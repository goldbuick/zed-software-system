const a3_0x240b=['machineInfo','gzip','runUrl','recordMetric','message','endRun','Invalid\x20end\x20run\x20response','then','runContext','axiosMultipleTries','../../../utilities/nx-imports','nxCloudVersion','printDuration','assign','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','status','note','devDependencies','apiAxiosInstance','createApiAxiosInstance','throw','data','apply','createMetricRecorder','...','post','apiError','/nx-cloud/runs/end','Invalid\x20Nx\x20Cloud\x20response:\x20','stack','CloudRunApi','axiosException','../../../utilities/axios','slice','startRun','RunEnd.\x20Completed\x20tasks','__esModule','Run\x20Details:','RunEnd\x20duration','length','RunStart\x20duration','from','done','VERBOSE_LOGGING','RunStart','map','createReqBody','RUNNER_FAILURE_PERF_ENTRY','terminalOutput','util','mapRespToPerfEntry','toString','response','headers','defineProperty','api','extractErrorMessage','messages','urls','readFileSync','string','Run\x20completion\x20responded\x20with\x20`undefined`.','parse','zlib','Invalid\x20end\x20run\x20response:\x20','../../../utilities/metric-logger','stringify','error','success'];(function(_0x7f1694,_0x240bf1){const _0x172a0f=function(_0x56016e){while(--_0x56016e){_0x7f1694['push'](_0x7f1694['shift']());}};_0x172a0f(++_0x240bf1);}(a3_0x240b,0x85));const a3_0x172a=function(_0x7f1694,_0x240bf1){_0x7f1694=_0x7f1694-0x0;let _0x172a0f=a3_0x240b[_0x7f1694];return _0x172a0f;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x4f7aa4,_0x52c0eb,_0xbaead4,_0x2c5b53){function _0x62bf0a(_0x151149){return _0x151149 instanceof _0xbaead4?_0x151149:new _0xbaead4(function(_0x5b388b){_0x5b388b(_0x151149);});}return new(_0xbaead4||(_0xbaead4=Promise))(function(_0x237841,_0x320d05){function _0x350f26(_0x4b573f){try{_0x2a7a88(_0x2c5b53['next'](_0x4b573f));}catch(_0x848192){_0x320d05(_0x848192);}}function _0x811807(_0x3d2627){try{_0x2a7a88(_0x2c5b53[a3_0x172a('0x19')](_0x3d2627));}catch(_0x329402){_0x320d05(_0x329402);}}function _0x2a7a88(_0x112036){_0x112036[a3_0x172a('0x2f')]?_0x237841(_0x112036['value']):_0x62bf0a(_0x112036['value'])[a3_0x172a('0xc')](_0x350f26,_0x811807);}_0x2a7a88((_0x2c5b53=_0x2c5b53[a3_0x172a('0x1b')](_0x4f7aa4,_0x52c0eb||[]))['next']());});};Object[a3_0x172a('0x3b')](exports,a3_0x172a('0x29'),{'value':!![]});exports[a3_0x172a('0x23')]=void 0x0;const axios_1=require(a3_0x172a('0x25'));const environment_1=require('../../../utilities/environment');const fs_1=require('fs');const zlib_1=require(a3_0x172a('0x44'));const util_1=require(a3_0x172a('0x36'));const metric_logger_1=require(a3_0x172a('0x1'));const {output}=require(a3_0x172a('0xf'));class CloudRunApi{constructor(_0x6c2275,_0x4ecd40,_0x55fdce,_0x52b65c){this[a3_0x172a('0x3e')]=_0x6c2275;this[a3_0x172a('0xd')]=_0x4ecd40;this[a3_0x172a('0x5')]=_0x52b65c;this[a3_0x172a('0x17')]=(0x0,axios_1[a3_0x172a('0x18')])(_0x55fdce);}['startRun'](_0x1073f3,_0x139287){var _0x3e07b4;return __awaiter(this,void 0x0,void 0x0,function*(){if(this['messages'][a3_0x172a('0x1f')])return{};const _0x2bd065=(0x0,metric_logger_1[a3_0x172a('0x1c')])(a3_0x172a('0x27'));try{const _0x26ef85={'meta':{'nxCloudVersion':this[a3_0x172a('0x10')]()},'branch':(0x0,environment_1['getBranch'])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'distributedExecutionId':_0x1073f3,'hashes':_0x139287};if(environment_1[a3_0x172a('0x30')]){output[a3_0x172a('0x15')]({'title':a3_0x172a('0x31'),'bodyLines':['\x0a'+JSON['stringify'](_0x26ef85,null,0x2)]});}const _0x5e26b9=yield(0x0,axios_1[a3_0x172a('0x11')])(a3_0x172a('0x2d'),()=>(0x0,axios_1[a3_0x172a('0xe')])(()=>this[a3_0x172a('0x17')][a3_0x172a('0x1e')]('/nx-cloud/runs/start',_0x26ef85)));_0x2bd065[a3_0x172a('0x8')]((0x0,metric_logger_1[a3_0x172a('0x37')])(_0x5e26b9));if(_0x5e26b9[a3_0x172a('0x1a')]&&_0x5e26b9['data'][a3_0x172a('0x9')]){this['messages'][a3_0x172a('0x9')]=_0x5e26b9['data'][a3_0x172a('0x9')];}if(!_0x5e26b9[a3_0x172a('0x1a')]||!_0x5e26b9[a3_0x172a('0x1a')][a3_0x172a('0x3f')]){this[a3_0x172a('0x3e')][a3_0x172a('0x1f')]=a3_0x172a('0x21')+JSON['stringify'](_0x5e26b9[a3_0x172a('0x1a')]);return{};}return _0x5e26b9[a3_0x172a('0x1a')][a3_0x172a('0x3f')];}catch(_0x5db485){_0x2bd065[a3_0x172a('0x8')](((_0x3e07b4=_0x5db485===null||_0x5db485===void 0x0?void 0x0:_0x5db485[a3_0x172a('0x24')])===null||_0x3e07b4===void 0x0?void 0x0:_0x3e07b4[a3_0x172a('0x39')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x5db485[a3_0x172a('0x24')][a3_0x172a('0x39')]):metric_logger_1[a3_0x172a('0x34')]);this[a3_0x172a('0x3e')]['apiError']=this[a3_0x172a('0x3e')]['extractErrorMessage'](_0x5db485,'api');return{};}});}[a3_0x172a('0x33')](_0x5ce917,_0x37b832,_0x2514ba){const _0x2c70c5={'meta':{'nxCloudVersion':this[a3_0x172a('0x10')]()},'tasks':_0x37b832,'run':_0x5ce917,'linkId':_0x2514ba,'machineInfo':this[a3_0x172a('0x5')]};return JSON[a3_0x172a('0x2')](_0x2c70c5);}[a3_0x172a('0xa')](_0x33f756,_0x43382c,_0x290c9c){var _0x2fe0a2,_0x433e5f;return __awaiter(this,void 0x0,void 0x0,function*(){if(this['messages'][a3_0x172a('0x1f')])return![];let _0x1fb6b8=this[a3_0x172a('0x33')](_0x33f756,_0x43382c,_0x290c9c);if(_0x1fb6b8[a3_0x172a('0x2c')]>0x14*0x3e8*0x3e8){_0x1fb6b8=this['createReqBody'](_0x33f756,_0x43382c[a3_0x172a('0x32')](_0x4ce5b2=>Object[a3_0x172a('0x12')](Object[a3_0x172a('0x12')]({},_0x4ce5b2),{'hashDetails':undefined})));}const _0x582219=Buffer[a3_0x172a('0x2e')](_0x1fb6b8);const _0x4729fa=yield(0x0,util_1['promisify'])(zlib_1[a3_0x172a('0x6')])(_0x582219);const _0x11f0c0=(0x0,metric_logger_1[a3_0x172a('0x1c')])(a3_0x172a('0xa'));try{if(environment_1['VERBOSE_LOGGING']){const _0x1b36a9=_0x43382c['map'](_0xa4566=>{return Object[a3_0x172a('0x12')](Object['assign']({},_0xa4566),{'terminalOutput':_0xa4566[a3_0x172a('0x35')]?_0xa4566[a3_0x172a('0x35')][a3_0x172a('0x26')](0x0,0x14)+a3_0x172a('0x1d'):undefined});});output[a3_0x172a('0x15')]({'title':a3_0x172a('0x28'),'bodyLines':['\x0a'+JSON[a3_0x172a('0x2')](_0x1b36a9,null,0x2)]});}const _0x25d6d4=yield(0x0,axios_1[a3_0x172a('0x11')])(a3_0x172a('0x2b'),()=>(0x0,axios_1[a3_0x172a('0xe')])(()=>this['apiAxiosInstance'][a3_0x172a('0x1e')](a3_0x172a('0x20'),_0x4729fa,{'headers':Object[a3_0x172a('0x12')](Object[a3_0x172a('0x12')]({},this[a3_0x172a('0x17')]['defaults'][a3_0x172a('0x3a')]),{'Content-Encoding':'gzip','Content-Type':'application/octet-stream'})})));if(_0x25d6d4){_0x11f0c0['recordMetric']((0x0,metric_logger_1[a3_0x172a('0x37')])(_0x25d6d4));if(_0x25d6d4['data']&&_0x25d6d4[a3_0x172a('0x1a')][a3_0x172a('0x7')]&&_0x25d6d4[a3_0x172a('0x1a')][a3_0x172a('0x14')]===a3_0x172a('0x4')){this['runContext'][a3_0x172a('0x7')]=_0x25d6d4['data'][a3_0x172a('0x7')];return!![];}if(_0x25d6d4[a3_0x172a('0x1a')]&&_0x25d6d4[a3_0x172a('0x1a')][a3_0x172a('0x14')]){this[a3_0x172a('0x3e')]['apiError']='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x172a('0x2')](_0x25d6d4[a3_0x172a('0x1a')][a3_0x172a('0x9')]);}else if(_0x25d6d4['data']&&typeof _0x25d6d4[a3_0x172a('0x1a')]===a3_0x172a('0x41')){if(_0x25d6d4['data']!=='success'){this[a3_0x172a('0x3e')][a3_0x172a('0x1f')]=a3_0x172a('0x0')+JSON['stringify'](_0x25d6d4[a3_0x172a('0x1a')]);}}else{this[a3_0x172a('0x3e')][a3_0x172a('0x1f')]=a3_0x172a('0x0')+JSON[a3_0x172a('0x2')](_0x25d6d4[a3_0x172a('0x1a')]);}if(environment_1[a3_0x172a('0x30')]){output[a3_0x172a('0x15')]({'title':a3_0x172a('0xb'),'bodyLines':[JSON['stringify'](_0x25d6d4[a3_0x172a('0x1a')],null,0x2)]});}}else{output[a3_0x172a('0x3')]({'title':a3_0x172a('0x13'),'bodyLines':[a3_0x172a('0x42'),a3_0x172a('0x2a'),JSON[a3_0x172a('0x2')](_0x33f756,null,0x2),'Stack\x20Trace:',JSON[a3_0x172a('0x2')](new Error()[a3_0x172a('0x22')],null,0x2)]});}return![];}catch(_0x194aed){_0x11f0c0[a3_0x172a('0x8')](((_0x2fe0a2=_0x194aed===null||_0x194aed===void 0x0?void 0x0:_0x194aed['axiosException'])===null||_0x2fe0a2===void 0x0?void 0x0:_0x2fe0a2[a3_0x172a('0x39')])?(0x0,metric_logger_1[a3_0x172a('0x37')])(_0x194aed[a3_0x172a('0x24')][a3_0x172a('0x39')]):metric_logger_1[a3_0x172a('0x34')]);const _0x2b228e=(_0x433e5f=_0x194aed[a3_0x172a('0x24')])!==null&&_0x433e5f!==void 0x0?_0x433e5f:_0x194aed;this['messages'][a3_0x172a('0x1f')]=this[a3_0x172a('0x3e')][a3_0x172a('0x3d')](_0x2b228e,a3_0x172a('0x3c'));return![];}});}[a3_0x172a('0x10')](){try{const _0x3c8637=JSON[a3_0x172a('0x43')]((0x0,fs_1[a3_0x172a('0x40')])('package.json')[a3_0x172a('0x38')]());return _0x3c8637[a3_0x172a('0x16')]['@nrwl/nx-cloud'];}catch(_0x422ab5){return'unknown';}}}exports[a3_0x172a('0x23')]=CloudRunApi;
const a6_0xbaec=['printCacheableTargetsError','trim','DteArtifactStorage','E2EEncryption','../../error/print-cacheable-targets-error','argv','unlinkSync','CIRCLECI','map','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','catch','join','Critical\x20Error\x20in\x20Agent:\x20\x22','options','encryptionKey','some','yargs-parser','cacheableOperations','CIRCLE_STAGE','../../error/print-invalid-runner-error','../../../utilities/environment','message','getRunGroup','@nrwl/nx-cloud','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','ENCRYPTION_KEY','default','next','value','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','invokeTasksUsingNxImperativeApi','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20target(s)\x20[','../../error/print-run-group-error','Other\x20Nx\x20Cloud\x20Agents\x20Detected','error','NX_AGENT_NAME','filter','split','readdirSync','../../file-storage/file-storage','printRunGroupError','existsSync','../../api/error-reporter.api','Agent\x20','floor','executeTasks','./distributed-agent.api','../../../utilities/metric-logger','Agent\x20was\x20terminated\x20via\x20SIGTERM','./execute-tasks','parse','Agent\x20was\x20terminated\x20via\x20SIGINT','printInvalidRunnerError','env','exit','random','writeFileSync','./invoke-tasks-using-run-many','FileStorage','includes','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','CIRCLE_JOB','../../../utilities/dte-artifact-storage','targets','.lock','/lockfiles','Duplicate\x20Agent\x20ID\x20Detected','getNxCacheDirectory','length','/nx.json','done','SIGTERM','__awaiter','readFileSync','completeRunGroupWithError','SIGINT','defineProperty','note','ErrorReporterApi'];(function(_0x59df9e,_0xbaec8e){const _0x3ed8e5=function(_0x129c04){while(--_0x129c04){_0x59df9e['push'](_0x59df9e['shift']());}};_0x3ed8e5(++_0xbaec8e);}(a6_0xbaec,0x1dd));const a6_0x3ed8=function(_0x59df9e,_0xbaec8e){_0x59df9e=_0x59df9e-0x0;let _0x3ed8e5=a6_0xbaec[_0x59df9e];return _0x3ed8e5;};'use strict';var __awaiter=this&&this[a6_0x3ed8('0x45')]||function(_0x5c901f,_0x88dc9a,_0x2b213f,_0x2d4a22){function _0xd2f44e(_0x4593a6){return _0x4593a6 instanceof _0x2b213f?_0x4593a6:new _0x2b213f(function(_0x3a98ed){_0x3a98ed(_0x4593a6);});}return new(_0x2b213f||(_0x2b213f=Promise))(function(_0x2482d9,_0x186eb6){function _0x25fc93(_0x2199cc){try{_0x12e5c0(_0x2d4a22[a6_0x3ed8('0x18')](_0x2199cc));}catch(_0x4e644f){_0x186eb6(_0x4e644f);}}function _0x102804(_0x4ddf57){try{_0x12e5c0(_0x2d4a22['throw'](_0x4ddf57));}catch(_0xbcdd6a){_0x186eb6(_0xbcdd6a);}}function _0x12e5c0(_0x168f85){_0x168f85[a6_0x3ed8('0x43')]?_0x2482d9(_0x168f85[a6_0x3ed8('0x19')]):_0xd2f44e(_0x168f85[a6_0x3ed8('0x19')])['then'](_0x25fc93,_0x102804);}_0x12e5c0((_0x2d4a22=_0x2d4a22['apply'](_0x5c901f,_0x88dc9a||[]))['next']());});};Object[a6_0x3ed8('0x49')](exports,'__esModule',{'value':!![]});exports['startAgent']=void 0x0;const fs_1=require('fs');const stripJsonComments=require('strip-json-comments');const yargsParser=require(a6_0x3ed8('0xd'));const environment_1=require(a6_0x3ed8('0x11'));const metric_logger_1=require(a6_0x3ed8('0x2c'));const print_cacheable_targets_error_1=require(a6_0x3ed8('0x1'));const print_invalid_runner_error_1=require(a6_0x3ed8('0x10'));const print_run_group_error_1=require(a6_0x3ed8('0x1d'));const distributed_agent_api_1=require(a6_0x3ed8('0x2b'));const execute_tasks_1=require(a6_0x3ed8('0x2e'));const dte_artifact_storage_1=require(a6_0x3ed8('0x3b'));const file_storage_1=require(a6_0x3ed8('0x24'));const e2e_encryption_1=require('../../file-storage/e2e-encryption');const error_reporter_api_1=require(a6_0x3ed8('0x27'));const invoke_tasks_using_run_many_1=require(a6_0x3ed8('0x36'));const invoke_tasks_using_nx_imperative_api_1=require('./invoke-tasks-using-nx-imperative-api');const {output,initTasksRunner,workspaceRoot}=require('../../../utilities/nx-imports');const args=yargsParser(process[a6_0x3ed8('0x2')],{'array':[a6_0x3ed8('0x3c')],'default':{}});if(args[a6_0x3ed8('0x3c')]&&args[a6_0x3ed8('0x3c')][a6_0x3ed8('0x41')]===0x1){args['targets']=args[a6_0x3ed8('0x3c')][0x0][a6_0x3ed8('0x22')](',')[a6_0x3ed8('0x5')](_0x4ee2ca=>_0x4ee2ca[a6_0x3ed8('0x4d')]());}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x111f60=(0x0,environment_1[a6_0x3ed8('0x13')])();if(!_0x111f60){(0x0,print_run_group_error_1[a6_0x3ed8('0x25')])();return process[a6_0x3ed8('0x33')](0x1);}if(args[a6_0x3ed8('0x3c')]&&args[a6_0x3ed8('0x3c')]['length']){output[a6_0x3ed8('0x4a')]({'title':a6_0x3ed8('0x1c')+args[a6_0x3ed8('0x3c')][a6_0x3ed8('0x8')](',\x20')+']'});}else{output[a6_0x3ed8('0x4a')]({'title':a6_0x3ed8('0x1a')});}const _0x169b65=JSON[a6_0x3ed8('0x2f')](stripJsonComments((0x0,fs_1[a6_0x3ed8('0x46')])(workspaceRoot+a6_0x3ed8('0x42'))['toString']()))['tasksRunnerOptions'][a6_0x3ed8('0x17')];if(_0x169b65['runner']!==a6_0x3ed8('0x14')){(0x0,print_invalid_runner_error_1[a6_0x3ed8('0x31')])();return process['exit'](0x1);}const _0xe9211a=_0x169b65[a6_0x3ed8('0xa')];if(args[a6_0x3ed8('0x3c')]&&args[a6_0x3ed8('0x3c')][a6_0x3ed8('0xc')](_0x50c166=>{var _0x399011;return!((_0x399011=_0xe9211a['cacheableOperations'])===null||_0x399011===void 0x0?void 0x0:_0x399011[a6_0x3ed8('0x38')](_0x50c166));})){const _0x168e50=args[a6_0x3ed8('0x3c')][a6_0x3ed8('0x21')](_0x4c4a5c=>{var _0x38eb51;return!((_0x38eb51=_0xe9211a[a6_0x3ed8('0xe')])===null||_0x38eb51===void 0x0?void 0x0:_0x38eb51['includes'](_0x4c4a5c));});(0x0,print_cacheable_targets_error_1[a6_0x3ed8('0x4c')])(_0x168e50);return process[a6_0x3ed8('0x33')](0x1);}const _0x50a480=getAgentName();const _0x42cbc1=new distributed_agent_api_1['DistributedAgentApi'](_0xe9211a,_0x111f60,_0x50a480);createAgentLockfileAndSetUpListeners(_0x42cbc1,_0xe9211a,_0x50a480);const _0x220c19=new e2e_encryption_1[(a6_0x3ed8('0x0'))](environment_1[a6_0x3ed8('0x16')]||_0xe9211a[a6_0x3ed8('0xb')]);const _0x82cac0=new error_reporter_api_1[(a6_0x3ed8('0x4b'))](_0xe9211a);const _0x278fc5=new dte_artifact_storage_1[(a6_0x3ed8('0x4e'))](new file_storage_1[(a6_0x3ed8('0x37'))](_0x220c19,_0x82cac0),(0x0,environment_1['getNxCacheDirectory'])(_0xe9211a));const _0x54a891=initTasksRunner?yield(0x0,invoke_tasks_using_nx_imperative_api_1[a6_0x3ed8('0x1b')])(_0xe9211a):yield(0x0,invoke_tasks_using_run_many_1['invokeTasksUsingRunMany'])(_0xe9211a);return(0x0,execute_tasks_1[a6_0x3ed8('0x2a')])(_0x50a480,_0x42cbc1,_0x278fc5,_0x54a891,args[a6_0x3ed8('0x3c')])['then'](_0x525047=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1['submitRunMetrics'])(_0xe9211a);return _0x525047;}))[a6_0x3ed8('0x7')](_0x37e63c=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x42cbc1['completeRunGroupWithError'](a6_0x3ed8('0x9')+_0x37e63c[a6_0x3ed8('0x12')]+'\x22');throw _0x37e63c;}));});}exports['startAgent']=startAgent;function getAgentName(){if(process[a6_0x3ed8('0x32')][a6_0x3ed8('0x20')]!==undefined){return process[a6_0x3ed8('0x32')][a6_0x3ed8('0x20')];}else if(process['env']['CIRCLECI']!==undefined&&process['env'][a6_0x3ed8('0xf')]){return process[a6_0x3ed8('0x32')]['CIRCLE_STAGE'];}else if(process[a6_0x3ed8('0x32')][a6_0x3ed8('0x4')]!==undefined&&process['env']['CIRCLE_JOB']){return process['env'][a6_0x3ed8('0x3a')];}else{return a6_0x3ed8('0x28')+Math[a6_0x3ed8('0x29')](Math[a6_0x3ed8('0x34')]()*0x186a0);}}function createAgentLockfileAndSetUpListeners(_0x132eb6,_0x45f0d0,_0x4e9511){const _0x200cb0=(0x0,environment_1[a6_0x3ed8('0x40')])(_0x45f0d0);const _0x2fdf60=_0x200cb0+a6_0x3ed8('0x3e');const _0x450908=_0x2fdf60+'/'+_0x4e9511+a6_0x3ed8('0x3d');if(!(0x0,fs_1[a6_0x3ed8('0x26')])(_0x2fdf60)){(0x0,fs_1['mkdirSync'])(_0x2fdf60,{'recursive':!![]});}const _0x3f7719=(0x0,fs_1[a6_0x3ed8('0x23')])(_0x2fdf60);if(_0x3f7719['length']){if(_0x3f7719[a6_0x3ed8('0x38')](_0x4e9511+'.lock')){output[a6_0x3ed8('0x1f')]({'title':a6_0x3ed8('0x3f'),'bodyLines':['We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.']});process[a6_0x3ed8('0x33')](0x1);}output['warn']({'title':a6_0x3ed8('0x1e'),'bodyLines':[a6_0x3ed8('0x6'),'',a6_0x3ed8('0x39'),a6_0x3ed8('0x15')]});}(0x0,fs_1[a6_0x3ed8('0x35')])(_0x450908,'');process['on'](a6_0x3ed8('0x33'),_0x546cd9=>{cleanupAgentLockfile(_0x450908,_0x546cd9);});process['on'](a6_0x3ed8('0x44'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x132eb6[a6_0x3ed8('0x47')](a6_0x3ed8('0x2d'));cleanupAgentLockfile(_0x450908,0x1);}));process['on'](a6_0x3ed8('0x48'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x132eb6[a6_0x3ed8('0x47')](a6_0x3ed8('0x30'));cleanupAgentLockfile(_0x450908,0x1);}));}function cleanupAgentLockfile(_0x286259,_0x5a89dc){if((0x0,fs_1[a6_0x3ed8('0x26')])(_0x286259)){(0x0,fs_1[a6_0x3ed8('0x3')])(_0x286259);process[a6_0x3ed8('0x33')](_0x5a89dc);}}
(function(){"use strict";const hh=new Set,ta={emit(t,e,r,n,i){ta.invoke($S(t,e,r,n,i))},invoke(t){hh.forEach(e=>e.handle(t))},connect(t){hh.add(t)},disconnect(t){hh.delete(t)}};var Fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function rS(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var r=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var wc={exports:{}},nS=wc.exports,Cm;function iS(){return Cm||(Cm=1,(function(t,e){(function(r,n){t.exports=n()})(nS,function(){return r.importState=function(i){var s=new r;return s.importState(i),s},r;function r(){return(function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=n();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var d=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return d.next=d,d.uint32=function(){return d()*4294967296},d.fract53=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.version="Alea 0.9",d.args=i,d.exportState=function(){return[s,o,a,c]},d.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},d})(Array.prototype.slice.call(arguments))}function n(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(wc)),wc.exports}var sS=iS(),Lm=Xs(sS),ra={},Mm;function oS(){return Mm||(Mm=1,(function(t){var e=ra&&ra.__spreadArray||function(l,u,d){if(d||arguments.length===2)for(var f=0,h=u.length,m;f<h;f++)(m||!(f in u))&&(m||(m=Array.prototype.slice.call(u,0,f)),m[f]=u[f]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function r(l){return l[Math.floor(Math.random()*l.length)]}function n(l){return l.reduce(function(u,d){return u.length>d.length?u:d})}function i(l){return l.reduce(function(u,d){return u.length<d.length?u:d})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,d=u===void 0?"":u,f=l.capitalize,h=f===void 0?!0:f,m=l.adjectiveCount,p=m===void 0?1:m,g=l.addAdverb,y=g===void 0?!1:g,b=e(e(e([],e([],Array(p),!0).map(function(A){return r(t.adjectives)}),!0),[r(t.nouns),r(t.verbs)],!1),y?[r(t.adverbs)]:[],!0);return h&&(b=b.map(function(A){return A.charAt(0).toUpperCase()+A.substr(1)})),b.join(d)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,f=l.addAdverb,h=f===void 0?!1:f;return t.adjectives.length*d*t.nouns.length*t.verbs.length*(h?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,f=l.addAdverb,h=f===void 0?!1:f,m=l.separator,p=m===void 0?"":m;return n(t.adjectives).length*d+d*p.length+n(t.nouns).length+p.length+n(t.verbs).length+(h?n(t.adverbs).length+p.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,f=l.addAdverb,h=f===void 0?!1:f,m=l.separator,p=m===void 0?"":m;return i(t.adjectives).length*d+d*p.length+i(t.nouns).length+p.length+i(t.verbs).length+(h?i(t.adverbs).length+p.length:0)}t.minLength=c,t.default=s})(ra)),ra}var aS=oS(),Um=Xs(aS);const cS="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let lS=t=>crypto.getRandomValues(new Uint8Array(t)),uS=(t,e,r)=>{let n=(2<<Math.log2(t.length-1))-1,i=-~(1.6*n*e/t.length);return(s=e)=>{let o="";for(;;){let a=r(i),c=i|0;for(;c--;)if(o+=t[a[c]&n]||"",o.length>=s)return o}}},$m=(t,e=21)=>uS(t,e|0,lS),hS=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=cS[r[t]&63];return e};var fh,Pm;function Fm(){return Pm||(Pm=1,fh="abcdefghijklmnopqrstuvwxyz"),fh}var dh,Bm;function Dm(){return Bm||(Bm=1,dh="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),dh}var ph,jm;function zm(){return jm||(jm=1,ph="0123456789"),ph}var mh,Wm;function fS(){return Wm||(Wm=1,mh="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz"),mh}var gh,Hm;function dS(){return Hm||(Hm=1,gh="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz"),gh}var yh,Gm;function pS(){if(Gm)return yh;Gm=1;const t=zm(),e=Fm(),r=Dm();return yh=t+e+r,yh}var _h,Km;function mS(){return Km||(Km=1,_h={lowercase:Fm(),uppercase:Dm(),numbers:zm(),nolookalikes:fS(),nolookalikesSafe:dS(),alphanumeric:pS()}),_h}var bh=mS();function Ft(){return`sid_${hS(12).replaceAll("-",".")}`}$m(bh.numbers,4),$m(`${bh.numbers}${bh.lowercase}`,16);function _r(t){return t?.startsWith("pid_")??!1}function gS(){return Um({capitalize:!1,adjectiveCount:1})}function yS(){return Um({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var _S=(function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}})(),bS=Object.prototype.hasOwnProperty;function wh(t,e){return bS.call(t,e)}function kh(t){if(Array.isArray(t)){for(var e=new Array(t.length),r=0;r<e.length;r++)e[r]=""+r;return e}if(Object.keys)return Object.keys(t);var n=[];for(var i in t)wh(t,i)&&n.push(i);return n}function Pr(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function vh(t){for(var e=0,r=t.length,n;e<r;){if(n=t.charCodeAt(e),n>=48&&n<=57){e++;continue}return!1}return!0}function cs(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function qm(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function xh(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,r=t.length;e<r;e++)if(xh(t[e]))return!0}else if(typeof t=="object"){for(var n=kh(t),i=n.length,s=0;s<i;s++)if(xh(t[n[s]]))return!0}}return!1}function Ym(t,e){var r=[t];for(var n in e){var i=typeof e[n]=="object"?JSON.stringify(e[n],null,2):e[n];typeof i<"u"&&r.push(n+": "+i)}return r.join(`
`)}var Vm=(function(t){_S(e,t);function e(r,n,i,s,o){var a=this.constructor,c=t.call(this,Ym(r,{name:n,index:i,operation:s,tree:o}))||this;return c.name=n,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Ym(r,{name:n,index:i,operation:s,tree:o}),c}return e})(Error),Lt=Vm,wS=Pr,Zs={add:function(t,e,r){return t[e]=this.value,{newDocument:r}},remove:function(t,e,r){var n=t[e];return delete t[e],{newDocument:r,removed:n}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:function(t,e,r){var n=kc(r,this.path);n&&(n=Pr(n));var i=ls(r,{op:"remove",path:this.from}).removed;return ls(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:n}},copy:function(t,e,r){var n=kc(r,this.from);return ls(r,{op:"add",path:this.path,value:Pr(n)}),{newDocument:r}},test:function(t,e,r){return{newDocument:r,test:na(t[e],this.value)}},_get:function(t,e,r){return this.value=t[e],{newDocument:r}}},kS={add:function(t,e,r){return vh(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:r,index:e}},remove:function(t,e,r){var n=t.splice(e,1);return{newDocument:r,removed:n[0]}},replace:function(t,e,r){var n=t[e];return t[e]=this.value,{newDocument:r,removed:n}},move:Zs.move,copy:Zs.copy,test:Zs.test,_get:Zs._get};function kc(t,e){if(e=="")return t;var r={op:"_get",path:e};return ls(t,r),r.value}function ls(t,e,r,n,i,s){if(r===void 0&&(r=!1),n===void 0&&(n=!0),i===void 0&&(i=!0),s===void 0&&(s=0),r&&(typeof r=="function"?r(e,0,t,e.path):vc(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=kc(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=na(t,e.value),o.test===!1)throw new Lt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(r)throw new Lt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{n||(t=Pr(t));var a=e.path||"",c=a.split("/"),l=t,u=1,d=c.length,f=void 0,h=void 0,m=void 0;for(typeof r=="function"?m=r:m=vc;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=qm(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&f===void 0&&(l[h]===void 0?f=c.slice(0,u).join("/"):u==d-1&&(f=e.path),f!==void 0&&m(e,0,t,f)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(r&&!vh(h))throw new Lt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);vh(h)&&(h=~~h)}if(u>=d){if(r&&e.op==="add"&&h>l.length)throw new Lt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=kS[e.op].call(e,l,h,t);if(o.test===!1)throw new Lt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=d){var o=Zs[e.op].call(e,l,h,t);if(o.test===!1)throw new Lt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[h],r&&u<d&&(!l||typeof l!="object"))throw new Lt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function Eh(t,e,r,n,i){if(n===void 0&&(n=!0),i===void 0&&(i=!0),r&&!Array.isArray(e))throw new Lt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(t=Pr(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=ls(t,e[o],r,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function vS(t,e,r){var n=ls(t,e);if(n.test===!1)throw new Lt("Test operation failed","TEST_OPERATION_FAILED",r,e,t);return n.newDocument}function vc(t,e,r,n){if(typeof t!="object"||t===null||Array.isArray(t))throw new Lt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,r);if(Zs[t.op]){if(typeof t.path!="string")throw new Lt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,r);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Lt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,r);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Lt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Lt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,r);if((t.op==="add"||t.op==="replace"||t.op==="test")&&xh(t.value))throw new Lt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,r);if(r){if(t.op=="add"){var i=t.path.split("/").length,s=n.split("/").length;if(i!==s+1&&i!==s)throw new Lt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,r)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==n)throw new Lt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,r)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=Xm([o],r);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Lt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,r)}}}else throw new Lt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,r)}function Xm(t,e,r){try{if(!Array.isArray(t))throw new Lt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Eh(Pr(e),Pr(t),r||!0);else{r=r||vc;for(var n=0;n<t.length;n++)r(t[n],n,e,void 0)}}catch(i){if(i instanceof Lt)return i;throw i}}function na(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=Array.isArray(t),n=Array.isArray(e),i,s,o;if(r&&n){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!na(t[i],e[i]))return!1;return!0}if(r!=n)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!na(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var xS=Object.freeze({__proto__:null,JsonPatchError:Lt,_areEquals:na,applyOperation:ls,applyPatch:Eh,applyReducer:vS,deepClone:wS,getValueByPointer:kc,validate:Xm,validator:vc});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Ah=new WeakMap,ES=(function(){function t(e){this.observers=new Map,this.obj=e}return t})(),AS=(function(){function t(e,r){this.callback=e,this.observer=r}return t})();function TS(t){return Ah.get(t)}function SS(t,e){return t.observers.get(e)}function RS(t,e){t.observers.delete(e.callback)}function OS(t,e){e.unobserve()}function IS(t,e){var r=[],n,i=TS(t);if(!i)i=new ES(t),Ah.set(t,i);else{var s=SS(i,e);n=s&&s.observer}if(n)return n;if(n={},i.value=Pr(t),e){n.callback=e,n.next=null;var o=function(){Th(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=r,n.object=t,n.unobserve=function(){Th(n),clearTimeout(n.next),RS(i,n),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new AS(e,n)),n}function Th(t,e){e===void 0&&(e=!1);var r=Ah.get(t.object);Sh(r.value,t.object,t.patches,"",e),t.patches.length&&Eh(r.value,t.patches);var n=t.patches;return n.length>0&&(t.patches=[],t.callback&&t.callback(n)),n}function Sh(t,e,r,n,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=kh(e),o=kh(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(wh(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var d=e[l];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?Sh(u,d,r,n+"/"+cs(l),i):u!==d&&(i&&r.push({op:"test",path:n+"/"+cs(l),value:Pr(u)}),r.push({op:"replace",path:n+"/"+cs(l),value:Pr(d)}))}else Array.isArray(t)===Array.isArray(e)?(i&&r.push({op:"test",path:n+"/"+cs(l),value:Pr(u)}),r.push({op:"remove",path:n+"/"+cs(l)}),a=!0):(i&&r.push({op:"test",path:n,value:t}),r.push({op:"replace",path:n,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!wh(t,l)&&e[l]!==void 0&&r.push({op:"add",path:n+"/"+cs(l),value:Pr(e[l])})}}}function Zm(t,e,r){r===void 0&&(r=!1);var n=[];return Sh(t,e,n,"",r),n}var NS=Object.freeze({__proto__:null,compare:Zm,generate:Th,observe:IS,unobserve:OS});Object.assign({},xS,NS,{JsonPatchError:Vm,deepClone:Pr,escapePathComponent:cs,unescapePathComponent:qm});var Rh,Jm;function CS(){if(Jm)return Rh;Jm=1;var t=typeof Element<"u",e=typeof Map=="function",r=typeof Set=="function",n=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function i(s,o){if(s===o)return!0;if(s&&o&&typeof s=="object"&&typeof o=="object"){if(s.constructor!==o.constructor)return!1;var a,c,l;if(Array.isArray(s)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(!i(s[c],o[c]))return!1;return!0}var u;if(e&&s instanceof Map&&o instanceof Map){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;for(u=s.entries();!(c=u.next()).done;)if(!i(c.value[1],o.get(c.value[0])))return!1;return!0}if(r&&s instanceof Set&&o instanceof Set){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;return!0}if(n&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(o)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(s[c]!==o[c])return!1;return!0}if(s.constructor===RegExp)return s.source===o.source&&s.flags===o.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof o.valueOf=="function")return s.valueOf()===o.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof o.toString=="function")return s.toString()===o.toString();if(l=Object.keys(s),a=l.length,a!==Object.keys(o).length)return!1;for(c=a;c--!==0;)if(!Object.prototype.hasOwnProperty.call(o,l[c]))return!1;if(t&&s instanceof Element)return!1;for(c=a;c--!==0;)if(!((l[c]==="_owner"||l[c]==="__v"||l[c]==="__o")&&s.$$typeof)&&!i(s[l[c]],o[l[c]]))return!1;return!0}return s!==s&&o!==o}return Rh=function(o,a){try{return i(o,a)}catch(c){if((c.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw c}},Rh}var LS=CS(),MS=Xs(LS);function w(t){return t!=null}const Fr=Object.keys;function Sn(t){return Pr(t)}function US(t){return typeof t=="boolean"}function Te(t){return typeof t=="number"&&isNaN(t)===!1}function ye(t){return typeof t=="string"}function ut(t){return Array.isArray(t)}function Oh(t){return t}var it=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(it||{}),We=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t[t.ISGHOST=4]="ISGHOST",t))(We||{}),Br=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Br||{}),ve=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t[t.AWAY=16]="AWAY",t[t.TOWARD=17]="TOWARD",t[t.FIND=18]="FIND",t[t.FLEE=19]="FLEE",t[t.TO=20]="TO",t[t.MID=21]="MID",t[t.OVER=22]="OVER",t[t.UNDER=23]="UNDER",t[t.WITHIN=24]="WITHIN",t[t.AWAYBY=25]="AWAYBY",t))(ve||{}),Pe=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.HOTKEY=11]="HOTKEY",t[t.COPYIT=12]="COPYIT",t[t.OPENIT=13]="OPENIT",t[t.VIEWIT=14]="VIEWIT",t[t.ZSSEDIT=15]="ZSSEDIT",t[t.CHAREDIT=16]="CHAREDIT",t[t.COLOREDIT=17]="COLOREDIT",t))(Pe||{});function Fe(t){return ye(t)?t.toLowerCase().trim():""}function $S(t,e,r,n,i){return{session:t,player:e,id:Ft(),sender:r,target:n,data:i}}function Dr(t){const[e,...r]=t.split(":");return{target:e,path:r.join(":")}}function Js(t,e=[],r=Oh,n=""){const i=Ft(),s=Fe(t),o=e.map(Fe);let a=n;const c={id(){return i},name(){return t},session(l){return w(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,d){ta.emit(a,l,i,u,d)},reply(l,u,d){c.emit(l.player,`${l.sender}:${u}`,d)},replynext(l,u,d){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,d),64)},handle(l){const{target:u,path:d}=Dr(l.target),f=Fe(u);!a&&f==="ready"&&(a=l.session),f==="session_reset"&&(a=""),o.findIndex(h=>h==="all"||h===f)!==-1&&r(l),(i===u||f==="all"||s===f)&&r({...l,target:d})}};return ta.connect(c),c}function PS(t){return typeof t=="object"&&ye(t.session)&&ye(t.player)&&ye(t.id)&&ye(t.sender)&&ye(t.target)}function mt(t,e,r,...n){return t.emit(e,"error",[`$red${r}$blue>>`,...n]),!1}function FS(t,e,...r){return t.emit(e,"info",r),!0}function Bt(t,e,...r){return t.emit(e,"log",r),!0}function BS(t,e,...r){return t.emit(e,"chat",r),!0}function ia(t,e,r){t.emit(e,"toast",r)}function DS(t,e,r){t.emit(e,"bridge:streamstart",r)}function jS(t,e){t.emit(e,"bridge:streamstop",void 0)}function zS(t,e,r){t.emit(e,"bridge:chatstart",r)}function WS(t,e){t.emit(e,"bridge:chatstop")}function HS(t,e,r,n,i,s,o){t.emit(e,"bridge:fetch",[r,n,i,s,o])}function GS(t,e,r){t.emit(e,"bridge:start",r)}function KS(t,e,r){t.emit(e,"bridge:tab",r)}function qS(t,e,r){t.emit(e,"gadgetclient:paint",r)}function YS(t,e,r){t.emit(e,"gadgetclient:patch",r)}function VS(t,e){t.emit(e,"gadgetserver:clearscroll")}function XS(t,e){t.emit(e,"gadgetserver:clearplayer")}function ZS(t){t.emit("","ready")}function Qm(t,e){t.emit(e,"register:loginfail")}function Ih(t,e){t.emit(e,"register:loginready",!0)}function JS(t,e,r,n){t.emit(e,"register:savemem",[r,n])}function QS(t,e,r){t.emit(e,"register:forkmem",[r])}function eR(t,e,r,n){t.emit(e,"register:itchiopublishmem",[r,n])}function Nh(t,e,r){t.emit(e,"register:copy",r)}function tR(t,e,r,n){t.emit(e,"register:copyjsonfile",[r,n])}function eg(t,e,r,n){t.emit(e,"register:downloadjsonfile",[r,n])}function rR(t,e){t.emit(e,"register:dev",void 0)}function nR(t,e){t.emit(e,"register:share",void 0)}function iR(t,e){t.emit(e,"register:nuke",void 0)}function sR(t,e){t.emit(e,"register:enterar",void 0)}function oR(t,e,r,n){t.emit(e,"synth:tts",[r,n])}function aR(t,e,r,n){t.emit(e,"synth:ttsqueue",[r,n])}function cR(t,e,r,n){t.emit(e,"synth:play",[r,n])}function lR(t,e,r,n,i){t.emit(e,"synth:bgplay",[r,n,i])}function uR(t,e,r){t.emit(e,"synth:bpm",r)}function hR(t,e,r){t.emit(e,"synth:playvolume",r)}function fR(t,e,r){t.emit(e,"synth:bgplayvolume",r)}function dR(t,e,r){t.emit(e,"synth:ttsvolume",r)}function Ch(t,e,r,n,i){t.emit(e,"synth:voice",[r,n,i])}function tg(t,e,r,n,i,s){t.emit(e,"synth:voicefx",[r,n,i,s])}function pR(t,e,r){t.emit(e,"synth:record",r)}function mR(t,e){t.emit(e,"synth:flush",filename)}function rg(t,e,r,n){t.emit(e,"register:config",[r,n])}function gR(t,e){t.emit(e,"register:configshow")}function yR(t,e){t.emit(e,"register:inspector")}function _R(t,e){t.emit(e,"register:terminal:full")}function ng(t,e,r,n,i,s){t.emit(e,"register:editor:open",[r,n,i,s])}function bR(t,e,r,n){t.emit(e,"vm:zztsearch",[r,n])}function wR(t,e){t.emit(e,"vm:zztrandom")}function kR(t,e){t.emit(e,"vm:local")}function Lh(t,e){t.emit(e,"vm:logout")}function ig(t,e,r,n,i){t.emit(e,"vm:touched",[r,n,i])}function vR(t,e){t.emit(e,"vm:readzipfilelist")}function xc(t,e){const[r,n]=e;return`${t}:${[r,n].filter(w).join(":")}`}function xR(t,e,r){t.emit(e,"vm:cli",r)}function ER(t,e){t.emit(e,"vm:restart")}function sg(t,e){t.emit(e,"vm:flush")}function AR(t,e){t.emit(e,"vm:fork")}function TR(t,e){t.emit(e,"vm:itchiopublish")}function SR(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function RR(t,e){return{filename:t,json:e}}function OR(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function Mh(t,e,r,n,i,s){let o;switch(n){case"file":o=s;break;case"text":o=SR(i,s);break;case"json":o=RR(i,s);break;case"binary":o=OR(i,s);break}setTimeout(()=>{t.emit(e,"vm:loader",[r,n,i,o])},1)}function IR(t){const e=new Set;function r(s){PS(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),ta.invoke(s))}const n=Js("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){ta.disconnect(n)}return{forward:r,disconnect:i}}function NR(t){switch(t.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"chat":case"toast":case"second":return!0;default:{const e=Dr(t.target);switch(e.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const Uh=80,Ec=Math.floor(1e3/Uh),og=3;function Ac(t){return new Promise(e=>setTimeout(e,t))}const $h=Js("clock");let Ph=0,Tc=0,Fh=0,ag=performance.now();function cg(){const t=performance.now(),e=t-ag;Fh+=e,Fh>=Uh&&(Fh%=Uh,$h.emit("","tick",Tc),$h.emit("","tock",Tc),++Ph,++Tc,Ph>=Ec&&(Ph%=Ec,$h.emit("","second",Tc))),ag=t,setTimeout(cg,2)}cg();var Bh={exports:{}};function CR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var lg={exports:{}},Dt=lg.exports={},Hn,Gn;function Dh(){throw new Error("setTimeout has not been defined")}function jh(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Hn=setTimeout:Hn=Dh}catch{Hn=Dh}try{typeof clearTimeout=="function"?Gn=clearTimeout:Gn=jh}catch{Gn=jh}})();function ug(t){if(Hn===setTimeout)return setTimeout(t,0);if((Hn===Dh||!Hn)&&setTimeout)return Hn=setTimeout,setTimeout(t,0);try{return Hn(t,0)}catch{try{return Hn.call(null,t,0)}catch{return Hn.call(this,t,0)}}}function LR(t){if(Gn===clearTimeout)return clearTimeout(t);if((Gn===jh||!Gn)&&clearTimeout)return Gn=clearTimeout,clearTimeout(t);try{return Gn(t)}catch{try{return Gn.call(null,t)}catch{return Gn.call(this,t)}}}var pi=[],Qs=!1,us,Sc=-1;function MR(){!Qs||!us||(Qs=!1,us.length?pi=us.concat(pi):Sc=-1,pi.length&&hg())}function hg(){if(!Qs){var t=ug(MR);Qs=!0;for(var e=pi.length;e;){for(us=pi,pi=[];++Sc<e;)us&&us[Sc].run();Sc=-1,e=pi.length}us=null,Qs=!1,LR(t)}}Dt.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];pi.push(new fg(t,e)),pi.length===1&&!Qs&&ug(hg)};function fg(t,e){this.fun=t,this.array=e}fg.prototype.run=function(){this.fun.apply(null,this.array)},Dt.title="browser",Dt.browser=!0,Dt.env={},Dt.argv=[],Dt.version="",Dt.versions={};function mi(){}Dt.on=mi,Dt.addListener=mi,Dt.once=mi,Dt.off=mi,Dt.removeListener=mi,Dt.removeAllListeners=mi,Dt.emit=mi,Dt.prependListener=mi,Dt.prependOnceListener=mi,Dt.listeners=function(t){return[]},Dt.binding=function(t){throw new Error("process.binding is not supported")},Dt.cwd=function(){return"/"},Dt.chdir=function(t){throw new Error("process.chdir is not supported")},Dt.umask=function(){return 0};var UR=lg.exports;const Rn=CR(UR);var Qe={},dg;function $R(){if(dg)return Qe;dg=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),d=Symbol.iterator;function f(N){return N===null||typeof N!="object"?null:(N=d&&N[d]||N["@@iterator"],typeof N=="function"?N:null)}var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,p={};function g(N,U,$){this.props=N,this.context=U,this.refs=p,this.updater=$||h}g.prototype.isReactComponent={},g.prototype.setState=function(N,U){if(typeof N!="object"&&typeof N!="function"&&N!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,N,U,"setState")},g.prototype.forceUpdate=function(N){this.updater.enqueueForceUpdate(this,N,"forceUpdate")};function y(){}y.prototype=g.prototype;function b(N,U,$){this.props=N,this.context=U,this.refs=p,this.updater=$||h}var A=b.prototype=new y;A.constructor=b,m(A,g.prototype),A.isPureReactComponent=!0;var R=Array.isArray,E={H:null,A:null,T:null,S:null,V:null},M=Object.prototype.hasOwnProperty;function S(N,U,$,V,q,J){return $=J.ref,{$$typeof:t,type:N,key:U,ref:$!==void 0?$:null,props:J}}function P(N,U){return S(N.type,U,void 0,void 0,void 0,N.props)}function W(N){return typeof N=="object"&&N!==null&&N.$$typeof===t}function D(N){var U={"=":"=0",":":"=2"};return"$"+N.replace(/[=:]/g,function($){return U[$]})}var G=/\/+/g;function O(N,U){return typeof N=="object"&&N!==null&&N.key!=null?D(""+N.key):U.toString(36)}function I(){}function k(N){switch(N.status){case"fulfilled":return N.value;case"rejected":throw N.reason;default:switch(typeof N.status=="string"?N.then(I,I):(N.status="pending",N.then(function(U){N.status==="pending"&&(N.status="fulfilled",N.value=U)},function(U){N.status==="pending"&&(N.status="rejected",N.reason=U)})),N.status){case"fulfilled":return N.value;case"rejected":throw N.reason}}throw N}function C(N,U,$,V,q){var J=typeof N;(J==="undefined"||J==="boolean")&&(N=null);var fe=!1;if(N===null)fe=!0;else switch(J){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(N.$$typeof){case t:case e:fe=!0;break;case u:return fe=N._init,C(fe(N._payload),U,$,V,q)}}if(fe)return q=q(N),fe=V===""?"."+O(N,0):V,R(q)?($="",fe!=null&&($=fe.replace(G,"$&/")+"/"),C(q,U,$,"",function(xe){return xe})):q!=null&&(W(q)&&(q=P(q,$+(q.key==null||N&&N.key===q.key?"":(""+q.key).replace(G,"$&/")+"/")+fe)),U.push(q)),1;fe=0;var Ee=V===""?".":V+":";if(R(N))for(var ke=0;ke<N.length;ke++)V=N[ke],J=Ee+O(V,ke),fe+=C(V,U,$,J,q);else if(ke=f(N),typeof ke=="function")for(N=ke.call(N),ke=0;!(V=N.next()).done;)V=V.value,J=Ee+O(V,ke++),fe+=C(V,U,$,J,q);else if(J==="object"){if(typeof N.then=="function")return C(k(N),U,$,V,q);throw U=String(N),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(N).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return fe}function z(N,U,$){if(N==null)return N;var V=[],q=0;return C(N,V,"","",function(J){return U.call($,J,q++)}),V}function F(N){if(N._status===-1){var U=N._result;U=U(),U.then(function($){(N._status===0||N._status===-1)&&(N._status=1,N._result=$)},function($){(N._status===0||N._status===-1)&&(N._status=2,N._result=$)}),N._status===-1&&(N._status=0,N._result=U)}if(N._status===1)return N._result.default;throw N._result}var Q=typeof reportError=="function"?reportError:function(N){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof N=="object"&&N!==null&&typeof N.message=="string"?String(N.message):String(N),error:N});if(!window.dispatchEvent(U))return}else if(typeof Rn=="object"&&typeof Rn.emit=="function"){Rn.emit("uncaughtException",N);return}console.error(N)};function Y(){}return Qe.Children={map:z,forEach:function(N,U,$){z(N,function(){U.apply(this,arguments)},$)},count:function(N){var U=0;return z(N,function(){U++}),U},toArray:function(N){return z(N,function(U){return U})||[]},only:function(N){if(!W(N))throw Error("React.Children.only expected to receive a single React element child.");return N}},Qe.Component=g,Qe.Fragment=r,Qe.Profiler=i,Qe.PureComponent=b,Qe.StrictMode=n,Qe.Suspense=c,Qe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=E,Qe.__COMPILER_RUNTIME={__proto__:null,c:function(N){return E.H.useMemoCache(N)}},Qe.cache=function(N){return function(){return N.apply(null,arguments)}},Qe.cloneElement=function(N,U,$){if(N==null)throw Error("The argument must be a React element, but you passed "+N+".");var V=m({},N.props),q=N.key,J=void 0;if(U!=null)for(fe in U.ref!==void 0&&(J=void 0),U.key!==void 0&&(q=""+U.key),U)!M.call(U,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&U.ref===void 0||(V[fe]=U[fe]);var fe=arguments.length-2;if(fe===1)V.children=$;else if(1<fe){for(var Ee=Array(fe),ke=0;ke<fe;ke++)Ee[ke]=arguments[ke+2];V.children=Ee}return S(N.type,q,void 0,void 0,J,V)},Qe.createContext=function(N){return N={$$typeof:o,_currentValue:N,_currentValue2:N,_threadCount:0,Provider:null,Consumer:null},N.Provider=N,N.Consumer={$$typeof:s,_context:N},N},Qe.createElement=function(N,U,$){var V,q={},J=null;if(U!=null)for(V in U.key!==void 0&&(J=""+U.key),U)M.call(U,V)&&V!=="key"&&V!=="__self"&&V!=="__source"&&(q[V]=U[V]);var fe=arguments.length-2;if(fe===1)q.children=$;else if(1<fe){for(var Ee=Array(fe),ke=0;ke<fe;ke++)Ee[ke]=arguments[ke+2];q.children=Ee}if(N&&N.defaultProps)for(V in fe=N.defaultProps,fe)q[V]===void 0&&(q[V]=fe[V]);return S(N,J,void 0,void 0,null,q)},Qe.createRef=function(){return{current:null}},Qe.forwardRef=function(N){return{$$typeof:a,render:N}},Qe.isValidElement=W,Qe.lazy=function(N){return{$$typeof:u,_payload:{_status:-1,_result:N},_init:F}},Qe.memo=function(N,U){return{$$typeof:l,type:N,compare:U===void 0?null:U}},Qe.startTransition=function(N){var U=E.T,$={};E.T=$;try{var V=N(),q=E.S;q!==null&&q($,V),typeof V=="object"&&V!==null&&typeof V.then=="function"&&V.then(Y,Q)}catch(J){Q(J)}finally{E.T=U}},Qe.unstable_useCacheRefresh=function(){return E.H.useCacheRefresh()},Qe.use=function(N){return E.H.use(N)},Qe.useActionState=function(N,U,$){return E.H.useActionState(N,U,$)},Qe.useCallback=function(N,U){return E.H.useCallback(N,U)},Qe.useContext=function(N){return E.H.useContext(N)},Qe.useDebugValue=function(){},Qe.useDeferredValue=function(N,U){return E.H.useDeferredValue(N,U)},Qe.useEffect=function(N,U,$){var V=E.H;if(typeof $=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return V.useEffect(N,U)},Qe.useId=function(){return E.H.useId()},Qe.useImperativeHandle=function(N,U,$){return E.H.useImperativeHandle(N,U,$)},Qe.useInsertionEffect=function(N,U){return E.H.useInsertionEffect(N,U)},Qe.useLayoutEffect=function(N,U){return E.H.useLayoutEffect(N,U)},Qe.useMemo=function(N,U){return E.H.useMemo(N,U)},Qe.useOptimistic=function(N,U){return E.H.useOptimistic(N,U)},Qe.useReducer=function(N,U,$){return E.H.useReducer(N,U,$)},Qe.useRef=function(N){return E.H.useRef(N)},Qe.useState=function(N){return E.H.useState(N)},Qe.useSyncExternalStore=function(N,U,$){return E.H.useSyncExternalStore(N,U,$)},Qe.useTransition=function(){return E.H.useTransition()},Qe.version="19.1.1",Qe}var pg;function PR(){return pg||(pg=1,Bh.exports=$R()),Bh.exports}PR();/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const mg="0123456789abcdef",gg=[],Rc=[];for(let t=0;t<256;t++)gg[t]=mg[t>>4&15]+mg[t&15],t<16&&(t<10?Rc[48+t]=t:Rc[87+t]=t);const yg=t=>{const e=t.length;let r="",n=0;for(;n<e;)r+=gg[t[n++]];return r},Oc=t=>{const e=t.length>>1,r=e<<1,n=new Uint8Array(e);let i=0,s=0;for(;s<r;)n[i++]=Rc[t.charCodeAt(s++)]<<4|Rc[t.charCodeAt(s++)];return n};for(var _g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",FR=typeof Uint8Array>"u"?[]:new Uint8Array(256),Ic=0;Ic<_g.length;Ic++)FR[_g.charCodeAt(Ic)]=Ic;new TextDecoder,new TextEncoder;const bg=typeof window<"u"?window:self,wg=bg.crypto||bg.msCrypto||{};wg.subtle||wg.webkitSubtle;const eo=globalThis||void 0||self,On=()=>new Map,zh=t=>{const e=On();return t.forEach((r,n)=>{e.set(n,r)}),e},Bi=(t,e,r)=>{let n=t.get(e);return n===void 0&&t.set(e,n=r()),n},BR=(t,e)=>{const r=[];for(const[n,i]of t)r.push(e(i,n));return r},DR=(t,e)=>{for(const[r,n]of t)if(e(n,r))return!0;return!1},to=()=>new Set,Wh=t=>t[t.length-1],jR=(t,e)=>{for(let r=0;r<e.length;r++)t.push(e[r])},hs=Array.from,zR=Array.isArray;class WR{constructor(){this._observers=On()}on(e,r){return Bi(this._observers,e,to).add(r),r}once(e,r){const n=(...i)=>{this.off(e,n),r(...i)};this.on(e,n)}off(e,r){const n=this._observers.get(e);n!==void 0&&(n.delete(r),n.size===0&&this._observers.delete(e))}emit(e,r){return hs((this._observers.get(e)||On()).values()).forEach(n=>n(...r))}destroy(){this._observers=On()}}const Di=Math.floor,Nc=Math.abs,kg=(t,e)=>t<e?t:e,fs=(t,e)=>t>e?t:e,vg=t=>t!==0?t<0:1/t<0,xg=1,Eg=2,Hh=4,Gh=8,sa=32,gi=64,Jr=128,Cc=31,Kh=63,ds=127,HR=2147483647,Ag=Number.MAX_SAFE_INTEGER,GR=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Di(t)===t),KR=t=>t.toLowerCase(),qR=/^\s*/g,YR=t=>t.replace(qR,""),VR=/([A-Z])/g,Tg=(t,e)=>YR(t.replace(VR,r=>`${e}${KR(r)}`)),XR=t=>{const e=unescape(encodeURIComponent(t)),r=e.length,n=new Uint8Array(r);for(let i=0;i<r;i++)n[i]=e.codePointAt(i);return n},oa=typeof TextEncoder<"u"?new TextEncoder:null,ZR=oa?t=>oa.encode(t):XR;let aa=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});aa&&aa.decode(new Uint8Array).length===1&&(aa=null);class ca{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Lc=()=>new ca,JR=t=>{let e=t.cpos;for(let r=0;r<t.bufs.length;r++)e+=t.bufs[r].length;return e},Kn=t=>{const e=new Uint8Array(JR(t));let r=0;for(let n=0;n<t.bufs.length;n++){const i=t.bufs[n];e.set(i,r),r+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),r),e},QR=(t,e)=>{const r=t.cbuf.length;r-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(fs(r,e)*2),t.cpos=0)},sr=(t,e)=>{const r=t.cbuf.length;t.cpos===r&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(r*2),t.cpos=0),t.cbuf[t.cpos++]=e},qh=sr,ht=(t,e)=>{for(;e>ds;)sr(t,Jr|ds&e),e=Di(e/128);sr(t,ds&e)},Yh=(t,e)=>{const r=vg(e);for(r&&(e=-e),sr(t,(e>Kh?Jr:0)|(r?gi:0)|Kh&e),e=Di(e/64);e>0;)sr(t,(e>ds?Jr:0)|ds&e),e=Di(e/128)},Vh=new Uint8Array(3e4),eO=Vh.length/3,tO=(t,e)=>{if(e.length<eO){const r=oa.encodeInto(e,Vh).written||0;ht(t,r);for(let n=0;n<r;n++)sr(t,Vh[n])}else Qr(t,ZR(e))},rO=(t,e)=>{const r=unescape(encodeURIComponent(e)),n=r.length;ht(t,n);for(let i=0;i<n;i++)sr(t,r.codePointAt(i))},ro=oa&&oa.encodeInto?tO:rO,Mc=(t,e)=>{const r=t.cbuf.length,n=t.cpos,i=kg(r-n,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),n),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(fs(r*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Qr=(t,e)=>{ht(t,e.byteLength),Mc(t,e)},Xh=(t,e)=>{QR(t,e);const r=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,r},nO=(t,e)=>Xh(t,4).setFloat32(0,e,!1),iO=(t,e)=>Xh(t,8).setFloat64(0,e,!1),sO=(t,e)=>Xh(t,8).setBigInt64(0,e,!1),Sg=new DataView(new ArrayBuffer(4)),oO=t=>(Sg.setFloat32(0,t),Sg.getFloat32(0)===t),la=(t,e)=>{switch(typeof e){case"string":sr(t,119),ro(t,e);break;case"number":GR(e)&&Nc(e)<=HR?(sr(t,125),Yh(t,e)):oO(e)?(sr(t,124),nO(t,e)):(sr(t,123),iO(t,e));break;case"bigint":sr(t,122),sO(t,e);break;case"object":if(e===null)sr(t,126);else if(zR(e)){sr(t,117),ht(t,e.length);for(let r=0;r<e.length;r++)la(t,e[r])}else if(e instanceof Uint8Array)sr(t,116),Qr(t,e);else{sr(t,118);const r=Object.keys(e);ht(t,r.length);for(let n=0;n<r.length;n++){const i=r[n];ro(t,i),la(t,e[i])}}break;case"boolean":sr(t,e?120:121);break;default:sr(t,127)}};class Rg extends ca{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ht(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Og=t=>{t.count>0&&(Yh(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ht(t.encoder,t.count-2))};class Uc{constructor(){this.encoder=new ca,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Og(this),this.count=1,this.s=e)}toUint8Array(){return Og(this),Kn(this.encoder)}}const Ig=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Yh(t.encoder,e),t.count>1&&ht(t.encoder,t.count-2)}};class Zh{constructor(){this.encoder=new ca,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Ig(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Ig(this),Kn(this.encoder)}}class aO{constructor(){this.sarr=[],this.s="",this.lensE=new Uc}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new ca;return this.sarr.push(this.s),this.s="",ro(e,this.sarr.join("")),Mc(e,this.lensE.toUint8Array()),Kn(e)}}const ji=t=>new Error(t),qn=()=>{throw ji("Method unimplemented")},Yn=()=>{throw ji("Unexpected case")},Ng=ji("Unexpected end of array"),Cg=ji("Integer out of Range");class $c{constructor(e){this.arr=e,this.pos=0}}const no=t=>new $c(t),cO=t=>t.pos!==t.arr.length,lO=(t,e)=>{const r=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,r},en=t=>lO(t,tt(t)),io=t=>t.arr[t.pos++],tt=t=>{let e=0,r=1;const n=t.arr.length;for(;t.pos<n;){const i=t.arr[t.pos++];if(e=e+(i&ds)*r,r*=128,i<Jr)return e;if(e>Ag)throw Cg}throw Ng},Jh=t=>{let e=t.arr[t.pos++],r=e&Kh,n=64;const i=(e&gi)>0?-1:1;if((e&Jr)===0)return i*r;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],r=r+(e&ds)*n,n*=128,e<Jr)return i*r;if(r>Ag)throw Cg}throw Ng},so=aa?t=>aa.decode(en(t)):t=>{let e=tt(t);if(e===0)return"";{let r=String.fromCodePoint(io(t));if(--e<100)for(;e--;)r+=String.fromCodePoint(io(t));else for(;e>0;){const n=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+n);t.pos+=n,r+=String.fromCodePoint.apply(null,i),e-=n}return decodeURIComponent(escape(r))}},Qh=(t,e)=>{const r=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,r},uO=[t=>{},t=>null,Jh,t=>Qh(t,4).getFloat32(0,!1),t=>Qh(t,8).getFloat64(0,!1),t=>Qh(t,8).getBigInt64(0,!1),t=>!1,t=>!0,so,t=>{const e=tt(t),r={};for(let n=0;n<e;n++){const i=so(t);r[i]=ua(t)}return r},t=>{const e=tt(t),r=[];for(let n=0;n<e;n++)r.push(ua(t));return r},en],ua=t=>uO[127-io(t)](t);class Lg extends $c{constructor(e,r){super(e),this.reader=r,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),cO(this)?this.count=tt(this)+1:this.count=-1),this.count--,this.s}}class Pc extends $c{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Jh(this);const e=vg(this.s);this.count=1,e&&(this.s=-this.s,this.count=tt(this)+2)}return this.count--,this.s}}class ef extends $c{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Jh(this),r=e&1;this.diff=Di(e/2),this.count=1,r&&(this.count=tt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class hO{constructor(e){this.decoder=new Pc(e),this.str=so(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),r=this.str.slice(this.spos,e);return this.spos=e,r}}const fO=crypto.getRandomValues.bind(crypto),Mg=()=>fO(new Uint32Array(1))[0],dO="10000000-1000-4000-8000"+-1e11,pO=()=>dO.replace(/[018]/g,t=>(t^Mg()&15>>t/4).toString(16)),Ug=t=>new Promise(t);Promise.all.bind(Promise);var $g={},Fc={};Fc.byteLength=yO,Fc.toByteArray=bO,Fc.fromByteArray=vO;for(var Vn=[],dn=[],mO=typeof Uint8Array<"u"?Uint8Array:Array,tf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",oo=0,gO=tf.length;oo<gO;++oo)Vn[oo]=tf[oo],dn[tf.charCodeAt(oo)]=oo;dn[45]=62,dn[95]=63;function Pg(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function yO(t){var e=Pg(t),r=e[0],n=e[1];return(r+n)*3/4-n}function _O(t,e,r){return(e+r)*3/4-r}function bO(t){var e,r=Pg(t),n=r[0],i=r[1],s=new mO(_O(t,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=dn[t.charCodeAt(c)]<<18|dn[t.charCodeAt(c+1)]<<12|dn[t.charCodeAt(c+2)]<<6|dn[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=dn[t.charCodeAt(c)]<<2|dn[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=dn[t.charCodeAt(c)]<<10|dn[t.charCodeAt(c+1)]<<4|dn[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function wO(t){return Vn[t>>18&63]+Vn[t>>12&63]+Vn[t>>6&63]+Vn[t&63]}function kO(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(wO(n));return i.join("")}function vO(t){for(var e,r=t.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(kO(t,o,o+s>a?a:o+s));return n===1?(e=t[r-1],i.push(Vn[e>>2]+Vn[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Vn[e>>10]+Vn[e>>4&63]+Vn[e<<2&63]+"=")),i.join("")}var rf={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */rf.read=function(t,e,r,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,u=-7,d=r?i-1:0,f=r?-1:1,h=t[e+d];for(d+=f,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+t[e+d],d+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+t[e+d],d+=f,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(h?-1:1)*o*Math.pow(2,s-n)},rf.write=function(t,e,r,n,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,d=u>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:s-1,m=n?1:-1,p=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+d>=1?e+=f/c:e+=f*Math.pow(2,1-d),e*c>=2&&(o++,c/=2),o+d>=u?(a=0,o=u):o+d>=1?(a=(e*c-1)*Math.pow(2,i),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;t[r+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[r+h]=o&255,h+=m,o/=256,l-=8);t[r+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Fc,r=rf,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=E,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const L=new s(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,s.prototype),Object.setPrototypeOf(L,_),L.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(L){if(L>i)throw new RangeError('The value "'+L+'" is invalid for option "size"');const _=new s(L);return Object.setPrototypeOf(_,u.prototype),_}function u(L,_,v){if(typeof L=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(L)}return d(L,_,v)}u.poolSize=8192;function d(L,_,v){if(typeof L=="string")return p(L,_);if(o.isView(L))return y(L);if(L==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof L);if(be(L,o)||L&&be(L.buffer,o)||typeof a<"u"&&(be(L,a)||L&&be(L.buffer,a)))return b(L,_,v);if(typeof L=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const B=L.valueOf&&L.valueOf();if(B!=null&&B!==L)return u.from(B,_,v);const X=A(L);if(X)return X;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof L[Symbol.toPrimitive]=="function")return u.from(L[Symbol.toPrimitive]("string"),_,v);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof L)}u.from=function(L,_,v){return d(L,_,v)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function f(L){if(typeof L!="number")throw new TypeError('"size" argument must be of type number');if(L<0)throw new RangeError('The value "'+L+'" is invalid for option "size"')}function h(L,_,v){return f(L),L<=0?l(L):_!==void 0?typeof v=="string"?l(L).fill(_,v):l(L).fill(_):l(L)}u.alloc=function(L,_,v){return h(L,_,v)};function m(L){return f(L),l(L<0?0:R(L)|0)}u.allocUnsafe=function(L){return m(L)},u.allocUnsafeSlow=function(L){return m(L)};function p(L,_){if((typeof _!="string"||_==="")&&(_="utf8"),!u.isEncoding(_))throw new TypeError("Unknown encoding: "+_);const v=M(L,_)|0;let B=l(v);const X=B.write(L,_);return X!==v&&(B=B.slice(0,X)),B}function g(L){const _=L.length<0?0:R(L.length)|0,v=l(_);for(let B=0;B<_;B+=1)v[B]=L[B]&255;return v}function y(L){if(be(L,s)){const _=new s(L);return b(_.buffer,_.byteOffset,_.byteLength)}return g(L)}function b(L,_,v){if(_<0||L.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(L.byteLength<_+(v||0))throw new RangeError('"length" is outside of buffer bounds');let B;return _===void 0&&v===void 0?B=new s(L):v===void 0?B=new s(L,_):B=new s(L,_,v),Object.setPrototypeOf(B,u.prototype),B}function A(L){if(u.isBuffer(L)){const _=R(L.length)|0,v=l(_);return v.length===0||L.copy(v,0,0,_),v}if(L.length!==void 0)return typeof L.length!="number"||De(L.length)?l(0):g(L);if(L.type==="Buffer"&&Array.isArray(L.data))return g(L.data)}function R(L){if(L>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return L|0}function E(L){return+L!=L&&(L=0),u.alloc(+L)}u.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==u.prototype},u.compare=function(_,v){if(be(_,s)&&(_=u.from(_,_.offset,_.byteLength)),be(v,s)&&(v=u.from(v,v.offset,v.byteLength)),!u.isBuffer(_)||!u.isBuffer(v))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===v)return 0;let B=_.length,X=v.length;for(let ce=0,H=Math.min(B,X);ce<H;++ce)if(_[ce]!==v[ce]){B=_[ce],X=v[ce];break}return B<X?-1:X<B?1:0},u.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(_,v){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return u.alloc(0);let B;if(v===void 0)for(v=0,B=0;B<_.length;++B)v+=_[B].length;const X=u.allocUnsafe(v);let ce=0;for(B=0;B<_.length;++B){let H=_[B];if(be(H,s))ce+H.length>X.length?(u.isBuffer(H)||(H=u.from(H)),H.copy(X,ce)):s.prototype.set.call(X,H,ce);else if(u.isBuffer(H))H.copy(X,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=H.length}return X};function M(L,_){if(u.isBuffer(L))return L.length;if(o.isView(L)||be(L,o))return L.byteLength;if(typeof L!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof L);const v=L.length,B=arguments.length>2&&arguments[2]===!0;if(!B&&v===0)return 0;let X=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return v;case"utf8":case"utf-8":return pe(L).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v*2;case"hex":return v>>>1;case"base64":return _e(L).length;default:if(X)return B?-1:pe(L).length;_=(""+_).toLowerCase(),X=!0}}u.byteLength=M;function S(L,_,v){let B=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((v===void 0||v>this.length)&&(v=this.length),v<=0)||(v>>>=0,_>>>=0,v<=_))return"";for(L||(L="utf8");;)switch(L){case"hex":return $(this,_,v);case"utf8":case"utf-8":return F(this,_,v);case"ascii":return N(this,_,v);case"latin1":case"binary":return U(this,_,v);case"base64":return z(this,_,v);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,_,v);default:if(B)throw new TypeError("Unknown encoding: "+L);L=(L+"").toLowerCase(),B=!0}}u.prototype._isBuffer=!0;function P(L,_,v){const B=L[_];L[_]=L[v],L[v]=B}u.prototype.swap16=function(){const _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let v=0;v<_;v+=2)P(this,v,v+1);return this},u.prototype.swap32=function(){const _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let v=0;v<_;v+=4)P(this,v,v+3),P(this,v+1,v+2);return this},u.prototype.swap64=function(){const _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let v=0;v<_;v+=8)P(this,v,v+7),P(this,v+1,v+6),P(this,v+2,v+5),P(this,v+3,v+4);return this},u.prototype.toString=function(){const _=this.length;return _===0?"":arguments.length===0?F(this,0,_):S.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(_){if(!u.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:u.compare(this,_)===0},u.prototype.inspect=function(){let _="";const v=t.INSPECT_MAX_BYTES;return _=this.toString("hex",0,v).replace(/(.{2})/g,"$1 ").trim(),this.length>v&&(_+=" ... "),"<Buffer "+_+">"},n&&(u.prototype[n]=u.prototype.inspect),u.prototype.compare=function(_,v,B,X,ce){if(be(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(v===void 0&&(v=0),B===void 0&&(B=_?_.length:0),X===void 0&&(X=0),ce===void 0&&(ce=this.length),v<0||B>_.length||X<0||ce>this.length)throw new RangeError("out of range index");if(X>=ce&&v>=B)return 0;if(X>=ce)return-1;if(v>=B)return 1;if(v>>>=0,B>>>=0,X>>>=0,ce>>>=0,this===_)return 0;let H=ce-X,re=B-v;const ze=Math.min(H,re),Ge=this.slice(X,ce),qe=_.slice(v,B);for(let Le=0;Le<ze;++Le)if(Ge[Le]!==qe[Le]){H=Ge[Le],re=qe[Le];break}return H<re?-1:re<H?1:0};function W(L,_,v,B,X){if(L.length===0)return-1;if(typeof v=="string"?(B=v,v=0):v>2147483647?v=2147483647:v<-2147483648&&(v=-2147483648),v=+v,De(v)&&(v=X?0:L.length-1),v<0&&(v=L.length+v),v>=L.length){if(X)return-1;v=L.length-1}else if(v<0)if(X)v=0;else return-1;if(typeof _=="string"&&(_=u.from(_,B)),u.isBuffer(_))return _.length===0?-1:D(L,_,v,B,X);if(typeof _=="number")return _=_&255,typeof s.prototype.indexOf=="function"?X?s.prototype.indexOf.call(L,_,v):s.prototype.lastIndexOf.call(L,_,v):D(L,[_],v,B,X);throw new TypeError("val must be string, number or Buffer")}function D(L,_,v,B,X){let ce=1,H=L.length,re=_.length;if(B!==void 0&&(B=String(B).toLowerCase(),B==="ucs2"||B==="ucs-2"||B==="utf16le"||B==="utf-16le")){if(L.length<2||_.length<2)return-1;ce=2,H/=2,re/=2,v/=2}function ze(qe,Le){return ce===1?qe[Le]:qe.readUInt16BE(Le*ce)}let Ge;if(X){let qe=-1;for(Ge=v;Ge<H;Ge++)if(ze(L,Ge)===ze(_,qe===-1?0:Ge-qe)){if(qe===-1&&(qe=Ge),Ge-qe+1===re)return qe*ce}else qe!==-1&&(Ge-=Ge-qe),qe=-1}else for(v+re>H&&(v=H-re),Ge=v;Ge>=0;Ge--){let qe=!0;for(let Le=0;Le<re;Le++)if(ze(L,Ge+Le)!==ze(_,Le)){qe=!1;break}if(qe)return Ge}return-1}u.prototype.includes=function(_,v,B){return this.indexOf(_,v,B)!==-1},u.prototype.indexOf=function(_,v,B){return W(this,_,v,B,!0)},u.prototype.lastIndexOf=function(_,v,B){return W(this,_,v,B,!1)};function G(L,_,v,B){v=Number(v)||0;const X=L.length-v;B?(B=Number(B),B>X&&(B=X)):B=X;const ce=_.length;B>ce/2&&(B=ce/2);let H;for(H=0;H<B;++H){const re=parseInt(_.substr(H*2,2),16);if(De(re))return H;L[v+H]=re}return H}function O(L,_,v,B){return Oe(pe(_,L.length-v),L,v,B)}function I(L,_,v,B){return Oe(me(_),L,v,B)}function k(L,_,v,B){return Oe(_e(_),L,v,B)}function C(L,_,v,B){return Oe(se(_,L.length-v),L,v,B)}u.prototype.write=function(_,v,B,X){if(v===void 0)X="utf8",B=this.length,v=0;else if(B===void 0&&typeof v=="string")X=v,B=this.length,v=0;else if(isFinite(v))v=v>>>0,isFinite(B)?(B=B>>>0,X===void 0&&(X="utf8")):(X=B,B=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-v;if((B===void 0||B>ce)&&(B=ce),_.length>0&&(B<0||v<0)||v>this.length)throw new RangeError("Attempt to write outside buffer bounds");X||(X="utf8");let H=!1;for(;;)switch(X){case"hex":return G(this,_,v,B);case"utf8":case"utf-8":return O(this,_,v,B);case"ascii":case"latin1":case"binary":return I(this,_,v,B);case"base64":return k(this,_,v,B);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,_,v,B);default:if(H)throw new TypeError("Unknown encoding: "+X);X=(""+X).toLowerCase(),H=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function z(L,_,v){return _===0&&v===L.length?e.fromByteArray(L):e.fromByteArray(L.slice(_,v))}function F(L,_,v){v=Math.min(L.length,v);const B=[];let X=_;for(;X<v;){const ce=L[X];let H=null,re=ce>239?4:ce>223?3:ce>191?2:1;if(X+re<=v){let ze,Ge,qe,Le;switch(re){case 1:ce<128&&(H=ce);break;case 2:ze=L[X+1],(ze&192)===128&&(Le=(ce&31)<<6|ze&63,Le>127&&(H=Le));break;case 3:ze=L[X+1],Ge=L[X+2],(ze&192)===128&&(Ge&192)===128&&(Le=(ce&15)<<12|(ze&63)<<6|Ge&63,Le>2047&&(Le<55296||Le>57343)&&(H=Le));break;case 4:ze=L[X+1],Ge=L[X+2],qe=L[X+3],(ze&192)===128&&(Ge&192)===128&&(qe&192)===128&&(Le=(ce&15)<<18|(ze&63)<<12|(Ge&63)<<6|qe&63,Le>65535&&Le<1114112&&(H=Le))}}H===null?(H=65533,re=1):H>65535&&(H-=65536,B.push(H>>>10&1023|55296),H=56320|H&1023),B.push(H),X+=re}return Y(B)}const Q=4096;function Y(L){const _=L.length;if(_<=Q)return String.fromCharCode.apply(String,L);let v="",B=0;for(;B<_;)v+=String.fromCharCode.apply(String,L.slice(B,B+=Q));return v}function N(L,_,v){let B="";v=Math.min(L.length,v);for(let X=_;X<v;++X)B+=String.fromCharCode(L[X]&127);return B}function U(L,_,v){let B="";v=Math.min(L.length,v);for(let X=_;X<v;++X)B+=String.fromCharCode(L[X]);return B}function $(L,_,v){const B=L.length;(!_||_<0)&&(_=0),(!v||v<0||v>B)&&(v=B);let X="";for(let ce=_;ce<v;++ce)X+=pt[L[ce]];return X}function V(L,_,v){const B=L.slice(_,v);let X="";for(let ce=0;ce<B.length-1;ce+=2)X+=String.fromCharCode(B[ce]+B[ce+1]*256);return X}u.prototype.slice=function(_,v){const B=this.length;_=~~_,v=v===void 0?B:~~v,_<0?(_+=B,_<0&&(_=0)):_>B&&(_=B),v<0?(v+=B,v<0&&(v=0)):v>B&&(v=B),v<_&&(v=_);const X=this.subarray(_,v);return Object.setPrototypeOf(X,u.prototype),X};function q(L,_,v){if(L%1!==0||L<0)throw new RangeError("offset is not uint");if(L+_>v)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(_,v,B){_=_>>>0,v=v>>>0,B||q(_,v,this.length);let X=this[_],ce=1,H=0;for(;++H<v&&(ce*=256);)X+=this[_+H]*ce;return X},u.prototype.readUintBE=u.prototype.readUIntBE=function(_,v,B){_=_>>>0,v=v>>>0,B||q(_,v,this.length);let X=this[_+--v],ce=1;for(;v>0&&(ce*=256);)X+=this[_+--v]*ce;return X},u.prototype.readUint8=u.prototype.readUInt8=function(_,v){return _=_>>>0,v||q(_,1,this.length),this[_]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(_,v){return _=_>>>0,v||q(_,2,this.length),this[_]|this[_+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(_,v){return _=_>>>0,v||q(_,2,this.length),this[_]<<8|this[_+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(_,v){return _=_>>>0,v||q(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(_,v){return _=_>>>0,v||q(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},u.prototype.readBigUInt64LE=Ze(function(_){_=_>>>0,ie(_,"offset");const v=this[_],B=this[_+7];(v===void 0||B===void 0)&&K(_,this.length-8);const X=v+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,ce=this[++_]+this[++_]*2**8+this[++_]*2**16+B*2**24;return BigInt(X)+(BigInt(ce)<<BigInt(32))}),u.prototype.readBigUInt64BE=Ze(function(_){_=_>>>0,ie(_,"offset");const v=this[_],B=this[_+7];(v===void 0||B===void 0)&&K(_,this.length-8);const X=v*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],ce=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+B;return(BigInt(X)<<BigInt(32))+BigInt(ce)}),u.prototype.readIntLE=function(_,v,B){_=_>>>0,v=v>>>0,B||q(_,v,this.length);let X=this[_],ce=1,H=0;for(;++H<v&&(ce*=256);)X+=this[_+H]*ce;return ce*=128,X>=ce&&(X-=Math.pow(2,8*v)),X},u.prototype.readIntBE=function(_,v,B){_=_>>>0,v=v>>>0,B||q(_,v,this.length);let X=v,ce=1,H=this[_+--X];for(;X>0&&(ce*=256);)H+=this[_+--X]*ce;return ce*=128,H>=ce&&(H-=Math.pow(2,8*v)),H},u.prototype.readInt8=function(_,v){return _=_>>>0,v||q(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},u.prototype.readInt16LE=function(_,v){_=_>>>0,v||q(_,2,this.length);const B=this[_]|this[_+1]<<8;return B&32768?B|4294901760:B},u.prototype.readInt16BE=function(_,v){_=_>>>0,v||q(_,2,this.length);const B=this[_+1]|this[_]<<8;return B&32768?B|4294901760:B},u.prototype.readInt32LE=function(_,v){return _=_>>>0,v||q(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},u.prototype.readInt32BE=function(_,v){return _=_>>>0,v||q(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},u.prototype.readBigInt64LE=Ze(function(_){_=_>>>0,ie(_,"offset");const v=this[_],B=this[_+7];(v===void 0||B===void 0)&&K(_,this.length-8);const X=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(B<<24);return(BigInt(X)<<BigInt(32))+BigInt(v+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),u.prototype.readBigInt64BE=Ze(function(_){_=_>>>0,ie(_,"offset");const v=this[_],B=this[_+7];(v===void 0||B===void 0)&&K(_,this.length-8);const X=(v<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(X)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+B)}),u.prototype.readFloatLE=function(_,v){return _=_>>>0,v||q(_,4,this.length),r.read(this,_,!0,23,4)},u.prototype.readFloatBE=function(_,v){return _=_>>>0,v||q(_,4,this.length),r.read(this,_,!1,23,4)},u.prototype.readDoubleLE=function(_,v){return _=_>>>0,v||q(_,8,this.length),r.read(this,_,!0,52,8)},u.prototype.readDoubleBE=function(_,v){return _=_>>>0,v||q(_,8,this.length),r.read(this,_,!1,52,8)};function J(L,_,v,B,X,ce){if(!u.isBuffer(L))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>X||_<ce)throw new RangeError('"value" argument is out of bounds');if(v+B>L.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(_,v,B,X){if(_=+_,v=v>>>0,B=B>>>0,!X){const re=Math.pow(2,8*B)-1;J(this,_,v,B,re,0)}let ce=1,H=0;for(this[v]=_&255;++H<B&&(ce*=256);)this[v+H]=_/ce&255;return v+B},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(_,v,B,X){if(_=+_,v=v>>>0,B=B>>>0,!X){const re=Math.pow(2,8*B)-1;J(this,_,v,B,re,0)}let ce=B-1,H=1;for(this[v+ce]=_&255;--ce>=0&&(H*=256);)this[v+ce]=_/H&255;return v+B},u.prototype.writeUint8=u.prototype.writeUInt8=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,1,255,0),this[v]=_&255,v+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,2,65535,0),this[v]=_&255,this[v+1]=_>>>8,v+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,2,65535,0),this[v]=_>>>8,this[v+1]=_&255,v+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,4,4294967295,0),this[v+3]=_>>>24,this[v+2]=_>>>16,this[v+1]=_>>>8,this[v]=_&255,v+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,4,4294967295,0),this[v]=_>>>24,this[v+1]=_>>>16,this[v+2]=_>>>8,this[v+3]=_&255,v+4};function fe(L,_,v,B,X){he(_,B,X,L,v,7);let ce=Number(_&BigInt(4294967295));L[v++]=ce,ce=ce>>8,L[v++]=ce,ce=ce>>8,L[v++]=ce,ce=ce>>8,L[v++]=ce;let H=Number(_>>BigInt(32)&BigInt(4294967295));return L[v++]=H,H=H>>8,L[v++]=H,H=H>>8,L[v++]=H,H=H>>8,L[v++]=H,v}function Ee(L,_,v,B,X){he(_,B,X,L,v,7);let ce=Number(_&BigInt(4294967295));L[v+7]=ce,ce=ce>>8,L[v+6]=ce,ce=ce>>8,L[v+5]=ce,ce=ce>>8,L[v+4]=ce;let H=Number(_>>BigInt(32)&BigInt(4294967295));return L[v+3]=H,H=H>>8,L[v+2]=H,H=H>>8,L[v+1]=H,H=H>>8,L[v]=H,v+8}u.prototype.writeBigUInt64LE=Ze(function(_,v=0){return fe(this,_,v,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=Ze(function(_,v=0){return Ee(this,_,v,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(_,v,B,X){if(_=+_,v=v>>>0,!X){const ze=Math.pow(2,8*B-1);J(this,_,v,B,ze-1,-ze)}let ce=0,H=1,re=0;for(this[v]=_&255;++ce<B&&(H*=256);)_<0&&re===0&&this[v+ce-1]!==0&&(re=1),this[v+ce]=(_/H>>0)-re&255;return v+B},u.prototype.writeIntBE=function(_,v,B,X){if(_=+_,v=v>>>0,!X){const ze=Math.pow(2,8*B-1);J(this,_,v,B,ze-1,-ze)}let ce=B-1,H=1,re=0;for(this[v+ce]=_&255;--ce>=0&&(H*=256);)_<0&&re===0&&this[v+ce+1]!==0&&(re=1),this[v+ce]=(_/H>>0)-re&255;return v+B},u.prototype.writeInt8=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,1,127,-128),_<0&&(_=255+_+1),this[v]=_&255,v+1},u.prototype.writeInt16LE=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,2,32767,-32768),this[v]=_&255,this[v+1]=_>>>8,v+2},u.prototype.writeInt16BE=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,2,32767,-32768),this[v]=_>>>8,this[v+1]=_&255,v+2},u.prototype.writeInt32LE=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,4,2147483647,-2147483648),this[v]=_&255,this[v+1]=_>>>8,this[v+2]=_>>>16,this[v+3]=_>>>24,v+4},u.prototype.writeInt32BE=function(_,v,B){return _=+_,v=v>>>0,B||J(this,_,v,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[v]=_>>>24,this[v+1]=_>>>16,this[v+2]=_>>>8,this[v+3]=_&255,v+4},u.prototype.writeBigInt64LE=Ze(function(_,v=0){return fe(this,_,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=Ze(function(_,v=0){return Ee(this,_,v,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ke(L,_,v,B,X,ce){if(v+B>L.length)throw new RangeError("Index out of range");if(v<0)throw new RangeError("Index out of range")}function xe(L,_,v,B,X){return _=+_,v=v>>>0,X||ke(L,_,v,4),r.write(L,_,v,B,23,4),v+4}u.prototype.writeFloatLE=function(_,v,B){return xe(this,_,v,!0,B)},u.prototype.writeFloatBE=function(_,v,B){return xe(this,_,v,!1,B)};function Ae(L,_,v,B,X){return _=+_,v=v>>>0,X||ke(L,_,v,8),r.write(L,_,v,B,52,8),v+8}u.prototype.writeDoubleLE=function(_,v,B){return Ae(this,_,v,!0,B)},u.prototype.writeDoubleBE=function(_,v,B){return Ae(this,_,v,!1,B)},u.prototype.copy=function(_,v,B,X){if(!u.isBuffer(_))throw new TypeError("argument should be a Buffer");if(B||(B=0),!X&&X!==0&&(X=this.length),v>=_.length&&(v=_.length),v||(v=0),X>0&&X<B&&(X=B),X===B||_.length===0||this.length===0)return 0;if(v<0)throw new RangeError("targetStart out of bounds");if(B<0||B>=this.length)throw new RangeError("Index out of range");if(X<0)throw new RangeError("sourceEnd out of bounds");X>this.length&&(X=this.length),_.length-v<X-B&&(X=_.length-v+B);const ce=X-B;return this===_&&typeof s.prototype.copyWithin=="function"?this.copyWithin(v,B,X):s.prototype.set.call(_,this.subarray(B,X),v),ce},u.prototype.fill=function(_,v,B,X){if(typeof _=="string"){if(typeof v=="string"?(X=v,v=0,B=this.length):typeof B=="string"&&(X=B,B=this.length),X!==void 0&&typeof X!="string")throw new TypeError("encoding must be a string");if(typeof X=="string"&&!u.isEncoding(X))throw new TypeError("Unknown encoding: "+X);if(_.length===1){const H=_.charCodeAt(0);(X==="utf8"&&H<128||X==="latin1")&&(_=H)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(v<0||this.length<v||this.length<B)throw new RangeError("Out of range index");if(B<=v)return this;v=v>>>0,B=B===void 0?this.length:B>>>0,_||(_=0);let ce;if(typeof _=="number")for(ce=v;ce<B;++ce)this[ce]=_;else{const H=u.isBuffer(_)?_:u.from(_,X),re=H.length;if(re===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(ce=0;ce<B-v;++ce)this[ce+v]=H[ce%re]}return this};const Se={};function Me(L,_,v){Se[L]=class extends v{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${L}]`,this.stack,delete this.name}get code(){return L}set code(X){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:X,writable:!0})}toString(){return`${this.name} [${L}]: ${this.message}`}}}Me("ERR_BUFFER_OUT_OF_BOUNDS",function(L){return L?`${L} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Me("ERR_INVALID_ARG_TYPE",function(L,_){return`The "${L}" argument must be of type number. Received type ${typeof _}`},TypeError),Me("ERR_OUT_OF_RANGE",function(L,_,v){let B=`The value of "${L}" is out of range.`,X=v;return Number.isInteger(v)&&Math.abs(v)>2**32?X=je(String(v)):typeof v=="bigint"&&(X=String(v),(v>BigInt(2)**BigInt(32)||v<-(BigInt(2)**BigInt(32)))&&(X=je(X)),X+="n"),B+=` It must be ${_}. Received ${X}`,B},RangeError);function je(L){let _="",v=L.length;const B=L[0]==="-"?1:0;for(;v>=B+4;v-=3)_=`_${L.slice(v-3,v)}${_}`;return`${L.slice(0,v)}${_}`}function T(L,_,v){ie(_,"offset"),(L[_]===void 0||L[_+v]===void 0)&&K(_,L.length-(v+1))}function he(L,_,v,B,X,ce){if(L>v||L<_){const H=typeof _=="bigint"?"n":"";let re;throw _===0||_===BigInt(0)?re=`>= 0${H} and < 2${H} ** ${(ce+1)*8}${H}`:re=`>= -(2${H} ** ${(ce+1)*8-1}${H}) and < 2 ** ${(ce+1)*8-1}${H}`,new Se.ERR_OUT_OF_RANGE("value",re,L)}T(B,X,ce)}function ie(L,_){if(typeof L!="number")throw new Se.ERR_INVALID_ARG_TYPE(_,"number",L)}function K(L,_,v){throw Math.floor(L)!==L?(ie(L,v),new Se.ERR_OUT_OF_RANGE("offset","an integer",L)):_<0?new Se.ERR_BUFFER_OUT_OF_BOUNDS:new Se.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${_}`,L)}const j=/[^+/0-9A-Za-z-_]/g;function ee(L){if(L=L.split("=")[0],L=L.trim().replace(j,""),L.length<2)return"";for(;L.length%4!==0;)L=L+"=";return L}function pe(L,_){_=_||1/0;let v;const B=L.length;let X=null;const ce=[];for(let H=0;H<B;++H){if(v=L.charCodeAt(H),v>55295&&v<57344){if(!X){if(v>56319){(_-=3)>-1&&ce.push(239,191,189);continue}else if(H+1===B){(_-=3)>-1&&ce.push(239,191,189);continue}X=v;continue}if(v<56320){(_-=3)>-1&&ce.push(239,191,189),X=v;continue}v=(X-55296<<10|v-56320)+65536}else X&&(_-=3)>-1&&ce.push(239,191,189);if(X=null,v<128){if((_-=1)<0)break;ce.push(v)}else if(v<2048){if((_-=2)<0)break;ce.push(v>>6|192,v&63|128)}else if(v<65536){if((_-=3)<0)break;ce.push(v>>12|224,v>>6&63|128,v&63|128)}else if(v<1114112){if((_-=4)<0)break;ce.push(v>>18|240,v>>12&63|128,v>>6&63|128,v&63|128)}else throw new Error("Invalid code point")}return ce}function me(L){const _=[];for(let v=0;v<L.length;++v)_.push(L.charCodeAt(v)&255);return _}function se(L,_){let v,B,X;const ce=[];for(let H=0;H<L.length&&!((_-=2)<0);++H)v=L.charCodeAt(H),B=v>>8,X=v%256,ce.push(X),ce.push(B);return ce}function _e(L){return e.toByteArray(ee(L))}function Oe(L,_,v,B){let X;for(X=0;X<B&&!(X+v>=_.length||X>=L.length);++X)_[X+v]=L[X];return X}function be(L,_){return L instanceof _||L!=null&&L.constructor!=null&&L.constructor.name!=null&&L.constructor.name===_.name}function De(L){return L!==L}const pt=(function(){const L="0123456789abcdef",_=new Array(256);for(let v=0;v<16;++v){const B=v*16;for(let X=0;X<16;++X)_[B+X]=L[v]+L[X]}return _})();function Ze(L){return typeof BigInt>"u"?Xt:L}function Xt(){throw new Error("BigInt not supported")}})($g);const Zt=$g.Buffer,Fg=t=>t===void 0?null:t;class xO{constructor(){this.map=new Map}setItem(e,r){this.map.set(e,r)}getItem(e){return this.map.get(e)}}let Bg=new xO,EO=!0;try{typeof localStorage<"u"&&localStorage&&(Bg=localStorage,EO=!1)}catch{}const AO=Bg,TO=Object.assign,SO=Object.keys,RO=(t,e)=>{for(const r in t)e(t[r],r)},Dg=t=>SO(t).length,OO=t=>{for(const e in t)return!1;return!0},IO=(t,e)=>{for(const r in t)if(!e(t[r],r))return!1;return!0},NO=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),CO=(t,e)=>t===e||Dg(t)===Dg(e)&&IO(t,(r,n)=>(r!==void 0||NO(e,n))&&e[n]===r),LO=Object.freeze,jg=t=>{for(const e in t){const r=t[e];(typeof r=="object"||typeof r=="function")&&jg(t[e])}return LO(t)},nf=(t,e,r=0)=>{try{for(;r<t.length;r++)t[r](...e)}finally{r<t.length&&nf(t,e,r+1)}},MO=t=>t,UO=(t,e)=>e.includes(t);var zg={};const ha=typeof Rn<"u"&&Rn.release&&/node|io\.js/.test(Rn.release.name)&&Object.prototype.toString.call(typeof Rn<"u"?Rn:0)==="[object process]";let Xn;const $O=()=>{if(Xn===void 0)if(ha){Xn=On();const t=Rn.argv;let e=null;for(let r=0;r<t.length;r++){const n=t[r];n[0]==="-"?(e!==null&&Xn.set(e,""),e=n):e!==null&&(Xn.set(e,n),e=null)}e!==null&&Xn.set(e,"")}else typeof location=="object"?(Xn=On(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,r]=t.split("=");Xn.set(`--${Tg(e,"-")}`,r),Xn.set(`-${Tg(e,"-")}`,r)}})):Xn=On();return Xn},sf=t=>$O().has(t),Bc=t=>Fg(ha?zg[t.toUpperCase().replaceAll("-","_")]:AO.getItem(t)),Wg=t=>sf("--"+t)||Bc(t)!==null;Wg("production");const PO=ha&&UO(zg.FORCE_COLOR,["true","1","2"])||!sf("--no-colors")&&!Wg("no-color")&&(!ha||Rn.stdout.isTTY)&&(!ha||sf("--color")||Bc("COLORTERM")!==null||(Bc("TERM")||"").includes("color")),FO=t=>new Uint8Array(t),BO=t=>{const e=FO(t.byteLength);return e.set(t),e};class DO{constructor(e,r){this.left=e,this.right=r}}const yi=(t,e)=>new DO(t,e);typeof DOMParser<"u"&&new DOMParser;const jO=t=>BR(t,(e,r)=>`${r}:${e};`).join(""),_i=Symbol,Hg=_i(),Gg=_i(),zO=_i(),WO=_i(),HO=_i(),Kg=_i(),GO=_i(),of=_i(),KO=_i(),qO=t=>{t.length===1&&t[0]?.constructor===Function&&(t=t[0]());const e=[],r=[];let n=0;for(;n<t.length;n++){const i=t[n];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(n>0&&r.push(e.join(""));n<t.length;n++){const i=t[n];i instanceof Symbol||r.push(i)}return r},YO={[Hg]:yi("font-weight","bold"),[Gg]:yi("font-weight","normal"),[zO]:yi("color","blue"),[HO]:yi("color","green"),[WO]:yi("color","grey"),[Kg]:yi("color","red"),[GO]:yi("color","purple"),[of]:yi("color","orange"),[KO]:yi("color","black")},qg=PO?t=>{t.length===1&&t[0]?.constructor===Function&&(t=t[0]());const e=[],r=[],n=On();let i=[],s=0;for(;s<t.length;s++){const o=t[s],a=YO[o];if(a!==void 0)n.set(a.left,a.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const c=jO(n);s>0||c.length>0?(e.push("%c"+o),r.push(c)):e.push(o)}else break}}for(s>0&&(i=r,i.unshift(e.join("")));s<t.length;s++){const o=t[s];o instanceof Symbol||i.push(o)}return i}:qO,VO=(...t)=>{console.log(...qg(t)),Yg.forEach(e=>e.print(t))},XO=(...t)=>{console.warn(...qg(t)),t.unshift(of),Yg.forEach(e=>e.print(t))},Yg=to(),Vg=t=>({[Symbol.iterator](){return this},next:t}),ZO=(t,e)=>Vg(()=>{let r;do r=t.next();while(!r.done&&!e(r.value));return r}),af=(t,e)=>Vg(()=>{const{done:r,value:n}=t.next();return{done:r,value:r?void 0:e(n)}});class cf{constructor(e,r){this.clock=e,this.len=r}}class fa{constructor(){this.clients=new Map}}const Xg=(t,e,r)=>e.clients.forEach((n,i)=>{const s=t.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,l=n[c];c<n.length&&l.clock<a;l=n[++c])fy(t,s,l.clock,l.len,r)}}),JO=(t,e)=>{let r=0,n=t.length-1;for(;r<=n;){const i=Di((r+n)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;r=i+1}else n=i-1}return null},Zg=(t,e)=>{const r=t.clients.get(e.client);return r!==void 0&&JO(r,e.clock)!==null},lf=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let r,n;for(r=1,n=1;r<e.length;r++){const i=e[n-1],s=e[r];i.clock+i.len>=s.clock?i.len=fs(i.len,s.clock+s.len-i.clock):(n<r&&(e[n]=s),n++)}e.length=n})},QO=t=>{const e=new fa;for(let r=0;r<t.length;r++)t[r].clients.forEach((n,i)=>{if(!e.clients.has(i)){const s=n.slice();for(let o=r+1;o<t.length;o++)jR(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return lf(e),e},Dc=(t,e,r,n)=>{Bi(t.clients,e,()=>[]).push(new cf(r,n))},eI=()=>new fa,tI=t=>{const e=eI();return t.clients.forEach((r,n)=>{const i=[];for(let s=0;s<r.length;s++){const o=r[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<r.length)for(let l=r[s+1];s+1<r.length&&l.deleted;l=r[++s+1])c+=l.length;i.push(new cf(a,c))}}i.length>0&&e.clients.set(n,i)}),e},ao=(t,e)=>{ht(t.restEncoder,e.clients.size),hs(e.clients.entries()).sort((r,n)=>n[0]-r[0]).forEach(([r,n])=>{t.resetDsCurVal(),ht(t.restEncoder,r);const i=n.length;ht(t.restEncoder,i);for(let s=0;s<i;s++){const o=n[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},uf=t=>{const e=new fa,r=tt(t.restDecoder);for(let n=0;n<r;n++){t.resetDsCurVal();const i=tt(t.restDecoder),s=tt(t.restDecoder);if(s>0){const o=Bi(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new cf(t.readDsClock(),t.readDsLen()))}}return e},Jg=(t,e,r)=>{const n=new fa,i=tt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=tt(t.restDecoder),a=tt(t.restDecoder),c=r.clients.get(o)||[],l=or(r,o);for(let u=0;u<a;u++){const d=t.readDsClock(),f=d+t.readDsLen();if(d<l){l<f&&Dc(n,o,l,f-l);let h=Zn(c,d),m=c[h];for(!m.deleted&&m.id.clock<d&&(c.splice(h+1,0,el(e,m,d-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<f);)m.deleted||(f<m.id.clock+m.length&&c.splice(h,0,el(e,m,f-m.id.clock)),m.delete(e))}else Dc(n,o,d,f-d)}}if(n.clients.size>0){const s=new ps;return ht(s.restEncoder,0),ao(s,n),s.toUint8Array()}return null},Qg=Mg;class co extends WR{constructor({guid:e=pO(),collectionid:r=null,gc:n=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=i,this.clientID=Qg(),this.guid=e,this.collectionid=r,this.share=new Map,this.store=new ly,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ug(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Ug(l=>{const u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&kt(e.parent.doc,r=>{r.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(hs(this.subdocs).map(e=>e.guid))}transact(e,r=null){return kt(this,e,r)}get(e,r=br){const n=Bi(this.share,e,()=>{const s=new r;return s._integrate(this,null),s}),i=n.constructor;if(r!==br&&i!==r)if(i===br){const s=new r;s._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=n._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=n._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return n}getArray(e=""){return this.get(e,fo)}getText(e=""){return this.get(e,bi)}getMap(e=""){return this.get(e,po)}getXmlElement(e=""){return this.get(e,go)}getXmlFragment(e=""){return this.get(e,ms)}toJSON(){const e={};return this.share.forEach((r,n)=>{e[n]=r.toJSON()}),e}destroy(){this.isDestroyed=!0,hs(this.subdocs).forEach(r=>r.destroy());const e=this._item;if(e!==null){this._item=null;const r=e.content;r.doc=new co({guid:this.guid,...r.opts,shouldLoad:!1}),r.doc._item=e,kt(e.parent.doc,n=>{const i=r.doc;e.deleted||n.subdocsAdded.add(i),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class ey{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return tt(this.restDecoder)}readDsLen(){return tt(this.restDecoder)}}class ty extends ey{readLeftID(){return ot(tt(this.restDecoder),tt(this.restDecoder))}readRightID(){return ot(tt(this.restDecoder),tt(this.restDecoder))}readClient(){return tt(this.restDecoder)}readInfo(){return io(this.restDecoder)}readString(){return so(this.restDecoder)}readParentInfo(){return tt(this.restDecoder)===1}readTypeRef(){return tt(this.restDecoder)}readLen(){return tt(this.restDecoder)}readAny(){return ua(this.restDecoder)}readBuf(){return BO(en(this.restDecoder))}readJSON(){return JSON.parse(so(this.restDecoder))}readKey(){return so(this.restDecoder)}}class rI{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=tt(this.restDecoder),this.dsCurrVal}readDsLen(){const e=tt(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class lo extends rI{constructor(e){super(e),this.keys=[],tt(e),this.keyClockDecoder=new ef(en(e)),this.clientDecoder=new Pc(en(e)),this.leftClockDecoder=new ef(en(e)),this.rightClockDecoder=new ef(en(e)),this.infoDecoder=new Lg(en(e),io),this.stringDecoder=new hO(en(e)),this.parentInfoDecoder=new Lg(en(e),io),this.typeRefDecoder=new Pc(en(e)),this.lenDecoder=new Pc(en(e))}readLeftID(){return new uo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new uo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ua(this.restDecoder)}readBuf(){return en(this.restDecoder)}readJSON(){return ua(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const r=this.stringDecoder.read();return this.keys.push(r),r}}}class nI{constructor(){this.restEncoder=Lc()}toUint8Array(){return Kn(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ht(this.restEncoder,e)}writeDsLen(e){ht(this.restEncoder,e)}}class da extends nI{writeLeftID(e){ht(this.restEncoder,e.client),ht(this.restEncoder,e.clock)}writeRightID(e){ht(this.restEncoder,e.client),ht(this.restEncoder,e.clock)}writeClient(e){ht(this.restEncoder,e)}writeInfo(e){qh(this.restEncoder,e)}writeString(e){ro(this.restEncoder,e)}writeParentInfo(e){ht(this.restEncoder,e?1:0)}writeTypeRef(e){ht(this.restEncoder,e)}writeLen(e){ht(this.restEncoder,e)}writeAny(e){la(this.restEncoder,e)}writeBuf(e){Qr(this.restEncoder,e)}writeJSON(e){ro(this.restEncoder,JSON.stringify(e))}writeKey(e){ro(this.restEncoder,e)}}class iI{constructor(){this.restEncoder=Lc(),this.dsCurrVal=0}toUint8Array(){return Kn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const r=e-this.dsCurrVal;this.dsCurrVal=e,ht(this.restEncoder,r)}writeDsLen(e){e===0&&Yn(),ht(this.restEncoder,e-1),this.dsCurrVal+=e}}class ps extends iI{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Zh,this.clientEncoder=new Uc,this.leftClockEncoder=new Zh,this.rightClockEncoder=new Zh,this.infoEncoder=new Rg(qh),this.stringEncoder=new aO,this.parentInfoEncoder=new Rg(qh),this.typeRefEncoder=new Uc,this.lenEncoder=new Uc}toUint8Array(){const e=Lc();return ht(e,0),Qr(e,this.keyClockEncoder.toUint8Array()),Qr(e,this.clientEncoder.toUint8Array()),Qr(e,this.leftClockEncoder.toUint8Array()),Qr(e,this.rightClockEncoder.toUint8Array()),Qr(e,Kn(this.infoEncoder)),Qr(e,this.stringEncoder.toUint8Array()),Qr(e,Kn(this.parentInfoEncoder)),Qr(e,this.typeRefEncoder.toUint8Array()),Qr(e,this.lenEncoder.toUint8Array()),Mc(e,Kn(this.restEncoder)),Kn(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){la(this.restEncoder,e)}writeBuf(e){Qr(this.restEncoder,e)}writeJSON(e){la(this.restEncoder,e)}writeKey(e){const r=this.keyMap.get(e);r===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(r)}}const sI=(t,e,r,n)=>{n=fs(n,e[0].id.clock);const i=Zn(e,n);ht(t.restEncoder,e.length-i),t.writeClient(r),ht(t.restEncoder,n);const s=e[i];s.write(t,n-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},hf=(t,e,r)=>{const n=new Map;r.forEach((i,s)=>{or(e,s)>i&&n.set(s,i)}),df(e).forEach((i,s)=>{r.has(s)||n.set(s,0)}),ht(t.restEncoder,n.size),hs(n.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{sI(t,e.clients.get(i),i,s)})},oI=(t,e)=>{const r=On(),n=tt(t.restDecoder);for(let i=0;i<n;i++){const s=tt(t.restDecoder),o=new Array(s),a=t.readClient();let c=tt(t.restDecoder);r.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(Cc&u){case 0:{const d=t.readLen();o[l]=new pn(ot(a,c),d),c+=d;break}case 10:{const d=tt(t.restDecoder);o[l]=new mn(ot(a,c),d),c+=d;break}default:{const d=(u&(gi|Jr))===0,f=new Qt(ot(a,c),null,(u&Jr)===Jr?t.readLeftID():null,null,(u&gi)===gi?t.readRightID():null,d?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,d&&(u&sa)===sa?t.readString():null,Py(t,u));o[l]=f,c+=f.length}}}}return r},aI=(t,e,r)=>{const n=[];let i=hs(r.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=r.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=r.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new ly,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const d=new Map,f=()=>{for(const h of n){const m=h.id.client,p=r.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),r.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(g=>g!==m)}n.length=0};for(;;){if(u.constructor!==mn){const m=Bi(d,u.id.client,()=>or(e,u.id.client))-u.id.clock;if(m<0)n.push(u),l(u.id.client,u.id.clock-1),f();else{const p=u.getMissing(t,e);if(p!==null){n.push(u);const g=r.get(p)||{refs:[],i:0};if(g.refs.length===g.i)l(p,or(e,p)),f();else{u=g.refs[g.i++];continue}}else(m===0||m<u.length)&&(u.integrate(t,m),d.set(u.id.client,u.id.clock+u.length))}}if(n.length>0)u=n.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new ps;return hf(h,a,new Map),ht(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},cI=(t,e)=>hf(t,e.doc.store,e.beforeState),lI=(t,e,r,n=new lo(t))=>kt(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=oI(n,o),l=aI(i,a,c),u=a.pendingStructs;if(u){for(const[f,h]of u.missing)if(h<or(a,f)){s=!0;break}if(l){for(const[f,h]of l.missing){const m=u.missing.get(f);(m==null||m>h)&&u.missing.set(f,h)}u.update=Wc([u.update,l.update])}}else a.pendingStructs=l;const d=Jg(n,i,a);if(a.pendingDs){const f=new lo(no(a.pendingDs));tt(f.restDecoder);const h=Jg(f,i,a);d&&h?a.pendingDs=Wc([d,h]):a.pendingDs=d||h}else a.pendingDs=d;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,ry(i.doc,f)}},r,!1),ry=(t,e,r,n=lo)=>{const i=no(e);lI(i,t,r,new n(i))},ny=(t,e,r)=>ry(t,e,r,ty),uI=(t,e,r=new Map)=>{hf(t,e.store,r),ao(t,tI(e.store))},hI=(t,e=new Uint8Array([0]),r=new ps)=>{const n=iy(e);uI(r,t,n);const i=[r.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(xI(t.store.pendingStructs.update,e)),i.length>1){if(r.constructor===da)return kI(i.map((s,o)=>o===0?s:AI(s)));if(r.constructor===ps)return Wc(i)}return i[0]},fI=(t,e)=>hI(t,e,new da),dI=t=>{const e=new Map,r=tt(t.restDecoder);for(let n=0;n<r;n++){const i=tt(t.restDecoder),s=tt(t.restDecoder);e.set(i,s)}return e},iy=t=>dI(new ey(no(t)));class pI{constructor(){this.l=[]}}const sy=()=>new pI,oy=(t,e)=>t.l.push(e),ay=(t,e)=>{const r=t.l,n=r.length;t.l=r.filter(i=>e!==i),n===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},cy=(t,e,r)=>nf(t.l,[e,r]);class uo{constructor(e,r){this.client=e,this.clock=r}}const jc=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,ot=(t,e)=>new uo(t,e),mI=t=>{for(const[e,r]of t.doc.share.entries())if(r===t)return e;throw Yn()},ho=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Zg(e.ds,t.id),ff=(t,e)=>{const r=Bi(t.meta,ff,to),n=t.doc.store;r.has(e)||(e.sv.forEach((i,s)=>{i<or(n,s)&&zi(t,ot(s,i))}),Xg(t,e.ds,i=>{}),r.add(e))};class ly{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const df=t=>{const e=new Map;return t.clients.forEach((r,n)=>{const i=r[r.length-1];e.set(n,i.id.clock+i.length)}),e},or=(t,e)=>{const r=t.clients.get(e);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},uy=(t,e)=>{let r=t.clients.get(e.id.client);if(r===void 0)r=[],t.clients.set(e.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==e.id.clock)throw Yn()}r.push(e)},Zn=(t,e)=>{let r=0,n=t.length-1,i=t[n],s=i.id.clock;if(s===e)return n;let o=Di(e/(s+i.length-1)*n);for(;r<=n;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;r=o+1}else n=o-1;o=Di((r+n)/2)}throw Yn()},pf=(t,e)=>{const r=t.clients.get(e.client);return r[Zn(r,e.clock)]},mf=(t,e,r)=>{const n=Zn(e,r),i=e[n];return i.id.clock<r&&i instanceof Qt?(e.splice(n+1,0,el(t,i,r-i.id.clock)),n+1):n},zi=(t,e)=>{const r=t.doc.store.clients.get(e.client);return r[mf(t,r,e.clock)]},hy=(t,e,r)=>{const n=e.clients.get(r.client),i=Zn(n,r.clock),s=n[i];return r.clock!==s.id.clock+s.length-1&&s.constructor!==pn&&n.splice(i+1,0,el(t,s,r.clock-s.id.clock+1)),s},gI=(t,e,r)=>{const n=t.clients.get(e.id.client);n[Zn(n,e.id.clock)]=r},fy=(t,e,r,n,i)=>{if(n===0)return;const s=r+n;let o=mf(t,e,r),a;do a=e[o++],s<a.id.clock+a.length&&mf(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class yI{constructor(e,r,n){this.doc=e,this.deleteSet=new fa,this.beforeState=df(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=r,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const dy=(t,e)=>e.deleteSet.clients.size===0&&!DR(e.afterState,(r,n)=>e.beforeState.get(n)!==r)?!1:(lf(e.deleteSet),cI(t,e),ao(t,e.deleteSet),!0),py=(t,e,r)=>{const n=e._item;(n===null||n.id.clock<(t.beforeState.get(n.id.client)||0)&&!n.deleted)&&Bi(t.changed,e,to).add(r)},zc=(t,e)=>{let r=t[e],n=t[e-1],i=e;for(;i>0;r=n,n=t[--i-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof Qt&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},_I=(t,e,r)=>{for(const[n,i]of t.clients.entries()){const s=e.clients.get(n);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Zn(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const d=s[l];if(a.clock+a.len<=d.id.clock)break;d instanceof Qt&&d.deleted&&!d.keep&&r(d)&&d.gc(e,!1)}}}},bI=(t,e)=>{t.clients.forEach((r,n)=>{const i=e.clients.get(n);for(let s=r.length-1;s>=0;s--){const o=r[s],a=kg(i.length-1,1+Zn(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+zc(i,c)}})},my=(t,e)=>{if(e<t.length){const r=t[e],n=r.doc,i=n.store,s=r.deleteSet,o=r._mergeStructs;try{lf(s),r.afterState=df(r.doc.store),n.emit("beforeObserverCalls",[r,n]);const a=[];r.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(r,c)})),a.push(()=>{r.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,d)=>u.path.length-d.path.length),cy(l._dEH,c,r))})}),a.push(()=>n.emit("afterTransaction",[r,n])),nf(a,[]),r._needFormattingCleanup&&BI(r)}finally{n.gc&&_I(s,i,n.gcFilter),bI(s,i),r.afterState.forEach((u,d)=>{const f=r.beforeState.get(d)||0;if(f!==u){const h=i.clients.get(d),m=fs(Zn(h,f),1);for(let p=h.length-1;p>=m;)p-=1+zc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:d,clock:f}=o[u].id,h=i.clients.get(d),m=Zn(h,f);m+1<h.length&&zc(h,m+1)>1||m>0&&zc(h,m)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(VO(of,Hg,"[yjs] ",Gg,Kg,"Changed the client-id because another client seems to be using it."),n.clientID=Qg()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const u=new da;dy(u,r)&&n.emit("update",[u.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const u=new ps;dy(u,r)&&n.emit("updateV2",[u.toUint8Array(),r.origin,n,r])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=r;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=n.clientID,u.collectionid==null&&(u.collectionid=n.collectionid),n.subdocs.add(u)}),l.forEach(u=>n.subdocs.delete(u)),n.emit("subdocs",[{loaded:c,added:a,removed:l},n,r]),l.forEach(u=>u.destroy())),t.length<=e+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,t])):my(t,e+1)}}},kt=(t,e,r=null,n=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new yI(t,r,n),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&my(i,0)}}return o};function*wI(t){const e=tt(t.restDecoder);for(let r=0;r<e;r++){const n=tt(t.restDecoder),i=t.readClient();let s=tt(t.restDecoder);for(let o=0;o<n;o++){const a=t.readInfo();if(a===10){const c=tt(t.restDecoder);yield new mn(ot(i,s),c),s+=c}else if((Cc&a)!==0){const c=(a&(gi|Jr))===0,l=new Qt(ot(i,s),null,(a&Jr)===Jr?t.readLeftID():null,null,(a&gi)===gi?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&sa)===sa?t.readString():null,Py(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new pn(ot(i,s),c),s+=c}}}}class gf{constructor(e,r){this.gen=wI(e),this.curr=null,this.done=!1,this.filterSkips=r,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===mn);return this.curr}}class yf{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const kI=t=>Wc(t,ty,da),vI=(t,e)=>{if(t.constructor===pn){const{client:r,clock:n}=t.id;return new pn(ot(r,n+e),t.length-e)}else if(t.constructor===mn){const{client:r,clock:n}=t.id;return new mn(ot(r,n+e),t.length-e)}else{const r=t,{client:n,clock:i}=r.id;return new Qt(ot(n,i+e),null,ot(n,i+e-1),null,r.rightOrigin,r.parent,r.parentSub,r.content.splice(e))}},Wc=(t,e=lo,r=ps)=>{if(t.length===1)return t[0];const n=t.map(u=>new e(no(u)));let i=n.map(u=>new gf(u,!0)),s=null;const o=new r,a=new yf(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,h)=>{if(f.curr.id.client===h.curr.id.client){const m=f.curr.id.clock-h.curr.id.clock;return m===0?f.curr.constructor===h.curr.constructor?0:f.curr.constructor===mn?1:-1:m}else return h.curr.id.client-f.curr.id.client}),i.length!==0;){const u=i[0],d=u.curr.id.client;if(s!==null){let f=u.curr,h=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=u.next(),h=!0;if(f===null||f.id.client!==d||h&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(d!==s.struct.id.client)Wi(a,s.struct,s.offset),s={struct:f,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===mn)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Wi(a,s.struct,s.offset);const m=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new mn(ot(d,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-f.id.clock;m>0&&(s.struct.constructor===mn?s.struct.length-=m:f=vI(f,m)),s.struct.mergeWith(f)||(Wi(a,s.struct,s.offset),s={struct:f,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let f=u.curr;f!==null&&f.id.client===d&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==mn;f=u.next())Wi(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Wi(a,s.struct,s.offset),s=null),_f(a);const c=n.map(u=>uf(u)),l=QO(c);return ao(o,l),o.toUint8Array()},xI=(t,e,r=lo,n=ps)=>{const i=iy(e),s=new n,o=new yf(s),a=new r(no(t)),c=new gf(a,!1);for(;c.curr;){const u=c.curr,d=u.id.client,f=i.get(d)||0;if(c.curr.constructor===mn){c.next();continue}if(u.id.clock+u.length>f)for(Wi(o,u,fs(f-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===d;)Wi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===d&&c.curr.id.clock+c.curr.length<=f;)c.next()}_f(o);const l=uf(a);return ao(s,l),s.toUint8Array()},gy=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Kn(t.encoder.restEncoder)}),t.encoder.restEncoder=Lc(),t.written=0)},Wi=(t,e,r)=>{t.written>0&&t.currClient!==e.id.client&&gy(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ht(t.encoder.restEncoder,e.id.clock+r)),e.write(t.encoder,r),t.written++},_f=t=>{gy(t);const e=t.encoder.restEncoder;ht(e,t.clientStructs.length);for(let r=0;r<t.clientStructs.length;r++){const n=t.clientStructs[r];ht(e,n.written),Mc(e,n.restEncoder)}},EI=(t,e,r,n)=>{const i=new r(no(t)),s=new gf(i,!1),o=new n,a=new yf(o);for(let l=s.curr;l!==null;l=s.next())Wi(a,e(l),0);_f(a);const c=uf(i);return ao(o,c),o.toUint8Array()},AI=t=>EI(t,MO,lo,da),yy="You must not compute changes after the event-handler fired.";class Hc{constructor(e,r){this.target=e,this.currentTarget=e,this.transaction=r,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=TI(this.currentTarget,this.target))}deletes(e){return Zg(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ji(yy);const e=new Map,r=this.target;this.transaction.changed.get(r).forEach(i=>{if(i!==null){const s=r._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Wh(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Wh(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Wh(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw ji(yy);const r=this.target,n=to(),i=to(),s=[];if(e={added:n,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(r).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=r._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),n.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const TI=(t,e)=>{const r=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)r.unshift(e._item.parentSub);else{let n=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(n+=i.length),i=i.right;r.unshift(n)}e=e._item.parent}return r},xr=()=>{XO("Invalid access: Add Yjs type to a document before reading data.")},_y=80;let bf=0;class SI{constructor(e,r){e.marker=!0,this.p=e,this.index=r,this.timestamp=bf++}}const RI=t=>{t.timestamp=bf++},by=(t,e,r)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=r,t.timestamp=bf++},OI=(t,e,r)=>{if(t.length>=_y){const n=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return by(n,e,r),n}else{const n=new SI(e,r);return t.push(n),n}},Gc=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const r=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>Nc(e-s.index)<Nc(e-o.index)?s:o);let n=t._start,i=0;for(r!==null&&(n=r.p,i=r.index,RI(r));n.right!==null&&i<e;){if(!n.deleted&&n.countable){if(e<i+n.length)break;i+=n.length}n=n.right}for(;n.left!==null&&i>e;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(i-=n.length);return r!==null&&Nc(r.index-i)<n.parent.length/_y?(by(r,n,i),r):OI(t._searchMarker,n,i)},pa=(t,e,r)=>{for(let n=t.length-1;n>=0;n--){const i=t[n];if(r>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(n,1);continue}i.p=s,s.marker=!0}(e<i.index||r>0&&e===i.index)&&(i.index=fs(e,i.index+r))}},Kc=(t,e,r)=>{const n=t,i=e.changedParentTypes;for(;Bi(i,t,()=>[]).push(r),t._item!==null;)t=t._item.parent;cy(n._eH,r,e)};class br{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=sy(),this._dEH=sy(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,r){this.doc=e,this._item=r}_copy(){throw qn()}clone(){throw qn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,r){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){oy(this._eH,e)}observeDeep(e){oy(this._dEH,e)}unobserve(e){ay(this._eH,e)}unobserveDeep(e){ay(this._dEH,e)}toJSON(){}}const wy=(t,e,r)=>{t.doc??xr(),e<0&&(e=t._length+e),r<0&&(r=t._length+r);let n=r-e;const i=[];let s=t._start;for(;s!==null&&n>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&n>0;a++)i.push(o[a]),n--;e=0}}s=s.right}return i},ky=t=>{t.doc??xr();const e=[];let r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let i=0;i<n.length;i++)e.push(n[i])}r=r.right}return e},ma=(t,e)=>{let r=0,n=t._start;for(t.doc??xr();n!==null;){if(n.countable&&!n.deleted){const i=n.content.getContent();for(let s=0;s<i.length;s++)e(i[s],r++,t)}n=n.right}},vy=(t,e)=>{const r=[];return ma(t,(n,i)=>{r.push(e(n,i,t))}),r},II=t=>{let e=t._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};r=e.content.getContent(),n=0,e=e.right}const i=r[n++];return r.length<=n&&(r=null),{done:!1,value:i}}}},xy=(t,e)=>{t.doc??xr();const r=Gc(t,e);let n=t._start;for(r!==null&&(n=r.p,e-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(e<n.length)return n.content.getContent()[e];e-=n.length}},qc=(t,e,r,n)=>{let i=r;const s=t.doc,o=s.clientID,a=s.store,c=r===null?e._start:r.right;let l=[];const u=()=>{l.length>0&&(i=new Qt(ot(o,or(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ys(l)),i.integrate(t,0),l=[])};n.forEach(d=>{if(d===null)l.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:i=new Qt(ot(o,or(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ga(new Uint8Array(d))),i.integrate(t,0);break;case co:i=new Qt(ot(o,or(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new _a(d)),i.integrate(t,0);break;default:if(d instanceof br)i=new Qt(ot(o,or(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new wi(d)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Ey=()=>ji("Length exceeded!"),Ay=(t,e,r,n)=>{if(r>e._length)throw Ey();if(r===0)return e._searchMarker&&pa(e._searchMarker,r,n.length),qc(t,e,null,n);const i=r,s=Gc(e,r);let o=e._start;for(s!==null&&(o=s.p,r-=s.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&zi(t,ot(o.id.client,o.id.clock+r));break}r-=o.length}return e._searchMarker&&pa(e._searchMarker,i,n.length),qc(t,e,o,n)},NI=(t,e,r)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return qc(t,e,i,r)},Ty=(t,e,r,n)=>{if(n===0)return;const i=r,s=n,o=Gc(e,r);let a=e._start;for(o!==null&&(a=o.p,r-=o.index);a!==null&&r>0;a=a.right)!a.deleted&&a.countable&&(r<a.length&&zi(t,ot(a.id.client,a.id.clock+r)),r-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&zi(t,ot(a.id.client,a.id.clock+n)),a.delete(t),n-=a.length),a=a.right;if(n>0)throw Ey();e._searchMarker&&pa(e._searchMarker,i,-s+n)},Yc=(t,e,r)=>{const n=e._map.get(r);n!==void 0&&n.delete(t)},wf=(t,e,r,n)=>{const i=e._map.get(r)||null,s=t.doc,o=s.clientID;let a;if(n==null)a=new ys([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new ys([n]);break;case Uint8Array:a=new ga(n);break;case co:a=new _a(n);break;default:if(n instanceof br)a=new wi(n);else throw new Error("Unexpected content type")}new Qt(ot(o,or(s.store,o)),i,i&&i.lastId,null,null,e,r,a).integrate(t,0)},kf=(t,e)=>{t.doc??xr();const r=t._map.get(e);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},Sy=t=>{const e={};return t.doc??xr(),t._map.forEach((r,n)=>{r.deleted||(e[n]=r.content.getContent()[r.length-1])}),e},Ry=(t,e)=>{t.doc??xr();const r=t._map.get(e);return r!==void 0&&!r.deleted},CI=(t,e)=>{const r={};return t._map.forEach((n,i)=>{let s=n;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&ho(s,e)&&(r[i]=s.content.getContent()[s.length-1])}),r},Vc=t=>(t.doc??xr(),ZO(t._map.entries(),e=>!e[1].deleted));class LI extends Hc{}class fo extends br{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const r=new fo;return r.push(e),r}_integrate(e,r){super._integrate(e,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new fo}clone(){const e=new fo;return e.insert(0,this.toArray().map(r=>r instanceof br?r.clone():r)),e}get length(){return this.doc??xr(),this._length}_callObserver(e,r){super._callObserver(e,r),Kc(this,e,new LI(this,e))}insert(e,r){this.doc!==null?kt(this.doc,n=>{Ay(n,this,e,r)}):this._prelimContent.splice(e,0,...r)}push(e){this.doc!==null?kt(this.doc,r=>{NI(r,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,r=1){this.doc!==null?kt(this.doc,n=>{Ty(n,this,e,r)}):this._prelimContent.splice(e,r)}get(e){return xy(this,e)}toArray(){return ky(this)}slice(e=0,r=this.length){return wy(this,e,r)}toJSON(){return this.map(e=>e instanceof br?e.toJSON():e)}map(e){return vy(this,e)}forEach(e){ma(this,e)}[Symbol.iterator](){return II(this)}_write(e){e.writeTypeRef(iN)}}const MI=t=>new fo;class UI extends Hc{constructor(e,r,n){super(e,r),this.keysChanged=n}}class po extends br{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,r){super._integrate(e,r),this._prelimContent.forEach((n,i)=>{this.set(i,n)}),this._prelimContent=null}_copy(){return new po}clone(){const e=new po;return this.forEach((r,n)=>{e.set(n,r instanceof br?r.clone():r)}),e}_callObserver(e,r){Kc(this,e,new UI(this,e,r))}toJSON(){this.doc??xr();const e={};return this._map.forEach((r,n)=>{if(!r.deleted){const i=r.content.getContent()[r.length-1];e[n]=i instanceof br?i.toJSON():i}}),e}get size(){return[...Vc(this)].length}keys(){return af(Vc(this),e=>e[0])}values(){return af(Vc(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return af(Vc(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??xr(),this._map.forEach((r,n)=>{r.deleted||e(r.content.getContent()[r.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?kt(this.doc,r=>{Yc(r,this,e)}):this._prelimContent.delete(e)}set(e,r){return this.doc!==null?kt(this.doc,n=>{wf(n,this,e,r)}):this._prelimContent.set(e,r),r}get(e){return kf(this,e)}has(e){return Ry(this,e)}clear(){this.doc!==null?kt(this.doc,e=>{this.forEach(function(r,n,i){Yc(e,i,n)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(sN)}}const $I=t=>new po,Hi=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&CO(t,e);class vf{constructor(e,r,n,i){this.left=e,this.right=r,this.index=n,this.currentAttributes=i}forward(){switch(this.right===null&&Yn(),this.right.content.constructor){case Jt:this.right.deleted||mo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Oy=(t,e,r)=>{for(;e.right!==null&&r>0;){switch(e.right.content.constructor){case Jt:e.right.deleted||mo(e.currentAttributes,e.right.content);break;default:e.right.deleted||(r<e.right.length&&zi(t,ot(e.right.id.client,e.right.id.clock+r)),e.index+=e.right.length,r-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Xc=(t,e,r,n)=>{const i=new Map,s=n?Gc(e,r):null;if(s){const o=new vf(s.p.left,s.p,s.index,i);return Oy(t,o,r-s.index)}else{const o=new vf(null,e._start,0,i);return Oy(t,o,r)}},Iy=(t,e,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===Jt&&Hi(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const i=t.doc,s=i.clientID;n.forEach((o,a)=>{const c=r.left,l=r.right,u=new Qt(ot(s,or(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Jt(a,o));u.integrate(t,0),r.right=u,r.forward()})},mo=(t,e)=>{const{key:r,value:n}=e;n===null?t.delete(r):t.set(r,n)},Ny=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Jt&&Hi(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Cy=(t,e,r,n)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in n){const c=n[a],l=r.currentAttributes.get(a)??null;if(!Hi(l,c)){o.set(a,l);const{left:u,right:d}=r;r.right=new Qt(ot(s,or(i.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new Jt(a,c)),r.right.integrate(t,0),r.forward()}}return o},xf=(t,e,r,n,i)=>{r.currentAttributes.forEach((f,h)=>{i[h]===void 0&&(i[h]=null)});const s=t.doc,o=s.clientID;Ny(r,i);const a=Cy(t,e,r,i),c=n.constructor===String?new Jn(n):n instanceof br?new wi(n):new gs(n);let{left:l,right:u,index:d}=r;e._searchMarker&&pa(e._searchMarker,r.index,c.getLength()),u=new Qt(ot(o,or(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),r.right=u,r.index=d,r.forward(),Iy(t,e,r,a)},Ly=(t,e,r,n,i)=>{const s=t.doc,o=s.clientID;Ny(r,i);const a=Cy(t,e,r,i);e:for(;r.right!==null&&(n>0||a.size>0&&(r.right.deleted||r.right.content.constructor===Jt));){if(!r.right.deleted)switch(r.right.content.constructor){case Jt:{const{key:c,value:l}=r.right.content,u=i[c];if(u!==void 0){if(Hi(u,l))a.delete(c);else{if(n===0)break e;a.set(c,l)}r.right.delete(t)}else r.currentAttributes.set(c,l);break}default:n<r.right.length&&zi(t,ot(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;r.right=new Qt(ot(o,or(s.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,e,null,new Jn(c)),r.right.integrate(t,0),r.forward()}Iy(t,e,r,a)},My=(t,e,r,n,i)=>{let s=e;const o=On();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Jt){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(r===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Jt:{const{key:u,value:d}=l,f=n.get(u)??null;(o.get(u)!==l||f===d)&&(e.delete(t),a++,!c&&(i.get(u)??null)===d&&f!==d&&(f===null?i.delete(u):i.set(u,f))),!c&&!e.deleted&&mo(i,l);break}}}e=e.right}return a},PI=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const r=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Jt){const n=e.content.key;r.has(n)?e.delete(t):r.add(n)}e=e.left}},FI=t=>{let e=0;return kt(t.doc,r=>{let n=t._start,i=t._start,s=On();const o=zh(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Jt:mo(o,i.content);break;default:e+=My(r,n,i,s,o),s=zh(o),n=i;break}i=i.right}}),e},BI=t=>{const e=new Set,r=t.doc;for(const[n,i]of t.afterState.entries()){const s=t.beforeState.get(n)||0;i!==s&&fy(t,r.store.clients.get(n),s,i,o=>{!o.deleted&&o.content.constructor===Jt&&o.constructor!==pn&&e.add(o.parent)})}kt(r,n=>{Xg(t,t.deleteSet,i=>{if(i instanceof pn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Jt?e.add(s):PI(n,i)});for(const i of e)FI(i)})},Uy=(t,e,r)=>{const n=r,i=zh(e.currentAttributes),s=e.right;for(;r>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case wi:case gs:case Jn:r<e.right.length&&zi(t,ot(e.right.id.client,e.right.id.clock+r)),r-=e.right.length,e.right.delete(t);break}e.forward()}s&&My(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&pa(o._searchMarker,e.index,-n+r),e};class DI extends Hc{constructor(e,r,n){super(e,r),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,r=[];kt(e,n=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,d=0;const f=()=>{if(a!==null){let h=null;switch(a){case"delete":d>0&&(h={delete:d}),d=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},OO(c)||(h.attributes=TO({},c))),u=0;break}h&&r.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case wi:case gs:this.adds(o)?this.deletes(o)||(f(),a="insert",l=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),d+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),u+=1);break;case Jn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),d+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),u+=o.length);break;case Jt:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;Hi(p,m)?m!==null&&o.delete(n):(a==="retain"&&f(),Hi(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;Hi(p,m)||(a==="retain"&&f(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&(Hi(p,m)?p!==null&&o.delete(n):(a==="retain"&&f(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&f(),mo(i,o.content));break}}o=o.right}for(f();r.length>0;){const h=r[r.length-1];if(h.retain!==void 0&&h.attributes===void 0)r.pop();else break}}),this._delta=r}return this._delta}}class bi extends br{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??xr(),this._length}_integrate(e,r){super._integrate(e,r);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new bi}clone(){const e=new bi;return e.applyDelta(this.toDelta()),e}_callObserver(e,r){super._callObserver(e,r);const n=new DI(this,e,r);Kc(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??xr();let e="",r=this._start;for(;r!==null;)!r.deleted&&r.countable&&r.content.constructor===Jn&&(e+=r.content.str),r=r.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:r=!0}={}){this.doc!==null?kt(this.doc,n=>{const i=new vf(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!r&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&xf(n,this,i,a,o.attributes||{})}else o.retain!==void 0?Ly(n,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Uy(n,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,r,n){this.doc??xr();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const d={};let f=!1;s.forEach((m,p)=>{f=!0,d[p]=m});const h={insert:a};f&&(h.attributes=d),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(ho(c,e)||r!==void 0&&ho(c,r))switch(c.content.constructor){case Jn:{const d=s.get("ychange");e!==void 0&&!ho(c,e)?(d===void 0||d.user!==c.id.client||d.type!=="removed")&&(l(),s.set("ychange",n?n("removed",c.id):{type:"removed"})):r!==void 0&&!ho(c,r)?(d===void 0||d.user!==c.id.client||d.type!=="added")&&(l(),s.set("ychange",n?n("added",c.id):{type:"added"})):d!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case wi:case gs:{l();const d={insert:c.content.getContent()[0]};if(s.size>0){const f={};d.attributes=f,s.forEach((h,m)=>{f[m]=h})}i.push(d);break}case Jt:ho(c,e)&&(l(),mo(s,c.content));break}c=c.right}l()};return e||r?kt(o,d=>{e&&ff(d,e),r&&ff(d,r),u()},"cleanup"):u(),i}insert(e,r,n){if(r.length<=0)return;const i=this.doc;i!==null?kt(i,s=>{const o=Xc(s,this,e,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),xf(s,this,o,r,n)}):this._pending.push(()=>this.insert(e,r,n))}insertEmbed(e,r,n){const i=this.doc;i!==null?kt(i,s=>{const o=Xc(s,this,e,!n);xf(s,this,o,r,n||{})}):this._pending.push(()=>this.insertEmbed(e,r,n||{}))}delete(e,r){if(r===0)return;const n=this.doc;n!==null?kt(n,i=>{Uy(i,Xc(i,this,e,!0),r)}):this._pending.push(()=>this.delete(e,r))}format(e,r,n){if(r===0)return;const i=this.doc;i!==null?kt(i,s=>{const o=Xc(s,this,e,!1);o.right!==null&&Ly(s,this,o,r,n)}):this._pending.push(()=>this.format(e,r,n))}removeAttribute(e){this.doc!==null?kt(this.doc,r=>{Yc(r,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,r){this.doc!==null?kt(this.doc,n=>{wf(n,this,e,r)}):this._pending.push(()=>this.setAttribute(e,r))}getAttribute(e){return kf(this,e)}getAttributes(){return Sy(this)}_write(e){e.writeTypeRef(oN)}}const jI=t=>new bi;class Ef{constructor(e,r=()=>!0){this._filter=r,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??xr()}[Symbol.iterator](){return this}next(){let e=this._currentNode,r=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(r)))do if(r=e.content.type,!e.deleted&&(r.constructor===go||r.constructor===ms)&&r._start!==null)e=r._start;else for(;e!==null;){const n=e.next;if(n!==null){e=n;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class ms extends br{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,r){super._integrate(e,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ms}clone(){const e=new ms;return e.insert(0,this.toArray().map(r=>r instanceof br?r.clone():r)),e}get length(){return this.doc??xr(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ef(this,e)}querySelector(e){e=e.toUpperCase();const n=new Ef(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return n.done?null:n.value}querySelectorAll(e){return e=e.toUpperCase(),hs(new Ef(this,r=>r.nodeName&&r.nodeName.toUpperCase()===e))}_callObserver(e,r){Kc(this,e,new HI(this,r,e))}toString(){return vy(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,r={},n){const i=e.createDocumentFragment();return n!==void 0&&n._createAssociation(i,this),ma(this,s=>{i.insertBefore(s.toDOM(e,r,n),null)}),i}insert(e,r){this.doc!==null?kt(this.doc,n=>{Ay(n,this,e,r)}):this._prelimContent.splice(e,0,...r)}insertAfter(e,r){if(this.doc!==null)kt(this.doc,n=>{const i=e&&e instanceof br?e._item:e;qc(n,this,i,r)});else{const n=this._prelimContent,i=e===null?0:n.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw ji("Reference item not found");n.splice(i,0,...r)}}delete(e,r=1){this.doc!==null?kt(this.doc,n=>{Ty(n,this,e,r)}):this._prelimContent.splice(e,r)}toArray(){return ky(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return xy(this,e)}slice(e=0,r=this.length){return wy(this,e,r)}forEach(e){ma(this,e)}_write(e){e.writeTypeRef(cN)}}const zI=t=>new ms;class go extends ms{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,r){super._integrate(e,r),this._prelimAttrs.forEach((n,i)=>{this.setAttribute(i,n)}),this._prelimAttrs=null}_copy(){return new go(this.nodeName)}clone(){const e=new go(this.nodeName),r=this.getAttributes();return RO(r,(n,i)=>{typeof n=="string"&&e.setAttribute(i,n)}),e.insert(0,this.toArray().map(n=>n instanceof br?n.clone():n)),e}toString(){const e=this.getAttributes(),r=[],n=[];for(const a in e)n.push(a);n.sort();const i=n.length;for(let a=0;a<i;a++){const c=n[a];r.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=r.length>0?" "+r.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?kt(this.doc,r=>{Yc(r,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,r){this.doc!==null?kt(this.doc,n=>{wf(n,this,e,r)}):this._prelimAttrs.set(e,r)}getAttribute(e){return kf(this,e)}hasAttribute(e){return Ry(this,e)}getAttributes(e){return e?CI(this,e):Sy(this)}toDOM(e=document,r={},n){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return ma(this,o=>{i.appendChild(o.toDOM(e,r,n))}),n!==void 0&&n._createAssociation(i,this),i}_write(e){e.writeTypeRef(aN),e.writeKey(this.nodeName)}}const WI=t=>new go(t.readKey());class HI extends Hc{constructor(e,r,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Zc extends po{constructor(e){super(),this.hookName=e}_copy(){return new Zc(this.hookName)}clone(){const e=new Zc(this.hookName);return this.forEach((r,n)=>{e.set(n,r)}),e}toDOM(e=document,r={},n){const i=r[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(lN),e.writeKey(this.hookName)}}const GI=t=>new Zc(t.readKey());class Jc extends bi{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Jc}clone(){const e=new Jc;return e.applyDelta(this.toDelta()),e}toDOM(e=document,r,n){const i=e.createTextNode(this.toString());return n!==void 0&&n._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const r=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),r.push({nodeName:i,attrs:s})}r.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let n="";for(let i=0;i<r.length;i++){const s=r[i];n+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=e.insert;for(let i=r.length-1;i>=0;i--)n+=`</${r[i].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(uN)}}const KI=t=>new Jc;class Af{constructor(e,r){this.id=e,this.length=r}get deleted(){throw qn()}mergeWith(e){return!1}write(e,r,n){throw qn()}integrate(e,r){throw qn()}}const qI=0;class pn extends Af{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,r){r>0&&(this.id.clock+=r,this.length-=r),uy(e.doc.store,this)}write(e,r){e.writeInfo(qI),e.writeLen(this.length-r)}getMissing(e,r){return null}}class ga{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ga(this.content)}splice(e){throw qn()}mergeWith(e){return!1}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeBuf(this.content)}getRef(){return 3}}const YI=t=>new ga(t.readBuf());class ya{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ya(this.len)}splice(e){const r=new ya(this.len-e);return this.len=e,r}mergeWith(e){return this.len+=e.len,!0}integrate(e,r){Dc(e.deleteSet,r.id.client,r.id.clock,this.len),r.markDeleted()}delete(e){}gc(e){}write(e,r){e.writeLen(this.len-r)}getRef(){return 1}}const VI=t=>new ya(t.readLen()),$y=(t,e)=>new co({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class _a{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const r={};this.opts=r,e.gc||(r.gc=!1),e.autoLoad&&(r.autoLoad=!0),e.meta!==null&&(r.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new _a($y(this.doc.guid,this.opts))}splice(e){throw qn()}mergeWith(e){return!1}integrate(e,r){this.doc._item=r,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,r){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const XI=t=>new _a($y(t.readString(),t.readAny()));class gs{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new gs(this.embed)}splice(e){throw qn()}mergeWith(e){return!1}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeJSON(this.embed)}getRef(){return 5}}const ZI=t=>new gs(t.readJSON());class Jt{constructor(e,r){this.key=e,this.value=r}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Jt(this.key,this.value)}splice(e){throw qn()}mergeWith(e){return!1}integrate(e,r){const n=r.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,r){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const JI=t=>new Jt(t.readKey(),t.readJSON());class Qc{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Qc(this.arr)}splice(e){const r=new Qc(this.arr.slice(e));return this.arr=this.arr.slice(0,e),r}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){const n=this.arr.length;e.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const QI=t=>{const e=t.readLen(),r=[];for(let n=0;n<e;n++){const i=t.readString();i==="undefined"?r.push(void 0):r.push(JSON.parse(i))}return new Qc(r)},eN=Bc("node_env")==="development";class ys{constructor(e){this.arr=e,eN&&jg(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ys(this.arr)}splice(e){const r=new ys(this.arr.slice(e));return this.arr=this.arr.slice(0,e),r}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){const n=this.arr.length;e.writeLen(n-r);for(let i=r;i<n;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const tN=t=>{const e=t.readLen(),r=[];for(let n=0;n<e;n++)r.push(t.readAny());return new ys(r)};class Jn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Jn(this.str)}splice(e){const r=new Jn(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"�",r.str="�"+r.str.slice(1)),r}mergeWith(e){return this.str+=e.str,!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeString(r===0?this.str:this.str.slice(r))}getRef(){return 4}}const rN=t=>new Jn(t.readString()),nN=[MI,$I,jI,WI,zI,GI,KI],iN=0,sN=1,oN=2,aN=3,cN=4,lN=5,uN=6;class wi{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new wi(this.type._copy())}splice(e){throw qn()}mergeWith(e){return!1}integrate(e,r){this.type._integrate(e.doc,r)}delete(e){let r=this.type._start;for(;r!==null;)r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e),r=r.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e)}),e.changed.delete(this.type)}gc(e){let r=this.type._start;for(;r!==null;)r.gc(e,!0),r=r.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(e,!0),n=n.left}),this.type._map=new Map}write(e,r){this.type._write(e)}getRef(){return 7}}const hN=t=>new wi(nN[t.readTypeRef()](t)),el=(t,e,r)=>{const{client:n,clock:i}=e.id,s=new Qt(ot(n,i+r),e,ot(n,i+r-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(r));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=ot(e.redone.client,e.redone.clock+r)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=r,s};class Qt extends Af{constructor(e,r,n,i,s,o,a,c){super(e,c.getLength()),this.origin=n,this.left=r,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Eg:0}set marker(e){(this.info&Gh)>0!==e&&(this.info^=Gh)}get marker(){return(this.info&Gh)>0}get keep(){return(this.info&xg)>0}set keep(e){this.keep!==e&&(this.info^=xg)}get countable(){return(this.info&Eg)>0}get deleted(){return(this.info&Hh)>0}set deleted(e){this.deleted!==e&&(this.info^=Hh)}markDeleted(){this.info|=Hh}getMissing(e,r){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=or(r,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=or(r,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===uo&&this.id.client!==this.parent.client&&this.parent.clock>=or(r,this.parent.client))return this.parent.client;if(this.origin&&(this.left=hy(e,r,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=zi(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===pn||this.right&&this.right.constructor===pn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Qt?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Qt&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===uo){const n=pf(r,this.parent);n.constructor===pn?this.parent=null:this.parent=n.content.type}return null}integrate(e,r){if(r>0&&(this.id.clock+=r,this.left=hy(e,e.doc.store,ot(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(r),this.length-=r),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,i;if(n!==null)i=n.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),jc(this.origin,i.origin)){if(i.id.client<this.id.client)n=i,s.clear();else if(jc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(pf(e.doc.store,i.origin)))s.has(pf(e.doc.store,i.origin))||(n=i,s.clear());else break;i=i.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),uy(e.doc.store,this),this.content.integrate(e,this),py(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new pn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:ot(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&jc(e.origin,this.lastId)&&this.right===e&&jc(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const r=this.parent._searchMarker;return r&&r.forEach(n=>{n.p===e&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const r=this.parent;this.countable&&this.parentSub===null&&(r._length-=this.length),this.markDeleted(),Dc(e.deleteSet,this.id.client,this.id.clock,this.length),py(e,r,this.parentSub),this.content.delete(e)}}gc(e,r){if(!this.deleted)throw Yn();this.content.gc(e),r?gI(e,this,new pn(this.id,this.length)):this.content=new ya(this.length)}write(e,r){const n=r>0?ot(this.id.client,this.id.clock+r-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Cc|(n===null?0:Jr)|(i===null?0:gi)|(s===null?0:sa);if(e.writeInfo(o),n!==null&&e.writeLeftID(n),i!==null&&e.writeRightID(i),n===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=mI(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===uo?(e.writeParentInfo(!1),e.writeLeftID(a)):Yn();s!==null&&e.writeString(s)}this.content.write(e,r)}}const Py=(t,e)=>fN[e&Cc](t),fN=[()=>{Yn()},VI,QI,YI,rN,ZI,JI,hN,tN,XI,()=>{Yn()}],dN=10;class mn extends Af{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,r){Yn()}write(e,r){e.writeInfo(dN),ht(e.restEncoder,this.length-r)}getMissing(e,r){return null}}const Fy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof eo<"u"?eo:{},By="__ $YJS$ __";Fy[By]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Fy[By]=!0;let Dy=!1;const tn=new co;function jy(t,e,r){const n=tn.getMap();if(!n.has(t))switch(e){case 0:case 1:n.set(t,r);break}}function pN(t,e){jy(t,0,e)}function Tf(t,e){const r=new bi(e);jy(t,1,r)}function mN(t,e){tn.getMap().set(t,e)}function gN(t,e){const r=tn.getMap(),n=new bi(e);r.set(t,n)}function zy(t,e){const r=tn.getMap();function n(i){const s=r.get(t);for(let o=0;o<i.length;++o)(i[o].target===r||i[o].target===s)&&e(s)}return r.has(t)&&e(r.get(t)),r.observeDeep(n),()=>{r.observeDeep(n)}}function yN(t,e){return zy(t,r=>{Te(r)&&e(r)})}function Wy(t,e){return zy(t,r=>{r instanceof bi&&e(r.toJSON())})}const _s=Js("modem",["second"],t=>{if(_s.session(t))switch(t.target){case"second":!Dy&&t.data%2===0&&_s.emit(t.player,"modem:join");break;case"join":t.sender!==_s.id()&&_s.reply(t,"joinack",yg(fI(tn)));break;case"joinack":t.sender!==_s.id()&&(Dy=!0,ny(tn,Oc(t.data),tn));break;case"sync":{t.sender!==_s.id()&&w(t.data)&&ny(tn,Oc(t.data),tn);break}}});function Hy(t,e){e!==tn&&_s.emit("","modem:sync",yg(t))}tn.on("update",Hy),tn.on("destroy",()=>{tn.off("update",Hy)});function Gy(t,e){return t%e}function Ky(t,e){return Math.floor(t/e)}function _N(t,e){return{x:Gy(t,e),y:Ky(t,e)}}function qy(t,e){const r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function rn(t,e){return t.x+t.y*e}function yo(t,e){return`${t.x},${t.y},${e.x},${e.y}`}function Sf(t,e,r,n,i,s){return t>=s&&t<=n&&e>=r&&e<=i}function Yy(t,e,r,n){const i=[],s=Math.min(t,r),o=Math.max(t,r),a=Math.min(e,n),c=Math.max(e,n);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function Vy(t,e,r,n){const i=[],s=Math.abs(r-t),o=Math.abs(n-e),a=t<r?1:-1,c=e<n?1:-1;let l=s-o;for(i.push({x:t,y:e});t!==r||e!==n;){const u=2*l;u>-o&&(l-=o,t+=a),u<s&&(l+=s,e+=c),i.push({x:t,y:e})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Xy="176",bN="",In="srgb",Zy="srgb-linear",Jy="linear",Rf="srgb";function Nn(t,e,r){return Math.max(e,Math.min(r,t))}function wN(t,e){return(t%e+e)%e}function Of(t,e,r){return(1-r)*t+r*e}class ba{constructor(e=0,r=0){ba.prototype.isVector2=!0,this.x=e,this.y=r}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,r){return this.x=e,this.y=r,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,r){switch(e){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this}addScaledVector(e,r){return this.x+=e.x*r,this.y+=e.y*r,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const r=this.x,n=this.y,i=e.elements;return this.x=i[0]*r+i[3]*n+i[6],this.y=i[1]*r+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,r){return this.x=Nn(this.x,e.x,r.x),this.y=Nn(this.y,e.y,r.y),this}clampScalar(e,r){return this.x=Nn(this.x,e,r),this.y=Nn(this.y,e,r),this}clampLength(e,r){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Nn(n,e,r))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const r=Math.sqrt(this.lengthSq()*e.lengthSq());if(r===0)return Math.PI/2;const n=this.dot(e)/r;return Math.acos(Nn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const r=this.x-e.x,n=this.y-e.y;return r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,r){return this.x+=(e.x-this.x)*r,this.y+=(e.y-this.y)*r,this}lerpVectors(e,r,n){return this.x=e.x+(r.x-e.x)*n,this.y=e.y+(r.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,r=0){return this.x=e[r],this.y=e[r+1],this}toArray(e=[],r=0){return e[r]=this.x,e[r+1]=this.y,e}fromBufferAttribute(e,r){return this.x=e.getX(r),this.y=e.getY(r),this}rotateAround(e,r){const n=Math.cos(r),i=Math.sin(r),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*i+e.x,this.y=s*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class wa{constructor(e,r,n,i,s,o,a,c,l){wa.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,r,n,i,s,o,a,c,l)}set(e,r,n,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=r,u[4]=s,u[5]=c,u[6]=n,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const r=this.elements,n=e.elements;return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],this}extractBasis(e,r,n){return e.setFromMatrix3Column(this,0),r.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const r=e.elements;return this.set(r[0],r[4],r[8],r[1],r[5],r[9],r[2],r[6],r[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,r){const n=e.elements,i=r.elements,s=this.elements,o=n[0],a=n[3],c=n[6],l=n[1],u=n[4],d=n[7],f=n[2],h=n[5],m=n[8],p=i[0],g=i[3],y=i[6],b=i[1],A=i[4],R=i[7],E=i[2],M=i[5],S=i[8];return s[0]=o*p+a*b+c*E,s[3]=o*g+a*A+c*M,s[6]=o*y+a*R+c*S,s[1]=l*p+u*b+d*E,s[4]=l*g+u*A+d*M,s[7]=l*y+u*R+d*S,s[2]=f*p+h*b+m*E,s[5]=f*g+h*A+m*M,s[8]=f*y+h*R+m*S,this}multiplyScalar(e){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=e,r[4]*=e,r[7]*=e,r[2]*=e,r[5]*=e,r[8]*=e,this}determinant(){const e=this.elements,r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return r*o*u-r*a*l-n*s*u+n*a*c+i*s*l-i*o*c}invert(){const e=this.elements,r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,f=a*c-u*s,h=l*s-o*c,m=r*d+n*f+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=d*p,e[1]=(i*l-u*n)*p,e[2]=(a*n-i*o)*p,e[3]=f*p,e[4]=(u*r-i*c)*p,e[5]=(i*s-a*r)*p,e[6]=h*p,e[7]=(n*c-l*r)*p,e[8]=(o*r-n*s)*p,this}transpose(){let e;const r=this.elements;return e=r[1],r[1]=r[3],r[3]=e,e=r[2],r[2]=r[6],r[6]=e,e=r[5],r[5]=r[7],r[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const r=this.elements;return e[0]=r[0],e[1]=r[3],e[2]=r[6],e[3]=r[1],e[4]=r[4],e[5]=r[7],e[6]=r[2],e[7]=r[5],e[8]=r[8],this}setUvTransform(e,r,n,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(n*c,n*l,-n*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+r,0,0,1),this}scale(e,r){return this.premultiply(If.makeScale(e,r)),this}rotate(e){return this.premultiply(If.makeRotation(-e)),this}translate(e,r){return this.premultiply(If.makeTranslation(e,r)),this}makeTranslation(e,r){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,r,0,0,1),this}makeRotation(e){const r=Math.cos(e),n=Math.sin(e);return this.set(r,-n,0,n,r,0,0,0,1),this}makeScale(e,r){return this.set(e,0,0,0,r,0,0,0,1),this}equals(e){const r=this.elements,n=e.elements;for(let i=0;i<9;i++)if(r[i]!==n[i])return!1;return!0}fromArray(e,r=0){for(let n=0;n<9;n++)this.elements[n]=e[n+r];return this}toArray(e=[],r=0){const n=this.elements;return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],e[r+4]=n[4],e[r+5]=n[5],e[r+6]=n[6],e[r+7]=n[7],e[r+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const If=new wa,Qy=new wa().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),e_=new wa().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function kN(){const t={enabled:!0,workingColorSpace:Zy,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Rf&&(i.r=_o(i.r),i.g=_o(i.g),i.b=_o(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Rf&&(i.r=bo(i.r),i.g=bo(i.g),i.b=bo(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===bN?Jy:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],r=[.2126,.7152,.0722],n=[.3127,.329];return t.define({[Zy]:{primaries:e,whitePoint:n,transfer:Jy,toXYZ:Qy,fromXYZ:e_,luminanceCoefficients:r,workingColorSpaceConfig:{unpackColorSpace:In},outputColorSpaceConfig:{drawingBufferColorSpace:In}},[In]:{primaries:e,whitePoint:n,transfer:Rf,toXYZ:Qy,fromXYZ:e_,luminanceCoefficients:r,outputColorSpaceConfig:{drawingBufferColorSpace:In}}}),t}const Cn=kN();function _o(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function bo(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const t_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gi={h:0,s:0,l:0},tl={h:0,s:0,l:0};function Nf(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*6*(2/3-r):t}class Cf{constructor(e,r,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,r,n)}set(e,r,n){if(r===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,r,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,r=In){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Cn.toWorkingColorSpace(this,r),this}setRGB(e,r,n,i=Cn.workingColorSpace){return this.r=e,this.g=r,this.b=n,Cn.toWorkingColorSpace(this,i),this}setHSL(e,r,n,i=Cn.workingColorSpace){if(e=wN(e,1),r=Nn(r,0,1),n=Nn(n,0,1),r===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+r):n+r-n*r,o=2*n-s;this.r=Nf(o,s,e+1/3),this.g=Nf(o,s,e),this.b=Nf(o,s,e-1/3)}return Cn.toWorkingColorSpace(this,i),this}setStyle(e,r=In){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,r);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,r);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,r);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,r);if(o===6)return this.setHex(parseInt(s,16),r);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,r);return this}setColorName(e,r=In){const n=t_[e.toLowerCase()];return n!==void 0?this.setHex(n,r):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=_o(e.r),this.g=_o(e.g),this.b=_o(e.b),this}copyLinearToSRGB(e){return this.r=bo(e.r),this.g=bo(e.g),this.b=bo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=In){return Cn.fromWorkingColorSpace(Er.copy(this),e),Math.round(Nn(Er.r*255,0,255))*65536+Math.round(Nn(Er.g*255,0,255))*256+Math.round(Nn(Er.b*255,0,255))}getHexString(e=In){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,r=Cn.workingColorSpace){Cn.fromWorkingColorSpace(Er.copy(this),r);const n=Er.r,i=Er.g,s=Er.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const d=o-a;switch(l=u<=.5?d/(o+a):d/(2-o-a),o){case n:c=(i-s)/d+(i<s?6:0);break;case i:c=(s-n)/d+2;break;case s:c=(n-i)/d+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,r=Cn.workingColorSpace){return Cn.fromWorkingColorSpace(Er.copy(this),r),e.r=Er.r,e.g=Er.g,e.b=Er.b,e}getStyle(e=In){Cn.fromWorkingColorSpace(Er.copy(this),e);const r=Er.r,n=Er.g,i=Er.b;return e!==In?`color(${e} ${r.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(r*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,r,n){return this.getHSL(Gi),this.setHSL(Gi.h+e,Gi.s+r,Gi.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,r){return this.r=e.r+r.r,this.g=e.g+r.g,this.b=e.b+r.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,r){return this.r+=(e.r-this.r)*r,this.g+=(e.g-this.g)*r,this.b+=(e.b-this.b)*r,this}lerpColors(e,r,n){return this.r=e.r+(r.r-e.r)*n,this.g=e.g+(r.g-e.g)*n,this.b=e.b+(r.b-e.b)*n,this}lerpHSL(e,r){this.getHSL(Gi),e.getHSL(tl);const n=Of(Gi.h,tl.h,r),i=Of(Gi.s,tl.s,r),s=Of(Gi.l,tl.l,r);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const r=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*r+s[3]*n+s[6]*i,this.g=s[1]*r+s[4]*n+s[7]*i,this.b=s[2]*r+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,r=0){return this.r=e[r],this.g=e[r+1],this.b=e[r+2],this}toArray(e=[],r=0){return e[r]=this.r,e[r+1]=this.g,e[r+2]=this.b,e}fromBufferAttribute(e,r){return this.r=e.getX(r),this.g=e.getY(r),this.b=e.getZ(r),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Er=new Cf;Cf.NAMES=t_,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Xy}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Xy),new ba,new ba;function jt(t,e,r){return Math.max(e,Math.min(r,t))}function r_(t){return t/180*Math.PI}function n_(t){return t*180/Math.PI}const vN=Lm("089fad0j9awfem09wavefc09uwaef");function xN(){return vN()}function EN(t){return Lm(t)()}function nn(t,e){const r=Math.min(t,e),i=Math.max(t,e)-r+1;return r+Math.floor(xN()*i)}function i_(t,e,r){const n=Math.min(e,r),s=Math.max(e,r)-n+1;return n+Math.floor(EN(t)*s)}function s_(t,e,r){typeof r!="number"&&(r=1);const n=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=r)n.push(o);return n}function AN(t){return t[nn(0,t.length-1)]}function TN(t,e){return e[i_(t,0,e.length-1)]}function gn(...t){return AN(t.flat())}function SN(t,...e){return TN(t,e.flat())}function RN(t){return[...new Set(t)].filter(w)}function bs(t){return w(t)&&w(t.x)&&w(t.y)}function Mt(t,e){switch(e){case ve.NORTH:--t.y;break;case ve.SOUTH:++t.y;break;case ve.WEST:--t.x;break;case ve.EAST:++t.x;break}return t}function Lf(t,e){return t<0?ve.WEST:t>0?ve.EAST:e<0?ve.NORTH:e>0?ve.SOUTH:ve.IDLE}function Ln(t,e){return Lf(e.x-t.x,e.y-t.y)}const Mf={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER",within:"WITHIN",awayby:"AWAYBY"};function sn(t){return ut(t)&&o_(t[0])}function o_(t){return w(ve[t])&&ye(t)}function a_(t){const e=ve[t];return w(e)?e:ve.IDLE}function rl(t){if(ye(t))return Mf[Fe(t)]}function ON(t){if(sn(t))return t;if(o_(t))return[t];const e=rl(t);if(w(e))return[e]}function c_(t){const e=x.words[t],r=ON(e);return sn(r)?[r,t+1]:[void 0,t]}function l_(t){const e=[];let[r,n]=c_(t);for(;sn(r);){switch(e.push(...r),r[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[a,c,l]=ue(x.words,n,[Z.NUMBER,Z.NUMBER]);e.push(a,c),n=l;break}case"FLEE":case"FIND":{const[a,c]=ue(x.words,n,[Z.KIND]);console.info("kind",a),n=c;break}case"TO":{const[a,c,l]=ue(x.words,n,[Z.DIR,Z.DIR]),u=x.element?.x??0,d=x.element?.y??0;a.destpt.x-=u,a.destpt.y-=d,c.destpt.x-=u,c.destpt.y-=d,e.push(u+a.destpt.x+c.destpt.x,d+a.destpt.y+c.destpt.y),n=l;break}case"WITHIN":case"AWAYBY":{const[a,c]=ue(x.words,n,[Z.NUMBER]);e.push(a),n=c;break}}const i=n;switch(r[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":case"WITHIN":case"AWAYBY":break;default:return[e,n]}const[s,o]=c_(i);r=s,n=o}return e.length?[e,n]:[void 0,t]}function IN(t){return w(t)&&t<it.ONBLACK?t:void 0}function Uf(t){return w(t)&&t>it.WHITE&&t<it.ONCLEAR?t-it.ONBLACK:void 0}const ka={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Rr(t){return ut(t)&&u_(t[0])}function NN(t){return Rr(t)&&t[0].startsWith("ON")}function u_(t){return w(it[t])&&ye(t)}function va(t){if(ye(t))return ka[Fe(t)]}function wo(t,e){return[w(t)?`${it[t]}`:void 0,w(e)?`ON${it[e]}`:void 0].filter(w)}function nl(t){return t.map(e=>it[e]).find(e=>w(e)&&e<it.ONBLACK)}function il(t){return t.map(e=>it[e]).find(e=>w(e)&&e>=it.ONBLACK)}function CN(t){if(Rr(t))return t;if(u_(t))return[t];const e=va(t);if(w(e))return[e]}function h_(t){const e=x.words[t],r=CN(e);return Rr(r)?[r,t+1]:[void 0,t]}function sl(t){const e=[];let r=t;const n=parseFloat(x.words[t]);if(Te(n))return[wo(n,void 0),t+1];const[i,s]=h_(t);Rr(i)&&(e.push(...i),r=s);const[o,a]=h_(s);return NN(o)&&(e.push(...o),r=a),e.length?[e,r]:[void 0,t]}function f_(t){const e={};for(let r=0;r<t.length;++r){const n=t[r],i=it[n];w(i)&&(i<it.ONBLACK?e.color=i:e.bg=Uf(i))}return e}var ol={exports:{}},al={exports:{}},LN=al.exports,d_;function MN(){return d_||(d_=1,(function(t,e){(function(r,n){t.exports=n()})(LN,function(){function r(p){return!isNaN(parseFloat(p))&&isFinite(p)}function n(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function d(p){if(p)for(var g=0;g<u.length;g++)p[u[g]]!==void 0&&this["set"+n(u[g])](p[u[g]])}d.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof d)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new d(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",g=this.getLineNumber()||"",y=this.getColumnNumber()||"",b=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+g+":"+y+")":"[eval]:"+g+":"+y:b?b+" ("+p+":"+g+":"+y+")":p+":"+g+":"+y}},d.fromString=function(g){var y=g.indexOf("("),b=g.lastIndexOf(")"),A=g.substring(0,y),R=g.substring(y+1,b).split(","),E=g.substring(b+1);if(E.indexOf("@")===0)var M=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(E,""),S=M[1],P=M[2],W=M[3];return new d({functionName:A,args:R||void 0,fileName:S,lineNumber:P||void 0,columnNumber:W||void 0})};for(var f=0;f<s.length;f++)d.prototype["get"+n(s[f])]=i(s[f]),d.prototype["set"+n(s[f])]=(function(p){return function(g){this[p]=!!g}})(s[f]);for(var h=0;h<o.length;h++)d.prototype["get"+n(o[h])]=i(o[h]),d.prototype["set"+n(o[h])]=(function(p){return function(g){if(!r(g))throw new TypeError(p+" must be a Number");this[p]=Number(g)}})(o[h]);for(var m=0;m<a.length;m++)d.prototype["get"+n(a[m])]=i(a[m]),d.prototype["set"+n(a[m])]=(function(p){return function(g){this[p]=String(g)}})(a[m]);return d})})(al)),al.exports}var UN=ol.exports,p_;function $N(){return p_||(p_=1,(function(t,e){(function(r,n){t.exports=n(MN())})(UN,function(n){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var d=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=d.match(/ (\(.+\)$)/);d=f?d.replace(f[0],""):d;var h=this.extractLocation(f?f[1]:d),m=f&&d||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new n({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new n({functionName:u});var d=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=u.match(d),h=f&&f[1]?f[1]:void 0,m=this.extractLocation(u.replace(d,""));return new n({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),d=[],f=2,h=u.length;f<h;f+=2){var m=l.exec(u[f]);m&&d.push(new n({fileName:m[2],lineNumber:m[1],source:u[f]}))}return d},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),d=[],f=0,h=u.length;f<h;f+=2){var m=l.exec(u[f]);m&&d.push(new n({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[f]}))}return d},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var d=u.split("@"),f=this.extractLocation(d.pop()),h=d.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var g=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new n({functionName:m,args:g,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:u})},this)}}})})(ol)),ol.exports}var PN=$N(),FN=Xs(PN);const Ue=60,rt=25,$f=Ue*rt;var Re=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Re||{});const Pf=14,cl=3,ws=8,ks=14,ll=16,BN=16,DN=16;var ul=(t=>(t[t.FAR=1]="FAR",t[t.MID=1.5]="MID",t[t.NEAR=3]="NEAR",t))(ul||{});function xa(t,e){return new Array(t).fill(e)}function jN(t,e,r,n,i,s=0){const o=n*i;return{id:`tiles:${t}:${e}`,type:1,tag:r,width:n,height:i,char:xa(o,0),color:xa(o,0),bg:xa(o,s),wall:xa(o,0)}}function zN(t,e,r,n=1,i=15){return{id:`sprites:${t}:${e}:${r}`,x:0,y:0,char:n,color:i,bg:it.ONCLEAR}}function WN(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function HN(t,e,r,n,i=0){const s=r*n;return{id:`dither:${t}:${e}`,type:3,width:r,height:n,alphas:xa(s,i)}}function GN(t,e,r,n){return{id:`media:${t}:${e}`,type:4,mime:r,media:n}}function KN(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:1.5,graphics:"flat",facing:0}}function m_(t,e){return`${t}:${e}`}const qN=1,YN=16,VN=256;var Or=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Or||{});const Qn=!!JSON.parse("false"),XN=!!JSON.parse("false");JSON.parse("false");const g_=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const vs={HALT_AT_COUNT:256},le=Js("SOFTWARE");function ki(t){const e={},r={everytick(){},aftertick(){},listcommands(){return Fr(e)},...t,getcommand(n){return e[n]},command(n,i){return e[n]=i,r}};return r}function jr(t,e,r,n){const[i,s]=ue(n,0,[Z.NUMBER_OR_STRING,Z.MAYBE_NUMBER_OR_STRING]);tg(le,t,e,r,i,s)}const ZN=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function Ff(t,e,r){const[n,i]=ue(r,0,[Z.NUMBER_OR_STRING]);if(Te(n))Ch(le,t,e,"volume",n);else if(ZN.includes(Fe(n))){const[s,o]=ue(r,i,[Z.NUMBER_OR_STRING,Z.MAYBE_NUMBER_OR_STRING]);tg(le,t,e,n,s,o)}else{const[s]=ue(r,i,[Z.MAYBE_NUMBER_OR_STRING]);if(Te(s)){const o=r.length-i,a=new Array(o).fill(Z.NUMBER),c=ue(r,i,a).slice(0,o),l=c.length===1?c[0]:c;Ch(le,t,e,n,l)}else{const[o]=ue(r,i,[Z.MAYBE_NUMBER_OR_STRING]);Ch(le,t,e,n,o)}}}function Ki(t,e){const[r]=ue(t,0,[Z.MAYBE_NAME]);lR(le,x.elementfocus,x.board?.id??"",r??"",e)}const hl=ki().command("tts",(t,e)=>{const[r,n]=ue(e,0,[Z.STRING,Z.STRING]);return oR(le,x.elementfocus,r,n),0}).command("ttsqueue",(t,e)=>{const[r,n]=ue(e,0,[Z.STRING,Z.STRING]);return aR(le,x.elementfocus,r,n),0}).command("bpm",(t,e)=>{const[r]=ue(e,0,[Z.NUMBER]);return uR(le,x.elementfocus,r),0}).command("vol",(t,e)=>{const[r]=ue(e,0,[Z.NUMBER]);return hR(le,x.elementfocus,r),0}).command("bgvol",(t,e)=>{const[r]=ue(e,0,[Z.NUMBER]);return fR(le,x.elementfocus,r),0}).command("ttsvol",(t,e)=>{const[r]=ue(e,0,[Z.NUMBER]);return dR(le,x.elementfocus,r),0}).command("play",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return cR(le,x.elementfocus,x.board?.id??"",r??""),0}).command("bgplay",(t,e)=>(Ki(e,""),0)).command("bgplayon64n",(t,e)=>(Ki(e,"@64n"),0)).command("bgplayon32n",(t,e)=>(Ki(e,"@32n"),0)).command("bgplayon16n",(t,e)=>(Ki(e,"@16n"),0)).command("bgplayon8n",(t,e)=>(Ki(e,"@8n"),0)).command("bgplayon4n",(t,e)=>(Ki(e,"@4n"),0)).command("bgplayon2n",(t,e)=>(Ki(e,"@2n"),0)).command("bgplayon1n",(t,e)=>(Ki(e,"@1m"),0)).command("synth",(t,e)=>{for(let r=0;r<4;++r)Ff(x.elementfocus,r,e);return 0}).command("synthrecord",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_STRING]);return pR(le,x.elementfocus,r??""),0}).command("synthflush",()=>(mR(le,x.elementfocus),0)).command("echo",(t,e)=>{for(let r=0;r<2;++r)jr(x.elementfocus,r,"echo",e);return 0}).command("fcrush",(t,e)=>{for(let r=0;r<2;++r)jr(x.elementfocus,r,"fc",e);return 0}).command("phaser",(t,e)=>{for(let r=0;r<2;++r)jr(x.elementfocus,r,"phaser",e);return 0}).command("reverb",(t,e)=>{for(let r=0;r<2;++r)jr(x.elementfocus,r,"reverb",e);return 0}).command("distort",(t,e)=>{for(let r=0;r<2;++r)jr(x.elementfocus,r,"distort",e);return 0}).command("vibrato",(t,e)=>{for(let r=0;r<2;++r)jr(x.elementfocus,r,"vibrato",e);return 0}).command("autowah",(t,e)=>{for(let r=0;r<2;++r)jr(x.elementfocus,r,"autowah",e);return 0});for(let t=0;t<4;++t)hl.command(`synth${t+1}`,(e,r)=>(Ff(x.elementfocus,t,r),0));hl.command("synth5",(t,e)=>{for(let r=4;r<8;++r)Ff(x.elementfocus,r,e);return 0});for(let t=0;t<3;++t){const e=t+1;hl.command(`echo${e}`,(r,n)=>(jr(x.elementfocus,t,"echo",n),0)).command(`fcrush${e}`,(r,n)=>(jr(x.elementfocus,t,"fcrush",n),0)).command(`phaser${e}`,(r,n)=>(jr(x.elementfocus,t,"phaser",n),0)).command(`reverb${e}`,(r,n)=>(jr(x.elementfocus,t,"reverb",n),0)).command(`distort${e}`,(r,n)=>(jr(x.elementfocus,t,"distort",n),0)).command(`vibrato${e}`,(r,n)=>(jr(x.elementfocus,t,"vibrato",n),0)).command(`autowah${e}`,(r,n)=>(jr(x.elementfocus,t,"autowah",n),0))}var Bf;try{Bf=new TextDecoder}catch{}var Ne,ei,te=0,vt={},at,qi,yn=0,ti=0,ar,vi,zr=[],st,y_={useRecords:!1,mapsAsObjects:!0};class __{}const b_=new __;b_.name="MessagePack 0xC1";var Yi=!1,w_=2,JN;try{new Function("")}catch{w_=1/0}class Ea{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,r){if(Ne)return M_(()=>(Hf(),this?this.unpack(e,r):Ea.prototype.unpack.call(y_,e,r)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Zt<"u"?Zt.from(e):new Uint8Array(e)),typeof r=="object"?(ei=r.end||e.length,te=r.start||0):(te=0,ei=r>-1?r:e.length),ti=0,qi=null,ar=null,Ne=e;try{st=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(n){throw Ne=null,e instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Ea){if(vt=this,this.structures)return at=this.structures,fl(r);(!at||at.length>0)&&(at=[])}else vt=y_,(!at||at.length>0)&&(at=[]);return fl(r)}unpackMultiple(e,r){let n,i=0;try{Yi=!0;let s=e.length,o=this?this.unpack(e,s):dl.unpack(e,s);if(r){if(r(o,i,te)===!1)return;for(;te<s;)if(i=te,r(fl(),i,te)===!1)return}else{for(n=[o];te<s;)i=te,n.push(fl());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{Yi=!1,Hf()}}_mergeStructures(e,r){e=e||[],Object.isFrozen(e)&&(e=e.map(n=>n.slice(0)));for(let n=0,i=e.length;n<i;n++){let s=e[n];s&&(s.isShared=!0,n>=32&&(s.highByte=n-32>>5))}e.sharedLength=e.length;for(let n in r||[])if(n>=0){let i=e[n],s=r[n];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[n]=i),e[n]=s)}return this.structures=e}decode(e,r){return this.unpack(e,r)}}function fl(t){try{if(!vt.trusted&&!Yi){let r=at.sharedLength||0;r<at.length&&(at.length=r)}let e;if(vt.randomAccessStructure&&Ne[te]<64&&Ne[te]>=32&&JN||(e=zt()),ar&&(te=ar.postBundlePosition,ar=null),Yi&&(at.restoreStructures=null),te==ei)at&&at.restoreStructures&&k_(),at=null,Ne=null,vi&&(vi=null);else{if(te>ei)throw new Error("Unexpected end of MessagePack data");if(!Yi){let r;try{r=JSON.stringify(e,(n,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(n){r="(JSON view not available "+n+")"}throw new Error("Data read, but end of buffer not reached "+r)}}return e}catch(e){throw at&&at.restoreStructures&&k_(),Hf(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||te>ei)&&(e.incomplete=!0),e}}function k_(){for(let t in at.restoreStructures)at[t]=at.restoreStructures[t];at.restoreStructures=null}function zt(){let t=Ne[te++];if(t<160)if(t<128){if(t<64)return t;{let e=at[t&63]||vt.getStructures&&x_()[t&63];return e?(e.read||(e.read=Df(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,vt.mapsAsObjects){let e={};for(let r=0;r<t;r++){let n=O_();n==="__proto__"&&(n="__proto_"),e[n]=zt()}return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(zt(),zt());return e}else{t-=144;let e=new Array(t);for(let r=0;r<t;r++)e[r]=zt();return vt.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(ti>=te)return qi.slice(te-yn,(te+=e)-yn);if(ti==0&&ei<140){let r=e<16?zf(e):T_(e);if(r!=null)return r}return jf(e)}else{let e;switch(t){case 192:return null;case 193:return ar?(e=zt(),e>0?ar[1].slice(ar.position1,ar.position1+=e):ar[0].slice(ar.position0,ar.position0-=e)):b_;case 194:return!1;case 195:return!0;case 196:if(e=Ne[te++],e===void 0)throw new Error("Unexpected end of buffer");return Wf(e);case 197:return e=st.getUint16(te),te+=2,Wf(e);case 198:return e=st.getUint32(te),te+=4,Wf(e);case 199:return xs(Ne[te++]);case 200:return e=st.getUint16(te),te+=2,xs(e);case 201:return e=st.getUint32(te),te+=4,xs(e);case 202:if(e=st.getFloat32(te),vt.useFloat32>2){let r=Gf[(Ne[te]&127)<<1|Ne[te+1]>>7];return te+=4,(r*e+(e>0?.5:-.5)>>0)/r}return te+=4,e;case 203:return e=st.getFloat64(te),te+=8,e;case 204:return Ne[te++];case 205:return e=st.getUint16(te),te+=2,e;case 206:return e=st.getUint32(te),te+=4,e;case 207:return vt.int64AsType==="number"?(e=st.getUint32(te)*4294967296,e+=st.getUint32(te+4)):vt.int64AsType==="string"?e=st.getBigUint64(te).toString():vt.int64AsType==="auto"?(e=st.getBigUint64(te),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=st.getBigUint64(te),te+=8,e;case 208:return st.getInt8(te++);case 209:return e=st.getInt16(te),te+=2,e;case 210:return e=st.getInt32(te),te+=4,e;case 211:return vt.int64AsType==="number"?(e=st.getInt32(te)*4294967296,e+=st.getUint32(te+4)):vt.int64AsType==="string"?e=st.getBigInt64(te).toString():vt.int64AsType==="auto"?(e=st.getBigInt64(te),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=st.getBigInt64(te),te+=8,e;case 212:if(e=Ne[te++],e==114)return N_(Ne[te++]&63);{let r=zr[e];if(r)return r.read?(te++,r.read(zt())):r.noBuffer?(te++,r()):r(Ne.subarray(te,++te));throw new Error("Unknown extension "+e)}case 213:return e=Ne[te],e==114?(te++,N_(Ne[te++]&63,Ne[te++])):xs(2);case 214:return xs(4);case 215:return xs(8);case 216:return xs(16);case 217:return e=Ne[te++],ti>=te?qi.slice(te-yn,(te+=e)-yn):eC(e);case 218:return e=st.getUint16(te),te+=2,ti>=te?qi.slice(te-yn,(te+=e)-yn):tC(e);case 219:return e=st.getUint32(te),te+=4,ti>=te?qi.slice(te-yn,(te+=e)-yn):rC(e);case 220:return e=st.getUint16(te),te+=2,E_(e);case 221:return e=st.getUint32(te),te+=4,E_(e);case 222:return e=st.getUint16(te),te+=2,A_(e);case 223:return e=st.getUint32(te),te+=4,A_(e);default:if(t>=224)return t-256;if(t===void 0){let r=new Error("Unexpected end of MessagePack data");throw r.incomplete=!0,r}throw new Error("Unknown MessagePack token "+t)}}}const QN=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Df(t,e){function r(){if(r.count++>w_){let i=t.read=new Function("r","return function(){return "+(vt.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":QN.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(zt);return t.highByte===0&&(t.read=v_(e,t.read)),i()}let n={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),n[o]=zt()}return vt.freezeData?Object.freeze(n):n}return r.count=0,t.highByte===0?v_(e,r):r}const v_=(t,e)=>function(){let r=Ne[te++];if(r===0)return e();let n=t<32?-(t+(r<<5)):t+(r<<5),i=at[n]||x_()[n];if(!i)throw new Error("Record id is not defined for "+n);return i.read||(i.read=Df(i,t)),i.read()};function x_(){let t=M_(()=>(Ne=null,vt.getStructures()));return at=vt._mergeStructures(t,at)}var jf=Aa,eC=Aa,tC=Aa,rC=Aa;function Aa(t){let e;if(t<16&&(e=zf(t)))return e;if(t>64&&Bf)return Bf.decode(Ne.subarray(te,te+=t));const r=te+t,n=[];for(e="";te<r;){const i=Ne[te++];if((i&128)===0)n.push(i);else if((i&224)===192){const s=Ne[te++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=Ne[te++]&63,o=Ne[te++]&63;n.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Ne[te++]&63,o=Ne[te++]&63,a=Ne[te++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c)}else n.push(i);n.length>=4096&&(e+=cr.apply(String,n),n.length=0)}return n.length>0&&(e+=cr.apply(String,n)),e}function E_(t){let e=new Array(t);for(let r=0;r<t;r++)e[r]=zt();return vt.freezeData?Object.freeze(e):e}function A_(t){if(vt.mapsAsObjects){let e={};for(let r=0;r<t;r++){let n=O_();n==="__proto__"&&(n="__proto_"),e[n]=zt()}return e}else{let e=new Map;for(let r=0;r<t;r++)e.set(zt(),zt());return e}}var cr=String.fromCharCode;function T_(t){let e=te,r=new Array(t);for(let n=0;n<t;n++){const i=Ne[te++];if((i&128)>0){te=e;return}r[n]=i}return cr.apply(String,r)}function zf(t){if(t<4)if(t<2){if(t===0)return"";{let e=Ne[te++];if((e&128)>1){te-=1;return}return cr(e)}}else{let e=Ne[te++],r=Ne[te++];if((e&128)>0||(r&128)>0){te-=2;return}if(t<3)return cr(e,r);let n=Ne[te++];if((n&128)>0){te-=3;return}return cr(e,r,n)}else{let e=Ne[te++],r=Ne[te++],n=Ne[te++],i=Ne[te++];if((e&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){te-=4;return}if(t<6){if(t===4)return cr(e,r,n,i);{let s=Ne[te++];if((s&128)>0){te-=5;return}return cr(e,r,n,i,s)}}else if(t<8){let s=Ne[te++],o=Ne[te++];if((s&128)>0||(o&128)>0){te-=6;return}if(t<7)return cr(e,r,n,i,s,o);let a=Ne[te++];if((a&128)>0){te-=7;return}return cr(e,r,n,i,s,o,a)}else{let s=Ne[te++],o=Ne[te++],a=Ne[te++],c=Ne[te++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){te-=8;return}if(t<10){if(t===8)return cr(e,r,n,i,s,o,a,c);{let l=Ne[te++];if((l&128)>0){te-=9;return}return cr(e,r,n,i,s,o,a,c,l)}}else if(t<12){let l=Ne[te++],u=Ne[te++];if((l&128)>0||(u&128)>0){te-=10;return}if(t<11)return cr(e,r,n,i,s,o,a,c,l,u);let d=Ne[te++];if((d&128)>0){te-=11;return}return cr(e,r,n,i,s,o,a,c,l,u,d)}else{let l=Ne[te++],u=Ne[te++],d=Ne[te++],f=Ne[te++];if((l&128)>0||(u&128)>0||(d&128)>0||(f&128)>0){te-=12;return}if(t<14){if(t===12)return cr(e,r,n,i,s,o,a,c,l,u,d,f);{let h=Ne[te++];if((h&128)>0){te-=13;return}return cr(e,r,n,i,s,o,a,c,l,u,d,f,h)}}else{let h=Ne[te++],m=Ne[te++];if((h&128)>0||(m&128)>0){te-=14;return}if(t<15)return cr(e,r,n,i,s,o,a,c,l,u,d,f,h,m);let p=Ne[te++];if((p&128)>0){te-=15;return}return cr(e,r,n,i,s,o,a,c,l,u,d,f,h,m,p)}}}}}function S_(){let t=Ne[te++],e;if(t<192)e=t-160;else switch(t){case 217:e=Ne[te++];break;case 218:e=st.getUint16(te),te+=2;break;case 219:e=st.getUint32(te),te+=4;break;default:throw new Error("Expected string")}return Aa(e)}function Wf(t){return vt.copyBuffers?Uint8Array.prototype.slice.call(Ne,te,te+=t):Ne.subarray(te,te+=t)}function xs(t){let e=Ne[te++];if(zr[e]){let r;return zr[e](Ne.subarray(te,r=te+=t),n=>{te=n;try{return zt()}finally{te=r}})}else throw new Error("Unknown extension type "+e)}var R_=new Array(4096);function O_(){let t=Ne[te++];if(t>=160&&t<192){if(t=t-160,ti>=te)return qi.slice(te-yn,(te+=t)-yn);if(!(ti==0&&ei<180))return jf(t)}else return te--,I_(zt());let e=(t<<5^(t>1?st.getUint16(te):t>0?Ne[te]:0))&4095,r=R_[e],n=te,i=te+t-3,s,o=0;if(r&&r.bytes==t){for(;n<i;){if(s=st.getUint32(n),s!=r[o++]){n=1879048192;break}n+=4}for(i+=3;n<i;)if(s=Ne[n++],s!=r[o++]){n=1879048192;break}if(n===i)return te=n,r.string;i-=3,n=te}for(r=[],R_[e]=r,r.bytes=t;n<i;)s=st.getUint32(n),r.push(s),n+=4;for(i+=3;n<i;)s=Ne[n++],r.push(s);let a=t<16?zf(t):T_(t);return a!=null?r.string=a:r.string=jf(t)}function I_(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";if(vt.allowArraysInMapKeys&&Array.isArray(t)&&t.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return t.flat().toString();throw new Error(`Invalid property type for record: ${typeof t}`)}const N_=(t,e)=>{let r=zt().map(I_),n=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,r.highByte=e);let i=at[t];return i&&(i.isShared||Yi)&&((at.restoreStructures||(at.restoreStructures=[]))[t]=i),at[t]=r,r.read=Df(r,n),r.read()};zr[0]=()=>{},zr[0].noBuffer=!0,zr[66]=t=>{let e=t.byteLength%8||8,r=BigInt(t[0]&128?t[0]-256:t[0]);for(let n=1;n<e;n++)r<<=BigInt(8),r+=BigInt(t[n]);if(t.byteLength!==e){let n=new DataView(t.buffer,t.byteOffset,t.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let d=n.getBigUint64(s);for(let f=s+8;f<o;f+=8)d<<=64n,d|=n.getBigUint64(f);return d}let c=s+(a>>4<<3),l=i(s,c),u=i(c,o);return l<<BigInt((o-c)*8)|u};r=r<<BigInt((n.byteLength-e)*8)|i(e,n.byteLength)}return r};let C_={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};zr[101]=()=>{let t=zt();if(!C_[t[0]]){let e=Error(t[1],{cause:t[2]});return e.name=t[0],e}return C_[t[0]](t[1],{cause:t[2]})},zr[105]=t=>{if(vt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=st.getUint32(te-4);vi||(vi=new Map);let r=Ne[te],n;r>=144&&r<160||r==220||r==221?n=[]:r>=128&&r<144||r==222||r==223?n=new Map:(r>=199&&r<=201||r>=212&&r<=216)&&Ne[te+1]===115?n=new Set:n={};let i={target:n};vi.set(e,i);let s=zt();if(i.used)Object.assign(n,s);else return i.target=s;if(n instanceof Map)for(let[o,a]of s.entries())n.set(o,a);if(n instanceof Set)for(let o of Array.from(s))n.add(o);return n},zr[112]=t=>{if(vt.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=st.getUint32(te-4),r=vi.get(e);return r.used=!0,r.target},zr[115]=()=>new Set(zt());const L_=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let nC=typeof globalThis=="object"?globalThis:window;zr[116]=t=>{let e=t[0],r=Uint8Array.prototype.slice.call(t,1).buffer,n=L_[e];if(!n){if(e===16)return r;if(e===17)return new DataView(r);throw new Error("Could not find typed array for code "+e)}return new nC[n](r)},zr[120]=()=>{let t=zt();return new RegExp(t[0],t[1])};const iC=[];zr[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],r=te;return te+=e-t.length,ar=iC,ar=[S_(),S_()],ar.position0=0,ar.position1=0,ar.postBundlePosition=te,te=r,zt()},zr[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function M_(t){let e=ei,r=te,n=yn,i=ti,s=qi,o=vi,a=ar,c=new Uint8Array(Ne.slice(0,ei)),l=at,u=at.slice(0,at.length),d=vt,f=Yi,h=t();return ei=e,te=r,yn=n,ti=i,qi=s,vi=o,ar=a,Ne=c,Yi=f,at=l,at.splice(0,at.length,...u),vt=d,st=new DataView(Ne.buffer,Ne.byteOffset,Ne.byteLength),h}function Hf(){Ne=null,vi=null,at=null}const Gf=new Array(147);for(let t=0;t<256;t++)Gf[t]=+("1e"+Math.floor(45.15-t*.30103));var dl=new Ea({useRecords:!1});const sC=dl.unpack;dl.unpackMultiple,dl.unpack;let oC=new Float32Array(1);new Uint8Array(oC.buffer,0,4);let pl;try{pl=new TextEncoder}catch{}let Kf,U_;const ko=typeof Zt<"u",ml=ko?function(t){return Zt.allocUnsafeSlow(t)}:Uint8Array,$_=ko?Zt:Uint8Array,P_=ko?4294967296:2144337920;let ae,Ta,wt,ne=0,Ar,Nt=null,aC;const cC=21760,lC=/[\u0080-\uFFFF]/,vo=Symbol("record-id");class uC extends Ea{constructor(e){super(e),this.offset=0;let r,n,i,s,o=$_.prototype.utf8Write?function(I,k){return ae.utf8Write(I,k,ae.byteLength-k)}:pl&&pl.encodeInto?function(I,k){return pl.encodeInto(I,ae.subarray(k)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let d=e.maxOwnStructures;d==null&&(d=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let f=u>32||d+u>64,h=u+64,m=u+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],g=0,y=0;this.pack=this.encode=function(I,k){if(ae||(ae=new ml(8192),wt=ae.dataView||(ae.dataView=new DataView(ae.buffer,0,8192)),ne=0),Ar=ae.length-10,Ar-ne<2048?(ae=new ml(ae.length),wt=ae.dataView||(ae.dataView=new DataView(ae.buffer,0,ae.length)),Ar=ae.length-10,ne=0):ne=ne+7&2147483640,r=ne,k&gC&&(ne+=k&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof I!="string"?(Nt=[],Nt.size=1/0):Nt=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let z=i.sharedLength||0;if(z>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let F=0;F<z;F++){let Q=i[F];if(!Q)continue;let Y,N=i.transitions;for(let U=0,$=Q.length;U<$;U++){let V=Q[U];Y=N[V],Y||(Y=N[V]=Object.create(null)),N=Y}N[vo]=F+64}this.lastNamedStructuresLength=z}c||(i.nextId=z+64)}n&&(n=!1);let C;try{a.randomAccessStructure&&I&&I.constructor&&I.constructor===Object?O(I):R(I);let z=Nt;if(Nt&&B_(r,R,0),s&&s.idsToInsert){let F=s.idsToInsert.sort((U,$)=>U.offset>$.offset?1:-1),Q=F.length,Y=-1;for(;z&&Q>0;){let U=F[--Q].offset+r;U<z.stringsPosition+r&&Y===-1&&(Y=0),U>z.position+r?Y>=0&&(Y+=6):(Y>=0&&(wt.setUint32(z.position+r,wt.getUint32(z.position+r)+Y),Y=-1),z=z.previous,Q++)}Y>=0&&z&&wt.setUint32(z.position+r,wt.getUint32(z.position+r)+Y),ne+=F.length*6,ne>Ar&&W(ne),a.offset=ne;let N=hC(ae.subarray(r,ne),F);return s=null,N}return a.offset=ne,k&pC?(ae.start=r,ae.end=ne,ae):ae.subarray(r,ne)}catch(z){throw C=z,z}finally{if(i&&(b(),n&&a.saveStructures)){let z=i.sharedLength||0,F=ae.subarray(r,ne),Q=fC(i,a);if(!C)return a.saveStructures(Q,Q.isCompatible)===!1?a.pack(I,k):(a.lastNamedStructuresLength=z,ae.length>1073741824&&(ae=null),F)}ae.length>1073741824&&(ae=null),k&mC&&(ne=r)}};const b=()=>{y<10&&y++;let I=i.sharedLength||0;if(i.length>I&&!c&&(i.length=I),g>1e4)i.transitions=null,y=0,g=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let k=0,C=p.length;k<C;k++)p[k][vo]=0;p=[]}},A=I=>{var k=I.length;k<16?ae[ne++]=144|k:k<65536?(ae[ne++]=220,ae[ne++]=k>>8,ae[ne++]=k&255):(ae[ne++]=221,wt.setUint32(ne,k),ne+=4);for(let C=0;C<k;C++)R(I[C])},R=I=>{ne>Ar&&(ae=W(ne));var k=typeof I,C;if(k==="string"){let z=I.length;if(Nt&&z>=4&&z<4096){if((Nt.size+=z)>cC){let N,U=(Nt[0]?Nt[0].length*3+Nt[1].length:0)+10;ne+U>Ar&&(ae=W(ne+U));let $;Nt.position?($=Nt,ae[ne]=200,ne+=3,ae[ne++]=98,N=ne-r,ne+=4,B_(r,R,0),wt.setUint16(N+r-3,ne-r-N)):(ae[ne++]=214,ae[ne++]=98,N=ne-r,ne+=4),Nt=["",""],Nt.previous=$,Nt.size=0,Nt.position=N}let Y=lC.test(I);Nt[Y?0:1]+=I,ae[ne++]=193,R(Y?-z:z);return}let F;z<32?F=1:z<256?F=2:z<65536?F=3:F=5;let Q=z*3;if(ne+Q>Ar&&(ae=W(ne+Q)),z<64||!o){let Y,N,U,$=ne+F;for(Y=0;Y<z;Y++)N=I.charCodeAt(Y),N<128?ae[$++]=N:N<2048?(ae[$++]=N>>6|192,ae[$++]=N&63|128):(N&64512)===55296&&((U=I.charCodeAt(Y+1))&64512)===56320?(N=65536+((N&1023)<<10)+(U&1023),Y++,ae[$++]=N>>18|240,ae[$++]=N>>12&63|128,ae[$++]=N>>6&63|128,ae[$++]=N&63|128):(ae[$++]=N>>12|224,ae[$++]=N>>6&63|128,ae[$++]=N&63|128);C=$-ne-F}else C=o(I,ne+F);C<32?ae[ne++]=160|C:C<256?(F<2&&ae.copyWithin(ne+2,ne+1,ne+1+C),ae[ne++]=217,ae[ne++]=C):C<65536?(F<3&&ae.copyWithin(ne+3,ne+2,ne+2+C),ae[ne++]=218,ae[ne++]=C>>8,ae[ne++]=C&255):(F<5&&ae.copyWithin(ne+5,ne+3,ne+3+C),ae[ne++]=219,wt.setUint32(ne,C),ne+=4),ne+=C}else if(k==="number")if(I>>>0===I)I<32||I<128&&this.useRecords===!1||I<64&&!this.randomAccessStructure?ae[ne++]=I:I<256?(ae[ne++]=204,ae[ne++]=I):I<65536?(ae[ne++]=205,ae[ne++]=I>>8,ae[ne++]=I&255):(ae[ne++]=206,wt.setUint32(ne,I),ne+=4);else if(I>>0===I)I>=-32?ae[ne++]=256+I:I>=-128?(ae[ne++]=208,ae[ne++]=I+256):I>=-32768?(ae[ne++]=209,wt.setInt16(ne,I),ne+=2):(ae[ne++]=210,wt.setInt32(ne,I),ne+=4);else{let z;if((z=this.useFloat32)>0&&I<4294967296&&I>=-2147483648){ae[ne++]=202,wt.setFloat32(ne,I);let F;if(z<4||(F=I*Gf[(ae[ne]&127)<<1|ae[ne+1]>>7])>>0===F){ne+=4;return}else ne--}ae[ne++]=203,wt.setFloat64(ne,I),ne+=8}else if(k==="object"||k==="function")if(!I)ae[ne++]=192;else{if(s){let F=s.get(I);if(F){if(!F.id){let Q=s.idsToInsert||(s.idsToInsert=[]);F.id=Q.push(F)}ae[ne++]=214,ae[ne++]=112,wt.setUint32(ne,F.id),ne+=4;return}else s.set(I,{offset:ne-r})}let z=I.constructor;if(z===Object)P(I);else if(z===Array)A(I);else if(z===Map)if(this.mapAsEmptyObject)ae[ne++]=128;else{C=I.size,C<16?ae[ne++]=128|C:C<65536?(ae[ne++]=222,ae[ne++]=C>>8,ae[ne++]=C&255):(ae[ne++]=223,wt.setUint32(ne,C),ne+=4);for(let[F,Q]of I)R(F),R(Q)}else{for(let F=0,Q=Kf.length;F<Q;F++){let Y=U_[F];if(I instanceof Y){let N=Kf[F];if(N.write){N.type&&(ae[ne++]=212,ae[ne++]=N.type,ae[ne++]=0);let J=N.write.call(this,I);J===I?Array.isArray(I)?A(I):P(I):R(J);return}let U=ae,$=wt,V=ne;ae=null;let q;try{q=N.pack.call(this,I,J=>(ae=U,U=null,ne+=J,ne>Ar&&W(ne),{target:ae,targetView:wt,position:ne-J}),R)}finally{U&&(ae=U,wt=$,ne=V,Ar=ae.length-10)}q&&(q.length+ne>Ar&&W(q.length+ne),ne=F_(q,ae,ne,N.type));return}}if(Array.isArray(I))A(I);else{if(I.toJSON){const F=I.toJSON();if(F!==I)return R(F)}if(k==="function")return R(this.writeFunction&&this.writeFunction(I));P(I)}}}else if(k==="boolean")ae[ne++]=I?195:194;else if(k==="bigint"){if(I<9223372036854776e3&&I>=-9223372036854776e3)ae[ne++]=211,wt.setBigInt64(ne,I);else if(I<18446744073709552e3&&I>0)ae[ne++]=207,wt.setBigUint64(ne,I);else if(this.largeBigIntToFloat)ae[ne++]=203,wt.setFloat64(ne,Number(I));else{if(this.largeBigIntToString)return R(I.toString());if(this.useBigIntExtension||this.moreTypes){let z=I<0?BigInt(-1):BigInt(0),F;if(I>>BigInt(65536)===z){let Q=BigInt(18446744073709552e3)-BigInt(1),Y=[];for(;Y.push(I&Q),I>>BigInt(63)!==z;)I>>=BigInt(64);F=new Uint8Array(new BigUint64Array(Y).buffer),F.reverse()}else{let Q=I<0,Y=(Q?~I:I).toString(16);if(Y.length%2?Y="0"+Y:parseInt(Y.charAt(0),16)>=8&&(Y="00"+Y),ko)F=Zt.from(Y,"hex");else{F=new Uint8Array(Y.length/2);for(let N=0;N<F.length;N++)F[N]=parseInt(Y.slice(N*2,N*2+2),16)}if(Q)for(let N=0;N<F.length;N++)F[N]=~F[N]}F.length+ne>Ar&&W(F.length+ne),ne=F_(F,ae,ne,66);return}else throw new RangeError(I+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}ne+=8}else if(k==="undefined")this.encodeUndefinedAsNil?ae[ne++]=192:(ae[ne++]=212,ae[ne++]=0,ae[ne++]=0);else throw new Error("Unknown type: "+k)},E=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?I=>{let k;if(this.skipValues){k=[];for(let F in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(F))&&!this.skipValues.includes(I[F])&&k.push(F)}else k=Object.keys(I);let C=k.length;C<16?ae[ne++]=128|C:C<65536?(ae[ne++]=222,ae[ne++]=C>>8,ae[ne++]=C&255):(ae[ne++]=223,wt.setUint32(ne,C),ne+=4);let z;if(this.coercibleKeyAsNumber)for(let F=0;F<C;F++){z=k[F];let Q=Number(z);R(isNaN(Q)?z:Q),R(I[z])}else for(let F=0;F<C;F++)R(z=k[F]),R(I[z])}:I=>{ae[ne++]=222;let k=ne-r;ne+=2;let C=0;for(let z in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(z))&&(R(z),R(I[z]),C++);if(C>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');ae[k+++r]=C>>8,ae[k+r]=C&255},M=this.useRecords===!1?E:e.progressiveRecords&&!f?I=>{let k,C=i.transitions||(i.transitions=Object.create(null)),z=ne++-r,F;for(let Q in I)if(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Q)){if(k=C[Q],k)C=k;else{let Y=Object.keys(I),N=C;C=i.transitions;let U=0;for(let $=0,V=Y.length;$<V;$++){let q=Y[$];k=C[q],k||(k=C[q]=Object.create(null),U++),C=k}z+r+1==ne?(ne--,D(C,Y,U)):G(C,Y,z,U),F=!0,C=N[Q]}R(I[Q])}if(!F){let Q=C[vo];Q?ae[z+r]=Q:G(C,Object.keys(I),z,0)}}:I=>{let k,C=i.transitions||(i.transitions=Object.create(null)),z=0;for(let Q in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Q))&&(k=C[Q],k||(k=C[Q]=Object.create(null),z++),C=k);let F=C[vo];F?F>=96&&f?(ae[ne++]=((F-=96)&31)+96,ae[ne++]=F>>5):ae[ne++]=F:D(C,C.__keys__||Object.keys(I),z);for(let Q in I)(typeof I.hasOwnProperty!="function"||I.hasOwnProperty(Q))&&R(I[Q])},S=typeof this.useRecords=="function"&&this.useRecords,P=S?I=>{S(I)?M(I):E(I)}:M,W=I=>{let k;if(I>16777216){if(I-r>P_)throw new Error("Packed buffer would be larger than maximum buffer size");k=Math.min(P_,Math.round(Math.max((I-r)*(I>67108864?1.25:2),4194304)/4096)*4096)}else k=(Math.max(I-r<<2,ae.length-1)>>12)+1<<12;let C=new ml(k);return wt=C.dataView||(C.dataView=new DataView(C.buffer,0,k)),I=Math.min(I,ae.length),ae.copy?ae.copy(C,0,r,I):C.set(ae.slice(r,I)),ne-=r,r=0,Ar=C.length-10,ae=C},D=(I,k,C)=>{let z=i.nextId;z||(z=64),z<h&&this.shouldShareStructure&&!this.shouldShareStructure(k)?(z=i.nextOwnId,z<m||(z=h),i.nextOwnId=z+1):(z>=m&&(z=h),i.nextId=z+1);let F=k.highByte=z>=96&&f?z-96>>5:-1;I[vo]=z,I.__keys__=k,i[z-64]=k,z<h?(k.isShared=!0,i.sharedLength=z-63,n=!0,F>=0?(ae[ne++]=(z&31)+96,ae[ne++]=F):ae[ne++]=z):(F>=0?(ae[ne++]=213,ae[ne++]=114,ae[ne++]=(z&31)+96,ae[ne++]=F):(ae[ne++]=212,ae[ne++]=114,ae[ne++]=z),C&&(g+=y*C),p.length>=d&&(p.shift()[vo]=0),p.push(I),R(k))},G=(I,k,C,z)=>{let F=ae,Q=ne,Y=Ar,N=r;ae=Ta,ne=0,r=0,ae||(Ta=ae=new ml(8192)),Ar=ae.length-10,D(I,k,z),Ta=ae;let U=ne;if(ae=F,ne=Q,Ar=Y,r=N,U>1){let $=ne+U-1;$>Ar&&W($);let V=C+r;ae.copyWithin(V+U,V+1,ne),ae.set(Ta.slice(0,U),V),ne=$}else ae[C+r]=Ta[0]},O=I=>{let k=aC(I,ae,r,ne,i,W,(C,z,F)=>{if(F)return n=!0;ne=z;let Q=ae;return R(C),b(),Q!==ae?{position:ne,targetView:wt,target:ae}:ne},this);if(k===0)return P(I);ne=k}}useBuffer(e){ae=e,ae.dataView||(ae.dataView=new DataView(ae.buffer,ae.byteOffset,ae.byteLength)),wt=ae.dataView,ne=0}set position(e){ne=e}get position(){return ne}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}U_=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,__],Kf=[{pack(t,e,r){let n=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&n>=0&&n<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,n)}else if(n>0&&n<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(n/1e3/4294967296>>0)),s.setUint32(o+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return e(0),r(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(n)))}}},{pack(t,e,r){if(this.setAsEmptyObject)return e(0),r({});let n=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),r(n)}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=101,n[i++]=0),r([t.name,t.message,t.cause])}},{pack(t,e,r){let{target:n,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(n[i++]=212,n[i++]=120,n[i++]=0),r([t.source,t.flags])}},{pack(t,e){this.moreTypes?qf(t,16,e):Yf(ko?Zt.from(t):new Uint8Array(t),e)}},{pack(t,e){let r=t.constructor;r!==$_&&this.moreTypes?qf(t,L_.indexOf(r.name),e):Yf(t,e)}},{pack(t,e){this.moreTypes?qf(t,17,e):Yf(ko?Zt.from(t):new Uint8Array(t),e)}},{pack(t,e){let{target:r,position:n}=e(1);r[n]=193}}];function qf(t,e,r,n){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=r(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=r(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=r(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function Yf(t,e){let r=t.byteLength;var n,i;if(r<256){var{target:n,position:i}=e(r+2);n[i++]=196,n[i++]=r}else if(r<65536){var{target:n,position:i}=e(r+3);n[i++]=197,n[i++]=r>>8,n[i++]=r&255}else{var{target:n,position:i,targetView:s}=e(r+5);n[i++]=198,s.setUint32(i,r),i+=4}n.set(t,i)}function F_(t,e,r,n){let i=t.length;switch(i){case 1:e[r++]=212;break;case 2:e[r++]=213;break;case 4:e[r++]=214;break;case 8:e[r++]=215;break;case 16:e[r++]=216;break;default:i<256?(e[r++]=199,e[r++]=i):i<65536?(e[r++]=200,e[r++]=i>>8,e[r++]=i&255):(e[r++]=201,e[r++]=i>>24,e[r++]=i>>16&255,e[r++]=i>>8&255,e[r++]=i&255)}return e[r++]=n,e.set(t,r),r+=i,r}function hC(t,e){let r,n=e.length*6,i=t.length-n;for(;r=e.pop();){let s=r.offset,o=r.id;t.copyWithin(s+n,s,i),n-=6;let a=s+n;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function B_(t,e,r){if(Nt.length>0){wt.setUint32(Nt.position+t,ne+r-Nt.position-t),Nt.stringsPosition=ne-t;let n=Nt;Nt=null,e(n[0]),e(n[1])}}function fC(t,e){return t.isCompatible=r=>{let n=!r||(e.lastNamedStructuresLength||0)===r.length;return n||e._mergeStructures(r),n},t}let D_=new uC({useRecords:!1});const dC=D_.pack;D_.pack;const pC=512,mC=1024,gC=2048;function Ot(){return null}function xo(t,e,r={}){if(!w(t))return;const n=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=r[o];w(c)&&(a=c(a));const l=e[o];w(l)&&(o=l),a!==null&&n.push(o,a)}return n}function Sa(t,e,r={}){if(w(t))try{const n={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];w(a)&&(s=a);const c=r[s];w(c)&&(o=c(o)),n[s]=o}return n}catch(n){mt(le,"","format",n.message)}}function yC(t){try{return dC(t)}catch(e){mt(le,"","format",e.message)}}function Vf(t){if(ye(t)){try{return JSON.parse(t)}catch(e){mt(le,"","format",e.message)}return}try{return sC(t)}catch(e){mt(le,"","format",e.message)}}function j_(){return{id:Ft()}}var gl=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.breakable=16]="breakable",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.stopped=27]="stopped",t[t.removed=28]="removed",t[t.party=29]="party",t[t.group=30]="group",t[t.lightdir=31]="lightdir",t[t.item=32]="item",t[t.p4=33]="p4",t[t.p5=34]="p5",t[t.p6=35]="p6",t[t.displaychar=36]="displaychar",t[t.displaycolor=37]="displaycolor",t[t.displaybg=38]="displaybg",t[t.shootx=39]="shootx",t[t.shooty=40]="shooty",t[t.p7=41]="p7",t[t.p8=42]="p8",t[t.p9=43]="p9",t[t.p10=44]="p10",t))(gl||{});function yl(t){return w(t?.id)?xo(t,gl,{category:Ot,kinddata:Ot,stopped:Ot,removed:Ot,bucket:Ot}):xo(t,gl,{id:Ot,x:Ot,y:Ot,lx:Ot,ly:Ot,code:Ot,category:Ot,kinddata:Ot,stopped:Ot,removed:Ot,bucket:Ot})}function _l(t){return Sa(t,gl)}function Wt(t){return t?.category===Br.ISOBJECT}function Ra(t,e){if(!w(t)||!Rr(e))return;const{color:r,bg:n}=f_(e);w(r)&&(t.color=r),w(n)&&(t.bg=n)}function z_(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}function W_(t){const e=Math.floor(t.length/cl);if(e*cl!==t.length)return;const r=z_(3,e);for(let n=0;n<r.bits.length;++n)r.bits[n]=t[n];return r}function _C(t,e){return t&1<<e?255:0}function Xf(t){const e=Math.floor(t.length/Pf);if(e*Pf!==t.length)return;const r=Math.ceil(e/ll),n=ws*ll,i=z_(n,ks*r);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*ks+a,u=t[c];for(let d=0;d<ws;++d){const f=s*ws+d;i.bits[f+l*n]=_C(u,7-d)}++a,a===ks&&(a=0,++s,s===ll&&(s=0,++o))}return i}const bC=Oc("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),wC=Oc("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var H_=typeof eo=="object"&&eo&&eo.Object===Object&&eo,kC=typeof self=="object"&&self&&self.Object===Object&&self,ri=H_||kC||Function("return this")(),_n=ri.Symbol,G_=Object.prototype,vC=G_.hasOwnProperty,xC=G_.toString,Oa=_n?_n.toStringTag:void 0;function EC(t){var e=vC.call(t,Oa),r=t[Oa];try{t[Oa]=void 0;var n=!0}catch{}var i=xC.call(t);return n&&(e?t[Oa]=r:delete t[Oa]),i}var AC=Object.prototype,TC=AC.toString;function SC(t){return TC.call(t)}var RC="[object Null]",OC="[object Undefined]",K_=_n?_n.toStringTag:void 0;function Vi(t){return t==null?t===void 0?OC:RC:K_&&K_ in Object(t)?EC(t):SC(t)}function Mn(t){return t!=null&&typeof t=="object"}var IC="[object Symbol]";function bl(t){return typeof t=="symbol"||Mn(t)&&Vi(t)==IC}function wl(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var lt=Array.isArray,q_=_n?_n.prototype:void 0,Y_=q_?q_.toString:void 0;function V_(t){if(typeof t=="string")return t;if(lt(t))return wl(t,V_)+"";if(bl(t))return Y_?Y_.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var NC=/\s/;function CC(t){for(var e=t.length;e--&&NC.test(t.charAt(e)););return e}var LC=/^\s+/;function MC(t){return t&&t.slice(0,CC(t)+1).replace(LC,"")}function bn(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var X_=NaN,UC=/^[-+]0x[0-9a-f]+$/i,$C=/^0b[01]+$/i,PC=/^0o[0-7]+$/i,FC=parseInt;function BC(t){if(typeof t=="number")return t;if(bl(t))return X_;if(bn(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=bn(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=MC(t);var r=$C.test(t);return r||PC.test(t)?FC(t.slice(2),r?2:8):UC.test(t)?X_:+t}var Z_=1/0,DC=17976931348623157e292;function jC(t){if(!t)return t===0?t:0;if(t=BC(t),t===Z_||t===-Z_){var e=t<0?-1:1;return e*DC}return t===t?t:0}function kl(t){var e=jC(t),r=e%1;return e===e?r?e-r:e:0}function Eo(t){return t}var zC="[object AsyncFunction]",WC="[object Function]",HC="[object GeneratorFunction]",GC="[object Proxy]";function xi(t){if(!bn(t))return!1;var e=Vi(t);return e==WC||e==HC||e==zC||e==GC}var Zf=ri["__core-js_shared__"],J_=(function(){var t=/[^.]+$/.exec(Zf&&Zf.keys&&Zf.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function KC(t){return!!J_&&J_ in t}var qC=Function.prototype,YC=qC.toString;function Es(t){if(t!=null){try{return YC.call(t)}catch{}try{return t+""}catch{}}return""}var VC=/[\\^$.*+?()[\]{}|]/g,XC=/^\[object .+?Constructor\]$/,ZC=Function.prototype,JC=Object.prototype,QC=ZC.toString,eL=JC.hasOwnProperty,tL=RegExp("^"+QC.call(eL).replace(VC,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function rL(t){if(!bn(t)||KC(t))return!1;var e=xi(t)?tL:XC;return e.test(Es(t))}function nL(t,e){return t?.[e]}function As(t,e){var r=nL(t,e);return rL(r)?r:void 0}var Jf=As(ri,"WeakMap"),Q_=Object.create,iL=(function(){function t(){}return function(e){if(!bn(e))return{};if(Q_)return Q_(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}})();function sL(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function er(){}function oL(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var aL=800,cL=16,lL=Date.now;function uL(t){var e=0,r=0;return function(){var n=lL(),i=cL-(n-r);if(r=n,i>0){if(++e>=aL)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function hL(t){return function(){return t}}var vl=(function(){try{var t=As(Object,"defineProperty");return t({},"",{}),t}catch{}})(),fL=vl?function(t,e){return vl(t,"toString",{configurable:!0,enumerable:!1,value:hL(e),writable:!0})}:Eo,dL=uL(fL);function eb(t,e){for(var r=-1,n=t==null?0:t.length;++r<n&&e(t[r],r,t)!==!1;);return t}function tb(t,e,r,n){for(var i=t.length,s=r+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function pL(t){return t!==t}function mL(t,e,r){for(var n=r-1,i=t.length;++n<i;)if(t[n]===e)return n;return-1}function Qf(t,e,r){return e===e?mL(t,e,r):tb(t,pL,r)}function rb(t,e){var r=t==null?0:t.length;return!!r&&Qf(t,e,0)>-1}var gL=9007199254740991,yL=/^(?:0|[1-9]\d*)$/;function xl(t,e){var r=typeof t;return e=e??gL,!!e&&(r=="number"||r!="symbol"&&yL.test(t))&&t>-1&&t%1==0&&t<e}function ed(t,e,r){e=="__proto__"&&vl?vl(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function Ia(t,e){return t===e||t!==t&&e!==e}var _L=Object.prototype,bL=_L.hasOwnProperty;function El(t,e,r){var n=t[e];(!(bL.call(t,e)&&Ia(n,r))||r===void 0&&!(e in t))&&ed(t,e,r)}function Na(t,e,r,n){var i=!r;r||(r={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?ed(r,a,c):El(r,a,c)}return r}var nb=Math.max;function wL(t,e,r){return e=nb(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,s=nb(n.length-e,0),o=Array(s);++i<s;)o[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(o),sL(t,this,a)}}function td(t,e){return dL(wL(t,e,Eo),t+"")}var kL=9007199254740991;function rd(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=kL}function ni(t){return t!=null&&rd(t.length)&&!xi(t)}function ib(t,e,r){if(!bn(r))return!1;var n=typeof e;return(n=="number"?ni(r)&&xl(e,r.length):n=="string"&&e in r)?Ia(r[e],t):!1}function vL(t){return td(function(e,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&ib(r[0],r[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,s)}return e})}var xL=Object.prototype;function Ca(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||xL;return t===r}function EL(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var AL="[object Arguments]";function sb(t){return Mn(t)&&Vi(t)==AL}var ob=Object.prototype,TL=ob.hasOwnProperty,SL=ob.propertyIsEnumerable,Al=sb((function(){return arguments})())?sb:function(t){return Mn(t)&&TL.call(t,"callee")&&!SL.call(t,"callee")};function RL(){return!1}var ab=typeof exports=="object"&&exports&&!exports.nodeType&&exports,cb=ab&&typeof module=="object"&&module&&!module.nodeType&&module,OL=cb&&cb.exports===ab,lb=OL?ri.Buffer:void 0,IL=lb?lb.isBuffer:void 0,La=IL||RL,NL="[object Arguments]",CL="[object Array]",LL="[object Boolean]",ML="[object Date]",UL="[object Error]",$L="[object Function]",PL="[object Map]",FL="[object Number]",BL="[object Object]",DL="[object RegExp]",jL="[object Set]",zL="[object String]",WL="[object WeakMap]",HL="[object ArrayBuffer]",GL="[object DataView]",KL="[object Float32Array]",qL="[object Float64Array]",YL="[object Int8Array]",VL="[object Int16Array]",XL="[object Int32Array]",ZL="[object Uint8Array]",JL="[object Uint8ClampedArray]",QL="[object Uint16Array]",e6="[object Uint32Array]",Tt={};Tt[KL]=Tt[qL]=Tt[YL]=Tt[VL]=Tt[XL]=Tt[ZL]=Tt[JL]=Tt[QL]=Tt[e6]=!0,Tt[NL]=Tt[CL]=Tt[HL]=Tt[LL]=Tt[GL]=Tt[ML]=Tt[UL]=Tt[$L]=Tt[PL]=Tt[FL]=Tt[BL]=Tt[DL]=Tt[jL]=Tt[zL]=Tt[WL]=!1;function t6(t){return Mn(t)&&rd(t.length)&&!!Tt[Vi(t)]}function Tl(t){return function(e){return t(e)}}var ub=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ma=ub&&typeof module=="object"&&module&&!module.nodeType&&module,r6=Ma&&Ma.exports===ub,nd=r6&&H_.process,Xi=(function(){try{var t=Ma&&Ma.require&&Ma.require("util").types;return t||nd&&nd.binding&&nd.binding("util")}catch{}})(),hb=Xi&&Xi.isTypedArray,id=hb?Tl(hb):t6,n6=Object.prototype,i6=n6.hasOwnProperty;function fb(t,e){var r=lt(t),n=!r&&Al(t),i=!r&&!n&&La(t),s=!r&&!n&&!i&&id(t),o=r||n||i||s,a=o?EL(t.length,String):[],c=a.length;for(var l in t)(e||i6.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||xl(l,c)))&&a.push(l);return a}function db(t,e){return function(r){return t(e(r))}}var s6=db(Object.keys,Object),o6=Object.prototype,a6=o6.hasOwnProperty;function pb(t){if(!Ca(t))return s6(t);var e=[];for(var r in Object(t))a6.call(t,r)&&r!="constructor"&&e.push(r);return e}function wn(t){return ni(t)?fb(t):pb(t)}var c6=Object.prototype,l6=c6.hasOwnProperty,Wr=vL(function(t,e){if(Ca(e)||ni(e)){Na(e,wn(e),t);return}for(var r in e)l6.call(e,r)&&El(t,r,e[r])});function u6(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var h6=Object.prototype,f6=h6.hasOwnProperty;function d6(t){if(!bn(t))return u6(t);var e=Ca(t),r=[];for(var n in t)n=="constructor"&&(e||!f6.call(t,n))||r.push(n);return r}function sd(t){return ni(t)?fb(t,!0):d6(t)}var p6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,m6=/^\w*$/;function od(t,e){if(lt(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||bl(t)?!0:m6.test(t)||!p6.test(t)||e!=null&&t in Object(e)}var Ua=As(Object,"create");function g6(){this.__data__=Ua?Ua(null):{},this.size=0}function y6(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var _6="__lodash_hash_undefined__",b6=Object.prototype,w6=b6.hasOwnProperty;function k6(t){var e=this.__data__;if(Ua){var r=e[t];return r===_6?void 0:r}return w6.call(e,t)?e[t]:void 0}var v6=Object.prototype,x6=v6.hasOwnProperty;function E6(t){var e=this.__data__;return Ua?e[t]!==void 0:x6.call(e,t)}var A6="__lodash_hash_undefined__";function T6(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Ua&&e===void 0?A6:e,this}function Ts(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ts.prototype.clear=g6,Ts.prototype.delete=y6,Ts.prototype.get=k6,Ts.prototype.has=E6,Ts.prototype.set=T6;function S6(){this.__data__=[],this.size=0}function Sl(t,e){for(var r=t.length;r--;)if(Ia(t[r][0],e))return r;return-1}var R6=Array.prototype,O6=R6.splice;function I6(t){var e=this.__data__,r=Sl(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():O6.call(e,r,1),--this.size,!0}function N6(t){var e=this.__data__,r=Sl(e,t);return r<0?void 0:e[r][1]}function C6(t){return Sl(this.__data__,t)>-1}function L6(t,e){var r=this.__data__,n=Sl(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function Ei(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ei.prototype.clear=S6,Ei.prototype.delete=I6,Ei.prototype.get=N6,Ei.prototype.has=C6,Ei.prototype.set=L6;var $a=As(ri,"Map");function M6(){this.size=0,this.__data__={hash:new Ts,map:new($a||Ei),string:new Ts}}function U6(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Rl(t,e){var r=t.__data__;return U6(e)?r[typeof e=="string"?"string":"hash"]:r.map}function $6(t){var e=Rl(this,t).delete(t);return this.size-=e?1:0,e}function P6(t){return Rl(this,t).get(t)}function F6(t){return Rl(this,t).has(t)}function B6(t,e){var r=Rl(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function Ai(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Ai.prototype.clear=M6,Ai.prototype.delete=$6,Ai.prototype.get=P6,Ai.prototype.has=F6,Ai.prototype.set=B6;var D6="Expected a function";function ad(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(D6);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,n);return r.cache=s.set(i,o)||s,o};return r.cache=new(ad.Cache||Ai),r}ad.Cache=Ai;var j6=500;function z6(t){var e=ad(t,function(n){return r.size===j6&&r.clear(),n}),r=e.cache;return e}var W6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,H6=/\\(\\)?/g,G6=z6(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(W6,function(r,n,i,s){e.push(i?s.replace(H6,"$1"):n||r)}),e});function mb(t){return t==null?"":V_(t)}function Ol(t,e){return lt(t)?t:od(t,e)?[t]:G6(mb(t))}function Pa(t){if(typeof t=="string"||bl(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function cd(t,e){e=Ol(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Pa(e[r++])];return r&&r==n?t:void 0}function K6(t,e,r){var n=t==null?void 0:cd(t,e);return n===void 0?r:n}function ld(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}var gb=_n?_n.isConcatSpreadable:void 0;function q6(t){return lt(t)||Al(t)||!!(gb&&t&&t[gb])}function ud(t,e,r,n,i){var s=-1,o=t.length;for(r||(r=q6),i||(i=[]);++s<o;){var a=t[s];r(a)?ld(i,a):n||(i[i.length]=a)}return i}function on(t){var e=t==null?0:t.length;return e?ud(t):[]}var yb=db(Object.getPrototypeOf,Object);function hd(t,e,r){var n=-1,i=t.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var s=Array(i);++n<i;)s[n]=t[n+e];return s}function Y6(t,e,r){var n=t.length;return r=r===void 0?n:r,!e&&r>=n?t:hd(t,e,r)}var V6="\\ud800-\\udfff",X6="\\u0300-\\u036f",Z6="\\ufe20-\\ufe2f",J6="\\u20d0-\\u20ff",Q6=X6+Z6+J6,eM="\\ufe0e\\ufe0f",tM="\\u200d",rM=RegExp("["+tM+V6+Q6+eM+"]");function _b(t){return rM.test(t)}function nM(t){return t.split("")}var bb="\\ud800-\\udfff",iM="\\u0300-\\u036f",sM="\\ufe20-\\ufe2f",oM="\\u20d0-\\u20ff",aM=iM+sM+oM,cM="\\ufe0e\\ufe0f",lM="["+bb+"]",fd="["+aM+"]",dd="\\ud83c[\\udffb-\\udfff]",uM="(?:"+fd+"|"+dd+")",wb="[^"+bb+"]",kb="(?:\\ud83c[\\udde6-\\uddff]){2}",vb="[\\ud800-\\udbff][\\udc00-\\udfff]",hM="\\u200d",xb=uM+"?",Eb="["+cM+"]?",fM="(?:"+hM+"(?:"+[wb,kb,vb].join("|")+")"+Eb+xb+")*",dM=Eb+xb+fM,pM="(?:"+[wb+fd+"?",fd,kb,vb,lM].join("|")+")",mM=RegExp(dd+"(?="+dd+")|"+pM+dM,"g");function gM(t){return t.match(mM)||[]}function yM(t){return _b(t)?gM(t):nM(t)}function _M(t){return function(e){e=mb(e);var r=_b(e)?yM(e):void 0,n=r?r[0]:e.charAt(0),i=r?Y6(r,1).join(""):e.slice(1);return n[t]()+i}}var Ab=_M("toUpperCase");function bM(t,e,r,n){var i=-1,s=t==null?0:t.length;for(n&&s&&(r=t[++i]);++i<s;)r=e(r,t[i],i,t);return r}function wM(){this.__data__=new Ei,this.size=0}function kM(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function vM(t){return this.__data__.get(t)}function xM(t){return this.__data__.has(t)}var EM=200;function AM(t,e){var r=this.__data__;if(r instanceof Ei){var n=r.__data__;if(!$a||n.length<EM-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Ai(n)}return r.set(t,e),this.size=r.size,this}function ii(t){var e=this.__data__=new Ei(t);this.size=e.size}ii.prototype.clear=wM,ii.prototype.delete=kM,ii.prototype.get=vM,ii.prototype.has=xM,ii.prototype.set=AM;function TM(t,e){return t&&Na(e,wn(e),t)}function SM(t,e){return t&&Na(e,sd(e),t)}var Tb=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Sb=Tb&&typeof module=="object"&&module&&!module.nodeType&&module,RM=Sb&&Sb.exports===Tb,Rb=RM?ri.Buffer:void 0,Ob=Rb?Rb.allocUnsafe:void 0;function OM(t,e){var r=t.length,n=Ob?Ob(r):new t.constructor(r);return t.copy(n),n}function pd(t,e){for(var r=-1,n=t==null?0:t.length,i=0,s=[];++r<n;){var o=t[r];e(o,r,t)&&(s[i++]=o)}return s}function Ib(){return[]}var IM=Object.prototype,NM=IM.propertyIsEnumerable,Nb=Object.getOwnPropertySymbols,md=Nb?function(t){return t==null?[]:(t=Object(t),pd(Nb(t),function(e){return NM.call(t,e)}))}:Ib;function CM(t,e){return Na(t,md(t),e)}var LM=Object.getOwnPropertySymbols,Cb=LM?function(t){for(var e=[];t;)ld(e,md(t)),t=yb(t);return e}:Ib;function MM(t,e){return Na(t,Cb(t),e)}function Lb(t,e,r){var n=e(t);return lt(t)?n:ld(n,r(t))}function gd(t){return Lb(t,wn,md)}function UM(t){return Lb(t,sd,Cb)}var yd=As(ri,"DataView"),_d=As(ri,"Promise"),Ao=As(ri,"Set"),Mb="[object Map]",$M="[object Object]",Ub="[object Promise]",$b="[object Set]",Pb="[object WeakMap]",Fb="[object DataView]",PM=Es(yd),FM=Es($a),BM=Es(_d),DM=Es(Ao),jM=Es(Jf),kn=Vi;(yd&&kn(new yd(new ArrayBuffer(1)))!=Fb||$a&&kn(new $a)!=Mb||_d&&kn(_d.resolve())!=Ub||Ao&&kn(new Ao)!=$b||Jf&&kn(new Jf)!=Pb)&&(kn=function(t){var e=Vi(t),r=e==$M?t.constructor:void 0,n=r?Es(r):"";if(n)switch(n){case PM:return Fb;case FM:return Mb;case BM:return Ub;case DM:return $b;case jM:return Pb}return e});var zM=Object.prototype,WM=zM.hasOwnProperty;function HM(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&WM.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var Il=ri.Uint8Array;function GM(t){var e=new t.constructor(t.byteLength);return new Il(e).set(new Il(t)),e}function KM(t,e){var r=t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var qM=/\w*$/;function YM(t){var e=new t.constructor(t.source,qM.exec(t));return e.lastIndex=t.lastIndex,e}var Bb=_n?_n.prototype:void 0,Db=Bb?Bb.valueOf:void 0;function VM(t){return Db?Object(Db.call(t)):{}}function XM(t,e){var r=t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var ZM="[object Boolean]",JM="[object Date]",QM="[object Map]",e3="[object Number]",t3="[object RegExp]",r3="[object Set]",n3="[object String]",i3="[object Symbol]",s3="[object ArrayBuffer]",o3="[object DataView]",a3="[object Float32Array]",c3="[object Float64Array]",l3="[object Int8Array]",u3="[object Int16Array]",h3="[object Int32Array]",f3="[object Uint8Array]",d3="[object Uint8ClampedArray]",p3="[object Uint16Array]",m3="[object Uint32Array]";function g3(t,e,r){var n=t.constructor;switch(e){case s3:return GM(t);case ZM:case JM:return new n(+t);case o3:return KM(t);case a3:case c3:case l3:case u3:case h3:case f3:case d3:case p3:case m3:return XM(t);case QM:return new n;case e3:case n3:return new n(t);case t3:return YM(t);case r3:return new n;case i3:return VM(t)}}function y3(t){return typeof t.constructor=="function"&&!Ca(t)?iL(yb(t)):{}}var _3="[object Map]";function b3(t){return Mn(t)&&kn(t)==_3}var jb=Xi&&Xi.isMap,w3=jb?Tl(jb):b3,k3="[object Set]";function v3(t){return Mn(t)&&kn(t)==k3}var zb=Xi&&Xi.isSet,x3=zb?Tl(zb):v3,E3=2,Wb="[object Arguments]",A3="[object Array]",T3="[object Boolean]",S3="[object Date]",R3="[object Error]",Hb="[object Function]",O3="[object GeneratorFunction]",I3="[object Map]",N3="[object Number]",Gb="[object Object]",C3="[object RegExp]",L3="[object Set]",M3="[object String]",U3="[object Symbol]",$3="[object WeakMap]",P3="[object ArrayBuffer]",F3="[object DataView]",B3="[object Float32Array]",D3="[object Float64Array]",j3="[object Int8Array]",z3="[object Int16Array]",W3="[object Int32Array]",H3="[object Uint8Array]",G3="[object Uint8ClampedArray]",K3="[object Uint16Array]",q3="[object Uint32Array]",xt={};xt[Wb]=xt[A3]=xt[P3]=xt[F3]=xt[T3]=xt[S3]=xt[B3]=xt[D3]=xt[j3]=xt[z3]=xt[W3]=xt[I3]=xt[N3]=xt[Gb]=xt[C3]=xt[L3]=xt[M3]=xt[U3]=xt[H3]=xt[G3]=xt[K3]=xt[q3]=!0,xt[R3]=xt[Hb]=xt[$3]=!1;function Nl(t,e,r,n,i,s){var o,a=e&E3;if(o!==void 0)return o;if(!bn(t))return t;var c=lt(t);if(c)return o=HM(t),oL(t,o);var l=kn(t),u=l==Hb||l==O3;if(La(t))return OM(t);if(l==Gb||l==Wb||u&&!i)return o=u?{}:y3(t),a?MM(t,SM(o,t)):CM(t,TM(o,t));if(!xt[l])return i?t:{};o=g3(t,l),s||(s=new ii);var d=s.get(t);if(d)return d;s.set(t,o),x3(t)?t.forEach(function(m){o.add(Nl(m,e,r,m,t,s))}):w3(t)&&t.forEach(function(m,p){o.set(p,Nl(m,e,r,p,t,s))});var f=gd,h=c?void 0:f(t);return eb(h||t,function(m,p){h&&(p=m,m=t[p]),El(o,p,Nl(m,e,r,p,t,s))}),o}var Y3=4;function wr(t){return Nl(t,Y3)}function Fa(t){for(var e=-1,r=t==null?0:t.length,n=0,i=[];++e<r;){var s=t[e];s&&(i[n++]=s)}return i}var V3="__lodash_hash_undefined__";function X3(t){return this.__data__.set(t,V3),this}function Z3(t){return this.__data__.has(t)}function To(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new Ai;++e<r;)this.add(t[e])}To.prototype.add=To.prototype.push=X3,To.prototype.has=Z3;function Kb(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function bd(t,e){return t.has(e)}var J3=1,Q3=2;function qb(t,e,r,n,i,s){var o=r&J3,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var d=-1,f=!0,h=r&Q3?new To:void 0;for(s.set(t,e),s.set(e,t);++d<a;){var m=t[d],p=e[d];if(n)var g=o?n(p,m,d,e,t,s):n(m,p,d,t,e,s);if(g!==void 0){if(g)continue;f=!1;break}if(h){if(!Kb(e,function(y,b){if(!bd(h,b)&&(m===y||i(m,y,r,n,s)))return h.push(b)})){f=!1;break}}else if(!(m===p||i(m,p,r,n,s))){f=!1;break}}return s.delete(t),s.delete(e),f}function e2(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}function wd(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var t2=1,r2=2,n2="[object Boolean]",i2="[object Date]",s2="[object Error]",o2="[object Map]",a2="[object Number]",c2="[object RegExp]",l2="[object Set]",u2="[object String]",h2="[object Symbol]",f2="[object ArrayBuffer]",d2="[object DataView]",Yb=_n?_n.prototype:void 0,kd=Yb?Yb.valueOf:void 0;function p2(t,e,r,n,i,s,o){switch(r){case d2:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case f2:return!(t.byteLength!=e.byteLength||!s(new Il(t),new Il(e)));case n2:case i2:case a2:return Ia(+t,+e);case s2:return t.name==e.name&&t.message==e.message;case c2:case u2:return t==e+"";case o2:var a=e2;case l2:var c=n&t2;if(a||(a=wd),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;n|=r2,o.set(t,e);var u=qb(a(t),a(e),n,i,s,o);return o.delete(t),u;case h2:if(kd)return kd.call(t)==kd.call(e)}return!1}var m2=1,g2=Object.prototype,y2=g2.hasOwnProperty;function _2(t,e,r,n,i,s){var o=r&m2,a=gd(t),c=a.length,l=gd(e),u=l.length;if(c!=u&&!o)return!1;for(var d=c;d--;){var f=a[d];if(!(o?f in e:y2.call(e,f)))return!1}var h=s.get(t),m=s.get(e);if(h&&m)return h==e&&m==t;var p=!0;s.set(t,e),s.set(e,t);for(var g=o;++d<c;){f=a[d];var y=t[f],b=e[f];if(n)var A=o?n(b,y,f,e,t,s):n(y,b,f,t,e,s);if(!(A===void 0?y===b||i(y,b,r,n,s):A)){p=!1;break}g||(g=f=="constructor")}if(p&&!g){var R=t.constructor,E=e.constructor;R!=E&&"constructor"in t&&"constructor"in e&&!(typeof R=="function"&&R instanceof R&&typeof E=="function"&&E instanceof E)&&(p=!1)}return s.delete(t),s.delete(e),p}var b2=1,Vb="[object Arguments]",Xb="[object Array]",Cl="[object Object]",w2=Object.prototype,Zb=w2.hasOwnProperty;function k2(t,e,r,n,i,s){var o=lt(t),a=lt(e),c=o?Xb:kn(t),l=a?Xb:kn(e);c=c==Vb?Cl:c,l=l==Vb?Cl:l;var u=c==Cl,d=l==Cl,f=c==l;if(f&&La(t)){if(!La(e))return!1;o=!0,u=!1}if(f&&!u)return s||(s=new ii),o||id(t)?qb(t,e,r,n,i,s):p2(t,e,c,r,n,i,s);if(!(r&b2)){var h=u&&Zb.call(t,"__wrapped__"),m=d&&Zb.call(e,"__wrapped__");if(h||m){var p=h?t.value():t,g=m?e.value():e;return s||(s=new ii),i(p,g,r,n,s)}}return f?(s||(s=new ii),_2(t,e,r,n,i,s)):!1}function vd(t,e,r,n,i){return t===e?!0:t==null||e==null||!Mn(t)&&!Mn(e)?t!==t&&e!==e:k2(t,e,r,n,vd,i)}var v2=1,x2=2;function E2(t,e,r,n){var i=r.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=r[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=r[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new ii,d;if(!(d===void 0?vd(l,c,v2|x2,n,u):d))return!1}}return!0}function Jb(t){return t===t&&!bn(t)}function A2(t){for(var e=wn(t),r=e.length;r--;){var n=e[r],i=t[n];e[r]=[n,i,Jb(i)]}return e}function Qb(t,e){return function(r){return r==null?!1:r[t]===e&&(e!==void 0||t in Object(r))}}function T2(t){var e=A2(t);return e.length==1&&e[0][2]?Qb(e[0][0],e[0][1]):function(r){return r===t||E2(r,t,e)}}function S2(t,e){return t!=null&&e in Object(t)}function ew(t,e,r){e=Ol(e,t);for(var n=-1,i=e.length,s=!1;++n<i;){var o=Pa(e[n]);if(!(s=t!=null&&r(t,o)))break;t=t[o]}return s||++n!=i?s:(i=t==null?0:t.length,!!i&&rd(i)&&xl(o,i)&&(lt(t)||Al(t)))}function R2(t,e){return t!=null&&ew(t,e,S2)}var O2=1,I2=2;function N2(t,e){return od(t)&&Jb(e)?Qb(Pa(t),e):function(r){var n=K6(r,t);return n===void 0&&n===e?R2(r,t):vd(e,n,O2|I2)}}function C2(t){return function(e){return e?.[t]}}function L2(t){return function(e){return cd(e,t)}}function M2(t){return od(t)?C2(Pa(t)):L2(t)}function si(t){return typeof t=="function"?t:t==null?Eo:typeof t=="object"?lt(t)?N2(t[0],t[1]):T2(t):M2(t)}function U2(t,e,r,n){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(n,o,r(o),t)}return n}function $2(t){return function(e,r,n){for(var i=-1,s=Object(e),o=n(e),a=o.length;a--;){var c=o[++i];if(r(s[c],c,s)===!1)break}return e}}var P2=$2();function F2(t,e){return t&&P2(t,e,wn)}function B2(t,e){return function(r,n){if(r==null)return r;if(!ni(r))return t(r,n);for(var i=r.length,s=-1,o=Object(r);++s<i&&n(o[s],s,o)!==!1;);return r}}var Ss=B2(F2);function D2(t,e,r,n){return Ss(t,function(i,s,o){e(n,i,r(i),o)}),n}function j2(t,e){return function(r,n){var i=lt(r)?U2:D2,s=e?e():{};return i(r,t,si(n),s)}}var tw=Object.prototype,z2=tw.hasOwnProperty,xd=td(function(t,e){t=Object(t);var r=-1,n=e.length,i=n>2?e[2]:void 0;for(i&&ib(e[0],e[1],i)&&(n=1);++r<n;)for(var s=e[r],o=sd(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||Ia(u,tw[l])&&!z2.call(t,l))&&(t[l]=s[l])}return t});function rw(t){return Mn(t)&&ni(t)}var W2=200;function H2(t,e,r,n){var i=-1,s=rb,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=W2&&(s=bd,o=!1,e=new To(e));e:for(;++i<a;){var u=t[i],d=u;if(u=u!==0?u:0,o&&d===d){for(var f=l;f--;)if(e[f]===d)continue e;c.push(u)}else s(e,d,n)||c.push(u)}return c}var Ll=td(function(t,e){return rw(t)?H2(t,ud(e,1,rw,!0)):[]});function So(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function kr(t,e,r){var n=t==null?0:t.length;return n?(e=e===void 0?1:kl(e),hd(t,e<0?0:e,n)):[]}function Ba(t,e,r){var n=t==null?0:t.length;return n?(e=e===void 0?1:kl(e),e=n-e,hd(t,0,e<0?0:e)):[]}function G2(t){return typeof t=="function"?t:Eo}function Ye(t,e){var r=lt(t)?eb:Ss;return r(t,G2(e))}function K2(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(!e(t[r],r,t))return!1;return!0}function q2(t,e){var r=!0;return Ss(t,function(n,i,s){return r=!!e(n,i,s),r}),r}function Un(t,e,r){var n=lt(t)?K2:q2;return n(t,si(e))}function nw(t,e){var r=[];return Ss(t,function(n,i,s){e(n,i,s)&&r.push(n)}),r}function vn(t,e){var r=lt(t)?pd:nw;return r(t,si(e))}function Y2(t){return function(e,r,n){var i=Object(e);if(!ni(e)){var s=si(r);e=wn(e),r=function(a){return s(i[a],a,i)}}var o=t(e,r,n);return o>-1?i[s?e[o]:o]:void 0}}var V2=Math.max;function X2(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=r==null?0:kl(r);return i<0&&(i=V2(n+i,0)),tb(t,si(e),i)}var Ro=Y2(X2);function $n(t){return t&&t.length?t[0]:void 0}function Z2(t,e){var r=-1,n=ni(t)?Array(t.length):[];return Ss(t,function(i,s,o){n[++r]=e(i,s,o)}),n}function $e(t,e){var r=lt(t)?wl:Z2;return r(t,si(e))}function xn(t,e){return ud($e(t,e))}var J2=Object.prototype,Q2=J2.hasOwnProperty,iw=j2(function(t,e,r){Q2.call(t,r)?t[r].push(e):ed(t,r,[e])}),eU=Object.prototype,tU=eU.hasOwnProperty;function rU(t,e){return t!=null&&tU.call(t,e)}function Ke(t,e){return t!=null&&ew(t,e,rU)}var nU="[object String]";function Hr(t){return typeof t=="string"||!lt(t)&&Mn(t)&&Vi(t)==nU}function iU(t,e){return wl(e,function(r){return t[r]})}function Yt(t){return t==null?[]:iU(t,wn(t))}var sU=Math.max;function Ir(t,e,r,n){t=ni(t)?t:Yt(t),r=r?kl(r):0;var i=t.length;return r<0&&(r=sU(i+r,0)),Hr(t)?r<=i&&t.indexOf(e,r)>-1:!!i&&Qf(t,e,r)>-1}function sw(t,e,r){var n=t==null?0:t.length;if(!n)return-1;var i=0;return Qf(t,e,i)}var oU="[object Map]",aU="[object Set]",cU=Object.prototype,lU=cU.hasOwnProperty;function Et(t){if(t==null)return!0;if(ni(t)&&(lt(t)||typeof t=="string"||typeof t.splice=="function"||La(t)||id(t)||Al(t)))return!t.length;var e=kn(t);if(e==oU||e==aU)return!t.size;if(Ca(t))return!pb(t).length;for(var r in t)if(lU.call(t,r))return!1;return!0}var uU="[object RegExp]";function hU(t){return Mn(t)&&Vi(t)==uU}var ow=Xi&&Xi.isRegExp,Ti=ow?Tl(ow):hU;function Si(t){return t===void 0}var fU="Expected a function";function dU(t){if(typeof t!="function")throw new TypeError(fU);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function pU(t,e,r,n){if(!bn(t))return t;e=Ol(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=Pa(e[i]),l=r;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=bn(u)?u:xl(e[i+1])?[]:{})}El(a,c,l),a=a[c]}return t}function mU(t,e,r){for(var n=-1,i=e.length,s={};++n<i;){var o=e[n],a=cd(t,o);r(a,o)&&pU(s,Ol(o,t),a)}return s}function Pn(t,e){if(t==null)return{};var r=wl(UM(t),function(n){return[n]});return e=si(e),mU(t,r,function(n,i){return e(n,i[0])})}function gU(t,e,r,n,i){return i(t,function(s,o,a){r=n?(n=!1,s):e(r,s,o,a)}),r}function Gr(t,e,r){var n=lt(t)?bM:gU,i=arguments.length<3;return n(t,si(e),r,i,Ss)}function Ml(t,e){var r=lt(t)?pd:nw;return r(t,dU(si(e)))}function yU(t,e){var r;return Ss(t,function(n,i,s){return r=e(n,i,s),!r}),!!r}function Ed(t,e,r){var n=lt(t)?Kb:yU;return n(t,si(e))}var _U=1/0,bU=Ao&&1/wd(new Ao([,-0]))[1]==_U?function(t){return new Ao(t)}:er,wU=200;function kU(t,e,r){var n=-1,i=rb,s=t.length,o=!0,a=[],c=a;if(s>=wU){var l=bU(t);if(l)return wd(l);o=!1,i=bd,c=new To}else c=a;e:for(;++n<s;){var u=t[n],d=u;if(u=u!==0?u:0,o&&d===d){for(var f=c.length;f--;)if(c[f]===d)continue e;a.push(u)}else i(c,d,r)||(c!==a&&c.push(d),a.push(u))}return a}function Ul(t){return t&&t.length?kU(t):[]}function Ad(t){console&&console.error&&console.error(`Error: ${t}`)}function aw(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function cw(t){const e=new Date().getTime(),r=t();return{time:new Date().getTime()-e,value:r}}function lw(t){function e(){}e.prototype=t;const r=new e;function n(){return typeof r.bar}return n(),n(),t}function vU(t){return xU(t)?t.LABEL:t.name}function xU(t){return Hr(t.LABEL)&&t.LABEL!==""}class oi{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Ye(this.definition,r=>{r.accept(e)})}}class Kr extends oi{constructor(e){super([]),this.idx=1,Wr(this,Pn(e,r=>r!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Oo extends oi{constructor(e){super(e.definition),this.orgText="",Wr(this,Pn(e,r=>r!==void 0))}}class qr extends oi{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Wr(this,Pn(e,r=>r!==void 0))}}class Yr extends oi{constructor(e){super(e.definition),this.idx=1,Wr(this,Pn(e,r=>r!==void 0))}}class ai extends oi{constructor(e){super(e.definition),this.idx=1,Wr(this,Pn(e,r=>r!==void 0))}}class ci extends oi{constructor(e){super(e.definition),this.idx=1,Wr(this,Pn(e,r=>r!==void 0))}}class tr extends oi{constructor(e){super(e.definition),this.idx=1,Wr(this,Pn(e,r=>r!==void 0))}}class Fn extends oi{constructor(e){super(e.definition),this.idx=1,Wr(this,Pn(e,r=>r!==void 0))}}class Bn extends oi{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Wr(this,Pn(e,r=>r!==void 0))}}class Ct{constructor(e){this.idx=1,Wr(this,Pn(e,r=>r!==void 0))}accept(e){e.visit(this)}}function EU(t){return $e(t,$l)}function $l(t){function e(r){return $e(r,$l)}if(t instanceof Kr){const r={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Hr(t.label)&&(r.label=t.label),r}else{if(t instanceof qr)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Yr)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof ai)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof ci)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:$l(new Ct({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Fn)return{type:"RepetitionWithSeparator",idx:t.idx,separator:$l(new Ct({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof tr)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Bn)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof Ct){const r={type:"Terminal",name:t.terminalType.name,label:vU(t.terminalType),idx:t.idx};Hr(t.label)&&(r.terminalLabel=t.label);const n=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(r.pattern=Ti(n)?n.source:n),r}else{if(t instanceof Oo)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class Rs{visit(e){const r=e;switch(r.constructor){case Kr:return this.visitNonTerminal(r);case qr:return this.visitAlternative(r);case Yr:return this.visitOption(r);case ai:return this.visitRepetitionMandatory(r);case ci:return this.visitRepetitionMandatoryWithSeparator(r);case Fn:return this.visitRepetitionWithSeparator(r);case tr:return this.visitRepetition(r);case Bn:return this.visitAlternation(r);case Ct:return this.visitTerminal(r);case Oo:return this.visitRule(r);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function AU(t){return t instanceof qr||t instanceof Yr||t instanceof tr||t instanceof ai||t instanceof ci||t instanceof Fn||t instanceof Ct||t instanceof Oo}function Pl(t,e=[]){return t instanceof Yr||t instanceof tr||t instanceof Fn?!0:t instanceof Bn?Ed(t.definition,n=>Pl(n,e)):t instanceof Kr&&Ir(e,t)?!1:t instanceof oi?(t instanceof Kr&&e.push(t),Un(t.definition,n=>Pl(n,e))):!1}function TU(t){return t instanceof Bn}function li(t){if(t instanceof Kr)return"SUBRULE";if(t instanceof Yr)return"OPTION";if(t instanceof Bn)return"OR";if(t instanceof ai)return"AT_LEAST_ONE";if(t instanceof ci)return"AT_LEAST_ONE_SEP";if(t instanceof Fn)return"MANY_SEP";if(t instanceof tr)return"MANY";if(t instanceof Ct)return"CONSUME";throw Error("non exhaustive match")}class Fl{walk(e,r=[]){Ye(e.definition,(n,i)=>{const s=kr(e.definition,i+1);if(n instanceof Kr)this.walkProdRef(n,s,r);else if(n instanceof Ct)this.walkTerminal(n,s,r);else if(n instanceof qr)this.walkFlat(n,s,r);else if(n instanceof Yr)this.walkOption(n,s,r);else if(n instanceof ai)this.walkAtLeastOne(n,s,r);else if(n instanceof ci)this.walkAtLeastOneSep(n,s,r);else if(n instanceof Fn)this.walkManySep(n,s,r);else if(n instanceof tr)this.walkMany(n,s,r);else if(n instanceof Bn)this.walkOr(n,s,r);else throw Error("non exhaustive match")})}walkTerminal(e,r,n){}walkProdRef(e,r,n){}walkFlat(e,r,n){const i=r.concat(n);this.walk(e,i)}walkOption(e,r,n){const i=r.concat(n);this.walk(e,i)}walkAtLeastOne(e,r,n){const i=[new Yr({definition:e.definition})].concat(r,n);this.walk(e,i)}walkAtLeastOneSep(e,r,n){const i=uw(e,r,n);this.walk(e,i)}walkMany(e,r,n){const i=[new Yr({definition:e.definition})].concat(r,n);this.walk(e,i)}walkManySep(e,r,n){const i=uw(e,r,n);this.walk(e,i)}walkOr(e,r,n){const i=r.concat(n);Ye(e.definition,s=>{const o=new qr({definition:[s]});this.walk(o,i)})}}function uw(t,e,r){return[new Yr({definition:[new Ct({terminalType:t.separator})].concat(t.definition)})].concat(e,r)}function Da(t){if(t instanceof Kr)return Da(t.referencedRule);if(t instanceof Ct)return OU(t);if(AU(t))return SU(t);if(TU(t))return RU(t);throw Error("non exhaustive match")}function SU(t){let e=[];const r=t.definition;let n=0,i=r.length>n,s,o=!0;for(;i&&o;)s=r[n],o=Pl(s),e=e.concat(Da(s)),n=n+1,i=r.length>n;return Ul(e)}function RU(t){const e=$e(t.definition,r=>Da(r));return Ul(on(e))}function OU(t){return[t.terminalType]}const hw="_~IN~_";class IU extends Fl{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,r,n){}walkProdRef(e,r,n){const i=CU(e.referencedRule,e.idx)+this.topProd.name,s=r.concat(n),o=new qr({definition:s}),a=Da(o);this.follows[i]=a}}function NU(t){const e={};return Ye(t,r=>{const n=new IU(r).startWalking();Wr(e,n)}),e}function CU(t,e){return t.name+e+hw}function Ve(t){return t.charCodeAt(0)}function Td(t,e){Array.isArray(t)?t.forEach(function(r){e.push(r)}):e.push(t)}function ja(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Io(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function LU(){throw Error("Internal Error - Should never get here!")}function fw(t){return t.type==="Character"}const Bl=[];for(let t=Ve("0");t<=Ve("9");t++)Bl.push(t);const Dl=[Ve("_")].concat(Bl);for(let t=Ve("a");t<=Ve("z");t++)Dl.push(t);for(let t=Ve("A");t<=Ve("Z");t++)Dl.push(t);const dw=[Ve(" "),Ve("\f"),Ve(`
`),Ve("\r"),Ve("	"),Ve("\v"),Ve("	"),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve(" "),Ve("\u2028"),Ve("\u2029"),Ve(" "),Ve(" "),Ve("　"),Ve("\uFEFF")],MU=/[0-9a-fA-F]/,jl=/[0-9]/,UU=/[1-9]/;class $U{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const r=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ja(n,"global");break;case"i":ja(n,"ignoreCase");break;case"m":ja(n,"multiLine");break;case"u":ja(n,"unicode");break;case"y":ja(n,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:r,loc:this.loc(0)}}disjunction(){const e=[],r=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(r)}}alternative(){const e=[],r=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(r)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let r;switch(this.popChar()){case"=":r="Lookahead";break;case"!":r="NegativeLookahead";break}Io(r);const n=this.disjunction();return this.consumeChar(")"),{type:r,value:n,loc:this.loc(e)}}return LU()}quantifier(e=!1){let r;const n=this.idx;switch(this.popChar()){case"*":r={atLeast:0,atMost:1/0};break;case"+":r={atLeast:1,atMost:1/0};break;case"?":r={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":r={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),r={atLeast:i,atMost:s}):r={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&r===void 0)return;Io(r);break}if(!(e===!0&&r===void 0)&&Io(r))return this.peekChar(0)==="?"?(this.consumeChar("?"),r.greedy=!1):r.greedy=!0,r.type="Quantifier",r.loc=this.loc(n),r}atom(){let e;const r=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Io(e))return e.loc=this.loc(r),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Ve(`
`),Ve("\r"),Ve("\u2028"),Ve("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,r=!1;switch(this.popChar()){case"d":e=Bl;break;case"D":e=Bl,r=!0;break;case"s":e=dw;break;case"S":e=dw,r=!0;break;case"w":e=Dl;break;case"W":e=Dl,r=!0;break}if(Io(e))return{type:"Set",value:e,complement:r}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=Ve("\f");break;case"n":e=Ve(`
`);break;case"r":e=Ve("\r");break;case"t":e=Ve("	");break;case"v":e=Ve("\v");break}if(Io(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Ve("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:Ve(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:Ve(e)}}}characterClass(){const e=[];let r=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),r=!0);this.isClassAtom();){const n=this.classAtom();if(n.type,fw(n)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,fw(i)){if(i.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:i.value})}else Td(n.value,e),e.push(Ve("-")),Td(i.value,e)}else Td(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:r,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Ve("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const r=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:e,value:r};return e&&(n.idx=this.groupIdx),n}positiveInteger(){let e=this.popChar();if(UU.test(e)===!1)throw Error("Expecting a positive integer");for(;jl.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(jl.test(e)===!1)throw Error("Expecting an integer");for(;jl.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Ve(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return jl.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let r="";for(let i=0;i<e;i++){const s=this.popChar();if(MU.test(s)===!1)throw Error("Expecting a HexDecimal digits");r+=s}return{type:"Character",value:parseInt(r,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class Sd{visitChildren(e){for(const r in e){const n=e[r];e.hasOwnProperty(r)&&(n.type!==void 0?this.visit(n):Array.isArray(n)&&n.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let zl={};const PU=new $U;function Wl(t){const e=t.toString();if(zl.hasOwnProperty(e))return zl[e];{const r=PU.pattern(e);return zl[e]=r,r}}function FU(){zl={}}const pw="Complement Sets are not supported for first char optimization",Hl=`Unable to use "first char" lexer optimizations:
`;function BU(t,e=!1){try{const r=Wl(t);return Rd(r.value,{},r.flags.ignoreCase)}catch(r){if(r.message===pw)e&&aw(`${Hl}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let n="";e&&(n=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Ad(`${Hl}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+n)}}return[]}function Rd(t,e,r){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)Rd(t.value[i],e,r);break;case"Alternative":const n=t.value;for(let i=0;i<n.length;i++){const s=n[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Gl(o.value,e,r);break;case"Set":if(o.complement===!0)throw Error(pw);Ye(o.value,c=>{if(typeof c=="number")Gl(c,e,r);else{const l=c;if(r===!0)for(let u=l.from;u<=l.to;u++)Gl(u,e,r);else{for(let u=l.from;u<=l.to&&u<Wa;u++)Gl(u,e,r);if(l.to>=Wa){const u=l.from>=Wa?l.from:Wa,d=l.to,f=Zi(u),h=Zi(d);for(let m=f;m<=h;m++)e[m]=m}}}});break;case"Group":Rd(o.value,e,r);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Od(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Yt(e)}function Gl(t,e,r){const n=Zi(t);e[n]=n,r===!0&&DU(t,e)}function DU(t,e){const r=String.fromCharCode(t),n=r.toUpperCase();if(n!==r){const i=Zi(n.charCodeAt(0));e[i]=i}else{const i=r.toLowerCase();if(i!==r){const s=Zi(i.charCodeAt(0));e[s]=s}}}function mw(t,e){return Ro(t.value,r=>{if(typeof r=="number")return Ir(e,r);{const n=r;return Ro(e,i=>n.from<=i&&i<=n.to)!==void 0}})}function Od(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?lt(t.value)?Un(t.value,Od):Od(t.value):!1}class jU extends Sd{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Ir(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?mw(e,this.targetCharCodes)===void 0&&(this.found=!0):mw(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Id(t,e){if(e instanceof RegExp){const r=Wl(e),n=new jU(t);return n.visit(r),n.found}else return Ro(e,r=>Ir(t,r.charCodeAt(0)))!==void 0}const Os="PATTERN",za="defaultMode",Kl="modes";let gw=typeof new RegExp("(?:)").sticky=="boolean";function zU(t,e){e=xd(e,{useSticky:gw,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(b,A)=>A()});const r=e.tracer;r("initCharCodeToOptimizedIndexMap",()=>{h8()});let n;r("Reject Lexer.NA",()=>{n=Ml(t,b=>b[Os]===lr.NA)});let i=!1,s;r("Transform Patterns",()=>{i=!1,s=$e(n,b=>{const A=b[Os];if(Ti(A)){const R=A.source;return R.length===1&&R!=="^"&&R!=="$"&&R!=="."&&!A.ignoreCase?R:R.length===2&&R[0]==="\\"&&!Ir(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],R[1])?R[1]:e.useSticky?_w(A):yw(A)}else{if(xi(A))return i=!0,{exec:A};if(typeof A=="object")return i=!0,A;if(typeof A=="string"){if(A.length===1)return A;{const R=A.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),E=new RegExp(R);return e.useSticky?_w(E):yw(E)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;r("misc mapping",()=>{o=$e(n,b=>b.tokenTypeIdx),a=$e(n,b=>{const A=b.GROUP;if(A!==lr.SKIPPED){if(Hr(A))return A;if(Si(A))return!1;throw Error("non exhaustive match")}}),c=$e(n,b=>{const A=b.LONGER_ALT;if(A)return lt(A)?$e(A,E=>sw(n,E)):[sw(n,A)]}),l=$e(n,b=>b.PUSH_MODE),u=$e(n,b=>Ke(b,"POP_MODE"))});let d;r("Line Terminator Handling",()=>{const b=kw(e.lineTerminatorCharacters);d=$e(n,A=>!1),e.positionTracking!=="onlyOffset"&&(d=$e(n,A=>Ke(A,"LINE_BREAKS")?!!A.LINE_BREAKS:ww(A,b)===!1&&Id(b,A.PATTERN)))});let f,h,m,p;r("Misc Mapping #2",()=>{f=$e(n,bw),h=$e(s,c8),m=Gr(n,(b,A)=>{const R=A.GROUP;return Hr(R)&&R!==lr.SKIPPED&&(b[R]=[]),b},{}),p=$e(s,(b,A)=>({pattern:s[A],longerAlt:c[A],canLineTerminator:d[A],isCustom:f[A],short:h[A],group:a[A],push:l[A],pop:u[A],tokenTypeIdx:o[A],tokenType:n[A]}))});let g=!0,y=[];return e.safeMode||r("First Char Optimization",()=>{y=Gr(n,(b,A,R)=>{if(typeof A.PATTERN=="string"){const E=A.PATTERN.charCodeAt(0),M=Zi(E);Nd(b,M,p[R])}else if(lt(A.START_CHARS_HINT)){let E;Ye(A.START_CHARS_HINT,M=>{const S=typeof M=="string"?M.charCodeAt(0):M,P=Zi(S);E!==P&&(E=P,Nd(b,P,p[R]))})}else if(Ti(A.PATTERN))if(A.PATTERN.unicode)g=!1,e.ensureOptimizations&&Ad(`${Hl}	Unable to analyze < ${A.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const E=BU(A.PATTERN,e.ensureOptimizations);Et(E)&&(g=!1),Ye(E,M=>{Nd(b,M,p[R])})}else e.ensureOptimizations&&Ad(`${Hl}	TokenType: <${A.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),g=!1;return b},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:g}}function WU(t,e){let r=[];const n=GU(t);r=r.concat(n.errors);const i=KU(n.valid),s=i.valid;return r=r.concat(i.errors),r=r.concat(HU(s)),r=r.concat(e8(s)),r=r.concat(t8(s,e)),r=r.concat(r8(s)),r}function HU(t){let e=[];const r=vn(t,n=>Ti(n[Os]));return e=e.concat(YU(r)),e=e.concat(ZU(r)),e=e.concat(JU(r)),e=e.concat(QU(r)),e=e.concat(VU(r)),e}function GU(t){const e=vn(t,i=>!Ke(i,Os)),r=$e(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Ut.MISSING_PATTERN,tokenTypes:[i]})),n=Ll(t,e);return{errors:r,valid:n}}function KU(t){const e=vn(t,i=>{const s=i[Os];return!Ti(s)&&!xi(s)&&!Ke(s,"exec")&&!Hr(s)}),r=$e(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Ut.INVALID_PATTERN,tokenTypes:[i]})),n=Ll(t,e);return{errors:r,valid:n}}const qU=/[^\\][$]/;function YU(t){class e extends Sd{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const r=vn(t,i=>{const s=i.PATTERN;try{const o=Wl(s),a=new e;return a.visit(o),a.found}catch{return qU.test(s.source)}});return $e(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ut.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function VU(t){const e=vn(t,n=>n.PATTERN.test(""));return $e(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' must not match an empty string",type:Ut.EMPTY_MATCH_PATTERN,tokenTypes:[n]}))}const XU=/[^\\[][\^]|^\^/;function ZU(t){class e extends Sd{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const r=vn(t,i=>{const s=i.PATTERN;try{const o=Wl(s),a=new e;return a.visit(o),a.found}catch{return XU.test(s.source)}});return $e(r,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Ut.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function JU(t){const e=vn(t,n=>{const i=n[Os];return i instanceof RegExp&&(i.multiline||i.global)});return $e(e,n=>({message:"Token Type: ->"+n.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Ut.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[n]}))}function QU(t){const e=[];let r=$e(t,s=>Gr(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Ir(e,a)&&a.PATTERN!==lr.NA&&(e.push(a),o.push(a)),o),[]));r=Fa(r);const n=vn(r,s=>s.length>1);return $e(n,s=>{const o=$e(s,c=>c.name);return{message:`The same RegExp pattern ->${$n(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Ut.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function e8(t){const e=vn(t,n=>{if(!Ke(n,"GROUP"))return!1;const i=n.GROUP;return i!==lr.SKIPPED&&i!==lr.NA&&!Hr(i)});return $e(e,n=>({message:"Token Type: ->"+n.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Ut.INVALID_GROUP_TYPE_FOUND,tokenTypes:[n]}))}function t8(t,e){const r=vn(t,i=>i.PUSH_MODE!==void 0&&!Ir(e,i.PUSH_MODE));return $e(r,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Ut.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function r8(t){const e=[],r=Gr(t,(n,i,s)=>{const o=i.PATTERN;return o===lr.NA||(Hr(o)?n.push({str:o,idx:s,tokenType:i}):Ti(o)&&i8(o)&&n.push({str:o.source,idx:s,tokenType:i})),n},[]);return Ye(t,(n,i)=>{Ye(r,({str:s,idx:o,tokenType:a})=>{if(i<o&&n8(s,n.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${n.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:Ut.UNREACHABLE_PATTERN,tokenTypes:[n,a]})}})}),e}function n8(t,e){if(Ti(e)){const r=e.exec(t);return r!==null&&r.index===0}else{if(xi(e))return e(t,0,[],{});if(Ke(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function i8(t){return Ro([".","\\","[","]","|","^","$","(",")","?","*","+","{"],r=>t.source.indexOf(r)!==-1)===void 0}function yw(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function _w(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function s8(t,e,r){const n=[];return Ke(t,za)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+za+`> property in its definition
`,type:Ut.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Ke(t,Kl)||n.push({message:"A MultiMode Lexer cannot be initialized without a <"+Kl+`> property in its definition
`,type:Ut.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Ke(t,Kl)&&Ke(t,za)&&!Ke(t.modes,t.defaultMode)&&n.push({message:`A MultiMode Lexer cannot be initialized with a ${za}: <${t.defaultMode}>which does not exist
`,type:Ut.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Ke(t,Kl)&&Ye(t.modes,(i,s)=>{Ye(i,(o,a)=>{if(Si(o))n.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Ut.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Ke(o,"LONGER_ALT")){const c=lt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ye(c,l=>{!Si(l)&&!Ir(i,l)&&n.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Ut.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),n}function o8(t,e,r){const n=[];let i=!1;const s=Fa(on(Yt(t.modes))),o=Ml(s,c=>c[Os]===lr.NA),a=kw(r);return e&&Ye(o,c=>{const l=ww(c,a);if(l!==!1){const d={message:u8(c,l),type:l.issue,tokenType:c};n.push(d)}else Ke(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Id(a,c.PATTERN)&&(i=!0)}),e&&!i&&n.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Ut.NO_LINE_BREAKS_FLAGS}),n}function a8(t){const e={},r=wn(t);return Ye(r,n=>{const i=t[n];if(lt(i))e[n]=[];else throw Error("non exhaustive match")}),e}function bw(t){const e=t.PATTERN;if(Ti(e))return!1;if(xi(e))return!0;if(Ke(e,"exec"))return!0;if(Hr(e))return!1;throw Error("non exhaustive match")}function c8(t){return Hr(t)&&t.length===1?t.charCodeAt(0):!1}const l8={test:function(t){const e=t.length;for(let r=this.lastIndex;r<e;r++){const n=t.charCodeAt(r);if(n===10)return this.lastIndex=r+1,!0;if(n===13)return t.charCodeAt(r+1)===10?this.lastIndex=r+2:this.lastIndex=r+1,!0}return!1},lastIndex:0};function ww(t,e){if(Ke(t,"LINE_BREAKS"))return!1;if(Ti(t.PATTERN)){try{Id(e,t.PATTERN)}catch(r){return{issue:Ut.IDENTIFY_TERMINATOR,errMsg:r.message}}return!1}else{if(Hr(t.PATTERN))return!1;if(bw(t))return{issue:Ut.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function u8(t,e){if(e.issue===Ut.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===Ut.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function kw(t){return $e(t,r=>Hr(r)?r.charCodeAt(0):r)}function Nd(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}const Wa=256;let ql=[];function Zi(t){return t<Wa?t:ql[t]}function h8(){if(Et(ql)){ql=new Array(65536);for(let t=0;t<65536;t++)ql[t]=t>255?255+~~(t/255):t}}function Ha(t,e){const r=t.tokenTypeIdx;return r===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[r]===!0}function Yl(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let vw=1;const xw={};function Ga(t){const e=f8(t);d8(e),m8(e),p8(e),Ye(e,r=>{r.isParent=r.categoryMatches.length>0})}function f8(t){let e=wr(t),r=t,n=!0;for(;n;){r=Fa(on($e(r,s=>s.CATEGORIES)));const i=Ll(r,e);e=e.concat(i),Et(i)?n=!1:r=i}return e}function d8(t){Ye(t,e=>{Aw(e)||(xw[vw]=e,e.tokenTypeIdx=vw++),Tw(e)&&!lt(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Tw(e)||(e.CATEGORIES=[]),g8(e)||(e.categoryMatches=[]),y8(e)||(e.categoryMatchesMap={})})}function p8(t){Ye(t,e=>{e.categoryMatches=[],Ye(e.categoryMatchesMap,(r,n)=>{e.categoryMatches.push(xw[n].tokenTypeIdx)})})}function m8(t){Ye(t,e=>{Ew([],e)})}function Ew(t,e){Ye(t,r=>{e.categoryMatchesMap[r.tokenTypeIdx]=!0}),Ye(e.CATEGORIES,r=>{const n=t.concat(e);Ir(n,r)||Ew(n,r)})}function Aw(t){return Ke(t,"tokenTypeIdx")}function Tw(t){return Ke(t,"CATEGORIES")}function g8(t){return Ke(t,"categoryMatches")}function y8(t){return Ke(t,"categoryMatchesMap")}function _8(t){return Ke(t,"tokenTypeIdx")}const b8={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,r,n,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${r} characters.`}};var Ut;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Ut||(Ut={}));const Ka={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:b8,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Ka);let lr=class{constructor(e,r=Ka){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=cw(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof r=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Wr({},Ka,r);const n=this.config.traceInitPerf;n===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof n=="number"&&(this.traceInitMaxIdent=n,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Ka.lineTerminatorsPattern)this.config.lineTerminatorsPattern=l8;else if(this.config.lineTerminatorCharacters===Ka.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(r.safeMode&&r.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),lt(e)?i={modes:{defaultMode:wr(e)},defaultMode:za}:(s=!1,i=wr(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(s8(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(o8(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ye(i.modes,(a,c)=>{i.modes[c]=Ml(a,l=>Si(l))});const o=wn(i.modes);if(Ye(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(WU(a,o))}),Et(this.lexerDefinitionErrors)){Ga(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=zU(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:r.positionTracking,ensureOptimizations:r.ensureOptimizations,safeMode:r.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Wr({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Et(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=$e(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ye(this.lexerDefinitionWarning,a=>{aw(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(gw?(this.chopInput=Eo,this.match=this.matchWithTest):(this.updateLastIndex=er,this.match=this.matchWithExec),s&&(this.handleModes=er),this.trackStartLines===!1&&(this.computeNewColumn=Eo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=er),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Gr(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(r.ensureOptimizations&&!Et(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{FU()}),this.TRACE_INIT("toFastProperties",()=>{lw(this)})})}tokenize(e,r=this.defaultMode){if(!Et(this.lexerDefinitionErrors)){const i=$e(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,r)}tokenizeInternal(e,r){let n,i,s,o,a,c,l,u,d,f,h,m,p,g,y;const b=e,A=b.length;let R=0,E=0;const M=this.hasCustom?0:Math.floor(e.length/10),S=new Array(M),P=[];let W=this.trackStartLines?1:void 0,D=this.trackStartLines?1:void 0;const G=a8(this.emptyGroups),O=this.trackStartLines,I=this.config.lineTerminatorsPattern;let k=0,C=[],z=[];const F=[],Q=[];Object.freeze(Q);let Y;function N(){return C}function U(fe){const Ee=Zi(fe),ke=z[Ee];return ke===void 0?Q:ke}const $=fe=>{if(F.length===1&&fe.tokenType.PUSH_MODE===void 0){const Ee=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(fe);P.push({offset:fe.startOffset,line:fe.startLine,column:fe.startColumn,length:fe.image.length,message:Ee})}else{F.pop();const Ee=So(F);C=this.patternIdxToConfig[Ee],z=this.charCodeToPatternIdxToConfig[Ee],k=C.length;const ke=this.canModeBeOptimized[Ee]&&this.config.safeMode===!1;z&&ke?Y=U:Y=N}};function V(fe){F.push(fe),z=this.charCodeToPatternIdxToConfig[fe],C=this.patternIdxToConfig[fe],k=C.length,k=C.length;const Ee=this.canModeBeOptimized[fe]&&this.config.safeMode===!1;z&&Ee?Y=U:Y=N}V.call(this,r);let q;const J=this.config.recoveryEnabled;for(;R<A;){c=null;const fe=b.charCodeAt(R),Ee=Y(fe),ke=Ee.length;for(n=0;n<ke;n++){q=Ee[n];const xe=q.pattern;l=null;const Ae=q.short;if(Ae!==!1?fe===Ae&&(c=xe):q.isCustom===!0?(y=xe.exec(b,R,S,G),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(xe,R),c=this.match(xe,e,R)),c!==null){if(a=q.longerAlt,a!==void 0){const Se=a.length;for(s=0;s<Se;s++){const Me=C[a[s]],je=Me.pattern;if(u=null,Me.isCustom===!0?(y=je.exec(b,R,S,G),y!==null?(o=y[0],y.payload!==void 0&&(u=y.payload)):o=null):(this.updateLastIndex(je,R),o=this.match(je,e,R)),o&&o.length>c.length){c=o,l=u,q=Me;break}}}break}}if(c!==null){if(d=c.length,f=q.group,f!==void 0&&(h=q.tokenTypeIdx,m=this.createTokenInstance(c,R,h,q.tokenType,W,D,d),this.handlePayload(m,l),f===!1?E=this.addToken(S,E,m):G[f].push(m)),e=this.chopInput(e,d),R=R+d,D=this.computeNewColumn(D,d),O===!0&&q.canLineTerminator===!0){let xe=0,Ae,Se;I.lastIndex=0;do Ae=I.test(c),Ae===!0&&(Se=I.lastIndex-1,xe++);while(Ae===!0);xe!==0&&(W=W+xe,D=d-Se,this.updateTokenEndLineColumnLocation(m,f,Se,xe,W,D,d))}this.handleModes(q,$,V,m)}else{const xe=R,Ae=W,Se=D;let Me=J===!1;for(;Me===!1&&R<A;)for(e=this.chopInput(e,1),R++,i=0;i<k;i++){const je=C[i],T=je.pattern,he=je.short;if(he!==!1?b.charCodeAt(R)===he&&(Me=!0):je.isCustom===!0?Me=T.exec(b,R,S,G)!==null:(this.updateLastIndex(T,R),Me=T.exec(e)!==null),Me===!0)break}if(p=R-xe,D=this.computeNewColumn(D,p),g=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(b,xe,p,Ae,Se),P.push({offset:xe,line:Ae,column:Se,length:p,message:g}),J===!1)break}}return this.hasCustom||(S.length=E),{tokens:S,groups:G,errors:P}}handleModes(e,r,n,i){if(e.pop===!0){const s=e.push;r(i),s!==void 0&&n.call(this,s)}else e.push!==void 0&&n.call(this,e.push)}chopInput(e,r){return e.substring(r)}updateLastIndex(e,r){e.lastIndex=r}updateTokenEndLineColumnLocation(e,r,n,i,s,o,a){let c,l;r!==void 0&&(c=n===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,r){return e+r}createOffsetOnlyToken(e,r,n,i){return{image:e,startOffset:r,tokenTypeIdx:n,tokenType:i}}createStartOnlyToken(e,r,n,i,s,o){return{image:e,startOffset:r,startLine:s,startColumn:o,tokenTypeIdx:n,tokenType:i}}createFullToken(e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:r+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:i}}addTokenUsingPush(e,r,n){return e.push(n),r}addTokenUsingMemberAccess(e,r,n){return e[r]=n,r++,r}handlePayloadNoCustom(e,r){}handlePayloadWithCustom(e,r){r!==null&&(e.payload=r)}matchWithTest(e,r,n){return e.test(r)===!0?r.substring(n,e.lastIndex):null}matchWithExec(e,r){const n=e.exec(r);return n!==null?n[0]:null}};lr.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",lr.NA=/NOT_APPLICABLE/;function qa(t){return Sw(t)?t.LABEL:t.name}function Sw(t){return Hr(t.LABEL)&&t.LABEL!==""}const w8="parent",Rw="categories",Ow="label",Iw="group",Nw="push_mode",Cw="pop_mode",Lw="longer_alt",Mw="line_breaks",Uw="start_chars_hint";function an(t){return k8(t)}function k8(t){const e=t.pattern,r={};if(r.name=t.name,Si(e)||(r.PATTERN=e),Ke(t,w8))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Ke(t,Rw)&&(r.CATEGORIES=t[Rw]),Ga([r]),Ke(t,Ow)&&(r.LABEL=t[Ow]),Ke(t,Iw)&&(r.GROUP=t[Iw]),Ke(t,Cw)&&(r.POP_MODE=t[Cw]),Ke(t,Nw)&&(r.PUSH_MODE=t[Nw]),Ke(t,Lw)&&(r.LONGER_ALT=t[Lw]),Ke(t,Mw)&&(r.LINE_BREAKS=t[Mw]),Ke(t,Uw)&&(r.START_CHARS_HINT=t[Uw]),r}const Is=an({name:"EOF",pattern:lr.NA});Ga([Is]);function Vl(t,e,r,n,i,s,o,a){return{image:e,startOffset:r,endOffset:n,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function v8(t,e){return Ha(t,e)}const $w={buildMismatchTokenMessage({expected:t,actual:e,previous:r,ruleName:n}){return`Expecting ${Sw(t)?`--> ${qa(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:r,customUserDescription:n,ruleName:i}){const s="Expecting: ",a=`
but found: '`+$n(e).image+"'";if(n)return s+n+a;{const c=Gr(t,(f,h)=>f.concat(h),[]),l=$e(c,f=>`[${$e(f,h=>qa(h)).join(", ")}]`),d=`one of these possible Token sequences:
${$e(l,(f,h)=>`  ${h+1}. ${f}`).join(`
`)}`;return s+d+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:r,ruleName:n}){const i="Expecting: ",o=`
but found: '`+$n(e).image+"'";if(r)return i+r+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${$e(t,l=>`[${$e(l,u=>qa(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze($w);const x8={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Ns={buildDuplicateFoundError(t,e){function r(u){return u instanceof Ct?u.terminalType.name:u instanceof Kr?u.nonTerminalName:""}const n=t.name,i=$n(e),s=i.idx,o=li(i),a=r(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=$e(t.prefixPath,i=>qa(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=$e(t.prefixPath,i=>qa(i)).join(", "),r=t.alternation.idx===0?"":t.alternation.idx;let n=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${r}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return n=n+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,n},buildEmptyRepetitionError(t){let e=li(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,r=$e(t.leftRecursionPath,s=>s.name),n=`${e} --> ${r.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${n}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Oo?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function E8(t,e){const r=new A8(t,e);return r.resolveRefs(),r.errors}class A8 extends Rs{constructor(e,r){super(),this.nameToTopRule=e,this.errMsgProvider=r,this.errors=[]}resolveRefs(){Ye(Yt(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const r=this.nameToTopRule[e.nonTerminalName];if(r)e.referencedRule=r;else{const n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:Nr.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class T8 extends Fl{constructor(e,r){super(),this.topProd=e,this.path=r,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=wr(this.path.ruleStack).reverse(),this.occurrenceStack=wr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,r=[]){this.found||super.walk(e,r)}walkProdRef(e,r,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=r.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Et(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class S8 extends T8{constructor(e,r){super(e,r),this.path=r,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,r,n){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=r.concat(n),s=new qr({definition:i});this.possibleTokTypes=Da(s),this.found=!0}}}class Xl extends Fl{constructor(e,r){super(),this.topRule=e,this.occurrence=r,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class R8 extends Xl{walkMany(e,r,n){if(e.idx===this.occurrence){const i=$n(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Ct&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,r,n)}}class Pw extends Xl{walkManySep(e,r,n){if(e.idx===this.occurrence){const i=$n(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Ct&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,r,n)}}class O8 extends Xl{walkAtLeastOne(e,r,n){if(e.idx===this.occurrence){const i=$n(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Ct&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,r,n)}}class Fw extends Xl{walkAtLeastOneSep(e,r,n){if(e.idx===this.occurrence){const i=$n(r.concat(n));this.result.isEndOfRule=i===void 0,i instanceof Ct&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,r,n)}}function Cd(t,e,r=[]){r=wr(r);let n=[],i=0;function s(a){return a.concat(kr(t,i+1))}function o(a){const c=Cd(s(a),e,r);return n.concat(c)}for(;r.length<e&&i<t.length;){const a=t[i];if(a instanceof qr)return o(a.definition);if(a instanceof Kr)return o(a.definition);if(a instanceof Yr)n=o(a.definition);else if(a instanceof ai){const c=a.definition.concat([new tr({definition:a.definition})]);return o(c)}else if(a instanceof ci){const c=[new qr({definition:a.definition}),new tr({definition:[new Ct({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Fn){const c=a.definition.concat([new tr({definition:[new Ct({terminalType:a.separator})].concat(a.definition)})]);n=o(c)}else if(a instanceof tr){const c=a.definition.concat([new tr({definition:a.definition})]);n=o(c)}else{if(a instanceof Bn)return Ye(a.definition,c=>{Et(c.definition)===!1&&(n=o(c.definition))}),n;if(a instanceof Ct)r.push(a.terminalType);else throw Error("non exhaustive match")}i++}return n.push({partialPath:r,suffixDef:kr(t,i)}),n}function Bw(t,e,r,n){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-n-1,u=[],d=[];for(d.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Et(d);){const f=d.pop();if(f===o){a&&So(d).idx<=l&&d.pop();continue}const h=f.def,m=f.idx,p=f.ruleStack,g=f.occurrenceStack;if(Et(h))continue;const y=h[0];if(y===i){const b={idx:m,def:kr(h),ruleStack:Ba(p),occurrenceStack:Ba(g)};d.push(b)}else if(y instanceof Ct)if(m<c-1){const b=m+1,A=e[b];if(r(A,y.terminalType)){const R={idx:b,def:kr(h),ruleStack:p,occurrenceStack:g};d.push(R)}}else if(m===c-1)u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:p,occurrenceStack:g}),a=!0;else throw Error("non exhaustive match");else if(y instanceof Kr){const b=wr(p);b.push(y.nonTerminalName);const A=wr(g);A.push(y.idx);const R={idx:m,def:y.definition.concat(s,kr(h)),ruleStack:b,occurrenceStack:A};d.push(R)}else if(y instanceof Yr){const b={idx:m,def:kr(h),ruleStack:p,occurrenceStack:g};d.push(b),d.push(o);const A={idx:m,def:y.definition.concat(kr(h)),ruleStack:p,occurrenceStack:g};d.push(A)}else if(y instanceof ai){const b=new tr({definition:y.definition,idx:y.idx}),A=y.definition.concat([b],kr(h)),R={idx:m,def:A,ruleStack:p,occurrenceStack:g};d.push(R)}else if(y instanceof ci){const b=new Ct({terminalType:y.separator}),A=new tr({definition:[b].concat(y.definition),idx:y.idx}),R=y.definition.concat([A],kr(h)),E={idx:m,def:R,ruleStack:p,occurrenceStack:g};d.push(E)}else if(y instanceof Fn){const b={idx:m,def:kr(h),ruleStack:p,occurrenceStack:g};d.push(b),d.push(o);const A=new Ct({terminalType:y.separator}),R=new tr({definition:[A].concat(y.definition),idx:y.idx}),E=y.definition.concat([R],kr(h)),M={idx:m,def:E,ruleStack:p,occurrenceStack:g};d.push(M)}else if(y instanceof tr){const b={idx:m,def:kr(h),ruleStack:p,occurrenceStack:g};d.push(b),d.push(o);const A=new tr({definition:y.definition,idx:y.idx}),R=y.definition.concat([A],kr(h)),E={idx:m,def:R,ruleStack:p,occurrenceStack:g};d.push(E)}else if(y instanceof Bn)for(let b=y.definition.length-1;b>=0;b--){const A=y.definition[b],R={idx:m,def:A.definition.concat(kr(h)),ruleStack:p,occurrenceStack:g};d.push(R),d.push(o)}else if(y instanceof qr)d.push({idx:m,def:y.definition.concat(kr(h)),ruleStack:p,occurrenceStack:g});else if(y instanceof Oo)d.push(I8(y,m,p,g));else throw Error("non exhaustive match")}return u}function I8(t,e,r,n){const i=wr(r);i.push(t.name);const s=wr(n);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var $t;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})($t||($t={}));function Dw(t){if(t instanceof Yr||t==="Option")return $t.OPTION;if(t instanceof tr||t==="Repetition")return $t.REPETITION;if(t instanceof ai||t==="RepetitionMandatory")return $t.REPETITION_MANDATORY;if(t instanceof ci||t==="RepetitionMandatoryWithSeparator")return $t.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Fn||t==="RepetitionWithSeparator")return $t.REPETITION_WITH_SEPARATOR;if(t instanceof Bn||t==="Alternation")return $t.ALTERNATION;throw Error("non exhaustive match")}function N8(t,e,r,n,i,s){const o=Md(t,e,r),a=Hw(o)?Yl:Ha;return s(o,n,a,i)}function C8(t,e,r,n,i,s){const o=Ud(t,e,i,r),a=Hw(o)?Yl:Ha;return s(o[0],a,n)}function L8(t,e,r,n){const i=t.length,s=Un(t,o=>Un(o,a=>a.length===1));if(e)return function(o){const a=$e(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,d=a[c];if(!(d!==void 0&&d.call(this)===!1))e:for(let f=0;f<u;f++){const h=l[f],m=h.length;for(let p=0;p<m;p++){const g=this.LA(p+1);if(r(g,h[p])===!1)continue e}return c}}};if(s&&!n){const o=$e(t,c=>on(c)),a=Gr(o,(c,l,u)=>(Ye(l,d=>{Ke(c,d.tokenTypeIdx)||(c[d.tokenTypeIdx]=u),Ye(d.categoryMatches,f=>{Ke(c,f)||(c[f]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],d=u.length;for(let f=0;f<d;f++){const h=this.LA(f+1);if(r(h,u[f])===!1)continue e}return o}}}}function M8(t,e,r){const n=Un(t,s=>s.length===1),i=t.length;if(n&&!r){const s=on(t);if(s.length===1&&Et(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Gr(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ye(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class U8 extends Fl{constructor(e,r,n){super(),this.topProd=e,this.targetOccurrence=r,this.targetProdType=n}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,r,n,i){return e.idx===this.targetOccurrence&&this.targetProdType===r?(this.restDef=n.concat(i),!0):!1}walkOption(e,r,n){this.checkIsTarget(e,$t.OPTION,r,n)||super.walkOption(e,r,n)}walkAtLeastOne(e,r,n){this.checkIsTarget(e,$t.REPETITION_MANDATORY,r,n)||super.walkOption(e,r,n)}walkAtLeastOneSep(e,r,n){this.checkIsTarget(e,$t.REPETITION_MANDATORY_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}walkMany(e,r,n){this.checkIsTarget(e,$t.REPETITION,r,n)||super.walkOption(e,r,n)}walkManySep(e,r,n){this.checkIsTarget(e,$t.REPETITION_WITH_SEPARATOR,r,n)||super.walkOption(e,r,n)}}class jw extends Rs{constructor(e,r,n){super(),this.targetOccurrence=e,this.targetProdType=r,this.targetRef=n,this.result=[]}checkIsTarget(e,r){e.idx===this.targetOccurrence&&this.targetProdType===r&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,$t.OPTION)}visitRepetition(e){this.checkIsTarget(e,$t.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,$t.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,$t.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,$t.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,$t.ALTERNATION)}}function zw(t){const e=new Array(t);for(let r=0;r<t;r++)e[r]=[];return e}function Ld(t){let e=[""];for(let r=0;r<t.length;r++){const n=t[r],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+n.tokenTypeIdx);for(let a=0;a<n.categoryMatches.length;a++){const c="_"+n.categoryMatches[a];i.push(o+c)}}e=i}return e}function $8(t,e,r){for(let n=0;n<t.length;n++){if(n===r)continue;const i=t[n];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function Ww(t,e){const r=$e(t,o=>Cd([o],1)),n=zw(r.length),i=$e(r,o=>{const a={};return Ye(o,c=>{const l=Ld(c.partialPath);Ye(l,u=>{a[u]=!0})}),a});let s=r;for(let o=1;o<=e;o++){const a=s;s=zw(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const d=l[u].partialPath,f=l[u].suffixDef,h=Ld(d);if($8(i,h,c)||Et(f)||d.length===e){const p=n[c];if($d(p,d)===!1){p.push(d);for(let g=0;g<h.length;g++){const y=h[g];i[c][y]=!0}}}else{const p=Cd(f,o+1,d);s[c]=s[c].concat(p),Ye(p,g=>{const y=Ld(g.partialPath);Ye(y,b=>{i[c][b]=!0})})}}}}return n}function Md(t,e,r,n){const i=new jw(t,$t.ALTERNATION,n);return e.accept(i),Ww(i.result,r)}function Ud(t,e,r,n){const i=new jw(t,r);e.accept(i);const s=i.result,a=new U8(e,t,r).startWalking(),c=new qr({definition:s}),l=new qr({definition:a});return Ww([c,l],n)}function $d(t,e){e:for(let r=0;r<t.length;r++){const n=t[r];if(n.length===e.length){for(let i=0;i<n.length;i++){const s=e[i],o=n[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function P8(t,e){return t.length<e.length&&Un(t,(r,n)=>{const i=e[n];return r===i||i.categoryMatchesMap[r.tokenTypeIdx]})}function Hw(t){return Un(t,e=>Un(e,r=>Un(r,n=>Et(n.categoryMatches))))}function F8(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return $e(e,r=>Object.assign({type:Nr.CUSTOM_LOOKAHEAD_VALIDATION},r))}function B8(t,e,r,n){const i=xn(t,c=>D8(c,r)),s=J8(t,e,r),o=xn(t,c=>Y8(c,r)),a=xn(t,c=>W8(c,t,n,r));return i.concat(s,o,a)}function D8(t,e){const r=new z8;t.accept(r);const n=r.allProductions,i=iw(n,j8),s=Pn(i,a=>a.length>1);return $e(Yt(s),a=>{const c=$n(a),l=e.buildDuplicateFoundError(t,a),u=li(c),d={message:l,type:Nr.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},f=Gw(c);return f&&(d.parameter=f),d})}function j8(t){return`${li(t)}_#_${t.idx}_#_${Gw(t)}`}function Gw(t){return t instanceof Ct?t.terminalType.name:t instanceof Kr?t.nonTerminalName:""}class z8 extends Rs{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function W8(t,e,r,n){const i=[];if(Gr(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=n.buildDuplicateRuleNameError({topLevelRule:t,grammarName:r});i.push({message:o,type:Nr.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function H8(t,e,r){const n=[];let i;return Ir(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${r}<-as it is not defined in any of the super grammars `,n.push({message:i,type:Nr.INVALID_RULE_OVERRIDE,ruleName:t})),n}function Kw(t,e,r,n=[]){const i=[],s=Zl(e.definition);if(Et(s))return[];{const o=t.name;Ir(s,t)&&i.push({message:r.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:n}),type:Nr.LEFT_RECURSION,ruleName:o});const c=Ll(s,n.concat([t])),l=xn(c,u=>{const d=wr(n);return d.push(u),Kw(t,u,r,d)});return i.concat(l)}}function Zl(t){let e=[];if(Et(t))return e;const r=$n(t);if(r instanceof Kr)e.push(r.referencedRule);else if(r instanceof qr||r instanceof Yr||r instanceof ai||r instanceof ci||r instanceof Fn||r instanceof tr)e=e.concat(Zl(r.definition));else if(r instanceof Bn)e=on($e(r.definition,s=>Zl(s.definition)));else if(!(r instanceof Ct))throw Error("non exhaustive match");const n=Pl(r),i=t.length>1;if(n&&i){const s=kr(t);return e.concat(Zl(s))}else return e}class Pd extends Rs{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function G8(t,e){const r=new Pd;t.accept(r);const n=r.alternations;return xn(n,s=>{const o=Ba(s.definition);return xn(o,(a,c)=>{const l=Bw([a],[],Ha,1);return Et(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Nr.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function K8(t,e,r){const n=new Pd;t.accept(n);let i=n.alternations;return i=Ml(i,o=>o.ignoreAmbiguities===!0),xn(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=Md(a,t,c,o),u=X8(l,o,t,r),d=Z8(l,o,t,r);return u.concat(d)})}class q8 extends Rs{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function Y8(t,e){const r=new Pd;t.accept(r);const n=r.alternations;return xn(n,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Nr.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function V8(t,e,r){const n=[];return Ye(t,i=>{const s=new q8;i.accept(s);const o=s.allProductions;Ye(o,a=>{const c=Dw(a),l=a.maxLookahead||e,u=a.idx,f=Ud(u,i,c,l)[0];if(Et(on(f))){const h=r.buildEmptyRepetitionError({topLevelRule:i,repetition:a});n.push({message:h,type:Nr.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),n}function X8(t,e,r,n){const i=[],s=Gr(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Ye(c,u=>{const d=[l];Ye(t,(f,h)=>{l!==h&&$d(f,u)&&e.definition[h].ignoreAmbiguities!==!0&&d.push(h)}),d.length>1&&!$d(i,u)&&(i.push(u),a.push({alts:d,path:u}))}),a),[]);return $e(s,a=>{const c=$e(a.alts,u=>u+1);return{message:n.buildAlternationAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Nr.AMBIGUOUS_ALTS,ruleName:r.name,occurrence:e.idx,alternatives:a.alts}})}function Z8(t,e,r,n){const i=Gr(t,(o,a,c)=>{const l=$e(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Fa(xn(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=vn(i,f=>e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&P8(f.path,l));return $e(u,f=>{const h=[f.idx+1,c+1],m=e.idx===0?"":e.idx;return{message:n.buildAlternationPrefixAmbiguityError({topLevelRule:r,alternation:e,ambiguityIndices:h,prefixPath:f.path}),type:Nr.AMBIGUOUS_PREFIX_ALTS,ruleName:r.name,occurrence:m,alternatives:h}})}))}function J8(t,e,r){const n=[],i=$e(e,s=>s.name);return Ye(t,s=>{const o=s.name;if(Ir(i,o)){const a=r.buildNamespaceConflictError(s);n.push({message:a,type:Nr.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),n}function Q8(t){const e=xd(t,{errMsgProvider:x8}),r={};return Ye(t.rules,n=>{r[n.name]=n}),E8(r,e.errMsgProvider)}function e$(t){return t=xd(t,{errMsgProvider:Ns}),B8(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const qw="MismatchedTokenException",Yw="NoViableAltException",Vw="EarlyExitException",Xw="NotAllInputParsedException",Zw=[qw,Yw,Vw,Xw];Object.freeze(Zw);function Jl(t){return Ir(Zw,t.name)}class Ql extends Error{constructor(e,r){super(e),this.token=r,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Jw extends Ql{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=qw}}class t$ extends Ql{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=Yw}}class r$ extends Ql{constructor(e,r){super(e,r),this.name=Xw}}class n$ extends Ql{constructor(e,r,n){super(e,r),this.previousToken=n,this.name=Vw}}const Fd={},Qw="InRuleRecoveryException";class i$ extends Error{constructor(e){super(e),this.name=Qw}}class s${initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Ke(e,"recoveryEnabled")?e.recoveryEnabled:Ri.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=o$)}getTokenToInsert(e){const r=Vl(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return r.isInsertedInRecovery=!0,r}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,r,n,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const d=()=>{const f=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:f,ruleName:this.getCurrRuleFullName()}),m=new Jw(h,l,this.LA(0));m.resyncedTokens=Ba(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){d();return}else if(n.call(this)){d(),e.apply(this,r);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,r,n){return!(n===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,r)))}getFollowsForInRuleRecovery(e,r){const n=this.getCurrentGrammarPath(e,r);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(e,r){if(this.canRecoverWithSingleTokenInsertion(e,r))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new i$("sad sad panda")}canPerformInRuleRecovery(e,r){return this.canRecoverWithSingleTokenInsertion(e,r)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,r){if(!this.canTokenTypeBeInsertedInRecovery(e)||Et(r))return!1;const n=this.LA(1);return Ro(r,s=>this.tokenMatcher(n,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const r=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(r);return Ir(n,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let r=this.LA(1),n=2;for(;;){const i=Ro(e,s=>v8(r,s));if(i!==void 0)return i;r=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Fd;const e=this.getLastExplicitRuleShortName(),r=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:r,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,r=this.RULE_OCCURRENCE_STACK;return $e(e,(n,i)=>i===0?Fd:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:r[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=$e(this.buildFullFollowKeyStack(),r=>this.getFollowSetFromFollowKey(r));return on(e)}getFollowSetFromFollowKey(e){if(e===Fd)return[Is];const r=e.ruleName+e.idxInCallingRule+hw+e.inRule;return this.resyncFollows[r]}addToResyncTokens(e,r){return this.tokenMatcher(e,Is)||r.push(e),r}reSyncTo(e){const r=[];let n=this.LA(1);for(;this.tokenMatcher(n,e)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,r);return Ba(r)}attemptInRepetitionRecovery(e,r,n,i,s,o,a){}getCurrentGrammarPath(e,r){const n=this.getHumanReadableRuleStack(),i=wr(this.RULE_OCCURRENCE_STACK);return{ruleStack:n,occurrenceStack:i,lastTok:e,lastTokOccurrence:r}}getHumanReadableRuleStack(){return $e(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function o$(t,e,r,n,i,s,o){const a=this.getKeyForAutomaticLookahead(n,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),h=this.getGAstProductions()[f];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const d=c.isEndOfRule;this.RULE_STACK.length===1&&d&&l===void 0&&(l=Is,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,r,l)}const a$=4,Ji=8,e1=1<<Ji,t1=2<<Ji,Bd=3<<Ji,Dd=4<<Ji,jd=5<<Ji,eu=6<<Ji;function zd(t,e,r){return r|e|t}class c${constructor(e){var r;this.maxLookahead=(r=e?.maxLookahead)!==null&&r!==void 0?r:Ri.maxLookahead}validate(e){const r=this.validateNoLeftRecursion(e.rules);if(Et(r)){const n=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...r,...n,...i,...s]}return r}validateNoLeftRecursion(e){return xn(e,r=>Kw(r,r,Ns))}validateEmptyOrAlternatives(e){return xn(e,r=>G8(r,Ns))}validateAmbiguousAlternationAlternatives(e,r){return xn(e,n=>K8(n,r,Ns))}validateSomeNonEmptyLookaheadPath(e,r){return V8(e,r,Ns)}buildLookaheadForAlternation(e){return N8(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,L8)}buildLookaheadForOptional(e){return C8(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Dw(e.prodType),M8)}}class l${initLooksAhead(e){this.dynamicTokensEnabled=Ke(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Ri.dynamicTokensEnabled,this.maxLookahead=Ke(e,"maxLookahead")?e.maxLookahead:Ri.maxLookahead,this.lookaheadStrategy=Ke(e,"lookaheadStrategy")?e.lookaheadStrategy:new c$({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Ye(e,r=>{this.TRACE_INIT(`${r.name} Rule Lookahead`,()=>{const{alternation:n,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=h$(r);Ye(n,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${li(l)}${u}`,()=>{const d=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:r,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=zd(this.fullRuleNameToShort[r.name],e1,l.idx);this.setLaFuncCache(f,d)})}),Ye(i,l=>{this.computeLookaheadFunc(r,l.idx,Bd,"Repetition",l.maxLookahead,li(l))}),Ye(s,l=>{this.computeLookaheadFunc(r,l.idx,t1,"Option",l.maxLookahead,li(l))}),Ye(o,l=>{this.computeLookaheadFunc(r,l.idx,Dd,"RepetitionMandatory",l.maxLookahead,li(l))}),Ye(a,l=>{this.computeLookaheadFunc(r,l.idx,eu,"RepetitionMandatoryWithSeparator",l.maxLookahead,li(l))}),Ye(c,l=>{this.computeLookaheadFunc(r,l.idx,jd,"RepetitionWithSeparator",l.maxLookahead,li(l))})})})}computeLookaheadFunc(e,r,n,i,s,o){this.TRACE_INIT(`${o}${r===0?"":r}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:r,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=zd(this.fullRuleNameToShort[e.name],n,r);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,r){const n=this.getLastExplicitRuleShortName();return zd(n,e,r)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,r){this.lookAheadFuncsCache.set(e,r)}}class u$ extends Rs{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const tu=new u$;function h$(t){tu.reset(),t.accept(tu);const e=tu.dslMethods;return tu.reset(),e}function r1(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function n1(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function f$(t,e,r){t.children[r]===void 0?t.children[r]=[e]:t.children[r].push(e)}function d$(t,e,r){t.children[e]===void 0?t.children[e]=[r]:t.children[e].push(r)}const p$="name";function i1(t,e){Object.defineProperty(t,p$,{enumerable:!1,configurable:!0,writable:!1,value:e})}function m$(t,e){const r=wn(t),n=r.length;for(let i=0;i<n;i++){const s=r[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function g$(t,e){const r=function(){};i1(r,t+"BaseSemantics");const n={visit:function(i,s){if(lt(i)&&(i=i[0]),!Si(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=_$(this,e);if(!Et(i)){const s=$e(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return r.prototype=n,r.prototype.constructor=r,r._RULE_NAMES=e,r}function y$(t,e,r){const n=function(){};i1(n,t+"BaseSemanticsWithDefaults");const i=Object.create(r.prototype);return Ye(e,s=>{i[s]=m$}),n.prototype=i,n.prototype.constructor=n,n}var Wd;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Wd||(Wd={}));function _$(t,e){return b$(t,e)}function b$(t,e){const r=vn(e,i=>xi(t[i])===!1),n=$e(r,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:Wd.MISSING_METHOD,methodName:i}));return Fa(n)}class w${initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Ke(e,"nodeLocationTracking")?e.nodeLocationTracking:Ri.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=er,this.cstFinallyStateUpdate=er,this.cstPostTerminal=er,this.cstPostNonTerminal=er,this.cstPostRule=er;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=n1,this.setNodeLocationFromNode=n1,this.cstPostRule=er,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=er,this.setNodeLocationFromNode=er,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=r1,this.setNodeLocationFromNode=r1,this.cstPostRule=er,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=er,this.setNodeLocationFromNode=er,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=er,this.setNodeLocationFromNode=er,this.cstPostRule=er,this.setInitialNodeLocation=er;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const r=this.LA(1);e.location={startOffset:r.startOffset,startLine:r.startLine,startColumn:r.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const r={name:e,children:Object.create(null)};this.setInitialNodeLocation(r),this.CST_STACK.push(r)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?(n.endOffset=r.endOffset,n.endLine=r.endLine,n.endColumn=r.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(e){const r=this.LA(0),n=e.location;n.startOffset<=r.startOffset?n.endOffset=r.endOffset:n.startOffset=NaN}cstPostTerminal(e,r){const n=this.CST_STACK[this.CST_STACK.length-1];f$(n,r,e),this.setNodeLocationFromToken(n.location,r)}cstPostNonTerminal(e,r){const n=this.CST_STACK[this.CST_STACK.length-1];d$(n,r,e),this.setNodeLocationFromNode(n.location,e.location)}getBaseCstVisitorConstructor(){if(Si(this.baseCstVisitorConstructor)){const e=g$(this.className,wn(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Si(this.baseCstVisitorWithDefaultsConstructor)){const e=y$(this.className,wn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class k${initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):iu}LA(e){const r=this.currIdx+e;return r<0||this.tokVectorLength<=r?iu:this.tokVector[r]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class v${ACTION(e){return e.call(this)}consume(e,r,n){return this.consumeInternal(r,e,n)}subrule(e,r,n){return this.subruleInternal(r,e,n)}option(e,r){return this.optionInternal(r,e)}or(e,r){return this.orInternal(r,e)}many(e,r){return this.manyInternal(e,r)}atLeastOne(e,r){return this.atLeastOneInternal(e,r)}CONSUME(e,r){return this.consumeInternal(e,0,r)}CONSUME1(e,r){return this.consumeInternal(e,1,r)}CONSUME2(e,r){return this.consumeInternal(e,2,r)}CONSUME3(e,r){return this.consumeInternal(e,3,r)}CONSUME4(e,r){return this.consumeInternal(e,4,r)}CONSUME5(e,r){return this.consumeInternal(e,5,r)}CONSUME6(e,r){return this.consumeInternal(e,6,r)}CONSUME7(e,r){return this.consumeInternal(e,7,r)}CONSUME8(e,r){return this.consumeInternal(e,8,r)}CONSUME9(e,r){return this.consumeInternal(e,9,r)}SUBRULE(e,r){return this.subruleInternal(e,0,r)}SUBRULE1(e,r){return this.subruleInternal(e,1,r)}SUBRULE2(e,r){return this.subruleInternal(e,2,r)}SUBRULE3(e,r){return this.subruleInternal(e,3,r)}SUBRULE4(e,r){return this.subruleInternal(e,4,r)}SUBRULE5(e,r){return this.subruleInternal(e,5,r)}SUBRULE6(e,r){return this.subruleInternal(e,6,r)}SUBRULE7(e,r){return this.subruleInternal(e,7,r)}SUBRULE8(e,r){return this.subruleInternal(e,8,r)}SUBRULE9(e,r){return this.subruleInternal(e,9,r)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,r,n=su){if(Ir(this.definedRulesNames,e)){const o={message:Ns.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Nr.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,r,n);return this[e]=i,i}OVERRIDE_RULE(e,r,n=su){const i=H8(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,r,n);return this[e]=s,s}BACKTRACK(e,r){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return e.apply(this,r),!0}catch(i){if(Jl(i))return!1;throw i}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return EU(Yt(this.gastProductionsCache))}}class x${initRecognizerEngine(e,r){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Yl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Ke(r,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(lt(e)){if(Et(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(lt(e))this.tokensMap=Gr(e,(s,o)=>(s[o.name]=o,s),{});else if(Ke(e,"modes")&&Un(on(Yt(e.modes)),_8)){const s=on(Yt(e.modes)),o=Ul(s);this.tokensMap=Gr(o,(a,c)=>(a[c.name]=c,a),{})}else if(bn(e))this.tokensMap=wr(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Is;const n=Ke(e,"modes")?on(Yt(e.modes)):Yt(e),i=Un(n,s=>Et(s.categoryMatches));this.tokenMatcher=i?Yl:Ha,Ga(Yt(this.tokensMap))}defineRule(e,r,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Ke(n,"resyncEnabled")?n.resyncEnabled:su.resyncEnabled,s=Ke(n,"recoveryValueFunc")?n.recoveryValueFunc:su.recoveryValueFunc,o=this.ruleShortNameIdx<<a$+Ji;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,u);const d=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(d),d}catch(d){return this.invokeRuleCatch(d,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),r.apply(this,u)}catch(d){return this.invokeRuleCatch(d,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:r})}invokeRuleCatch(e,r,n){const i=this.RULE_STACK.length===1,s=r&&!this.isBackTracking()&&this.recoveryEnabled;if(Jl(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return n(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),n(e);throw o}}else throw e}optionInternal(e,r){const n=this.getKeyForAutomaticLookahead(t1,r);return this.optionInternalLogic(e,r,n)}optionInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,r){const n=this.getKeyForAutomaticLookahead(Dd,e);return this.atLeastOneInternalLogic(e,r,n)}atLeastOneInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const o=r.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=r;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,$t.REPETITION_MANDATORY,r.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,r],i,Dd,e,O8)}atLeastOneSepFirstInternal(e,r){const n=this.getKeyForAutomaticLookahead(eu,e);this.atLeastOneSepFirstInternalLogic(e,r,n)}atLeastOneSepFirstInternalLogic(e,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Fw],a,eu,e,Fw)}else throw this.raiseEarlyExitException(e,$t.REPETITION_MANDATORY_WITH_SEPARATOR,r.ERR_MSG)}manyInternal(e,r){const n=this.getKeyForAutomaticLookahead(Bd,e);return this.manyInternalLogic(e,r,n)}manyInternalLogic(e,r,n){let i=this.getLaFuncFromCache(n),s;if(typeof r!="function"){s=r.DEF;const a=r.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=r;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,r],i,Bd,e,R8,o)}manySepFirstInternal(e,r){const n=this.getKeyForAutomaticLookahead(jd,e);this.manySepFirstInternalLogic(e,r,n)}manySepFirstInternalLogic(e,r,n){const i=r.DEF,s=r.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Pw],a,jd,e,Pw)}}repetitionSepSecondInternal(e,r,n,i,s){for(;n();)this.CONSUME(r),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,r,n,i,s],n,eu,e,s)}doSingleRepetition(e){const r=this.getLexerPosition();return e.call(this),this.getLexerPosition()>r}orInternal(e,r){const n=this.getKeyForAutomaticLookahead(e1,r),i=lt(e)?e:e.DEF,o=this.getLaFuncFromCache(n).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(r,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),r=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new r$(r,e))}}subruleInternal(e,r,n){let i;try{const s=n!==void 0?n.ARGS:void 0;return this.subruleIdx=r,i=e.apply(this,s),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,n,e.ruleName)}}subruleInternalError(e,r,n){throw Jl(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,r!==void 0&&r.LABEL!==void 0?r.LABEL:n),delete e.partialCstResult),e}consumeInternal(e,r,n){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,n)}catch(s){i=this.consumeInternalRecovery(e,r,s)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:e.name,i),i}consumeInternalError(e,r,n){let i;const s=this.LA(0);throw n!==void 0&&n.ERR_MSG?i=n.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:r,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Jw(i,r,s))}consumeInternalRecovery(e,r,n){if(this.recoveryEnabled&&n.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,r);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===Qw?n:s}}else throw n}saveRecogState(){const e=this.errors,r=wr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:r,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,r,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(r)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Is)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class E${initErrorHandler(e){this._errors=[],this.errorMessageProvider=Ke(e,"errorMessageProvider")?e.errorMessageProvider:Ri.errorMessageProvider}SAVE_ERROR(e){if(Jl(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:wr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return wr(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,r,n){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Ud(e,s,r,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:n,ruleName:i});throw this.SAVE_ERROR(new n$(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,r){const n=this.getCurrRuleFullName(),i=this.getGAstProductions()[n],s=Md(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:r,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new t$(c,this.LA(1),a))}}class A${initContentAssist(){}computeContentAssist(e,r){const n=this.gastProductionsCache[e];if(Si(n))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Bw([n],r,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const r=$n(e.ruleStack),i=this.getGAstProductions()[r];return new S8(i,e).startWalking()}}const ru={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ru);const s1=!0,o1=Math.pow(2,Ji)-1,a1=an({name:"RECORDING_PHASE_TOKEN",pattern:lr.NA});Ga([a1]);const c1=Vl(a1,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(c1);const T$={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class S${initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const r=e>0?e:"";this[`CONSUME${r}`]=function(n,i){return this.consumeInternalRecord(n,e,i)},this[`SUBRULE${r}`]=function(n,i){return this.subruleInternalRecord(n,e,i)},this[`OPTION${r}`]=function(n){return this.optionInternalRecord(n,e)},this[`OR${r}`]=function(n){return this.orInternalRecord(n,e)},this[`MANY${r}`]=function(n){this.manyInternalRecord(e,n)},this[`MANY_SEP${r}`]=function(n){this.manySepFirstInternalRecord(e,n)},this[`AT_LEAST_ONE${r}`]=function(n){this.atLeastOneInternalRecord(e,n)},this[`AT_LEAST_ONE_SEP${r}`]=function(n){this.atLeastOneSepFirstInternalRecord(e,n)}}this.consume=function(e,r,n){return this.consumeInternalRecord(r,e,n)},this.subrule=function(e,r,n){return this.subruleInternalRecord(r,e,n)},this.option=function(e,r){return this.optionInternalRecord(r,e)},this.or=function(e,r){return this.orInternalRecord(r,e)},this.many=function(e,r){this.manyInternalRecord(e,r)},this.atLeastOne=function(e,r){this.atLeastOneInternalRecord(e,r)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let r=0;r<10;r++){const n=r>0?r:"";delete e[`CONSUME${n}`],delete e[`SUBRULE${n}`],delete e[`OPTION${n}`],delete e[`OR${n}`],delete e[`MANY${n}`],delete e[`MANY_SEP${n}`],delete e[`AT_LEAST_ONE${n}`],delete e[`AT_LEAST_ONE_SEP${n}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,r){return()=>!0}LA_RECORD(e){return iu}topLevelRuleRecord(e,r){try{const n=new Oo({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),r.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(e,r){return Ya.call(this,Yr,e,r)}atLeastOneInternalRecord(e,r){Ya.call(this,ai,r,e)}atLeastOneSepFirstInternalRecord(e,r){Ya.call(this,ci,r,e,s1)}manyInternalRecord(e,r){Ya.call(this,tr,r,e)}manySepFirstInternalRecord(e,r){Ya.call(this,Fn,r,e,s1)}orInternalRecord(e,r){return R$.call(this,e,r)}subruleInternalRecord(e,r,n){if(nu(r),!e||Ke(e,"ruleName")===!1){const a=new Error(`<SUBRULE${l1(r)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=So(this.recordingProdStack),s=e.ruleName,o=new Kr({idx:r,nonTerminalName:s,label:n?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?T$:ru}consumeInternalRecord(e,r,n){if(nu(r),!Aw(e)){const o=new Error(`<CONSUME${l1(r)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=So(this.recordingProdStack),s=new Ct({idx:r,terminalType:e,label:n?.LABEL});return i.definition.push(s),c1}}function Ya(t,e,r,n=!1){nu(r);const i=So(this.recordingProdStack),s=xi(e)?e:e.DEF,o=new t({definition:[],idx:r});return n&&(o.separator=e.SEP),Ke(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),ru}function R$(t,e){nu(e);const r=So(this.recordingProdStack),n=lt(t)===!1,i=n===!1?t:t.DEF,s=new Bn({definition:[],idx:e,ignoreAmbiguities:n&&t.IGNORE_AMBIGUITIES===!0});Ke(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=Ed(i,a=>xi(a.GATE));return s.hasPredicates=o,r.definition.push(s),Ye(i,a=>{const c=new qr({definition:[]});s.definition.push(c),Ke(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Ke(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),ru}function l1(t){return t===0?"":`${t}`}function nu(t){if(t<0||t>o1){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${o1+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class O${initPerformanceTracer(e){if(Ke(e,"traceInitPerf")){const r=e.traceInitPerf,n=typeof r=="number";this.traceInitMaxIdent=n?r:1/0,this.traceInitPerf=n?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=Ri.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,r){if(this.traceInitPerf===!0){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${e}>`);const{time:i,value:s}=cw(r),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${n}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return r()}}function I$(t,e){e.forEach(r=>{const n=r.prototype;Object.getOwnPropertyNames(n).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(n,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=r.prototype[i]})})}const iu=Vl(Is,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(iu);const Ri=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:$w,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),su=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Nr;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Nr||(Nr={}));let Hd=class tS{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const r=this.className;this.TRACE_INIT("toFastProps",()=>{lw(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ye(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let n=[];if(this.TRACE_INIT("Grammar Resolving",()=>{n=Q8({rules:Yt(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(n)}),this.TRACE_INIT("Grammar Validations",()=>{if(Et(n)&&this.skipValidations===!1){const i=e$({rules:Yt(this.gastProductionsCache),tokenTypes:Yt(this.tokensMap),errMsgProvider:Ns,grammarName:r}),s=F8({lookaheadStrategy:this.lookaheadStrategy,rules:Yt(this.gastProductionsCache),tokenTypes:Yt(this.tokensMap),grammarName:r});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Et(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=NU(Yt(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Yt(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Yt(this.gastProductionsCache))})),!tS.DEFER_DEFINITION_ERRORS_HANDLING&&!Et(this.definitionErrors))throw e=$e(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,r){this.definitionErrors=[],this.selfAnalysisDone=!1;const n=this;if(n.initErrorHandler(r),n.initLexerAdapter(),n.initLooksAhead(r),n.initRecognizerEngine(e,r),n.initRecoverable(r),n.initTreeBuilder(r),n.initContentAssist(),n.initGastRecorder(r),n.initPerformanceTracer(r),Ke(r,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Ke(r,"skipValidations")?r.skipValidations:Ri.skipValidations}};Hd.DEFER_DEFINITION_ERRORS_HANDLING=!1,I$(Hd,[s$,l$,w$,k$,x$,v$,E$,A$,S$,O$]);class N$ extends Hd{constructor(e,r=Ri){const n=wr(r);n.outputCst=!0,super(e,n)}}function C$(t){const e=new L$,r=Yt(t);return $e(r,n=>e.visitRule(n))}class L$ extends Rs{visitRule(e){const r=this.visitEach(e.definition),n=iw(r,s=>s.propertyName),i=$e(n,(s,o)=>{const a=!Ed(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=$e(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:ou(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:ou(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:ou(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:ou(e)}]}visitEachAndOverrideWith(e,r){return $e(this.visitEach(e),n=>Wr({},n,r))}visitEach(e){return on($e(e,r=>this.visit(r)))}}function ou(t){return t instanceof Kr?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function M$(t,e){let r=[];return r=r.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),r=r.concat(on($e(t,n=>U$(n)))),e.includeVisitorInterface&&(r=r.concat(B$(e.visitorInterfaceName,t))),r.join(`

`)+`
`}function U$(t){const e=$$(t),r=P$(t);return[e,r]}function $$(t){const e=h1(t.name),r=Gd(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${r};
}`}function P$(t){return`export type ${Gd(t.name)} = {
  ${$e(t.properties,r=>F$(r)).join(`
  `)}
};`}function F$(t){const e=j$(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function B$(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${$e(e,r=>D$(r)).join(`
  `)}
}`}function D$(t){const e=Gd(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function j$(t){if(lt(t)){const e=Ul($e(t,n=>u1(n)));return"("+Gr(e,(n,i)=>n+" | "+i)+")"}else return u1(t)}function u1(t){return t.kind==="token"?"IToken":h1(t.name)}function h1(t){return Ab(t)+"CstNode"}function Gd(t){return Ab(t)+"CstChildren"}const z$={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function W$(t,e){const r=Object.assign(Object.assign({},z$),e),n=C$(t);return M$(n,r)}const Va=s_(32,126).map(t=>String.fromCharCode(t));function et(t){return an({...t,name:`token_${t.name}`})}function de(t){return et({name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:Ht})}const au=et({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),H$=et({name:"whitespace",pattern:/ +/,group:lr.SKIPPED}),G$=et({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:lr.SKIPPED}),Kd=et({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),No=et({name:"command",pattern:/#/,start_chars_hint:["#"]});let f1=!1;const K$="@#/?':!",q$=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function Y$(t,e){if(!f1)return null;let r=e;const n=t[r-1]??"";if(r>0&&n!==" "&&n!==`
`)return null;if(t[r]===" "){for(;t[r]===" ";)r++;if(K$.includes(t[r]))return null}for(;r>0&&`$"@#':!/?
`.includes(t[r])===!1;)r--;switch(t[r]){case"?":case"/":{const o=t.substring(r+1,e+1).toLowerCase();if(o.indexOf(" ")<1||q$.test(o))return null;break}case"#":return null;case'"':{for(r--;r>0&&t[r]===" ";)r--;if(!(r<1||t[r]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=e;for(t[i]==='"'&&++i;i<t.length&&t[i]!==`
`;)i++;const s=t.substring(e,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const d1=et({name:"text",pattern:Y$,line_breaks:!1,start_chars_hint:Va}),p1=et({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),qd=et({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),m1=et({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),g1=et({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Ht=et({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Va}),cu=et({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Yd=et({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),y1=de("isterrain"),_1=de("isobject"),b1=de("issolid"),w1=de("iswalk"),k1=de("isswim"),v1=de("isbullet"),x1=de("isghost"),E1=de("iswalking"),A1=de("iswalkable"),T1=de("isswimming"),S1=de("isswimmable"),R1=de("black"),O1=de("dkblue"),I1=de("dkgreen"),N1=de("dkcyan"),C1=de("dkred"),L1=de("dkpurple"),M1=de("dkyellow"),U1=de("ltgray"),$1=de("dkgray"),P1=de("blue"),F1=de("green"),B1=de("cyan"),D1=de("red"),j1=de("purple"),z1=de("yellow"),W1=de("white"),H1=de("brown"),G1=de("dkwhite"),K1=de("ltgrey"),q1=de("gray"),Y1=de("grey"),V1=de("dkgrey"),X1=de("ltblack"),Z1=de("onblack"),J1=de("ondkblue"),Q1=de("ondkgreen"),ek=de("ondkcyan"),tk=de("ondkred"),rk=de("ondkpurple"),nk=de("ondkyellow"),ik=de("onltgray"),sk=de("ondkgray"),ok=de("onblue"),ak=de("ongreen"),ck=de("oncyan"),lk=de("onred"),uk=de("onpurple"),hk=de("onyellow"),fk=de("onwhite"),dk=de("onbrown"),pk=de("ondkwhite"),mk=de("onltgrey"),gk=de("ongray"),yk=de("ongrey"),_k=de("ondkgrey"),bk=de("onltblack"),wk=de("onclear"),kk=de("idle"),vk=de("up"),xk=de("down"),Ek=de("left"),Ak=de("right"),Tk=de("by"),Sk=de("at"),Rk=de("flow"),Ok=de("seek"),Ik=de("rndns"),Nk=de("rndne"),Ck=de("rnd"),Lk=de("cw"),Mk=de("ccw"),Uk=de("opp"),$k=de("rndp"),Pk=de("away"),Fk=de("toward"),Bk=de("find"),Dk=de("flee"),jk=de("to"),zk=de("i"),Wk=de("u"),Hk=de("north"),Gk=de("n"),Kk=de("d"),qk=de("south"),Yk=de("s"),Vk=de("l"),Xk=de("west"),Zk=de("w"),Jk=de("r"),Qk=de("east"),ev=de("e"),tv=de("over"),rv=de("under"),nv=de("within"),iv=de("awayby"),sv=et({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:Ht}),ov=de("contact"),av=de("blocked"),cv=de("any"),lv=de("countof"),uv=de("abs"),hv=de("intceil"),fv=de("intfloor"),dv=de("intround"),pv=de("clamp"),mv=de("min"),gv=de("max"),yv=de("pick"),_v=de("pickwith"),bv=de("random"),wv=de("randomwith"),kv=de("run"),vv=de("runwith"),xv=et({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),Ev=et({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:Ht}),Av=et({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:Ht}),Tv=et({name:"islessthan",pattern:/<|below/i,longer_alt:Ht}),Sv=et({name:"isgreaterthan",pattern:/>|above/i,longer_alt:Ht}),Rv=et({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:Ht}),Ov=et({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:Ht}),Vd=et({name:"or",pattern:/or/i,longer_alt:Ht}),Xd=et({name:"not",pattern:/not/i,longer_alt:Ht}),Zd=et({name:"and",pattern:/and/i,longer_alt:Ht}),Jd=et({name:"plus",pattern:/\+/}),Qd=et({name:"minus",pattern:/-/}),Iv=et({name:"power",pattern:/\*\*/}),Nv=et({name:"multiply",pattern:/\*/}),ep=et({name:"divide",pattern:/\//}),Cv=et({name:"moddivide",pattern:/%/}),Lv=et({name:"floordivide",pattern:/%%/}),Mv=et({name:"query",pattern:/\?/}),Uv=et({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),$v=et({name:"rparen",pattern:/\)/,pop_mode:!0}),Pv=et({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:Va,longer_alt:Ht}),Fv=et({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Va,longer_alt:Ht}),Bv=et({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Va,longer_alt:Ht}),tp=et({name:"if",pattern:/if|try|take|give|duplicate/i,longer_alt:Ht}),lu=et({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:Ht}),rp=de("done"),np=de("else"),Dv=de("while"),jv=de("repeat"),zv=de("waitfor"),Wv=et({name:"foreach",pattern:/foreach|for/i,longer_alt:Ht}),Hv=de("break"),Gv=de("continue");function Kv(t,e){return[...t,xk,...e,Yd,y1,_1,b1,A1,E1,w1,S1,T1,k1,v1,x1,R1,O1,I1,N1,C1,L1,M1,U1,$1,P1,F1,B1,D1,j1,z1,W1,H1,G1,K1,q1,Y1,V1,X1,Z1,J1,Q1,ek,tk,rk,nk,ik,sk,ok,ak,ck,lk,uk,hk,fk,dk,pk,mk,gk,yk,_k,bk,wk,kk,vk,Ek,Ak,Tk,Sk,Rk,Ok,$k,Ik,Nk,Ck,Lk,Mk,Uk,nv,iv,Pk,Fk,Bk,Dk,jk,Hk,qk,Xk,Qk,tv,rv,sv,ov,av,cv,lv,uv,hv,fv,dv,pv,mv,gv,_v,yv,wv,bv,vv,kv,xv,Ev,Av,Rv,Tv,Ov,Sv,Vd,Xd,Zd,Jd,Qd,Iv,Nv,ep,Lv,Cv,Mv,Uv,$v,zk,Wk,Gk,Kk,Yk,Vk,Zk,Jk,ev,cu,Ht]}const qv=Kv([d1,Kd,Pv,Fv,Bv,No,p1,qd,m1,g1,au,H$],[Hv,Gv,rp,lu,np,Wv,tp,jv,zv,Dv]),V$=new lr({defaultMode:"use_newlines",modes:{use_newlines:qv,ignore_newlines:Kv([G$],[])}},{skipValidations:!Qn,ensureOptimizations:Qn,positionTracking:"full"});function Yv(t){f1=!0;const e=V$.tokenize(t||` 
`),[r]=(ut(e.tokens)?e.tokens:[]).slice(-1);return r&&r.tokenType.name!=="Newline"&&e.tokens.push(Vl(au,`
`,r.startOffset,r.endOffset??NaN,r.startLine??NaN,r.endLine??NaN,r.startColumn??NaN,r.endColumn??NaN)),e}function X$(t,e,r=!0){if(r){const[n,...i]=e;switch(Fe(n??"")){default:return{type:Pe.OBJECT,values:e};case"loader":return{type:Pe.LOADER,values:i};case"board":return{type:Pe.BOARD,values:i};case"object":return{type:Pe.OBJECT,values:i};case"terrain":return{type:Pe.TERRAIN,values:i};case"charset":return{type:Pe.CHARSET,values:i};case"palette":return{type:Pe.PALETTE,values:i}}}else{const[n,i,...s]=e,o=Fe(i??""),a=[n,t,...s];switch(o){default:return{type:Pe.CONST,values:e};case"rn":case"range":return{type:Pe.RANGE,values:a};case"sl":case"select":return{type:Pe.SELECT,values:a};case"nm":case"number":return{type:Pe.NUMBER,values:a};case"tx":case"text":return{type:Pe.TEXT,values:a};case"hk":case"hotkey":return{type:Pe.HOTKEY,values:a};case"copyit":return{type:Pe.COPYIT,values:a};case"openit":return{type:Pe.OPENIT,values:a};case"zssedit":return{type:Pe.ZSSEDIT,values:a};case"charedit":return{type:Pe.CHAREDIT,values:a};case"coloredit":return{type:Pe.COLOREDIT,values:a}}}}function cn(t){switch(t){case Pe.LOADER:return"loader";case Pe.BOARD:return"board";case Pe.OBJECT:return"object";case Pe.TERRAIN:return"terrain";case Pe.CHARSET:return"charset";case Pe.PALETTE:return"palette";case Pe.CONST:return"const";case Pe.RANGE:return"range";case Pe.SELECT:return"select";case Pe.NUMBER:return"number";case Pe.TEXT:return"text";case Pe.HOTKEY:return"hotkey";case Pe.COPYIT:return"copyit";case Pe.OPENIT:return"openit";case Pe.VIEWIT:return"viewit";case Pe.ZSSEDIT:return"zssedit";case Pe.CHAREDIT:return"charedit";case Pe.COLOREDIT:return"coloredit"}}var ip=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(ip||{});function Vv(t){return xo(t,ip,{bits:e=>Array.from(e)})}function Xv(t){return Sa(t,ip,{bits:e=>new Uint8Array(e)})}function Xa(t,e){return{id:Ft(),code:t,...e}}var sp=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(sp||{});function Z$(t){return xo(t,sp,{board:p7,object:yl,terrain:yl,charset:Vv,palette:Vv,stats:Ot})}function J$(t){return Sa(t,sp,{board:m7,object:_l,terrain:_l,charset:Xv,palette:Xv})}function Za(t){const e={...Cs(t)};return Object.keys(e).forEach(r=>{switch(r){case"type":case"name":delete e[r];break}}),e}function Q$(t){return w(t)?(t.stats=void 0,Cs(t)):{}}function uu(t){const e=Yv(t),r={};let n=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===Kd){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),l=a.split(" "),u=X$(ye(c)?c:"",l,n),d=u.values.join(" ");switch(n=!1,u.type){case Pe.LOADER:r.type=Re.LOADER,r.name=d;break;case Pe.BOARD:r.type=Re.BOARD,r.name=d;break;case Pe.OBJECT:r.type=Re.OBJECT,r.name=d||"object";break;case Pe.TERRAIN:r.type=Re.TERRAIN,r.name=d;break;case Pe.CHARSET:r.type=Re.CHARSET,r.name=d;break;case Pe.PALETTE:r.type=Re.PALETTE,r.name=d;break;case Pe.CONST:{const[f,...h]=u.values;if(ye(f)){const m=Fe(f),p=h.join(" ");if(ye(p)){const g=parseFloat(p);r[m]=Te(g)?g:p}else r[m]=1}break}case Pe.RANGE:case Pe.SELECT:case Pe.NUMBER:case Pe.TEXT:case Pe.HOTKEY:case Pe.ZSSEDIT:case Pe.CHAREDIT:case Pe.COLOREDIT:{const[f,...h]=u.values;if(ye(f)){const m=Fe(f);r[m]=[cn(u.type),...h]}break}}}}return r}function Cs(t){return w(t)?(w(t.stats?.type)||(t.stats=uu(t.code),w(t.stats.type)||(t.stats.type=Re.OBJECT)),t.stats):{}}function Zv(t){switch(t){default:case Re.ERROR:return"error";case Re.LOADER:return cn(Pe.LOADER);case Re.BOARD:return cn(Pe.BOARD);case Re.OBJECT:return cn(Pe.OBJECT);case Re.TERRAIN:return cn(Pe.TERRAIN);case Re.CHARSET:return cn(Pe.CHARSET);case Re.PALETTE:return cn(Pe.PALETTE)}}function ui(t){return Cs(t).type??Re.ERROR}function Oi(t){return Zv(ui(t))}function gt(t){return Cs(t).name??""}function eP(t,e){return Cs(t)[e]}const hu=new Cf;function tP(t){if(!ye(t))return;const e=va(t);if(w(e)&&w(it[e]))return it[e];const r=Fe(t),n=ve[r];if(w(n))return n}function fu(t,e){const r=Object.keys(t);for(let n=0;n<r.length;++n){const i=r[n],s=t[i];if(ut(s)){const[o,...a]=s;switch(o){case"text":w(e[i])||(e[i]="");break;case"range":w(e[i])||(e[i]=4);break;case"number":w(e[i])||(e[i]=0);break;case"select":if(!w(e[i])){const[,c]=a;e[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":e[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":e[i]=tP(s)??s;break;case"isitem":e.item=1;break;case"notitem":e.item=0;break;case"ispushable":e.pushable=s===""?1:s;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=We.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=We.ISSWIM;break;case"issolid":e.collision=We.ISSOLID;break;case"isbullet":e.collision=We.ISBULLET;break;case"isghost":e.collision=We.ISGHOST;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function St(t){if(w(t))switch(ui(t)){default:return;case Re.ERROR:return t.code??"";case Re.LOADER:return t.code??"";case Re.BOARD:{w(t.board)||(t.board=zu()),t.board.id=t.id;const e=Za(t);return e.isdark&&(t.board.isdark=1),e.notdark&&(t.board.isdark=0),Te(e.startx)&&(t.board.startx=e.startx),Te(e.starty)&&(t.board.starty=e.starty),ye(e.over)&&(Fe(e.over)==="empty"?t.board.over=void 0:t.board.over=e.over,t.board.overboard=void 0),ye(e.under)&&(Fe(e.under)==="empty"?t.board.under=void 0:t.board.under=e.under,t.board.underboard=void 0),ye(e.camera)&&(Fe(e.camera)==="empty"?t.board.camera=void 0:t.board.camera=e.camera),ye(e.graphics)&&(Fe(e.graphics)==="empty"?t.board.graphics=void 0:t.board.graphics=e.graphics),Te(e.facing)&&(t.board.facing=e.facing),ye(e.facing)&&Fe(e.facing)==="empty"&&(t.board.facing=void 0),ye(e.exitnorth)&&(t.board.exitnorth=e.exitnorth),ye(e.exitsouth)&&(t.board.exitsouth=e.exitsouth),ye(e.exitwest)&&(t.board.exitwest=e.exitwest),ye(e.exiteast)&&(t.board.exiteast=e.exiteast),Te(e.timelimit)&&(t.board.timelimit=e.timelimit),e.restartonzap&&(t.board.restartonzap=1),e.norestartonzap&&(t.board.restartonzap=0),Te(e.maxplayershots)&&(t.board.maxplayershots=e.maxplayershots),t.board}case Re.OBJECT:return w(t.object)||(t.object=j_()),t.object.id=t.id,t.object.code=t.code,t.object.name=gt(t),t.object.category=Br.ISOBJECT,fu(Za(t),t.object),t.object;case Re.TERRAIN:return w(t.terrain)||(t.terrain=j_()),t.terrain.id=t.id,t.terrain.name=gt(t),t.terrain.category=Br.ISTERRAIN,fu(Za(t),t.terrain),t.terrain;case Re.PALETTE:{if(w(t.palette)||(t.palette=W_(wC)),w(t.palette?.bits)){const e=Za(t),r=Fr(e);for(let n=0;n<r.length;++n){const i=r[n].toLowerCase(),s=e[i];if(i.startsWith("color")&&ye(s)){const o=parseFloat(i.replace("color",""));if(o>=0&&o<=15){hu.set(s);const a=o*cl,c=hu.r*63,l=hu.g*63,u=hu.b*63;t.palette.bits[a+0]=jt(c,0,63),t.palette.bits[a+1]=jt(l,0,63),t.palette.bits[a+2]=jt(u,0,63)}}}}return t.palette}case Re.CHARSET:return w(t.charset)||(t.charset=Xf(bC)),t.charset}}function op(t){return{id:Ft(),name:gS(),timestamp:0,activelist:[],pages:t,flags:{}}}var ap=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t[t.token=6]="token",t))(ap||{});function rP(t){return xo(t,ap,{pages:e=>e.map(Z$),flags:e=>{const r=Object.keys(e);for(let n=0;n<r.length;++n){const i=r[n];Object.keys(e[i]).length===0&&delete e[i]}return e}})}function cp(t){return Sa(t,ap,{pages:e=>e.map(J$)})}function Jv(t){w(t)&&(t.token=`${yS()}${nn(1111,9999)}`)}function Ls(t,e){if(!w(t))return;const r=Fe(e);return t.pages.find(i=>i.id===e||r===gt(i))}function Cr(t,e,r){if(!w(t))return;const n=Fe(r);return t.pages.find(s=>ui(s)===e&&(s.id===r||n===gt(s)))}function lp(t,e,r){let n=Cr(t,e,r);if(!w(n)){const i=Zv(e);return n=Xa(i==="object"?`@${r||"object"}
`:`@${i} ${r}
`,{}),Co(t,n),[n,!0]}return[n,!1]}function Ms(t,e){return w(t)?t.pages.filter(r=>ui(r)===e):[]}function up(t,e,r){if(!w(t))return[];const n=Fe(r);return t.pages.filter(s=>ui(s)===e).filter(s=>{const o=Cs(s),a=Fe(gt(s));return s.id===r||n===a||w(o[r])})}function Ja(t){return w(t)?Sn(t.pages).sort((r,n)=>{const i=ui(r),s=ui(n);return i===s?gt(r).localeCompare(gt(n)):s-i}):[]}function Qv(t,e){if(w(e)){const r=Cr(t,Re.TERRAIN,e.kind??"");if(w(r))return r;const n=Cr(t,Re.OBJECT,e.kind??"");if(w(n))return n}}function Co(t,e){if(!w(t)||!w(e))return!1;const r=Ls(t,e.id);return w(r)?!1:(t.pages.push(e),Jv(t),!0)}function ex(t,e){const r=Ls(t,e);if(w(t)&&w(r)){const n=Fe(e);return t.pages=t.pages.filter(i=>i.id!==e&&n!==gt(i)),Jv(t),r}}function rr(t,e=1,r=it.WHITE,n=it.BLACK){const i=t?.kinddata;return{name:Fe(t?.name??i?.name),char:t?.displaychar??i?.displaychar??t?.char??i?.char??e,color:t?.displaycolor??i?.displaycolor??t?.color??i?.color??r,bg:t?.displaybg??i?.displaybg??t?.bg??i?.bg??n,light:t?.light??i?.light??0}}function nP(t,e){return!!t?.flags[e]}function Ii(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function tx(t,e){t&&delete t.flags[e]}function rx(t,e,r){return Ii(t,e)?.[r]}function iP(t,e,r,n){const i=Ii(t,e);return i&&(i[r]=n),n}function ur(t){if(!w(t)||w(t.lookup)&&w(t.named))return;const e=new Array(Ue*rt).fill(void 0),r={},n=Object.values(t.objects);for(let o=0;o<n.length;++o){const a=n[o];if(w(a.x)&&w(a.y)&&w(a.id)&&!w(a.removed)&&He(a,"collision")!==We.ISGHOST){a.category=Br.ISOBJECT,e[a.x+a.y*Ue]=a.id,ye(a.code)&&!w(a.name)&&fu(uu(a.code),a);const c=rr(a);r[c.name]||(r[c.name]=new Set),r[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];if(w(a)){a.x=i,a.y=s,a.category=Br.ISTERRAIN;const c=rr(En(a));r[c.name]||(r[c.name]=new Set),r[c.name].add(o)}++i,i>=Ue&&(i=0,++s)}t.lookup=e,t.named=r}function Qa(t){w(t)&&(delete t.named,delete t.lookup,ur(t))}function hp(t,e,r){if(!w(t)||!w(t.named)||!w(e))return;const n=Fe(e.name??e.kinddata?.name??"");t.named[n]||(t.named[n]=new Set),t.named[n].add(e?.id??r??"")}function nx(t,e){if(!(!w(t)||!w(t.lookup)||!w(e?.id))&&!w(e.removed)&&He(e,"collision")!==We.ISGHOST){const r=e.x??0,n=e.y??0;t.lookup[r+n*Ue]=e.id}}function sP(t,e){if(w(t)&&w(e?.x)&&w(e.y)){const r=rr(e),n=Ui(t,e);w(t.named?.[r.name])&&t.named[r.name].delete(n)}}function du(t,e){if(w(t)&&w(e?.id)){if(w(t.lookup)&&w(e.x)&&w(e.y)){const n=e.x+e.y*Ue;t.lookup[n]===e.id&&(t.lookup[n]=void 0)}const r=rr(e);w(t.named?.[r.name])&&w(e.id)&&t.named[r.name].delete(e.id)}}function pu(t,e,r,n=!1){if(!w(t)||!w(t.lookup)||r.x<0||r.x>=Ue||r.y<0||r.y>=rt)return;const i=r.x+r.y*Ue,s=pr(t,t.lookup[i]??"404");if(w(s))return n&&_r(s.id)?void 0:s;const o=t.terrain[i];if(w(o)&&lc(e,He(o,"collision")))return o}function oP(t,e,r){const n=pr(t,e?.id??""),i=n?.x??-1,s=n?.y??-1;if(i-r.x===0&&s-r.y===0)return!0;const o=He(n,"collision");return w(pu(t,o,r))}function ix(t,e,r){const n=pr(t,e?.id??"");if(!w(t)||!w(n)||!w(n.x)||!w(n.y)||!w(t.lookup)||r.x<0||r.x>=Ue||r.y<0||r.y>=rt)return{name:"edge",kind:"edge",collision:We.ISSOLID,x:r.x,y:r.y};if(n.x-r.x===0&&n.y-r.y===0)return;const i=Ui(t,n),s=Ui(t,r),o=He(n,"collision");if(o===We.ISGHOST)return;const a=_r(n?.id),c=pr(t,t.lookup[s]??"");if(He(c,"collision")===We.ISGHOST)return;const l=_r(c?.id??"");if(w(c)&&(!a||!l))return{...c};const u=t.terrain[s],d=u?.collision??u?.kinddata?.collision??We.ISWALK;if(lc(o,d))return{...u,x:r.x,y:r.y};n.x=r.x,n.y=r.y,w(n.removed)||(t.lookup[i]=void 0,t.lookup[s]=n.id??"")}function aP(t,e){const r=[];if(!w(t))return r;const n=Object.values(t.objects);for(let i=0;i<n.length;++i){const s=n[i];w(s.id)&&w(s.removed)&&e-s.removed>Ec*5&&(r.push(s.id),KA(t,s.id))}return r}function cP(t,e){const r=[];if(!w(t))return r;t.lookup=void 0,ur(t);const n=Object.values(t.objects);for(let s=0;s<n.length;++s){const o=n[s];if(!w(o.id))continue;o.lx=o.x,o.ly=o.y;const c=`${En(o)?.code??""}
${o.code??""}`;if(c){if(o.removed){const l=e-o.removed,u=He(o,"cycle");if(l>u)continue}r.push({id:o.id,type:Re.OBJECT,code:c,object:o,terrain:void 0})}}const i=aP(t,e);for(let s=0;s<i.length;++s)r.push({id:i[s],type:Re.ERROR,code:"",object:void 0,terrain:void 0});return r}function sx(t,e,r){const n=[],i=[];if(!w(t))return{objectelements:n,terrainelements:i};function s(a,c){switch(r){case"all":return!0;case"self":return a?.id===e;case"others":return a?.id!==e;case"terrain":return c===!0;case"object":return c===!1}const l=He(a,r);return w(l)||rr(a).name===r||He(a,"group")===r}const o=Object.values(t.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&n.push(c)}for(let a=0;a<$f;++a){const c=t.terrain[a];w(c)&&s(c,!0)&&i.push(c)}return{objectelements:n,terrainelements:i}}function ox(t,e,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=nt(e,{x:s,y:i});Wt(o)&&mr(e,o,t.timestamp),It(e,{x:s,y:i})}}function lP(t,e,r){for(let n=e.y;n<=r.y;++n)for(let i=e.x;i<=r.x;++i)It(t,{x:i,y:n})}function ax(t,e,r,n){for(let i=r.y;i<=n.y;++i)for(let s=r.x;s<=n.x;++s){const o=nt(e,{x:s,y:i});Wt(o)&&mr(e,o,t.timestamp),It(e,{x:s,y:i})}}function Us(t,e){w(t)&&(t.name=e.name,t.char=e.char,t.color=e.color,t.bg=e.bg,t.displaychar=e.displaychar,t.displaycolor=e.displaycolor,t.displaybg=e.displaybg,t.p1=e.p1,t.p2=e.p2,t.p3=e.p3,t.p4=e.p4,t.p5=e.p5,t.p6=e.p6,t.code=e.code,t.item=e.item,t.group=e.group,t.party=e.party,t.cycle=e.cycle,t.light=e.light,t.lightdir=e.lightdir,t.stepx=e.stepx,t.stepy=e.stepy,t.shootx=e.shootx,t.shooty=e.shooty,t.pushable=e.pushable,t.collision=e.collision,t.breakable=e.breakable,t.tickertext=e.tickertext,t.tickertime=e.tickertime)}function mu(t,e,r,n,i){switch(i){case"all":case"object":case"terrain":break;default:return uP(t,e,r,"",i)}if(!w(x.book))return;const s=x.book,o=Cr(s,Re.BOARD,t),a=St(o);if(!w(a))return;const c=Cr(s,Re.BOARD,e),l=St(c);if(!w(l))return;ur(a),ur(l);let u=!1;if(w(a)&&w(l)){switch(i){case"all":ox(s,l,r,n);break;case"object":ax(s,l,r,n);break;case"terrain":lP(l,r,n);break;default:u=!0;break}for(let d=r.y;d<=n.y;++d)for(let f=r.x;f<=n.x;++f){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:f,y:d};let g,y=nt(a,p);if(Wt(y)?(g=rs(a,f,d),_r(y?.id)&&(y=void 0)):(g=y,y=void 0),w(g)&&(m||u&&He(g,"group")===i)){u&&ox(s,l,p,p);const b=hn(l,[g.kind??""],p);Us(b,g)}if(w(y)&&(h||u&&He(y,"group")===i)){u&&ax(s,l,p,p);const b=hn(l,[y.kind??""],p);Us(b,y)}}Qa(l)}}function uP(t,e,r,n,i){if(!w(x.book))return;const s=x.book,o=Cr(s,Re.BOARD,t),a=St(o);if(!w(a))return;const c=Cr(s,Re.BOARD,e),l=St(c);if(w(l)&&(ur(a),ur(l),w(a)&&w(l))){const{terrainelements:u,objectelements:d}=sx(a,n,i);if(u.length===0&&d.length===0)return;const f={x:Ue,y:rt};for(let h=0;h<u.length;++h){const m=u[h];Te(m.x)&&(f.x=Math.min(f.x,m.x)),Te(m.y)&&(f.y=Math.min(f.y,m.y))}for(let h=0;h<d.length;++h){const m=d[h];Te(m.x)&&(f.x=Math.min(f.x,m.x)),Te(m.y)&&(f.y=Math.min(f.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:r.x+(m.x??0)-f.x,y:r.y+(m.y??0)-f.y},g=nt(l,p);w(g)&&(Wt(g)&&mr(l,g,s.timestamp),It(l,p));const y=hn(l,[m.kind??""],p);Us(y,m)}for(let h=0;h<d.length;++h){const m=d[h],p={x:r.x+(m.x??0)-f.x,y:r.y+(m.y??0)-f.y},g=hn(l,[m.kind??""],p);Us(g,m)}Qa(l)}}function Pt(t){return`${t??""}`}function ec(t,e){const r=parseFloat(Pt(t));return isNaN(r)?e:r}function hP(t,e){return t?.activelist.includes(e)??!1}function gu(t,e,r){if(!w(t))return;iP(t,e,"board",r);const n=dr(r);w(n)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function Lo(t,e,r,n,i=!1){const s=Kt(e);if(!w(t)||!w(s))return;const o=pr(s,e);if(!Wt(o)||!o?.id)return;const a=dr(r);if(!w(a))return;ur(a);const c=pu(a,We.ISWALK,n,!0);if(i===!1&&w(c))if(He(c,"item"))qt(e,o,c,"touch");else return;du(s,o),delete s.objects[o.id],o.x=n.x,o.y=n.y,a.objects[o.id]=o,hp(a,o),nx(a,o),gu(t,e,a.id)}function fP(t){const r=(t?.activelist??[]).map(n=>{const i=rx(t,n,"board");return ye(i)?i:""});return RN(r)}function Mo(t){const e=fP(t),r=new Set,n=[];for(let i=0;i<e.length;++i){const s=dr(e[i]);if(w(s)&&!r.has(s.id)){if(ye(s.over))if(ye(s.overboard)){const o=dr(s.overboard);w(o)?r.has(o.id)||n.push(o):delete s.overboard}else{const o=dr(s.over);w(o)&&(s.overboard=o.id)}else ye(s.overboard)&&delete s.overboard;if(n.push(s),ye(s.under))if(ye(s.underboard)){const o=dr(s.underboard);w(o)||delete s.underboard}else{const o=dr(s.under);w(o)&&(s.underboard=o.id)}else ye(s.underboard)&&delete s.underboard}}return n}const dP=s_(32,126).map(t=>String.fromCharCode(t)),pP=an({name:"Whitespace",pattern:/ +/}),mP=an({name:"WhitespaceSkipped",pattern:/ +/,group:lr.SKIPPED}),fp=an({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),cx=an({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:dP}),dp=an({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),pp=an({name:"EscapedDollar",pattern:"$$"}),mp=an({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),gp=an({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),lx=an({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function gP(t,e=""){return an({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const ux=Object.keys(ka).map(t=>gP(`\\$(${t})`,t)),yP=[pP,fp,...ux,dp,cx,gp,pp,lx,mp],_P=new lr(yP,{skipValidations:!Qn,ensureOptimizations:Qn}),bP=new lr([mP,fp,...ux,dp,cx,gp,pp,lx,mp],{skipValidations:!Qn,ensureOptimizations:Qn}),hx=/\$CENTER/i;function wP(t){if(hx.test(t))return t.replace(hx,"")}function yp(t,e=!1){return e?bP.tokenize(t):_P.tokenize(t)}function fx(t,e,r,n,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:r,bg:n,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function kP(t){t.active={...t.reset}}function dx(t,e){const r=e.y;function n(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}n()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case pp:s("$");break;case gp:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}n();break;case dp:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case fp:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=ka[l],d=IN(it[u]),f=Uf(it[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):w(d)?e.active.color=d:w(f)?e.active.bg=f:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(w(e.writefullwidth)&&(e.x>o||e.y===r)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){kP(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;AP(u,u+l.length,e.active.color,e.active.bg,e),EP(u,l,e)}}}function vP(t,e,r){const n=yp(t);n.tokens&&(dx(n.tokens,e),e.changed())}function xP(t,e,r){const n=yp(t);if(!n.tokens)return;const i=fx(e,r,it.WHITE,it.BLACK);return i.measureonly=!0,dx(n.tokens,i),i.x>0&&++i.y,i}function EP(t,e,r){let n=0;const i=t+e.length;for(let s=t;s<i;++s)r.char[s]=e.charCodeAt(n++);r.changed()}function AP(t,e,r,n,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=r,i.bg[a]=n;i.changed()}function yu(t,e,r){if(!w(x.element?.x)||!w(x.element.y))return 0;const[n,i]=ue(e,0,[Z.DIR,Z.MAYBE_KIND]);x.element.shootx=jt(n.destpt.x-n.startpt.x,-1,1),x.element.shooty=jt(n.destpt.y-n.startpt.y,-1,1);const s=i??["bullet"],o=Zz(x.board,s,{x:x.element.x,y:x.element.y});if(w(o)){w(r)&&(o.arg=r),o.cycle=1,o.party=x.elementid,o.collision=We.ISBULLET,o.breakable=1,o.stepx=n.destpt.x-x.element.x,o.stepy=n.destpt.y-x.element.y,o.bg=it.ONCLEAR;const a=En(o),c=o.code??a?.code??"";UA(x.book,x.board,o,c)}return t.yield(),0}function tc(t,e,r){if(!bs(x.element)||!w(x.book)||!w(x.board)||!w(x.element))return 0;const[n,i]=ue(t,0,[Z.DIR,Z.KIND]);if(n.targets.length){for(let f=0;f<n.targets.length;++f){const h=n.targets[f];tc(["at",h.x,h.y,...i],e,r)}return 0}const{destpt:s}=n;if(s.x<0||s.x>=Ue||s.y<0||s.y>=rt)return 0;const[o]=i,a={x:x.element?.x??0,y:x.element?.y??0},c=En({kind:o}),l=He(c,"collision");if(l===We.ISGHOST)return hn(x.board,i,n.destpt,e),0;let u=nt(x.board,n.destpt);if(He(u,"pushable")){const f=Sn(n.destpt),h=Mt(f,Ln(a,f));zn(x.book,x.board,u,h),u=nt(x.board,n.destpt)}if(o==="empty")return mr(x.board,u,x.timestamp),0;if(Wt(u)&&mr(x.board,u,x.timestamp),Wt(c)||hn(x.board,i,n.destpt,e),Wt(c)){const f=pu(x.board,l,n.destpt);if(!w(f)){const h=hn(x.board,i,n.destpt,e);w(h)&&w(r)&&(h.arg=r)}}return 0}function TP(t,e,r){if(!w(x.book)||!w(x.board))return 1;const[n,i]=ue(e,0,[Z.DIR,Z.DIR]),s=nt(x.board,n.destpt);if(w(s)&&w(s.kind)){const o=He(s,"collision"),a=pu(x.board,o,i.destpt);if(w(a))return 1;const c=hn(x.board,[s.kind],i.destpt);if(!w(c))return 1;Us(c,s)}else return 1;return 0}const SP={x:0,y:0},RP={x:Ue-1,y:rt-1},OP="all",IP=ki().command("build",(t,e)=>{if(!w(x.book)||!w(x.board)||!w(x.element))return 0;const[r,n]=ue(e,0,[Z.NAME,Z.MAYBE_STRING]),i=zu();if(w(i)){if(ye(n)){const s=dr(n);w(s)&&mu(s.id,i.id,SP,RP,OP)}t.set(r,i.id)}return 0}).command("goto",(t,e)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ue(e,0,[Z.STRING]),[i,s]=ue(e,n,[Z.MAYBE_NUMBER,Z.MAYBE_NUMBER]),o=dr(r);if(!w(o))return 0;const a={x:i??o.startx??Math.round(Ue*.5),y:s??o.starty??Math.round(rt*.5)},c=rr(x.element);if(c.name!=="player"){const l=He(x.element,"color"),u=He(x.element,"bg"),d=wo(l,u),f=ju(o,[c.name,d]),[h]=f.sort((m,p)=>{const g=m.y??1e4,y=p.y??1e4,b=g-y;if(b!==0)return b;const A=m.x??1e4,R=p.x??1e4;return A-R});w(h)&&Te(h.x)&&Te(h.y)&&(a.x=h.x,a.y=h.y)}return Lo(x.book,x.elementfocus,o.id,a,!0),0}).command("transport",(t,e)=>{if(!w(x.book)||!w(x.board)||!w(x.element))return 0;const[r]=ue(e,0,[Z.STRING]),n=pr(x.board,r);if(w(x.element?.x)&&w(x.element.y)&&w(n?.x)&&w(n.y)){let i=!0;const s={x:x.element.x,y:x.element.y},o=s.x-n.x,a=s.y-n.y;if(He(x.element,"shootx")!==o||He(x.element,"shooty")!==a)return 0;for(;i&&(s.x+=o,s.y+=a,!(s.x<0&&s.x>=Ue&&s.y<0&&s.y>=rt));){const c=nt(x.board,s);c?.kind===x.element.kind&&He(c,"shootx")===-o&&He(c,"shooty")===-a&&zn(x.book,x.board,n,{x:s.x+o,y:s.y+a})&&(i=!1)}}return 0}).command("shove",(t,e)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ue(e,0,[Z.DIR,Z.DIR]),i=nt(x.board,r.destpt);if(Wt(i)&&He(i,"pushable")){const s=r.destpt.x+(n.destpt.x-n.startpt.x),o=r.destpt.y+(n.destpt.y-n.startpt.y);zn(x.book,x.board,i,{x:s,y:o})}return 0}).command("duplicate",TP).command("write",(t,e)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n,i]=ue(e,0,[Z.DIR,Z.COLOR]),s=e.slice(i).map(Pt).join(" "),{color:o,bg:a}=f_(n),c=xP(s,256,1)?.measuredwidth??1,l=fx(256,1,o??it.WHITE,a??it.BLACK);vP(s,l);const u=c-1;switch(Ln(r.startpt,r.destpt)){case ve.EAST:for(let f=0;f<c;++f)It(x.board,{x:r.destpt.x+f,y:r.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case ve.WEST:for(let f=0;f<c;++f)It(x.board,{x:r.destpt.x+f-u,y:r.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case ve.NORTH:for(let f=0;f<c;++f)It(x.board,{x:r.destpt.x,y:r.destpt.y+f-u,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case ve.SOUTH:for(let f=0;f<c;++f)It(x.board,{x:r.destpt.x,y:r.destpt.y+f,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break}return 0}).command("change",(t,e)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ue(e,0,[Z.KIND,Z.KIND]);(cc(r)??"")==="empty"&&h7(x.board).forEach(c=>{hn(x.board,n,c)});const s=cc(n),o=Du(n),a=FA(n);return ju(x.board,r).forEach(c=>{if(w(o)&&(c.color=o),w(a)&&(c.bg=a),rr(c).name!==s){const u=He(c,"color"),d=He(c,"bg");if(mr(x.board,c,x.timestamp),s!=="empty"){const f={x:c.x??0,y:c.y??0},h=hn(x.board,n,f);w(h)&&(h.color=u,h.bg=d)}}}),0}).command("put",(t,e)=>tc(e)).command("putwith",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY]);return tc(e.slice(n),void 0,r)}).command("oneof",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY]);return w(x.board)&&pr(x.board,r)?0:tc(e.slice(n),r)}).command("oneofwith",(t,e)=>{const[r,n,i]=ue(e,0,[Z.ANY,Z.ANY]);return w(x.board)&&pr(x.board,n)?0:tc(e.slice(i),n,r)}).command("shoot",yu).command("shootwith",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY]);return yu(t,e.slice(n),r)}).command("throwstar",(t,e)=>yu(t,[...e,"star"])).command("throwstarwith",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY]);return yu(t,[...e.slice(n),"star"],r)});var $s=(t=>(t[t.Border=-1]="Border",t[t.Data=0]="Data",t[t.Function=1]="Function",t[t.Position=2]="Position",t[t.Timing=3]="Timing",t[t.Alignment=4]="Alignment",t))($s||{}),NP=Object.defineProperty,CP=(t,e,r)=>e in t?NP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_u=(t,e,r)=>(CP(t,typeof e!="symbol"?e+"":e,r),r);const LP=[0,1],px=[1,0],mx=[2,3],gx=[3,2],MP={L:LP,M:px,Q:mx,H:gx},UP=/^[0-9]*$/,$P=/^[A-Z0-9 $%*+.\/:-]*$/,_p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",bp=1,wp=40,yx=3,PP=3,bu=40,FP=10,_x=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],bx=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class BP{constructor(e,r,n,i){if(this.version=e,this.ecc=r,_u(this,"size"),_u(this,"mask"),_u(this,"modules",[]),_u(this,"types",[]),e<bp||e>wp)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(n);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,r){return e>=0&&e<this.size&&r>=0&&r<this.size&&this.modules[r][e]}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2===0,$s.Timing),this.setFunctionModule(n,6,n%2===0,$s.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),r=e.length;for(let n=0;n<r;n++)for(let i=0;i<r;i++)n===0&&i===0||n===0&&i===r-1||n===r-1&&i===0||this.drawAlignmentPattern(e[n],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const r=this.ecc[1]<<3|e;let n=r;for(let s=0;s<10;s++)n=n<<1^(n>>>9)*1335;const i=(r<<10|n)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Ci(i,s));this.setFunctionModule(8,7,Ci(i,6)),this.setFunctionModule(8,8,Ci(i,7)),this.setFunctionModule(7,8,Ci(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Ci(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Ci(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Ci(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let n=0;n<12;n++)e=e<<1^(e>>>11)*7973;const r=this.version<<12|e;for(let n=0;n<18;n++){const i=Ci(r,n),s=this.size-11+n%3,o=Math.floor(n/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,r){for(let n=-4;n<=4;n++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(n)),o=e+i,a=r+n;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,$s.Position)}}drawAlignmentPattern(e,r){for(let n=-2;n<=2;n++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,r+n,Math.max(Math.abs(i),Math.abs(n))!==1,$s.Alignment)}setFunctionModule(e,r,n,i=$s.Function){this.modules[r][e]=n,this.types[r][e]=i}addEccAndInterleave(e){const r=this.version,n=this.ecc;if(e.length!==wu(r,n))throw new RangeError("Invalid argument");const i=bx[n[0]][r],s=_x[n[0]][r],o=Math.floor(vp(r)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=YP(s);for(let f=0,h=0;f<i;f++){const m=e.slice(h,h+c-s+(f<a?0:1));h+=m.length;const p=VP(m,u);f<a&&m.push(0),l.push(m.concat(p))}const d=[];for(let f=0;f<l[0].length;f++)l.forEach((h,m)=>{(f!==c-s||m>=a)&&d.push(h[f])});return d}drawCodewords(e){if(e.length!==Math.floor(vp(this.version)/8))throw new RangeError("Invalid argument");let r=0;for(let n=this.size-1;n>=1;n-=2){n===6&&(n=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=n-s,c=(n+1&2)===0?this.size-1-i:i;!this.types[c][o]&&r<e.length*8&&(this.modules[c][o]=Ci(e[r>>>3],7-(r&7)),r++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let r=0;r<this.size;r++)for(let n=0;n<this.size;n++){let i;switch(e){case 0:i=(n+r)%2===0;break;case 1:i=r%2===0;break;case 2:i=n%3===0;break;case 3:i=(n+r)%3===0;break;case 4:i=(Math.floor(n/3)+Math.floor(r/2))%2===0;break;case 5:i=n*r%2+n*r%3===0;break;case 6:i=(n*r%2+n*r%3)%2===0;break;case 7:i=((n+r)%2+n*r%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[r][n]&&i&&(this.modules[r][n]=!this.modules[r][n])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=yx:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*bu),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*bu}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=yx:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*bu),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*bu}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=PP)}let r=0;for(const s of this.modules)r=s.reduce((o,a)=>o+(a?1:0),r);const n=this.size*this.size,i=Math.ceil(Math.abs(r*20-n*10)/n)-1;return e+=i*FP,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,r=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,n=[6];for(let i=this.size-7;n.length<e;i-=r)n.splice(1,0,i);return n}}finderPenaltyCountPatterns(e){const r=e[1],n=r>0&&e[2]===r&&e[3]===r*3&&e[4]===r&&e[5]===r;return(n&&e[0]>=r*4&&e[6]>=r?1:0)+(n&&e[6]>=r*4&&e[0]>=r?1:0)}finderPenaltyTerminateAndCount(e,r,n){return e&&(this.finderPenaltyAddHistory(r,n),r=0),r+=this.size,this.finderPenaltyAddHistory(r,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(e,r){r[0]===0&&(e+=this.size),r.pop(),r.unshift(e)}}function Ni(t,e,r){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let n=e-1;n>=0;n--)r.push(t>>>n&1)}function Ci(t,e){return(t>>>e&1)!==0}class kp{constructor(e,r,n){if(this.mode=e,this.numChars=r,this.bitData=n,r<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}getData(){return this.bitData.slice()}}const DP=[1,10,12,14],jP=[2,9,11,13],zP=[4,8,16,16];function wx(t,e){return t[Math.floor((e+7)/17)+1]}function kx(t){const e=[];for(const r of t)Ni(r,8,e);return new kp(zP,t.length,e)}function WP(t){if(!vx(t))throw new RangeError("String contains non-numeric characters");const e=[];for(let r=0;r<t.length;){const n=Math.min(t.length-r,3);Ni(Number.parseInt(t.substring(r,r+n),10),n*3+1,e),r+=n}return new kp(DP,t.length,e)}function HP(t){if(!xx(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let r;for(r=0;r+2<=t.length;r+=2){let n=_p.indexOf(t.charAt(r))*45;n+=_p.indexOf(t.charAt(r+1)),Ni(n,11,e)}return r<t.length&&Ni(_p.indexOf(t.charAt(r)),6,e),new kp(jP,t.length,e)}function GP(t){return t===""?[]:vx(t)?[WP(t)]:xx(t)?[HP(t)]:[kx(qP(t))]}function vx(t){return UP.test(t)}function xx(t){return $P.test(t)}function KP(t,e){let r=0;for(const n of t){const i=wx(n.mode,e);if(n.numChars>=1<<i)return Number.POSITIVE_INFINITY;r+=4+i+n.bitData.length}return r}function qP(t){t=encodeURI(t);const e=[];for(let r=0;r<t.length;r++)t.charAt(r)!=="%"?e.push(t.charCodeAt(r)):(e.push(Number.parseInt(t.substring(r+1,r+3),16)),r+=2);return e}function vp(t){if(t<bp||t>wp)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const r=Math.floor(t/7)+2;e-=(25*r-10)*r-55,t>=7&&(e-=36)}return e}function wu(t,e){return Math.floor(vp(t)/8)-_x[e[0]][t]*bx[e[0]][t]}function YP(t){if(t<1||t>255)throw new RangeError("Degree out of range");const e=[];for(let n=0;n<t-1;n++)e.push(0);e.push(1);let r=1;for(let n=0;n<t;n++){for(let i=0;i<e.length;i++)e[i]=xp(e[i],r),i+1<e.length&&(e[i]^=e[i+1]);r=xp(r,2)}return e}function VP(t,e){const r=e.map(n=>0);for(const n of t){const i=n^r.shift();r.push(0),e.forEach((s,o)=>r[o]^=xp(s,i))}return r}function xp(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let r=0;for(let n=7;n>=0;n--)r=r<<1^(r>>>7)*285,r^=(e>>>n&1)*t;return r}function XP(t,e,r=1,n=40,i=-1,s=!0){if(!(bp<=r&&r<=n&&n<=wp)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=r;;o++){const d=wu(o,e)*8,f=KP(t,o);if(f<=d){a=f;break}if(o>=n)throw new RangeError("Data too long")}for(const d of[px,mx,gx])s&&a<=wu(o,d)*8&&(e=d);const c=[];for(const d of t){Ni(d.mode[0],4,c),Ni(d.numChars,wx(d.mode,o),c);for(const f of d.getData())c.push(f)}const l=wu(o,e)*8;Ni(0,Math.min(4,l-c.length),c),Ni(0,(8-c.length%8)%8,c);for(let d=236;c.length<l;d^=253)Ni(d,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((d,f)=>u[f>>>3]|=d<<7-(f&7)),new BP(o,e,u,i)}function ZP(t,e){const{ecc:r="L",boostEcc:n=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof t=="string"?GP(t):Array.isArray(t)?[kx(t)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof t}`);const l=XP(c,MP[r],i,s,o,n),u=JP({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e?.invert&&(u.data=u.data.map(d=>d.map(f=>!f))),e?.onEncoded?.(u),u}function JP(t,e=1){if(!e)return t;const{size:r}=t,n=r+e*2;t.size=n,t.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)t.data.unshift(Array.from({length:n},o=>!1)),t.data.push(Array.from({length:n},o=>!1));const i=$s.Border;t.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)t.types.unshift(Array.from({length:n},o=>i)),t.types.push(Array.from({length:n},o=>i));return t}function QP(t,e,r,n=!1){return e<0||r<0||e>=t.length||r>=t.length?n:t[r][e]}function eF(t,e={}){const r={WHITE_ALL:"█",WHITE_BLACK:"▀",BLACK_WHITE:"▄",BLACK_ALL:" "},n=ZP(t,e),i=!1,s=!0,o=(l,u)=>QP(n.data,l,u,!0),a=[];let c="";for(let l=0;l<n.size;l+=2){for(let u=0;u<n.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=r.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=r.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=r.BLACK_WHITE:c+=r.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const Ps="$dkpurple",tF="$196",rF="$205",Vt="$yellow$205$205$205$196";function bt(t,e,r){FS(t,e,r)}function nF(t,e,r){const n=tF.repeat(r);bt(t,e,`${Ps}${n}`)}function Ep(t,e,r){const n=rF.repeat(r);bt(t,e,`${Ps}${n}`)}function Ap(t,e,r){nF(t,e,r.length+2),bt(t,e,`${Ps} $white${r} `),Ep(t,e,r.length+2)}function Fs(t,e,r){bt(t,e,`${Ps} ${" ".repeat(r.length)} `),bt(t,e,`${Ps} $gray${r} `),Ep(t,e,r.length+2)}function Bs(t,e,r,n){bt(t,e,`${Ps} $white${r} $blue${n}`)}function Uo(t,e,r){bt(t,e,`${Ps}$blue${r}`)}function iF(t,e,r,n){bt(t,e,`!${r};${n}`)}function sF(t,e,r,n,i=!0){if(i){const s=eF(r).split(`
`),o={32:32,9600:223,9604:220,9608:219};for(let a=0;a<s.length;a++){const c=[...s[a]].map(l=>`$${o[l.charCodeAt(0)]}`).join("");bt(t,e,c)}}bt(t,e,`!copyit ${r};${n}`),_R(t,e)}var oF=`desc;$DKGRAYname and type of codepage
`,aF=Object.freeze({__proto__:null,default:oF}),cF="desc;changes object into specified element",lF=Object.freeze({__proto__:null,default:cF}),uF="desc;like #play but for sound effects",hF=Object.freeze({__proto__:null,default:uF}),fF="",dF=Object.freeze({__proto__:null,default:fF}),pF="",mF=Object.freeze({__proto__:null,default:pF}),gF="",yF=Object.freeze({__proto__:null,default:gF}),_F="",bF=Object.freeze({__proto__:null,default:_F}),wF="",kF=Object.freeze({__proto__:null,default:wF}),vF="",xF=Object.freeze({__proto__:null,default:vF}),EF="",AF=Object.freeze({__proto__:null,default:EF}),TF="",SF=Object.freeze({__proto__:null,default:TF}),RF="",OF=Object.freeze({__proto__:null,default:RF}),IF="",NF=Object.freeze({__proto__:null,default:IF}),CF="",LF=Object.freeze({__proto__:null,default:CF}),MF="",UF=Object.freeze({__proto__:null,default:MF}),$F="",PF=Object.freeze({__proto__:null,default:$F}),FF="",BF=Object.freeze({__proto__:null,default:FF}),DF="",jF=Object.freeze({__proto__:null,default:DF}),zF=`desc;$DKGRAYstarts a section of an if-do-done block
`,WF=Object.freeze({__proto__:null,default:zF}),HF=`desc;$DKGRAYcompletes an if-do-done block
`,GF=Object.freeze({__proto__:null,default:HF}),KF="",qF=Object.freeze({__proto__:null,default:KF}),YF="",VF=Object.freeze({__proto__:null,default:YF}),XF="",ZF=Object.freeze({__proto__:null,default:XF}),JF=`desc;$DKGRAYelse logic in an if-do-done block
`,QF=Object.freeze({__proto__:null,default:JF}),eB=`desc;$DKGRAYconditional else logic in an if-do-done block
`,tB=Object.freeze({__proto__:null,default:eB}),rB="",nB=Object.freeze({__proto__:null,default:rB}),iB="",sB=Object.freeze({__proto__:null,default:iB}),oB="",aB=Object.freeze({__proto__:null,default:oB}),cB="",lB=Object.freeze({__proto__:null,default:cB}),uB="",hB=Object.freeze({__proto__:null,default:uB}),fB="",dB=Object.freeze({__proto__:null,default:fB}),pB="",mB=Object.freeze({__proto__:null,default:pB}),gB="",yB=Object.freeze({__proto__:null,default:gB}),_B=`desc;$DKGRAYhalt until the next cycle
`,bB=Object.freeze({__proto__:null,default:_B}),wB=`desc;$DKGRAYevals condition for true or false
`,kB=Object.freeze({__proto__:null,default:wB}),vB="",xB=Object.freeze({__proto__:null,default:vB}),EB="",AB=Object.freeze({__proto__:null,default:EB}),TB="",SB=Object.freeze({__proto__:null,default:TB}),RB="",OB=Object.freeze({__proto__:null,default:RB}),IB="",NB=Object.freeze({__proto__:null,default:IB}),CB="",LB=Object.freeze({__proto__:null,default:CB}),MB="",UB=Object.freeze({__proto__:null,default:MB}),$B="",PB=Object.freeze({__proto__:null,default:$B}),FB="",BB=Object.freeze({__proto__:null,default:FB}),DB="",jB=Object.freeze({__proto__:null,default:DB}),zB="",WB=Object.freeze({__proto__:null,default:zB}),HB="",GB=Object.freeze({__proto__:null,default:HB}),KB="",qB=Object.freeze({__proto__:null,default:KB}),YB="",VB=Object.freeze({__proto__:null,default:YB}),XB="",ZB=Object.freeze({__proto__:null,default:XB}),JB="",QB=Object.freeze({__proto__:null,default:JB}),eD="",tD=Object.freeze({__proto__:null,default:eD}),rD="",nD=Object.freeze({__proto__:null,default:rD}),iD="",sD=Object.freeze({__proto__:null,default:iD}),oD="",aD=Object.freeze({__proto__:null,default:oD}),cD="",lD=Object.freeze({__proto__:null,default:cD}),uD=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,hD=Object.freeze({__proto__:null,default:uD}),fD="",dD=Object.freeze({__proto__:null,default:fD}),pD="",mD=Object.freeze({__proto__:null,default:pD}),gD="",yD=Object.freeze({__proto__:null,default:gD}),_D="",bD=Object.freeze({__proto__:null,default:_D}),wD="",kD=Object.freeze({__proto__:null,default:wD}),vD="",xD=Object.freeze({__proto__:null,default:vD}),ED="",AD=Object.freeze({__proto__:null,default:ED}),TD="",SD=Object.freeze({__proto__:null,default:TD}),RD="",OD=Object.freeze({__proto__:null,default:RD}),ID="",ND=Object.freeze({__proto__:null,default:ID}),CD="",LD=Object.freeze({__proto__:null,default:CD}),MD="",UD=Object.freeze({__proto__:null,default:MD}),$D="",PD=Object.freeze({__proto__:null,default:$D}),FD="",BD=Object.freeze({__proto__:null,default:FD}),DD="",jD=Object.freeze({__proto__:null,default:DD}),zD="",WD=Object.freeze({__proto__:null,default:zD}),HD="",GD=Object.freeze({__proto__:null,default:HD}),KD="",qD=Object.freeze({__proto__:null,default:KD}),YD="",VD=Object.freeze({__proto__:null,default:YD}),XD=`desc;$DKGRAYdesignates an inactive label or comment
`,ZD=Object.freeze({__proto__:null,default:XD}),JD=`desc;$DKGRAYadds hyperlink text

`,QD=Object.freeze({__proto__:null,default:JD}),e4=`desc;$DKGRAYsends the given message when hotkey is pressed

`,t4=Object.freeze({__proto__:null,default:e4}),r4=`desc;$DKGRAYread number input into given stat/flag
`,n4=Object.freeze({__proto__:null,default:r4}),i4=`desc;$DKGRAYa slider input from 1 to 9 

`,s4=Object.freeze({__proto__:null,default:i4}),o4=`desc;$DKGRAYlist with label value pairs to pick from
`,a4=Object.freeze({__proto__:null,default:o4}),c4=`desc;$DKGRAYread text input into given stat/flag
`,l4=Object.freeze({__proto__:null,default:c4}),u4=`desc;$DKGRAYdesignates a starting point for running code
`,h4=Object.freeze({__proto__:null,default:u4}),f4=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,d4=Object.freeze({__proto__:null,default:f4}),p4=`desc;$DKGRAYwill move the object in the given direction
`,m4=Object.freeze({__proto__:null,default:p4}),g4=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,y4=Object.freeze({__proto__:null,default:g4}),_4=`desc;$DKGRAYcustom 8x14 charset
`,b4=Object.freeze({__proto__:null,default:_4}),w4=`desc;$DKGRAYsets stat to given value

`,k4=Object.freeze({__proto__:null,default:w4}),v4=`desc;$DKGRAYsends the given message when hotkey is pressed

`,x4=Object.freeze({__proto__:null,default:v4}),E4=`desc;$DKGRAYread external content and/or handle events
`,A4=Object.freeze({__proto__:null,default:E4}),T4=`desc;$DKGRAYread number input into given stat/flag
`,S4=Object.freeze({__proto__:null,default:T4}),R4=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,O4=Object.freeze({__proto__:null,default:R4}),I4=`desc;$DKGRAYcustom palette colors
`,N4=Object.freeze({__proto__:null,default:I4}),C4=`desc;$DKGRAYa slider input from 1 to 9 

`,L4=Object.freeze({__proto__:null,default:C4}),M4=`desc;$DKGRAYlist with label value pairs to pick from
`,U4=Object.freeze({__proto__:null,default:M4}),$4=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,P4=Object.freeze({__proto__:null,default:$4}),F4=`desc;$DKGRAYread text input into given stat/flag
`,B4=Object.freeze({__proto__:null,default:F4}),D4=`desc;$DKGRAYadds text
`,j4=Object.freeze({__proto__:null,default:D4}),z4=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,W4=Object.freeze({__proto__:null,default:z4}),H4=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,G4=Object.freeze({__proto__:null,default:H4}),K4=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,q4=Object.freeze({__proto__:null,default:K4}),Y4=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,V4=Object.freeze({__proto__:null,default:Y4}),X4=`header;player settings
#set user "name goes here"
`,Z4=Object.freeze({__proto__:null,default:X4}),J4=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,Q4=Object.freeze({__proto__:null,default:J4}),ej=`section;#autowah on
#autowah <number>
$white 0-100, 0 is off, 100 is full volume
#autowah basefrequency <frequency>
$white The frequency the filter is set to at the
$white low point of the wah.
#autowah octaves <number>
$white The number of octaves above the baseFrequency 
$white the filter will sweep to when fully open.
#autowah sensitivity <number>
$white The decibel threshold sensitivity for 
$white the incoming signal.
$white Normal range of -40 to 0.
#autowah gain <number>
$white Controls the loudness of the effect.
#autowah follower <seconds>
$white Sets the smoothing time for the effect.`,tj=Object.freeze({__proto__:null,default:ej}),rj=`section;#distort on
#distort <number>
$white 0-100, 0 is off, 100 is full volume
#distort distortion <number>
$white 0 or higher, controls strength of effect.
#distort oversample <2x|4x|none>
$white oversample improves quality.`,nj=Object.freeze({__proto__:null,default:rj}),ij=`section;#echo on
#echo <number>
$white 0-100, 0 is off, 100 is full volume
#echo delaytime <seconds>
$white duration between echos.
#echo feedback <number>
$white A number that is between [0, 1]
$white 1 is forever feedback and 0 is none.`,sj=Object.freeze({__proto__:null,default:ij}),oj=`!fcrushscroll hk f F next;#fcrush on
!echoscroll hk e E next;#echo on
!reverbscroll hk r R next;#reverb on
!phaserscroll hk p P next;#phaser on
!distortscroll hk d D next;#distort on
!vibratoscroll hk v V next;#vibrato on
!autowahscroll hk a A next;#autowah on`,aj=Object.freeze({__proto__:null,default:oj}),cj=`section;#fcrush on
#fcrush <number>
$white 0-100, 0 is off, 100 is full volume
#fcrush rate <number>
$white 1 or higher, more rate, more crush`,lj=Object.freeze({__proto__:null,default:cj}),uj=`section;helper scrolls
!termscroll hk t T next;terminal commands
!charscroll hk a A next;char
!colorscroll hk c C next;color
!notesscroll hk n N next;notes
!synthscroll hk s S next;synth
!effectsscroll hk e E next;effects
!voicescroll hk v V next;tts voices
!dictionary hk d D next;dictionary of commands
`,hj=Object.freeze({__proto__:null,default:uj}),fj=`"duration             cdefgab = notes 
"y = 64th note        x = rest
"t = 32nd note        
"s = 16th note        drums
"i = eight note       0 = hihat
"q = quarter note     1 = open hihat
"h = half note        2 = cowbell
"w = whole note       p = clap
"mods                 4 = high snare
"3 = triplet          5 = high woodblock
". = time and a half  6 = low snare
"# = sharp            7 = low tom
"! = flat             8 = low woodblock
"+ = increase octave  9 = bass drum
"- = decrease octave`,dj=Object.freeze({__proto__:null,default:fj}),pj=`section;sine, square, triangle, sawtooth
#synth phase <degrees>
$white The phase is the starting position within 
$white the oscillator's cycle. For example a phase 
$white of 180 would start halfway through the
$white oscillator's cycle.
section;amsine, amsquare, amtriangle, amsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
section;fmsine, fmsquare, fmtriangle, fmsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
#synth modindex <degrees>
$white The modulation index which is in essence
$white the depth or amount of the modulation.
$white In other terms it is the ratio of the 
$white frequency of the modulating signal (mf) 
$white to the amplitude of the modulating signal 
$white (ma) -- as in ma/mf
section;fatsine, fatsquare, fattriangle, fatsawtooth
#synth phase <degrees>
#synth count <number>
$white This sets the number of oscillators to 
$white spread along the given range.
#synth spread <cents>
$white This signals the number of cents between
$white oscillators.`,mj=Object.freeze({__proto__:null,default:pj}),gj=`section;#phaser on
#phaser <number>
$white 0-100, 0 is off, 100 is full volume
#phaser frequency <frequency>
$white The rate of oscilation of the effect.
#phaser octaves <number>
$white Controls the range of the effect.
#phaser basefrequency <frequency>
$white The base frequency of the filters.
`,yj=Object.freeze({__proto__:null,default:gj}),_j=`section;pulse
#synth width <range>
$white A number that is between [-1, 1] altering
$white this value changes the shape of the square
$white wave`,bj=Object.freeze({__proto__:null,default:_j}),wj=`section;pwm
#synth modfreq <frequency>
$white This sets the frequency of change for the 
$white pulse width of this oscillator.`,kj=Object.freeze({__proto__:null,default:wj}),vj=`section;#reverb on
#reverb <number>
$white 0-100, 0 is off, 100 is full volume
#reverb predelay <seconds>
$white The amount of time before the reverb
$white is fully ramped in.
#reverb decay <seconds>
$white The duration of the reverb.
`,xj=Object.freeze({__proto__:null,default:vj}),Ej=`switching voices
#synth <sine, square, triangle, sawtooth> 
#synth <pwm, pulse, bells, doot>
#synth <retro, buzz, clang, metallic>

voice settings
#synth restart - resets voice to default
#synth vol <db> - control volume
#synth port <seconds>
#synth env <attack> <delay> <sustain> <release>

voice specific 
!oscscroll hk o O next;sine, square, triangle, sawtooth
!pwmscroll hk m M next;pwm
!pulsescroll hk p P next;pulse`,Aj=Object.freeze({__proto__:null,default:Ej}),Tj=`press$white C$yellow to chat
press$white #$yellow to run a quick command
section;dev-tools
#gadget
$white toggles inspector tool on/off
#zztrandom
$white downloads random from the museumofzzt api
#zztsearch <field> <value>
$white searches the museumofzzt api for zzt games
section;multi-player
#set user <name>
$white sets your display name when talking to others
#joincode OR ctrl+O 
$white starts a multi-player session showing a
$white QR code. It also provides are sharable link
$white you can give to other to join the game.`,Sj=Object.freeze({__proto__:null,default:Tj}),Rj=`section;#vibrato on
#vibrato <number>
$white 0-100, 0 is off, 100 is full volume
#vibrato maxdelay <seconds>
$white longer delay increases the vibrato`,Oj=Object.freeze({__proto__:null,default:Rj}),Ij=`!copyit "ar-SA-HamedNeural";ar-SA-HamedNeural
!copyit "ar-SA-ZariyahNeural";ar-SA-ZariyahNeural
!copyit "de-DE-AmalaNeural";de-DE-AmalaNeural
!copyit "de-DE-ConradNeural";de-DE-ConradNeural
!copyit "de-DE-KatjaNeural";de-DE-KatjaNeural
!copyit "de-DE-KillianNeural";de-DE-KillianNeural
!copyit "en-US-AnaNeural";en-US-AnaNeural
!copyit "en-US-AndrewNeural";en-US-AndrewNeural
!copyit "en-US-AriaNeural";en-US-AriaNeural
!copyit "en-US-ChristopherNeural";en-US-ChristopherNeural
!copyit "en-US-EricNeural";en-US-EricNeural
!copyit "en-US-GuyNeural";en-US-GuyNeural
!copyit "en-US-JennyNeural";en-US-JennyNeural
!copyit "en-US-MichelleNeural";en-US-MichelleNeural
!copyit "en-US-RogerNeural";en-US-RogerNeural
!copyit "en-US-SteffanNeural";en-US-SteffanNeural
!copyit "es-ES-AlvaroNeural";es-ES-AlvaroNeural
!copyit "es-ES-ElviraNeural";es-ES-ElviraNeural
!copyit "fr-FR-DeniseNeural";fr-FR-DeniseNeural
!copyit "fr-FR-EloiseNeural";fr-FR-EloiseNeural
!copyit "fr-FR-HenriNeural";fr-FR-HenriNeural`,Nj=Object.freeze({__proto__:null,default:Ij});const Ex=Object.assign({"./editor/codepagename.txt":aF,"./editor/command/become.txt":lF,"./editor/command/bgplay.txt":hF,"./editor/command/bgvol.txt":dF,"./editor/command/bind.txt":mF,"./editor/command/board.txt":yF,"./editor/command/bpm.txt":bF,"./editor/command/break.txt":kF,"./editor/command/change.txt":xF,"./editor/command/char.txt":AF,"./editor/command/charset.txt":SF,"./editor/command/clear.txt":OF,"./editor/command/color.txt":NF,"./editor/command/continue.txt":LF,"./editor/command/copy.txt":UF,"./editor/command/cycle.txt":PF,"./editor/command/die.txt":BF,"./editor/command/distort.txt":jF,"./editor/command/do.txt":WF,"./editor/command/done.txt":GF,"./editor/command/duplicate.txt":qF,"./editor/command/echo.txt":VF,"./editor/command/edge.txt":ZF,"./editor/command/else.txt":QF,"./editor/command/elseif.txt":tB,"./editor/command/end.txt":nB,"./editor/command/endgame.txt":sB,"./editor/command/endwith.txt":aB,"./editor/command/fcrush.txt":lB,"./editor/command/fetch.txt":hB,"./editor/command/fetchwith.txt":dB,"./editor/command/foreach.txt":mB,"./editor/command/go.txt":yB,"./editor/command/idle.txt":bB,"./editor/command/if.txt":kB,"./editor/command/lock.txt":xB,"./editor/command/oneof.txt":AB,"./editor/command/oneofwith.txt":SB,"./editor/command/palette.txt":OB,"./editor/command/phaser.txt":NB,"./editor/command/pivot.txt":LB,"./editor/command/play.txt":UB,"./editor/command/put.txt":PB,"./editor/command/putwith.txt":BB,"./editor/command/readbin.txt":jB,"./editor/command/readjson.txt":WB,"./editor/command/readline.txt":GB,"./editor/command/readrexpaint.txt":qB,"./editor/command/remix.txt":VB,"./editor/command/repeat.txt":ZB,"./editor/command/restore.txt":QB,"./editor/command/reverb.txt":tD,"./editor/command/revert.txt":nD,"./editor/command/run.txt":sD,"./editor/command/runwith.txt":aD,"./editor/command/set.txt":lD,"./editor/command/shoot.txt":hD,"./editor/command/shootwith.txt":dD,"./editor/command/shove.txt":mD,"./editor/command/snapshot.txt":yD,"./editor/command/synth.txt":bD,"./editor/command/toast.txt":kD,"./editor/command/tts.txt":xD,"./editor/command/ttsvol.txt":AD,"./editor/command/twitchbroadcast.txt":SD,"./editor/command/twitchchat.txt":OD,"./editor/command/unlock.txt":ND,"./editor/command/vibrato.txt":LD,"./editor/command/vol.txt":UD,"./editor/command/waitfor.txt":PD,"./editor/command/walk.txt":BD,"./editor/command/weave.txt":jD,"./editor/command/while.txt":WD,"./editor/command/with.txt":GD,"./editor/command/write.txt":qD,"./editor/command/zap.txt":VD,"./editor/comment.txt":ZD,"./editor/hyperlink.txt":QD,"./editor/hyperlink/hotkey.txt":t4,"./editor/hyperlink/number.txt":n4,"./editor/hyperlink/range.txt":s4,"./editor/hyperlink/select.txt":a4,"./editor/hyperlink/text.txt":l4,"./editor/label.txt":h4,"./editor/shortgo.txt":d4,"./editor/shorttry.txt":m4,"./editor/stat/board.txt":y4,"./editor/stat/charset.txt":b4,"./editor/stat/const.txt":k4,"./editor/stat/hotkey.txt":x4,"./editor/stat/loader.txt":A4,"./editor/stat/number.txt":S4,"./editor/stat/object.txt":O4,"./editor/stat/palette.txt":N4,"./editor/stat/range.txt":L4,"./editor/stat/select.txt":U4,"./editor/stat/terrain.txt":P4,"./editor/stat/text.txt":B4,"./editor/text.txt":j4,"./help/controls.txt":W4,"./help/developer.txt":G4,"./help/menu.txt":q4,"./help/nopages.txt":V4,"./help/player.txt":Z4,"./help/text.txt":Q4,"./refscroll/autowahscroll.txt":tj,"./refscroll/distortscroll.txt":nj,"./refscroll/echoscroll.txt":sj,"./refscroll/effectsscroll.txt":aj,"./refscroll/fcrushscroll.txt":lj,"./refscroll/menu.txt":hj,"./refscroll/notesscroll.txt":dj,"./refscroll/oscscroll.txt":mj,"./refscroll/phaserscroll.txt":yj,"./refscroll/pulsescroll.txt":bj,"./refscroll/pwmscroll.txt":kj,"./refscroll/reverbscroll.txt":xj,"./refscroll/synthscroll.txt":Aj,"./refscroll/termscroll.txt":Sj,"./refscroll/vibratoscroll.txt":Oj,"./refscroll/voicescroll.txt":Nj}),Ax={};Fr(Ex).forEach(t=>{const e=t.replace(".txt","").replace("./","").replaceAll("/",":");Ax[e]=Ex[t].default});function ku(t){const e=Fe(t.trim().replaceAll(`
`,"").replace(/:+$/,"")),r=Ax[e];if(w(r))return r;const{target:n,path:i}=Dr(e);switch(n){case"editor":{const s=Dr(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function Tp(t,e){const r=(t??"").split(`
`);for(let n=0;n<r.length;++n)e(r[n].split(";"))}function Cj(t,e){const[r,...n]=e,i=n[0]??"",s=n[1]??"";switch(Fe(r.trim())){case"header":Ap(le,t,i);break;case"section":Fs(le,t,i);break;case"option":Bs(le,t,i,s);break;default:r.trimStart().startsWith("!")?iF(le,t,r.trimStart().slice(1),i):bt(le,t,r);break}}const Ds="$dkpurple",Lj="$196",Mj="$205";function Uj(t,e){const r=Lj.repeat(e);Ie(t,`${Ds}${r}`)}function Tx(t,e){const r=Mj.repeat(e);Ie(t,`${Ds}${r}`)}function $j(t,e){Ie(t,`${Ds} ${" ".repeat(e.length)} `),Uj(t,e.length+2),Ie(t,`${Ds} $white${e} `),Tx(t,e.length+2)}function Pj(t,e){Ie(t,`${Ds} ${" ".repeat(e.length)} `),Ie(t,`${Ds} $gray${e} `),Tx(t,e.length+2)}function Fj(t,e,r){Ie(t,`${Ds} $white${e} $blue${r}`)}function Sx(t,e){const[r,...n]=e,i=n[0]??"",s=n[1]??"";switch(Fe(r.trim())){case"header":$j(t,i);break;case"section":Pj(t,i);break;case"option":Fj(t,i,s);break;default:if(r.trimStart().startsWith("!")){const o=r.trimStart().slice(1).split(" ");switch(Fe(o[0]??"")){case"copyit":Be(t,"refscroll",i,["",o[0]??"",o[1]??""]);break;default:{switch(Fe(o[1]??"")){case"hk":case"hotkey":Be(t,"refscroll",i,[o[0]??"",o[1]??"",o[2]??"",` ${o[3]??""} `,o[4]??""]);break;default:Be(t,"refscroll",i,[o[0]??""]);break}break}}}else r.trimStart().startsWith('"')?Ie(t,r.trimStart().slice(1)):Ie(t,r);break}}function Li(t,e=!1){const[r]=ue(t,0,[Z.ANY]);if(e&&sn(r)){const[n,i,s]=ue(t,0,[Z.DIR,Z.MAYBE_NAME]);return ye(i)&&i.startsWith(":")?{targetdir:n,label:[i.substring(1).trim(),...t.slice(s)].join(" ")}:{targetdir:n,label:t.slice(s-1).join(" ")}}else if(ye(r)){const[n,i,s]=ue(t,0,[Z.NAME,Z.MAYBE_NAME]);if(ye(i)&&i.startsWith(":")){const a=[i.substring(1).trim(),...t.slice(s)];return{targetname:n,label:a.join(" ")}}return{targetname:"self",label:[n,...t.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function js(){sg(le,vr())}function $o(t){Tp(ku(`help:${t}`),e=>Cj(x.elementfocus,e))}function Rx(t){switch(t.label){case"helpmenu":$o("menu");break;case"helpcontrols":$o("controls");break;case"helptext":$o("text");break;case"helpdeveloper":$o("developer");break;case"helpplayer":$o("player");break;default:{const e=dt(Xe.MAIN),r=Mo(e);w(t.targetname)?Ho(t.targetname,t.label,void 0,r):w(t.targetdir)&&Ho(t.targetdir.destpt,t.label,void 0,r);break}}}const Bj=ki().command("shortsend",(t,e)=>{const r=Li(e);return Rx(r),0}).command("send",(t,e)=>{const r=Li(e,!0);return Rx(r),0}).command("stat",(t,e)=>{const[r,...n]=e.map(Pt),i=n.join(" ");function s(o,a){if(w(o)&&(t.command("pageopen",o.id),a)){const c=gt(o),l=Oi(o);bt(le,x.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(Fe(r)){case cn(Pe.LOADER):{const[o,a]=ts(Xe.MAIN,i,Re.LOADER);s(o,a);break}default:{const[o,a]=ts(Xe.MAIN,[r,...n].join(" "),Re.OBJECT);s(o,a);break}case cn(Pe.BOARD):{const[o,a]=ts(Xe.MAIN,i,Re.BOARD);s(o,a);break}case cn(Pe.OBJECT):{const[o,a]=ts(Xe.MAIN,i,Re.OBJECT);s(o,a);break}case cn(Pe.TERRAIN):{const[o,a]=ts(Xe.MAIN,i,Re.TERRAIN);s(o,a);break}case cn(Pe.CHARSET):{const[o,a]=ts(Xe.MAIN,i,Re.CHARSET);s(o,a);break}case cn(Pe.PALETTE):{const[o,a]=ts(Xe.MAIN,i,Re.PALETTE);s(o,a);break}}return 0}).command("text",(t,e)=>{const r=e.map(Pt).join(" ");if(w(x.element)&&x.elementisplayer){const{user:n}=Xr(x.elementid),i=ye(n)?n:"player";x.element.tickertext=`${i}:$BLUE ${r}`,x.element.tickertime=x.timestamp;const s=rr(x.element);BS(le,x.elementid,`$${it[s.color]}$ON${it[s.bg]}$${s.char}$ONCLEAR$WHITE ${i}:$BLUE ${r}`),Mh(le,x.elementid,void 0,"text","chat:message:game",`${i}:${r}`)}return 0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Pt(r),s=Li(n);if(w(s.targetname)){const{user:o}=Xr(x.elementid),a=ye(o)?o:"player",c=rr(x.element),l=`$${it[c.color]}$ON${it[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;Bt(le,x.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(t,e)=>{const[r,n]=ue(e,0,[Z.MAYBE_NAME,Z.MAYBE_STRING]);return ye(r)&&ye(n)?rg(le,x.elementfocus,r,n):gR(le,x.elementfocus),0}).command("bookcreate",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]),n=IA(r);return w(n)&&t.command("bookopen",n.id),0}).command("bookopen",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=jn(r);return w(n)?(rg(le,x.elementfocus,"selected",n.id),js()):mt(le,x.elementfocus,"bookopen",`book ${r} not found`),0}).command("booktrash",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=dt(Xe.MAIN),i=jn(r);return w(i)&&(n===i&&OA(Xe.MAIN,""),e7(r),Bt(le,x.elementfocus,`trashed [book] ${i.name}`),js(),t.command("pages")),0}).command("boardopen",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=dr(r);return w(n)&&Lo(x.book,x.elementfocus,n.id,{x:nn(0,Ue-1),y:nn(0,rt-1)},!0),0}).command("pageopen",(t,e)=>{const[r,n]=ue(e,0,[Z.NAME,Z.MAYBE_NAME]);let i,s;const o=un();for(let a=0;a<o.length&&(s=o[a],i=Ls(s,r),!w(i));++a);if(w(i)&&w(s)){const a=gt(i),c=[i.id,n];Tf(xc(s.id,c),i.code);const l=Oi(i);ng(le,x.elementfocus,s.id,c,l,`${a} - ${s.name}`)}else mt(le,"pageopen",`page ${r} not found`,x.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=hr(Xe.MAIN),i=ex(n,r);if(w(r)){const s=gt(i),o=Oi(i);Bt(le,x.elementfocus,`trashed [${o}] ${s}`),js(),t.command("pages")}return 0}).command("help",(t,e)=>{const r=e.map(Pt).join(" ")||"menu";return t.command(`help${r}`),0}).command("books",()=>{Fs(le,x.elementfocus,"books");const t=dt(Xe.MAIN);Bs(le,x.elementfocus,"main",`${t?.name??"empty"} $GREEN${t?.id??""}`);const e=dt(Xe.MAIN);Bs(le,x.elementfocus,"content",`${e?.name??"empty"} ${e?.id??""}`),Ep(le,x.elementfocus,7);const r=un();return r.length?r.forEach(n=>{bt(le,x.elementfocus,`!bookopen ${n.id};${n.name}`)}):Uo(le,x.elementfocus,"no books found"),bt(le,x.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const t=hr(Xe.MAIN);if(!w(t))return 0;Fs(le,x.elementfocus,"pages"),Bs(le,x.elementfocus,"main",`${t.name} $GREEN${t.id}`),t.pages.length?Ja(t).forEach(n=>{const i=gt(n),s=Oi(n);bt(le,x.elementfocus,`!pageopen ${n.id};$blue[${s}]$white ${i}`)}):(bt(le,x.elementfocus,""),$o("nopages"));const e=un();for(let r=0;r<e.length;++r){const n=e[r];n.id!==t.id&&(Bs(le,x.elementfocus,"content",`${n.name} $GREEN${n.id}`),Ja(n).forEach(s=>{const o=gt(s),a=Oi(s);bt(le,x.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Fs(le,x.elementfocus,"boards");const t=hr(Xe.MAIN);if(w(t)){Bs(le,x.elementfocus,"main",`${t.name} $GREEN${t.id}`);const r=Ja(t);r.filter(n=>ui(n)===Re.BOARD).forEach(n=>{const i=gt(n);bt(le,x.elementfocus,`!boardopen ${n.id};$blue[#goto]$white ${i}`)}),r.length===0&&(bt(le,x.elementfocus,""),Uo(le,x.elementfocus,"$white no boards found"),Uo(le,x.elementfocus,"$white use @ to create a board"),Uo(le,x.elementfocus,"$white @board name of board"))}const e=un();for(let r=0;r<e.length;++r){const n=e[r];n.id!==t.id&&(Bs(le,x.elementfocus,"content",`${n.name} $GREEN${n.id}`),Ja(n).filter(s=>ui(s)===Re.BOARD).forEach(s=>{const o=gt(s);bt(le,x.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{Fs(le,x.elementfocus,"$REDTRASH"),Uo(le,x.elementfocus,"books");const t=un();t.length&&(t.forEach(r=>{bt(le,x.elementfocus,`!booktrash ${r.id};$REDTRASH ${r.name}`)}),bt(le,x.elementfocus,""));const e=dt(Xe.MAIN);return w(e)&&(Uo(le,x.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(r=>{const n=gt(r);bt(le,x.elementfocus,`!pagetrash ${r.id};$REDTRASH ${n}`)}),bt(le,x.elementfocus,"")),0}).command("dev",()=>(js(),rR(le,x.elementfocus),0)).command("share",()=>(js(),nR(le,x.elementfocus),0)).command("save",()=>(js(),0)).command("fork",()=>(AR(le,x.elementfocus),0)).command("itchiopublish",()=>(TR(le,x.elementfocus),0)).command("nuke",()=>(iR(le,x.elementfocus),0)).command("restart",()=>(ER(le,x.elementfocus),js(),0)).command("export",()=>{Ap(le,x.elementfocus,"E X P O R T"),Fs(le,x.elementfocus,"books");const t=un();return t.length&&t.forEach(e=>bt(le,x.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=jn(r);return w(n)&&(Ap(le,x.elementfocus,"E X P O R T"),Fs(le,x.elementfocus,"pages"),setTimeout(()=>{if(n.pages.length){const i=Ja(n);bt(le,x.elementfocus,`!bookallexport ${r};$blue[all]$white export book`),i.forEach(s=>{const o=gt(s),a=Oi(s);bt(le,x.elementfocus,`!pageexport ${r}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=jn(r);return w(n)&&eg(le,x.elementfocus,Sn(n),`${n.name}.book.json`),0}).command("pageexport",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),{target:n,path:i}=Dr(r),s=jn(n),o=Ls(s,i);return w(o)&&eg(le,x.elementfocus,Sn(o),`${gt(o)}.${Oi(o)}.json`),0}).command("gadget",()=>(yR(le,x.elementfocus),0)).command("zztsearch",(t,e)=>{const[r,n]=ue(e,0,[Z.NAME,Z.MAYBE_NAME]),i=w(n)?r:"title",s=w(n)?n:r;return bR(le,x.elementfocus,i,s),0}).command("zztrandom",()=>(wR(le,x.elementfocus),0)).command("joincode",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return GS(le,x.elementfocus,!!r),0}).command("jointab",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return KS(le,x.elementfocus,!!r),0}).command("startlookingglass",()=>(sR(le,x.elementfocus),0)),Dj=ki().command("toast",(t,e)=>{const r=e.map(Pt).join("");return ia(le,x.elementfocus,r),0}).command("ticker",(t,e)=>{const r=e.map(Pt).join("");return w(x.element)&&(x.element.tickertext=r,x.element.tickertime=x.timestamp),0}).command("palette",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=CA(),i=fr(Re.PALETTE,r);return w(i)?(n.palette=i.id,Bt(le,x.elementfocus,`loaded palette ${r}`)):mt(le,x.elementfocus,"not-found",`unabled to find palette ${r}`),0}).command("charset",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=CA(),i=fr(Re.CHARSET,r);return w(i)?(n.charset=i.id,Bt(le,x.elementfocus,`loaded charset ${r}`)):mt(le,x.elementfocus,"not-found",`unabled to find charset ${r}`),0}),Sp={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};We.ISSOLID,We.ISWALK,We.ISSWIM,We.ISBULLET,We.ISGHOST,We.ISWALK,We.ISSWIM;function vu(t){return ut(t)&&Rp(t[0])}function Rp(t){return w(We[t])&&ye(t)}function jj(t){if(ye(t))return Sp[Fe(t)]}function zj(t){const e=x.words[t];if(vu(e))return[e,t+1];if(Rp(e))return[[e],t+1];const[r,n]=Lr(t);return vu(r)?[r,n]:Rp(r)?[[r],n]:[void 0,t]}function Po(t,e=0){const r=[];let n=t;for(;n<x.words.length;){const[i,s]=Lr(n);if(ut(i)&&!sn(i)&&!rc(i)&&!vu(i)&&!Rr(i)&&r.push(...i),i==="|")return[r,s];if(n=s,r.push(i),e>0&&r.length>=e)return[r,n]}return[r,n]}function Lr(t){const e=x.words[t],r=t+1;if(Ix(e)){const[n,i]=Wj(t);if(w(n))return[n,i]}if(jj(e)){const[n,i]=zj(t);if(w(n))return[n,i]}if(va(e)){const[n,i]=sl(t);if(w(n))return[n,i]}if(ye(e)&&Fe(e)==="rnd"){const[n,i]=Lr(r),[s,o]=Lr(i);return Te(n)&&Te(s)?[nn(n,s),o]:Te(n)?[nn(0,n),i]:[nn(0,1),r]}if(rl(e)){const[n,i]=l_(t);if(w(n))return[n,i]}if(!w(e))return[void 0,t];if(Te(e)||ut(e))return[e,r];if(ye(e)){const n=Fe(e),i=x.get?.(e);if(w(i))return[i,r];switch(n){case"aligned":case"alligned":{const s=uc(x.board,{x:x.element?.x??-1,y:x.element?.y??-1},x.elementfocus);return!w(x.element)||!w(s)?[0,r]:[x.element.x===s.x||x.element.y===s.y?1:0,r]}case"contact":{const s=uc(x.board,{x:x.element?.x??-1,y:x.element?.y??-1},x.elementfocus);if(!w(x.element)||!w(s))return[0,r];const o=(s.x??0)-(x.element?.x??0),a=(s.y??0)-(x.element?.y??0);return[o===0&&Math.abs(a)<2||a===0&&Math.abs(o)<2?1:0,r]}case"blocked":{const[s,o]=ue(x.words,r,[Z.DIR]);return[oP(x.board,x.element,s.destpt)?1:0,o]}case"any":{const[s]=ue(x.words,r,[Z.ANY]);if(sn(s)){const[l,u,d]=ue(x.words,r,[Z.DIR,Z.COLOR_OR_KIND]);if(l.targets.length){const h=[];for(let m=0;m<l.targets.length;++m){const p=l.targets[m],g=["any","at",p.x,p.y,...u],[y]=ue(g,0,[Z.ANY]);ut(y)&&y.length&&h.push(...y)}return[h,d]}const f=l.layer===ve.MID?nt(x.board,l.destpt):rs(x.board,l.destpt.x,l.destpt.y);if(w(f)){const h=rr(f);if(Rr(u))return[nl(u)===h.color||il(u)===h.bg?[f]:[],d];const m=Fe(cc(u)),p=Du(u);if((m.length&&m!==h.name||w(p)&&p!==h.color)===!1)return[[f],d]}return[[],d]}const[o,a]=ue(x.words,r,[Z.COLOR_OR_KIND]);return Rr(o)?[BA(x.board,o),a]:[ju(x.board,o),a]}case"countof":{const[s]=ue(x.words,r,[Z.ANY]);if(sn(s)){const[l,u,d]=ue(x.words,r,[Z.DIR,Z.COLOR_OR_KIND]);if(l.targets.length){let h=0;for(let m=0;m<l.targets.length;++m){const p=l.targets[m],g=["countof","at",p.x,p.y,...u],[y]=ue(g,0,[Z.ANY]);Te(y)&&(h+=y)}return[h,d]}const f=l.layer===ve.MID?nt(x.board,l.destpt):rs(x.board,l.destpt.x,l.destpt.y);if(w(f)){const h=rr(f);if(Rr(u))return[nl(u)===h.color||il(u)===h.bg?1:0,d];const m=Fe(cc(u)),p=Du(u),g=m.length?m===h.name:!0,y=w(p)?p===h.color:!0;if(g&&y)return[1,d]}return[0,d]}const[o,a]=ue(x.words,r,[Z.COLOR_OR_KIND]);return Rr(o)?[BA(x.board,o).length,a]:[ju(x.board,o).length,a]}case"rnd":return[nn(0,1),r];case"abs":{const[s,o]=ue(x.words,r,[Z.NUMBER]);return[Math.abs(s),o]}case"intceil":{const[s,o]=ue(x.words,r,[Z.NUMBER]);return[Math.ceil(s),o]}case"intfloor":{const[s,o]=ue(x.words,r,[Z.NUMBER]);return[Math.floor(s),o]}case"intround":{const[s,o]=ue(x.words,r,[Z.NUMBER]);return[Math.round(s),o]}case"clamp":{const[s,o,a,c]=ue(x.words,r,[Z.NUMBER,Z.NUMBER,Z.NUMBER]);return[jt(s,o,a),c]}case"min":{const[s,o]=Po(r);return[Math.min(...s),o]}case"max":{const[s,o]=Po(r);return[Math.max(...s),o]}case"pick":{const[s,o]=Po(r);return[gn(s),o]}case"pickwith":{const[s,o]=ue(x.words,r,[Z.NUMBER_OR_STRING]),[a,c]=Po(o);return[SN(`${s}`,a),c]}case"random":{const[s,o]=Po(r,2),[a,c]=s;return[nn(a,c??0),o]}case"randomwith":{const[s,o]=ue(x.words,r,[Z.NUMBER_OR_STRING]),[a,c]=Po(o,2),[l,u]=a;return[i_(`${s}`,l,u??0),c]}case"run":{const[s,o]=ue(x.words,r,[Z.NAME]);return Bu(s),[x.get?.("arg"),o]}case"runwith":{const[s,o,a]=ue(x.words,r,[Z.ANY,Z.NAME]);return w(x.element)&&(x.element.arg=s),Bu(o),[x.get?.("arg"),a]}}}return[e,r]}const Op={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function rc(t){return ut(t)&&Ox(t[0])}function Ox(t){return w(Br[t])&&ye(t)}function Ix(t){if(ye(t))return Op[Fe(t)]}function Nx(t){if(rc(t))return t;if(Ox(t))return[t];const e=Ix(t);if(w(e))return[e]}function Wj(t){const e=x.words[t],r=Nx(e);if(rc(r))return[r,t+1];const[n,i]=Lr(t),s=Nx(n);return rc(s)?[s,i]:[void 0,t]}const Hj=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Cx=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"]),Gj=["NORTH","SOUTH","WEST","EAST"];function Kj(t){const e=Xr(t);if(Te(e.inputcurrent)||(e.inputcurrent=0),ut(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[r]=e.inputqueue,[n=Or.NONE,i=0]=r??[Or.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&qN?1:0,e.inputctrl=i&YN?1:0,e.inputshift=i&VN?1:0,n){case Or.MOVE_UP:case Or.MOVE_DOWN:case Or.MOVE_LEFT:case Or.MOVE_RIGHT:e.inputmove=[Gj[n-Or.MOVE_UP]];break;case Or.OK_BUTTON:e.inputok=1;break;case Or.CANCEL_BUTTON:e.inputcancel=1;break;case Or.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=n,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Or.NONE&&o!==n}),e}function qj(t){const e=Op[t];if(w(e))return e;const r=Sp[t];if(w(r))return r;const n=ka[t];if(w(n))return n;const i=Mf[t];if(w(i))return i}function Lx(){if(mr(x.board,x.element,x.timestamp),!!He(x.element,"item")){const e={x:x.element?.x??-1,y:x.element?.y??-1},r=uc(x.board,e,x.elementfocus);w(r)&&(r.x=e.x,r.y=e.y)}}const Yj=ki({get(t,e){const r=qj(e);if(w(r))return[!0,r];if(x.elementisplayer&&Hj.has(e)){const l=Kj(x.elementid)[e];return[w(l),l]}const n=uc(x.board,{x:x.element?.x??-1,y:x.element?.y??-1},x.elementfocus),i=n?.id??x.elementfocus??vr(),s=x.element?.sender,o=HA(x.board,ye(s)?s:""),a=o?.id??"";switch(e){case"camera":case"graphics":case"facing":if(w(x.board?.[e]))return[!0,x.board?.[e]];break;case"isdark":return[!0,x.board?.isdark?1:0];case"startx":return[!0,x.board?.startx??0];case"starty":return[!0,x.board?.starty??0];case"over":return[!0,x.board?.over??""];case"under":return[!0,x.board?.under??""];case"exitnorth":return[!0,x.board?.exitnorth??""];case"exitsouth":return[!0,x.board?.exitsouth??""];case"exitwest":return[!0,x.board?.exitwest??""];case"exiteast":return[!0,x.board?.exiteast??""];case"timelimit":return[!0,x.board?.timelimit??0];case"restartonzap":return[!0,x.board?.restartonzap??0];case"maxplayershots":return[!0,x.board?.maxplayershots??0];case"currenttick":return[!0,x.timestamp];case"boardid":return[!0,x.board?.id??""];case"playerid":return[!0,i];case"playerx":return[!0,n?.x??-1];case"playery":return[!0,n?.y??-1];case"thisid":return[!0,x.element?.id??""];case"thisx":return[!0,x.element?.x??-1];case"thisy":return[!0,x.element?.y??-1];case"senderid":return[!0,a];case"senderx":return[!0,o?.x??-1];case"sendery":return[!0,o?.y??-1];default:{if(Cx.has(e))return[!0,He(x.element,e)??0];break}}const c=Xr(i)[e];return[w(c),c]},set(t,e,r){const i=uc(x.board,{x:x.element?.x??-1,y:x.element?.y??-1},x.elementfocus)?.id??x.elementfocus;switch(e){case"camera":case"graphics":case"facing":break;case"isdark":if(w(x.board))return x.board.isdark=r?1:0,[!0,x.board.isdark];break;case"startx":if(w(x.board))return x.board.startx=ec(r,0),[!0,x.board.startx];break;case"starty":if(w(x.board))return x.board.starty=ec(r,0),[!0,x.board.starty];break;case"over":if(w(x.board))return x.board.over=Pt(r),[!0,x.board.over];break;case"under":if(w(x.board))return[!0,x.board.under=Pt(r)];break;case"exitnorth":if(w(x.board))return[!0,x.board.exitnorth=Pt(r)];break;case"exitsouth":if(w(x.board))return[!0,x.board.exitsouth=Pt(r)];break;case"exitwest":if(w(x.board))return[!0,x.board.exitwest=Pt(r)];break;case"exiteast":if(w(x.board))return[!0,x.board.exiteast=Pt(r)];break;case"timelimit":if(w(x.board))return[!0,x.board.timelimit=ec(r,0)];break;case"restartonzap":if(w(x.board))return[!0,x.board.restartonzap=r?1:0];break;case"maxplayershots":if(w(x.board))return[!0,x.board.maxplayershots=ec(r,0)];break;case"currenttick":return[!1,r];case"boardid":return[!1,r];case"playerid":return[!1,r];case"playerx":return[!1,r];case"playery":return[!1,r];case"thisid":return[!1,r];case"thisx":return[!1,r];case"thisy":return[!1,r];case"senderid":return[!1,r];case"senderx":return[!1,r];case"sendery":return[!1,r];default:{if(Cx.has(e))return w(x.element)&&(x.element[e]=r),[!0,r];break}}const s=Xr(i);return w(s)?(s[e]=r,[!0,r]):[!1,r]},everytick(){!x.element?.removed&&w(x.element?.x)&&w(x.element.y)&&w(x.element.stepx)&&w(x.element.stepy)&&(x.element.stepx||x.element.stepy)&&zn(x.book,x.board,x.element,{x:x.element.x+x.element.stepx,y:x.element.y+x.element.stepy})}}).command("clear",(t,e)=>{for(let r=0;r<e.length;++r)t.set(Pt(e[r]),0);return 0}).command("set",(t,e)=>{const[r,n]=ue(e,0,[Z.NAME,Z.ANY]);return t.set(r,n??1),0}).command("become",(t,e)=>{const[r]=ue(e,0,[Z.KIND]);ur(x.board);const n=rr(x.element),[i,s]=r,o=[...wo(n.color,n.bg),...s??[]],a=[i,o];if(du(x.board,x.element),mr(x.board,x.element,x.timestamp)){const c={x:x.element?.x??0,y:x.element?.y??0};hn(x.board,a,c)}return t.endofprogram(),0}).command("bind",(t,e)=>{const[r]=ue(e,0,[Z.NAME]),n=Go(x.board,r);return w(x.element)&&n.length>0&&(x.element.code=gn(...n).code??"",$A(x.elementid)),0}).command("char",(t,e)=>{const[r]=ue(e,0,[Z.ANY]);if(sn(r)){const[n,i]=ue(e,0,[Z.DIR,Z.NUMBER]),s=nt(x.board,n.destpt);w(s)&&(s.char=i)}else w(x.element)&&Te(r)&&(x.element.char=r);return 0}).command("color",(t,e)=>{const[r]=ue(e,0,[Z.ANY]);if(sn(r)){const[n,i]=ue(e,0,[Z.DIR,Z.COLOR]),s=nt(x.board,n.destpt);w(s)&&Ra(x.element,i)}else{const[n]=ue(e,0,[Z.COLOR]);w(x.element)&&w(n)&&Ra(x.element,n)}return 0}).command("go",(t,e)=>{if(w(x.element)){const[r]=ue(e,0,[Z.DIR]);if(zn(x.book,x.board,x.element,r.destpt),t.yield(),x.element.x===r.destpt.x&&x.element.y===r.destpt.y)return 0}return 1}).command("walk",(t,e)=>{if(!w(x.element))return 0;const[r]=ue(e,0,[Z.DIR]),n=x.element.x??0,i=x.element.y??0;return x.element.stepx=r.destpt.x-n,x.element.stepy=r.destpt.y-i,0}).command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[r]=ue(e,0,[Z.ANY]);return t.set("arg",r),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(Pt(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(Pt(e[0])),0)).command("cycle",(t,e)=>{if(w(x.element)){const[r]=ue(e,0,[Z.NUMBER]);x.element.cycle=jt(Math.round(r),1,255)}return 0}).command("die",t=>(Lx(),t.endofprogram(),0)).command("dieonend",()=>(Lx(),0)).command("endgame",()=>(Lh(le,x.elementfocus),0)).command("run",(t,e)=>{const[r]=ue(e,0,[Z.NAME]);return Bu(r),0}).command("runwith",(t,e)=>{const[r,n]=ue(e,0,[Z.ANY,Z.NAME]);return t.set("arg",r),Bu(n),0}),xu={};function Vj(t){return xu[t]?.arg}function Mx(t){return xu[t]?.format}function Fo(t){return xu[t]?.content}function Ux(t,e,r,n,i){const s=dt(Xe.MAIN);if(!w(s))return;const o=Ms(s,Re.LOADER).filter(a=>{const c=Cs(a),l=c.format,u=ye(l)?new RegExp(l).test(e):!1,d=c.event,f=ye(d)?new RegExp(d).test(r):!1;return ye(l)&&ye(d)?u&&f:ye(l)?u:ye(d)?f:!1});for(let a=0;a<o.length;++a){const c=`${Ft()}_loader`;xu[c]={arg:t,format:e,content:n,player:i},s7(c,o[a].code)}}function $x(t,e){if(!w(t))return;const r=Fe(e),n=r.endsWith("le");switch(r){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,n);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,n);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,n);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,n);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,n);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,n);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,n);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,n);return t.cursor+=8,i}}}const Xj=(t,e)=>{const r=Fo(t.id());if(!w(r))return 0;const[n,i]=ue(e,0,[Z.NAME]),s=Fe(n);switch(s){case"seek":{const[o]=ue(e,i,[Z.NUMBER]);r.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=ue(e,i,[Z.NAME]);t.set(o,$x(r,s));break}case"text":{const[o,a]=ue(e,i,[Z.NAME,Z.NAME]),c=$x(r,o);if(Te(c)&&ye(a)){const l=new Uint8Array(r.bytes.buffer,r.cursor,c),d=new TextDecoder("utf-8").decode(l);t.set(a,d),r.cursor+=c}break}case"palette":{const[o]=ue(e,i,[Z.NAME]),[a]=lp(x.book,Re.PALETTE,o),c=St(a);if(w(c)){const l=DN*cl,u=W_(new Uint8Array(r.bytes.buffer,r.cursor,l));w(u)&&(c.bits=u.bits),r.cursor+=l}break}case"charset":{const[o]=ue(e,i,[Z.NAME]),[a]=lp(x.book,Re.CHARSET,o),c=St(a);if(w(c)){const l=ll*BN*Pf,u=Xf(new Uint8Array(r.bytes.buffer,r.cursor,l));w(u)&&(c.bits=u.bits),r.cursor+=l}break}}return 0},Bo=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",Eu=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r+=1)if(!Eu(t[r],e[r]))return!1;return!0}if(Bo(t)&&Bo(e)){const r=Object.entries(t),n=new Set(Object.keys(e));if(r.length!==n.size)return!1;for(const[i,s]of r){if(!Eu(s,e[i]))return!1;n.delete(i)}return n.size===0}return!1},Au=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(Bo(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},Zj=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",Px=t=>t>="0"&&t<="9"||t==="-",Jj=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var oe;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(oe||(oe={}));const Fx={"(":oe.TOK_LPAREN,")":oe.TOK_RPAREN,"*":oe.TOK_STAR,",":oe.TOK_COMMA,".":oe.TOK_DOT,":":oe.TOK_COLON,"@":oe.TOK_CURRENT,$:oe.TOK_ROOT,"]":oe.TOK_RBRACKET,"{":oe.TOK_LBRACE,"}":oe.TOK_RBRACE},Qj={"!":!0,"<":!0,"=":!0,">":!0},e5={"	":!0,"\n":!0,"\r":!0," ":!0};class t5{constructor(){this._current=0}tokenize(e){const r=[];this._current=0;let n,i,s;for(;this._current<e.length;)if(Zj(e[this._current]))n=this._current,i=this.consumeUnquotedIdentifier(e),r.push({start:n,type:oe.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Fx[e[this._current]]!==void 0)r.push({start:this._current,type:Fx[e[this._current]],value:e[this._current]}),this._current+=1;else if(Px(e[this._current]))s=this.consumeNumber(e),r.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),r.push(s);else if(e[this._current]==='"')n=this._current,i=this.consumeQuotedIdentifier(e),r.push({start:n,type:oe.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")n=this._current,i=this.consumeRawStringLiteral(e),r.push({start:n,type:oe.TOK_LITERAL,value:i});else if(e[this._current]==="`"){n=this._current;const o=this.consumeLiteral(e);r.push({start:n,type:oe.TOK_LITERAL,value:o})}else if(Qj[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&r.push(s);else if(e5[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")n=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,r.push({start:n,type:oe.TOK_AND,value:"&&"})):r.push({start:n,type:oe.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")n=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,r.push({start:n,type:oe.TOK_OR,value:"||"})):r.push({start:n,type:oe.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return r}consumeUnquotedIdentifier(e){const r=this._current;for(this._current+=1;this._current<e.length&&Jj(e[this._current]);)this._current+=1;return e.slice(r,this._current)}consumeQuotedIdentifier(e){const r=this._current;this._current+=1;const n=e.length;for(;e[this._current]!=='"'&&this._current<n;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(r,this._current))}consumeRawStringLiteral(e){const r=this._current;this._current+=1;const n=e.length;for(;e[this._current]!=="'"&&this._current<n;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(r+1,this._current-1).replace("\\'","'")}consumeNumber(e){const r=this._current;this._current+=1;const n=e.length;for(;Px(e[this._current])&&this._current<n;)this._current+=1;const i=parseInt(e.slice(r,this._current),10);return{start:r,value:i,type:oe.TOK_NUMBER}}consumeLBracket(e){const r=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:r,type:oe.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:r,type:oe.TOK_FLATTEN,value:"[]"}):{start:r,type:oe.TOK_LBRACKET,value:"["}}consumeOperator(e){const r=this._current,n=e[r];if(this._current+=1,n==="!")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_NE,value:"!="}):{start:r,type:oe.TOK_NOT,value:"!"};if(n==="<")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_LTE,value:"<="}):{start:r,type:oe.TOK_LT,value:"<"};if(n===">")return e[this._current]==="="?(this._current+=1,{start:r,type:oe.TOK_GTE,value:">="}):{start:r,type:oe.TOK_GT,value:">"};if(n==="="&&e[this._current]==="=")return this._current+=1,{start:r,type:oe.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const r=this._current,n=e.length;for(;e[this._current]!=="`"&&this._current<n;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(r,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n=["true","false","null"],i="-0123456789";if(e==="")return!1;if('[{"'.includes(e[0])||n.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const r5=new t5,Tr={[oe.TOK_EOF]:0,[oe.TOK_UNQUOTEDIDENTIFIER]:0,[oe.TOK_QUOTEDIDENTIFIER]:0,[oe.TOK_RBRACKET]:0,[oe.TOK_RPAREN]:0,[oe.TOK_COMMA]:0,[oe.TOK_RBRACE]:0,[oe.TOK_NUMBER]:0,[oe.TOK_CURRENT]:0,[oe.TOK_EXPREF]:0,[oe.TOK_ROOT]:0,[oe.TOK_PIPE]:1,[oe.TOK_OR]:2,[oe.TOK_AND]:3,[oe.TOK_EQ]:5,[oe.TOK_GT]:5,[oe.TOK_LT]:5,[oe.TOK_GTE]:5,[oe.TOK_LTE]:5,[oe.TOK_NE]:5,[oe.TOK_FLATTEN]:9,[oe.TOK_STAR]:20,[oe.TOK_FILTER]:21,[oe.TOK_DOT]:40,[oe.TOK_NOT]:45,[oe.TOK_LBRACE]:50,[oe.TOK_LBRACKET]:55,[oe.TOK_LPAREN]:60};class n5{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const r=this.expression(0);if(this.lookahead(0)!==oe.TOK_EOF){const n=this.lookaheadToken(0);this.errorToken(n,`Unexpected token type: ${n.type}, value: ${n.value}`)}return r}loadTokens(e){this.tokens=[...r5.tokenize(e),{type:oe.TOK_EOF,value:"",start:e.length}]}expression(e){const r=this.lookaheadToken(0);this.advance();let n=this.nud(r),i=this.lookahead(0);for(;e<Tr[i];)this.advance(),n=this.led(i,n),i=this.lookahead(0);return n}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let r,n,i;switch(e.type){case oe.TOK_LITERAL:return{type:"Literal",value:e.value};case oe.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case oe.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===oe.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case oe.TOK_NOT:return n=this.expression(Tr.Not),{type:"NotExpression",children:[n]};case oe.TOK_STAR:return r={type:"Identity"},n=this.lookahead(0)===oe.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Tr.Star),{type:"ValueProjection",children:[r,n]};case oe.TOK_FILTER:return this.led(e.type,{type:"Identity"});case oe.TOK_LBRACE:return this.parseMultiselectHash();case oe.TOK_FLATTEN:return r={type:oe.TOK_FLATTEN,children:[{type:"Identity"}]},n=this.parseProjectionRHS(Tr.Flatten),{type:"Projection",children:[r,n]};case oe.TOK_LBRACKET:return this.lookahead(0)===oe.TOK_NUMBER||this.lookahead(0)===oe.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},n)):this.lookahead(0)===oe.TOK_STAR&&this.lookahead(1)===oe.TOK_RBRACKET?(this.advance(),this.advance(),n=this.parseProjectionRHS(Tr.Star),{children:[{type:"Identity"},n],type:"Projection"}):this.parseMultiselectList();case oe.TOK_CURRENT:return{type:oe.TOK_CURRENT};case oe.TOK_ROOT:return{type:oe.TOK_ROOT};case oe.TOK_EXPREF:return i=this.expression(Tr.Expref),{type:"ExpressionReference",children:[i]};case oe.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==oe.TOK_RPAREN;)this.lookahead(0)===oe.TOK_CURRENT?(i={type:oe.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(oe.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,r){let n;switch(e){case oe.TOK_DOT:const i=Tr.Dot;return this.lookahead(0)!==oe.TOK_STAR?(n=this.parseDotRHS(i),{type:"Subexpression",children:[r,n]}):(this.advance(),n=this.parseProjectionRHS(i),{type:"ValueProjection",children:[r,n]});case oe.TOK_PIPE:return n=this.expression(Tr.Pipe),{type:oe.TOK_PIPE,children:[r,n]};case oe.TOK_OR:return n=this.expression(Tr.Or),{type:"OrExpression",children:[r,n]};case oe.TOK_AND:return n=this.expression(Tr.And),{type:"AndExpression",children:[r,n]};case oe.TOK_LPAREN:const s=r.name,o=[];let a;for(;this.lookahead(0)!==oe.TOK_RPAREN;)this.lookahead(0)===oe.TOK_CURRENT?(a={type:oe.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===oe.TOK_COMMA&&this.match(oe.TOK_COMMA),o.push(a);return this.match(oe.TOK_RPAREN),{name:s,type:"Function",children:o};case oe.TOK_FILTER:const l=this.expression(0);return this.match(oe.TOK_RBRACKET),n=this.lookahead(0)===oe.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Tr.Filter),{type:"FilterProjection",children:[r,n,l]};case oe.TOK_FLATTEN:const u={type:oe.TOK_FLATTEN,children:[r]},d=this.parseProjectionRHS(Tr.Flatten);return{type:"Projection",children:[u,d]};case oe.TOK_EQ:case oe.TOK_NE:case oe.TOK_GT:case oe.TOK_GTE:case oe.TOK_LT:case oe.TOK_LTE:return this.parseComparator(r,e);case oe.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===oe.TOK_NUMBER||f.type===oe.TOK_COLON?(n=this.parseIndexExpression(),this.projectIfSlice(r,n)):(this.match(oe.TOK_STAR),this.match(oe.TOK_RBRACKET),n=this.parseProjectionRHS(Tr.Star),{type:"Projection",children:[r,n]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const r=this.lookaheadToken(0);this.errorToken(r,`Expected ${e}, got: ${r.type}`)}}errorToken(e,r=""){const n=new Error(r||`Invalid token (${e.type}): "${e.value}"`);throw n.name="ParserError",n}parseIndexExpression(){if(this.lookahead(0)===oe.TOK_COLON||this.lookahead(1)===oe.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(oe.TOK_RBRACKET),e}projectIfSlice(e,r){const n={type:"IndexExpression",children:[e,r]};return r.type==="Slice"?{children:[n,this.parseProjectionRHS(Tr.Star)],type:"Projection"}:n}parseSliceExpression(){const e=[null,null,null];let r=0,n=this.lookahead(0);for(;n!==oe.TOK_RBRACKET&&r<3;){if(n===oe.TOK_COLON)r+=1,this.advance();else if(n===oe.TOK_NUMBER)e[r]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}n=this.lookahead(0)}return this.match(oe.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,r){const n=this.expression(Tr[r]);return{type:"Comparator",name:r,children:[e,n]}}parseDotRHS(e){const r=this.lookahead(0);if([oe.TOK_UNQUOTEDIDENTIFIER,oe.TOK_QUOTEDIDENTIFIER,oe.TOK_STAR].includes(r))return this.expression(e);if(r===oe.TOK_LBRACKET)return this.match(oe.TOK_LBRACKET),this.parseMultiselectList();if(r===oe.TOK_LBRACE)return this.match(oe.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(Tr[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===oe.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===oe.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===oe.TOK_DOT)return this.match(oe.TOK_DOT),this.parseDotRHS(e);const r=this.lookaheadToken(0);this.errorToken(r,`Syntax error, unexpected token: ${r.value}(${r.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==oe.TOK_RBRACKET;){const r=this.expression(0);if(e.push(r),this.lookahead(0)===oe.TOK_COMMA&&(this.match(oe.TOK_COMMA),this.lookahead(0)===oe.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(oe.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],r=[oe.TOK_UNQUOTEDIDENTIFIER,oe.TOK_QUOTEDIDENTIFIER];let n,i,s;for(;;){if(n=this.lookaheadToken(0),!r.includes(n.type))throw new Error(`Expecting an identifier token, got: ${n.type}`);if(i=n.value,this.advance(),this.match(oe.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===oe.TOK_COMMA)this.match(oe.TOK_COMMA);else if(this.lookahead(0)===oe.TOK_RBRACE){this.match(oe.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const i5=new n5;var ge;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ge||(ge={}));class s5{constructor(e){this.TYPE_NAME_TABLE={[ge.TYPE_NUMBER]:"number",[ge.TYPE_ANY]:"any",[ge.TYPE_STRING]:"string",[ge.TYPE_ARRAY]:"array",[ge.TYPE_OBJECT]:"object",[ge.TYPE_BOOLEAN]:"boolean",[ge.TYPE_EXPREF]:"expression",[ge.TYPE_NULL]:"null",[ge.TYPE_ARRAY_NUMBER]:"Array<number>",[ge.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([r])=>Math.abs(r),this.functionAvg=([r])=>{let n=0;for(let i=0;i<r.length;i+=1)n+=r[i];return n/r.length},this.functionCeil=([r])=>Math.ceil(r),this.functionContains=r=>{const[n,i]=r;return n.includes(i)},this.functionEndsWith=r=>{const[n,i]=r;return n.includes(i,n.length-i.length)},this.functionFloor=([r])=>Math.floor(r),this.functionJoin=r=>{const[n,i]=r;return i.join(n)},this.functionKeys=([r])=>Object.keys(r),this.functionLength=([r])=>Bo(r)?Object.keys(r).length:r.length,this.functionMap=r=>{if(!this._interpreter)return[];const n=[],i=this._interpreter,s=r[0],o=r[1];for(let a=0;a<o.length;a+=1)n.push(i.visit(s,o[a]));return n},this.functionMax=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===ge.TYPE_NUMBER)return Math.max(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[ge.TYPE_NUMBER,ge.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=r=>{let n={};for(let i=0;i<r.length;i+=1){const s=r[i];n=Object.assign(n,s)}return n},this.functionMin=([r])=>{if(!r.length)return null;if(this.getTypeName(r[0])===ge.TYPE_NUMBER)return Math.min(...r);const i=r;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=r=>{const n=r[1],i=r[0],s=this.createKeyFunction(n,[ge.TYPE_NUMBER,ge.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=r=>{for(let n=0;n<r.length;n+=1)if(this.getTypeName(r[n])!==ge.TYPE_NULL)return r[n];return null},this.functionReverse=([r])=>{if(this.getTypeName(r)===ge.TYPE_STRING){const s=r;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=r.slice(0);return i.reverse(),i},this.functionSort=([r])=>[...r].sort(),this.functionSortBy=r=>{if(!this._interpreter)return[];const n=r[0].slice(0);if(n.length===0)return n;const i=this._interpreter,s=r[1],o=this.getTypeName(i.visit(s,n[0]));if(o!==void 0&&![ge.TYPE_NUMBER,ge.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<n.length;c+=1)a.push([c,n[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),d=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(d)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(d)]}`);return u>d?1:u<d?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)n[c]=a[c][1];return n},this.functionStartsWith=([r,n])=>r.startsWith(n),this.functionSum=([r])=>r.reduce((n,i)=>n+i,0),this.functionToArray=([r])=>this.getTypeName(r)===ge.TYPE_ARRAY?r:[r],this.functionToNumber=([r])=>{const n=this.getTypeName(r);let i;return n===ge.TYPE_NUMBER?r:n===ge.TYPE_STRING&&(i=+r,!isNaN(i))?i:null},this.functionToString=([r])=>this.getTypeName(r)===ge.TYPE_STRING?r:JSON.stringify(r),this.functionType=([r])=>{switch(this.getTypeName(r)){case ge.TYPE_NUMBER:return"number";case ge.TYPE_STRING:return"string";case ge.TYPE_ARRAY:return"array";case ge.TYPE_OBJECT:return"object";case ge.TYPE_BOOLEAN:return"boolean";case ge.TYPE_EXPREF:return"expref";case ge.TYPE_NULL:return"null";default:return}},this.functionValues=([r])=>Object.values(r),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ge.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ge.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ge.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY]},{types:[ge.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ge.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ge.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY,ge.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ge.TYPE_EXPREF]},{types:[ge.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ge.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ge.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ge.TYPE_STRING,ge.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ge.TYPE_ARRAY_STRING,ge.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ge.TYPE_ARRAY]},{types:[ge.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ge.TYPE_STRING]},{types:[ge.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ge.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ge.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ge.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ge.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ge.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ge.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,r,n){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:r.bind(this),_signature:n}}callFunction(e,r){const n=this.functionTable[e];if(n===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,r,n._signature),n._func.call(this,r)}validateInputSignatures(e,r){for(let n=0;n<r.length;n+=1)if("variadic"in r[n]&&n!==r.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${n+1} must occur last`)}validateArgs(e,r,n){var i,s;let o;this.validateInputSignatures(e,n);const a=n.filter(p=>{var g;return(g=!p.optional)!==null&&g!==void 0?g:!1}).length,c=(s=(i=n[n.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=r.length<a,u=r.length>n.length,d=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=n.length>1,new Error(`ArgumentError: ${e}() takes ${d}${a} argument${o&&"s"||""} but received ${r.length}`);let f,h,m;for(let p=0;p<n.length;p+=1){m=!1,f=n[p].types,h=this.getTypeName(r[p]);let g;for(g=0;g<f.length;g+=1)if(h!==void 0&&this.typeMatches(h,f[g],r[p])){m=!0;break}if(!m&&h!==void 0){const y=f.map(b=>this.TYPE_NAME_TABLE[b]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${p+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(e,r,n){if(r===ge.TYPE_ANY)return!0;if(r===ge.TYPE_ARRAY_STRING||r===ge.TYPE_ARRAY_NUMBER||r===ge.TYPE_ARRAY){if(r===ge.TYPE_ARRAY)return e===ge.TYPE_ARRAY;if(e===ge.TYPE_ARRAY){let i;r===ge.TYPE_ARRAY_NUMBER?i=ge.TYPE_NUMBER:r===ge.TYPE_ARRAY_STRING&&(i=ge.TYPE_STRING);for(let s=0;s<n.length;s+=1){const o=this.getTypeName(n[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,n[s]))return!1}return!0}}else return e===r;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return ge.TYPE_STRING;case"[object Number]":return ge.TYPE_NUMBER;case"[object Array]":return ge.TYPE_ARRAY;case"[object Boolean]":return ge.TYPE_BOOLEAN;case"[object Null]":return ge.TYPE_NULL;case"[object Object]":return e.jmespathType===oe.TOK_EXPREF?ge.TYPE_EXPREF:ge.TYPE_OBJECT;default:return}}createKeyFunction(e,r){if(!this._interpreter)return;const n=this._interpreter;return s=>{const o=n.visit(e,s);if(!r.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${r.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class o5{constructor(){this._rootValue=null,this.runtime=new s5(this)}search(e,r){return this._rootValue=r,this.visit(e,r)}visit(e,r){let n,i,s,o,a,c,l,u,d,f,h;switch(e.type){case"Field":return r===null?null:Bo(r)?(c=r[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],r),f=1;f<e.children.length;f+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],r),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(r))return null;let m=e.value;return m<0&&(m=r.length+m),s=r[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(r))return null;const p=[...e.children],g=this.computeSliceParams(r.length,p),[y,b,A]=g;if(s=[],A>0)for(f=y;f<b;f+=A)s.push(r[f]);else for(f=y;f>b;f+=A)s.push(r[f]);return s;case"Projection":if(h=this.visit(e.children[0],r),!Array.isArray(h))return null;for(d=[],f=0;f<h.length;f+=1)i=this.visit(e.children[1],h[f]),i!==null&&d.push(i);return d;case"ValueProjection":if(h=this.visit(e.children[0],r),!Bo(h))return null;d=[];const R=Object.values(h);for(f=0;f<R.length;f+=1)i=this.visit(e.children[1],R[f]),i!==null&&d.push(i);return d;case"FilterProjection":if(h=this.visit(e.children[0],r),!Array.isArray(h))return null;const E=[],M=[];for(f=0;f<h.length;f+=1)n=this.visit(e.children[2],h[f]),Au(n)||E.push(h[f]);for(let O=0;O<E.length;O+=1)i=this.visit(e.children[1],E[O]),i!==null&&M.push(i);return M;case"Comparator":switch(o=this.visit(e.children[0],r),a=this.visit(e.children[1],r),e.name){case oe.TOK_EQ:s=Eu(o,a);break;case oe.TOK_NE:s=!Eu(o,a);break;case oe.TOK_GT:s=o>a;break;case oe.TOK_GTE:s=o>=a;break;case oe.TOK_LT:s=o<a;break;case oe.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case oe.TOK_FLATTEN:const S=this.visit(e.children[0],r);if(!Array.isArray(S))return null;let P=[];for(f=0;f<S.length;f+=1)i=S[f],Array.isArray(i)?P=[...P,...i]:P.push(i);return P;case"Identity":return r;case"MultiSelectList":if(r===null)return null;for(d=[],f=0;f<e.children.length;f+=1)d.push(this.visit(e.children[f],r));return d;case"MultiSelectHash":if(r===null)return null;d={};let W;for(f=0;f<e.children.length;f+=1)W=e.children[f],d[W.name]=this.visit(W.value,r);return d;case"OrExpression":return n=this.visit(e.children[0],r),Au(n)&&(n=this.visit(e.children[1],r)),n;case"AndExpression":return o=this.visit(e.children[0],r),Au(o)?o:this.visit(e.children[1],r);case"NotExpression":return o=this.visit(e.children[0],r),Au(o);case"Literal":return e.value;case oe.TOK_PIPE:return l=this.visit(e.children[0],r),this.visit(e.children[1],l);case oe.TOK_CURRENT:return r;case oe.TOK_ROOT:return this._rootValue;case"Function":const D=[];for(let O=0;O<e.children.length;O+=1)D.push(this.visit(e.children[O],r));return this.runtime.callFunction(e.name,D);case"ExpressionReference":const G=e.children[0];return G.jmespathType=oe.TOK_EXPREF,G;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,r){let[n,i,s]=r;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return n=n===null?o?e-1:0:this.capSliceRange(e,n,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[n,i,s]}capSliceRange(e,r,n){let i=r;return i<0?(i+=e,i<0&&(i=n<0?-1:0)):i>=e&&(i=n<0?e-1:e),i}}const a5=new o5;ge.TYPE_ANY,ge.TYPE_ARRAY,ge.TYPE_ARRAY_NUMBER,ge.TYPE_ARRAY_STRING,ge.TYPE_BOOLEAN,ge.TYPE_EXPREF,ge.TYPE_NULL,ge.TYPE_NUMBER,ge.TYPE_OBJECT,ge.TYPE_STRING;function c5(t,e){const r=i5.parse(e);return a5.search(r,t)}const l5=(t,e)=>{const r=Fo(t.id());if(!w(r))return 0;const[n,i]=ue(e,0,[Z.NAME,Z.NAME]),s=c5(r.json,n);return t.set(i,s),0},u5=(t,e)=>{const r=Fo(t.id());if(!w(r))return 0;const[n,i]=ue(e,0,[Z.NAME]);switch(Fe(n)){case"seek":{const[o]=ue(e,i,[Z.NUMBER]);r.cursor=jt(o,0,r.lines.length-1);break}case"line":r.cursor=jt(r.cursor+1,0,r.lines.length-1);break;default:{const o=r.lines[r.cursor]??"",c=new RegExp(n,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[d,f]=ue(e,u,[Z.NAME]);t.set(d,c[l]??0),++l,u=f}break}}return 0};function Bx(t){const e=dt(Xe.MAIN),r=Mo(e);w(t.targetdir)?Ho(t.targetdir.destpt,t.label,void 0,r):w(t.targetname)&&Ho(t.targetname,t.label,void 0,r)}const h5=ki({get(t,e){const r=Mx(t.id());if(e==="format")return[!0,r];switch(r){case"text":{const s=Fo(t.id());switch(e){case"filename":return[!0,s.filename];case"cursor":return[!0,s.cursor];case"lines":return[!0,s.lines.length]}break}case"json":{const s=Fo(t.id());switch(e){case"filename":return[!0,s.filename]}break}case"binary":{const s=Fo(t.id());switch(e){case"filename":return[!0,s.filename];case"cursor":return[!0,s.cursor];case"bytes":return[!0,s.bytes.length]}break}}const n=vr(),i=Xr(n)[e];return[w(i),i]},set(t,e,r){const n=Mx(t.id());if(e==="format")return[!1,void 0];switch(n){case"text":switch(e){case"filename":case"cursor":case"lines":return[!1,void 0]}break;case"json":switch(e){case"filename":return[!1,void 0]}break;case"binary":switch(e){case"filename":case"cursor":case"bytes":return[!1,void 0]}break}const i=vr(),s=Xr(i);return w(s)?(s[e]=r,[!0,r]):[!1,void 0]}}).command("shortsend",(t,e)=>{const r=Li(e);return Bx(r),0}).command("send",(t,e)=>{const r=Li(e,!0);return Bx(r),0}).command("stat",()=>0).command("text",(t,e)=>{const r=e.map(Pt).join(" ");return Bt(le,x.elementfocus,"$175",r),0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Pt(r),s=Li(n);return w(s.targetname)&&Bt(le,x.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",u5).command("readjson",l5).command("readbin",Xj).command("withboard",(t,e)=>{const[r]=ue(e,0,[Z.STRING]),n=dr(r);return w(n)&&(x.board=n,x.element={x:-1,y:-1}),0});function Dx(t,e,r,n,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=ue(i,a,[Z.ANY]);ut(c)&&!sn(c)&&!rc(c)&&!vu(c)&&!Rr(c)?o.push(...c):o.push(c),a=l}switch(Fe(n)){case"get":case"post:json":HS(le,x.elementfocus,t,e,r,n,o);break}return 0}const f5=ki().command("fetch",(t,e)=>{const[r,n,i="get",s]=ue(e,0,[Z.NAME,Z.NAME,Z.MAYBE_STRING]);return Dx(void 0,r,n,i,e,s),0}).command("fetchwith",(t,e)=>{const[r,n,i,s="get",o]=ue(e,0,[Z.ANY,Z.NAME,Z.NAME,Z.MAYBE_STRING]);return Dx(r,n,i,s,e,o),0}).command("chat",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return r?zS(le,x.elementfocus,r):WS(le,x.elementfocus),0}).command("broadcast",(t,e)=>{const[r]=ue(e,0,[Z.MAYBE_NAME]);return r?DS(le,x.elementfocus,r):jS(le,x.elementfocus),0});function nc(t,e,r){if(w(x.board)){switch(r){case"shot":case"bombed":He(e,"breakable")&&mr(x.board,e,x.timestamp);break}w(e?.id)&&t.send(x.elementfocus,e.id,r)}}function jx(t,e){if(w(e.targetname)){const r=Object.keys(x.board?.objects??{});switch(e.targetname){case"all":for(let n=0;n<r.length;++n){const i=r[n],s=pr(x.board,i);w(s)&&nc(t,s,e.label)}break;case"others":for(let n=0;n<r.length;++n){const i=r[n],s=pr(x.board,i);i!==t.id()&&w(s)&&nc(t,s,e.label)}break;case"self":x.elementid!==t.id()?t.send(x.elementfocus,x.elementid,e.label):t.message({session:le.session(),player:x.elementfocus,id:Ft(),sender:x.elementid,target:e.label});break;default:{const n=DA(x.board,[e.targetname]);for(let i=0;i<n.length;++i){const s=n[i];w(s)&&nc(t,s,e.label)}break}}}else if(w(e.targetdir))if(e.targetdir.targets.length)for(let r=0;r<e.targetdir.targets.length;++r){const n=nt(x.board,e.targetdir.targets[r]);w(n)&&nc(t,n,e.label)}else{const r=nt(x.board,e.targetdir.destpt);w(r)&&nc(t,r,e.label)}}const d5=ki({set(t,e,r){return x7(t,e,r),[!1,void 0]},aftertick(){const t=ir(x.elementid),[e]=t;if(t.length===1&&ye(e)){if(w(x.element))if(e.trim().length===0){const r=Rt(x.elementid);r.sidebar=[]}else x.element.tickertext=e,x.element.tickertime=x.timestamp}else if(t.length>1)if(x.elementisplayer){const r=Rt(x.elementid);r.sidebar=XA(t)}else{const r=Rt(x.elementfocus);r.scrollname=x.element?.name??x.element?.kinddata?.name??"",r.scroll=XA(t)}}}).command("shortsend",(t,e)=>{const r=Li(e);return jx(t,r),0}).command("send",(t,e)=>{const r=Li(e,!0);return jx(t,r),0}).command("stat",()=>0).command("text",(t,e)=>{const r=e.map(Pt).join("");return Ie(x.elementid,r),0}).command("hyperlink",(t,e)=>{const[r,...n]=e,i=Pt(r),s=Li(n);return w(s.targetname)&&Be(x.elementid,t.id(),i,`${s.targetname}:${s.label}`.split(" "),t.get,t.set),0});function p5(t,e,r,n,i){if(!w(x.book))return;const s=x.book,o=Cr(s,Re.BOARD,t),a=St(o);if(!w(a))return;const c=zu(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";ur(a),ur(c);const d=-Math.tan(e*.5),f=Math.sin(e),h=Math.round(12.5*d),m=Math.round(12.5*f),p=new Array(rt).fill(0);Vy(h,0,-h,rt-1).forEach(R=>{R.x<0?p[R.y]=Math.min(p[R.y],R.x):p[R.y]=Math.max(p[R.y],R.x)});const y=new Array(Ue).fill(0);Vy(0,m,Ue-1,-m).forEach(R=>{R.y<0?y[R.x]=Math.min(y[R.x],R.y):y[R.x]=Math.max(y[R.x],R.y)});const A=[p,y,p];for(let R=0;R<A.length;++R){const E=A[R];if(R!==1){for(let M=0;M<rt;++M){const S=E[M],P=M*Ue;for(let W=0;W<Ue;W++){const D=(W+S+Ue)%Ue;u&&(c.terrain[D+P]=a.terrain[W+P])}}if(l){const M=Object.keys(a.objects);for(let S=0;S<M.length;++S){const P=M[S],{x:W,y:D}=a.objects[P];if(w(W)&&w(D)){const G=E[D];a.objects[P].x=(W+G+Ue)%Ue,a.objects[P].lx=a.objects[P].x}}}}if(R===1){for(let M=0;M<Ue;++M){const S=E[M];for(let P=0;P<rt;++P){const W=(P+S+rt)%rt;u&&(c.terrain[M+W*Ue]=a.terrain[M+P*Ue])}}if(l){const M=Object.keys(a.objects);for(let S=0;S<M.length;++S){const P=M[S],{x:W,y:D}=a.objects[P];if(w(W)&&w(D)){const G=E[W];a.objects[P].y=(D+G+rt)%rt,a.objects[P].ly=a.objects[P].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,ur(c),ur(a)}}var Ip,zx;function m5(){if(zx)return Ip;zx=1;function t(e,r){let n=0,i=0,s=0;for(;s<e.length;s++)n+=e[s];for(s=0,r*=n;r&&s<e.length;){if(i+=e[s],r<=i)return s;s++}return 0}return Ip=t,Ip}var Np,Wx;function Hx(){if(Wx)return Np;Wx=1;const t=m5(),e=function(){};return e.prototype.FMX=0,e.prototype.FMY=0,e.prototype.FMXxFMY=0,e.prototype.T=0,e.prototype.N=0,e.prototype.initiliazedField=!1,e.prototype.generationComplete=!1,e.prototype.wave=null,e.prototype.compatible=null,e.prototype.weightLogWeights=null,e.prototype.sumOfWeights=0,e.prototype.sumOfWeightLogWeights=0,e.prototype.startingEntropy=0,e.prototype.sumsOfOnes=null,e.prototype.sumsOfWeights=null,e.prototype.sumsOfWeightLogWeights=null,e.prototype.entropies=null,e.prototype.propagator=null,e.prototype.observed=null,e.prototype.distribution=null,e.prototype.stack=null,e.prototype.stackSize=0,e.prototype.DX=[-1,0,1,0],e.prototype.DY=[0,1,0,-1],e.prototype.opposite=[2,3,0,1],e.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let r=0;r<this.FMXxFMY;r++){this.wave[r]=new Array(this.T),this.compatible[r]=new Array(this.T);for(let n=0;n<this.T;n++)this.compatible[r][n]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let r=0;r<this.T;r++)this.weightLogWeights[r]=this.weights[r]*Math.log(this.weights[r]),this.sumOfWeights+=this.weights[r],this.sumOfWeightLogWeights+=this.weightLogWeights[r];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},e.prototype.observe=function(r){let n=1e3,i=-1;for(let a=0;a<this.FMXxFMY;a++){if(this.onBoundary(a%this.FMX,a/this.FMX|0))continue;const c=this.sumsOfOnes[a];if(c===0)return!1;const l=this.entropies[a];if(c>1&&l<=n){const u=1e-6*r();l+u<n&&(n=l+u,i=a)}}if(i===-1){this.observed=new Array(this.FMXxFMY);for(let a=0;a<this.FMXxFMY;a++)for(let c=0;c<this.T;c++)if(this.wave[a][c]){this.observed[a]=c;break}return!0}for(let a=0;a<this.T;a++)this.distribution[a]=this.wave[i][a]?this.weights[a]:0;const s=t(this.distribution,r()),o=this.wave[i];for(let a=0;a<this.T;a++)o[a]!==(a===s)&&this.ban(i,a);return null},e.prototype.propagate=function(){for(;this.stackSize>0;){const r=this.stack[this.stackSize-1];this.stackSize--;const n=r[0],i=n%this.FMX,s=n/this.FMX|0;for(let o=0;o<4;o++){const a=this.DX[o],c=this.DY[o];let l=i+a,u=s+c;if(this.onBoundary(l,u))continue;l<0?l+=this.FMX:l>=this.FMX&&(l-=this.FMX),u<0?u+=this.FMY:u>=this.FMY&&(u-=this.FMY);const d=l+u*this.FMX,f=this.propagator[o][r[1]],h=this.compatible[d];for(let m=0;m<f.length;m++){const p=f[m],g=h[p];g[o]--,g[o]==0&&this.ban(d,p)}}}},e.prototype.singleIteration=function(r){const n=this.observe(r);return n!==null?(this.generationComplete=n,!!n):(this.propagate(),null)},e.prototype.iterate=function(r,n){this.wave||this.initialize(),this.initiliazedField||this.clear(),r=r||0,n=n||Math.random;for(let i=0;i<r||r===0;i++){const s=this.singleIteration(n);if(s!==null)return!!s}return!0},e.prototype.generate=function(r){for(r=r||Math.random,this.wave||this.initialize(),this.clear();;){const n=this.singleIteration(r);if(n!==null)return!!n}},e.prototype.isGenerationComplete=function(){return this.generationComplete},e.prototype.ban=function(r,n){const i=this.compatible[r][n];for(let o=0;o<4;o++)i[o]=0;this.wave[r][n]=!1,this.stack[this.stackSize]=[r,n],this.stackSize++,this.sumsOfOnes[r]-=1,this.sumsOfWeights[r]-=this.weights[n],this.sumsOfWeightLogWeights[r]-=this.weightLogWeights[n];const s=this.sumsOfWeights[r];this.entropies[r]=Math.log(s)-this.sumsOfWeightLogWeights[r]/s},e.prototype.clear=function(){for(let r=0;r<this.FMXxFMY;r++){for(let n=0;n<this.T;n++){this.wave[r][n]=!0;for(let i=0;i<4;i++)this.compatible[r][n][i]=this.propagator[this.opposite[i]][n].length}this.sumsOfOnes[r]=this.weights.length,this.sumsOfWeights[r]=this.sumOfWeights,this.sumsOfWeightLogWeights[r]=this.sumOfWeightLogWeights,this.entropies[r]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1},Np=e,Np}var Cp,Gx;function g5(){if(Gx)return Cp;Gx=1;const t=Hx(),e=function(n,i,s,o,a,c,l,u,d,f){f=f||0,this.N=o,this.FMX=a,this.FMY=c,this.FMXxFMY=a*c,this.periodic=u;const h=i,m=new Array(h);for(let G=0;G<h;G++)m[G]=new Array(s);this.colors=[];const p={};for(let G=0;G<s;G++)for(let O=0;O<i;O++){const I=(G*i+O)*4,k=[n[I],n[I+1],n[I+2],n[I+3]],C=k.join("-");p.hasOwnProperty(C)||(p[C]=this.colors.length,this.colors.push(k)),m[O][G]=p[C]}const g=this.colors.length,y=Math.pow(g,o*o),b=function(O){let I=new Array(o*o);for(let k=0;k<o;k++)for(let C=0;C<o;C++)I[C+k*o]=O(C,k);return I},A=function(O,I){return b(function(k,C){return m[(O+k)%i][(I+C)%s]})},R=function(O){return b(function(I,k){return O[o-1-k+I*o]})},E=function(O){return b(function(I,k){return O[o-1-I+k*o]})},M=function(O){let I=0,k=1;for(let C=0;C<O.length;C++)I+=O[O.length-1-C]*k,k*=g;return I},S=function(O){let I=O,k=y;const C=new Array(o*o);for(let z=0;z<C.length;z++){k/=g;let F=0;for(;I>=k;)I-=k,F++;C[z]=F}return C},P={},W=[];for(let G=0;G<(l?s:s-o+1);G++)for(let O=0;O<(l?i:i-o+1);O++){const I=new Array(8);I[0]=A(O,G),I[1]=E(I[0]),I[2]=R(I[0]),I[3]=E(I[2]),I[4]=R(I[2]),I[5]=E(I[4]),I[6]=R(I[4]),I[7]=E(I[6]);for(let k=0;k<d;k++){const C=M(I[k]);P[C]?P[C]++:(W.push(C),P[C]=1)}}this.T=W.length,this.ground=(f+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let G=0;G<this.T;G++){const O=parseInt(W[G],10);this.patterns[G]=S(O),this.weights[G]=P[O]}const D=function(O,I,k,C){const z=k<0?0:k,F=k<0?k+o:o,Q=C<0?0:C,Y=C<0?C+o:o;for(let N=Q;N<Y;N++)for(let U=z;U<F;U++)if(O[U+o*N]!=I[U-k+o*(N-C)])return!1;return!0};this.propagator=new Array(4);for(let G=0;G<4;G++){this.propagator[G]=new Array(this.T);for(let O=0;O<this.T;O++){const I=[];for(let k=0;k<this.T;k++)D(this.patterns[O],this.patterns[k],this.DX[G],this.DY[G])&&I.push(k);this.propagator[G][O]=I}}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(r,n){return!this.periodic&&(r+this.N>this.FMX||n+this.N>this.FMY||r<0||n<0)},e.prototype.clear=function(){if(t.prototype.clear.call(this),this.ground!==0){for(let r=0;r<this.FMX;r++){for(let n=0;n<this.T;n++)n!==this.ground&&this.ban(r+(this.FMY-1)*this.FMX,n);for(let n=0;n<this.FMY-1;n++)this.ban(r+n*this.FMX,this.ground)}this.propagate()}},e.prototype.graphics=function(r){return r=r||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(r):this.graphicsIncomplete(r),r},e.prototype.graphicsComplete=function(r){for(let n=0;n<this.FMY;n++){const i=n<this.FMY-this.N+1?0:this.N-1;for(let s=0;s<this.FMX;s++){const o=s<this.FMX-this.N+1?0:this.N-1,a=(n*this.FMX+s)*4,c=this.colors[this.patterns[this.observed[s-o+(n-i)*this.FMX]][o+i*this.N]];r[a]=c[0],r[a+1]=c[1],r[a+2]=c[2],r[a+3]=c[3]}}},e.prototype.graphicsIncomplete=function(r){for(let n=0;n<this.FMXxFMY;n++){const i=n%this.FMX,s=n/this.FMX|0;let o=0,a=0,c=0,l=0,u=0;for(let f=0;f<this.N;f++)for(let h=0;h<this.N;h++){let m=i-h;m<0&&(m+=this.FMX);let p=s-f;if(p<0&&(p+=this.FMY),this.onBoundary(m,p))continue;const g=m+p*this.FMX;for(let y=0;y<this.T;y++)if(this.wave[g][y]){o++;const b=this.colors[this.patterns[y][h+f*this.N]];a+=b[0],c+=b[1],l+=b[2],u+=b[3]}}const d=n*4;r[d]=a/o,r[d+1]=c/o,r[d+2]=l/o,r[d+3]=u/o}},Cp=e,Cp}var Lp,Kx;function y5(){if(Kx)return Lp;Kx=1;const t=Hx(),e=function(n,i,s,o,a){const c=n.tilesize||16;this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=a,this.tilesize=c;const l=!!n.unique;let u=null;i&&n.subsets&&n.subsets[i]&&(u=n.subsets[i]);const d=function(M){const S=new Array(c*c);for(let P=0;P<c;P++)for(let W=0;W<c;W++)S[W+P*c]=M(W,P);return S},f=function(M){return d(function(S,P){return M[c-1-P+S*c]})},h=function(M){return d(function(S,P){return M[c-1-S+P*c]})};this.tiles=[];const m=[],p=[],g={};let y,b,A;for(let E=0;E<n.tiles.length;E++){const M=n.tiles[E];if(u!==null&&u.indexOf(M.name)===-1)continue;switch(M.symmetry){case"L":A=4,y=function(P){return(P+1)%4},b=function(P){return P%2===0?P+1:P-1};break;case"T":A=4,y=function(P){return(P+1)%4},b=function(P){return P%2===0?P:4-P};break;case"I":A=2,y=function(P){return 1-P},b=function(P){return P};break;case"\\":A=2,y=function(P){return 1-P},b=function(P){return 1-P};break;case"F":A=8,y=function(P){return P<4?(P+1)%4:4+(P-1)%4},b=function(P){return P<4?P+4:P-4};break;default:A=1,y=function(P){return P},b=function(P){return P};break}this.T=p.length,g[M.name]=this.T;for(let P=0;P<A;P++)p.push([this.T+P,this.T+y(P),this.T+y(y(P)),this.T+y(y(y(P))),this.T+b(P),this.T+b(y(P)),this.T+b(y(y(P))),this.T+b(y(y(y(P))))]);let S;if(l)for(let P=0;P<A;P++)S=M.bitmap[P],this.tiles.push(d(function(W,D){return[S[(c*D+W)*4],S[(c*D+W)*4+1],S[(c*D+W)*4+2],S[(c*D+W)*4+3]]}));else{S=M.bitmap,this.tiles.push(d(function(P,W){return[S[(c*W+P)*4],S[(c*W+P)*4+1],S[(c*W+P)*4+2],S[(c*W+P)*4+3]]}));for(let P=1;P<A;P++)this.tiles.push(P<4?f(this.tiles[this.T+P-1]):h(this.tiles[this.T+P-4]))}for(let P=0;P<A;P++)m.push(M.weight||1)}this.T=p.length,this.weights=m,this.propagator=new Array(4);const R=new Array(4);for(let E=0;E<4;E++){this.propagator[E]=new Array(this.T),R[E]=new Array(this.T);for(let M=0;M<this.T;M++){R[E][M]=new Array(this.T);for(let S=0;S<this.T;S++)R[E][M][S]=!1}}for(let E=0;E<n.neighbors.length;E++){const M=n.neighbors[E],S=M.left.split(" ").filter(function(I){return I.length}),P=M.right.split(" ").filter(function(I){return I.length});if(u!==null&&(u.indexOf(S[0])===-1||u.indexOf(P[0])===-1))continue;const W=p[g[S[0]]][S.length==1?0:parseInt(S[1],10)],D=p[W][1],G=p[g[P[0]]][P.length==1?0:parseInt(P[1],10)],O=p[G][1];R[0][G][W]=!0,R[0][p[G][6]][p[W][6]]=!0,R[0][p[W][4]][p[G][4]]=!0,R[0][p[W][2]][p[G][2]]=!0,R[1][O][D]=!0,R[1][p[D][6]][p[O][6]]=!0,R[1][p[O][4]][p[D][4]]=!0,R[1][p[D][2]][p[O][2]]=!0}for(let E=0;E<this.T;E++)for(let M=0;M<this.T;M++)R[2][E][M]=R[0][M][E],R[3][E][M]=R[1][M][E];for(let E=0;E<4;E++)for(let M=0;M<this.T;M++){const S=[],P=R[E][M];for(let W=0;W<this.T;W++)P[W]&&S.push(W);this.propagator[E][M]=S}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(r,n){return!this.periodic&&(r<0||n<0||r>=this.FMX||n>=this.FMY)},e.prototype.graphics=function(r,n){return r=r||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(r):this.graphicsIncomplete(r,n),r},e.prototype.graphicsComplete=function(r){for(let n=0;n<this.FMX;n++)for(let i=0;i<this.FMY;i++){const s=this.tiles[this.observed[n+i*this.FMX]];for(let o=0;o<this.tilesize;o++)for(let a=0;a<this.tilesize;a++){const c=(n*this.tilesize+a+(i*this.tilesize+o)*this.FMX*this.tilesize)*4,l=s[a+o*this.tilesize];r[c]=l[0],r[c+1]=l[1],r[c+2]=l[2],r[c+3]=l[3]}}},e.prototype.graphicsIncomplete=function(r,n){(!n||n.length!==4)&&(n=!1);for(let i=0;i<this.FMX;i++)for(let s=0;s<this.FMY;s++){const o=this.wave[i+s*this.FMX];let a=0,c=0;for(let u=0;u<this.T;u++)o[u]&&(a++,c+=this.weights[u]);const l=1/c;for(let u=0;u<this.tilesize;u++)for(let d=0;d<this.tilesize;d++){const f=(i*this.tilesize+d+(s*this.tilesize+u)*this.FMX*this.tilesize)*4;if(n&&a===this.T)r[f]=n[0],r[f+1]=n[1],r[f+2]=n[2],r[f+3]=n[3];else{let h=0,m=0,p=0,g=0;for(let y=0;y<this.T;y++)if(o[y]){const b=this.tiles[y][d+u*this.tilesize],A=this.weights[y]*l;h+=b[0]*A,m+=b[1]*A,p+=b[2]*A,g+=b[3]*A}r[f]=h,r[f+1]=m,r[f+2]=p,r[f+3]=g}}}},Lp=e,Lp}var Mp,qx;function _5(){return qx||(qx=1,Mp={OverlappingModel:g5(),SimpleTiledModel:y5()}),Mp}var b5=_5(),w5=Xs(b5);const Yx=5;function Vx(t,e,r,n,i,s,o){if(!w(x.book))return!1;const a=x.book,c=Cr(a,Re.BOARD,t),l=Cr(a,Re.BOARD,e),u=St(c),d=St(l);if(!w(u)||!w(d))return!1;ur(u),ur(d);let f=0;const h=new Map,m=new Map;let p=0;const g=32,y=new Uint8Array($f*4);for(let S=0;S<rt;++S)for(let P=0;P<Ue;++P){const W=nt(d,{x:P,y:S}),D=W?.char??0,G=W?.color??g,O=W?.bg??g;y[p++]=D,y[p++]=G,y[p++]=O;const I=En(W),k=Fe(I?.name??"empty"),C=h.get(k);Te(C)?y[p++]=C:(h.set(k,f),m.set(f,k),y[p++]=f++)}const b=s.x-i.x+1,A=s.y-i.y+1,R=new w5.OverlappingModel(y,Ue,rt,r,b,A,!1,!1,n,0);let E=0;for(;E<Yx&&!R.generate();++E);if(E===Yx)return!1;p=0;const M=R.graphics();for(let S=i.y;S<=s.y;++S)for(let P=i.x;P<=s.x;++P){const W={x:P,y:S},D=M[p++],G=M[p++],O=M[p++];switch(f=M[p++],o){case"all":{const z=nt(u,{x:P,y:S});Wt(z)&&mr(u,z,a.timestamp),It(u,{x:P,y:S});break}case"object":{const z=nt(u,{x:P,y:S});Wt(z)&&mr(u,z,a.timestamp);break}case"terrain":It(u,{x:P,y:S});break}let I=m.get(f)??"";const k=En({kind:I});switch(o){case"all":break;case"object":Wt(k)||(I="");break;case"terrain":Wt(k)&&(I="");break;default:if(He(k,"group")!==o&&(I=""),I){const z=nt(u,{x:P,y:S});Wt(z)&&mr(u,z,a.timestamp),It(u,{x:P,y:S})}break}const C=I?hn(u,[I],W):void 0;if(!(!w(C)||!w(k))&&(Us(C,k),D>0&&(C.char=D),G<g&&(C.color=G),O<g&&(C.bg=O),Wt(C))){const z=gn(Go(d,I));w(z)&&(It(u,{...rs(d,z.x??0,z.y??0),x:P,y:S}),Us(C,z))}}return!0}function Xx(t){return`zss_snapshot_${t}`}const Zx={x:0,y:0},Jx={x:Ue-1,y:rt-1},Qx="all";function k5(t){const e=Cr(x.book,Re.BOARD,t),r=St(e);if(!w(r))return;const n=Xx(r.id);ex(x.book,n);const[i]=ts(Xe.MAIN,n,Re.BOARD),s=St(i);if(w(s))return mu(t,s.id,Zx,Jx,Qx),s}function v5(t){const e=Cr(x.book,Re.BOARD,t),r=St(e);if(!w(r))return;const n=Xx(r.id),i=Cr(x.book,Re.BOARD,n),s=St(i);if(w(s))return mu(s.id,t,Zx,Jx,Qx),s}function x5(t,e,r,n,i,s){switch(s){case"all":case"object":case"terrain":break;default:return E5(t,e,i,s)}if(!w(x.book))return;const o=x.book,a=Cr(o,Re.BOARD,t),c=St(a);if(!w(c))return;const l=zu();ur(c);for(let u=r.y;u<=n.y;++u)for(let d=r.x;d<=n.x;++d){let f=!1,h=!1;switch(s){case"all":f=!0,h=!0;break;case"object":f=!0;break;case"terrain":h=!0;break}const m=(d+e.x+Ue)%Ue,p=(u+e.y+rt)%rt;if(f){const g=nt(c,{x:d,y:u});Wt(g)&&w(g?.x)&&w(g?.y)&&(g.x=m,g.lx=m,g.y=p,g.ly=p)}h&&(l.terrain[m+p*Ue]=c.terrain[d+u*Ue])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),Qa(c)}function E5(t,e,r,n){if(!w(x.book))return;const i=x.book,s=Cr(i,Re.BOARD,t),o=St(s);if(!w(o))return;ur(o);const{terrainelements:a,objectelements:c}=sx(o,r,n);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>rn({x:p.x??0,y:p.y??0},Ue)),d=[],f=[];for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b=nt(o,y);w(b)&&Wt(b)&&(d.push(b.id??""),d.push(b.id??""),f.push(rn({x:b.x??0,y:b.y??0},Ue)))}let h=!1;for(let p=0;p<a.length;++p){const g=a[p],y=He(g,"collision"),b={x:g.x??-1,y:g.y??-1},A=rn(b,Ue),R={x:b.x+e.x,y:b.y+e.y};if(Ko(R)){const E=nt(o,R),M=E?.id??"",S=rn({x:E?.x??0,y:E?.y??0},Ue),P=He(E,"collision");if(w(E)&&Wt(E)&&d.includes(M)!==!0&&l.includes(M)!==!0){let W=!1;const D=f.includes(A),G=D?nt(o,b):void 0,O=D?He(G,"pushable"):!1,I=D&&O;if(K0(g,E)&&(y!==We.ISWALK||D)){let k=D;w(G)&&O&&(h=zn(i,o,G,{x:(G.x??0)-e.x,y:(G.y??0)-e.y})!==!0,h||(k=!1)),(k||y!==We.ISWALK)&&(h=zn(i,o,E,{x:(E.x??0)+e.x,y:(E.y??0)+e.y})!==!0,h&&(W=I))}else(y!==We.ISWALK||I)&&(h=!0,W=I);W&&w(G)&&(h=zn(i,o,G,{x:(G.x??0)-e.x,y:(G.y??0)-e.y})!==!0)}else P===We.ISSOLID&&u.includes(S)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const g=c[p],y=He(g,"collision"),b={x:g.x??0,y:g.y??0},A={x:b.x+e.x,y:b.y+e.y};if(Ko(A)){const R=nt(o,A),E=R?.id??"",M=He(R,"collision"),S=He(R,"group");w(R)&&Wt(R)&&d.includes(E)&&l.includes(E)!==!0?K0(g,R)?h=zn(i,o,R,A)!==!0:h=!0:lc(y,M)&&n!==S&&(h=!0)}else h=!0}if(h)return;(e.x>0||e.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const g=a[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+e.x,y:y.y+e.y},A=rs(o,b.x,b.y);if(w(g)&&w(A)){It(o,{...g,x:b.x,y:b.y}),It(o,{...A,x:y.x,y:y.y});const R=nt(o,y);Wt(R)&&w(R)&&(R.x=(R.x??0)+e.x,R.y=(R.y??0)+e.y,R.lx=(R.lx??0)+e.x,R.ly=(R.ly??0)+e.y)}}Qa(o);for(let p=0;p<c.length;++p){const g=c[p],y={x:g.x??-1,y:g.y??-1},b={x:y.x+e.x,y:y.y+e.y};if(!zn(i,o,g,b))break}Qa(o)}function Tu(t,e){let r="all";const n={x:0,y:0},i={x:Ue-1,y:rt-1};for(let s=e;s<t.length;){const[o,a]=ue(t,s,[Z.MAYBE_NUMBER_OR_STRING]);if(ye(o))r=Fe(o),s=a;else if(Te(o)){const[c,l,u,d]=ue(t,a,[Z.NUMBER,Z.MAYBE_NUMBER,Z.MAYBE_NUMBER]);n.x=Math.min(o,l??o),n.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=d}else break}return{targetset:r,pt1:n,pt2:i}}function eE(t,e){const r=un();for(let n=0;n<r.length;++n){const i=r[n],s=gn(up(i,t,e));if(w(s))return s}}const A5=ki().command("snapshot",()=>(!w(x.book)||!w(x.board)||k5(x.board.id),0)).command("revert",()=>(!w(x.book)||!w(x.board)||v5(x.board.id),0)).command("copy",(t,e)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ue(e,0,[Z.STRING]),i=eE(Re.BOARD,r);if(w(i)){const s=Tu(e,n);mu(i.id,x.board.id,s.pt1,s.pt2,s.targetset)}return 0}).command("remix",(t,e)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n,i,s]=ue(e,0,[Z.STRING,Z.NUMBER,Z.NUMBER]),o=eE(Re.BOARD,r);if(w(o)){const a=Tu(e,s);Vx(x.board.id,o.id,n,i,a.pt1,a.pt2,a.targetset)}return 0}).command("weave",(t,e)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ue(e,0,[Z.DIR]),i={x:r.destpt.x-(x.element?.x??0),y:r.destpt.y-(x.element?.y??0)},s=Tu(e,n);return x5(x.board.id,i,s.pt1,s.pt2,x.elementid,s.targetset),0}).command("pivot",(t,e)=>{if(!w(x.book)||!w(x.board))return 0;const[r,n]=ue(e,0,[Z.NUMBER]),i=Tu(e,n);return p5(x.board.id,r_(r),i.pt1,i.pt2,i.targetset),0});var Qi=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(Qi||{});const T5={audio:hl,board:IP,cli:Bj,display:Dj,element:Yj,runtime:d5,loader:h5,network:f5,transform:A5},Up=["audio","board","display","network","transform","element"],S5={0:[],1:["cli",...Up],2:["loader",...Up],3:["runtime",...Up]},R5={0:new Map,1:new Map,2:new Map,3:new Map};function Do(t){return(S5[t]??[]).map(r=>T5[r]).filter(w)}function $p(t){const e=[],r=Do(t);for(let n=0;n<r.length;++n)e.push(...r[n].listcommands());return e}function O5(t,e){const r=R5[t];if(!r.has(e)){let n;const i=Do(t);for(let s=0;s<i.length&&(n=i[s].getcommand(e),!w(n));++s);r.set(e,n)}return r.get(e)}function I5(t,e,r){const n=Do(t);for(let i=0;i<n.length;++i){const s=n[i];if(s.get!==void 0){const[o,a]=s.get(e,r);if(o)return[o,a]}}return[!1,void 0]}function N5(t,e,r,n){const i=Do(t);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,r,n);if(a)return[a,n]}}return[!1,void 0]}function C5(t,e){const r=Do(t);for(let n=0;n<r.length;++n)r[n].everytick(e)}function L5(t,e){const r=Do(t);for(let n=0;n<r.length;++n)r[n].aftertick(e)}var ic={},Pp={},Fp={},Bp={},tE;function M5(){if(tE)return Bp;tE=1;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return Bp.encode=function(e){if(0<=e&&e<t.length)return t[e];throw new TypeError("Must be between 0 and 63: "+e)},Bp}var rE;function nE(){if(rE)return Fp;rE=1;const t=M5(),e=5,r=1<<e,n=r-1,i=r;function s(o){return o<0?(-o<<1)+1:(o<<1)+0}return Fp.encode=function(a){let c="",l,u=s(a);do l=u&n,u>>>=e,u>0&&(l|=i),c+=t.encode(l);while(u>0);return c},Fp}var Dn={},zs={},sc={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var U5=sc.exports,iE;function $5(){return iE||(iE=1,(function(t,e){(function(r){var n=e&&!e.nodeType&&e,i=t&&!t.nodeType&&t,s=typeof Fi=="object"&&Fi;(s.global===s||s.window===s||s.self===s)&&(r=s);var o,a=2147483647,c=36,l=1,u=26,d=38,f=700,h=72,m=128,p="-",g=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},R=c-l,E=Math.floor,M=String.fromCharCode,S;function P(N){throw new RangeError(A[N])}function W(N,U){for(var $=N.length,V=[];$--;)V[$]=U(N[$]);return V}function D(N,U){var $=N.split("@"),V="";$.length>1&&(V=$[0]+"@",N=$[1]),N=N.replace(b,".");var q=N.split("."),J=W(q,U).join(".");return V+J}function G(N){for(var U=[],$=0,V=N.length,q,J;$<V;)q=N.charCodeAt($++),q>=55296&&q<=56319&&$<V?(J=N.charCodeAt($++),(J&64512)==56320?U.push(((q&1023)<<10)+(J&1023)+65536):(U.push(q),$--)):U.push(q);return U}function O(N){return W(N,function(U){var $="";return U>65535&&(U-=65536,$+=M(U>>>10&1023|55296),U=56320|U&1023),$+=M(U),$}).join("")}function I(N){return N-48<10?N-22:N-65<26?N-65:N-97<26?N-97:c}function k(N,U){return N+22+75*(N<26)-((U!=0)<<5)}function C(N,U,$){var V=0;for(N=$?E(N/f):N>>1,N+=E(N/U);N>R*u>>1;V+=c)N=E(N/R);return E(V+(R+1)*N/(N+d))}function z(N){var U=[],$=N.length,V,q=0,J=m,fe=h,Ee,ke,xe,Ae,Se,Me,je,T,he;for(Ee=N.lastIndexOf(p),Ee<0&&(Ee=0),ke=0;ke<Ee;++ke)N.charCodeAt(ke)>=128&&P("not-basic"),U.push(N.charCodeAt(ke));for(xe=Ee>0?Ee+1:0;xe<$;){for(Ae=q,Se=1,Me=c;xe>=$&&P("invalid-input"),je=I(N.charCodeAt(xe++)),(je>=c||je>E((a-q)/Se))&&P("overflow"),q+=je*Se,T=Me<=fe?l:Me>=fe+u?u:Me-fe,!(je<T);Me+=c)he=c-T,Se>E(a/he)&&P("overflow"),Se*=he;V=U.length+1,fe=C(q-Ae,V,Ae==0),E(q/V)>a-J&&P("overflow"),J+=E(q/V),q%=V,U.splice(q++,0,J)}return O(U)}function F(N){var U,$,V,q,J,fe,Ee,ke,xe,Ae,Se,Me=[],je,T,he,ie;for(N=G(N),je=N.length,U=m,$=0,J=h,fe=0;fe<je;++fe)Se=N[fe],Se<128&&Me.push(M(Se));for(V=q=Me.length,q&&Me.push(p);V<je;){for(Ee=a,fe=0;fe<je;++fe)Se=N[fe],Se>=U&&Se<Ee&&(Ee=Se);for(T=V+1,Ee-U>E((a-$)/T)&&P("overflow"),$+=(Ee-U)*T,U=Ee,fe=0;fe<je;++fe)if(Se=N[fe],Se<U&&++$>a&&P("overflow"),Se==U){for(ke=$,xe=c;Ae=xe<=J?l:xe>=J+u?u:xe-J,!(ke<Ae);xe+=c)ie=ke-Ae,he=c-Ae,Me.push(M(k(Ae+ie%he,0))),ke=E(ie/he);Me.push(M(k(ke,0))),J=C($,T,V==q),$=0,++V}++$,++U}return Me.join("")}function Q(N){return D(N,function(U){return g.test(U)?z(U.slice(4).toLowerCase()):U})}function Y(N){return D(N,function(U){return y.test(U)?"xn--"+F(U):U})}if(o={version:"1.4.1",ucs2:{decode:G,encode:O},decode:z,encode:F,toASCII:Y,toUnicode:Q},n&&i)if(t.exports==n)i.exports=o;else for(S in o)o.hasOwnProperty(S)&&(n[S]=o[S]);else r.punycode=o})(U5)})(sc,sc.exports)),sc.exports}var Dp,sE;function jo(){return sE||(sE=1,Dp=TypeError),Dp}var P5={},F5=Object.freeze({__proto__:null,default:P5}),B5=rS(F5),jp,oE;function Su(){if(oE)return jp;oE=1;var t=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&t?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,r=t&&e&&typeof e.get=="function"?e.get:null,n=t&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,d=u?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,h=f?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,p=Object.prototype.toString,g=Function.prototype.toString,y=String.prototype.match,b=String.prototype.slice,A=String.prototype.replace,R=String.prototype.toUpperCase,E=String.prototype.toLowerCase,M=RegExp.prototype.test,S=Array.prototype.concat,P=Array.prototype.join,W=Array.prototype.slice,D=Math.floor,G=typeof BigInt=="function"?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,k=typeof Symbol=="function"&&typeof Symbol.iterator=="object",C=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===k||!0)?Symbol.toStringTag:null,z=Object.prototype.propertyIsEnumerable,F=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(H){return H.__proto__}:null);function Q(H,re){if(H===1/0||H===-1/0||H!==H||H&&H>-1e3&&H<1e3||M.call(/e/,re))return re;var ze=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof H=="number"){var Ge=H<0?-D(-H):D(H);if(Ge!==H){var qe=String(Ge),Le=b.call(re,qe.length+1);return A.call(qe,ze,"$&_")+"."+A.call(A.call(Le,/([0-9]{3})/g,"$&_"),/_$/,"")}}return A.call(re,ze,"$&_")}var Y=B5,N=Y.custom,U=T(N)?N:null,$={__proto__:null,double:'"',single:"'"},V={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};jp=function H(re,ze,Ge,qe){var Le=ze||{};if(K(Le,"quoteStyle")&&!K($,Le.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(K(Le,"maxStringLength")&&(typeof Le.maxStringLength=="number"?Le.maxStringLength<0&&Le.maxStringLength!==1/0:Le.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Zr=K(Le,"customInspect")?Le.customInspect:!0;if(typeof Zr!="boolean"&&Zr!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(K(Le,"indent")&&Le.indent!==null&&Le.indent!=="	"&&!(parseInt(Le.indent,10)===Le.indent&&Le.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(K(Le,"numericSeparator")&&typeof Le.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Tn=Le.numericSeparator;if(typeof re>"u")return"undefined";if(re===null)return"null";if(typeof re=="boolean")return re?"true":"false";if(typeof re=="string")return pt(re,Le);if(typeof re=="number"){if(re===0)return 1/0/re>0?"0":"-0";var fn=String(re);return Tn?Q(re,fn):fn}if(typeof re=="bigint"){var as=String(re)+"n";return Tn?Q(re,as):as}var xm=typeof Le.depth>"u"?5:Le.depth;if(typeof Ge>"u"&&(Ge=0),Ge>=xm&&xm>0&&typeof re=="object")return Ee(re)?"[Array]":"[Object]";var Qo=B(Le,Ge);if(typeof qe>"u")qe=[];else if(pe(qe,re)>=0)return"[Circular]";function Wn(ea,uh,YH){if(uh&&(qe=W.call(qe),qe.push(uh)),YH){var eS={depth:Le.depth};return K(Le,"quoteStyle")&&(eS.quoteStyle=Le.quoteStyle),H(ea,eS,Ge+1,qe)}return H(ea,Le,Ge+1,qe)}if(typeof re=="function"&&!xe(re)){var qT=ee(re),YT=ce(re,Wn);return"[Function"+(qT?": "+qT:" (anonymous)")+"]"+(YT.length>0?" { "+P.call(YT,", ")+" }":"")}if(T(re)){var VT=k?A.call(String(re),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(re);return typeof re=="object"&&!k?Xt(VT):VT}if(De(re)){for(var bc="<"+E.call(String(re.nodeName)),Em=re.attributes||[],lh=0;lh<Em.length;lh++)bc+=" "+Em[lh].name+"="+q(J(Em[lh].value),"double",Le);return bc+=">",re.childNodes&&re.childNodes.length&&(bc+="..."),bc+="</"+E.call(String(re.nodeName))+">",bc}if(Ee(re)){if(re.length===0)return"[]";var Am=ce(re,Wn);return Qo&&!v(Am)?"["+X(Am,Qo)+"]":"[ "+P.call(Am,", ")+" ]"}if(Ae(re)){var Tm=ce(re,Wn);return!("cause"in Error.prototype)&&"cause"in re&&!z.call(re,"cause")?"{ ["+String(re)+"] "+P.call(S.call("[cause]: "+Wn(re.cause),Tm),", ")+" }":Tm.length===0?"["+String(re)+"]":"{ ["+String(re)+"] "+P.call(Tm,", ")+" }"}if(typeof re=="object"&&Zr){if(U&&typeof re[U]=="function"&&Y)return Y(re,{depth:xm-Ge});if(Zr!=="symbol"&&typeof re.inspect=="function")return re.inspect()}if(me(re)){var XT=[];return n&&n.call(re,function(ea,uh){XT.push(Wn(uh,re,!0)+" => "+Wn(ea,re))}),_("Map",r.call(re),XT,Qo)}if(Oe(re)){var ZT=[];return a&&a.call(re,function(ea){ZT.push(Wn(ea,re))}),_("Set",o.call(re),ZT,Qo)}if(se(re))return L("WeakMap");if(be(re))return L("WeakSet");if(_e(re))return L("WeakRef");if(Me(re))return Xt(Wn(Number(re)));if(he(re))return Xt(Wn(G.call(re)));if(je(re))return Xt(m.call(re));if(Se(re))return Xt(Wn(String(re)));if(typeof window<"u"&&re===window)return"{ [object Window] }";if(typeof globalThis<"u"&&re===globalThis||typeof Fi<"u"&&re===Fi)return"{ [object globalThis] }";if(!ke(re)&&!xe(re)){var Sm=ce(re,Wn),JT=F?F(re)===Object.prototype:re instanceof Object||re.constructor===Object,Rm=re instanceof Object?"":"null prototype",QT=!JT&&C&&Object(re)===re&&C in re?b.call(j(re),8,-1):Rm?"Object":"",qH=JT||typeof re.constructor!="function"?"":re.constructor.name?re.constructor.name+" ":"",Om=qH+(QT||Rm?"["+P.call(S.call([],QT||[],Rm||[]),": ")+"] ":"");return Sm.length===0?Om+"{}":Qo?Om+"{"+X(Sm,Qo)+"}":Om+"{ "+P.call(Sm,", ")+" }"}return String(re)};function q(H,re,ze){var Ge=ze.quoteStyle||re,qe=$[Ge];return qe+H+qe}function J(H){return A.call(String(H),/"/g,"&quot;")}function fe(H){return!C||!(typeof H=="object"&&(C in H||typeof H[C]<"u"))}function Ee(H){return j(H)==="[object Array]"&&fe(H)}function ke(H){return j(H)==="[object Date]"&&fe(H)}function xe(H){return j(H)==="[object RegExp]"&&fe(H)}function Ae(H){return j(H)==="[object Error]"&&fe(H)}function Se(H){return j(H)==="[object String]"&&fe(H)}function Me(H){return j(H)==="[object Number]"&&fe(H)}function je(H){return j(H)==="[object Boolean]"&&fe(H)}function T(H){if(k)return H&&typeof H=="object"&&H instanceof Symbol;if(typeof H=="symbol")return!0;if(!H||typeof H!="object"||!I)return!1;try{return I.call(H),!0}catch{}return!1}function he(H){if(!H||typeof H!="object"||!G)return!1;try{return G.call(H),!0}catch{}return!1}var ie=Object.prototype.hasOwnProperty||function(H){return H in this};function K(H,re){return ie.call(H,re)}function j(H){return p.call(H)}function ee(H){if(H.name)return H.name;var re=y.call(g.call(H),/^function\s*([\w$]+)/);return re?re[1]:null}function pe(H,re){if(H.indexOf)return H.indexOf(re);for(var ze=0,Ge=H.length;ze<Ge;ze++)if(H[ze]===re)return ze;return-1}function me(H){if(!r||!H||typeof H!="object")return!1;try{r.call(H);try{o.call(H)}catch{return!0}return H instanceof Map}catch{}return!1}function se(H){if(!l||!H||typeof H!="object")return!1;try{l.call(H,l);try{d.call(H,d)}catch{return!0}return H instanceof WeakMap}catch{}return!1}function _e(H){if(!h||!H||typeof H!="object")return!1;try{return h.call(H),!0}catch{}return!1}function Oe(H){if(!o||!H||typeof H!="object")return!1;try{o.call(H);try{r.call(H)}catch{return!0}return H instanceof Set}catch{}return!1}function be(H){if(!d||!H||typeof H!="object")return!1;try{d.call(H,d);try{l.call(H,l)}catch{return!0}return H instanceof WeakSet}catch{}return!1}function De(H){return!H||typeof H!="object"?!1:typeof HTMLElement<"u"&&H instanceof HTMLElement?!0:typeof H.nodeName=="string"&&typeof H.getAttribute=="function"}function pt(H,re){if(H.length>re.maxStringLength){var ze=H.length-re.maxStringLength,Ge="... "+ze+" more character"+(ze>1?"s":"");return pt(b.call(H,0,re.maxStringLength),re)+Ge}var qe=V[re.quoteStyle||"single"];qe.lastIndex=0;var Le=A.call(A.call(H,qe,"\\$1"),/[\x00-\x1f]/g,Ze);return q(Le,"single",re)}function Ze(H){var re=H.charCodeAt(0),ze={8:"b",9:"t",10:"n",12:"f",13:"r"}[re];return ze?"\\"+ze:"\\x"+(re<16?"0":"")+R.call(re.toString(16))}function Xt(H){return"Object("+H+")"}function L(H){return H+" { ? }"}function _(H,re,ze,Ge){var qe=Ge?X(ze,Ge):P.call(ze,", ");return H+" ("+re+") {"+qe+"}"}function v(H){for(var re=0;re<H.length;re++)if(pe(H[re],`
`)>=0)return!1;return!0}function B(H,re){var ze;if(H.indent==="	")ze="	";else if(typeof H.indent=="number"&&H.indent>0)ze=P.call(Array(H.indent+1)," ");else return null;return{base:ze,prev:P.call(Array(re+1),ze)}}function X(H,re){if(H.length===0)return"";var ze=`
`+re.prev+re.base;return ze+P.call(H,","+ze)+`
`+re.prev}function ce(H,re){var ze=Ee(H),Ge=[];if(ze){Ge.length=H.length;for(var qe=0;qe<H.length;qe++)Ge[qe]=K(H,qe)?re(H[qe],H):""}var Le=typeof O=="function"?O(H):[],Zr;if(k){Zr={};for(var Tn=0;Tn<Le.length;Tn++)Zr["$"+Le[Tn]]=Le[Tn]}for(var fn in H)K(H,fn)&&(ze&&String(Number(fn))===fn&&fn<H.length||k&&Zr["$"+fn]instanceof Symbol||(M.call(/[^\w$]/,fn)?Ge.push(re(fn,H)+": "+re(H[fn],H)):Ge.push(fn+": "+re(H[fn],H))));if(typeof O=="function")for(var as=0;as<Le.length;as++)z.call(H,Le[as])&&Ge.push("["+re(Le[as])+"]: "+re(H[Le[as]],H));return Ge}return jp}var zp,aE;function D5(){if(aE)return zp;aE=1;var t=Su(),e=jo(),r=function(a,c,l){for(var u=a,d;(d=u.next)!=null;u=d)if(d.key===c)return u.next=d.next,l||(d.next=a.next,a.next=d),d},n=function(a,c){if(a){var l=r(a,c);return l&&l.value}},i=function(a,c,l){var u=r(a,c);u?u.value=l:a.next={key:c,next:a.next,value:l}},s=function(a,c){return a?!!r(a,c):!1},o=function(a,c){if(a)return r(a,c,!0)};return zp=function(){var c,l={assert:function(u){if(!l.has(u))throw new e("Side channel does not contain "+t(u))},delete:function(u){var d=c&&c.next,f=o(c,u);return f&&d&&d===f&&(c=void 0),!!f},get:function(u){return n(c,u)},has:function(u){return s(c,u)},set:function(u,d){c||(c={next:void 0}),i(c,u,d)}};return l},zp}var Wp,cE;function lE(){return cE||(cE=1,Wp=Object),Wp}var Hp,uE;function j5(){return uE||(uE=1,Hp=Error),Hp}var Gp,hE;function z5(){return hE||(hE=1,Gp=EvalError),Gp}var Kp,fE;function W5(){return fE||(fE=1,Kp=RangeError),Kp}var qp,dE;function H5(){return dE||(dE=1,qp=ReferenceError),qp}var Yp,pE;function G5(){return pE||(pE=1,Yp=SyntaxError),Yp}var Vp,mE;function K5(){return mE||(mE=1,Vp=URIError),Vp}var Xp,gE;function q5(){return gE||(gE=1,Xp=Math.abs),Xp}var Zp,yE;function Y5(){return yE||(yE=1,Zp=Math.floor),Zp}var Jp,_E;function V5(){return _E||(_E=1,Jp=Math.max),Jp}var Qp,bE;function X5(){return bE||(bE=1,Qp=Math.min),Qp}var e0,wE;function Z5(){return wE||(wE=1,e0=Math.pow),e0}var t0,kE;function J5(){return kE||(kE=1,t0=Math.round),t0}var r0,vE;function Q5(){return vE||(vE=1,r0=Number.isNaN||function(e){return e!==e}),r0}var n0,xE;function ez(){if(xE)return n0;xE=1;var t=Q5();return n0=function(r){return t(r)||r===0?r:r<0?-1:1},n0}var i0,EE;function tz(){return EE||(EE=1,i0=Object.getOwnPropertyDescriptor),i0}var s0,AE;function TE(){if(AE)return s0;AE=1;var t=tz();if(t)try{t([],"length")}catch{t=null}return s0=t,s0}var o0,SE;function rz(){if(SE)return o0;SE=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return o0=t,o0}var a0,RE;function nz(){return RE||(RE=1,a0=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;e[r]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,r);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),a0}var c0,OE;function iz(){if(OE)return c0;OE=1;var t=typeof Symbol<"u"&&Symbol,e=nz();return c0=function(){return typeof t!="function"||typeof Symbol!="function"||typeof t("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},c0}var l0,IE;function NE(){return IE||(IE=1,l0=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),l0}var u0,CE;function LE(){if(CE)return u0;CE=1;var t=lE();return u0=t.getPrototypeOf||null,u0}var h0,ME;function sz(){if(ME)return h0;ME=1;var t="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,r=Math.max,n="[object Function]",i=function(c,l){for(var u=[],d=0;d<c.length;d+=1)u[d]=c[d];for(var f=0;f<l.length;f+=1)u[f+c.length]=l[f];return u},s=function(c,l){for(var u=[],d=l,f=0;d<c.length;d+=1,f+=1)u[f]=c[d];return u},o=function(a,c){for(var l="",u=0;u<a.length;u+=1)l+=a[u],u+1<a.length&&(l+=c);return l};return h0=function(c){var l=this;if(typeof l!="function"||e.apply(l)!==n)throw new TypeError(t+l);for(var u=s(arguments,1),d,f=function(){if(this instanceof d){var y=l.apply(this,i(u,arguments));return Object(y)===y?y:this}return l.apply(c,i(u,arguments))},h=r(0,l.length-u.length),m=[],p=0;p<h;p++)m[p]="$"+p;if(d=Function("binder","return function ("+o(m,",")+"){ return binder.apply(this,arguments); }")(f),l.prototype){var g=function(){};g.prototype=l.prototype,d.prototype=new g,g.prototype=null}return d},h0}var f0,UE;function Ru(){if(UE)return f0;UE=1;var t=sz();return f0=Function.prototype.bind||t,f0}var d0,$E;function p0(){return $E||($E=1,d0=Function.prototype.call),d0}var m0,PE;function FE(){return PE||(PE=1,m0=Function.prototype.apply),m0}var g0,BE;function oz(){return BE||(BE=1,g0=typeof Reflect<"u"&&Reflect&&Reflect.apply),g0}var y0,DE;function az(){if(DE)return y0;DE=1;var t=Ru(),e=FE(),r=p0(),n=oz();return y0=n||t.call(r,e),y0}var _0,jE;function zE(){if(jE)return _0;jE=1;var t=Ru(),e=jo(),r=p0(),n=az();return _0=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return n(t,r,s)},_0}var b0,WE;function cz(){if(WE)return b0;WE=1;var t=zE(),e=TE(),r;try{r=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var n=!!r&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return b0=n&&typeof n.get=="function"?t([n.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,b0}var w0,HE;function lz(){if(HE)return w0;HE=1;var t=NE(),e=LE(),r=cz();return w0=t?function(i){return t(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:r?function(i){return r(i)}:null,w0}var k0,GE;function uz(){if(GE)return k0;GE=1;var t=Function.prototype.call,e=Object.prototype.hasOwnProperty,r=Ru();return k0=r.call(t,e),k0}var v0,KE;function x0(){if(KE)return v0;KE=1;var t,e=lE(),r=j5(),n=z5(),i=W5(),s=H5(),o=G5(),a=jo(),c=K5(),l=q5(),u=Y5(),d=V5(),f=X5(),h=Z5(),m=J5(),p=ez(),g=Function,y=function(xe){try{return g('"use strict"; return ('+xe+").constructor;")()}catch{}},b=TE(),A=rz(),R=function(){throw new a},E=b?(function(){try{return arguments.callee,R}catch{try{return b(arguments,"callee").get}catch{return R}}})():R,M=iz()(),S=lz(),P=LE(),W=NE(),D=FE(),G=p0(),O={},I=typeof Uint8Array>"u"||!S?t:S(Uint8Array),k={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?t:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?t:ArrayBuffer,"%ArrayIteratorPrototype%":M&&S?S([][Symbol.iterator]()):t,"%AsyncFromSyncIteratorPrototype%":t,"%AsyncFunction%":O,"%AsyncGenerator%":O,"%AsyncGeneratorFunction%":O,"%AsyncIteratorPrototype%":O,"%Atomics%":typeof Atomics>"u"?t:Atomics,"%BigInt%":typeof BigInt>"u"?t:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?t:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?t:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?t:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":n,"%Float16Array%":typeof Float16Array>"u"?t:Float16Array,"%Float32Array%":typeof Float32Array>"u"?t:Float32Array,"%Float64Array%":typeof Float64Array>"u"?t:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?t:FinalizationRegistry,"%Function%":g,"%GeneratorFunction%":O,"%Int8Array%":typeof Int8Array>"u"?t:Int8Array,"%Int16Array%":typeof Int16Array>"u"?t:Int16Array,"%Int32Array%":typeof Int32Array>"u"?t:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":M&&S?S(S([][Symbol.iterator]())):t,"%JSON%":typeof JSON=="object"?JSON:t,"%Map%":typeof Map>"u"?t:Map,"%MapIteratorPrototype%":typeof Map>"u"||!M||!S?t:S(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":b,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?t:Promise,"%Proxy%":typeof Proxy>"u"?t:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?t:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?t:Set,"%SetIteratorPrototype%":typeof Set>"u"||!M||!S?t:S(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?t:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":M&&S?S(""[Symbol.iterator]()):t,"%Symbol%":M?Symbol:t,"%SyntaxError%":o,"%ThrowTypeError%":E,"%TypedArray%":I,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?t:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?t:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?t:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?t:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?t:WeakMap,"%WeakRef%":typeof WeakRef>"u"?t:WeakRef,"%WeakSet%":typeof WeakSet>"u"?t:WeakSet,"%Function.prototype.call%":G,"%Function.prototype.apply%":D,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":P,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":d,"%Math.min%":f,"%Math.pow%":h,"%Math.round%":m,"%Math.sign%":p,"%Reflect.getPrototypeOf%":W};if(S)try{null.error}catch(xe){var C=S(S(xe));k["%Error.prototype%"]=C}var z=function xe(Ae){var Se;if(Ae==="%AsyncFunction%")Se=y("async function () {}");else if(Ae==="%GeneratorFunction%")Se=y("function* () {}");else if(Ae==="%AsyncGeneratorFunction%")Se=y("async function* () {}");else if(Ae==="%AsyncGenerator%"){var Me=xe("%AsyncGeneratorFunction%");Me&&(Se=Me.prototype)}else if(Ae==="%AsyncIteratorPrototype%"){var je=xe("%AsyncGenerator%");je&&S&&(Se=S(je.prototype))}return k[Ae]=Se,Se},F={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Q=Ru(),Y=uz(),N=Q.call(G,Array.prototype.concat),U=Q.call(D,Array.prototype.splice),$=Q.call(G,String.prototype.replace),V=Q.call(G,String.prototype.slice),q=Q.call(G,RegExp.prototype.exec),J=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,fe=/\\(\\)?/g,Ee=function(Ae){var Se=V(Ae,0,1),Me=V(Ae,-1);if(Se==="%"&&Me!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(Me==="%"&&Se!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var je=[];return $(Ae,J,function(T,he,ie,K){je[je.length]=ie?$(K,fe,"$1"):he||T}),je},ke=function(Ae,Se){var Me=Ae,je;if(Y(F,Me)&&(je=F[Me],Me="%"+je[0]+"%"),Y(k,Me)){var T=k[Me];if(T===O&&(T=z(Me)),typeof T>"u"&&!Se)throw new a("intrinsic "+Ae+" exists, but is not available. Please file an issue!");return{alias:je,name:Me,value:T}}throw new o("intrinsic "+Ae+" does not exist!")};return v0=function(Ae,Se){if(typeof Ae!="string"||Ae.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Se!="boolean")throw new a('"allowMissing" argument must be a boolean');if(q(/^%?[^%]*%?$/,Ae)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Me=Ee(Ae),je=Me.length>0?Me[0]:"",T=ke("%"+je+"%",Se),he=T.name,ie=T.value,K=!1,j=T.alias;j&&(je=j[0],U(Me,N([0,1],j)));for(var ee=1,pe=!0;ee<Me.length;ee+=1){var me=Me[ee],se=V(me,0,1),_e=V(me,-1);if((se==='"'||se==="'"||se==="`"||_e==='"'||_e==="'"||_e==="`")&&se!==_e)throw new o("property names with quotes must have matching quotes");if((me==="constructor"||!pe)&&(K=!0),je+="."+me,he="%"+je+"%",Y(k,he))ie=k[he];else if(ie!=null){if(!(me in ie)){if(!Se)throw new a("base intrinsic for "+Ae+" exists, but the property is not available.");return}if(b&&ee+1>=Me.length){var Oe=b(ie,me);pe=!!Oe,pe&&"get"in Oe&&!("originalValue"in Oe.get)?ie=Oe.get:ie=ie[me]}else pe=Y(ie,me),ie=ie[me];pe&&!K&&(k[he]=ie)}}return ie},v0}var E0,qE;function YE(){if(qE)return E0;qE=1;var t=x0(),e=zE(),r=e([t("%String.prototype.indexOf%")]);return E0=function(i,s){var o=t(i,!!s);return typeof o=="function"&&r(i,".prototype.")>-1?e([o]):o},E0}var A0,VE;function XE(){if(VE)return A0;VE=1;var t=x0(),e=YE(),r=Su(),n=jo(),i=t("%Map%",!0),s=e("Map.prototype.get",!0),o=e("Map.prototype.set",!0),a=e("Map.prototype.has",!0),c=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return A0=!!i&&function(){var d,f={assert:function(h){if(!f.has(h))throw new n("Side channel does not contain "+r(h))},delete:function(h){if(d){var m=c(d,h);return l(d)===0&&(d=void 0),m}return!1},get:function(h){if(d)return s(d,h)},has:function(h){return d?a(d,h):!1},set:function(h,m){d||(d=new i),o(d,h,m)}};return f},A0}var T0,ZE;function hz(){if(ZE)return T0;ZE=1;var t=x0(),e=YE(),r=Su(),n=XE(),i=jo(),s=t("%WeakMap%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),c=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return T0=s?function(){var d,f,h={assert:function(m){if(!h.has(m))throw new i("Side channel does not contain "+r(m))},delete:function(m){if(s&&m&&(typeof m=="object"||typeof m=="function")){if(d)return l(d,m)}else if(n&&f)return f.delete(m);return!1},get:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&d?o(d,m):f&&f.get(m)},has:function(m){return s&&m&&(typeof m=="object"||typeof m=="function")&&d?c(d,m):!!f&&f.has(m)},set:function(m,p){s&&m&&(typeof m=="object"||typeof m=="function")?(d||(d=new s),a(d,m,p)):n&&(f||(f=n()),f.set(m,p))}};return h}:n,T0}var S0,JE;function fz(){if(JE)return S0;JE=1;var t=jo(),e=Su(),r=D5(),n=XE(),i=hz(),s=i||n||r;return S0=function(){var a,c={assert:function(l){if(!c.has(l))throw new t("Side channel does not contain "+e(l))},delete:function(l){return!!a&&a.delete(l)},get:function(l){return a&&a.get(l)},has:function(l){return!!a&&a.has(l)},set:function(l,u){a||(a=s()),a.set(l,u)}};return c},S0}var R0,QE;function O0(){if(QE)return R0;QE=1;var t=String.prototype.replace,e=/%20/g,r={RFC1738:"RFC1738",RFC3986:"RFC3986"};return R0={default:r.RFC3986,formatters:{RFC1738:function(n){return t.call(n,e,"+")},RFC3986:function(n){return String(n)}},RFC1738:r.RFC1738,RFC3986:r.RFC3986},R0}var I0,eA;function tA(){if(eA)return I0;eA=1;var t=O0(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n=(function(){for(var g=[],y=0;y<256;++y)g.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return g})(),i=function(y){for(;y.length>1;){var b=y.pop(),A=b.obj[b.prop];if(r(A)){for(var R=[],E=0;E<A.length;++E)typeof A[E]<"u"&&R.push(A[E]);b.obj[b.prop]=R}}},s=function(y,b){for(var A=b&&b.plainObjects?{__proto__:null}:{},R=0;R<y.length;++R)typeof y[R]<"u"&&(A[R]=y[R]);return A},o=function g(y,b,A){if(!b)return y;if(typeof b!="object"&&typeof b!="function"){if(r(y))y.push(b);else if(y&&typeof y=="object")(A&&(A.plainObjects||A.allowPrototypes)||!e.call(Object.prototype,b))&&(y[b]=!0);else return[y,b];return y}if(!y||typeof y!="object")return[y].concat(b);var R=y;return r(y)&&!r(b)&&(R=s(y,A)),r(y)&&r(b)?(b.forEach(function(E,M){if(e.call(y,M)){var S=y[M];S&&typeof S=="object"&&E&&typeof E=="object"?y[M]=g(S,E,A):y.push(E)}else y[M]=E}),y):Object.keys(b).reduce(function(E,M){var S=b[M];return e.call(E,M)?E[M]=g(E[M],S,A):E[M]=S,E},R)},a=function(y,b){return Object.keys(b).reduce(function(A,R){return A[R]=b[R],A},y)},c=function(g,y,b){var A=g.replace(/\+/g," ");if(b==="iso-8859-1")return A.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(A)}catch{return A}},l=1024,u=function(y,b,A,R,E){if(y.length===0)return y;var M=y;if(typeof y=="symbol"?M=Symbol.prototype.toString.call(y):typeof y!="string"&&(M=String(y)),A==="iso-8859-1")return escape(M).replace(/%u[0-9a-f]{4}/gi,function(I){return"%26%23"+parseInt(I.slice(2),16)+"%3B"});for(var S="",P=0;P<M.length;P+=l){for(var W=M.length>=l?M.slice(P,P+l):M,D=[],G=0;G<W.length;++G){var O=W.charCodeAt(G);if(O===45||O===46||O===95||O===126||O>=48&&O<=57||O>=65&&O<=90||O>=97&&O<=122||E===t.RFC1738&&(O===40||O===41)){D[D.length]=W.charAt(G);continue}if(O<128){D[D.length]=n[O];continue}if(O<2048){D[D.length]=n[192|O>>6]+n[128|O&63];continue}if(O<55296||O>=57344){D[D.length]=n[224|O>>12]+n[128|O>>6&63]+n[128|O&63];continue}G+=1,O=65536+((O&1023)<<10|W.charCodeAt(G)&1023),D[D.length]=n[240|O>>18]+n[128|O>>12&63]+n[128|O>>6&63]+n[128|O&63]}S+=D.join("")}return S},d=function(y){for(var b=[{obj:{o:y},prop:"o"}],A=[],R=0;R<b.length;++R)for(var E=b[R],M=E.obj[E.prop],S=Object.keys(M),P=0;P<S.length;++P){var W=S[P],D=M[W];typeof D=="object"&&D!==null&&A.indexOf(D)===-1&&(b.push({obj:M,prop:W}),A.push(D))}return i(b),y},f=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},h=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},m=function(y,b){return[].concat(y,b)},p=function(y,b){if(r(y)){for(var A=[],R=0;R<y.length;R+=1)A.push(b(y[R]));return A}return b(y)};return I0={arrayToObject:s,assign:a,combine:m,compact:d,decode:c,encode:u,isBuffer:h,isRegExp:f,maybeMap:p,merge:o},I0}var N0,rA;function dz(){if(rA)return N0;rA=1;var t=fz(),e=tA(),r=O0(),n=Object.prototype.hasOwnProperty,i={brackets:function(g){return g+"[]"},comma:"comma",indices:function(g,y){return g+"["+y+"]"},repeat:function(g){return g}},s=Array.isArray,o=Array.prototype.push,a=function(p,g){o.apply(p,s(g)?g:[g])},c=Date.prototype.toISOString,l=r.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:r.formatters[l],indices:!1,serializeDate:function(g){return c.call(g)},skipNulls:!1,strictNullHandling:!1},d=function(g){return typeof g=="string"||typeof g=="number"||typeof g=="boolean"||typeof g=="symbol"||typeof g=="bigint"},f={},h=function p(g,y,b,A,R,E,M,S,P,W,D,G,O,I,k,C,z,F){for(var Q=g,Y=F,N=0,U=!1;(Y=Y.get(f))!==void 0&&!U;){var $=Y.get(g);if(N+=1,typeof $<"u"){if($===N)throw new RangeError("Cyclic object value");U=!0}typeof Y.get(f)>"u"&&(N=0)}if(typeof W=="function"?Q=W(y,Q):Q instanceof Date?Q=O(Q):b==="comma"&&s(Q)&&(Q=e.maybeMap(Q,function(he){return he instanceof Date?O(he):he})),Q===null){if(E)return P&&!C?P(y,u.encoder,z,"key",I):y;Q=""}if(d(Q)||e.isBuffer(Q)){if(P){var V=C?y:P(y,u.encoder,z,"key",I);return[k(V)+"="+k(P(Q,u.encoder,z,"value",I))]}return[k(y)+"="+k(String(Q))]}var q=[];if(typeof Q>"u")return q;var J;if(b==="comma"&&s(Q))C&&P&&(Q=e.maybeMap(Q,P)),J=[{value:Q.length>0?Q.join(",")||null:void 0}];else if(s(W))J=W;else{var fe=Object.keys(Q);J=D?fe.sort(D):fe}var Ee=S?String(y).replace(/\./g,"%2E"):String(y),ke=A&&s(Q)&&Q.length===1?Ee+"[]":Ee;if(R&&s(Q)&&Q.length===0)return ke+"[]";for(var xe=0;xe<J.length;++xe){var Ae=J[xe],Se=typeof Ae=="object"&&Ae&&typeof Ae.value<"u"?Ae.value:Q[Ae];if(!(M&&Se===null)){var Me=G&&S?String(Ae).replace(/\./g,"%2E"):String(Ae),je=s(Q)?typeof b=="function"?b(ke,Me):ke:ke+(G?"."+Me:"["+Me+"]");F.set(g,N);var T=t();T.set(f,F),a(q,p(Se,je,b,A,R,E,M,S,b==="comma"&&C&&s(Q)?null:P,W,D,G,O,I,k,C,z,T))}}return q},m=function(g){if(!g)return u;if(typeof g.allowEmptyArrays<"u"&&typeof g.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof g.encodeDotInKeys<"u"&&typeof g.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(g.encoder!==null&&typeof g.encoder<"u"&&typeof g.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=g.charset||u.charset;if(typeof g.charset<"u"&&g.charset!=="utf-8"&&g.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=r.default;if(typeof g.format<"u"){if(!n.call(r.formatters,g.format))throw new TypeError("Unknown format option provided.");b=g.format}var A=r.formatters[b],R=u.filter;(typeof g.filter=="function"||s(g.filter))&&(R=g.filter);var E;if(g.arrayFormat in i?E=g.arrayFormat:"indices"in g?E=g.indices?"indices":"repeat":E=u.arrayFormat,"commaRoundTrip"in g&&typeof g.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var M=typeof g.allowDots>"u"?g.encodeDotInKeys===!0?!0:u.allowDots:!!g.allowDots;return{addQueryPrefix:typeof g.addQueryPrefix=="boolean"?g.addQueryPrefix:u.addQueryPrefix,allowDots:M,allowEmptyArrays:typeof g.allowEmptyArrays=="boolean"?!!g.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:E,charset:y,charsetSentinel:typeof g.charsetSentinel=="boolean"?g.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!g.commaRoundTrip,delimiter:typeof g.delimiter>"u"?u.delimiter:g.delimiter,encode:typeof g.encode=="boolean"?g.encode:u.encode,encodeDotInKeys:typeof g.encodeDotInKeys=="boolean"?g.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof g.encoder=="function"?g.encoder:u.encoder,encodeValuesOnly:typeof g.encodeValuesOnly=="boolean"?g.encodeValuesOnly:u.encodeValuesOnly,filter:R,format:b,formatter:A,serializeDate:typeof g.serializeDate=="function"?g.serializeDate:u.serializeDate,skipNulls:typeof g.skipNulls=="boolean"?g.skipNulls:u.skipNulls,sort:typeof g.sort=="function"?g.sort:null,strictNullHandling:typeof g.strictNullHandling=="boolean"?g.strictNullHandling:u.strictNullHandling}};return N0=function(p,g){var y=p,b=m(g),A,R;typeof b.filter=="function"?(R=b.filter,y=R("",y)):s(b.filter)&&(R=b.filter,A=R);var E=[];if(typeof y!="object"||y===null)return"";var M=i[b.arrayFormat],S=M==="comma"&&b.commaRoundTrip;A||(A=Object.keys(y)),b.sort&&A.sort(b.sort);for(var P=t(),W=0;W<A.length;++W){var D=A[W],G=y[D];b.skipNulls&&G===null||a(E,h(G,D,M,S,b.allowEmptyArrays,b.strictNullHandling,b.skipNulls,b.encodeDotInKeys,b.encode?b.encoder:null,b.filter,b.sort,b.allowDots,b.serializeDate,b.format,b.formatter,b.encodeValuesOnly,b.charset,P))}var O=E.join(b.delimiter),I=b.addQueryPrefix===!0?"?":"";return b.charsetSentinel&&(b.charset==="iso-8859-1"?I+="utf8=%26%2310003%3B&":I+="utf8=%E2%9C%93&"),O.length>0?I+O:""},N0}var C0,nA;function pz(){if(nA)return C0;nA=1;var t=tA(),e=Object.prototype.hasOwnProperty,r=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:t.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(f){return f.replace(/&#(\d+);/g,function(h,m){return String.fromCharCode(parseInt(m,10))})},s=function(f,h,m){if(f&&typeof f=="string"&&h.comma&&f.indexOf(",")>-1)return f.split(",");if(h.throwOnLimitExceeded&&m>=h.arrayLimit)throw new RangeError("Array limit exceeded. Only "+h.arrayLimit+" element"+(h.arrayLimit===1?"":"s")+" allowed in an array.");return f},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(h,m){var p={__proto__:null},g=m.ignoreQueryPrefix?h.replace(/^\?/,""):h;g=g.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=m.parameterLimit===1/0?void 0:m.parameterLimit,b=g.split(m.delimiter,m.throwOnLimitExceeded?y+1:y);if(m.throwOnLimitExceeded&&b.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var A=-1,R,E=m.charset;if(m.charsetSentinel)for(R=0;R<b.length;++R)b[R].indexOf("utf8=")===0&&(b[R]===a?E="utf-8":b[R]===o&&(E="iso-8859-1"),A=R,R=b.length);for(R=0;R<b.length;++R)if(R!==A){var M=b[R],S=M.indexOf("]="),P=S===-1?M.indexOf("="):S+1,W,D;P===-1?(W=m.decoder(M,n.decoder,E,"key"),D=m.strictNullHandling?null:""):(W=m.decoder(M.slice(0,P),n.decoder,E,"key"),D=t.maybeMap(s(M.slice(P+1),m,r(p[W])?p[W].length:0),function(O){return m.decoder(O,n.decoder,E,"value")})),D&&m.interpretNumericEntities&&E==="iso-8859-1"&&(D=i(String(D))),M.indexOf("[]=")>-1&&(D=r(D)?[D]:D);var G=e.call(p,W);G&&m.duplicates==="combine"?p[W]=t.combine(p[W],D):(!G||m.duplicates==="last")&&(p[W]=D)}return p},l=function(f,h,m,p){var g=0;if(f.length>0&&f[f.length-1]==="[]"){var y=f.slice(0,-1).join("");g=Array.isArray(h)&&h[y]?h[y].length:0}for(var b=p?h:s(h,m,g),A=f.length-1;A>=0;--A){var R,E=f[A];if(E==="[]"&&m.parseArrays)R=m.allowEmptyArrays&&(b===""||m.strictNullHandling&&b===null)?[]:t.combine([],b);else{R=m.plainObjects?{__proto__:null}:{};var M=E.charAt(0)==="["&&E.charAt(E.length-1)==="]"?E.slice(1,-1):E,S=m.decodeDotInKeys?M.replace(/%2E/g,"."):M,P=parseInt(S,10);!m.parseArrays&&S===""?R={0:b}:!isNaN(P)&&E!==S&&String(P)===S&&P>=0&&m.parseArrays&&P<=m.arrayLimit?(R=[],R[P]=b):S!=="__proto__"&&(R[S]=b)}b=R}return b},u=function(h,m,p,g){if(h){var y=p.allowDots?h.replace(/\.([^.[]+)/g,"[$1]"):h,b=/(\[[^[\]]*])/,A=/(\[[^[\]]*])/g,R=p.depth>0&&b.exec(y),E=R?y.slice(0,R.index):y,M=[];if(E){if(!p.plainObjects&&e.call(Object.prototype,E)&&!p.allowPrototypes)return;M.push(E)}for(var S=0;p.depth>0&&(R=A.exec(y))!==null&&S<p.depth;){if(S+=1,!p.plainObjects&&e.call(Object.prototype,R[1].slice(1,-1))&&!p.allowPrototypes)return;M.push(R[1])}if(R){if(p.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+p.depth+" and strictDepth is true");M.push("["+y.slice(R.index)+"]")}return l(M,m,p,g)}},d=function(h){if(!h)return n;if(typeof h.allowEmptyArrays<"u"&&typeof h.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof h.decodeDotInKeys<"u"&&typeof h.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(h.decoder!==null&&typeof h.decoder<"u"&&typeof h.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof h.charset<"u"&&h.charset!=="utf-8"&&h.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof h.throwOnLimitExceeded<"u"&&typeof h.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var m=typeof h.charset>"u"?n.charset:h.charset,p=typeof h.duplicates>"u"?n.duplicates:h.duplicates;if(p!=="combine"&&p!=="first"&&p!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var g=typeof h.allowDots>"u"?h.decodeDotInKeys===!0?!0:n.allowDots:!!h.allowDots;return{allowDots:g,allowEmptyArrays:typeof h.allowEmptyArrays=="boolean"?!!h.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:typeof h.allowPrototypes=="boolean"?h.allowPrototypes:n.allowPrototypes,allowSparse:typeof h.allowSparse=="boolean"?h.allowSparse:n.allowSparse,arrayLimit:typeof h.arrayLimit=="number"?h.arrayLimit:n.arrayLimit,charset:m,charsetSentinel:typeof h.charsetSentinel=="boolean"?h.charsetSentinel:n.charsetSentinel,comma:typeof h.comma=="boolean"?h.comma:n.comma,decodeDotInKeys:typeof h.decodeDotInKeys=="boolean"?h.decodeDotInKeys:n.decodeDotInKeys,decoder:typeof h.decoder=="function"?h.decoder:n.decoder,delimiter:typeof h.delimiter=="string"||t.isRegExp(h.delimiter)?h.delimiter:n.delimiter,depth:typeof h.depth=="number"||h.depth===!1?+h.depth:n.depth,duplicates:p,ignoreQueryPrefix:h.ignoreQueryPrefix===!0,interpretNumericEntities:typeof h.interpretNumericEntities=="boolean"?h.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:typeof h.parameterLimit=="number"?h.parameterLimit:n.parameterLimit,parseArrays:h.parseArrays!==!1,plainObjects:typeof h.plainObjects=="boolean"?h.plainObjects:n.plainObjects,strictDepth:typeof h.strictDepth=="boolean"?!!h.strictDepth:n.strictDepth,strictNullHandling:typeof h.strictNullHandling=="boolean"?h.strictNullHandling:n.strictNullHandling,throwOnLimitExceeded:typeof h.throwOnLimitExceeded=="boolean"?h.throwOnLimitExceeded:!1}};return C0=function(f,h){var m=d(h);if(f===""||f===null||typeof f>"u")return m.plainObjects?{__proto__:null}:{};for(var p=typeof f=="string"?c(f,m):f,g=m.plainObjects?{__proto__:null}:{},y=Object.keys(p),b=0;b<y.length;++b){var A=y[b],R=u(A,p[A],m,typeof f=="string");g=t.merge(g,R,m)}return m.allowSparse===!0?g:t.compact(g)},C0}var L0,iA;function mz(){if(iA)return L0;iA=1;var t=dz(),e=pz(),r=O0();return L0={formats:r,parse:e,stringify:t},L0}var sA;function gz(){if(sA)return zs;sA=1;var t=$5();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var r=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,d=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,h={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},p={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=mz();function y(E,M,S){if(E&&typeof E=="object"&&E instanceof e)return E;var P=new e;return P.parse(E,M,S),P}e.prototype.parse=function(E,M,S){if(typeof E!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof E);var P=E.indexOf("?"),W=P!==-1&&P<E.indexOf("#")?"?":"#",D=E.split(W),G=/\\/g;D[0]=D[0].replace(G,"/"),E=D.join(W);var O=E;if(O=O.trim(),!S&&E.split("#").length===1){var I=i.exec(O);if(I)return this.path=O,this.href=O,this.pathname=I[1],I[2]?(this.search=I[2],M?this.query=g.parse(this.search.substr(1)):this.query=this.search.substr(1)):M&&(this.search="",this.query={}),this}var k=r.exec(O);if(k){k=k[0];var C=k.toLowerCase();this.protocol=C,O=O.substr(k.length)}if(S||k||O.match(/^\/\/[^@/]+@[^@/]+/)){var z=O.substr(0,2)==="//";z&&!(k&&m[k])&&(O=O.substr(2),this.slashes=!0)}if(!m[k]&&(z||k&&!p[k])){for(var F=-1,Q=0;Q<l.length;Q++){var Y=O.indexOf(l[Q]);Y!==-1&&(F===-1||Y<F)&&(F=Y)}var N,U;F===-1?U=O.lastIndexOf("@"):U=O.lastIndexOf("@",F),U!==-1&&(N=O.slice(0,U),O=O.slice(U+1),this.auth=decodeURIComponent(N)),F=-1;for(var Q=0;Q<c.length;Q++){var Y=O.indexOf(c[Q]);Y!==-1&&(F===-1||Y<F)&&(F=Y)}F===-1&&(F=O.length),this.host=O.slice(0,F),O=O.slice(F),this.parseHost(),this.hostname=this.hostname||"";var $=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!$)for(var V=this.hostname.split(/\./),Q=0,q=V.length;Q<q;Q++){var J=V[Q];if(J&&!J.match(d)){for(var fe="",Ee=0,ke=J.length;Ee<ke;Ee++)J.charCodeAt(Ee)>127?fe+="x":fe+=J[Ee];if(!fe.match(d)){var xe=V.slice(0,Q),Ae=V.slice(Q+1),Se=J.match(f);Se&&(xe.push(Se[1]),Ae.unshift(Se[2])),Ae.length&&(O="/"+Ae.join(".")+O),this.hostname=xe.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),$||(this.hostname=t.toASCII(this.hostname));var Me=this.port?":"+this.port:"",je=this.hostname||"";this.host=je+Me,this.href+=this.host,$&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),O[0]!=="/"&&(O="/"+O))}if(!h[C])for(var Q=0,q=a.length;Q<q;Q++){var T=a[Q];if(O.indexOf(T)!==-1){var he=encodeURIComponent(T);he===T&&(he=escape(T)),O=O.split(T).join(he)}}var ie=O.indexOf("#");ie!==-1&&(this.hash=O.substr(ie),O=O.slice(0,ie));var K=O.indexOf("?");if(K!==-1?(this.search=O.substr(K),this.query=O.substr(K+1),M&&(this.query=g.parse(this.query)),O=O.slice(0,K)):M&&(this.search="",this.query={}),O&&(this.pathname=O),p[C]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var Me=this.pathname||"",j=this.search||"";this.path=Me+j}return this.href=this.format(),this};function b(E){return typeof E=="string"&&(E=y(E)),E instanceof e?E.format():e.prototype.format.call(E)}e.prototype.format=function(){var E=this.auth||"";E&&(E=encodeURIComponent(E),E=E.replace(/%3A/i,":"),E+="@");var M=this.protocol||"",S=this.pathname||"",P=this.hash||"",W=!1,D="";this.host?W=E+this.host:this.hostname&&(W=E+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(W+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(D=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var G=this.search||D&&"?"+D||"";return M&&M.substr(-1)!==":"&&(M+=":"),this.slashes||(!M||p[M])&&W!==!1?(W="//"+(W||""),S&&S.charAt(0)!=="/"&&(S="/"+S)):W||(W=""),P&&P.charAt(0)!=="#"&&(P="#"+P),G&&G.charAt(0)!=="?"&&(G="?"+G),S=S.replace(/[?#]/g,function(O){return encodeURIComponent(O)}),G=G.replace("#","%23"),M+W+S+G+P};function A(E,M){return y(E,!1,!0).resolve(M)}e.prototype.resolve=function(E){return this.resolveObject(y(E,!1,!0)).format()};function R(E,M){return E?y(E,!1,!0).resolveObject(M):M}return e.prototype.resolveObject=function(E){if(typeof E=="string"){var M=new e;M.parse(E,!1,!0),E=M}for(var S=new e,P=Object.keys(this),W=0;W<P.length;W++){var D=P[W];S[D]=this[D]}if(S.hash=E.hash,E.href==="")return S.href=S.format(),S;if(E.slashes&&!E.protocol){for(var G=Object.keys(E),O=0;O<G.length;O++){var I=G[O];I!=="protocol"&&(S[I]=E[I])}return p[S.protocol]&&S.hostname&&!S.pathname&&(S.pathname="/",S.path=S.pathname),S.href=S.format(),S}if(E.protocol&&E.protocol!==S.protocol){if(!p[E.protocol]){for(var k=Object.keys(E),C=0;C<k.length;C++){var z=k[C];S[z]=E[z]}return S.href=S.format(),S}if(S.protocol=E.protocol,!E.host&&!m[E.protocol]){for(var q=(E.pathname||"").split("/");q.length&&!(E.host=q.shift()););E.host||(E.host=""),E.hostname||(E.hostname=""),q[0]!==""&&q.unshift(""),q.length<2&&q.unshift(""),S.pathname=q.join("/")}else S.pathname=E.pathname;if(S.search=E.search,S.query=E.query,S.host=E.host||"",S.auth=E.auth,S.hostname=E.hostname||E.host,S.port=E.port,S.pathname||S.search){var F=S.pathname||"",Q=S.search||"";S.path=F+Q}return S.slashes=S.slashes||E.slashes,S.href=S.format(),S}var Y=S.pathname&&S.pathname.charAt(0)==="/",N=E.host||E.pathname&&E.pathname.charAt(0)==="/",U=N||Y||S.host&&E.pathname,$=U,V=S.pathname&&S.pathname.split("/")||[],q=E.pathname&&E.pathname.split("/")||[],J=S.protocol&&!p[S.protocol];if(J&&(S.hostname="",S.port=null,S.host&&(V[0]===""?V[0]=S.host:V.unshift(S.host)),S.host="",E.protocol&&(E.hostname=null,E.port=null,E.host&&(q[0]===""?q[0]=E.host:q.unshift(E.host)),E.host=null),U=U&&(q[0]===""||V[0]==="")),N)S.host=E.host||E.host===""?E.host:S.host,S.hostname=E.hostname||E.hostname===""?E.hostname:S.hostname,S.search=E.search,S.query=E.query,V=q;else if(q.length)V||(V=[]),V.pop(),V=V.concat(q),S.search=E.search,S.query=E.query;else if(E.search!=null){if(J){S.host=V.shift(),S.hostname=S.host;var fe=S.host&&S.host.indexOf("@")>0?S.host.split("@"):!1;fe&&(S.auth=fe.shift(),S.hostname=fe.shift(),S.host=S.hostname)}return S.search=E.search,S.query=E.query,(S.pathname!==null||S.search!==null)&&(S.path=(S.pathname?S.pathname:"")+(S.search?S.search:"")),S.href=S.format(),S}if(!V.length)return S.pathname=null,S.search?S.path="/"+S.search:S.path=null,S.href=S.format(),S;for(var Ee=V.slice(-1)[0],ke=(S.host||E.host||V.length>1)&&(Ee==="."||Ee==="..")||Ee==="",xe=0,Ae=V.length;Ae>=0;Ae--)Ee=V[Ae],Ee==="."?V.splice(Ae,1):Ee===".."?(V.splice(Ae,1),xe++):xe&&(V.splice(Ae,1),xe--);if(!U&&!$)for(;xe--;xe)V.unshift("..");U&&V[0]!==""&&(!V[0]||V[0].charAt(0)!=="/")&&V.unshift(""),ke&&V.join("/").substr(-1)!=="/"&&V.push("");var Se=V[0]===""||V[0]&&V[0].charAt(0)==="/";if(J){S.hostname=Se?"":V.length?V.shift():"",S.host=S.hostname;var fe=S.host&&S.host.indexOf("@")>0?S.host.split("@"):!1;fe&&(S.auth=fe.shift(),S.hostname=fe.shift(),S.host=S.hostname)}return U=U||S.host&&V.length,U&&!Se&&V.unshift(""),V.length>0?S.pathname=V.join("/"):(S.pathname=null,S.path=null),(S.pathname!==null||S.search!==null)&&(S.path=(S.pathname?S.pathname:"")+(S.search?S.search:"")),S.auth=E.auth||S.auth,S.slashes=S.slashes||E.slashes,S.href=S.format(),S},e.prototype.parseHost=function(){var E=this.host,M=n.exec(E);M&&(M=M[0],M!==":"&&(this.port=M.substr(1)),E=E.substr(0,E.length-M.length)),E&&(this.hostname=E)},zs.parse=y,zs.resolve=A,zs.resolveObject=R,zs.format=b,zs.Url=e,zs}var M0,oA;function yz(){return oA||(oA=1,M0=typeof URL=="function"?URL:gz().URL),M0}var aA;function Ou(){if(aA)return Dn;aA=1;const t=yz();function e(D,G,O){if(G in D)return D[G];if(arguments.length===3)return O;throw new Error('"'+G+'" is a required argument.')}Dn.getArg=e;const r=(function(){return!("__proto__"in Object.create(null))})();function n(D){return D}function i(D){return o(D)?"$"+D:D}Dn.toSetString=r?n:i;function s(D){return o(D)?D.slice(1):D}Dn.fromSetString=r?n:s;function o(D){if(!D)return!1;const G=D.length;if(G<9||D.charCodeAt(G-1)!==95||D.charCodeAt(G-2)!==95||D.charCodeAt(G-3)!==111||D.charCodeAt(G-4)!==116||D.charCodeAt(G-5)!==111||D.charCodeAt(G-6)!==114||D.charCodeAt(G-7)!==112||D.charCodeAt(G-8)!==95||D.charCodeAt(G-9)!==95)return!1;for(let O=G-10;O>=0;O--)if(D.charCodeAt(O)!==36)return!1;return!0}function a(D,G){return D===G?0:D===null?1:G===null?-1:D>G?1:-1}function c(D,G){let O=D.generatedLine-G.generatedLine;return O!==0||(O=D.generatedColumn-G.generatedColumn,O!==0)||(O=a(D.source,G.source),O!==0)||(O=D.originalLine-G.originalLine,O!==0)||(O=D.originalColumn-G.originalColumn,O!==0)?O:a(D.name,G.name)}Dn.compareByGeneratedPositionsInflated=c;function l(D){return JSON.parse(D.replace(/^\)]}'[^\n]*\n/,""))}Dn.parseSourceMapInput=l;const u="http:",d=`${u}//host`;function f(D){return G=>{const O=y(G),I=p(G),k=new t(G,I);D(k);const C=k.toString();return O==="absolute"?C:O==="scheme-relative"?C.slice(u.length):O==="path-absolute"?C.slice(d.length):b(I,C)}}function h(D,G){return new t(D,G).toString()}function m(D,G){let O=0;do{const I=D+O++;if(G.indexOf(I)===-1)return I}while(!0)}function p(D){const G=D.split("..").length-1,O=m("p",D);let I=`${d}/`;for(let k=0;k<G;k++)I+=`${O}/`;return I}const g=/^[A-Za-z0-9\+\-\.]+:/;function y(D){return D[0]==="/"?D[1]==="/"?"scheme-relative":"path-absolute":g.test(D)?"absolute":"path-relative"}function b(D,G){typeof D=="string"&&(D=new t(D)),typeof G=="string"&&(G=new t(G));const O=G.pathname.split("/"),I=D.pathname.split("/");for(I.length>0&&!I[I.length-1]&&I.pop();O.length>0&&I.length>0&&O[0]===I[0];)O.shift(),I.shift();return I.map(()=>"..").concat(O).join("/")+G.search+G.hash}const A=f(D=>{D.pathname=D.pathname.replace(/\/?$/,"/")}),R=f(D=>{D.href=new t(".",D.toString()).toString()}),E=f(D=>{});Dn.normalize=E;function M(D,G){const O=y(G),I=y(D);if(D=A(D),O==="absolute")return h(G,void 0);if(I==="absolute")return h(G,D);if(O==="scheme-relative")return E(G);if(I==="scheme-relative")return h(G,h(D,d)).slice(u.length);if(O==="path-absolute")return E(G);if(I==="path-absolute")return h(G,h(D,d)).slice(d.length);const k=p(G+D),C=h(G,h(D,k));return b(k,C)}Dn.join=M;function S(D,G){const O=P(D,G);return typeof O=="string"?O:E(G)}Dn.relative=S;function P(D,G){if(y(D)!==y(G))return null;const I=p(D+G),k=new t(D,I),C=new t(G,I);try{new t("",C.toString())}catch{return null}return C.protocol!==k.protocol||C.user!==k.user||C.password!==k.password||C.hostname!==k.hostname||C.port!==k.port?null:b(k,C)}function W(D,G,O){D&&y(G)==="path-absolute"&&(G=G.replace(/^\//,""));let I=E(G||"");return D&&(I=M(D,I)),O&&(I=M(R(O),I)),I}return Dn.computeSourceURL=W,Dn}var U0={},cA;function lA(){if(cA)return U0;cA=1;class t{constructor(){this._array=[],this._set=new Map}static fromArray(r,n){const i=new t;for(let s=0,o=r.length;s<o;s++)i.add(r[s],n);return i}size(){return this._set.size}add(r,n){const i=this.has(r),s=this._array.length;(!i||n)&&this._array.push(r),i||this._set.set(r,s)}has(r){return this._set.has(r)}indexOf(r){const n=this._set.get(r);if(n>=0)return n;throw new Error('"'+r+'" is not in the set.')}at(r){if(r>=0&&r<this._array.length)return this._array[r];throw new Error("No element indexed by "+r)}toArray(){return this._array.slice()}}return U0.ArraySet=t,U0}var $0={},uA;function _z(){if(uA)return $0;uA=1;const t=Ou();function e(n,i){const s=n.generatedLine,o=i.generatedLine,a=n.generatedColumn,c=i.generatedColumn;return o>s||o==s&&c>=a||t.compareByGeneratedPositionsInflated(n,i)<=0}class r{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(i,s){this._array.forEach(i,s)}add(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))}toArray(){return this._sorted||(this._array.sort(t.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}return $0.MappingList=r,$0}var hA;function fA(){if(hA)return Pp;hA=1;const t=nE(),e=Ou(),r=lA().ArraySet,n=_z().MappingList;class i{constructor(o){o||(o={}),this._file=e.getArg(o,"file",null),this._sourceRoot=e.getArg(o,"sourceRoot",null),this._skipValidation=e.getArg(o,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new n,this._sourcesContents=null}static fromSourceMap(o){const a=o.sourceRoot,c=new i({file:o.file,sourceRoot:a});return o.eachMapping(function(l){const u={generated:{line:l.generatedLine,column:l.generatedColumn}};l.source!=null&&(u.source=l.source,a!=null&&(u.source=e.relative(a,u.source)),u.original={line:l.originalLine,column:l.originalColumn},l.name!=null&&(u.name=l.name)),c.addMapping(u)}),o.sources.forEach(function(l){let u=l;a!=null&&(u=e.relative(a,l)),c._sources.has(u)||c._sources.add(u);const d=o.sourceContentFor(l);d!=null&&c.setSourceContent(l,d)}),c}addMapping(o){const a=e.getArg(o,"generated"),c=e.getArg(o,"original",null);let l=e.getArg(o,"source",null),u=e.getArg(o,"name",null);this._skipValidation||this._validateMapping(a,c,l,u),l!=null&&(l=String(l),this._sources.has(l)||this._sources.add(l)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:a.line,generatedColumn:a.column,originalLine:c&&c.line,originalColumn:c&&c.column,source:l,name:u})}setSourceContent(o,a){let c=o;this._sourceRoot!=null&&(c=e.relative(this._sourceRoot,c)),a!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(c)]=a):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(c)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(o,a,c){let l=a;if(a==null){if(o.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);l=o.file}const u=this._sourceRoot;u!=null&&(l=e.relative(u,l));const d=this._mappings.toArray().length>0?new r:this._sources,f=new r;this._mappings.unsortedForEach(function(h){if(h.source===l&&h.originalLine!=null){const g=o.originalPositionFor({line:h.originalLine,column:h.originalColumn});g.source!=null&&(h.source=g.source,c!=null&&(h.source=e.join(c,h.source)),u!=null&&(h.source=e.relative(u,h.source)),h.originalLine=g.line,h.originalColumn=g.column,g.name!=null&&(h.name=g.name))}const m=h.source;m!=null&&!d.has(m)&&d.add(m);const p=h.name;p!=null&&!f.has(p)&&f.add(p)},this),this._sources=d,this._names=f,o.sources.forEach(function(h){const m=o.sourceContentFor(h);m!=null&&(c!=null&&(h=e.join(c,h)),u!=null&&(h=e.relative(u,h)),this.setSourceContent(h,m))},this)}_validateMapping(o,a,c,l){if(a&&typeof a.line!="number"&&typeof a.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(o&&"line"in o&&"column"in o&&o.line>0&&o.column>=0&&!a&&!c&&!l)){if(!(o&&"line"in o&&"column"in o&&a&&"line"in a&&"column"in a&&o.line>0&&o.column>=0&&a.line>0&&a.column>=0&&c))throw new Error("Invalid mapping: "+JSON.stringify({generated:o,source:c,original:a,name:l}))}}_serializeMappings(){let o=0,a=1,c=0,l=0,u=0,d=0,f="",h,m,p,g;const y=this._mappings.toArray();for(let b=0,A=y.length;b<A;b++){if(m=y[b],h="",m.generatedLine!==a)for(o=0;m.generatedLine!==a;)h+=";",a++;else if(b>0){if(!e.compareByGeneratedPositionsInflated(m,y[b-1]))continue;h+=","}h+=t.encode(m.generatedColumn-o),o=m.generatedColumn,m.source!=null&&(g=this._sources.indexOf(m.source),h+=t.encode(g-d),d=g,h+=t.encode(m.originalLine-1-l),l=m.originalLine-1,h+=t.encode(m.originalColumn-c),c=m.originalColumn,m.name!=null&&(p=this._names.indexOf(m.name),h+=t.encode(p-u),u=p)),f+=h}return f}_generateSourcesContent(o,a){return o.map(function(c){if(!this._sourcesContents)return null;a!=null&&(c=e.relative(a,c));const l=e.toSetString(c);return Object.prototype.hasOwnProperty.call(this._sourcesContents,l)?this._sourcesContents[l]:null},this)}toJSON(){const o={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(o.file=this._file),this._sourceRoot!=null&&(o.sourceRoot=this._sourceRoot),this._sourcesContents&&(o.sourcesContent=this._generateSourcesContent(o.sources,o.sourceRoot)),o}toString(){return JSON.stringify(this.toJSON())}}return i.prototype._version=3,Pp.SourceMapGenerator=i,Pp}var oc={},P0={},dA;function bz(){return dA||(dA=1,(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(r,n,i,s,o,a){const c=Math.floor((n-r)/2)+r,l=o(i,s[c],!0);return l===0?c:l>0?n-c>1?e(c,n,i,s,o,a):a===t.LEAST_UPPER_BOUND?n<s.length?n:-1:c:c-r>1?e(r,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:r<0?-1:r}t.search=function(n,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,n,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(P0)),P0}var Iu={exports:{}},pA;function mA(){if(pA)return Iu.exports;pA=1;let t=null;return Iu.exports=function(){if(typeof t=="string")return fetch(t).then(r=>r.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Iu.exports.initialize=e=>{t=e},Iu.exports}var F0,gA;function wz(){if(gA)return F0;gA=1;const t=mA();function e(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let r=null;return F0=function(){if(r)return r;const i=[];return r=t().then(s=>WebAssembly.instantiate(s,{env:{mapping_callback(o,a,c,l,u,d,f,h,m,p){const g=new e;g.generatedLine=o+1,g.generatedColumn=a,c&&(g.lastGeneratedColumn=l-1),u&&(g.source=d,g.originalLine=f+1,g.originalColumn=h,m&&(g.name=p)),i[i.length-1](g)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(s=>({exports:s.instance.exports,withMappingCallback:(o,a)=>{i.push(o);try{a()}finally{i.pop()}}})).then(null,s=>{throw r=null,s}),r},F0}var yA;function kz(){if(yA)return oc;yA=1;const t=Ou(),e=bz(),r=lA().ArraySet;nE();const n=mA(),i=wz(),s=Symbol("smcInternal");class o{constructor(f,h){return f==s?Promise.resolve(this):l(f,h)}static initialize(f){n.initialize(f["lib/mappings.wasm"])}static fromSourceMap(f,h){return u(f,h)}static async with(f,h,m){const p=await new o(f,h);try{return await m(p)}finally{p.destroy()}}eachMapping(f,h,m){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(f){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}o.prototype._version=3,o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,oc.SourceMapConsumer=o;class a extends o{constructor(f,h){return super(s).then(m=>{let p=f;typeof f=="string"&&(p=t.parseSourceMapInput(f));const g=t.getArg(p,"version"),y=t.getArg(p,"sources").map(String),b=t.getArg(p,"names",[]),A=t.getArg(p,"sourceRoot",null),R=t.getArg(p,"sourcesContent",null),E=t.getArg(p,"mappings"),M=t.getArg(p,"file",null),S=t.getArg(p,"x_google_ignoreList",null);if(g!=m._version)throw new Error("Unsupported version: "+g);return m._sourceLookupCache=new Map,m._names=r.fromArray(b.map(String),!0),m._sources=r.fromArray(y,!0),m._absoluteSources=r.fromArray(m._sources.toArray().map(function(P){return t.computeSourceURL(A,P,h)}),!0),m.sourceRoot=A,m.sourcesContent=R,m._mappings=E,m._sourceMapURL=h,m.file=M,m.x_google_ignoreList=S,m._computedColumnSpans=!1,m._mappingsPtr=0,m._wasm=null,i().then(P=>(m._wasm=P,m))})}_findSourceIndex(f){const h=this._sourceLookupCache.get(f);if(typeof h=="number")return h;const m=t.computeSourceURL(null,f,this._sourceMapURL);if(this._absoluteSources.has(m)){const g=this._absoluteSources.indexOf(m);return this._sourceLookupCache.set(f,g),g}const p=t.computeSourceURL(this.sourceRoot,f,this._sourceMapURL);if(this._absoluteSources.has(p)){const g=this._absoluteSources.indexOf(p);return this._sourceLookupCache.set(f,g),g}return-1}static fromSourceMap(f,h){return new a(f.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const f=this._mappings,h=f.length,m=this._wasm.exports.allocate_mappings(h)>>>0,p=new Uint8Array(this._wasm.exports.memory.buffer,m,h);for(let y=0;y<h;y++)p[y]=f.charCodeAt(y);const g=this._wasm.exports.parse_mappings(m);if(!g){const y=this._wasm.exports.get_last_error();let b=`Error parsing mappings (code ${y}): `;switch(y){case 1:b+="the mappings contained a negative line, column, source index, or name index";break;case 2:b+="the mappings contained a number larger than 2**32";break;case 3:b+="reached EOF while in the middle of parsing a VLQ";break;case 4:b+="invalid base 64 character while parsing a VLQ";break;default:b+="unknown error code";break}throw new Error(b)}this._mappingsPtr=g}eachMapping(f,h,m){const p=h||null,g=m||o.GENERATED_ORDER;this._wasm.withMappingCallback(y=>{y.source!==null&&(y.source=this._absoluteSources.at(y.source),y.name!==null&&(y.name=this._names.at(y.name))),this._computedColumnSpans&&y.lastGeneratedColumn===null&&(y.lastGeneratedColumn=1/0),f.call(p,y)},()=>{switch(g){case o.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case o.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(f){let h=t.getArg(f,"source");const m=t.getArg(f,"line"),p=f.column||0;if(h=this._findSourceIndex(h),h<0)return[];if(m<1)throw new Error("Line numbers must be >= 1");if(p<0)throw new Error("Column numbers must be >= 0");const g=[];return this._wasm.withMappingCallback(y=>{let b=y.lastGeneratedColumn;this._computedColumnSpans&&b===null&&(b=1/0),g.push({line:y.generatedLine,column:y.generatedColumn,lastColumn:b})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),h,m-1,"column"in f,p)}),g}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(f){const h={generatedLine:t.getArg(f,"line"),generatedColumn:t.getArg(f,"column")};if(h.generatedLine<1)throw new Error("Line numbers must be >= 1");if(h.generatedColumn<0)throw new Error("Column numbers must be >= 0");let m=t.getArg(f,"bias",o.GREATEST_LOWER_BOUND);m==null&&(m=o.GREATEST_LOWER_BOUND);let p;if(this._wasm.withMappingCallback(g=>p=g,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),h.generatedLine-1,h.generatedColumn,m)}),p&&p.generatedLine===h.generatedLine){let g=t.getArg(p,"source",null);g!==null&&(g=this._absoluteSources.at(g));let y=t.getArg(p,"name",null);return y!==null&&(y=this._names.at(y)),{source:g,line:t.getArg(p,"originalLine",null),column:t.getArg(p,"originalColumn",null),name:y}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(f){return f==null}):!1}sourceContentFor(f,h){if(!this.sourcesContent)return null;const m=this._findSourceIndex(f);if(m>=0)return this.sourcesContent[m];if(h)return null;throw new Error('"'+f+'" is not in the SourceMap.')}generatedPositionFor(f){let h=t.getArg(f,"source");if(h=this._findSourceIndex(h),h<0)return{line:null,column:null,lastColumn:null};const m={source:h,originalLine:t.getArg(f,"line"),originalColumn:t.getArg(f,"column")};if(m.originalLine<1)throw new Error("Line numbers must be >= 1");if(m.originalColumn<0)throw new Error("Column numbers must be >= 0");let p=t.getArg(f,"bias",o.GREATEST_LOWER_BOUND);p==null&&(p=o.GREATEST_LOWER_BOUND);let g;if(this._wasm.withMappingCallback(y=>g=y,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),m.source,m.originalLine-1,m.originalColumn,p)}),g&&g.source===m.source){let y=g.lastGeneratedColumn;return this._computedColumnSpans&&y===null&&(y=1/0),{line:t.getArg(g,"generatedLine",null),column:t.getArg(g,"generatedColumn",null),lastColumn:y}}return{line:null,column:null,lastColumn:null}}}a.prototype.consumer=o,oc.BasicSourceMapConsumer=a;class c extends o{constructor(f,h){return super(s).then(m=>{let p=f;typeof f=="string"&&(p=t.parseSourceMapInput(f));const g=t.getArg(p,"version"),y=t.getArg(p,"sections");if(g!=m._version)throw new Error("Unsupported version: "+g);let b={line:-1,column:0};return Promise.all(y.map(A=>{if(A.url)throw new Error("Support for url field in sections not implemented.");const R=t.getArg(A,"offset"),E=t.getArg(R,"line"),M=t.getArg(R,"column");if(E<b.line||E===b.line&&M<b.column)throw new Error("Section offsets must be ordered and non-overlapping.");return b=R,new o(t.getArg(A,"map"),h).then(P=>({generatedOffset:{generatedLine:E+1,generatedColumn:M+1},consumer:P}))})).then(A=>(m._sections=A,m))})}get sources(){const f=[];for(let h=0;h<this._sections.length;h++)for(let m=0;m<this._sections[h].consumer.sources.length;m++)f.push(this._sections[h].consumer.sources[m]);return f}originalPositionFor(f){const h={generatedLine:t.getArg(f,"line"),generatedColumn:t.getArg(f,"column")},m=e.search(h,this._sections,function(g,y){const b=g.generatedLine-y.generatedOffset.generatedLine;return b||g.generatedColumn-(y.generatedOffset.generatedColumn-1)}),p=this._sections[m];return p?p.consumer.originalPositionFor({line:h.generatedLine-(p.generatedOffset.generatedLine-1),column:h.generatedColumn-(p.generatedOffset.generatedLine===h.generatedLine?p.generatedOffset.generatedColumn-1:0),bias:f.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(f){return f.consumer.hasContentsOfAllSources()})}sourceContentFor(f,h){for(let m=0;m<this._sections.length;m++){const g=this._sections[m].consumer.sourceContentFor(f,!0);if(g)return g}if(h)return null;throw new Error('"'+f+'" is not in the SourceMap.')}_findSectionIndex(f){for(let h=0;h<this._sections.length;h++){const{consumer:m}=this._sections[h];if(m._findSourceIndex(f)!==-1)return h}return-1}generatedPositionFor(f){const h=this._findSectionIndex(t.getArg(f,"source")),m=h>=0?this._sections[h]:null,p=h>=0&&h+1<this._sections.length?this._sections[h+1]:null,g=m&&m.consumer.generatedPositionFor(f);if(g&&g.line!==null){const y=m.generatedOffset.generatedLine-1,b=m.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=b,typeof g.lastColumn=="number"&&(g.lastColumn+=b)),g.lastColumn===1/0&&p&&g.line===p.generatedOffset.generatedLine&&(g.lastColumn=p.generatedOffset.generatedColumn-2),g.line+=y,g}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(f){const h=this._findSectionIndex(t.getArg(f,"source")),m=h>=0?this._sections[h]:null,p=h>=0&&h+1<this._sections.length?this._sections[h+1]:null;return m?m.consumer.allGeneratedPositionsFor(f).map(g=>{const y=m.generatedOffset.generatedLine-1,b=m.generatedOffset.generatedColumn-1;return g.line===1&&(g.column+=b,typeof g.lastColumn=="number"&&(g.lastColumn+=b)),g.lastColumn===1/0&&p&&g.line===p.generatedOffset.generatedLine&&(g.lastColumn=p.generatedOffset.generatedColumn-2),g.line+=y,g}):[]}eachMapping(f,h,m){this._sections.forEach((p,g)=>{const y=g+1<this._sections.length?this._sections[g+1]:null,{generatedOffset:b}=p,A=b.generatedLine-1,R=b.generatedColumn-1;p.consumer.eachMapping(function(E){E.generatedLine===1&&(E.generatedColumn+=R,typeof E.lastGeneratedColumn=="number"&&(E.lastGeneratedColumn+=R)),E.lastGeneratedColumn===1/0&&y&&E.generatedLine===y.generatedOffset.generatedLine&&(E.lastGeneratedColumn=y.generatedOffset.generatedColumn-2),E.generatedLine+=A,f.call(this,E)},h,m)})}computeColumnSpans(){for(let f=0;f<this._sections.length;f++)this._sections[f].consumer.computeColumnSpans()}destroy(){for(let f=0;f<this._sections.length;f++)this._sections[f].consumer.destroy()}}oc.IndexedSourceMapConsumer=c;function l(d,f){let h=d;typeof d=="string"&&(h=t.parseSourceMapInput(d));const m=h.sections!=null?new c(h,f):new a(h,f);return Promise.resolve(m)}function u(d,f){return a.fromSourceMap(d,f)}return oc}var B0={},_A;function vz(){if(_A)return B0;_A=1;const t=fA().SourceMapGenerator,e=Ou(),r=/(\r?\n)/,n=10,i="$$$isSourceNode$$$";class s{constructor(a,c,l,u,d){this.children=[],this.sourceContents={},this.line=a??null,this.column=c??null,this.source=l??null,this.name=d??null,this[i]=!0,u!=null&&this.add(u)}static fromStringWithSourceMap(a,c,l){const u=new s,d=a.split(r);let f=0;const h=function(){const A=E(),R=E()||"";return A+R;function E(){return f<d.length?d[f++]:void 0}};let m=1,p=0,g=null,y;return c.eachMapping(function(A){if(g!==null)if(m<A.generatedLine)b(g,h()),m++,p=0;else{y=d[f]||"";const R=y.substr(0,A.generatedColumn-p);d[f]=y.substr(A.generatedColumn-p),p=A.generatedColumn,b(g,R),g=A;return}for(;m<A.generatedLine;)u.add(h()),m++;p<A.generatedColumn&&(y=d[f]||"",u.add(y.substr(0,A.generatedColumn)),d[f]=y.substr(A.generatedColumn),p=A.generatedColumn),g=A},this),f<d.length&&(g&&b(g,h()),u.add(d.splice(f).join(""))),c.sources.forEach(function(A){const R=c.sourceContentFor(A);R!=null&&(l!=null&&(A=e.join(l,A)),u.setSourceContent(A,R))}),u;function b(A,R){if(A===null||A.source===void 0)u.add(R);else{const E=l?e.join(l,A.source):A.source;u.add(new s(A.originalLine,A.originalColumn,E,R,A.name))}}}add(a){if(Array.isArray(a))a.forEach(function(c){this.add(c)},this);else if(a[i]||typeof a=="string")a&&this.children.push(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}prepend(a){if(Array.isArray(a))for(let c=a.length-1;c>=0;c--)this.prepend(a[c]);else if(a[i]||typeof a=="string")this.children.unshift(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}walk(a){let c;for(let l=0,u=this.children.length;l<u;l++)c=this.children[l],c[i]?c.walk(a):c!==""&&a(c,{source:this.source,line:this.line,column:this.column,name:this.name})}join(a){let c,l;const u=this.children.length;if(u>0){for(c=[],l=0;l<u-1;l++)c.push(this.children[l]),c.push(a);c.push(this.children[l]),this.children=c}return this}replaceRight(a,c){const l=this.children[this.children.length-1];return l[i]?l.replaceRight(a,c):typeof l=="string"?this.children[this.children.length-1]=l.replace(a,c):this.children.push("".replace(a,c)),this}setSourceContent(a,c){this.sourceContents[e.toSetString(a)]=c}walkSourceContents(a){for(let l=0,u=this.children.length;l<u;l++)this.children[l][i]&&this.children[l].walkSourceContents(a);const c=Object.keys(this.sourceContents);for(let l=0,u=c.length;l<u;l++)a(e.fromSetString(c[l]),this.sourceContents[c[l]])}toString(){let a="";return this.walk(function(c){a+=c}),a}toStringWithSourceMap(a){const c={code:"",line:1,column:0},l=new t(a);let u=!1,d=null,f=null,h=null,m=null;return this.walk(function(p,g){c.code+=p,g.source!==null&&g.line!==null&&g.column!==null?((d!==g.source||f!==g.line||h!==g.column||m!==g.name)&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name}),d=g.source,f=g.line,h=g.column,m=g.name,u=!0):u&&(l.addMapping({generated:{line:c.line,column:c.column}}),d=null,u=!1);for(let y=0,b=p.length;y<b;y++)p.charCodeAt(y)===n?(c.line++,c.column=0,y+1===b?(d=null,u=!1):u&&l.addMapping({source:g.source,original:{line:g.line,column:g.column},generated:{line:c.line,column:c.column},name:g.name})):c.column++}),this.walkSourceContents(function(p,g){l.setSourceContent(p,g)}),{code:c.code,map:l}}}return B0.SourceNode=s,B0}var bA;function xz(){return bA||(bA=1,ic.SourceMapGenerator=fA().SourceMapGenerator,ic.SourceMapConsumer=kz().SourceMapConsumer,ic.SourceNode=vz().SourceNode),ic}var Ez=xz();let wA=0;const kA=Qn,Az=["Command","lines"];class Tz extends N${constructor(){super(qv,{traceInitPerf:Qn,skipValidations:!Qn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"}),this.performSelfAnalysis()}PEEK(e,r,...n){console.info(e,n.map(i=>[i.image,i.tokenType]),r)}RULED(e,r,n){const i=Az.some(s=>e.includes(s));return this.RULE(e,()=>{const o=(wA++).toString().padStart(3),a=i?"font-weight: bold;":"";if(kA&&!this.RECORDING_PHASE){const c=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${o}%c> ${e} ${c.join(" ")}`,a)}r(),kA&&!this.RECORDING_PHASE&&console.info(`${o}%c< ${e} `,a),wA--},n)}program=this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))});line=this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(au)}])});stmt=this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])});inline_go=this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))});inline_try=this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))});inline_command=this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))});inline=this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])});stmt_label=this.RULED("stmt_label",()=>{this.CONSUME(qd)});stmt_stat=this.RULED("stmt_stat",()=>{this.CONSUME(Kd)});stmt_text=this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(d1)}])});stmt_comment=this.RULED("stmt_comment",()=>{this.CONSUME(p1)});stmt_hyperlink=this.RULED("stmt_hyperlink",()=>{this.CONSUME(m1),this.CONSUME(g1)});stmt_command=this.RULED("stmt_command",()=>{this.CONSUME(No),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])});structured_cmd=this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])});short_go=this.RULED("short_go",()=>{this.CONSUME(ep),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});short_try=this.RULED("short_try",()=>{this.CONSUME(Mv),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});command_if=this.RULED("command_if",()=>{this.CONSUME(tp),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))});command_if_block=this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(lu),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(au)),this.CONSUME4(No),this.CONSUME4(rp)}}])});command_block=this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(lu),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(No),this.CONSUME(rp)}}])});command_fork=this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(lu),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])});command_else_if=this.RULED("command_else_if",()=>{this.CONSUME(No),this.CONSUME(np),this.CONSUME(tp),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))});command_else=this.RULED("command_else",()=>{this.CONSUME(No),this.CONSUME(np),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))});command_while=this.RULED("command_while",()=>{this.CONSUME(Dv),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_repeat=this.RULED("command_repeat",()=>{this.CONSUME(jv),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_waitfor=this.RULED("command_waitfor",()=>{this.CONSUME(zv),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_foreach=this.RULED("command_foreach",()=>{this.CONSUME(Wv),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_break=this.RULED("command_break",()=>{this.CONSUME(Hv)});command_continue=this.RULED("command_continue",()=>{this.CONSUME(Gv)});command_play=this.RULED("command_play",()=>{this.CONSUME(Pv)});command_toast=this.RULED("command_toast",()=>{this.CONSUME(Fv)});command_ticker=this.RULED("command_ticker",()=>{this.CONSUME(Bv)});expr=this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Vd),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})});and_test=this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Zd),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})});not_test=this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Xd),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])});comparison=this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})});comp_op=this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Ev)},{ALT:()=>this.CONSUME(Av)},{ALT:()=>this.CONSUME(Tv)},{ALT:()=>this.CONSUME(Sv)},{ALT:()=>this.CONSUME(Rv)},{ALT:()=>this.CONSUME(Ov)}])});expr_value=this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Vd),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})});and_test_value=this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(Zd),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})});not_test_value=this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Xd),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])});arith_expr=this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])});arith_expr_item=this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Jd)},{ALT:()=>this.CONSUME(Qd)}]),this.SUBRULE(this.term)});term=this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))});term_item=this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(Nv)},{ALT:()=>this.CONSUME(ep)},{ALT:()=>this.CONSUME(Cv)},{ALT:()=>this.CONSUME(Lv)}]),this.SUBRULE(this.factor)});factor=this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Jd)},{ALT:()=>this.CONSUME(Qd)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])});power=this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(Iv),this.SUBRULE(this.factor)})});words=this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))});kind=this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)});category=this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(y1)},{ALT:()=>this.CONSUME(_1)}])});collision=this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(b1)},{ALT:()=>this.CONSUME(w1)},{ALT:()=>this.CONSUME(k1)},{ALT:()=>this.CONSUME(v1)},{ALT:()=>this.CONSUME(x1)},{ALT:()=>this.CONSUME(E1)},{ALT:()=>this.CONSUME(A1)},{ALT:()=>this.CONSUME(T1)},{ALT:()=>this.CONSUME(S1)}])});color=this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(R1)},{ALT:()=>this.CONSUME(O1)},{ALT:()=>this.CONSUME(I1)},{ALT:()=>this.CONSUME(N1)},{ALT:()=>this.CONSUME(C1)},{ALT:()=>this.CONSUME(L1)},{ALT:()=>this.CONSUME(M1)},{ALT:()=>this.CONSUME(U1)},{ALT:()=>this.CONSUME($1)},{ALT:()=>this.CONSUME(P1)},{ALT:()=>this.CONSUME(F1)},{ALT:()=>this.CONSUME(B1)},{ALT:()=>this.CONSUME(D1)},{ALT:()=>this.CONSUME(j1)},{ALT:()=>this.CONSUME(z1)},{ALT:()=>this.CONSUME(W1)},{ALT:()=>this.CONSUME(H1)},{ALT:()=>this.CONSUME(G1)},{ALT:()=>this.CONSUME(K1)},{ALT:()=>this.CONSUME(q1)},{ALT:()=>this.CONSUME(Y1)},{ALT:()=>this.CONSUME(V1)},{ALT:()=>this.CONSUME(X1)},{ALT:()=>this.CONSUME(Z1)},{ALT:()=>this.CONSUME(J1)},{ALT:()=>this.CONSUME(Q1)},{ALT:()=>this.CONSUME(ek)},{ALT:()=>this.CONSUME(tk)},{ALT:()=>this.CONSUME(rk)},{ALT:()=>this.CONSUME(nk)},{ALT:()=>this.CONSUME(ik)},{ALT:()=>this.CONSUME(sk)},{ALT:()=>this.CONSUME(ok)},{ALT:()=>this.CONSUME(ak)},{ALT:()=>this.CONSUME(ck)},{ALT:()=>this.CONSUME(lk)},{ALT:()=>this.CONSUME(uk)},{ALT:()=>this.CONSUME(hk)},{ALT:()=>this.CONSUME(fk)},{ALT:()=>this.CONSUME(dk)},{ALT:()=>this.CONSUME(pk)},{ALT:()=>this.CONSUME(mk)},{ALT:()=>this.CONSUME(gk)},{ALT:()=>this.CONSUME(yk)},{ALT:()=>this.CONSUME(_k)},{ALT:()=>this.CONSUME(bk)},{ALT:()=>this.CONSUME(wk)}])});dir_mod=this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Lk)},{ALT:()=>this.CONSUME(Mk)},{ALT:()=>this.CONSUME(Uk)},{ALT:()=>this.CONSUME($k)},{ALT:()=>this.CONSUME(tv)},{ALT:()=>this.CONSUME(rv)},{ALT:()=>this.SUBRULE(this.dir_within)},{ALT:()=>this.SUBRULE(this.dir_awayby)}])});dir_by=this.RULED("dir_by",()=>{this.CONSUME(Tk),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_at=this.RULED("dir_at",()=>{this.CONSUME(Sk),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_away=this.RULED("dir_away",()=>{this.CONSUME(Pk),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_toward=this.RULED("dir_toward",()=>{this.CONSUME(Fk),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_find=this.RULED("dir_find",()=>{this.CONSUME(Bk),this.SUBRULE1(this.kind)});dir_flee=this.RULED("dir_flee",()=>{this.CONSUME(Dk),this.SUBRULE1(this.kind)});dir_to=this.RULED("dir_to",()=>{this.CONSUME(jk),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)});dir_within=this.RULED("dir_within",()=>{this.CONSUME(nv),this.SUBRULE1(this.simple_token)});dir_awayby=this.RULED("dir_awayby",()=>{this.CONSUME(iv),this.SUBRULE1(this.simple_token)});dir=this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(kk)},{ALT:()=>this.CONSUME(vk)},{ALT:()=>this.CONSUME(xk)},{ALT:()=>this.CONSUME(Ek)},{ALT:()=>this.CONSUME(Ak)},{ALT:()=>this.SUBRULE(this.dir_by)},{ALT:()=>this.SUBRULE(this.dir_at)},{ALT:()=>this.SUBRULE(this.dir_away)},{ALT:()=>this.SUBRULE(this.dir_toward)},{ALT:()=>this.CONSUME(Rk)},{ALT:()=>this.CONSUME(Ok)},{ALT:()=>this.CONSUME(Ik)},{ALT:()=>this.CONSUME(Nk)},{ALT:()=>this.CONSUME(Ck)},{ALT:()=>this.SUBRULE(this.dir_find)},{ALT:()=>this.SUBRULE(this.dir_flee)},{ALT:()=>this.SUBRULE(this.dir_to)},{ALT:()=>this.CONSUME(zk)},{ALT:()=>this.CONSUME(Wk)},{ALT:()=>this.CONSUME(Hk)},{ALT:()=>this.CONSUME(Gk)},{ALT:()=>this.CONSUME(Kk)},{ALT:()=>this.CONSUME(qk)},{ALT:()=>this.CONSUME(Yk)},{ALT:()=>this.CONSUME(Vk)},{ALT:()=>this.CONSUME(Xk)},{ALT:()=>this.CONSUME(Zk)},{ALT:()=>this.CONSUME(Jk)},{ALT:()=>this.CONSUME(Qk)},{ALT:()=>this.CONSUME(ev)}])});expr_any=this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])});token_expr_any=this.RULED("token_expr_any",()=>{this.CONSUME(cv),this.SUBRULE(this.expr_any)});token_expr_count=this.RULED("token_expr_count",()=>{this.CONSUME(lv),this.SUBRULE(this.expr_any)});token_expr_blocked=this.RULED("token_expr_blocked",()=>{this.CONSUME(av),this.SUBRULE(this.dir)});token_expr_abs=this.RULED("token_expr_abs",()=>{this.CONSUME(uv),this.SUBRULE(this.simple_token)});token_expr_intceil=this.RULED("token_expr_intceil",()=>{this.CONSUME(hv),this.SUBRULE(this.simple_token)});token_expr_intfloor=this.RULED("token_expr_intfloor",()=>{this.CONSUME(fv),this.SUBRULE(this.simple_token)});token_expr_intround=this.RULED("token_expr_intround",()=>{this.CONSUME(dv),this.SUBRULE(this.simple_token)});token_expr_clamp=this.RULED("token_expr_clamp",()=>{this.CONSUME(pv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)});token_expr_min=this.RULED("token_expr_min",()=>{this.CONSUME(mv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_max=this.RULED("token_expr_max",()=>{this.CONSUME(gv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pick=this.RULED("token_expr_pick",()=>{this.CONSUME(yv),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pickwith=this.RULED("token_expr_pickwith",()=>{this.CONSUME(_v),this.SUBRULE1(this.simple_token),this.AT_LEAST_ONE(()=>this.SUBRULE2(this.simple_token))});token_expr_random=this.RULED("token_expr_random",()=>{this.CONSUME(bv),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))});token_expr_randomwith=this.RULED("token_expr_randomwith",()=>{this.CONSUME(wv),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))});token_expr_run=this.RULED("token_expr_run",()=>{this.CONSUME(kv),this.SUBRULE(this.string_token)});token_expr_runwith=this.RULED("token_expr_runwith",()=>{this.CONSUME(vv),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)});token_expr=this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(sv)},{ALT:()=>this.CONSUME(ov)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])});string_token=this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(Ht)},{ALT:()=>this.CONSUME(cu)}])});simple_token=this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(Yd)},{ALT:()=>this.CONSUME(Ht)},{ALT:()=>this.CONSUME(cu)},{ALT:()=>this.SUBRULE(this.color)}])});token=this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(qd)},{ALT:()=>this.CONSUME(cu)},{ALT:()=>this.CONSUME(Ht)},{ALT:()=>this.CONSUME(Yd)},{ALT:()=>this.CONSUME(xv)},{ALT:()=>{this.CONSUME(Uv),this.SUBRULE(this.expr),this.CONSUME($v)}}])})}const zo=new Tz;if(XN){const t=zo.getGAstProductions(),e=W$(t);console.info(e)}const Sz=zo.getBaseCstVisitorConstructor();var Ce=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(Ce||{}),Ws=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(Ws||{}),hi=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(hi||{}),Nu=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(Nu||{});function Gt(t,e){const[r]=t??[];return(r?.image??e).trimStart().replaceAll(/^"|"$/g,"")}class Rz extends Sz{unique=0;constructor(){super(),Qn&&this.validateVisitor()}visit(e){if(ut(e)&&(e=e[0]),!!w(e))return this[e.name](e.children,e.location)}createcodenode(e,r){return[{...r,...e,lineindex:0}]}createstringnode(e,r){return this.createcodenode(e,{type:12,literal:1,value:r})}createtemplatenode(e,r){return this.createcodenode(e,{type:12,literal:2,value:r})}createmarknode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:3,id:r,comment:n}))}creategotonode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:4,id:r,comment:n}))}createlinenode(e,r){return this.createcodenode(e,{type:2,stmts:r})}createapinode(e,r,n){return this.createlinenode(e,this.createcodenode(e,{type:1,words:n,method:r}))}createlogicnode(e,r,n,i){return this.createlinenode(e,this.createcodenode(e,{type:14,skip:n,words:i,method:r}))}createcountnode(e){return this.createcodenode(e,{type:5,index:this.unique++})}createexprnodeondemand(e,r){return e.length===1?e[0]:this.createcodenode(r,{type:31,words:e})[0]}go(e){return Array.isArray(e)?e.map(r=>this.visit(r)).flat():w(e)?[this.visit(e)].flat():[]}program(e,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(e.line)].flat()})}line(e){return e.stmt?this.go(e.stmt):[]}stmt(e){return e.stmt_label?this.go(e.stmt_label):e.stmt_stat?this.go(e.stmt_stat):e.stmt_text?this.go(e.stmt_text):e.stmt_comment?this.go(e.stmt_comment):e.stmt_hyperlink?this.go(e.stmt_hyperlink):e.stmt_command?this.go(e.stmt_command):e.short_go?this.go(e.short_go):e.short_try?this.go(e.short_try):[]}inline_go(e){const r=[];return e.short_go&&r.push(...this.go(e.short_go)),e.inline&&r.push(...this.go(e.inline)),r}inline_try(e){const r=[];return e.short_try&&r.push(...this.go(e.short_try)),e.inline&&r.push(...this.go(e.inline)),r}inline_command(e){const r=[];return e.stmt_command&&r.push(...this.go(e.stmt_command)),e.inline&&r.push(...this.go(e.inline)),r}inline(e){const r=[];return e.stmt_stat&&r.push(...this.go(e.stmt_stat)),e.stmt_text&&r.push(...this.go(e.stmt_text)),e.stmt_comment&&r.push(...this.go(e.stmt_comment)),e.stmt_hyperlink&&r.push(...this.go(e.stmt_hyperlink)),e.inline_go&&r.push(...this.go(e.inline_go)),e.inline_try&&r.push(...this.go(e.inline_try)),e.inline_command&&r.push(...this.go(e.inline_command)),e.structured_cmd&&r.push(...this.go(e.structured_cmd)),r}stmt_label(e,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Gt(e.token_label,":").slice(1).trim()}))}stmt_stat(e,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Gt(e.token_stat,"@").slice(1)}))}stmt_text(e,r){const n=Gt(e.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:n}))}stmt_comment(e,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Gt(e.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(e,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:Gt(e.token_hyperlink,"!").slice(1),text:Gt(e.token_hyperlinktext,";").slice(1)}))}stmt_command(e,r){return e.structured_cmd?this.go(e.structured_cmd):this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(e.words)}))}structured_cmd(e){return e.command_if?this.go(e.command_if):e.command_while?this.go(e.command_while):e.command_repeat?this.go(e.command_repeat):e.command_waitfor?this.go(e.command_waitfor):e.command_foreach?this.go(e.command_foreach):e.command_break?this.go(e.command_break):e.command_continue?this.go(e.command_continue):[]}short_go(e,r){return e.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}short_try(e,r){return e.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}command_if(e,r){const[n]=this.createlogicnode(r,Gt(e.token_if,"if").toLowerCase(),"",this.go(e.words)),[i]=this.go(e.command_if_block)??[];return this.createcodenode(r,{type:13,check:n,block:i})}command_if_block(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:15,skip:n,done:i,lines:[this.go(e.inline),this.go(e.line),this.creategotonode(r,i,"end of if"),this.createmarknode(r,n,"alt logic")].flat(),altlines:[this.go(e.command_else_if),this.go(e.command_else),this.createmarknode(r,i,"end of if")].flat()})}command_block(e){return[this.go(e.inline),this.go(e.line)].flat()}command_fork(e){return[this.go(e.inline),this.go(e.line)].flat()}command_else_if(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:16,done:i,lines:[this.createlogicnode(r,Gt(e.token_if,"if"),n,this.go(e.words)),this.go(e.command_fork),this.creategotonode(r,i,"end of if"),this.createmarknode(r,n,"skip")].flat()})}command_else(e,r){const n=[];return e.words&&n.push(...this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(e.words)}))),e.command_fork&&n.push(...this.go(e.command_fork)),this.createcodenode(r,{type:17,lines:n})}command_while(e,r){const n=Ft(),i=Ft();return this.createcodenode(r,{type:18,loop:n,done:i,lines:[this.createmarknode(r,n,"start of while"),this.createlogicnode(r,"if",i,this.go(e.words)),this.go(e.command_block),this.creategotonode(r,n,"loop of while"),this.createmarknode(r,i,"end of while")].flat()})}command_repeat(e,r){const n=Ft(),i=Ft(),o=[this.createcountnode(r),this.go(e.words)].flat();return this.createcodenode(r,{type:21,loop:n,done:i,lines:[this.createapinode(r,"repeatstart",o),this.createmarknode(r,n,"start of repeat"),this.createlogicnode(r,"repeat",i,o),this.go(e.command_block),this.creategotonode(r,n,"loop of repeat"),this.createmarknode(r,i,"end of repeat")].flat()})}command_foreach(e,r){const n=Ft(),i=Ft(),o=[this.createcountnode(r),this.go(e.words)].flat();return this.createcodenode(r,{type:23,loop:n,done:i,lines:[this.createapinode(r,"foreachstart",o),this.createmarknode(r,n,"start of foreach"),this.createlogicnode(r,"foreach",i,o),this.go(e.command_block),this.creategotonode(r,n,"loop of foreach"),this.createmarknode(r,i,"end of foreach")].flat()})}command_waitfor(e,r){const n=Ft();return this.createcodenode(r,{type:22,loop:n,lines:[this.createmarknode(r,n,"start of waitfor"),this.createlogicnode(r,"waitfor",n,this.go(e.words))].flat()})}command_break(e,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(e,r){return this.createcodenode(r,{type:20,goto:0})}command_play(e,r){const n=Gt(e.token_command_play,"").trim(),[i,...s]=n.split(" ");return[this.createstringnode(r,i),this.createstringnode(r,s.join(" "))].flat()}command_toast(e,r){const i=Gt(e.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(r,"toast"),this.createtemplatenode(r,i)].flat()}command_ticker(e,r){const i=Gt(e.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(r,"ticker"),this.createtemplatenode(r,i)].flat()}expr(e,r){return e.RHS?this.createcodenode(r,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}and_test(e,r){return e.RHS?this.createcodenode(r,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}not_test(e,r){return e.comparison?this.go(e.comparison):e.LHS?this.createcodenode(r,{type:26,items:this.go(e.LHS)}):[]}comparison(e,r){if(e.RHS){const[n]=this.go(e.comp_op);return this.createcodenode(r,{type:27,compare:n,lhs:this.createexprnodeondemand(this.go(e.LHS),r),rhs:this.createexprnodeondemand(this.go(e.RHS),r)})}return this.go(e.LHS)}comp_op(e,r){return e.token_iseq?this.createcodenode(r,{type:28,method:0}):e.token_isnoteq?this.createcodenode(r,{type:28,method:1}):e.token_islessthan?this.createcodenode(r,{type:28,method:2}):e.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):e.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):e.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(e,r){return e.RHS?this.createcodenode(r,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}and_test_value(e,r){return e.RHS?this.createcodenode(r,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),r),this.createexprnodeondemand(this.go(e.RHS),r)]}):this.go(e.LHS)}not_test_value(e,r){return e.arith_expr?this.go(e.arith_expr):e.LHS?this.createcodenode(r,{type:26,items:this.go(e.LHS)}):[]}arith_expr(e,r){if(e.LHS)return this.go(e.LHS);const n=this.go(e.term);return e.RHS?this.createcodenode(r,{type:29,lhs:n[0],items:this.go(e.RHS)}):n}arith_expr_item(e,r){return this.createcodenode(r,{type:30,operator:e.token_plus?1:2,rhs:this.go(e.term)[0]})}term(e,r){return e.term_item?this.createcodenode(r,{type:29,lhs:this.go(e.factor)[0],items:this.go(e.term_item)}):this.go(e.factor)}term_item(e,r){let n=0;return e.token_multiply&&(n=4),e.token_divide&&(n=5),e.token_moddivide&&(n=6),e.token_floordivide&&(n=7),this.createcodenode(r,{type:30,operator:n,rhs:this.go(e.factor)[0]})}factor(e,r){if(e.power)return this.go(e.power);let n=0;return e.token_plus&&(n=8),e.token_minus&&(n=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:n,rhs:this.go(e.LHS)[0]})})}power(e,r){const n=this.go(e.token);return e.factor?this.createcodenode(r,{type:29,lhs:n[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(e.factor)[0]})}):n}words(e){return this.go(e.expr)}kind(e){return[this.go(e.color),this.go(e.string_token)].flat()}category(e,r){return e.token_isterrain?this.createcodenode(r,{type:12,literal:1,value:"isterrain"}):e.token_isobject?this.createcodenode(r,{type:12,literal:1,value:"isobject"}):[]}collision(e,r){return e.token_iswalkable?this.createcodenode(r,{type:12,literal:1,value:"iswalkable"}):e.token_iswalking?this.createcodenode(r,{type:12,literal:1,value:"iswalking"}):e.token_iswalk?this.createcodenode(r,{type:12,literal:1,value:"iswalk"}):e.token_isswimmable?this.createcodenode(r,{type:12,literal:1,value:"isswimmable"}):e.token_isswimming?this.createcodenode(r,{type:12,literal:1,value:"isswimming"}):e.token_isswim?this.createcodenode(r,{type:12,literal:1,value:"isswim"}):e.token_issolid?this.createcodenode(r,{type:12,literal:1,value:"issolid"}):e.token_isbullet?this.createcodenode(r,{type:12,literal:1,value:"isbullet"}):e.token_isghost?this.createcodenode(r,{type:12,literal:1,value:"isghost"}):[]}color(e,r){let n="ERROR";return e.token_black&&(n="black"),e.token_dkblue&&(n="dkblue"),e.token_dkgreen&&(n="dkgreen"),e.token_dkcyan&&(n="dkcyan"),e.token_dkred&&(n="dkred"),e.token_dkpurple&&(n="dkpurple"),e.token_dkyellow&&(n="dkyellow"),e.token_ltgray&&(n="ltgray"),e.token_dkgray&&(n="dkgray"),e.token_blue&&(n="blue"),e.token_green&&(n="green"),e.token_cyan&&(n="cyan"),e.token_red&&(n="red"),e.token_purple&&(n="purple"),e.token_yellow&&(n="yellow"),e.token_white&&(n="white"),e.token_brown&&(n="brown"),e.token_dkwhite&&(n="dkwhite"),e.token_ltgrey&&(n="ltgrey"),e.token_gray&&(n="gray"),e.token_grey&&(n="grey"),e.token_dkgrey&&(n="dkgrey"),e.token_ltblack&&(n="ltblack"),e.token_onblack&&(n="onblack"),e.token_ondkblue&&(n="ondkblue"),e.token_ondkgreen&&(n="ondkgreen"),e.token_ondkcyan&&(n="ondkcyan"),e.token_ondkred&&(n="ondkred"),e.token_ondkpurple&&(n="ondkpurple"),e.token_ondkyellow&&(n="ondkyellow"),e.token_onltgray&&(n="onltgray"),e.token_ondkgray&&(n="ondkgray"),e.token_onblue&&(n="onblue"),e.token_ongreen&&(n="ongreen"),e.token_oncyan&&(n="oncyan"),e.token_onred&&(n="onred"),e.token_onpurple&&(n="onpurple"),e.token_onyellow&&(n="onyellow"),e.token_onwhite&&(n="onwhite"),e.token_onbrown&&(n="onbrown"),e.token_ondkwhite&&(n="ondkwhite"),e.token_onltgrey&&(n="onltgrey"),e.token_ongray&&(n="ongray"),e.token_ongrey&&(n="ongrey"),e.token_ondkgrey&&(n="ondkgrey"),e.token_onltblack&&(n="onltblack"),e.token_onclear&&(n="onclear"),this.createcodenode(r,{type:12,literal:1,value:n})}dir_mod(e,r){if(e.dir_within)return this.go(e.dir_within);if(e.dir_awayby)return this.go(e.dir_awayby);let n="ERROR";return e.token_cw&&(n="cw"),e.token_ccw&&(n="ccw"),e.token_opp&&(n="opp"),e.token_rndp&&(n="rndp"),e.token_over&&(n="over"),e.token_under&&(n="under"),this.createcodenode(r,{type:12,literal:1,value:n})}dir_by(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"by"}),...this.go(e.simple_token)]}dir_at(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"at"}),...this.go(e.simple_token)]}dir_away(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"away"}),...this.go(e.simple_token)]}dir_toward(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"toward"}),...this.go(e.simple_token)]}dir_find(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"find"}),...this.go(e.kind)]}dir_flee(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"flee"}),...this.go(e.kind)]}dir_to(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"to"}),...this.go(e.dir)]}dir_within(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"within"}),...this.go(e.simple_token)]}dir_awayby(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"awayby"}),...this.go(e.simple_token)]}dir(e,r){const n=this.go(e.dir_mod)??[];return e.token_i&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"i"})),e.token_idle&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"idle"})),e.token_n&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"n"})),e.token_u&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"u"})),e.token_north&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"north"})),e.token_up&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"up"})),e.token_s&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"s"})),e.token_d&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"d"})),e.token_south&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"south"})),e.token_down&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"down"})),e.token_w&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"w"})),e.token_l&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"l"})),e.token_west&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"west"})),e.token_left&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"left"})),e.token_e&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"e"})),e.token_r&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"r"})),e.token_east&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"east"})),e.token_right&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"right"})),e.token_rnd&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rnd"})),e.token_rndne&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rndne"})),e.token_rndns&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"rndns"})),e.token_flow&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"flow"})),e.token_seek&&n.push(...this.createcodenode(r,{type:12,literal:1,value:"seek"})),e.dir_by&&n.push(...this.go(e.dir_by)),e.dir_at&&n.push(...this.go(e.dir_at)),e.dir_away&&n.push(...this.go(e.dir_away)),e.dir_toward&&n.push(...this.go(e.dir_toward)),e.dir_find&&n.push(...this.go(e.dir_find)),e.dir_flee&&n.push(...this.go(e.dir_flee)),e.dir_to&&n.push(...this.go(e.dir_to)),n.flat()}expr_any(e){return[this.go(e.dir),this.go(e.kind),this.go(e.color)].flat()}token_expr_any(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"any"}),this.go(e.expr_any)].flat()}token_expr_count(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"countof"}),this.go(e.expr_any)].flat()}token_expr_blocked(e,r){return[this.createcodenode(r,{type:12,literal:1,value:"blocked"}),this.go(e.dir)].flat()}token_expr_abs(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"abs"}),...this.go(e.simple_token)]}token_expr_intceil(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intceil"}),...this.go(e.simple_token)]}token_expr_intfloor(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intfloor"}),...this.go(e.simple_token)]}token_expr_intround(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intround"}),...this.go(e.simple_token)]}token_expr_clamp(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"clamp"}),...this.go(e.simple_token)]}token_expr_min(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"min"}),...this.go(e.simple_token)]}token_expr_max(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"max"}),...this.go(e.simple_token)]}token_expr_pick(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pick"}),...this.go(e.simple_token)]}token_expr_pickwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pickwith"}),...this.go(e.simple_token)]}token_expr_random(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"random"}),...this.go(e.simple_token)]}token_expr_randomwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"randomwith"}),...this.go(e.simple_token)]}token_expr_run(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"run"}),...this.go(e.string_token)]}token_expr_runwith(e,r){return[...this.createcodenode(r,{type:12,literal:1,value:"runwith"}),...this.go(e.simple_token),...this.go(e.string_token)]}token_expr(e,r){return e.token_expr_aligned?this.createcodenode(r,{type:12,literal:1,value:"aligned"}):e.token_contact?this.createcodenode(r,{type:12,literal:1,value:"contact"}):e.token_expr_any?this.go(e.token_expr_any):e.token_expr_count?this.go(e.token_expr_count):e.token_expr_blocked?this.go(e.token_expr_blocked):e.token_expr_abs?this.go(e.token_expr_abs):e.token_expr_intceil?this.go(e.token_expr_intceil):e.token_expr_intfloor?this.go(e.token_expr_intfloor):e.token_expr_intround?this.go(e.token_expr_intround):e.token_expr_clamp?this.go(e.token_expr_clamp):e.token_expr_min?this.go(e.token_expr_min):e.token_expr_max?this.go(e.token_expr_max):e.token_expr_pick?this.go(e.token_expr_pick):e.token_expr_pickwith?this.go(e.token_expr_pickwith):e.token_expr_random?this.go(e.token_expr_random):e.token_expr_randomwith?this.go(e.token_expr_randomwith):e.token_expr_run?this.go(e.token_expr_run):e.token_expr_runwith?this.go(e.token_expr_runwith):[]}string_token(e,r){if(e.token_stringliteraldouble){const n=Gt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Gt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}return[]}simple_token(e,r){if(e.token_stringliteraldouble){const n=Gt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Gt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_numberliteral){const n=parseFloat(Gt(e.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:n})}return e.color?this.go(e.color):[]}token(e,r){if(e.category)return this.go(e.category);if(e.collision)return this.go(e.collision);if(e.color)return this.go(e.color);if(e.dir)return this.go(e.dir);if(e.command_play)return this.go(e.command_play);if(e.command_toast)return this.go(e.command_toast);if(e.command_ticker)return this.go(e.command_ticker);if(e.token_label){const n=Gt(e.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_stringliteraldouble){const n=Gt(e.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:n})}if(e.token_stringliteral){const n=Gt(e.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:n})}if(e.token_numberliteral){const n=parseFloat(Gt(e.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:n})}if(e.token_lparen)return[this.createexprnodeondemand(this.go(e.expr),r)];if(e.token_stop){const n=Gt(e.token_stop,"");return this.createcodenode(r,{type:12,literal:1,value:n})}return[]}}const Oz=new Rz,Vr={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},Cu="zss.js";function ct(t,e){return new Ez.SourceNode(t.startLine??1,t.startColumn??1,Cu,e)}function D0(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Lu(t){return`'${D0(t)}'`}function j0(t){const e=yp(t);return e.errors.length?t:`['${e.tokens.map(n=>{if(n.tokenType===mp){const i=D0(n.image.substring(1));return Fe(i)==="center"?"$CENTER":`', api.get('${i}'), '`}return D0(n.image)}).join("")}'].join('')`}function ac(t){return t.filter(e=>e!==void 0).map(ft)}function vA(t){return ct(t,"")}function Iz(t,e){const r=[];return t.forEach(n=>{r.push(n,e)}),r.pop(),r}function nr(t,e,r){return ct(t,[`api.${e}(`,...Iz(r,", "),")"])}function Nz(t){if(t.type===Ce.COMPARE&&t.compare.type===Ce.COMPARE_ITEM)switch(t.compare.method){case Ws.IS_EQ:return nr(t,"isEq",[ft(t.lhs),ft(t.rhs)]);case Ws.IS_NOT_EQ:return nr(t,"isNotEq",[ft(t.lhs),ft(t.rhs)]);case Ws.IS_LESS_THAN:return nr(t,"isLessThan",[ft(t.lhs),ft(t.rhs)]);case Ws.IS_GREATER_THAN:return nr(t,"isGreaterThan",[ft(t.lhs),ft(t.rhs)]);case Ws.IS_LESS_THAN_OR_EQ:return nr(t,"isLessThanOrEq",[ft(t.lhs),ft(t.rhs)]);case Ws.IS_GREATER_THAN_OR_EQ:return nr(t,"isGreaterThanOrEq",[ft(t.lhs),ft(t.rhs)])}return ct(t,"")}function Hs(t,e,r){return t.prepend(`api.${e}(`),t.add([", ",ft(r),")"])}function xA(t,e,r){return t.prepend(`api.${e}(`),t.add([ft(r),")"])}function Cz(t,e){if(t.type===Ce.OPERATOR_ITEM)switch(t.operator){case hi.PLUS:return Hs(e,"opPlus",t.rhs);case hi.MINUS:return Hs(e,"opMinus",t.rhs);case hi.POWER:return Hs(e,"opPower",t.rhs);case hi.MULTIPLY:return Hs(e,"opMultiply",t.rhs);case hi.DIVIDE:return Hs(e,"opDivide",t.rhs);case hi.MOD_DIVIDE:return Hs(e,"opModDivide",t.rhs);case hi.FLOOR_DIVIDE:return Hs(e,"opFloorDivide",t.rhs);case hi.UNI_PLUS:return xA(e,"opUniPlus",t.rhs);case hi.UNI_MINUS:return xA(e,"opUniMinus",t.rhs)}return ct(t,"")}function Lz(t){if(t.type===Ce.OPERATOR){const e=t.lhs?ft(t.lhs):ct(t,"");return t.items.forEach(r=>Cz(r,e)),e}return ct(t,"")}function Mu(t,e){return ct(t,[nr(t,"jump",[`${e}`]),"; continue;"])}function Mi(t){return Vr.linelookup[t??""]??-1}function z0(t,e){Vr.linelookup[t]=e}function Wo(t,e,r){for(let n=0;n<t.length;++n){const i=t[n];switch(i.type){case Ce.WHILE:case Ce.REPEAT:case Ce.FOREACH:case Ce.ELSE_IF:i.type===e&&(i.done=r);break;case Ce.IF_BLOCK:case Ce.IF_CHECK:i.type===e&&(i.skip=r);break;case Ce.LINE:Wo(i.stmts,e,r);break}}}function EA(t,e,r){for(let n=0;n<t.length;++n){const i=t[n];switch(i.type){case Ce.WHILE:case Ce.REPEAT:case Ce.FOREACH:case Ce.ELSE_IF:i.type===e&&z0(i.done,r);break;case Ce.IF_BLOCK:case Ce.IF_CHECK:i.type===e&&z0(i.skip,r);break;case Ce.LINE:EA(i.stmts,e,r);break}}}function ft(t){switch(t.type){case Ce.PROGRAM:return ct(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(ft).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Cu}`]);case Ce.API:return ct(t,["  ",nr(t,t.method,ac(t.words)),`;
`]);case Ce.LINE:return ct(t,[`case ${t.lineindex}:
`,...t.stmts.map(ft).flat(),`  break;
`]);case Ce.MARK:return ct(t,`  // ${t.comment}
`);case Ce.GOTO:{const e=Mi(t.id);return ct(t,["  ",Mu(t,e),`
`])}case Ce.COUNT:return ct(t,`${t.index}`);case Ce.LITERAL:switch(t.literal){case Nu.NUMBER:return ct(t,`${t.value}`);case Nu.STRING:return ct(t,Lu(t.value));case Nu.TEMPLATE:return ct(t,j0(t.value))}return vA(t);case Ce.TEXT:return ct(t,["  ",nr(t,"text",[j0(t.value)]),`;
`]);case Ce.STAT:if(Vr.isfirststat){Vr.isfirststat=!1;const e=t.value.trim().split(" ").map(Lu);return ct(t,["  ",nr(t,"stat",e),`;
`])}return ct(t,`  // skipped ${t.value}
`);case Ce.LABEL:{const e=Fe(t.name),r=t.active?"label":"comment";Vr.labels[e]||(Vr.labels[e]=[]);const n=(t.active?1:-1)*t.lineindex;return Vr.labels[e].push(n),ct(t,`  // ${n} '${e}' ${r}
`)}case Ce.HYPERLINK:return ct(t,["  ",nr(t,"hyperlink",[j0(t.text),...t.link.split(" ").filter(e=>e.length>0).map(Lu)]),`;
`]);case Ce.MOVE:{const e=nr(t,"command",[Lu("go"),ac(t.words)].flat());return t.wait?ct(t,["  if (",e,`) { continue; };
`]):ct(t,["  ",e,`;
`])}case Ce.COMMAND:return ct(t,["  if (",nr(t,"command",ac(t.words)),`) { continue; };
`]);case Ce.IF:{const e=t.block?.type===Ce.IF_BLOCK?t.block:void 0;if(w(e)){Wo([t.check],Ce.IF_CHECK,e.skip);const r=ct(t,ft(t.check));return e.lines.forEach(n=>r.add(ft(n))),EA(e.altlines,Ce.ELSE_IF,Mi(e.done)),e.altlines.forEach(n=>r.add(ft(n))),r}return ct(t,ft(t.check))}case Ce.IF_CHECK:{const e=Mi(t.skip);return e===-1?ct(t,["  ",nr(t,t.method,ac(t.words)),`;
`]):ct(t,["  if (!",nr(t,t.method,ac(t.words)),") { ",Mu(t,e),` }
`])}case Ce.ELSE_IF:case Ce.ELSE:{const e=ct(t,"");return t.lines.forEach(r=>e.add(ft(r))),e}case Ce.WHILE:{const e=Mi(t.loop),r=Mi(t.done),n=ct(t,"");return Wo(t.lines,Ce.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ce.BREAK:i.goto=r;break;case Ce.CONTINUE:i.goto=e;break}n.add(ft(i))}),n}case Ce.REPEAT:{const e=Mi(t.loop),r=Mi(t.done),n=ct(t,"");return Wo(t.lines,Ce.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ce.BREAK:i.goto=r;break;case Ce.CONTINUE:i.goto=e;break}n.add(ft(i))}),n}case Ce.WAITFOR:{const e=ct(t,"");return Wo(t.lines,Ce.IF_CHECK,t.loop),t.lines.forEach(r=>{e.add(ft(r))}),e}case Ce.FOREACH:{const e=Mi(t.loop),r=Mi(t.done),n=ct(t,"");return Wo(t.lines,Ce.IF_CHECK,t.done),t.lines.forEach(i=>{switch(i.type){case Ce.BREAK:i.goto=r;break;case Ce.CONTINUE:i.goto=e;break}n.add(ft(i))}),n}case Ce.BREAK:return ct(t,["  ",Mu(t,t.goto),`
`]);case Ce.CONTINUE:return ct(t,["  ",Mu(t,t.goto),`
`]);case Ce.OR:return nr(t,"or",t.items.map(ft));case Ce.AND:return nr(t,"and",t.items.map(ft));case Ce.NOT:return nr(t,"not",t.items.map(ft));case Ce.COMPARE:return Nz(t);case Ce.OPERATOR:return Lz(t);case Ce.EXPR:return nr(t,"expr",t.words.map(ft));default:return console.error("<unsupported node>",t.type,t),vA(t)}}function fi(t){if(w(t))switch(t.type===Ce.LINE&&++Vr.lineindex,t.lineindex=Vr.lineindex,t.type){case Ce.PROGRAM:t.lines.forEach(fi);break;case Ce.LINE:t.stmts.forEach(fi);break;case Ce.MARK:z0(t.id,t.lineindex);break;case Ce.IF:fi(t.check),fi(t.block);break;case Ce.IF_BLOCK:t.lines.forEach(fi),t.altlines.forEach(fi);break;case Ce.ELSE_IF:t.lines.forEach(fi);break;case Ce.ELSE:case Ce.WHILE:case Ce.REPEAT:case Ce.FOREACH:case Ce.WAITFOR:t.lines.forEach(fi);break;case Ce.MOVE:case Ce.COMMAND:case Ce.IF_CHECK:t.words.forEach(fi);break}}function Mz(t){Vr.labels={},Vr.internal=1,Vr.lineindex=0,Vr.isfirststat=!0,fi(t)}function Uz(t){return Mz(t),{...ft(t).toStringWithSourceMap({file:`${Cu}.map`}),...Vr}}function AA(t){return ut(t)?t.length>0?1:0:t??0}function $z(t){return`${t}_chip`}function TA(t=""){return`vm:${t??""}`}function Pz(t,e,r){const n=$z(t),i=Xr(n);let s;const o=Sn(Object.entries(r.labels??{}));(!ut(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(r.errors?.length??0)!==0?1:0);function a(l,u){x.words=u;const d=O5(e,l);return w(d)?d(c,u):l!=="send"?a("shortsend",[l,...u]):0}const c={halt(){Jz(n)},id(){return t},set(l,u){const[d,f]=N5(e,c,l,u);if(d)return f},get(l){const[u,d]=I5(e,c,l);if(u)return d},tick(l){const u=Te(i.ps)?i.ps:0,d=u%l===0;if(i.ps=u+1,d===!1)return!1;C5(e,c);const f=c.shouldtick();if(f){i.lc=0,i.ys=0,x.get=c.get;try{s?.(c)||(i.es=1)}catch(h){mt(le,x.elementfocus,"crash",h.message),i.es=1}}return L5(e,c),f},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Te(i.lc)?++i.lc>vs.HALT_AT_COUNT:!0},haslabel(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const[d,f]=i.lb[u];if(d===l)return(f.find(m=>Te(m)&&m>0)??0)>0}return!1},hm(){if(ut(i.mg)&&ut(i.lb)){const[l]=i.mg;if(w(l))for(let u=0;u<i.lb.length;++u){const[d,f]=i.lb[u];if(d===l)return f.find(h=>Te(h)&&h>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.shouldhalt()},send(l,u,d,f){le.emit(l,`${TA(u)}:${d}`,f)},lock(l){i.lk=l},unlock(){i.lk=""},message(l){i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const d=i.lb[u];if(d[0]===l){const f=d[1].findIndex(h=>h>0);if(f>=0&&w(d[1])){d[1][f]*=-1;break}}}},restore(l){if(ut(i.lb))for(let u=0;u<i.lb.length;++u){const d=i.lb[u];if(d[0]===l)for(let f=0;f<d[1].length;f++)d[1][f]=Math.abs(d[1][f])}},getcase(){i.ec=Te(i.ec)?i.ec:1;const l=c.hm();if(l&&ut(i.mg)){const[,u,d,f]=i.mg;c.set("sender",d),w(u)&&c.set("arg",u),f&&(c.set("player",f),x.elementfocus=f),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=Te(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const u=FN.parse(l),[d]=u.filter(f=>f.fileName===Cu);return{line:d?.lineNumber??0,column:d?.columnNumber??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},command(...l){if(l.length===0)return 0;const[u,...d]=l;return a(Fe(Pt(u)),d)},if(...l){const[u,d]=ue(l,0,[Z.ANY]),f=AA(u);return f&&d<l.length&&c.command(...l.slice(d)),f?1:0},try(...l){const[,u]=ue(l,0,[Z.DIR]),d=c.command("go",...l);return d&&u<l.length&&c.command(...l.slice(u)),d?1:0},take(...l){const[u,d,f]=ue(l,0,[Z.NAME,Z.ANY]),h=Te(d),m=h?f:1,p=c.get(u),g=h?d:1;if(!Te(p))return m<l.length&&c.command(...l.slice(m)),1;const y=p-g;return y<0?(m<l.length&&c.command(...l.slice(m)),1):(c.set(u,y),0)},give(...l){const[u,d,f]=ue(l,0,[Z.NAME,Z.ANY]),h=Te(d),m=h?f:1,p=c.get(u),g=h?d:1,y=p===void 0?1:0;return y&&m<l.length&&c.command(...l.slice(m)),c.set(u,ec(p,0)+g),y},duplicate(...l){return c.command("duplicate",...l)},repeatstart(l,...u){const[d,f]=ue(u,0,[Z.NUMBER]),h=`repeatcount${l}`,m=`repeatwords${l}`;i[h]=d,i[m]=f<u.length?u.slice(f):void 0},repeat(l){const u=`repeatcount${l}`,d=`repeatwords${l}`;if(!Te(i[u]))return 0;const f=i[u];i[u]=f-1;const h=f>0,m=i[d];return h&&ut(m)&&c.command(...m),h?1:0},foreachstart(l,...u){const[d,f,h,m]=ue(u,0,[Z.NAME,Z.NUMBER,Z.NUMBER,Z.MAYBE_NUMBER]);let p=Math.min(f,h),g=Math.max(f,h);const y=(m??0)||1;if(y<0){const b=p;p=g,g=b}return c.set(d,p-y),0},foreach(l,...u){const[d,f,h,m,p]=ue(u,0,[Z.NAME,Z.NUMBER,Z.NUMBER,Z.MAYBE_NUMBER]);let g=Math.min(f,h),y=Math.max(f,h);const b=(m??0)||1;if(b<0){const E=g;g=y,y=E}let A=c.get(d);!Te(A)||A<g||A>y?A=g:A+=b;const R=A<=y?1:0;return R&&(c.set(d,A),p<u.length&&c.command(...u.slice(p))),R},waitfor(...l){const[u]=ue(l,0,[Z.ANY]),d=AA(u);return d||c.yield(),d?1:0},or(...l){let u=0;for(let d=0;d<l.length;){const[f,h]=ue(l,d,[Z.ANY]);if(u=f,u)break;d=h}return u},and(...l){let u=0;for(let d=0;d<l.length;){const[f,h]=ue(l,d,[Z.ANY]);if(u=f,!u)break;d=h}return u},not(...l){const[u]=ue(l,0,[Z.ANY]);return u?0:1},expr(...l){const[u]=ue(l,0,[Z.ANY]);return u},isEq(l,u){const[d]=ue([l],0,[Z.ANY]),[f]=ue([u],0,[Z.ANY]);return typeof d=="object"||typeof f=="object"?MS(d,f)?1:0:d===f?1:0},isNotEq(l,u){return this.isEq(l,u)?0:1},isLessThan(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return d<f?1:0},isGreaterThan(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return d>f?1:0},isLessThanOrEq(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return d<=f?1:0},isGreaterThanOrEq(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return d>=f?1:0},opPlus(l,u){const[d]=ue([l],0,[Z.ANY]),[f]=ue([u],0,[Z.ANY]);return d+f},opMinus(l,u){const[d]=ue([l],0,[Z.ANY]),[f]=ue([u],0,[Z.ANY]);return d-f},opPower(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return Math.pow(d,f)},opMultiply(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return d*f},opDivide(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return d/f},opModDivide(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return d%f},opFloorDivide(l,u){const[d]=ue([l],0,[Z.NUMBER]),[f]=ue([u],0,[Z.NUMBER]);return Math.floor(d/f)},opUniPlus(l){const[u]=ue([l],0,[Z.NUMBER]);return+u},opUniMinus(l){const[u]=ue([l],0,[Z.NUMBER]);return-u}};return s=r.code,c}function W0(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(r=>{if(r!=="parent"){const n=t[r];ut(n)?n.forEach(i=>{e.push(W0(i))}):e.push(W0(n))}}),t.range={start:Math.min(...e.filter(r=>r).map(r=>r?.start??0)),end:Math.max(...e.filter(r=>r).map(r=>r?.end??0))},t.range}function Fz(t){const e=Yv(`${t}
`);if(e.errors.length>0)return e;zo.input=e.tokens;const r=zo.program();if(zo.errors.length>0)return{tokens:e.tokens,errors:zo.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[n]=Oz.go(r);return n?(W0(n),{tokens:e.tokens,cst:r,ast:n}):{tokens:e.tokens,cst:r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}function Bz(t,e){const r=`compile-${t}`;console.time(r);const n=Fz(e);if(console.timeEnd(r),g_&&console.info(e,n.errors),n.errors&&n.errors.length>0)return console.info(e,n.tokens,n.errors),n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=Uz(n.ast);if(i.code){g_&&console.info(i.code);try{return{...n,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...n,...i,source:"",code:new Function("api"," ")}}function Dz(){const t={},e={};function r(i,s){const o=t[s];if(o)return o;const a=Bz(i,s);return t[s]=a,a}const n={ids(){return Object.keys(e)},isended(i){const s=e[i];return w(s)?s.isended():!0},halt(i){const s=e[i];return w(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=n.ids();for(let s=0;s<i.length;++s)n.isended(i[s])&&n.halt(i[s])},arg(i,s){const o=e[i];w(o)&&o.set("arg",s)},tick(i,s,o,a,c){let l=e[i];if(!w(e[i])){const u=r(a,c);if(l=e[i]=Pz(i,s,u),u.errors?.length){const[d]=u.errors,f=(d?.line??2)-1,h=c.replaceAll(`\r
`,"").split(`
`).map((A,R)=>[A,R]),m=h.slice(f-2,f);for(let A=0;A<m.length;++A){const[R,E]=m[A];mt(le,vr(),"build",`$grey${E+1} $grey${R}`)}const[p,g]=h[f]??[];if(ye(p)&&w(g)){const A=(d.column??1)-1,R=A+d.length,E=A<p.length?p:`${p}*`,M=E.substring(0,A),S=E.substring(A,R),P=E.substring(R);mt(le,vr(),"build",`$red${g+1} $grey${M}$red${S}$grey${P}`)}const y=h.slice(f+1,f+3);for(let A=0;A<y.length;++A){const[R,E]=y[A];mt(le,vr(),"build",`$grey${E+1} $grey${R}`)}const b=d.message.split(`
`).slice(0,4).join(" ");return mt(le,vr(),"build",b),!1}}return!!l?.tick(o)},once(i,s,o,a){const c=n.tick(i,s,1,o,a);return n.halt(i)&&c},message(i){const{target:s,path:o}=Dr(i.target),a=e[s];if(w(a)){const c={...i,target:o};a.message(c)}}};return n}const Sr=new ba,Mr={},Uu={};function jz(t,e,r,n,i,s=0){const o=`tiles:${t}:${e}`;return w(Mr[o])||(Mr[o]=jN(t,e,r,n,i,s)),Mr[o]}function SA(t,e,r,n){const i=`sprites:${t}:${e}:${r}`,s=`sprite:${t}:${e}:${n}`;return w(Uu[s])||(Uu[s]=zN(t,e,r)),Uu[s].id=i,Uu[s]}function zz(t,e){const r=`sprites:${t}:${e}`;return w(Mr[r])||(Mr[r]=WN(t,e)),Mr[r]}function Wz(t,e,r,n,i=0){const s=`dither:${t}:${e}`;return w(Mr[s])||(Mr[s]=HN(t,e,r,n,i)),Mr[s]}function $u(t,e,r,n){const i=`media:${t}:${e}`;w(Mr[i])||(Mr[i]=GN(t,e,r,n));const s=Mr[i];return s.mime=r,s.media=n,s}function Hz(t,e){const r=`control:${t}:${e}`;return w(Mr[r])||(Mr[r]=KN(t,e)),Mr[r]}const es=3;function RA(t,e){const r=[],n=(t.x+.5)*ws,i=(t.y+.5)*ks,s=e.x*ws,o=e.y*ks,a=s-n,c=o-i;Sr.x=a-es,Sr.y=c-es,r.push(Sr.angle()),Sr.x=a+ws+es,Sr.y=c-es,r.push(Sr.angle()),Sr.x=a-es,Sr.y=c+ks+es,r.push(Sr.angle()),Sr.x=a+ws+es,Sr.y=c+ks+es,r.push(Sr.angle());const l=r.map(h=>Math.round(n_(h))),u=Math.min(...l),d=Math.max(...l);if(d-u>180){const h=l.filter(y=>y<180),m=l.filter(y=>y>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,d]}function Pu(t,e,r,n,i,s,o,a,c){const l={x:a,y:c},u=Ui(t,l);if(u===-1)return;Sr.x=a-i.x,Sr.y=Math.round((c-i.y)*1.333);const d=Sr.length();if(d>s)return;const f=Math.round(n_(Sr.angle()));let h=0;for(let A=0;A<r.length;++A){const[R,E,M]=r[A];R>E?(f>=R||f<=E)&&(h=Math.max(h,M)):f>=R&&f<=E&&(h=Math.max(h,M))}const m=s*.5;e[u]=Math.min(e[u],h+(d<m?0:(d-m)*o)),e[u]=jt(e[u],0,1);const p=pr(t,t.lookup?.[u]??"");if(w(p)){const A=[...RA(i,l),.25];n.push(A)}const g=t.terrain[u],y=En(g),b=g?.collision??y?.collision;if(lc(We.ISBULLET,b)){const A=[...RA(i,l),1];n.push(A)}}function H0(t,e,r,n,i,s){if(!w(r)||!w(r.terrain)||!w(r.objects))return[];const o=[];let a=e;const c=Ue,l=rt,u=s?it.BLACK:it.ONCLEAR,d=jz(t,a++,"terrain",c,l,u);o.push(d);const f=a++,h=zz(t,f);h.sprites=[],o.push(h);const m=r.isdark?1:0,p=Wz(t,a++,c,l,m);o.push(p),p.alphas.fill(m);const g=Hz(t,a++);if(i){o.push(g);const{graphics:M,camera:S,facing:P}=Xr(t),W=r.graphics??M??"",D=r.camera??S??"",G=r.facing??P??"";if(ye(W)){const O=Fe(W);switch(O){case"fpv":case"iso":case"flat":case"mode7":g.graphics=O;break;default:g.graphics="flat";break}}if(ye(D))switch(Fe(D)){default:case"mid":g.viewscale=ul.MID;break;case"near":g.viewscale=ul.NEAR;break;case"far":g.viewscale=ul.FAR;break}Te(G)&&(g.facing=r_(G%360))}for(let M=0;M<r.terrain.length;++M){const S=r.terrain[M],P=rr(S,0,it.WHITE,s?it.BLACK:it.ONCLEAR),W=He(S,"collision");d.char[M]=P.char,d.color[M]=P.color,d.bg[M]=P.bg,d.wall[M]=W===We.ISSOLID?1:0}const y=Object.values(r.objects??{}),b=new Set;for(let M=0;M<y.length;++M){const S=y[M];_r(S.id)&&Te(S.x)&&Te(S.y)&&b.add(rn(S,Ue))}for(let M=0;M<y.length;++M){const S=y[M],P=He(S,"collision");if(w(S.removed)||P===We.ISGHOST)continue;const W=S.id??"";if(_r(W)===!1&&Te(S.x)&&Te(S.y)&&b.has(rn(S,Ue))===!0)continue;const D=rr(S),G=SA(t,f,W,M);if(G.x=S.x??0,G.y=S.y??0,G.char=D.char,G.color=D.color,G.bg=D.bg,h.sprites.push(G),m){if(D.light>0){const O=Ui(r,G),I=jt(Math.round(D.light),1,rt),k=1/(I*.5);if(p.alphas[O]=0,I>1){const C=[];for(let z=1;z<=I;++z){if(z===2){const Y=He(S,"lightdir");if(sn(Y)){const N=qo(r,S,"",Y,G);switch(Ln(G,N.destpt)){case ve.EAST:C.push([45,315,1]);break;case ve.WEST:C.push([225,135,1]);break;case ve.NORTH:C.push([315,225,1]);break;case ve.SOUTH:C.push([135,45,1]);break}}}const F=[];for(let Y=G.y-z;Y<=G.y+z;++Y)Pu(r,p.alphas,C,F,G,I,k,G.x-z,Y),Pu(r,p.alphas,C,F,G,I,k,G.x+z,Y);const Q=z-1;for(let Y=G.x-Q;Y<=G.x+Q;++Y)Pu(r,p.alphas,C,F,G,I,k,Y,G.y-z),Pu(r,p.alphas,C,F,G,I,k,Y,G.y+z);for(let Y=0;Y<F.length;++Y){const N=F[Y];let U=0;for(U=0;U<C.length;++U){const $=C[U];if($[1]>$[0]&&N[1]>=$[0]&&N[0]<=$[1]&&N[2]>=1&&$[2]>=1){C[U]=[Math.min(N[0],$[0]),Math.max(N[1],$[1]),1];break}}U===C.length&&C.push(N)}}}}else if(_r(W)){const O=Ui(r,G);p.alphas[O]=0}}W===t&&(g.focusx=G.x,g.focusy=G.y,g.focusid=W)}for(let M=0;M<y.length;++M){const S=y[M],P=He(S,"collision");if(w(S.removed)||P!==We.ISGHOST)continue;const W=S.id??"",D=rr(S),G=SA(t,f,W,M);G.x=S.x??0,G.y=S.y??0,G.char=D.char,G.color=D.color,G.bg=D.bg,h.sprites.push(G)}for(let M=0;M<y.length;++M){const S=y[M];if(ye(S.tickertext)&&Te(S.tickertime)&&S.tickertext.length){const P=rr(S),W=S.kind!=="player"?`${P.name}:$BLUE `:"",D=`$${it[P.color]}$ON${it[P.bg]}$${P.char}$ONCLEAR$WHITE ${W}${S.tickertext}`;n.push(D)}}o.push($u(t,a++,"text/mood",m?"dark":"bright"));const A=dt(Xe.MAIN),R=Ii(A,Xe.MAIN);if(ye(R.palette)){const M=fr(Re.PALETTE,R.palette),S=St(M);w(S?.bits)&&o.push($u(t,a++,"image/palette",Array.from(S.bits)))}if(ye(R.charset)){const M=fr(Re.CHARSET,R.charset),S=St(M);w(S?.bits)&&o.push($u(t,a++,"image/charset",Array.from(S.bits)))}const E=Object.keys(r.objects).filter(_r);return o.push($u(t,a++,"text/players",E.join(","))),o}const ln=Dz();var Xe=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(Xe||{});const At={halt:!1,session:Ft(),operator:"",software:{main:"",content:""},books:new Map,loaders:new Map};function Gz(){return At.session}function vr(){return At.operator}function Kz(t){At.operator=t}function qz(t){At.halt=t}function Yz(){return At.halt}function un(){return[...At.books.values()]}function Vz(){const[t]=At.books.values();return t}function G0(){const t=un(),e=dt("main"),[r]=t.filter(n=>n.id!==e?.id);return r??e}function jn(t){const e=Fe(t);return At.books.get(t)??un().find(r=>r.name===e)}function OA(t,e){w(jn(e))&&(At.software[t]=e)}function dt(t){return jn(At.software[t])}function IA(t){const e=op([]);return ye(t)&&(e.name=t),Fu(e),Bt(le,At.operator,`created [book] ${e.name}`),e}function Xz(t){let e=jn(t);return w(e)||(e=op([]),e.name=t),Fu(e),Bt(le,At.operator,`created [book] ${e.name}`),e}function hr(t,e){let r=w(e)?Xz(e):dt(t);return w(r)||(w(r)||(r=Vz()),w(r)||(r=IA(e)),w(r)&&Bt(le,At.operator,`opened [book] ${r.name} for ${t}`)),OA(t,r.id),r}function ts(t,e,r){return lp(hr(t),r,e)}function fr(t,e){const r=dt("main"),n=gn(up(r,t,e));if(w(n))return n;const i=un();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==r?.id){const a=gn(up(o,t,e));if(w(a))return a}}}function En(t){if(w(t?.kinddata))return t.kinddata;if(!ye(t?.kind)||!t.kind)return;const e=fr(Re.OBJECT,t.kind);if(w(e))return t.kinddata=St(e),t.kinddata;const r=fr(Re.TERRAIN,t.kind);if(w(r))return t.kinddata=St(r),t.kinddata}function He(t,e){const r=t?.kinddata,n=r?.id??"",i=t?.[e];if(w(i))return i;const s=r?.[e];if(w(s))return s;const o=fr(Re.OBJECT,n)??fr(Re.TERRAIN,n),a=eP(o,e);if(w(a))return a;switch(e){case"group":return"";case"cycle":return og;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return We.ISWALK;default:return}}function K0(t,e){const r={x:t?.x??-1,y:t?.y??-1},n={x:e?.x??-1,y:e?.y??-1},i=Ln(r,n),s=He(e,"pushable");return Te(s)?s!==0:ye(s)?s.trim().split(" ").map(o=>a_(rl(o))).some(o=>o===i):!1}function hn(t,e,r,n){if(!w(t)||!w(e))return;const[i,s]=e,o=fr(Re.OBJECT,i);if(w(o)){const c=Z0(t,r,i,n);if(w(c))return Ra(c,s),En(c),He(c,"collision")!==We.ISGHOST&&(nx(t,c),hp(t,c)),c}const a=fr(Re.TERRAIN,i);if(w(a)){const c=g7(t,r,i);if(w(c)){Ra(c,s),En(c);const l=rn(r,Ue);return hp(t,c,l),c}}}function Zz(t,e,r){if(!w(t)||!w(e))return;const[n,i]=e,s=fr(Re.OBJECT,n);if(w(s)){const o=Z0(t,r,n);return Ra(o,i),o}}function dr(t){const e=fr(Re.BOARD,t);return St(e)}function Xr(t){const e=hr("main");return Ii(e,t)}function NA(t){const e=hr("main");return nP(e,t)}function CA(){const t=hr("main");return Ii(t,"main")}function Jz(t){const e=hr("main");return tx(e,t)}function Qz(t,e){At.books.clear(),t.forEach(n=>{At.books.set(n.id,n),n.name==="main"&&(At.software.main=n.id)});const r=jn(e);if(w(r)&&(At.software.main=r.id),!At.software.main){const n=At.books.values().next();n.value&&(At.software.main=n.value.id)}}function Fu(t){return At.books.set(t.id,t),t.id}function e7(t){const e=jn(t);e&&At.books.delete(e.id)}function LA(t){if(!ye(t)||!t)return mt(le,t,"login",`failed for playerid ==>${t}<==`);const e=dt("main");if(!w(e))return mt(le,t,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${t}<==`);let r=Kt(t);if(w(r?.objects[t]))return!0;if(!w(r)){const l=fr(Re.BOARD,"title");r=St(l)}if(!w(r))return mt(le,t,"login:title","login failed to find board with 'title' stat");const n=fr(Re.OBJECT,"player");if(!w(n))return mt(le,t,"login:player","login failed to find object type 'player'");const i=r.startx??0,s=r.starty??0,o=Te(i)?i:Math.round(Ue*.5),a=Te(s)?s:Math.round(rt*.5),c=Z0(r,{x:o,y:a},"player",t);return w(c?.id)?(c.player=t,gu(e,t,r.id),!0):!1}function t7(t){const e=dt("main");if(!w(e))return;const r=[];for(let i=0;i<e.activelist.length;++i){const s=e.activelist[i];s.startsWith(t)&&r.push(s)}const n=Kt(t);for(let i=0;i<r.length;++i){const s=r[i];gu(e,s,""),du(n,pr(n,s)),KA(n,s),ln.halt(s),tx(e,s)}}function Kt(t){const e=dt("main"),r=rx(e,t,"board"),n=fr(Re.BOARD,r);return St(n)}function r7(t){const e=dt("main"),r=hP(e,t),n=Kt(t),i=pr(n,t);return r&&w(i)}function n7(t){const e=dt("main"),r=Mo(e);for(let n=0;n<r.length;++n){const i=r[n],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;_r(c)&&(gu(e,c,i.id),w(t[c])||(t[c]=0))}}}function MA(t){ln.message(t)}function qt(t,e,r,n){if(ye(r.id))if(ye(e.id))ig(le,t,e.id,r.id,n);else{const i=`${rn({x:e.x??0,y:e.y??0},Ue)}`;ig(le,t,i,r.id,n)}}function i7(t,e,r,n){const i=r.id??"";if(n.x<0){const s=dr(e?.exitwest??"");w(s)&&Lo(t,i,s.id,{x:Ue-1,y:n.y})}else if(n.x>=Ue){const s=dr(e?.exiteast??"");w(s)&&Lo(t,i,s.id,{x:0,y:n.y})}else if(n.y<0){const s=dr(e?.exitnorth??"");w(s)&&Lo(t,i,s.id,{x:n.x,y:rt-1})}else if(n.y>=rt){const s=dr(e?.exitsouth??"");w(s)&&Lo(t,i,s.id,{x:n.x,y:0})}}function zn(t,e,r,n){if(!w(r?.id))return!1;let i=ix(e,r,n);const s=He(r,"collision");if(w(i)&&s!==We.ISBULLET){const o=_r(r?.id),a=!!He(i,"item");if(K0(r,i)&&(!o||!a)){const l=Ln({x:r.x??0,y:r.y??0},n),u=Mt({x:i.x??0,y:i.y??0},l);zn(t,e,i,u)}i=ix(e,r,n)}if(w(i)){const o=_r(r.id),a=_r(r.party??r.id),c=He(r,"collision")===We.ISBULLET,l=r.kind??"";let u="";r.party&&a&&(u=r.party),o&&(u=r.id);const d=_r(i.id),f=_r(i.party??i.id),h=He(i,"collision")===We.ISBULLET,m=i.kind??"",p=a===f;let g="";if(i.party&&f&&(g=i.party),d&&(g=i.id??""),o&&m==="edge")i7(t,e,r,n);else if(o)d?(qt(p?"":g,i,r,"thud"),qt(p?"":u,r,i,"bump")):h?(qt(p?"":g,i,r,p?"partyshot":"shot"),qt(u,r,i,"thud")):(qt(p?"":g,i,r,"thud"),qt(p?"":u,r,i,"touch"));else if(c)if(d)qt(p?"":g,i,r,"thud"),qt(p?"":u,r,i,p?"partyshot":"shot");else if(h)qt(p?"":g,i,r,"thud"),qt(p?"":u,r,i,"thud");else switch(qt(p?"":g,i,r,"thud"),m){case"object":case"scroll":qt(p?"":u,r,i,"shot");break;default:qt(p?"":u,r,i,p?"partyshot":"shot");break}else if(d)qt(p?"":g,i,r,"thud"),qt(p?"":u,r,i,"bump");else if(h){switch(l){case"object":case"scroll":qt(p?"":u,r,i,"shot");break;default:qt(p?"":u,r,i,p?"partyshot":"shot");break}qt(p?"":u,r,i,"thud")}else qt(p?"":g,i,r,"thud"),qt(p?"":u,r,i,"bump");if(c&&He(i,"breakable"))if(w(i?.id)){const y=nt(e,{x:i.x??-1,y:i.y??-1});w(y)&&mr(x.board,y,x.timestamp)}else It(e,{x:n.x,y:n.y});return!1}return!0}function UA(t,e,r,n){if(!w(t)||!w(e)||!w(r))return;const i={...x};x.book=t,x.board=e,x.element=r,x.elementid=r.id??"",x.elementisplayer=_r(x.elementid);const s=x.element.player??At.operator;x.elementfocus=x.elementisplayer?x.elementid:s;const o=He(r,"cycle"),a=r.id??"",c=Fe(r.name??r.kinddata?.name??"");if(ln.tick(a,Qi.RUNTIME,o,c,n),Te(r?.tickertime)&&x.timestamp-r.tickertime>Ec*5&&(r.tickertime=0,r.tickertext=""),x.elementisplayer){const l=Xr(x.elementid);Te(l.inputcurrent)&&(l.inputcurrent=0)}Fr(i).forEach(l=>{x[l]=i[l]})}function s7(t,e){At.loaders.set(t,e)}function $A(t){ln.halt(t)}function o7(){const t=ln.ids();for(let r=0;r<t.length;++r)ln.halt(t[r]);const e=dt("main");w(e)&&(e.flags={})}function a7(t=!1){const e=dt("main");if(!w(e))return;const r=e.timestamp+1,n=vs.HALT_AT_COUNT;vs.HALT_AT_COUNT=n*2,At.loaders.forEach((s,o)=>{const a={...x};x.timestamp=e.timestamp,x.book=e,x.board=void 0,x.element=void 0,x.elementid=o,x.elementisplayer=!1,x.elementfocus=vr();const c=Vj(o);w(c)&&ln.arg(o,c),ln.tick(o,Qi.LOADER,1,"loader",s),ln.isended(o)&&(ln.halt(o),At.loaders.delete(o)),Fr(a).forEach(l=>{x[l]=a[l]})}),vs.HALT_AT_COUNT=n,e.timestamp=r,x.timestamp=r;const i=Mo(e);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)En(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];En(o.objects[u])}const c=cP(o,r);for(let l=0;l<c.length;++l){const{id:u,type:d,code:f,object:h}=c[l];d===Re.ERROR?ln.halt(u):(!t||_r(h?.id??""))&&UA(e,o,h,f)}}}function Ho(t,e,r,n){const i=dt("main");if(!w(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(w(c.id)){const l=`${TA(c.id)}:${e}`;le.emit("",l,r)}}}if(bs(t)){for(let o=0;o<n.length;++o){const a=n[o],c=nt(a,t);w(c)&&s([c])}return}for(let o=0;o<n.length;++o){const a=n[o];switch(Fe(t)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(DA(a,[t]));break}}}}function c7(t){const e=Xr(t),r=e.playbuffer=ye(e.playbuffer)?e.playbuffer:"";r&&PA(t,r,!1)}function PA(t,e,r=!0){const n=hr("main");if(!w(n))return;const i=`${t}_cli`;x.timestamp=n.timestamp,x.book=n,x.board=Kt(t),x.element=pr(x.board,t),x.elementid=x.element?.id??"",x.elementisplayer=!0,x.elementfocus=x.elementid||t;const s=vs.HALT_AT_COUNT;if(vs.HALT_AT_COUNT=s*8,ln.once(i,Qi.CLI,"cli",e),r){const o=Xr(t);o.playbuffer=e}vs.HALT_AT_COUNT=s}function Bu(t){const e=hr("main"),r=Ls(e,t);if(!w(e)||!w(r)||!w(x.element))return;const n={...x},i=`${t}_run`,s=Fe(x.element.name??x.element.kinddata?.name??""),o=r?.code??"";ln.once(i,Qi.RUNTIME,s,o),Fr(n).forEach(a=>{x[a]=n[a]})}function l7(t){const e=dt("main"),r=Kt(t),n=[],i=[],s=[],o=[];if(!w(e)||!w(r))return{board:"",over:n,under:i,layers:s,tickers:o};const a=r.graphics??"flat",c=dr(r.overboard??""),l=dr(r.underboard??"");return i.push(...H0(t,0,l,o,!1,!0)),s.push(...H0(t,i.length,r,o,!0,a!=="flat")),n.push(...H0(t,i.length+s.length,c,o,!1,!1)),{board:r.id,over:n,under:i,layers:s,tickers:o}}function Gs(t){return ut(t)&&typeof t[0]=="string"}function u7(t){const e=x.words[t];return ye(e)?[e,t+1]:[void 0,t]}function q0(t){const e=x.words[t];if(Gs(e))return[e,t+1];const[r,n]=sl(t),[i,s]=u7(n);return ye(i)&&(i==="empty"||En({kind:i}))?[[i,r],s]:[void 0,t]}function cc(t){if(!Gs(t))return;const[e]=t;return e}function Du(t){if(!Gs(t))return;const[,e]=t,r=w(e)?nl(e):void 0;return w(r)?r:void 0}function FA(t){if(!Gs(t))return;const[,e]=t,r=w(e)?il(e):void 0;return w(r)?Uf(r):void 0}function lc(t,e){const r=t??We.ISWALK,n=e??We.ISWALK;if(r===We.ISGHOST||n===We.ISGHOST)return!1;switch(r){case We.ISWALK:return n!==We.ISWALK;case We.ISSWIM:return n!==We.ISSWIM;case We.ISSOLID:return!0;case We.ISBULLET:return n!==We.ISWALK&&n!==We.ISSWIM}}function uc(t,e,r){const n=t?.objects[r];if(w(n))return n;const i=Go(t,"player");return w(e)?(e.x<0&&(e.x=nn(0,Ue-1)),e.y<0&&(e.y=nn(0,rt-1)),jA(e,i)):gn(...i)}function Go(t,e){const r=t?.named?.[e];return w(r)?[...r.values()].map(i=>typeof i=="string"?t?.objects[i]:t?.terrain[i]).filter(w):[]}function h7(t){const e=[];for(let r=0;r<rt;++r)for(let n=0;n<Ue;++n){const i={x:n,y:r},s=nt(t,i);!s?.name&&!s?.kind&&e.push(i)}return e}function Y0(t,e,r,n){if(!w(t))return!1;const i=rr(t);return!(w(e)&&e!==i.name||w(r)&&r!==i.color||w(n)&&n!==i.bg)}function ju(t,e){const r=cc(e),n=Du(e),i=FA(e);return Go(t,r??"").filter(s=>Y0(s,r,n,i))}function BA(t,e){const r=w(e)?nl(e):void 0,n=w(e)?il(e):void 0,i=[];if(w(t)){for(let o=0;o<t.terrain.length;++o){const a=t.terrain[o];w(a)&&Y0(a,void 0,r,n)&&i.push(a)}const s=Object.values(t.objects);for(let o=0;o<s.length;++o){const a=s[o];Y0(a,void 0,r,n)&&i.push(a)}}return i}function DA(t,e){return w(t)?e.map(r=>{if(typeof r=="string"){const n=t.objects[r];if(w(n))return n;const i=Go(t,Fe(r));if(i.length)return i}else if(bs(r)&&r.x>=0&&r.x<Ue&&r.y>=0&&r.y<rt){const n=r.x+r.y*Ue,i=t.lookup?.[n];return w(i)?t.objects[i]:t.terrain[n]}}).flat().filter(w):[]}function jA(t,e){let r=0,n;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(n===void 0||c<r)&&(r=c,n=s)}}return n}function f7(t,e,r,n){if(!w(t))return;w(t.distmaps)||(t.distmaps={});const i=`${e}.${r.x}.${r.y}.${n.x}.${n.y}`;let s=t.distmaps[i];if(!w(s)){s=new Array($f).fill(-2);const o=[{...n}];let a=0;for(;o.length;){const c=o.shift();if(w(c)&&Ko(c)){const l=rn(c,Ue);if(s[l]===-2){const u=rs(t,c.x,c.y);lc(e,He(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}t.distmaps[i]=s}return s}function zA(t,e){return Ko(t)?e[rn(t,Ue)]:-1}function WA(t,e,r,n,i){if(!w(t))return;const s=f7(t,e,r,n);if(!w(s))return;const o=[{x:r.x,y:r.y-1},{x:r.x,y:r.y+1},{x:r.x-1,y:r.y},{x:r.x+1,y:r.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=zA(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=zA(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function d7(){return new Array(Ue*rt).map(()=>{})}function zu(t=Oh){const e={terrain:d7(),objects:{},id:""};return t(e)}var V0=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t[t.camera=12]="camera",t[t.graphics=13]="graphics",t))(V0||{});function p7(t){return xo(t,V0,{terrain:e=>e.map(yl),objects:e=>Object.values(e).filter(r=>!r.removed).map(yl),id:Ot,named:Ot,lookup:Ot,codepage:Ot,distmaps:Ot,overboard:Ot,underboard:Ot})}function m7(t){return Sa(t,V0,{terrain:e=>e.map(_l),objects:e=>{const r={};for(let n=0;n<e.length;++n){const i=_l(e[n]);w(i?.id)&&(r[i.id]=i)}return r}})}function Ko(t){return Sf(t.x,t.y,0,Ue-1,rt-1,0)}function Ui(t,e){return!w(t)||!w(e?.x)||!w(e?.y)||e.x<0||e.x>=Ue||e.y<0||e.y>=rt?-1:e.x+e.y*Ue}function nt(t,e){const r=Ui(t,e);if(r<0||!w(t?.lookup))return;const n=pr(t,t.lookup[r]??"");return w(n)?n:t.terrain[r]}function HA(t,e){const r=pr(t,e);if(w(r))return r;const n=parseFloat(e),i=_N(isNaN(n)?-1:n,Ue);return rs(t,i.x,i.y)}function rs(t,e,r){return(e>=0&&e<Ue)??(r>=0&&r<rt)?t?.terrain[e+r*Ue]:void 0}function It(t,e){if(!w(t)||!w(e)||!w(e.x)||!w(e.y)||e.x<0||e.x>=Ue||e.y<0||e.y>=rt)return;const r=Sn(e),n=e.x+e.y*Ue;return t.terrain[n]=r,delete t.distmaps,t.terrain[n]}function X0(t,e){if(!w(t)||!w(e))return;const r=Sn(e);return r.id=r.id??Ft(),t.objects[r.id]=r,t.objects[r.id]}function g7(t,e,r){return It(t,{...e,kind:r})}function Z0(t,e,r,n){return X0(t,{...e,kind:r,id:n})}function pr(t,e){if(t)return t.objects[e]}function GA(t,e){const r=Ui(t,e);if(r<0||!w(t?.lookup))return;const n=pr(t,t.lookup[r]??"");if(w(n))return n}function mr(t,e,r){return!w(e)||rr(e).name==="player"?!1:(e.id?(e.removed=r,du(t,e)):(It(t,{x:e?.x??0,y:e?.y??0}),sP(t,e)),!0)}function KA(t,e){return w(t?.objects[e])?(delete t.objects[e],!0):!1}function y7(t,e,r){if(!w(t)||!w(e))return;const n=t.objects[r];if(w(n))return n;if(bs(e))return jA(e,Go(t,"player"))}function qo(t,e,r,n,i){const s=ve.MID;if(!w(t)||!w(e))return{dir:n,startpt:i,destpt:i,layer:s,targets:[]};const o={x:e.x??0,y:e.y??0},a={x:o.x+(e.stepx??0),y:o.y+(e.stepy??0)},c=Ln(o,a),l=Ue-1,u=rt-1;for(let d=0;d<n.length;++d){const f=a_(n[d]);switch(f){case ve.IDLE:break;case ve.NORTH:case ve.SOUTH:case ve.WEST:case ve.EAST:Mt(o,f);break;case ve.BY:{const[h,m]=n.slice(d+1);Te(h)&&Te(m)&&(o.x=jt(o.x+h,0,l),o.y=jt(o.y+m,0,u)),d+=2;break}case ve.TO:{const[h,m]=n.slice(d+1);Te(h)&&Te(m)&&(o.x=jt(h,0,l),o.y=jt(m,0,u)),d+=2;break}case ve.AT:{const[h,m]=n.slice(d+1);Te(h)&&Te(m)&&(o.x=jt(h,0,l),o.y=jt(m,0,u)),d+=2;break}case ve.FLOW:Mt(o,c);break;case ve.SEEK:{const h=y7(t,e,r);bs(h)&&Mt(o,Ln(i,h));break}case ve.RNDNS:Mt(o,gn(ve.NORTH,ve.SOUTH));break;case ve.RNDNE:Mt(o,gn(ve.NORTH,ve.EAST));break;case ve.RND:Mt(o,gn(ve.NORTH,ve.SOUTH,ve.WEST,ve.EAST));break;case ve.CW:case ve.CCW:case ve.OPP:case ve.RNDP:{const h=qo(t,e,r,n.slice(d+1),i);switch(o.x=i.x,o.y=i.y,f){case ve.CW:switch(Ln(i,h.destpt)){case ve.NORTH:Mt(o,ve.EAST);break;case ve.SOUTH:Mt(o,ve.WEST);break;case ve.EAST:Mt(o,ve.SOUTH);break;case ve.WEST:Mt(o,ve.NORTH);break}break;case ve.CCW:switch(Ln(i,h.destpt)){case ve.NORTH:Mt(o,ve.WEST);break;case ve.SOUTH:Mt(o,ve.EAST);break;case ve.EAST:Mt(o,ve.NORTH);break;case ve.WEST:Mt(o,ve.SOUTH);break}break;case ve.OPP:switch(Ln(i,h.destpt)){case ve.NORTH:Mt(o,ve.SOUTH);break;case ve.SOUTH:Mt(o,ve.NORTH);break;case ve.EAST:Mt(o,ve.WEST);break;case ve.WEST:Mt(o,ve.EAST);break}break;case ve.RNDP:switch(Ln(i,h.destpt)){case ve.NORTH:case ve.SOUTH:o.x+=gn(-1,1);break;case ve.WEST:case ve.EAST:o.y+=gn(-1,1);break}break}return{dir:n,startpt:i,destpt:o,layer:s,targets:[]}}case ve.FLEE:break;case ve.AWAY:{const[h,m]=n.slice(d+1);if(Te(h)&&Te(m)){const p={x:jt(h,0,l),y:jt(m,0,u)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=He(e,"collision"),A=WA(t,b,o,p,!0);w(A)&&A.x!==h&&A.y!==m&&!GA(t,A)&&(o.x=A.x,o.y=A.y)}else{const b=Lf(-g,-y);Mt(o,b)}}d+=2;break}case ve.FIND:break;case ve.TOWARD:{const[h,m]=n.slice(d+1);if(Te(h)&&Te(m)){const p={x:jt(h,0,l),y:jt(m,0,u)},g=p.x-o.x,y=p.y-o.y;if(Math.abs(g)>1||Math.abs(y)>1){const b=He(e,"collision"),A=WA(t,b,o,p,!1);w(A)&&A.x!==h&&A.y!==m&&!GA(t,A)&&(o.x=A.x,o.y=A.y)}else{const b=Lf(g,y);Mt(o,b)}}d+=2;break}case ve.OVER:case ve.UNDER:{const h=qo(t,e,r,n.slice(d+1),i);return h.layer=f,h}case ve.WITHIN:{const[h]=n.slice(d+1),m=qo(t,e,r,n.slice(d+2),i);if(m.targets.length===0&&Te(h)&&h>0)for(let p=-h;p<=h;++p)for(let g=-h;g<=h;++g){const y={x:m.destpt.x+g,y:m.destpt.y+p};Ko(y)&&m.targets.push(y)}return Te(h)&&h>0?{...m,targets:m.targets.filter(p=>bs(p)?qy(p,m.destpt)<=h:!1)}:m}case ve.AWAYBY:{const[h]=n.slice(d+1),m=qo(t,e,r,n.slice(d+2),i);if(m.targets.length===0)for(let p=-Ue;p<=Ue;++p)for(let g=-Ue;g<=Ue;++g){const y={x:m.destpt.x+g,y:m.destpt.y+p};Ko(y)&&m.targets.push(y)}return Te(h)&&h>0?{...m,targets:m.targets.filter(p=>bs(p)?qy(p,m.destpt)>=h:!1)}:m}}}return{dir:n,startpt:i,destpt:o,layer:s,targets:[]}}const x={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var Z=(t=>(t[t.COLOR=0]="COLOR",t[t.KIND=1]="KIND",t[t.DIR=2]="DIR",t[t.NAME=3]="NAME",t[t.NUMBER=4]="NUMBER",t[t.STRING=5]="STRING",t[t.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",t[t.COLOR_OR_KIND=7]="COLOR_OR_KIND",t[t.MAYBE_KIND=8]="MAYBE_KIND",t[t.MAYBE_NAME=9]="MAYBE_NAME",t[t.MAYBE_NUMBER=10]="MAYBE_NUMBER",t[t.MAYBE_STRING=11]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",t[t.ANY=13]="ANY",t))(Z||{});function gr(t,e,r){throw console.info(r,x.element,x.elementid,x.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function qA(t){const e={x:x.element?.x??0,y:x.element?.y??0};return qo(x.board,x.element,x.elementfocus,t,e)}function ue(t,e,r){const n=x.words;x.words=t;const i=[];let s=e;for(let o=0;o<r.length;++o)switch(r[o]){case 1:{const[a,c]=q0(s);Gs(a)?(s=c,i.push(a)):gr("kind",a,t);break}case 0:{if(va(t[s])===void 0){const[a,c]=Lr(s);Rr(a)?(s=c,i.push(a)):Te(a)?(s=c,i.push(wo(a,void 0))):gr("color",a,t)}else{const[a,c]=sl(s);Rr(a)?(s=c,i.push(a)):gr("color",a,t)}break}case 2:{if(rl(t[s])===void 0){const[a,c]=Lr(s);sn(a)?(s=c,i.push(qA(a))):gr("direction",a,t)}else{const[a,c]=l_(s);sn(a)?(s=c,i.push(qA(a))):gr("direction",a,t)}break}case 3:{const a=x.words[s];ye(a)||gr("string",a,t),++s,i.push(a);break}case 4:{const[a,c]=Lr(s);if(ye(a)){const l=parseFloat(a);Te(l)?i.push(l):gr("number",a,t)}else Te(a)?i.push(a):gr("number",a,t);s=c;break}case 5:{const[a,c]=Lr(s);ye(a)||gr("string",a,t),s=c,i.push(a);break}case 6:{const[a,c]=Lr(s);let l=a;if(ye(l)){const u=parseFloat(l);Te(u)&&(l=u)}else Te(l)||gr("number or string",l,t);s=c,i.push(l);break}case 7:{const[a,c]=q0(s);if(Gs(a))s=c,i.push(a);else if(va(t[s])===void 0){const[l,u]=Lr(s);Rr(l)?(s=u,i.push(l)):gr("color",l,t)}else{const[l,u]=sl(s);Rr(l)?(s=u,i.push(l)):gr("color or kind",l,t)}break}case 8:{const[a,c]=q0(s);a!==void 0&&!Gs(a)&&gr("optional kind",a,t),s=c,i.push(a);break}case 9:{const a=x.words[s];a!==void 0&&!ye(a)&&gr("optional string",a,t),++s,i.push(a);break}case 10:{const[a,c]=Lr(s);if(ye(a)){const l=parseFloat(a);Te(l)?i.push(l):gr("optional number",a,t)}else Te(a)||a===void 0?i.push(a):gr("optional number",a,t);s=c;break}case 11:{const[a,c]=Lr(s);a!==void 0&&!ye(a)&&gr("optional string",a,t),s=c,i.push(a);break}case 12:{const[a,c]=Lr(s);let l=a;if(ye(l)){const u=parseFloat(l);Te(u)&&(l=u)}else l!==void 0&&!Te(l)&&gr("number or string",l,t);s=c,i.push(l);break}case 13:{const[a,c]=Lr(s);s=c,i.push(a);break}}return x.words=n,[...i,s]}const Wu={},Yo={};function J0(){return{id:Ft(),board:"",layers:[],scroll:[],sidebar:[]}}const _7=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),b7=new Set(["tx","text"]),w7={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},YA={};let VA=t=>{let e=YA[t];return w(e)||(YA[t]=e=J0()),e};function k7(t){VA=t}function Rt(t){return VA(t)}function Q0(t){return w(Wu[t])||(Wu[t]=[]),Wu[t]}function v7(t){const e=Rt(t);e.scrollname="",e.scroll=[]}function x7(t,e,r){Object.values(Yo).forEach(n=>{if(n[e]!==void 0){const i=m_(t.id(),e);Te(r)&&mN(i,r),ye(r)&&gN(i,r)}})}function ir(t){const e=Q0(t);return Wu[t]=[],e}function XA(t){const e=[];let r;for(let n=0;n<t.length;++n){const i=t[n],s=ye(i)&&w(wP(i));w(r)&&r!==s&&e.push(" "),e.push(i),r=s}return e}function Ie(t,e){Q0(t).push(e)}function Be(t,e,r,n,i=()=>0,s=Oh){const o=[e,r,...n],a=Fe(`${o[3]}`),c={...x};function l(u,d){w(d)&&d!==i(u)&&(x.board=c.board,x.element=c.element,x.elementfocus=c.elementfocus,s(u,d))}if(_7.has(a)){const u=`${o[2]}`;Yo[e]=Yo[e]??{};const d=i(u)??w7[a];if(Yo[e][u]===void 0){const f=m_(e,u);Te(d)&&pN(f,d),ye(d)&&Tf(f,d),b7.has(a)?Yo[e][u]=Wy(f,h=>{l(u,h)}):Yo[e][u]=yN(f,h=>{l(u,h)})}}Q0(t).push(o)}k7(t=>{if(_r(t)){const e=dt(Xe.MAIN),r=Ii(e,Xe.GADGETSTORE);let n=r[t];return w(n)||(r[t]=n=J0()),n}return J0()});const em=Js("gadgetserver",["tock"],t=>{if(!em.session(t))return;const e=dt(Xe.MAIN),r=[...e?.activelist??[],vr()],n=[...new Set(r.values())],i=Ii(e,Xe.GADGETSYNC);switch(t.target){case"tock":{for(let s=0;s<n.length;++s){const o=n[s],{board:a,over:c,under:l,layers:u,tickers:d}=l7(o),f=Rt(o);f.board=a,f.over=c,f.under=l,f.layers=u,f.tickers=d;const h=i[o]??{},m=Zm(h,f);m.length&&(i[o]=Sn(f),YS(em,o,m))}break}case"desync":qS(em,t.player,Rt(t.player));break;case"clearscroll":v7(t.player);break;case"clearplayer":{const s=Ii(e,Xe.GADGETSTORE);delete s[t.player];const o=Ii(e,Xe.GADGETSYNC);delete o[t.player];break}}});async function E7(t){const e=nn(1111111,9999999),r=Fe(t.replace(/[^a-zA-Z/]/g,""));return await(await fetch(`https://raw.githubusercontent.com/wiki/goldbuick/zed-software-system/${r}.md?q=${e}`)).text()}function Hu(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var tm={exports:{}},ZA;function A7(){return ZA||(ZA=1,(function(t,e){(function(r){t.exports=r()})(function(){return(function r(n,i,s){function o(l,u){if(!i[l]){if(!n[l]){var d=typeof Hu=="function"&&Hu;if(!u&&d)return d(l,!0);if(a)return a(l,!0);var f=new Error("Cannot find module '"+l+"'");throw f.code="MODULE_NOT_FOUND",f}var h=i[l]={exports:{}};n[l][0].call(h.exports,function(m){var p=n[l][1][m];return o(p||m)},h,h.exports,r,n,i,s)}return i[l].exports}for(var a=typeof Hu=="function"&&Hu,c=0;c<s.length;c++)o(s[c]);return o})({1:[function(r,n,i){var s=r("./utils"),o=r("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,d,f,h,m,p,g=[],y=0,b=c.length,A=b,R=s.getTypeOf(c)!=="string";y<c.length;)A=b-y,d=R?(l=c[y++],u=y<b?c[y++]:0,y<b?c[y++]:0):(l=c.charCodeAt(y++),u=y<b?c.charCodeAt(y++):0,y<b?c.charCodeAt(y++):0),f=l>>2,h=(3&l)<<4|u>>4,m=1<A?(15&u)<<2|d>>6:64,p=2<A?63&d:64,g.push(a.charAt(f)+a.charAt(h)+a.charAt(m)+a.charAt(p));return g.join("")},i.decode=function(c){var l,u,d,f,h,m,p=0,g=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,A=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&A--,c.charAt(c.length-2)===a.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|A):new Array(0|A);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(f=a.indexOf(c.charAt(p++)))>>4,u=(15&f)<<4|(h=a.indexOf(c.charAt(p++)))>>2,d=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),b[g++]=l,h!==64&&(b[g++]=u),m!==64&&(b[g++]=d);return b}},{"./support":30,"./utils":32}],2:[function(r,n,i){var s=r("./external"),o=r("./stream/DataWorker"),a=r("./stream/Crc32Probe"),c=r("./stream/DataLengthProbe");function l(u,d,f,h,m){this.compressedSize=u,this.uncompressedSize=d,this.crc32=f,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),d=this;return u.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,d,f){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",d)},n.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,n,i){var s=r("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,n,i){var s=r("./utils"),o=(function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c})();n.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(l,u,d,f){var h=o,m=f+d;l^=-1;for(var p=f;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l})(0|c,a,a.length,0):(function(l,u,d,f){var h=o,m=f+d;l^=-1;for(var p=f;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l})(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(r,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(r,n,i){var s=null;s=typeof Promise<"u"?Promise:r("lie"),n.exports={Promise:s}},{lie:37}],7:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),a=r("./utils"),c=r("./stream/GenericWorker"),l=s?"uint8array":"array";function u(d,f){c.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,d.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},i.compressWorker=function(d){return new u("Deflate",d)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,n,i){function s(h,m){var p,g="";for(p=0;p<m;p++)g+=String.fromCharCode(255&h),h>>>=8;return g}function o(h,m,p,g,y,b){var A,R,E=h.file,M=h.compression,S=b!==l.utf8encode,P=a.transformTo("string",b(E.name)),W=a.transformTo("string",l.utf8encode(E.name)),D=E.comment,G=a.transformTo("string",b(D)),O=a.transformTo("string",l.utf8encode(D)),I=W.length!==E.name.length,k=O.length!==D.length,C="",z="",F="",Q=E.dir,Y=E.date,N={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(N.crc32=h.crc32,N.compressedSize=h.compressedSize,N.uncompressedSize=h.uncompressedSize);var U=0;m&&(U|=8),S||!I&&!k||(U|=2048);var $=0,V=0;Q&&($|=16),y==="UNIX"?(V=798,$|=(function(J,fe){var Ee=J;return J||(Ee=fe?16893:33204),(65535&Ee)<<16})(E.unixPermissions,Q)):(V=20,$|=(function(J){return 63&(J||0)})(E.dosPermissions)),A=Y.getUTCHours(),A<<=6,A|=Y.getUTCMinutes(),A<<=5,A|=Y.getUTCSeconds()/2,R=Y.getUTCFullYear()-1980,R<<=4,R|=Y.getUTCMonth()+1,R<<=5,R|=Y.getUTCDate(),I&&(z=s(1,1)+s(u(P),4)+W,C+="up"+s(z.length,2)+z),k&&(F=s(1,1)+s(u(G),4)+O,C+="uc"+s(F.length,2)+F);var q="";return q+=`
\0`,q+=s(U,2),q+=M.magic,q+=s(A,2),q+=s(R,2),q+=s(N.crc32,4),q+=s(N.compressedSize,4),q+=s(N.uncompressedSize,4),q+=s(P.length,2),q+=s(C.length,2),{fileRecord:d.LOCAL_FILE_HEADER+q+P+C,dirRecord:d.CENTRAL_FILE_HEADER+s(V,2)+q+s(G.length,2)+"\0\0\0\0"+s($,4)+s(g,4)+P+C+G}}var a=r("../utils"),c=r("../stream/GenericWorker"),l=r("../utf8"),u=r("../crc32"),d=r("../signature");function f(h,m,p,g){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=g,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-g-1))/p:100}}))},f.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:(function(g){return d.DATA_DESCRIPTOR+s(g.crc32,4)+s(g.compressedSize,4)+s(g.uncompressedSize,4)})(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,g=(function(y,b,A,R,E){var M=a.transformTo("string",E(R));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(b,4)+s(A,4)+s(M.length,2)+M})(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},n.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,n,i){var s=r("../compressions"),o=r("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),d=0;try{a.forEach(function(f,h){d++;var m=(function(b,A){var R=b||A,E=s[R];if(!E)throw new Error(R+" is not a valid compression method !");return E})(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},g=h.dir,y=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:f,dir:g,date:y,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=d}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,n,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=r("./object")).loadAsync=r("./load"),s.support=r("./support"),s.defaults=r("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=r("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,n,i){var s=r("./utils"),o=r("./external"),a=r("./utf8"),c=r("./zipEntries"),l=r("./stream/Crc32Probe"),u=r("./nodejsUtils");function d(f){return new o.Promise(function(h,m){var p=f.decompressed.getContentWorker().pipe(new l);p.on("error",function(g){m(g)}).on("end",function(){p.streamInfo.crc32!==f.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}n.exports=function(f,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,h.optimizedBinaryString,h.base64).then(function(p){var g=new c(h);return g.load(p),g}).then(function(p){var g=[o.Promise.resolve(p)],y=p.files;if(h.checkCRC32)for(var b=0;b<y.length;b++)g.push(d(y[b]));return o.Promise.all(g)}).then(function(p){for(var g=p.shift(),y=g.files,b=0;b<y.length;b++){var A=y[b],R=A.fileNameStr,E=s.resolve(A.fileNameStr);m.file(E,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:h.createFolders}),A.dir||(m.file(E).unsafeOriginalName=R)}return g.zipComment.length&&(m.comment=g.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,n,i){var s=r("../utils"),o=r("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,n,i){var s=r("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(d,f){u.push(d)||u._helper.pause(),l&&l(f)}).on("error",function(d){u.emit("error",d)}).on("end",function(){u.push(null)})}r("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,n,i){n.exports={isNode:typeof Zt<"u",newBufferFrom:function(s,o){if(Zt.from&&Zt.from!==Uint8Array.from)return Zt.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Zt(s,o)},allocBuffer:function(s){if(Zt.alloc)return Zt.alloc(s);var o=new Zt(s);return o.fill(0),o},isBuffer:function(s){return Zt.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(r,n,i){function s(E,M,S){var P,W=a.getTypeOf(M),D=a.extend(S||{},u);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(E=y(E)),D.createFolders&&(P=g(E))&&b.call(this,P,!0);var G=W==="string"&&D.binary===!1&&D.base64===!1;S&&S.binary!==void 0||(D.binary=!G),(M instanceof d&&M.uncompressedSize===0||D.dir||!M||M.length===0)&&(D.base64=!1,D.binary=!0,M="",D.compression="STORE",W="string");var O=null;O=M instanceof d||M instanceof c?M:m.isNode&&m.isStream(M)?new p(E,M):a.prepareContent(E,M,D.binary,D.optimizedBinaryString,D.base64);var I=new f(E,O,D);this.files[E]=I}var o=r("./utf8"),a=r("./utils"),c=r("./stream/GenericWorker"),l=r("./stream/StreamHelper"),u=r("./defaults"),d=r("./compressedObject"),f=r("./zipObject"),h=r("./generate"),m=r("./nodejsUtils"),p=r("./nodejs/NodejsStreamInputAdapter"),g=function(E){E.slice(-1)==="/"&&(E=E.substring(0,E.length-1));var M=E.lastIndexOf("/");return 0<M?E.substring(0,M):""},y=function(E){return E.slice(-1)!=="/"&&(E+="/"),E},b=function(E,M){return M=M!==void 0?M:u.createFolders,E=y(E),this.files[E]||s.call(this,E,null,{dir:!0,createFolders:M}),this.files[E]};function A(E){return Object.prototype.toString.call(E)==="[object RegExp]"}var R={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(E){var M,S,P;for(M in this.files)P=this.files[M],(S=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&E(S,P)},filter:function(E){var M=[];return this.forEach(function(S,P){E(S,P)&&M.push(P)}),M},file:function(E,M,S){if(arguments.length!==1)return E=this.root+E,s.call(this,E,M,S),this;if(A(E)){var P=E;return this.filter(function(D,G){return!G.dir&&P.test(D)})}var W=this.files[this.root+E];return W&&!W.dir?W:null},folder:function(E){if(!E)return this;if(A(E))return this.filter(function(W,D){return D.dir&&E.test(W)});var M=this.root+E,S=b.call(this,M),P=this.clone();return P.root=S.name,P},remove:function(E){E=this.root+E;var M=this.files[E];if(M||(E.slice(-1)!=="/"&&(E+="/"),M=this.files[E]),M&&!M.dir)delete this.files[E];else for(var S=this.filter(function(W,D){return D.name.slice(0,E.length)===E}),P=0;P<S.length;P++)delete this.files[S[P].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(E){var M,S={};try{if((S=a.extend(E||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");a.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var P=S.comment||this.comment||"";M=h.generateWorker(this,S,P)}catch(W){(M=new c("error")).error(W)}return new l(M,S.type||"string",S.mimeType)},generateAsync:function(E,M){return this.generateInternalStream(E).accumulate(M)},generateNodeStream:function(E,M){return(E=E||{}).type||(E.type="nodebuffer"),this.generateInternalStream(E).toNodejsStream(M)}};n.exports=R},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,n,i){n.exports=r("stream")},{stream:void 0}],17:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),d=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===l&&this.data[f+2]===u&&this.data[f+3]===d)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),d=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&l===f[1]&&u===f[2]&&d===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,n,i){var s=r("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(r,n,i){var s=r("./Uint8ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,n,i){var s=r("./DataReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,n,i){var s=r("./ArrayReader");function o(a){s.call(this,a)}r("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,n,i){var s=r("../utils"),o=r("../support"),a=r("./ArrayReader"),c=r("./StringReader"),l=r("./NodeBufferReader"),u=r("./Uint8ArrayReader");n.exports=function(d){var f=s.getTypeOf(d);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new l(d):o.uint8array?new u(s.transformTo("uint8array",d)):new a(s.transformTo("array",d)):new c(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,n,i){var s=r("./GenericWorker"),o=r("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(r,n,i){var s=r("./GenericWorker"),o=r("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(r,n,i){var s=r("../utils"),o=r("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(r,n,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=s},{}],29:[function(r,n,i){var s=r("../utils"),o=r("./ConvertWorker"),a=r("./GenericWorker"),c=r("../base64"),l=r("../support"),u=r("../external"),d=null;if(l.nodestream)try{d=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(m,p){return new u.Promise(function(g,y){var b=[],A=m._internalType,R=m._outputType,E=m._mimeType;m.on("data",function(M,S){b.push(M),p&&p(S)}).on("error",function(M){b=[],y(M)}).on("end",function(){try{var M=(function(S,P,W){switch(S){case"blob":return s.newBlob(s.transformTo("arraybuffer",P),W);case"base64":return c.encode(P);default:return s.transformTo(S,P)}})(R,(function(S,P){var W,D=0,G=null,O=0;for(W=0;W<P.length;W++)O+=P[W].length;switch(S){case"string":return P.join("");case"array":return Array.prototype.concat.apply([],P);case"uint8array":for(G=new Uint8Array(O),W=0;W<P.length;W++)G.set(P[W],D),D+=P[W].length;return G;case"nodebuffer":return Zt.concat(P);default:throw new Error("concat : unsupported type '"+S+"'")}})(A,b),E);g(M)}catch(S){y(S)}b=[]}).resume()})}function h(m,p,g){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=g,s.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}h.prototype={accumulate:function(m){return f(this,m)},on:function(m,p){var g=this;return m==="data"?this._worker.on(m,function(y){p.call(g,y.data,y.meta)}):this._worker.on(m,function(){s.delay(p,arguments,g)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Zt<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!r("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(r,n,i){for(var s=r("./utils"),o=r("./support"),a=r("./nodejsUtils"),c=r("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function d(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):(function(m){var p,g,y,b,A,R=m.length,E=0;for(b=0;b<R;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<R&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),E+=g<128?1:g<2048?2:g<65536?3:4;for(p=o.uint8array?new Uint8Array(E):new Array(E),b=A=0;A<E;b++)(64512&(g=m.charCodeAt(b)))==55296&&b+1<R&&(64512&(y=m.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),g<128?p[A++]=g:(g<2048?p[A++]=192|g>>>6:(g<65536?p[A++]=224|g>>>12:(p[A++]=240|g>>>18,p[A++]=128|g>>>12&63),p[A++]=128|g>>>6&63),p[A++]=128|63&g);return p})(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):(function(m){var p,g,y,b,A=m.length,R=new Array(2*A);for(p=g=0;p<A;)if((y=m[p++])<128)R[g++]=y;else if(4<(b=l[y]))R[g++]=65533,p+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&p<A;)y=y<<6|63&m[p++],b--;1<b?R[g++]=65533:y<65536?R[g++]=y:(y-=65536,R[g++]=55296|y>>10&1023,R[g++]=56320|1023&y)}return R.length!==g&&(R.subarray?R=R.subarray(0,g):R.length=g),s.applyFromCharCode(R)})(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(d,c),d.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var g=(function(b,A){var R;for((A=A||b.length)>b.length&&(A=b.length),R=A-1;0<=R&&(192&b[R])==128;)R--;return R<0||R===0?A:R+l[b[R]]>A?R:A})(m),y=m;g!==m.length&&(o.uint8array?(y=m.subarray(0,g),this.leftOver=m.subarray(g,m.length)):(y=m.slice(0,g),this.leftOver=m.slice(g,m.length))),this.push({data:i.utf8decode(y),meta:h.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,s.inherits(f,c),f.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,n,i){var s=r("./support"),o=r("./base64"),a=r("./nodejsUtils"),c=r("./external");function l(p){return p}function u(p,g){for(var y=0;y<p.length;++y)g[y]=255&p.charCodeAt(y);return g}r("setimmediate"),i.newBlob=function(p,g){i.checkSupport("blob");try{return new Blob([p],{type:g})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(p,g,y){var b=[],A=0,R=p.length;if(R<=y)return String.fromCharCode.apply(null,p);for(;A<R;)g==="array"||g==="nodebuffer"?b.push(String.fromCharCode.apply(null,p.slice(A,Math.min(A+y,R)))):b.push(String.fromCharCode.apply(null,p.subarray(A,Math.min(A+y,R)))),A+=y;return b.join("")},stringifyByChar:function(p){for(var g="",y=0;y<p.length;y++)g+=String.fromCharCode(p[y]);return g},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function f(p){var g=65536,y=i.getTypeOf(p),b=!0;if(y==="uint8array"?b=d.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=d.applyCanBeUsed.nodebuffer),b)for(;1<g;)try{return d.stringifyByChunk(p,y,g)}catch{g=Math.floor(g/2)}return d.stringifyByChar(p)}function h(p,g){for(var y=0;y<p.length;y++)g[y]=p[y];return g}i.applyFromCharCode=f;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:f,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return f(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:f,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:f,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,g){if(g=g||"",!p)return g;i.checkSupport(p);var y=i.getTypeOf(g);return m[y][p](g)},i.resolve=function(p){for(var g=p.split("/"),y=[],b=0;b<g.length;b++){var A=g[b];A==="."||A===""&&b!==0&&b!==g.length-1||(A===".."?y.pop():y.push(A))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var g,y,b="";for(y=0;y<(p||"").length;y++)b+="\\x"+((g=p.charCodeAt(y))<16?"0":"")+g.toString(16).toUpperCase();return b},i.delay=function(p,g,y){setImmediate(function(){p.apply(y||null,g||[])})},i.inherits=function(p,g){function y(){}y.prototype=g.prototype,p.prototype=new y},i.extend=function(){var p,g,y={};for(p=0;p<arguments.length;p++)for(g in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],g)&&y[g]===void 0&&(y[g]=arguments[p][g]);return y},i.prepareContent=function(p,g,y,b,A){return c.Promise.resolve(g).then(function(R){return s.blob&&(R instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(R))!==-1)&&typeof FileReader<"u"?new c.Promise(function(E,M){var S=new FileReader;S.onload=function(P){E(P.target.result)},S.onerror=function(P){M(P.target.error)},S.readAsArrayBuffer(R)}):R}).then(function(R){var E=i.getTypeOf(R);return E?(E==="arraybuffer"?R=i.transformTo("uint8array",R):E==="string"&&(A?R=o.decode(R):y&&b!==!0&&(R=(function(M){return u(M,s.uint8array?new Uint8Array(M.length):new Array(M.length))})(R))),R):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./signature"),c=r("./zipEntry"),l=r("./support");function u(d){this.files=[],this.loadOptions=d}u.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(d)+")")}},isSignature:function(d,f){var h=this.reader.index;this.reader.setIndex(d);var m=this.reader.readString(4)===f;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=l.uint8array?"uint8array":"array",h=o.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,h,m=this.zip64EndOfCentralSize-44;0<m;)d=this.reader.readInt(2),f=this.reader.readInt(4),h=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=f-h;if(0<m)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(d){this.reader=s(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,n,i){var s=r("./reader/readerFor"),o=r("./utils"),a=r("./compressedObject"),c=r("./crc32"),l=r("./utf8"),u=r("./compressions"),d=r("./support");function f(h,m){this.options=h,this.loadOptions=m}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=(function(g){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===g)return u[y];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,g,y=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<y;)m=h.readInt(2),p=h.readInt(2),g=h.readData(p),this.extraFields[m]={id:m,length:p,value:g};h.setIndex(y)},handleUTF8:function(){var h=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var y=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},n.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,n,i){function s(m,p,g){this.name=m,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=p,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=r("./stream/StreamHelper"),a=r("./stream/DataWorker"),c=r("./utf8"),l=r("./compressedObject"),u=r("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,g="string";try{if(!m)throw new Error("No output type specified.");var y=(g=m.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),p=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(p=p.pipe(new c.Utf8EncodeWorker)),!b&&y&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(A){(p=new u("error")).error(A)}return new o(p,g,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(g,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<d.length;h++)s.prototype[d[h]]=f;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,n,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),d=s.document.createTextNode("");u.observe(d,{characterData:!0}),o=function(){d.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var f=new s.MessageChannel;f.port1.onmessage=m,o=function(){f.port2.postMessage(0)}}var h=[];function m(){var p,g;a=!0;for(var y=h.length;y;){for(g=h,h=[],p=-1;++p<y;)g[p]();y=h.length}a=!1}n.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof Fi<"u"?Fi:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,n,i){var s=r("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function d(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function f(y,b,A){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function h(y,b,A){s(function(){var R;try{R=b(A)}catch(E){return a.reject(y,E)}R===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,R)})}function m(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}function p(y,b){var A=!1;function R(S){A||(A=!0,a.reject(y,S))}function E(S){A||(A=!0,a.resolve(y,S))}var M=g(function(){b(E,R)});M.status==="error"&&R(M.value)}function g(y,b){var A={};try{A.value=y(b),A.status="success"}catch(R){A.status="error",A.value=R}return A}(n.exports=d).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(A){return b.resolve(y()).then(function(){return A})},function(A){return b.resolve(y()).then(function(){throw A})})},d.prototype.catch=function(y){return this.then(null,y)},d.prototype.then=function(y,b){if(typeof y!="function"&&this.state===l||typeof b!="function"&&this.state===c)return this;var A=new this.constructor(o);return this.state!==u?h(A,this.state===l?y:b,this.outcome):this.queue.push(new f(A,y,b)),A},f.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},f.prototype.otherCallFulfilled=function(y){h(this.promise,this.onFulfilled,y)},f.prototype.callRejected=function(y){a.reject(this.promise,y)},f.prototype.otherCallRejected=function(y){h(this.promise,this.onRejected,y)},a.resolve=function(y,b){var A=g(m,b);if(A.status==="error")return a.reject(y,A.value);var R=A.value;if(R)p(y,R);else{y.state=l,y.outcome=b;for(var E=-1,M=y.queue.length;++E<M;)y.queue[E].callFulfilled(b)}return y},a.reject=function(y,b){y.state=c,y.outcome=b;for(var A=-1,R=y.queue.length;++A<R;)y.queue[A].callRejected(b);return y},d.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},d.reject=function(y){var b=new this(o);return a.reject(b,y)},d.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,R=!1;if(!A)return this.resolve([]);for(var E=new Array(A),M=0,S=-1,P=new this(o);++S<A;)W(y[S],S);return P;function W(D,G){b.resolve(D).then(function(O){E[G]=O,++M!==A||R||(R=!0,a.resolve(P,E))},function(O){R||(R=!0,a.reject(P,O))})}},d.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=y.length,R=!1;if(!A)return this.resolve([]);for(var E=-1,M=new this(o);++E<A;)S=y[E],b.resolve(S).then(function(P){R||(R=!0,a.resolve(M,P))},function(P){R||(R=!0,a.reject(M,P))});var S;return M}},{immediate:36}],38:[function(r,n,i){var s={};(0,r("./lib/utils/common").assign)(s,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,n,i){var s=r("./zlib/deflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/messages"),l=r("./zlib/zstream"),u=Object.prototype.toString,d=0,f=-1,h=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:f,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(A!==d)throw new Error(c[A]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var R;if(R=typeof b.dictionary=="string"?a.string2buf(b.dictionary):u.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(A=s.deflateSetDictionary(this.strm,R))!==d)throw new Error(c[A]);this._dict_set=!0}}function g(y,b){var A=new p(b);if(A.push(y,!0),A.err)throw A.msg||c[A.err];return A.result}p.prototype.push=function(y,b){var A,R,E=this.strm,M=this.options.chunkSize;if(this.ended)return!1;R=b===~~b?b:b===!0?4:0,typeof y=="string"?E.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?E.input=new Uint8Array(y):E.input=y,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new o.Buf8(M),E.next_out=0,E.avail_out=M),(A=s.deflate(E,R))!==1&&A!==d)return this.onEnd(A),!(this.ended=!0);E.avail_out!==0&&(E.avail_in!==0||R!==4&&R!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(E.output,E.next_out))):this.onData(o.shrinkBuf(E.output,E.next_out)))}while((0<E.avail_in||E.avail_out===0)&&A!==1);return R===4?(A=s.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===d):R!==2||(this.onEnd(d),!(E.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=g,i.deflateRaw=function(y,b){return(b=b||{}).raw=!0,g(y,b)},i.gzip=function(y,b){return(b=b||{}).gzip=!0,g(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,n,i){var s=r("./zlib/inflate"),o=r("./utils/common"),a=r("./utils/strings"),c=r("./zlib/constants"),l=r("./zlib/messages"),u=r("./zlib/zstream"),d=r("./zlib/gzheader"),f=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||p&&p.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&(15&g.windowBits)==0&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,g.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new d,s.inflateGetHeader(this.strm,this.header)}function m(p,g){var y=new h(g);if(y.push(p,!0),y.err)throw y.msg||l[y.err];return y.result}h.prototype.push=function(p,g){var y,b,A,R,E,M,S=this.strm,P=this.options.chunkSize,W=this.options.dictionary,D=!1;if(this.ended)return!1;b=g===~~g?g:g===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?S.input=a.binstring2buf(p):f.call(p)==="[object ArrayBuffer]"?S.input=new Uint8Array(p):S.input=p,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(P),S.next_out=0,S.avail_out=P),(y=s.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&W&&(M=typeof W=="string"?a.string2buf(W):f.call(W)==="[object ArrayBuffer]"?new Uint8Array(W):W,y=s.inflateSetDictionary(this.strm,M)),y===c.Z_BUF_ERROR&&D===!0&&(y=c.Z_OK,D=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&y!==c.Z_STREAM_END&&(S.avail_in!==0||b!==c.Z_FINISH&&b!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=a.utf8border(S.output,S.next_out),R=S.next_out-A,E=a.buf2string(S.output,A),S.next_out=R,S.avail_out=P-R,R&&o.arraySet(S.output,S.output,A,R,0),this.onData(E)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(D=!0)}while((0<S.avail_in||S.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(b=c.Z_FINISH),b===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):b!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,g){return(g=g||{}).raw=!0,m(p,g)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,n,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var d in u)u.hasOwnProperty(d)&&(c[d]=u[d])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,d,f){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+d),f);else for(var h=0;h<d;h++)c[f+h]=l[u+h]},flattenChunks:function(c){var l,u,d,f,h,m;for(l=d=0,u=c.length;l<u;l++)d+=c[l].length;for(m=new Uint8Array(d),l=f=0,u=c.length;l<u;l++)h=c[l],m.set(h,f),f+=h.length;return m}},a={arraySet:function(c,l,u,d,f){for(var h=0;h<d;h++)c[f+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(r,n,i){var s=r("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(d,f){if(f<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(d,f));for(var h="",m=0;m<f;m++)h+=String.fromCharCode(d[m]);return h}c[254]=c[254]=1,i.string2buf=function(d){var f,h,m,p,g,y=d.length,b=0;for(p=0;p<y;p++)(64512&(h=d.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=d.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),b+=h<128?1:h<2048?2:h<65536?3:4;for(f=new s.Buf8(b),p=g=0;g<b;p++)(64512&(h=d.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=d.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?f[g++]=h:(h<2048?f[g++]=192|h>>>6:(h<65536?f[g++]=224|h>>>12:(f[g++]=240|h>>>18,f[g++]=128|h>>>12&63),f[g++]=128|h>>>6&63),f[g++]=128|63&h);return f},i.buf2binstring=function(d){return u(d,d.length)},i.binstring2buf=function(d){for(var f=new s.Buf8(d.length),h=0,m=f.length;h<m;h++)f[h]=d.charCodeAt(h);return f},i.buf2string=function(d,f){var h,m,p,g,y=f||d.length,b=new Array(2*y);for(h=m=0;h<y;)if((p=d[h++])<128)b[m++]=p;else if(4<(g=c[p]))b[m++]=65533,h+=g-1;else{for(p&=g===2?31:g===3?15:7;1<g&&h<y;)p=p<<6|63&d[h++],g--;1<g?b[m++]=65533:p<65536?b[m++]=p:(p-=65536,b[m++]=55296|p>>10&1023,b[m++]=56320|1023&p)}return u(b,m)},i.utf8border=function(d,f){var h;for((f=f||d.length)>d.length&&(f=d.length),h=f-1;0<=h&&(192&d[h])==128;)h--;return h<0||h===0?f:h+c[d[h]]>f?h:f}},{"./common":41}],43:[function(r,n,i){n.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--d;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(r,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,n,i){var s=(function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a})();n.exports=function(o,a,c,l){var u=s,d=l+c;o^=-1;for(var f=l;f<d;f++)o=o>>>8^u[255&(o^a[f])];return-1^o}},{}],46:[function(r,n,i){var s,o=r("../utils/common"),a=r("./trees"),c=r("./adler32"),l=r("./crc32"),u=r("./messages"),d=0,f=4,h=0,m=-2,p=-1,g=4,y=2,b=8,A=9,R=286,E=30,M=19,S=2*R+1,P=15,W=3,D=258,G=D+W+1,O=42,I=113,k=1,C=2,z=3,F=4;function Q(T,he){return T.msg=u[he],he}function Y(T){return(T<<1)-(4<T?9:0)}function N(T){for(var he=T.length;0<=--he;)T[he]=0}function U(T){var he=T.state,ie=he.pending;ie>T.avail_out&&(ie=T.avail_out),ie!==0&&(o.arraySet(T.output,he.pending_buf,he.pending_out,ie,T.next_out),T.next_out+=ie,he.pending_out+=ie,T.total_out+=ie,T.avail_out-=ie,he.pending-=ie,he.pending===0&&(he.pending_out=0))}function $(T,he){a._tr_flush_block(T,0<=T.block_start?T.block_start:-1,T.strstart-T.block_start,he),T.block_start=T.strstart,U(T.strm)}function V(T,he){T.pending_buf[T.pending++]=he}function q(T,he){T.pending_buf[T.pending++]=he>>>8&255,T.pending_buf[T.pending++]=255&he}function J(T,he){var ie,K,j=T.max_chain_length,ee=T.strstart,pe=T.prev_length,me=T.nice_match,se=T.strstart>T.w_size-G?T.strstart-(T.w_size-G):0,_e=T.window,Oe=T.w_mask,be=T.prev,De=T.strstart+D,pt=_e[ee+pe-1],Ze=_e[ee+pe];T.prev_length>=T.good_match&&(j>>=2),me>T.lookahead&&(me=T.lookahead);do if(_e[(ie=he)+pe]===Ze&&_e[ie+pe-1]===pt&&_e[ie]===_e[ee]&&_e[++ie]===_e[ee+1]){ee+=2,ie++;do;while(_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&_e[++ee]===_e[++ie]&&ee<De);if(K=D-(De-ee),ee=De-D,pe<K){if(T.match_start=he,me<=(pe=K))break;pt=_e[ee+pe-1],Ze=_e[ee+pe]}}while((he=be[he&Oe])>se&&--j!=0);return pe<=T.lookahead?pe:T.lookahead}function fe(T){var he,ie,K,j,ee,pe,me,se,_e,Oe,be=T.w_size;do{if(j=T.window_size-T.lookahead-T.strstart,T.strstart>=be+(be-G)){for(o.arraySet(T.window,T.window,be,be,0),T.match_start-=be,T.strstart-=be,T.block_start-=be,he=ie=T.hash_size;K=T.head[--he],T.head[he]=be<=K?K-be:0,--ie;);for(he=ie=be;K=T.prev[--he],T.prev[he]=be<=K?K-be:0,--ie;);j+=be}if(T.strm.avail_in===0)break;if(pe=T.strm,me=T.window,se=T.strstart+T.lookahead,_e=j,Oe=void 0,Oe=pe.avail_in,_e<Oe&&(Oe=_e),ie=Oe===0?0:(pe.avail_in-=Oe,o.arraySet(me,pe.input,pe.next_in,Oe,se),pe.state.wrap===1?pe.adler=c(pe.adler,me,Oe,se):pe.state.wrap===2&&(pe.adler=l(pe.adler,me,Oe,se)),pe.next_in+=Oe,pe.total_in+=Oe,Oe),T.lookahead+=ie,T.lookahead+T.insert>=W)for(ee=T.strstart-T.insert,T.ins_h=T.window[ee],T.ins_h=(T.ins_h<<T.hash_shift^T.window[ee+1])&T.hash_mask;T.insert&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[ee+W-1])&T.hash_mask,T.prev[ee&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=ee,ee++,T.insert--,!(T.lookahead+T.insert<W)););}while(T.lookahead<G&&T.strm.avail_in!==0)}function Ee(T,he){for(var ie,K;;){if(T.lookahead<G){if(fe(T),T.lookahead<G&&he===d)return k;if(T.lookahead===0)break}if(ie=0,T.lookahead>=W&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),ie!==0&&T.strstart-ie<=T.w_size-G&&(T.match_length=J(T,ie)),T.match_length>=W)if(K=a._tr_tally(T,T.strstart-T.match_start,T.match_length-W),T.lookahead-=T.match_length,T.match_length<=T.max_lazy_match&&T.lookahead>=W){for(T.match_length--;T.strstart++,T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart,--T.match_length!=0;);T.strstart++}else T.strstart+=T.match_length,T.match_length=0,T.ins_h=T.window[T.strstart],T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+1])&T.hash_mask;else K=a._tr_tally(T,0,T.window[T.strstart]),T.lookahead--,T.strstart++;if(K&&($(T,!1),T.strm.avail_out===0))return k}return T.insert=T.strstart<W-1?T.strstart:W-1,he===f?($(T,!0),T.strm.avail_out===0?z:F):T.last_lit&&($(T,!1),T.strm.avail_out===0)?k:C}function ke(T,he){for(var ie,K,j;;){if(T.lookahead<G){if(fe(T),T.lookahead<G&&he===d)return k;if(T.lookahead===0)break}if(ie=0,T.lookahead>=W&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),T.prev_length=T.match_length,T.prev_match=T.match_start,T.match_length=W-1,ie!==0&&T.prev_length<T.max_lazy_match&&T.strstart-ie<=T.w_size-G&&(T.match_length=J(T,ie),T.match_length<=5&&(T.strategy===1||T.match_length===W&&4096<T.strstart-T.match_start)&&(T.match_length=W-1)),T.prev_length>=W&&T.match_length<=T.prev_length){for(j=T.strstart+T.lookahead-W,K=a._tr_tally(T,T.strstart-1-T.prev_match,T.prev_length-W),T.lookahead-=T.prev_length-1,T.prev_length-=2;++T.strstart<=j&&(T.ins_h=(T.ins_h<<T.hash_shift^T.window[T.strstart+W-1])&T.hash_mask,ie=T.prev[T.strstart&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=T.strstart),--T.prev_length!=0;);if(T.match_available=0,T.match_length=W-1,T.strstart++,K&&($(T,!1),T.strm.avail_out===0))return k}else if(T.match_available){if((K=a._tr_tally(T,0,T.window[T.strstart-1]))&&$(T,!1),T.strstart++,T.lookahead--,T.strm.avail_out===0)return k}else T.match_available=1,T.strstart++,T.lookahead--}return T.match_available&&(K=a._tr_tally(T,0,T.window[T.strstart-1]),T.match_available=0),T.insert=T.strstart<W-1?T.strstart:W-1,he===f?($(T,!0),T.strm.avail_out===0?z:F):T.last_lit&&($(T,!1),T.strm.avail_out===0)?k:C}function xe(T,he,ie,K,j){this.good_length=T,this.max_lazy=he,this.nice_length=ie,this.max_chain=K,this.func=j}function Ae(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*E+1)),this.bl_tree=new o.Buf16(2*(2*M+1)),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(P+1),this.heap=new o.Buf16(2*R+1),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*R+1),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Se(T){var he;return T&&T.state?(T.total_in=T.total_out=0,T.data_type=y,(he=T.state).pending=0,he.pending_out=0,he.wrap<0&&(he.wrap=-he.wrap),he.status=he.wrap?O:I,T.adler=he.wrap===2?0:1,he.last_flush=d,a._tr_init(he),h):Q(T,m)}function Me(T){var he=Se(T);return he===h&&(function(ie){ie.window_size=2*ie.w_size,N(ie.head),ie.max_lazy_match=s[ie.level].max_lazy,ie.good_match=s[ie.level].good_length,ie.nice_match=s[ie.level].nice_length,ie.max_chain_length=s[ie.level].max_chain,ie.strstart=0,ie.block_start=0,ie.lookahead=0,ie.insert=0,ie.match_length=ie.prev_length=W-1,ie.match_available=0,ie.ins_h=0})(T.state),he}function je(T,he,ie,K,j,ee){if(!T)return m;var pe=1;if(he===p&&(he=6),K<0?(pe=0,K=-K):15<K&&(pe=2,K-=16),j<1||A<j||ie!==b||K<8||15<K||he<0||9<he||ee<0||g<ee)return Q(T,m);K===8&&(K=9);var me=new Ae;return(T.state=me).strm=T,me.wrap=pe,me.gzhead=null,me.w_bits=K,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=j+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+W-1)/W),me.window=new o.Buf8(2*me.w_size),me.head=new o.Buf16(me.hash_size),me.prev=new o.Buf16(me.w_size),me.lit_bufsize=1<<j+6,me.pending_buf_size=4*me.lit_bufsize,me.pending_buf=new o.Buf8(me.pending_buf_size),me.d_buf=1*me.lit_bufsize,me.l_buf=3*me.lit_bufsize,me.level=he,me.strategy=ee,me.method=ie,Me(T)}s=[new xe(0,0,0,0,function(T,he){var ie=65535;for(ie>T.pending_buf_size-5&&(ie=T.pending_buf_size-5);;){if(T.lookahead<=1){if(fe(T),T.lookahead===0&&he===d)return k;if(T.lookahead===0)break}T.strstart+=T.lookahead,T.lookahead=0;var K=T.block_start+ie;if((T.strstart===0||T.strstart>=K)&&(T.lookahead=T.strstart-K,T.strstart=K,$(T,!1),T.strm.avail_out===0)||T.strstart-T.block_start>=T.w_size-G&&($(T,!1),T.strm.avail_out===0))return k}return T.insert=0,he===f?($(T,!0),T.strm.avail_out===0?z:F):(T.strstart>T.block_start&&($(T,!1),T.strm.avail_out),k)}),new xe(4,4,8,4,Ee),new xe(4,5,16,8,Ee),new xe(4,6,32,32,Ee),new xe(4,4,16,16,ke),new xe(8,16,32,32,ke),new xe(8,16,128,128,ke),new xe(8,32,128,256,ke),new xe(32,128,258,1024,ke),new xe(32,258,258,4096,ke)],i.deflateInit=function(T,he){return je(T,he,b,15,8,0)},i.deflateInit2=je,i.deflateReset=Me,i.deflateResetKeep=Se,i.deflateSetHeader=function(T,he){return T&&T.state?T.state.wrap!==2?m:(T.state.gzhead=he,h):m},i.deflate=function(T,he){var ie,K,j,ee;if(!T||!T.state||5<he||he<0)return T?Q(T,m):m;if(K=T.state,!T.output||!T.input&&T.avail_in!==0||K.status===666&&he!==f)return Q(T,T.avail_out===0?-5:m);if(K.strm=T,ie=K.last_flush,K.last_flush=he,K.status===O)if(K.wrap===2)T.adler=0,V(K,31),V(K,139),V(K,8),K.gzhead?(V(K,(K.gzhead.text?1:0)+(K.gzhead.hcrc?2:0)+(K.gzhead.extra?4:0)+(K.gzhead.name?8:0)+(K.gzhead.comment?16:0)),V(K,255&K.gzhead.time),V(K,K.gzhead.time>>8&255),V(K,K.gzhead.time>>16&255),V(K,K.gzhead.time>>24&255),V(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),V(K,255&K.gzhead.os),K.gzhead.extra&&K.gzhead.extra.length&&(V(K,255&K.gzhead.extra.length),V(K,K.gzhead.extra.length>>8&255)),K.gzhead.hcrc&&(T.adler=l(T.adler,K.pending_buf,K.pending,0)),K.gzindex=0,K.status=69):(V(K,0),V(K,0),V(K,0),V(K,0),V(K,0),V(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),V(K,3),K.status=I);else{var pe=b+(K.w_bits-8<<4)<<8;pe|=(2<=K.strategy||K.level<2?0:K.level<6?1:K.level===6?2:3)<<6,K.strstart!==0&&(pe|=32),pe+=31-pe%31,K.status=I,q(K,pe),K.strstart!==0&&(q(K,T.adler>>>16),q(K,65535&T.adler)),T.adler=1}if(K.status===69)if(K.gzhead.extra){for(j=K.pending;K.gzindex<(65535&K.gzhead.extra.length)&&(K.pending!==K.pending_buf_size||(K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),U(T),j=K.pending,K.pending!==K.pending_buf_size));)V(K,255&K.gzhead.extra[K.gzindex]),K.gzindex++;K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),K.gzindex===K.gzhead.extra.length&&(K.gzindex=0,K.status=73)}else K.status=73;if(K.status===73)if(K.gzhead.name){j=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),U(T),j=K.pending,K.pending===K.pending_buf_size)){ee=1;break}ee=K.gzindex<K.gzhead.name.length?255&K.gzhead.name.charCodeAt(K.gzindex++):0,V(K,ee)}while(ee!==0);K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),ee===0&&(K.gzindex=0,K.status=91)}else K.status=91;if(K.status===91)if(K.gzhead.comment){j=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),U(T),j=K.pending,K.pending===K.pending_buf_size)){ee=1;break}ee=K.gzindex<K.gzhead.comment.length?255&K.gzhead.comment.charCodeAt(K.gzindex++):0,V(K,ee)}while(ee!==0);K.gzhead.hcrc&&K.pending>j&&(T.adler=l(T.adler,K.pending_buf,K.pending-j,j)),ee===0&&(K.status=103)}else K.status=103;if(K.status===103&&(K.gzhead.hcrc?(K.pending+2>K.pending_buf_size&&U(T),K.pending+2<=K.pending_buf_size&&(V(K,255&T.adler),V(K,T.adler>>8&255),T.adler=0,K.status=I)):K.status=I),K.pending!==0){if(U(T),T.avail_out===0)return K.last_flush=-1,h}else if(T.avail_in===0&&Y(he)<=Y(ie)&&he!==f)return Q(T,-5);if(K.status===666&&T.avail_in!==0)return Q(T,-5);if(T.avail_in!==0||K.lookahead!==0||he!==d&&K.status!==666){var me=K.strategy===2?(function(se,_e){for(var Oe;;){if(se.lookahead===0&&(fe(se),se.lookahead===0)){if(_e===d)return k;break}if(se.match_length=0,Oe=a._tr_tally(se,0,se.window[se.strstart]),se.lookahead--,se.strstart++,Oe&&($(se,!1),se.strm.avail_out===0))return k}return se.insert=0,_e===f?($(se,!0),se.strm.avail_out===0?z:F):se.last_lit&&($(se,!1),se.strm.avail_out===0)?k:C})(K,he):K.strategy===3?(function(se,_e){for(var Oe,be,De,pt,Ze=se.window;;){if(se.lookahead<=D){if(fe(se),se.lookahead<=D&&_e===d)return k;if(se.lookahead===0)break}if(se.match_length=0,se.lookahead>=W&&0<se.strstart&&(be=Ze[De=se.strstart-1])===Ze[++De]&&be===Ze[++De]&&be===Ze[++De]){pt=se.strstart+D;do;while(be===Ze[++De]&&be===Ze[++De]&&be===Ze[++De]&&be===Ze[++De]&&be===Ze[++De]&&be===Ze[++De]&&be===Ze[++De]&&be===Ze[++De]&&De<pt);se.match_length=D-(pt-De),se.match_length>se.lookahead&&(se.match_length=se.lookahead)}if(se.match_length>=W?(Oe=a._tr_tally(se,1,se.match_length-W),se.lookahead-=se.match_length,se.strstart+=se.match_length,se.match_length=0):(Oe=a._tr_tally(se,0,se.window[se.strstart]),se.lookahead--,se.strstart++),Oe&&($(se,!1),se.strm.avail_out===0))return k}return se.insert=0,_e===f?($(se,!0),se.strm.avail_out===0?z:F):se.last_lit&&($(se,!1),se.strm.avail_out===0)?k:C})(K,he):s[K.level].func(K,he);if(me!==z&&me!==F||(K.status=666),me===k||me===z)return T.avail_out===0&&(K.last_flush=-1),h;if(me===C&&(he===1?a._tr_align(K):he!==5&&(a._tr_stored_block(K,0,0,!1),he===3&&(N(K.head),K.lookahead===0&&(K.strstart=0,K.block_start=0,K.insert=0))),U(T),T.avail_out===0))return K.last_flush=-1,h}return he!==f?h:K.wrap<=0?1:(K.wrap===2?(V(K,255&T.adler),V(K,T.adler>>8&255),V(K,T.adler>>16&255),V(K,T.adler>>24&255),V(K,255&T.total_in),V(K,T.total_in>>8&255),V(K,T.total_in>>16&255),V(K,T.total_in>>24&255)):(q(K,T.adler>>>16),q(K,65535&T.adler)),U(T),0<K.wrap&&(K.wrap=-K.wrap),K.pending!==0?h:1)},i.deflateEnd=function(T){var he;return T&&T.state?(he=T.state.status)!==O&&he!==69&&he!==73&&he!==91&&he!==103&&he!==I&&he!==666?Q(T,m):(T.state=null,he===I?Q(T,-3):h):m},i.deflateSetDictionary=function(T,he){var ie,K,j,ee,pe,me,se,_e,Oe=he.length;if(!T||!T.state||(ee=(ie=T.state).wrap)===2||ee===1&&ie.status!==O||ie.lookahead)return m;for(ee===1&&(T.adler=c(T.adler,he,Oe,0)),ie.wrap=0,Oe>=ie.w_size&&(ee===0&&(N(ie.head),ie.strstart=0,ie.block_start=0,ie.insert=0),_e=new o.Buf8(ie.w_size),o.arraySet(_e,he,Oe-ie.w_size,ie.w_size,0),he=_e,Oe=ie.w_size),pe=T.avail_in,me=T.next_in,se=T.input,T.avail_in=Oe,T.next_in=0,T.input=he,fe(ie);ie.lookahead>=W;){for(K=ie.strstart,j=ie.lookahead-(W-1);ie.ins_h=(ie.ins_h<<ie.hash_shift^ie.window[K+W-1])&ie.hash_mask,ie.prev[K&ie.w_mask]=ie.head[ie.ins_h],ie.head[ie.ins_h]=K,K++,--j;);ie.strstart=K,ie.lookahead=W-1,fe(ie)}return ie.strstart+=ie.lookahead,ie.block_start=ie.strstart,ie.insert=ie.lookahead,ie.lookahead=0,ie.match_length=ie.prev_length=W-1,ie.match_available=0,T.next_in=me,T.input=se,T.avail_in=pe,ie.wrap=ee,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,n,i){n.exports=function(s,o){var a,c,l,u,d,f,h,m,p,g,y,b,A,R,E,M,S,P,W,D,G,O,I,k,C;a=s.state,c=s.next_in,k=s.input,l=c+(s.avail_in-5),u=s.next_out,C=s.output,d=u-(o-s.avail_out),f=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,g=a.wnext,y=a.window,b=a.hold,A=a.bits,R=a.lencode,E=a.distcode,M=(1<<a.lenbits)-1,S=(1<<a.distbits)-1;e:do{A<15&&(b+=k[c++]<<A,A+=8,b+=k[c++]<<A,A+=8),P=R[b&M];t:for(;;){if(b>>>=W=P>>>24,A-=W,(W=P>>>16&255)===0)C[u++]=65535&P;else{if(!(16&W)){if((64&W)==0){P=R[(65535&P)+(b&(1<<W)-1)];continue t}if(32&W){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}D=65535&P,(W&=15)&&(A<W&&(b+=k[c++]<<A,A+=8),D+=b&(1<<W)-1,b>>>=W,A-=W),A<15&&(b+=k[c++]<<A,A+=8,b+=k[c++]<<A,A+=8),P=E[b&S];r:for(;;){if(b>>>=W=P>>>24,A-=W,!(16&(W=P>>>16&255))){if((64&W)==0){P=E[(65535&P)+(b&(1<<W)-1)];continue r}s.msg="invalid distance code",a.mode=30;break e}if(G=65535&P,A<(W&=15)&&(b+=k[c++]<<A,(A+=8)<W&&(b+=k[c++]<<A,A+=8)),h<(G+=b&(1<<W)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(b>>>=W,A-=W,(W=u-d)<G){if(p<(W=G-W)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(I=y,(O=0)===g){if(O+=m-W,W<D){for(D-=W;C[u++]=y[O++],--W;);O=u-G,I=C}}else if(g<W){if(O+=m+g-W,(W-=g)<D){for(D-=W;C[u++]=y[O++],--W;);if(O=0,g<D){for(D-=W=g;C[u++]=y[O++],--W;);O=u-G,I=C}}}else if(O+=g-W,W<D){for(D-=W;C[u++]=y[O++],--W;);O=u-G,I=C}for(;2<D;)C[u++]=I[O++],C[u++]=I[O++],C[u++]=I[O++],D-=3;D&&(C[u++]=I[O++],1<D&&(C[u++]=I[O++]))}else{for(O=u-G;C[u++]=C[O++],C[u++]=C[O++],C[u++]=C[O++],2<(D-=3););D&&(C[u++]=C[O++],1<D&&(C[u++]=C[O++]))}break}}break}}while(c<l&&u<f);c-=D=A>>3,b&=(1<<(A-=D<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<f?f-u+257:257-(u-f),a.hold=b,a.bits=A}},{}],49:[function(r,n,i){var s=r("../utils/common"),o=r("./adler32"),a=r("./crc32"),c=r("./inffast"),l=r("./inftrees"),u=1,d=2,f=0,h=-2,m=1,p=852,g=592;function y(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(O){var I;return O&&O.state?(I=O.state,O.total_in=O.total_out=I.total=0,O.msg="",I.wrap&&(O.adler=1&I.wrap),I.mode=m,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new s.Buf32(p),I.distcode=I.distdyn=new s.Buf32(g),I.sane=1,I.back=-1,f):h}function R(O){var I;return O&&O.state?((I=O.state).wsize=0,I.whave=0,I.wnext=0,A(O)):h}function E(O,I){var k,C;return O&&O.state?(C=O.state,I<0?(k=0,I=-I):(k=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?h:(C.window!==null&&C.wbits!==I&&(C.window=null),C.wrap=k,C.wbits=I,R(O))):h}function M(O,I){var k,C;return O?(C=new b,(O.state=C).window=null,(k=E(O,I))!==f&&(O.state=null),k):h}var S,P,W=!0;function D(O){if(W){var I;for(S=new s.Buf32(512),P=new s.Buf32(32),I=0;I<144;)O.lens[I++]=8;for(;I<256;)O.lens[I++]=9;for(;I<280;)O.lens[I++]=7;for(;I<288;)O.lens[I++]=8;for(l(u,O.lens,0,288,S,0,O.work,{bits:9}),I=0;I<32;)O.lens[I++]=5;l(d,O.lens,0,32,P,0,O.work,{bits:5}),W=!1}O.lencode=S,O.lenbits=9,O.distcode=P,O.distbits=5}function G(O,I,k,C){var z,F=O.state;return F.window===null&&(F.wsize=1<<F.wbits,F.wnext=0,F.whave=0,F.window=new s.Buf8(F.wsize)),C>=F.wsize?(s.arraySet(F.window,I,k-F.wsize,F.wsize,0),F.wnext=0,F.whave=F.wsize):(C<(z=F.wsize-F.wnext)&&(z=C),s.arraySet(F.window,I,k-C,z,F.wnext),(C-=z)?(s.arraySet(F.window,I,k-C,C,0),F.wnext=C,F.whave=F.wsize):(F.wnext+=z,F.wnext===F.wsize&&(F.wnext=0),F.whave<F.wsize&&(F.whave+=z))),0}i.inflateReset=R,i.inflateReset2=E,i.inflateResetKeep=A,i.inflateInit=function(O){return M(O,15)},i.inflateInit2=M,i.inflate=function(O,I){var k,C,z,F,Q,Y,N,U,$,V,q,J,fe,Ee,ke,xe,Ae,Se,Me,je,T,he,ie,K,j=0,ee=new s.Buf8(4),pe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return h;(k=O.state).mode===12&&(k.mode=13),Q=O.next_out,z=O.output,N=O.avail_out,F=O.next_in,C=O.input,Y=O.avail_in,U=k.hold,$=k.bits,V=Y,q=N,he=f;e:for(;;)switch(k.mode){case m:if(k.wrap===0){k.mode=13;break}for(;$<16;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if(2&k.wrap&&U===35615){ee[k.check=0]=255&U,ee[1]=U>>>8&255,k.check=a(k.check,ee,2,0),$=U=0,k.mode=2;break}if(k.flags=0,k.head&&(k.head.done=!1),!(1&k.wrap)||(((255&U)<<8)+(U>>8))%31){O.msg="incorrect header check",k.mode=30;break}if((15&U)!=8){O.msg="unknown compression method",k.mode=30;break}if($-=4,T=8+(15&(U>>>=4)),k.wbits===0)k.wbits=T;else if(T>k.wbits){O.msg="invalid window size",k.mode=30;break}k.dmax=1<<T,O.adler=k.check=1,k.mode=512&U?10:12,$=U=0;break;case 2:for(;$<16;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if(k.flags=U,(255&k.flags)!=8){O.msg="unknown compression method",k.mode=30;break}if(57344&k.flags){O.msg="unknown header flags set",k.mode=30;break}k.head&&(k.head.text=U>>8&1),512&k.flags&&(ee[0]=255&U,ee[1]=U>>>8&255,k.check=a(k.check,ee,2,0)),$=U=0,k.mode=3;case 3:for(;$<32;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}k.head&&(k.head.time=U),512&k.flags&&(ee[0]=255&U,ee[1]=U>>>8&255,ee[2]=U>>>16&255,ee[3]=U>>>24&255,k.check=a(k.check,ee,4,0)),$=U=0,k.mode=4;case 4:for(;$<16;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}k.head&&(k.head.xflags=255&U,k.head.os=U>>8),512&k.flags&&(ee[0]=255&U,ee[1]=U>>>8&255,k.check=a(k.check,ee,2,0)),$=U=0,k.mode=5;case 5:if(1024&k.flags){for(;$<16;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}k.length=U,k.head&&(k.head.extra_len=U),512&k.flags&&(ee[0]=255&U,ee[1]=U>>>8&255,k.check=a(k.check,ee,2,0)),$=U=0}else k.head&&(k.head.extra=null);k.mode=6;case 6:if(1024&k.flags&&(Y<(J=k.length)&&(J=Y),J&&(k.head&&(T=k.head.extra_len-k.length,k.head.extra||(k.head.extra=new Array(k.head.extra_len)),s.arraySet(k.head.extra,C,F,J,T)),512&k.flags&&(k.check=a(k.check,C,J,F)),Y-=J,F+=J,k.length-=J),k.length))break e;k.length=0,k.mode=7;case 7:if(2048&k.flags){if(Y===0)break e;for(J=0;T=C[F+J++],k.head&&T&&k.length<65536&&(k.head.name+=String.fromCharCode(T)),T&&J<Y;);if(512&k.flags&&(k.check=a(k.check,C,J,F)),Y-=J,F+=J,T)break e}else k.head&&(k.head.name=null);k.length=0,k.mode=8;case 8:if(4096&k.flags){if(Y===0)break e;for(J=0;T=C[F+J++],k.head&&T&&k.length<65536&&(k.head.comment+=String.fromCharCode(T)),T&&J<Y;);if(512&k.flags&&(k.check=a(k.check,C,J,F)),Y-=J,F+=J,T)break e}else k.head&&(k.head.comment=null);k.mode=9;case 9:if(512&k.flags){for(;$<16;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if(U!==(65535&k.check)){O.msg="header crc mismatch",k.mode=30;break}$=U=0}k.head&&(k.head.hcrc=k.flags>>9&1,k.head.done=!0),O.adler=k.check=0,k.mode=12;break;case 10:for(;$<32;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}O.adler=k.check=y(U),$=U=0,k.mode=11;case 11:if(k.havedict===0)return O.next_out=Q,O.avail_out=N,O.next_in=F,O.avail_in=Y,k.hold=U,k.bits=$,2;O.adler=k.check=1,k.mode=12;case 12:if(I===5||I===6)break e;case 13:if(k.last){U>>>=7&$,$-=7&$,k.mode=27;break}for(;$<3;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}switch(k.last=1&U,$-=1,3&(U>>>=1)){case 0:k.mode=14;break;case 1:if(D(k),k.mode=20,I!==6)break;U>>>=2,$-=2;break e;case 2:k.mode=17;break;case 3:O.msg="invalid block type",k.mode=30}U>>>=2,$-=2;break;case 14:for(U>>>=7&$,$-=7&$;$<32;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if((65535&U)!=(U>>>16^65535)){O.msg="invalid stored block lengths",k.mode=30;break}if(k.length=65535&U,$=U=0,k.mode=15,I===6)break e;case 15:k.mode=16;case 16:if(J=k.length){if(Y<J&&(J=Y),N<J&&(J=N),J===0)break e;s.arraySet(z,C,F,J,Q),Y-=J,F+=J,N-=J,Q+=J,k.length-=J;break}k.mode=12;break;case 17:for(;$<14;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if(k.nlen=257+(31&U),U>>>=5,$-=5,k.ndist=1+(31&U),U>>>=5,$-=5,k.ncode=4+(15&U),U>>>=4,$-=4,286<k.nlen||30<k.ndist){O.msg="too many length or distance symbols",k.mode=30;break}k.have=0,k.mode=18;case 18:for(;k.have<k.ncode;){for(;$<3;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}k.lens[pe[k.have++]]=7&U,U>>>=3,$-=3}for(;k.have<19;)k.lens[pe[k.have++]]=0;if(k.lencode=k.lendyn,k.lenbits=7,ie={bits:k.lenbits},he=l(0,k.lens,0,19,k.lencode,0,k.work,ie),k.lenbits=ie.bits,he){O.msg="invalid code lengths set",k.mode=30;break}k.have=0,k.mode=19;case 19:for(;k.have<k.nlen+k.ndist;){for(;xe=(j=k.lencode[U&(1<<k.lenbits)-1])>>>16&255,Ae=65535&j,!((ke=j>>>24)<=$);){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if(Ae<16)U>>>=ke,$-=ke,k.lens[k.have++]=Ae;else{if(Ae===16){for(K=ke+2;$<K;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if(U>>>=ke,$-=ke,k.have===0){O.msg="invalid bit length repeat",k.mode=30;break}T=k.lens[k.have-1],J=3+(3&U),U>>>=2,$-=2}else if(Ae===17){for(K=ke+3;$<K;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}$-=ke,T=0,J=3+(7&(U>>>=ke)),U>>>=3,$-=3}else{for(K=ke+7;$<K;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}$-=ke,T=0,J=11+(127&(U>>>=ke)),U>>>=7,$-=7}if(k.have+J>k.nlen+k.ndist){O.msg="invalid bit length repeat",k.mode=30;break}for(;J--;)k.lens[k.have++]=T}}if(k.mode===30)break;if(k.lens[256]===0){O.msg="invalid code -- missing end-of-block",k.mode=30;break}if(k.lenbits=9,ie={bits:k.lenbits},he=l(u,k.lens,0,k.nlen,k.lencode,0,k.work,ie),k.lenbits=ie.bits,he){O.msg="invalid literal/lengths set",k.mode=30;break}if(k.distbits=6,k.distcode=k.distdyn,ie={bits:k.distbits},he=l(d,k.lens,k.nlen,k.ndist,k.distcode,0,k.work,ie),k.distbits=ie.bits,he){O.msg="invalid distances set",k.mode=30;break}if(k.mode=20,I===6)break e;case 20:k.mode=21;case 21:if(6<=Y&&258<=N){O.next_out=Q,O.avail_out=N,O.next_in=F,O.avail_in=Y,k.hold=U,k.bits=$,c(O,q),Q=O.next_out,z=O.output,N=O.avail_out,F=O.next_in,C=O.input,Y=O.avail_in,U=k.hold,$=k.bits,k.mode===12&&(k.back=-1);break}for(k.back=0;xe=(j=k.lencode[U&(1<<k.lenbits)-1])>>>16&255,Ae=65535&j,!((ke=j>>>24)<=$);){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if(xe&&(240&xe)==0){for(Se=ke,Me=xe,je=Ae;xe=(j=k.lencode[je+((U&(1<<Se+Me)-1)>>Se)])>>>16&255,Ae=65535&j,!(Se+(ke=j>>>24)<=$);){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}U>>>=Se,$-=Se,k.back+=Se}if(U>>>=ke,$-=ke,k.back+=ke,k.length=Ae,xe===0){k.mode=26;break}if(32&xe){k.back=-1,k.mode=12;break}if(64&xe){O.msg="invalid literal/length code",k.mode=30;break}k.extra=15&xe,k.mode=22;case 22:if(k.extra){for(K=k.extra;$<K;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}k.length+=U&(1<<k.extra)-1,U>>>=k.extra,$-=k.extra,k.back+=k.extra}k.was=k.length,k.mode=23;case 23:for(;xe=(j=k.distcode[U&(1<<k.distbits)-1])>>>16&255,Ae=65535&j,!((ke=j>>>24)<=$);){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if((240&xe)==0){for(Se=ke,Me=xe,je=Ae;xe=(j=k.distcode[je+((U&(1<<Se+Me)-1)>>Se)])>>>16&255,Ae=65535&j,!(Se+(ke=j>>>24)<=$);){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}U>>>=Se,$-=Se,k.back+=Se}if(U>>>=ke,$-=ke,k.back+=ke,64&xe){O.msg="invalid distance code",k.mode=30;break}k.offset=Ae,k.extra=15&xe,k.mode=24;case 24:if(k.extra){for(K=k.extra;$<K;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}k.offset+=U&(1<<k.extra)-1,U>>>=k.extra,$-=k.extra,k.back+=k.extra}if(k.offset>k.dmax){O.msg="invalid distance too far back",k.mode=30;break}k.mode=25;case 25:if(N===0)break e;if(J=q-N,k.offset>J){if((J=k.offset-J)>k.whave&&k.sane){O.msg="invalid distance too far back",k.mode=30;break}fe=J>k.wnext?(J-=k.wnext,k.wsize-J):k.wnext-J,J>k.length&&(J=k.length),Ee=k.window}else Ee=z,fe=Q-k.offset,J=k.length;for(N<J&&(J=N),N-=J,k.length-=J;z[Q++]=Ee[fe++],--J;);k.length===0&&(k.mode=21);break;case 26:if(N===0)break e;z[Q++]=k.length,N--,k.mode=21;break;case 27:if(k.wrap){for(;$<32;){if(Y===0)break e;Y--,U|=C[F++]<<$,$+=8}if(q-=N,O.total_out+=q,k.total+=q,q&&(O.adler=k.check=k.flags?a(k.check,z,q,Q-q):o(k.check,z,q,Q-q)),q=N,(k.flags?U:y(U))!==k.check){O.msg="incorrect data check",k.mode=30;break}$=U=0}k.mode=28;case 28:if(k.wrap&&k.flags){for(;$<32;){if(Y===0)break e;Y--,U+=C[F++]<<$,$+=8}if(U!==(4294967295&k.total)){O.msg="incorrect length check",k.mode=30;break}$=U=0}k.mode=29;case 29:he=1;break e;case 30:he=-3;break e;case 31:return-4;case 32:default:return h}return O.next_out=Q,O.avail_out=N,O.next_in=F,O.avail_in=Y,k.hold=U,k.bits=$,(k.wsize||q!==O.avail_out&&k.mode<30&&(k.mode<27||I!==4))&&G(O,O.output,O.next_out,q-O.avail_out)?(k.mode=31,-4):(V-=O.avail_in,q-=O.avail_out,O.total_in+=V,O.total_out+=q,k.total+=q,k.wrap&&q&&(O.adler=k.check=k.flags?a(k.check,z,q,O.next_out-q):o(k.check,z,q,O.next_out-q)),O.data_type=k.bits+(k.last?64:0)+(k.mode===12?128:0)+(k.mode===20||k.mode===15?256:0),(V==0&&q===0||I===4)&&he===f&&(he=-5),he)},i.inflateEnd=function(O){if(!O||!O.state)return h;var I=O.state;return I.window&&(I.window=null),O.state=null,f},i.inflateGetHeader=function(O,I){var k;return O&&O.state?(2&(k=O.state).wrap)==0?h:((k.head=I).done=!1,f):h},i.inflateSetDictionary=function(O,I){var k,C=I.length;return O&&O.state?(k=O.state).wrap!==0&&k.mode!==11?h:k.mode===11&&o(1,I,C,0)!==k.check?-3:G(O,I,C,C)?(k.mode=31,-4):(k.havedict=1,f):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,n,i){var s=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,d,f,h,m,p,g,y){var b,A,R,E,M,S,P,W,D,G=y.bits,O=0,I=0,k=0,C=0,z=0,F=0,Q=0,Y=0,N=0,U=0,$=null,V=0,q=new s.Buf16(16),J=new s.Buf16(16),fe=null,Ee=0;for(O=0;O<=15;O++)q[O]=0;for(I=0;I<h;I++)q[d[f+I]]++;for(z=G,C=15;1<=C&&q[C]===0;C--);if(C<z&&(z=C),C===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(k=1;k<C&&q[k]===0;k++);for(z<k&&(z=k),O=Y=1;O<=15;O++)if(Y<<=1,(Y-=q[O])<0)return-1;if(0<Y&&(u===0||C!==1))return-1;for(J[1]=0,O=1;O<15;O++)J[O+1]=J[O]+q[O];for(I=0;I<h;I++)d[f+I]!==0&&(g[J[d[f+I]]++]=I);if(S=u===0?($=fe=g,19):u===1?($=o,V-=257,fe=a,Ee-=257,256):($=c,fe=l,-1),O=k,M=p,Q=I=U=0,R=-1,E=(N=1<<(F=z))-1,u===1&&852<N||u===2&&592<N)return 1;for(;;){for(P=O-Q,D=g[I]<S?(W=0,g[I]):g[I]>S?(W=fe[Ee+g[I]],$[V+g[I]]):(W=96,0),b=1<<O-Q,k=A=1<<F;m[M+(U>>Q)+(A-=b)]=P<<24|W<<16|D|0,A!==0;);for(b=1<<O-1;U&b;)b>>=1;if(b!==0?(U&=b-1,U+=b):U=0,I++,--q[O]==0){if(O===C)break;O=d[f+g[I]]}if(z<O&&(U&E)!==R){for(Q===0&&(Q=z),M+=k,Y=1<<(F=O-Q);F+Q<C&&!((Y-=q[F+Q])<=0);)F++,Y<<=1;if(N+=1<<F,u===1&&852<N||u===2&&592<N)return 1;m[R=U&E]=z<<24|F<<16|M-p|0}}return U!==0&&(m[M+U]=O-Q<<24|64<<16|0),y.bits=z,0}},{"../utils/common":41}],51:[function(r,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,n,i){var s=r("../utils/common"),o=0,a=1;function c(j){for(var ee=j.length;0<=--ee;)j[ee]=0}var l=0,u=29,d=256,f=d+1+u,h=30,m=19,p=2*f+1,g=15,y=16,b=7,A=256,R=16,E=17,M=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(f+2));c(G);var O=new Array(2*h);c(O);var I=new Array(512);c(I);var k=new Array(256);c(k);var C=new Array(u);c(C);var z,F,Q,Y=new Array(h);function N(j,ee,pe,me,se){this.static_tree=j,this.extra_bits=ee,this.extra_base=pe,this.elems=me,this.max_length=se,this.has_stree=j&&j.length}function U(j,ee){this.dyn_tree=j,this.max_code=0,this.stat_desc=ee}function $(j){return j<256?I[j]:I[256+(j>>>7)]}function V(j,ee){j.pending_buf[j.pending++]=255&ee,j.pending_buf[j.pending++]=ee>>>8&255}function q(j,ee,pe){j.bi_valid>y-pe?(j.bi_buf|=ee<<j.bi_valid&65535,V(j,j.bi_buf),j.bi_buf=ee>>y-j.bi_valid,j.bi_valid+=pe-y):(j.bi_buf|=ee<<j.bi_valid&65535,j.bi_valid+=pe)}function J(j,ee,pe){q(j,pe[2*ee],pe[2*ee+1])}function fe(j,ee){for(var pe=0;pe|=1&j,j>>>=1,pe<<=1,0<--ee;);return pe>>>1}function Ee(j,ee,pe){var me,se,_e=new Array(g+1),Oe=0;for(me=1;me<=g;me++)_e[me]=Oe=Oe+pe[me-1]<<1;for(se=0;se<=ee;se++){var be=j[2*se+1];be!==0&&(j[2*se]=fe(_e[be]++,be))}}function ke(j){var ee;for(ee=0;ee<f;ee++)j.dyn_ltree[2*ee]=0;for(ee=0;ee<h;ee++)j.dyn_dtree[2*ee]=0;for(ee=0;ee<m;ee++)j.bl_tree[2*ee]=0;j.dyn_ltree[2*A]=1,j.opt_len=j.static_len=0,j.last_lit=j.matches=0}function xe(j){8<j.bi_valid?V(j,j.bi_buf):0<j.bi_valid&&(j.pending_buf[j.pending++]=j.bi_buf),j.bi_buf=0,j.bi_valid=0}function Ae(j,ee,pe,me){var se=2*ee,_e=2*pe;return j[se]<j[_e]||j[se]===j[_e]&&me[ee]<=me[pe]}function Se(j,ee,pe){for(var me=j.heap[pe],se=pe<<1;se<=j.heap_len&&(se<j.heap_len&&Ae(ee,j.heap[se+1],j.heap[se],j.depth)&&se++,!Ae(ee,me,j.heap[se],j.depth));)j.heap[pe]=j.heap[se],pe=se,se<<=1;j.heap[pe]=me}function Me(j,ee,pe){var me,se,_e,Oe,be=0;if(j.last_lit!==0)for(;me=j.pending_buf[j.d_buf+2*be]<<8|j.pending_buf[j.d_buf+2*be+1],se=j.pending_buf[j.l_buf+be],be++,me===0?J(j,se,ee):(J(j,(_e=k[se])+d+1,ee),(Oe=S[_e])!==0&&q(j,se-=C[_e],Oe),J(j,_e=$(--me),pe),(Oe=P[_e])!==0&&q(j,me-=Y[_e],Oe)),be<j.last_lit;);J(j,A,ee)}function je(j,ee){var pe,me,se,_e=ee.dyn_tree,Oe=ee.stat_desc.static_tree,be=ee.stat_desc.has_stree,De=ee.stat_desc.elems,pt=-1;for(j.heap_len=0,j.heap_max=p,pe=0;pe<De;pe++)_e[2*pe]!==0?(j.heap[++j.heap_len]=pt=pe,j.depth[pe]=0):_e[2*pe+1]=0;for(;j.heap_len<2;)_e[2*(se=j.heap[++j.heap_len]=pt<2?++pt:0)]=1,j.depth[se]=0,j.opt_len--,be&&(j.static_len-=Oe[2*se+1]);for(ee.max_code=pt,pe=j.heap_len>>1;1<=pe;pe--)Se(j,_e,pe);for(se=De;pe=j.heap[1],j.heap[1]=j.heap[j.heap_len--],Se(j,_e,1),me=j.heap[1],j.heap[--j.heap_max]=pe,j.heap[--j.heap_max]=me,_e[2*se]=_e[2*pe]+_e[2*me],j.depth[se]=(j.depth[pe]>=j.depth[me]?j.depth[pe]:j.depth[me])+1,_e[2*pe+1]=_e[2*me+1]=se,j.heap[1]=se++,Se(j,_e,1),2<=j.heap_len;);j.heap[--j.heap_max]=j.heap[1],(function(Ze,Xt){var L,_,v,B,X,ce,H=Xt.dyn_tree,re=Xt.max_code,ze=Xt.stat_desc.static_tree,Ge=Xt.stat_desc.has_stree,qe=Xt.stat_desc.extra_bits,Le=Xt.stat_desc.extra_base,Zr=Xt.stat_desc.max_length,Tn=0;for(B=0;B<=g;B++)Ze.bl_count[B]=0;for(H[2*Ze.heap[Ze.heap_max]+1]=0,L=Ze.heap_max+1;L<p;L++)Zr<(B=H[2*H[2*(_=Ze.heap[L])+1]+1]+1)&&(B=Zr,Tn++),H[2*_+1]=B,re<_||(Ze.bl_count[B]++,X=0,Le<=_&&(X=qe[_-Le]),ce=H[2*_],Ze.opt_len+=ce*(B+X),Ge&&(Ze.static_len+=ce*(ze[2*_+1]+X)));if(Tn!==0){do{for(B=Zr-1;Ze.bl_count[B]===0;)B--;Ze.bl_count[B]--,Ze.bl_count[B+1]+=2,Ze.bl_count[Zr]--,Tn-=2}while(0<Tn);for(B=Zr;B!==0;B--)for(_=Ze.bl_count[B];_!==0;)re<(v=Ze.heap[--L])||(H[2*v+1]!==B&&(Ze.opt_len+=(B-H[2*v+1])*H[2*v],H[2*v+1]=B),_--)}})(j,ee),Ee(_e,pt,j.bl_count)}function T(j,ee,pe){var me,se,_e=-1,Oe=ee[1],be=0,De=7,pt=4;for(Oe===0&&(De=138,pt=3),ee[2*(pe+1)+1]=65535,me=0;me<=pe;me++)se=Oe,Oe=ee[2*(me+1)+1],++be<De&&se===Oe||(be<pt?j.bl_tree[2*se]+=be:se!==0?(se!==_e&&j.bl_tree[2*se]++,j.bl_tree[2*R]++):be<=10?j.bl_tree[2*E]++:j.bl_tree[2*M]++,_e=se,pt=(be=0)===Oe?(De=138,3):se===Oe?(De=6,3):(De=7,4))}function he(j,ee,pe){var me,se,_e=-1,Oe=ee[1],be=0,De=7,pt=4;for(Oe===0&&(De=138,pt=3),me=0;me<=pe;me++)if(se=Oe,Oe=ee[2*(me+1)+1],!(++be<De&&se===Oe)){if(be<pt)for(;J(j,se,j.bl_tree),--be!=0;);else se!==0?(se!==_e&&(J(j,se,j.bl_tree),be--),J(j,R,j.bl_tree),q(j,be-3,2)):be<=10?(J(j,E,j.bl_tree),q(j,be-3,3)):(J(j,M,j.bl_tree),q(j,be-11,7));_e=se,pt=(be=0)===Oe?(De=138,3):se===Oe?(De=6,3):(De=7,4)}}c(Y);var ie=!1;function K(j,ee,pe,me){q(j,(l<<1)+(me?1:0),3),(function(se,_e,Oe,be){xe(se),V(se,Oe),V(se,~Oe),s.arraySet(se.pending_buf,se.window,_e,Oe,se.pending),se.pending+=Oe})(j,ee,pe)}i._tr_init=function(j){ie||((function(){var ee,pe,me,se,_e,Oe=new Array(g+1);for(se=me=0;se<u-1;se++)for(C[se]=me,ee=0;ee<1<<S[se];ee++)k[me++]=se;for(k[me-1]=se,se=_e=0;se<16;se++)for(Y[se]=_e,ee=0;ee<1<<P[se];ee++)I[_e++]=se;for(_e>>=7;se<h;se++)for(Y[se]=_e<<7,ee=0;ee<1<<P[se]-7;ee++)I[256+_e++]=se;for(pe=0;pe<=g;pe++)Oe[pe]=0;for(ee=0;ee<=143;)G[2*ee+1]=8,ee++,Oe[8]++;for(;ee<=255;)G[2*ee+1]=9,ee++,Oe[9]++;for(;ee<=279;)G[2*ee+1]=7,ee++,Oe[7]++;for(;ee<=287;)G[2*ee+1]=8,ee++,Oe[8]++;for(Ee(G,f+1,Oe),ee=0;ee<h;ee++)O[2*ee+1]=5,O[2*ee]=fe(ee,5);z=new N(G,S,d+1,f,g),F=new N(O,P,0,h,g),Q=new N(new Array(0),W,0,m,b)})(),ie=!0),j.l_desc=new U(j.dyn_ltree,z),j.d_desc=new U(j.dyn_dtree,F),j.bl_desc=new U(j.bl_tree,Q),j.bi_buf=0,j.bi_valid=0,ke(j)},i._tr_stored_block=K,i._tr_flush_block=function(j,ee,pe,me){var se,_e,Oe=0;0<j.level?(j.strm.data_type===2&&(j.strm.data_type=(function(be){var De,pt=4093624447;for(De=0;De<=31;De++,pt>>>=1)if(1&pt&&be.dyn_ltree[2*De]!==0)return o;if(be.dyn_ltree[18]!==0||be.dyn_ltree[20]!==0||be.dyn_ltree[26]!==0)return a;for(De=32;De<d;De++)if(be.dyn_ltree[2*De]!==0)return a;return o})(j)),je(j,j.l_desc),je(j,j.d_desc),Oe=(function(be){var De;for(T(be,be.dyn_ltree,be.l_desc.max_code),T(be,be.dyn_dtree,be.d_desc.max_code),je(be,be.bl_desc),De=m-1;3<=De&&be.bl_tree[2*D[De]+1]===0;De--);return be.opt_len+=3*(De+1)+5+5+4,De})(j),se=j.opt_len+3+7>>>3,(_e=j.static_len+3+7>>>3)<=se&&(se=_e)):se=_e=pe+5,pe+4<=se&&ee!==-1?K(j,ee,pe,me):j.strategy===4||_e===se?(q(j,2+(me?1:0),3),Me(j,G,O)):(q(j,4+(me?1:0),3),(function(be,De,pt,Ze){var Xt;for(q(be,De-257,5),q(be,pt-1,5),q(be,Ze-4,4),Xt=0;Xt<Ze;Xt++)q(be,be.bl_tree[2*D[Xt]+1],3);he(be,be.dyn_ltree,De-1),he(be,be.dyn_dtree,pt-1)})(j,j.l_desc.max_code+1,j.d_desc.max_code+1,Oe+1),Me(j,j.dyn_ltree,j.dyn_dtree)),ke(j),me&&xe(j)},i._tr_tally=function(j,ee,pe){return j.pending_buf[j.d_buf+2*j.last_lit]=ee>>>8&255,j.pending_buf[j.d_buf+2*j.last_lit+1]=255&ee,j.pending_buf[j.l_buf+j.last_lit]=255&pe,j.last_lit++,ee===0?j.dyn_ltree[2*pe]++:(j.matches++,ee--,j.dyn_ltree[2*(k[pe]+d+1)]++,j.dyn_dtree[2*$(ee)]++),j.last_lit===j.lit_bufsize-1},i._tr_align=function(j){q(j,2,3),J(j,A,G),(function(ee){ee.bi_valid===16?(V(ee,ee.bi_buf),ee.bi_buf=0,ee.bi_valid=0):8<=ee.bi_valid&&(ee.pending_buf[ee.pending++]=255&ee.bi_buf,ee.bi_buf>>=8,ee.bi_valid-=8)})(j)}},{"../utils/common":41}],53:[function(r,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,n,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,d,f=1,h={},m=!1,p=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,c={}.toString.call(o.process)==="[object process]"?function(R){Rn.nextTick(function(){b(R)})}:(function(){if(o.postMessage&&!o.importScripts){var R=!0,E=o.onmessage;return o.onmessage=function(){R=!1},o.postMessage("","*"),o.onmessage=E,R}})()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",A,!1):o.attachEvent("onmessage",A),function(R){o.postMessage(d+R,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(R){b(R.data)},function(R){u.port2.postMessage(R)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(R){var E=p.createElement("script");E.onreadystatechange=function(){b(R),E.onreadystatechange=null,l.removeChild(E),E=null},l.appendChild(E)}):function(R){setTimeout(b,0,R)},g.setImmediate=function(R){typeof R!="function"&&(R=new Function(""+R));for(var E=new Array(arguments.length-1),M=0;M<E.length;M++)E[M]=arguments[M+1];var S={callback:R,args:E};return h[f]=S,c(f),f++},g.clearImmediate=y}function y(R){delete h[R]}function b(R){if(m)setTimeout(b,0,R);else{var E=h[R];if(E){m=!0;try{(function(M){var S=M.callback,P=M.args;switch(P.length){case 0:S();break;case 1:S(P[0]);break;case 2:S(P[0],P[1]);break;case 3:S(P[0],P[1],P[2]);break;default:S.apply(a,P)}})(E)}finally{y(R),m=!1}}}}function A(R){R.source===o&&typeof R.data=="string"&&R.data.indexOf(d)===0&&b(+R.data.slice(d.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Fi<"u"?Fi:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(tm)),tm.exports}var T7=A7(),rm=Xs(T7);const JA={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(JA);var An=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Vo,hc,Ks;class S7{constructor(...e){Vo.set(this,new Map),hc.set(this,new Map),Ks.set(this,new Map);for(const r of e)this.define(r)}define(e,r=!1){for(let[n,i]of Object.entries(e)){n=n.toLowerCase(),i=i.map(a=>a.toLowerCase()),An(this,Ks,"f").has(n)||An(this,Ks,"f").set(n,new Set);const s=An(this,Ks,"f").get(n);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s?.add(a),o&&An(this,hc,"f").set(n,a),o=!1,c)continue;const l=An(this,Vo,"f").get(a);if(l&&l!=n&&!r)throw new Error(`"${n} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);An(this,Vo,"f").set(a,n)}}return this}getType(e){if(typeof e!="string")return null;const r=e.replace(/^.*[/\\]/s,"").toLowerCase(),n=r.replace(/^.*\./s,"").toLowerCase(),i=r.length<e.length;return!(n.length<r.length-1)&&i?null:An(this,Vo,"f").get(n)??null}getExtension(e){return typeof e!="string"?null:(e=e?.split?.(";")[0],(e&&An(this,hc,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:An(this,Ks,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of An(this,Ks,"f").values())Object.freeze(e);return this}_getTestState(){return{types:An(this,Vo,"f"),extensions:An(this,hc,"f")}}}Vo=new WeakMap,hc=new WeakMap,Ks=new WeakMap;var R7=new S7(JA)._freeze();function O7(t,e,r){const n=G0();if(!w(n))return;const i=`@charset ${e.toLowerCase().replace(".chr","")}`,s=Xa(i,{}),o=gt(s),a=Xf(r),c=St(s);w(a)&&w(c)&&(Object.assign(c,a),Co(n,s),ia(le,t,`imported chr file ${o} into ${n.name} book`))}function I7(t,e){console.info(e)}const N7=/; \$(\w+) ?(.*)/,C7=/title (.+?) (.*)/i;function nm(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function L7(t,e){const r=G0();if(!w(r))return;const n=e.split(/\r?\n/),i={title:"",gendate:"",gentime:"",songs:[]};function s(m){return i.songs.find(p=>p.order===m)}function o(m,p){return{order:m,title:p,lines:[]}}for(let m=0;m<n.length;++m){const p=n[m],g=N7.exec(p);if(w(g)){const y=g[1].toLowerCase(),b=g[2];switch(y){case"title":i.title=b;break;case"gendate":i.gendate=b;break;case"gentime":i.gentime=b;break;case"song":{const A=C7.exec(b);if(w(A)){const R=parseFloat(A[1]),E=A[2],M=s(R);w(M)?M.title=E:i.songs.push(o(R,E))}else{const R=parseFloat(b);if(Te(R)){const E=s(R);w(E)||i.songs.push(o(R,""))}}break}}}else{const y=i.songs[i.songs.length-1];w(y)&&p.trim().length&&y.lines.push(p)}}i.songs.sort((m,p)=>m.order-p.order);const a=i.songs.map(m=>m.title),c=`@play_${Fe(i.title).replace(/\W/g,"")}
@cycle 1
@char 14
#end

:touch
"ALBUM: ${nm(i.title)}"
"$purple  ${nm(i.gendate)}"
"$purple  ${nm(i.gentime)}"
${a.map((m,p)=>`!song_${p};${p+1} ${m||"untitled"}`).join(`
`)}
#end

${i.songs.map((m,p)=>`:song_${p}
${m.lines.map(g=>`#play ${g}`).join(`
`)}
#end
`).join(`
`)}
`,l=Xa(c,{}),u=gt(l);Co(r,l),ia(le,t,`imported zzt zzm file ${u} into ${r.name} book`);const d=gt(l),f=Oi(l);bt(le,t,`!pageopen ${l.id};$blue[${f}]$white ${d}`);const h=`#put n ${u}`;sF(le,t,h,h,!1)}const Gu=60,M7=Gu*25;function U7(t,e){let r=0;const n=new DataView(e.buffer);function i(){const C=n.getUint8(r);return r++,C}function s(){const C=n.getInt16(r,!0);return r+=2,C}function o(){const C=n.getInt32(r,!0);return r+=4,C}function a(C){let z="";const F=e.subarray(r,r+C);for(let Q=0;Q<F.length;++Q)z+=String.fromCharCode(F[Q]);return r+=C,z.replace("\r",`
`)}function c(C,z,F,Q){const Y=hn(C,z,F);if(w(Y)&&w(Q)){const N=Fr(Q);for(let U=0;U<N.length;++U){const $=N[U];Y[$]=Q[$]}}}function l(C){let z="";for(let F=0;F<C.length;++F){const Q=C.charCodeAt(F);Q<32||Q>127?z+=`$${Q}`:z+=C[F]}return z}function u(C){return C.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map(z=>z.replace("$","$CENTER ")).map(l).join(`
`)}function d(C,z,F,Q,Y){const N=Q.color%16,U=Math.floor(Q.color/16)%8,$=wo(N,U),V=wo((U+8)%16,N),q={},J=Y.find(fe=>fe.x===z&&fe.y===F);if(w(J)&&(Te(J.cycle)&&J.cycle>0&&(q.cycle=J.cycle),w(J.p1)&&(q.p1=J.p1),w(J.p2)&&(q.p2=J.p2),w(J.p3)&&(q.p3=J.p3),w(J.code)&&J.code&&(q.code=u(J.code)),w(J.stepx)&&(q.stepx=J.stepx),w(J.stepy)&&(q.stepy=J.stepy),w(J.bind)&&J.bind>0)){const fe=Y[J.bind];w(fe?.code)&&ye(fe.code)&&(q.code=u(fe.code))}switch(Q.element){case 0:case 1:case 2:case 3:break;case 4:break;case 5:c(C,["ammo",$],{x:z,y:F},q);break;case 6:c(C,["torch",$],{x:z,y:F},q);break;case 7:c(C,["gem",$],{x:z,y:F},q);break;case 8:c(C,["key",$],{x:z,y:F},q);break;case 9:c(C,["door",V],{x:z,y:F},q);break;case 10:c(C,["scroll",$],{x:z,y:F},q);break;case 11:{q.p3=f(J?.p3)??"",c(C,["passage",$],{x:z,y:F},q);break}case 12:c(C,["duplicator",$],{x:z,y:F},{...q,stepx:0,stepy:0,shootx:q.stepx??0,shooty:q.stepy??0});break;case 13:c(C,["bomb",$],{x:z,y:F},q);break;case 14:c(C,["energize",$],{x:z,y:F},q);break;case 15:c(C,["star",$],{x:z,y:F},q);break;case 16:c(C,["clockwise",$],{x:z,y:F},q);break;case 17:c(C,["counter",$],{x:z,y:F},q);break;case 18:c(C,["bullet",$],{x:z,y:F},q);break;case 19:c(C,["water",$],{x:z,y:F},q);break;case 20:c(C,["forest",$],{x:z,y:F},q);break;case 21:c(C,["solid",$],{x:z,y:F},q);break;case 22:c(C,["normal",$],{x:z,y:F},q);break;case 23:c(C,["breakable",$],{x:z,y:F},q);break;case 24:c(C,["boulder",$],{x:z,y:F},q);break;case 25:c(C,["sliderns",$],{x:z,y:F},q);break;case 26:c(C,["sliderew",$],{x:z,y:F},q);break;case 27:c(C,["fake",$],{x:z,y:F},q);break;case 28:c(C,["invisible",$],{x:z,y:F},q);break;case 29:c(C,["blinkwall",$],{x:z,y:F},{...q,stepx:0,stepy:0,shootx:q.stepx??0,shooty:q.stepy??0});break;case 30:c(C,["transporter",$],{x:z,y:F},{...q,stepx:0,stepy:0,shootx:q.stepx??0,shooty:q.stepy??0});break;case 31:c(C,["line",$],{x:z,y:F},q);break;case 32:c(C,["ricochet",$],{x:z,y:F},q);break;case 33:c(C,["blinkns",$],{x:z,y:F},q);break;case 34:c(C,["bear",$],{x:z,y:F},q);break;case 35:c(C,["ruffian",$],{x:z,y:F},q);break;case 36:c(C,["object",$],{x:z,y:F},{...q,char:J?.p1??1});break;case 37:c(C,["slime",$],{x:z,y:F},q);break;case 38:c(C,["shark",$],{x:z,y:F},q);break;case 39:c(C,["spinninggun",$],{x:z,y:F},q);break;case 40:c(C,["pusher",$],{x:z,y:F},q);break;case 41:c(C,["lion",$],{x:z,y:F},q);break;case 42:c(C,["tiger",$],{x:z,y:F},q);break;case 43:c(C,["blinkns",$],{x:z,y:F},q);break;case 44:c(C,["head",$],{x:z,y:F},q);break;case 45:c(C,["segment",$],{x:z,y:F},q);break;case 46:break;case 47:c(C,["text",["WHITE","ONDKBLUE"]],{x:z,y:F},{...q,char:Q.color});break;case 48:c(C,["text",["WHITE","ONDKGREEN"]],{x:z,y:F},{...q,char:Q.color});break;case 49:c(C,["text",["WHITE","ONDKCYAN"]],{x:z,y:F},{...q,char:Q.color});break;case 50:c(C,["text",["WHITE","ONDKRED"]],{x:z,y:F},{...q,char:Q.color});break;case 51:c(C,["text",["WHITE","ONDKPURPLE"]],{x:z,y:F},{...q,char:Q.color});break;case 52:c(C,["text",["WHITE","ONDKYELLOW"]],{x:z,y:F},{...q,char:Q.color});break;case 53:c(C,["text",["WHITE","ONBLACK"]],{x:z,y:F},{...q,char:Q.color});break}}function f(C){if(Te(C)&&C>0)return`zztboard${C}`}if(s()!=-1)return;const m=s(),p=s(),g=s(),y=a(7),b=s(),A=s(),R=s(),E=s(),M=s();s();const S=s(),P=i(),W=a(20).slice(0,P);for(let C=0;C<9;C++){const z=i();a(20).slice(0,z)}const D=s(),G=s(),O=i();console.info(p,g,y,b,A,R,E,M,S,D,G,O),r=512;const I=[];for(let C=0;C<=m;++C){const z=s(),F=r,Q=i(),N={boardname:a(50).slice(0,Q),elements:[],stats:[]};for(;N.elements.length<M7;){let $=i();$===0&&($=255);const V=i(),q=i();for(let J=0;J<$;++J)N.elements.push({element:V,color:q})}N.maxplayershots=i(),N.isdark=i(),N.exitnorth=i(),N.exitsouth=i(),N.exitwest=i(),N.exiteast=i(),N.restartonzap=i(),N.messagelength=i(),N.message=a(58).slice(0,N.messagelength),N.playerenterx=i(),N.playerentery=i(),N.timelimit=s(),r+=16;const U=s()+1;for(;N.stats.length<U;){const $={};$.x=i()-1,$.y=i()-1,$.stepx=s(),$.stepy=s(),$.cycle=s(),$.p1=i(),$.p2=i(),$.p3=i(),$.follower=s(),$.leader=s(),$.underelement=i(),$.undercolor=i(),$.pointer=o(),$.currentinstruction=s();const V=s();r+=8,V<0?$.bind=Math.abs(V):$.code=a(V),N.stats.push($)}I.push(N),r=F+z}const k=op([]);k.name=W;for(let C=0;C<I.length;++C){const z=I[C],F=[`@zztboard${C}`,""];C===0?F.push("@title"):C===A&&F.push("@zztstartboard");for(let Ee=0;Ee<z.elements.length;++Ee)z.elements[Ee].element===4&&(F.push(`@startx ${Gy(Ee,Gu)}`),F.push(`@starty ${Ky(Ee,Gu)}`));Te(z.maxplayershots)&&F.push(`@maxplayershots ${z.maxplayershots}`),Te(z.isdark)&&F.push(`@isdark ${z.isdark}`),Te(z.restartonzap)&&F.push(`@restartonzap ${z.restartonzap}`),Te(z.timelimit)&&F.push(`@timelimit ${z.timelimit}`);const Q=f(z.exitnorth);ye(Q)&&F.push(`@exitnorth ${Q}`);const Y=f(z.exitsouth);ye(Y)&&F.push(`@exitsouth ${Y}`);const N=f(z.exitwest);ye(N)&&F.push(`@exitwest ${N}`);const U=f(z.exiteast);ye(U)&&F.push(`@exiteast ${U}`);const $=`@board ${String(C).padStart(3,"0")}. ${z.boardname}
${F.join(`
`)}`,V=Xa($,{});Co(k,V);const q=St(V);if(!w(q))continue;let J=0,fe=0;for(let Ee=0;Ee<z.elements.length;++Ee){const ke=z.elements[Ee];d(q,J,fe,ke,z.stats),++J,J===Gu&&(J=0,++fe)}ur(q)}Fu(k),ia(le,t,`imported zzt file into ${k.name} book`)}function $7(t,e,r){const n=G0();if(!w(n))return;const s=uu(r).name?r:`@${e.toLowerCase().replace(".obj","")}
${r}`,o=Xa(s,{}),a=gt(o);Co(n,o),ia(le,t,`imported zzt obj file ${a} into ${n.name} book`)}function QA(t,e){switch([...e.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return R7.getType(t)??"application/octet-stream"}function eT(t,e){if(!w(e))return"";switch(t){case"model/obj":return"obj";case"text/plain":return"txt";case"application/json":return"json";case"application/zip":return"zip";case"application/octet-stream":if(/.zzt$/i.test(e.name))return"zzt";if(/.brd$/i.test(e.name))return"brd";if(/.chr$/i.test(e.name))return"chr";if(/.zzl$/i.test(e.name))return"zzl";if(/.zzm$/i.test(e.name))return"zzm";break}return""}let Xo=[],Ku={};async function P7(t,e){try{Bt(le,t,"parsezipfile",e.name);const r=await e.arrayBuffer(),i=await new rm().loadAsync(r);Xo=[],Ku={};const s=[];i.forEach((o,a)=>s.push([o,a]));for(let o=0;o<s.length;++o){const[a,c]=s[o],l=await c.async("uint8array"),u=QA(a,l),d=new File([l],c.name,{type:u});Xo.push(d)}vR(le,t)}catch(r){mt(le,t,"crash",r.message)}}function F7(){const t=[];for(let e=0;e<Xo.length;++e){const r=Xo[e];t.push([eT(r.type,r),r.name])}return t}function B7(t,e){Ku[t.toLowerCase()]=e}function D7(t){return Ku[t.toLowerCase()]}async function j7(t){for(let e=0;e<Xo.length;++e){const r=Xo[e];Ku[r.name.toLowerCase()]&&(im(t,r),await Ac(2e3))}await Ac(2e3),Lh(le,t)}function tT(t,e,r){if(!w(r))return;switch(eT(e,r)){case"obj":r.text().then(i=>$7(t,r.name,i)).catch(i=>mt(le,t,"crash",i.message));break;case"txt":r.text().then(i=>Mh(le,t,void 0,"text",`file:${r.name}`,i)).catch(i=>mt(le,t,"crash",i.message));break;case"json":r.text().then(i=>Mh(le,t,void 0,"json",`file:${r.name}`,i)).catch(i=>mt(le,t,"crash",i.message));break;case"zip":P7(t,r).catch(i=>mt(le,t,"crash",i.message));break;case"zzt":r.arrayBuffer().then(i=>{U7(t,new Uint8Array(i))}).catch(i=>mt(le,t,"crash",i.message));break;case"brd":r.arrayBuffer().then(i=>{}).catch(i=>mt(le,t,"crash",i.message));break;case"chr":r.arrayBuffer().then(i=>{O7(t,r.name,new Uint8Array(i))}).catch(i=>mt(le,t,"crash",i.message));break;case"zzl":r.text().then(i=>{I7(t,i)}).catch(i=>mt(le,t,"crash",i.message));break;case"zzm":r.text().then(i=>{L7(t,i)}).catch(i=>mt(le,t,"crash",i.message));break;default:e||r.arrayBuffer().then(i=>{const s=QA(r.name,new Uint8Array(i));if(s)tT(t,s,r);else return mt(le,t,"parsewebfile",`unsupported file ${r.name}`)}).catch(i=>mt(le,t,"crash",i.message));return}}function im(t,e){tT(t,e?.type??"",e)}function sm(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var qs=sm();function rT(t){qs=t}var fc={exec:()=>null};function yt(t,e=""){let r=typeof t=="string"?t:t.source,n={replace:(i,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(Ur.caret,"$1"),r=r.replace(i,o),n},getRegex:()=>new RegExp(r,e)};return n}var Ur={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},z7=/^(?:[ \t]*(?:\n|$))+/,W7=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,H7=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,dc=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,G7=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,om=/(?:[*+-]|\d{1,9}[.)])/,nT=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,iT=yt(nT).replace(/bull/g,om).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),K7=yt(nT).replace(/bull/g,om).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),am=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,q7=/^[^\n]+/,cm=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Y7=yt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",cm).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),V7=yt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,om).getRegex(),qu="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",lm=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,X7=yt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",lm).replace("tag",qu).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),sT=yt(am).replace("hr",dc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qu).getRegex(),Z7=yt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",sT).getRegex(),um={blockquote:Z7,code:W7,def:Y7,fences:H7,heading:G7,hr:dc,html:X7,lheading:iT,list:V7,newline:z7,paragraph:sT,table:fc,text:q7},oT=yt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",dc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qu).getRegex(),J7={...um,lheading:K7,table:oT,paragraph:yt(am).replace("hr",dc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",oT).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",qu).getRegex()},Q7={...um,html:yt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",lm).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:fc,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:yt(am).replace("hr",dc).replace("heading",` *#{1,6} *[^
]`).replace("lheading",iT).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},eW=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,tW=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,aT=/^( {2,}|\\)\n(?!\s*$)/,rW=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Yu=/[\p{P}\p{S}]/u,hm=/[\s\p{P}\p{S}]/u,cT=/[^\s\p{P}\p{S}]/u,nW=yt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,hm).getRegex(),lT=/(?!~)[\p{P}\p{S}]/u,iW=/(?!~)[\s\p{P}\p{S}]/u,sW=/(?:[^\s\p{P}\p{S}]|~)/u,oW=/\[[^\[\]]*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,uT=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,aW=yt(uT,"u").replace(/punct/g,Yu).getRegex(),cW=yt(uT,"u").replace(/punct/g,lT).getRegex(),hT="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",lW=yt(hT,"gu").replace(/notPunctSpace/g,cT).replace(/punctSpace/g,hm).replace(/punct/g,Yu).getRegex(),uW=yt(hT,"gu").replace(/notPunctSpace/g,sW).replace(/punctSpace/g,iW).replace(/punct/g,lT).getRegex(),hW=yt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,cT).replace(/punctSpace/g,hm).replace(/punct/g,Yu).getRegex(),fW=yt(/\\(punct)/,"gu").replace(/punct/g,Yu).getRegex(),dW=yt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),pW=yt(lm).replace("(?:-->|$)","-->").getRegex(),mW=yt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",pW).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Vu=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`[^`]*`|[^\[\]\\`])*?/,gW=yt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Vu).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),fT=yt(/^!?\[(label)\]\[(ref)\]/).replace("label",Vu).replace("ref",cm).getRegex(),dT=yt(/^!?\[(ref)\](?:\[\])?/).replace("ref",cm).getRegex(),yW=yt("reflink|nolink(?!\\()","g").replace("reflink",fT).replace("nolink",dT).getRegex(),fm={_backpedal:fc,anyPunctuation:fW,autolink:dW,blockSkip:oW,br:aT,code:tW,del:fc,emStrongLDelim:aW,emStrongRDelimAst:lW,emStrongRDelimUnd:hW,escape:eW,link:gW,nolink:dT,punctuation:nW,reflink:fT,reflinkSearch:yW,tag:mW,text:rW,url:fc},_W={...fm,link:yt(/^!?\[(label)\]\((.*?)\)/).replace("label",Vu).getRegex(),reflink:yt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Vu).getRegex()},dm={...fm,emStrongRDelimAst:uW,emStrongLDelim:cW,url:yt(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},bW={...dm,br:yt(aT).replace("{2,}","*").getRegex(),text:yt(dm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Xu={normal:um,gfm:J7,pedantic:Q7},pc={normal:fm,gfm:dm,breaks:bW,pedantic:_W},wW={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},pT=t=>wW[t];function di(t,e){if(e){if(Ur.escapeTest.test(t))return t.replace(Ur.escapeReplace,pT)}else if(Ur.escapeTestNoEncode.test(t))return t.replace(Ur.escapeReplaceNoEncode,pT);return t}function mT(t){try{t=encodeURI(t).replace(Ur.percentDecode,"%")}catch{return null}return t}function gT(t,e){let r=t.replace(Ur.findPipe,(s,o,a)=>{let c=!1,l=o;for(;--l>=0&&a[l]==="\\";)c=!c;return c?"|":" |"}),n=r.split(Ur.splitPipe),i=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(Ur.slashPipe,"|");return n}function mc(t,e,r){let n=t.length;if(n===0)return"";let i=0;for(;i<n&&t.charAt(n-i-1)===e;)i++;return t.slice(0,n-i)}function kW(t,e){if(t.indexOf(e[1])===-1)return-1;let r=0;for(let n=0;n<t.length;n++)if(t[n]==="\\")n++;else if(t[n]===e[0])r++;else if(t[n]===e[1]&&(r--,r<0))return n;return r>0?-2:-1}function yT(t,e,r,n,i){let s=e.href,o=e.title||null,a=t[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let c={type:t[0].charAt(0)==="!"?"image":"link",raw:r,href:s,title:o,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,c}function vW(t,e,r){let n=t.match(r.other.indentCodeCompensation);if(n===null)return e;let i=n[1];return e.split(`
`).map(s=>{let o=s.match(r.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=i.length?s.slice(i.length):s}).join(`
`)}var Zu=class{options;rules;lexer;constructor(t){this.options=t||qs}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let r=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?r:mc(r,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let r=e[0],n=vW(r,e[3]||"",this.rules);return{type:"code",raw:r,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:n}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let r=e[2].trim();if(this.rules.other.endingHash.test(r)){let n=mc(r,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(r=n.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:r,tokens:this.lexer.inline(r)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:mc(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let r=mc(e[0],`
`).split(`
`),n="",i="",s=[];for(;r.length>0;){let o=!1,a=[],c;for(c=0;c<r.length;c++)if(this.rules.other.blockquoteStart.test(r[c]))a.push(r[c]),o=!0;else if(!o)a.push(r[c]);else break;r=r.slice(c);let l=a.join(`
`),u=l.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${l}`:l,i=i?`${i}
${u}`:u;let d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,s,!0),this.lexer.state.top=d,r.length===0)break;let f=s.at(-1);if(f?.type==="code")break;if(f?.type==="blockquote"){let h=f,m=h.raw+`
`+r.join(`
`),p=this.blockquote(m);s[s.length-1]=p,n=n.substring(0,n.length-h.raw.length)+p.raw,i=i.substring(0,i.length-h.text.length)+p.text;break}else if(f?.type==="list"){let h=f,m=h.raw+`
`+r.join(`
`),p=this.list(m);s[s.length-1]=p,n=n.substring(0,n.length-f.raw.length)+p.raw,i=i.substring(0,i.length-h.raw.length)+p.raw,r=m.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:s,text:i}}}list(t){let e=this.rules.block.list.exec(t);if(e){let r=e[1].trim(),n=r.length>1,i={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");let s=this.rules.other.listItemRegex(r),o=!1;for(;t;){let c=!1,l="",u="";if(!(e=s.exec(t))||this.rules.block.hr.test(t))break;l=e[0],t=t.substring(l.length);let d=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,y=>" ".repeat(3*y.length)),f=t.split(`
`,1)[0],h=!d.trim(),m=0;if(this.options.pedantic?(m=2,u=d.trimStart()):h?m=e[1].length+1:(m=e[2].search(this.rules.other.nonSpaceChar),m=m>4?1:m,u=d.slice(m),m+=e[1].length),h&&this.rules.other.blankLine.test(f)&&(l+=f+`
`,t=t.substring(f.length+1),c=!0),!c){let y=this.rules.other.nextBulletRegex(m),b=this.rules.other.hrRegex(m),A=this.rules.other.fencesBeginRegex(m),R=this.rules.other.headingBeginRegex(m),E=this.rules.other.htmlBeginRegex(m);for(;t;){let M=t.split(`
`,1)[0],S;if(f=M,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),S=f):S=f.replace(this.rules.other.tabCharGlobal,"    "),A.test(f)||R.test(f)||E.test(f)||y.test(f)||b.test(f))break;if(S.search(this.rules.other.nonSpaceChar)>=m||!f.trim())u+=`
`+S.slice(m);else{if(h||d.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||A.test(d)||R.test(d)||b.test(d))break;u+=`
`+f}!h&&!f.trim()&&(h=!0),l+=M+`
`,t=t.substring(M.length+1),d=S.slice(m)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(l)&&(o=!0));let p=null,g;this.options.gfm&&(p=this.rules.other.listIsTask.exec(u),p&&(g=p[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:l,task:!!p,checked:g,loose:!1,text:u,tokens:[]}),i.raw+=l}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let l=i.items[c].tokens.filter(d=>d.type==="space"),u=l.length>0&&l.some(d=>this.rules.other.anyLine.test(d.raw));i.loose=u}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let r=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:r,raw:e[0],href:n,title:i}}}table(t){let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let r=gT(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(r.length===n.length){for(let o of n)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<r.length;o++)s.header.push({text:r[o],tokens:this.lexer.inline(r[o]),header:!0,align:s.align[o]});for(let o of i)s.rows.push(gT(o,s.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:s.align[c]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let r=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:r,tokens:this.lexer.inline(r)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let r=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(r)){if(!this.rules.other.endAngleBracket.test(r))return;let s=mc(r.slice(0,-1),"\\");if((r.length-s.length)%2===0)return}else{let s=kW(e[2],"()");if(s===-2)return;if(s>-1){let o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let n=e[2],i="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(n);s&&(n=s[1],i=s[3])}else i=e[3]?e[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(r)?n=n.slice(1):n=n.slice(1,-1)),yT(e,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let r;if((r=this.rules.inline.reflink.exec(t))||(r=this.rules.inline.nolink.exec(t))){let n=(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[n.toLowerCase()];if(!i){let s=r[0].charAt(0);return{type:"text",raw:s,text:s}}return yT(r,i,r[0],this.lexer,this.rules)}}emStrong(t,e,r=""){let n=this.rules.inline.emStrongLDelim.exec(t);if(!(!n||n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!r||this.rules.inline.punctuation.exec(r))){let i=[...n[0]].length-1,s,o,a=i,c=0,l=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,e=e.slice(-1*t.length+i);(n=l.exec(e))!=null;){if(s=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!s)continue;if(o=[...s].length,n[3]||n[4]){a+=o;continue}else if((n[5]||n[6])&&i%3&&!((i+o)%3)){c+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+c);let u=[...n[0]][0].length,d=t.slice(0,i+n.index+u+o);if(Math.min(i,o)%2){let h=d.slice(1,-1);return{type:"em",raw:d,text:h,tokens:this.lexer.inlineTokens(h)}}let f=d.slice(2,-2);return{type:"strong",raw:d,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let r=e[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(r),i=this.rules.other.startingSpaceChar.test(r)&&this.rules.other.endingSpaceChar.test(r);return n&&i&&(r=r.substring(1,r.length-1)),{type:"codespan",raw:e[0],text:r}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let r,n;return e[2]==="@"?(r=e[1],n="mailto:"+r):(r=e[1],n=r),{type:"link",raw:e[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let r,n;if(e[2]==="@")r=e[0],n="mailto:"+r;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);r=e[0],e[1]==="www."?n="http://"+e[0]:n=e[0]}return{type:"link",raw:e[0],text:r,href:n,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let r=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:r}}}},$i=class Im{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||qs,this.options.tokenizer=this.options.tokenizer||new Zu,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let r={other:Ur,block:Xu.normal,inline:pc.normal};this.options.pedantic?(r.block=Xu.pedantic,r.inline=pc.pedantic):this.options.gfm&&(r.block=Xu.gfm,this.options.breaks?r.inline=pc.breaks:r.inline=pc.gfm),this.tokenizer.rules=r}static get rules(){return{block:Xu,inline:pc}}static lex(e,r){return new Im(r).lex(e)}static lexInline(e,r){return new Im(r).inlineTokens(e)}lex(e){e=e.replace(Ur.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){let n=this.inlineQueue[r];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,r=[],n=!1){for(this.options.pedantic&&(e=e.replace(Ur.tabCharGlobal,"    ").replace(Ur.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},e,r))?(e=e.substring(i.raw.length),r.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let o=r.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:r.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):r.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let o=r.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},r.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),r.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let o=1/0,a=e.slice(1),c;this.options.extensions.startBlock.forEach(l=>{c=l.call({lexer:this},a),typeof c=="number"&&c>=0&&(o=Math.min(o,c))}),o<1/0&&o>=0&&(s=e.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let o=r.at(-1);n&&o?.type==="paragraph"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(i),n=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let o=r.at(-1);o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):r.push(i);continue}if(e){let o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,r}inline(e,r=[]){return this.inlineQueue.push({src:e,tokens:r}),r}inlineTokens(e,r=[]){let n=e,i=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)a.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let s=!1,o="";for(;e;){s||(o=""),s=!1;let a;if(this.options.extensions?.inline?.some(l=>(a=l.call({lexer:this},e,r))?(e=e.substring(a.raw.length),r.push(a),!0):!1))continue;if(a=this.tokenizer.escape(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.tag(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.link(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(a.raw.length);let l=r.at(-1);a.type==="text"&&l?.type==="text"?(l.raw+=a.raw,l.text+=a.text):r.push(a);continue}if(a=this.tokenizer.emStrong(e,n,o)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.codespan(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.br(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.del(e)){e=e.substring(a.raw.length),r.push(a);continue}if(a=this.tokenizer.autolink(e)){e=e.substring(a.raw.length),r.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(e))){e=e.substring(a.raw.length),r.push(a);continue}let c=e;if(this.options.extensions?.startInline){let l=1/0,u=e.slice(1),d;this.options.extensions.startInline.forEach(f=>{d=f.call({lexer:this},u),typeof d=="number"&&d>=0&&(l=Math.min(l,d))}),l<1/0&&l>=0&&(c=e.substring(0,l+1))}if(a=this.tokenizer.inlineText(c)){e=e.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(o=a.raw.slice(-1)),s=!0;let l=r.at(-1);l?.type==="text"?(l.raw+=a.raw,l.text+=a.text):r.push(a);continue}if(e){let l="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return r}},Ju=class{options;parser;constructor(t){this.options=t||qs}space(t){return""}code({text:t,lang:e,escaped:r}){let n=(e||"").match(Ur.notSpaceStart)?.[0],i=t.replace(Ur.endingNewline,"")+`
`;return n?'<pre><code class="language-'+di(n)+'">'+(r?i:di(i,!0))+`</code></pre>
`:"<pre><code>"+(r?i:di(i,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,r=t.start,n="";for(let o=0;o<t.items.length;o++){let a=t.items[o];n+=this.listitem(a)}let i=e?"ol":"ul",s=e&&r!==1?' start="'+r+'"':"";return"<"+i+s+`>
`+n+"</"+i+`>
`}listitem(t){let e="";if(t.task){let r=this.checkbox({checked:!!t.checked});t.loose?t.tokens[0]?.type==="paragraph"?(t.tokens[0].text=r+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=r+" "+di(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):e+=r+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",r="";for(let i=0;i<t.header.length;i++)r+=this.tablecell(t.header[i]);e+=this.tablerow({text:r});let n="";for(let i=0;i<t.rows.length;i++){let s=t.rows[i];r="";for(let o=0;o<s.length;o++)r+=this.tablecell(s[o]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+n+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${di(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:r}){let n=this.parser.parseInline(r),i=mT(t);if(i===null)return n;t=i;let s='<a href="'+t+'"';return e&&(s+=' title="'+di(e)+'"'),s+=">"+n+"</a>",s}image({href:t,title:e,text:r,tokens:n}){n&&(r=this.parser.parseInline(n,this.parser.textRenderer));let i=mT(t);if(i===null)return di(r);t=i;let s=`<img src="${t}" alt="${r}"`;return e&&(s+=` title="${di(e)}"`),s+=">",s}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:di(t.text)}},pm=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},Pi=class Nm{options;renderer;textRenderer;constructor(e){this.options=e||qs,this.options.renderer=this.options.renderer||new Ju,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new pm}static parse(e,r){return new Nm(r).parse(e)}static parseInline(e,r){return new Nm(r).parseInline(e)}parse(e,r=!0){let n="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=s,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){n+=c||"";continue}}let o=s;switch(o.type){case"space":{n+=this.renderer.space(o);continue}case"hr":{n+=this.renderer.hr(o);continue}case"heading":{n+=this.renderer.heading(o);continue}case"code":{n+=this.renderer.code(o);continue}case"table":{n+=this.renderer.table(o);continue}case"blockquote":{n+=this.renderer.blockquote(o);continue}case"list":{n+=this.renderer.list(o);continue}case"html":{n+=this.renderer.html(o);continue}case"def":{n+=this.renderer.def(o);continue}case"paragraph":{n+=this.renderer.paragraph(o);continue}case"text":{let a=o,c=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],c+=`
`+this.renderer.text(a);r?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(e,r=this.renderer){let n="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){n+=a||"";continue}}let o=s;switch(o.type){case"escape":{n+=r.text(o);break}case"html":{n+=r.html(o);break}case"link":{n+=r.link(o);break}case"image":{n+=r.image(o);break}case"strong":{n+=r.strong(o);break}case"em":{n+=r.em(o);break}case"codespan":{n+=r.codespan(o);break}case"br":{n+=r.br(o);break}case"del":{n+=r.del(o);break}case"text":{n+=r.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}},Qu=class{options;block;constructor(t){this.options=t||qs}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?$i.lex:$i.lexInline}provideParser(){return this.block?Pi.parse:Pi.parseInline}},xW=class{defaults=sm();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Pi;Renderer=Ju;TextRenderer=pm;Lexer=$i;Tokenizer=Zu;Hooks=Qu;constructor(...t){this.use(...t)}walkTokens(t,e){let r=[];for(let n of t)switch(r=r.concat(e.call(this,n)),n.type){case"table":{let i=n;for(let s of i.header)r=r.concat(this.walkTokens(s.tokens,e));for(let s of i.rows)for(let o of s)r=r.concat(this.walkTokens(o.tokens,e));break}case"list":{let i=n;r=r.concat(this.walkTokens(i.items,e));break}default:{let i=n;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let o=i[s].flat(1/0);r=r.concat(this.walkTokens(o,e))}):i.tokens&&(r=r.concat(this.walkTokens(i.tokens,e)))}}return r}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(r=>{let n={...r};if(n.async=this.defaults.async||n.async||!1,r.extensions&&(r.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let s=e.renderers[i.name];s?e.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[i.level];s?s.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),n.extensions=e),r.renderer){let i=this.defaults.renderer||new Ju(this.defaults);for(let s in r.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=r.renderer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u||""}}n.renderer=i}if(r.tokenizer){let i=this.defaults.tokenizer||new Zu(this.defaults);for(let s in r.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=r.tokenizer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}n.tokenizer=i}if(r.hooks){let i=this.defaults.hooks||new Qu;for(let s in r.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=r.hooks[o],c=i[o];Qu.passThroughHooks.has(s)?i[o]=l=>{if(this.defaults.async)return Promise.resolve(a.call(i,l)).then(d=>c.call(i,d));let u=a.call(i,l);return c.call(i,u)}:i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}n.hooks=i}if(r.walkTokens){let i=this.defaults.walkTokens,s=r.walkTokens;n.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...n}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return $i.lex(t,e??this.defaults)}parser(t,e){return Pi.parse(t,e??this.defaults)}parseMarkdown(t){return(e,r)=>{let n={...r},i={...this.defaults,...n},s=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&n.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=t);let o=i.hooks?i.hooks.provideLexer():t?$i.lex:$i.lexInline,a=i.hooks?i.hooks.provideParser():t?Pi.parse:Pi.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(e):e).then(c=>o(c,i)).then(c=>i.hooks?i.hooks.processAllTokens(c):c).then(c=>i.walkTokens?Promise.all(this.walkTokens(c,i.walkTokens)).then(()=>c):c).then(c=>a(c,i)).then(c=>i.hooks?i.hooks.postprocess(c):c).catch(s);try{i.hooks&&(e=i.hooks.preprocess(e));let c=o(e,i);i.hooks&&(c=i.hooks.processAllTokens(c)),i.walkTokens&&this.walkTokens(c,i.walkTokens);let l=a(c,i);return i.hooks&&(l=i.hooks.postprocess(l)),l}catch(c){return s(c)}}}onError(t,e){return r=>{if(r.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let n="<p>An error occurred:</p><pre>"+di(r.message+"",!0)+"</pre>";return e?Promise.resolve(n):n}if(e)return Promise.reject(r);throw r}}},Ys=new xW;function _t(t,e){return Ys.parse(t,e)}_t.options=_t.setOptions=function(t){return Ys.setOptions(t),_t.defaults=Ys.defaults,rT(_t.defaults),_t},_t.getDefaults=sm,_t.defaults=qs,_t.use=function(...t){return Ys.use(...t),_t.defaults=Ys.defaults,rT(_t.defaults),_t},_t.walkTokens=function(t,e){return Ys.walkTokens(t,e)},_t.parseInline=Ys.parseInline,_t.Parser=Pi,_t.parser=Pi.parse,_t.Renderer=Ju,_t.TextRenderer=pm,_t.Lexer=$i,_t.lexer=$i.lex,_t.Tokenizer=Zu,_t.Hooks=Qu,_t.parse=_t,_t.options,_t.setOptions,_t.use,_t.walkTokens,_t.parseInline,Pi.parse,$i.lex;const eh="$dkpurple",EW="$196",AW="$205";function _T(t,e){const r=EW.repeat(e);Ie(t,`${eh}${r}`)}function TW(t,e){const r=AW.repeat(e);Ie(t,`${eh}${r}`)}function SW(t,e){Ie(t,`${eh} ${" ".repeat(e.length)} `),_T(t,e.length+2),Ie(t,`${eh} $white${e} `),TW(t,e.length+2)}function bT(t,e,r){const n=e.split(" ");switch(Fe(n[0]??"")){case"copyit":Be(t,"refscroll",r,["",n[0]??"",n[1]??""]);break;default:{switch(Fe(n[1]??"")){case"hk":case"hotkey":Be(t,"refscroll",r,[n[0]??"",n[1]??"",n[2]??"",` ${n[3]??""} `,n[4]??""]);break;default:Be(t,"refscroll",r,[n[0]??""]);break}break}}}function ns(t,e){switch(e.type){default:console.info("unknown",e);break;case"heading":SW(t,e.text),Ie(t," ");break;case"hr":Ie(t," "),_T(t,10),Ie(t," ");break;case"paragraph":for(let r=0;r<(e.tokens?.length??0);++r)w(e.tokens?.[r])&&ns(t,e.tokens[r]);break;case"code":e.text.split(`
`).forEach(r=>Ie(t,r.replace(/\s+/g," ").trim()));break;case"text":Ie(t,e.text);break;case"link":{const[r,...n]=e.text.split("|").map(s=>s.trim()),i=[...n,e.href??""];bT(t,i.join(" "),r);break}case"image":bT(t,`openit ${e.href}`,`show ${e.title??e.href}`);break;case"blockquote":e.text.split(`
`).forEach(r=>{Ie(t,`$dkpurple$221$white  ${r}`)}),Ie(t," ");break;case"list":for(let r=0;r<(e.items?.length??0);++r)w(e.items?.[r])&&ns(t,e.items[r]);Ie(t," ");break;case"list_item":Ie(t,` $grey$7 ${e.text}`);break}}function RW(t,e){_t.use({pedantic:!1,gfm:!0,breaks:!1,renderer:{heading(r){return ns(t,r),""},blockquote(r){return ns(t,r),""},hr(r){return ns(t,r),""},list(r){return ns(t,r),""},listitem(r){return ns(t,r),""},paragraph(r){return ns(t,r),""}}}),_t.parse(e)}const th="https://bridge.zed.cafe";async function OW(t,e,r){const n=`offset=${r}&${t}=${e}`,i=new Request(`${th}/api/v1/search/files/?${n}`);return(await(await fetch(i)).json()).data.results}async function IW(){const t=new Request(`${th}/api/v1/get/random-file/`);return[(await(await fetch(t)).json()).data]}function NW(t){return`${th}/static/${t}`}async function CW(t,e){const n=await(await fetch(`${th}/zgames/${e}`)).arrayBuffer(),i=new File([n],e);im(t,i)}function $r(t,e,r){r().catch(n=>{console.error(n),mt(t,e,"crash",n?.message)})}function LW(t){const[e,r]=t.split(":"),n=w(r);return[n?e:"self",n?r:t]}var we=typeof we<"u"?we:{},gc={},is;for(is in we)we.hasOwnProperty(is)&&(gc[is]=we[is]);var Zo=we.printErr||console.warn.bind(console);for(is in gc)gc.hasOwnProperty(is)&&(we[is]=gc[is]);var mm=(t,e)=>{throw e};gc=null,we.arguments&&we.arguments,we.thisProgram&&(thisProgram=we.thisProgram),we.quit&&(mm=we.quit),typeof WebAssembly!="object"&&gm("no native wasm support detected");var rh,nh=!1,ih,wT;function kT(){var t=rh.buffer;we.HEAP8=new Int8Array(t),we.HEAPU8=wT=new Uint8Array(t)}var vT=[],xT=[],ET=[];function MW(){if(we.preRun)for(typeof we.preRun=="function"&&(we.preRun=[we.preRun]);we.preRun.length;)PW(we.preRun.shift());ym(vT)}function UW(){ym(xT)}function $W(){if(we.postRun)for(typeof we.postRun=="function"&&(we.postRun=[we.postRun]);we.postRun.length;)BW(we.postRun.shift());ym(ET)}function PW(t){vT.unshift(t)}function FW(t){xT.unshift(t)}function BW(t){ET.unshift(t)}var Vs=0,yc=null;function DW(t){var e;Vs++,(e=we.monitorRunDependencies)===null||e===void 0||e.call(we,Vs)}function jW(t){var e;if(Vs--,(e=we.monitorRunDependencies)===null||e===void 0||e.call(we,Vs),Vs==0&&yc){var r=yc;yc=null,r()}}function gm(t){var e;(e=we.onAbort)===null||e===void 0||e.call(we,t),t="Aborted("+t+")",Zo(t),nh=!0,t+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(t);throw r}function zW(){return{a:nH}}function WW(t){return fetch(t,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+t+"'";return e.arrayBuffer()})}function HW(t){var e=zW();function r(a,c){return yr=a.exports,rh=yr.f,kT(),FW(yr.g),jW(),yr}DW();function n(a){r(a.instance)}function i(a){return WW(t).then(function(c){var l=WebAssembly.instantiate(c,e);return l}).then(a,function(c){Zo("failed to asynchronously prepare wasm: "+c),gm(c)})}function s(){return t&&t.byteLength>0?WebAssembly.instantiate(t,e).then(n,function(a){Zo("wasm compile failed: "+a)}):typeof WebAssembly.instantiateStreaming=="function"&&typeof t=="string"&&typeof fetch=="function"?fetch(t,{credentials:"same-origin"}).then(function(a){var c=WebAssembly.instantiateStreaming(a,e);return c.then(n,function(l){return Zo("wasm streaming compile failed: "+l),Zo("falling back to ArrayBuffer instantiation"),i(n)})}):i(n)}if(we.instantiateWasm)try{var o=we.instantiateWasm(e,r);return o}catch(a){return Zo("Module.instantiateWasm callback failed with error: "+a),!1}return s(),{}}class AT{constructor(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}}var ym=t=>{for(;t.length>0;)t.shift()(we)},TT=we.noExitRuntime||!0,GW=()=>gm(""),ST=0,KW=()=>{TT=!1,ST=0},_c={},RT=t=>{if(t instanceof AT||t=="unwind")return ih;mm(1,t)},OT=()=>TT||ST>0,IT=t=>{var e;ih=t,OT()||((e=we.onExit)===null||e===void 0||e.call(we,t),nh=!0),mm(t,new AT(t))},qW=(t,e)=>{ih=t,IT(t)},YW=qW,VW=()=>{if(!OT())try{YW(ih)}catch(t){RT(t)}},XW=t=>{if(!nh)try{t(),VW()}catch(e){RT(e)}},ZW=()=>performance.now(),JW=(t,e)=>{if(_c[t]&&(clearTimeout(_c[t].id),delete _c[t]),!e)return 0;var r=setTimeout(()=>{delete _c[t],XW(()=>NT(t,ZW()))},e);return _c[t]={id:r,timeout_ms:e},0},QW=()=>2147483648,eH=(t,e)=>Math.ceil(t/e)*e,tH=t=>{var e=rh.buffer,r=(t-e.byteLength+65535)/65536|0;try{return rh.grow(r),kT(),1}catch{}},rH=t=>{var e=wT.length;t>>>=0;var r=QW();if(t>r)return!1;for(var n=1;n<=4;n*=2){var i=e*(1+.2/n);i=Math.min(i,t+100663296);var s=Math.min(r,eH(Math.max(t,i),65536)),o=tH(s);if(o)return!0}return!1},nH={c:GW,b:KW,d:JW,e:rH,a:IT},yr;we._ZSTD_isError=t=>(we._ZSTD_isError=yr.h)(t),we._ZSTD_compressBound=t=>(we._ZSTD_compressBound=yr.i)(t),we._ZSTD_createCCtx=()=>(we._ZSTD_createCCtx=yr.j)(),we._ZSTD_freeCCtx=t=>(we._ZSTD_freeCCtx=yr.k)(t),we._ZSTD_compress_usingDict=(t,e,r,n,i,s,o,a)=>(we._ZSTD_compress_usingDict=yr.l)(t,e,r,n,i,s,o,a),we._ZSTD_compress=(t,e,r,n,i)=>(we._ZSTD_compress=yr.m)(t,e,r,n,i),we._ZSTD_createDCtx=()=>(we._ZSTD_createDCtx=yr.n)(),we._ZSTD_freeDCtx=t=>(we._ZSTD_freeDCtx=yr.o)(t),we._ZSTD_getFrameContentSize=(t,e)=>(we._ZSTD_getFrameContentSize=yr.p)(t,e),we._ZSTD_decompress_usingDict=(t,e,r,n,i,s,o)=>(we._ZSTD_decompress_usingDict=yr.q)(t,e,r,n,i,s,o),we._ZSTD_decompress=(t,e,r,n)=>(we._ZSTD_decompress=yr.r)(t,e,r,n),we._malloc=t=>(we._malloc=yr.s)(t),we._free=t=>(we._free=yr.t)(t);var NT=(t,e)=>(NT=yr.v)(t,e),sh;yc=function t(){sh||CT(),sh||(yc=t)};function CT(){if(Vs>0||(MW(),Vs>0))return;function t(){var e;sh||(sh=!0,we.calledRun=!0,!nh&&(UW(),(e=we.onRuntimeInitialized)===null||e===void 0||e.call(we),$W()))}we.setStatus?(we.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>we.setStatus(""),1),t()},1)):t()}if(we.run=CT,we.preInit)for(typeof we.preInit=="function"&&(we.preInit=[we.preInit]);we.preInit.length>0;)we.preInit.pop()();we.init=HW;var iH=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(d){o(d)}}function c(u){try{l(n.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const sH=new Promise(t=>{we.onRuntimeInitialized=t}),oH=()=>iH(void 0,void 0,void 0,function*(){yield sH}),LT=t=>{const e=we._ZSTD_isError;return e(t)},aH=(t,e)=>{const r=we._ZSTD_getFrameContentSize;return r(t,e)},cH=(t,e={defaultHeapSize:1024*1024})=>{const r=we._malloc,n=r(t.byteLength);we.HEAP8.set(t,n);const i=aH(n,t.byteLength),s=i===-1?e.defaultHeapSize:i,o=we._free,a=r(s);try{const c=we._ZSTD_decompress,l=c(a,s,n,t.byteLength);if(LT(l))throw new Error(`Failed to compress with code ${l}`);const u=new Uint8Array(we.HEAPU8.buffer,a,l).slice();return o(a,s),o(n,t.byteLength),u}catch(c){throw o(a,s),o(n,t.byteLength),c}},lH=t=>{const e=we._ZSTD_compressBound;return e(t)},uH=(t,e)=>{const r=lH(t.byteLength),n=we._malloc,i=n(r),s=n(t.byteLength);we.HEAP8.set(t,s);const o=we._free;try{const a=we._ZSTD_compress,c=a(i,r,s,t.byteLength,e??3);if(LT(c))throw new Error(`Failed to compress with code ${c}`);const l=new Uint8Array(we.HEAPU8.buffer,i,c).slice();return o(i,r),o(s,t.byteLength),l}catch(a){throw o(i,r),o(s,t.byteLength),a}};var hH=function(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(d){o(d)}}function c(u){try{l(n.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(t,e||[])).next())})};const fH=t=>hH(void 0,void 0,void 0,function*(){const e=new URL("/assets/zstd-CV7N7xSg.wasm",self.location.href).href;we.init(e),yield oH()});let MT=!1;async function UT(){MT||(await fH(),MT=!0)}function dH(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r="=".repeat((4-e.length%4)%4);return e+r}function pH(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const mH=new Date("1980/09/02");async function _m(t){await UT(),console.info("saved",t);const e=new rm;for(let n=0;n<t.length;++n){const i=t[n],s=rP(i);if(s){const o=yC(s);if(w(o)){const a=uH(o,15);e.file(i.id,a,{date:mH})}}}const r=await e.generateAsync({type:"base64",compression:"STORE"});return pH(r)}async function gH(t){await UT();const e=dH(t),r=await rm.loadAsync(e,{base64:!0}),n=[],i=[];r.forEach((s,o)=>i.push(o));for(let s=0;s<i.length;++s){const o=i[s],a=await o.async("uint8array");if(w(a))try{const c=cH(a),l=Vf(c);if(w(l)){const u=cp(l);w(u)&&n.push(u)}}catch{const l=Vf(a);if(w(l)){const u=cp(l);w(u)&&n.push(u)}}else{const c=await o.async("string"),l=Vf(c);if(w(l)){const u=cp(l);w(u)&&n.push(u)}}}return n}function yH(t,e,r,n){const i=Kt(t);if(!w(i))return;let s=0;function o(){return s}function a(l,u){Te(u)&&(s=u,Yy(e.x,e.y,r.x,r.y).forEach(d=>{const f=nt(i,d);w(f)&&(f[l]=u)}))}Ie(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt),Be(t,`batch:${yo(e,r)}`,"char",[n,"charedit"],o,a);const c=Rt(t);c.scrollname="bulk set char",c.scroll=ir(t)}function _H(t,e,r,n){const i=Kt(t);if(!w(i))return;let s=0;function o(){return s}function a(l,u){if(Te(u)){s=u;for(let d=e.y;d<=r.y;++d)for(let f=e.x;f<=r.x;++f){const h=nt(i,{x:f,y:d});w(h)&&(h[l]=u)}}}Ie(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt),Be(t,`batch:${yo(e,r)}`,"color",[n,"coloredit"],o,a);const c=Rt(t);c.scrollname="bulk set color",c.scroll=ir(t)}function bH(t,e,r,n){const i=Kt(t);if(!w(i))return;let s=0;function o(){return s}function a(l,u){Te(u)&&(s=u,Yy(e.x,e.y,r.x,r.y).forEach(d=>{const f=nt(i,d);w(f)&&(f[l]=u)}))}Ie(t,`batch chars: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt),Be(t,`batch:${yo(e,r)}`,"color",[n,"coloredit"],o,a);const c=Rt(t);c.scrollname="bulk set bg",c.scroll=ir(t)}function wH(t,e,r,n){const i=hr(Xe.MAIN);if(!w(i))return;const s=Kt(t);if(!w(s))return;const o=yo(e,r);Ie(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt),Be(t,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Be(t,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),n&&Be(t,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Be(t,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),Be(t,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Ie(t,Vt),Be(t,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Be(t,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Be(t,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Ie(t,Vt),Be(t,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Ie(t,Vt),Ie(t,"codepages:");const a=Math.min(e.x,r.x),c=Math.min(e.y,r.y),l=Math.max(e.x,r.x),u=Math.max(e.y,r.y),d=new Set;for(let h=c;h<=u;++h)for(let m=a;m<=l;++m){const p=nt(s,{x:m,y:h}),g=Qv(i,p);w(g)&&!d.has(g.id)&&(d.add(g.id),Be(t,"batch",`edit @${gt(g)}`,[`pageopen:${g.id}`]))}const f=fr(Re.BOARD,s.id);Ie(t,gt(f)),Be(t,"batch",`id ${s.id}`,["","copyit",s.id]),Be(t,"batch","edit @board codepage",[`pageopen:${s.id}`])}function bm(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function kH(t,e){let r;const n=()=>{if(r)return r;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),r=bm(i),r.then(s=>{s.onclose=()=>r=void 0},()=>{}),r};return(i,s)=>n().then(o=>s(o.transaction(e,i).objectStore(e)))}let wm;function $T(){return wm||(wm=kH("keyval-store","keyval")),wm}function PT(t,e=$T()){return e("readonly",r=>bm(r.get(t)))}function FT(t,e,r=$T()){return r("readwrite",n=>new Promise((i,s)=>{n.get(t).onsuccess=function(){try{n.put(e(this.result),t),i(bm(n.transaction))}catch(o){s(o)}}}))}function km(t,e){return`${t.x},${t.y},${e.x},${e.y}`}async function BT(){return PT("secretheap")}async function DT(t){return FT("secretheap",t)}async function vH(){return!!await BT()}function jT(t,e,r){const n=Math.min(e.x,r.x),i=Math.min(e.y,r.y),s=Math.max(e.x,r.x),o=Math.max(e.y,r.y),a=s-n+1,c=o-i+1,l=[],u=[];for(let d=i;d<=o;++d)for(let f=n;f<=s;++f){const h={x:f-n,y:d-i},m=nt(t,{x:f,y:d});m?.category===Br.ISOBJECT?(l.push(Sn(rs(t,f,d))),rr(m).name!=="player"&&u.push({...Sn(m),...h,id:"blank"})):l.push({...Sn(m),...h})}return{board:t.id,width:a,height:c,terrain:l,objects:u}}async function xH(t,e,r,n){const i=Kt(t);if(!w(i))return;const s=jT(i,e,r);switch(n){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await DT(()=>s)}function EH(t,e,r){const n=km(e,r);Ie(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt),Be(t,"batch","copy terrain & objects",[`copyall:${n}`,"hk","1"]),Be(t,"batch","copy objects",[`copyobjects:${n}`,"hk","2"]),Be(t,"batch","copy terrain",[`copyterrain:${n}`,"hk","3"]);const i=Rt(t);i.scrollname="copy",i.scroll=ir(t)}async function AH(t,e,r,n){const i=hr(Xe.MAIN);if(!w(i))return;const s=Kt(t);if(!w(s))return;const o=jT(s,e,r);switch(n){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(n){case"cutall":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c){const l=nt(s,{x:c,y:a});l?.category===Br.ISOBJECT&&mr(s,l,i.timestamp),It(s,{x:c,y:a})}break}case"cutobjects":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c){const l=nt(s,{x:c,y:a});l?.category===Br.ISOBJECT&&mr(s,l,i.timestamp)}break}case"cutterrain":{for(let a=e.y;a<=r.y;++a)for(let c=e.x;c<=r.x;++c)It(s,{x:c,y:a});break}}await DT(()=>o)}function TH(t,e,r){const n=km(e,r);Ie(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt),Be(t,"batch","cut terrain & objects",[`cutall:${n}`,"hk","1"]),Be(t,"batch","cut objects",[`cutobjects:${n}`,"hk","2"]),Be(t,"batch","cut terrain",[`cutterrain:${n}`,"hk","3"]);const i=Rt(t);i.scrollname="cut",i.scroll=ir(t)}async function SH(t,e,r,n){const i=Kt(t),s=await BT();if(!w(i)||!w(s))return;const o=Math.min(e.x,r.x),a=Math.min(e.y,r.y),c=Math.max(e.x,r.x),l=Math.max(e.y,r.y),u=c-o+1,d=l-a+1,f=Math.min(s.width,u),h=Math.min(s.height,d);switch(n){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<f;++p){const g=rn({x:p,y:m},s.width);It(i,{...s.terrain[g],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&Sf(p.x,p.y,0,u-1,d-1,0)&&X0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];w(p.x)&&w(p.y)&&Sf(p.x,p.y,0,u-1,d-1,0)&&X0(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<f;++p){const g=rn({x:p,y:m},s.width);It(i,{...s.terrain[g],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const g=(p-o)%s.width,y=(m-a)%s.height,b=rn({x:g,y},s.width);It(i,{...s.terrain[b],x:p,y:m})}break}}function RH(t,e,r){const n=km(e,r);Ie(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt),Be(t,"batch","paste terrain & objects",[`pasteall:${n}`,"hk","1"]),Be(t,"batch","paste objects",[`pasteobjects:${n}`,"hk","2"]),Be(t,"batch","paste terrain",[`pasteterrain:${n}`,"hk","3"]),Be(t,"batch","paste terrain tiled",[`pasteterraintiled:${n}`,"hk","4"]);const i=Rt(t);i.scrollname="paste",i.scroll=ir(t)}function vm(t,e){return`inspect:${e?.id?e.id:Ui(t,e)}`}function OH(t,e,r){const n=hr(Xe.MAIN);if(!w(n))return;const i=Kt(t);if(!w(i))return;function s(f){return e?.[f]??e?.kinddata?.[f]??0}function o(f,h){w(e)&&(e[f]=h)}const a=e.category===Br.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=vm(i,e);Ie(t,`${a}: ${c} ${l}`),Ie(t,Vt),Be(t,u,"color",[r,"coloredit"],s,o);const d=Rt(t);d.scrollname="color",d.scroll=ir(t)}function IH(t,e,r){const n=hr(Xe.MAIN);if(!w(n))return;const i=Kt(t);if(!w(i))return;function s(f){return e?.[f]??e?.kinddata?.[f]??0}function o(f,h){w(e)&&(e[f]=h)}const a=e.category===Br.ISTERRAIN?"terrain":"object",c=e.name??e.kind??"ERR",l=`${e.x??-1}, ${e.y??-1}`,u=vm(i,e);Ie(t,`${a}: ${c} ${l}`),Ie(t,Vt),Be(t,u,"char",[r,"charedit"],s,o);const d=Rt(t);d.scrollname="char",d.scroll=ir(t)}function NH(t,e,r,n,i,s){const o=hr(Xe.MAIN);if(!w(o))return;function a(m){const p=n?.[m]??n?.kinddata?.[m];if(!w(p))switch(m){case"color":return 15;case"bg":return 0;case"cycle":return og;case"collision":return We.ISWALK;case"pushable":return 0;case"breakable":return 0}return p}function c(m,p){w(n)&&(n[m]=p)}s?Ie(t,`object: ${n.name??n.kind??"ERR"} ${i.x}, ${i.y}`):Ie(t,`terrain: ${n.kind??"ERR"} ${i.x}, ${i.y}`);const l=vm(e,n);switch(s&&Ie(t,`cycle: ${He(n,"cycle")}`),He(n,"collision")){case We.ISWALK:Ie(t,"collision: iswalk");break;case We.ISSWIM:Ie(t,"collision: isswim");break;case We.ISSOLID:Ie(t,"collision: issolid");break;case We.ISBULLET:Ie(t,"collision: isbullet");break;case We.ISGHOST:Ie(t,"collision: isghost");break}s&&Ie(t,`ispushable: ${He(n,"pushable")?"yes":"no"}`),Ie(t,`isbreakable: ${He(n,"breakable")?"yes":"no"}`),Ie(t,Vt);const d=Za(r),f=Fr(d);for(let m=0;m<f.length;++m){const p=f[m];switch(p){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ut(d[p])){const[g,y,...b]=d[p];ye(y)&&Be(t,l,y||p,[p,g,...b],a,c)}break}}Be(t,l,"copy coords",["copycoords","hk","5"," 5 "]),Ie(t,Vt),Be(t,l,`char: ${n.char??n.kinddata?.char??1}`,["char","hk","a"," A ","next"],a,c),Be(t,l,`color: ${n.color??n.kinddata?.color??15}`,["color","hk","c"," C ","next"],a,c),Be(t,l,`bg: ${n.bg??n.kinddata?.bg??0}`,["bg","hk","b"," B ","next"],a,c),Ie(t,Vt),Be(t,l,"make empty",["empty","hk","0"],a,c),Ie(t,Vt),Be(t,"batch",`edit @${gt(r)}`,[`pageopen:${r.id}`]);const h=fr(Re.BOARD,e.id);Ie(t,gt(h)),Be(t,"batch",`id ${e.id}`,["","copyit",e.id]),Be(t,"batch","edit @board codepage",[`pageopen:${e.id}`])}function CH(t,e,r,n){const i=hr(Xe.MAIN);if(!w(i))return;const s=Kt(t);if(w(s))switch(n){case"emptyall":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a){const c=nt(s,{x:a,y:o});c?.category===Br.ISOBJECT&&mr(s,c,i.timestamp),It(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a){const c=nt(s,{x:a,y:o});c?.category===Br.ISOBJECT&&mr(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=e.y;o<=r.y;++o)for(let a=e.x;a<=r.x;++a)It(s,{x:a,y:o});break}}}function LH(t,e,r){const n=hr(Xe.MAIN);if(!w(n))return;const i=Kt(t);if(!w(i))return;const s=yo(e,r);Ie(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt),Be(t,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Be(t,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Be(t,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Rt(t);o.scrollname="empty",o.scroll=ir(t)}async function MH(t,e,r){const n=hr(Xe.MAIN),i=await vH();if(!w(n))return;const s=Kt(t);if(!w(s))return;if(ur(s),e.x===r.x&&e.y===r.y){const a=nt(s,e),c=Qv(n,a);if(w(a)&&w(c)&&NH(t,s,c,a,e,Wt(a)),!a?.kind){Ie(t,`empty: ${e.x}, ${e.y}`),Ie(t,Vt),Be(t,"empty","copy coords",[`copycoords:${e.x},${e.y}`,"hk","5"," 5 "]);const l=fr(Re.BOARD,s.id);Ie(t,gt(l)),Be(t,"batch",`id ${s.id}`,["","copyit",s.id]),Be(t,"batch","edit @board codepage",[`pageopen:${s.id}`])}}else wH(t,e,r,i);const o=Rt(t);o.scrollname="inspect",o.scroll=ir(t)}function UH(t,e){const r=dt(Xe.MAIN);if(!w(r))return;const n=Kt(e);if(!w(n))return;const i=Dr(t),s=HA(n,i.target);if(w(s))switch(i.path){case"copycoords":Nh(le,vr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":OH(e,s,i.path);break;case"char":IH(e,s,i.path);break;case"empty":mr(n,s,r.timestamp);break;case"code":$r(le,e,async()=>{const o="object",a=[n.id,s.id];Tf(xc(r.id,a),s.code??""),VS(le,e),await Ac(800),ng(le,e,r.id,a,o,`${name} - ${r.name}`)});break;default:console.info("unknown inspect",i);break}}async function $H(t,e){const r=Kt(e);if(!w(r))return;const n=Dr(t),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"copy":EH(e,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await xH(e,c,l,n.target);break;case"cut":TH(e,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await AH(e,c,l,n.target);break;case"paste":RH(e,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await SH(e,c,l,n.target);break;case"empty":LH(e,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":CH(e,c,l,n.target);break;case"chars":yH(e,c,l,"char");break;case"colors":_H(e,c,l,"color");break;case"bgs":bH(e,c,l,"bg");break;case"copycoords":Nh(le,e,[i,s,o,a].join(" "));break;case"pageopen":$r(le,e,async()=>{await Ac(800),xR(le,e,`#pageopen ${n.path}`)});break;default:console.info("unknown batch",n);break}}async function PH(){return PT("remixconfig")}async function FH(t){return FT("remixconfig",t)}let ss={stat:"",patternsize:2,mirror:1};async function BH(t,e){const r=Kt(e);if(!w(r))return;const n=Dr(t),[i,s,o,a]=n.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(n.target){case"remix":{await DH(e,c,l);break}case"remixrun":{const u=dr(ss.stat);w(u)&&Vx(r.id,u.id,ss.patternsize,ss.mirror,c,l,"all"),await FH(()=>ss);break}default:console.info("unknown remix",n);break}}async function DH(t,e,r){const n=await PH();ss={...ss,...n};const i=yo(e,r);Ie(t,`selected: ${e.x},${e.y} - ${r.x},${r.y}`),Ie(t,Vt);function s(c){const{target:l}=Dr(c);return ss[l]}function o(c,l){if(Te(l)||ye(l)){const{target:u}=Dr(c);ss[u]=l}}Be(t,"remix","source board",[`stat:${i}`,"text"],s,o),Be(t,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),Be(t,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Ie(t,Vt),Be(t,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Rt(t);a.scrollname="remix",a.scroll=ir(t)}const jH=16,os={},oh={},zH=60;let zT=0;const Jo={},ah={};async function WT(t){const e=un(),r=dt(Xe.MAIN);if(e.length&&w(r)){const n=await _m(e),i=`${t?"autosave ":""}${new Date().toISOString()} ${r.name} ${n.length} chars`;JS(Je,vr(),i,n)}}async function WH(){const t=un(),e=dt(Xe.MAIN);if(t.length&&w(e)){const r=await _m(t);QS(Je,vr(),r)}}async function HH(){const t=un(),e=dt(Xe.MAIN);return t.length&&w(e)?_m(t):""}const HT="$176$176$177$177$178 ZZT BRIDGE $178$177$177$176$176";function GT(t){Ie(t,`Searching ${"$6".repeat(nn(1,6))}`);const e=Rt(t);e.scrollname=HT,e.scroll=ir(t)}function KT(t,e){for(let n=0;n<t.length;++n){const i=t[n],s=`pub: ${new Date(i.publish_date).toLocaleDateString()}`;Ie(e,`$white${i.title}`),Ie(e,`$yellow  ${i.author.join(", ")}`),Ie(e,`$dkgreen  ${i.genres.join(", ")}`),Ie(e,`$purple  ${s}`),i.screenshot&&Be(e,"zztbridge",i.screenshot,["screenshot","viewit",NW(i.screenshot)]),Be(e,"zztbridge",i.filename,["zztimport","hyperlink",`${i.letter}/${i.filename}`]),Ie(e," ")}const r=Rt(e);r.scrollname=HT,r.scroll=ir(e)}const ch={},Je=Js("vm",["tick","second"],t=>{if(!Je.session(t))return;const e=vr();switch(t.target){case"operator":Kz(t.player),Bt(Je,t.player,`operator set to ${t.player}`),Je.replynext(t,"ackoperator",!0);break;case"zsswords":{const r=dt(Xe.MAIN);Je.replynext(t,"ackzsswords",{cli:$p(Qi.CLI),loader:$p(Qi.LOADER),runtime:$p(Qi.RUNTIME),flags:[...Fr(Xr(t.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","playerid","playerx","playery","thisid","thisx","thisy","senderid","senderx","sendery","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isghost","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","sender","arg"],kinds:[...Ms(r,Re.OBJECT).map(n=>gt(n)),...Fr(Op)],altkinds:[...Ms(r,Re.TERRAIN),...Ms(r,Re.BOARD),...Ms(r,Re.PALETTE),...Ms(r,Re.CHARSET),...Ms(r,Re.LOADER)].map(n=>gt(n)),colors:[...Fr(ka)],dirs:[...Fr(Mf).filter(n=>["cw","ccw","oop","rndp"].includes(n)===!1)],dirmods:["cw","ccw","oop","rndp",...Fr(Sp)],exprs:["aligned","alligned","contact","blocked","any","countof","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":t.player===e&&$r(Je,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data,i=await gH(r),s=i.map(o=>o.name);Qz(i,n),Bt(Je,t.player,`loading ${s.join(", ")}`),Ih(Je,t.player)}});break;case"search":r7(t.player)||Ih(Je,t.player);break;case"logout":t7(t.player),delete os[t.player],Bt(Je,e,`player ${t.player} logout`),Ih(Je,t.player);break;case"login":LA(t.player)?(XS(Je,t.player),os[t.player]=0,Bt(Je,vr(),`login from ${t.player}`),Je.replynext(t,"acklogin",!0)):Qm(Je,t.player);break;case"local":LA(t.player)?(os[t.player]=0,Bt(Je,vr(),`login from ${t.player}`)):Qm(Je,t.player);break;case"doot":os[t.player]=0,oh[t.player]=oh[t.player]??0,oh[t.player]%32===0&&Bt(Je,t.player,`$whiteactive $blue${t.player}`),++oh[t.player];break;case"input":{if(t.player.includes("local")&&!NA(t.player)&&kR(Je,t.player),!t.player.includes("local")||NA(t.player)){const r=Xr(t.player),[n=Or.NONE,i=0]=t.data??[Or.NONE,0];ut(r.inputqueue)||(r.inputqueue=[]),n!==Or.NONE&&r.inputqueue.push([n,i])}break}case"codewatch":if(ut(t.data)){const[r,n]=t.data,i=xc(r,n);w(ah[i])||(ah[i]=Wy(i,s=>{const[o,a]=n,c=jn(r),l=Ls(c,o);if(w(l))if(ui(l)===Re.BOARD&&w(a)){const u=St(l),d=pr(u,a);w(d)&&(d.code=s,fu(uu(s),d))}else l.code=s,Q$(l)})),Jo[i]=Jo[i]??new Set,Jo[i].add(t.player)}break;case"coderelease":if(ut(t.data)){const[r,n]=t.data,[,i]=n,s=xc(r,n);w(Jo[s])&&(Jo[s].delete(t.player),Jo[s].size===0&&(ah[s]?.(),ah[s]=void 0,ye(i)&&$A(i)))}break;case"halt":t.player===e&&US(t.data)&&qz(t.data);break;case"tick":{a7(Yz());const r=Fr(ch);for(let n=0;n<r.length;++n){const i=r[n];--ch[i]}break}case"synthsend":if(ye(t.data)){const r=t.data,[n,i]=LW(r),s=ch[r];if(!w(s)||s<=0){ch[r]=2;const o=dt(Xe.MAIN);Ho(n,i,void 0,Mo(o))}}break;case"second":{n7(os);const r=Object.keys(os);for(let n=0;n<r.length;++n)++os[r[n]];for(let n=0;n<r.length;++n){const i=r[n];os[i]>=jH&&Lh(Je,i)}++zT>=zH&&(zT=0,$r(Je,t.player,async()=>{await WT(!0)}));break}case"copyjsonfile":if(t.player===e){const r=dt(Xe.MAIN);if(w(r)&&ut(t.data)){const[n]=t.data,i=Ls(r,n);w(i)&&tR(Je,e,i,`${gt(i)}.${Oi(i)}.json`)}}break;case"refscroll":{Tp(ku("refscroll:menu"),n=>Sx(t.player,n));const r=Rt(t.player);r.scrollname="refscroll",r.scroll=ir(t.player);break}case"readzipfilelist":{const r=F7();Ie(t.player,"$CENTER Select Files"),Be(t.player,"zipfilelist","import selected",["importfiles"]);for(let i=0;i<r.length;++i){const[s,o]=r[i];s&&(Ie(t.player,o),Be(t.player,"zipfilelist",`[${s}]`,[Fe(o),"select","NO","0","YES","1"],a=>D7(a)?1:0,(a,c)=>{B7(a,!!c)}))}const n=Rt(t.player);n.scrollname="zipfilelist",n.scroll=ir(t.player);break}case"fork":t.player===e&&$r(Je,t.player,async()=>{await WH()});break;case"zztsearch":$r(Je,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data;let i=0;const s=[];for(;s.length<256;){GT(t.player);const o=await OW(r,n,i);if(i+=o.length,s.push(...o),o.length<25)break}KT(s,t.player)}});break;case"zztrandom":$r(Je,t.player,async()=>{GT(t.player);const r=await IW();KT(r,t.player)});break;case"itchiopublish":$r(Je,t.player,async()=>{if(t.player===e){const r=dt(Xe.MAIN);if(w(r)){const n=await HH();eR(Je,t.player,r.name,n)}}});break;case"flush":t.player===e&&$r(Je,t.player,async()=>{await WT()});break;case"cli":PA(t.player,t.data);break;case"clirepeatlast":c7(t.player);break;case"restart":t.player===e&&(o7(),sg(Je,t.player));break;case"inspect":$r(Je,t.player,async()=>{if(ut(t.data)){const[r,n]=t.data;await MH(t.player,r,n)}});break;case"loader":if(ut(t.data)){const[r,n,i,s]=t.data;switch(n){case"file":im(t.player,s);break;case"json":if(/file:.*\.book.json/.test(i)){Bt(Je,t.player,`loading ${i}`);const o=JSON.parse(s.json);w(o.data)&&ye(o.exported)&&(Fu(o.data),Bt(Je,t.player,`loaded ${o.exported}`))}else if(/file:.*\..*\.codepage.json/.test(i)){Bt(Je,t.player,`loading ${i}`);const o=JSON.parse(s.json),a=dt(Xe.MAIN);w(a)&&w(o.data)&&ye(o.exported)&&(Co(a,o.data),Bt(Je,t.player,`loaded ${o.exported}`))}else Ux(r,n,i,s,t.player);break;default:Ux(r,n,i,s,t.player);break}}break;default:{const{target:r,path:n}=Dr(t.target);switch(Fe(r)){case"refscroll":switch(n){case"charscroll":{Be(t.player,"refscroll","char",["char","charedit"]);const i=Rt(t.player);i.scrollname="chars",i.scroll=ir(t.player);break}case"colorscroll":{Be(t.player,"refscroll","color",["color","coloredit"]);const i=Rt(t.player);i.scrollname="colors",i.scroll=ir(t.player);break}default:{$r(Je,t.player,async()=>{const i=ku(`refscroll:${n}`);if(w(i))Tp(ku(`refscroll:${n}`),o=>Sx(t.player,o));else{const o=Rt(t.player);o.scrollname="$7$7$7 please wait",o.scroll=["loading $7$7$7"];const a=await E7(n);RW(t.player,a)}const s=Rt(t.player);s.scrollname=n,s.scroll=ir(t.player)});break}}break;case"batch":$r(Je,t.player,async()=>{await $H(n,t.player)});break;case"remix":$r(Je,t.player,async()=>{await BH(n,t.player)});break;case"empty":{const i=Dr(n);switch(i.target){case"copycoords":Nh(Je,vr(),i.path.split(",").join(" "));break}break}case"inspect":UH(n,t.player);break;case"touched":if(ut(t.data)){const[i,s,o]=t.data;MA({...t,target:`${s}:${o}`,data:void 0,sender:i})}break;case"zztbridge":$r(Je,t.player,async()=>{ye(t.data)&&await CW(t.player,t.data)});break;case"zipfilelist":$r(Je,t.player,async()=>{await j7(t.player)});break;default:{const i=Dr(n);if(Fe(i.target)==="self"||!i.path)t.target=t.target.replace("self:",""),MA(t);else{const s=dt(Xe.MAIN);Ho(i.target,i.path,void 0,Mo(s))}break}}break}}},Gz());function GH(){ZS(Je)}const{forward:KH}=IR(t=>{NR(t)&&postMessage(t)});onmessage=function(e){KH(e.data)},setTimeout(GH,100)})();

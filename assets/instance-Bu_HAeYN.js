var e2=Object.defineProperty;var n2=(mr,Vt,Be)=>Vt in mr?e2(mr,Vt,{enumerable:!0,configurable:!0,writable:!0,value:Be}):mr[Vt]=Be;var gt=(mr,Vt,Be)=>n2(mr,typeof Vt!="symbol"?Vt+"":Vt,Be);(function(){"use strict";const mr=new Set,Vt={emit(e,t,n,r){Vt.invoke(Ab(e,t,n,r))},invoke(e){mr.forEach(t=>t.handle(e))},connect(e){mr.add(e)},disconnect(e){mr.delete(e)}};var Be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ks(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ub(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var af={};(function(e){var t=Be&&Be.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,p;d<h;d++)(p||!(d in u))&&(p||(p=Array.prototype.slice.call(u,0,d)),p[d]=u[d]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,p=l.adjectiveCount,m=p===void 0?1:p,b=l.addAdverb,g=b===void 0?!1:b,x=t(t(t([],t([],Array(m),!0).map(function(S){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),g?[n(e.adverbs)]:[],!0);return h&&(x=x.map(function(S){return S.charAt(0).toUpperCase()+S.substr(1)})),x.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return r(e.adjectives).length*f+f*m.length+r(e.nouns).length+m.length+r(e.verbs).length+(h?r(e.adverbs).length+m.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,p=l.separator,m=p===void 0?"":p;return i(e.adjectives).length*f+f*m.length+i(e.nouns).length+m.length+i(e.verbs).length+(h?i(e.adverbs).length+m.length:0)}e.minLength=c,e.default=s})(af);var cf=ks(af);const hb="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let fb=e=>crypto.getRandomValues(new Uint8Array(e)),db=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},lf=(e,t=21)=>db(e,t,fb),pb=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=hb[n[e]&63];return t};var uf="abcdefghijklmnopqrstuvwxyz",hf="ABCDEFGHIJKLMNOPQRSTUVWXYZ",ff="0123456789",mb="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",gb="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const yb=ff,_b=uf,bb=hf;var wb=yb+_b+bb,Wc={lowercase:uf,uppercase:hf,numbers:ff,nolookalikes:mb,nolookalikesSafe:gb,alphanumeric:wb};function Hn(){return`sid_${pb(12).replaceAll("-",".")}`}const Eb=lf(Wc.numbers,4),xb=lf(`${Wc.numbers}${Wc.lowercase}`,16);function vb(){return`pid_${Eb()}_${xb()}`}function kb(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function Sb(){return cf({capitalize:!1,adjectiveCount:1})}function df(){return cf({addAdverb:!1,capitalize:!1,adjectiveCount:0})}function Ab(e,t,n,r){return{id:Hn(),target:e,sender:t,data:n,player:r}}function pf(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Po(e,t,n){const r=Hn(),i=e.toLowerCase(),s=t.map(a=>a.toLowerCase()),o={id(){return r},name(){return e},topics(){return t},emit(a,c,l){Vt.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=pf(a.target),u=c.toLowerCase();s.findIndex(f=>f==="all"||f===u)!==-1&&n(a),(r===c||u==="all"||i===u)&&n({...a,target:l})}};return Vt.connect(o),o}function Tb(e){const t=new Set;function n(r){t.has(r.id)||(t.add(r.id),Vt.invoke(r))}return Po("forward",["all"],r=>{t.has(r.id)||(t.add(r.id),e(r))}),n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Rb=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ob=Object.prototype.hasOwnProperty;function Gc(e,t){return Ob.call(e,t)}function Kc(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Gc(e,i)&&r.push(i);return r}function Fe(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Hc(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function ui(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function mf(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Vc(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Vc(e[t]))return!0}else if(typeof e=="object"){for(var r=Kc(e),i=r.length,s=0;s<i;s++)if(Vc(e[r[s]]))return!0}}return!1}function gf(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var yf=function(e){Rb(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,gf(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=gf(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),ee=yf,Ib=Fe,ji={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Bo(n,this.path);r&&(r=Fe(r));var i=hi(n,{op:"remove",path:this.from}).removed;return hi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Bo(n,this.from);return hi(n,{op:"add",path:this.path,value:Fe(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Ss(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Cb={add:function(e,t,n){return Hc(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:ji.move,copy:ji.copy,test:ji.test,_get:ji._get};function Bo(e,t){if(t=="")return e;var n={op:"_get",path:t};return hi(e,n),n.value}function hi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Fo(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Bo(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Ss(e,t.value),o.test===!1)throw new ee("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ee("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Fe(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,p=void 0;for(typeof n=="function"?p=n:p=Fo;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=mf(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&p(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!Hc(h))throw new ee("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Hc(h)&&(h=~~h)}if(u>=f){if(n&&t.op==="add"&&h>l.length)throw new ee("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=Cb[t.op].call(t,l,h,e);if(o.test===!1)throw new ee("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=ji[t.op].call(t,l,h,e);if(o.test===!1)throw new ee("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new ee("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Yc(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new ee("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Fe(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=hi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function Nb(e,t,n){var r=hi(e,t);if(r.test===!1)throw new ee("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Fo(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new ee("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(ji[e.op]){if(typeof e.path!="string")throw new ee("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ee('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ee("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ee("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Vc(e.value))throw new ee("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ee("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new ee("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=_f([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ee("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ee("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function _f(e,t,n){try{if(!Array.isArray(e))throw new ee("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Yc(Fe(t),Fe(e),n||!0);else{n=n||Fo;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof ee)return i;throw i}}function Ss(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Ss(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Ss(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Lb=Object.freeze({__proto__:null,JsonPatchError:ee,_areEquals:Ss,applyOperation:hi,applyPatch:Yc,applyReducer:Nb,deepClone:Ib,getValueByPointer:Bo,validate:_f,validator:Fo});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var qc=new WeakMap,Mb=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Ub=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Db(e){return qc.get(e)}function Pb(e,t){return e.observers.get(t)}function Bb(e,t){e.observers.delete(t.callback)}function Fb(e,t){t.unobserve()}function zb(e,t){var n=[],r,i=Db(e);if(!i)i=new Mb(e),qc.set(e,i);else{var s=Pb(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Fe(e),t){r.callback=t,r.next=null;var o=function(){Xc(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){Xc(r),clearTimeout(r.next),Bb(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new Ub(t,r)),r}function Xc(e,t){t===void 0&&(t=!1);var n=qc.get(e.object);Jc(n.value,e.object,e.patches,"",t),e.patches.length&&Yc(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Jc(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Kc(t),o=Kc(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(Gc(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?Jc(u,f,n,r+"/"+ui(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+ui(l),value:Fe(u)}),n.push({op:"replace",path:r+"/"+ui(l),value:Fe(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+ui(l),value:Fe(u)}),n.push({op:"remove",path:r+"/"+ui(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!Gc(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+ui(l),value:Fe(t[l])})}}}function Zc(e,t,n){n===void 0&&(n=!1);var r=[];return Jc(e,t,r,"",n),r}var $b=Object.freeze({__proto__:null,compare:Zc,generate:Xc,observe:zb,unobserve:Fb});Object.assign({},Lb,$b,{JsonPatchError:yf,deepClone:Fe,escapePathComponent:ui,unescapePathComponent:mf});function T(e){return e!=null}const jb=Object.keys;function Wb(e,t){return Zc(e,t).length===0}function Gb(e){return Fe(e)}function Kb(e){return typeof e=="boolean"}function qt(e){return typeof e=="number"}function Lt(e){return typeof e=="string"}function Le(e){return Array.isArray(e)}function Hb(e){return e}var xt=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.CLEAR=32]="CLEAR",e[e.SHADOW=33]="SHADOW",e[e.BORROW=34]="BORROW",e))(xt||{});function Vb(e){return T(e)&&e<16?e:void 0}function Yb(e){return T(e)&&e>15&&e<32?e-16:void 0}function zo(e,t){return new Array(e).fill(t)}function bf(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:zo(s,0),color:zo(s,0),bg:zo(s,i)}}function qb(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:32}}function Xb(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Jb(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:zo(s,i)}}function Zb(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:2}}var un=(e=>(e[e.START=0]="START",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.SCROLL=5]="SCROLL",e))(un||{});const Qb={start:0,left:1,right:2,top:3,bottom:4,scroll:5},tw={0:1,1:20,2:20,3:1,4:1,5:40};function wf(e,t){return`${e}:${t}`}const ew=1,nw=16,rw=256;var me=(e=>(e[e.NONE=0]="NONE",e[e.MOVE_UP=1]="MOVE_UP",e[e.MOVE_DOWN=2]="MOVE_DOWN",e[e.MOVE_LEFT=3]="MOVE_LEFT",e[e.MOVE_RIGHT=4]="MOVE_RIGHT",e[e.OK_BUTTON=5]="OK_BUTTON",e[e.CANCEL_BUTTON=6]="CANCEL_BUTTON",e[e.MENU_BUTTON=7]="MENU_BUTTON",e))(me||{});function ne(e,t,n,r){const i=r??"";return Vt.emit(`error:${t}`,e,n,i),cw(e,n,i)}function iw(e,t,n){Vt.emit("gadgetclient:reset",e,t,n)}function sw(e,t,n){Vt.emit("gadgetclient:patch",e,t,n)}function ow(e,t){Vt.emit("register:flush",e,t)}function aw(e){Vt.emit("register:nodetrash",e)}function Ef(e,t,n){Vt.emit("synth:play",e,[t,n])}function ge(e,...t){return Vt.emit("tape:info",e,t),!0}function xf(e,...t){return Vt.emit("tape:debug",e,t),!0}function cw(e,...t){return Vt.emit("tape:error",e,t),!1}function lw(e,t,n,r,i,s){Vt.emit("tape:editor:open",e,[t,n,r,i],s)}function vf(e,t){return`${e}${t}`}function As(e){Vt.emit("vm:flush",e)}function kf(e,t){function n(r){console.error(r),ne(e,"crash",r.message)}t().catch(n)}var Sf={exports:{}},Qc={exports:{}},Af;function uw(){return Af||(Af=1,function(e,t){(function(n,r){e.exports=r()})(Be,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(m){if(m)for(var b=0;b<u.length;b++)m[u[b]]!==void 0&&this["set"+r(u[b])](m[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof f)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new f(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",g=this.getColumnNumber()||"",x=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+g+")":"[eval]:"+b+":"+g:x?x+" ("+m+":"+b+":"+g+")":m+":"+b+":"+g}},f.fromString=function(b){var g=b.indexOf("("),x=b.lastIndexOf(")"),S=b.substring(0,g),w=b.substring(g+1,x).split(","),k=b.substring(x+1);if(k.indexOf("@")===0)var v=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(k,""),E=v[1],N=v[2],O=v[3];return new f({functionName:S,args:w||void 0,fileName:E,lineNumber:N||void 0,columnNumber:O||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[h]);for(var p=0;p<a.length;p++)f.prototype["get"+r(a[p])]=i(a[p]),f.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return f})}(Qc)),Qc.exports}(function(e,t){(function(n,r){e.exports=r(uw())})(Be,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),p=d&&f||void 0,m=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:p,fileName:m,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,p=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var p=l.exec(u[d]);p&&f.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",p=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;h.match(/\(([^)]*)\)/)&&(m=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Sf);var hw=Sf.exports,fw=ks(hw),Tf={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Be,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Tf);var dw=Tf.exports,pw=ks(dw);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Rf="164",Of=300,If=1e3,$o=1001,Cf=1002,Nf=1003,mw=1006,gw=1008,yw=1009,_w=1014,bw=1020,ww=1023,tl=1026,Lf=1027,Ew="",xw=515,jo=2e3,Mf=2001;class Uf{addEventListener(t,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(n)===-1&&r[t].push(n)}hasEventListener(t,n){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(n)!==-1}removeEventListener(t,n){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,t);t.target=null}}}const Me=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function el(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Me[e&255]+Me[e>>8&255]+Me[e>>16&255]+Me[e>>24&255]+"-"+Me[t&255]+Me[t>>8&255]+"-"+Me[t>>16&15|64]+Me[t>>24&255]+"-"+Me[n&63|128]+Me[n>>8&255]+"-"+Me[n>>16&255]+Me[n>>24&255]+Me[r&255]+Me[r>>8&255]+Me[r>>16&255]+Me[r>>24&255]).toLowerCase()}function gr(e,t,n){return Math.max(t,Math.min(n,e))}class fi{constructor(t=0,n=0){fi.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(gr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ts{constructor(t,n,r,i,s,o,a,c,l){Ts.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],p=r[8],m=i[0],b=i[3],g=i[6],x=i[1],S=i[4],w=i[7],k=i[2],v=i[5],E=i[8];return s[0]=o*m+a*x+c*k,s[3]=o*b+a*S+c*v,s[6]=o*g+a*w+c*E,s[1]=l*m+u*x+f*k,s[4]=l*b+u*S+f*v,s[7]=l*g+u*w+f*E,s[2]=d*m+h*x+p*k,s[5]=d*b+h*S+p*v,s[8]=d*g+h*w+p*E,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,p=n*f+r*d+i*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=f*m,t[1]=(i*l-u*r)*m,t[2]=(a*r-i*o)*m,t[3]=d*m,t[4]=(u*n-i*c)*m,t[5]=(i*s-a*n)*m,t[6]=h*m,t[7]=(r*c-l*n)*m,t[8]=(o*n-r*s)*m,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(nl.makeScale(t,n)),this}rotate(t){return this.premultiply(nl.makeRotation(-t)),this}translate(t,n){return this.premultiply(nl.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const nl=new Ts;function Df(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function rl(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}let Wi;class vw{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let n;if(t instanceof HTMLCanvasElement)n=t;else{Wi===void 0&&(Wi=Df("canvas")),Wi.width=t.width,Wi.height=t.height;const r=Wi.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),n=Wi}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const n=Df("canvas");n.width=t.width,n.height=t.height;const r=n.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const i=r.getImageData(0,0,t.width,t.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=rl(s[o]/255)*255;return r.putImageData(i,0,0),n}else if(t.data){const n=t.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(rl(n[r]/255)*255):n[r]=rl(n[r]);return{data:n,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let kw=0;class Sw{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:kw++}),this.uuid=el(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const n=t===void 0||typeof t=="string";if(!n&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(il(i[o].image)):s.push(il(i[o]))}else s=il(i);r.url=s}return n||(t.images[this.uuid]=r),r}}function il(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?vw.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Aw=0;class Fr extends Uf{constructor(t=Fr.DEFAULT_IMAGE,n=Fr.DEFAULT_MAPPING,r=$o,i=$o,s=mw,o=gw,a=ww,c=yw,l=Fr.DEFAULT_ANISOTROPY,u=Ew){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Aw++}),this.uuid=el(),this.name="",this.source=new Sw(t),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new fi(0,0),this.repeat=new fi(1,1),this.center=new fi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ts,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const n=t===void 0||typeof t=="string";if(!n&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Of)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case If:t.x=t.x-Math.floor(t.x);break;case $o:t.x=t.x<0?0:1;break;case Cf:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case If:t.y=t.y-Math.floor(t.y);break;case $o:t.y=t.y<0?0:1;break;case Cf:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Fr.DEFAULT_IMAGE=null,Fr.DEFAULT_MAPPING=Of,Fr.DEFAULT_ANISOTROPY=1;class Rs{constructor(t=0,n=0,r=0,i=1){this.isQuaternion=!0,this._x=t,this._y=n,this._z=r,this._w=i}static slerpFlat(t,n,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],f=r[i+3];const d=s[o+0],h=s[o+1],p=s[o+2],m=s[o+3];if(a===0){t[n+0]=c,t[n+1]=l,t[n+2]=u,t[n+3]=f;return}if(a===1){t[n+0]=d,t[n+1]=h,t[n+2]=p,t[n+3]=m;return}if(f!==m||c!==d||l!==h||u!==p){let b=1-a;const g=c*d+l*h+u*p+f*m,x=g>=0?1:-1,S=1-g*g;if(S>Number.EPSILON){const k=Math.sqrt(S),v=Math.atan2(k,g*x);b=Math.sin(b*v)/k,a=Math.sin(a*v)/k}const w=a*x;if(c=c*b+d*w,l=l*b+h*w,u=u*b+p*w,f=f*b+m*w,b===1-a){const k=1/Math.sqrt(c*c+l*l+u*u+f*f);c*=k,l*=k,u*=k,f*=k}}t[n]=c,t[n+1]=l,t[n+2]=u,t[n+3]=f}static multiplyQuaternionsFlat(t,n,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],f=s[o],d=s[o+1],h=s[o+2],p=s[o+3];return t[n]=a*p+u*f+c*h-l*d,t[n+1]=c*p+u*d+l*f-a*h,t[n+2]=l*p+u*h+a*d-c*f,t[n+3]=u*p-a*f-c*d-l*h,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,n,r,i){return this._x=t,this._y=n,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,n=!0){const r=t._x,i=t._y,s=t._z,o=t._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),f=a(s/2),d=c(r/2),h=c(i/2),p=c(s/2);switch(o){case"XYZ":this._x=d*u*f+l*h*p,this._y=l*h*f-d*u*p,this._z=l*u*p+d*h*f,this._w=l*u*f-d*h*p;break;case"YXZ":this._x=d*u*f+l*h*p,this._y=l*h*f-d*u*p,this._z=l*u*p-d*h*f,this._w=l*u*f+d*h*p;break;case"ZXY":this._x=d*u*f-l*h*p,this._y=l*h*f+d*u*p,this._z=l*u*p+d*h*f,this._w=l*u*f-d*h*p;break;case"ZYX":this._x=d*u*f-l*h*p,this._y=l*h*f+d*u*p,this._z=l*u*p-d*h*f,this._w=l*u*f+d*h*p;break;case"YZX":this._x=d*u*f+l*h*p,this._y=l*h*f+d*u*p,this._z=l*u*p-d*h*f,this._w=l*u*f-d*h*p;break;case"XZY":this._x=d*u*f-l*h*p,this._y=l*h*f-d*u*p,this._z=l*u*p+d*h*f,this._w=l*u*f+d*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,n){const r=n/2,i=Math.sin(r);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const n=t.elements,r=n[0],i=n[4],s=n[8],o=n[1],a=n[5],c=n[9],l=n[2],u=n[6],f=n[10],d=r+a+f;if(d>0){const h=.5/Math.sqrt(d+1);this._w=.25/h,this._x=(u-c)*h,this._y=(s-l)*h,this._z=(o-i)*h}else if(r>a&&r>f){const h=2*Math.sqrt(1+r-a-f);this._w=(u-c)/h,this._x=.25*h,this._y=(i+o)/h,this._z=(s+l)/h}else if(a>f){const h=2*Math.sqrt(1+a-r-f);this._w=(s-l)/h,this._x=(i+o)/h,this._y=.25*h,this._z=(c+u)/h}else{const h=2*Math.sqrt(1+f-r-a);this._w=(o-i)/h,this._x=(s+l)/h,this._y=(c+u)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(t,n){let r=t.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*n.z-t.z*n.y,this._y=t.z*n.x-t.x*n.z,this._z=t.x*n.y-t.y*n.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(gr(this.dot(t),-1,1)))}rotateTowards(t,n){const r=this.angleTo(t);if(r===0)return this;const i=Math.min(1,n/r);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,n){const r=t._x,i=t._y,s=t._z,o=t._w,a=n._x,c=n._y,l=n._z,u=n._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(t,n){if(n===0)return this;if(n===1)return this.copy(t);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*t._w+r*t._x+i*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const h=1-n;return this._w=h*o+n*this._w,this._x=h*r+n*this._x,this._y=h*i+n*this._y,this._z=h*s+n*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),f=Math.sin((1-n)*u)/l,d=Math.sin(n*u)/l;return this._w=o*f+this._w*d,this._x=r*f+this._x*d,this._y=i*f+this._y*d,this._z=s*f+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,n,r){return this.copy(t).slerp(n,r)}random(){const t=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(t),i*Math.cos(t),s*Math.sin(n),s*Math.cos(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,n=0){return this._x=t[n],this._y=t[n+1],this._z=t[n+2],this._w=t[n+3],this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._w,t}fromBufferAttribute(t,n){return this._x=t.getX(n),this._y=t.getY(n),this._z=t.getZ(n),this._w=t.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ye{constructor(t=0,n=0,r=0){ye.prototype.isVector3=!0,this.x=t,this.y=n,this.z=r}set(t,n,r){return r===void 0&&(r=this.z),this.x=t,this.y=n,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this.z+=t.z*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this.z=t.z-n.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,n){return this.x=t.x*n.x,this.y=t.y*n.y,this.z=t.z*n.z,this}applyEuler(t){return this.applyQuaternion(Pf.setFromEuler(t))}applyAxisAngle(t,n){return this.applyQuaternion(Pf.setFromAxisAngle(t,n))}applyMatrix3(t){const n=this.x,r=this.y,i=this.z,s=t.elements;return this.x=s[0]*n+s[3]*r+s[6]*i,this.y=s[1]*n+s[4]*r+s[7]*i,this.z=s[2]*n+s[5]*r+s[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const n=this.x,r=this.y,i=this.z,s=t.elements,o=1/(s[3]*n+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*n+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*n+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*n+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(t){const n=this.x,r=this.y,i=this.z,s=t.x,o=t.y,a=t.z,c=t.w,l=2*(o*i-a*r),u=2*(a*n-s*i),f=2*(s*r-o*n);return this.x=n+c*l+o*f-a*u,this.y=r+c*u+a*l-s*f,this.z=i+c*f+s*u-o*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const n=this.x,r=this.y,i=this.z,s=t.elements;return this.x=s[0]*n+s[4]*r+s[8]*i,this.y=s[1]*n+s[5]*r+s[9]*i,this.z=s[2]*n+s[6]*r+s[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this.z=Math.max(t.z,Math.min(n.z,this.z)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this.z=Math.max(t,Math.min(n,this.z)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this.z+=(t.z-this.z)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this.z=t.z+(n.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,n){const r=t.x,i=t.y,s=t.z,o=n.x,a=n.y,c=n.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(t){const n=t.lengthSq();if(n===0)return this.set(0,0,0);const r=t.dot(this)/n;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return sl.copy(this).projectOnVector(t),this.sub(sl)}reflect(t){return this.sub(sl.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(gr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return n*n+r*r+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,n,r){const i=Math.sin(n)*t;return this.x=i*Math.sin(r),this.y=Math.cos(n)*t,this.z=i*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,n,r){return this.x=t*Math.sin(n),this.y=r,this.z=t*Math.cos(n),this}setFromMatrixPosition(t){const n=t.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(t){const n=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=n,this.y=r,this.z=i,this}setFromMatrixColumn(t,n){return this.fromArray(t.elements,n*4)}setFromMatrix3Column(t,n){return this.fromArray(t.elements,n*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this.z=t[n+2],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t[n+2]=this.z,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this.z=t.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(t),this.y=n,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const sl=new ye,Pf=new Rs;class yr{constructor(t,n,r,i,s,o,a,c,l,u,f,d,h,p,m,b){yr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l,u,f,d,h,p,m,b)}set(t,n,r,i,s,o,a,c,l,u,f,d,h,p,m,b){const g=this.elements;return g[0]=t,g[4]=n,g[8]=r,g[12]=i,g[1]=s,g[5]=o,g[9]=a,g[13]=c,g[2]=l,g[6]=u,g[10]=f,g[14]=d,g[3]=h,g[7]=p,g[11]=m,g[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new yr().fromArray(this.elements)}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(t){const n=this.elements,r=t.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(t){const n=t.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(t,n,r){return t.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,n,r){return this.set(t.x,n.x,r.x,0,t.y,n.y,r.y,0,t.z,n.z,r.z,0,0,0,0,1),this}extractRotation(t){const n=this.elements,r=t.elements,i=1/Gi.setFromMatrixColumn(t,0).length(),s=1/Gi.setFromMatrixColumn(t,1).length(),o=1/Gi.setFromMatrixColumn(t,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(t){const n=this.elements,r=t.x,i=t.y,s=t.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),f=Math.sin(s);if(t.order==="XYZ"){const d=o*u,h=o*f,p=a*u,m=a*f;n[0]=c*u,n[4]=-c*f,n[8]=l,n[1]=h+p*l,n[5]=d-m*l,n[9]=-a*c,n[2]=m-d*l,n[6]=p+h*l,n[10]=o*c}else if(t.order==="YXZ"){const d=c*u,h=c*f,p=l*u,m=l*f;n[0]=d+m*a,n[4]=p*a-h,n[8]=o*l,n[1]=o*f,n[5]=o*u,n[9]=-a,n[2]=h*a-p,n[6]=m+d*a,n[10]=o*c}else if(t.order==="ZXY"){const d=c*u,h=c*f,p=l*u,m=l*f;n[0]=d-m*a,n[4]=-o*f,n[8]=p+h*a,n[1]=h+p*a,n[5]=o*u,n[9]=m-d*a,n[2]=-o*l,n[6]=a,n[10]=o*c}else if(t.order==="ZYX"){const d=o*u,h=o*f,p=a*u,m=a*f;n[0]=c*u,n[4]=p*l-h,n[8]=d*l+m,n[1]=c*f,n[5]=m*l+d,n[9]=h*l-p,n[2]=-l,n[6]=a*c,n[10]=o*c}else if(t.order==="YZX"){const d=o*c,h=o*l,p=a*c,m=a*l;n[0]=c*u,n[4]=m-d*f,n[8]=p*f+h,n[1]=f,n[5]=o*u,n[9]=-a*u,n[2]=-l*u,n[6]=h*f+p,n[10]=d-m*f}else if(t.order==="XZY"){const d=o*c,h=o*l,p=a*c,m=a*l;n[0]=c*u,n[4]=-f,n[8]=l*u,n[1]=d*f+m,n[5]=o*u,n[9]=h*f-p,n[2]=p*f-h,n[6]=a*u,n[10]=m*f+d}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Tw,t,Rw)}lookAt(t,n,r){const i=this.elements;return nn.subVectors(t,n),nn.lengthSq()===0&&(nn.z=1),nn.normalize(),zr.crossVectors(r,nn),zr.lengthSq()===0&&(Math.abs(r.z)===1?nn.x+=1e-4:nn.z+=1e-4,nn.normalize(),zr.crossVectors(r,nn)),zr.normalize(),Wo.crossVectors(nn,zr),i[0]=zr.x,i[4]=Wo.x,i[8]=nn.x,i[1]=zr.y,i[5]=Wo.y,i[9]=nn.y,i[2]=zr.z,i[6]=Wo.z,i[10]=nn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],f=r[5],d=r[9],h=r[13],p=r[2],m=r[6],b=r[10],g=r[14],x=r[3],S=r[7],w=r[11],k=r[15],v=i[0],E=i[4],N=i[8],O=i[12],W=i[1],Z=i[5],C=i[9],A=i[13],y=i[2],L=i[6],j=i[10],U=i[14],q=i[3],G=i[7],J=i[11],F=i[15];return s[0]=o*v+a*W+c*y+l*q,s[4]=o*E+a*Z+c*L+l*G,s[8]=o*N+a*C+c*j+l*J,s[12]=o*O+a*A+c*U+l*F,s[1]=u*v+f*W+d*y+h*q,s[5]=u*E+f*Z+d*L+h*G,s[9]=u*N+f*C+d*j+h*J,s[13]=u*O+f*A+d*U+h*F,s[2]=p*v+m*W+b*y+g*q,s[6]=p*E+m*Z+b*L+g*G,s[10]=p*N+m*C+b*j+g*J,s[14]=p*O+m*A+b*U+g*F,s[3]=x*v+S*W+w*y+k*q,s[7]=x*E+S*Z+w*L+k*G,s[11]=x*N+S*C+w*j+k*J,s[15]=x*O+S*A+w*U+k*F,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[4]*=t,n[8]*=t,n[12]*=t,n[1]*=t,n[5]*=t,n[9]*=t,n[13]*=t,n[2]*=t,n[6]*=t,n[10]*=t,n[14]*=t,n[3]*=t,n[7]*=t,n[11]*=t,n[15]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[4],i=t[8],s=t[12],o=t[1],a=t[5],c=t[9],l=t[13],u=t[2],f=t[6],d=t[10],h=t[14],p=t[3],m=t[7],b=t[11],g=t[15];return p*(+s*c*f-i*l*f-s*a*d+r*l*d+i*a*h-r*c*h)+m*(+n*c*h-n*l*d+s*o*d-i*o*h+i*l*u-s*c*u)+b*(+n*l*f-n*a*h-s*o*f+r*o*h+s*a*u-r*l*u)+g*(-i*a*u-n*c*f+n*a*d+i*o*f-r*o*d+r*c*u)}transpose(){const t=this.elements;let n;return n=t[1],t[1]=t[4],t[4]=n,n=t[2],t[2]=t[8],t[8]=n,n=t[6],t[6]=t[9],t[9]=n,n=t[3],t[3]=t[12],t[12]=n,n=t[7],t[7]=t[13],t[13]=n,n=t[11],t[11]=t[14],t[14]=n,this}setPosition(t,n,r){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=n,i[14]=r),this}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=t[9],d=t[10],h=t[11],p=t[12],m=t[13],b=t[14],g=t[15],x=f*b*l-m*d*l+m*c*h-a*b*h-f*c*g+a*d*g,S=p*d*l-u*b*l-p*c*h+o*b*h+u*c*g-o*d*g,w=u*m*l-p*f*l+p*a*h-o*m*h-u*a*g+o*f*g,k=p*f*c-u*m*c-p*a*d+o*m*d+u*a*b-o*f*b,v=n*x+r*S+i*w+s*k;if(v===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/v;return t[0]=x*E,t[1]=(m*d*s-f*b*s-m*i*h+r*b*h+f*i*g-r*d*g)*E,t[2]=(a*b*s-m*c*s+m*i*l-r*b*l-a*i*g+r*c*g)*E,t[3]=(f*c*s-a*d*s-f*i*l+r*d*l+a*i*h-r*c*h)*E,t[4]=S*E,t[5]=(u*b*s-p*d*s+p*i*h-n*b*h-u*i*g+n*d*g)*E,t[6]=(p*c*s-o*b*s-p*i*l+n*b*l+o*i*g-n*c*g)*E,t[7]=(o*d*s-u*c*s+u*i*l-n*d*l-o*i*h+n*c*h)*E,t[8]=w*E,t[9]=(p*f*s-u*m*s-p*r*h+n*m*h+u*r*g-n*f*g)*E,t[10]=(o*m*s-p*a*s+p*r*l-n*m*l-o*r*g+n*a*g)*E,t[11]=(u*a*s-o*f*s-u*r*l+n*f*l+o*r*h-n*a*h)*E,t[12]=k*E,t[13]=(u*m*i-p*f*i+p*r*d-n*m*d-u*r*b+n*f*b)*E,t[14]=(p*a*i-o*m*i-p*r*c+n*m*c+o*r*b-n*a*b)*E,t[15]=(o*f*i-u*a*i+u*r*c-n*f*c-o*r*d+n*a*d)*E,this}scale(t){const n=this.elements,r=t.x,i=t.y,s=t.z;return n[0]*=r,n[4]*=i,n[8]*=s,n[1]*=r,n[5]*=i,n[9]*=s,n[2]*=r,n[6]*=i,n[10]*=s,n[3]*=r,n[7]*=i,n[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(n,r,i))}makeTranslation(t,n,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(t){const n=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,n){const r=Math.cos(n),i=Math.sin(n),s=1-r,o=t.x,a=t.y,c=t.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(t,n,r){return this.set(t,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,n,r,i,s,o){return this.set(1,r,s,0,t,1,o,0,n,i,1,0,0,0,0,1),this}compose(t,n,r){const i=this.elements,s=n._x,o=n._y,a=n._z,c=n._w,l=s+s,u=o+o,f=a+a,d=s*l,h=s*u,p=s*f,m=o*u,b=o*f,g=a*f,x=c*l,S=c*u,w=c*f,k=r.x,v=r.y,E=r.z;return i[0]=(1-(m+g))*k,i[1]=(h+w)*k,i[2]=(p-S)*k,i[3]=0,i[4]=(h-w)*v,i[5]=(1-(d+g))*v,i[6]=(b+x)*v,i[7]=0,i[8]=(p+S)*E,i[9]=(b-x)*E,i[10]=(1-(d+m))*E,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,n,r){const i=this.elements;let s=Gi.set(i[0],i[1],i[2]).length();const o=Gi.set(i[4],i[5],i[6]).length(),a=Gi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),t.x=i[12],t.y=i[13],t.z=i[14],Rn.copy(this);const l=1/s,u=1/o,f=1/a;return Rn.elements[0]*=l,Rn.elements[1]*=l,Rn.elements[2]*=l,Rn.elements[4]*=u,Rn.elements[5]*=u,Rn.elements[6]*=u,Rn.elements[8]*=f,Rn.elements[9]*=f,Rn.elements[10]*=f,n.setFromRotationMatrix(Rn),r.x=s,r.y=o,r.z=a,this}makePerspective(t,n,r,i,s,o,a=jo){const c=this.elements,l=2*s/(n-t),u=2*s/(r-i),f=(n+t)/(n-t),d=(r+i)/(r-i);let h,p;if(a===jo)h=-(o+s)/(o-s),p=-2*o*s/(o-s);else if(a===Mf)h=-o/(o-s),p=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=u,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=h,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,n,r,i,s,o,a=jo){const c=this.elements,l=1/(n-t),u=1/(r-i),f=1/(o-s),d=(n+t)*l,h=(r+i)*u;let p,m;if(a===jo)p=(o+s)*f,m=-2*f;else if(a===Mf)p=s*f,m=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-h,c[2]=0,c[6]=0,c[10]=m,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<16;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<16;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t[n+9]=r[9],t[n+10]=r[10],t[n+11]=r[11],t[n+12]=r[12],t[n+13]=r[13],t[n+14]=r[14],t[n+15]=r[15],t}}const Gi=new ye,Rn=new yr,Tw=new ye(0,0,0),Rw=new ye(1,1,1),zr=new ye,Wo=new ye,nn=new ye,Bf=new yr,Ff=new Rs;class Go{constructor(t=0,n=0,r=0,i=Go.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,n,r,i=this._order){return this._x=t,this._y=n,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,n=this._order,r=!0){const i=t.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],f=i[2],d=i[6],h=i[10];switch(n){case"XYZ":this._y=Math.asin(gr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-gr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-f,s),this._z=0);break;case"ZXY":this._x=Math.asin(gr(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,h),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-gr(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(gr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-gr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,n,r){return Bf.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Bf,n,r)}setFromVector3(t,n=this._order){return this.set(t.x,t.y,t.z,n)}reorder(t){return Ff.setFromEuler(this),this.setFromQuaternion(Ff,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],n=0){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t[n+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Go.DEFAULT_ORDER="XYZ";class Ow{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Iw=0;const zf=new ye,Ki=new Rs,_r=new yr,Ko=new ye,Os=new ye,Cw=new ye,Nw=new Rs,$f=new ye(1,0,0),jf=new ye(0,1,0),Wf=new ye(0,0,1),Gf={type:"added"},Lw={type:"removed"},Hi={type:"childadded",child:null},ol={type:"childremoved",child:null};class di extends Uf{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Iw++}),this.uuid=el(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=di.DEFAULT_UP.clone();const t=new ye,n=new Go,r=new Rs,i=new ye(1,1,1);function s(){r.setFromEuler(n,!1)}function o(){n.setFromQuaternion(r,void 0,!1)}n._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new yr},normalMatrix:{value:new Ts}}),this.matrix=new yr,this.matrixWorld=new yr,this.matrixAutoUpdate=di.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=di.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ow,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,n){this.quaternion.setFromAxisAngle(t,n)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,n){return Ki.setFromAxisAngle(t,n),this.quaternion.multiply(Ki),this}rotateOnWorldAxis(t,n){return Ki.setFromAxisAngle(t,n),this.quaternion.premultiply(Ki),this}rotateX(t){return this.rotateOnAxis($f,t)}rotateY(t){return this.rotateOnAxis(jf,t)}rotateZ(t){return this.rotateOnAxis(Wf,t)}translateOnAxis(t,n){return zf.copy(t).applyQuaternion(this.quaternion),this.position.add(zf.multiplyScalar(n)),this}translateX(t){return this.translateOnAxis($f,t)}translateY(t){return this.translateOnAxis(jf,t)}translateZ(t){return this.translateOnAxis(Wf,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(_r.copy(this.matrixWorld).invert())}lookAt(t,n,r){t.isVector3?Ko.copy(t):Ko.set(t,n,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Os.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_r.lookAt(Os,Ko,this.up):_r.lookAt(Ko,Os,this.up),this.quaternion.setFromRotationMatrix(_r),i&&(_r.extractRotation(i.matrixWorld),Ki.setFromRotationMatrix(_r),this.quaternion.premultiply(Ki.invert()))}add(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Gf),Hi.child=t,this.dispatchEvent(Hi),Hi.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(t);return n!==-1&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(Lw),ol.child=t,this.dispatchEvent(ol),ol.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),_r.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),_r.multiply(t.parent.matrixWorld)),t.applyMatrix4(_r),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Gf),Hi.child=t,this.dispatchEvent(Hi),Hi.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,n){if(this[t]===n)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(t,n);if(o!==void 0)return o}}getObjectsByProperty(t,n,r=[]){this[t]===n&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(t,n,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Os,t,Cw),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Os,Nw,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return t.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(t){t(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverseVisible(t)}traverseAncestors(t){const n=this.parent;n!==null&&(t(n),n.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const n=this.children;for(let r=0,i=n.length;r<i;r++){const s=n[r];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,n){const r=this.parent;if(t===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++){const a=i[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const n=t===void 0||typeof t=="string",r={};n&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const f=c[l];s(t.shapes,f)}else s(t.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(t.materials,this.material[c]));i.material=a}else i.material=s(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(t.animations,c))}}if(n){const a=o(t.geometries),c=o(t.materials),l=o(t.textures),u=o(t.images),f=o(t.shapes),d=o(t.skeletons),h=o(t.animations),p=o(t.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),f.length>0&&(r.shapes=f),d.length>0&&(r.skeletons=d),h.length>0&&(r.animations=h),p.length>0&&(r.nodes=p)}return r.object=i,r;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,n=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),n===!0)for(let r=0;r<t.children.length;r++){const i=t.children[r];this.add(i.clone())}return this}}di.DEFAULT_UP=new ye(0,1,0),di.DEFAULT_MATRIX_AUTO_UPDATE=!0,di.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class Mw extends Fr{constructor(t,n,r,i,s,o,a,c,l,u){if(u=u!==void 0?u:tl,u!==tl&&u!==Lf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===tl&&(r=_w),r===void 0&&u===Lf&&(r=bw),super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:t,height:n},this.magFilter=a!==void 0?a:Nf,this.minFilter=c!==void 0?c:Nf,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const n=super.toJSON(t);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}const Uw=new Mw(1,1);Uw.compareFunction=xw,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Rf}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Rf),new fi,new fi;function pi(e,t,n){return Math.max(t,Math.min(n,e))}const Dw=pw("089fad0j9awfem09wavefc09uwaef");function Pw(){return Dw()}function Ho(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Pw()*i)}function al(e,t,n){typeof e!="number"&&(e=0,t=0,n=1),typeof t!="number"&&(t=e,e=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function Bw(e){return e[Ho(0,e.length-1)]}function br(...e){return Bw(e.flat())}function Fw(e){return[...new Set(e)].filter(T)}function zw(...e){const t=e.flat().filter(T);return t.reduce((n,r)=>n+r,0)/t.length}var re=(e=>(e[e.ISSOLID=0]="ISSOLID",e[e.ISWALK=1]="ISWALK",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(re||{}),Vo=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Vo||{});const Pt=60,He=25,$w=Pt*He;var ut=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e[e.EIGHT_TRACK=7]="EIGHT_TRACK",e))(ut||{}),ie=(e=>(e.LOADER="loader",e.BOARD="board",e.OBJECT="object",e.TERRAIN="terrain",e.CHARSET="charset",e.PALETTE="palette",e.EIGHT_TRACK="8track",e))(ie||{});function Kf(e,t){const n=e??re.ISWALK,r=t??re.ISWALK;switch(n){case re.ISWALK:return r!==re.ISWALK;case re.ISSWIM:return r!==re.ISSWIM;case re.ISSOLID:return!0;case re.ISBULLET:return r!==re.ISWALK&&r!==re.ISSWIM}}function cl(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(T)}function jw(e,t){const n=vl(t),r=Dd(t),i=Pd(t);return e.filter(s=>!(T(n)&&wd(s)!==n||T(r)&&_E(s)!==r||T(i)&&bE(s)!==i)).filter(T)}function ll(e,t){return T(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(T(i))return i;const s=cl(e,n.toLowerCase());if(s.length)return s}else if(Yn(n)&&n.x>=0&&n.x<Pt&&n.y>=0&&n.y<He){const i=n.x+n.y*Pt,s=(r=e.lookup)==null?void 0:r[i];return T(s)?e.objects[s]:e.terrain[i]}}).flat().filter(T):[]}function Ww(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var ul;try{ul=new TextDecoder}catch{}var rt,hn,M=0,$t={},Tt,$r,fn=0,Vn=0,Se,wr,Ve=[],At,Hf={useRecords:!1,mapsAsObjects:!0};class Vf{}const Yf=new Vf;Yf.name="MessagePack 0xC1";var jr=!1,qf=2,Xf;try{new Function("")}catch{qf=1/0}class Is{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(rt)return ld(()=>(ml(),this?this.unpack(t,n):Is.prototype.unpack.call(Hf,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Buffer<"u"?Buffer.from(t):new Uint8Array(t)),typeof n=="object"?(hn=n.end||t.length,M=n.start||0):(M=0,hn=n>-1?n:t.length),Vn=0,$r=null,Se=null,rt=t;try{At=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw rt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Is){if($t=this,this.structures)return Tt=this.structures,Yo(n);(!Tt||Tt.length>0)&&(Tt=[])}else $t=Hf,(!Tt||Tt.length>0)&&(Tt=[]);return Yo(n)}unpackMultiple(t,n){let r,i=0;try{jr=!0;let s=t.length,o=this?this.unpack(t,s):qo.unpack(t,s);if(n){if(n(o,i,M)===!1)return;for(;M<s;)if(i=M,n(Yo(),i,M)===!1)return}else{for(r=[o];M<s;)i=M,r.push(Yo());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{jr=!1,ml()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Yo(e){try{if(!$t.trusted&&!jr){let n=Tt.sharedLength||0;n<Tt.length&&(Tt.length=n)}let t;if($t.randomAccessStructure&&rt[M]<64&&rt[M]>=32&&Xf?(t=Xf(rt,M,hn,$t),rt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),M=hn):t=le(),Se&&(M=Se.postBundlePosition,Se=null),jr&&(Tt.restoreStructures=null),M==hn)Tt&&Tt.restoreStructures&&Jf(),Tt=null,rt=null,wr&&(wr=null);else{if(M>hn)throw new Error("Unexpected end of MessagePack data");if(!jr){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw Tt&&Tt.restoreStructures&&Jf(),ml(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||M>hn)&&(t.incomplete=!0),t}}function Jf(){for(let e in Tt.restoreStructures)Tt[e]=Tt.restoreStructures[e];Tt.restoreStructures=null}function le(){let e=rt[M++];if(e<160)if(e<128){if(e<64)return e;{let t=Tt[e&63]||$t.getStructures&&Qf()[e&63];return t?(t.read||(t.read=hl(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,$t.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=sd();r==="__proto__"&&(r="__proto_"),t[r]=le()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(le(),le());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=le();return $t.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Vn>=M)return $r.slice(M-fn,(M+=t)-fn);if(Vn==0&&hn<140){let n=t<16?dl(t):nd(t);if(n!=null)return n}return fl(t)}else{let t;switch(e){case 192:return null;case 193:return Se?(t=le(),t>0?Se[1].slice(Se.position1,Se.position1+=t):Se[0].slice(Se.position0,Se.position0-=t)):Yf;case 194:return!1;case 195:return!0;case 196:if(t=rt[M++],t===void 0)throw new Error("Unexpected end of buffer");return pl(t);case 197:return t=At.getUint16(M),M+=2,pl(t);case 198:return t=At.getUint32(M),M+=4,pl(t);case 199:return mi(rt[M++]);case 200:return t=At.getUint16(M),M+=2,mi(t);case 201:return t=At.getUint32(M),M+=4,mi(t);case 202:if(t=At.getFloat32(M),$t.useFloat32>2){let n=gl[(rt[M]&127)<<1|rt[M+1]>>7];return M+=4,(n*t+(t>0?.5:-.5)>>0)/n}return M+=4,t;case 203:return t=At.getFloat64(M),M+=8,t;case 204:return rt[M++];case 205:return t=At.getUint16(M),M+=2,t;case 206:return t=At.getUint32(M),M+=4,t;case 207:return $t.int64AsType==="number"?(t=At.getUint32(M)*4294967296,t+=At.getUint32(M+4)):$t.int64AsType==="string"?t=At.getBigUint64(M).toString():$t.int64AsType==="auto"?(t=At.getBigUint64(M),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=At.getBigUint64(M),M+=8,t;case 208:return At.getInt8(M++);case 209:return t=At.getInt16(M),M+=2,t;case 210:return t=At.getInt32(M),M+=4,t;case 211:return $t.int64AsType==="number"?(t=At.getInt32(M)*4294967296,t+=At.getUint32(M+4)):$t.int64AsType==="string"?t=At.getBigInt64(M).toString():$t.int64AsType==="auto"?(t=At.getBigInt64(M),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=At.getBigInt64(M),M+=8,t;case 212:if(t=rt[M++],t==114)return ad(rt[M++]&63);{let n=Ve[t];if(n)return n.read?(M++,n.read(le())):n.noBuffer?(M++,n()):n(rt.subarray(M,++M));throw new Error("Unknown extension "+t)}case 213:return t=rt[M],t==114?(M++,ad(rt[M++]&63,rt[M++])):mi(2);case 214:return mi(4);case 215:return mi(8);case 216:return mi(16);case 217:return t=rt[M++],Vn>=M?$r.slice(M-fn,(M+=t)-fn):Kw(t);case 218:return t=At.getUint16(M),M+=2,Vn>=M?$r.slice(M-fn,(M+=t)-fn):Hw(t);case 219:return t=At.getUint32(M),M+=4,Vn>=M?$r.slice(M-fn,(M+=t)-fn):Vw(t);case 220:return t=At.getUint16(M),M+=2,td(t);case 221:return t=At.getUint32(M),M+=4,td(t);case 222:return t=At.getUint16(M),M+=2,ed(t);case 223:return t=At.getUint32(M),M+=4,ed(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const Gw=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function hl(e,t){function n(){if(n.count++>qf){let i=e.read=new Function("r","return function(){return "+($t.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":Gw.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(le);return e.highByte===0&&(e.read=Zf(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=le()}return $t.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Zf(t,n):n}const Zf=(e,t)=>function(){let n=rt[M++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=Tt[r]||Qf()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=hl(i,e)),i.read()};function Qf(){let e=ld(()=>(rt=null,$t.getStructures()));return Tt=$t._mergeStructures(e,Tt)}var fl=Cs,Kw=Cs,Hw=Cs,Vw=Cs;function Cs(e){let t;if(e<16&&(t=dl(e)))return t;if(e>64&&ul)return ul.decode(rt.subarray(M,M+=e));const n=M+e,r=[];for(t="";M<n;){const i=rt[M++];if(!(i&128))r.push(i);else if((i&224)===192){const s=rt[M++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=rt[M++]&63,o=rt[M++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=rt[M++]&63,o=rt[M++]&63,a=rt[M++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Ae.apply(String,r),r.length=0)}return r.length>0&&(t+=Ae.apply(String,r)),t}function td(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=le();return $t.freezeData?Object.freeze(t):t}function ed(e){if($t.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=sd();r==="__proto__"&&(r="__proto_"),t[r]=le()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(le(),le());return t}}var Ae=String.fromCharCode;function nd(e){let t=M,n=new Array(e);for(let r=0;r<e;r++){const i=rt[M++];if((i&128)>0){M=t;return}n[r]=i}return Ae.apply(String,n)}function dl(e){if(e<4)if(e<2){if(e===0)return"";{let t=rt[M++];if((t&128)>1){M-=1;return}return Ae(t)}}else{let t=rt[M++],n=rt[M++];if((t&128)>0||(n&128)>0){M-=2;return}if(e<3)return Ae(t,n);let r=rt[M++];if((r&128)>0){M-=3;return}return Ae(t,n,r)}else{let t=rt[M++],n=rt[M++],r=rt[M++],i=rt[M++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){M-=4;return}if(e<6){if(e===4)return Ae(t,n,r,i);{let s=rt[M++];if((s&128)>0){M-=5;return}return Ae(t,n,r,i,s)}}else if(e<8){let s=rt[M++],o=rt[M++];if((s&128)>0||(o&128)>0){M-=6;return}if(e<7)return Ae(t,n,r,i,s,o);let a=rt[M++];if((a&128)>0){M-=7;return}return Ae(t,n,r,i,s,o,a)}else{let s=rt[M++],o=rt[M++],a=rt[M++],c=rt[M++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){M-=8;return}if(e<10){if(e===8)return Ae(t,n,r,i,s,o,a,c);{let l=rt[M++];if((l&128)>0){M-=9;return}return Ae(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=rt[M++],u=rt[M++];if((l&128)>0||(u&128)>0){M-=10;return}if(e<11)return Ae(t,n,r,i,s,o,a,c,l,u);let f=rt[M++];if((f&128)>0){M-=11;return}return Ae(t,n,r,i,s,o,a,c,l,u,f)}else{let l=rt[M++],u=rt[M++],f=rt[M++],d=rt[M++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){M-=12;return}if(e<14){if(e===12)return Ae(t,n,r,i,s,o,a,c,l,u,f,d);{let h=rt[M++];if((h&128)>0){M-=13;return}return Ae(t,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=rt[M++],p=rt[M++];if((h&128)>0||(p&128)>0){M-=14;return}if(e<15)return Ae(t,n,r,i,s,o,a,c,l,u,f,d,h,p);let m=rt[M++];if((m&128)>0){M-=15;return}return Ae(t,n,r,i,s,o,a,c,l,u,f,d,h,p,m)}}}}}function rd(){let e=rt[M++],t;if(e<192)t=e-160;else switch(e){case 217:t=rt[M++];break;case 218:t=At.getUint16(M),M+=2;break;case 219:t=At.getUint32(M),M+=4;break;default:throw new Error("Expected string")}return Cs(t)}function pl(e){return $t.copyBuffers?Uint8Array.prototype.slice.call(rt,M,M+=e):rt.subarray(M,M+=e)}function mi(e){let t=rt[M++];if(Ve[t]){let n;return Ve[t](rt.subarray(M,n=M+=e),r=>{M=r;try{return le()}finally{M=n}})}else throw new Error("Unknown extension type "+t)}var id=new Array(4096);function sd(){let e=rt[M++];if(e>=160&&e<192){if(e=e-160,Vn>=M)return $r.slice(M-fn,(M+=e)-fn);if(!(Vn==0&&hn<180))return fl(e)}else return M--,od(le());let t=(e<<5^(e>1?At.getUint16(M):e>0?rt[M]:0))&4095,n=id[t],r=M,i=M+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=At.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=rt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return M=r,n.string;i-=3,r=M}for(n=[],id[t]=n,n.bytes=e;r<i;)s=At.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=rt[r++],n.push(s);let a=e<16?dl(e):nd(e);return a!=null?n.string=a:n.string=fl(e)}function od(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const ad=(e,t)=>{let n=le().map(od),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=Tt[e];return i&&(i.isShared||jr)&&((Tt.restoreStructures||(Tt.restoreStructures=[]))[e]=i),Tt[e]=n,n.read=hl(n,r),n.read()};Ve[0]=()=>{},Ve[0].noBuffer=!0,Ve[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let Yw={Error,TypeError,ReferenceError};Ve[101]=()=>{let e=le();return(Yw[e[0]]||Error)(e[1],{cause:e[2]})},Ve[105]=e=>{if($t.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=At.getUint32(M-4);wr||(wr=new Map);let n=rt[M],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};wr.set(t,i);let s=le();return i.used?Object.assign(r,s):(i.target=s,s)},Ve[112]=e=>{if($t.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=At.getUint32(M-4),n=wr.get(t);return n.used=!0,n.target},Ve[115]=()=>new Set(le());const cd=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let qw=typeof globalThis=="object"?globalThis:window;Ve[116]=e=>{let t=e[0],n=cd[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new qw[n](Uint8Array.prototype.slice.call(e,1).buffer)},Ve[120]=()=>{let e=le();return new RegExp(e[0],e[1])};const Xw=[];Ve[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=M;return M+=t-e.length,Se=Xw,Se=[rd(),rd()],Se.position0=0,Se.position1=0,Se.postBundlePosition=M,M=n,le()},Ve[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function ld(e){let t=hn,n=M,r=fn,i=Vn,s=$r,o=wr,a=Se,c=new Uint8Array(rt.slice(0,hn)),l=Tt,u=Tt.slice(0,Tt.length),f=$t,d=jr,h=e();return hn=t,M=n,fn=r,Vn=i,$r=s,wr=o,Se=a,rt=c,jr=d,Tt=l,Tt.splice(0,Tt.length,...u),$t=f,At=new DataView(rt.buffer,rt.byteOffset,rt.byteLength),h}function ml(){rt=null,wr=null,Tt=null}const gl=new Array(147);for(let e=0;e<256;e++)gl[e]=+("1e"+Math.floor(45.15-e*.30103));var qo=new Is({useRecords:!1});const Jw=qo.unpack;qo.unpackMultiple,qo.unpack;let Zw=new Float32Array(1);new Uint8Array(Zw.buffer,0,4);let Xo;try{Xo=new TextEncoder}catch{}let yl,ud;const Jo=typeof Buffer<"u",Zo=Jo?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,hd=Jo?Buffer:Uint8Array,fd=Jo?4294967296:2144337920;let z,Ns,jt,D=0,ze,Jt=null,Qw;const tE=21760,eE=/[\u0080-\uFFFF]/,Vi=Symbol("record-id");class nE extends Is{constructor(t){super(t),this.offset=0;let n,r,i,s,o=hd.prototype.utf8Write?function(A,y){return z.utf8Write(A,y,z.byteLength-y)}:Xo&&Xo.encodeInto?function(A,y){return Xo.encodeInto(A,z.subarray(y)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,p=u+f+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,g=0;this.pack=this.encode=function(A,y){if(z||(z=new Zo(8192),jt=z.dataView||(z.dataView=new DataView(z.buffer,0,8192)),D=0),ze=z.length-10,ze-D<2048?(z=new Zo(z.length),jt=z.dataView||(z.dataView=new DataView(z.buffer,0,z.length)),ze=z.length-10,D=0):D=D+7&2147483640,n=D,y&lE&&(D+=y&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof A!="string"?(Jt=[],Jt.size=1/0):Jt=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let j=i.sharedLength||0;if(j>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let U=0;U<j;U++){let q=i[U];if(!q)continue;let G,J=i.transitions;for(let F=0,B=q.length;F<B;F++){let ct=q[F];G=J[ct],G||(G=J[ct]=Object.create(null)),J=G}J[Vi]=U+64}this.lastNamedStructuresLength=j}c||(i.nextId=j+64)}r&&(r=!1);let L;try{a.randomAccessStructure&&A&&A.constructor&&A.constructor===Object?C(A):w(A);let j=Jt;if(Jt&&md(n,w,0),s&&s.idsToInsert){let U=s.idsToInsert.sort((F,B)=>F.offset>B.offset?1:-1),q=U.length,G=-1;for(;j&&q>0;){let F=U[--q].offset+n;F<j.stringsPosition+n&&G===-1&&(G=0),F>j.position+n?G>=0&&(G+=6):(G>=0&&(jt.setUint32(j.position+n,jt.getUint32(j.position+n)+G),G=-1),j=j.previous,q++)}G>=0&&j&&jt.setUint32(j.position+n,jt.getUint32(j.position+n)+G),D+=U.length*6,D>ze&&O(D),a.offset=D;let J=iE(z.subarray(n,D),U);return s=null,J}return a.offset=D,y&aE?(z.start=n,z.end=D,z):z.subarray(n,D)}catch(j){throw L=j,j}finally{if(i&&(x(),r&&a.saveStructures)){let j=i.sharedLength||0,U=z.subarray(n,D),q=sE(i,a);if(!L)return a.saveStructures(q,q.isCompatible)===!1?a.pack(A,y):(a.lastNamedStructuresLength=j,z.length>1073741824&&(z=null),U)}z.length>1073741824&&(z=null),y&cE&&(D=n)}};const x=()=>{g<10&&g++;let A=i.sharedLength||0;if(i.length>A&&!c&&(i.length=A),b>1e4)i.transitions=null,g=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let y=0,L=m.length;y<L;y++)m[y][Vi]=0;m=[]}},S=A=>{var y=A.length;y<16?z[D++]=144|y:y<65536?(z[D++]=220,z[D++]=y>>8,z[D++]=y&255):(z[D++]=221,jt.setUint32(D,y),D+=4);for(let L=0;L<y;L++)w(A[L])},w=A=>{D>ze&&(z=O(D));var y=typeof A,L;if(y==="string"){let j=A.length;if(Jt&&j>=4&&j<4096){if((Jt.size+=j)>tE){let J,F=(Jt[0]?Jt[0].length*3+Jt[1].length:0)+10;D+F>ze&&(z=O(D+F));let B;Jt.position?(B=Jt,z[D]=200,D+=3,z[D++]=98,J=D-n,D+=4,md(n,w,0),jt.setUint16(J+n-3,D-n-J)):(z[D++]=214,z[D++]=98,J=D-n,D+=4),Jt=["",""],Jt.previous=B,Jt.size=0,Jt.position=J}let G=eE.test(A);Jt[G?0:1]+=A,z[D++]=193,w(G?-j:j);return}let U;j<32?U=1:j<256?U=2:j<65536?U=3:U=5;let q=j*3;if(D+q>ze&&(z=O(D+q)),j<64||!o){let G,J,F,B=D+U;for(G=0;G<j;G++)J=A.charCodeAt(G),J<128?z[B++]=J:J<2048?(z[B++]=J>>6|192,z[B++]=J&63|128):(J&64512)===55296&&((F=A.charCodeAt(G+1))&64512)===56320?(J=65536+((J&1023)<<10)+(F&1023),G++,z[B++]=J>>18|240,z[B++]=J>>12&63|128,z[B++]=J>>6&63|128,z[B++]=J&63|128):(z[B++]=J>>12|224,z[B++]=J>>6&63|128,z[B++]=J&63|128);L=B-D-U}else L=o(A,D+U);L<32?z[D++]=160|L:L<256?(U<2&&z.copyWithin(D+2,D+1,D+1+L),z[D++]=217,z[D++]=L):L<65536?(U<3&&z.copyWithin(D+3,D+2,D+2+L),z[D++]=218,z[D++]=L>>8,z[D++]=L&255):(U<5&&z.copyWithin(D+5,D+3,D+3+L),z[D++]=219,jt.setUint32(D,L),D+=4),D+=L}else if(y==="number")if(A>>>0===A)A<32||A<128&&this.useRecords===!1||A<64&&!this.randomAccessStructure?z[D++]=A:A<256?(z[D++]=204,z[D++]=A):A<65536?(z[D++]=205,z[D++]=A>>8,z[D++]=A&255):(z[D++]=206,jt.setUint32(D,A),D+=4);else if(A>>0===A)A>=-32?z[D++]=256+A:A>=-128?(z[D++]=208,z[D++]=A+256):A>=-32768?(z[D++]=209,jt.setInt16(D,A),D+=2):(z[D++]=210,jt.setInt32(D,A),D+=4);else{let j;if((j=this.useFloat32)>0&&A<4294967296&&A>=-2147483648){z[D++]=202,jt.setFloat32(D,A);let U;if(j<4||(U=A*gl[(z[D]&127)<<1|z[D+1]>>7])>>0===U){D+=4;return}else D--}z[D++]=203,jt.setFloat64(D,A),D+=8}else if(y==="object"||y==="function")if(!A)z[D++]=192;else{if(s){let U=s.get(A);if(U){if(!U.id){let q=s.idsToInsert||(s.idsToInsert=[]);U.id=q.push(U)}z[D++]=214,z[D++]=112,jt.setUint32(D,U.id),D+=4;return}else s.set(A,{offset:D-n})}let j=A.constructor;if(j===Object)N(A);else if(j===Array)S(A);else if(j===Map)if(this.mapAsEmptyObject)z[D++]=128;else{L=A.size,L<16?z[D++]=128|L:L<65536?(z[D++]=222,z[D++]=L>>8,z[D++]=L&255):(z[D++]=223,jt.setUint32(D,L),D+=4);for(let[U,q]of A)w(U),w(q)}else{for(let U=0,q=yl.length;U<q;U++){let G=ud[U];if(A instanceof G){let J=yl[U];if(J.write){J.type&&(z[D++]=212,z[D++]=J.type,z[D++]=0);let tt=J.write.call(this,A);tt===A?Array.isArray(A)?S(A):N(A):w(tt);return}let F=z,B=jt,ct=D;z=null;let Q;try{Q=J.pack.call(this,A,tt=>(z=F,F=null,D+=tt,D>ze&&O(D),{target:z,targetView:jt,position:D-tt}),w)}finally{F&&(z=F,jt=B,D=ct,ze=z.length-10)}Q&&(Q.length+D>ze&&O(Q.length+D),D=rE(Q,z,D,J.type));return}}if(Array.isArray(A))S(A);else{if(A.toJSON){const U=A.toJSON();if(U!==A)return w(U)}if(y==="function")return w(this.writeFunction&&this.writeFunction(A));N(A)}}}else if(y==="boolean")z[D++]=A?195:194;else if(y==="bigint"){if(A<BigInt(1)<<BigInt(63)&&A>=-(BigInt(1)<<BigInt(63)))z[D++]=211,jt.setBigInt64(D,A);else if(A<BigInt(1)<<BigInt(64)&&A>0)z[D++]=207,jt.setBigUint64(D,A);else if(this.largeBigIntToFloat)z[D++]=203,jt.setFloat64(D,Number(A));else{if(this.largeBigIntToString)return w(A.toString());if(this.useBigIntExtension&&A<BigInt(2)**BigInt(1023)&&A>-(BigInt(2)**BigInt(1023))){z[D++]=199,D++,z[D++]=66;let j=[],U;do{let q=A&BigInt(255);U=(q&BigInt(128))===(A<BigInt(0)?BigInt(128):BigInt(0)),j.push(q),A>>=BigInt(8)}while(!((A===BigInt(0)||A===BigInt(-1))&&U));z[D-2]=j.length;for(let q=j.length;q>0;)z[D++]=Number(j[--q]);return}else throw new RangeError(A+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}D+=8}else if(y==="undefined")this.encodeUndefinedAsNil?z[D++]=192:(z[D++]=212,z[D++]=0,z[D++]=0);else throw new Error("Unknown type: "+y)},k=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?A=>{let y;if(this.skipValues){y=[];for(let U in A)(typeof A.hasOwnProperty!="function"||A.hasOwnProperty(U))&&!this.skipValues.includes(A[U])&&y.push(U)}else y=Object.keys(A);let L=y.length;L<16?z[D++]=128|L:L<65536?(z[D++]=222,z[D++]=L>>8,z[D++]=L&255):(z[D++]=223,jt.setUint32(D,L),D+=4);let j;if(this.coercibleKeyAsNumber)for(let U=0;U<L;U++){j=y[U];let q=Number(j);w(isNaN(q)?j:q),w(A[j])}else for(let U=0;U<L;U++)w(j=y[U]),w(A[j])}:A=>{z[D++]=222;let y=D-n;D+=2;let L=0;for(let j in A)(typeof A.hasOwnProperty!="function"||A.hasOwnProperty(j))&&(w(j),w(A[j]),L++);if(L>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');z[y+++n]=L>>8,z[y+n]=L&255},v=this.useRecords===!1?k:t.progressiveRecords&&!d?A=>{let y,L=i.transitions||(i.transitions=Object.create(null)),j=D++-n,U;for(let q in A)if(typeof A.hasOwnProperty!="function"||A.hasOwnProperty(q)){if(y=L[q],y)L=y;else{let G=Object.keys(A),J=L;L=i.transitions;let F=0;for(let B=0,ct=G.length;B<ct;B++){let Q=G[B];y=L[Q],y||(y=L[Q]=Object.create(null),F++),L=y}j+n+1==D?(D--,W(L,G,F)):Z(L,G,j,F),U=!0,L=J[q]}w(A[q])}if(!U){let q=L[Vi];q?z[j+n]=q:Z(L,Object.keys(A),j,0)}}:A=>{let y,L=i.transitions||(i.transitions=Object.create(null)),j=0;for(let q in A)(typeof A.hasOwnProperty!="function"||A.hasOwnProperty(q))&&(y=L[q],y||(y=L[q]=Object.create(null),j++),L=y);let U=L[Vi];U?U>=96&&d?(z[D++]=((U-=96)&31)+96,z[D++]=U>>5):z[D++]=U:W(L,L.__keys__||Object.keys(A),j);for(let q in A)(typeof A.hasOwnProperty!="function"||A.hasOwnProperty(q))&&w(A[q])},E=typeof this.useRecords=="function"&&this.useRecords,N=E?A=>{E(A)?v(A):k(A)}:v,O=A=>{let y;if(A>16777216){if(A-n>fd)throw new Error("Packed buffer would be larger than maximum buffer size");y=Math.min(fd,Math.round(Math.max((A-n)*(A>67108864?1.25:2),4194304)/4096)*4096)}else y=(Math.max(A-n<<2,z.length-1)>>12)+1<<12;let L=new Zo(y);return jt=L.dataView||(L.dataView=new DataView(L.buffer,0,y)),A=Math.min(A,z.length),z.copy?z.copy(L,0,n,A):L.set(z.slice(n,A)),D-=n,n=0,ze=L.length-10,z=L},W=(A,y,L)=>{let j=i.nextId;j||(j=64),j<h&&this.shouldShareStructure&&!this.shouldShareStructure(y)?(j=i.nextOwnId,j<p||(j=h),i.nextOwnId=j+1):(j>=p&&(j=h),i.nextId=j+1);let U=y.highByte=j>=96&&d?j-96>>5:-1;A[Vi]=j,A.__keys__=y,i[j-64]=y,j<h?(y.isShared=!0,i.sharedLength=j-63,r=!0,U>=0?(z[D++]=(j&31)+96,z[D++]=U):z[D++]=j):(U>=0?(z[D++]=213,z[D++]=114,z[D++]=(j&31)+96,z[D++]=U):(z[D++]=212,z[D++]=114,z[D++]=j),L&&(b+=g*L),m.length>=f&&(m.shift()[Vi]=0),m.push(A),w(y))},Z=(A,y,L,j)=>{let U=z,q=D,G=ze,J=n;z=Ns,D=0,n=0,z||(Ns=z=new Zo(8192)),ze=z.length-10,W(A,y,j),Ns=z;let F=D;if(z=U,D=q,ze=G,n=J,F>1){let B=D+F-1;B>ze&&O(B);let ct=L+n;z.copyWithin(ct+F,ct+1,D),z.set(Ns.slice(0,F),ct),D=B}else z[L+n]=Ns[0]},C=A=>{let y=Qw(A,z,n,D,i,O,(L,j,U)=>{if(U)return r=!0;D=j;let q=z;return w(L),x(),q!==z?{position:D,targetView:jt,target:z}:D},this);if(y===0)return N(A);D=y}}useBuffer(t){z=t,z.dataView||(z.dataView=new DataView(z.buffer,z.byteOffset,z.byteLength)),D=0}set position(t){D=t}get position(){return D}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}ud=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Vf],yl=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?dd(e,16,t):pd(Jo?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==hd&&this.moreTypes?dd(e,cd.indexOf(n.name),t):pd(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function dd(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function pd(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function rE(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function iE(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function md(e,t,n){if(Jt.length>0){jt.setUint32(Jt.position+e,D+n-Jt.position-e),Jt.stringsPosition=D-e;let r=Jt;Jt=null,t(r[0]),t(r[1])}}function sE(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let gd=new nE({useRecords:!1});const oE=gd.pack;gd.pack;const aE=512,cE=1024,lE=2048;function uE(e,t,n={}){if(!T(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=t[o];T(c)&&(o=c);const l=n[o];T(l)&&(a=l(a)),a!==null&&r.push(c,a)}return r}function hE(e,t,n={}){if(T(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];T(a)&&(s=a);const c=n[s];T(c)&&(o=c(o)),r[s]=o}return r}catch{}}function fE(e){try{return oE(e)}catch(t){ne("format","binary",t.message)}}function dE(e){try{return Jw(e)}catch(t){ne("format","binary",t.message)}}function yd(){return{id:Hn()}}function _d(e,t,n){return T(e)?e[t]??n:void 0}function bd(e,t,n){T(e)&&(e[t]=n)}function _l(e,t){jb(t).forEach(n=>bd(e,n,t[n]))}function pE(){return new Array(Pt*He).map(()=>{})}function mE(e=Hb){const t={terrain:pE(),objects:{},codepage:""};return e(t)}function gE(e,t){return!T(e)||t.x<0||t.x>=Pt||t.y<0||t.y>=He?-1:t.x+t.y*Pt}function yE(e,t){const n=gE(e,t);if(n<0||!T(e==null?void 0:e.lookup))return;const r=wl(e,e.lookup[n]??"");return T(r)?r:e.terrain[n]}function wd(e){var t;return((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"object").toLowerCase()}function _E(e){var t;return(e==null?void 0:e.color)??((t=e==null?void 0:e.kinddata)==null?void 0:t.color)??xt.BLACK}function bE(e){var t;return(e==null?void 0:e.bg)??((t=e==null?void 0:e.kinddata)==null?void 0:t.bg)??xt.BLACK}function Qo(e,t){if(!T(e)||!rn(t))return;const{color:n,bg:r}=Md(t);T(n)&&(e.color=n),T(r)&&(e.bg=r)}function wE(e,t){if(!T(e)||!T(t)||!T(t.x)||!T(t.y)||t.x<0||t.x>=Pt||t.y<0||t.y>=He)return;const n={...t},r=t.x+t.y*Pt;return e.terrain[r]=n,t}function EE(e,t){if(!T(e)||!T(t))return;const n={...t,id:t.id??Hn()};return e.objects[n.id]=n,n}function Ed(e,t,n){return wE(e,{...t,kind:n})}function bl(e,t,n,r){return EE(e,{...t,id:r??void 0,kind:n})}function wl(e,t){if(e)return e.objects[t]}function Yi(e,t,n){if(!T(e)||!T(t))return{x:0,y:0};const r={x:t.x??0,y:t.y??0},i={x:t.lx??r.x,y:t.ly??r.y},s={...r},o=Wr(i,r),a=Pt-1,c=He-1;for(let l=0;l<n.length;++l){const u=RE(n[l]);switch(u){case Mt.IDLE:break;case Mt.NORTH:case Mt.SOUTH:case Mt.WEST:case Mt.EAST:dn(r,u);break;case Mt.BY:{const[f,d]=n.slice(l+1);qt(f)&&qt(d)&&(r.x=pi(r.x+f,0,a),r.y=pi(r.y+d,0,c)),l+=2;break}case Mt.AT:{const[f,d]=n.slice(l+1);qt(f)&&qt(d)&&(r.x=pi(f,0,a),r.y=pi(d,0,c)),l+=2;break}case Mt.FLOW:dn(r,o);break;case Mt.SEEK:{const f=El(e,t);Yn(f)&&dn(r,Wr(s,f));break}case Mt.RNDNS:dn(r,br(Mt.NORTH,Mt.SOUTH));break;case Mt.RNDNE:dn(r,br(Mt.NORTH,Mt.EAST));break;case Mt.RND:dn(r,br(Mt.NORTH,Mt.SOUTH,Mt.WEST,Mt.EAST));break;case Mt.CW:{const f=Yi(e,t,n.slice(l+1));dn(r,Wr(s,f));break}case Mt.CCW:{const f=Yi(e,t,n.slice(l+1));dn(r,Wr(s,f));break}case Mt.OPP:{const f=Yi(e,t,n.slice(l+1));dn(r,Wr(s,f));break}case Mt.RNDP:{const f=Yi(e,t,n.slice(l+1));switch(Wr(s,f)){case Mt.NORTH:case Mt.SOUTH:r.x+=br(-1,1);break;case Mt.WEST:case Mt.EAST:r.y+=br(-1,1);break}break}}}return r}function xd(e,t){return T(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function El(e,t){if(!T(e)||!T(t))return;const r=St(t.id??"").player??"",i=e.objects[r];if(T(i))return i;if(Yn(t))return Ww(t,cl(e,"player"))}function xE(e,t,n){return{board:e.board,object:e.object,words:t,get:n}}var Mt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(Mt||{});function Yn(e){return T(e)&&T(e.x)&&T(e.y)}function dn(e,t){switch(t){case 1:--e.y;break;case 2:++e.y;break;case 3:--e.x;break;case 4:++e.x;break}return e}function Wr(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return 3;if(n>0)return 4;if(r<0)return 1;if(r>0)return 2}const vd={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Gr(e){return Le(e)&&kd(e[0])}function kd(e){return T(Vo[e])&&Lt(e)}function Sd(e){if(Lt(e))return vd[e.toLowerCase()]}function Ad(e){if(Gr(e))return e;if(kd(e))return[e];const t=Sd(e);if(T(t))return[t]}function ta(e,t){const n=e.words[t],r=Ad(n);if(Gr(r))return[r,t+1];const[i,s]=$e(e,t),o=Ad(i);return Gr(o)?[o,s]:[void 0,t]}const Td={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"},vE={issolid:re.ISSOLID,iswalk:re.ISWALK,isswim:re.ISSWIM,isbullet:re.ISBULLET,iswalkable:re.ISWALK,isswimmable:re.ISSWIM};function Kr(e){return Le(e)&&xl(e[0])}function kE(e){return vE[e[0].toLowerCase()]}function xl(e){return T(re[e])&&Lt(e)}function SE(e){if(Lt(e))return Td[e.toLowerCase()]}function Rd(e,t){const n=e.words[t];if(Kr(n))return[n,t+1];if(xl(n))return[[n],t+1];const[r,i]=$e(e,t);return Kr(r)?[r,i]:xl(r)?[[r],i]:[void 0,t]}const ea={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",clear:"CLEAR",shadow:"SHADOW",borrow:"BORROW",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY"};function rn(e){return Le(e)&&Id(e[0])}function Od(e){return rn(e)&&e[0].startsWith("ON")}function Id(e){return T(xt[e])&&Lt(e)}function Cd(e){if(Lt(e))return ea[e.toLowerCase()]}function AE(e){return e.map(t=>xt[t]).find(t=>T(t)&&t<xt.ONBLACK)}function TE(e){return e.map(t=>xt[t]).find(t=>T(t)&&t>=xt.ONBLACK)}function Nd(e){if(rn(e))return e;if(Id(e))return[e];const t=Cd(e);if(T(t))return[t]}function Ld(e,t){const n=e.words[t],r=Nd(n);if(rn(r))return[r,t+1];const[i,s]=$e(e,t),o=Nd(i);return rn(o)?[o,s]:[void 0,t]}function na(e,t){const n=[];let r=t;const[i,s]=Ld(e,t);if(rn(i)&&(n.push(...i),r=s),rn(n)&&!Od(n)){const[o,a]=Ld(e,s);Od(o)&&(r=a)}return n.length?[n,r]:[void 0,t]}function Md(e){const t={};return e.every(n=>{const r=xt[n];T(r)&&(r<xt.ONBLACK?t.color=r:t.bg=r-xt.ONBLACK)}),t}function qi(e){return Le(e)&&typeof e[0]=="string"}function Ud(e,t){const n=e.words[t];if(qi(n))return[n,t+1];const[r,i]=na(e,t),[s,o]=$e(e,i,!1);return Lt(s)?[[s,r],o]:[void 0,t]}function vl(e){if(!qi(e))return;const[t]=e;return t}function Dd(e){if(!qi(e))return;const[,t]=e,n=T(t)?AE(t):void 0;return T(n)?n:void 0}function Pd(e){if(!qi(e))return;const[,t]=e,n=T(t)?TE(t):void 0;return T(n)?n:void 0}const Bd={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function Er(e){return Le(e)&&Fd(e[0])}function Fd(e){return T(Mt[e])&&Lt(e)}function RE(e){const t=Mt[e];return T(t)?t:0}function zd(e){if(Lt(e))return Bd[e.toLowerCase()]}function $d(e){if(Er(e))return e;if(Fd(e))return[e];const t=zd(e);if(T(t))return[t]}function jd(e,t){const n=e.words[t],r=$d(n);if(Er(r))return[r,t+1];const[i,s]=$e(e,t),o=$d(i);return Er(o)?[o,s]:[void 0,t]}function kl(e,t){const n=[];let[r,i]=jd(e,t);for(;Er(r);){if(n.push(...r),r[0]==="AT"||r[0]==="BY"){const[a,c,l]=it(e,i,[5,5]);n.push(a,c),i=l}const[s,o]=jd(e,i);r=s,i=o}return n.length?[n,i]:[void 0,t]}function $e(e,t,n=!0){const r=e.words[t];if(Sd(r)){const[i,s]=ta(e,t);if(T(i))return[i,s]}if(SE(r)){const[i,s]=Rd(e,t);if(T(i))return[i,s]}if(Cd(r)){const[i,s]=na(e,t);if(T(i))return[i,s]}if(Lt(r)&&r.toLowerCase()==="rnd"){const[i,s]=$e(e,t+1),[o,a]=$e(e,s);return qt(i)&&qt(o)?[Ho(i,o),a]:qt(i)?[Ho(0,i),s]:[Ho(0,1),t+1]}if(zd(r)){const[i,s]=kl(e,t);if(T(i))return[i,s]}if(!T(r))return[void 0,t];if(Yn(r)||qt(r)||Le(r))return[r,t+1];if(Lt(r)){const i=r.toLowerCase();if(n){const s=e.get(r);if(T(s))return[s,t+1]}switch(i){case"aligned":case"alligned":break;case"contact":break;case"blocked":break;case"any":break;case"abs":{const[s,o]=it(e,t+1,[5]);return[Math.abs(s),o]}case"ceil":{const[s,o]=it(e,t+1,[5]);return[Math.ceil(s),o]}case"floor":{const[s,o]=it(e,t+1,[5]);return[Math.floor(s),o]}case"round":{const[s,o]=it(e,t+1,[5]);return[Math.round(s),o]}case"min":{const s=[];for(let o=t+1;o<e.words.length;){const[a,c]=$e(e,o);if(Le(a)&&!Yn(a)&&!Er(a)&&!Gr(a)&&!Kr(a)&&!rn(a))return[br(a),c];o=c,s.push(a)}return[Math.min(...s),e.words.length]}case"max":{const s=[];for(let o=t+1;o<e.words.length;){const[a,c]=$e(e,o);if(Le(a)&&!Yn(a)&&!Er(a)&&!Gr(a)&&!Kr(a)&&!rn(a))return[br(a),c];o=c,s.push(a)}return[Math.max(...s),e.words.length]}case"clamp":{const[s,o,a,c]=it(e,t+1,[5,5,5]);return[pi(s,o,a),c]}case"pick":{const s=[];for(let o=t+1;o<e.words.length;){const[a,c]=$e(e,o);if(Le(a)&&!Yn(a)&&!Er(a)&&!Gr(a)&&!Kr(a)&&!rn(a))return[br(a),c];o=c,s.push(a)}return[br(s),e.words.length]}case"range":{const[s,o,a,c]=it(e,t+1,[5,13,13]);return[al(s,o,a),c]}}}return[r,t+1]}var X=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NUMBER=5]="NUMBER",e[e.STRING=6]="STRING",e[e.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=9]="MAYBE_COLLISION",e[e.MAYBE_COLOR=10]="MAYBE_COLOR",e[e.MAYBE_KIND=11]="MAYBE_KIND",e[e.MAYBE_DIR=12]="MAYBE_DIR",e[e.MAYBE_NUMBER=13]="MAYBE_NUMBER",e[e.MAYBE_STRING=14]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",e[e.ANY=16]="ANY",e))(X||{});function Ue(e,t){throw new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function it(e,t,n){const r=[];let i=t;for(let s=0;s<n.length;++s)switch(n[s]){case 0:{const[o,a]=ta(e,i);Gr(o)||Ue("terrain or object",o),i=a,r.push(o);break}case 1:{const[o,a]=Rd(e,i);Kr(o)||Ue("solid, walk, swim, bullet, walkable or swimmable",o),i=a,r.push(o);break}case 2:{const[o,a]=na(e,i);rn(o)||Ue("color",o),i=a,r.push(o);break}case 3:{const[o,a]=Ud(e,i);qi(o)?(i=a,r.push(o)):Ue("kind",o);break}case 4:{const[o,a]=kl(e,i);if(Er(o)){const c=e.board?Yi(e.board,e.object,o):{x:0,y:0};i=a,r.push(c)}else Ue("direction",o);break}case 5:{const[o,a]=$e(e,i);qt(o)||Ue("number",o),i=a,r.push(o);break}case 6:{const o=e.words[i];Lt(o)||Ue("string",o),++i,r.push(o);break}case 7:{const[o,a]=$e(e,i,!1);!qt(o)&&!Lt(o)&&Ue("number or string",o),i=a,r.push(o);break}case 8:{const[o,a]=ta(e,i);o!==void 0&&!Gr(o)&&Ue("optional terrain or object",o),i=a,r.push(o);break}case 9:{const[o,a]=ta(e,i);o!==void 0&&!Kr(o)&&Ue("optional solid, walk, swim, bullet, walkable or swimmable",o),i=a,r.push(o);break}case 10:{const[o,a]=na(e,i);o!==void 0&&!rn(o)&&Ue("optional color",o),i=a,r.push(o);break}case 11:{const[o,a]=Ud(e,i);o!==void 0&&!qi(o)&&Ue("optional kind",o),i=a,r.push(o);break}case 12:{const[o,a]=kl(e,i);if(Er(o)){const c=e.board?Yi(e.board,e.object,o):{x:0,y:0};i=a,r.push(c)}else o===void 0?(i=a,r.push(void 0)):Ue("optional direction",o);break}case 13:{const[o,a]=$e(e,i);o!==void 0&&!qt(o)&&Ue("optional number",o),i=a,r.push(o);break}case 14:{const o=e.words[i];o!==void 0&&!Lt(o)&&Ue("optional string",o),++i,r.push(o);break}case 15:{const[o,a]=$e(e,i,!1);o!==void 0&&!qt(o)&&!Lt(o)&&Ue("optional number or string",o),i=a,r.push(o);break}case 16:{const[o,a]=$e(e,i);i=a,r.push(o);break}}return[...r,i]}var Wd={},Gd={},Kd={};const Hd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Kd.encode=function(e){if(0<=e&&e<Hd.length)return Hd[e];throw new TypeError("Must be between 0 and 63: "+e)};const OE=Kd,Vd=5,Yd=1<<Vd,IE=Yd-1,CE=Yd;function NE(e){return e<0?(-e<<1)+1:(e<<1)+0}Gd.encode=function(t){let n="",r,i=NE(t);do r=i&IE,i>>>=Vd,i>0&&(r|=CE),n+=OE.encode(r);while(i>0);return n};var Ls={};(function(e){function t(v,E,N){if(E in v)return v[E];if(arguments.length===3)return N;throw new Error('"'+E+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(v){const E=v.match(n);return E?{scheme:E[1],auth:E[2],host:E[3],port:E[4],path:E[5]}:null}e.urlParse=i;function s(v){let E="";return v.scheme&&(E+=v.scheme+":"),E+="//",v.auth&&(E+=v.auth+"@"),v.host&&(E+=v.host),v.port&&(E+=":"+v.port),v.path&&(E+=v.path),E}e.urlGenerate=s;const o=32;function a(v){const E=[];return function(N){for(let W=0;W<E.length;W++)if(E[W].input===N){const Z=E[0];return E[0]=E[W],E[W]=Z,E[0].result}const O=v(N);return E.unshift({input:N,result:O}),E.length>o&&E.pop(),O}}const c=a(function(E){let N=E;const O=i(E);if(O){if(!O.path)return E;N=O.path}const W=e.isAbsolute(N),Z=[];let C=0,A=0;for(;;)if(C=A,A=N.indexOf("/",C),A===-1){Z.push(N.slice(C));break}else for(Z.push(N.slice(C,A));A<N.length&&N[A]==="/";)A++;let y=0;for(A=Z.length-1;A>=0;A--){const L=Z[A];L==="."?Z.splice(A,1):L===".."?y++:y>0&&(L===""?(Z.splice(A+1,y),y=0):(Z.splice(A,2),y--))}return N=Z.join("/"),N===""&&(N=W?"/":"."),O?(O.path=N,s(O)):N});e.normalize=c;function l(v,E){v===""&&(v="."),E===""&&(E=".");const N=i(E),O=i(v);if(O&&(v=O.path||"/"),N&&!N.scheme)return O&&(N.scheme=O.scheme),s(N);if(N||E.match(r))return E;if(O&&!O.host&&!O.path)return O.host=E,s(O);const W=E.charAt(0)==="/"?E:c(v.replace(/\/+$/,"")+"/"+E);return O?(O.path=W,s(O)):W}e.join=l,e.isAbsolute=function(v){return v.charAt(0)==="/"||n.test(v)};function u(v,E){v===""&&(v="."),v=v.replace(/\/$/,"");let N=0;for(;E.indexOf(v+"/")!==0;){const O=v.lastIndexOf("/");if(O<0||(v=v.slice(0,O),v.match(/^([^\/]+:\/)?\/*$/)))return E;++N}return Array(N+1).join("../")+E.substr(v.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(v){return v}function h(v){return m(v)?"$"+v:v}e.toSetString=f?d:h;function p(v){return m(v)?v.slice(1):v}e.fromSetString=f?d:p;function m(v){if(!v)return!1;const E=v.length;if(E<9||v.charCodeAt(E-1)!==95||v.charCodeAt(E-2)!==95||v.charCodeAt(E-3)!==111||v.charCodeAt(E-4)!==116||v.charCodeAt(E-5)!==111||v.charCodeAt(E-6)!==114||v.charCodeAt(E-7)!==112||v.charCodeAt(E-8)!==95||v.charCodeAt(E-9)!==95)return!1;for(let N=E-10;N>=0;N--)if(v.charCodeAt(N)!==36)return!1;return!0}function b(v,E,N){let O=x(v.source,E.source);return O!==0||(O=v.originalLine-E.originalLine,O!==0)||(O=v.originalColumn-E.originalColumn,O!==0||N)||(O=v.generatedColumn-E.generatedColumn,O!==0)||(O=v.generatedLine-E.generatedLine,O!==0)?O:x(v.name,E.name)}e.compareByOriginalPositions=b;function g(v,E,N){let O=v.generatedLine-E.generatedLine;return O!==0||(O=v.generatedColumn-E.generatedColumn,O!==0||N)||(O=x(v.source,E.source),O!==0)||(O=v.originalLine-E.originalLine,O!==0)||(O=v.originalColumn-E.originalColumn,O!==0)?O:x(v.name,E.name)}e.compareByGeneratedPositionsDeflated=g;function x(v,E){return v===E?0:v===null?1:E===null?-1:v>E?1:-1}function S(v,E){let N=v.generatedLine-E.generatedLine;return N!==0||(N=v.generatedColumn-E.generatedColumn,N!==0)||(N=x(v.source,E.source),N!==0)||(N=v.originalLine-E.originalLine,N!==0)||(N=v.originalColumn-E.originalColumn,N!==0)?N:x(v.name,E.name)}e.compareByGeneratedPositionsInflated=S;function w(v){return JSON.parse(v.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=w;function k(v,E,N){if(E=E||"",v&&(v[v.length-1]!=="/"&&E[0]!=="/"&&(v+="/"),E=v+E),N){const O=i(N);if(!O)throw new Error("sourceMapURL could not be parsed");if(O.path){const W=O.path.lastIndexOf("/");W>=0&&(O.path=O.path.substring(0,W+1))}E=l(s(O),E)}return c(E)}e.computeSourceURL=k})(Ls);var Sl={};let LE=class cb{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new cb;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Sl.ArraySet=LE;var qd={};const Xd=Ls;function ME(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||Xd.compareByGeneratedPositionsInflated(e,t)<=0}let UE=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){ME(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(Xd.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};qd.MappingList=UE;const Ms=Gd,fe=Ls,ra=Sl.ArraySet,DE=qd.MappingList;let Jd=class lb{constructor(t){t||(t={}),this._file=fe.getArg(t,"file",null),this._sourceRoot=fe.getArg(t,"sourceRoot",null),this._skipValidation=fe.getArg(t,"skipValidation",!1),this._sources=new ra,this._names=new ra,this._mappings=new DE,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new lb({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=fe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=fe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=fe.getArg(t,"generated"),r=fe.getArg(t,"original",null);let i=fe.getArg(t,"source",null),s=fe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=fe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[fe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[fe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=fe.relative(s,i));const o=this._mappings.toArray().length>0?new ra:this._sources,a=new ra;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=fe.join(r,c.source)),s!=null&&(c.source=fe.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=fe.join(r,c)),s!=null&&(c=fe.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,p=d.length;h<p;h++){if(l=d[h],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!fe.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Ms.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Ms.encode(f-o),o=f,c+=Ms.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Ms.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Ms.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=fe.relative(n,r));const i=fe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Jd.prototype._version=3,Wd.SourceMapGenerator=Jd;var Zd={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(Zd);var Us={exports:{}},PE={},BE=Object.freeze({__proto__:null,default:PE}),Qd=ub(BE);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Us.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Us.exports.initialize=t=>e=t}else{const e=Qd,t=Qd;Us.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Us.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var tp=Us.exports;const FE=tp;function zE(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Ds=null;var $E=function(){if(Ds)return Ds;const t=[];return Ds=FE().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new zE;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Ds=null,n}),Ds};const lt=Ls,Al=Zd,ia=Sl.ArraySet,jE=tp,WE=$E,Tl=Symbol("smcInternal");class ue{constructor(t,n){return t==Tl?Promise.resolve(this):KE(t,n)}static initialize(t){jE.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return HE(t,n)}static async with(t,n,r){const i=await new ue(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ue.prototype._version=3,ue.GENERATED_ORDER=1,ue.ORIGINAL_ORDER=2,ue.GREATEST_LOWER_BOUND=1,ue.LEAST_UPPER_BOUND=2;class Ps extends ue{constructor(t,n){return super(Tl).then(r=>{let i=t;typeof t=="string"&&(i=lt.parseSourceMapInput(t));const s=lt.getArg(i,"version");let o=lt.getArg(i,"sources");const a=lt.getArg(i,"names",[]);let c=lt.getArg(i,"sourceRoot",null);const l=lt.getArg(i,"sourcesContent",null),u=lt.getArg(i,"mappings"),f=lt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=lt.normalize(c)),o=o.map(String).map(lt.normalize).map(function(d){return c&&lt.isAbsolute(c)&&lt.isAbsolute(d)?lt.relative(c,d):d}),r._names=ia.fromArray(a.map(String),!0),r._sources=ia.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return lt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,WE().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=lt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new Ps(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||ue.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=lt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case ue.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ue.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=lt.getArg(t,"source");const r=lt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:lt.getArg(t,"line"),generatedColumn:lt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=lt.getArg(t,"bias",ue.GREATEST_LOWER_BOUND);r==null&&(r=ue.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=lt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=lt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=lt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:lt.getArg(i,"originalLine",null),column:lt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=lt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=lt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=lt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:lt.getArg(t,"line"),originalColumn:lt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=lt.getArg(t,"bias",ue.GREATEST_LOWER_BOUND);i==null&&(i=ue.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:lt.getArg(s,"generatedLine",null),column:lt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}Ps.prototype.consumer=ue;class GE extends ue{constructor(t,n){return super(Tl).then(r=>{let i=t;typeof t=="string"&&(i=lt.parseSourceMapInput(t));const s=lt.getArg(i,"version"),o=lt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new ia,r._names=new ia,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=lt.getArg(c,"offset"),u=lt.getArg(l,"line"),f=lt.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ue(lt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(lt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(lt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:lt.getArg(t,"line"),generatedColumn:lt.getArg(t,"column")},r=Al.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(lt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=lt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||ue.GENERATED_ORDER;let o;switch(s){case ue.GENERATED_ORDER:o=this._generatedMappings;break;case ue.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=lt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return Al.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=lt.getArg(t,"line"),r={source:lt.getArg(t,"source"),originalLine:n,originalColumn:lt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",lt.compareByOriginalPositions,Al.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:lt.getArg(o,"generatedLine",null),column:lt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:lt.getArg(o,"generatedLine",null),column:lt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function KE(e,t){let n=e;typeof e=="string"&&(n=lt.parseSourceMapInput(e));const r=n.sections!=null?new GE(n,t):new Ps(n,t);return Promise.resolve(r)}function HE(e,t){return Ps.fromSourceMap(e,t)}var ep={};const VE=Wd.SourceMapGenerator,sa=Ls,YE=/(\r?\n)/,qE=10,Xi="$$$isSourceNode$$$";let XE=class of{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[Xi]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new of,s=t.split(YE);let o=0;const a=function(){const h=m(),p=m()||"";return h+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const p=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,p),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const p=n.sourceContentFor(h);p!=null&&(r!=null&&(h=sa.join(r,h)),i.setSourceContent(h,p))}),i;function d(h,p){if(h===null||h.source===void 0)i.add(p);else{const m=r?sa.join(r,h.source):h.source;i.add(new of(h.originalLine,h.originalColumn,m,p,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[Xi]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[Xi]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[Xi]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[Xi]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[sa.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][Xi]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(sa.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new VE(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===qE?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};ep.SourceNode=XE;var JE=ep.SourceNode;const qn=!!JSON.parse("false"),ZE=!!JSON.parse("false");JSON.parse("false");const QE=!!JSON.parse("false"),t1="";JSON.parse("false"),JSON.parse("false");var np=typeof global=="object"&&global&&global.Object===Object&&global,e1=typeof self=="object"&&self&&self.Object===Object&&self,Xn=np||e1||Function("return this")(),pn=Xn.Symbol,rp=Object.prototype,n1=rp.hasOwnProperty,r1=rp.toString,Bs=pn?pn.toStringTag:void 0;function i1(e){var t=n1.call(e,Bs),n=e[Bs];try{e[Bs]=void 0;var r=!0}catch{}var i=r1.call(e);return r&&(t?e[Bs]=n:delete e[Bs]),i}var s1=Object.prototype,o1=s1.toString;function a1(e){return o1.call(e)}var c1="[object Null]",l1="[object Undefined]",ip=pn?pn.toStringTag:void 0;function Hr(e){return e==null?e===void 0?l1:c1:ip&&ip in Object(e)?i1(e):a1(e)}function On(e){return e!=null&&typeof e=="object"}var u1="[object Symbol]";function oa(e){return typeof e=="symbol"||On(e)&&Hr(e)==u1}function aa(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var It=Array.isArray,h1=1/0,sp=pn?pn.prototype:void 0,op=sp?sp.toString:void 0;function ap(e){if(typeof e=="string")return e;if(It(e))return aa(e,ap)+"";if(oa(e))return op?op.call(e):"";var t=e+"";return t=="0"&&1/e==-h1?"-0":t}var f1=/\s/;function d1(e){for(var t=e.length;t--&&f1.test(e.charAt(t)););return t}var p1=/^\s+/;function m1(e){return e&&e.slice(0,d1(e)+1).replace(p1,"")}function mn(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var cp=NaN,g1=/^[-+]0x[0-9a-f]+$/i,y1=/^0b[01]+$/i,_1=/^0o[0-7]+$/i,b1=parseInt;function w1(e){if(typeof e=="number")return e;if(oa(e))return cp;if(mn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=mn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=m1(e);var n=y1.test(e);return n||_1.test(e)?b1(e.slice(2),n?2:8):g1.test(e)?cp:+e}var lp=1/0,E1=17976931348623157e292;function x1(e){if(!e)return e===0?e:0;if(e=w1(e),e===lp||e===-lp){var t=e<0?-1:1;return t*E1}return e===e?e:0}function ca(e){var t=x1(e),n=t%1;return t===t?n?t-n:t:0}function Ji(e){return e}var v1="[object AsyncFunction]",k1="[object Function]",S1="[object GeneratorFunction]",A1="[object Proxy]";function xr(e){if(!mn(e))return!1;var t=Hr(e);return t==k1||t==S1||t==v1||t==A1}var Rl=Xn["__core-js_shared__"],up=function(){var e=/[^.]+$/.exec(Rl&&Rl.keys&&Rl.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function T1(e){return!!up&&up in e}var R1=Function.prototype,O1=R1.toString;function gi(e){if(e!=null){try{return O1.call(e)}catch{}try{return e+""}catch{}}return""}var I1=/[\\^$.*+?()[\]{}|]/g,C1=/^\[object .+?Constructor\]$/,N1=Function.prototype,L1=Object.prototype,M1=N1.toString,U1=L1.hasOwnProperty,D1=RegExp("^"+M1.call(U1).replace(I1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function P1(e){if(!mn(e)||T1(e))return!1;var t=xr(e)?D1:C1;return t.test(gi(e))}function B1(e,t){return e==null?void 0:e[t]}function yi(e,t){var n=B1(e,t);return P1(n)?n:void 0}var Ol=yi(Xn,"WeakMap"),hp=Object.create,F1=function(){function e(){}return function(t){if(!mn(t))return{};if(hp)return hp(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function z1(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function _e(){}function $1(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var j1=800,W1=16,G1=Date.now;function K1(e){var t=0,n=0;return function(){var r=G1(),i=W1-(r-n);if(n=r,i>0){if(++t>=j1)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function H1(e){return function(){return e}}var la=function(){try{var e=yi(Object,"defineProperty");return e({},"",{}),e}catch{}}(),V1=la?function(e,t){return la(e,"toString",{configurable:!0,enumerable:!1,value:H1(t),writable:!0})}:Ji,Y1=K1(V1);function fp(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function dp(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function q1(e){return e!==e}function X1(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function Il(e,t,n){return t===t?X1(e,t,n):dp(e,q1,n)}function pp(e,t){var n=e==null?0:e.length;return!!n&&Il(e,t,0)>-1}var J1=9007199254740991,Z1=/^(?:0|[1-9]\d*)$/;function ua(e,t){var n=typeof e;return t=t??J1,!!t&&(n=="number"||n!="symbol"&&Z1.test(e))&&e>-1&&e%1==0&&e<t}function Cl(e,t,n){t=="__proto__"&&la?la(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Fs(e,t){return e===t||e!==e&&t!==t}var Q1=Object.prototype,tx=Q1.hasOwnProperty;function ha(e,t,n){var r=e[t];(!(tx.call(e,t)&&Fs(r,n))||n===void 0&&!(t in e))&&Cl(e,t,n)}function Nl(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?Cl(n,a,c):ha(n,a,c)}return n}var mp=Math.max;function ex(e,t,n){return t=mp(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=mp(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),z1(e,this,a)}}function Ll(e,t){return Y1(ex(e,t,Ji),e+"")}var nx=9007199254740991;function Ml(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=nx}function Jn(e){return e!=null&&Ml(e.length)&&!xr(e)}function gp(e,t,n){if(!mn(n))return!1;var r=typeof t;return(r=="number"?Jn(n)&&ua(t,n.length):r=="string"&&t in n)?Fs(n[t],e):!1}function rx(e){return Ll(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&gp(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var ix=Object.prototype;function zs(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||ix;return e===n}function sx(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var ox="[object Arguments]";function yp(e){return On(e)&&Hr(e)==ox}var _p=Object.prototype,ax=_p.hasOwnProperty,cx=_p.propertyIsEnumerable,fa=yp(function(){return arguments}())?yp:function(e){return On(e)&&ax.call(e,"callee")&&!cx.call(e,"callee")};function lx(){return!1}var bp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wp=bp&&typeof module=="object"&&module&&!module.nodeType&&module,ux=wp&&wp.exports===bp,Ep=ux?Xn.Buffer:void 0,hx=Ep?Ep.isBuffer:void 0,$s=hx||lx,fx="[object Arguments]",dx="[object Array]",px="[object Boolean]",mx="[object Date]",gx="[object Error]",yx="[object Function]",_x="[object Map]",bx="[object Number]",wx="[object Object]",Ex="[object RegExp]",xx="[object Set]",vx="[object String]",kx="[object WeakMap]",Sx="[object ArrayBuffer]",Ax="[object DataView]",Tx="[object Float32Array]",Rx="[object Float64Array]",Ox="[object Int8Array]",Ix="[object Int16Array]",Cx="[object Int32Array]",Nx="[object Uint8Array]",Lx="[object Uint8ClampedArray]",Mx="[object Uint16Array]",Ux="[object Uint32Array]",Yt={};Yt[Tx]=Yt[Rx]=Yt[Ox]=Yt[Ix]=Yt[Cx]=Yt[Nx]=Yt[Lx]=Yt[Mx]=Yt[Ux]=!0,Yt[fx]=Yt[dx]=Yt[Sx]=Yt[px]=Yt[Ax]=Yt[mx]=Yt[gx]=Yt[yx]=Yt[_x]=Yt[bx]=Yt[wx]=Yt[Ex]=Yt[xx]=Yt[vx]=Yt[kx]=!1;function Dx(e){return On(e)&&Ml(e.length)&&!!Yt[Hr(e)]}function da(e){return function(t){return e(t)}}var xp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,js=xp&&typeof module=="object"&&module&&!module.nodeType&&module,Px=js&&js.exports===xp,Ul=Px&&np.process,Vr=function(){try{var e=js&&js.require&&js.require("util").types;return e||Ul&&Ul.binding&&Ul.binding("util")}catch{}}(),vp=Vr&&Vr.isTypedArray,Dl=vp?da(vp):Dx,Bx=Object.prototype,Fx=Bx.hasOwnProperty;function kp(e,t){var n=It(e),r=!n&&fa(e),i=!n&&!r&&$s(e),s=!n&&!r&&!i&&Dl(e),o=n||r||i||s,a=o?sx(e.length,String):[],c=a.length;for(var l in e)(t||Fx.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||ua(l,c)))&&a.push(l);return a}function Sp(e,t){return function(n){return e(t(n))}}var zx=Sp(Object.keys,Object),$x=Object.prototype,jx=$x.hasOwnProperty;function Ap(e){if(!zs(e))return zx(e);var t=[];for(var n in Object(e))jx.call(e,n)&&n!="constructor"&&t.push(n);return t}function gn(e){return Jn(e)?kp(e):Ap(e)}var Wx=Object.prototype,Gx=Wx.hasOwnProperty,Ye=rx(function(e,t){if(zs(t)||Jn(t)){Nl(t,gn(t),e);return}for(var n in t)Gx.call(t,n)&&ha(e,n,t[n])});function Kx(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var Hx=Object.prototype,Vx=Hx.hasOwnProperty;function Yx(e){if(!mn(e))return Kx(e);var t=zs(e),n=[];for(var r in e)r=="constructor"&&(t||!Vx.call(e,r))||n.push(r);return n}function Tp(e){return Jn(e)?kp(e,!0):Yx(e)}var qx=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xx=/^\w*$/;function Pl(e,t){if(It(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||oa(e)?!0:Xx.test(e)||!qx.test(e)||t!=null&&e in Object(t)}var Ws=yi(Object,"create");function Jx(){this.__data__=Ws?Ws(null):{},this.size=0}function Zx(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Qx="__lodash_hash_undefined__",tv=Object.prototype,ev=tv.hasOwnProperty;function nv(e){var t=this.__data__;if(Ws){var n=t[e];return n===Qx?void 0:n}return ev.call(t,e)?t[e]:void 0}var rv=Object.prototype,iv=rv.hasOwnProperty;function sv(e){var t=this.__data__;return Ws?t[e]!==void 0:iv.call(t,e)}var ov="__lodash_hash_undefined__";function av(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ws&&t===void 0?ov:t,this}function _i(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}_i.prototype.clear=Jx,_i.prototype.delete=Zx,_i.prototype.get=nv,_i.prototype.has=sv,_i.prototype.set=av;function cv(){this.__data__=[],this.size=0}function pa(e,t){for(var n=e.length;n--;)if(Fs(e[n][0],t))return n;return-1}var lv=Array.prototype,uv=lv.splice;function hv(e){var t=this.__data__,n=pa(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():uv.call(t,n,1),--this.size,!0}function fv(e){var t=this.__data__,n=pa(t,e);return n<0?void 0:t[n][1]}function dv(e){return pa(this.__data__,e)>-1}function pv(e,t){var n=this.__data__,r=pa(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function vr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vr.prototype.clear=cv,vr.prototype.delete=hv,vr.prototype.get=fv,vr.prototype.has=dv,vr.prototype.set=pv;var Gs=yi(Xn,"Map");function mv(){this.size=0,this.__data__={hash:new _i,map:new(Gs||vr),string:new _i}}function gv(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ma(e,t){var n=e.__data__;return gv(t)?n[typeof t=="string"?"string":"hash"]:n.map}function yv(e){var t=ma(this,e).delete(e);return this.size-=t?1:0,t}function _v(e){return ma(this,e).get(e)}function bv(e){return ma(this,e).has(e)}function wv(e,t){var n=ma(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function kr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}kr.prototype.clear=mv,kr.prototype.delete=yv,kr.prototype.get=_v,kr.prototype.has=bv,kr.prototype.set=wv;var Ev="Expected a function";function Bl(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Ev);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Bl.Cache||kr),n}Bl.Cache=kr;var xv=500;function vv(e){var t=Bl(e,function(r){return n.size===xv&&n.clear(),r}),n=t.cache;return t}var kv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Sv=/\\(\\)?/g,Av=vv(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(kv,function(n,r,i,s){t.push(i?s.replace(Sv,"$1"):r||n)}),t});function Rp(e){return e==null?"":ap(e)}function ga(e,t){return It(e)?e:Pl(e,t)?[e]:Av(Rp(e))}var Tv=1/0;function Ks(e){if(typeof e=="string"||oa(e))return e;var t=e+"";return t=="0"&&1/e==-Tv?"-0":t}function Fl(e,t){t=ga(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Ks(t[n++])];return n&&n==r?e:void 0}function Rv(e,t,n){var r=e==null?void 0:Fl(e,t);return r===void 0?n:r}function zl(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Op=pn?pn.isConcatSpreadable:void 0;function Ov(e){return It(e)||fa(e)||!!(Op&&e&&e[Op])}function $l(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=Ov),i||(i=[]);++s<o;){var a=e[s];n(a)?zl(i,a):r||(i[i.length]=a)}return i}function sn(e){var t=e==null?0:e.length;return t?$l(e):[]}var Ip=Sp(Object.getPrototypeOf,Object);function jl(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function Iv(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:jl(e,t,n)}var Cv="\\ud800-\\udfff",Nv="\\u0300-\\u036f",Lv="\\ufe20-\\ufe2f",Mv="\\u20d0-\\u20ff",Uv=Nv+Lv+Mv,Dv="\\ufe0e\\ufe0f",Pv="\\u200d",Bv=RegExp("["+Pv+Cv+Uv+Dv+"]");function Cp(e){return Bv.test(e)}function Fv(e){return e.split("")}var Np="\\ud800-\\udfff",zv="\\u0300-\\u036f",$v="\\ufe20-\\ufe2f",jv="\\u20d0-\\u20ff",Wv=zv+$v+jv,Gv="\\ufe0e\\ufe0f",Kv="["+Np+"]",Wl="["+Wv+"]",Gl="\\ud83c[\\udffb-\\udfff]",Hv="(?:"+Wl+"|"+Gl+")",Lp="[^"+Np+"]",Mp="(?:\\ud83c[\\udde6-\\uddff]){2}",Up="[\\ud800-\\udbff][\\udc00-\\udfff]",Vv="\\u200d",Dp=Hv+"?",Pp="["+Gv+"]?",Yv="(?:"+Vv+"(?:"+[Lp,Mp,Up].join("|")+")"+Pp+Dp+")*",qv=Pp+Dp+Yv,Xv="(?:"+[Lp+Wl+"?",Wl,Mp,Up,Kv].join("|")+")",Jv=RegExp(Gl+"(?="+Gl+")|"+Xv+qv,"g");function Zv(e){return e.match(Jv)||[]}function Qv(e){return Cp(e)?Zv(e):Fv(e)}function tk(e){return function(t){t=Rp(t);var n=Cp(t)?Qv(t):void 0,r=n?n[0]:t.charAt(0),i=n?Iv(n,1).join(""):t.slice(1);return r[e]()+i}}var Bp=tk("toUpperCase");function ek(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function nk(){this.__data__=new vr,this.size=0}function rk(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function ik(e){return this.__data__.get(e)}function sk(e){return this.__data__.has(e)}var ok=200;function ak(e,t){var n=this.__data__;if(n instanceof vr){var r=n.__data__;if(!Gs||r.length<ok-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new kr(r)}return n.set(e,t),this.size=n.size,this}function Zn(e){var t=this.__data__=new vr(e);this.size=t.size}Zn.prototype.clear=nk,Zn.prototype.delete=rk,Zn.prototype.get=ik,Zn.prototype.has=sk,Zn.prototype.set=ak;function ck(e,t){return e&&Nl(t,gn(t),e)}var Fp=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zp=Fp&&typeof module=="object"&&module&&!module.nodeType&&module,lk=zp&&zp.exports===Fp,$p=lk?Xn.Buffer:void 0,jp=$p?$p.allocUnsafe:void 0;function uk(e,t){var n=e.length,r=jp?jp(n):new e.constructor(n);return e.copy(r),r}function Kl(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Wp(){return[]}var hk=Object.prototype,fk=hk.propertyIsEnumerable,Gp=Object.getOwnPropertySymbols,Hl=Gp?function(e){return e==null?[]:(e=Object(e),Kl(Gp(e),function(t){return fk.call(e,t)}))}:Wp;function dk(e,t){return Nl(e,Hl(e),t)}var pk=Object.getOwnPropertySymbols,mk=pk?function(e){for(var t=[];e;)zl(t,Hl(e)),e=Ip(e);return t}:Wp;function Kp(e,t,n){var r=t(e);return It(e)?r:zl(r,n(e))}function Vl(e){return Kp(e,gn,Hl)}function gk(e){return Kp(e,Tp,mk)}var Yl=yi(Xn,"DataView"),ql=yi(Xn,"Promise"),Zi=yi(Xn,"Set"),Hp="[object Map]",yk="[object Object]",Vp="[object Promise]",Yp="[object Set]",qp="[object WeakMap]",Xp="[object DataView]",_k=gi(Yl),bk=gi(Gs),wk=gi(ql),Ek=gi(Zi),xk=gi(Ol),yn=Hr;(Yl&&yn(new Yl(new ArrayBuffer(1)))!=Xp||Gs&&yn(new Gs)!=Hp||ql&&yn(ql.resolve())!=Vp||Zi&&yn(new Zi)!=Yp||Ol&&yn(new Ol)!=qp)&&(yn=function(e){var t=Hr(e),n=t==yk?e.constructor:void 0,r=n?gi(n):"";if(r)switch(r){case _k:return Xp;case bk:return Hp;case wk:return Vp;case Ek:return Yp;case xk:return qp}return t});var vk=Object.prototype,kk=vk.hasOwnProperty;function Sk(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&kk.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var ya=Xn.Uint8Array;function Ak(e){var t=new e.constructor(e.byteLength);return new ya(t).set(new ya(e)),t}function Tk(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var Rk=/\w*$/;function Ok(e){var t=new e.constructor(e.source,Rk.exec(e));return t.lastIndex=e.lastIndex,t}var Jp=pn?pn.prototype:void 0,Zp=Jp?Jp.valueOf:void 0;function Ik(e){return Zp?Object(Zp.call(e)):{}}function Ck(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var Nk="[object Boolean]",Lk="[object Date]",Mk="[object Map]",Uk="[object Number]",Dk="[object RegExp]",Pk="[object Set]",Bk="[object String]",Fk="[object Symbol]",zk="[object ArrayBuffer]",$k="[object DataView]",jk="[object Float32Array]",Wk="[object Float64Array]",Gk="[object Int8Array]",Kk="[object Int16Array]",Hk="[object Int32Array]",Vk="[object Uint8Array]",Yk="[object Uint8ClampedArray]",qk="[object Uint16Array]",Xk="[object Uint32Array]";function Jk(e,t,n){var r=e.constructor;switch(t){case zk:return Ak(e);case Nk:case Lk:return new r(+e);case $k:return Tk(e);case jk:case Wk:case Gk:case Kk:case Hk:case Vk:case Yk:case qk:case Xk:return Ck(e);case Mk:return new r;case Uk:case Bk:return new r(e);case Dk:return Ok(e);case Pk:return new r;case Fk:return Ik(e)}}function Zk(e){return typeof e.constructor=="function"&&!zs(e)?F1(Ip(e)):{}}var Qk="[object Map]";function tS(e){return On(e)&&yn(e)==Qk}var Qp=Vr&&Vr.isMap,eS=Qp?da(Qp):tS,nS="[object Set]";function rS(e){return On(e)&&yn(e)==nS}var tm=Vr&&Vr.isSet,iS=tm?da(tm):rS,em="[object Arguments]",sS="[object Array]",oS="[object Boolean]",aS="[object Date]",cS="[object Error]",nm="[object Function]",lS="[object GeneratorFunction]",uS="[object Map]",hS="[object Number]",rm="[object Object]",fS="[object RegExp]",dS="[object Set]",pS="[object String]",mS="[object Symbol]",gS="[object WeakMap]",yS="[object ArrayBuffer]",_S="[object DataView]",bS="[object Float32Array]",wS="[object Float64Array]",ES="[object Int8Array]",xS="[object Int16Array]",vS="[object Int32Array]",kS="[object Uint8Array]",SS="[object Uint8ClampedArray]",AS="[object Uint16Array]",TS="[object Uint32Array]",Wt={};Wt[em]=Wt[sS]=Wt[yS]=Wt[_S]=Wt[oS]=Wt[aS]=Wt[bS]=Wt[wS]=Wt[ES]=Wt[xS]=Wt[vS]=Wt[uS]=Wt[hS]=Wt[rm]=Wt[fS]=Wt[dS]=Wt[pS]=Wt[mS]=Wt[kS]=Wt[SS]=Wt[AS]=Wt[TS]=!0,Wt[cS]=Wt[nm]=Wt[gS]=!1;function _a(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!mn(e))return e;var a=It(e);if(a)return o=Sk(e),$1(e,o);var c=yn(e),l=c==nm||c==lS;if($s(e))return uk(e);if(c==rm||c==em||l&&!i)return o=l?{}:Zk(e),dk(e,ck(o,e));if(!Wt[c])return i?e:{};o=Jk(e,c),s||(s=new Zn);var u=s.get(e);if(u)return u;s.set(e,o),iS(e)?e.forEach(function(h){o.add(_a(h,t,n,h,e,s))}):eS(e)&&e.forEach(function(h,p){o.set(p,_a(h,t,n,p,e,s))});var f=Vl,d=a?void 0:f(e);return fp(d||e,function(h,p){d&&(p=h,h=e[p]),ha(o,p,_a(h,t,n,p,e,s))}),o}var RS=4;function Ie(e){return _a(e,RS)}function Hs(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var OS="__lodash_hash_undefined__";function IS(e){return this.__data__.set(e,OS),this}function CS(e){return this.__data__.has(e)}function Qi(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new kr;++t<n;)this.add(e[t])}Qi.prototype.add=Qi.prototype.push=IS,Qi.prototype.has=CS;function im(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Xl(e,t){return e.has(t)}var NS=1,LS=2;function sm(e,t,n,r,i,s){var o=n&NS,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=n&LS?new Qi:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var p=e[f],m=t[f];if(r)var b=o?r(m,p,f,t,e,s):r(p,m,f,e,t,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!im(t,function(g,x){if(!Xl(h,x)&&(p===g||i(p,g,n,r,s)))return h.push(x)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function MS(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Jl(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var US=1,DS=2,PS="[object Boolean]",BS="[object Date]",FS="[object Error]",zS="[object Map]",$S="[object Number]",jS="[object RegExp]",WS="[object Set]",GS="[object String]",KS="[object Symbol]",HS="[object ArrayBuffer]",VS="[object DataView]",om=pn?pn.prototype:void 0,Zl=om?om.valueOf:void 0;function YS(e,t,n,r,i,s,o){switch(n){case VS:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case HS:return!(e.byteLength!=t.byteLength||!s(new ya(e),new ya(t)));case PS:case BS:case $S:return Fs(+e,+t);case FS:return e.name==t.name&&e.message==t.message;case jS:case GS:return e==t+"";case zS:var a=MS;case WS:var c=r&US;if(a||(a=Jl),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=DS,o.set(e,t);var u=sm(a(e),a(t),r,i,s,o);return o.delete(e),u;case KS:if(Zl)return Zl.call(e)==Zl.call(t)}return!1}var qS=1,XS=Object.prototype,JS=XS.hasOwnProperty;function ZS(e,t,n,r,i,s){var o=n&qS,a=Vl(e),c=a.length,l=Vl(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:JS.call(t,d)))return!1}var h=s.get(e),p=s.get(t);if(h&&p)return h==t&&p==e;var m=!0;s.set(e,t),s.set(t,e);for(var b=o;++f<c;){d=a[f];var g=e[d],x=t[d];if(r)var S=o?r(x,g,d,t,e,s):r(g,x,d,e,t,s);if(!(S===void 0?g===x||i(g,x,n,r,s):S)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var w=e.constructor,k=t.constructor;w!=k&&"constructor"in e&&"constructor"in t&&!(typeof w=="function"&&w instanceof w&&typeof k=="function"&&k instanceof k)&&(m=!1)}return s.delete(e),s.delete(t),m}var QS=1,am="[object Arguments]",cm="[object Array]",ba="[object Object]",tA=Object.prototype,lm=tA.hasOwnProperty;function eA(e,t,n,r,i,s){var o=It(e),a=It(t),c=o?cm:yn(e),l=a?cm:yn(t);c=c==am?ba:c,l=l==am?ba:l;var u=c==ba,f=l==ba,d=c==l;if(d&&$s(e)){if(!$s(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new Zn),o||Dl(e)?sm(e,t,n,r,i,s):YS(e,t,c,n,r,i,s);if(!(n&QS)){var h=u&&lm.call(e,"__wrapped__"),p=f&&lm.call(t,"__wrapped__");if(h||p){var m=h?e.value():e,b=p?t.value():t;return s||(s=new Zn),i(m,b,n,r,s)}}return d?(s||(s=new Zn),ZS(e,t,n,r,i,s)):!1}function Ql(e,t,n,r,i){return e===t?!0:e==null||t==null||!On(e)&&!On(t)?e!==e&&t!==t:eA(e,t,n,r,Ql,i)}var nA=1,rA=2;function iA(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new Zn,f;if(!(f===void 0?Ql(l,c,nA|rA,r,u):f))return!1}}return!0}function um(e){return e===e&&!mn(e)}function sA(e){for(var t=gn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,um(i)]}return t}function hm(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function oA(e){var t=sA(e);return t.length==1&&t[0][2]?hm(t[0][0],t[0][1]):function(n){return n===e||iA(n,e,t)}}function aA(e,t){return e!=null&&t in Object(e)}function fm(e,t,n){t=ga(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=Ks(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Ml(i)&&ua(o,i)&&(It(e)||fa(e)))}function cA(e,t){return e!=null&&fm(e,t,aA)}var lA=1,uA=2;function hA(e,t){return Pl(e)&&um(t)?hm(Ks(e),t):function(n){var r=Rv(n,e);return r===void 0&&r===t?cA(n,e):Ql(t,r,lA|uA)}}function fA(e){return function(t){return t==null?void 0:t[e]}}function dA(e){return function(t){return Fl(t,e)}}function pA(e){return Pl(e)?fA(Ks(e)):dA(e)}function Qn(e){return typeof e=="function"?e:e==null?Ji:typeof e=="object"?It(e)?hA(e[0],e[1]):oA(e):pA(e)}function mA(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function gA(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var yA=gA();function _A(e,t){return e&&yA(e,t,gn)}function bA(e,t){return function(n,r){if(n==null)return n;if(!Jn(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var bi=bA(_A);function wA(e,t,n,r){return bi(e,function(i,s,o){t(r,i,n(i),o)}),r}function EA(e,t){return function(n,r){var i=It(n)?mA:wA,s=t?t():{};return i(n,e,Qn(r),s)}}var dm=Object.prototype,xA=dm.hasOwnProperty,tu=Ll(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&gp(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Tp(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||Fs(u,dm[l])&&!xA.call(e,l))&&(e[l]=s[l])}return e});function pm(e){return On(e)&&Jn(e)}var vA=200;function kA(e,t,n,r){var i=-1,s=pp,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=vA&&(s=Xl,o=!1,t=new Qi(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var wa=Ll(function(e,t){return pm(e)?kA(e,$l(t,1,pm,!0)):[]});function ts(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function Ce(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:ca(t),jl(e,t<0?0:t,r)):[]}function Vs(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:ca(t),t=r-t,jl(e,0,t<0?0:t)):[]}function SA(e){return typeof e=="function"?e:Ji}function dt(e,t){var n=It(e)?fp:bi;return n(e,SA(t))}function AA(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function TA(e,t){var n=!0;return bi(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function In(e,t,n){var r=It(e)?AA:TA;return r(e,Qn(t))}function mm(e,t){var n=[];return bi(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function _n(e,t){var n=It(e)?Kl:mm;return n(e,Qn(t))}function RA(e){return function(t,n,r){var i=Object(t);if(!Jn(t)){var s=Qn(n);t=gn(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var OA=Math.max;function IA(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:ca(n);return i<0&&(i=OA(r+i,0)),dp(e,Qn(t),i)}var es=RA(IA);function Cn(e){return e&&e.length?e[0]:void 0}function CA(e,t){var n=-1,r=Jn(e)?Array(e.length):[];return bi(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function ot(e,t){var n=It(e)?aa:CA;return n(e,Qn(t))}function bn(e,t){return $l(ot(e,t))}var NA=Object.prototype,LA=NA.hasOwnProperty,gm=EA(function(e,t,n){LA.call(e,n)?e[n].push(t):Cl(e,n,[t])}),MA=Object.prototype,UA=MA.hasOwnProperty;function DA(e,t){return e!=null&&UA.call(e,t)}function ft(e,t){return e!=null&&fm(e,t,DA)}var PA="[object String]";function qe(e){return typeof e=="string"||!It(e)&&On(e)&&Hr(e)==PA}function BA(e,t){return aa(t,function(n){return e[n]})}function de(e){return e==null?[]:BA(e,gn(e))}var FA=Math.max;function je(e,t,n,r){e=Jn(e)?e:de(e),n=n&&!r?ca(n):0;var i=e.length;return n<0&&(n=FA(i+n,0)),qe(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Il(e,t,n)>-1}function ym(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return Il(e,t,i)}var zA="[object Map]",$A="[object Set]",jA=Object.prototype,WA=jA.hasOwnProperty;function Gt(e){if(e==null)return!0;if(Jn(e)&&(It(e)||typeof e=="string"||typeof e.splice=="function"||$s(e)||Dl(e)||fa(e)))return!e.length;var t=yn(e);if(t==zA||t==$A)return!e.size;if(zs(e))return!Ap(e).length;for(var n in e)if(WA.call(e,n))return!1;return!0}var GA="[object RegExp]";function KA(e){return On(e)&&Hr(e)==GA}var _m=Vr&&Vr.isRegExp,Sr=_m?da(_m):KA;function Ar(e){return e===void 0}var HA="Expected a function";function VA(e){if(typeof e!="function")throw new TypeError(HA);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function YA(e,t,n,r){if(!mn(e))return e;t=ga(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=Ks(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=mn(u)?u:ua(t[i+1])?[]:{})}ha(a,c,l),a=a[c]}return e}function qA(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Fl(e,o);n(a,o)&&YA(s,ga(o,e),a)}return s}function Nn(e,t){if(e==null)return{};var n=aa(gk(e),function(r){return[r]});return t=Qn(t),qA(e,n,function(r,i){return t(r,i[0])})}function XA(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function Xe(e,t,n){var r=It(e)?ek:XA,i=arguments.length<3;return r(e,Qn(t),n,i,bi)}function Ea(e,t){var n=It(e)?Kl:mm;return n(e,VA(Qn(t)))}function JA(e,t){var n;return bi(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function eu(e,t,n){var r=It(e)?im:JA;return r(e,Qn(t))}var ZA=1/0,QA=Zi&&1/Jl(new Zi([,-0]))[1]==ZA?function(e){return new Zi(e)}:_e,tT=200;function eT(e,t,n){var r=-1,i=pp,s=e.length,o=!0,a=[],c=a;if(s>=tT){var l=QA(e);if(l)return Jl(l);o=!1,i=Xl,c=new Qi}else c=a;t:for(;++r<s;){var u=e[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function xa(e){return e&&e.length?eT(e):[]}function nu(e){console&&console.error&&console.error(`Error: ${e}`)}function bm(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function wm(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Em(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function nT(e){return rT(e)?e.LABEL:e.name}function rT(e){return qe(e.LABEL)&&e.LABEL!==""}class tr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),dt(this.definition,n=>{n.accept(t)})}}class Je extends tr{constructor(t){super([]),this.idx=1,Ye(this,Nn(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class ns extends tr{constructor(t){super(t.definition),this.orgText="",Ye(this,Nn(t,n=>n!==void 0))}}class Ze extends tr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Ye(this,Nn(t,n=>n!==void 0))}}class Qe extends tr{constructor(t){super(t.definition),this.idx=1,Ye(this,Nn(t,n=>n!==void 0))}}class er extends tr{constructor(t){super(t.definition),this.idx=1,Ye(this,Nn(t,n=>n!==void 0))}}class nr extends tr{constructor(t){super(t.definition),this.idx=1,Ye(this,Nn(t,n=>n!==void 0))}}class be extends tr{constructor(t){super(t.definition),this.idx=1,Ye(this,Nn(t,n=>n!==void 0))}}class Ln extends tr{constructor(t){super(t.definition),this.idx=1,Ye(this,Nn(t,n=>n!==void 0))}}class Mn extends tr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Ye(this,Nn(t,n=>n!==void 0))}}class Zt{constructor(t){this.idx=1,Ye(this,Nn(t,n=>n!==void 0))}accept(t){t.visit(this)}}function iT(e){return ot(e,va)}function va(e){function t(n){return ot(n,va)}if(e instanceof Je){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return qe(e.label)&&(n.label=e.label),n}else{if(e instanceof Ze)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Qe)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof er)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof nr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:va(new Zt({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Ln)return{type:"RepetitionWithSeparator",idx:e.idx,separator:va(new Zt({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof be)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Mn)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Zt){const n={type:"Terminal",name:e.terminalType.name,label:nT(e.terminalType),idx:e.idx};qe(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Sr(r)?r.source:r),n}else{if(e instanceof ns)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class wi{visit(t){const n=t;switch(n.constructor){case Je:return this.visitNonTerminal(n);case Ze:return this.visitAlternative(n);case Qe:return this.visitOption(n);case er:return this.visitRepetitionMandatory(n);case nr:return this.visitRepetitionMandatoryWithSeparator(n);case Ln:return this.visitRepetitionWithSeparator(n);case be:return this.visitRepetition(n);case Mn:return this.visitAlternation(n);case Zt:return this.visitTerminal(n);case ns:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function sT(e){return e instanceof Ze||e instanceof Qe||e instanceof be||e instanceof er||e instanceof nr||e instanceof Ln||e instanceof Zt||e instanceof ns}function ka(e,t=[]){return e instanceof Qe||e instanceof be||e instanceof Ln?!0:e instanceof Mn?eu(e.definition,r=>ka(r,t)):e instanceof Je&&je(t,e)?!1:e instanceof tr?(e instanceof Je&&t.push(e),In(e.definition,r=>ka(r,t))):!1}function oT(e){return e instanceof Mn}function rr(e){if(e instanceof Je)return"SUBRULE";if(e instanceof Qe)return"OPTION";if(e instanceof Mn)return"OR";if(e instanceof er)return"AT_LEAST_ONE";if(e instanceof nr)return"AT_LEAST_ONE_SEP";if(e instanceof Ln)return"MANY_SEP";if(e instanceof be)return"MANY";if(e instanceof Zt)return"CONSUME";throw Error("non exhaustive match")}class Sa{walk(t,n=[]){dt(t.definition,(r,i)=>{const s=Ce(t.definition,i+1);if(r instanceof Je)this.walkProdRef(r,s,n);else if(r instanceof Zt)this.walkTerminal(r,s,n);else if(r instanceof Ze)this.walkFlat(r,s,n);else if(r instanceof Qe)this.walkOption(r,s,n);else if(r instanceof er)this.walkAtLeastOne(r,s,n);else if(r instanceof nr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Ln)this.walkManySep(r,s,n);else if(r instanceof be)this.walkMany(r,s,n);else if(r instanceof Mn)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Qe({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=xm(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Qe({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=xm(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);dt(t.definition,s=>{const o=new Ze({definition:[s]});this.walk(o,i)})}}function xm(e,t,n){return[new Qe({definition:[new Zt({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function Ys(e){if(e instanceof Je)return Ys(e.referencedRule);if(e instanceof Zt)return lT(e);if(sT(e))return aT(e);if(oT(e))return cT(e);throw Error("non exhaustive match")}function aT(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=ka(s),t=t.concat(Ys(s)),r=r+1,i=n.length>r;return xa(t)}function cT(e){const t=ot(e.definition,n=>Ys(n));return xa(sn(t))}function lT(e){return[e.terminalType]}const vm="_~IN~_";class uT extends Sa{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=fT(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Ze({definition:s}),a=Ys(o);this.follows[i]=a}}function hT(e){const t={};return dt(e,n=>{const r=new uT(n).startWalking();Ye(t,r)}),t}function fT(e,t){return e.name+t+vm}function pt(e){return e.charCodeAt(0)}function ru(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function qs(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function rs(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function dT(){throw Error("Internal Error - Should never get here!")}function km(e){return e.type==="Character"}const Aa=[];for(let e=pt("0");e<=pt("9");e++)Aa.push(e);const Ta=[pt("_")].concat(Aa);for(let e=pt("a");e<=pt("z");e++)Ta.push(e);for(let e=pt("A");e<=pt("Z");e++)Ta.push(e);const Sm=[pt(" "),pt("\f"),pt(`
`),pt("\r"),pt("	"),pt("\v"),pt("	"),pt(""),pt(""),pt(""),pt(""),pt(""),pt(""),pt(""),pt(""),pt(""),pt(""),pt(""),pt(""),pt(""),pt("\u2028"),pt("\u2029"),pt(""),pt(""),pt(""),pt("\uFEFF")],pT=/[0-9a-fA-F]/,Ra=/[0-9]/,mT=/[1-9]/;class gT{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":qs(r,"global");break;case"i":qs(r,"ignoreCase");break;case"m":qs(r,"multiLine");break;case"u":qs(r,"unicode");break;case"y":qs(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}rs(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return dT()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;rs(n);break}if(!(t===!0&&n===void 0)&&rs(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),rs(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[pt(`
`),pt("\r"),pt("\u2028"),pt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Aa;break;case"D":t=Aa,n=!0;break;case"s":t=Sm;break;case"S":t=Sm,n=!0;break;case"w":t=Ta;break;case"W":t=Ta,n=!0;break}if(rs(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=pt("\f");break;case"n":t=pt(`
`);break;case"r":t=pt("\r");break;case"t":t=pt("	");break;case"v":t=pt("\v");break}if(rs(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:pt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:pt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:pt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,km(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,km(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else ru(r.value,t),t.push(pt("-")),ru(i.value,t)}else ru(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:pt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(mT.test(t)===!1)throw Error("Expecting a positive integer");for(;Ra.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Ra.test(t)===!1)throw Error("Expecting an integer");for(;Ra.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:pt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Ra.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(pT.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class iu{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Oa={};const yT=new gT;function Ia(e){const t=e.toString();if(Oa.hasOwnProperty(t))return Oa[t];{const n=yT.pattern(t);return Oa[t]=n,n}}function _T(){Oa={}}const Am="Complement Sets are not supported for first char optimization",Ca=`Unable to use "first char" lexer optimizations:
`;function bT(e,t=!1){try{const n=Ia(e);return su(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Am)t&&bm(`${Ca}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),nu(`${Ca}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function su(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)su(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Na(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(Am);dt(o.value,c=>{if(typeof c=="number")Na(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)Na(u,t,n);else{for(let u=l.from;u<=l.to&&u<Js;u++)Na(u,t,n);if(l.to>=Js){const u=l.from>=Js?l.from:Js,f=l.to,d=Yr(u),h=Yr(f);for(let p=d;p<=h;p++)t[p]=p}}}});break;case"Group":su(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&ou(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return de(t)}function Na(e,t,n){const r=Yr(e);t[r]=r,n===!0&&wT(e,t)}function wT(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Yr(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Yr(i.charCodeAt(0));t[s]=s}}}function Tm(e,t){return es(e.value,n=>{if(typeof n=="number")return je(t,n);{const r=n;return es(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function ou(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?It(e.value)?In(e.value,ou):ou(e.value):!1}class ET extends iu{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){je(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Tm(t,this.targetCharCodes)===void 0&&(this.found=!0):Tm(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function au(e,t){if(t instanceof RegExp){const n=Ia(t),r=new ET(e);return r.visit(n),r.found}else return es(t,n=>je(e,n.charCodeAt(0)))!==void 0}const Ei="PATTERN",Xs="defaultMode",La="modes";let Rm=typeof new RegExp("(?:)").sticky=="boolean";function xT(e,t){t=tu(t,{useSticky:Rm,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(x,S)=>S()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{KT()});let r;n("Reject Lexer.NA",()=>{r=Ea(e,x=>x[Ei]===we.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=ot(r,x=>{const S=x[Ei];if(Sr(S)){const w=S.source;return w.length===1&&w!=="^"&&w!=="$"&&w!=="."&&!S.ignoreCase?w:w.length===2&&w[0]==="\\"&&!je(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],w[1])?w[1]:t.useSticky?Im(S):Om(S)}else{if(xr(S))return i=!0,{exec:S};if(typeof S=="object")return i=!0,S;if(typeof S=="string"){if(S.length===1)return S;{const w=S.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),k=new RegExp(w);return t.useSticky?Im(k):Om(k)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=ot(r,x=>x.tokenTypeIdx),a=ot(r,x=>{const S=x.GROUP;if(S!==we.SKIPPED){if(qe(S))return S;if(Ar(S))return!1;throw Error("non exhaustive match")}}),c=ot(r,x=>{const S=x.LONGER_ALT;if(S)return It(S)?ot(S,k=>ym(r,k)):[ym(r,S)]}),l=ot(r,x=>x.PUSH_MODE),u=ot(r,x=>ft(x,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const x=Lm(t.lineTerminatorCharacters);f=ot(r,S=>!1),t.positionTracking!=="onlyOffset"&&(f=ot(r,S=>ft(S,"LINE_BREAKS")?!!S.LINE_BREAKS:Nm(S,x)===!1&&au(x,S.PATTERN)))});let d,h,p,m;n("Misc Mapping #2",()=>{d=ot(r,Cm),h=ot(s,jT),p=Xe(r,(x,S)=>{const w=S.GROUP;return qe(w)&&w!==we.SKIPPED&&(x[w]=[]),x},{}),m=ot(s,(x,S)=>({pattern:s[S],longerAlt:c[S],canLineTerminator:f[S],isCustom:d[S],short:h[S],group:a[S],push:l[S],pop:u[S],tokenTypeIdx:o[S],tokenType:r[S]}))});let b=!0,g=[];return t.safeMode||n("First Char Optimization",()=>{g=Xe(r,(x,S,w)=>{if(typeof S.PATTERN=="string"){const k=S.PATTERN.charCodeAt(0),v=Yr(k);cu(x,v,m[w])}else if(It(S.START_CHARS_HINT)){let k;dt(S.START_CHARS_HINT,v=>{const E=typeof v=="string"?v.charCodeAt(0):v,N=Yr(E);k!==N&&(k=N,cu(x,N,m[w]))})}else if(Sr(S.PATTERN))if(S.PATTERN.unicode)b=!1,t.ensureOptimizations&&nu(`${Ca}	Unable to analyze < ${S.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const k=bT(S.PATTERN,t.ensureOptimizations);Gt(k)&&(b=!1),dt(k,v=>{cu(x,v,m[w])})}else t.ensureOptimizations&&nu(`${Ca}	TokenType: <${S.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return x},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:g,hasCustom:i,canBeOptimized:b}}function vT(e,t){let n=[];const r=ST(e);n=n.concat(r.errors);const i=AT(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(kT(s)),n=n.concat(MT(s)),n=n.concat(UT(s,t)),n=n.concat(DT(s)),n}function kT(e){let t=[];const n=_n(e,r=>Sr(r[Ei]));return t=t.concat(RT(n)),t=t.concat(CT(n)),t=t.concat(NT(n)),t=t.concat(LT(n)),t=t.concat(OT(n)),t}function ST(e){const t=_n(e,i=>!ft(i,Ei)),n=ot(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:se.MISSING_PATTERN,tokenTypes:[i]})),r=wa(e,t);return{errors:n,valid:r}}function AT(e){const t=_n(e,i=>{const s=i[Ei];return!Sr(s)&&!xr(s)&&!ft(s,"exec")&&!qe(s)}),n=ot(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:se.INVALID_PATTERN,tokenTypes:[i]})),r=wa(e,t);return{errors:n,valid:r}}const TT=/[^\\][$]/;function RT(e){class t extends iu{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=_n(e,i=>{const s=i.PATTERN;try{const o=Ia(s),a=new t;return a.visit(o),a.found}catch{return TT.test(s.source)}});return ot(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:se.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function OT(e){const t=_n(e,r=>r.PATTERN.test(""));return ot(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:se.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const IT=/[^\\[][\^]|^\^/;function CT(e){class t extends iu{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=_n(e,i=>{const s=i.PATTERN;try{const o=Ia(s),a=new t;return a.visit(o),a.found}catch{return IT.test(s.source)}});return ot(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:se.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function NT(e){const t=_n(e,r=>{const i=r[Ei];return i instanceof RegExp&&(i.multiline||i.global)});return ot(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:se.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function LT(e){const t=[];let n=ot(e,s=>Xe(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!je(t,a)&&a.PATTERN!==we.NA&&(t.push(a),o.push(a)),o),[]));n=Hs(n);const r=_n(n,s=>s.length>1);return ot(r,s=>{const o=ot(s,c=>c.name);return{message:`The same RegExp pattern ->${Cn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:se.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function MT(e){const t=_n(e,r=>{if(!ft(r,"GROUP"))return!1;const i=r.GROUP;return i!==we.SKIPPED&&i!==we.NA&&!qe(i)});return ot(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:se.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function UT(e,t){const n=_n(e,i=>i.PUSH_MODE!==void 0&&!je(t,i.PUSH_MODE));return ot(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:se.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function DT(e){const t=[],n=Xe(e,(r,i,s)=>{const o=i.PATTERN;return o===we.NA||(qe(o)?r.push({str:o,idx:s,tokenType:i}):Sr(o)&&BT(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return dt(e,(r,i)=>{dt(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&PT(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:se.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function PT(e,t){if(Sr(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(xr(t))return t(e,0,[],{});if(ft(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function BT(e){return es([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Om(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Im(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function FT(e,t,n){const r=[];return ft(e,Xs)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Xs+`> property in its definition
`,type:se.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),ft(e,La)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+La+`> property in its definition
`,type:se.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),ft(e,La)&&ft(e,Xs)&&!ft(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Xs}: <${e.defaultMode}>which does not exist
`,type:se.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),ft(e,La)&&dt(e.modes,(i,s)=>{dt(i,(o,a)=>{if(Ar(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:se.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(ft(o,"LONGER_ALT")){const c=It(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];dt(c,l=>{!Ar(l)&&!je(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:se.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function zT(e,t,n){const r=[];let i=!1;const s=Hs(sn(de(e.modes))),o=Ea(s,c=>c[Ei]===we.NA),a=Lm(n);return t&&dt(o,c=>{const l=Nm(c,a);if(l!==!1){const f={message:GT(c,l),type:l.issue,tokenType:c};r.push(f)}else ft(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):au(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:se.NO_LINE_BREAKS_FLAGS}),r}function $T(e){const t={},n=gn(e);return dt(n,r=>{const i=e[r];if(It(i))t[r]=[];else throw Error("non exhaustive match")}),t}function Cm(e){const t=e.PATTERN;if(Sr(t))return!1;if(xr(t))return!0;if(ft(t,"exec"))return!0;if(qe(t))return!1;throw Error("non exhaustive match")}function jT(e){return qe(e)&&e.length===1?e.charCodeAt(0):!1}const WT={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Nm(e,t){if(ft(e,"LINE_BREAKS"))return!1;if(Sr(e.PATTERN)){try{au(t,e.PATTERN)}catch(n){return{issue:se.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(qe(e.PATTERN))return!1;if(Cm(e))return{issue:se.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function GT(e,t){if(t.issue===se.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===se.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Lm(e){return ot(e,n=>qe(n)?n.charCodeAt(0):n)}function cu(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Js=256;let Ma=[];function Yr(e){return e<Js?e:Ma[e]}function KT(){if(Gt(Ma)){Ma=new Array(65536);for(let e=0;e<65536;e++)Ma[e]=e>255?255+~~(e/255):e}}function Zs(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function Ua(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let Mm=1;const Um={};function Qs(e){const t=HT(e);VT(t),qT(t),YT(t),dt(t,n=>{n.isParent=n.categoryMatches.length>0})}function HT(e){let t=Ie(e),n=e,r=!0;for(;r;){n=Hs(sn(ot(n,s=>s.CATEGORIES)));const i=wa(n,t);t=t.concat(i),Gt(i)?r=!1:n=i}return t}function VT(e){dt(e,t=>{Pm(t)||(Um[Mm]=t,t.tokenTypeIdx=Mm++),Bm(t)&&!It(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),Bm(t)||(t.CATEGORIES=[]),XT(t)||(t.categoryMatches=[]),JT(t)||(t.categoryMatchesMap={})})}function YT(e){dt(e,t=>{t.categoryMatches=[],dt(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(Um[r].tokenTypeIdx)})})}function qT(e){dt(e,t=>{Dm([],t)})}function Dm(e,t){dt(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),dt(t.CATEGORIES,n=>{const r=e.concat(t);je(r,n)||Dm(r,n)})}function Pm(e){return ft(e,"tokenTypeIdx")}function Bm(e){return ft(e,"CATEGORIES")}function XT(e){return ft(e,"categoryMatches")}function JT(e){return ft(e,"categoryMatchesMap")}function ZT(e){return ft(e,"tokenTypeIdx")}const QT={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var se;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(se||(se={}));const to={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:QT,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(to);class we{constructor(t,n=to){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=wm(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Ye({},to,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===to.lineTerminatorsPattern)this.config.lineTerminatorsPattern=WT;else if(this.config.lineTerminatorCharacters===to.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),It(t)?i={modes:{defaultMode:Ie(t)},defaultMode:Xs}:(s=!1,i=Ie(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(FT(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(zT(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},dt(i.modes,(a,c)=>{i.modes[c]=Ea(a,l=>Ar(l))});const o=gn(i.modes);if(dt(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(vT(a,o))}),Gt(this.lexerDefinitionErrors)){Qs(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=xT(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Ye({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Gt(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=ot(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}dt(this.lexerDefinitionWarning,a=>{bm(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Rm?(this.chopInput=Ji,this.match=this.matchWithTest):(this.updateLastIndex=_e,this.match=this.matchWithExec),s&&(this.handleModes=_e),this.trackStartLines===!1&&(this.computeNewColumn=Ji),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=_e),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Xe(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!Gt(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{_T()}),this.TRACE_INIT("toFastProperties",()=>{Em(this)})})}tokenize(t,n=this.defaultMode){if(!Gt(this.lexerDefinitionErrors)){const i=ot(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,f,d,h,p,m,b,g;const x=t,S=x.length;let w=0,k=0;const v=this.hasCustom?0:Math.floor(t.length/10),E=new Array(v),N=[];let O=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const Z=$T(this.emptyGroups),C=this.trackStartLines,A=this.config.lineTerminatorsPattern;let y=0,L=[],j=[];const U=[],q=[];Object.freeze(q);let G;function J(){return L}function F(Et){const Ft=Yr(Et),_t=j[Ft];return _t===void 0?q:_t}const B=Et=>{if(U.length===1&&Et.tokenType.PUSH_MODE===void 0){const Ft=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Et);N.push({offset:Et.startOffset,line:Et.startLine,column:Et.startColumn,length:Et.image.length,message:Ft})}else{U.pop();const Ft=ts(U);L=this.patternIdxToConfig[Ft],j=this.charCodeToPatternIdxToConfig[Ft],y=L.length;const _t=this.canModeBeOptimized[Ft]&&this.config.safeMode===!1;j&&_t?G=F:G=J}};function ct(Et){U.push(Et),j=this.charCodeToPatternIdxToConfig[Et],L=this.patternIdxToConfig[Et],y=L.length,y=L.length;const Ft=this.canModeBeOptimized[Et]&&this.config.safeMode===!1;j&&Ft?G=F:G=J}ct.call(this,n);let Q;const tt=this.config.recoveryEnabled;for(;w<S;){c=null;const Et=x.charCodeAt(w),Ft=G(Et),_t=Ft.length;for(r=0;r<_t;r++){Q=Ft[r];const yt=Q.pattern;l=null;const zt=Q.short;if(zt!==!1?Et===zt&&(c=yt):Q.isCustom===!0?(g=yt.exec(x,w,E,Z),g!==null?(c=g[0],g.payload!==void 0&&(l=g.payload)):c=null):(this.updateLastIndex(yt,w),c=this.match(yt,t,w)),c!==null){if(a=Q.longerAlt,a!==void 0){const Dt=a.length;for(s=0;s<Dt;s++){const pe=L[a[s]],ke=pe.pattern;if(u=null,pe.isCustom===!0?(g=ke.exec(x,w,E,Z),g!==null?(o=g[0],g.payload!==void 0&&(u=g.payload)):o=null):(this.updateLastIndex(ke,w),o=this.match(ke,t,w)),o&&o.length>c.length){c=o,l=u,Q=pe;break}}}break}}if(c!==null){if(f=c.length,d=Q.group,d!==void 0&&(h=Q.tokenTypeIdx,p=this.createTokenInstance(c,w,h,Q.tokenType,O,W,f),this.handlePayload(p,l),d===!1?k=this.addToken(E,k,p):Z[d].push(p)),t=this.chopInput(t,f),w=w+f,W=this.computeNewColumn(W,f),C===!0&&Q.canLineTerminator===!0){let yt=0,zt,Dt;A.lastIndex=0;do zt=A.test(c),zt===!0&&(Dt=A.lastIndex-1,yt++);while(zt===!0);yt!==0&&(O=O+yt,W=f-Dt,this.updateTokenEndLineColumnLocation(p,d,Dt,yt,O,W,f))}this.handleModes(Q,B,ct,p)}else{const yt=w,zt=O,Dt=W;let pe=tt===!1;for(;pe===!1&&w<S;)for(t=this.chopInput(t,1),w++,i=0;i<y;i++){const ke=L[i],_=ke.pattern,H=ke.short;if(H!==!1?x.charCodeAt(w)===H&&(pe=!0):ke.isCustom===!0?pe=_.exec(x,w,E,Z)!==null:(this.updateLastIndex(_,w),pe=_.exec(t)!==null),pe===!0)break}if(m=w-yt,W=this.computeNewColumn(W,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(x,yt,m,zt,Dt),N.push({offset:yt,line:zt,column:Dt,length:m,message:b}),tt===!1)break}}return this.hasCustom||(E.length=k),{tokens:E,groups:Z,errors:N}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}}we.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",we.NA=/NOT_APPLICABLE/;function eo(e){return Fm(e)?e.LABEL:e.name}function Fm(e){return qe(e.LABEL)&&e.LABEL!==""}const tR="parent",zm="categories",$m="label",jm="group",Wm="push_mode",Gm="pop_mode",Km="longer_alt",Hm="line_breaks",Vm="start_chars_hint";function on(e){return eR(e)}function eR(e){const t=e.pattern,n={};if(n.name=e.name,Ar(t)||(n.PATTERN=t),ft(e,tR))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return ft(e,zm)&&(n.CATEGORIES=e[zm]),Qs([n]),ft(e,$m)&&(n.LABEL=e[$m]),ft(e,jm)&&(n.GROUP=e[jm]),ft(e,Gm)&&(n.POP_MODE=e[Gm]),ft(e,Wm)&&(n.PUSH_MODE=e[Wm]),ft(e,Km)&&(n.LONGER_ALT=e[Km]),ft(e,Hm)&&(n.LINE_BREAKS=e[Hm]),ft(e,Vm)&&(n.START_CHARS_HINT=e[Vm]),n}const xi=on({name:"EOF",pattern:we.NA});Qs([xi]);function Da(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function nR(e,t){return Zs(e,t)}const Ym={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${Fm(e)?`--> ${eo(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Cn(t).image+"'";if(r)return s+r+a;{const c=Xe(e,(d,h)=>d.concat(h),[]),l=ot(c,d=>`[${ot(d,h=>eo(h)).join(", ")}]`),f=`one of these possible Token sequences:
${ot(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Cn(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${ot(e,l=>`[${ot(l,u=>eo(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Ym);const rR={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},vi={buildDuplicateFoundError(e,t){function n(u){return u instanceof Zt?u.terminalType.name:u instanceof Je?u.nonTerminalName:""}const r=e.name,i=Cn(t),s=i.idx,o=rr(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=ot(e.prefixPath,i=>eo(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=ot(e.prefixPath,i=>eo(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=rr(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=ot(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof ns?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function iR(e,t){const n=new sR(e,t);return n.resolveRefs(),n.errors}class sR extends wi{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){dt(de(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:We.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class oR extends Sa{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ie(this.path.ruleStack).reverse(),this.occurrenceStack=Ie(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){Gt(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class aR extends oR{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Ze({definition:i});this.possibleTokTypes=Ys(s),this.found=!0}}}class Pa extends Sa{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class cR extends Pa{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Zt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class qm extends Pa{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Zt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class lR extends Pa{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Zt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Xm extends Pa{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Zt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function lu(e,t,n=[]){n=Ie(n);let r=[],i=0;function s(a){return a.concat(Ce(e,i+1))}function o(a){const c=lu(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Ze)return o(a.definition);if(a instanceof Je)return o(a.definition);if(a instanceof Qe)r=o(a.definition);else if(a instanceof er){const c=a.definition.concat([new be({definition:a.definition})]);return o(c)}else if(a instanceof nr){const c=[new Ze({definition:a.definition}),new be({definition:[new Zt({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Ln){const c=a.definition.concat([new be({definition:[new Zt({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof be){const c=a.definition.concat([new be({definition:a.definition})]);r=o(c)}else{if(a instanceof Mn)return dt(a.definition,c=>{Gt(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Zt)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Ce(e,i)}),r}function Jm(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!Gt(f);){const d=f.pop();if(d===o){a&&ts(f).idx<=l&&f.pop();continue}const h=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(Gt(h))continue;const g=h[0];if(g===i){const x={idx:p,def:Ce(h),ruleStack:Vs(m),occurrenceStack:Vs(b)};f.push(x)}else if(g instanceof Zt)if(p<c-1){const x=p+1,S=t[x];if(n(S,g.terminalType)){const w={idx:x,def:Ce(h),ruleStack:m,occurrenceStack:b};f.push(w)}}else if(p===c-1)u.push({nextTokenType:g.terminalType,nextTokenOccurrence:g.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(g instanceof Je){const x=Ie(m);x.push(g.nonTerminalName);const S=Ie(b);S.push(g.idx);const w={idx:p,def:g.definition.concat(s,Ce(h)),ruleStack:x,occurrenceStack:S};f.push(w)}else if(g instanceof Qe){const x={idx:p,def:Ce(h),ruleStack:m,occurrenceStack:b};f.push(x),f.push(o);const S={idx:p,def:g.definition.concat(Ce(h)),ruleStack:m,occurrenceStack:b};f.push(S)}else if(g instanceof er){const x=new be({definition:g.definition,idx:g.idx}),S=g.definition.concat([x],Ce(h)),w={idx:p,def:S,ruleStack:m,occurrenceStack:b};f.push(w)}else if(g instanceof nr){const x=new Zt({terminalType:g.separator}),S=new be({definition:[x].concat(g.definition),idx:g.idx}),w=g.definition.concat([S],Ce(h)),k={idx:p,def:w,ruleStack:m,occurrenceStack:b};f.push(k)}else if(g instanceof Ln){const x={idx:p,def:Ce(h),ruleStack:m,occurrenceStack:b};f.push(x),f.push(o);const S=new Zt({terminalType:g.separator}),w=new be({definition:[S].concat(g.definition),idx:g.idx}),k=g.definition.concat([w],Ce(h)),v={idx:p,def:k,ruleStack:m,occurrenceStack:b};f.push(v)}else if(g instanceof be){const x={idx:p,def:Ce(h),ruleStack:m,occurrenceStack:b};f.push(x),f.push(o);const S=new be({definition:g.definition,idx:g.idx}),w=g.definition.concat([S],Ce(h)),k={idx:p,def:w,ruleStack:m,occurrenceStack:b};f.push(k)}else if(g instanceof Mn)for(let x=g.definition.length-1;x>=0;x--){const S=g.definition[x],w={idx:p,def:S.definition.concat(Ce(h)),ruleStack:m,occurrenceStack:b};f.push(w),f.push(o)}else if(g instanceof Ze)f.push({idx:p,def:g.definition.concat(Ce(h)),ruleStack:m,occurrenceStack:b});else if(g instanceof ns)f.push(uR(g,p,m,b));else throw Error("non exhaustive match")}return u}function uR(e,t,n,r){const i=Ie(n);i.push(e.name);const s=Ie(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var oe;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(oe||(oe={}));function Zm(e){if(e instanceof Qe||e==="Option")return oe.OPTION;if(e instanceof be||e==="Repetition")return oe.REPETITION;if(e instanceof er||e==="RepetitionMandatory")return oe.REPETITION_MANDATORY;if(e instanceof nr||e==="RepetitionMandatoryWithSeparator")return oe.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Ln||e==="RepetitionWithSeparator")return oe.REPETITION_WITH_SEPARATOR;if(e instanceof Mn||e==="Alternation")return oe.ALTERNATION;throw Error("non exhaustive match")}function hR(e,t,n,r,i,s){const o=hu(e,t,n),a=ng(o)?Ua:Zs;return s(o,r,a,i)}function fR(e,t,n,r,i,s){const o=fu(e,t,i,n),a=ng(o)?Ua:Zs;return s(o[0],a,r)}function dR(e,t,n,r){const i=e.length,s=In(e,o=>In(o,a=>a.length===1));if(t)return function(o){const a=ot(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],p=h.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,h[m])===!1)continue t}return c}}};if(s&&!r){const o=ot(e,c=>sn(c)),a=Xe(o,(c,l,u)=>(dt(l,f=>{ft(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),dt(f.categoryMatches,d=>{ft(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function pR(e,t,n){const r=In(e,s=>s.length===1),i=e.length;if(r&&!n){const s=sn(e);if(s.length===1&&Gt(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Xe(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,dt(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class mR extends Sa{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,oe.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,oe.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,oe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,oe.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,oe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class Qm extends wi{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,oe.OPTION)}visitRepetition(t){this.checkIsTarget(t,oe.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,oe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,oe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,oe.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,oe.ALTERNATION)}}function tg(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function uu(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function gR(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function eg(e,t){const n=ot(e,o=>lu([o],1)),r=tg(n.length),i=ot(n,o=>{const a={};return dt(o,c=>{const l=uu(c.partialPath);dt(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=tg(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=uu(f);if(gR(i,h,c)||Gt(d)||f.length===t){const m=r[c];if(du(m,f)===!1){m.push(f);for(let b=0;b<h.length;b++){const g=h[b];i[c][g]=!0}}}else{const m=lu(d,o+1,f);s[c]=s[c].concat(m),dt(m,b=>{const g=uu(b.partialPath);dt(g,x=>{i[c][x]=!0})})}}}}return r}function hu(e,t,n,r){const i=new Qm(e,oe.ALTERNATION,r);return t.accept(i),eg(i.result,n)}function fu(e,t,n,r){const i=new Qm(e,n);t.accept(i);const s=i.result,a=new mR(t,e,n).startWalking(),c=new Ze({definition:s}),l=new Ze({definition:a});return eg([c,l],r)}function du(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function yR(e,t){return e.length<t.length&&In(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function ng(e){return In(e,t=>In(t,n=>In(n,r=>Gt(r.categoryMatches))))}function _R(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return ot(t,n=>Object.assign({type:We.CUSTOM_LOOKAHEAD_VALIDATION},n))}function bR(e,t,n,r){const i=bn(e,c=>wR(c,n)),s=NR(e,t,n),o=bn(e,c=>RR(c,n)),a=bn(e,c=>vR(c,e,r,n));return i.concat(s,o,a)}function wR(e,t){const n=new xR;e.accept(n);const r=n.allProductions,i=gm(r,ER),s=Nn(i,a=>a.length>1);return ot(de(s),a=>{const c=Cn(a),l=t.buildDuplicateFoundError(e,a),u=rr(c),f={message:l,type:We.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=rg(c);return d&&(f.parameter=d),f})}function ER(e){return`${rr(e)}_#_${e.idx}_#_${rg(e)}`}function rg(e){return e instanceof Zt?e.terminalType.name:e instanceof Je?e.nonTerminalName:""}class xR extends wi{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function vR(e,t,n,r){const i=[];if(Xe(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:We.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function kR(e,t,n){const r=[];let i;return je(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:We.INVALID_RULE_OVERRIDE,ruleName:e})),r}function ig(e,t,n,r=[]){const i=[],s=Ba(t.definition);if(Gt(s))return[];{const o=e.name;je(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:We.LEFT_RECURSION,ruleName:o});const c=wa(s,r.concat([e])),l=bn(c,u=>{const f=Ie(r);return f.push(u),ig(e,u,n,f)});return i.concat(l)}}function Ba(e){let t=[];if(Gt(e))return t;const n=Cn(e);if(n instanceof Je)t.push(n.referencedRule);else if(n instanceof Ze||n instanceof Qe||n instanceof er||n instanceof nr||n instanceof Ln||n instanceof be)t=t.concat(Ba(n.definition));else if(n instanceof Mn)t=sn(ot(n.definition,s=>Ba(s.definition)));else if(!(n instanceof Zt))throw Error("non exhaustive match");const r=ka(n),i=e.length>1;if(r&&i){const s=Ce(e);return t.concat(Ba(s))}else return t}class pu extends wi{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function SR(e,t){const n=new pu;e.accept(n);const r=n.alternations;return bn(r,s=>{const o=Vs(s.definition);return bn(o,(a,c)=>{const l=Jm([a],[],Zs,1);return Gt(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:We.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function AR(e,t,n){const r=new pu;e.accept(r);let i=r.alternations;return i=Ea(i,o=>o.ignoreAmbiguities===!0),bn(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=hu(a,e,c,o),u=IR(l,o,e,n),f=CR(l,o,e,n);return u.concat(f)})}class TR extends wi{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function RR(e,t){const n=new pu;e.accept(n);const r=n.alternations;return bn(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:We.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function OR(e,t,n){const r=[];return dt(e,i=>{const s=new TR;i.accept(s);const o=s.allProductions;dt(o,a=>{const c=Zm(a),l=a.maxLookahead||t,u=a.idx,d=fu(u,i,c,l)[0];if(Gt(sn(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:We.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function IR(e,t,n,r){const i=[],s=Xe(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||dt(c,u=>{const f=[l];dt(e,(d,h)=>{l!==h&&du(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!du(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return ot(s,a=>{const c=ot(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:We.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function CR(e,t,n,r){const i=Xe(e,(o,a,c)=>{const l=ot(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Hs(bn(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=_n(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&yR(d.path,l));return ot(u,d=>{const h=[d.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:We.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:h}})}))}function NR(e,t,n){const r=[],i=ot(t,s=>s.name);return dt(e,s=>{const o=s.name;if(je(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:We.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function LR(e){const t=tu(e,{errMsgProvider:rR}),n={};return dt(e.rules,r=>{n[r.name]=r}),iR(n,t.errMsgProvider)}function MR(e){return e=tu(e,{errMsgProvider:vi}),bR(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const sg="MismatchedTokenException",og="NoViableAltException",ag="EarlyExitException",cg="NotAllInputParsedException",lg=[sg,og,ag,cg];Object.freeze(lg);function Fa(e){return je(lg,e.name)}class za extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class ug extends za{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=sg}}class UR extends za{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=og}}class DR extends za{constructor(t,n){super(t,n),this.name=cg}}class PR extends za{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ag}}const mu={},hg="InRuleRecoveryException";class BR extends Error{constructor(t){super(t),this.name=hg}}class FR{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=ft(t,"recoveryEnabled")?t.recoveryEnabled:Tr.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=zR)}getTokenToInsert(t){const n=Da(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),p=new ug(h,l,this.LA(0));p.resyncedTokens=Vs(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new BR("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||Gt(n))return!1;const r=this.LA(1);return es(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return je(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=es(t,s=>nR(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return mu;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return ot(t,(r,i)=>i===0?mu:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=ot(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return sn(t)}getFollowSetFromFollowKey(t){if(t===mu)return[xi];const n=t.ruleName+t.idxInCallingRule+vm+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,xi)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Vs(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=Ie(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return ot(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function zR(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=xi,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const $R=4,qr=8,fg=1<<qr,dg=2<<qr,gu=3<<qr,yu=4<<qr,_u=5<<qr,$a=6<<qr;function bu(e,t,n){return n|t|e}class jR{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Tr.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(Gt(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return bn(t,n=>ig(n,n,vi))}validateEmptyOrAlternatives(t){return bn(t,n=>SR(n,vi))}validateAmbiguousAlternationAlternatives(t,n){return bn(t,r=>AR(r,n,vi))}validateSomeNonEmptyLookaheadPath(t,n){return OR(t,n,vi)}buildLookaheadForAlternation(t){return hR(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,dR)}buildLookaheadForOptional(t){return fR(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Zm(t.prodType),pR)}}class WR{initLooksAhead(t){this.dynamicTokensEnabled=ft(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Tr.dynamicTokensEnabled,this.maxLookahead=ft(t,"maxLookahead")?t.maxLookahead:Tr.maxLookahead,this.lookaheadStrategy=ft(t,"lookaheadStrategy")?t.lookaheadStrategy:new jR({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){dt(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=KR(n);dt(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${rr(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=bu(this.fullRuleNameToShort[n.name],fg,l.idx);this.setLaFuncCache(d,f)})}),dt(i,l=>{this.computeLookaheadFunc(n,l.idx,gu,"Repetition",l.maxLookahead,rr(l))}),dt(s,l=>{this.computeLookaheadFunc(n,l.idx,dg,"Option",l.maxLookahead,rr(l))}),dt(o,l=>{this.computeLookaheadFunc(n,l.idx,yu,"RepetitionMandatory",l.maxLookahead,rr(l))}),dt(a,l=>{this.computeLookaheadFunc(n,l.idx,$a,"RepetitionMandatoryWithSeparator",l.maxLookahead,rr(l))}),dt(c,l=>{this.computeLookaheadFunc(n,l.idx,_u,"RepetitionWithSeparator",l.maxLookahead,rr(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=bu(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return bu(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class GR extends wi{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const ja=new GR;function KR(e){ja.reset(),e.accept(ja);const t=ja.dslMethods;return ja.reset(),t}function pg(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function mg(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function HR(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function VR(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const YR="name";function gg(e,t){Object.defineProperty(e,YR,{enumerable:!1,configurable:!0,writable:!1,value:t})}function qR(e,t){const n=gn(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function XR(e,t){const n=function(){};gg(n,e+"BaseSemantics");const r={visit:function(i,s){if(It(i)&&(i=i[0]),!Ar(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=ZR(this,t);if(!Gt(i)){const s=ot(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function JR(e,t,n){const r=function(){};gg(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return dt(t,s=>{i[s]=qR}),r.prototype=i,r.prototype.constructor=r,r}var wu;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(wu||(wu={}));function ZR(e,t){return QR(e,t)}function QR(e,t){const n=_n(t,i=>xr(e[i])===!1),r=ot(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:wu.MISSING_METHOD,methodName:i}));return Hs(r)}class tO{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=ft(t,"nodeLocationTracking")?t.nodeLocationTracking:Tr.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=_e,this.cstFinallyStateUpdate=_e,this.cstPostTerminal=_e,this.cstPostNonTerminal=_e,this.cstPostRule=_e;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=mg,this.setNodeLocationFromNode=mg,this.cstPostRule=_e,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=_e,this.setNodeLocationFromNode=_e,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=pg,this.setNodeLocationFromNode=pg,this.cstPostRule=_e,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=_e,this.setNodeLocationFromNode=_e,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=_e,this.setNodeLocationFromNode=_e,this.cstPostRule=_e,this.setInitialNodeLocation=_e;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];HR(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];VR(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Ar(this.baseCstVisitorConstructor)){const t=XR(this.className,gn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Ar(this.baseCstVisitorWithDefaultsConstructor)){const t=JR(this.className,gn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class eO{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Ka}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?Ka:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class nO{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=Ha){if(je(this.definedRulesNames,t)){const o={message:vi.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:We.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=Ha){const i=kR(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(Fa(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return iT(de(this.gastProductionsCache))}}class rO{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Ua,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},ft(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(It(t)){if(Gt(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(It(t))this.tokensMap=Xe(t,(s,o)=>(s[o.name]=o,s),{});else if(ft(t,"modes")&&In(sn(de(t.modes)),ZT)){const s=sn(de(t.modes)),o=xa(s);this.tokensMap=Xe(o,(a,c)=>(a[c.name]=c,a),{})}else if(mn(t))this.tokensMap=Ie(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=xi;const r=ft(t,"modes")?sn(de(t.modes)):de(t),i=In(r,s=>Gt(s.categoryMatches));this.tokenMatcher=i?Ua:Zs,Qs(de(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=ft(r,"resyncEnabled")?r.resyncEnabled:Ha.resyncEnabled,s=ft(r,"recoveryValueFunc")?r.recoveryValueFunc:Ha.recoveryValueFunc,o=this.ruleShortNameIdx<<$R+qr;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Fa(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(dg,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(yu,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,oe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,yu,t,lR)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead($a,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Xm],a,$a,t,Xm)}else throw this.raiseEarlyExitException(t,oe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(gu,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,gu,t,cR,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(_u,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,qm],a,_u,t,qm)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,$a,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(fg,n),i=It(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new DR(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw Fa(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new ug(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===hg?r:s}}else throw r}saveRecogState(){const t=this.errors,n=Ie(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),xi)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class iO{initErrorHandler(t){this._errors=[],this.errorMessageProvider=ft(t,"errorMessageProvider")?t.errorMessageProvider:Tr.errorMessageProvider}SAVE_ERROR(t){if(Fa(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ie(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ie(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=fu(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new PR(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=hu(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new UR(c,this.LA(1),a))}}class sO{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Ar(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Jm([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Cn(t.ruleStack),i=this.getGAstProductions()[n];return new aR(i,t).startWalking()}}const Wa={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Wa);const yg=!0,_g=Math.pow(2,qr)-1,bg=on({name:"RECORDING_PHASE_TOKEN",pattern:we.NA});Qs([bg]);const wg=Da(bg,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(wg);const oO={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class aO{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return Ka}topLevelRuleRecord(t,n){try{const r=new ns({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return no.call(this,Qe,t,n)}atLeastOneInternalRecord(t,n){no.call(this,er,n,t)}atLeastOneSepFirstInternalRecord(t,n){no.call(this,nr,n,t,yg)}manyInternalRecord(t,n){no.call(this,be,n,t)}manySepFirstInternalRecord(t,n){no.call(this,Ln,n,t,yg)}orInternalRecord(t,n){return cO.call(this,t,n)}subruleInternalRecord(t,n,r){if(Ga(n),!t||ft(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Eg(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=ts(this.recordingProdStack),s=t.ruleName,o=new Je({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?oO:Wa}consumeInternalRecord(t,n,r){if(Ga(n),!Pm(t)){const o=new Error(`<CONSUME${Eg(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=ts(this.recordingProdStack),s=new Zt({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),wg}}function no(e,t,n,r=!1){Ga(n);const i=ts(this.recordingProdStack),s=xr(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),ft(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Wa}function cO(e,t){Ga(t);const n=ts(this.recordingProdStack),r=It(e)===!1,i=r===!1?e:e.DEF,s=new Mn({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});ft(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=eu(i,a=>xr(a.GATE));return s.hasPredicates=o,n.definition.push(s),dt(i,a=>{const c=new Ze({definition:[]});s.definition.push(c),ft(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:ft(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Wa}function Eg(e){return e===0?"":`${e}`}function Ga(e){if(e<0||e>_g){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${_g+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class lO{initPerformanceTracer(t){if(ft(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Tr.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=wm(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function uO(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const Ka=Da(xi,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Ka);const Tr=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Ym,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Ha=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var We;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(We||(We={}));class ro{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Em(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),dt(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=LR({rules:de(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(Gt(r)&&this.skipValidations===!1){const i=MR({rules:de(this.gastProductionsCache),tokenTypes:de(this.tokensMap),errMsgProvider:vi,grammarName:n}),s=_R({lookaheadStrategy:this.lookaheadStrategy,rules:de(this.gastProductionsCache),tokenTypes:de(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Gt(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=hT(de(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:de(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(de(this.gastProductionsCache))})),!ro.DEFER_DEFINITION_ERRORS_HANDLING&&!Gt(this.definitionErrors))throw t=ot(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),ft(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=ft(n,"skipValidations")?n.skipValidations:Tr.skipValidations}}ro.DEFER_DEFINITION_ERRORS_HANDLING=!1,uO(ro,[FR,WR,tO,eO,rO,nO,iO,sO,aO,lO]);class hO extends ro{constructor(t,n=Tr){const r=Ie(n);r.outputCst=!0,super(t,r)}}function fO(e){const t=new dO,n=de(e);return ot(n,r=>t.visitRule(r))}class dO extends wi{visitRule(t){const n=this.visitEach(t.definition),r=gm(n,s=>s.propertyName),i=ot(r,(s,o)=>{const a=!eu(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=ot(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:Va(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:Va(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:Va(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:Va(t)}]}visitEachAndOverrideWith(t,n){return ot(this.visitEach(t),r=>Ye({},r,n))}visitEach(t){return sn(ot(t,n=>this.visit(n)))}}function Va(e){return e instanceof Je?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function pO(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(sn(ot(e,r=>mO(r)))),t.includeVisitorInterface&&(n=n.concat(bO(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function mO(e){const t=gO(e),n=yO(e);return[t,n]}function gO(e){const t=vg(e.name),n=Eu(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function yO(e){return`export type ${Eu(e.name)} = {
  ${ot(e.properties,n=>_O(n)).join(`
  `)}
};`}function _O(e){const t=EO(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function bO(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${ot(t,n=>wO(n)).join(`
  `)}
}`}function wO(e){const t=Eu(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function EO(e){if(It(e)){const t=xa(ot(e,r=>xg(r)));return"("+Xe(t,(r,i)=>r+" | "+i)+")"}else return xg(e)}function xg(e){return e.kind==="token"?"IToken":vg(e.name)}function vg(e){return Bp(e)+"CstNode"}function Eu(e){return Bp(e)+"CstChildren"}const xO={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function vO(e,t){const n=Object.assign(Object.assign({},xO),t),r=fO(e);return pO(r,n)}var kg={exports:{}},vt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var io=Symbol.for("react.element"),kO=Symbol.for("react.portal"),SO=Symbol.for("react.fragment"),AO=Symbol.for("react.strict_mode"),TO=Symbol.for("react.profiler"),RO=Symbol.for("react.provider"),OO=Symbol.for("react.context"),IO=Symbol.for("react.forward_ref"),CO=Symbol.for("react.suspense"),NO=Symbol.for("react.memo"),LO=Symbol.for("react.lazy"),Sg=Symbol.iterator;function MO(e){return e===null||typeof e!="object"?null:(e=Sg&&e[Sg]||e["@@iterator"],typeof e=="function"?e:null)}var Ag={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Tg=Object.assign,Rg={};function is(e,t,n){this.props=e,this.context=t,this.refs=Rg,this.updater=n||Ag}is.prototype.isReactComponent={},is.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},is.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Og(){}Og.prototype=is.prototype;function xu(e,t,n){this.props=e,this.context=t,this.refs=Rg,this.updater=n||Ag}var vu=xu.prototype=new Og;vu.constructor=xu,Tg(vu,is.prototype),vu.isPureReactComponent=!0;var Ig=Array.isArray,Cg=Object.prototype.hasOwnProperty,ku={current:null},Ng={key:!0,ref:!0,__self:!0,__source:!0};function Lg(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Cg.call(t,r)&&!Ng.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:io,type:e,key:s,ref:o,props:i,_owner:ku.current}}function UO(e,t){return{$$typeof:io,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Su(e){return typeof e=="object"&&e!==null&&e.$$typeof===io}function DO(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Mg=/\/+/g;function Au(e,t){return typeof e=="object"&&e!==null&&e.key!=null?DO(""+e.key):t.toString(36)}function Ya(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case io:case kO:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+Au(o,0):r,Ig(i)?(n="",e!=null&&(n=e.replace(Mg,"$&/")+"/"),Ya(i,t,n,"",function(l){return l})):i!=null&&(Su(i)&&(i=UO(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Mg,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",Ig(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+Au(s,a);o+=Ya(s,t,n,c,i)}else if(c=MO(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+Au(s,a++),o+=Ya(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function qa(e,t,n){if(e==null)return e;var r=[],i=0;return Ya(e,r,"","",function(s){return t.call(n,s,i++)}),r}function PO(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ge={current:null},Xa={transition:null},BO={ReactCurrentDispatcher:Ge,ReactCurrentBatchConfig:Xa,ReactCurrentOwner:ku};function Ug(){throw Error("act(...) is not supported in production builds of React.")}vt.Children={map:qa,forEach:function(e,t,n){qa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return qa(e,function(){t++}),t},toArray:function(e){return qa(e,function(t){return t})||[]},only:function(e){if(!Su(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},vt.Component=is,vt.Fragment=SO,vt.Profiler=TO,vt.PureComponent=xu,vt.StrictMode=AO,vt.Suspense=CO,vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BO,vt.act=Ug,vt.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Tg({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=ku.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)Cg.call(t,c)&&!Ng.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:io,type:e.type,key:i,ref:s,props:r,_owner:o}},vt.createContext=function(e){return e={$$typeof:OO,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:RO,_context:e},e.Consumer=e},vt.createElement=Lg,vt.createFactory=function(e){var t=Lg.bind(null,e);return t.type=e,t},vt.createRef=function(){return{current:null}},vt.forwardRef=function(e){return{$$typeof:IO,render:e}},vt.isValidElement=Su,vt.lazy=function(e){return{$$typeof:LO,_payload:{_status:-1,_result:e},_init:PO}},vt.memo=function(e,t){return{$$typeof:NO,type:e,compare:t===void 0?null:t}},vt.startTransition=function(e){var t=Xa.transition;Xa.transition={};try{e()}finally{Xa.transition=t}},vt.unstable_act=Ug,vt.useCallback=function(e,t){return Ge.current.useCallback(e,t)},vt.useContext=function(e){return Ge.current.useContext(e)},vt.useDebugValue=function(){},vt.useDeferredValue=function(e){return Ge.current.useDeferredValue(e)},vt.useEffect=function(e,t){return Ge.current.useEffect(e,t)},vt.useId=function(){return Ge.current.useId()},vt.useImperativeHandle=function(e,t,n){return Ge.current.useImperativeHandle(e,t,n)},vt.useInsertionEffect=function(e,t){return Ge.current.useInsertionEffect(e,t)},vt.useLayoutEffect=function(e,t){return Ge.current.useLayoutEffect(e,t)},vt.useMemo=function(e,t){return Ge.current.useMemo(e,t)},vt.useReducer=function(e,t,n){return Ge.current.useReducer(e,t,n)},vt.useRef=function(e){return Ge.current.useRef(e)},vt.useState=function(e){return Ge.current.useState(e)},vt.useSyncExternalStore=function(e,t,n){return Ge.current.useSyncExternalStore(e,t,n)},vt.useTransition=function(){return Ge.current.useTransition()},vt.version="18.3.1",kg.exports=vt;var FO=kg.exports;const zO=al(32,126).map(e=>String.fromCharCode(e)),$O=on({name:"Whitespace",pattern:/ +/}),jO=on({name:"WhitespaceSkipped",pattern:/ +/,group:we.SKIPPED}),Tu=on({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),Dg=on({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:zO}),Ru=on({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ou=on({name:"EscapedDollar",pattern:"$$"}),Iu=on({name:"MaybeFlag",pattern:/\$[^ $\r\n]+/}),Cu=on({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),Pg=on({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function WO(e,t=""){return on({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const Bg=Object.keys(ea).map(e=>WO(`\\$(${e})`,e)),GO=[$O,Tu,...Bg,Ru,Dg,Cu,Ou,Pg,Iu],KO=new we(GO,{skipValidations:!qn,ensureOptimizations:qn}),HO=new we([jO,Tu,...Bg,Ru,Dg,Cu,Ou,Pg,Iu],{skipValidations:!qn,ensureOptimizations:qn});function Nu(e,t=!1){return t?HO.tokenize(e):KO.tokenize(e)}function Lu(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[]}}FO.createContext(Lu(1,1,15,1));function Fg(e){e.active={...e.reset}}function zg(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x+1)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Ou:s("$");break;case Cu:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case Ru:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Tu:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=ea[l],f=Vb(xt[u]),d=Yb(xt[u]);u==="CLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):T(f)?t.active.color=f:T(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(T(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Fg(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;XO(u,u+l.length,t.active.color,t.active.bg,t),qO(u,l,t)}}}function VO(e,t,n){const r=Nu(e);r.tokens&&(zg(r.tokens,t),Fg(t))}function YO(e,t,n){const r=Nu(e);if(!r.tokens)return;const i=Lu(t,n,xt.WHITE,xt.BLACK);return i.measureonly=!0,zg(r.tokens,i),i.x>0&&++i.y,i}function qO(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++)}function XO(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r}const Mu=al(32,126).map(e=>String.fromCharCode(e));function Rt(e){return on({...e,name:`token_${e.name}`})}function wn(e,t=!1){return Rt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:tn,group:we.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:tn})}const ss=Rt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),JO=Rt({name:"whitespace",pattern:/ +/,group:we.SKIPPED}),ZO=Rt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:we.SKIPPED}),Uu=Rt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),os=Rt({name:"command",pattern:/#/,start_chars_hint:["#"]});let $g=!1;function QO(e,t,n){if(!$g)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==ss)return null;let i=t;for(;e[i]===" ";)i++;if(`@#/?':!"`.includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;return[e.substring(t,s)]}const jg=Rt({name:"text",pattern:QO,line_breaks:!1,start_chars_hint:Mu.filter(e=>"@#/?':!".includes(e)===!1)}),Wg=Rt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Gg=Rt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Kg=Rt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Hg=Rt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),tn=Rt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Mu}),Du=Rt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Vg=Rt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Yg=Rt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:tn}),qg=Rt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:tn}),Xg=Rt({name:"islessthan",pattern:/<|below/,longer_alt:tn}),Jg=Rt({name:"isgreaterthan",pattern:/>|above/,longer_alt:tn}),Zg=Rt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:tn}),Qg=Rt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:tn}),Pu=Rt({name:"or",pattern:/or/i,longer_alt:tn}),Bu=Rt({name:"not",pattern:/not/i,longer_alt:tn}),Fu=Rt({name:"and",pattern:/and/i,longer_alt:tn}),zu=Rt({name:"plus",pattern:/\+/}),$u=Rt({name:"minus",pattern:/-/}),t0=Rt({name:"power",pattern:/\*\*/}),e0=Rt({name:"multiply",pattern:/\*/}),ju=Rt({name:"divide",pattern:/\//}),n0=Rt({name:"moddivide",pattern:/%/}),r0=Rt({name:"floordivide",pattern:/%%/}),i0=Rt({name:"query",pattern:/\?/}),s0=Rt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),o0=Rt({name:"rparen",pattern:/\)/,pop_mode:!0}),a0=Rt({name:"command_play",pattern:/play .*/,start_chars_hint:Mu,longer_alt:tn}),Wu=wn("if"),c0=wn("do"),tI=wn("to",!0),Gu=wn("done"),eI=wn("then",!0),Ku=wn("else"),l0=wn("while"),u0=wn("repeat"),h0=wn("waitfor"),f0=wn("foreach"),d0=wn("break"),p0=wn("continue");function m0(e){return[...e,Vg,Yg,qg,Zg,Xg,Qg,Jg,Pu,Bu,Fu,zu,$u,t0,e0,ju,r0,n0,i0,s0,o0,Du,tn]}const g0=m0([jg,Uu,a0,os,Wg,Gg,Kg,Hg,ss,JO,Wu,Gu,c0,tI,eI,Ku,l0,u0,h0,f0,d0,p0]),nI=new we({defaultMode:"use_newlines",modes:{use_newlines:g0,ignore_newlines:m0([ZO])}},{skipValidations:!qn,ensureOptimizations:qn});function Hu(e){$g=!0;const t=nI.tokenize(e||` 
`),[n]=(Le(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(Da(ss,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}let y0=0;const _0=qn,rI=["Command","lines"];class iI extends hO{constructor(){super(g0,{traceInitPerf:qn,skipValidations:!qn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});gt(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));gt(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(ss)}])}));gt(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));gt(this,"do_block",this.RULED("do_block",()=>{this.CONSUME(c0),this.MANY(()=>this.CONSUME(ss)),this.AT_LEAST_ONE({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}));gt(this,"do_inline",this.RULED("do_inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{GATE:this.BACKTRACK(this.commands),ALT:()=>this.MANY(()=>this.SUBRULE(this.commands))}])}));gt(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Gg)}));gt(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Uu)}));gt(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Du)},{ALT:()=>this.CONSUME(jg)}])}));gt(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Wg)}));gt(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Kg),this.SUBRULE(this.words),this.CONSUME(Hg)}));gt(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(os),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));gt(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));gt(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));gt(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));gt(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(ju),this.SUBRULE(this.words)}));gt(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(i0),this.SUBRULE(this.words)}));gt(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Wu),this.SUBRULE(this.words),this.OPTION({GATE:this.BACKTRACK(this.command_if_block),DEF:()=>this.SUBRULE(this.command_if_block)})}));gt(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{GATE:this.BACKTRACK(this.do_inline),ALT:()=>this.SUBRULE(this.do_inline)},{ALT:()=>{this.SUBRULE(this.do_block),this.MANY({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION2({GATE:this.BACKTRACK(this.command_else),DEF:()=>this.SUBRULE(this.command_else)}),this.MANY2(()=>this.CONSUME(ss)),this.CONSUME(os),this.CONSUME(Gu)}}])}));gt(this,"command_block",this.RULED("command_block",()=>{this.OR([{GATE:this.BACKTRACK(this.do_inline),ALT:()=>this.SUBRULE(this.do_inline)},{GATE:this.BACKTRACK(this.do_block),ALT:()=>this.SUBRULE(this.do_block)}])}));gt(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(os),this.CONSUME(Ku),this.CONSUME(Wu),this.SUBRULE(this.words),this.OPTION({GATE:this.BACKTRACK(this.command_block),DEF:()=>this.SUBRULE(this.command_block)})}));gt(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(os),this.CONSUME(Ku),this.OPTION({GATE:this.BACKTRACK(this.command_block),DEF:()=>this.SUBRULE(this.command_block)})}));gt(this,"command_loop",this.RULED("command_loop",()=>{this.OR([{GATE:this.BACKTRACK(this.do_inline),ALT:()=>this.SUBRULE(this.do_inline)},{GATE:this.BACKTRACK(this.do_block),ALT:()=>{this.SUBRULE(this.do_block),this.CONSUME(os),this.CONSUME(Gu)}}])}));gt(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(l0),this.SUBRULE(this.words),this.OPTION({GATE:this.BACKTRACK(this.command_loop),DEF:()=>this.SUBRULE(this.command_loop)})}));gt(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(u0),this.SUBRULE(this.words),this.OPTION({GATE:this.BACKTRACK(this.command_loop),DEF:()=>this.SUBRULE(this.command_loop)})}));gt(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(h0),this.SUBRULE(this.words)}));gt(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(f0),this.SUBRULE(this.words),this.OPTION({GATE:this.BACKTRACK(this.command_loop),DEF:()=>this.SUBRULE(this.command_loop)})}));gt(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(d0)}));gt(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(p0)}));gt(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(a0)}));gt(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Pu),this.SUBRULE2(this.and_test)})}));gt(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Fu),this.SUBRULE2(this.not_test)})}));gt(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Bu),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));gt(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));gt(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(Yg)},{ALT:()=>this.CONSUME(qg)},{ALT:()=>this.CONSUME(Xg)},{ALT:()=>this.CONSUME(Jg)},{ALT:()=>this.CONSUME(Zg)},{ALT:()=>this.CONSUME(Qg)}])}));gt(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Pu),this.SUBRULE2(this.and_test_value)})}));gt(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Fu),this.SUBRULE2(this.not_test_value)})}));gt(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Bu),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));gt(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));gt(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(zu)},{ALT:()=>this.CONSUME($u)}]),this.SUBRULE(this.term)}));gt(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));gt(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(e0)},{ALT:()=>this.CONSUME(ju)},{ALT:()=>this.CONSUME(n0)},{ALT:()=>this.CONSUME(r0)}]),this.SUBRULE(this.factor)}));gt(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(zu)},{ALT:()=>this.CONSUME($u)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));gt(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(t0),this.SUBRULE(this.factor)})}));gt(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));gt(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Du)},{ALT:()=>this.CONSUME(tn)},{ALT:()=>this.CONSUME(Vg)},{ALT:()=>{this.CONSUME(s0),this.SUBRULE(this.expr),this.CONSUME(o0)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=rI.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(y0++).toString().padStart(3),c=s?"font-weight: bold;":"";if(_0&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),_0&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),y0--},i)}}const as=new iI;if(ZE){const e=as.getGAstProductions(),t=vO(e);console.info(t)}const sI=as.getBaseCstVisitorConstructor();var kt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.TEXT=1]="TEXT",e[e.LABEL=2]="LABEL",e[e.HYPERLINK=3]="HYPERLINK",e[e.STAT=4]="STAT",e[e.MOVE=5]="MOVE",e[e.COMMAND=6]="COMMAND",e[e.LITERAL=7]="LITERAL",e[e.IF=8]="IF",e[e.IF_BLOCK=9]="IF_BLOCK",e[e.ELSE_IF=10]="ELSE_IF",e[e.ELSE=11]="ELSE",e[e.WHILE=12]="WHILE",e[e.BREAK=13]="BREAK",e[e.CONTINUE=14]="CONTINUE",e[e.REPEAT=15]="REPEAT",e[e.WAITFOR=16]="WAITFOR",e[e.FOREACH=17]="FOREACH",e[e.OR=18]="OR",e[e.AND=19]="AND",e[e.NOT=20]="NOT",e[e.COMPARE=21]="COMPARE",e[e.COMPARE_ITEM=22]="COMPARE_ITEM",e[e.OPERATOR=23]="OPERATOR",e[e.OPERATOR_ITEM=24]="OPERATOR_ITEM",e[e.EXPR=25]="EXPR",e))(kt||{}),ki=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(ki||{}),ir=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(ir||{}),Ja=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Ja||{});function oI(e){return!!(e!=null&&e.tokenType)}function sr(e,t){const[n]=e??[];return(n==null?void 0:n.image)??t}function b0(e,t){return mt(e,{type:7,literal:1,value:t})}function aI(e){const t=Object.values(e).flat().filter(n=>!!n).map(n=>n&&oI(n)?{startLine:n.startLine,startColumn:n.startColumn,startOffset:n.startOffset,endLine:n.endLine,endColumn:n.endColumn,endOffset:n.endOffset}:n!=null&&n.location?{...n.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(n=>n.startLine!==0&&n.endLine!==0);return{startLine:Math.min(...t.map(n=>n.startLine??1)),startColumn:Math.min(...t.map(n=>n.startColumn??1)),startOffset:Math.min(...t.map(n=>n.startOffset??1)),endLine:Math.max(...t.map(n=>n.endLine??1)),endColumn:Math.max(...t.map(n=>n.endColumn??1)),endOffset:Math.max(...t.map(n=>n.endOffset??1))}}function mt(e,t){return[{...t,...aI(e)}]}class cI extends sI{constructor(){super(),qn&&this.validateVisitor()}go(t){return Array.isArray(t)?t.map(n=>this.visit(n)).flat():T(t)?[this.visit(t)].flat():[]}program(t){return mt(t,{type:0,lines:this.go(t.line)})}line(t){return this.go(t.stmt)}stmt(t){return t.stmt_label?this.go(t.stmt_label):t.stmt_stat?this.go(t.stmt_stat):t.stmt_text?this.go(t.stmt_text):t.stmt_comment?this.go(t.stmt_comment):t.stmt_command?this.go(t.stmt_command):t.stmt_hyperlink?this.go(t.stmt_hyperlink):t.short_commands?[this.go(t.short_commands),this.go(t.commands)].flat():[]}do_block(t){return this.go(t.line)}do_inline(t){return t.stmt_stat?this.go(t.stmt_stat):t.stmt_text?this.go(t.stmt_text):t.stmt_comment?this.go(t.stmt_comment):t.stmt_command?this.go(t.stmt_command):t.stmt_hyperlink?this.go(t.stmt_hyperlink):t.commands?this.go(t.commands):[]}stmt_label(t){return mt(t,{type:2,active:!0,name:sr(t.token_label,":").slice(1).trim()})}stmt_stat(t){return mt(t,{type:4,value:sr(t.token_stat,"@").slice(1)})}stmt_text(t){return mt(t,{type:1,value:sr(t.token_stringliteraldouble,"")||sr(t.token_text,"")})}stmt_comment(t){return mt(t,{type:2,active:!1,name:sr(t.token_comment,"'").slice(1).trim()})}stmt_hyperlink(t){return mt(t,{type:3,link:this.go(t.words),text:sr(t.token_hyperlinktext,";").slice(1)})}stmt_command(t){return t.commands?this.go(t.commands):[]}short_commands(t){return t.short_go?this.go(t.short_go):t.short_try?this.go(t.short_try):[]}commands(t){return t.words?mt(t,{type:6,words:this.go(t.words)}):t.short_go?this.go(t.short_go):t.short_try?this.go(t.short_try):t.command_play?this.go(t.command_play):t.structured_cmd?this.go(t.structured_cmd):[]}structured_cmd(t){return t.command_if?this.go(t.command_if):t.command_while?this.go(t.command_while):t.command_repeat?this.go(t.command_repeat):t.command_waitfor?this.go(t.command_waitfor):t.command_foreach?this.go(t.command_foreach):t.command_break?this.go(t.command_break):t.command_continue?this.go(t.command_continue):[]}short_go(t){return t.token_divide?mt(t,{type:5,wait:!0,words:this.go(t.words)}):[]}short_try(t){return t.token_query?mt(t,{type:5,wait:!1,words:this.go(t.words)}):[]}command_if(t){return mt(t,{type:8,method:"if",words:this.go(t.words),blocks:this.go(t.command_if_block)})}command_if_block(t){return mt(t,{type:9,lines:[this.go(t.do_inline),this.go(t.do_block)].flat(),altlines:[this.go(t.command_else_if),this.go(t.command_else)].flat()})}command_block(t){return[this.go(t.do_inline),this.go(t.do_block)].flat()}command_else_if(t){return mt(t,{type:10,method:"if",skipto:"",words:this.go(t.words),lines:this.go(t.command_block)})}command_else(t){return mt(t,{type:11,method:"if",lines:this.go(t.command_block)})}command_loop(t){return[this.go(t.do_inline),this.go(t.do_block)].flat()}command_while(t){return mt(t,{type:12,method:"while",words:this.go(t.words),lines:this.go(t.command_loop)})}command_repeat(t){return mt(t,{type:15,words:this.go(t.words),lines:this.go(t.command_loop)})}command_waitfor(t){return mt(t,{type:16,words:this.go(t.words)})}command_foreach(t){return mt(t,{type:17,words:this.go(t.words),lines:this.go(t.command_loop)})}command_break(t){return mt(t,{type:13,skipto:""})}command_continue(t){return mt(t,{type:14,skipto:""})}command_play(t){const n=sr(t.token_command_play,"").replace("play","").trim();return mt(t,{type:6,words:[b0(t,"play"),b0(t,n)].flat()})}expr(t){return t.and_test.length===1?this.go(t.and_test):mt(t,{type:18,items:this.go(t.and_test)})}and_test(t){return t.not_test.length===1?this.go(t.not_test):mt(t,{type:19,items:this.go(t.not_test)})}not_test(t){return t.comparison?this.go(t.comparison):t.not_test?mt(t,{type:20,items:this.go(t.not_test)}):[]}comparison(t){if(t.arith_expr.length===1)return this.go(t.arith_expr);const[n,r]=this.go(t.arith_expr),[i]=this.go(t.comp_op);return mt(t,{type:21,lhs:n,compare:i,rhs:r})}comp_op(t){return t.token_iseq?mt(t,{type:22,method:0}):t.token_isnoteq?mt(t,{type:22,method:1}):t.token_islessthan?mt(t,{type:22,method:2}):t.token_isgreaterthan?mt(t,{type:22,method:3}):t.token_isgreaterthanorequal?mt(t,{type:22,method:4}):t.token_isgreaterthanorequal?mt(t,{type:22,method:5}):[]}expr_value(t){return t.and_test_value.length===1?this.go(t.and_test_value):mt(t,{type:18,items:this.go(t.and_test_value)})}and_test_value(t){return t.not_test_value.length===1?this.go(t.not_test_value):mt(t,{type:19,items:this.go(t.not_test_value)})}not_test_value(t){return t.arith_expr?this.go(t.arith_expr):t.not_test_value?mt(t,{type:20,items:this.go(t.not_test_value)}):[]}arith_expr(t){const n=this.go(t.term);return t.arith_expr_item?mt(t,{type:23,lhs:n[0],items:this.go(t.arith_expr_item)}):n}arith_expr_item(t){return mt(t,{type:24,operator:t.token_plus?1:2,rhs:this.go(t.term)[0]})}term(t){return t.term_item?mt(t,{type:23,lhs:this.go(t.factor)[0],items:this.go(t.term_item)}):this.go(t.factor)}term_item(t){let n=0;return t.token_multiply&&(n=4),t.token_divide&&(n=5),t.token_moddivide&&(n=6),t.token_floordivide&&(n=7),mt(t,{type:24,operator:n,rhs:this.go(t.factor)[0]})}factor(t){if(t.power)return this.go(t.power);let n=0;return t.token_plus&&(n=8),t.token_minus&&(n=9),mt(t,{type:23,lhs:void 0,items:mt(t,{type:24,operator:n,rhs:this.go(t.factor)[0]})})}power(t){const n=this.go(t.token);return t.factor?mt(t,{type:23,lhs:n[0],items:mt(t,{type:24,operator:3,rhs:this.go(t.factor)[0]})}):n}words(t){return this.go(t.expr)}token(t){if(t.token_stringliteraldouble){const n=sr(t.token_stringliteraldouble,'""').replace(/(^"|"$)/g,"");return mt(t,{type:7,literal:2,value:n.substring(1,n.length-1)})}return t.token_stringliteral?mt(t,{type:7,literal:1,value:sr(t.token_stringliteral,"")}):t.token_numberliteral?mt(t,{type:7,literal:0,value:parseFloat(sr(t.token_numberliteral,"0"))}):t.token_lparen?mt(t,{type:25,words:this.go(t.expr)}):[]}}const lI=new cI,En={internal:0,labels:{},labelIndex:0},w0="     ",Un=`
         `,E0="if (api.hm()) { continue zss; }",uI="if (api.sy()) { yield 1; }",hI=`yield 1; ${E0}`;let x0=!1;const Vu={};function v0(e){if(!x0)return"";Vu[e]=Vu[e]??0;const t=Vu[e]++;return`${Un}console.info('${e}-${t}')`}function Za(){return`${hI};${v0("wait")}`}function k0(){return`${uI}; ${E0}${v0("eol")};`}function fI(e){x0=e===t1}const Qa="zss.js";function Qt(e,t){return new JE(e.startLine??1,e.startColumn??1,Qa,t)}function Yu(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function qu(e){return`'${Yu(e)}'`}function tc(e){if(e.startsWith('"'))return tc(e.substring(1,e.length-1));const t=Nu(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Iu?`', api.get('${Yu(r.image.substring(1))}'), '`:Yu(r.image)).join("")}'].join('')`}function or(e){return e.filter(t=>t!==void 0).map(Bt)}function S0(e){return Qt(e,"")}function dI(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function Xt(e,t,n){return Qt(e,[`api.${t}(`,...dI(n,", "),")"])}function pI(e){if(e.type===kt.COMPARE&&e.compare.type===kt.COMPARE_ITEM)switch(e.compare.method){case ki.IS_EQ:return Xt(e,"isEq",[Bt(e.lhs),Bt(e.rhs)]);case ki.IS_NOT_EQ:return Xt(e,"isNotEq",[Bt(e.lhs),Bt(e.rhs)]);case ki.IS_LESS_THAN:return Xt(e,"isLessThan",[Bt(e.lhs),Bt(e.rhs)]);case ki.IS_GREATER_THAN:return Xt(e,"isGreaterThan",[Bt(e.lhs),Bt(e.rhs)]);case ki.IS_LESS_THAN_OR_EQ:return Xt(e,"isLessThanOrEq",[Bt(e.lhs),Bt(e.rhs)]);case ki.IS_GREATER_THAN_OR_EQ:return Xt(e,"isGreaterThanOrEq",[Bt(e.lhs),Bt(e.rhs)])}return Qt(e,"")}function Si(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",Bt(n),")"])}function A0(e,t,n){return e.prepend(`api.${t}(`),e.add([Bt(n),")"])}function mI(e,t){if(e.type===kt.OPERATOR_ITEM)switch(e.operator){case ir.PLUS:return Si(t,"opPlus",e.rhs);case ir.MINUS:return Si(t,"opMinus",e.rhs);case ir.POWER:return Si(t,"opPower",e.rhs);case ir.MULTIPLY:return Si(t,"opMultiply",e.rhs);case ir.DIVIDE:return Si(t,"opDivide",e.rhs);case ir.MOD_DIVIDE:return Si(t,"opModDivide",e.rhs);case ir.FLOOR_DIVIDE:return Si(t,"opFloorDivide",e.rhs);case ir.UNI_PLUS:return A0(t,"opUniPlus",e.rhs);case ir.UNI_MINUS:return A0(t,"opUniMinus",e.rhs)}return Qt(e,"")}function gI(e){if(e.type===kt.OPERATOR){const t=e.lhs?Bt(e.lhs):Qt(e,"");return e.items.forEach(n=>mI(n,t)),t}return Qt(e,"")}function Dn(){return`_zc${En.internal++}_`}function xn(e,t=!0){const n=e.toLowerCase(),r=En.labelIndex++;return En.labels[n]||(En.labels[n]=[]),En.labels[n].push(t?r:-r),r}function vn(e,t,n){return Qt(e,`case ${n}: // ${t}`)}function en(e,t){return Qt(e,[Xt(e,"goto",[qu(t)]),"; continue zss;"])}function Bt(e){switch(e.type){case kt.PROGRAM:return Qt(e,[`try { // first-line
`,`zss: while (true) {
`,`switch (api.getcase()) {
`,`default:
`,`case 1: 
`,...e.lines.map(t=>[Bt(t),`
`]).flat(),`}
`,`api.endofprogram();
`,`while(true) { ${Za()} }
`,`}
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Qa}`]);case kt.LITERAL:switch(e.literal){case Ja.NUMBER:return Qt(e,`${e.value}`);case Ja.STRING:return Qt(e,qu(e.value));case Ja.TEMPLATE:return Qt(e,tc(e.value))}return S0(e);case kt.TEXT:return Xt(e,"text",[tc(e.value)]);case kt.STAT:return Xt(e,"stat",[qu(e.value)]);case kt.LABEL:{const t=xn(e.name,e.active);return vn(e,e.name,t)}case kt.HYPERLINK:return Xt(e,"hyperlink",[tc(e.text),...or(e.link)]);case kt.MOVE:return Qt(e,[`${w0}while (`,Xt(e,"move",[e.wait?"true":"false",...or(e.words)]),`)${Un}{ ${Za()} };${Un}${k0()}`]);case kt.COMMAND:return Qt(e,[`${w0}while (`,Xt(e,"command",or(e.words)),`)${Un}{ ${Za()} };${Un}${k0()}`]);case kt.IF:{const t=Dn(),n=xn(t),r=Dn(),i=xn(r),s=Qt(e,["if (!",Xt(e,e.method,or(e.words)),`)${Un}{ `,en(e,r),` }
`]);return e.blocks.forEach(o=>{o.type===kt.IF_BLOCK&&o.lines.forEach(a=>s.add([Bt(a),`
`]))}),s.add([en(e,t),`
`]),s.add([vn(e,r,i),`
`]),e.blocks.forEach(o=>{o.type===kt.IF_BLOCK&&o.altlines.forEach(a=>{a.type===kt.ELSE_IF&&(a.skipto=t),s.add([Bt(a),`
`])})}),s.add([vn(e,t,n),`
`]),s}case kt.ELSE_IF:{const t=Dn(),n=xn(t),r=Qt(e,["if (!",Xt(e,e.method,or(e.words)),`)${Un}{ `,en(e,t),` }
`]);return e.lines.forEach(i=>r.add([Bt(i),`
`])),r.add([en(e,e.skipto),`
`]),r.add([vn(e,t,n),`
`]),r}case kt.ELSE:{const t=Qt(e,"");return e.lines.forEach(n=>t.add([Bt(n),`
`])),t}case kt.WHILE:{const t=Dn(),n=xn(t),r=Dn(),i=xn(r),s=Qt(e,[vn(e,t,n),`
`]);return s.add(["if (!",Xt(e,"if",or(e.words)),`)${Un}{ `,en(e,r),` }
`]),e.lines.forEach(o=>{switch(o.type){case kt.BREAK:o.skipto=r;break;case kt.CONTINUE:o.skipto=t;break}s.add([Bt(o),`
`])}),s.add([en(e,t),`
`]),s.add([vn(e,r,i),`
`]),s}case kt.REPEAT:{const t=Dn(),n=xn(t),r=Dn(),i=xn(r),s=Qt(e,[Xt(e,"repeatstart",[`${En.internal}`,...or(e.words)]),`;
`]);return s.add([vn(e,t,n),`
`]),s.add([["if (!",Xt(e,"repeat",[`${En.internal}`]),")"],[`${Un}{ `,en(e,r),` }
`]].flat()),En.internal+=1,e.lines.forEach(o=>{switch(o.type){case kt.BREAK:o.skipto=r;break;case kt.CONTINUE:o.skipto=t;break}s.add([Bt(o),`
`])}),s.add([en(e,t),`
`]),s.add([vn(e,r,i),`
`]),s}case kt.WAITFOR:{const t=Dn(),n=xn(t),r=Dn(),i=xn(r),s=Qt(e,[vn(e,t,n),`
`]);return s.add(["if (",Xt(e,"if",or(e.words)),`)${Un}{ `,en(e,r),` }
`]),s.add(Za()),s.add([en(e,t),`
`]),s.add([vn(e,r,i),`
`]),s}case kt.FOREACH:{const t=Dn(),n=xn(t),r=Dn(),i=xn(r),s=Qt(e,[Xt(e,"foreachstart",or(e.words)),`;
`]);return s.add([vn(e,t,n),`
`]),s.add(["if (!",Xt(e,"foreach",or(e.words)),`)${Un}{ `,en(e,r),` }
`]),e.lines.forEach(o=>{switch(o.type){case kt.BREAK:o.skipto=r;break;case kt.CONTINUE:o.skipto=t;break}s.add([Bt(o),`
`])}),s.add([en(e,t),`
`]),s.add([vn(e,r,i),`
`]),s}case kt.BREAK:return Qt(e,[en(e,e.skipto),`
`]);case kt.CONTINUE:return Qt(e,[en(e,e.skipto),`
`]);case kt.OR:return Xt(e,"or",e.items.map(Bt));case kt.AND:return Xt(e,"and",e.items.map(Bt));case kt.NOT:return Xt(e,"not",e.items.map(Bt));case kt.COMPARE:return pI(e);case kt.OPERATOR:return gI(e);case kt.EXPR:return Xt(e,"expr",e.words.map(Bt));default:return console.error("<unsupported node>",e.type,e),S0(e)}}function yI(e){return En.internal=0,En.labels={restart:[1]},En.labelIndex=2,{...Bt(e).toStringWithSourceMap({file:`${Qa}.map`}),...En}}const ec={HALT_AT_COUNT:64};function _I(e){return Le(e)?e.length>0?1:0:e??0}function Te(e){return`${e??""}`}function bI(e,t){var x,S;const n=Gb(t.labels??{});let r,i="",s,o=0;const a={},c={};let l=!1,u=0,f=0,d=(((x=t.errors)==null?void 0:x.length)??0)!==0;const h=[];let p={};function m(w){if(p[w]===void 0)for(let k=0;k<h.length;++k){const v=h[k].getcommand(w);v&&(p[w]=v)}return p[w]}function b(w,k){const v=m(w);if(!v)throw new Error(`unknown firmware command ${w}`);v(g,k)}const g={id(){return e},senderid(w=g.id()){return`vm:${w??g.id()}`},install(w){T(w)&&(p={},h.push(w))},set(w,k){const v=w.toLowerCase();for(let E=0;E<h.length;++E){const[N]=h[E].set(g,v,k);if(N)return k}return k},get(w){const k=w.toLowerCase();for(let v=0;v<h.length;++v){const[E,N]=h[v].get(g,k);if(E)return N}},timestamp(){return f},tick(w,k){f=k;const v=u%w===0;for(let E=0;E<h.length;++E)h[E].shouldtick(g,v);if(!g.shouldtick()||(++u,!v))return!1;o=0,l=!1;for(let E=0;E<h.length;++E)h[E].tick(g);try{const E=r==null?void 0:r.next();E!=null&&E.done&&(ne("chip","crash","generator logic unexpectedly exited"),d=!0)}catch(E){ne("chip","crash",E.message),d=!0}for(let E=0;E<h.length;++E)h[E].tock(g);return!0},isended(){return d===!0},shouldtick(){return d===!1||g.hm()!==0},shouldhalt(){return o++>ec.HALT_AT_COUNT},goto(w){b("send",[w])},hm(){var k;const w=(s==null?void 0:s.target)??"";return T(s==null?void 0:s.target)?((k=n[w])==null?void 0:k.find(v=>v>0))??0:0},yield(){l=!0},sy(){return l||g.shouldhalt()},emit(w,k,v){Vt.emit(w,g.senderid(),k,v)},send(w,k,v,E){Vt.emit(`${g.senderid(w)}:${k}`,e,v,E)},lock(w){i=w},unlock(){i=""},message(w){i&&w.sender!==i||(s=w)},zap(w){const k=n[w];if(k){const v=k.findIndex(E=>E>0);v>=0&&(k[v]*=-1)}},restore(w){const k=n[w];if(k)for(let v=0;v<k.length;v++)k[v]=Math.abs(k[v])},getcase(){const w=g.hm();return w&&T(s)&&(g.set("sender",s.sender),g.set("data",s.data),s.player&&g.set("player",s.player),s=void 0,l=!1,d=!1),w},endofprogram(){g.yield(),d=!0},stacktrace(w){const k=fw.parse(w),[v]=k.filter(E=>E.fileName===Qa);return{line:(v==null?void 0:v.lineNumber)??0,column:(v==null?void 0:v.columnNumber)??0}},text(w){return b("text",[w])},stat(...w){return b("stat",w)},hyperlink(...w){return b("hyperlink",w)},move(w,...k){const v=g.command("go",...k)&&w;return g.yield(),v?1:0},command(...w){if(w.length===0)return 0;const[k,...v]=w,E=m(Te(k));return T(E)?E(g,v):(b("send",[k,...v]),0)},if(...w){const[k,v]=it(st(g,w),0,[X.ANY]),E=_I(k);return E&&v<w.length&&g.command(...w.slice(v)),E?1:0},repeatstart(w,...k){const[v,E]=it(st(g,k),0,[X.NUMBER]);a[w]=v,c[w]=E<k.length?k.slice(E):void 0},repeat(w){const k=a[w]??0;a[w]=k-1;const v=k>0,E=c[w];return v&&E&&g.command(...E),v?1:0},foreachstart(...w){const[k,v,E,N]=it(st(g,w),0,[X.STRING,X.NUMBER,X.NUMBER,X.MAYBE_NUMBER]);let O=Math.min(v,E),W=Math.max(v,E);const Z=(N??0)||1;if(Z<0){const C=O;O=W,W=C}return g.set(k,O-Z),0},foreach(...w){const[k,v,E,N,O]=it(st(g,w),0,[X.STRING,X.NUMBER,X.NUMBER,X.MAYBE_NUMBER]);let W=Math.min(v,E),Z=Math.max(v,E);const C=(N??0)||1;if(C<0){const L=W;W=Z,Z=L}let A=g.get(k);!qt(A)||A<W||A>Z?A=W:A+=C;const y=A<=Z?1:0;return y&&(g.set(k,A),O<w.length&&g.command(...w.slice(O))),y},or(...w){let k=0;for(let v=0;v<w.length;){const[E,N]=it(st(g,w),v,[X.ANY]);if(k=E,k)break;v=N}return k},and(...w){let k=0;for(let v=0;v<w.length;){const[E,N]=it(st(g,w),v,[X.ANY]);if(k=E,!k)break;v=N}return k},not(...w){const[k]=it(st(g,w),0,[X.ANY]);return k?0:1},expr(...w){const[k]=it(st(g,w),0,[X.ANY]);return k},isEq(w,k){const[v]=it(st(g,[w]),0,[X.ANY]),[E]=it(st(g,[k]),0,[X.ANY]);return Wb(v,E)?1:0},isNotEq(w,k){const[v]=it(st(g,[w]),0,[X.ANY]),[E]=it(st(g,[k]),0,[X.ANY]);return v!==E?1:0},isLessThan(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return v<E?1:0},isGreaterThan(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return v>E?1:0},isLessThanOrEq(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return v<=E?1:0},isGreaterThanOrEq(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return v>=E?1:0},opPlus(w,k){const[v]=it(st(g,[w]),0,[X.ANY]),[E]=it(st(g,[k]),0,[X.ANY]);return v+E},opMinus(w,k){const[v]=it(st(g,[w]),0,[X.ANY]),[E]=it(st(g,[k]),0,[X.ANY]);return v-E},opPower(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return Math.pow(v,E)},opMultiply(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return v*E},opDivide(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return v/E},opModDivide(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return v%E},opFloorDivide(w,k){const[v]=it(st(g,[w]),0,[X.NUMBER]),[E]=it(st(g,[k]),0,[X.NUMBER]);return Math.floor(v/E)},opUniPlus(w){const[k]=it(st(g,[w]),0,[X.NUMBER]);return+k},opUniMinus(w){const[k]=it(st(g,[w]),0,[X.NUMBER]);return-k}};return r=(S=t.code)==null?void 0:S.call(t,g),g}function Ai(e){const t={},n={...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function wI(e){const t=vd[e];if(T(t))return t;const n=Td[e];if(T(n))return n;const r=ea[e];if(T(r))return r;const i=Bd[e];if(T(i))return i}const EI=Ai({get(e,t){const n=wI(t);return T(n)?[!0,n]:[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("clear",(e,t)=>{const n=Te(t[0]);return e.set(n,0),0}).command("set",(e,t)=>{const[n,r]=it(st(e,t),0,[X.STRING,X.ANY]);return e.set(n,r),0}).command("take",(e,t)=>{const[n,r,i]=it(st(e,t),0,[X.STRING,X.MAYBE_NUMBER]),s=e.get(n),o=r??1;if(!qt(s))return 1;const a=s-o;return a<0?(i<t.length&&e.command(...t.slice(i)),1):(e.set(n,a),0)}).command("give",(e,t)=>{const[n,r,i]=it(st(e,t),0,[X.STRING,X.MAYBE_NUMBER]),s=e.get(n),o=qt(s)?s:0,a=r??1;if(!qt(a))return 0;const c=s===void 0?1:0;return c&&i<t.length&&e.command(...t.slice(i)),e.set(n,o+a),c}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Te(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Te(t[0])),0)),xI=Ai({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("play",(e,t)=>{const n=st(e,t),[r]=it(n,0,[X.MAYBE_STRING]),i=r??"",s=e.get(i);return Ef("audio",-1,Lt(s)?s:i),0}).command("bgplay",(e,t)=>{const n=st(e,t),[r]=it(n,0,[X.MAYBE_STRING]),i=r??"",s=e.get(i);return Ef("audio",1,Lt(s)?s:i),0});function so(){return so=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},so.apply(this,arguments)}function vI(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Xu(e,t)}function Xu(e,t){return Xu=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Xu(e,t)}function kI(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var T0=function(){function e(n){this.trigger=n,this.observing=new Map}var t=e.prototype;return t.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},t.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[Ee].connections.iterate.delete(r),i.byKey.forEach(function(o){s[Ee].connections.byKey.get(o).delete(r)})}),this.observing.clear()},e}(),Ti=[],nc=function(e){vI(t,e);function t(r,i,s){var o;if(o=e.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){Ti.push(kI(o));try{o.func()}finally{Ti.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=t.prototype;return n._trigger=function(){if(Ti.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},t}(T0);function R0(){return!!Ti.length}function O0(){return Ti.length?Ti[Ti.length-1]:void 0}function SI(e,t,n){var r=so({name:"unnamed",fireImmediately:!0},n),i=new nc(e,r,t);return i}var rc=0;function I0(){return rc>0}function Ju(e){rc++;try{return e()}finally{rc--,rc===0&&TI()}}var Zu=!1;function C0(){return Zu}function N0(e){Zu=!0;try{e()}finally{Zu=!1}}function AI(e){return function(){return N0(e)}}var Qu=[];function TI(){var e=[].concat(Qu);Qu=[],L0(e)}function L0(e){var t=new Set;e.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[Ee].connections.iterate.forEach(function(i){t.add(i)}),(r=n.observable[Ee].connections.byKey.get(n.key))==null||r.forEach(function(i){t.add(i)})}),t.forEach(function(n){n.trigger()})}function ic(e){if(I0()){Qu.push(e);return}L0([e])}function M0(e,t){if(e.type==="iterate")e.observable[Ee].connections.iterate.add(t);else{var n=e.observable[Ee].connections.byKey.get(e.key);n||(n=new Set,e.observable[Ee].connections.byKey.set(e.key,n)),n.add(t)}}function sc(e,t){if(!C0()){var n=O0();n&&(M0(e,n),n.registerConnection(e)),t&&(M0(e,t),t.registerConnection(e))}}var th=Symbol("$skipreactive"),Ee=Symbol("$reactive"),kn=Symbol("$reactiveproxy");function oo(e,t){return!!(e&&e[kn]&&e[kn].implicitObserver===t)}function eh(e){return e[th]=!0,e}function U0(e){return!!(e&&!oo(e)&&e[Ee])}function nh(e,t,n){if(n===void 0&&(n=!1),e[th]||oo(e,t))return e;var r=RI(e,n);if(!t)return r;var i=r[Ee].proxiesWithImplicitObserver.get(t);if(!i){var s={implicitObserver:t};Object.setPrototypeOf(s,D0),i=new Proxy(r[Ee].raw,s),r[Ee].proxiesWithImplicitObserver.set(t,i)}return i}var ao=nh;function RI(e,t){if(t===void 0&&(t=!1),oo(e))return e;if(U0(e))return e[Ee].proxy;if(e[Ee]||e[kn])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:e,proxiesWithImplicitObserver:new Map,shallow:t};Object.defineProperty(e,Ee,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(e,D0);return n.proxy=r,r}var D0={has:function(t,n){var r=Reflect.has(t,n);return typeof n=="symbol"||sc({observable:t,key:n,type:"has"},this.implicitObserver),r},get:function(t,n,r){if(n===kn)return{implicitObserver:this.implicitObserver};var i=Reflect.get(t,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(t)?sc({observable:t,type:"iterate"},this.implicitObserver):sc({observable:t,key:n,type:"get"},this.implicitObserver),U0(i))return nh(i,this.implicitObserver);if(t[Ee].shallow)return i;if(typeof i=="object"&&i!==null&&!oo(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(t,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(R0()||this.implicitObserver))return nh(i,this.implicitObserver)}return i},ownKeys:function(t){return sc({observable:t,type:"iterate"},this.implicitObserver),Reflect.ownKeys(t)},set:function(t,n,r,i){return Ju(function(){if(typeof n=="symbol")return Reflect.set(t,n,r,i);var s=Object.hasOwnProperty.call(t,n),o=Reflect.get(t,n,i),a=Reflect.set(t,n,r,i);if(!s)ic({observable:t,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(t)){if(!(o<r))for(var c=r+1;c<=o;c++)ic({observable:t,key:""+(c-1),oldValue:void 0,type:"delete"})}else ic({observable:t,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(t,n){return Ju(function(){if(typeof n=="symbol")return Reflect.deleteProperty(t,n);var r=Object.hasOwnProperty.call(t,n),i=Reflect.get(t,n),s=Reflect.deleteProperty(t,n);return r&&ic({observable:t,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(t){throw new Error("Dynamic observable objects cannot be frozen")}};function OI(e,t){var n=so({name:"unnamed",fireImmediately:!0},t),r=new nc(e,n);return r}function II(e,t,n){var r=so({name:"unnamed",fireImmediately:!0},n),i=new nc(function(){e(t)},r);return t=ao(t,i),r.fireImmediately&&i.trigger(),i}var P0=function(){function e(){this._observable=ao({_key:1})}var t=e.prototype;return t.reportObserved=function(r){return ao(this._observable,r)._key},t.reportChanged=function(){this._observable._key++},e}();function CI(e,t,n){return new P0}var NI=Object.freeze({__proto__:null,$reactive:Ee,$reactiveproxy:kn,$skipreactive:th,Atom:P0,Observer:T0,Reaction:nc,autorun:OI,autorunAsync:II,createAtom:CI,hasRunningReaction:R0,isActionRunning:I0,isReactive:oo,isTrackingDisabled:C0,markRaw:eh,reaction:SI,reactive:ao,runInAction:Ju,runningReaction:O0,untracked:N0,untrackedCB:AI});const Pn=()=>new Map,rh=e=>{const t=Pn();return e.forEach((n,r)=>{t.set(r,n)}),t},Xr=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},LI=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},MI=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},cs=()=>new Set,ih=e=>e[e.length-1],UI=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Jr=Array.from,DI=Array.isArray;class PI{constructor(){this._observers=Pn()}on(t,n){return Xr(this._observers,t,cs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Jr((this._observers.get(t)||Pn()).values()).forEach(r=>r(...n))}destroy(){this._observers=Pn()}}const Zr=Math.floor,oc=Math.abs,B0=(e,t)=>e<t?e:t,Ri=(e,t)=>e>t?e:t,F0=e=>e!==0?e<0:1/e<0,z0=1,$0=2,sh=4,oh=8,co=32,Rr=64,an=128,ac=31,ah=63,Oi=127,BI=2147483647,j0=Number.MAX_SAFE_INTEGER,FI=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Zr(e)===e),zI=e=>e.toLowerCase(),$I=/^\s*/g,jI=e=>e.replace($I,""),WI=/([A-Z])/g,W0=(e,t)=>jI(e.replace(WI,n=>`${t}${zI(n)}`)),GI=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},lo=typeof TextEncoder<"u"?new TextEncoder:null,KI=lo?e=>lo.encode(e):GI;let uo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});uo&&uo.decode(new Uint8Array).length===1&&(uo=null);class ho{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Qr=()=>new ho,HI=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Bn=e=>{const t=new Uint8Array(HI(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},VI=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Ri(n,t)*2),e.cpos=0)},Re=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},ch=Re,bt=(e,t)=>{for(;t>Oi;)Re(e,an|Oi&t),t=Zr(t/128);Re(e,Oi&t)},lh=(e,t)=>{const n=F0(t);for(n&&(t=-t),Re(e,(t>ah?an:0)|(n?Rr:0)|ah&t),t=Zr(t/64);t>0;)Re(e,(t>Oi?an:0)|Oi&t),t=Zr(t/128)},uh=new Uint8Array(3e4),YI=uh.length/3,qI=(e,t)=>{if(t.length<YI){const n=lo.encodeInto(t,uh).written||0;bt(e,n);for(let r=0;r<n;r++)Re(e,uh[r])}else De(e,KI(t))},XI=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;bt(e,r);for(let i=0;i<r;i++)Re(e,n.codePointAt(i))},ls=lo&&lo.encodeInto?qI:XI,cc=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=B0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Ri(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},De=(e,t)=>{bt(e,t.byteLength),cc(e,t)},hh=(e,t)=>{VI(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},JI=(e,t)=>hh(e,4).setFloat32(0,t,!1),ZI=(e,t)=>hh(e,8).setFloat64(0,t,!1),QI=(e,t)=>hh(e,8).setBigInt64(0,t,!1),G0=new DataView(new ArrayBuffer(4)),tC=e=>(G0.setFloat32(0,e),G0.getFloat32(0)===e),fo=(e,t)=>{switch(typeof t){case"string":Re(e,119),ls(e,t);break;case"number":FI(t)&&oc(t)<=BI?(Re(e,125),lh(e,t)):tC(t)?(Re(e,124),JI(e,t)):(Re(e,123),ZI(e,t));break;case"bigint":Re(e,122),QI(e,t);break;case"object":if(t===null)Re(e,126);else if(DI(t)){Re(e,117),bt(e,t.length);for(let n=0;n<t.length;n++)fo(e,t[n])}else if(t instanceof Uint8Array)Re(e,116),De(e,t);else{Re(e,118);const n=Object.keys(t);bt(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];ls(e,i),fo(e,t[i])}}break;case"boolean":Re(e,t?120:121);break;default:Re(e,127)}};class K0 extends ho{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&bt(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const H0=e=>{e.count>0&&(lh(e.encoder,e.count===1?e.s:-e.s),e.count>1&&bt(e.encoder,e.count-2))};class lc{constructor(){this.encoder=new ho,this.s=0,this.count=0}write(t){this.s===t?this.count++:(H0(this),this.count=1,this.s=t)}toUint8Array(){return H0(this),Bn(this.encoder)}}const V0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);lh(e.encoder,t),e.count>1&&bt(e.encoder,e.count-2)}};class fh{constructor(){this.encoder=new ho,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(V0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return V0(this),Bn(this.encoder)}}class eC{constructor(){this.sarr=[],this.s="",this.lensE=new lc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new ho;return this.sarr.push(this.s),this.s="",ls(t,this.sarr.join("")),cc(t,this.lensE.toUint8Array()),Bn(t)}}const ti=e=>new Error(e),ar=()=>{throw ti("Method unimplemented")},cr=()=>{throw ti("Unexpected case")},Y0=ti("Unexpected end of array"),q0=ti("Integer out of Range");class uc{constructor(t){this.arr=t,this.pos=0}}const Ii=e=>new uc(e),nC=e=>e.pos!==e.arr.length,rC=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Ke=e=>rC(e,wt(e)),us=e=>e.arr[e.pos++],wt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&Oi)*n,n*=128,i<an)return t;if(t>j0)throw q0}throw Y0},dh=e=>{let t=e.arr[e.pos++],n=t&ah,r=64;const i=(t&Rr)>0?-1:1;if(!(t&an))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&Oi)*r,r*=128,t<an)return i*n;if(n>j0)throw q0}throw Y0},hs=uo?e=>uo.decode(Ke(e)):e=>{let t=wt(e);if(t===0)return"";{let n=String.fromCodePoint(us(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(us(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},ph=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},iC=[e=>{},e=>null,dh,e=>ph(e,4).getFloat32(0,!1),e=>ph(e,8).getFloat64(0,!1),e=>ph(e,8).getBigInt64(0,!1),e=>!1,e=>!0,hs,e=>{const t=wt(e),n={};for(let r=0;r<t;r++){const i=hs(e);n[i]=po(e)}return n},e=>{const t=wt(e),n=[];for(let r=0;r<t;r++)n.push(po(e));return n},Ke],po=e=>iC[127-us(e)](e);class X0 extends uc{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),nC(this)?this.count=wt(this)+1:this.count=-1),this.count--,this.s}}class hc extends uc{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=dh(this);const t=F0(this.s);this.count=1,t&&(this.s=-this.s,this.count=wt(this)+2)}return this.count--,this.s}}class mh extends uc{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=dh(this),n=t&1;this.diff=Zr(t/2),this.count=1,n&&(this.count=wt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class sC{constructor(t){this.decoder=new hc(t),this.str=hs(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const oC=crypto.getRandomValues.bind(crypto),J0=()=>oC(new Uint32Array(1))[0],aC="10000000-1000-4000-8000"+-1e11,cC=()=>aC.replace(/[018]/g,e=>(e^J0()&15>>e/4).toString(16)),Z0=e=>new Promise(e);Promise.all.bind(Promise);const Q0=e=>e===void 0?null:e;class lC{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let ty=new lC,uC=!0;try{typeof localStorage<"u"&&localStorage&&(ty=localStorage,uC=!1)}catch{}const hC=ty,fC=Object.assign,dC=Object.keys,pC=(e,t)=>{for(const n in e)t(e[n],n)},ey=e=>dC(e).length,mC=e=>{for(const t in e)return!1;return!0},gC=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},yC=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),_C=(e,t)=>e===t||ey(e)===ey(t)&&gC(e,(n,r)=>(n!==void 0||yC(t,r))&&t[r]===n),bC=Object.freeze,ny=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&ny(e[t])}return bC(e)},gh=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&gh(e,t,n+1)}},wC=e=>e,EC=(e,t)=>t.includes(e);var ry={};const mo=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let lr;const xC=()=>{if(lr===void 0)if(mo){lr=Pn();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&lr.set(t,""),t=r):t!==null&&(lr.set(t,r),t=null)}t!==null&&lr.set(t,"")}else typeof location=="object"?(lr=Pn(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");lr.set(`--${W0(t,"-")}`,n),lr.set(`-${W0(t,"-")}`,n)}})):lr=Pn();return lr},yh=e=>xC().has(e),fc=e=>Q0(mo?ry[e.toUpperCase().replaceAll("-","_")]:hC.getItem(e)),iy=e=>yh("--"+e)||fc(e)!==null;iy("production");const vC=mo&&EC(ry.FORCE_COLOR,["true","1","2"])||!yh("--no-colors")&&!iy("no-color")&&(!mo||process.stdout.isTTY)&&(!mo||yh("--color")||fc("COLORTERM")!==null||(fc("TERM")||"").includes("color")),kC=e=>new Uint8Array(e),SC=e=>{const t=kC(e.byteLength);return t.set(e),t};class AC{constructor(t,n){this.left=t,this.right=n}}const Or=(e,t)=>new AC(e,t);typeof DOMParser<"u"&&new DOMParser;const TC=e=>LI(e,(t,n)=>`${n}:${t};`).join(""),Ir=Symbol,sy=Ir(),oy=Ir(),RC=Ir(),OC=Ir(),IC=Ir(),ay=Ir(),CC=Ir(),_h=Ir(),NC=Ir(),LC=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},MC={[sy]:Or("font-weight","bold"),[oy]:Or("font-weight","normal"),[RC]:Or("color","blue"),[IC]:Or("color","green"),[OC]:Or("color","grey"),[ay]:Or("color","red"),[CC]:Or("color","purple"),[_h]:Or("color","orange"),[NC]:Or("color","black")},cy=vC?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=Pn();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=MC[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=TC(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:LC,UC=(...e)=>{console.log(...cy(e)),ly.forEach(t=>t.print(e))},DC=(...e)=>{console.warn(...cy(e)),e.unshift(_h),ly.forEach(t=>t.print(e))},ly=cs(),uy=e=>({[Symbol.iterator](){return this},next:e}),PC=(e,t)=>uy(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),bh=(e,t)=>uy(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class wh{constructor(t,n){this.clock=t,this.len=n}}class go{constructor(){this.clients=new Map}}const hy=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Oy(e,s,a.clock,a.len,n)}}),BC=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Zr((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},fy=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&BC(n,t.clock)!==null},Eh=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Ri(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},FC=e=>{const t=new go;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)UI(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Eh(t),t},dc=(e,t,n,r)=>{Xr(e.clients,t,()=>[]).push(new wh(n,r))},zC=()=>new go,$C=e=>{const t=zC();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new wh(a,c))}}i.length>0&&t.clients.set(r,i)}),t},fs=(e,t)=>{bt(e.restEncoder,t.clients.size),Jr(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),bt(e.restEncoder,n);const i=r.length;bt(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},xh=e=>{const t=new go,n=wt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=wt(e.restDecoder),s=wt(e.restDecoder);if(s>0){const o=Xr(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new wh(e.readDsClock(),e.readDsLen()))}}return t},dy=(e,t,n)=>{const r=new go,i=wt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=wt(e.restDecoder),a=wt(e.restDecoder),c=n.clients.get(o)||[],l=Oe(n,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&dc(r,o,l,d-l);let h=Fn(c,f),p=c[h];for(!p.deleted&&p.id.clock<f&&(c.splice(h+1,0,Ac(t,p,f-p.id.clock)),h++);h<c.length&&(p=c[h++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(h,0,Ac(t,p,d-p.id.clock)),p.delete(t))}else dc(r,o,f,d-f)}}if(r.clients.size>0){const s=new Ci;return bt(s.restEncoder,0),fs(s,r),s.toUint8Array()}return null},py=J0;class Cr extends PI{constructor({guid:t=cC(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=py(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Ay,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Z0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Z0(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Kt(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Jr(this.subdocs).map(t=>t.guid))}transact(t,n=null){return Kt(this,t,n)}get(t,n=ae){const r=Xr(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==ae&&i!==n)if(i===ae){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,ur)}getText(t=""){return this.get(t,zn)}getMap(t=""){return this.get(t,hr)}getXmlElement(t=""){return this.get(t,Nr)}getXmlFragment(t=""){return this.get(t,fr)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Jr(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Cr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,Kt(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class my{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return wt(this.restDecoder)}readDsLen(){return wt(this.restDecoder)}}class gy extends my{readLeftID(){return Ot(wt(this.restDecoder),wt(this.restDecoder))}readRightID(){return Ot(wt(this.restDecoder),wt(this.restDecoder))}readClient(){return wt(this.restDecoder)}readInfo(){return us(this.restDecoder)}readString(){return hs(this.restDecoder)}readParentInfo(){return wt(this.restDecoder)===1}readTypeRef(){return wt(this.restDecoder)}readLen(){return wt(this.restDecoder)}readAny(){return po(this.restDecoder)}readBuf(){return SC(Ke(this.restDecoder))}readJSON(){return JSON.parse(hs(this.restDecoder))}readKey(){return hs(this.restDecoder)}}class jC{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=wt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=wt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class ds extends jC{constructor(t){super(t),this.keys=[],wt(t),this.keyClockDecoder=new mh(Ke(t)),this.clientDecoder=new hc(Ke(t)),this.leftClockDecoder=new mh(Ke(t)),this.rightClockDecoder=new mh(Ke(t)),this.infoDecoder=new X0(Ke(t),us),this.stringDecoder=new sC(Ke(t)),this.parentInfoDecoder=new X0(Ke(t),us),this.typeRefDecoder=new hc(Ke(t)),this.lenDecoder=new hc(Ke(t))}readLeftID(){return new ps(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ps(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return po(this.restDecoder)}readBuf(){return Ke(this.restDecoder)}readJSON(){return po(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class yy{constructor(){this.restEncoder=Qr()}toUint8Array(){return Bn(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){bt(this.restEncoder,t)}writeDsLen(t){bt(this.restEncoder,t)}}class yo extends yy{writeLeftID(t){bt(this.restEncoder,t.client),bt(this.restEncoder,t.clock)}writeRightID(t){bt(this.restEncoder,t.client),bt(this.restEncoder,t.clock)}writeClient(t){bt(this.restEncoder,t)}writeInfo(t){ch(this.restEncoder,t)}writeString(t){ls(this.restEncoder,t)}writeParentInfo(t){bt(this.restEncoder,t?1:0)}writeTypeRef(t){bt(this.restEncoder,t)}writeLen(t){bt(this.restEncoder,t)}writeAny(t){fo(this.restEncoder,t)}writeBuf(t){De(this.restEncoder,t)}writeJSON(t){ls(this.restEncoder,JSON.stringify(t))}writeKey(t){ls(this.restEncoder,t)}}class _y{constructor(){this.restEncoder=Qr(),this.dsCurrVal=0}toUint8Array(){return Bn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,bt(this.restEncoder,n)}writeDsLen(t){t===0&&cr(),bt(this.restEncoder,t-1),this.dsCurrVal+=t}}class Ci extends _y{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new fh,this.clientEncoder=new lc,this.leftClockEncoder=new fh,this.rightClockEncoder=new fh,this.infoEncoder=new K0(ch),this.stringEncoder=new eC,this.parentInfoEncoder=new K0(ch),this.typeRefEncoder=new lc,this.lenEncoder=new lc}toUint8Array(){const t=Qr();return bt(t,0),De(t,this.keyClockEncoder.toUint8Array()),De(t,this.clientEncoder.toUint8Array()),De(t,this.leftClockEncoder.toUint8Array()),De(t,this.rightClockEncoder.toUint8Array()),De(t,Bn(this.infoEncoder)),De(t,this.stringEncoder.toUint8Array()),De(t,Bn(this.parentInfoEncoder)),De(t,this.typeRefEncoder.toUint8Array()),De(t,this.lenEncoder.toUint8Array()),cc(t,Bn(this.restEncoder)),Bn(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){fo(this.restEncoder,t)}writeBuf(t){De(this.restEncoder,t)}writeJSON(t){fo(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const WC=(e,t,n,r)=>{r=Ri(r,t[0].id.clock);const i=Fn(t,r);bt(e.restEncoder,t.length-i),e.writeClient(n),bt(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},vh=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Oe(t,s)>i&&r.set(s,i)}),mc(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),bt(e.restEncoder,r.size),Jr(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{WC(e,t.clients.get(i),i,s)})},GC=(e,t)=>{const n=Pn(),r=wt(e.restDecoder);for(let i=0;i<r;i++){const s=wt(e.restDecoder),o=new Array(s),a=e.readClient();let c=wt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(ac&u){case 0:{const f=e.readLen();o[l]=new cn(Ot(a,c),f),c+=f;break}case 10:{const f=wt(e.restDecoder);o[l]=new Sn(Ot(a,c),f),c+=f;break}default:{const f=(u&(Rr|an))===0,d=new ve(Ot(a,c),null,(u&an)===an?e.readLeftID():null,null,(u&Rr)===Rr?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&co)===co?e.readString():null,t_(e,u));o[l]=d,c+=d.length}}}}return n},KC=(e,t,n)=>{const r=[];let i=Jr(n.keys()).sort((h,p)=>h-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new Ay,c=new Map,l=(h,p)=>{const m=c.get(h);(m==null||m>p)&&c.set(h,p)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const p=h.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[h]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(u.constructor!==Sn){const p=Xr(f,u.id.client,()=>Oe(t,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(e,t);if(m!==null){r.push(u);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,Oe(t,m)),d();else{u=b.refs[b.i++];continue}}else(p===0||p<u.length)&&(u.integrate(e,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new Ci;return vh(h,a,new Map),bt(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},HC=(e,t)=>vh(e,t.doc.store,t.beforeState),VC=(e,t,n,r=new ds(e))=>Kt(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=GC(r,o),l=KC(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<Oe(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const p=u.missing.get(d);(p==null||p>h)&&u.missing.set(d,h)}u.update=yc([u.update,l.update])}}else a.pendingStructs=l;const f=dy(r,i,a);if(a.pendingDs){const d=new ds(Ii(a.pendingDs));wt(d.restDecoder);const h=dy(d,i,a);f&&h?a.pendingDs=yc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,by(i.doc,d)}},n,!1),by=(e,t,n,r=ds)=>{const i=Ii(t);VC(i,e,n,new r(i))},YC=(e,t,n)=>by(e,t,n,gy),qC=(e,t,n=new Map)=>{vh(e,t.store,n),fs(e,$C(t.store))},XC=(e,t=new Uint8Array([0]),n=new Ci)=>{const r=wy(t);qC(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(hN(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===yo)return lN(i.map((s,o)=>o===0?s:dN(s)));if(n.constructor===Ci)return yc(i)}return i[0]},JC=(e,t)=>XC(e,t,new yo),ZC=e=>{const t=new Map,n=wt(e.restDecoder);for(let r=0;r<n;r++){const i=wt(e.restDecoder),s=wt(e.restDecoder);t.set(i,s)}return t},wy=e=>ZC(new my(Ii(e))),Ey=(e,t)=>(bt(e.restEncoder,t.size),Jr(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{bt(e.restEncoder,n),bt(e.restEncoder,r)}),e),QC=(e,t)=>Ey(e,mc(t.store)),tN=(e,t=new _y)=>(e instanceof Map?Ey(t,e):QC(t,e),t.toUint8Array()),eN=e=>tN(e,new yy);class nN{constructor(){this.l=[]}}const xy=()=>new nN,vy=(e,t)=>e.l.push(t),ky=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Sy=(e,t,n)=>gh(e.l,[t,n]);class ps{constructor(t,n){this.client=t,this.clock=n}}const pc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Ot=(e,t)=>new ps(e,t),rN=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw cr()},ms=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!fy(t.ds,e.id),kh=(e,t)=>{const n=Xr(e.meta,kh,cs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Oe(r,s)&&ei(e,Ot(s,i))}),hy(e,t.ds,i=>{}),n.add(t))};class Ay{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const mc=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Oe=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Ty=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw cr()}n.push(t)},Fn=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Zr(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Zr((n+r)/2)}throw cr()},Sh=(e,t)=>{const n=e.clients.get(t.client);return n[Fn(n,t.clock)]},Ah=(e,t,n)=>{const r=Fn(t,n),i=t[r];return i.id.clock<n&&i instanceof ve?(t.splice(r+1,0,Ac(e,i,n-i.id.clock)),r+1):r},ei=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Ah(e,n,t.clock)]},Ry=(e,t,n)=>{const r=t.clients.get(n.client),i=Fn(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==cn&&r.splice(i+1,0,Ac(e,s,n.clock-s.id.clock+1)),s},iN=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Fn(r,t.id.clock)]=n},Oy=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Ah(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Ah(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class sN{constructor(t,n,r){this.doc=t,this.deleteSet=new go,this.beforeState=mc(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Iy=(e,t)=>t.deleteSet.clients.size===0&&!MI(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Eh(t.deleteSet),HC(e,t),fs(e,t.deleteSet),!0),Cy=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Xr(e.changed,t,cs).add(n)},gc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ve&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},oN=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Fn(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof ve&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},aN=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=B0(i.length-1,1+Fn(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+gc(i,c)}})},Ny=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Eh(s),n.afterState=mc(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),Sy(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),gh(a,[]),n._needFormattingCleanup&&TN(n)}finally{r.gc&&oN(s,i,r.gcFilter),aN(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=Ri(Fn(h,d),1);for(let m=h.length-1;m>=p;)m-=1+gc(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=Fn(h,d);p+1<h.length&&gc(h,p+1)>1||p>0&&gc(h,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(UC(_h,sy,"[yjs] ",oy,ay,"Changed the client-id because another client seems to be using it."),r.clientID=py()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new yo;Iy(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Ci;Iy(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Ny(e,t+1)}}},Kt=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new sN(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Ny(i,0)}}return o};function*cN(e){const t=wt(e.restDecoder);for(let n=0;n<t;n++){const r=wt(e.restDecoder),i=e.readClient();let s=wt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=wt(e.restDecoder);yield new Sn(Ot(i,s),c),s+=c}else if(ac&a){const c=(a&(Rr|an))===0,l=new ve(Ot(i,s),null,(a&an)===an?e.readLeftID():null,null,(a&Rr)===Rr?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&co)===co?e.readString():null,t_(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new cn(Ot(i,s),c),s+=c}}}}class Th{constructor(t,n){this.gen=cN(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Sn);return this.curr}}class Rh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const lN=e=>yc(e,gy,yo),uN=(e,t)=>{if(e.constructor===cn){const{client:n,clock:r}=e.id;return new cn(Ot(n,r+t),e.length-t)}else if(e.constructor===Sn){const{client:n,clock:r}=e.id;return new Sn(Ot(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new ve(Ot(r,i+t),null,Ot(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},yc=(e,t=ds,n=Ci)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Ii(u)));let i=r.map(u=>new Th(u,!0)),s=null;const o=new n,a=new Rh(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const p=d.curr.id.clock-h.curr.id.clock;return p===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===Sn?1:-1:p}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)ni(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Sn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{ni(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Sn(Ot(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===Sn?s.struct.length-=p:d=uN(d,p)),s.struct.mergeWith(d)||(ni(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Sn;d=u.next())ni(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(ni(a,s.struct,s.offset),s=null),Oh(a);const c=r.map(u=>xh(u)),l=FC(c);return fs(o,l),o.toUint8Array()},hN=(e,t,n=ds,r=Ci)=>{const i=wy(t),s=new r,o=new Rh(s),a=new n(Ii(e)),c=new Th(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===Sn){c.next();continue}if(u.id.clock+u.length>d)for(ni(o,u,Ri(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)ni(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}Oh(o);const l=xh(a);return fs(s,l),s.toUint8Array()},Ly=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Bn(e.encoder.restEncoder)}),e.encoder.restEncoder=Qr(),e.written=0)},ni=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Ly(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),bt(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Oh=e=>{Ly(e);const t=e.encoder.restEncoder;bt(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];bt(t,r.written),cc(t,r.restEncoder)}},fN=(e,t,n,r)=>{const i=new n(Ii(e)),s=new Th(i,!1),o=new r,a=new Rh(o);for(let l=s.curr;l!==null;l=s.next())ni(a,t(l),0);Oh(a);const c=xh(i);return fs(o,c),o.toUint8Array()},dN=e=>fN(e,wC,ds,yo),My="You must not compute changes after the event-handler fired.";class _c{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=pN(this.currentTarget,this.target))}deletes(t){return fy(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ti(My);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=ih(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=ih(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=ih(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw ti(My);const n=this.target,r=cs(),i=cs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const pN=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},Pe=()=>{DC("Invalid access: Add Yjs type to a document before reading data.")},Uy=80;let Ih=0;class mN{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Ih++}}const gN=e=>{e.timestamp=Ih++},Dy=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Ih++},yN=(e,t,n)=>{if(e.length>=Uy){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Dy(r,t,n),r}else{const r=new mN(t,n);return e.push(r),r}},bc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>oc(t-s.index)<oc(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,gN(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&oc(n.index-i)<r.parent.length/Uy?(Dy(n,r,i),n):yN(e._searchMarker,r,i)},_o=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Ri(t,i.index+n))}},wc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Xr(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Sy(r._eH,n,t)};class ae{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=xy(),this._dEH=xy(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw ar()}clone(){throw ar()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){vy(this._eH,t)}observeDeep(t){vy(this._dEH,t)}unobserve(t){ky(this._eH,t)}unobserveDeep(t){ky(this._dEH,t)}toJSON(){}}const Py=(e,t,n)=>{e.doc??Pe(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},By=e=>{e.doc??Pe();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},bo=(e,t)=>{let n=0,r=e._start;for(e.doc??Pe();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Fy=(e,t)=>{const n=[];return bo(e,(r,i)=>{n.push(t(r,i,e))}),n},_N=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},zy=(e,t)=>{e.doc??Pe();const n=bc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Ec=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new ve(Ot(o,Oe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Mi(l)),i.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new ve(Ot(o,Oe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new wo(new Uint8Array(f))),i.integrate(e,0);break;case Cr:i=new ve(Ot(o,Oe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new xo(f)),i.integrate(e,0);break;default:if(f instanceof ae)i=new ve(Ot(o,Oe(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Lr(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},$y=()=>ti("Length exceeded!"),jy=(e,t,n,r)=>{if(n>t._length)throw $y();if(n===0)return t._searchMarker&&_o(t._searchMarker,n,r.length),Ec(e,t,null,r);const i=n,s=bc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&ei(e,Ot(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&_o(t._searchMarker,i,r.length),Ec(e,t,o,r)},bN=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Ec(e,t,i,n)},Wy=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=bc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&ei(e,Ot(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&ei(e,Ot(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw $y();t._searchMarker&&_o(t._searchMarker,i,-s+r)},xc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Ch=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new Mi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Mi([r]);break;case Uint8Array:a=new wo(r);break;case Cr:a=new xo(r);break;default:if(r instanceof ae)a=new Lr(r);else throw new Error("Unexpected content type")}new ve(Ot(o,Oe(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Nh=(e,t)=>{e.doc??Pe();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Gy=e=>{const t={};return e.doc??Pe(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Ky=(e,t)=>{e.doc??Pe();const n=e._map.get(t);return n!==void 0&&!n.deleted},wN=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&ms(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},vc=e=>(e.doc??Pe(),PC(e._map.entries(),t=>!t[1].deleted));class EN extends _c{}class ur extends ae{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new ur;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ur}clone(){const t=new ur;return t.insert(0,this.toArray().map(n=>n instanceof ae?n.clone():n)),t}get length(){return this.doc??Pe(),this._length}_callObserver(t,n){super._callObserver(t,n),wc(this,t,new EN(this,t))}insert(t,n){this.doc!==null?Kt(this.doc,r=>{jy(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?Kt(this.doc,n=>{bN(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?Kt(this.doc,r=>{Wy(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return zy(this,t)}toArray(){return By(this)}slice(t=0,n=this.length){return Py(this,t,n)}toJSON(){return this.map(t=>t instanceof ae?t.toJSON():t)}map(t){return Fy(this,t)}forEach(t){bo(this,t)}[Symbol.iterator](){return _N(this)}_write(t){t.writeTypeRef(HN)}}const xN=e=>new ur;class vN extends _c{constructor(t,n,r){super(t,n),this.keysChanged=r}}class hr extends ae{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new hr}clone(){const t=new hr;return this.forEach((n,r)=>{t.set(r,n instanceof ae?n.clone():n)}),t}_callObserver(t,n){wc(this,t,new vN(this,t,n))}toJSON(){this.doc??Pe();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof ae?i.toJSON():i}}),t}get size(){return[...vc(this)].length}keys(){return bh(vc(this),t=>t[0])}values(){return bh(vc(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return bh(vc(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??Pe(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Kt(this.doc,n=>{xc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?Kt(this.doc,r=>{Ch(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Nh(this,t)}has(t){return Ky(this,t)}clear(){this.doc!==null?Kt(this.doc,t=>{this.forEach(function(n,r,i){xc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(VN)}}const kN=e=>new hr,ri=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&_C(e,t);class Lh{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&cr(),this.right.content.constructor){case xe:this.right.deleted||gs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Hy=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case xe:t.right.deleted||gs(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&ei(e,Ot(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},kc=(e,t,n,r)=>{const i=new Map,s=r?bc(t,n):null;if(s){const o=new Lh(s.p.left,s.p,s.index,i);return Hy(e,o,n-s.index)}else{const o=new Lh(null,t._start,0,i);return Hy(e,o,n)}},Vy=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===xe&&ri(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new ve(Ot(s,Oe(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new xe(a,o));u.integrate(e,0),n.right=u,n.forward()})},gs=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Yy=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===xe&&ri(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},qy=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!ri(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new ve(Ot(s,Oe(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new xe(a,c)),n.right.integrate(e,0),n.forward()}}return o},Mh=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;Yy(n,i);const a=qy(e,t,n,i),c=r.constructor===String?new dr(r):r instanceof ae?new Lr(r):new Li(r);let{left:l,right:u,index:f}=n;t._searchMarker&&_o(t._searchMarker,n.index,c.getLength()),u=new ve(Ot(o,Oe(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=f,n.forward(),Vy(e,t,n,a)},Xy=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Yy(n,i);const a=qy(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===xe));){if(!n.right.deleted)switch(n.right.content.constructor){case xe:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(ri(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&ei(e,Ot(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ve(Ot(o,Oe(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new dr(c)),n.right.integrate(e,0),n.forward()}Vy(e,t,n,a)},Jy=(e,t,n,r,i)=>{let s=t;const o=Pn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===xe){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case xe:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&gs(i,l);break}}}t=t.right}return a},SN=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===xe){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},AN=e=>{let t=0;return Kt(e.doc,n=>{let r=e._start,i=e._start,s=Pn();const o=rh(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case xe:gs(o,i.content);break;default:t+=Jy(n,r,i,s,o),s=rh(o),r=i;break}i=i.right}}),t},TN=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Oy(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===xe&&o.constructor!==cn&&t.add(o.parent)})}Kt(n,r=>{hy(e,e.deleteSet,i=>{if(i instanceof cn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===xe?t.add(s):SN(r,i)});for(const i of t)AN(i)})},Zy=(e,t,n)=>{const r=n,i=rh(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Lr:case Li:case dr:n<t.right.length&&ei(e,Ot(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Jy(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&_o(o._searchMarker,t.index,-r+n),t};class RN extends _c{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];Kt(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),l="";break;case"retain":u>0&&(h={retain:u},mC(c)||(h.attributes=fC({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case Lr:case Li:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case dr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case xe:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;ri(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),ri(p,s.get(h)??null)?delete c[h]:c[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;ri(m,p)||(a==="retain"&&d(),c[h]=m)}else if(!o.deleted){s.set(h,p);const m=c[h];m!==void 0&&(ri(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[h]:c[h]=p))}o.deleted||(a==="insert"&&d(),gs(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class zn extends ae{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Pe(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new zn}clone(){const t=new zn;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new RN(this,t,n);wc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??Pe();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===dr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?Kt(this.doc,r=>{const i=new Lh(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Mh(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Xy(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Zy(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??Pe();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(ms(c,t)||n!==void 0&&ms(c,n))switch(c.content.constructor){case dr:{const f=s.get("ychange");t!==void 0&&!ms(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!ms(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case Lr:case Li:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case xe:ms(c,t)&&(l(),gs(s,c.content));break}c=c.right}l()};return t||n?Kt(o,f=>{t&&kh(f,t),n&&kh(f,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Kt(i,s=>{const o=kc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Mh(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?Kt(i,s=>{const o=kc(s,this,t,!r);Mh(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?Kt(r,i=>{Zy(i,kc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?Kt(i,s=>{const o=kc(s,this,t,!1);o.right!==null&&Xy(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?Kt(this.doc,n=>{xc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?Kt(this.doc,r=>{Ch(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Nh(this,t)}getAttributes(){return Gy(this)}_write(t){t.writeTypeRef(YN)}}const ON=e=>new zn;class Uh{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??Pe()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Nr||n.constructor===fr)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class fr extends ae{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new fr}clone(){const t=new fr;return t.insert(0,this.toArray().map(n=>n instanceof ae?n.clone():n)),t}get length(){return this.doc??Pe(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Uh(this,t)}querySelector(t){t=t.toUpperCase();const r=new Uh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Jr(new Uh(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){wc(this,t,new NN(this,n,t))}toString(){return Fy(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),bo(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?Kt(this.doc,r=>{jy(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)Kt(this.doc,r=>{const i=t&&t instanceof ae?t._item:t;Ec(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw ti("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?Kt(this.doc,r=>{Wy(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return By(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return zy(this,t)}slice(t=0,n=this.length){return Py(this,t,n)}forEach(t){bo(this,t)}_write(t){t.writeTypeRef(XN)}}const IN=e=>new fr;class Nr extends fr{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Nr(this.nodeName)}clone(){const t=new Nr(this.nodeName),n=this.getAttributes();return pC(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof ae?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?Kt(this.doc,n=>{xc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?Kt(this.doc,r=>{Ch(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Nh(this,t)}hasAttribute(t){return Ky(this,t)}getAttributes(t){return t?wN(this,t):Gy(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return bo(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(qN),t.writeKey(this.nodeName)}}const CN=e=>new Nr(e.readKey());class NN extends _c{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class ys extends hr{constructor(t){super(),this.hookName=t}_copy(){return new ys(this.hookName)}clone(){const t=new ys(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(JN),t.writeKey(this.hookName)}}const LN=e=>new ys(e.readKey());class Ni extends zn{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Ni}clone(){const t=new Ni;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(ZN)}}const MN=e=>new Ni;class Dh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw ar()}mergeWith(t){return!1}write(t,n,r){throw ar()}integrate(t,n){throw ar()}}const UN=0;class cn extends Dh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ty(t.doc.store,this)}write(t,n){t.writeInfo(UN),t.writeLen(this.length-n)}getMissing(t,n){return null}}class wo{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new wo(this.content)}splice(t){throw ar()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const DN=e=>new wo(e.readBuf());class Eo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Eo(this.len)}splice(t){const n=new Eo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){dc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const PN=e=>new Eo(e.readLen()),Qy=(e,t)=>new Cr({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class xo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new xo(Qy(this.doc.guid,this.opts))}splice(t){throw ar()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const BN=e=>new xo(Qy(e.readString(),e.readAny()));class Li{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Li(this.embed)}splice(t){throw ar()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const FN=e=>new Li(e.readJSON());class xe{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new xe(this.key,this.value)}splice(t){throw ar()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const zN=e=>new xe(e.readKey(),e.readJSON());class Sc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Sc(this.arr)}splice(t){const n=new Sc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const $N=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Sc(n)},jN=fc("node_env")==="development";class Mi{constructor(t){this.arr=t,jN&&ny(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Mi(this.arr)}splice(t){const n=new Mi(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const WN=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Mi(n)};class dr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new dr(this.str)}splice(t){const n=new dr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const GN=e=>new dr(e.readString()),KN=[xN,kN,ON,CN,IN,LN,MN],HN=0,VN=1,YN=2,qN=3,XN=4,JN=5,ZN=6;class Lr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Lr(this.type._copy())}splice(t){throw ar()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const QN=e=>new Lr(KN[e.readTypeRef()](e)),Ac=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new ve(Ot(r,i+n),t,Ot(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Ot(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class ve extends Dh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?$0:0}set marker(t){(this.info&oh)>0!==t&&(this.info^=oh)}get marker(){return(this.info&oh)>0}get keep(){return(this.info&z0)>0}set keep(t){this.keep!==t&&(this.info^=z0)}get countable(){return(this.info&$0)>0}get deleted(){return(this.info&sh)>0}set deleted(t){this.deleted!==t&&(this.info^=sh)}markDeleted(){this.info|=sh}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Oe(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Oe(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ps&&this.id.client!==this.parent.client&&this.parent.clock>=Oe(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Ry(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ei(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===cn||this.right&&this.right.constructor===cn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ve&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ve&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ps){const r=Sh(n,this.parent);r.constructor===cn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Ry(t,t.doc.store,Ot(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),pc(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(pc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Sh(t.doc.store,i.origin)))s.has(Sh(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ty(t.doc.store,this),this.content.integrate(t,this),Cy(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new cn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Ot(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&pc(t.origin,this.lastId)&&this.right===t&&pc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),dc(t.deleteSet,this.id.client,this.id.clock,this.length),Cy(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw cr();this.content.gc(t),n?iN(t,this,new cn(this.id,this.length)):this.content=new Eo(this.length)}write(t,n){const r=n>0?Ot(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&ac|(r===null?0:an)|(i===null?0:Rr)|(s===null?0:co);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=rN(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===ps?(t.writeParentInfo(!1),t.writeLeftID(a)):cr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const t_=(e,t)=>tL[t&ac](e),tL=[()=>{cr()},PN,$N,DN,GN,FN,zN,QN,WN,BN,()=>{cr()}],eL=10;class Sn extends Dh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){cr()}write(t,n){t.writeInfo(eL),bt(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const e_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},n_="__ $YJS$ __";e_[n_]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),e_[n_]=!0;let Ph,Bh,nL=e=>e();function rL(e,t){if(Bh)return Bh(e,t);nL(e)}function Ui(e,t,n){if(Ph)return Ph.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function iL(e){Ph=function(t,n,r){const i=e.createAtom(t);return n&&n(),i},Bh=(t,n)=>e.reaction(t,n,{fireImmediately:!1})}const r_=new WeakSet;function sL(e){if(r_.has(e))return e;r_.add(e);let t;const n=new Map;function r(){if(!t){const f=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&t.reportChanged()};t=Ui("map",()=>{e.observe(f)},()=>{e.unobserve(f)})}t.reportObserved(e._implicitObserver)}function i(f){let d=n.get(f);if(!d){const h=p=>{d.reportChanged()};d=Ui(f+"",()=>{e.observe(h)},()=>{e.unobserve(h)}),n.set(f,d)}d.reportObserved(e._implicitObserver)}const s=e.get;e.get=function(f){if(typeof f!="number")throw new Error("unexpected");return i(f),Reflect.apply(s,this,arguments)};function o(f){const d=e[f];e[f]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(f){let d=e,h=Object.getOwnPropertyDescriptor(d,f);if(h||(d=Object.getPrototypeOf(d),h=Object.getOwnPropertyDescriptor(d,f)),h||(d=Object.getPrototypeOf(d),h=Object.getOwnPropertyDescriptor(d,f)),!h)throw new Error("property not found");const p=h.get;h.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(e,f,h)}function c(f,d){let h=e,p=Object.getOwnPropertyDescriptor(h,f);if(p||(h=Object.getPrototypeOf(h),p=Object.getOwnPropertyDescriptor(h,f)),p||(h=Object.getPrototypeOf(h),p=Object.getOwnPropertyDescriptor(h,f)),!p)throw new Error("property not found");Object.defineProperty(e,d,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=e.push;e.push=function(f){this._disableTracking=!0;const d=l.call(this,f);return this._disableTracking=!1,d};const u=e.slice;return e.slice=function(f,d){this._disableTracking=!0;const h=u.call(this,f,d);return this._disableTracking=!1,h},e}const i_=new WeakSet;function oL(e){if(i_.has(e))return e;i_.add(e);let t;function n(){if(!t){let s=Array.from(e.share.keys());const o=a=>{const c=Array.from(e.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,t.reportChanged())};t=Ui("map",()=>{e.on("beforeObserverCalls",o)},()=>{e.off("beforeObserverCalls",o)})}t.reportObserved(e._implicitObserver)}const r=e.get;e.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return Tc(o),o};function i(s){const o=e[s];let a;e[s]=function(){let c,l=arguments;return n(),a&&a.removeObservers(),a=rL(()=>(c=Reflect.apply(o,e,l),c),()=>t.reportChanged()),c}}return i("toJSON"),Object.defineProperty(e,"keys",{get:()=>(n(),Object.keys(e.share))}),e}const s_=new WeakSet;function aL(e){if(s_.has(e))return e;s_.add(e);let t;const n=new Map;function r(){if(!t){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&t.reportChanged()};t=Ui("map",()=>{e.observe(a)},()=>{e.unobserve(a)})}t.reportObserved(e._implicitObserver)}function i(a){let c=n.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=Ui(a,()=>{e.observe(l)},()=>{e.unobserve(l)}),n.set(a,c)}c.reportObserved(e._implicitObserver)}const s=e.get;e.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=e[a];e[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),e}const o_=new WeakSet;function a_(e){if(o_.has(e))return e;o_.add(e);let t;const n=i=>{t.reportChanged()};t=Ui("text",()=>{e.observe(n)},()=>{e.unobserve(n)});function r(i){const s=e[i];e[i]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),e}const c_=new WeakSet;function l_(e){if(c_.has(e))return e;c_.add(e);let t;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&t.reportChanged()};t=Ui("xml",()=>{e.observe(n)},()=>{e.unobserve(n)});function r(s){const o=e[s];e[s]=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=e,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return t.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(e,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),e}function Tc(e){return e instanceof Ni||e instanceof zn?a_(e):e instanceof ur?sL(e):e instanceof hr?aL(e):e instanceof Cr||Object.prototype.hasOwnProperty.call(e,"autoLoad")?oL(e):e instanceof fr||e instanceof Nr?l_(e):e}function u_(e){e.share.forEach(t=>{t.constructor!==ae&&Tc(t)})}function h_(e,t){for(let r=e.length-1;r>=t;r--){let i=e[r];if(!i.deleted){var n;if(i instanceof cn)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof ae&&Tc(s)})}}}const f_=new WeakSet;function cL(e){f_.has(e)||(f_.add(e),Tc(e),e.store.clients.forEach(t=>{t&&h_(t,0)}),u_(e),e.on("beforeObserverCalls",t=>{u_(e),t.afterState.forEach((n,r)=>{const i=t.beforeState.get(r)||0;if(i!==n){const s=t.doc.store.clients.get(r);if(!s)return;const o=Fn(s,i);h_(s,o)}})}))}class vo{constructor(t){this.value=void 0,this.value=t}}function lL(e){return ArrayBuffer.isView(e)?new vo(e):new vo(Object.freeze(e))}function uL(e){const t=function(){var a;let c=(a=this[kn])==null?void 0:a.implicitObserver;return e._implicitObserver=c,e.slice.bind(e).apply(e,arguments).map(u=>{const f=Rc(u,c);return c&&typeof f=="object"?ao(f,c):f})},n=function(a){return a.map(c=>{const l=Fh(c);let u=Di(l)||l;if(u instanceof vo&&(u=u.value),u instanceof ae&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(t.apply(this),arguments)},i={slice:t,unshift:(...o)=>(e.unshift(n(o)),e.lengthUntracked),push:(...o)=>(e.push(n(o)),e.lengthUntracked),insert:e.insert.bind(e),toJSON:e.toJSON.bind(e),forEach:function(){return[].forEach.apply(t.apply(this),arguments)},every:function(){return[].every.apply(t.apply(this),arguments)},filter:function(){return[].filter.apply(t.apply(this),arguments)},find:function(){return[].find.apply(t.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(t.apply(this),arguments)},includes:function(){return[].includes.apply(t.apply(this),arguments)},map:function(){return[].map.apply(t.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>mL(a,o))},splice:function(){let o=arguments[0]<0?e.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=t.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return e.doc?e.doc.transact(()=>{e.delete(o,a),e.insert(o,n(c))}):(e.delete(o,a),e.insert(o,n(c))),l}},s=[];for(let o in i)s[o]=i[o];return s}function ko(e){if(typeof e=="string"&&e.trim().length){const t=Number(e);if(Number.isInteger(t))return t}return e}function d_(e,t=new ur){if(t[Ee])throw new Error("unexpected");const n=uL(t),r=new Proxy(n,{set:(i,s,o)=>{throw typeof ko(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=ko(s);if(a===Oc)return t;if(typeof a=="number"){let u;if(o&&o[kn]){var c;u=(c=o[kn])==null?void 0:c.implicitObserver,t._implicitObserver=u}let f=t.get(a);return f=Rc(f,u),f}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=t.slice();return Reflect.get(u,a)}return a==="length"?t.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=ko(s);if(typeof o!="number")throw new Error;return o<t.lengthUntracked&&o>=0?(t.delete(o),!0):!1},has:(i,s)=>{const o=ko(s);return typeof o!="number"?Reflect.has(i,o):o<t.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=ko(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<t.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<t.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,e),r}function p_(e,t=new hr){if(t[Ee])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=Fh(s);let a=Di(o)||o;if(a instanceof vo&&(a=a.value),a instanceof ae&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return t.set(i,a),!0},get:(r,i,s)=>{if(i===Oc)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[kn]){var a;o=(a=s[kn])==null?void 0:a.implicitObserver,t._implicitObserver=o}let c=t.get(i);return c=Rc(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return t.has(i)?(t.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&t.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.keys())});So.set(t,n);for(let r in e)n[r]=e[r];return n}function hL(e){return e instanceof ae}const So=new WeakMap;function Rc(e,t){if(hL(e)){if(e._implicitObserver=t,e instanceof ur||e instanceof hr){if(!So.has(e)){const n=Fh(e);So.set(e,n)}e=So.get(e)}else if(e instanceof Nr||e instanceof fr||e instanceof Ni||e instanceof ys||e instanceof zn)eh(e),e.__v_skip=!0;else throw new Error("unknown YType");return e}else{if(e===null)return null;if(typeof e=="object")return lL(e)}return e}function Fh(e){if(e==null)return e;if(e=Di(e)||e,e instanceof ur)return d_([],e);if(e instanceof hr)return p_({},e);if(typeof e=="string")return e;if(Array.isArray(e))return d_(e);if(e instanceof Nr||e instanceof fr||e instanceof Ni||e instanceof ys)return e;if(e instanceof zn)return e;if(typeof e=="object")return e instanceof vo?e:p_(e);if(typeof e=="number"||typeof e=="boolean")return e;throw new Error("invalid")}function fL(e){for(let[t,n]of Object.entries(e))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function m_(e,t,n){let r=t[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?e.getXmlFragment(n):r==="text"?e.getText(n):Array.isArray(r)?e.getArray(n):e.getMap(n)}function dL(e,t){if(e[Ee])throw new Error("unexpected");fL(t);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===Oc)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[kn]){var a;o=(a=s[kn])==null?void 0:a.implicitObserver,e._implicitObserver=o}if(i==="toJSON"){for(let u of Object.keys(t))m_(e,t,u);return Reflect.get(e,i)}let c=m_(e,t,i);return c=Rc(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&e.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.share.keys())});return So.set(e,n),n}iL(NI);const Oc=Symbol("INTERNAL_SYMBOL");function g_(e,t){const n=Di(e)||e;if(!n)throw new Error("not a valid synced object");return n instanceof Cr?(n.on("update",t),()=>{n.off("update",t)}):(n.observeDeep(t),()=>{n.unobserveDeep(t)})}function pL(e){const t=Di(e);if(!(t instanceof Cr))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return t}function Di(e){if(typeof e!="object"||e===null)return;const t=e[Oc];return t&&(eh(t),t.__v_skip=!0),t}function mL(e,t){if(e===t)return!0;if(typeof e=="object"&&typeof t=="object"){const n=Di(e),r=Di(t);return!n||!r?!1:n===r}return!1}function gL(e,t=new Cr){return cL(t),dL(t,e)}const zh=0,y_=1,__=2,yL=(e,t)=>{bt(e,zh);const n=eN(t);De(e,n)},b_=(e,t,n)=>{bt(e,y_),De(e,JC(t,n))},_L=(e,t,n)=>b_(t,n,Ke(e)),w_=(e,t,n)=>{try{YC(t,Ke(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},bL=(e,t)=>{bt(e,__),De(e,t)},wL=w_,EL=(e,t,n,r)=>{const i=wt(e);switch(i){case zh:_L(e,t,n);break;case y_:w_(e,n,r);break;case __:wL(e,n,r);break;default:throw new Error("Unknown message type")}return i},Mr=gL({shared:[]});function Ic(e,t,n){return e.find(r=>r.key===t&&r.type===n)}function E_(e,t,n){const r=Ic(Mr.shared,e,t);T(r)||Mr.shared.push({key:e,type:t,value:n})}function xL(e,t){E_(e,0,t)}function x_(e,t){const n=new zn(t);E_(e,1,n)}function vL(e,t){const n=Ic(Mr.shared,e,0);if(T(n)){n.value=t;return}Mr.shared.push({key:e,type:0,value:t})}function kL(e,t){const n=new zn(t),r=Ic(Mr.shared,e,1);if(T(r)){r.value=n;return}Mr.shared.push({key:e,type:1,value:n})}function v_(e,t,n){let r;function i(){const o=Ic(Mr.shared,e,t);T(o)&&(s(),r=g_(o,()=>n(o.value)))}const s=g_(Mr.shared,i);return i(),()=>r==null?void 0:r()}function SL(e,t){return v_(e,0,t)}function k_(e,t){return v_(e,1,n=>t(n.toJSON()))}function Cc(e){return Bn(e)}let S_=!1;const ii=pL(Mr),Ur=Po("modem",["second"],e=>{switch(e.target){case"second":!S_&&e.data%2===0&&Ur.emit("modem:join");break;case"join":if(e.sender!==Ur.id()){Ur.reply(e,"joinack");const t=Qr();yL(t,ii),Ur.reply(e,"sync",Cc(t));const n=Qr();b_(n,ii),Ur.reply(e,"sync",Cc(n))}break;case"joinack":S_=!0;break;case"sync":{if(T(e.data)&&e.sender!==Ur.id()){const t=Ii(e.data),n=Qr();EL(t,n,ii,Ur)===zh&&Ur.emit("modem:sync",Cc(n))}break}}});function A_(e){const t=Qr();bL(t,e),Ur.emit("modem:sync",Cc(t))}ii.on("update",A_),ii.on("destroy",()=>{ii==null||ii.off("update",A_)});const T_=Math.round(1e3/40),AL=3;function R_(e,t){return{id:Hn(),code:e,...t}}function TL(e){return e.map(t=>t.image)}function RL(e,t){const[n,r,...i]=t;if(T(e.stats)&&T(n))switch(n.image.toLowerCase()){case"rn":case"range":case"sl":case"select":case"nm":case"number":case"tx":case"text":case"ln":case"link":if(T(r)){const s=r.image.toLowerCase();e.stats[s]=TL(i??[])}break;default:{const s=t.slice(1).map(o=>o.image);for(let o=0;o<s.length;++o)e.stats[s[o]]="";break}}}function O_(e){const t={...Ao(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function OL(e){return T(e)?(e.stats=void 0,Ao(e)):{}}function Ao(e){var r;if(!T(e))return{};if(T((r=e.stats)==null?void 0:r.type))return e.stats;e.stats={};const t=Hu(e.code);let n=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Uu){const[o,...a]=s.image.slice(1).split(" "),c=o.toLowerCase(),l=a.join(" "),u=l.toLowerCase().trim();switch(c){case"stat":{const f=Hu(`!${l}`);f.tokens.length&&RL(e,f.tokens);break}case ie.BOARD:e.stats.type=ut.BOARD,e.stats.name=u;break;case ie.OBJECT:e.stats.type=ut.OBJECT,e.stats.name=u;break;case ie.TERRAIN:e.stats.type=ut.TERRAIN,e.stats.name=u;break;case ie.CHARSET:e.stats.type=ut.CHARSET,e.stats.name=u;break;case ie.PALETTE:e.stats.type=ut.PALETTE,e.stats.name=u;break;case ie.EIGHT_TRACK:e.stats.type=ut.EIGHT_TRACK,e.stats.name=u;break;case ie.LOADER:e.stats.type=ut.LOADER,e.stats.name=u;break;default:n?e.stats.name=[c,...a].join(" ").trim():e.stats[c]=1;break}n=!1}}return T(e.stats.type)||(e.stats.type=ut.OBJECT),e.stats}function I_(e){switch(e){default:case ut.ERROR:return"error";case ut.LOADER:return ie.LOADER;case ut.BOARD:return ie.BOARD;case ut.OBJECT:return ie.OBJECT;case ut.TERRAIN:return ie.TERRAIN;case ut.CHARSET:return ie.CHARSET;case ut.PALETTE:return ie.PALETTE;case ut.EIGHT_TRACK:return ie.EIGHT_TRACK}}function To(e){return Ao(e).type??ut.ERROR}function Pi(e){return I_(To(e))}function ln(e){return(Ao(e).name??"").toLowerCase()}function $h(e){var t;switch((t=e==null?void 0:e.stats)==null?void 0:t.type){default:return;case ut.ERROR:return(e==null?void 0:e.code)??"";case ut.LOADER:return(e==null?void 0:e.code)??"";case ut.BOARD:return T(e.board)||(e.board=mE()),e.board.codepage=e.id,e.board;case ut.OBJECT:return T(e.object)||(e.object=yd()),e.object.name=ln(e),e.object;case ut.TERRAIN:return T(e.terrain)||(e.terrain=yd()),e.terrain.name=ln(e),e.terrain;case ut.CHARSET:return T(e.charset),e.charset;case ut.PALETTE:return T(e.palette),e.palette;case ut.EIGHT_TRACK:return T(e.eighttrack),e.eighttrack}}function IL(e){return{id:Hn(),name:Sb(),pages:e,flags:{},players:{}}}var jh=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.pages=2]="pages",e[e.flags=3]="flags",e[e.players=4]="players",e))(jh||{});function CL(e){return uE(e,jh)}function NL(e){return hE(e,jh)}function si(e,t){if(!T(e))return;const n=t.toLowerCase();return e.pages.find(i=>i.id===t||n===ln(i))}function Nc(e,t,n){if(!T(e))return;const r=n.toLowerCase();return e.pages.find(s=>To(s)===t&&(s.id===n||r===ln(s)))}function LL(e,t){return T(e)?e.pages.filter(n=>To(n)===t):[]}function C_(e,t){if(!T(e)||!T(t))return!1;const n=si(e,t.id);return T(n)?!1:(e.pages.push(t),!0)}function ML(e,t){const n=si(e,t);if(T(e)&&T(n)){const r=t.toLowerCase();return e.pages=e.pages.filter(i=>i.id!==t&&r!==ln(i)),n}}function $n(e,t){if(T(t)&&T(t.kind))return T(t.kinddata)||(t.kinddata=T(t.id)?Lc(e,t.kind):L_(e,t.kind)),t.kinddata}function N_(e,t){const n=$n(e,t);return{char:(t==null?void 0:t.char)??(n==null?void 0:n.char)??1,color:(t==null?void 0:t.color)??(n==null?void 0:n.color)??xt.WHITE,bg:(t==null?void 0:t.bg)??(n==null?void 0:n.bg)??xt.BORROW}}function Lc(e,t){const n=t??"",r=Nc(e,ut.OBJECT,n);if(T(r)){const i=O_(r);return{...$h(r),...i,name:n,code:r.code}}else return}function L_(e,t){const n=t??"",r=Nc(e,ut.TERRAIN,n);if(T(r)){const i=O_(r);return{...$h(r),...i,name:n,code:r.code}}else return}function _s(e,t){return $h(si(e,t))}function M_(e,t){if(e)return e.flags[t]=e.flags[t]??{},e.flags[t]}function Wh(e,t,n){const r=M_(e,t);return r==null?void 0:r[n]}function Gh(e,t,n,r){const i=M_(e,t);return i&&(i[n]=r),r}function U_(e,t){return _s(e,(e==null?void 0:e.players[t])??"")}function D_(e,t,n){T(e)&&T(_s(e,n))&&(e.players[t]=n)}function P_(e){return Fw(Object.values((e==null?void 0:e.players)??{})).map(n=>_s(e,n)).filter(T)}function UL(e,t,n,r){const i=wl(t,(n==null?void 0:n.id)??"");if(!T(e)||!T(t)||!T(i)||!T(i.x)||!T(i.y)||!T(t.lookup)||r.x<0||r.x>=Pt||r.y<0||r.y>=He)return{kind:"edge",collision:re.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=r.x+r.y*Pt,o=$n(e,i),a=i.collision??(o==null?void 0:o.collision),c=wl(t,t.lookup[s]??"");if(T(c))return{...c};const l=t.terrain[s];if(T(l)){const u=$n(e,l),f=l.collision??(u==null?void 0:u.collision);if(Kf(a,f))return{...l,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,T(i.removed)||(t.lookup[s]=void 0,t.lookup[i.x+i.y*Pt]=i.id??"")}function bs(e,t){const n=$n(e,t);return T(t==null?void 0:t.id)&&T(t.x)&&T(t.y)?(t.name??(n==null?void 0:n.name)??"object").toLowerCase():((t==null?void 0:t.name)??(n==null?void 0:n.name)??"terrain").toLowerCase()}function Kh(e,t,n,r){if(!T(e)||!T(t)||!T(t.named)||!T(n))return;const i=bs(e,n);t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function DL(e,t,n){if(!(!T(e)||!T(t)||!T(t.lookup)||!T(n==null?void 0:n.id))&&!T(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*Pt]=n.id}}function Ro(e,t){if(!T(e)||!T(t)||T(t.lookup)&&T(t.named))return;const n=new Array(Pt*He).fill(void 0),r={},i=Object.values(t.objects);for(let a=0;a<i.length;++a){const c=i[a];if(T(c.x)&&T(c.y)&&T(c.id)&&!T(c.removed)){c.category=Vo.ISOBJECT,n[c.x+c.y*Pt]=c.id;const l=bs(e,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let s=0,o=0;for(let a=0;a<t.terrain.length;++a){const c=t.terrain[a];if(T(c)){c.x=s,c.y=o,c.category=Vo.ISTERRAIN;const l=bs(e,c);r[l]||(r[l]=new Set),r[l].add(a)}++s,s>=Pt&&(s=0,++o)}t.lookup=n,t.named=r}function Hh(e,t,n){return bs(e,t)!=="player"&&T(t)?(t.removed=n,!0):!1}function Mc(e,t,n){var r;if(T(e)&&T(t)&&T(n==null?void 0:n.id)){if(T(t.lookup)&&T(n.x)&&T(n.y)){const s=n.x+n.y*Pt;t.lookup[s]===n.id&&delete t.lookup[s]}const i=bs(e,n);T((r=t.named)==null?void 0:r[i])&&T(n.id)&&t.named[i].delete(n.id)}}function PL(e,t,n){if(!T(e)||!T(t))return;const r=Object.values(t.objects);for(let i=0;i<r.length;++i){const s=r[i];T(s.id)&&T(s.removed)&&n-s.removed>T_*5&&xd(t,s.id)}}function BL(e,t,n){const r=[];if(!T(e)||!T(t))return r;t.lookup=void 0,Ro(e,t);const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];if(!T(o.id))continue;o.lx=o.x,o.ly=o.y;const a=$n(e,o),c=o.code??(a==null?void 0:a.code)??"";c&&r.push({id:o.id,type:ut.OBJECT,code:c,object:o,terrain:void 0})}return PL(e,t,n),r}function FL(e,t,n,r){if(T(e)&&T(t)&&T(n)){const[i,s]=n,o=Lc(e,i);if(T(o)&&T(o.name)){const a=bl(t,r,i);return T(a)&&(a.headless=!0,Qo(a,s),Kh(e,t,a)),a}}}function Uc(e,t,n,r){if(T(e)&&T(t)&&T(n)){const[i,s]=n,o=L_(e,i);if(T(o)){const c=Ed(t,r,i);Qo(c,s);const l=r.x+r.y*Pt;return Kh(e,t,c,l),c}const a=Lc(e,i);if(T(a)&&T(a.name)){const c=bl(t,r,i);return Qo(c,s),DL(e,t,c),Kh(e,t,c),c}}}const zL=navigator.userAgent.indexOf("Mac")!==-1?"cmd":"ctrl",oi="$dkpurple",$L="$196",jL="$205";function jn(e,t){return`$${e}${t}$blue`}function B_(e,t){return`$${e}${t}$ondkblue`}function te(e){ge("cli",e)}function WL(e){const t=$L.repeat(e);te(`${oi}${t}`)}function Vh(e){const t=jL.repeat(e);te(`${oi}${t}`)}function Oo(e){te(`${oi} ${" ".repeat(e.length)} `),WL(e.length+2),te(`${oi} $white${e} `),Vh(e.length+2)}function Dr(e){te(`${oi} ${" ".repeat(e.length)} `),te(`${oi} $gray${e} `),Vh(e.length+2)}function Nt(e,t){te(`${oi} $white${e} $blue${t}`)}function Ut(e){te(`${oi}$blue${e}`)}function Yh(){return tf("main")}const GL=Ai({get(e,t){const n=St(e.id()),r=Wh(n.book,n.player,t);return[T(r),r]},set(e,t,n){const r=St(e.id());return Gh(r.book,r.player,t,n),[!0,n]},shouldtick(){},tick(){},tock(){}}).command("stat",(e,t)=>{const[n]=t;if(!Lt(n))return 0;const[r,i]=n.split(" "),s=T(i)?Te(r):"object",o=T(i)?Te(i):Te(r);return e.command("mod",s,o),e.command("pageopen",o),0}).command("text",(e,t)=>{const n=t.map(Te).join(" ");return ge("$2",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=r.map(Te).join(" ");return ge("$2",`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=it(st(e,t),0,[X.MAYBE_STRING]),r=tb(n);return T(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const n=St(e.id()),[r]=it(st(e,t),0,[X.STRING]),i=Lo(r);return T(i)?(Ut(`opened [book] ${i.name}`),Qh("main",i.id),e.command("pages")):ne("cli","bookopen",`book ${r} not found`,n.player),0}).command("booktrash",(e,t)=>{const[n]=it(st(e,t),0,[X.STRING]),r=Gn("main"),i=Lo(n);return T(i)&&(r===i&&Qh("main",""),IM(n),Ut(`trashed [book] ${i.name}`),As("cli"),e.command("pages")),0}).command("pageopen",(e,t)=>{const n=St(e.id()),[r]=it(st(e,t),0,[X.STRING]),i=Yh();if(!T(i))return 0;const s=si(i,r);if(T(s)){const o=ln(s),a=Pi(s);Ut(`opened [${a}] ${o}`),x_(vf(i.id,s.id),s.code);const c=Pi(s);lw("cli",i.id,s.id,c,`@book ${i.name}:${o}`,n.player)}else ne("cli","pageopen",`page ${r} not found`,n.player);return 0}).command("pagetrash",(e,t)=>{const[n]=it(st(e,t),0,[X.STRING]),r=Yh(),i=ML(r,n);if(T(n)){const s=ln(i),o=Pi(i);Ut(`trashed [${o}] ${s}`),As("cli"),e.command("pages")}return 0}).command("nodetrash",()=>(aw("cli"),Ut("node id changed, refreshing page recommended"),0)).command("help",(e,t)=>{const n=t.map(Te).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Dr("books");const e=Gn("main");Nt("main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=Gn("content");Nt("content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),Vh(7);const n=Fc();return n.length?n.forEach(r=>{te(`!bookopen ${r.id};${r.name}`)}):Ut("no books found"),te("!bookcreate;create a new book"),0}).command("pages",e=>{Dr("pages");const t=Yh();return T(t)?(Nt("main",`${t.name} $GREEN${t.id}`),t.pages.length?t.pages.forEach(n=>{const r=ln(n);te(`!pageopen ${n.id};${r}`)}):(te(""),Ut("no pages found"),Ut("use @ to create a page"),Ut("@board name of board"),Ut("@object name of object"),Ut("@terrain name of terrain"),Ut("You can omit the type and it will default to object"),Ut("@object name of object"),Ut("@name of object"))):e.command("bookopen","main"),0}).command("trash",()=>{Dr("$REDTRASH"),Ut("books");const e=Fc();e.length&&(e.forEach(n=>{te(`!booktrash ${n.id};$REDTRASH ${n.name}`)}),te(""));const t=Gn("main");return T(t)&&(Ut(`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=ln(n);te(`!pagetrash ${n.id};$REDTRASH ${r}`)}),te("")),0}).command("save",()=>(As("cli"),0)).command("send",(e,t)=>{const[n,r]=it(st(e,t),0,[X.STRING,X.ANY]);switch(n){case"helpmenu":Oo("H E L P"),Nt("#help controls","zss controls and inputs"),te("!helpcontrols;read help controls"),te(""),Nt("#help text","text formatting"),te("!helptext;read help text"),te(""),Nt("#help developer","developer commands"),te("!helpdeveloper;read help developer"),te(""),Nt("#help player","player settings"),te("!helpplayer;read help player"),Dr("keyboard input"),Nt("?","open console"),Nt("esc","close console"),Nt("tab","move console"),Nt("up / down arrow keys","navigate console items"),Nt("left / right arrow keys","change console items"),Nt("enter","interact with console items"),Nt("alt + arrow keys","skip words and console lines"),Nt(`${zL} + up / down arrow keys`,"input history");break;case"helpcontrols":Oo("zss controls and inputs"),Dr("keyboard input"),Nt("arrow keys","move"),Nt("shift + arrow keys","shoot"),Nt("enter","ok / accept"),Nt("escape","cancel / close"),Nt("tab","menu / action"),Dr("mouse input"),Ut("todo ???"),Dr("controller input"),Nt("left stick","move"),Nt("right stick","aim"),Nt("a","ok / accept"),Nt("b","cancel / close"),Nt("y","menu / action"),Nt("x","shoot"),Nt("triggers","shoot");break;case"helptext":Oo("text formatting"),Dr("typography"),Ut("plain text"),Ut("$centering text"),Ut('"\\"@quoted strings for special chars\\""'),Ut("$$0-255 for ascii chars $159$176$240"),Ut(`use color names like ${jn("red","$$red")} to change foreground color`),Ut(`use color names like ${B_("ongreen","$$ongreen")} to change background color`),Ut(`use clear ${B_("clear","to change background to")} transparent`),Dr("hyperlinks"),Ut(`${jn("white",'"!hotkey"')} message shortcut;${jn("gray","Label")}`),Ut(`${jn("white",'"!range"')} flag [labelmin] [labelmax];${jn("gray","Input Label")}`),Ut(`${jn("white",'"!select"')} flag ...list of values;${jn("gray","Input Label")}`),Ut(`${jn("white",'"!number"')} flag [minvalue] [maxvalue];${jn("gray","Input Label")}`),Ut(`${jn("white",'"!text"')} flag;${jn("gray","Input Label")}`);break;case"helpdeveloper":Oo("developer commands"),Nt("#books","list books in memory"),Nt("#pages","list pages in opened book"),Nt("@[pagetype:]page name","create & edit a new codepage in the currently opened book"),Nt("#trash","list books and pages from open book you can delete"),Nt("#save","flush state to register");break;case"helpplayer":Oo("player settings"),Ut("todo");break;default:ge("$2",`${n} ${r??""}`);break}return 0}),F_=new Set(["p1","p2","p3","cycle","stepx","stepy","sender","data"]),KL=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),HL=["NORTH","SOUTH","WEST","EAST"];function VL(e){const t=St(e.id??"");if(t.inputcurrent!==void 0)return;const[n=me.NONE]=t.inputqueue;e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0;const r=t.inputmods[n];switch(e.inputalt=r&ew?1:0,e.inputctrl=r&nw?1:0,e.inputshift=r&rw?1:0,n){case me.MOVE_UP:case me.MOVE_DOWN:case me.MOVE_LEFT:case me.MOVE_RIGHT:e.inputmove=[HL[n-me.MOVE_UP]];break;case me.OK_BUTTON:e.inputok=1;break;case me.CANCEL_BUTTON:e.inputcancel=1;break;case me.MENU_BUTTON:e.inputmenu=1;break}t.inputcurrent=n,t.inputqueue.delete(n)}function ws(e,t,n,r){const i=Lt(t)?t:t.id,s=Lt(t)?void 0:{x:t.x??0,y:t.y??0},o=Lt(n)?n:n.id,a=i??s;T(o)&&T(a)&&e.send(o,r,a)}function z_(e,t,n,r){T(n==null?void 0:n.id)?(n.headless=!0,Mc(e,t,n)):Ed(t,r,"empty")}function $_(e,t,n,r,i){const s=UL(t,n,r,i);if(T(s)){ws(e,s,e.id(),"thud"),r.kind==="player"?ws(e,e.id(),s,"touch"):r.collision===re.ISBULLET?ws(e,e.id(),s,"shot"):ws(e,e.id(),s,"bump");const o=$n(t,s);return(s.destructible??(o==null?void 0:o.destructible))&&z_(t,n,s,i),!1}return!0}const YL=Ai({get(e,t){const n=St(e.id());if(!T(n.object))return[!1,void 0];KL.has(t)&&VL(n.object);const r=n.object[t];if(T(r)||F_.has(t))return[!0,r];const s=n.board?El(n.board,n.object):void 0,o=Wh(n.book,(s==null?void 0:s.id)??"",t);return[T(o),o]},set(e,t,n){const r=St(e.id());if(!T(r.object))return[!1,void 0];if(T(r.object[t])||F_.has(t))return r.object[t]=n,[!0,n];const i=r.board?El(r.board,r.object):void 0;return Gh(r.book,(i==null?void 0:i.id)??"",t,n),[!0,n]},shouldtick(e,t){var r,i,s,o;const n=St(e.id());!t||!T((r=n.object)==null?void 0:r.x)||!T((i=n.object)==null?void 0:i.y)||!T((s=n.object)==null?void 0:s.stepx)||!T((o=n.object)==null?void 0:o.stepy)||$_(e,n.book,n.board,n.object,{x:n.object.x+n.object.stepx,y:n.object.y+n.object.stepy})||_l(n.object,{stepx:0,stepy:0})},tick(){},tock(e){var n;(n=St(e.id()).object)!=null&&n.headless&&e.command("die")}}).command("become",(e,t)=>{var s,o;const n=St(e.id()),r={x:((s=n.object)==null?void 0:s.x)??0,y:((o=n.object)==null?void 0:o.y)??0},[i]=it(st(e,t),0,[X.KIND]);return Ro(n.book,n.board),Mc(n.book,n.board,n.object),Hh(n.book,n.object,e.timestamp())&&Uc(n.book,n.board,i,r),e.endofprogram(),0}).command("bind",()=>0).command("change",(e,t)=>{const n=St(e.id());if(!T(n.book)||!T(n.board))return 0;const[r,i]=it(st(e,t),0,[X.KIND,X.KIND]);Ro(n.book,n.board);const s=vl(r)??"",o=cl(n.board,s),a=jw(o,r),c=vl(i),l=Dd(i),u=Pd(i);return a.forEach(f=>{if(bs(n.book,f)===c)T(l)&&(f.color=l),T(u)&&(f.bg=u);else{if(T(f.id)&&(Mc(n.book,n.board,f),!Hh(n.book,f,e.timestamp())))return;Yn(f)&&Uc(n.book,n.board,i,f)}}),0}).command("char",(e,t)=>{const n=St(e.id()),[r]=it(st(e,t),0,[X.NUMBER]);return T(n.object)&&(n.object.char=r),0}).command("color",(e,t)=>{const n=St(e.id()),[r]=it(st(e,t),0,[X.COLOR]);return T(n.object)&&T(r)&&Qo(n.object,r),0}).command("cycle",(e,t)=>{const n=St(e.id()),[r]=it(st(e,t),0,[X.NUMBER]),i=pi(Math.round(r),1,255);return bd(n.object,"cycle",i),0}).command("die",e=>{var n;const t=St(e.id());return(n=t.object)!=null&&n.headless&&Mc(t.book,t.board,t.object),Hh(t.book,t.object,e.timestamp()),e.endofprogram(),0}).command("endgame",e=>(e.set("health",0),0)).command("go",(e,t)=>{const n=St(e.id());if(!T(n.object))return 1;const[r]=it(st(e,t),0,[X.DIR]);return $_(e,n.book,n.board,n.object,r),n.object.x!==r.x&&n.object.y!==r.y?1:0}).command("put",(e,t)=>{const n=St(e.id());if(!T(n.book)||!T(n.board))return 0;const[r,i]=it(st(e,t),0,[X.DIR,X.KIND]);return Ro(n.book,n.board),Uc(n.book,n.board,i,r),0}).command("send",(e,t)=>{var f,d;const n=St(e.id()),[r,i]=it(st(e,t),0,[X.STRING,X.ANY]),[s,o]=r.split(":"),a=T(o)?s:"self",c=o??s;function l(h){h.forEach(p=>{T(p.id)&&e.send(p.id,c,i)})}const u=a.toLowerCase();switch(u){case"all":for(const h of Object.keys(((f=n.board)==null?void 0:f.objects)??{}))e.send(h,c,i);break;case"self":e.message({id:Hn(),sender:e.id(),target:c,data:i});break;case"others":for(const h of Object.keys(((d=n.board)==null?void 0:d.objects)??{}))h!==e.id()&&e.send(h,c,i);break;case"player":break;default:{l(ll(n.board,[a]));const h=e.get(u);Le(h)?l(ll(n.board,h)):l(ll(n.board,[h]));break}}return 0}).command("shoot",(e,t)=>{const n=St(e.id());if(!T(n.book)||!T(n.board)||!Yn(n.object))return 0;const[r,i]=it(st(e,t),0,[X.DIR,X.MAYBE_KIND]),s=Wr(n.object,r),o=dn({x:0,y:0},s),a=dn({x:n.object.x,y:n.object.y},s);Ro(n.book,n.board);let c=yE(n.board,a);if(T(c)&&!T(c.id)){const l=$n(n.book,n.object),u=$n(n.book,c);Kf(c.collision??(l==null?void 0:l.collision),c.collision??(u==null?void 0:u.collision))||(c=void 0)}if(T(c)){T(c.id)&&ws(e,e.id(),c,"shot");const l=$n(n.book,c);(c.destructible??(l==null?void 0:l.destructible))&&z_(n.book,n.board,c,a);const u=FL(n.book,n.board,i??["bullet"],a);T(u)&&(u.collision=re.ISBULLET,ws(e,c,e.id(),"thud"))}else{const l=Uc(n.book,n.board,i??["bullet"],a);T(l)&&(l.collision=re.ISBULLET,_l(l,{stepx:o.x,stepy:o.y}))}return e.yield(),0}).command("throwstar",(e,t)=>e.command("shoot",...t,"star")?1:0).command("try",(e,t)=>{const[,n]=it(st(e,t),0,[X.DIR]);return e.command("go",...t)&&n<t.length&&e.command(...t.slice(n)),e.yield(),0}).command("walk",(e,t)=>{const n=St(e.id());if(!Yn(n.object))return 0;const[r]=it(st(e,t),0,[X.DIR]),i=Wr(n.object,r),s=dn({x:0,y:0},i);return _l(n.object,{stepx:s.x,stepy:s.y}),0}).command("stat",(e,t)=>{const n=St(e.id());return n.object&&(n.object.name=t.map(Te).join(" ")),0});var j_={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(e){(function(){var t=function(h,p){return p=p||"",h.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=t("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+t("DF-F6,F8-FF","00"),i="A-Z"+t("C0-D6,D8-DE","00"),s="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(h,p,m,b){return h=h||n,p=p||r,m=m||i,b=b||s,{capitalize:new RegExp("(^|["+h+"])(["+p+"])","g"),pascal:new RegExp("(^|["+h+"])+(["+p+m+"])","g"),fill:new RegExp("["+h+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+b+")\\b","g"),relax:new RegExp("([^"+m+"])(["+m+"]*)(["+m+"])(?=[^"+m+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+h+"]")}},a=o(),c={re:a,unicodes:t,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(h){return c.up.call(h.charAt(0))+h.slice(1)},decap:function(h){return c.low.call(h.charAt(0))+h.slice(1)},deapostrophe:function(h){return h.replace(a.apostrophe,"")},fill:function(h,p,m){return p!=null&&(h=h.replace(a.fill,function(b,g){return g?p+g:""})),m&&(h=c.deapostrophe(h)),h},prep:function(h,p,m,b){if(h=h==null?"":h+"",!b&&a.upper.test(h)&&(h=c.low.call(h)),!p&&!a.hole.test(h)){var g=c.fill(h," ");a.hole.test(g)&&(h=g)}return!m&&!a.room.test(h)&&(h=h.replace(a.relax,c.relax)),h},relax:function(h,p,m,b){return p+" "+(m?m+" ":"")+b}},l={_:c,of:function(h){for(var p=0,m=c.types.length;p<m;p++)if(l[c.types[p]].apply(l,arguments)===h)return c.types[p]},flip:function(h){return h.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(h){return h.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(h,p){l[h]=p,c.types.push(h)}},u={lower:function(h,p,m){return c.fill(c.low.call(c.prep(h,p)),p,m)},snake:function(h){return l.lower(h,"_",!0)},constant:function(h){return l.upper(h,"_",!0)},camel:function(h){return c.decap(l.pascal(h))},kebab:function(h){return l.lower(h,"-",!0)},upper:function(h,p,m){return c.fill(c.up.call(c.prep(h,p,!1,!0)),p,m)},capital:function(h,p,m){return c.fill(c.prep(h).replace(a.capitalize,function(b,g,x){return g+c.up.call(x)}),p,m)},header:function(h){return l.capital(h,"-",!0)},pascal:function(h){return c.fill(c.prep(h,!1,!0).replace(a.pascal,function(p,m,b){return c.up.call(b)}),"",!0)},title:function(h){return l.capital(h).replace(a.improper,function(p,m,b,g){return b>0&&b<g.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(h,p,m){return h=l.lower(h).replace(a.sentence,function(b,g,x){return g+c.up.call(x)}),p&&p.forEach(function(b){h=h.replace(new RegExp("\\b"+l.lower(b)+"\\b","g"),c.cap)}),m&&m.forEach(function(b){h=h.replace(new RegExp("(\\b"+l.lower(b)+"\\. +)(\\w)"),function(g,x,S){return x+c.low.call(S)})}),h}};u.squish=u.pascal,l.default=l;for(var f in u)l.type(f,u[f]);var d=typeof d=="function"?d:function(){};d(e.exports?e.exports=l:this.Case=l)}).call(Be)})(j_);var qL=j_.exports,XL=ks(qL);const ai={};function W_(e,t){return e.player=t,e.layers=[],e.layout=[],e.layoutreset=!0,e.layoutfocus="scroll",e}function G_(e){e.text=[],Object.values(ai[e.id]??{}).forEach(t=>t==null?void 0:t()),ai[e.id]={}}function K_(e){const t=e.layout.find(n=>n.name===e.layoutfocus);if(!t){const n={id:Hn(),name:e.layoutfocus,edge:un.RIGHT,size:20,text:[]};return e.layout.push(n),e.layoutreset=!1,n}return t}const qh={},JL=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),ZL=new Set(["rn","range","sl","select","nm","number","tx","text"]),QL=new Set(["tx","text"]),tM={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""};function Bi(e){let t=qh[e];return T(t)?t:qh[e]=t=W_({},e)}function eM(){return Object.keys(qh)}function nM(e){const t=Bi(e);t.layout=t.layout.filter(n=>n.edge!==un.SCROLL)}function rM(e,t,n){Object.values(ai).forEach(r=>{if(r[t]!==void 0){const i=wf(e.id(),t);qt(n)&&vL(i,n),Lt(n)&&kL(i,n)}})}function iM(e){let t="";const n=Bi(e);return n.layout=n.layout.filter(r=>{if(r.edge===un.SCROLL){const[i]=r.text;return Lt(i)&&r.text.length===1&&(t=i),r.text.length>1}return!0}),t}function Xh(e,t,n,r,i){const s=Bi(e),o=r,a=i??XL.capital(t),c=s.layout.find(l=>l.name===a);if(c)s.layoutreset=!0,s.layoutfocus=a,qt(o)&&(c.size=o);else switch(n){case un.START:W_(s,e);break;case un.LEFT:case un.RIGHT:case un.TOP:case un.BOTTOM:case un.SCROLL:{const l={id:Hn(),name:a,edge:n,size:o??tw[n],text:[]};s.layout.push(l),s.layoutfocus=a;break}}}function sM(e,t){const n=Bi(e),r=K_(n);n.layoutreset&&(n.layoutreset=!1,G_(r)),r.text.push(t)}function oM(e,t,n,r,i){const s=Bi(e),o=K_(s);s.layoutreset&&(s.layoutreset=!1,G_(o));const a=r.toLowerCase(),c=[t.id(),n,...JL.has(a)?[a]:["hyperlink",r],...i],l=c[2];if(ZL.has(l)){const u=`${c[3]??""}`;ai[o.id]=ai[o.id]??{};const f=t.get(u)??tM[l];if(ai[o.id][u]===void 0){const d=wf(t.id(),u);qt(f)&&xL(d,f),Lt(f)&&x_(d,f),QL.has(l)?ai[o.id][u]=k_(d,h=>{T(h)&&h!==t.get(u)&&(console.info("modemobservevaluestring??",u,h,t.get(u)),t.set(u,h))}):ai[o.id][u]=SL(d,h=>{T(h)&&h!==t.get(u)&&(console.info("modemobservevaluenumber??",u,h,t.get(u)),t.set(u,h))})}}o.text.push(c)}const aM=Ai({get(){return[!1,void 0]},set(e,t,n){return rM(e,t,n),[!1,void 0]},shouldtick(){},tick(e){var r;const t=St(e.id());let n="scroll";T((r=t.object)==null?void 0:r.name)&&(n=t.object.name),Xh(t.player,"scroll",un.SCROLL,void 0,n)},tock(e){const t=St(e.id()),n=iM(t.player);if(n&&T(t.object)){const r=e.timestamp();t.object.tickertext=n,t.object.tickertime=r;const i=N_(t.book,t.object);ge(`$${xt[i.color]}$${i.char}`,n)}}}).command("gadget",(e,t)=>{const n=St(e.id()),r=st(e,t),[i]=it(r,0,[X.STRING]),s=Qb[i.toLowerCase()];if(s===un.SCROLL){const[,o,a]=it(r,0,[X.STRING,X.MAYBE_STRING,X.MAYBE_NUMBER]);Xh(n.player,i,s,a,o)}else{const[,o,a]=it(r,0,[X.STRING,X.MAYBE_NUMBER,X.MAYBE_STRING]);Xh(n.player,i,s,o,a)}return 0}).command("text",(e,t)=>{const n=St(e.id()),r=t.map(Te).join("");return sM(n.player,r),0}).command("hyperlink",(e,t)=>{const n=St(e.id()),[r,i,...s]=t,o=Te(r),a=Te(i);return oM(n.player,e,o,a,s),0});function H_(e,t){if(!T(e.binaryfile))return;const n=t.toLowerCase(),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.binaryfile.dataview.getFloat32(e.binaryfile.cursor,r);return e.binaryfile.cursor+=4,i}case"float64":case"float64le":{const i=e.binaryfile.dataview.getFloat64(e.binaryfile.cursor,r);return e.binaryfile.cursor+=8,i}case"int8":case"int8le":{const i=e.binaryfile.dataview.getInt8(e.binaryfile.cursor);return e.binaryfile.cursor+=1,i}case"int16":case"int16le":{const i=e.binaryfile.dataview.getInt16(e.binaryfile.cursor,r);return e.binaryfile.cursor+=2,i}case"int32":case"int32le":{const i=e.binaryfile.dataview.getInt32(e.binaryfile.cursor,r);return e.binaryfile.cursor+=4,i}case"int64":case"int64le":{const i=e.binaryfile.dataview.getBigInt64(e.binaryfile.cursor,r);return e.binaryfile.cursor+=8,i}case"uint8":case"uint8le":{const i=e.binaryfile.dataview.getUint8(e.binaryfile.cursor);return e.binaryfile.cursor+=1,i}case"uint16":case"uint16le":{const i=e.binaryfile.dataview.getUint16(e.binaryfile.cursor,r);return e.binaryfile.cursor+=2,i}case"uint32":case"uint32le":{const i=e.binaryfile.dataview.getUint32(e.binaryfile.cursor,r);return e.binaryfile.cursor+=4,i}case"uint64":case"uint64le":{const i=e.binaryfile.dataview.getBigUint64(e.binaryfile.cursor,r);return e.binaryfile.cursor+=8,i}}}const cM=(e,t)=>{const n=St(e.id());if(!T(n.binaryfile))return 0;const[r]=it(st(e,t),0,[X.STRING]),i=r.toLowerCase();switch(i){case"seek":{const[s]=it(st(e,t),1,[X.NUMBER]);n.binaryfile.cursor=s;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[s]=it(st(e,t),1,[X.STRING]);e.set(s,H_(n,i));break}case"text":{const[s,o]=it(st(e,t),1,[X.STRING,X.STRING]),a=H_(n,s);if(qt(a)&&Lt(o)){const c=new Uint8Array(n.binaryfile.bytes.buffer,n.binaryfile.cursor,a),u=new TextDecoder("utf-8").decode(c);e.set(o,u),n.binaryfile.cursor+=a}break}}return 0},lM=Ai({get(e,t){var i,s;const n=St(e.id());if(!T(n))return[!1,void 0];switch(t.toLowerCase()){case"filename":if(T((i=n.binaryfile)==null?void 0:i.filename))return[!0,n.binaryfile.filename];break;case"cursor":if(T((s=n.binaryfile)==null?void 0:s.cursor))return[!0,n.binaryfile.cursor];break}const r=Wh(n.book,n.player,t);return[T(r),r]},set(e,t,n){const r=St(e.id());return T(r)?(Gh(r.book,r.player,t,n),[!0,n]):[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Te).join(" ");return ge("$2",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Te(n),s=r.map(Te).join(" ");return ge("$2",`!${s};${i}`),0}).command("bin",cM).command("send",(e,t)=>{const[n,r]=it(st(e,t),0,[X.STRING,X.ANY]);return e.message({id:Hn(),sender:e.id(),target:n,data:r}),0});var Fi=(e=>(e[e.ANY=0]="ANY",e[e.SKIP=1]="SKIP",e[e.WORD_TYPE=2]="WORD_TYPE",e[e.ARRAY=3]="ARRAY",e[e.OBJECT=4]="OBJECT",e[e.READ_ONLY=5]="READ_ONLY",e))(Fi||{});const Es={type:0},Io={type:1},ci={type:2,kind:"string"},Ne={type:2,kind:"number"},uM={type:2,kind:"collision"},V_={type:2,kind:"color"},Co={type:5},Dc={type:4,element:Es,props:{kind:Co,name:Co,code:Io,sender:Io,data:Io,id:Co,cycle:Ne,x:Ne,y:Ne,lx:Ne,ly:Ne,char:Ne,color:V_,bg:V_,pushable:Ne,collision:uM,destructible:Ne,p1:Es,p2:Es,p3:Es,stepx:Es,stepy:Es}},hM={type:4,props:{id:Io,terrain:{type:3,element:Dc,fixed:$w},objects:{type:4,element:Dc},isdark:Ne,over:ci,under:ci,exitnorth:ci,exitsouth:ci,exitwest:ci,exiteast:ci,timelimit:Ne,restartonzap:Ne,maxplayershots:Ne}},Y_={type:4,props:{width:Co,height:Co,size:Io,bits:{type:3,element:Ne,fixed:-1}}},fM={type:4,props:{tempo:Ne,synths:{type:3,element:{type:4,props:{synth:Ne,effects:{type:3,element:{type:4,props:{fx:Ne,settings:{type:4,numkey:!0,element:ci}}}},settings:{type:4,numkey:!0,element:ci}}},fixed:8},measures:{type:3,element:{type:3,element:Ne,fixed:8}}}},dM="$dkpurple";function Wn(e){ge("mods",`${dM}$blue${e}`)}const q_=new Map;function Jh(e){let t=q_.get(e);return T(t)||(t={type:ut.ERROR,target:"",value:void 0,schema:void 0},q_.set(e,t)),t}function X_(e,t){switch(e.target=t.id,To(t)){case ut.ERROR:case ut.LOADER:break;case ut.BOARD:e.type=ut.BOARD,e.value=t.board,e.schema=hM;break;case ut.OBJECT:e.type=ut.OBJECT,e.value=t.object,e.schema=Dc;break;case ut.TERRAIN:e.type=ut.TERRAIN,e.value=t.terrain,e.schema=Dc;break;case ut.CHARSET:e.type=ut.CHARSET,e.value=t.charset,e.schema=Y_;break;case ut.PALETTE:e.type=ut.PALETTE,e.value=t.palette,e.schema=Y_;break;case ut.EIGHT_TRACK:e.type=ut.EIGHT_TRACK,e.value=t.eighttrack,e.schema=fM;break}const n=Pi(t);Wn(`modifying [${n}] ${ln(t)} ${e.target}`)}function li(e,t,n,r){let i=Nc(t.book,n,r);if(T(i))return i;const s=I_(n);return i=R_(s==="object"?`@${r}
`:`@${s} ${r}
`,{}),T(i)&&(C_(t.book,i),X_(e,i),As("mods")),i}const pM=Ai({get(){return[!1,void 0]},set(){return[!1,void 0]},shouldtick(){},tick(){},tock(){}}).command("mod",(e,t)=>{const n=St(e.id()),r=Jh(e.id()),[i,s]=it(st(e,t),0,[X.MAYBE_STRING,X.MAYBE_STRING]);if(!T(i)){if(r.target==="")Wn("not currently modifying anything");else{const c=si(n.book,r.target),l=Pi(c);Wn(`modifying [${l}] ${ln(c)} ${r.target}`)}return 0}const o=i.toLowerCase(),a=s??df();switch(o){default:{const c=si(n.book,i);if(T(c))X_(r,c);else{const l=i||df();li(r,n,ut.OBJECT,l)}break}case ie.LOADER:li(r,n,ut.LOADER,a);break;case ie.BOARD:li(r,n,ut.BOARD,a);break;case ie.OBJECT:li(r,n,ut.OBJECT,a);break;case ie.TERRAIN:li(r,n,ut.TERRAIN,a);break;case ie.CHARSET:li(r,n,ut.CHARSET,a);break;case ie.PALETTE:li(r,n,ut.PALETTE,a);break;case ie.EIGHT_TRACK:li(r,n,ut.EIGHT_TRACK,a);break}return 0}).command("read",(e,t)=>{var s,o,a,c;const n=Jh(e.id());if(!T(n.value))return Wn("use #mod before #read"),0;const[r,i]=it(st(e,t),0,[X.MAYBE_STRING,X.MAYBE_STRING]);if(!T(r)){if(((s=n.schema)==null?void 0:s.type)===Fi.OBJECT&&T(n.schema.props)){const l=[],u=[],f=Object.keys(n.schema.props);for(let d=0;d<f.length;++d){const h=f[d];switch((o=n.schema.props)==null?void 0:o[h].type){case Fi.SKIP:break;case Fi.READ_ONLY:u.push(h);break;default:l.push(h);break}}Wn(`write stats [${l.join(", ")}]`),Wn(`read only stats [${u.join(", ")}]`)}return 0}if(!T(i)){if(((a=n.schema)==null?void 0:a.type)===Fi.OBJECT){const l=Object.keys(((c=n.schema)==null?void 0:c.props)??{}),u=r.toLowerCase();if(l.includes(u)){const f=n.value[u];(Lt(f)||qt(f)||Kb(f))&&Wn(`stat ${u} is ${f}`),Le(f)&&Wn(`stat ${u} is an array`),f===void 0&&Wn(`stat ${u} is not set`)}}return 0}return 0}).command("write",(e,t)=>{var s,o;const n=St(e.id()),r=Jh(e.id());if(!T(r.value))return Wn("use #mod before #write"),0;const[i]=it(st(e,t),0,[X.STRING]);if(((s=r.schema)==null?void 0:s.type)===Fi.OBJECT){const a=(o=r.schema.props)==null?void 0:o[i];if(T(a))switch(a.type){case Fi.WORD_TYPE:{const c={string:X.STRING,number:X.NUMBER,collision:X.COLLISION,color:X.COLOR};let[l]=it(st(e,t),1,[c[a.kind]]);if(a.kind==="color"&&rn(l)){const{color:h,bg:p}=Md(l);l=h??p??0}a.kind==="collision"&&Kr(l)&&(l=kE(l)),r.value[i]=l;const u=`${l}`,f=si(n.book,r.target),d=Pi(f);Wn(`wrote [${d}] ${ln(f)} ${i} = ${u}`);break}}}return 0});var Pc=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.CODE_PAGE=3]="CODE_PAGE",e))(Pc||{});const mM={all:EI,audio:xI,cli:GL,element:YL,gadget:aM,loader:lM,mods:pM},gM={0:[],1:["all","audio","mods","element","cli"],2:["all","audio","mods","element","loader"],3:["all","audio","mods","element","gadget"]};function yM(e,t){(gM[t]??[]).forEach(r=>e.install(mM[r]))}function Bc(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var J_={exports:{}};/*!

  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>

  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  */(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof Bc=="function"&&Bc;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(p){var m=r[l][1][p];return o(m||p)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof Bc=="function"&&Bc,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,p,m,b=[],g=0,x=c.length,S=x,w=s.getTypeOf(c)!=="string";g<c.length;)S=x-g,f=w?(l=c[g++],u=g<x?c[g++]:0,g<x?c[g++]:0):(l=c.charCodeAt(g++),u=g<x?c.charCodeAt(g++):0,g<x?c.charCodeAt(g++):0),d=l>>2,h=(3&l)<<4|u>>4,p=1<S?(15&u)<<2|f>>6:64,m=2<S?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var l,u,f,d,h,p,m=0,b=0,g="data:";if(c.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var x,S=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&S--,c.charAt(c.length-2)===a.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=o.uint8array?new Uint8Array(0|S):new Array(0|S);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(m++)))>>2,f=(3&h)<<6|(p=a.indexOf(c.charAt(m++))),x[b++]=l,h!==64&&(x[b++]=u),p!==64&&(x[b++]=f);return x}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,p){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u[m])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,p=d+f;l^=-1;for(var m=d;m<p;m++)l=l>>>8^h[255&(l^u.charCodeAt(m))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,p,m,b,g,x){var S,w,k=h.file,v=h.compression,E=x!==l.utf8encode,N=a.transformTo("string",x(k.name)),O=a.transformTo("string",l.utf8encode(k.name)),W=k.comment,Z=a.transformTo("string",x(W)),C=a.transformTo("string",l.utf8encode(W)),A=O.length!==k.name.length,y=C.length!==W.length,L="",j="",U="",q=k.dir,G=k.date,J={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(J.crc32=h.crc32,J.compressedSize=h.compressedSize,J.uncompressedSize=h.uncompressedSize);var F=0;p&&(F|=8),E||!A&&!y||(F|=2048);var B=0,ct=0;q&&(B|=16),g==="UNIX"?(ct=798,B|=function(tt,Et){var Ft=tt;return tt||(Ft=Et?16893:33204),(65535&Ft)<<16}(k.unixPermissions,q)):(ct=20,B|=function(tt){return 63&(tt||0)}(k.dosPermissions)),S=G.getUTCHours(),S<<=6,S|=G.getUTCMinutes(),S<<=5,S|=G.getUTCSeconds()/2,w=G.getUTCFullYear()-1980,w<<=4,w|=G.getUTCMonth()+1,w<<=5,w|=G.getUTCDate(),A&&(j=s(1,1)+s(u(N),4)+O,L+="up"+s(j.length,2)+j),y&&(U=s(1,1)+s(u(Z),4)+C,L+="uc"+s(U.length,2)+U);var Q="";return Q+=`
\0`,Q+=s(F,2),Q+=v.magic,Q+=s(S,2),Q+=s(w,2),Q+=s(J.crc32,4),Q+=s(J.compressedSize,4),Q+=s(J.uncompressedSize,4),Q+=s(N.length,2),Q+=s(L.length,2),{fileRecord:f.LOCAL_FILE_HEADER+Q+N+L,dirRecord:f.CENTRAL_FILE_HEADER+s(ct,2)+Q+s(Z.length,2)+"\0\0\0\0"+s(B,4)+s(b,4)+N+L+Z}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var p=h.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var m=o(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,m=o(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-h,b=function(g,x,S,w,k){var v=a.transformTo("string",k(w));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(g,2)+s(g,2)+s(x,4)+s(S,4)+s(v.length,2)+v}(this.dirRecords.length,m,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(m){p.processChunk(m)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var p=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var m=0;m<p.length;m++)try{p[m].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var p=function(x,S){var w=x||S,k=s[w];if(!k)throw new Error(w+" is not a valid compression method !");return k}(h.options.compression,c.compression),m=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,g=h.date;h._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:g,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,p){var m=d.decompressed.getContentWorker().pipe(new l);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var p=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(m){var b=new c(h);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],g=m.files;if(h.checkCRC32)for(var x=0;x<g.length;x++)b.push(f(g[x]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),g=b.files,x=0;x<g.length;x++){var S=g[x],w=S.fileNameStr,k=s.resolve(S.fileNameStr);p.file(k,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:h.createFolders}),S.dir||(p.file(k).unsafeOriginalName=w)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(k,v,E){var N,O=a.getTypeOf(v),W=a.extend(E||{},u);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(k=g(k)),W.createFolders&&(N=b(k))&&x.call(this,N,!0);var Z=O==="string"&&W.binary===!1&&W.base64===!1;E&&E.binary!==void 0||(W.binary=!Z),(v instanceof f&&v.uncompressedSize===0||W.dir||!v||v.length===0)&&(W.base64=!1,W.binary=!0,v="",W.compression="STORE",O="string");var C=null;C=v instanceof f||v instanceof c?v:p.isNode&&p.isStream(v)?new m(k,v):a.prepareContent(k,v,W.binary,W.optimizedBinaryString,W.base64);var A=new d(k,C,W);this.files[k]=A}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var v=k.lastIndexOf("/");return 0<v?k.substring(0,v):""},g=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},x=function(k,v){return v=v!==void 0?v:u.createFolders,k=g(k),this.files[k]||s.call(this,k,null,{dir:!0,createFolders:v}),this.files[k]};function S(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var w={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var v,E,N;for(v in this.files)N=this.files[v],(E=v.slice(this.root.length,v.length))&&v.slice(0,this.root.length)===this.root&&k(E,N)},filter:function(k){var v=[];return this.forEach(function(E,N){k(E,N)&&v.push(N)}),v},file:function(k,v,E){if(arguments.length!==1)return k=this.root+k,s.call(this,k,v,E),this;if(S(k)){var N=k;return this.filter(function(W,Z){return!Z.dir&&N.test(W)})}var O=this.files[this.root+k];return O&&!O.dir?O:null},folder:function(k){if(!k)return this;if(S(k))return this.filter(function(O,W){return W.dir&&k.test(O)});var v=this.root+k,E=x.call(this,v),N=this.clone();return N.root=E.name,N},remove:function(k){k=this.root+k;var v=this.files[k];if(v||(k.slice(-1)!=="/"&&(k+="/"),v=this.files[k]),v&&!v.dir)delete this.files[k];else for(var E=this.filter(function(O,W){return W.name.slice(0,k.length)===k}),N=0;N<E.length;N++)delete this.files[E[N].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var v,E={};try{if((E=a.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=E.type.toLowerCase(),E.compression=E.compression.toUpperCase(),E.type==="binarystring"&&(E.type="string"),!E.type)throw new Error("No output type specified.");a.checkSupport(E.type),E.platform!=="darwin"&&E.platform!=="freebsd"&&E.platform!=="linux"&&E.platform!=="sunos"||(E.platform="UNIX"),E.platform==="win32"&&(E.platform="DOS");var N=E.comment||this.comment||"";v=h.generateWorker(this,E,N)}catch(O){(v=new c("error")).error(O)}return new l(v,E.type||"string",E.mimeType)},generateAsync:function(k,v){return this.generateInternalStream(k).accumulate(v)},generateNodeStream:function(k,v){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(v)}};r.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new u.Promise(function(b,g){var x=[],S=p._internalType,w=p._outputType,k=p._mimeType;p.on("data",function(v,E){x.push(v),m&&m(E)}).on("error",function(v){x=[],g(v)}).on("end",function(){try{var v=function(E,N,O){switch(E){case"blob":return s.newBlob(s.transformTo("arraybuffer",N),O);case"base64":return c.encode(N);default:return s.transformTo(E,N)}}(w,function(E,N){var O,W=0,Z=null,C=0;for(O=0;O<N.length;O++)C+=N[O].length;switch(E){case"string":return N.join("");case"array":return Array.prototype.concat.apply([],N);case"uint8array":for(Z=new Uint8Array(C),O=0;O<N.length;O++)Z.set(N[O],W),W+=N[O].length;return Z;case"nodebuffer":return Buffer.concat(N);default:throw new Error("concat : unsupported type '"+E+"'")}}(S,x),k);b(v)}catch(E){g(E)}x=[]}).resume()})}function h(p,m,b){var g=m;switch(m){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=m,this._mimeType=b,s.checkSupport(g),this._worker=p.pipe(new o(g)),p.lock()}catch(x){this._worker=new a("error"),this._worker.error(x)}}h.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(g){m.call(b,g.data,g.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var m,b,g,x,S,w=p.length,k=0;for(x=0;x<w;x++)(64512&(b=p.charCodeAt(x)))==55296&&x+1<w&&(64512&(g=p.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),x++),k+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(k):new Array(k),x=S=0;S<k;x++)(64512&(b=p.charCodeAt(x)))==55296&&x+1<w&&(64512&(g=p.charCodeAt(x+1)))==56320&&(b=65536+(b-55296<<10)+(g-56320),x++),b<128?m[S++]=b:(b<2048?m[S++]=192|b>>>6:(b<65536?m[S++]=224|b>>>12:(m[S++]=240|b>>>18,m[S++]=128|b>>>12&63),m[S++]=128|b>>>6&63),m[S++]=128|63&b);return m}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(p){var m,b,g,x,S=p.length,w=new Array(2*S);for(m=b=0;m<S;)if((g=p[m++])<128)w[b++]=g;else if(4<(x=l[g]))w[b++]=65533,m+=x-1;else{for(g&=x===2?31:x===3?15:7;1<x&&m<S;)g=g<<6|63&p[m++],x--;1<x?w[b++]=65533:g<65536?w[b++]=g:(g-=65536,w[b++]=55296|g>>10&1023,w[b++]=56320|1023&g)}return w.length!==b&&(w.subarray?w=w.subarray(0,b):w.length=b),s.applyFromCharCode(w)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var p=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(x,S){var w;for((S=S||x.length)>x.length&&(S=x.length),w=S-1;0<=w&&(192&x[w])==128;)w--;return w<0||w===0?S:w+l[x[w]]>S?w:S}(p),g=p;b!==p.length&&(o.uint8array?(g=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(g=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(g),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(m){return m}function u(m,b){for(var g=0;g<m.length;++g)b[g]=255&m.charCodeAt(g);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(m),g.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,b,g){var x=[],S=0,w=m.length;if(w<=g)return String.fromCharCode.apply(null,m);for(;S<w;)b==="array"||b==="nodebuffer"?x.push(String.fromCharCode.apply(null,m.slice(S,Math.min(S+g,w)))):x.push(String.fromCharCode.apply(null,m.subarray(S,Math.min(S+g,w)))),S+=g;return x.join("")},stringifyByChar:function(m){for(var b="",g=0;g<m.length;g++)b+=String.fromCharCode(m[g]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,g=i.getTypeOf(m),x=!0;if(g==="uint8array"?x=f.applyCanBeUsed.uint8array:g==="nodebuffer"&&(x=f.applyCanBeUsed.nodebuffer),x)for(;1<b;)try{return f.stringifyByChunk(m,g,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(m)}function h(m,b){for(var g=0;g<m.length;g++)b[g]=m[g];return b}i.applyFromCharCode=d;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:d,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return h(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var g=i.getTypeOf(b);return p[g][m](b)},i.resolve=function(m){for(var b=m.split("/"),g=[],x=0;x<b.length;x++){var S=b[x];S==="."||S===""&&x!==0&&x!==b.length-1||(S===".."?g.pop():g.push(S))}return g.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,g,x="";for(g=0;g<(m||"").length;g++)x+="\\x"+((b=m.charCodeAt(g))<16?"0":"")+b.toString(16).toUpperCase();return x},i.delay=function(m,b,g){setImmediate(function(){m.apply(g||null,b||[])})},i.inherits=function(m,b){function g(){}g.prototype=b.prototype,m.prototype=new g},i.extend=function(){var m,b,g={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&g[b]===void 0&&(g[b]=arguments[m][b]);return g},i.prepareContent=function(m,b,g,x,S){return c.Promise.resolve(b).then(function(w){return s.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader<"u"?new c.Promise(function(k,v){var E=new FileReader;E.onload=function(N){k(N.target.result)},E.onerror=function(N){v(N.target.error)},E.readAsArrayBuffer(w)}):w}).then(function(w){var k=i.getTypeOf(w);return k?(k==="arraybuffer"?w=i.transformTo("uint8array",w):k==="string"&&(S?w=o.decode(w):g&&x!==!0&&(w=function(v){return u(v,s.uint8array?new Uint8Array(v.length):new Array(v.length))}(w))),w):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var p=this.reader.readString(4)===d;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,p=this.zip64EndOfCentralSize-44;0<p;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=d-h;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,p){this.options=h,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,m;if(h.skip(22),this.fileNameLength=h.readInt(2),m=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var g in u)if(Object.prototype.hasOwnProperty.call(u,g)&&u[g].magic===b)return u[g];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,m,b,g=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<g;)p=h.readInt(2),m=h.readInt(2),b=h.readData(m),this.extraFields[p]={id:p,length:m,value:b};h.setIndex(g)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var g=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=s(h.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var g=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var x=!this._dataBinary;x&&!g&&(m=m.pipe(new c.Utf8EncodeWorker)),!x&&g&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(S){(m=new u("error")).error(S)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var h=[];function p(){var m,b;a=!0;for(var g=h.length;g;){for(b=h,h=[],m=-1;++m<g;)b[m]();g=h.length}a=!1}r.exports=function(m){h.push(m)!==1||a||o()}}).call(this,typeof Be<"u"?Be:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,g!==o&&m(this,g)}function d(g,x,S){this.promise=g,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function h(g,x,S){s(function(){var w;try{w=x(S)}catch(k){return a.reject(g,k)}w===g?a.reject(g,new TypeError("Cannot resolve promise with itself")):a.resolve(g,w)})}function p(g){var x=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof x=="function")return function(){x.apply(g,arguments)}}function m(g,x){var S=!1;function w(E){S||(S=!0,a.reject(g,E))}function k(E){S||(S=!0,a.resolve(g,E))}var v=b(function(){x(k,w)});v.status==="error"&&w(v.value)}function b(g,x){var S={};try{S.value=g(x),S.status="success"}catch(w){S.status="error",S.value=w}return S}(r.exports=f).prototype.finally=function(g){if(typeof g!="function")return this;var x=this.constructor;return this.then(function(S){return x.resolve(g()).then(function(){return S})},function(S){return x.resolve(g()).then(function(){throw S})})},f.prototype.catch=function(g){return this.then(null,g)},f.prototype.then=function(g,x){if(typeof g!="function"&&this.state===l||typeof x!="function"&&this.state===c)return this;var S=new this.constructor(o);return this.state!==u?h(S,this.state===l?g:x,this.outcome):this.queue.push(new d(S,g,x)),S},d.prototype.callFulfilled=function(g){a.resolve(this.promise,g)},d.prototype.otherCallFulfilled=function(g){h(this.promise,this.onFulfilled,g)},d.prototype.callRejected=function(g){a.reject(this.promise,g)},d.prototype.otherCallRejected=function(g){h(this.promise,this.onRejected,g)},a.resolve=function(g,x){var S=b(p,x);if(S.status==="error")return a.reject(g,S.value);var w=S.value;if(w)m(g,w);else{g.state=l,g.outcome=x;for(var k=-1,v=g.queue.length;++k<v;)g.queue[k].callFulfilled(x)}return g},a.reject=function(g,x){g.state=c,g.outcome=x;for(var S=-1,w=g.queue.length;++S<w;)g.queue[S].callRejected(x);return g},f.resolve=function(g){return g instanceof this?g:a.resolve(new this(o),g)},f.reject=function(g){var x=new this(o);return a.reject(x,g)},f.all=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=g.length,w=!1;if(!S)return this.resolve([]);for(var k=new Array(S),v=0,E=-1,N=new this(o);++E<S;)O(g[E],E);return N;function O(W,Z){x.resolve(W).then(function(C){k[Z]=C,++v!==S||w||(w=!0,a.resolve(N,k))},function(C){w||(w=!0,a.reject(N,C))})}},f.race=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=g.length,w=!1;if(!S)return this.resolve([]);for(var k=-1,v=new this(o);++k<S;)E=g[k],x.resolve(E).then(function(N){w||(w=!0,a.resolve(v,N))},function(N){w||(w=!0,a.reject(v,N))});var E;return v}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,p=8;function m(g){if(!(this instanceof m))return new m(g);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},g||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var S=s.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(S!==f)throw new Error(c[S]);if(x.header&&s.deflateSetHeader(this.strm,x.header),x.dictionary){var w;if(w=typeof x.dictionary=="string"?a.string2buf(x.dictionary):u.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(S=s.deflateSetDictionary(this.strm,w))!==f)throw new Error(c[S]);this._dict_set=!0}}function b(g,x){var S=new m(x);if(S.push(g,!0),S.err)throw S.msg||c[S.err];return S.result}m.prototype.push=function(g,x){var S,w,k=this.strm,v=this.options.chunkSize;if(this.ended)return!1;w=x===~~x?x:x===!0?4:0,typeof g=="string"?k.input=a.string2buf(g):u.call(g)==="[object ArrayBuffer]"?k.input=new Uint8Array(g):k.input=g,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new o.Buf8(v),k.next_out=0,k.avail_out=v),(S=s.deflate(k,w))!==1&&S!==f)return this.onEnd(S),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(k.output,k.next_out))):this.onData(o.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&S!==1);return w===4?(S=s.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===f):w!==2||(this.onEnd(f),!(k.avail_out=0))},m.prototype.onData=function(g){this.chunks.push(g)},m.prototype.onEnd=function(g){g===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(g,x){return(x=x||{}).raw=!0,b(g,x)},i.gzip=function(g,x){return(x=x||{}).gzip=!0,b(g,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(m){if(!(this instanceof h))return new h(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var g=s.inflateInit2(this.strm,b.windowBits);if(g!==c.Z_OK)throw new Error(l[g]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var g=new h(b);if(g.push(m,!0),g.err)throw g.msg||l[g.err];return g.result}h.prototype.push=function(m,b){var g,x,S,w,k,v,E=this.strm,N=this.options.chunkSize,O=this.options.dictionary,W=!1;if(this.ended)return!1;x=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?E.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?E.input=new Uint8Array(m):E.input=m,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new o.Buf8(N),E.next_out=0,E.avail_out=N),(g=s.inflate(E,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&O&&(v=typeof O=="string"?a.string2buf(O):d.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,g=s.inflateSetDictionary(this.strm,v)),g===c.Z_BUF_ERROR&&W===!0&&(g=c.Z_OK,W=!1),g!==c.Z_STREAM_END&&g!==c.Z_OK)return this.onEnd(g),!(this.ended=!0);E.next_out&&(E.avail_out!==0&&g!==c.Z_STREAM_END&&(E.avail_in!==0||x!==c.Z_FINISH&&x!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=a.utf8border(E.output,E.next_out),w=E.next_out-S,k=a.buf2string(E.output,S),E.next_out=w,E.avail_out=N-w,w&&o.arraySet(E.output,E.output,S,w,0),this.onData(k)):this.onData(o.shrinkBuf(E.output,E.next_out)))),E.avail_in===0&&E.avail_out===0&&(W=!0)}while((0<E.avail_in||E.avail_out===0)&&g!==c.Z_STREAM_END);return g===c.Z_STREAM_END&&(x=c.Z_FINISH),x===c.Z_FINISH?(g=s.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===c.Z_OK):x!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(E.avail_out=0))},h.prototype.onData=function(m){this.chunks.push(m)},h.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,p;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(p=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],p.set(h,d),d+=h.length;return p}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",p=0;p<d;p++)h+=String.fromCharCode(f[p]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,p,m,b,g=f.length,x=0;for(m=0;m<g;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<g&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),x+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(x),m=b=0;b<x;m++)(64512&(h=f.charCodeAt(m)))==55296&&m+1<g&&(64512&(p=f.charCodeAt(m+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),m++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,p=d.length;h<p;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,p,m,b,g=d||f.length,x=new Array(2*g);for(h=p=0;h<g;)if((m=f[h++])<128)x[p++]=m;else if(4<(b=c[m]))x[p++]=65533,h+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&h<g;)m=m<<6|63&f[h++],b--;1<b?x[p++]=65533:m<65536?x[p++]=m:(m-=65536,x[p++]=55296|m>>10&1023,x[p++]=56320|1023&m)}return u(x,p)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,p=-2,m=-1,b=4,g=2,x=8,S=9,w=286,k=30,v=19,E=2*w+1,N=15,O=3,W=258,Z=W+O+1,C=42,A=113,y=1,L=2,j=3,U=4;function q(_,H){return _.msg=u[H],H}function G(_){return(_<<1)-(4<_?9:0)}function J(_){for(var H=_.length;0<=--H;)_[H]=0}function F(_){var H=_.state,K=H.pending;K>_.avail_out&&(K=_.avail_out),K!==0&&(o.arraySet(_.output,H.pending_buf,H.pending_out,K,_.next_out),_.next_out+=K,H.pending_out+=K,_.total_out+=K,_.avail_out-=K,H.pending-=K,H.pending===0&&(H.pending_out=0))}function B(_,H){a._tr_flush_block(_,0<=_.block_start?_.block_start:-1,_.strstart-_.block_start,H),_.block_start=_.strstart,F(_.strm)}function ct(_,H){_.pending_buf[_.pending++]=H}function Q(_,H){_.pending_buf[_.pending++]=H>>>8&255,_.pending_buf[_.pending++]=255&H}function tt(_,H){var K,I,R=_.max_chain_length,P=_.strstart,V=_.prev_length,Y=_.nice_match,$=_.strstart>_.w_size-Z?_.strstart-(_.w_size-Z):0,et=_.window,at=_.w_mask,nt=_.prev,ht=_.strstart+W,Ht=et[P+V-1],Ct=et[P+V];_.prev_length>=_.good_match&&(R>>=2),Y>_.lookahead&&(Y=_.lookahead);do if(et[(K=H)+V]===Ct&&et[K+V-1]===Ht&&et[K]===et[P]&&et[++K]===et[P+1]){P+=2,K++;do;while(et[++P]===et[++K]&&et[++P]===et[++K]&&et[++P]===et[++K]&&et[++P]===et[++K]&&et[++P]===et[++K]&&et[++P]===et[++K]&&et[++P]===et[++K]&&et[++P]===et[++K]&&P<ht);if(I=W-(ht-P),P=ht-W,V<I){if(_.match_start=H,Y<=(V=I))break;Ht=et[P+V-1],Ct=et[P+V]}}while((H=nt[H&at])>$&&--R!=0);return V<=_.lookahead?V:_.lookahead}function Et(_){var H,K,I,R,P,V,Y,$,et,at,nt=_.w_size;do{if(R=_.window_size-_.lookahead-_.strstart,_.strstart>=nt+(nt-Z)){for(o.arraySet(_.window,_.window,nt,nt,0),_.match_start-=nt,_.strstart-=nt,_.block_start-=nt,H=K=_.hash_size;I=_.head[--H],_.head[H]=nt<=I?I-nt:0,--K;);for(H=K=nt;I=_.prev[--H],_.prev[H]=nt<=I?I-nt:0,--K;);R+=nt}if(_.strm.avail_in===0)break;if(V=_.strm,Y=_.window,$=_.strstart+_.lookahead,et=R,at=void 0,at=V.avail_in,et<at&&(at=et),K=at===0?0:(V.avail_in-=at,o.arraySet(Y,V.input,V.next_in,at,$),V.state.wrap===1?V.adler=c(V.adler,Y,at,$):V.state.wrap===2&&(V.adler=l(V.adler,Y,at,$)),V.next_in+=at,V.total_in+=at,at),_.lookahead+=K,_.lookahead+_.insert>=O)for(P=_.strstart-_.insert,_.ins_h=_.window[P],_.ins_h=(_.ins_h<<_.hash_shift^_.window[P+1])&_.hash_mask;_.insert&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[P+O-1])&_.hash_mask,_.prev[P&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=P,P++,_.insert--,!(_.lookahead+_.insert<O)););}while(_.lookahead<Z&&_.strm.avail_in!==0)}function Ft(_,H){for(var K,I;;){if(_.lookahead<Z){if(Et(_),_.lookahead<Z&&H===f)return y;if(_.lookahead===0)break}if(K=0,_.lookahead>=O&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,K=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),K!==0&&_.strstart-K<=_.w_size-Z&&(_.match_length=tt(_,K)),_.match_length>=O)if(I=a._tr_tally(_,_.strstart-_.match_start,_.match_length-O),_.lookahead-=_.match_length,_.match_length<=_.max_lazy_match&&_.lookahead>=O){for(_.match_length--;_.strstart++,_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,K=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart,--_.match_length!=0;);_.strstart++}else _.strstart+=_.match_length,_.match_length=0,_.ins_h=_.window[_.strstart],_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+1])&_.hash_mask;else I=a._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++;if(I&&(B(_,!1),_.strm.avail_out===0))return y}return _.insert=_.strstart<O-1?_.strstart:O-1,H===d?(B(_,!0),_.strm.avail_out===0?j:U):_.last_lit&&(B(_,!1),_.strm.avail_out===0)?y:L}function _t(_,H){for(var K,I,R;;){if(_.lookahead<Z){if(Et(_),_.lookahead<Z&&H===f)return y;if(_.lookahead===0)break}if(K=0,_.lookahead>=O&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,K=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),_.prev_length=_.match_length,_.prev_match=_.match_start,_.match_length=O-1,K!==0&&_.prev_length<_.max_lazy_match&&_.strstart-K<=_.w_size-Z&&(_.match_length=tt(_,K),_.match_length<=5&&(_.strategy===1||_.match_length===O&&4096<_.strstart-_.match_start)&&(_.match_length=O-1)),_.prev_length>=O&&_.match_length<=_.prev_length){for(R=_.strstart+_.lookahead-O,I=a._tr_tally(_,_.strstart-1-_.prev_match,_.prev_length-O),_.lookahead-=_.prev_length-1,_.prev_length-=2;++_.strstart<=R&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+O-1])&_.hash_mask,K=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),--_.prev_length!=0;);if(_.match_available=0,_.match_length=O-1,_.strstart++,I&&(B(_,!1),_.strm.avail_out===0))return y}else if(_.match_available){if((I=a._tr_tally(_,0,_.window[_.strstart-1]))&&B(_,!1),_.strstart++,_.lookahead--,_.strm.avail_out===0)return y}else _.match_available=1,_.strstart++,_.lookahead--}return _.match_available&&(I=a._tr_tally(_,0,_.window[_.strstart-1]),_.match_available=0),_.insert=_.strstart<O-1?_.strstart:O-1,H===d?(B(_,!0),_.strm.avail_out===0?j:U):_.last_lit&&(B(_,!1),_.strm.avail_out===0)?y:L}function yt(_,H,K,I,R){this.good_length=_,this.max_lazy=H,this.nice_length=K,this.max_chain=I,this.func=R}function zt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*E),this.dyn_dtree=new o.Buf16(2*(2*k+1)),this.bl_tree=new o.Buf16(2*(2*v+1)),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(N+1),this.heap=new o.Buf16(2*w+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*w+1),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dt(_){var H;return _&&_.state?(_.total_in=_.total_out=0,_.data_type=g,(H=_.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?C:A,_.adler=H.wrap===2?0:1,H.last_flush=f,a._tr_init(H),h):q(_,p)}function pe(_){var H=Dt(_);return H===h&&function(K){K.window_size=2*K.w_size,J(K.head),K.max_lazy_match=s[K.level].max_lazy,K.good_match=s[K.level].good_length,K.nice_match=s[K.level].nice_length,K.max_chain_length=s[K.level].max_chain,K.strstart=0,K.block_start=0,K.lookahead=0,K.insert=0,K.match_length=K.prev_length=O-1,K.match_available=0,K.ins_h=0}(_.state),H}function ke(_,H,K,I,R,P){if(!_)return p;var V=1;if(H===m&&(H=6),I<0?(V=0,I=-I):15<I&&(V=2,I-=16),R<1||S<R||K!==x||I<8||15<I||H<0||9<H||P<0||b<P)return q(_,p);I===8&&(I=9);var Y=new zt;return(_.state=Y).strm=_,Y.wrap=V,Y.gzhead=null,Y.w_bits=I,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=R+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+O-1)/O),Y.window=new o.Buf8(2*Y.w_size),Y.head=new o.Buf16(Y.hash_size),Y.prev=new o.Buf16(Y.w_size),Y.lit_bufsize=1<<R+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new o.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=H,Y.strategy=P,Y.method=K,pe(_)}s=[new yt(0,0,0,0,function(_,H){var K=65535;for(K>_.pending_buf_size-5&&(K=_.pending_buf_size-5);;){if(_.lookahead<=1){if(Et(_),_.lookahead===0&&H===f)return y;if(_.lookahead===0)break}_.strstart+=_.lookahead,_.lookahead=0;var I=_.block_start+K;if((_.strstart===0||_.strstart>=I)&&(_.lookahead=_.strstart-I,_.strstart=I,B(_,!1),_.strm.avail_out===0)||_.strstart-_.block_start>=_.w_size-Z&&(B(_,!1),_.strm.avail_out===0))return y}return _.insert=0,H===d?(B(_,!0),_.strm.avail_out===0?j:U):(_.strstart>_.block_start&&(B(_,!1),_.strm.avail_out),y)}),new yt(4,4,8,4,Ft),new yt(4,5,16,8,Ft),new yt(4,6,32,32,Ft),new yt(4,4,16,16,_t),new yt(8,16,32,32,_t),new yt(8,16,128,128,_t),new yt(8,32,128,256,_t),new yt(32,128,258,1024,_t),new yt(32,258,258,4096,_t)],i.deflateInit=function(_,H){return ke(_,H,x,15,8,0)},i.deflateInit2=ke,i.deflateReset=pe,i.deflateResetKeep=Dt,i.deflateSetHeader=function(_,H){return _&&_.state?_.state.wrap!==2?p:(_.state.gzhead=H,h):p},i.deflate=function(_,H){var K,I,R,P;if(!_||!_.state||5<H||H<0)return _?q(_,p):p;if(I=_.state,!_.output||!_.input&&_.avail_in!==0||I.status===666&&H!==d)return q(_,_.avail_out===0?-5:p);if(I.strm=_,K=I.last_flush,I.last_flush=H,I.status===C)if(I.wrap===2)_.adler=0,ct(I,31),ct(I,139),ct(I,8),I.gzhead?(ct(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),ct(I,255&I.gzhead.time),ct(I,I.gzhead.time>>8&255),ct(I,I.gzhead.time>>16&255),ct(I,I.gzhead.time>>24&255),ct(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),ct(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(ct(I,255&I.gzhead.extra.length),ct(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(_.adler=l(_.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(ct(I,0),ct(I,0),ct(I,0),ct(I,0),ct(I,0),ct(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),ct(I,3),I.status=A);else{var V=x+(I.w_bits-8<<4)<<8;V|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(V|=32),V+=31-V%31,I.status=A,Q(I,V),I.strstart!==0&&(Q(I,_.adler>>>16),Q(I,65535&_.adler)),_.adler=1}if(I.status===69)if(I.gzhead.extra){for(R=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>R&&(_.adler=l(_.adler,I.pending_buf,I.pending-R,R)),F(_),R=I.pending,I.pending!==I.pending_buf_size));)ct(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>R&&(_.adler=l(_.adler,I.pending_buf,I.pending-R,R)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){R=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>R&&(_.adler=l(_.adler,I.pending_buf,I.pending-R,R)),F(_),R=I.pending,I.pending===I.pending_buf_size)){P=1;break}P=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,ct(I,P)}while(P!==0);I.gzhead.hcrc&&I.pending>R&&(_.adler=l(_.adler,I.pending_buf,I.pending-R,R)),P===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){R=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>R&&(_.adler=l(_.adler,I.pending_buf,I.pending-R,R)),F(_),R=I.pending,I.pending===I.pending_buf_size)){P=1;break}P=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,ct(I,P)}while(P!==0);I.gzhead.hcrc&&I.pending>R&&(_.adler=l(_.adler,I.pending_buf,I.pending-R,R)),P===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&F(_),I.pending+2<=I.pending_buf_size&&(ct(I,255&_.adler),ct(I,_.adler>>8&255),_.adler=0,I.status=A)):I.status=A),I.pending!==0){if(F(_),_.avail_out===0)return I.last_flush=-1,h}else if(_.avail_in===0&&G(H)<=G(K)&&H!==d)return q(_,-5);if(I.status===666&&_.avail_in!==0)return q(_,-5);if(_.avail_in!==0||I.lookahead!==0||H!==f&&I.status!==666){var Y=I.strategy===2?function($,et){for(var at;;){if($.lookahead===0&&(Et($),$.lookahead===0)){if(et===f)return y;break}if($.match_length=0,at=a._tr_tally($,0,$.window[$.strstart]),$.lookahead--,$.strstart++,at&&(B($,!1),$.strm.avail_out===0))return y}return $.insert=0,et===d?(B($,!0),$.strm.avail_out===0?j:U):$.last_lit&&(B($,!1),$.strm.avail_out===0)?y:L}(I,H):I.strategy===3?function($,et){for(var at,nt,ht,Ht,Ct=$.window;;){if($.lookahead<=W){if(Et($),$.lookahead<=W&&et===f)return y;if($.lookahead===0)break}if($.match_length=0,$.lookahead>=O&&0<$.strstart&&(nt=Ct[ht=$.strstart-1])===Ct[++ht]&&nt===Ct[++ht]&&nt===Ct[++ht]){Ht=$.strstart+W;do;while(nt===Ct[++ht]&&nt===Ct[++ht]&&nt===Ct[++ht]&&nt===Ct[++ht]&&nt===Ct[++ht]&&nt===Ct[++ht]&&nt===Ct[++ht]&&nt===Ct[++ht]&&ht<Ht);$.match_length=W-(Ht-ht),$.match_length>$.lookahead&&($.match_length=$.lookahead)}if($.match_length>=O?(at=a._tr_tally($,1,$.match_length-O),$.lookahead-=$.match_length,$.strstart+=$.match_length,$.match_length=0):(at=a._tr_tally($,0,$.window[$.strstart]),$.lookahead--,$.strstart++),at&&(B($,!1),$.strm.avail_out===0))return y}return $.insert=0,et===d?(B($,!0),$.strm.avail_out===0?j:U):$.last_lit&&(B($,!1),$.strm.avail_out===0)?y:L}(I,H):s[I.level].func(I,H);if(Y!==j&&Y!==U||(I.status=666),Y===y||Y===j)return _.avail_out===0&&(I.last_flush=-1),h;if(Y===L&&(H===1?a._tr_align(I):H!==5&&(a._tr_stored_block(I,0,0,!1),H===3&&(J(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),F(_),_.avail_out===0))return I.last_flush=-1,h}return H!==d?h:I.wrap<=0?1:(I.wrap===2?(ct(I,255&_.adler),ct(I,_.adler>>8&255),ct(I,_.adler>>16&255),ct(I,_.adler>>24&255),ct(I,255&_.total_in),ct(I,_.total_in>>8&255),ct(I,_.total_in>>16&255),ct(I,_.total_in>>24&255)):(Q(I,_.adler>>>16),Q(I,65535&_.adler)),F(_),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?h:1)},i.deflateEnd=function(_){var H;return _&&_.state?(H=_.state.status)!==C&&H!==69&&H!==73&&H!==91&&H!==103&&H!==A&&H!==666?q(_,p):(_.state=null,H===A?q(_,-3):h):p},i.deflateSetDictionary=function(_,H){var K,I,R,P,V,Y,$,et,at=H.length;if(!_||!_.state||(P=(K=_.state).wrap)===2||P===1&&K.status!==C||K.lookahead)return p;for(P===1&&(_.adler=c(_.adler,H,at,0)),K.wrap=0,at>=K.w_size&&(P===0&&(J(K.head),K.strstart=0,K.block_start=0,K.insert=0),et=new o.Buf8(K.w_size),o.arraySet(et,H,at-K.w_size,K.w_size,0),H=et,at=K.w_size),V=_.avail_in,Y=_.next_in,$=_.input,_.avail_in=at,_.next_in=0,_.input=H,Et(K);K.lookahead>=O;){for(I=K.strstart,R=K.lookahead-(O-1);K.ins_h=(K.ins_h<<K.hash_shift^K.window[I+O-1])&K.hash_mask,K.prev[I&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=I,I++,--R;);K.strstart=I,K.lookahead=O-1,Et(K)}return K.strstart+=K.lookahead,K.block_start=K.strstart,K.insert=K.lookahead,K.lookahead=0,K.match_length=K.prev_length=O-1,K.match_available=0,_.next_in=Y,_.input=$,_.avail_in=V,K.wrap=P,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,p,m,b,g,x,S,w,k,v,E,N,O,W,Z,C,A,y,L;a=s.state,c=s.next_in,y=s.input,l=c+(s.avail_in-5),u=s.next_out,L=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,g=a.window,x=a.hold,S=a.bits,w=a.lencode,k=a.distcode,v=(1<<a.lenbits)-1,E=(1<<a.distbits)-1;t:do{S<15&&(x+=y[c++]<<S,S+=8,x+=y[c++]<<S,S+=8),N=w[x&v];e:for(;;){if(x>>>=O=N>>>24,S-=O,(O=N>>>16&255)===0)L[u++]=65535&N;else{if(!(16&O)){if(!(64&O)){N=w[(65535&N)+(x&(1<<O)-1)];continue e}if(32&O){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}W=65535&N,(O&=15)&&(S<O&&(x+=y[c++]<<S,S+=8),W+=x&(1<<O)-1,x>>>=O,S-=O),S<15&&(x+=y[c++]<<S,S+=8,x+=y[c++]<<S,S+=8),N=k[x&E];n:for(;;){if(x>>>=O=N>>>24,S-=O,!(16&(O=N>>>16&255))){if(!(64&O)){N=k[(65535&N)+(x&(1<<O)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(Z=65535&N,S<(O&=15)&&(x+=y[c++]<<S,(S+=8)<O&&(x+=y[c++]<<S,S+=8)),h<(Z+=x&(1<<O)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(x>>>=O,S-=O,(O=u-f)<Z){if(m<(O=Z-O)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(A=g,(C=0)===b){if(C+=p-O,O<W){for(W-=O;L[u++]=g[C++],--O;);C=u-Z,A=L}}else if(b<O){if(C+=p+b-O,(O-=b)<W){for(W-=O;L[u++]=g[C++],--O;);if(C=0,b<W){for(W-=O=b;L[u++]=g[C++],--O;);C=u-Z,A=L}}}else if(C+=b-O,O<W){for(W-=O;L[u++]=g[C++],--O;);C=u-Z,A=L}for(;2<W;)L[u++]=A[C++],L[u++]=A[C++],L[u++]=A[C++],W-=3;W&&(L[u++]=A[C++],1<W&&(L[u++]=A[C++]))}else{for(C=u-Z;L[u++]=L[C++],L[u++]=L[C++],L[u++]=L[C++],2<(W-=3););W&&(L[u++]=L[C++],1<W&&(L[u++]=L[C++]))}break}}break}}while(c<l&&u<d);c-=W=S>>3,x&=(1<<(S-=W<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=x,a.bits=S}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,p=1,m=852,b=592;function g(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(C){var A;return C&&C.state?(A=C.state,C.total_in=C.total_out=A.total=0,C.msg="",A.wrap&&(C.adler=1&A.wrap),A.mode=p,A.last=0,A.havedict=0,A.dmax=32768,A.head=null,A.hold=0,A.bits=0,A.lencode=A.lendyn=new s.Buf32(m),A.distcode=A.distdyn=new s.Buf32(b),A.sane=1,A.back=-1,d):h}function w(C){var A;return C&&C.state?((A=C.state).wsize=0,A.whave=0,A.wnext=0,S(C)):h}function k(C,A){var y,L;return C&&C.state?(L=C.state,A<0?(y=0,A=-A):(y=1+(A>>4),A<48&&(A&=15)),A&&(A<8||15<A)?h:(L.window!==null&&L.wbits!==A&&(L.window=null),L.wrap=y,L.wbits=A,w(C))):h}function v(C,A){var y,L;return C?(L=new x,(C.state=L).window=null,(y=k(C,A))!==d&&(C.state=null),y):h}var E,N,O=!0;function W(C){if(O){var A;for(E=new s.Buf32(512),N=new s.Buf32(32),A=0;A<144;)C.lens[A++]=8;for(;A<256;)C.lens[A++]=9;for(;A<280;)C.lens[A++]=7;for(;A<288;)C.lens[A++]=8;for(l(u,C.lens,0,288,E,0,C.work,{bits:9}),A=0;A<32;)C.lens[A++]=5;l(f,C.lens,0,32,N,0,C.work,{bits:5}),O=!1}C.lencode=E,C.lenbits=9,C.distcode=N,C.distbits=5}function Z(C,A,y,L){var j,U=C.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new s.Buf8(U.wsize)),L>=U.wsize?(s.arraySet(U.window,A,y-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(L<(j=U.wsize-U.wnext)&&(j=L),s.arraySet(U.window,A,y-L,j,U.wnext),(L-=j)?(s.arraySet(U.window,A,y-L,L,0),U.wnext=L,U.whave=U.wsize):(U.wnext+=j,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=j))),0}i.inflateReset=w,i.inflateReset2=k,i.inflateResetKeep=S,i.inflateInit=function(C){return v(C,15)},i.inflateInit2=v,i.inflate=function(C,A){var y,L,j,U,q,G,J,F,B,ct,Q,tt,Et,Ft,_t,yt,zt,Dt,pe,ke,_,H,K,I,R=0,P=new s.Buf8(4),V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return h;(y=C.state).mode===12&&(y.mode=13),q=C.next_out,j=C.output,J=C.avail_out,U=C.next_in,L=C.input,G=C.avail_in,F=y.hold,B=y.bits,ct=G,Q=J,H=d;t:for(;;)switch(y.mode){case p:if(y.wrap===0){y.mode=13;break}for(;B<16;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(2&y.wrap&&F===35615){P[y.check=0]=255&F,P[1]=F>>>8&255,y.check=a(y.check,P,2,0),B=F=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&F)<<8)+(F>>8))%31){C.msg="incorrect header check",y.mode=30;break}if((15&F)!=8){C.msg="unknown compression method",y.mode=30;break}if(B-=4,_=8+(15&(F>>>=4)),y.wbits===0)y.wbits=_;else if(_>y.wbits){C.msg="invalid window size",y.mode=30;break}y.dmax=1<<_,C.adler=y.check=1,y.mode=512&F?10:12,B=F=0;break;case 2:for(;B<16;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(y.flags=F,(255&y.flags)!=8){C.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){C.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=F>>8&1),512&y.flags&&(P[0]=255&F,P[1]=F>>>8&255,y.check=a(y.check,P,2,0)),B=F=0,y.mode=3;case 3:for(;B<32;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}y.head&&(y.head.time=F),512&y.flags&&(P[0]=255&F,P[1]=F>>>8&255,P[2]=F>>>16&255,P[3]=F>>>24&255,y.check=a(y.check,P,4,0)),B=F=0,y.mode=4;case 4:for(;B<16;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}y.head&&(y.head.xflags=255&F,y.head.os=F>>8),512&y.flags&&(P[0]=255&F,P[1]=F>>>8&255,y.check=a(y.check,P,2,0)),B=F=0,y.mode=5;case 5:if(1024&y.flags){for(;B<16;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}y.length=F,y.head&&(y.head.extra_len=F),512&y.flags&&(P[0]=255&F,P[1]=F>>>8&255,y.check=a(y.check,P,2,0)),B=F=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(G<(tt=y.length)&&(tt=G),tt&&(y.head&&(_=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),s.arraySet(y.head.extra,L,U,tt,_)),512&y.flags&&(y.check=a(y.check,L,tt,U)),G-=tt,U+=tt,y.length-=tt),y.length))break t;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(G===0)break t;for(tt=0;_=L[U+tt++],y.head&&_&&y.length<65536&&(y.head.name+=String.fromCharCode(_)),_&&tt<G;);if(512&y.flags&&(y.check=a(y.check,L,tt,U)),G-=tt,U+=tt,_)break t}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(G===0)break t;for(tt=0;_=L[U+tt++],y.head&&_&&y.length<65536&&(y.head.comment+=String.fromCharCode(_)),_&&tt<G;);if(512&y.flags&&(y.check=a(y.check,L,tt,U)),G-=tt,U+=tt,_)break t}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;B<16;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(F!==(65535&y.check)){C.msg="header crc mismatch",y.mode=30;break}B=F=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),C.adler=y.check=0,y.mode=12;break;case 10:for(;B<32;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}C.adler=y.check=g(F),B=F=0,y.mode=11;case 11:if(y.havedict===0)return C.next_out=q,C.avail_out=J,C.next_in=U,C.avail_in=G,y.hold=F,y.bits=B,2;C.adler=y.check=1,y.mode=12;case 12:if(A===5||A===6)break t;case 13:if(y.last){F>>>=7&B,B-=7&B,y.mode=27;break}for(;B<3;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}switch(y.last=1&F,B-=1,3&(F>>>=1)){case 0:y.mode=14;break;case 1:if(W(y),y.mode=20,A!==6)break;F>>>=2,B-=2;break t;case 2:y.mode=17;break;case 3:C.msg="invalid block type",y.mode=30}F>>>=2,B-=2;break;case 14:for(F>>>=7&B,B-=7&B;B<32;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if((65535&F)!=(F>>>16^65535)){C.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&F,B=F=0,y.mode=15,A===6)break t;case 15:y.mode=16;case 16:if(tt=y.length){if(G<tt&&(tt=G),J<tt&&(tt=J),tt===0)break t;s.arraySet(j,L,U,tt,q),G-=tt,U+=tt,J-=tt,q+=tt,y.length-=tt;break}y.mode=12;break;case 17:for(;B<14;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(y.nlen=257+(31&F),F>>>=5,B-=5,y.ndist=1+(31&F),F>>>=5,B-=5,y.ncode=4+(15&F),F>>>=4,B-=4,286<y.nlen||30<y.ndist){C.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;B<3;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}y.lens[V[y.have++]]=7&F,F>>>=3,B-=3}for(;y.have<19;)y.lens[V[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,K={bits:y.lenbits},H=l(0,y.lens,0,19,y.lencode,0,y.work,K),y.lenbits=K.bits,H){C.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;yt=(R=y.lencode[F&(1<<y.lenbits)-1])>>>16&255,zt=65535&R,!((_t=R>>>24)<=B);){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(zt<16)F>>>=_t,B-=_t,y.lens[y.have++]=zt;else{if(zt===16){for(I=_t+2;B<I;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(F>>>=_t,B-=_t,y.have===0){C.msg="invalid bit length repeat",y.mode=30;break}_=y.lens[y.have-1],tt=3+(3&F),F>>>=2,B-=2}else if(zt===17){for(I=_t+3;B<I;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}B-=_t,_=0,tt=3+(7&(F>>>=_t)),F>>>=3,B-=3}else{for(I=_t+7;B<I;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}B-=_t,_=0,tt=11+(127&(F>>>=_t)),F>>>=7,B-=7}if(y.have+tt>y.nlen+y.ndist){C.msg="invalid bit length repeat",y.mode=30;break}for(;tt--;)y.lens[y.have++]=_}}if(y.mode===30)break;if(y.lens[256]===0){C.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,K={bits:y.lenbits},H=l(u,y.lens,0,y.nlen,y.lencode,0,y.work,K),y.lenbits=K.bits,H){C.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,K={bits:y.distbits},H=l(f,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,K),y.distbits=K.bits,H){C.msg="invalid distances set",y.mode=30;break}if(y.mode=20,A===6)break t;case 20:y.mode=21;case 21:if(6<=G&&258<=J){C.next_out=q,C.avail_out=J,C.next_in=U,C.avail_in=G,y.hold=F,y.bits=B,c(C,Q),q=C.next_out,j=C.output,J=C.avail_out,U=C.next_in,L=C.input,G=C.avail_in,F=y.hold,B=y.bits,y.mode===12&&(y.back=-1);break}for(y.back=0;yt=(R=y.lencode[F&(1<<y.lenbits)-1])>>>16&255,zt=65535&R,!((_t=R>>>24)<=B);){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(yt&&!(240&yt)){for(Dt=_t,pe=yt,ke=zt;yt=(R=y.lencode[ke+((F&(1<<Dt+pe)-1)>>Dt)])>>>16&255,zt=65535&R,!(Dt+(_t=R>>>24)<=B);){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}F>>>=Dt,B-=Dt,y.back+=Dt}if(F>>>=_t,B-=_t,y.back+=_t,y.length=zt,yt===0){y.mode=26;break}if(32&yt){y.back=-1,y.mode=12;break}if(64&yt){C.msg="invalid literal/length code",y.mode=30;break}y.extra=15&yt,y.mode=22;case 22:if(y.extra){for(I=y.extra;B<I;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}y.length+=F&(1<<y.extra)-1,F>>>=y.extra,B-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;yt=(R=y.distcode[F&(1<<y.distbits)-1])>>>16&255,zt=65535&R,!((_t=R>>>24)<=B);){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(!(240&yt)){for(Dt=_t,pe=yt,ke=zt;yt=(R=y.distcode[ke+((F&(1<<Dt+pe)-1)>>Dt)])>>>16&255,zt=65535&R,!(Dt+(_t=R>>>24)<=B);){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}F>>>=Dt,B-=Dt,y.back+=Dt}if(F>>>=_t,B-=_t,y.back+=_t,64&yt){C.msg="invalid distance code",y.mode=30;break}y.offset=zt,y.extra=15&yt,y.mode=24;case 24:if(y.extra){for(I=y.extra;B<I;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}y.offset+=F&(1<<y.extra)-1,F>>>=y.extra,B-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){C.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(J===0)break t;if(tt=Q-J,y.offset>tt){if((tt=y.offset-tt)>y.whave&&y.sane){C.msg="invalid distance too far back",y.mode=30;break}Et=tt>y.wnext?(tt-=y.wnext,y.wsize-tt):y.wnext-tt,tt>y.length&&(tt=y.length),Ft=y.window}else Ft=j,Et=q-y.offset,tt=y.length;for(J<tt&&(tt=J),J-=tt,y.length-=tt;j[q++]=Ft[Et++],--tt;);y.length===0&&(y.mode=21);break;case 26:if(J===0)break t;j[q++]=y.length,J--,y.mode=21;break;case 27:if(y.wrap){for(;B<32;){if(G===0)break t;G--,F|=L[U++]<<B,B+=8}if(Q-=J,C.total_out+=Q,y.total+=Q,Q&&(C.adler=y.check=y.flags?a(y.check,j,Q,q-Q):o(y.check,j,Q,q-Q)),Q=J,(y.flags?F:g(F))!==y.check){C.msg="incorrect data check",y.mode=30;break}B=F=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;B<32;){if(G===0)break t;G--,F+=L[U++]<<B,B+=8}if(F!==(4294967295&y.total)){C.msg="incorrect length check",y.mode=30;break}B=F=0}y.mode=29;case 29:H=1;break t;case 30:H=-3;break t;case 31:return-4;case 32:default:return h}return C.next_out=q,C.avail_out=J,C.next_in=U,C.avail_in=G,y.hold=F,y.bits=B,(y.wsize||Q!==C.avail_out&&y.mode<30&&(y.mode<27||A!==4))&&Z(C,C.output,C.next_out,Q-C.avail_out)?(y.mode=31,-4):(ct-=C.avail_in,Q-=C.avail_out,C.total_in+=ct,C.total_out+=Q,y.total+=Q,y.wrap&&Q&&(C.adler=y.check=y.flags?a(y.check,j,Q,C.next_out-Q):o(y.check,j,Q,C.next_out-Q)),C.data_type=y.bits+(y.last?64:0)+(y.mode===12?128:0)+(y.mode===20||y.mode===15?256:0),(ct==0&&Q===0||A===4)&&H===d&&(H=-5),H)},i.inflateEnd=function(C){if(!C||!C.state)return h;var A=C.state;return A.window&&(A.window=null),C.state=null,d},i.inflateGetHeader=function(C,A){var y;return C&&C.state&&2&(y=C.state).wrap?((y.head=A).done=!1,d):h},i.inflateSetDictionary=function(C,A){var y,L=A.length;return C&&C.state?(y=C.state).wrap!==0&&y.mode!==11?h:y.mode===11&&o(1,A,L,0)!==y.check?-3:Z(C,A,L,L)?(y.mode=31,-4):(y.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,p,m,b,g){var x,S,w,k,v,E,N,O,W,Z=g.bits,C=0,A=0,y=0,L=0,j=0,U=0,q=0,G=0,J=0,F=0,B=null,ct=0,Q=new s.Buf16(16),tt=new s.Buf16(16),Et=null,Ft=0;for(C=0;C<=15;C++)Q[C]=0;for(A=0;A<h;A++)Q[f[d+A]]++;for(j=Z,L=15;1<=L&&Q[L]===0;L--);if(L<j&&(j=L),L===0)return p[m++]=20971520,p[m++]=20971520,g.bits=1,0;for(y=1;y<L&&Q[y]===0;y++);for(j<y&&(j=y),C=G=1;C<=15;C++)if(G<<=1,(G-=Q[C])<0)return-1;if(0<G&&(u===0||L!==1))return-1;for(tt[1]=0,C=1;C<15;C++)tt[C+1]=tt[C]+Q[C];for(A=0;A<h;A++)f[d+A]!==0&&(b[tt[f[d+A]]++]=A);if(E=u===0?(B=Et=b,19):u===1?(B=o,ct-=257,Et=a,Ft-=257,256):(B=c,Et=l,-1),C=y,v=m,q=A=F=0,w=-1,k=(J=1<<(U=j))-1,u===1&&852<J||u===2&&592<J)return 1;for(;;){for(N=C-q,W=b[A]<E?(O=0,b[A]):b[A]>E?(O=Et[Ft+b[A]],B[ct+b[A]]):(O=96,0),x=1<<C-q,y=S=1<<U;p[v+(F>>q)+(S-=x)]=N<<24|O<<16|W|0,S!==0;);for(x=1<<C-1;F&x;)x>>=1;if(x!==0?(F&=x-1,F+=x):F=0,A++,--Q[C]==0){if(C===L)break;C=f[d+b[A]]}if(j<C&&(F&k)!==w){for(q===0&&(q=j),v+=y,G=1<<(U=C-q);U+q<L&&!((G-=Q[U+q])<=0);)U++,G<<=1;if(J+=1<<U,u===1&&852<J||u===2&&592<J)return 1;p[w=F&k]=j<<24|U<<16|v-m|0}}return F!==0&&(p[v+F]=C-q<<24|64<<16|0),g.bits=j,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(R){for(var P=R.length;0<=--P;)R[P]=0}var l=0,u=29,f=256,d=f+1+u,h=30,p=19,m=2*d+1,b=15,g=16,x=7,S=256,w=16,k=17,v=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(d+2));c(Z);var C=new Array(2*h);c(C);var A=new Array(512);c(A);var y=new Array(256);c(y);var L=new Array(u);c(L);var j,U,q,G=new Array(h);function J(R,P,V,Y,$){this.static_tree=R,this.extra_bits=P,this.extra_base=V,this.elems=Y,this.max_length=$,this.has_stree=R&&R.length}function F(R,P){this.dyn_tree=R,this.max_code=0,this.stat_desc=P}function B(R){return R<256?A[R]:A[256+(R>>>7)]}function ct(R,P){R.pending_buf[R.pending++]=255&P,R.pending_buf[R.pending++]=P>>>8&255}function Q(R,P,V){R.bi_valid>g-V?(R.bi_buf|=P<<R.bi_valid&65535,ct(R,R.bi_buf),R.bi_buf=P>>g-R.bi_valid,R.bi_valid+=V-g):(R.bi_buf|=P<<R.bi_valid&65535,R.bi_valid+=V)}function tt(R,P,V){Q(R,V[2*P],V[2*P+1])}function Et(R,P){for(var V=0;V|=1&R,R>>>=1,V<<=1,0<--P;);return V>>>1}function Ft(R,P,V){var Y,$,et=new Array(b+1),at=0;for(Y=1;Y<=b;Y++)et[Y]=at=at+V[Y-1]<<1;for($=0;$<=P;$++){var nt=R[2*$+1];nt!==0&&(R[2*$]=Et(et[nt]++,nt))}}function _t(R){var P;for(P=0;P<d;P++)R.dyn_ltree[2*P]=0;for(P=0;P<h;P++)R.dyn_dtree[2*P]=0;for(P=0;P<p;P++)R.bl_tree[2*P]=0;R.dyn_ltree[2*S]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0}function yt(R){8<R.bi_valid?ct(R,R.bi_buf):0<R.bi_valid&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0}function zt(R,P,V,Y){var $=2*P,et=2*V;return R[$]<R[et]||R[$]===R[et]&&Y[P]<=Y[V]}function Dt(R,P,V){for(var Y=R.heap[V],$=V<<1;$<=R.heap_len&&($<R.heap_len&&zt(P,R.heap[$+1],R.heap[$],R.depth)&&$++,!zt(P,Y,R.heap[$],R.depth));)R.heap[V]=R.heap[$],V=$,$<<=1;R.heap[V]=Y}function pe(R,P,V){var Y,$,et,at,nt=0;if(R.last_lit!==0)for(;Y=R.pending_buf[R.d_buf+2*nt]<<8|R.pending_buf[R.d_buf+2*nt+1],$=R.pending_buf[R.l_buf+nt],nt++,Y===0?tt(R,$,P):(tt(R,(et=y[$])+f+1,P),(at=E[et])!==0&&Q(R,$-=L[et],at),tt(R,et=B(--Y),V),(at=N[et])!==0&&Q(R,Y-=G[et],at)),nt<R.last_lit;);tt(R,S,P)}function ke(R,P){var V,Y,$,et=P.dyn_tree,at=P.stat_desc.static_tree,nt=P.stat_desc.has_stree,ht=P.stat_desc.elems,Ht=-1;for(R.heap_len=0,R.heap_max=m,V=0;V<ht;V++)et[2*V]!==0?(R.heap[++R.heap_len]=Ht=V,R.depth[V]=0):et[2*V+1]=0;for(;R.heap_len<2;)et[2*($=R.heap[++R.heap_len]=Ht<2?++Ht:0)]=1,R.depth[$]=0,R.opt_len--,nt&&(R.static_len-=at[2*$+1]);for(P.max_code=Ht,V=R.heap_len>>1;1<=V;V--)Dt(R,et,V);for($=ht;V=R.heap[1],R.heap[1]=R.heap[R.heap_len--],Dt(R,et,1),Y=R.heap[1],R.heap[--R.heap_max]=V,R.heap[--R.heap_max]=Y,et[2*$]=et[2*V]+et[2*Y],R.depth[$]=(R.depth[V]>=R.depth[Y]?R.depth[V]:R.depth[Y])+1,et[2*V+1]=et[2*Y+1]=$,R.heap[1]=$++,Dt(R,et,1),2<=R.heap_len;);R.heap[--R.heap_max]=R.heap[1],function(Ct,Tn){var Mo,pr,Uo,he,$c,sf,Br=Tn.dyn_tree,ob=Tn.max_code,ZM=Tn.stat_desc.static_tree,QM=Tn.stat_desc.has_stree,t2=Tn.stat_desc.extra_bits,ab=Tn.stat_desc.extra_base,Do=Tn.stat_desc.max_length,jc=0;for(he=0;he<=b;he++)Ct.bl_count[he]=0;for(Br[2*Ct.heap[Ct.heap_max]+1]=0,Mo=Ct.heap_max+1;Mo<m;Mo++)Do<(he=Br[2*Br[2*(pr=Ct.heap[Mo])+1]+1]+1)&&(he=Do,jc++),Br[2*pr+1]=he,ob<pr||(Ct.bl_count[he]++,$c=0,ab<=pr&&($c=t2[pr-ab]),sf=Br[2*pr],Ct.opt_len+=sf*(he+$c),QM&&(Ct.static_len+=sf*(ZM[2*pr+1]+$c)));if(jc!==0){do{for(he=Do-1;Ct.bl_count[he]===0;)he--;Ct.bl_count[he]--,Ct.bl_count[he+1]+=2,Ct.bl_count[Do]--,jc-=2}while(0<jc);for(he=Do;he!==0;he--)for(pr=Ct.bl_count[he];pr!==0;)ob<(Uo=Ct.heap[--Mo])||(Br[2*Uo+1]!==he&&(Ct.opt_len+=(he-Br[2*Uo+1])*Br[2*Uo],Br[2*Uo+1]=he),pr--)}}(R,P),Ft(et,Ht,R.bl_count)}function _(R,P,V){var Y,$,et=-1,at=P[1],nt=0,ht=7,Ht=4;for(at===0&&(ht=138,Ht=3),P[2*(V+1)+1]=65535,Y=0;Y<=V;Y++)$=at,at=P[2*(Y+1)+1],++nt<ht&&$===at||(nt<Ht?R.bl_tree[2*$]+=nt:$!==0?($!==et&&R.bl_tree[2*$]++,R.bl_tree[2*w]++):nt<=10?R.bl_tree[2*k]++:R.bl_tree[2*v]++,et=$,Ht=(nt=0)===at?(ht=138,3):$===at?(ht=6,3):(ht=7,4))}function H(R,P,V){var Y,$,et=-1,at=P[1],nt=0,ht=7,Ht=4;for(at===0&&(ht=138,Ht=3),Y=0;Y<=V;Y++)if($=at,at=P[2*(Y+1)+1],!(++nt<ht&&$===at)){if(nt<Ht)for(;tt(R,$,R.bl_tree),--nt!=0;);else $!==0?($!==et&&(tt(R,$,R.bl_tree),nt--),tt(R,w,R.bl_tree),Q(R,nt-3,2)):nt<=10?(tt(R,k,R.bl_tree),Q(R,nt-3,3)):(tt(R,v,R.bl_tree),Q(R,nt-11,7));et=$,Ht=(nt=0)===at?(ht=138,3):$===at?(ht=6,3):(ht=7,4)}}c(G);var K=!1;function I(R,P,V,Y){Q(R,(l<<1)+(Y?1:0),3),function($,et,at,nt){yt($),ct($,at),ct($,~at),s.arraySet($.pending_buf,$.window,et,at,$.pending),$.pending+=at}(R,P,V)}i._tr_init=function(R){K||(function(){var P,V,Y,$,et,at=new Array(b+1);for($=Y=0;$<u-1;$++)for(L[$]=Y,P=0;P<1<<E[$];P++)y[Y++]=$;for(y[Y-1]=$,$=et=0;$<16;$++)for(G[$]=et,P=0;P<1<<N[$];P++)A[et++]=$;for(et>>=7;$<h;$++)for(G[$]=et<<7,P=0;P<1<<N[$]-7;P++)A[256+et++]=$;for(V=0;V<=b;V++)at[V]=0;for(P=0;P<=143;)Z[2*P+1]=8,P++,at[8]++;for(;P<=255;)Z[2*P+1]=9,P++,at[9]++;for(;P<=279;)Z[2*P+1]=7,P++,at[7]++;for(;P<=287;)Z[2*P+1]=8,P++,at[8]++;for(Ft(Z,d+1,at),P=0;P<h;P++)C[2*P+1]=5,C[2*P]=Et(P,5);j=new J(Z,E,f+1,d,b),U=new J(C,N,0,h,b),q=new J(new Array(0),O,0,p,x)}(),K=!0),R.l_desc=new F(R.dyn_ltree,j),R.d_desc=new F(R.dyn_dtree,U),R.bl_desc=new F(R.bl_tree,q),R.bi_buf=0,R.bi_valid=0,_t(R)},i._tr_stored_block=I,i._tr_flush_block=function(R,P,V,Y){var $,et,at=0;0<R.level?(R.strm.data_type===2&&(R.strm.data_type=function(nt){var ht,Ht=4093624447;for(ht=0;ht<=31;ht++,Ht>>>=1)if(1&Ht&&nt.dyn_ltree[2*ht]!==0)return o;if(nt.dyn_ltree[18]!==0||nt.dyn_ltree[20]!==0||nt.dyn_ltree[26]!==0)return a;for(ht=32;ht<f;ht++)if(nt.dyn_ltree[2*ht]!==0)return a;return o}(R)),ke(R,R.l_desc),ke(R,R.d_desc),at=function(nt){var ht;for(_(nt,nt.dyn_ltree,nt.l_desc.max_code),_(nt,nt.dyn_dtree,nt.d_desc.max_code),ke(nt,nt.bl_desc),ht=p-1;3<=ht&&nt.bl_tree[2*W[ht]+1]===0;ht--);return nt.opt_len+=3*(ht+1)+5+5+4,ht}(R),$=R.opt_len+3+7>>>3,(et=R.static_len+3+7>>>3)<=$&&($=et)):$=et=V+5,V+4<=$&&P!==-1?I(R,P,V,Y):R.strategy===4||et===$?(Q(R,2+(Y?1:0),3),pe(R,Z,C)):(Q(R,4+(Y?1:0),3),function(nt,ht,Ht,Ct){var Tn;for(Q(nt,ht-257,5),Q(nt,Ht-1,5),Q(nt,Ct-4,4),Tn=0;Tn<Ct;Tn++)Q(nt,nt.bl_tree[2*W[Tn]+1],3);H(nt,nt.dyn_ltree,ht-1),H(nt,nt.dyn_dtree,Ht-1)}(R,R.l_desc.max_code+1,R.d_desc.max_code+1,at+1),pe(R,R.dyn_ltree,R.dyn_dtree)),_t(R),Y&&yt(R)},i._tr_tally=function(R,P,V){return R.pending_buf[R.d_buf+2*R.last_lit]=P>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&P,R.pending_buf[R.l_buf+R.last_lit]=255&V,R.last_lit++,P===0?R.dyn_ltree[2*V]++:(R.matches++,P--,R.dyn_ltree[2*(y[V]+f+1)]++,R.dyn_dtree[2*B(P)]++),R.last_lit===R.lit_bufsize-1},i._tr_align=function(R){Q(R,2,3),tt(R,S,Z),function(P){P.bi_valid===16?(ct(P,P.bi_buf),P.bi_buf=0,P.bi_valid=0):8<=P.bi_valid&&(P.pending_buf[P.pending++]=255&P.bi_buf,P.bi_buf>>=8,P.bi_valid-=8)}(R)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(w){process.nextTick(function(){x(w)})}:function(){if(o.postMessage&&!o.importScripts){var w=!0,k=o.onmessage;return o.onmessage=function(){w=!1},o.postMessage("","*"),o.onmessage=k,w}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",S,!1):o.attachEvent("onmessage",S),function(w){o.postMessage(f+w,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(w){x(w.data)},function(w){u.port2.postMessage(w)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(w){var k=m.createElement("script");k.onreadystatechange=function(){x(w),k.onreadystatechange=null,l.removeChild(k),k=null},l.appendChild(k)}):function(w){setTimeout(x,0,w)},b.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var k=new Array(arguments.length-1),v=0;v<k.length;v++)k[v]=arguments[v+1];var E={callback:w,args:k};return h[d]=E,c(d),d++},b.clearImmediate=g}function g(w){delete h[w]}function x(w){if(p)setTimeout(x,0,w);else{var k=h[w];if(k){p=!0;try{(function(v){var E=v.callback,N=v.args;switch(N.length){case 0:E();break;case 1:E(N[0]);break;case 2:E(N[0],N[1]);break;case 3:E(N[0],N[1],N[2]);break;default:E.apply(a,N)}})(k)}finally{g(w),p=!1}}}}function S(w){w.source===o&&typeof w.data=="string"&&w.data.indexOf(f)===0&&x(+w.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Be<"u"?Be:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(J_);var _M=J_.exports,Zh=ks(_M);const Z_={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Z_);var An=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},xs,No,zi;class bM{constructor(...t){xs.set(this,new Map),No.set(this,new Map),zi.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),An(this,zi,"f").has(r)||An(this,zi,"f").set(r,new Set);const s=An(this,zi,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&An(this,No,"f").set(r,a),o=!1,c)continue;const l=An(this,xs,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);An(this,xs,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:An(this,xs,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&An(this,No,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:An(this,zi,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of An(this,zi,"f").values())Object.freeze(t);return this}_getTestState(){return{types:An(this,xs,"f"),extensions:An(this,No,"f")}}}xs=new WeakMap,No=new WeakMap,zi=new WeakMap;var wM=new bM(Z_)._freeze();function Q_(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return wM.getType(e)??"application/octet-stream"}function EM(e){const t=R_(e,{}),n=ln(t),r=Pi(t),i=tf("main");if(!T(i))return;const s=Nc(i,To(t),n);T(s)?ge("memory",`${i.name} already has a [${r}] named ${n}`):(C_(i,t),ge("memory",`created [${r}] ${n} in ${i.name}`))}async function xM(e){const t=await e.text();EM(t)}async function vM(e,t){try{ge("parsezipfile",e.name);const n=await e.arrayBuffer();(await new Zh().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=Q_(s,a),l=new File([a],o.name,{type:c});t(l)}).catch(a=>{ne("memory","crash",a.message)})})}catch(n){ne("memory","crash",n.message)}}async function kM(e,t){try{ge("parsebinaryfile",e.name);const n=await e.arrayBuffer(),r=e.name.split(".").slice(-1)[0];t((r??"").toLowerCase(),new Uint8Array(n))}catch(n){ne("memory","crash",n.message)}}const ce={defaultplayer:vb(),software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function SM(e){ce.defaultplayer=e}function AM(){return ce.defaultplayer}function Fc(){return[...ce.books.values()]}function TM(){const[e]=ce.books.values();return e}function Lo(e){const t=e.toLowerCase();return ce.books.get(e)??Fc().find(n=>n.name.toLowerCase()===t)}function Qh(e,t){ce.software[e]=t}function Gn(e){return Lo(ce.software[e])}function tb(e){const t=IL([]);return Lt(e)&&(t.name=e),OM(t),ge("memory",`created [book] ${t.name}`),t}function tf(e,t){let n=Gn(e);if(T(n))return n;T(n)||(n=TM()),T(n)||(n=tb(t)),T(n)&&(Qh("main",n.id),ge("memory",`opened [book] ${n.name}`))}function RM(e){if(ce.books.clear(),e.forEach(t=>{ce.books.set(t.id,t),t.name.toLowerCase()==="main"&&(ce.software.main=t.id)}),!ce.software.main){const t=ce.books.values().next();t.value&&(ce.software.main=t.value.id)}}function OM(e){return ce.books.set(e.id,e),e.id}function IM(e){const t=Lo(e);t&&ce.books.delete(t.id)}function St(e){let t=ce.chips.get(e);return T(t)||(t={book:void 0,board:void 0,object:void 0,terrain:void 0,charset:void 0,palette:void 0,eighttrack:void 0,binaryfile:void 0,player:ce.defaultplayer,inputqueue:new Set,inputmods:{[me.NONE]:0,[me.MOVE_UP]:0,[me.MOVE_DOWN]:0,[me.MOVE_LEFT]:0,[me.MOVE_RIGHT]:0,[me.OK_BUTTON]:0,[me.CANCEL_BUTTON]:0,[me.MENU_BUTTON]:0},inputcurrent:void 0},ce.chips.set(e,t)),t}function st(e,t){const n=St(e.id());return xE(n,t,e.get)}function CM(e){if(!Lt(e)||!e)return ne("memory","login",`failed for playerid ==>${e}<==`,e);const t=Gn("main");if(!T(t))return ne("memory","login:main","login failed to find book 'main'",e);const n=_s(t,"title");if(!T(n))return ne("memory","login:title","login failed to find board 'title'",e);const r=Lc(t,"player");if(!T(r))return ne("memory","login:player","login failed to find object type 'player'",e);const i={x:0,y:0},s=r.name??"player",o=bl(n,i,s,e);return T(o==null?void 0:o.id)?(D_(t,e,n.codepage),!0):!1}function NM(e){ce.books.forEach(t=>{const n=U_(t,e);xd(n,e)})}function LM(e){const t=Gn("main"),n=P_(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;kb(c)&&T(e[c])===!1&&(e[c]=0,D_(t,c,i.codepage))}}}function MM(e,t){const n=ec.HALT_AT_COUNT;ec.HALT_AT_COUNT=n*32,ce.loaders.forEach((s,o)=>{e.tick(o,Pc.LOADER,1,t,"loader",s),e.isended(o)&&(e.halt(o),ce.loaders.delete(o))}),ec.HALT_AT_COUNT=n;const r=Gn("main");P_(r).forEach(s=>{var a,c;const o=BL(r,s,t);for(let l=0;l<o.length;++l){const u=o[l],f=St(u.id);f.book=r,f.board=s,f.object=u.object,f.inputcurrent=void 0,qt((a=f.object)==null?void 0:a.tickertime)&&t-((c=f.object)==null?void 0:c.tickertime)>T_*5&&(f.object.tickertext=void 0,f.object.tickertime=void 0);const d=_d($n(r,u.object),"cycle",void 0),h=_d(u.object,"cycle",d),p=wd(u.object);e.tick(u.id,Pc.CODE_PAGE,qt(h)?h:AL,t,p,u.code)}})}function UM(e,t,n,r){tf("main");const i=Gn("main"),s=`${n}_cli`,o=St(s);o.player=n,o.book=i,o.board=void 0,o.inputcurrent=void 0,xf("memory","running",t,s,r),e.once(s,Pc.CLI,t,"cli",r)}function DM(e,t,n,r,i){const s=Gn("main");if(!T(s))return;const o=["binaryfile",r];ge("memory","looking for stats",...o);const a=LL(s,ut.LOADER).filter(c=>{const l=Ao(c);return Object.keys(l).filter(d=>l[d]===""&&o.includes(d.toLowerCase())).length===o.length});for(let c=0;c<a.length;++c){const l=a[c],u=`${t}_load_${l.id}`,f=St(u);f.player=t,f.book=s,f.board=void 0,f.binaryfile={filename:n.name,cursor:0,bytes:i,dataview:new DataView(i.buffer)},f.inputcurrent=void 0,ge("memory","starting loader",e,u),ce.loaders.set(u,l.code)}}function eb(e,t,n){function r(i){if(T(n))switch(i){case"text/plain":xM(n).catch(s=>ne("memory","crash",s.message));break;case"application/zip":vM(n,s=>eb(e,t,s)).catch(s=>ne("memory","crash",s.message));break;case"application/octet-stream":kM(n,(s,o)=>{DM(e,t,n,s,o)}).catch(s=>ne("memory","crash",s.message));break;default:n.arrayBuffer().then(s=>{const o=Q_(n.name,new Uint8Array(s));if(o)r(o);else return ne("memory","loadfile",`unsupported file ${n.name}`)}).catch(s=>ne("memory","crash",s.message));return}}r((n==null?void 0:n.type)??"")}let nb=0;function PM(){switch(nb++){case 0:return xt.BLUE;case 1:return xt.GREEN;case 2:return xt.CYAN;case 3:return xt.RED;case 4:return xt.PURPLE;case 5:return xt.YELLOW;default:return nb=0,xt.WHITE}}function BM(e,t,n,r,i,s){const o=[];let a=t;const c=a===0,l=Pt,u=He,f=c?xt.BLACK:xt.CLEAR,d=bf(e,a++,l,u,f);o.push(d);const h=Jb(e,a++,l,u);o.push(h);const p=a++,m=Xb(e,p);o.push(m);const b=bf(e,a++,l,u,xt.CLEAR);o.push(b);const g={...Lu(Pt,He,PM(),xt.CLEAR),...b},x=Zb(e,a++);i&&o.push(x),r.terrain.forEach((E,N)=>{if(E){const O=$n(n,E);d.char[N]=E.char??(O==null?void 0:O.char)??0,d.color[N]=E.color??(O==null?void 0:O.color)??f,d.bg[N]=E.bg??(O==null?void 0:O.bg)??f,d.color[N]!==xt.CLEAR&&(s[N]=d.color[N])}});const S=r.objects??{};Object.values(S).forEach(E=>{if(T(E.removed)||T(E.headless))return;const N=E.id??"",O=N_(n,E),W=qb(e,p,N),Z=E.lx??E.x??0,C=E.ly??E.y??0,A=Z+C*Pt;if(W.x=E.x??0,W.y=E.y??0,W.char=E.char??(O==null?void 0:O.char)??1,W.color=E.color??(O==null?void 0:O.color)??xt.WHITE,W.bg=E.bg??(O==null?void 0:O.bg)??xt.BORROW,m.sprites.push(W),W.bg===xt.SHADOW&&(W.bg=xt.CLEAR,h.alphas[Z+C*l]=.5),W.bg===xt.BORROW&&(W.bg=s[A]??xt.BLACK),W.color!==xt.CLEAR&&(s[A]=W.color),Lt(E.tickertext)&&qt(E.tickertime)&&E.tickertext.length){const y=Pt,L=YO(E.tickertext,y,He),j=((L==null?void 0:L.measuredwidth)??1)-1,U=E.x??0,q=E.y??0,G=q<He*.5;g.x=U-Math.floor(j*.5),g.y=q+(G?1:-1),g.x+j>Pt&&(g.x=Pt-j),g.x<0&&(g.x=0),VO(E.tickertext,g)}N===e&&(x.focusx=W.x,x.focusy=W.y,x.focusid=N)});function w(E,N){if(!(E<0||E>=Pt||N<0||N>=He))return h.alphas[E+N*Pt]}const k=[[1,1,1,1,1],[1,3,5,3,1],[1,5,12,5,1],[1,3,5,3,1],[1,1,1,1,1]].flat(),v=new Array(h.alphas.length);for(let E=0;E<h.alphas.length;++E){const N=E%Pt,O=Math.floor(E/Pt),W=[[w(N-2,O-2),w(N-1,O-2),w(N,O-2),w(N+1,O-2),w(N+2,O-2)],[w(N-2,O-1),w(N-1,O-1),w(N,O-1),w(N+1,O-1),w(N+2,O-1)],[w(N-2,O),w(N-1,O),w(N,O),w(N+1,O),w(N+2,O)],[w(N-2,O+1),w(N-1,O+1),w(N,O+1),w(N+1,O+1),w(N+2,O+1)],[w(N-2,O+2),w(N-1,O+2),w(N,O+2),w(N+1,O+2),w(N+2,O+2)]].flat().map((Z,C)=>T(Z)?Z*k[C]:void 0).filter(T);v[E]=pi(zw(W),0,1)}return h.alphas=v,o}function FM(e){const t=Gn("main"),n=U_(t,e),r=[];if(!T(t)||!T(n))return r;const i=new Array(Pt*He).fill(0),s=_s(t,n.over??""),o=_s(t,n.under??""),a=[s,n,o].filter(T);let c=0;for(let l=0;l<a.length;++l){const u=a[l],f=BM(e,c,t,u,u===n,i);c+=f.length,r.push(...f)}return r}function zM(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function $M(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const jM=new Date("1980/09/02");async function WM(e){return new Promise((t,n)=>{const r=new Zh;for(let i=0;i<e.length;++i){const s=e[i],o=CL(s);if(o){const a=fE(o);T(a)&&r.file(s.id,a,{date:jM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t($M(i))}).catch(n)})}async function GM(e){return new Promise((t,n)=>{const r=new Zh;r.loadAsync(zM(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=NL(dE(c));T(l)&&i.push(l)}t(i)}).catch(n)})}function ef(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];Le(r)?r.forEach(i=>{t.push(ef(i))}):t.push(ef(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function KM(e){const t=Hu(`${e}
`);if(t.errors.length>0)return t;as.input=t.tokens;const n=as.program();if(as.errors.length>0)return{tokens:t.tokens,errors:as.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=lI.go(n);return r?(ef(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const nf=Object.getPrototypeOf(function*(){}).constructor;function HM(e,t){fI(e);const n=KM(t);if(n.errors&&n.errors.length>0)return n;if(!n.ast)return{...n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const r=yI(n.ast);if(r.code){QE&&console.info(r.code);try{return{...n,...r,source:r.code,code:new nf("api",r.code)}}catch(i){return{errors:[{message:`unexpected error ${i.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new nf("api"," ")}}}return{...n,...r,source:"",code:new nf("api"," ")}}function VM(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=HM(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},has(i){return T(t[i])},isended(i){const s=t[i];return T(s)?s.isended():!0},halt(i){const s=t[i];return T(s)&&delete t[i],!!s},tick(i,s,o,a,c,l){var f;let u=t[i];if(!T(t[i])){const d=n(c,l);if(u=t[i]=bI(i,d),(f=d.errors)!=null&&f.length){const[h]=d.errors,p=((h==null?void 0:h.line)??2)-1,m=l.replaceAll(`\r
`,"").split(`
`).map((x,S)=>[x,S]);m.slice(p-5,p).forEach(([x,S])=>{ne("os","build",`$grey${S+1} $grey${x}`)});const[b,g]=m[p]??[];if(Lt(b)&&T(g)){const x=(h.column??1)-1,S=x+h.length,w=x<b.length?b:`${b}*`,k=w.substring(0,x),v=w.substring(x,S),E=w.substring(S);ne("os","build",`$red${g+1} $grey${k}$red${v}$grey${E}`)}return h.message.split(`
`).forEach(x=>{ne("os","build",x)}),!1}yM(u,s)}return!!(u!=null&&u.tick(o,a))},once(i,s,o,a,c){return r.tick(i,s,1,o,a,c)&&r.halt(i)},message(i){const{target:s,path:o}=pf(i.target),a=t[s];if(T(a)){const c={...i,target:o};a.message(c)}}};return r}const rf=VM();let zc=0;const YM=16,$i={},qM=64;let rb=0;const Pr={},vs={},Kn=Po("vm",["tick","second"],e=>{var t;switch(e.target){case"init":T(e.player)&&(SM(e.player),Kn.reply(e,"ackinit",!0,e.player));break;case"books":kf("vm:books",async()=>{if(Lt(e.data)){const n=await GM(e.data),r=n.map(i=>i.name);RM(n),ge(Kn.name(),"reset by",e.sender,"with",...r,e.player),Kn.reply(e,"ackbooks",!0,e.player)}});break;case"login":e.player&&CM(e.player)&&($i[e.player]=0,ge(Kn.name(),"player login",e.player),Kn.reply(e,"acklogin",!0,e.player));break;case"doot":e.player&&($i[e.player]=0,xf(Kn.name(),"active",e.player));break;case"input":if(e.player){const n=St(e.player),[r=me.NONE,i=0]=e.data??{};n.inputqueue.add(r),n.inputmods[r]=i}break;case"codewatch":if(e.player&&Le(e.data)){const[n,r]=e.data;if(!T(vs[r])){const i=vf(n,r);vs[r]=k_(i,s=>{const o=Lo(n),a=si(o,r);T(a)&&(a.code=s,OL(a))})}Pr[n]=Pr[n]??{},Pr[n][r]=Pr[n][r]??new Set,Pr[n][r].add(e.player)}break;case"coderelease":if(e.player&&Le(e.data)){const[n,r]=e.data;T(Pr[n])&&T(Pr[n][r])&&(Pr[n][r].delete(e.player),Pr[n][r].size===0&&((t=vs[r])==null||t.call(vs),vs[r]=void 0))}break;case"tick":zc=e.data??0,MM(rf,zc);break;case"second":{LM($i);const n=Object.keys($i);for(let r=0;r<n.length;++r)++$i[n[r]];for(let r=0;r<n.length;++r){const i=n[r];$i[i]>=YM&&(delete $i[i],NM(i),ge(Kn.name(),"player logout",i),Kn.emit("logout",void 0,i))}++rb>=qM&&(rb=0,As(Kn.name()));break}case"flush":kf("vm:flush",async()=>{const n=Fc();n.length&&ow(Kn.name(),await WM(n))});break;case"cli":T(e.player)&&UM(rf,zc,e.player,e.data??"");break;case"loadfile":T(e.player)&&eb(zc,e.player,e.data);break;default:rf.message(e);break}});function XM(){Kn.emit("ready",void 0,AM())}const ib={},sb=Po("gadgetserver",["tock"],e=>{switch(e.target){case"tock":eM().forEach(t=>{const n=Bi(t);n.layers=FM(t);const r=Zc(ib[t]??{},n);r.length&&(ib[t]=Fe(n),sw(sb.name(),r,t))});break;case"desync":if(e.player){const t=Bi(e.player);iw(sb.name(),t,e.player)}break;case"clearscroll":e.player&&nM(e.player);break}}),JM=Tb(e=>postMessage(e));onmessage=function(t){JM(t.data)},queueMicrotask(XM)})();

var GM=Object.defineProperty;var HM=(or,_e,Ut)=>_e in or?GM(or,_e,{enumerable:!0,configurable:!0,writable:!0,value:Ut}):or[_e]=Ut;var ye=(or,_e,Ut)=>HM(or,typeof _e!="symbol"?_e+"":_e,Ut);(function(){"use strict";const or=new Set,_e={emit(t,e,n,r){_e.invoke(sb(t,e,n,r))},invoke(t){or.forEach(e=>e.handle(t))},connect(t){or.add(t)},disconnect(t){or.delete(t)}};var Ut=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ii(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function W_(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var qh={};(function(t){var e=Ut&&Ut.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var d=0,f=l.length,p;d<f;d++)(p||!(d in l))&&(p||(p=Array.prototype.slice.call(l,0,d)),p[d]=l[d]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,d=u.capitalize,f=d===void 0?!0:d,p=u.adjectiveCount,m=p===void 0?1:p,b=u.addAdverb,_=b===void 0?!1:b,w=e(e(e([],e([],Array(m),!0).map(function(E){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),_?[n(t.adverbs)]:[],!0);return f&&(w=w.map(function(E){return E.charAt(0).toUpperCase()+E.substr(1)})),w.join(h)}t.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d;return t.adjectives.length*h*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d,p=u.separator,m=p===void 0?"":p;return r(t.adjectives).length*h+h*m.length+r(t.nouns).length+m.length+r(t.verbs).length+(f?r(t.adverbs).length+m.length:0)}t.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,d=u.addAdverb,f=d===void 0?!1:d,p=u.separator,m=p===void 0?"":p;return i(t.adjectives).length*h+h*m.length+i(t.nouns).length+m.length+i(t.verbs).length+(f?i(t.adverbs).length+m.length:0)}t.minLength=c,t.default=s})(qh);var G_=Ii(qh);const H_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let V_=t=>crypto.getRandomValues(new Uint8Array(t)),K_=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},Xh=(t,e=21)=>K_(t,e,V_),q_=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=H_[n[t]&63];return e};var Zh="abcdefghijklmnopqrstuvwxyz",Jh="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Yh="0123456789",X_="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",Z_="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const J_=Yh,Y_=Zh,Q_=Jh;var eb=J_+Y_+Q_,Nc={lowercase:Zh,uppercase:Jh,numbers:Yh,nolookalikes:X_,nolookalikesSafe:Z_,alphanumeric:eb};function at(){return`sid_${q_(12).replaceAll("-",".")}`}const tb=Xh(Nc.numbers,4),nb=Xh(`${Nc.numbers}${Nc.lowercase}`,16);function rb(){return`pid_${tb()}_${nb()}`}function Qh(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function ib(){return G_({capitalize:!1,adjectiveCount:1})}var Te=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(Te||{}),He=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(He||{}),Eo=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(Eo||{}),ae=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t))(ae||{}),he=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.LINK=11]="LINK",t[t.HOTKEY=12]="HOTKEY",t[t.SCROLL=13]="SCROLL",t[t.COPYIT=14]="COPYIT",t))(he||{});function Pe(t){return t.toLowerCase().trim()}function sb(t,e,n,r){return{id:at(),target:t,sender:e,data:n,player:r}}function ef(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function as(t,e,n){const r=at(),i=Pe(t),s=e.map(Pe),o={id(){return r},name(){return t},topics(){return e},emit(a,c,u){_e.emit(a,r,c,u)},reply(a,c,u,l){o.emit(`${a.sender}:${c}`,u,l)},handle(a){const{target:c,path:u}=ef(a.target),l=Pe(c);s.findIndex(h=>h==="all"||h===l)!==-1&&n(a),(r===c||l==="all"||i===l)&&n({...a,target:u})}};return _e.connect(o),o}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var ob=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ab=Object.prototype.hasOwnProperty;function Lc(t,e){return ab.call(t,e)}function Mc(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)Lc(t,i)&&r.push(i);return r}function Ht(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Uc(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Yr(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function tf(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Pc(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(Pc(t[e]))return!0}else if(typeof t=="object"){for(var r=Mc(t),i=r.length,s=0;s<i;s++)if(Pc(t[r[s]]))return!0}}return!1}function nf(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var rf=function(t){ob(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,nf(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=nf(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),rt=rf,cb=Ht,xi={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=ko(n,this.path);r&&(r=Ht(r));var i=Qr(n,{op:"remove",path:this.from}).removed;return Qr(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=ko(n,this.from);return Qr(n,{op:"add",path:this.path,value:Ht(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:cs(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},lb={add:function(t,e,n){return Uc(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:xi.move,copy:xi.copy,test:xi.test,_get:xi._get};function ko(t,e){if(e=="")return t;var n={op:"_get",path:e};return Qr(t,n),n.value}function Qr(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):So(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=ko(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=cs(t,e.value),o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new rt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=Ht(t));var a=e.path||"",c=a.split("/"),u=t,l=1,h=c.length,d=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=So;;){if(f=c[l],f&&f.indexOf("~")!=-1&&(f=tf(f)),i&&(f=="__proto__"||f=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(u[f]===void 0?d=c.slice(0,l).join("/"):l==h-1&&(d=e.path),d!==void 0&&p(e,0,t,d)),l++,Array.isArray(u)){if(f==="-")f=u.length;else{if(n&&!Uc(f))throw new rt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);Uc(f)&&(f=~~f)}if(l>=h){if(n&&e.op==="add"&&f>u.length)throw new rt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=lb[e.op].call(e,u,f,t);if(o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(l>=h){var o=xi[e.op].call(e,u,f,t);if(o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(u=u[f],n&&l<h&&(!u||typeof u!="object"))throw new rt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function Dc(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new rt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Ht(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Qr(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function ub(t,e,n){var r=Qr(t,e);if(r.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function So(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new rt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(xi[t.op]){if(typeof t.path!="string")throw new rt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new rt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new rt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new rt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Pc(t.value))throw new rt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new rt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new rt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=sf([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new rt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new rt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function sf(t,e,n){try{if(!Array.isArray(t))throw new rt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Dc(Ht(e),Ht(t),n||!0);else{n=n||So;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof rt)return i;throw i}}function cs(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!cs(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!cs(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}var hb=Object.freeze({__proto__:null,JsonPatchError:rt,_areEquals:cs,applyOperation:Qr,applyPatch:Dc,applyReducer:ub,deepClone:cb,getValueByPointer:ko,validate:sf,validator:So});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Bc=new WeakMap,fb=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),db=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function pb(t){return Bc.get(t)}function mb(t,e){return t.observers.get(e)}function gb(t,e){t.observers.delete(e.callback)}function yb(t,e){e.unobserve()}function _b(t,e){var n=[],r,i=pb(t);if(!i)i=new fb(t),Bc.set(t,i);else{var s=mb(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=Ht(t),e){r.callback=e,r.next=null;var o=function(){Fc(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){Fc(r),clearTimeout(r.next),gb(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new db(e,r)),r}function Fc(t,e){e===void 0&&(e=!1);var n=Bc.get(t.object);$c(n.value,t.object,t.patches,"",e),t.patches.length&&Dc(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function $c(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Mc(e),o=Mc(t),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=t[u];if(Lc(e,u)&&!(e[u]===void 0&&l!==void 0&&Array.isArray(e)===!1)){var h=e[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?$c(l,h,n,r+"/"+Yr(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+Yr(u),value:Ht(l)}),n.push({op:"replace",path:r+"/"+Yr(u),value:Ht(h)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+Yr(u),value:Ht(l)}),n.push({op:"remove",path:r+"/"+Yr(u)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!Lc(t,u)&&e[u]!==void 0&&n.push({op:"add",path:r+"/"+Yr(u),value:Ht(e[u])})}}}function of(t,e,n){n===void 0&&(n=!1);var r=[];return $c(t,e,r,"",n),r}var bb=Object.freeze({__proto__:null,compare:of,generate:Fc,observe:_b,unobserve:yb});Object.assign({},hb,bb,{JsonPatchError:rf,deepClone:Ht,escapePathComponent:Yr,unescapePathComponent:tf});var wb=typeof Element<"u",vb=typeof Map=="function",Eb=typeof Set=="function",kb=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ao(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!Ao(t[r],e[r]))return!1;return!0}var s;if(vb&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!Ao(r.value[1],e.get(r.value[0])))return!1;return!0}if(Eb&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(kb&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(wb&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!Ao(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var Sb=function(e,n){try{return Ao(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Ab=Ii(Sb);function k(t){return t!=null}const Tb=Object.keys;function ar(t){return Ht(t)}function Ee(t){return typeof t=="number"&&isNaN(t)===!1}function ke(t){return typeof t=="string"}function ze(t){return Array.isArray(t)}function Rb(t){return t}function Ib(t){return k(t)&&typeof t=="object"&&ke(t.id)&&ke(t.target)&&ke(t.sender)}function xb(t){const e=new Set;function n(s){Ib(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),_e.invoke(s))}const r=as("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){_e.disconnect(r)}return{forward:n,disconnect:i}}const jc=66.666,To=Math.round(1e3/jc),Ob=3;function Cb(t){return new Promise(e=>setTimeout(e,t))}function Nb(){return location.href.includes("/join/")}function Lb(){return location.href.includes("/locked/")}const zc=as("clock",[],()=>{});let Wc=0,Ro=0,Gc=0,af=performance.now();function cf(){const t=performance.now(),e=t-af,n=Lb()?"locked":"";Gc+=e,Gc>=jc&&(Gc%=jc,zc.emit("tick",Ro,n),zc.emit("tock",Ro,n),++Wc,++Ro,Wc>=To&&(Wc%=To,zc.emit("second",Ro,n))),af=t,setTimeout(cf,1)}cf();var lf={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(t){(function(){var e=function(f,p){return p=p||"",f.replace(/(^|-)/g,"$1\\u"+p).replace(/,/g,"\\u"+p)},n=e("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+e("DF-F6,F8-FF","00"),i="A-Z"+e("C0-D6,D8-DE","00"),s="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,p,m,b){return f=f||n,p=p||r,m=m||i,b=b||s,{capitalize:new RegExp("(^|["+f+"])(["+p+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+p+m+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+p+"])","g"),improper:new RegExp("\\b("+b+")\\b","g"),relax:new RegExp("([^"+m+"])(["+m+"]*)(["+m+"])(?=[^"+m+"]|$)","g"),upper:new RegExp("^[^"+p+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:e,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,p,m){return p!=null&&(f=f.replace(a.fill,function(b,_){return _?p+_:""})),m&&(f=c.deapostrophe(f)),f},prep:function(f,p,m,b){if(f=f==null?"":f+"",!b&&a.upper.test(f)&&(f=c.low.call(f)),!p&&!a.hole.test(f)){var _=c.fill(f," ");a.hole.test(_)&&(f=_)}return!m&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,p,m,b){return p+" "+(m?m+" ":"")+b}},u={_:c,of:function(f){for(var p=0,m=c.types.length;p<m;p++)if(u[c.types[p]].apply(u,arguments)===f)return c.types[p]},flip:function(f){return f.replace(/\w/g,function(p){return(p==c.up.call(p)?c.low:c.up).call(p)})},random:function(f){return f.replace(/\w/g,function(p){return(Math.round(Math.random())?c.up:c.low).call(p)})},type:function(f,p){u[f]=p,c.types.push(f)}},l={lower:function(f,p,m){return c.fill(c.low.call(c.prep(f,p)),p,m)},snake:function(f){return u.lower(f,"_",!0)},constant:function(f){return u.upper(f,"_",!0)},camel:function(f){return c.decap(u.pascal(f))},kebab:function(f){return u.lower(f,"-",!0)},upper:function(f,p,m){return c.fill(c.up.call(c.prep(f,p,!1,!0)),p,m)},capital:function(f,p,m){return c.fill(c.prep(f).replace(a.capitalize,function(b,_,w){return _+c.up.call(w)}),p,m)},header:function(f){return u.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(p,m,b){return c.up.call(b)}),"",!0)},title:function(f){return u.capital(f).replace(a.improper,function(p,m,b,_){return b>0&&b<_.lastIndexOf(" ")?c.low.call(p):p})},sentence:function(f,p,m){return f=u.lower(f).replace(a.sentence,function(b,_,w){return _+c.up.call(w)}),p&&p.forEach(function(b){f=f.replace(new RegExp("\\b"+u.lower(b)+"\\b","g"),c.cap)}),m&&m.forEach(function(b){f=f.replace(new RegExp("(\\b"+u.lower(b)+"\\. +)(\\w)"),function(_,w,E){return w+c.low.call(E)})}),f}};l.squish=l.pascal,u.default=u;for(var h in l)u.type(h,l[h]);var d=typeof d=="function"?d:function(){};d(t.exports?t.exports=u:this.Case=u)}).call(Ut)})(lf);var Mb=lf.exports,Ub=Ii(Mb);function ls(){return ls=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ls.apply(this,arguments)}function Pb(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Hc(t,e)}function Hc(t,e){return Hc=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Hc(t,e)}function Db(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var uf=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[gt].connections.iterate.delete(r),i.byKey.forEach(function(o){s[gt].connections.byKey.get(o).delete(r)})}),this.observing.clear()},t}(),ei=[],Io=function(t){Pb(e,t);function e(r,i,s){var o;if(o=t.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){ei.push(Db(o));try{o.func()}finally{ei.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=e.prototype;return n._trigger=function(){if(ei.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(uf);function hf(){return!!ei.length}function ff(){return ei.length?ei[ei.length-1]:void 0}function Bb(t,e,n){var r=ls({name:"unnamed",fireImmediately:!0},n),i=new Io(t,r,e);return i}var xo=0;function df(){return xo>0}function Vc(t){xo++;try{return t()}finally{xo--,xo===0&&$b()}}var Kc=!1;function pf(){return Kc}function mf(t){Kc=!0;try{t()}finally{Kc=!1}}function Fb(t){return function(){return mf(t)}}var qc=[];function $b(){var t=[].concat(qc);qc=[],gf(t)}function gf(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[gt].connections.iterate.forEach(function(i){e.add(i)}),(r=n.observable[gt].connections.byKey.get(n.key))==null||r.forEach(function(i){e.add(i)})}),e.forEach(function(n){n.trigger()})}function Oo(t){if(df()){qc.push(t);return}gf([t])}function yf(t,e){if(t.type==="iterate")t.observable[gt].connections.iterate.add(e);else{var n=t.observable[gt].connections.byKey.get(t.key);n||(n=new Set,t.observable[gt].connections.byKey.set(t.key,n)),n.add(e)}}function Co(t,e){if(!pf()){var n=ff();n&&(yf(t,n),n.registerConnection(t)),e&&(yf(t,e),e.registerConnection(t))}}var Xc=Symbol("$skipreactive"),gt=Symbol("$reactive"),an=Symbol("$reactiveproxy");function us(t,e){return!!(t&&t[an]&&t[an].implicitObserver===e)}function Zc(t){return t[Xc]=!0,t}function _f(t){return!!(t&&!us(t)&&t[gt])}function Jc(t,e,n){if(n===void 0&&(n=!1),t[Xc]||us(t,e))return t;var r=jb(t,n);if(!e)return r;var i=r[gt].proxiesWithImplicitObserver.get(e);if(!i){var s={implicitObserver:e};Object.setPrototypeOf(s,bf),i=new Proxy(r[gt].raw,s),r[gt].proxiesWithImplicitObserver.set(e,i)}return i}var hs=Jc;function jb(t,e){if(e===void 0&&(e=!1),us(t))return t;if(_f(t))return t[gt].proxy;if(t[gt]||t[an])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,gt,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,bf);return n.proxy=r,r}var bf={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||Co({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===an)return{implicitObserver:this.implicitObserver};var i=Reflect.get(e,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(e)?Co({observable:e,type:"iterate"},this.implicitObserver):Co({observable:e,key:n,type:"get"},this.implicitObserver),_f(i))return Jc(i,this.implicitObserver);if(e[gt].shallow)return i;if(typeof i=="object"&&i!==null&&!us(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(e,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(hf()||this.implicitObserver))return Jc(i,this.implicitObserver)}return i},ownKeys:function(e){return Co({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,i){return Vc(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,i);var s=Object.hasOwnProperty.call(e,n),o=Reflect.get(e,n,i),a=Reflect.set(e,n,r,i);if(!s)Oo({observable:e,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)Oo({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else Oo({observable:e,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,n){return Vc(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),i=Reflect.get(e,n),s=Reflect.deleteProperty(e,n);return r&&Oo({observable:e,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function zb(t,e){var n=ls({name:"unnamed",fireImmediately:!0},e),r=new Io(t,n);return r}function Wb(t,e,n){var r=ls({name:"unnamed",fireImmediately:!0},n),i=new Io(function(){t(e)},r);return e=hs(e,i),r.fireImmediately&&i.trigger(),i}var wf=function(){function t(){this._observable=hs({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return hs(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function Gb(t,e,n){return new wf}var Hb=Object.freeze({__proto__:null,$reactive:gt,$reactiveproxy:an,$skipreactive:Xc,Atom:wf,Observer:uf,Reaction:Io,autorun:zb,autorunAsync:Wb,createAtom:Gb,hasRunningReaction:hf,isActionRunning:df,isReactive:us,isTrackingDisabled:pf,markRaw:Zc,reaction:Bb,reactive:hs,runInAction:Vc,runningReaction:ff,untracked:mf,untrackedCB:Fb});const Sn=()=>new Map,Yc=t=>{const e=Sn();return t.forEach((n,r)=>{e.set(r,n)}),e},Nr=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Vb=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},Kb=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Oi=()=>new Set,Qc=t=>t[t.length-1],qb=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},Lr=Array.from,Xb=Array.isArray;class Zb{constructor(){this._observers=Sn()}on(e,n){return Nr(this._observers,e,Oi).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return Lr((this._observers.get(e)||Sn()).values()).forEach(r=>r(...n))}destroy(){this._observers=Sn()}}const Mr=Math.floor,No=Math.abs,vf=(t,e)=>t<e?t:e,ti=(t,e)=>t>e?t:e,Ef=t=>t!==0?t<0:1/t<0,kf=1,Sf=2,el=4,tl=8,fs=32,cr=64,en=128,Lo=31,nl=63,ni=127,Jb=2147483647,Af=Number.MAX_SAFE_INTEGER,Yb=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Mr(t)===t),Qb=t=>t.toLowerCase(),ew=/^\s*/g,tw=t=>t.replace(ew,""),nw=/([A-Z])/g,Tf=(t,e)=>tw(t.replace(nw,n=>`${e}${Qb(n)}`)),rw=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},ds=typeof TextEncoder<"u"?new TextEncoder:null,iw=ds?t=>ds.encode(t):rw;let ps=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ps&&ps.decode(new Uint8Array).length===1&&(ps=null);class ms{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ur=()=>new ms,sw=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},An=t=>{const e=new Uint8Array(sw(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},ow=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(ti(n,e)*2),t.cpos=0)},kt=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},rl=kt,Se=(t,e)=>{for(;e>ni;)kt(t,en|ni&e),e=Mr(e/128);kt(t,ni&e)},il=(t,e)=>{const n=Ef(e);for(n&&(e=-e),kt(t,(e>nl?en:0)|(n?cr:0)|nl&e),e=Mr(e/64);e>0;)kt(t,(e>ni?en:0)|ni&e),e=Mr(e/128)},sl=new Uint8Array(3e4),aw=sl.length/3,cw=(t,e)=>{if(e.length<aw){const n=ds.encodeInto(e,sl).written||0;Se(t,n);for(let r=0;r<n;r++)kt(t,sl[r])}else Nt(t,iw(e))},lw=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;Se(t,r);for(let i=0;i<r;i++)kt(t,n.codePointAt(i))},Ci=ds&&ds.encodeInto?cw:lw,Mo=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=vf(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ti(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},Nt=(t,e)=>{Se(t,e.byteLength),Mo(t,e)},ol=(t,e)=>{ow(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},uw=(t,e)=>ol(t,4).setFloat32(0,e,!1),hw=(t,e)=>ol(t,8).setFloat64(0,e,!1),fw=(t,e)=>ol(t,8).setBigInt64(0,e,!1),Rf=new DataView(new ArrayBuffer(4)),dw=t=>(Rf.setFloat32(0,t),Rf.getFloat32(0)===t),gs=(t,e)=>{switch(typeof e){case"string":kt(t,119),Ci(t,e);break;case"number":Yb(e)&&No(e)<=Jb?(kt(t,125),il(t,e)):dw(e)?(kt(t,124),uw(t,e)):(kt(t,123),hw(t,e));break;case"bigint":kt(t,122),fw(t,e);break;case"object":if(e===null)kt(t,126);else if(Xb(e)){kt(t,117),Se(t,e.length);for(let n=0;n<e.length;n++)gs(t,e[n])}else if(e instanceof Uint8Array)kt(t,116),Nt(t,e);else{kt(t,118);const n=Object.keys(e);Se(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ci(t,i),gs(t,e[i])}}break;case"boolean":kt(t,e?120:121);break;default:kt(t,127)}};class If extends ms{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Se(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const xf=t=>{t.count>0&&(il(t.encoder,t.count===1?t.s:-t.s),t.count>1&&Se(t.encoder,t.count-2))};class Uo{constructor(){this.encoder=new ms,this.s=0,this.count=0}write(e){this.s===e?this.count++:(xf(this),this.count=1,this.s=e)}toUint8Array(){return xf(this),An(this.encoder)}}const Of=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);il(t.encoder,e),t.count>1&&Se(t.encoder,t.count-2)}};class al{constructor(){this.encoder=new ms,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Of(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Of(this),An(this.encoder)}}class pw{constructor(){this.sarr=[],this.s="",this.lensE=new Uo}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new ms;return this.sarr.push(this.s),this.s="",Ci(e,this.sarr.join("")),Mo(e,this.lensE.toUint8Array()),An(e)}}const Pr=t=>new Error(t),Un=()=>{throw Pr("Method unimplemented")},Pn=()=>{throw Pr("Unexpected case")},Cf=Pr("Unexpected end of array"),Nf=Pr("Integer out of Range");class Po{constructor(e){this.arr=e,this.pos=0}}const ri=t=>new Po(t),mw=t=>t.pos!==t.arr.length,gw=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Pt=t=>gw(t,Ae(t)),Ni=t=>t.arr[t.pos++],Ae=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&ni)*n,n*=128,i<en)return e;if(e>Af)throw Nf}throw Cf},cl=t=>{let e=t.arr[t.pos++],n=e&nl,r=64;const i=(e&cr)>0?-1:1;if(!(e&en))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&ni)*r,r*=128,e<en)return i*n;if(n>Af)throw Nf}throw Cf},Li=ps?t=>ps.decode(Pt(t)):t=>{let e=Ae(t);if(e===0)return"";{let n=String.fromCodePoint(Ni(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Ni(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},ll=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},yw=[t=>{},t=>null,cl,t=>ll(t,4).getFloat32(0,!1),t=>ll(t,8).getFloat64(0,!1),t=>ll(t,8).getBigInt64(0,!1),t=>!1,t=>!0,Li,t=>{const e=Ae(t),n={};for(let r=0;r<e;r++){const i=Li(t);n[i]=ys(t)}return n},t=>{const e=Ae(t),n=[];for(let r=0;r<e;r++)n.push(ys(t));return n},Pt],ys=t=>yw[127-Ni(t)](t);class Lf extends Po{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),mw(this)?this.count=Ae(this)+1:this.count=-1),this.count--,this.s}}class Do extends Po{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=cl(this);const e=Ef(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ae(this)+2)}return this.count--,this.s}}class ul extends Po{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=cl(this),n=e&1;this.diff=Mr(e/2),this.count=1,n&&(this.count=Ae(this)+2)}return this.s+=this.diff,this.count--,this.s}}class _w{constructor(e){this.decoder=new Do(e),this.str=Li(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const bw=crypto.getRandomValues.bind(crypto),Mf=()=>bw(new Uint32Array(1))[0],ww="10000000-1000-4000-8000"+-1e11,vw=()=>ww.replace(/[018]/g,t=>(t^Mf()&15>>t/4).toString(16)),Uf=t=>new Promise(t);Promise.all.bind(Promise);const Pf=t=>t===void 0?null:t;class Ew{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Df=new Ew,kw=!0;try{typeof localStorage<"u"&&localStorage&&(Df=localStorage,kw=!1)}catch{}const Sw=Df,Aw=Object.assign,Tw=Object.keys,Rw=(t,e)=>{for(const n in t)e(t[n],n)},Bf=t=>Tw(t).length,Iw=t=>{for(const e in t)return!1;return!0},xw=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Ow=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Cw=(t,e)=>t===e||Bf(t)===Bf(e)&&xw(t,(n,r)=>(n!==void 0||Ow(e,r))&&e[r]===n),Nw=Object.freeze,Ff=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Ff(t[e])}return Nw(t)},hl=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&hl(t,e,n+1)}},Lw=t=>t,Mw=(t,e)=>e.includes(t);var $f={};const _s=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Dn;const Uw=()=>{if(Dn===void 0)if(_s){Dn=Sn();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Dn.set(e,""),e=r):e!==null&&(Dn.set(e,r),e=null)}e!==null&&Dn.set(e,"")}else typeof location=="object"?(Dn=Sn(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Dn.set(`--${Tf(e,"-")}`,n),Dn.set(`-${Tf(e,"-")}`,n)}})):Dn=Sn();return Dn},fl=t=>Uw().has(t),Bo=t=>Pf(_s?$f[t.toUpperCase().replaceAll("-","_")]:Sw.getItem(t)),jf=t=>fl("--"+t)||Bo(t)!==null;jf("production");const Pw=_s&&Mw($f.FORCE_COLOR,["true","1","2"])||!fl("--no-colors")&&!jf("no-color")&&(!_s||process.stdout.isTTY)&&(!_s||fl("--color")||Bo("COLORTERM")!==null||(Bo("TERM")||"").includes("color")),Dw=t=>new Uint8Array(t),Bw=t=>{const e=Dw(t.byteLength);return e.set(t),e};class Fw{constructor(e,n){this.left=e,this.right=n}}const lr=(t,e)=>new Fw(t,e);typeof DOMParser<"u"&&new DOMParser;const $w=t=>Vb(t,(e,n)=>`${n}:${e};`).join(""),ur=Symbol,zf=ur(),Wf=ur(),jw=ur(),zw=ur(),Ww=ur(),Gf=ur(),Gw=ur(),dl=ur(),Hw=ur(),Vw=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},Kw={[zf]:lr("font-weight","bold"),[Wf]:lr("font-weight","normal"),[jw]:lr("color","blue"),[Ww]:lr("color","green"),[zw]:lr("color","grey"),[Gf]:lr("color","red"),[Gw]:lr("color","purple"),[dl]:lr("color","orange"),[Hw]:lr("color","black")},Hf=Pw?t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Sn();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=Kw[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=$w(r);s>0||u.length>0?(e.push("%c"+a),n.push(u)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i}:Vw,qw=(...t)=>{console.log(...Hf(t)),Vf.forEach(e=>e.print(t))},Xw=(...t)=>{console.warn(...Hf(t)),t.unshift(dl),Vf.forEach(e=>e.print(t))},Vf=Oi(),Kf=t=>({[Symbol.iterator](){return this},next:t}),Zw=(t,e)=>Kf(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),pl=(t,e)=>Kf(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class ml{constructor(e,n){this.clock=e,this.len=n}}class bs{constructor(){this.clients=new Map}}const qf=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];fd(t,s,a.clock,a.len,n)}}),Jw=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Mr((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},Xf=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&Jw(n,e.clock)!==null},gl=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=ti(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},Yw=t=>{const e=new bs;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)qb(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return gl(e),e},Fo=(t,e,n,r)=>{Nr(t.clients,e,()=>[]).push(new ml(n,r))},Qw=()=>new bs,ev=t=>{const e=Qw();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new ml(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Mi=(t,e)=>{Se(t.restEncoder,e.clients.size),Lr(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),Se(t.restEncoder,n);const i=r.length;Se(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},yl=t=>{const e=new bs,n=Ae(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Ae(t.restDecoder),s=Ae(t.restDecoder);if(s>0){const o=Nr(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new ml(t.readDsClock(),t.readDsLen()))}}return e},Zf=(t,e,n)=>{const r=new bs,i=Ae(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Ae(t.restDecoder),a=Ae(t.restDecoder),c=n.clients.get(o)||[],u=St(n,o);for(let l=0;l<a;l++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<u){u<d&&Fo(r,o,u,d-u);let f=Tn(c,h),p=c[f];for(!p.deleted&&p.id.clock<h&&(c.splice(f+1,0,Yo(e,p,h-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&c.splice(f,0,Yo(e,p,d-p.id.clock)),p.delete(e))}else Fo(r,o,h,d-h)}}if(r.clients.size>0){const s=new ii;return Se(s.restEncoder,0),Mi(s,r),s.toUint8Array()}return null},Jf=Mf;class hr extends Zb{constructor({guid:e=vw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Jf(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new ld,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Uf(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>Uf(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ve(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Lr(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Ve(this,e,n)}get(e,n=it){const r=Nr(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==it&&i!==n)if(i===it){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Bn)}getText(e=""){return this.get(e,Rn)}getMap(e=""){return this.get(e,Fn)}getXmlElement(e=""){return this.get(e,fr)}getXmlFragment(e=""){return this.get(e,$n)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,Lr(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new hr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Ve(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Yf{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ae(this.restDecoder)}readDsLen(){return Ae(this.restDecoder)}}class Qf extends Yf{readLeftID(){return Ce(Ae(this.restDecoder),Ae(this.restDecoder))}readRightID(){return Ce(Ae(this.restDecoder),Ae(this.restDecoder))}readClient(){return Ae(this.restDecoder)}readInfo(){return Ni(this.restDecoder)}readString(){return Li(this.restDecoder)}readParentInfo(){return Ae(this.restDecoder)===1}readTypeRef(){return Ae(this.restDecoder)}readLen(){return Ae(this.restDecoder)}readAny(){return ys(this.restDecoder)}readBuf(){return Bw(Pt(this.restDecoder))}readJSON(){return JSON.parse(Li(this.restDecoder))}readKey(){return Li(this.restDecoder)}}class tv{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ae(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ae(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Ui extends tv{constructor(e){super(e),this.keys=[],Ae(e),this.keyClockDecoder=new ul(Pt(e)),this.clientDecoder=new Do(Pt(e)),this.leftClockDecoder=new ul(Pt(e)),this.rightClockDecoder=new ul(Pt(e)),this.infoDecoder=new Lf(Pt(e),Ni),this.stringDecoder=new _w(Pt(e)),this.parentInfoDecoder=new Lf(Pt(e),Ni),this.typeRefDecoder=new Do(Pt(e)),this.lenDecoder=new Do(Pt(e))}readLeftID(){return new Pi(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Pi(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ys(this.restDecoder)}readBuf(){return Pt(this.restDecoder)}readJSON(){return ys(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class ed{constructor(){this.restEncoder=Ur()}toUint8Array(){return An(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Se(this.restEncoder,e)}writeDsLen(e){Se(this.restEncoder,e)}}class ws extends ed{writeLeftID(e){Se(this.restEncoder,e.client),Se(this.restEncoder,e.clock)}writeRightID(e){Se(this.restEncoder,e.client),Se(this.restEncoder,e.clock)}writeClient(e){Se(this.restEncoder,e)}writeInfo(e){rl(this.restEncoder,e)}writeString(e){Ci(this.restEncoder,e)}writeParentInfo(e){Se(this.restEncoder,e?1:0)}writeTypeRef(e){Se(this.restEncoder,e)}writeLen(e){Se(this.restEncoder,e)}writeAny(e){gs(this.restEncoder,e)}writeBuf(e){Nt(this.restEncoder,e)}writeJSON(e){Ci(this.restEncoder,JSON.stringify(e))}writeKey(e){Ci(this.restEncoder,e)}}class td{constructor(){this.restEncoder=Ur(),this.dsCurrVal=0}toUint8Array(){return An(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,Se(this.restEncoder,n)}writeDsLen(e){e===0&&Pn(),Se(this.restEncoder,e-1),this.dsCurrVal+=e}}class ii extends td{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new al,this.clientEncoder=new Uo,this.leftClockEncoder=new al,this.rightClockEncoder=new al,this.infoEncoder=new If(rl),this.stringEncoder=new pw,this.parentInfoEncoder=new If(rl),this.typeRefEncoder=new Uo,this.lenEncoder=new Uo}toUint8Array(){const e=Ur();return Se(e,0),Nt(e,this.keyClockEncoder.toUint8Array()),Nt(e,this.clientEncoder.toUint8Array()),Nt(e,this.leftClockEncoder.toUint8Array()),Nt(e,this.rightClockEncoder.toUint8Array()),Nt(e,An(this.infoEncoder)),Nt(e,this.stringEncoder.toUint8Array()),Nt(e,An(this.parentInfoEncoder)),Nt(e,this.typeRefEncoder.toUint8Array()),Nt(e,this.lenEncoder.toUint8Array()),Mo(e,An(this.restEncoder)),An(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){gs(this.restEncoder,e)}writeBuf(e){Nt(this.restEncoder,e)}writeJSON(e){gs(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const nv=(t,e,n,r)=>{r=ti(r,e[0].id.clock);const i=Tn(e,r);Se(t.restEncoder,e.length-i),t.writeClient(n),Se(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},_l=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{St(e,s)>i&&r.set(s,i)}),jo(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Se(t.restEncoder,r.size),Lr(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{nv(t,e.clients.get(i),i,s)})},rv=(t,e)=>{const n=Sn(),r=Ae(t.restDecoder);for(let i=0;i<r;i++){const s=Ae(t.restDecoder),o=new Array(s),a=t.readClient();let c=Ae(t.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=t.readInfo();switch(Lo&l){case 0:{const h=t.readLen();o[u]=new tn(Ce(a,c),h),c+=h;break}case 10:{const h=Ae(t.restDecoder);o[u]=new cn(Ce(a,c),h),c+=h;break}default:{const h=(l&(cr|en))===0,d=new _t(Ce(a,c),null,(l&en)===en?t.readLeftID():null,null,(l&cr)===cr?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(l&fs)===fs?t.readString():null,Dd(t,l));o[u]=d,c+=d.length}}}}return n},iv=(t,e,n)=>{const r=[];let i=Lr(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new ld,c=new Map,u=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let l=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),i=i.filter(b=>b!==p)}r.length=0};for(;;){if(l.constructor!==cn){const p=Nr(h,l.id.client,()=>St(e,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),d();else{const m=l.getMissing(t,e);if(m!==null){r.push(l);const b=n.get(m)||{refs:[],i:0};if(b.refs.length===b.i)u(m,St(e,m)),d();else{l=b.refs[b.i++];continue}}else(p===0||p<l.length)&&(l.integrate(t,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const f=new ii;return _l(f,a,new Map),Se(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},sv=(t,e)=>_l(t,e.doc.store,e.beforeState),ov=(t,e,n,r=new Ui(t))=>Ve(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=rv(r,o),u=iv(i,a,c),l=a.pendingStructs;if(l){for(const[d,f]of l.missing)if(f<St(a,d)){s=!0;break}if(u){for(const[d,f]of u.missing){const p=l.missing.get(d);(p==null||p>f)&&l.missing.set(d,f)}l.update=Wo([l.update,u.update])}}else a.pendingStructs=u;const h=Zf(r,i,a);if(a.pendingDs){const d=new Ui(ri(a.pendingDs));Ae(d.restDecoder);const f=Zf(d,i,a);h&&f?a.pendingDs=Wo([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,nd(i.doc,d)}},n,!1),nd=(t,e,n,r=Ui)=>{const i=ri(e);ov(i,t,n,new r(i))},av=(t,e,n)=>nd(t,e,n,Qf),cv=(t,e,n=new Map)=>{_l(t,e.store,n),Mi(t,ev(e.store))},lv=(t,e=new Uint8Array([0]),n=new ii)=>{const r=rd(e);cv(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(Sv(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===ws)return Ev(i.map((s,o)=>o===0?s:Tv(s)));if(n.constructor===ii)return Wo(i)}return i[0]},uv=(t,e)=>lv(t,e,new ws),hv=t=>{const e=new Map,n=Ae(t.restDecoder);for(let r=0;r<n;r++){const i=Ae(t.restDecoder),s=Ae(t.restDecoder);e.set(i,s)}return e},rd=t=>hv(new Yf(ri(t))),id=(t,e)=>(Se(t.restEncoder,e.size),Lr(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Se(t.restEncoder,n),Se(t.restEncoder,r)}),t),fv=(t,e)=>id(t,jo(e.store)),dv=(t,e=new td)=>(t instanceof Map?id(e,t):fv(e,t),e.toUint8Array()),pv=t=>dv(t,new ed);class mv{constructor(){this.l=[]}}const sd=()=>new mv,od=(t,e)=>t.l.push(e),ad=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},cd=(t,e,n)=>hl(t.l,[e,n]);class Pi{constructor(e,n){this.client=e,this.clock=n}}const $o=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ce=(t,e)=>new Pi(t,e),gv=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Pn()},Di=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Xf(e.ds,t.id),bl=(t,e)=>{const n=Nr(t.meta,bl,Oi),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<St(r,s)&&Dr(t,Ce(s,i))}),qf(t,e.ds,i=>{}),n.add(e))};class ld{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const jo=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},St=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ud=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Pn()}n.push(e)},Tn=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=Mr(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=Mr((n+r)/2)}throw Pn()},wl=(t,e)=>{const n=t.clients.get(e.client);return n[Tn(n,e.clock)]},vl=(t,e,n)=>{const r=Tn(e,n),i=e[r];return i.id.clock<n&&i instanceof _t?(e.splice(r+1,0,Yo(t,i,n-i.id.clock)),r+1):r},Dr=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[vl(t,n,e.clock)]},hd=(t,e,n)=>{const r=e.clients.get(n.client),i=Tn(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==tn&&r.splice(i+1,0,Yo(t,s,n.clock-s.id.clock+1)),s},yv=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Tn(r,e.id.clock)]=n},fd=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=vl(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&vl(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class _v{constructor(e,n,r){this.doc=e,this.deleteSet=new bs,this.beforeState=jo(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const dd=(t,e)=>e.deleteSet.clients.size===0&&!Kb(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(gl(e.deleteSet),sv(t,e),Mi(t,e.deleteSet),!0),pd=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Nr(t.changed,e,Oi).add(n)},zo=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof _t&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},bv=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=Tn(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof _t&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},wv=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=vf(i.length-1,1+Tn(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+zo(i,c)}})},md=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{gl(s),n.afterState=jo(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),cd(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),hl(a,[]),n._needFormattingCleanup&&$v(n)}finally{r.gc&&bv(s,i,r.gcFilter),wv(s,i),n.afterState.forEach((l,h)=>{const d=n.beforeState.get(h)||0;if(d!==l){const f=i.clients.get(h),p=ti(Tn(f,d),1);for(let m=f.length-1;m>=p;)m-=1+zo(f,m)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:d}=o[l].id,f=i.clients.get(h),p=Tn(f,d);p+1<f.length&&zo(f,p+1)>1||p>0&&zo(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(qw(dl,zf,"[yjs] ",Wf,Gf,"Changed the client-id because another client seems to be using it."),r.clientID=Jf()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new ws;dd(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new ii;dd(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):md(t,e+1)}}},Ve=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new _v(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&md(i,0)}}return o};function*vv(t){const e=Ae(t.restDecoder);for(let n=0;n<e;n++){const r=Ae(t.restDecoder),i=t.readClient();let s=Ae(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Ae(t.restDecoder);yield new cn(Ce(i,s),c),s+=c}else if(Lo&a){const c=(a&(cr|en))===0,u=new _t(Ce(i,s),null,(a&en)===en?t.readLeftID():null,null,(a&cr)===cr?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&fs)===fs?t.readString():null,Dd(t,a));yield u,s+=u.length}else{const c=t.readLen();yield new tn(Ce(i,s),c),s+=c}}}}class El{constructor(e,n){this.gen=vv(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===cn);return this.curr}}class kl{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const Ev=t=>Wo(t,Qf,ws),kv=(t,e)=>{if(t.constructor===tn){const{client:n,clock:r}=t.id;return new tn(Ce(n,r+e),t.length-e)}else if(t.constructor===cn){const{client:n,clock:r}=t.id;return new cn(Ce(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new _t(Ce(r,i+e),null,Ce(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Wo=(t,e=Ui,n=ii)=>{if(t.length===1)return t[0];const r=t.map(l=>new e(ri(l)));let i=r.map(l=>new El(l,!0)),s=null;const o=new n,a=new kl(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const p=d.curr.id.clock-f.curr.id.clock;return p===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===cn?1:-1:p}else return f.curr.id.client-d.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let d=l.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=l.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Br(a,s.struct,s.offset),s={struct:d,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===cn)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Br(a,s.struct,s.offset);const p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new cn(Ce(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===cn?s.struct.length-=p:d=kv(d,p)),s.struct.mergeWith(d)||(Br(a,s.struct,s.offset),s={struct:d,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let d=l.curr;d!==null&&d.id.client===h&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==cn;d=l.next())Br(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Br(a,s.struct,s.offset),s=null),Sl(a);const c=r.map(l=>yl(l)),u=Yw(c);return Mi(o,u),o.toUint8Array()},Sv=(t,e,n=Ui,r=ii)=>{const i=rd(e),s=new r,o=new kl(s),a=new n(ri(t)),c=new El(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,d=i.get(h)||0;if(c.curr.constructor===cn){c.next();continue}if(l.id.clock+l.length>d)for(Br(o,l,ti(d-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Br(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Sl(o);const u=yl(a);return Mi(s,u),s.toUint8Array()},gd=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:An(t.encoder.restEncoder)}),t.encoder.restEncoder=Ur(),t.written=0)},Br=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&gd(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Se(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Sl=t=>{gd(t);const e=t.encoder.restEncoder;Se(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];Se(e,r.written),Mo(e,r.restEncoder)}},Av=(t,e,n,r)=>{const i=new n(ri(t)),s=new El(i,!1),o=new r,a=new kl(o);for(let u=s.curr;u!==null;u=s.next())Br(a,e(u),0);Sl(a);const c=yl(i);return Mi(o,c),o.toUint8Array()},Tv=t=>Av(t,Lw,Ui,ws),yd="You must not compute changes after the event-handler fired.";class Go{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Rv(this.currentTarget,this.target))}deletes(e){return Xf(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Pr(yd);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Qc(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Qc(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Qc(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Pr(yd);const n=this.target,r=Oi(),i=Oi(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const Rv=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},Lt=()=>{Xw("Invalid access: Add Yjs type to a document before reading data.")},_d=80;let Al=0;class Iv{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Al++}}const xv=t=>{t.timestamp=Al++},bd=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Al++},Ov=(t,e,n)=>{if(t.length>=_d){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return bd(r,e,n),r}else{const r=new Iv(e,n);return t.push(r),r}},Ho=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>No(e-s.index)<No(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,xv(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&No(n.index-i)<r.parent.length/_d?(bd(n,r,i),n):Ov(t._searchMarker,r,i)},vs=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=ti(e,i.index+n))}},Vo=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;Nr(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;cd(r._eH,n,e)};class it{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=sd(),this._dEH=sd(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Un()}clone(){throw Un()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){od(this._eH,e)}observeDeep(e){od(this._dEH,e)}unobserve(e){ad(this._eH,e)}unobserveDeep(e){ad(this._dEH,e)}toJSON(){}}const wd=(t,e,n)=>{t.doc??Lt(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},vd=t=>{t.doc??Lt();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Es=(t,e)=>{let n=0,r=t._start;for(t.doc??Lt();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},Ed=(t,e)=>{const n=[];return Es(t,(r,i)=>{n.push(e(r,i,t))}),n},Cv=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},kd=(t,e)=>{t.doc??Lt();const n=Ho(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ko=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new _t(Ce(o,St(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ai(u)),i.integrate(t,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new _t(Ce(o,St(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new ks(new Uint8Array(h))),i.integrate(t,0);break;case hr:i=new _t(Ce(o,St(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new As(h)),i.integrate(t,0);break;default:if(h instanceof it)i=new _t(Ce(o,St(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new dr(h)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},Sd=()=>Pr("Length exceeded!"),Ad=(t,e,n,r)=>{if(n>e._length)throw Sd();if(n===0)return e._searchMarker&&vs(e._searchMarker,n,r.length),Ko(t,e,null,r);const i=n,s=Ho(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Dr(t,Ce(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&vs(e._searchMarker,i,r.length),Ko(t,e,o,r)},Nv=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Ko(t,e,i,n)},Td=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=Ho(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Dr(t,Ce(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Dr(t,Ce(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw Sd();e._searchMarker&&vs(e._searchMarker,i,-s+r)},qo=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Tl=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new ai([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ai([r]);break;case Uint8Array:a=new ks(r);break;case hr:a=new As(r);break;default:if(r instanceof it)a=new dr(r);else throw new Error("Unexpected content type")}new _t(Ce(o,St(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Rl=(t,e)=>{t.doc??Lt();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Rd=t=>{const e={};return t.doc??Lt(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Id=(t,e)=>{t.doc??Lt();const n=t._map.get(e);return n!==void 0&&!n.deleted},Lv=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Di(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Xo=t=>(t.doc??Lt(),Zw(t._map.entries(),e=>!e[1].deleted));class Mv extends Go{}class Bn extends it{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Bn;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Bn}clone(){const e=new Bn;return e.insert(0,this.toArray().map(n=>n instanceof it?n.clone():n)),e}get length(){return this.doc??Lt(),this._length}_callObserver(e,n){super._callObserver(e,n),Vo(this,e,new Mv(this,e))}insert(e,n){this.doc!==null?Ve(this.doc,r=>{Ad(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Ve(this.doc,n=>{Nv(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Ve(this.doc,r=>{Td(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return kd(this,e)}toArray(){return vd(this)}slice(e=0,n=this.length){return wd(this,e,n)}toJSON(){return this.map(e=>e instanceof it?e.toJSON():e)}map(e){return Ed(this,e)}forEach(e){Es(this,e)}[Symbol.iterator](){return Cv(this)}_write(e){e.writeTypeRef(sE)}}const Uv=t=>new Bn;class Pv extends Go{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Fn extends it{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Fn}clone(){const e=new Fn;return this.forEach((n,r)=>{e.set(r,n instanceof it?n.clone():n)}),e}_callObserver(e,n){Vo(this,e,new Pv(this,e,n))}toJSON(){this.doc??Lt();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof it?i.toJSON():i}}),e}get size(){return[...Xo(this)].length}keys(){return pl(Xo(this),e=>e[0])}values(){return pl(Xo(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return pl(Xo(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Lt(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ve(this.doc,n=>{qo(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Ve(this.doc,r=>{Tl(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Rl(this,e)}has(e){return Id(this,e)}clear(){this.doc!==null?Ve(this.doc,e=>{this.forEach(function(n,r,i){qo(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(oE)}}const Dv=t=>new Fn,Fr=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Cw(t,e);class Il{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Pn(),this.right.content.constructor){case yt:this.right.deleted||Bi(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const xd=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case yt:e.right.deleted||Bi(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Dr(t,Ce(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Zo=(t,e,n,r)=>{const i=new Map,s=r?Ho(e,n):null;if(s){const o=new Il(s.p.left,s.p,s.index,i);return xd(t,o,n-s.index)}else{const o=new Il(null,e._start,0,i);return xd(t,o,n)}},Od=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===yt&&Fr(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new _t(Ce(s,St(i.store,s)),c,c&&c.lastId,u,u&&u.id,e,null,new yt(a,o));l.integrate(t,0),n.right=l,n.forward()})},Bi=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Cd=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===yt&&Fr(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Nd=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!Fr(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new _t(Ce(s,St(i.store,s)),l,l&&l.lastId,h,h&&h.id,e,null,new yt(a,c)),n.right.integrate(t,0),n.forward()}}return o},xl=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,f)=>{i[f]===void 0&&(i[f]=null)});const s=t.doc,o=s.clientID;Cd(n,i);const a=Nd(t,e,n,i),c=r.constructor===String?new jn(r):r instanceof it?new dr(r):new oi(r);let{left:u,right:l,index:h}=n;e._searchMarker&&vs(e._searchMarker,n.index,c.getLength()),l=new _t(Ce(o,St(s.store,o)),u,u&&u.lastId,l,l&&l.id,e,null,c),l.integrate(t,0),n.right=l,n.index=h,n.forward(),Od(t,e,n,a)},Ld=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;Cd(n,i);const a=Nd(t,e,n,i);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===yt));){if(!n.right.deleted)switch(n.right.content.constructor){case yt:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(Fr(l,u))a.delete(c);else{if(r===0)break e;a.set(c,u)}n.right.delete(t)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Dr(t,Ce(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new _t(Ce(o,St(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new jn(c)),n.right.integrate(t,0),n.forward()}Od(t,e,n,a)},Md=(t,e,n,r,i)=>{let s=e;const o=Sn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===yt){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const u=e.content;switch(u.constructor){case yt:{const{key:l,value:h}=u,d=r.get(l)??null;(o.get(l)!==u||d===h)&&(e.delete(t),a++,!c&&(i.get(l)??null)===h&&d!==h&&(d===null?i.delete(l):i.set(l,d))),!c&&!e.deleted&&Bi(i,u);break}}}e=e.right}return a},Bv=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===yt){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Fv=t=>{let e=0;return Ve(t.doc,n=>{let r=t._start,i=t._start,s=Sn();const o=Yc(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case yt:Bi(o,i.content);break;default:e+=Md(n,r,i,s,o),s=Yc(o),r=i;break}i=i.right}}),e},$v=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&fd(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===yt&&o.constructor!==tn&&e.add(o.parent)})}Ve(n,r=>{qf(t,t.deleteSet,i=>{if(i instanceof tn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===yt?e.add(s):Bv(r,i)});for(const i of e)Fv(i)})},Ud=(t,e,n)=>{const r=n,i=Yc(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case dr:case oi:case jn:n<e.right.length&&Dr(t,Ce(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Md(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&vs(o._searchMarker,e.index,-r+n),e};class jv extends Go{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Ve(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(f={insert:u},i.size>0&&(f.attributes={},i.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),u="";break;case"retain":l>0&&(f={retain:l},Iw(c)||(f.attributes=Aw({},c))),l=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case dr:case oi:this.adds(o)?this.deletes(o)||(d(),a="insert",u=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),l+=1);break;case jn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),l+=o.length);break;case yt:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(f)??null;Fr(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Fr(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const m=i.get(f)??null;Fr(m,p)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){s.set(f,p);const m=c[f];m!==void 0&&(Fr(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&d(),Bi(i,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Rn extends it{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Lt(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Rn}clone(){const e=new Rn;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new jv(this,e,n);Vo(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Lt();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===jn&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Ve(this.doc,r=>{const i=new Il(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&xl(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Ld(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Ud(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Lt();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let d=!1;s.forEach((p,m)=>{d=!0,h[m]=p});const f={insert:a};d&&(f.attributes=h),i.push(f),a=""}}const l=()=>{for(;c!==null;){if(Di(c,e)||n!==void 0&&Di(c,n))switch(c.content.constructor){case jn:{const h=s.get("ychange");e!==void 0&&!Di(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Di(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case dr:case oi:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const d={};h.attributes=d,s.forEach((f,p)=>{d[p]=f})}i.push(h);break}case yt:Di(c,e)&&(u(),Bi(s,c.content));break}c=c.right}u()};return e||n?Ve(o,h=>{e&&bl(h,e),n&&bl(h,n),l()},"cleanup"):l(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Ve(i,s=>{const o=Zo(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),xl(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?Ve(i,s=>{const o=Zo(s,this,e,!r);xl(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Ve(r,i=>{Ud(i,Zo(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Ve(i,s=>{const o=Zo(s,this,e,!1);o.right!==null&&Ld(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Ve(this.doc,n=>{qo(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Ve(this.doc,r=>{Tl(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Rl(this,e)}getAttributes(){return Rd(this)}_write(e){e.writeTypeRef(aE)}}const zv=t=>new Rn;class Ol{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Lt()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===fr||n.constructor===$n)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class $n extends it{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $n}clone(){const e=new $n;return e.insert(0,this.toArray().map(n=>n instanceof it?n.clone():n)),e}get length(){return this.doc??Lt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ol(this,e)}querySelector(e){e=e.toUpperCase();const r=new Ol(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Lr(new Ol(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Vo(this,e,new Hv(this,n,e))}toString(){return Ed(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Es(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Ve(this.doc,r=>{Ad(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Ve(this.doc,r=>{const i=e&&e instanceof it?e._item:e;Ko(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Pr("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Ve(this.doc,r=>{Td(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return vd(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return kd(this,e)}slice(e=0,n=this.length){return wd(this,e,n)}forEach(e){Es(this,e)}_write(e){e.writeTypeRef(lE)}}const Wv=t=>new $n;class fr extends $n{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new fr(this.nodeName)}clone(){const e=new fr(this.nodeName),n=this.getAttributes();return Rw(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof it?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ve(this.doc,n=>{qo(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Ve(this.doc,r=>{Tl(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Rl(this,e)}hasAttribute(e){return Id(this,e)}getAttributes(e){return e?Lv(this,e):Rd(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Es(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(cE),e.writeKey(this.nodeName)}}const Gv=t=>new fr(t.readKey());class Hv extends Go{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Fi extends Fn{constructor(e){super(),this.hookName=e}_copy(){return new Fi(this.hookName)}clone(){const e=new Fi(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(uE),e.writeKey(this.hookName)}}const Vv=t=>new Fi(t.readKey());class si extends Rn{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new si}clone(){const e=new si;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(hE)}}const Kv=t=>new si;class Cl{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Un()}mergeWith(e){return!1}write(e,n,r){throw Un()}integrate(e,n){throw Un()}}const qv=0;class tn extends Cl{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),ud(e.doc.store,this)}write(e,n){e.writeInfo(qv),e.writeLen(this.length-n)}getMissing(e,n){return null}}class ks{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ks(this.content)}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const Xv=t=>new ks(t.readBuf());class Ss{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ss(this.len)}splice(e){const n=new Ss(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Fo(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Zv=t=>new Ss(t.readLen()),Pd=(t,e)=>new hr({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class As{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new As(Pd(this.doc.guid,this.opts))}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Jv=t=>new As(Pd(t.readString(),t.readAny()));class oi{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new oi(this.embed)}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const Yv=t=>new oi(t.readJSON());class yt{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new yt(this.key,this.value)}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Qv=t=>new yt(t.readKey(),t.readJSON());class Jo{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Jo(this.arr)}splice(e){const n=new Jo(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const eE=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new Jo(n)},tE=Bo("node_env")==="development";class ai{constructor(e){this.arr=e,tE&&Ff(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ai(this.arr)}splice(e){const n=new ai(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const nE=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new ai(n)};class jn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new jn(this.str)}splice(e){const n=new jn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const rE=t=>new jn(t.readString()),iE=[Uv,Dv,zv,Gv,Wv,Vv,Kv],sE=0,oE=1,aE=2,cE=3,lE=4,uE=5,hE=6;class dr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new dr(this.type._copy())}splice(e){throw Un()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const fE=t=>new dr(iE[t.readTypeRef()](t)),Yo=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new _t(Ce(r,i+n),e,Ce(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ce(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class _t extends Cl{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Sf:0}set marker(e){(this.info&tl)>0!==e&&(this.info^=tl)}get marker(){return(this.info&tl)>0}get keep(){return(this.info&kf)>0}set keep(e){this.keep!==e&&(this.info^=kf)}get countable(){return(this.info&Sf)>0}get deleted(){return(this.info&el)>0}set deleted(e){this.deleted!==e&&(this.info^=el)}markDeleted(){this.info|=el}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=St(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=St(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Pi&&this.id.client!==this.parent.client&&this.parent.clock>=St(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=hd(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Dr(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===tn||this.right&&this.right.constructor===tn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===_t&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===_t&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Pi){const r=wl(n,this.parent);r.constructor===tn?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=hd(e,e.doc.store,Ce(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),$o(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if($o(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(wl(e.doc.store,i.origin)))s.has(wl(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ud(e.doc.store,this),this.content.integrate(e,this),pd(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new tn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ce(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&$o(e.origin,this.lastId)&&this.right===e&&$o(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Fo(e.deleteSet,this.id.client,this.id.clock,this.length),pd(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Pn();this.content.gc(e),n?yv(e,this,new tn(this.id,this.length)):this.content=new Ss(this.length)}write(e,n){const r=n>0?Ce(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Lo|(r===null?0:en)|(i===null?0:cr)|(s===null?0:fs);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=gv(a);e.writeParentInfo(!0),e.writeString(u)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Pi?(e.writeParentInfo(!1),e.writeLeftID(a)):Pn();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Dd=(t,e)=>dE[e&Lo](t),dE=[()=>{Pn()},Zv,eE,Xv,rE,Yv,Qv,fE,nE,Jv,()=>{Pn()}],pE=10;class cn extends Cl{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Pn()}write(e,n){e.writeInfo(pE),Se(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Bd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Fd="__ $YJS$ __";Bd[Fd]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Bd[Fd]=!0;let Nl,Ll,mE=t=>t();function gE(t,e){if(Ll)return Ll(t,e);mE(t)}function ci(t,e,n){if(Nl)return Nl.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function yE(t){Nl=function(e,n,r){const i=t.createAtom(e);return n&&n(),i},Ll=(e,n)=>t.reaction(e,n,{fireImmediately:!1})}const $d=new WeakSet;function _E(t){if($d.has(t))return t;$d.add(t);let e;const n=new Map;function r(){if(!e){const h=d=>{(d.changes.added.size||d.changes.deleted.size||d.changes.keys.size||d.changes.delta.length)&&e.reportChanged()};e=ci("map",()=>{t.observe(h)},()=>{t.unobserve(h)})}e.reportObserved(t._implicitObserver)}function i(h){let d=n.get(h);if(!d){const f=p=>{d.reportChanged()};d=ci(h+"",()=>{t.observe(f)},()=>{t.unobserve(f)}),n.set(h,d)}d.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(h){if(typeof h!="number")throw new Error("unexpected");return i(h),Reflect.apply(s,this,arguments)};function o(h){const d=t[h];t[h]=function(){return r(),Reflect.apply(d,this,arguments)}}function a(h){let d=t,f=Object.getOwnPropertyDescriptor(d,h);if(f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),f||(d=Object.getPrototypeOf(d),f=Object.getOwnPropertyDescriptor(d,h)),!f)throw new Error("property not found");const p=f.get;f.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(t,h,f)}function c(h,d){let f=t,p=Object.getOwnPropertyDescriptor(f,h);if(p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,h)),!p)throw new Error("property not found");Object.defineProperty(t,d,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const u=t.push;t.push=function(h){this._disableTracking=!0;const d=u.call(this,h);return this._disableTracking=!1,d};const l=t.slice;return t.slice=function(h,d){this._disableTracking=!0;const f=l.call(this,h,d);return this._disableTracking=!1,f},t}const jd=new WeakSet;function bE(t){if(jd.has(t))return t;jd.add(t);let e;function n(){if(!e){let s=Array.from(t.share.keys());const o=a=>{const c=Array.from(t.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,e.reportChanged())};e=ci("map",()=>{t.on("beforeObserverCalls",o)},()=>{t.off("beforeObserverCalls",o)})}e.reportObserved(t._implicitObserver)}const r=t.get;t.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return Qo(o),o};function i(s){const o=t[s];let a;t[s]=function(){let c,u=arguments;return n(),a&&a.removeObservers(),a=gE(()=>(c=Reflect.apply(o,t,u),c),()=>e.reportChanged()),c}}return i("toJSON"),Object.defineProperty(t,"keys",{get:()=>(n(),Object.keys(t.share))}),t}const zd=new WeakSet;function wE(t){if(zd.has(t))return t;zd.add(t);let e;const n=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=ci("map",()=>{t.observe(a)},()=>{t.unobserve(a)})}e.reportObserved(t._implicitObserver)}function i(a){let c=n.get(a);if(!c){const u=l=>{l.keysChanged.has(a)&&(l.changes.added.size||l.changes.deleted.size||l.changes.keys.size||l.changes.delta.length)&&c.reportChanged()};c=ci(a,()=>{t.observe(u)},()=>{t.unobserve(u)}),n.set(a,c)}c.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=t[a];t[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),t}const Wd=new WeakSet;function Gd(t){if(Wd.has(t))return t;Wd.add(t);let e;const n=i=>{e.reportChanged()};e=ci("text",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(i){const s=t[i];t[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),t}const Hd=new WeakSet;function Vd(t){if(Hd.has(t))return t;Hd.add(t);let e;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&e.reportChanged()};e=ci("xml",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(s){const o=t[s];t[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=t,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(t,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),t}function Qo(t){return t instanceof si||t instanceof Rn?Gd(t):t instanceof Bn?_E(t):t instanceof Fn?wE(t):t instanceof hr||Object.prototype.hasOwnProperty.call(t,"autoLoad")?bE(t):t instanceof $n||t instanceof fr?Vd(t):t}function Kd(t){t.share.forEach(e=>{e.constructor!==it&&Qo(e)})}function qd(t,e){for(let r=t.length-1;r>=e;r--){let i=t[r];if(!i.deleted){var n;if(i instanceof tn)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof it&&Qo(s)})}}}const Xd=new WeakSet;function vE(t){Xd.has(t)||(Xd.add(t),Qo(t),t.store.clients.forEach(e=>{e&&qd(e,0)}),Kd(t),t.on("beforeObserverCalls",e=>{Kd(t),e.afterState.forEach((n,r)=>{const i=e.beforeState.get(r)||0;if(i!==n){const s=e.doc.store.clients.get(r);if(!s)return;const o=Tn(s,i);qd(s,o)}})}))}class Ts{constructor(e){this.value=void 0,this.value=e}}function EE(t){return ArrayBuffer.isView(t)?new Ts(t):new Ts(Object.freeze(t))}function kE(t){const e=function(){var a;let c=(a=this[an])==null?void 0:a.implicitObserver;return t._implicitObserver=c,t.slice.bind(t).apply(t,arguments).map(l=>{const h=ea(l,c);return c&&typeof h=="object"?hs(h,c):h})},n=function(a){return a.map(c=>{const u=Ml(c);let l=li(u)||u;if(l instanceof Ts&&(l=l.value),l instanceof it&&l.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return l})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},i={slice:e,unshift:(...o)=>(t.unshift(n(o)),t.lengthUntracked),push:(...o)=>(t.push(n(o)),t.lengthUntracked),insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>IE(a,o))},splice:function(){let o=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),u=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return t.doc?t.doc.transact(()=>{t.delete(o,a),t.insert(o,n(c))}):(t.delete(o,a),t.insert(o,n(c))),u}},s=[];for(let o in i)s[o]=i[o];return s}function Rs(t){if(typeof t=="string"&&t.trim().length){const e=Number(t);if(Number.isInteger(e))return e}return t}function Zd(t,e=new Bn){if(e[gt])throw new Error("unexpected");const n=kE(e),r=new Proxy(n,{set:(i,s,o)=>{throw typeof Rs(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=Rs(s);if(a===ta)return e;if(typeof a=="number"){let l;if(o&&o[an]){var c;l=(c=o[an])==null?void 0:c.implicitObserver,e._implicitObserver=l}let h=e.get(a);return h=ea(h,l),h}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const l=e.slice();return Reflect.get(l,a)}return a==="length"?e.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=Rs(s);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(i,s)=>{const o=Rs(s);return typeof o!="number"?Reflect.has(i,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=Rs(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<e.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,t),r}function Jd(t,e=new Fn){if(e[gt])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=Ml(s);let a=li(o)||o;if(a instanceof Ts&&(a=a.value),a instanceof it&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(i,a),!0},get:(r,i,s)=>{if(i===ta)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[an]){var a;o=(a=s[an])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(i);return c=ea(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return e.has(i)?(e.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&e.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});Is.set(e,n);for(let r in t)n[r]=t[r];return n}function SE(t){return t instanceof it}const Is=new WeakMap;function ea(t,e){if(SE(t)){if(t._implicitObserver=e,t instanceof Bn||t instanceof Fn){if(!Is.has(t)){const n=Ml(t);Is.set(t,n)}t=Is.get(t)}else if(t instanceof fr||t instanceof $n||t instanceof si||t instanceof Fi||t instanceof Rn)Zc(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return EE(t)}return t}function Ml(t){if(t==null)return t;if(t=li(t)||t,t instanceof Bn)return Zd([],t);if(t instanceof Fn)return Jd({},t);if(typeof t=="string")return t;if(Array.isArray(t))return Zd(t);if(t instanceof fr||t instanceof $n||t instanceof si||t instanceof Fi)return t;if(t instanceof Rn)return t;if(typeof t=="object")return t instanceof Ts?t:Jd(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function AE(t){for(let[e,n]of Object.entries(t))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function Yd(t,e,n){let r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function TE(t,e){if(t[gt])throw new Error("unexpected");AE(e);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===ta)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[an]){var a;o=(a=s[an])==null?void 0:a.implicitObserver,t._implicitObserver=o}if(i==="toJSON"){for(let l of Object.keys(e))Yd(t,e,l);return Reflect.get(t,i)}let c=Yd(t,e,i);return c=ea(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&t.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.share.keys())});return Is.set(t,n),n}yE(Hb);const ta=Symbol("INTERNAL_SYMBOL");function Qd(t,e){const n=li(t)||t;if(!n)throw new Error("not a valid synced object");return n instanceof hr?(n.on("update",e),()=>{n.off("update",e)}):(n.observeDeep(e),()=>{n.unobserveDeep(e)})}function RE(t){const e=li(t);if(!(e instanceof hr))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function li(t){if(typeof t!="object"||t===null)return;const e=t[ta];return e&&(Zc(e),e.__v_skip=!0),e}function IE(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){const n=li(t),r=li(e);return!n||!r?!1:n===r}return!1}function xE(t,e=new hr){return vE(e),TE(e,t)}var Ie={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xs=Symbol.for("react.element"),OE=Symbol.for("react.portal"),CE=Symbol.for("react.fragment"),NE=Symbol.for("react.strict_mode"),LE=Symbol.for("react.profiler"),ME=Symbol.for("react.provider"),UE=Symbol.for("react.context"),PE=Symbol.for("react.forward_ref"),DE=Symbol.for("react.suspense"),BE=Symbol.for("react.memo"),FE=Symbol.for("react.lazy"),ep=Symbol.iterator;function $E(t){return t===null||typeof t!="object"?null:(t=ep&&t[ep]||t["@@iterator"],typeof t=="function"?t:null)}var tp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},np=Object.assign,rp={};function $i(t,e,n){this.props=t,this.context=e,this.refs=rp,this.updater=n||tp}$i.prototype.isReactComponent={},$i.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},$i.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function ip(){}ip.prototype=$i.prototype;function Ul(t,e,n){this.props=t,this.context=e,this.refs=rp,this.updater=n||tp}var Pl=Ul.prototype=new ip;Pl.constructor=Ul,np(Pl,$i.prototype),Pl.isPureReactComponent=!0;var sp=Array.isArray,op=Object.prototype.hasOwnProperty,Dl={current:null},ap={key:!0,ref:!0,__self:!0,__source:!0};function cp(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)op.call(e,r)&&!ap.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:xs,type:t,key:s,ref:o,props:i,_owner:Dl.current}}function jE(t,e){return{$$typeof:xs,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Bl(t){return typeof t=="object"&&t!==null&&t.$$typeof===xs}function zE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var lp=/\/+/g;function Fl(t,e){return typeof t=="object"&&t!==null&&t.key!=null?zE(""+t.key):e.toString(36)}function na(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case xs:case OE:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Fl(o,0):r,sp(i)?(n="",t!=null&&(n=t.replace(lp,"$&/")+"/"),na(i,e,n,"",function(u){return u})):i!=null&&(Bl(i)&&(i=jE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(lp,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",sp(t))for(var a=0;a<t.length;a++){s=t[a];var c=r+Fl(s,a);o+=na(s,e,n,c,i)}else if(c=$E(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=r+Fl(s,a++),o+=na(s,e,n,c,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ra(t,e,n){if(t==null)return t;var r=[],i=0;return na(t,r,"","",function(s){return e.call(n,s,i++)}),r}function WE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Dt={current:null},ia={transition:null},GE={ReactCurrentDispatcher:Dt,ReactCurrentBatchConfig:ia,ReactCurrentOwner:Dl};function up(){throw Error("act(...) is not supported in production builds of React.")}Ie.Children={map:ra,forEach:function(t,e,n){ra(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ra(t,function(){e++}),e},toArray:function(t){return ra(t,function(e){return e})||[]},only:function(t){if(!Bl(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},Ie.Component=$i,Ie.Fragment=CE,Ie.Profiler=LE,Ie.PureComponent=Ul,Ie.StrictMode=NE,Ie.Suspense=DE,Ie.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=GE,Ie.act=up,Ie.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=np({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Dl.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)op.call(e,c)&&!ap.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:xs,type:t.type,key:i,ref:s,props:r,_owner:o}},Ie.createContext=function(t){return t={$$typeof:UE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:ME,_context:t},t.Consumer=t},Ie.createElement=cp,Ie.createFactory=function(t){var e=cp.bind(null,t);return e.type=t,e},Ie.createRef=function(){return{current:null}},Ie.forwardRef=function(t){return{$$typeof:PE,render:t}},Ie.isValidElement=Bl,Ie.lazy=function(t){return{$$typeof:FE,_payload:{_status:-1,_result:t},_init:WE}},Ie.memo=function(t,e){return{$$typeof:BE,type:t,compare:e===void 0?null:e}},Ie.startTransition=function(t){var e=ia.transition;ia.transition={};try{t()}finally{ia.transition=e}},Ie.unstable_act=up,Ie.useCallback=function(t,e){return Dt.current.useCallback(t,e)},Ie.useContext=function(t){return Dt.current.useContext(t)},Ie.useDebugValue=function(){},Ie.useDeferredValue=function(t){return Dt.current.useDeferredValue(t)},Ie.useEffect=function(t,e){return Dt.current.useEffect(t,e)},Ie.useId=function(){return Dt.current.useId()},Ie.useImperativeHandle=function(t,e,n){return Dt.current.useImperativeHandle(t,e,n)},Ie.useInsertionEffect=function(t,e){return Dt.current.useInsertionEffect(t,e)},Ie.useLayoutEffect=function(t,e){return Dt.current.useLayoutEffect(t,e)},Ie.useMemo=function(t,e){return Dt.current.useMemo(t,e)},Ie.useReducer=function(t,e,n){return Dt.current.useReducer(t,e,n)},Ie.useRef=function(t){return Dt.current.useRef(t)},Ie.useState=function(t){return Dt.current.useState(t)},Ie.useSyncExternalStore=function(t,e,n){return Dt.current.useSyncExternalStore(t,e,n)},Ie.useTransition=function(){return Dt.current.useTransition()},Ie.version="18.3.1";const $l=0,hp=1,fp=2,HE=(t,e)=>{Se(t,$l);const n=pv(e);Nt(t,n)},dp=(t,e,n)=>{Se(t,hp),Nt(t,uv(e,n))},VE=(t,e,n)=>dp(e,n,Pt(t)),pp=(t,e,n)=>{try{av(e,Pt(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},KE=(t,e)=>{Se(t,fp),Nt(t,e)},qE=pp,XE=(t,e,n,r)=>{const i=Ae(t);switch(i){case $l:VE(t,e,n);break;case hp:pp(t,n,r);break;case fp:qE(t,n,r);break;default:throw new Error("Unknown message type")}return i};function Bt(t,e,n,r){const i=r??"";return _e.emit(`error:${e}`,t,n,i),yk(t,n,i)}function ZE(t,e){_e.emit("broadcast:createsession",t,void 0,e)}function JE(t,e){_e.emit("broadcast:closesession",t,void 0,e)}function YE(t,e,n){_e.emit("broadcast:startstream",t,e,n)}function QE(t,e){_e.emit("broadcast:stopstream",t,void 0,e)}function ek(t,e,n){_e.emit("chat:connect",t,e,n)}function tk(t,e){_e.emit("chat:disconnect",t,void 0,e)}function nk(t,e,n){_e.emit("gadgetclient:reset",t,e,n)}function rk(t,e,n){_e.emit("gadgetclient:patch",t,e,n)}function ik(t,e){_e.emit("gadgetserver:clearplayer",t,void 0,e)}function sk(t,e){_e.emit("peer:joincode",t,void 0,e)}function ok(t,e){_e.emit("started",t,void 0,e)}function ak(t,e,n,r){_e.emit("register:flush",t,[e,n],r)}function ck(t,e){_e.emit("register:dev",t,void 0,e)}function lk(t,e){_e.emit("register:share",t,void 0,e)}function uk(t,e){_e.emit("register:nuke",t,void 0,e)}function hk(t,e,n){_e.emit("synth:tts",t,[e,n])}function fk(t,e,n){_e.emit("synth:play",t,[e,n])}function dk(t,e,n){_e.emit("synth:mainvolume",t,e,n)}function pk(t,e,n){_e.emit("synth:drumvolume",t,e,n)}function mk(t,e,n){_e.emit("synth:ttsvolume",t,e,n)}function jl(t,e,n,r){_e.emit("synth:voice",t,[e,n,r])}function gk(t,e,n,r,i){_e.emit("synth:voicefx",t,[e,n,r,i])}function In(t,...e){return _e.emit("tape:info",t,e),!0}function mp(t,...e){return _e.emit("tape:debug",t,e),!0}function yk(t,...e){return _e.emit("tape:error",t,e),!1}function _k(t,e,n,r,i,s){_e.emit("tape:editor:open",t,[e,n,r,i],s)}function bk(t,e){_e.emit("vm:login",t,void 0,e)}function wk(t,e){_e.emit("vm:endgame",t,void 0,e)}function gp(t,e){return`${t}${e}`}function zl(t,e,n){_e.emit("vm:flush",t,e,n)}const pr=xE({shared:[]});function sa(t,e,n){return t.find(r=>r.key===e&&r.type===n)}function tU(t){}function yp(t,e,n){const r=sa(pr.shared,t,e);k(r)||pr.shared.push({key:t,type:e,value:n})}function vk(t,e){yp(t,0,e)}function _p(t,e){const n=new Rn(e);yp(t,1,n)}function Ek(t,e){const n=sa(pr.shared,t,0);if(k(n)){n.value=e;return}pr.shared.push({key:t,type:0,value:e})}function kk(t,e){const n=new Rn(e),r=sa(pr.shared,t,1);if(k(r)){r.value=n;return}pr.shared.push({key:t,type:1,value:n})}function bp(t,e,n){let r;function i(){const o=sa(pr.shared,t,e);k(o)&&(s(),r=Qd(o,()=>n(o.value)))}const s=Qd(pr.shared,i);return i(),()=>r==null?void 0:r()}function Sk(t,e){return bp(t,0,e)}function wp(t,e){return bp(t,1,n=>e(n.toJSON()))}function oa(t){return An(t)}const $r=RE(pr),zn=as("modem",["second"],t=>{switch(t.target){case"second":break;case"join":if(t.sender!==zn.id()){zn.reply(t,"joinack");const e=Ur();HE(e,$r),zn.reply(t,"sync",oa(e));const n=Ur();dp(n,$r),zn.reply(t,"sync",oa(n))}break;case"joinack":t.sender,zn.id();break;case"sync":{if(t.sender!==zn.id()&&k(t.data))try{const e=ri(t.data),n=Ur();XE(e,n,$r,zn)===$l&&zn.emit("modem:sync",oa(n))}catch(e){Bt(zn.name(),"sync",e.message)}break}}});function vp(t){const e=Ur();KE(e,t),zn.emit("modem:sync",oa(e))}$r.on("update",vp),$r.on("destroy",()=>{$r==null||$r.off("update",vp)});const Ak=8,Tk=14;function aa(t,e){return new Array(t).fill(e)}function Ep(t,e,n,r,i=0){const s=n*r;return{id:`tiles:${t}:${e}`,type:1,width:n,height:r,char:aa(s,0),color:aa(s,0),bg:aa(s,i)}}function Rk(t,e,n,r=1,i=15){return{id:`sprites:${t}:${e}:${n}`,x:0,y:0,char:r,color:i,bg:Te.ONCLEAR}}function Ik(t,e){return{id:`sprites:${t}:${e}`,type:2,sprites:[]}}function xk(t,e,n,r,i=0){const s=n*r;return{id:`dither:${t}:${e}`,type:3,width:n,height:r,alphas:aa(s,i)}}function Ok(t,e){return{id:`control:${t}:${e}`,type:5,focusx:0,focusy:0,focusid:t,viewscale:2}}var ln=(t=>(t[t.START=0]="START",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.SCROLL=5]="SCROLL",t))(ln||{});const Ck={start:0,left:1,right:2,top:3,bottom:4,scroll:5},Nk={0:1,1:20,2:20,3:1,4:1,5:40};function kp(t,e){return`${t}:${e}`}const Lk=1,Mk=16,Uk=256;var Ft=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Ft||{});const jr={};function Wl(){return{layers:[],panels:[],reset:!0,focus:"scroll"}}function Sp(t){t.text=[],Object.values(jr[t.id]??{}).forEach(e=>e==null?void 0:e()),jr[t.id]={}}function Ap(t){const e=t.panels.find(n=>n.name===t.focus);if(!e){const n={id:at(),name:t.focus,edge:ln.RIGHT,size:20,text:[]};return t.panels.push(n),t.reset=!1,n}return e}const Pk=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),Dk=new Set(["rn","range","sl","select","nm","number","tx","text"]),Bk=new Set(["tx","text"]),Fk={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""},Gl={};let Tp=t=>{let e=Gl[t];return k(e)||(Gl[t]=e=Wl()),e};function $k(t){Tp=t}function ui(t){return Tp(t)}function jk(t){const e=ui(t);e.panels=e.panels.filter(n=>n.edge!==ln.SCROLL)}function zk(t,e,n){Object.values(jr).forEach(r=>{if(r[e]!==void 0){const i=kp(t.id(),e);Ee(n)&&Ek(i,n),ke(n)&&kk(i,n)}})}function Wk(t){let e="";const n=ui(t);return n.panels=n.panels.filter(r=>{if(r.edge===ln.SCROLL){const[i]=r.text;return ke(i)&&r.text.length===1&&(e=i),r.text.length>1}return!0}),e}function Hl(t,e,n,r,i){const s=ui(t),o=r,a=i??Ub.capital(e),c=s.panels.find(u=>u.name===a);if(c)s.reset=!0,s.focus=a,Ee(o)&&(c.size=o);else switch(n){case ln.START:{Gl[t]=Wl();break}case ln.LEFT:case ln.RIGHT:case ln.TOP:case ln.BOTTOM:case ln.SCROLL:{const u={id:at(),name:a,edge:n,size:o??Nk[n],text:[]};s.panels.push(u),s.focus=a;break}}}function Gk(t,e){const n=ui(t),r=Ap(n);n.reset&&(n.reset=!1,Sp(r)),r.text.push(e)}function Hk(t,e,n,r,i){const s=ui(t),o=Ap(s);s.reset&&(s.reset=!1,Sp(o));const a=Pe(r),c=[e.id(),n,...Pk.has(a)?[a]:["hyperlink",r],...i],u=c[2];if(Dk.has(u)){const l=`${c[3]??""}`;jr[o.id]=jr[o.id]??{};const h=e.get(l)??Fk[u];if(jr[o.id][l]===void 0){const d=kp(e.id(),l);Ee(h)&&vk(d,h),ke(h)&&_p(d,h),Bk.has(u)?jr[o.id][l]=wp(d,f=>{k(f)&&f!==e.get(l)&&e.set(l,f)}):jr[o.id][l]=Sk(d,f=>{k(f)&&f!==e.get(l)&&e.set(l,f)})}}o.text.push(c)}var Rp={exports:{}},Vl={exports:{}},Ip;function Vk(){return Ip||(Ip=1,function(t,e){(function(n,r){t.exports=r()})(Ut,function(){function n(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(m){if(m)for(var b=0;b<l.length;b++)m[l[b]]!==void 0&&this["set"+r(l[b])](m[l[b]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",b=this.getLineNumber()||"",_=this.getColumnNumber()||"",w=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+b+":"+_+")":"[eval]:"+b+":"+_:w?w+" ("+m+":"+b+":"+_+")":m+":"+b+":"+_}},h.fromString=function(b){var _=b.indexOf("("),w=b.lastIndexOf(")"),E=b.substring(0,_),S=b.substring(_+1,w).split(","),C=b.substring(w+1);if(C.indexOf("@")===0)var I=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(C,""),R=I[1],B=I[2],L=I[3];return new h({functionName:E,args:S||void 0,fileName:R,lineNumber:B||void 0,columnNumber:L||void 0})};for(var d=0;d<s.length;d++)h.prototype["get"+r(s[d])]=i(s[d]),h.prototype["set"+r(s[d])]=function(m){return function(b){this[m]=!!b}}(s[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=i(o[f]),h.prototype["set"+r(o[f])]=function(m){return function(b){if(!n(b))throw new TypeError(m+" must be a Number");this[m]=Number(b)}}(o[f]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(m){return function(b){this[m]=String(b)}}(a[p]);return h})}(Vl)),Vl.exports}(function(t,e){(function(n,r){t.exports=r(Vk())})(Ut,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),p=d&&h||void 0,m=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:m,lineNumber:f[1],columnNumber:f[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=l.match(h),f=d&&d[1]?d[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],d=2,f=l.length;d<f;d+=2){var p=u.exec(l[d]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[d]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],d=0,f=l.length;d<f;d+=2){var p=u.exec(l[d]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[d]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;f.match(/\(([^)]*)\)/)&&(m=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:l})},this)}}})})(Rp);var Kk=Rp.exports,qk=Ii(Kk);const Wn=!!JSON.parse("false"),Xk=!!JSON.parse("false");JSON.parse("false");const Zk=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const mr={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Ak*mr.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Tk*mr.DRAW_CHAR_SCALE}};function gr(t){const e={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}var xp={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Ut,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(xp);var Jk=xp.exports,Op=Ii(Jk);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Cp="170",Yk="",ca="srgb",Np="srgb-linear",Lp="linear",Kl="srgb";function Qk(t,e,n){return Math.max(e,Math.min(n,t))}class Os{constructor(e=0,n=0){Os.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(Qk(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Cs{constructor(e,n,r,i,s,o,a,c,u){Cs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,u)}set(e,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=e,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],d=r[2],f=r[5],p=r[8],m=i[0],b=i[3],_=i[6],w=i[1],E=i[4],S=i[7],C=i[2],I=i[5],R=i[8];return s[0]=o*m+a*w+c*C,s[3]=o*b+a*E+c*I,s[6]=o*_+a*S+c*R,s[1]=u*m+l*w+h*C,s[4]=u*b+l*E+h*I,s[7]=u*_+l*S+h*R,s[2]=d*m+f*w+p*C,s[5]=d*b+f*E+p*I,s[8]=d*_+f*S+p*R,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],l=e[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],l=e[8],h=l*o-a*u,d=a*c-l*s,f=u*s-o*c,p=n*h+r*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*u-l*r)*m,e[2]=(a*r-i*o)*m,e[3]=d*m,e[4]=(l*n-i*c)*m,e[5]=(i*s-a*n)*m,e[6]=f*m,e[7]=(r*c-u*n)*m,e[8]=(o*n-r*s)*m,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+e,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(ql.makeScale(e,n)),this}rotate(e){return this.premultiply(ql.makeRotation(-e)),this}translate(e,n){return this.premultiply(ql.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ql=new Cs,e1={enabled:!0,workingColorSpace:Np,spaces:{},convert:function(t,e,n){return this.enabled===!1||e===n||!e||!n||(this.spaces[e].transfer===Kl&&(t.r=Xl(t.r),t.g=Xl(t.g),t.b=Xl(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===Kl&&(t.r=Zl(t.r),t.g=Zl(t.g),t.b=Zl(t.b))),t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===Yk?Lp:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function Xl(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Zl(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const Mp=[.64,.33,.3,.6,.15,.06],Up=[.2126,.7152,.0722],Pp=[.3127,.329],Dp=new Cs().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Bp=new Cs().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);e1.define({[Np]:{primaries:Mp,whitePoint:Pp,transfer:Lp,toXYZ:Dp,fromXYZ:Bp,luminanceCoefficients:Up,workingColorSpaceConfig:{unpackColorSpace:ca},outputColorSpaceConfig:{drawingBufferColorSpace:ca}},[ca]:{primaries:Mp,whitePoint:Pp,transfer:Kl,toXYZ:Dp,fromXYZ:Bp,luminanceCoefficients:Up,outputColorSpaceConfig:{drawingBufferColorSpace:ca}}}),typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Cp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Cp),new Os,new Os;function Gn(t,e,n){return Math.max(e,Math.min(n,t))}const t1=Op("089fad0j9awfem09wavefc09uwaef");function n1(){return t1()}function r1(t){return Op(t)()}function Ns(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(n1()*i)}function i1(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(r1(t)*s)}function Jl(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function s1(t){return t[Ns(0,t.length-1)]}function o1(t,e){return e[i1(t,0,e.length-1)]}function ji(...t){return s1(t.flat())}function Fp(t,...e){return o1(t,e.flat())}function a1(t){return[...new Set(t)].filter(k)}function Ls(t){return k(t)&&k(t.x)&&k(t.y)}function At(t,e){switch(e){case ae.NORTH:--t.y;break;case ae.SOUTH:++t.y;break;case ae.WEST:--t.x;break;case ae.EAST:++t.x;break}return t}function zi(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return ae.WEST;if(n>0)return ae.EAST;if(r<0)return ae.NORTH;if(r>0)return ae.SOUTH}const $p={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function Hn(t){return ze(t)&&jp(t[0])}function jp(t){return k(ae[t])&&ke(t)}function c1(t){const e=ae[t];return k(e)?e:ae.IDLE}function zp(t){if(ke(t))return $p[Pe(t)]}function Wp(t){if(Hn(t))return t;if(jp(t))return[t];const e=zp(t);if(k(e))return[e]}function Gp(t){const e=O.words[t],n=Wp(e);if(Hn(n))return[n,t+1];const[r,i]=Mt(t),s=Wp(r);return Hn(s)?[s,i]:[void 0,t]}function Yl(t){const e=[];let[n,r]=Gp(t);for(;Hn(n);){if(e.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=Y(O.words,r,[V.NUMBER,V.NUMBER]);e.push(o,a),r=c}const[i,s]=Gp(r);n=i,r=s}return e.length?[e,r]:[void 0,t]}function Wi(t){return ze(t)&&typeof t[0]=="string"}function Hp(t){const e=O.words[t];if(Wi(e))return[e,t+1];const[n,r]=mc(t),[i,s]=Mt(r,!1);return ke(i)?[[i,n],s]:[void 0,t]}function la(t){if(!Wi(t))return;const[e]=t;return e}function Vp(t){if(!Wi(t))return;const[,e]=t,n=k(e)?TN(e):void 0;return k(n)?n:void 0}function Kp(t){if(!Wi(t))return;const[,e]=t,n=k(e)?RN(e):void 0;return k(n)?n:void 0}const et=60,un=25;var Re=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Re||{});function Ql(t,e){const n=t??He.ISWALK,r=e??He.ISWALK;switch(n){case He.ISWALK:return r!==He.ISWALK;case He.ISSWIM:return r!==He.ISSWIM;case He.ISSOLID:return!0;case He.ISBULLET:return r!==He.ISWALK&&r!==He.ISSWIM}}function qp(t,e,n){const r=t==null?void 0:t.objects[n];if(k(r))return r;if(k(e)){const i=Ms(t,"player"),s={x:e.x??0,y:e.y??0};Zp(s,i)}}function Ms(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(k)}function Xp(t,e){const n=la(e),r=Vp(e),i=Kp(e);return t.filter(s=>!(k(n)&&Ah(s)!==n||k(r)&&MN(s)!==r||k(i)&&UN(s)!==i)).filter(k)}function eu(t,e){return k(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(k(i))return i;const s=Ms(t,Pe(n));if(s.length)return s}else if(Ls(n)&&n.x>=0&&n.x<et&&n.y>=0&&n.y<un){const i=n.x+n.y*et,s=(r=t.lookup)==null?void 0:r[i];return k(s)?t.objects[s]:t.terrain[i]}}).flat().filter(k):[]}function Zp(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var Jp=typeof global=="object"&&global&&global.Object===Object&&global,l1=typeof self=="object"&&self&&self.Object===Object&&self,Vn=Jp||l1||Function("return this")(),hn=Vn.Symbol,Yp=Object.prototype,u1=Yp.hasOwnProperty,h1=Yp.toString,Us=hn?hn.toStringTag:void 0;function f1(t){var e=u1.call(t,Us),n=t[Us];try{t[Us]=void 0;var r=!0}catch{}var i=h1.call(t);return r&&(e?t[Us]=n:delete t[Us]),i}var d1=Object.prototype,p1=d1.toString;function m1(t){return p1.call(t)}var g1="[object Null]",y1="[object Undefined]",Qp=hn?hn.toStringTag:void 0;function zr(t){return t==null?t===void 0?y1:g1:Qp&&Qp in Object(t)?f1(t):m1(t)}function xn(t){return t!=null&&typeof t=="object"}var _1="[object Symbol]";function ua(t){return typeof t=="symbol"||xn(t)&&zr(t)==_1}function ha(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Me=Array.isArray,b1=1/0,em=hn?hn.prototype:void 0,tm=em?em.toString:void 0;function nm(t){if(typeof t=="string")return t;if(Me(t))return ha(t,nm)+"";if(ua(t))return tm?tm.call(t):"";var e=t+"";return e=="0"&&1/t==-b1?"-0":e}var w1=/\s/;function v1(t){for(var e=t.length;e--&&w1.test(t.charAt(e)););return e}var E1=/^\s+/;function k1(t){return t&&t.slice(0,v1(t)+1).replace(E1,"")}function fn(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var rm=NaN,S1=/^[-+]0x[0-9a-f]+$/i,A1=/^0b[01]+$/i,T1=/^0o[0-7]+$/i,R1=parseInt;function I1(t){if(typeof t=="number")return t;if(ua(t))return rm;if(fn(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=fn(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=k1(t);var n=A1.test(t);return n||T1.test(t)?R1(t.slice(2),n?2:8):S1.test(t)?rm:+t}var im=1/0,x1=17976931348623157e292;function O1(t){if(!t)return t===0?t:0;if(t=I1(t),t===im||t===-im){var e=t<0?-1:1;return e*x1}return t===t?t:0}function fa(t){var e=O1(t),n=e%1;return e===e?n?e-n:e:0}function Gi(t){return t}var C1="[object AsyncFunction]",N1="[object Function]",L1="[object GeneratorFunction]",M1="[object Proxy]";function yr(t){if(!fn(t))return!1;var e=zr(t);return e==N1||e==L1||e==C1||e==M1}var tu=Vn["__core-js_shared__"],sm=function(){var t=/[^.]+$/.exec(tu&&tu.keys&&tu.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function U1(t){return!!sm&&sm in t}var P1=Function.prototype,D1=P1.toString;function hi(t){if(t!=null){try{return D1.call(t)}catch{}try{return t+""}catch{}}return""}var B1=/[\\^$.*+?()[\]{}|]/g,F1=/^\[object .+?Constructor\]$/,$1=Function.prototype,j1=Object.prototype,z1=$1.toString,W1=j1.hasOwnProperty,G1=RegExp("^"+z1.call(W1).replace(B1,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function H1(t){if(!fn(t)||U1(t))return!1;var e=yr(t)?G1:F1;return e.test(hi(t))}function V1(t,e){return t==null?void 0:t[e]}function fi(t,e){var n=V1(t,e);return H1(n)?n:void 0}var nu=fi(Vn,"WeakMap"),om=Object.create,K1=function(){function t(){}return function(e){if(!fn(e))return{};if(om)return om(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function q1(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function bt(){}function X1(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Z1=800,J1=16,Y1=Date.now;function Q1(t){var e=0,n=0;return function(){var r=Y1(),i=J1-(r-n);if(n=r,i>0){if(++e>=Z1)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function eS(t){return function(){return t}}var da=function(){try{var t=fi(Object,"defineProperty");return t({},"",{}),t}catch{}}(),tS=da?function(t,e){return da(t,"toString",{configurable:!0,enumerable:!1,value:eS(e),writable:!0})}:Gi,nS=Q1(tS);function am(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function cm(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function rS(t){return t!==t}function iS(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function ru(t,e,n){return e===e?iS(t,e,n):cm(t,rS,n)}function lm(t,e){var n=t==null?0:t.length;return!!n&&ru(t,e,0)>-1}var sS=9007199254740991,oS=/^(?:0|[1-9]\d*)$/;function pa(t,e){var n=typeof t;return e=e??sS,!!e&&(n=="number"||n!="symbol"&&oS.test(t))&&t>-1&&t%1==0&&t<e}function iu(t,e,n){e=="__proto__"&&da?da(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Ps(t,e){return t===e||t!==t&&e!==e}var aS=Object.prototype,cS=aS.hasOwnProperty;function ma(t,e,n){var r=t[e];(!(cS.call(t,e)&&Ps(r,n))||n===void 0&&!(e in t))&&iu(t,e,n)}function su(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?iu(n,a,c):ma(n,a,c)}return n}var um=Math.max;function lS(t,e,n){return e=um(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=um(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),q1(t,this,a)}}function ou(t,e){return nS(lS(t,e,Gi),t+"")}var uS=9007199254740991;function au(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=uS}function Kn(t){return t!=null&&au(t.length)&&!yr(t)}function hm(t,e,n){if(!fn(n))return!1;var r=typeof e;return(r=="number"?Kn(n)&&pa(e,n.length):r=="string"&&e in n)?Ps(n[e],t):!1}function hS(t){return ou(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&hm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var fS=Object.prototype;function Ds(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||fS;return t===n}function dS(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var pS="[object Arguments]";function fm(t){return xn(t)&&zr(t)==pS}var dm=Object.prototype,mS=dm.hasOwnProperty,gS=dm.propertyIsEnumerable,ga=fm(function(){return arguments}())?fm:function(t){return xn(t)&&mS.call(t,"callee")&&!gS.call(t,"callee")};function yS(){return!1}var pm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,mm=pm&&typeof module=="object"&&module&&!module.nodeType&&module,_S=mm&&mm.exports===pm,gm=_S?Vn.Buffer:void 0,bS=gm?gm.isBuffer:void 0,Bs=bS||yS,wS="[object Arguments]",vS="[object Array]",ES="[object Boolean]",kS="[object Date]",SS="[object Error]",AS="[object Function]",TS="[object Map]",RS="[object Number]",IS="[object Object]",xS="[object RegExp]",OS="[object Set]",CS="[object String]",NS="[object WeakMap]",LS="[object ArrayBuffer]",MS="[object DataView]",US="[object Float32Array]",PS="[object Float64Array]",DS="[object Int8Array]",BS="[object Int16Array]",FS="[object Int32Array]",$S="[object Uint8Array]",jS="[object Uint8ClampedArray]",zS="[object Uint16Array]",WS="[object Uint32Array]",Ye={};Ye[US]=Ye[PS]=Ye[DS]=Ye[BS]=Ye[FS]=Ye[$S]=Ye[jS]=Ye[zS]=Ye[WS]=!0,Ye[wS]=Ye[vS]=Ye[LS]=Ye[ES]=Ye[MS]=Ye[kS]=Ye[SS]=Ye[AS]=Ye[TS]=Ye[RS]=Ye[IS]=Ye[xS]=Ye[OS]=Ye[CS]=Ye[NS]=!1;function GS(t){return xn(t)&&au(t.length)&&!!Ye[zr(t)]}function ya(t){return function(e){return t(e)}}var ym=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Fs=ym&&typeof module=="object"&&module&&!module.nodeType&&module,HS=Fs&&Fs.exports===ym,cu=HS&&Jp.process,Wr=function(){try{var t=Fs&&Fs.require&&Fs.require("util").types;return t||cu&&cu.binding&&cu.binding("util")}catch{}}(),_m=Wr&&Wr.isTypedArray,lu=_m?ya(_m):GS,VS=Object.prototype,KS=VS.hasOwnProperty;function bm(t,e){var n=Me(t),r=!n&&ga(t),i=!n&&!r&&Bs(t),s=!n&&!r&&!i&&lu(t),o=n||r||i||s,a=o?dS(t.length,String):[],c=a.length;for(var u in t)(e||KS.call(t,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||pa(u,c)))&&a.push(u);return a}function wm(t,e){return function(n){return t(e(n))}}var qS=wm(Object.keys,Object),XS=Object.prototype,ZS=XS.hasOwnProperty;function vm(t){if(!Ds(t))return qS(t);var e=[];for(var n in Object(t))ZS.call(t,n)&&n!="constructor"&&e.push(n);return e}function dn(t){return Kn(t)?bm(t):vm(t)}var JS=Object.prototype,YS=JS.hasOwnProperty,Vt=hS(function(t,e){if(Ds(e)||Kn(e)){su(e,dn(e),t);return}for(var n in e)YS.call(e,n)&&ma(t,n,e[n])});function QS(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var eA=Object.prototype,tA=eA.hasOwnProperty;function nA(t){if(!fn(t))return QS(t);var e=Ds(t),n=[];for(var r in t)r=="constructor"&&(e||!tA.call(t,r))||n.push(r);return n}function Em(t){return Kn(t)?bm(t,!0):nA(t)}var rA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,iA=/^\w*$/;function uu(t,e){if(Me(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ua(t)?!0:iA.test(t)||!rA.test(t)||e!=null&&t in Object(e)}var $s=fi(Object,"create");function sA(){this.__data__=$s?$s(null):{},this.size=0}function oA(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var aA="__lodash_hash_undefined__",cA=Object.prototype,lA=cA.hasOwnProperty;function uA(t){var e=this.__data__;if($s){var n=e[t];return n===aA?void 0:n}return lA.call(e,t)?e[t]:void 0}var hA=Object.prototype,fA=hA.hasOwnProperty;function dA(t){var e=this.__data__;return $s?e[t]!==void 0:fA.call(e,t)}var pA="__lodash_hash_undefined__";function mA(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=$s&&e===void 0?pA:e,this}function di(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}di.prototype.clear=sA,di.prototype.delete=oA,di.prototype.get=uA,di.prototype.has=dA,di.prototype.set=mA;function gA(){this.__data__=[],this.size=0}function _a(t,e){for(var n=t.length;n--;)if(Ps(t[n][0],e))return n;return-1}var yA=Array.prototype,_A=yA.splice;function bA(t){var e=this.__data__,n=_a(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():_A.call(e,n,1),--this.size,!0}function wA(t){var e=this.__data__,n=_a(e,t);return n<0?void 0:e[n][1]}function vA(t){return _a(this.__data__,t)>-1}function EA(t,e){var n=this.__data__,r=_a(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function _r(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}_r.prototype.clear=gA,_r.prototype.delete=bA,_r.prototype.get=wA,_r.prototype.has=vA,_r.prototype.set=EA;var js=fi(Vn,"Map");function kA(){this.size=0,this.__data__={hash:new di,map:new(js||_r),string:new di}}function SA(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function ba(t,e){var n=t.__data__;return SA(e)?n[typeof e=="string"?"string":"hash"]:n.map}function AA(t){var e=ba(this,t).delete(t);return this.size-=e?1:0,e}function TA(t){return ba(this,t).get(t)}function RA(t){return ba(this,t).has(t)}function IA(t,e){var n=ba(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function br(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}br.prototype.clear=kA,br.prototype.delete=AA,br.prototype.get=TA,br.prototype.has=RA,br.prototype.set=IA;var xA="Expected a function";function hu(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(xA);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(hu.Cache||br),n}hu.Cache=br;var OA=500;function CA(t){var e=hu(t,function(r){return n.size===OA&&n.clear(),r}),n=e.cache;return e}var NA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,LA=/\\(\\)?/g,MA=CA(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(NA,function(n,r,i,s){e.push(i?s.replace(LA,"$1"):r||n)}),e});function km(t){return t==null?"":nm(t)}function wa(t,e){return Me(t)?t:uu(t,e)?[t]:MA(km(t))}var UA=1/0;function zs(t){if(typeof t=="string"||ua(t))return t;var e=t+"";return e=="0"&&1/t==-UA?"-0":e}function fu(t,e){e=wa(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[zs(e[n++])];return n&&n==r?t:void 0}function PA(t,e,n){var r=t==null?void 0:fu(t,e);return r===void 0?n:r}function du(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Sm=hn?hn.isConcatSpreadable:void 0;function DA(t){return Me(t)||ga(t)||!!(Sm&&t&&t[Sm])}function pu(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=DA),i||(i=[]);++s<o;){var a=t[s];n(a)?du(i,a):r||(i[i.length]=a)}return i}function nn(t){var e=t==null?0:t.length;return e?pu(t):[]}var Am=wm(Object.getPrototypeOf,Object);function mu(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function BA(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:mu(t,e,n)}var FA="\\ud800-\\udfff",$A="\\u0300-\\u036f",jA="\\ufe20-\\ufe2f",zA="\\u20d0-\\u20ff",WA=$A+jA+zA,GA="\\ufe0e\\ufe0f",HA="\\u200d",VA=RegExp("["+HA+FA+WA+GA+"]");function Tm(t){return VA.test(t)}function KA(t){return t.split("")}var Rm="\\ud800-\\udfff",qA="\\u0300-\\u036f",XA="\\ufe20-\\ufe2f",ZA="\\u20d0-\\u20ff",JA=qA+XA+ZA,YA="\\ufe0e\\ufe0f",QA="["+Rm+"]",gu="["+JA+"]",yu="\\ud83c[\\udffb-\\udfff]",eT="(?:"+gu+"|"+yu+")",Im="[^"+Rm+"]",xm="(?:\\ud83c[\\udde6-\\uddff]){2}",Om="[\\ud800-\\udbff][\\udc00-\\udfff]",tT="\\u200d",Cm=eT+"?",Nm="["+YA+"]?",nT="(?:"+tT+"(?:"+[Im,xm,Om].join("|")+")"+Nm+Cm+")*",rT=Nm+Cm+nT,iT="(?:"+[Im+gu+"?",gu,xm,Om,QA].join("|")+")",sT=RegExp(yu+"(?="+yu+")|"+iT+rT,"g");function oT(t){return t.match(sT)||[]}function aT(t){return Tm(t)?oT(t):KA(t)}function cT(t){return function(e){e=km(e);var n=Tm(e)?aT(e):void 0,r=n?n[0]:e.charAt(0),i=n?BA(n,1).join(""):e.slice(1);return r[t]()+i}}var Lm=cT("toUpperCase");function lT(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function uT(){this.__data__=new _r,this.size=0}function hT(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function fT(t){return this.__data__.get(t)}function dT(t){return this.__data__.has(t)}var pT=200;function mT(t,e){var n=this.__data__;if(n instanceof _r){var r=n.__data__;if(!js||r.length<pT-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new br(r)}return n.set(t,e),this.size=n.size,this}function qn(t){var e=this.__data__=new _r(t);this.size=e.size}qn.prototype.clear=uT,qn.prototype.delete=hT,qn.prototype.get=fT,qn.prototype.has=dT,qn.prototype.set=mT;function gT(t,e){return t&&su(e,dn(e),t)}var Mm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Um=Mm&&typeof module=="object"&&module&&!module.nodeType&&module,yT=Um&&Um.exports===Mm,Pm=yT?Vn.Buffer:void 0,Dm=Pm?Pm.allocUnsafe:void 0;function _T(t,e){var n=t.length,r=Dm?Dm(n):new t.constructor(n);return t.copy(r),r}function _u(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Bm(){return[]}var bT=Object.prototype,wT=bT.propertyIsEnumerable,Fm=Object.getOwnPropertySymbols,bu=Fm?function(t){return t==null?[]:(t=Object(t),_u(Fm(t),function(e){return wT.call(t,e)}))}:Bm;function vT(t,e){return su(t,bu(t),e)}var ET=Object.getOwnPropertySymbols,kT=ET?function(t){for(var e=[];t;)du(e,bu(t)),t=Am(t);return e}:Bm;function $m(t,e,n){var r=e(t);return Me(t)?r:du(r,n(t))}function wu(t){return $m(t,dn,bu)}function ST(t){return $m(t,Em,kT)}var vu=fi(Vn,"DataView"),Eu=fi(Vn,"Promise"),Hi=fi(Vn,"Set"),jm="[object Map]",AT="[object Object]",zm="[object Promise]",Wm="[object Set]",Gm="[object WeakMap]",Hm="[object DataView]",TT=hi(vu),RT=hi(js),IT=hi(Eu),xT=hi(Hi),OT=hi(nu),pn=zr;(vu&&pn(new vu(new ArrayBuffer(1)))!=Hm||js&&pn(new js)!=jm||Eu&&pn(Eu.resolve())!=zm||Hi&&pn(new Hi)!=Wm||nu&&pn(new nu)!=Gm)&&(pn=function(t){var e=zr(t),n=e==AT?t.constructor:void 0,r=n?hi(n):"";if(r)switch(r){case TT:return Hm;case RT:return jm;case IT:return zm;case xT:return Wm;case OT:return Gm}return e});var CT=Object.prototype,NT=CT.hasOwnProperty;function LT(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&NT.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var va=Vn.Uint8Array;function MT(t){var e=new t.constructor(t.byteLength);return new va(e).set(new va(t)),e}function UT(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var PT=/\w*$/;function DT(t){var e=new t.constructor(t.source,PT.exec(t));return e.lastIndex=t.lastIndex,e}var Vm=hn?hn.prototype:void 0,Km=Vm?Vm.valueOf:void 0;function BT(t){return Km?Object(Km.call(t)):{}}function FT(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var $T="[object Boolean]",jT="[object Date]",zT="[object Map]",WT="[object Number]",GT="[object RegExp]",HT="[object Set]",VT="[object String]",KT="[object Symbol]",qT="[object ArrayBuffer]",XT="[object DataView]",ZT="[object Float32Array]",JT="[object Float64Array]",YT="[object Int8Array]",QT="[object Int16Array]",eR="[object Int32Array]",tR="[object Uint8Array]",nR="[object Uint8ClampedArray]",rR="[object Uint16Array]",iR="[object Uint32Array]";function sR(t,e,n){var r=t.constructor;switch(e){case qT:return MT(t);case $T:case jT:return new r(+t);case XT:return UT(t);case ZT:case JT:case YT:case QT:case eR:case tR:case nR:case rR:case iR:return FT(t);case zT:return new r;case WT:case VT:return new r(t);case GT:return DT(t);case HT:return new r;case KT:return BT(t)}}function oR(t){return typeof t.constructor=="function"&&!Ds(t)?K1(Am(t)):{}}var aR="[object Map]";function cR(t){return xn(t)&&pn(t)==aR}var qm=Wr&&Wr.isMap,lR=qm?ya(qm):cR,uR="[object Set]";function hR(t){return xn(t)&&pn(t)==uR}var Xm=Wr&&Wr.isSet,fR=Xm?ya(Xm):hR,Zm="[object Arguments]",dR="[object Array]",pR="[object Boolean]",mR="[object Date]",gR="[object Error]",Jm="[object Function]",yR="[object GeneratorFunction]",_R="[object Map]",bR="[object Number]",Ym="[object Object]",wR="[object RegExp]",vR="[object Set]",ER="[object String]",kR="[object Symbol]",SR="[object WeakMap]",AR="[object ArrayBuffer]",TR="[object DataView]",RR="[object Float32Array]",IR="[object Float64Array]",xR="[object Int8Array]",OR="[object Int16Array]",CR="[object Int32Array]",NR="[object Uint8Array]",LR="[object Uint8ClampedArray]",MR="[object Uint16Array]",UR="[object Uint32Array]",Ke={};Ke[Zm]=Ke[dR]=Ke[AR]=Ke[TR]=Ke[pR]=Ke[mR]=Ke[RR]=Ke[IR]=Ke[xR]=Ke[OR]=Ke[CR]=Ke[_R]=Ke[bR]=Ke[Ym]=Ke[wR]=Ke[vR]=Ke[ER]=Ke[kR]=Ke[NR]=Ke[LR]=Ke[MR]=Ke[UR]=!0,Ke[gR]=Ke[Jm]=Ke[SR]=!1;function Ea(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!fn(t))return t;var a=Me(t);if(a)return o=LT(t),X1(t,o);var c=pn(t),u=c==Jm||c==yR;if(Bs(t))return _T(t);if(c==Ym||c==Zm||u&&!i)return o=u?{}:oR(t),vT(t,gT(o,t));if(!Ke[c])return i?t:{};o=sR(t,c),s||(s=new qn);var l=s.get(t);if(l)return l;s.set(t,o),fR(t)?t.forEach(function(f){o.add(Ea(f,e,n,f,t,s))}):lR(t)&&t.forEach(function(f,p){o.set(p,Ea(f,e,n,p,t,s))});var h=wu,d=a?void 0:h(t);return am(d||t,function(f,p){d&&(p=f,f=t[p]),ma(o,p,Ea(f,e,n,p,t,s))}),o}var PR=4;function Ot(t){return Ea(t,PR)}function Ws(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var DR="__lodash_hash_undefined__";function BR(t){return this.__data__.set(t,DR),this}function FR(t){return this.__data__.has(t)}function Vi(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new br;++e<n;)this.add(t[e])}Vi.prototype.add=Vi.prototype.push=BR,Vi.prototype.has=FR;function Qm(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function ku(t,e){return t.has(e)}var $R=1,jR=2;function eg(t,e,n,r,i,s){var o=n&$R,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(t),l=s.get(e);if(u&&l)return u==e&&l==t;var h=-1,d=!0,f=n&jR?new Vi:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var p=t[h],m=e[h];if(r)var b=o?r(m,p,h,e,t,s):r(p,m,h,t,e,s);if(b!==void 0){if(b)continue;d=!1;break}if(f){if(!Qm(e,function(_,w){if(!ku(f,w)&&(p===_||i(p,_,n,r,s)))return f.push(w)})){d=!1;break}}else if(!(p===m||i(p,m,n,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}function zR(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Su(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var WR=1,GR=2,HR="[object Boolean]",VR="[object Date]",KR="[object Error]",qR="[object Map]",XR="[object Number]",ZR="[object RegExp]",JR="[object Set]",YR="[object String]",QR="[object Symbol]",eI="[object ArrayBuffer]",tI="[object DataView]",tg=hn?hn.prototype:void 0,Au=tg?tg.valueOf:void 0;function nI(t,e,n,r,i,s,o){switch(n){case tI:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case eI:return!(t.byteLength!=e.byteLength||!s(new va(t),new va(e)));case HR:case VR:case XR:return Ps(+t,+e);case KR:return t.name==e.name&&t.message==e.message;case ZR:case YR:return t==e+"";case qR:var a=zR;case JR:var c=r&WR;if(a||(a=Su),t.size!=e.size&&!c)return!1;var u=o.get(t);if(u)return u==e;r|=GR,o.set(t,e);var l=eg(a(t),a(e),r,i,s,o);return o.delete(t),l;case QR:if(Au)return Au.call(t)==Au.call(e)}return!1}var rI=1,iI=Object.prototype,sI=iI.hasOwnProperty;function oI(t,e,n,r,i,s){var o=n&rI,a=wu(t),c=a.length,u=wu(e),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in e:sI.call(e,d)))return!1}var f=s.get(t),p=s.get(e);if(f&&p)return f==e&&p==t;var m=!0;s.set(t,e),s.set(e,t);for(var b=o;++h<c;){d=a[h];var _=t[d],w=e[d];if(r)var E=o?r(w,_,d,e,t,s):r(_,w,d,t,e,s);if(!(E===void 0?_===w||i(_,w,n,r,s):E)){m=!1;break}b||(b=d=="constructor")}if(m&&!b){var S=t.constructor,C=e.constructor;S!=C&&"constructor"in t&&"constructor"in e&&!(typeof S=="function"&&S instanceof S&&typeof C=="function"&&C instanceof C)&&(m=!1)}return s.delete(t),s.delete(e),m}var aI=1,ng="[object Arguments]",rg="[object Array]",ka="[object Object]",cI=Object.prototype,ig=cI.hasOwnProperty;function lI(t,e,n,r,i,s){var o=Me(t),a=Me(e),c=o?rg:pn(t),u=a?rg:pn(e);c=c==ng?ka:c,u=u==ng?ka:u;var l=c==ka,h=u==ka,d=c==u;if(d&&Bs(t)){if(!Bs(e))return!1;o=!0,l=!1}if(d&&!l)return s||(s=new qn),o||lu(t)?eg(t,e,n,r,i,s):nI(t,e,c,n,r,i,s);if(!(n&aI)){var f=l&&ig.call(t,"__wrapped__"),p=h&&ig.call(e,"__wrapped__");if(f||p){var m=f?t.value():t,b=p?e.value():e;return s||(s=new qn),i(m,b,n,r,s)}}return d?(s||(s=new qn),oI(t,e,n,r,i,s)):!1}function Tu(t,e,n,r,i){return t===e?!0:t==null||e==null||!xn(t)&&!xn(e)?t!==t&&e!==e:lI(t,e,n,r,Tu,i)}var uI=1,hI=2;function fI(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],u=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var l=new qn,h;if(!(h===void 0?Tu(u,c,uI|hI,r,l):h))return!1}}return!0}function sg(t){return t===t&&!fn(t)}function dI(t){for(var e=dn(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,sg(i)]}return e}function og(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function pI(t){var e=dI(t);return e.length==1&&e[0][2]?og(e[0][0],e[0][1]):function(n){return n===t||fI(n,t,e)}}function mI(t,e){return t!=null&&e in Object(t)}function ag(t,e,n){e=wa(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=zs(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&au(i)&&pa(o,i)&&(Me(t)||ga(t)))}function gI(t,e){return t!=null&&ag(t,e,mI)}var yI=1,_I=2;function bI(t,e){return uu(t)&&sg(e)?og(zs(t),e):function(n){var r=PA(n,t);return r===void 0&&r===e?gI(n,t):Tu(e,r,yI|_I)}}function wI(t){return function(e){return e==null?void 0:e[t]}}function vI(t){return function(e){return fu(e,t)}}function EI(t){return uu(t)?wI(zs(t)):vI(t)}function Xn(t){return typeof t=="function"?t:t==null?Gi:typeof t=="object"?Me(t)?bI(t[0],t[1]):pI(t):EI(t)}function kI(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function SI(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var AI=SI();function TI(t,e){return t&&AI(t,e,dn)}function RI(t,e){return function(n,r){if(n==null)return n;if(!Kn(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var pi=RI(TI);function II(t,e,n,r){return pi(t,function(i,s,o){e(r,i,n(i),o)}),r}function xI(t,e){return function(n,r){var i=Me(n)?kI:II,s=e?e():{};return i(n,t,Xn(r),s)}}var cg=Object.prototype,OI=cg.hasOwnProperty,Ru=ou(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&hm(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Em(s),a=-1,c=o.length;++a<c;){var u=o[a],l=t[u];(l===void 0||Ps(l,cg[u])&&!OI.call(t,u))&&(t[u]=s[u])}return t});function lg(t){return xn(t)&&Kn(t)}var CI=200;function NI(t,e,n,r){var i=-1,s=lm,o=!0,a=t.length,c=[],u=e.length;if(!a)return c;e.length>=CI&&(s=ku,o=!1,e=new Vi(e));e:for(;++i<a;){var l=t[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var d=u;d--;)if(e[d]===h)continue e;c.push(l)}else s(e,h,r)||c.push(l)}return c}var Sa=ou(function(t,e){return lg(t)?NI(t,pu(e,1,lg,!0)):[]});function Ki(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ct(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:fa(e),mu(t,e<0?0:e,r)):[]}function Gs(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:fa(e),e=r-e,mu(t,0,e<0?0:e)):[]}function LI(t){return typeof t=="function"?t:Gi}function me(t,e){var n=Me(t)?am:pi;return n(t,LI(e))}function MI(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function UI(t,e){var n=!0;return pi(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function On(t,e,n){var r=Me(t)?MI:UI;return r(t,Xn(e))}function ug(t,e){var n=[];return pi(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function mn(t,e){var n=Me(t)?_u:ug;return n(t,Xn(e))}function PI(t){return function(e,n,r){var i=Object(e);if(!Kn(e)){var s=Xn(n);e=dn(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var DI=Math.max;function BI(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:fa(n);return i<0&&(i=DI(r+i,0)),cm(t,Xn(e),i)}var qi=PI(BI);function Cn(t){return t&&t.length?t[0]:void 0}function FI(t,e){var n=-1,r=Kn(t)?Array(t.length):[];return pi(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function le(t,e){var n=Me(t)?ha:FI;return n(t,Xn(e))}function gn(t,e){return pu(le(t,e))}var $I=Object.prototype,jI=$I.hasOwnProperty,hg=xI(function(t,e,n){jI.call(t,n)?t[n].push(e):iu(t,n,[e])}),zI=Object.prototype,WI=zI.hasOwnProperty;function GI(t,e){return t!=null&&WI.call(t,e)}function pe(t,e){return t!=null&&ag(t,e,GI)}var HI="[object String]";function Kt(t){return typeof t=="string"||!Me(t)&&xn(t)&&zr(t)==HI}function VI(t,e){return ha(e,function(n){return t[n]})}function ht(t){return t==null?[]:VI(t,dn(t))}var KI=Math.max;function $t(t,e,n,r){t=Kn(t)?t:ht(t),n=n&&!r?fa(n):0;var i=t.length;return n<0&&(n=KI(i+n,0)),Kt(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&ru(t,e,n)>-1}function fg(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return ru(t,e,i)}var qI="[object Map]",XI="[object Set]",ZI=Object.prototype,JI=ZI.hasOwnProperty;function qe(t){if(t==null)return!0;if(Kn(t)&&(Me(t)||typeof t=="string"||typeof t.splice=="function"||Bs(t)||lu(t)||ga(t)))return!t.length;var e=pn(t);if(e==qI||e==XI)return!t.size;if(Ds(t))return!vm(t).length;for(var n in t)if(JI.call(t,n))return!1;return!0}var YI="[object RegExp]";function QI(t){return xn(t)&&zr(t)==YI}var dg=Wr&&Wr.isRegExp,wr=dg?ya(dg):QI;function vr(t){return t===void 0}var ex="Expected a function";function tx(t){if(typeof t!="function")throw new TypeError(ex);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function nx(t,e,n,r){if(!fn(t))return t;e=wa(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=zs(e[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=fn(l)?l:pa(e[i+1])?[]:{})}ma(a,c,u),a=a[c]}return t}function rx(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=fu(t,o);n(a,o)&&nx(s,wa(o,t),a)}return s}function Nn(t,e){if(t==null)return{};var n=ha(ST(t),function(r){return[r]});return e=Xn(e),rx(t,n,function(r,i){return e(r,i[0])})}function ix(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function qt(t,e,n){var r=Me(t)?lT:ix,i=arguments.length<3;return r(t,Xn(e),n,i,pi)}function Aa(t,e){var n=Me(t)?_u:ug;return n(t,tx(Xn(e)))}function sx(t,e){var n;return pi(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function Iu(t,e,n){var r=Me(t)?Qm:sx;return r(t,Xn(e))}var ox=1/0,ax=Hi&&1/Su(new Hi([,-0]))[1]==ox?function(t){return new Hi(t)}:bt,cx=200;function lx(t,e,n){var r=-1,i=lm,s=t.length,o=!0,a=[],c=a;if(s>=cx){var u=ax(t);if(u)return Su(u);o=!1,i=ku,c=new Vi}else c=a;e:for(;++r<s;){var l=t[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue e;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Ta(t){return t&&t.length?lx(t):[]}function xu(t){console&&console.error&&console.error(`Error: ${t}`)}function pg(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function mg(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function gg(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function ux(t){return hx(t)?t.LABEL:t.name}function hx(t){return Kt(t.LABEL)&&t.LABEL!==""}class Zn{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),me(this.definition,n=>{n.accept(e)})}}class Xt extends Zn{constructor(e){super([]),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Xi extends Zn{constructor(e){super(e.definition),this.orgText="",Vt(this,Nn(e,n=>n!==void 0))}}class Zt extends Zn{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Vt(this,Nn(e,n=>n!==void 0))}}class Jt extends Zn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class Jn extends Zn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class Yn extends Zn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class wt extends Zn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class Ln extends Zn{constructor(e){super(e.definition),this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}}class Mn extends Zn{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Vt(this,Nn(e,n=>n!==void 0))}}class tt{constructor(e){this.idx=1,Vt(this,Nn(e,n=>n!==void 0))}accept(e){e.visit(this)}}function fx(t){return le(t,Ra)}function Ra(t){function e(n){return le(n,Ra)}if(t instanceof Xt){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Kt(t.label)&&(n.label=t.label),n}else{if(t instanceof Zt)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Jt)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Jn)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Yn)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Ra(new tt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Ln)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Ra(new tt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof wt)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Mn)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof tt){const n={type:"Terminal",name:t.terminalType.name,label:ux(t.terminalType),idx:t.idx};Kt(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=wr(r)?r.source:r),n}else{if(t instanceof Xi)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class mi{visit(e){const n=e;switch(n.constructor){case Xt:return this.visitNonTerminal(n);case Zt:return this.visitAlternative(n);case Jt:return this.visitOption(n);case Jn:return this.visitRepetitionMandatory(n);case Yn:return this.visitRepetitionMandatoryWithSeparator(n);case Ln:return this.visitRepetitionWithSeparator(n);case wt:return this.visitRepetition(n);case Mn:return this.visitAlternation(n);case tt:return this.visitTerminal(n);case Xi:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function dx(t){return t instanceof Zt||t instanceof Jt||t instanceof wt||t instanceof Jn||t instanceof Yn||t instanceof Ln||t instanceof tt||t instanceof Xi}function Ia(t,e=[]){return t instanceof Jt||t instanceof wt||t instanceof Ln?!0:t instanceof Mn?Iu(t.definition,r=>Ia(r,e)):t instanceof Xt&&$t(e,t)?!1:t instanceof Zn?(t instanceof Xt&&e.push(t),On(t.definition,r=>Ia(r,e))):!1}function px(t){return t instanceof Mn}function Qn(t){if(t instanceof Xt)return"SUBRULE";if(t instanceof Jt)return"OPTION";if(t instanceof Mn)return"OR";if(t instanceof Jn)return"AT_LEAST_ONE";if(t instanceof Yn)return"AT_LEAST_ONE_SEP";if(t instanceof Ln)return"MANY_SEP";if(t instanceof wt)return"MANY";if(t instanceof tt)return"CONSUME";throw Error("non exhaustive match")}class xa{walk(e,n=[]){me(e.definition,(r,i)=>{const s=Ct(e.definition,i+1);if(r instanceof Xt)this.walkProdRef(r,s,n);else if(r instanceof tt)this.walkTerminal(r,s,n);else if(r instanceof Zt)this.walkFlat(r,s,n);else if(r instanceof Jt)this.walkOption(r,s,n);else if(r instanceof Jn)this.walkAtLeastOne(r,s,n);else if(r instanceof Yn)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Ln)this.walkManySep(r,s,n);else if(r instanceof wt)this.walkMany(r,s,n);else if(r instanceof Mn)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Jt({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=yg(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Jt({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=yg(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);me(e.definition,s=>{const o=new Zt({definition:[s]});this.walk(o,i)})}}function yg(t,e,n){return[new Jt({definition:[new tt({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function Hs(t){if(t instanceof Xt)return Hs(t.referencedRule);if(t instanceof tt)return yx(t);if(dx(t))return mx(t);if(px(t))return gx(t);throw Error("non exhaustive match")}function mx(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=Ia(s),e=e.concat(Hs(s)),r=r+1,i=n.length>r;return Ta(e)}function gx(t){const e=le(t.definition,n=>Hs(n));return Ta(nn(e))}function yx(t){return[t.terminalType]}const _g="_~IN~_";class _x extends xa{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=wx(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new Zt({definition:s}),a=Hs(o);this.follows[i]=a}}function bx(t){const e={};return me(t,n=>{const r=new _x(n).startWalking();Vt(e,r)}),e}function wx(t,e){return t.name+e+_g}function ge(t){return t.charCodeAt(0)}function Ou(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function Vs(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function Zi(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function vx(){throw Error("Internal Error - Should never get here!")}function bg(t){return t.type==="Character"}const Oa=[];for(let t=ge("0");t<=ge("9");t++)Oa.push(t);const Ca=[ge("_")].concat(Oa);for(let t=ge("a");t<=ge("z");t++)Ca.push(t);for(let t=ge("A");t<=ge("Z");t++)Ca.push(t);const wg=[ge(" "),ge("\f"),ge(`
`),ge("\r"),ge("	"),ge("\v"),ge("	"),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge(" "),ge("\u2028"),ge("\u2029"),ge(" "),ge(" "),ge("　"),ge("\uFEFF")],Ex=/[0-9a-fA-F]/,Na=/[0-9]/,kx=/[1-9]/;class Sx{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Vs(r,"global");break;case"i":Vs(r,"ignoreCase");break;case"m":Vs(r,"multiLine");break;case"u":Vs(r,"unicode");break;case"y":Vs(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Zi(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return vx()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;Zi(n);break}if(!(e===!0&&n===void 0)&&Zi(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),Zi(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[ge(`
`),ge("\r"),ge("\u2028"),ge("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Oa;break;case"D":e=Oa,n=!0;break;case"s":e=wg;break;case"S":e=wg,n=!0;break;case"w":e=Ca;break;case"W":e=Ca,n=!0;break}if(Zi(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=ge("\f");break;case"n":e=ge(`
`);break;case"r":e=ge("\r");break;case"t":e=ge("	");break;case"v":e=ge("\v");break}if(Zi(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:ge("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:ge(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:ge(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,bg(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,bg(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else Ou(r.value,e),e.push(ge("-")),Ou(i.value,e)}else Ou(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:ge("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(kx.test(e)===!1)throw Error("Expecting a positive integer");for(;Na.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Na.test(e)===!1)throw Error("Expecting an integer");for(;Na.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:ge(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Na.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(Ex.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class Cu{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let La={};const Ax=new Sx;function Ma(t){const e=t.toString();if(La.hasOwnProperty(e))return La[e];{const n=Ax.pattern(e);return La[e]=n,n}}function Tx(){La={}}const vg="Complement Sets are not supported for first char optimization",Ua=`Unable to use "first char" lexer optimizations:
`;function Rx(t,e=!1){try{const n=Ma(t);return Nu(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===vg)e&&pg(`${Ua}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),xu(`${Ua}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Nu(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)Nu(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Pa(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(vg);me(o.value,c=>{if(typeof c=="number")Pa(c,e,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Pa(l,e,n);else{for(let l=u.from;l<=u.to&&l<qs;l++)Pa(l,e,n);if(u.to>=qs){const l=u.from>=qs?u.from:qs,h=u.to,d=Gr(l),f=Gr(h);for(let p=d;p<=f;p++)e[p]=p}}}});break;case"Group":Nu(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Lu(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return ht(e)}function Pa(t,e,n){const r=Gr(t);e[r]=r,n===!0&&Ix(t,e)}function Ix(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=Gr(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Gr(i.charCodeAt(0));e[s]=s}}}function Eg(t,e){return qi(t.value,n=>{if(typeof n=="number")return $t(e,n);{const r=n;return qi(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function Lu(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Me(t.value)?On(t.value,Lu):Lu(t.value):!1}class xx extends Cu{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){$t(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Eg(e,this.targetCharCodes)===void 0&&(this.found=!0):Eg(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Mu(t,e){if(e instanceof RegExp){const n=Ma(e),r=new xx(t);return r.visit(n),r.found}else return qi(e,n=>$t(t,n.charCodeAt(0)))!==void 0}const gi="PATTERN",Ks="defaultMode",Da="modes";let kg=typeof new RegExp("(?:)").sticky=="boolean";function Ox(t,e){e=Ru(e,{useSticky:kg,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(w,E)=>E()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{Qx()});let r;n("Reject Lexer.NA",()=>{r=Aa(t,w=>w[gi]===vt.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=le(r,w=>{const E=w[gi];if(wr(E)){const S=E.source;return S.length===1&&S!=="^"&&S!=="$"&&S!=="."&&!E.ignoreCase?S:S.length===2&&S[0]==="\\"&&!$t(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],S[1])?S[1]:e.useSticky?Ag(E):Sg(E)}else{if(yr(E))return i=!0,{exec:E};if(typeof E=="object")return i=!0,E;if(typeof E=="string"){if(E.length===1)return E;{const S=E.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),C=new RegExp(S);return e.useSticky?Ag(C):Sg(C)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=le(r,w=>w.tokenTypeIdx),a=le(r,w=>{const E=w.GROUP;if(E!==vt.SKIPPED){if(Kt(E))return E;if(vr(E))return!1;throw Error("non exhaustive match")}}),c=le(r,w=>{const E=w.LONGER_ALT;if(E)return Me(E)?le(E,C=>fg(r,C)):[fg(r,E)]}),u=le(r,w=>w.PUSH_MODE),l=le(r,w=>pe(w,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const w=Ig(e.lineTerminatorCharacters);h=le(r,E=>!1),e.positionTracking!=="onlyOffset"&&(h=le(r,E=>pe(E,"LINE_BREAKS")?!!E.LINE_BREAKS:Rg(E,w)===!1&&Mu(w,E.PATTERN)))});let d,f,p,m;n("Misc Mapping #2",()=>{d=le(r,Tg),f=le(s,Zx),p=qt(r,(w,E)=>{const S=E.GROUP;return Kt(S)&&S!==vt.SKIPPED&&(w[S]=[]),w},{}),m=le(s,(w,E)=>({pattern:s[E],longerAlt:c[E],canLineTerminator:h[E],isCustom:d[E],short:f[E],group:a[E],push:u[E],pop:l[E],tokenTypeIdx:o[E],tokenType:r[E]}))});let b=!0,_=[];return e.safeMode||n("First Char Optimization",()=>{_=qt(r,(w,E,S)=>{if(typeof E.PATTERN=="string"){const C=E.PATTERN.charCodeAt(0),I=Gr(C);Uu(w,I,m[S])}else if(Me(E.START_CHARS_HINT)){let C;me(E.START_CHARS_HINT,I=>{const R=typeof I=="string"?I.charCodeAt(0):I,B=Gr(R);C!==B&&(C=B,Uu(w,B,m[S]))})}else if(wr(E.PATTERN))if(E.PATTERN.unicode)b=!1,e.ensureOptimizations&&xu(`${Ua}	Unable to analyze < ${E.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const C=Rx(E.PATTERN,e.ensureOptimizations);qe(C)&&(b=!1),me(C,I=>{Uu(w,I,m[S])})}else e.ensureOptimizations&&xu(`${Ua}	TokenType: <${E.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return w},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:_,hasCustom:i,canBeOptimized:b}}function Cx(t,e){let n=[];const r=Lx(t);n=n.concat(r.errors);const i=Mx(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(Nx(s)),n=n.concat(zx(s)),n=n.concat(Wx(s,e)),n=n.concat(Gx(s)),n}function Nx(t){let e=[];const n=mn(t,r=>wr(r[gi]));return e=e.concat(Px(n)),e=e.concat(Fx(n)),e=e.concat($x(n)),e=e.concat(jx(n)),e=e.concat(Dx(n)),e}function Lx(t){const e=mn(t,i=>!pe(i,gi)),n=le(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:st.MISSING_PATTERN,tokenTypes:[i]})),r=Sa(t,e);return{errors:n,valid:r}}function Mx(t){const e=mn(t,i=>{const s=i[gi];return!wr(s)&&!yr(s)&&!pe(s,"exec")&&!Kt(s)}),n=le(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:st.INVALID_PATTERN,tokenTypes:[i]})),r=Sa(t,e);return{errors:n,valid:r}}const Ux=/[^\\][$]/;function Px(t){class e extends Cu{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=mn(t,i=>{const s=i.PATTERN;try{const o=Ma(s),a=new e;return a.visit(o),a.found}catch{return Ux.test(s.source)}});return le(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:st.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Dx(t){const e=mn(t,r=>r.PATTERN.test(""));return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:st.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const Bx=/[^\\[][\^]|^\^/;function Fx(t){class e extends Cu{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=mn(t,i=>{const s=i.PATTERN;try{const o=Ma(s),a=new e;return a.visit(o),a.found}catch{return Bx.test(s.source)}});return le(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:st.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function $x(t){const e=mn(t,r=>{const i=r[gi];return i instanceof RegExp&&(i.multiline||i.global)});return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:st.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function jx(t){const e=[];let n=le(t,s=>qt(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!$t(e,a)&&a.PATTERN!==vt.NA&&(e.push(a),o.push(a)),o),[]));n=Ws(n);const r=mn(n,s=>s.length>1);return le(r,s=>{const o=le(s,c=>c.name);return{message:`The same RegExp pattern ->${Cn(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:st.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function zx(t){const e=mn(t,r=>{if(!pe(r,"GROUP"))return!1;const i=r.GROUP;return i!==vt.SKIPPED&&i!==vt.NA&&!Kt(i)});return le(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:st.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function Wx(t,e){const n=mn(t,i=>i.PUSH_MODE!==void 0&&!$t(e,i.PUSH_MODE));return le(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:st.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function Gx(t){const e=[],n=qt(t,(r,i,s)=>{const o=i.PATTERN;return o===vt.NA||(Kt(o)?r.push({str:o,idx:s,tokenType:i}):wr(o)&&Vx(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return me(t,(r,i)=>{me(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&Hx(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:st.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function Hx(t,e){if(wr(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(yr(e))return e(t,0,[],{});if(pe(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function Vx(t){return qi([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function Sg(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function Ag(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function Kx(t,e,n){const r=[];return pe(t,Ks)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Ks+`> property in its definition
`,type:st.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),pe(t,Da)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Da+`> property in its definition
`,type:st.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),pe(t,Da)&&pe(t,Ks)&&!pe(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Ks}: <${t.defaultMode}>which does not exist
`,type:st.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),pe(t,Da)&&me(t.modes,(i,s)=>{me(i,(o,a)=>{if(vr(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:st.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(pe(o,"LONGER_ALT")){const c=Me(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];me(c,u=>{!vr(u)&&!$t(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:st.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function qx(t,e,n){const r=[];let i=!1;const s=Ws(nn(ht(t.modes))),o=Aa(s,c=>c[gi]===vt.NA),a=Ig(n);return e&&me(o,c=>{const u=Rg(c,a);if(u!==!1){const h={message:Yx(c,u),type:u.issue,tokenType:c};r.push(h)}else pe(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Mu(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:st.NO_LINE_BREAKS_FLAGS}),r}function Xx(t){const e={},n=dn(t);return me(n,r=>{const i=t[r];if(Me(i))e[r]=[];else throw Error("non exhaustive match")}),e}function Tg(t){const e=t.PATTERN;if(wr(e))return!1;if(yr(e))return!0;if(pe(e,"exec"))return!0;if(Kt(e))return!1;throw Error("non exhaustive match")}function Zx(t){return Kt(t)&&t.length===1?t.charCodeAt(0):!1}const Jx={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Rg(t,e){if(pe(t,"LINE_BREAKS"))return!1;if(wr(t.PATTERN)){try{Mu(e,t.PATTERN)}catch(n){return{issue:st.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Kt(t.PATTERN))return!1;if(Tg(t))return{issue:st.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function Yx(t,e){if(e.issue===st.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===st.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Ig(t){return le(t,n=>Kt(n)?n.charCodeAt(0):n)}function Uu(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const qs=256;let Ba=[];function Gr(t){return t<qs?t:Ba[t]}function Qx(){if(qe(Ba)){Ba=new Array(65536);for(let t=0;t<65536;t++)Ba[t]=t>255?255+~~(t/255):t}}function Xs(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function Fa(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let xg=1;const Og={};function Zs(t){const e=eO(t);tO(e),rO(e),nO(e),me(e,n=>{n.isParent=n.categoryMatches.length>0})}function eO(t){let e=Ot(t),n=t,r=!0;for(;r;){n=Ws(nn(le(n,s=>s.CATEGORIES)));const i=Sa(n,e);e=e.concat(i),qe(i)?r=!1:n=i}return e}function tO(t){me(t,e=>{Ng(e)||(Og[xg]=e,e.tokenTypeIdx=xg++),Lg(e)&&!Me(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Lg(e)||(e.CATEGORIES=[]),iO(e)||(e.categoryMatches=[]),sO(e)||(e.categoryMatchesMap={})})}function nO(t){me(t,e=>{e.categoryMatches=[],me(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(Og[r].tokenTypeIdx)})})}function rO(t){me(t,e=>{Cg([],e)})}function Cg(t,e){me(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),me(e.CATEGORIES,n=>{const r=t.concat(e);$t(r,n)||Cg(r,n)})}function Ng(t){return pe(t,"tokenTypeIdx")}function Lg(t){return pe(t,"CATEGORIES")}function iO(t){return pe(t,"categoryMatches")}function sO(t){return pe(t,"categoryMatchesMap")}function oO(t){return pe(t,"tokenTypeIdx")}const aO={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var st;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(st||(st={}));const Js={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:aO,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Js);class vt{constructor(e,n=Js){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=mg(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Vt({},Js,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Js.lineTerminatorsPattern)this.config.lineTerminatorsPattern=Jx;else if(this.config.lineTerminatorCharacters===Js.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Me(e)?i={modes:{defaultMode:Ot(e)},defaultMode:Ks}:(s=!1,i=Ot(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Kx(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(qx(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},me(i.modes,(a,c)=>{i.modes[c]=Aa(a,u=>vr(u))});const o=dn(i.modes);if(me(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Cx(a,o))}),qe(this.lexerDefinitionErrors)){Zs(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=Ox(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=Vt({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!qe(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=le(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}me(this.lexerDefinitionWarning,a=>{pg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(kg?(this.chopInput=Gi,this.match=this.matchWithTest):(this.updateLastIndex=bt,this.match=this.matchWithExec),s&&(this.handleModes=bt),this.trackStartLines===!1&&(this.computeNewColumn=Gi),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=bt),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=qt(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!qe(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{Tx()}),this.TRACE_INIT("toFastProperties",()=>{gg(this)})})}tokenize(e,n=this.defaultMode){if(!qe(this.lexerDefinitionErrors)){const i=le(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,u,l,h,d,f,p,m,b,_;const w=e,E=w.length;let S=0,C=0;const I=this.hasCustom?0:Math.floor(e.length/10),R=new Array(I),B=[];let L=this.trackStartLines?1:void 0,q=this.trackStartLines?1:void 0;const ie=Xx(this.emptyGroups),x=this.trackStartLines,v=this.config.lineTerminatorsPattern;let g=0,N=[],W=[];const M=[],J=[];Object.freeze(J);let H;function ee(){return N}function $(ve){const Fe=Gr(ve),we=W[Fe];return we===void 0?J:we}const D=ve=>{if(M.length===1&&ve.tokenType.PUSH_MODE===void 0){const Fe=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(ve);B.push({offset:ve.startOffset,line:ve.startLine,column:ve.startColumn,length:ve.image.length,message:Fe})}else{M.pop();const Fe=Ki(M);N=this.patternIdxToConfig[Fe],W=this.charCodeToPatternIdxToConfig[Fe],g=N.length;const we=this.canModeBeOptimized[Fe]&&this.config.safeMode===!1;W&&we?H=$:H=ee}};function ce(ve){M.push(ve),W=this.charCodeToPatternIdxToConfig[ve],N=this.patternIdxToConfig[ve],g=N.length,g=N.length;const Fe=this.canModeBeOptimized[ve]&&this.config.safeMode===!1;W&&Fe?H=$:H=ee}ce.call(this,n);let Q;const te=this.config.recoveryEnabled;for(;S<E;){c=null;const ve=w.charCodeAt(S),Fe=H(ve),we=Fe.length;for(r=0;r<we;r++){Q=Fe[r];const be=Q.pattern;u=null;const Ge=Q.short;if(Ge!==!1?ve===Ge&&(c=be):Q.isCustom===!0?(_=be.exec(w,S,R,ie),_!==null?(c=_[0],_.payload!==void 0&&(u=_.payload)):c=null):(this.updateLastIndex(be,S),c=this.match(be,e,S)),c!==null){if(a=Q.longerAlt,a!==void 0){const je=a.length;for(s=0;s<je;s++){const mt=N[a[s]],Et=mt.pattern;if(l=null,mt.isCustom===!0?(_=Et.exec(w,S,R,ie),_!==null?(o=_[0],_.payload!==void 0&&(l=_.payload)):o=null):(this.updateLastIndex(Et,S),o=this.match(Et,e,S)),o&&o.length>c.length){c=o,u=l,Q=mt;break}}}break}}if(c!==null){if(h=c.length,d=Q.group,d!==void 0&&(f=Q.tokenTypeIdx,p=this.createTokenInstance(c,S,f,Q.tokenType,L,q,h),this.handlePayload(p,u),d===!1?C=this.addToken(R,C,p):ie[d].push(p)),e=this.chopInput(e,h),S=S+h,q=this.computeNewColumn(q,h),x===!0&&Q.canLineTerminator===!0){let be=0,Ge,je;v.lastIndex=0;do Ge=v.test(c),Ge===!0&&(je=v.lastIndex-1,be++);while(Ge===!0);be!==0&&(L=L+be,q=h-je,this.updateTokenEndLineColumnLocation(p,d,je,be,L,q,h))}this.handleModes(Q,D,ce,p)}else{const be=S,Ge=L,je=q;let mt=te===!1;for(;mt===!1&&S<E;)for(e=this.chopInput(e,1),S++,i=0;i<g;i++){const Et=N[i],y=Et.pattern,K=Et.short;if(K!==!1?w.charCodeAt(S)===K&&(mt=!0):Et.isCustom===!0?mt=y.exec(w,S,R,ie)!==null:(this.updateLastIndex(y,S),mt=y.exec(e)!==null),mt===!0)break}if(m=S-be,q=this.computeNewColumn(q,m),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(w,be,m,Ge,je),B.push({offset:be,line:Ge,column:je,length:m,message:b}),te===!1)break}}return this.hasCustom||(R.length=C),{tokens:R,groups:ie,errors:B}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(e.endLine=s+u,e.endColumn=o-1+-u))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}vt.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",vt.NA=/NOT_APPLICABLE/;function Ys(t){return Mg(t)?t.LABEL:t.name}function Mg(t){return Kt(t.LABEL)&&t.LABEL!==""}const cO="parent",Ug="categories",Pg="label",Dg="group",Bg="push_mode",Fg="pop_mode",$g="longer_alt",jg="line_breaks",zg="start_chars_hint";function rn(t){return lO(t)}function lO(t){const e=t.pattern,n={};if(n.name=t.name,vr(e)||(n.PATTERN=e),pe(t,cO))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return pe(t,Ug)&&(n.CATEGORIES=t[Ug]),Zs([n]),pe(t,Pg)&&(n.LABEL=t[Pg]),pe(t,Dg)&&(n.GROUP=t[Dg]),pe(t,Fg)&&(n.POP_MODE=t[Fg]),pe(t,Bg)&&(n.PUSH_MODE=t[Bg]),pe(t,$g)&&(n.LONGER_ALT=t[$g]),pe(t,jg)&&(n.LINE_BREAKS=t[jg]),pe(t,zg)&&(n.START_CHARS_HINT=t[zg]),n}const yi=rn({name:"EOF",pattern:vt.NA});Zs([yi]);function $a(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function uO(t,e){return Xs(t,e)}const Wg={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Mg(t)?`--> ${Ys(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Cn(e).image+"'";if(r)return s+r+a;{const c=qt(t,(d,f)=>d.concat(f),[]),u=le(c,d=>`[${le(d,f=>Ys(f)).join(", ")}]`),h=`one of these possible Token sequences:
${le(u,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Cn(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${le(t,u=>`[${le(u,l=>Ys(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Wg);const hO={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},_i={buildDuplicateFoundError(t,e){function n(l){return l instanceof tt?l.terminalType.name:l instanceof Xt?l.nonTerminalName:""}const r=t.name,i=Cn(e),s=i.idx,o=Qn(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=le(t.prefixPath,i=>Ys(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=le(t.prefixPath,i=>Ys(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Qn(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=le(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Xi?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function fO(t,e){const n=new dO(t,e);return n.resolveRefs(),n.errors}class dO extends mi{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){me(ht(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:jt.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class pO extends xa{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Ot(this.path.ruleStack).reverse(),this.occurrenceStack=Ot(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){qe(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class mO extends pO{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Zt({definition:i});this.possibleTokTypes=Hs(s),this.found=!0}}}class ja extends xa{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class gO extends ja{walkMany(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof tt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class Gg extends ja{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof tt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class yO extends ja{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof tt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class Hg extends ja{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=Cn(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof tt&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function Pu(t,e,n=[]){n=Ot(n);let r=[],i=0;function s(a){return a.concat(Ct(t,i+1))}function o(a){const c=Pu(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof Zt)return o(a.definition);if(a instanceof Xt)return o(a.definition);if(a instanceof Jt)r=o(a.definition);else if(a instanceof Jn){const c=a.definition.concat([new wt({definition:a.definition})]);return o(c)}else if(a instanceof Yn){const c=[new Zt({definition:a.definition}),new wt({definition:[new tt({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Ln){const c=a.definition.concat([new wt({definition:[new tt({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof wt){const c=a.definition.concat([new wt({definition:a.definition})]);r=o(c)}else{if(a instanceof Mn)return me(a.definition,c=>{qe(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof tt)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Ct(t,i)}),r}function Vg(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!qe(h);){const d=h.pop();if(d===o){a&&Ki(h).idx<=u&&h.pop();continue}const f=d.def,p=d.idx,m=d.ruleStack,b=d.occurrenceStack;if(qe(f))continue;const _=f[0];if(_===i){const w={idx:p,def:Ct(f),ruleStack:Gs(m),occurrenceStack:Gs(b)};h.push(w)}else if(_ instanceof tt)if(p<c-1){const w=p+1,E=e[w];if(n(E,_.terminalType)){const S={idx:w,def:Ct(f),ruleStack:m,occurrenceStack:b};h.push(S)}}else if(p===c-1)l.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:m,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(_ instanceof Xt){const w=Ot(m);w.push(_.nonTerminalName);const E=Ot(b);E.push(_.idx);const S={idx:p,def:_.definition.concat(s,Ct(f)),ruleStack:w,occurrenceStack:E};h.push(S)}else if(_ instanceof Jt){const w={idx:p,def:Ct(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const E={idx:p,def:_.definition.concat(Ct(f)),ruleStack:m,occurrenceStack:b};h.push(E)}else if(_ instanceof Jn){const w=new wt({definition:_.definition,idx:_.idx}),E=_.definition.concat([w],Ct(f)),S={idx:p,def:E,ruleStack:m,occurrenceStack:b};h.push(S)}else if(_ instanceof Yn){const w=new tt({terminalType:_.separator}),E=new wt({definition:[w].concat(_.definition),idx:_.idx}),S=_.definition.concat([E],Ct(f)),C={idx:p,def:S,ruleStack:m,occurrenceStack:b};h.push(C)}else if(_ instanceof Ln){const w={idx:p,def:Ct(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const E=new tt({terminalType:_.separator}),S=new wt({definition:[E].concat(_.definition),idx:_.idx}),C=_.definition.concat([S],Ct(f)),I={idx:p,def:C,ruleStack:m,occurrenceStack:b};h.push(I)}else if(_ instanceof wt){const w={idx:p,def:Ct(f),ruleStack:m,occurrenceStack:b};h.push(w),h.push(o);const E=new wt({definition:_.definition,idx:_.idx}),S=_.definition.concat([E],Ct(f)),C={idx:p,def:S,ruleStack:m,occurrenceStack:b};h.push(C)}else if(_ instanceof Mn)for(let w=_.definition.length-1;w>=0;w--){const E=_.definition[w],S={idx:p,def:E.definition.concat(Ct(f)),ruleStack:m,occurrenceStack:b};h.push(S),h.push(o)}else if(_ instanceof Zt)h.push({idx:p,def:_.definition.concat(Ct(f)),ruleStack:m,occurrenceStack:b});else if(_ instanceof Xi)h.push(_O(_,p,m,b));else throw Error("non exhaustive match")}return l}function _O(t,e,n,r){const i=Ot(n);i.push(t.name);const s=Ot(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var ot;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(ot||(ot={}));function Kg(t){if(t instanceof Jt||t==="Option")return ot.OPTION;if(t instanceof wt||t==="Repetition")return ot.REPETITION;if(t instanceof Jn||t==="RepetitionMandatory")return ot.REPETITION_MANDATORY;if(t instanceof Yn||t==="RepetitionMandatoryWithSeparator")return ot.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Ln||t==="RepetitionWithSeparator")return ot.REPETITION_WITH_SEPARATOR;if(t instanceof Mn||t==="Alternation")return ot.ALTERNATION;throw Error("non exhaustive match")}function bO(t,e,n,r,i,s){const o=Bu(t,e,n),a=Jg(o)?Fa:Xs;return s(o,r,a,i)}function wO(t,e,n,r,i,s){const o=Fu(t,e,i,n),a=Jg(o)?Fa:Xs;return s(o[0],a,r)}function vO(t,e,n,r){const i=t.length,s=On(t,o=>On(o,a=>a.length===1));if(e)return function(o){const a=le(o,c=>c.GATE);for(let c=0;c<i;c++){const u=t[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let d=0;d<l;d++){const f=u[d],p=f.length;for(let m=0;m<p;m++){const b=this.LA(m+1);if(n(b,f[m])===!1)continue e}return c}}};if(s&&!r){const o=le(t,c=>nn(c)),a=qt(o,(c,u,l)=>(me(u,h=>{pe(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),me(h.categoryMatches,d=>{pe(c,d)||(c[d]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,l[d])===!1)continue e}return o}}}}function EO(t,e,n){const r=On(t,s=>s.length===1),i=t.length;if(r&&!n){const s=nn(t);if(s.length===1&&qe(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=qt(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,me(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(e(u,o[c])===!1)continue e}return!0}return!1}}class kO extends xa{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,ot.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,ot.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,ot.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,ot.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,ot.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class qg extends mi{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,ot.OPTION)}visitRepetition(e){this.checkIsTarget(e,ot.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,ot.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,ot.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,ot.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,ot.ALTERNATION)}}function Xg(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Du(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function SO(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function Zg(t,e){const n=le(t,o=>Pu([o],1)),r=Xg(n.length),i=le(n,o=>{const a={};return me(o,c=>{const u=Du(c.partialPath);me(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=Xg(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,d=u[l].suffixDef,f=Du(h);if(SO(i,f,c)||qe(d)||h.length===e){const m=r[c];if($u(m,h)===!1){m.push(h);for(let b=0;b<f.length;b++){const _=f[b];i[c][_]=!0}}}else{const m=Pu(d,o+1,h);s[c]=s[c].concat(m),me(m,b=>{const _=Du(b.partialPath);me(_,w=>{i[c][w]=!0})})}}}}return r}function Bu(t,e,n,r){const i=new qg(t,ot.ALTERNATION,r);return e.accept(i),Zg(i.result,n)}function Fu(t,e,n,r){const i=new qg(t,n);e.accept(i);const s=i.result,a=new kO(e,t,n).startWalking(),c=new Zt({definition:s}),u=new Zt({definition:a});return Zg([c,u],r)}function $u(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function AO(t,e){return t.length<e.length&&On(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Jg(t){return On(t,e=>On(e,n=>On(n,r=>qe(r.categoryMatches))))}function TO(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return le(e,n=>Object.assign({type:jt.CUSTOM_LOOKAHEAD_VALIDATION},n))}function RO(t,e,n,r){const i=gn(t,c=>IO(c,n)),s=$O(t,e,n),o=gn(t,c=>PO(c,n)),a=gn(t,c=>CO(c,t,r,n));return i.concat(s,o,a)}function IO(t,e){const n=new OO;t.accept(n);const r=n.allProductions,i=hg(r,xO),s=Nn(i,a=>a.length>1);return le(ht(s),a=>{const c=Cn(a),u=e.buildDuplicateFoundError(t,a),l=Qn(c),h={message:u,type:jt.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:l,occurrence:c.idx},d=Yg(c);return d&&(h.parameter=d),h})}function xO(t){return`${Qn(t)}_#_${t.idx}_#_${Yg(t)}`}function Yg(t){return t instanceof tt?t.terminalType.name:t instanceof Xt?t.nonTerminalName:""}class OO extends mi{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function CO(t,e,n,r){const i=[];if(qt(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:jt.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function NO(t,e,n){const r=[];let i;return $t(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:jt.INVALID_RULE_OVERRIDE,ruleName:t})),r}function Qg(t,e,n,r=[]){const i=[],s=za(e.definition);if(qe(s))return[];{const o=t.name;$t(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:jt.LEFT_RECURSION,ruleName:o});const c=Sa(s,r.concat([t])),u=gn(c,l=>{const h=Ot(r);return h.push(l),Qg(t,l,n,h)});return i.concat(u)}}function za(t){let e=[];if(qe(t))return e;const n=Cn(t);if(n instanceof Xt)e.push(n.referencedRule);else if(n instanceof Zt||n instanceof Jt||n instanceof Jn||n instanceof Yn||n instanceof Ln||n instanceof wt)e=e.concat(za(n.definition));else if(n instanceof Mn)e=nn(le(n.definition,s=>za(s.definition)));else if(!(n instanceof tt))throw Error("non exhaustive match");const r=Ia(n),i=t.length>1;if(r&&i){const s=Ct(t);return e.concat(za(s))}else return e}class ju extends mi{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function LO(t,e){const n=new ju;t.accept(n);const r=n.alternations;return gn(r,s=>{const o=Gs(s.definition);return gn(o,(a,c)=>{const u=Vg([a],[],Xs,1);return qe(u)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:jt.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function MO(t,e,n){const r=new ju;t.accept(r);let i=r.alternations;return i=Aa(i,o=>o.ignoreAmbiguities===!0),gn(i,o=>{const a=o.idx,c=o.maxLookahead||e,u=Bu(a,t,c,o),l=BO(u,o,t,n),h=FO(u,o,t,n);return l.concat(h)})}class UO extends mi{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function PO(t,e){const n=new ju;t.accept(n);const r=n.alternations;return gn(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:jt.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function DO(t,e,n){const r=[];return me(t,i=>{const s=new UO;i.accept(s);const o=s.allProductions;me(o,a=>{const c=Kg(a),u=a.maxLookahead||e,l=a.idx,d=Fu(l,i,c,u)[0];if(qe(nn(d))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:f,type:jt.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function BO(t,e,n,r){const i=[],s=qt(t,(a,c,u)=>(e.definition[u].ignoreAmbiguities===!0||me(c,l=>{const h=[u];me(t,(d,f)=>{u!==f&&$u(d,l)&&e.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!$u(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return le(s,a=>{const c=le(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:jt.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function FO(t,e,n,r){const i=qt(t,(o,a,c)=>{const u=le(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return Ws(gn(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=mn(i,d=>e.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&AO(d.path,u));return le(l,d=>{const f=[d.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:f,prefixPath:d.path}),type:jt.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function $O(t,e,n){const r=[],i=le(e,s=>s.name);return me(t,s=>{const o=s.name;if($t(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:jt.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function jO(t){const e=Ru(t,{errMsgProvider:hO}),n={};return me(t.rules,r=>{n[r.name]=r}),fO(n,e.errMsgProvider)}function zO(t){return t=Ru(t,{errMsgProvider:_i}),RO(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const e0="MismatchedTokenException",t0="NoViableAltException",n0="EarlyExitException",r0="NotAllInputParsedException",i0=[e0,t0,n0,r0];Object.freeze(i0);function Wa(t){return $t(i0,t.name)}class Ga extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class s0 extends Ga{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=e0}}class WO extends Ga{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=t0}}class GO extends Ga{constructor(e,n){super(e,n),this.name=r0}}class HO extends Ga{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=n0}}const zu={},o0="InRuleRecoveryException";class VO extends Error{constructor(e){super(e),this.name=o0}}class KO{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=pe(e,"recoveryEnabled")?e.recoveryEnabled:Er.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=qO)}getTokenToInsert(e){const n=$a(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:d,ruleName:this.getCurrRuleFullName()}),p=new s0(f,u,this.LA(0));p.resyncedTokens=Gs(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new VO("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||qe(n))return!1;const r=this.LA(1);return qi(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return $t(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=qi(e,s=>uO(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return zu;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return le(e,(r,i)=>i===0?zu:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=le(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return nn(e)}getFollowSetFromFollowKey(e){if(e===zu)return[yi];const n=e.ruleName+e.idxInCallingRule+_g+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,yi)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Gs(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Ot(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return le(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function qO(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=yi,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(t,e,n,u)}const XO=4,Hr=8,a0=1<<Hr,c0=2<<Hr,Wu=3<<Hr,Gu=4<<Hr,Hu=5<<Hr,Ha=6<<Hr;function Vu(t,e,n){return n|e|t}class ZO{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Er.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(qe(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return gn(e,n=>Qg(n,n,_i))}validateEmptyOrAlternatives(e){return gn(e,n=>LO(n,_i))}validateAmbiguousAlternationAlternatives(e,n){return gn(e,r=>MO(r,n,_i))}validateSomeNonEmptyLookaheadPath(e,n){return DO(e,n,_i)}buildLookaheadForAlternation(e){return bO(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,vO)}buildLookaheadForOptional(e){return wO(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Kg(e.prodType),EO)}}class JO{initLooksAhead(e){this.dynamicTokensEnabled=pe(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Er.dynamicTokensEnabled,this.maxLookahead=pe(e,"maxLookahead")?e.maxLookahead:Er.maxLookahead,this.lookaheadStrategy=pe(e,"lookaheadStrategy")?e.lookaheadStrategy:new ZO({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){me(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=QO(n);me(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Qn(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Vu(this.fullRuleNameToShort[n.name],a0,u.idx);this.setLaFuncCache(d,h)})}),me(i,u=>{this.computeLookaheadFunc(n,u.idx,Wu,"Repetition",u.maxLookahead,Qn(u))}),me(s,u=>{this.computeLookaheadFunc(n,u.idx,c0,"Option",u.maxLookahead,Qn(u))}),me(o,u=>{this.computeLookaheadFunc(n,u.idx,Gu,"RepetitionMandatory",u.maxLookahead,Qn(u))}),me(a,u=>{this.computeLookaheadFunc(n,u.idx,Ha,"RepetitionMandatoryWithSeparator",u.maxLookahead,Qn(u))}),me(c,u=>{this.computeLookaheadFunc(n,u.idx,Hu,"RepetitionWithSeparator",u.maxLookahead,Qn(u))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Vu(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return Vu(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class YO extends mi{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const Va=new YO;function QO(t){Va.reset(),t.accept(Va);const e=Va.dslMethods;return Va.reset(),e}function l0(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function u0(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function eC(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function tC(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const nC="name";function h0(t,e){Object.defineProperty(t,nC,{enumerable:!1,configurable:!0,writable:!1,value:e})}function rC(t,e){const n=dn(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,e)}}}function iC(t,e){const n=function(){};h0(n,t+"BaseSemantics");const r={visit:function(i,s){if(Me(i)&&(i=i[0]),!vr(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=oC(this,e);if(!qe(i)){const s=le(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function sC(t,e,n){const r=function(){};h0(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return me(e,s=>{i[s]=rC}),r.prototype=i,r.prototype.constructor=r,r}var Ku;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(Ku||(Ku={}));function oC(t,e){return aC(t,e)}function aC(t,e){const n=mn(e,i=>yr(t[i])===!1),r=le(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:Ku.MISSING_METHOD,methodName:i}));return Ws(r)}class cC{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=pe(e,"nodeLocationTracking")?e.nodeLocationTracking:Er.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=bt,this.cstFinallyStateUpdate=bt,this.cstPostTerminal=bt,this.cstPostNonTerminal=bt,this.cstPostRule=bt;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=u0,this.setNodeLocationFromNode=u0,this.cstPostRule=bt,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=bt,this.setNodeLocationFromNode=bt,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=l0,this.setNodeLocationFromNode=l0,this.cstPostRule=bt,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=bt,this.setNodeLocationFromNode=bt,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=bt,this.setNodeLocationFromNode=bt,this.cstPostRule=bt,this.setInitialNodeLocation=bt;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];eC(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];tC(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(vr(this.baseCstVisitorConstructor)){const e=iC(this.className,dn(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(vr(this.baseCstVisitorWithDefaultsConstructor)){const e=sC(this.className,dn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class lC{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Xa}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Xa:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class uC{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Za){if($t(this.definedRulesNames,e)){const o={message:_i.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:jt.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Za){const i=NO(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Wa(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return fx(ht(this.gastProductionsCache))}}class hC{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Fa,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},pe(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Me(e)){if(qe(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Me(e))this.tokensMap=qt(e,(s,o)=>(s[o.name]=o,s),{});else if(pe(e,"modes")&&On(nn(ht(e.modes)),oO)){const s=nn(ht(e.modes)),o=Ta(s);this.tokensMap=qt(o,(a,c)=>(a[c.name]=c,a),{})}else if(fn(e))this.tokensMap=Ot(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=yi;const r=pe(e,"modes")?nn(ht(e.modes)):ht(e),i=On(r,s=>qe(s.categoryMatches));this.tokenMatcher=i?Fa:Xs,Zs(ht(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=pe(r,"resyncEnabled")?r.resyncEnabled:Za.resyncEnabled,s=pe(r,"recoveryValueFunc")?r.recoveryValueFunc:Za.recoveryValueFunc,o=this.ruleShortNameIdx<<XO+Hr;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Wa(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(c0,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(Gu,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,ot.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,Gu,e,yO)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ha,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Hg],a,Ha,e,Hg)}else throw this.raiseEarlyExitException(e,ot.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(Wu,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,Wu,e,gO,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(Hu,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Gg],a,Hu,e,Gg)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,Ha,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(a0,n),i=Me(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new GO(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Wa(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new s0(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===o0?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Ot(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),yi)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class fC{initErrorHandler(e){this._errors=[],this.errorMessageProvider=pe(e,"errorMessageProvider")?e.errorMessageProvider:Er.errorMessageProvider}SAVE_ERROR(e){if(Wa(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Ot(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Ot(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Fu(e,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new HO(u,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Bu(e,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new WO(c,this.LA(1),a))}}class dC{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(vr(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Vg([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=Cn(e.ruleStack),i=this.getGAstProductions()[n];return new mO(i,e).startWalking()}}const Ka={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Ka);const f0=!0,d0=Math.pow(2,Hr)-1,p0=rn({name:"RECORDING_PHASE_TOKEN",pattern:vt.NA});Zs([p0]);const m0=$a(p0,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(m0);const pC={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class mC{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Xa}topLevelRuleRecord(e,n){try{const r=new Xi({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Qs.call(this,Jt,e,n)}atLeastOneInternalRecord(e,n){Qs.call(this,Jn,n,e)}atLeastOneSepFirstInternalRecord(e,n){Qs.call(this,Yn,n,e,f0)}manyInternalRecord(e,n){Qs.call(this,wt,n,e)}manySepFirstInternalRecord(e,n){Qs.call(this,Ln,n,e,f0)}orInternalRecord(e,n){return gC.call(this,e,n)}subruleInternalRecord(e,n,r){if(qa(n),!e||pe(e,"ruleName")===!1){const a=new Error(`<SUBRULE${g0(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Ki(this.recordingProdStack),s=e.ruleName,o=new Xt({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?pC:Ka}consumeInternalRecord(e,n,r){if(qa(n),!Ng(e)){const o=new Error(`<CONSUME${g0(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Ki(this.recordingProdStack),s=new tt({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),m0}}function Qs(t,e,n,r=!1){qa(n);const i=Ki(this.recordingProdStack),s=yr(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),pe(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Ka}function gC(t,e){qa(e);const n=Ki(this.recordingProdStack),r=Me(t)===!1,i=r===!1?t:t.DEF,s=new Mn({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});pe(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=Iu(i,a=>yr(a.GATE));return s.hasPredicates=o,n.definition.push(s),me(i,a=>{const c=new Zt({definition:[]});s.definition.push(c),pe(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:pe(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Ka}function g0(t){return t===0?"":`${t}`}function qa(t){if(t<0||t>d0){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${d0+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class yC{initPerformanceTracer(e){if(pe(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Er.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=mg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function _C(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Xa=$a(yi,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Xa);const Er=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Wg,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Za=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var jt;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(jt||(jt={}));class eo{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{gg(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),me(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=jO({rules:ht(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(qe(r)&&this.skipValidations===!1){const i=zO({rules:ht(this.gastProductionsCache),tokenTypes:ht(this.tokensMap),errMsgProvider:_i,grammarName:n}),s=TO({lookaheadStrategy:this.lookaheadStrategy,rules:ht(this.gastProductionsCache),tokenTypes:ht(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),qe(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=bx(ht(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:ht(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(ht(this.gastProductionsCache))})),!eo.DEFER_DEFINITION_ERRORS_HANDLING&&!qe(this.definitionErrors))throw e=le(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),pe(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=pe(n,"skipValidations")?n.skipValidations:Er.skipValidations}}eo.DEFER_DEFINITION_ERRORS_HANDLING=!1,_C(eo,[KO,JO,cC,lC,hC,uC,fC,dC,mC,yC]);class bC extends eo{constructor(e,n=Er){const r=Ot(n);r.outputCst=!0,super(e,r)}}function wC(t){const e=new vC,n=ht(t);return le(n,r=>e.visitRule(r))}class vC extends mi{visitRule(e){const n=this.visitEach(e.definition),r=hg(n,s=>s.propertyName),i=le(r,(s,o)=>{const a=!Iu(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=le(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:Ja(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:Ja(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:Ja(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:Ja(e)}]}visitEachAndOverrideWith(e,n){return le(this.visitEach(e),r=>Vt({},r,n))}visitEach(e){return nn(le(e,n=>this.visit(n)))}}function Ja(t){return t instanceof Xt?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function EC(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(nn(le(t,r=>kC(r)))),e.includeVisitorInterface&&(n=n.concat(RC(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function kC(t){const e=SC(t),n=AC(t);return[e,n]}function SC(t){const e=_0(t.name),n=qu(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function AC(t){return`export type ${qu(t.name)} = {
  ${le(t.properties,n=>TC(n)).join(`
  `)}
};`}function TC(t){const e=xC(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function RC(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${le(e,n=>IC(n)).join(`
  `)}
}`}function IC(t){const e=qu(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function xC(t){if(Me(t)){const e=Ta(le(t,r=>y0(r)));return"("+qt(e,(r,i)=>r+" | "+i)+")"}else return y0(t)}function y0(t){return t.kind==="token"?"IToken":_0(t.name)}function _0(t){return Lm(t)+"CstNode"}function qu(t){return Lm(t)+"CstChildren"}const OC={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function CC(t,e){const n=Object.assign(Object.assign({},OC),e),r=wC(t);return EC(r,n)}const Xu=Jl(32,126).map(t=>String.fromCharCode(t));function xe(t){return rn({...t,name:`token_${t.name}`})}function yn(t,e=!1){return xe(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt,group:vt.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:zt})}const to=xe({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),NC=xe({name:"whitespace",pattern:/ +/,group:vt.SKIPPED}),LC=xe({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:vt.SKIPPED}),Zu=xe({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Ji=xe({name:"command",pattern:/#/,start_chars_hint:["#"]});let b0=!1;function MC(t,e,n){if(!b0)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==to)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const w0=xe({name:"text",pattern:MC,line_breaks:!1,start_chars_hint:Xu.filter(t=>"@#/?':!".includes(t)===!1)}),v0=xe({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),E0=xe({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),k0=xe({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),S0=xe({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),zt=xe({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Xu}),A0=xe({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),T0=xe({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),R0=xe({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:zt}),I0=xe({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:zt}),x0=xe({name:"islessthan",pattern:/<|below/,longer_alt:zt}),O0=xe({name:"isgreaterthan",pattern:/>|above/,longer_alt:zt}),C0=xe({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:zt}),N0=xe({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:zt}),Ju=xe({name:"or",pattern:/or/i,longer_alt:zt}),Yu=xe({name:"not",pattern:/not/i,longer_alt:zt}),Qu=xe({name:"and",pattern:/and/i,longer_alt:zt}),eh=xe({name:"plus",pattern:/\+/}),th=xe({name:"minus",pattern:/-/}),L0=xe({name:"power",pattern:/\*\*/}),M0=xe({name:"multiply",pattern:/\*/}),nh=xe({name:"divide",pattern:/\//}),U0=xe({name:"moddivide",pattern:/%/}),P0=xe({name:"floordivide",pattern:/%%/}),D0=xe({name:"query",pattern:/\?/}),B0=xe({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),F0=xe({name:"rparen",pattern:/\)/,pop_mode:!0}),$0=xe({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:Xu,longer_alt:zt}),j0=yn("debugger"),rh=yn("if"),Ya=yn("do"),UC=yn("to",!0),ih=yn("done"),PC=yn("then",!0),sh=yn("else"),z0=yn("while"),W0=yn("repeat"),G0=yn("waitfor"),H0=xe({name:"foreach",pattern:/foreach|for/,longer_alt:zt}),V0=yn("break"),K0=yn("continue");function q0(t){return[...t,T0,R0,I0,C0,x0,N0,O0,Ju,Yu,Qu,eh,th,L0,M0,nh,P0,U0,D0,B0,F0,A0,zt]}const X0=q0([w0,Zu,$0,Ji,v0,E0,k0,S0,to,NC,V0,K0,j0,ih,Ya,sh,H0,rh,W0,PC,UC,G0,z0]),DC=new vt({defaultMode:"use_newlines",modes:{use_newlines:X0,ignore_newlines:q0([LC])}},{skipValidations:!Wn,ensureOptimizations:Wn});function Z0(t){b0=!0;const e=DC.tokenize(t||` 
`),[n]=(ze(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push($a(to,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function J0(t,e=!0){const[n,...r]=t;switch(Pe(n)){default:return e?{type:he.OBJECT,values:t}:{type:he.CONST,values:t};case"loader":return{type:he.LOADER,values:r};case"board":return{type:he.BOARD,values:r};case"object":return{type:he.OBJECT,values:r};case"terrain":return{type:he.TERRAIN,values:r};case"charset":return{type:he.CHARSET,values:r};case"palette":return{type:he.PALETTE,values:r};case"rn":case"range":return{type:he.RANGE,values:r};case"sl":case"select":return{type:he.SELECT,values:r};case"nm":case"number":return{type:he.NUMBER,values:r};case"tx":case"text":return{type:he.TEXT,values:r};case"ln":case"link":return{type:he.LINK,values:r};case"hk":case"hotkey":return{type:he.HOTKEY,values:r};case"scroll":return{type:he.SCROLL,values:r};case"copyit":return{type:he.COPYIT,values:r}}}function _n(t){switch(t){case he.LOADER:return"loader";case he.BOARD:return"board";case he.OBJECT:return"object";case he.TERRAIN:return"terrain";case he.CHARSET:return"charset";case he.PALETTE:return"palette";case he.CONST:return"const";case he.RANGE:return"range";case he.SELECT:return"select";case he.NUMBER:return"number";case he.TEXT:return"text";case he.LINK:return"link";case he.HOTKEY:return"hotkey";case he.SCROLL:return"scroll";case he.COPYIT:return"copyit"}}var oh;try{oh=new TextDecoder}catch{}var se,bn,U=0,Xe={},Ne,Vr,wn=0,er=0,Tt,kr,Yt=[],Oe,Y0={useRecords:!1,mapsAsObjects:!0};class Q0{}const ey=new Q0;ey.name="MessagePack 0xC1";var Kr=!1,ty=2,ny;try{new Function("")}catch{ty=1/0}class no{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(se)return my(()=>(hh(),this?this.unpack(e,n):no.prototype.unpack.call(Y0,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Buffer<"u"?Buffer.from(e):new Uint8Array(e)),typeof n=="object"?(bn=n.end||e.length,U=n.start||0):(U=0,bn=n>-1?n:e.length),er=0,Vr=null,Tt=null,se=e;try{Oe=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw se=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof no){if(Xe=this,this.structures)return Ne=this.structures,Qa(n);(!Ne||Ne.length>0)&&(Ne=[])}else Xe=Y0,(!Ne||Ne.length>0)&&(Ne=[]);return Qa(n)}unpackMultiple(e,n){let r,i=0;try{Kr=!0;let s=e.length,o=this?this.unpack(e,s):ec.unpack(e,s);if(n){if(n(o,i,U)===!1)return;for(;U<s;)if(i=U,n(Qa(),i,U)===!1)return}else{for(r=[o];U<s;)i=U,r.push(Qa());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Kr=!1,hh()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function Qa(t){try{if(!Xe.trusted&&!Kr){let n=Ne.sharedLength||0;n<Ne.length&&(Ne.length=n)}let e;if(Xe.randomAccessStructure&&se[U]<64&&se[U]>=32&&ny?(e=ny(se,U,bn,Xe),se=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),U=bn):e=ct(),Tt&&(U=Tt.postBundlePosition,Tt=null),Kr&&(Ne.restoreStructures=null),U==bn)Ne&&Ne.restoreStructures&&ry(),Ne=null,se=null,kr&&(kr=null);else{if(U>bn)throw new Error("Unexpected end of MessagePack data");if(!Kr){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw Ne&&Ne.restoreStructures&&ry(),hh(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||U>bn)&&(e.incomplete=!0),e}}function ry(){for(let t in Ne.restoreStructures)Ne[t]=Ne.restoreStructures[t];Ne.restoreStructures=null}function ct(){let t=se[U++];if(t<160)if(t<128){if(t<64)return t;{let e=Ne[t&63]||Xe.getStructures&&sy()[t&63];return e?(e.read||(e.read=ah(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Xe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=hy();r==="__proto__"&&(r="__proto_"),e[r]=ct()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(ct(),ct());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=ct();return Xe.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(er>=U)return Vr.slice(U-wn,(U+=e)-wn);if(er==0&&bn<140){let n=e<16?lh(e):cy(e);if(n!=null)return n}return ch(e)}else{let e;switch(t){case 192:return null;case 193:return Tt?(e=ct(),e>0?Tt[1].slice(Tt.position1,Tt.position1+=e):Tt[0].slice(Tt.position0,Tt.position0-=e)):ey;case 194:return!1;case 195:return!0;case 196:if(e=se[U++],e===void 0)throw new Error("Unexpected end of buffer");return uh(e);case 197:return e=Oe.getUint16(U),U+=2,uh(e);case 198:return e=Oe.getUint32(U),U+=4,uh(e);case 199:return bi(se[U++]);case 200:return e=Oe.getUint16(U),U+=2,bi(e);case 201:return e=Oe.getUint32(U),U+=4,bi(e);case 202:if(e=Oe.getFloat32(U),Xe.useFloat32>2){let n=fh[(se[U]&127)<<1|se[U+1]>>7];return U+=4,(n*e+(e>0?.5:-.5)>>0)/n}return U+=4,e;case 203:return e=Oe.getFloat64(U),U+=8,e;case 204:return se[U++];case 205:return e=Oe.getUint16(U),U+=2,e;case 206:return e=Oe.getUint32(U),U+=4,e;case 207:return Xe.int64AsType==="number"?(e=Oe.getUint32(U)*4294967296,e+=Oe.getUint32(U+4)):Xe.int64AsType==="string"?e=Oe.getBigUint64(U).toString():Xe.int64AsType==="auto"?(e=Oe.getBigUint64(U),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Oe.getBigUint64(U),U+=8,e;case 208:return Oe.getInt8(U++);case 209:return e=Oe.getInt16(U),U+=2,e;case 210:return e=Oe.getInt32(U),U+=4,e;case 211:return Xe.int64AsType==="number"?(e=Oe.getInt32(U)*4294967296,e+=Oe.getUint32(U+4)):Xe.int64AsType==="string"?e=Oe.getBigInt64(U).toString():Xe.int64AsType==="auto"?(e=Oe.getBigInt64(U),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Oe.getBigInt64(U),U+=8,e;case 212:if(e=se[U++],e==114)return dy(se[U++]&63);{let n=Yt[e];if(n)return n.read?(U++,n.read(ct())):n.noBuffer?(U++,n()):n(se.subarray(U,++U));throw new Error("Unknown extension "+e)}case 213:return e=se[U],e==114?(U++,dy(se[U++]&63,se[U++])):bi(2);case 214:return bi(4);case 215:return bi(8);case 216:return bi(16);case 217:return e=se[U++],er>=U?Vr.slice(U-wn,(U+=e)-wn):FC(e);case 218:return e=Oe.getUint16(U),U+=2,er>=U?Vr.slice(U-wn,(U+=e)-wn):$C(e);case 219:return e=Oe.getUint32(U),U+=4,er>=U?Vr.slice(U-wn,(U+=e)-wn):jC(e);case 220:return e=Oe.getUint16(U),U+=2,oy(e);case 221:return e=Oe.getUint32(U),U+=4,oy(e);case 222:return e=Oe.getUint16(U),U+=2,ay(e);case 223:return e=Oe.getUint32(U),U+=4,ay(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const BC=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function ah(t,e){function n(){if(n.count++>ty){let i=t.read=new Function("r","return function(){return "+(Xe.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":BC.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(ct);return t.highByte===0&&(t.read=iy(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=ct()}return Xe.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?iy(e,n):n}const iy=(t,e)=>function(){let n=se[U++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=Ne[r]||sy()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=ah(i,t)),i.read()};function sy(){let t=my(()=>(se=null,Xe.getStructures()));return Ne=Xe._mergeStructures(t,Ne)}var ch=ro,FC=ro,$C=ro,jC=ro;function ro(t){let e;if(t<16&&(e=lh(t)))return e;if(t>64&&oh)return oh.decode(se.subarray(U,U+=t));const n=U+t,r=[];for(e="";U<n;){const i=se[U++];if(!(i&128))r.push(i);else if((i&224)===192){const s=se[U++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=se[U++]&63,o=se[U++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=se[U++]&63,o=se[U++]&63,a=se[U++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Rt.apply(String,r),r.length=0)}return r.length>0&&(e+=Rt.apply(String,r)),e}function oy(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=ct();return Xe.freezeData?Object.freeze(e):e}function ay(t){if(Xe.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=hy();r==="__proto__"&&(r="__proto_"),e[r]=ct()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(ct(),ct());return e}}var Rt=String.fromCharCode;function cy(t){let e=U,n=new Array(t);for(let r=0;r<t;r++){const i=se[U++];if((i&128)>0){U=e;return}n[r]=i}return Rt.apply(String,n)}function lh(t){if(t<4)if(t<2){if(t===0)return"";{let e=se[U++];if((e&128)>1){U-=1;return}return Rt(e)}}else{let e=se[U++],n=se[U++];if((e&128)>0||(n&128)>0){U-=2;return}if(t<3)return Rt(e,n);let r=se[U++];if((r&128)>0){U-=3;return}return Rt(e,n,r)}else{let e=se[U++],n=se[U++],r=se[U++],i=se[U++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){U-=4;return}if(t<6){if(t===4)return Rt(e,n,r,i);{let s=se[U++];if((s&128)>0){U-=5;return}return Rt(e,n,r,i,s)}}else if(t<8){let s=se[U++],o=se[U++];if((s&128)>0||(o&128)>0){U-=6;return}if(t<7)return Rt(e,n,r,i,s,o);let a=se[U++];if((a&128)>0){U-=7;return}return Rt(e,n,r,i,s,o,a)}else{let s=se[U++],o=se[U++],a=se[U++],c=se[U++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){U-=8;return}if(t<10){if(t===8)return Rt(e,n,r,i,s,o,a,c);{let u=se[U++];if((u&128)>0){U-=9;return}return Rt(e,n,r,i,s,o,a,c,u)}}else if(t<12){let u=se[U++],l=se[U++];if((u&128)>0||(l&128)>0){U-=10;return}if(t<11)return Rt(e,n,r,i,s,o,a,c,u,l);let h=se[U++];if((h&128)>0){U-=11;return}return Rt(e,n,r,i,s,o,a,c,u,l,h)}else{let u=se[U++],l=se[U++],h=se[U++],d=se[U++];if((u&128)>0||(l&128)>0||(h&128)>0||(d&128)>0){U-=12;return}if(t<14){if(t===12)return Rt(e,n,r,i,s,o,a,c,u,l,h,d);{let f=se[U++];if((f&128)>0){U-=13;return}return Rt(e,n,r,i,s,o,a,c,u,l,h,d,f)}}else{let f=se[U++],p=se[U++];if((f&128)>0||(p&128)>0){U-=14;return}if(t<15)return Rt(e,n,r,i,s,o,a,c,u,l,h,d,f,p);let m=se[U++];if((m&128)>0){U-=15;return}return Rt(e,n,r,i,s,o,a,c,u,l,h,d,f,p,m)}}}}}function ly(){let t=se[U++],e;if(t<192)e=t-160;else switch(t){case 217:e=se[U++];break;case 218:e=Oe.getUint16(U),U+=2;break;case 219:e=Oe.getUint32(U),U+=4;break;default:throw new Error("Expected string")}return ro(e)}function uh(t){return Xe.copyBuffers?Uint8Array.prototype.slice.call(se,U,U+=t):se.subarray(U,U+=t)}function bi(t){let e=se[U++];if(Yt[e]){let n;return Yt[e](se.subarray(U,n=U+=t),r=>{U=r;try{return ct()}finally{U=n}})}else throw new Error("Unknown extension type "+e)}var uy=new Array(4096);function hy(){let t=se[U++];if(t>=160&&t<192){if(t=t-160,er>=U)return Vr.slice(U-wn,(U+=t)-wn);if(!(er==0&&bn<180))return ch(t)}else return U--,fy(ct());let e=(t<<5^(t>1?Oe.getUint16(U):t>0?se[U]:0))&4095,n=uy[e],r=U,i=U+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=Oe.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=se[r++],s!=n[o++]){r=1879048192;break}if(r===i)return U=r,n.string;i-=3,r=U}for(n=[],uy[e]=n,n.bytes=t;r<i;)s=Oe.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=se[r++],n.push(s);let a=t<16?lh(t):cy(t);return a!=null?n.string=a:n.string=ch(t)}function fy(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const dy=(t,e)=>{let n=ct().map(fy),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=Ne[t];return i&&(i.isShared||Kr)&&((Ne.restoreStructures||(Ne.restoreStructures=[]))[t]=i),Ne[t]=n,n.read=ah(n,r),n.read()};Yt[0]=()=>{},Yt[0].noBuffer=!0,Yt[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let zC={Error,TypeError,ReferenceError};Yt[101]=()=>{let t=ct();return(zC[t[0]]||Error)(t[1],{cause:t[2]})},Yt[105]=t=>{if(Xe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Oe.getUint32(U-4);kr||(kr=new Map);let n=se[U],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};kr.set(e,i);let s=ct();return i.used?Object.assign(r,s):(i.target=s,s)},Yt[112]=t=>{if(Xe.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Oe.getUint32(U-4),n=kr.get(e);return n.used=!0,n.target},Yt[115]=()=>new Set(ct());const py=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let WC=typeof globalThis=="object"?globalThis:window;Yt[116]=t=>{let e=t[0],n=py[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new WC[n](Uint8Array.prototype.slice.call(t,1).buffer)},Yt[120]=()=>{let t=ct();return new RegExp(t[0],t[1])};const GC=[];Yt[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=U;return U+=e-t.length,Tt=GC,Tt=[ly(),ly()],Tt.position0=0,Tt.position1=0,Tt.postBundlePosition=U,U=n,ct()},Yt[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function my(t){let e=bn,n=U,r=wn,i=er,s=Vr,o=kr,a=Tt,c=new Uint8Array(se.slice(0,bn)),u=Ne,l=Ne.slice(0,Ne.length),h=Xe,d=Kr,f=t();return bn=e,U=n,wn=r,er=i,Vr=s,kr=o,Tt=a,se=c,Kr=d,Ne=u,Ne.splice(0,Ne.length,...l),Xe=h,Oe=new DataView(se.buffer,se.byteOffset,se.byteLength),f}function hh(){se=null,kr=null,Ne=null}const fh=new Array(147);for(let t=0;t<256;t++)fh[t]=+("1e"+Math.floor(45.15-t*.30103));var ec=new no({useRecords:!1});const HC=ec.unpack;ec.unpackMultiple,ec.unpack;let VC=new Float32Array(1);new Uint8Array(VC.buffer,0,4);let tc;try{tc=new TextEncoder}catch{}let dh,gy;const nc=typeof Buffer<"u",rc=nc?function(t){return Buffer.allocUnsafeSlow(t)}:Uint8Array,yy=nc?Buffer:Uint8Array,_y=nc?4294967296:2144337920;let j,io,Ze,P=0,Wt,nt=null,KC;const qC=21760,XC=/[\u0080-\uFFFF]/,Yi=Symbol("record-id");class ZC extends no{constructor(e){super(e),this.offset=0;let n,r,i,s,o=yy.prototype.utf8Write?function(v,g){return j.utf8Write(v,g,j.byteLength-g)}:tc&&tc.encodeInto?function(v,g){return tc.encodeInto(v,j.subarray(g)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,l=e.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let d=l>32||h+l>64,f=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],b=0,_=0;this.pack=this.encode=function(v,g){if(j||(j=new rc(8192),Ze=j.dataView||(j.dataView=new DataView(j.buffer,0,8192)),P=0),Wt=j.length-10,Wt-P<2048?(j=new rc(j.length),Ze=j.dataView||(j.dataView=new DataView(j.buffer,0,j.length)),Wt=j.length-10,P=0):P=P+7&2147483640,n=P,g&rN&&(P+=g&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof v!="string"?(nt=[],nt.size=1/0):nt=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let W=i.sharedLength||0;if(W>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let M=0;M<W;M++){let J=i[M];if(!J)continue;let H,ee=i.transitions;for(let $=0,D=J.length;$<D;$++){let ce=J[$];H=ee[ce],H||(H=ee[ce]=Object.create(null)),ee=H}ee[Yi]=M+64}this.lastNamedStructuresLength=W}c||(i.nextId=W+64)}r&&(r=!1);let N;try{a.randomAccessStructure&&v&&v.constructor&&v.constructor===Object?x(v):S(v);let W=nt;if(nt&&vy(n,S,0),s&&s.idsToInsert){let M=s.idsToInsert.sort(($,D)=>$.offset>D.offset?1:-1),J=M.length,H=-1;for(;W&&J>0;){let $=M[--J].offset+n;$<W.stringsPosition+n&&H===-1&&(H=0),$>W.position+n?H>=0&&(H+=6):(H>=0&&(Ze.setUint32(W.position+n,Ze.getUint32(W.position+n)+H),H=-1),W=W.previous,J++)}H>=0&&W&&Ze.setUint32(W.position+n,Ze.getUint32(W.position+n)+H),P+=M.length*6,P>Wt&&L(P),a.offset=P;let ee=YC(j.subarray(n,P),M);return s=null,ee}return a.offset=P,g&tN?(j.start=n,j.end=P,j):j.subarray(n,P)}catch(W){throw N=W,W}finally{if(i&&(w(),r&&a.saveStructures)){let W=i.sharedLength||0,M=j.subarray(n,P),J=QC(i,a);if(!N)return a.saveStructures(J,J.isCompatible)===!1?a.pack(v,g):(a.lastNamedStructuresLength=W,j.length>1073741824&&(j=null),M)}j.length>1073741824&&(j=null),g&nN&&(P=n)}};const w=()=>{_<10&&_++;let v=i.sharedLength||0;if(i.length>v&&!c&&(i.length=v),b>1e4)i.transitions=null,_=0,b=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let g=0,N=m.length;g<N;g++)m[g][Yi]=0;m=[]}},E=v=>{var g=v.length;g<16?j[P++]=144|g:g<65536?(j[P++]=220,j[P++]=g>>8,j[P++]=g&255):(j[P++]=221,Ze.setUint32(P,g),P+=4);for(let N=0;N<g;N++)S(v[N])},S=v=>{P>Wt&&(j=L(P));var g=typeof v,N;if(g==="string"){let W=v.length;if(nt&&W>=4&&W<4096){if((nt.size+=W)>qC){let ee,$=(nt[0]?nt[0].length*3+nt[1].length:0)+10;P+$>Wt&&(j=L(P+$));let D;nt.position?(D=nt,j[P]=200,P+=3,j[P++]=98,ee=P-n,P+=4,vy(n,S,0),Ze.setUint16(ee+n-3,P-n-ee)):(j[P++]=214,j[P++]=98,ee=P-n,P+=4),nt=["",""],nt.previous=D,nt.size=0,nt.position=ee}let H=XC.test(v);nt[H?0:1]+=v,j[P++]=193,S(H?-W:W);return}let M;W<32?M=1:W<256?M=2:W<65536?M=3:M=5;let J=W*3;if(P+J>Wt&&(j=L(P+J)),W<64||!o){let H,ee,$,D=P+M;for(H=0;H<W;H++)ee=v.charCodeAt(H),ee<128?j[D++]=ee:ee<2048?(j[D++]=ee>>6|192,j[D++]=ee&63|128):(ee&64512)===55296&&(($=v.charCodeAt(H+1))&64512)===56320?(ee=65536+((ee&1023)<<10)+($&1023),H++,j[D++]=ee>>18|240,j[D++]=ee>>12&63|128,j[D++]=ee>>6&63|128,j[D++]=ee&63|128):(j[D++]=ee>>12|224,j[D++]=ee>>6&63|128,j[D++]=ee&63|128);N=D-P-M}else N=o(v,P+M);N<32?j[P++]=160|N:N<256?(M<2&&j.copyWithin(P+2,P+1,P+1+N),j[P++]=217,j[P++]=N):N<65536?(M<3&&j.copyWithin(P+3,P+2,P+2+N),j[P++]=218,j[P++]=N>>8,j[P++]=N&255):(M<5&&j.copyWithin(P+5,P+3,P+3+N),j[P++]=219,Ze.setUint32(P,N),P+=4),P+=N}else if(g==="number")if(v>>>0===v)v<32||v<128&&this.useRecords===!1||v<64&&!this.randomAccessStructure?j[P++]=v:v<256?(j[P++]=204,j[P++]=v):v<65536?(j[P++]=205,j[P++]=v>>8,j[P++]=v&255):(j[P++]=206,Ze.setUint32(P,v),P+=4);else if(v>>0===v)v>=-32?j[P++]=256+v:v>=-128?(j[P++]=208,j[P++]=v+256):v>=-32768?(j[P++]=209,Ze.setInt16(P,v),P+=2):(j[P++]=210,Ze.setInt32(P,v),P+=4);else{let W;if((W=this.useFloat32)>0&&v<4294967296&&v>=-2147483648){j[P++]=202,Ze.setFloat32(P,v);let M;if(W<4||(M=v*fh[(j[P]&127)<<1|j[P+1]>>7])>>0===M){P+=4;return}else P--}j[P++]=203,Ze.setFloat64(P,v),P+=8}else if(g==="object"||g==="function")if(!v)j[P++]=192;else{if(s){let M=s.get(v);if(M){if(!M.id){let J=s.idsToInsert||(s.idsToInsert=[]);M.id=J.push(M)}j[P++]=214,j[P++]=112,Ze.setUint32(P,M.id),P+=4;return}else s.set(v,{offset:P-n})}let W=v.constructor;if(W===Object)B(v);else if(W===Array)E(v);else if(W===Map)if(this.mapAsEmptyObject)j[P++]=128;else{N=v.size,N<16?j[P++]=128|N:N<65536?(j[P++]=222,j[P++]=N>>8,j[P++]=N&255):(j[P++]=223,Ze.setUint32(P,N),P+=4);for(let[M,J]of v)S(M),S(J)}else{for(let M=0,J=dh.length;M<J;M++){let H=gy[M];if(v instanceof H){let ee=dh[M];if(ee.write){ee.type&&(j[P++]=212,j[P++]=ee.type,j[P++]=0);let te=ee.write.call(this,v);te===v?Array.isArray(v)?E(v):B(v):S(te);return}let $=j,D=Ze,ce=P;j=null;let Q;try{Q=ee.pack.call(this,v,te=>(j=$,$=null,P+=te,P>Wt&&L(P),{target:j,targetView:Ze,position:P-te}),S)}finally{$&&(j=$,Ze=D,P=ce,Wt=j.length-10)}Q&&(Q.length+P>Wt&&L(Q.length+P),P=JC(Q,j,P,ee.type));return}}if(Array.isArray(v))E(v);else{if(v.toJSON){const M=v.toJSON();if(M!==v)return S(M)}if(g==="function")return S(this.writeFunction&&this.writeFunction(v));B(v)}}}else if(g==="boolean")j[P++]=v?195:194;else if(g==="bigint"){if(v<BigInt(1)<<BigInt(63)&&v>=-(BigInt(1)<<BigInt(63)))j[P++]=211,Ze.setBigInt64(P,v);else if(v<BigInt(1)<<BigInt(64)&&v>0)j[P++]=207,Ze.setBigUint64(P,v);else if(this.largeBigIntToFloat)j[P++]=203,Ze.setFloat64(P,Number(v));else{if(this.largeBigIntToString)return S(v.toString());if(this.useBigIntExtension&&v<BigInt(2)**BigInt(1023)&&v>-(BigInt(2)**BigInt(1023))){j[P++]=199,P++,j[P++]=66;let W=[],M;do{let J=v&BigInt(255);M=(J&BigInt(128))===(v<BigInt(0)?BigInt(128):BigInt(0)),W.push(J),v>>=BigInt(8)}while(!((v===BigInt(0)||v===BigInt(-1))&&M));j[P-2]=W.length;for(let J=W.length;J>0;)j[P++]=Number(W[--J]);return}else throw new RangeError(v+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}P+=8}else if(g==="undefined")this.encodeUndefinedAsNil?j[P++]=192:(j[P++]=212,j[P++]=0,j[P++]=0);else throw new Error("Unknown type: "+g)},C=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?v=>{let g;if(this.skipValues){g=[];for(let M in v)(typeof v.hasOwnProperty!="function"||v.hasOwnProperty(M))&&!this.skipValues.includes(v[M])&&g.push(M)}else g=Object.keys(v);let N=g.length;N<16?j[P++]=128|N:N<65536?(j[P++]=222,j[P++]=N>>8,j[P++]=N&255):(j[P++]=223,Ze.setUint32(P,N),P+=4);let W;if(this.coercibleKeyAsNumber)for(let M=0;M<N;M++){W=g[M];let J=Number(W);S(isNaN(J)?W:J),S(v[W])}else for(let M=0;M<N;M++)S(W=g[M]),S(v[W])}:v=>{j[P++]=222;let g=P-n;P+=2;let N=0;for(let W in v)(typeof v.hasOwnProperty!="function"||v.hasOwnProperty(W))&&(S(W),S(v[W]),N++);if(N>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');j[g+++n]=N>>8,j[g+n]=N&255},I=this.useRecords===!1?C:e.progressiveRecords&&!d?v=>{let g,N=i.transitions||(i.transitions=Object.create(null)),W=P++-n,M;for(let J in v)if(typeof v.hasOwnProperty!="function"||v.hasOwnProperty(J)){if(g=N[J],g)N=g;else{let H=Object.keys(v),ee=N;N=i.transitions;let $=0;for(let D=0,ce=H.length;D<ce;D++){let Q=H[D];g=N[Q],g||(g=N[Q]=Object.create(null),$++),N=g}W+n+1==P?(P--,q(N,H,$)):ie(N,H,W,$),M=!0,N=ee[J]}S(v[J])}if(!M){let J=N[Yi];J?j[W+n]=J:ie(N,Object.keys(v),W,0)}}:v=>{let g,N=i.transitions||(i.transitions=Object.create(null)),W=0;for(let J in v)(typeof v.hasOwnProperty!="function"||v.hasOwnProperty(J))&&(g=N[J],g||(g=N[J]=Object.create(null),W++),N=g);let M=N[Yi];M?M>=96&&d?(j[P++]=((M-=96)&31)+96,j[P++]=M>>5):j[P++]=M:q(N,N.__keys__||Object.keys(v),W);for(let J in v)(typeof v.hasOwnProperty!="function"||v.hasOwnProperty(J))&&S(v[J])},R=typeof this.useRecords=="function"&&this.useRecords,B=R?v=>{R(v)?I(v):C(v)}:I,L=v=>{let g;if(v>16777216){if(v-n>_y)throw new Error("Packed buffer would be larger than maximum buffer size");g=Math.min(_y,Math.round(Math.max((v-n)*(v>67108864?1.25:2),4194304)/4096)*4096)}else g=(Math.max(v-n<<2,j.length-1)>>12)+1<<12;let N=new rc(g);return Ze=N.dataView||(N.dataView=new DataView(N.buffer,0,g)),v=Math.min(v,j.length),j.copy?j.copy(N,0,n,v):N.set(j.slice(n,v)),P-=n,n=0,Wt=N.length-10,j=N},q=(v,g,N)=>{let W=i.nextId;W||(W=64),W<f&&this.shouldShareStructure&&!this.shouldShareStructure(g)?(W=i.nextOwnId,W<p||(W=f),i.nextOwnId=W+1):(W>=p&&(W=f),i.nextId=W+1);let M=g.highByte=W>=96&&d?W-96>>5:-1;v[Yi]=W,v.__keys__=g,i[W-64]=g,W<f?(g.isShared=!0,i.sharedLength=W-63,r=!0,M>=0?(j[P++]=(W&31)+96,j[P++]=M):j[P++]=W):(M>=0?(j[P++]=213,j[P++]=114,j[P++]=(W&31)+96,j[P++]=M):(j[P++]=212,j[P++]=114,j[P++]=W),N&&(b+=_*N),m.length>=h&&(m.shift()[Yi]=0),m.push(v),S(g))},ie=(v,g,N,W)=>{let M=j,J=P,H=Wt,ee=n;j=io,P=0,n=0,j||(io=j=new rc(8192)),Wt=j.length-10,q(v,g,W),io=j;let $=P;if(j=M,P=J,Wt=H,n=ee,$>1){let D=P+$-1;D>Wt&&L(D);let ce=N+n;j.copyWithin(ce+$,ce+1,P),j.set(io.slice(0,$),ce),P=D}else j[N+n]=io[0]},x=v=>{let g=KC(v,j,n,P,i,L,(N,W,M)=>{if(M)return r=!0;P=W;let J=j;return S(N),w(),J!==j?{position:P,targetView:Ze,target:j}:P},this);if(g===0)return B(v);P=g}}useBuffer(e){j=e,j.dataView||(j.dataView=new DataView(j.buffer,j.byteOffset,j.byteLength)),P=0}set position(e){P=e}get position(){return P}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}gy=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Q0],dh=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?by(t,16,e):wy(nc?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==yy&&this.moreTypes?by(t,py.indexOf(n.name),e):wy(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function by(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function wy(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function JC(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function YC(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function vy(t,e,n){if(nt.length>0){Ze.setUint32(nt.position+t,P+n-nt.position-t),nt.stringsPosition=P-t;let r=nt;nt=null,e(r[0]),e(r[1])}}function QC(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let Ey=new ZC({useRecords:!1});const eN=Ey.pack;Ey.pack;const tN=512,nN=1024,rN=2048;function wi(){return null}function so(t,e,n={}){if(!k(t))return;const r=[],i=Object.keys(t);for(let s=0;s<i.length;++s){let o=i[s],a=t[o];const c=n[o];k(c)&&(a=c(a));const u=e[o];k(u)&&(o=u),a!==null&&r.push(o,a)}return r}function oo(t,e,n={}){if(k(t))try{const r={};for(let i=0;i<t.length;i+=2){let s=t[i],o=t[i+1];const a=e[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){Bt("format","binary",r.message)}}function iN(t){try{const e=ar(t);return eN(e)}catch(e){Bt("format","binary",e.message)}}function sN(t){try{return HC(t)}catch(e){Bt("format","binary",e.message)}}function ky(){return{id:at()}}var ph=(t=>(t[t.kind=0]="kind",t[t.id=1]="id",t[t.x=2]="x",t[t.y=3]="y",t[t.lx=4]="lx",t[t.ly=5]="ly",t[t.code=6]="code",t[t.name=7]="name",t[t.char=8]="char",t[t.color=9]="color",t[t.bg=10]="bg",t[t.light=11]="light",t[t.player=12]="player",t[t.bucket=13]="bucket",t[t.pushable=14]="pushable",t[t.collision=15]="collision",t[t.destructible=16]="destructible",t[t.tickertext=17]="tickertext",t[t.tickertime=18]="tickertime",t[t.p1=19]="p1",t[t.p2=20]="p2",t[t.p3=21]="p3",t[t.cycle=22]="cycle",t[t.stepx=23]="stepx",t[t.stepy=24]="stepy",t[t.sender=25]="sender",t[t.arg=26]="arg",t[t.headless=27]="headless",t[t.removed=28]="removed",t))(ph||{});function ic(t){return so(t,ph,{category:wi,kinddata:wi})}function sc(t){return oo(t,ph)}var mh=(t=>(t[t.width=0]="width",t[t.height=1]="height",t[t.bits=2]="bits",t))(mh||{});function Sy(t){return so(t,mh)}function Ay(t){return oo(t,mh)}function oN(t,e){return{id:at(),code:t,...e}}var gh=(t=>(t[t.id=0]="id",t[t.code=1]="code",t[t.board=2]="board",t[t.object=3]="object",t[t.terrain=4]="terrain",t[t.charset=5]="charset",t[t.palette=6]="palette",t[t.eighttrack=7]="eighttrack",t))(gh||{});function aN(t){return so(t,gh,{board:CN,object:ic,terrain:ic,charset:Sy,palette:Sy,stats:wi})}function cN(t){return oo(t,gh,{board:NN,object:sc,terrain:sc,charset:Ay,palette:Ay})}function Ty(t){const e={...Qi(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function lN(t){return k(t)?(t.stats=void 0,Qi(t)):{}}function Qi(t){var r;if(!k(t))return{};if(k((r=t.stats)==null?void 0:r.type))return t.stats;t.stats={};const e=Z0(t.code);let n=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===Zu){const a=s.image.slice(1).split(" "),c=J0(a,n),u=Pe(c.values.join(" "));switch(n=!1,c.type){case he.LOADER:t.stats.type=Re.LOADER,t.stats.name=u;break;case he.BOARD:t.stats.type=Re.BOARD,t.stats.name=u;break;case he.OBJECT:t.stats.type=Re.OBJECT,t.stats.name=u;break;case he.TERRAIN:t.stats.type=Re.TERRAIN,t.stats.name=u;break;case he.CHARSET:t.stats.type=Re.CHARSET,t.stats.name=u;break;case he.PALETTE:t.stats.type=Re.PALETTE,t.stats.name=u;break;case he.CONST:{const[l,h]=c.values;if(ke(l)){const d=Pe(l);if(ke(h)){const f=parseFloat(h);t.stats[d]=Ee(f)?f:h}else Ee(h)?t.stats[d]=h:t.stats[d]=1}break}case he.RANGE:case he.SELECT:case he.NUMBER:case he.TEXT:case he.LINK:case he.HOTKEY:case he.SCROLL:{const[l,...h]=c.values;if(ke(l)){const d=Pe(l);t.stats[d]=h}break}}}}return k(t.stats.type)||(t.stats.type=Re.OBJECT),t.stats}function Ry(t){switch(t){default:case Re.ERROR:return"error";case Re.LOADER:return _n(he.LOADER);case Re.BOARD:return _n(he.BOARD);case Re.OBJECT:return _n(he.OBJECT);case Re.TERRAIN:return _n(he.TERRAIN);case Re.CHARSET:return _n(he.CHARSET);case Re.PALETTE:return _n(he.PALETTE)}}function oc(t){return Qi(t).type??Re.ERROR}function ac(t){return Ry(oc(t))}function Sr(t){return Qi(t).name??""}function Iy(t,e){const n=Ty(t),r=Object.keys(n);for(let i=0;i<r.length;++i){const s=r[i];switch(s){case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[s]=n[s];break;case"canpush":case"ispushable":e.pushable=1;break;case"iswalk":case"iswalkable":e.collision=He.ISWALK;break;case"isswim":case"isswimable":e.collision=He.ISSWIM;break;case"issolid":e.collision=He.ISSOLID;break;case"isbullet":e.collision=He.ISBULLET;break;case"canshoot":case"isdestructible":e.destructible=1;break}}}function cc(t){if(k(t))switch(oc(t)){default:return;case Re.ERROR:return t.code??"";case Re.LOADER:return t.code??"";case Re.BOARD:{k(t.board)||(t.board=ON()),t.board.id=t.id;const e=Ty(t);return t.board.isdark=k(e.isdark)&&e.isdark?1:0,t.board.over=e.over??t.board.over,t.board.under=e.under??t.board.under,t.board.exitnorth=e.exitnorth??t.board.exitnorth,t.board.exitsouth=e.exitsouth??t.board.exitsouth,t.board.exitwest=e.exitwest??t.board.exitwest,t.board.exiteast=e.exiteast??t.board.exiteast,t.board.timelimit=e.timelimit??t.board.timelimit,t.board.restartonzap=e.restartonzap??t.board.restartonzap,t.board.maxplayershots=e.maxplayershots??t.board.maxplayershots,t.board}case Re.OBJECT:return k(t.object)||(t.object=ky()),t.object.name=Sr(t),Iy(t,t.object),t.object;case Re.TERRAIN:return k(t.terrain)||(t.terrain=ky()),t.terrain.name=Sr(t),Iy(t,t.terrain),t.terrain;case Re.CHARSET:return k(t.charset),t.charset;case Re.PALETTE:return k(t.palette),t.palette}}function xy(t){return{id:at(),name:ib(),timestamp:0,activelist:[],pages:t,flags:{}}}var yh=(t=>(t[t.id=0]="id",t[t.name=1]="name",t[t.timestamp=2]="timestamp",t[t.activelist=3]="activelist",t[t.pages=4]="pages",t[t.flags=5]="flags",t))(yh||{});function uN(t){return so(t,yh,{pages:e=>e.map(aN)})}function hN(t){return oo(t,yh,{pages:e=>e.map(cN)})}function vi(t,e){if(!k(t))return;const n=Pe(e);return t.pages.find(i=>i.id===e||n===Sr(i))}function Oy(t,e,n){if(!k(t))return;const r=Pe(n);return t.pages.find(s=>oc(s)===e&&(s.id===n||r===Sr(s)))}function Cy(t,e){return k(t)?t.pages.filter(n=>oc(n)===e):[]}function fN(t,e){if(!k(t)||!k(e))return!1;const n=vi(t,e.id);return k(n)?!1:(t.pages.push(e),!0)}function dN(t,e){const n=vi(t,e);if(k(t)&&k(n)){const r=Pe(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==Sr(i)),n}}function vn(t,e){if(k(e)&&k(e.kind))return k(e.kinddata)||(e.kinddata=k(e.id)?lc(t,e.kind):Ny(t,e.kind)),e.kinddata}function pN(t,e,n){const r=vn(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function _h(t,e,n,r,i){const s=vn(t,e);return{char:(e==null?void 0:e.char)??(s==null?void 0:s.char)??n,color:(e==null?void 0:e.color)??(s==null?void 0:s.color)??r,bg:(e==null?void 0:e.bg)??(s==null?void 0:s.bg)??i,light:(e==null?void 0:e.light)??(s==null?void 0:s.light)??0}}function lc(t,e){const n=e??"",r=Oy(t,Re.OBJECT,n);if(k(r)){const i=cc(r);return{...ar(i),name:n,code:r.code}}}function Ny(t,e){const n=e??"",r=Oy(t,Re.TERRAIN,n);if(k(r)){const i=cc(r);return{...ar(i),name:n,code:r.code}}}function ao(t,e){const n=vi(t,e);return cc(n)}function es(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function bh(t,e){t&&delete t.flags[e]}function Ly(t,e,n){const r=es(t,e);return r==null?void 0:r[n]}function mN(t,e,n,r){const i=es(t,e);return i&&(i[n]=r),r}function uc(t,e){const n=Ly(t,e,"board");return ao(t,ke(n)?n:"")}function wh(t,e,n){if(!k(t))return;mN(t,e,"board",n);const r=ao(t,n);k(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function gN(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=Ly(t,r,"board");return ke(i)?i:""});return a1(n)}function My(t){return gN(t).map(n=>ao(t,n)).filter(k)}function yN(t,e,n,r){const i=Ei(e,(n==null?void 0:n.id)??"");if(!k(t)||!k(e)||!k(i)||!k(i.x)||!k(i.y)||!k(e.lookup)||r.x<0||r.x>=et||r.y<0||r.y>=un||i.x-r.x===0&&i.y-r.y===0)return!0;const s=r.x+r.y*et,o=vn(t,i),a=i.collision??(o==null?void 0:o.collision),c=Ei(e,e.lookup[s]??"");if(k(c))return!0;const u=e.terrain[s];if(k(u)){const l=vn(t,u),h=u.collision??(l==null?void 0:l.collision);if(Ql(a,h))return!0}return!1}function _N(t,e,n,r){const i=Ei(e,(n==null?void 0:n.id)??"");if(!k(t)||!k(e)||!k(i)||!k(i.x)||!k(i.y)||!k(e.lookup)||r.x<0||r.x>=et||r.y<0||r.y>=un)return{kind:"edge",collision:He.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=i.x+i.y*et,o=r.x+r.y*et,a=vn(t,i),c=i.collision??(a==null?void 0:a.collision),u=Ei(e,e.lookup[o]??"");if(k(u))return{...u};const l=e.terrain[o];if(k(l)){const h=vn(t,l),d=l.collision??(h==null?void 0:h.collision);if(Ql(c,d))return{...l,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,k(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function ts(t,e){const n=vn(t,e);return k(e==null?void 0:e.id)&&k(e.x)&&k(e.y)?Pe(e.name??(n==null?void 0:n.name)??"object"):Pe((e==null?void 0:e.name)??(n==null?void 0:n.name)??"terrain")}function vh(t,e,n,r){if(!k(t)||!k(e)||!k(e.named)||!k(n))return;const i=ts(t,n);e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function bN(t,e,n){if(!(!k(t)||!k(e)||!k(e.lookup)||!k(n==null?void 0:n.id))&&!k(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*et]=n.id}}function hc(t,e){if(!k(t)||!k(e)||k(e.lookup)&&k(e.named))return;const n=new Array(et*un).fill(void 0),r={},i=Object.values(e.objects);for(let a=0;a<i.length;++a){const c=i[a];if(k(c.x)&&k(c.y)&&k(c.id)&&!k(c.removed)){c.category=Eo.ISOBJECT,n[c.x+c.y*et]=c.id;const u=ts(t,c);r[u]||(r[u]=new Set),r[u].add(c.id)}}let s=0,o=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(k(c)){c.x=s,c.y=o,c.category=Eo.ISTERRAIN;const u=ts(t,c);r[u]||(r[u]=new Set),r[u].add(a)}++s,s>=et&&(s=0,++o)}e.lookup=n,e.named=r}function fc(t,e,n){return ts(t,e)!=="player"&&k(e)?(e.removed=n,!0):!1}function co(t,e,n){var r;if(k(t)&&k(e)&&k(n==null?void 0:n.id)){if(k(e.lookup)&&k(n.x)&&k(n.y)){const s=n.x+n.y*et;e.lookup[s]===n.id&&e.lookup.splice(s,1)}const i=ts(t,n);k((r=e.named)==null?void 0:r[i])&&k(n.id)&&e.named[i].delete(n.id)}}function wN(t,e,n){const r=[];if(!k(t)||!k(e))return r;const i=Object.values(e.objects);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&k(o.removed)&&n-o.removed>To*5&&(r.push(o.id),Ky(e,o.id))}return r}function vN(t,e,n){const r=[];if(!k(t)||!k(e))return r;e.lookup=void 0,hc(t,e);const i=Object.values(e.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!k(a.id))continue;a.lx=a.x,a.ly=a.y;const c=vn(t,a),u=a.code??(c==null?void 0:c.code)??"";u&&r.push({id:a.id,type:Re.OBJECT,code:u,object:a,terrain:void 0})}const s=wN(t,e,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:Re.ERROR,code:"",object:void 0,terrain:void 0});return r}function EN(t,e,n,r){if(k(t)&&k(e)&&k(n)){const[i,s]=n,o=lc(t,i);if(k(o)&&k(o.name)){const a=Th(e,r,i);return gc(a,s),vh(t,e,a),a}}}function Eh(t,e,n,r){if(k(t)&&k(e)&&k(n)){const[i,s]=n,o=Ny(t,i);if(k(o)){const c=Vy(e,r,i);gc(c,s);const u=r.x+r.y*et;return vh(t,e,c,u),c}const a=lc(t,i);if(k(a)&&k(a.name)){const c=Th(e,r,i);return gc(c,s),bN(t,e,c),vh(t,e,c),c}}}const Uy={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ar(t){return ze(t)&&Py(t[0])}function Py(t){return k(Eo[t])&&ke(t)}function Dy(t){if(ke(t))return Uy[Pe(t)]}function By(t){if(Ar(t))return t;if(Py(t))return[t];const e=Dy(t);if(k(e))return[e]}function dc(t){const e=O.words[t],n=By(e);if(Ar(n))return[n,t+1];const[r,i]=Mt(t),s=By(r);return Ar(s)?[s,i]:[void 0,t]}const Fy={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};He.ISSOLID,He.ISWALK,He.ISSWIM,He.ISBULLET,He.ISWALK,He.ISSWIM;function qr(t){return ze(t)&&kh(t[0])}function kh(t){return k(He[t])&&ke(t)}function kN(t){if(ke(t))return Fy[Pe(t)]}function $y(t){const e=O.words[t];if(qr(e))return[e,t+1];if(kh(e))return[[e],t+1];const[n,r]=Mt(t);return qr(n)?[n,r]:kh(n)?[[n],r]:[void 0,t]}function Mt(t,e=!0){var i,s,o,a,c;const n=O.words[t],r=t+1;if(Dy(n)){const[u,l]=dc(t);if(k(u))return[u,l]}if(kN(n)){const[u,l]=$y(t);if(k(u))return[u,l]}if(Wy(n)){const[u,l]=mc(t);if(k(u))return[u,l]}if(ke(n)&&Pe(n)==="rnd"){const[u,l]=Mt(r),[h,d]=Mt(l);return Ee(u)&&Ee(h)?[Ns(u,h),d]:Ee(u)?[Ns(0,u),l]:[Ns(0,1),r]}if(zp(n)){const[u,l]=Yl(t);if(k(u))return[u,l]}if(!k(n))return[void 0,t];if(Ee(n)||ze(n))return[n,r];if(ke(n)){const u=Pe(n);if(e){const l=(i=O.get)==null?void 0:i.call(O,n);if(k(l))return[l,r]}switch(u){case"aligned":case"alligned":{const l=qp(O.board,O.element,O.player);return!k(O.element)||!k(l)?[0,r]:[O.element.x===l.x||O.element.y===l.y?1:0,r]}case"contact":{const l=qp(O.board,O.element,O.player);if(!k(O.element)||!k(l))return[0,r];const h=(l.x??0)-(((s=O.element)==null?void 0:s.x)??0),d=(l.y??0)-(((o=O.element)==null?void 0:o.y)??0);return[h===0&&Math.abs(d)<2||d===0&&Math.abs(h)<2?1:0,r]}case"blocked":{const[l,h]=Y(O.words,r,[V.DIR]);return[yN(O.book,O.board,O.element,l)?1:0,h]}case"any":{const[l,h]=Y(O.words,r,[V.KIND]),d=la(l)??"",f=Ms(O.board,d);return[Xp(f,l).length?1:0,h]}case"rnd":return[Ns(0,1),r];case"abs":{const[l,h]=Y(O.words,r,[V.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=Y(O.words,r,[V.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=Y(O.words,r,[V.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=Y(O.words,r,[V.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,d,f]=Y(O.words,r,[V.NUMBER,V.NUMBER,V.NUMBER]);return[Gn(l,h,d),f]}case"min":{const l=[];for(let h=r;h<O.words.length;){const[d,f]=Mt(h);ze(d)&&!Hn(d)&&!Ar(d)&&!qr(d)&&!sn(d)&&l.push(...d),h=f,l.push(d)}return[Math.min(...l),O.words.length]}case"max":{const l=[];for(let h=r;h<O.words.length;){const[d,f]=Mt(h);ze(d)&&!Hn(d)&&!Ar(d)&&!qr(d)&&!sn(d)&&l.push(...d),h=f,l.push(d)}return[Math.max(...l),O.words.length]}case"pick":{const l=[];for(let h=r;h<O.words.length;){const[d,f]=Mt(h);ze(d)&&!Hn(d)&&!Ar(d)&&!qr(d)&&!sn(d)&&l.push(...d),h=f,l.push(d)}return[ji(l),O.words.length]}case"pickwith":{const l=[],[h,d]=Y(O.words,r,[V.STRING]);for(let f=d;f<O.words.length;){const[p,m]=Mt(f);ze(p)&&!Hn(p)&&!Ar(p)&&!qr(p)&&!sn(p)&&l.push(...p),f=m,l.push(p)}return[Fp(h,l),O.words.length]}case"range":{const[l,h,d,f]=Y(O.words,r,[V.NUMBER,V.MAYBE_NUMBER,V.MAYBE_NUMBER]);return[Jl(l,h,d),f]}case"run":{const[l,h]=Y(O.words,r,[V.STRING]);return Ic(l),[(a=O.get)==null?void 0:a.call(O,"arg"),h]}case"runwith":{const[l,h,d]=Y(O.words,r,[V.ANY,V.STRING]);return k(O.element)&&(O.element.arg=l),Ic(h),[(c=O.get)==null?void 0:c.call(O,"arg"),d]}}}return[n,r]}function SN(t){return k(t)&&t<Te.ONBLACK?t:void 0}function AN(t){return k(t)&&t>Te.WHITE&&t<Te.ONCLEAR?t-Te.ONBLACK:void 0}const pc={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function sn(t){return ze(t)&&zy(t[0])}function jy(t){return sn(t)&&t[0].startsWith("ON")}function zy(t){return k(Te[t])&&ke(t)}function Wy(t){if(ke(t))return pc[Pe(t)]}function TN(t){return t.map(e=>Te[e]).find(e=>k(e)&&e<Te.ONBLACK)}function RN(t){return t.map(e=>Te[e]).find(e=>k(e)&&e>=Te.ONBLACK)}function Gy(t){if(sn(t))return t;if(zy(t))return[t];const e=Wy(t);if(k(e))return[e]}function Hy(t){const e=O.words[t],n=Gy(e);if(sn(n))return[n,t+1];const[r,i]=Mt(t),s=Gy(r);return sn(s)?[s,i]:[void 0,t]}function mc(t){const e=[];let n=t;const[r,i]=Hy(t);if(sn(r)&&(e.push(...r),n=i),sn(e)&&!jy(e)){const[s,o]=Hy(i);jy(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function IN(t){const e={};return t.every(n=>{const r=Te[n];k(r)&&(r<Te.ONBLACK?e.color=r:e.bg=r-Te.ONBLACK)}),e}function xN(){return new Array(et*un).map(()=>{})}function ON(t=Rb){const e={terrain:xN(),objects:{},id:""};return t(e)}var Sh=(t=>(t[t.terrain=0]="terrain",t[t.objects=1]="objects",t[t.isdark=2]="isdark",t[t.over=3]="over",t[t.under=4]="under",t[t.exitnorth=5]="exitnorth",t[t.exitsouth=6]="exitsouth",t[t.exitwest=7]="exitwest",t[t.exiteast=8]="exiteast",t[t.timelimit=9]="timelimit",t[t.restartonzap=10]="restartonzap",t[t.maxplayershots=11]="maxplayershots",t))(Sh||{});function CN(t){return so(t,Sh,{terrain:e=>e.map(ic),objects:e=>Object.values(e).map(ic),id:wi,named:wi,lookup:wi,codepage:wi})}function NN(t){return oo(t,Sh,{terrain:e=>e.map(sc),objects:e=>{const n={};for(let r=0;r<e.length;++r){const i=sc(e[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function LN(t,e){return!k(t)||e.x<0||e.x>=et||e.y<0||e.y>=un?-1:e.x+e.y*et}function Ah(t){var e;return Pe((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"object")}function MN(t){var e;return(t==null?void 0:t.color)??((e=t==null?void 0:t.kinddata)==null?void 0:e.color)??Te.BLACK}function UN(t){var e;return(t==null?void 0:t.bg)??((e=t==null?void 0:t.kinddata)==null?void 0:e.bg)??Te.BLACK}function gc(t,e){if(!k(t)||!sn(e))return;const{color:n,bg:r}=IN(e);k(n)&&(t.color=n),k(r)&&(t.bg=r)}function PN(t,e){if(!k(t)||!k(e)||!k(e.x)||!k(e.y)||e.x<0||e.x>=et||e.y<0||e.y>=un)return;const n=ar(e),r=e.x+e.y*et;return t.terrain[r]=n,t.terrain[r]}function DN(t,e){if(!k(t)||!k(e))return;const n=ar(e);return n.id=n.id??at(),t.objects[n.id]=n,t.objects[n.id]}function Vy(t,e,n){return PN(t,{...e,kind:n})}function Th(t,e,n,r){const i=DN(t,{...e,kind:n});return k(r)&&k(i)&&(i.id=r),i}function Ei(t,e){if(t)return t.objects[e]}function Rh(t,e,n,r,i){if(!k(t)||!k(e))return{x:0,y:0};const s={x:e.x??0,y:e.y??0},o={x:e.lx??s.x,y:e.ly??s.y},a=zi(o,s),c=et-1,u=un-1;for(let l=0;l<r.length;++l){const h=c1(r[l]);switch(h){case ae.IDLE:break;case ae.NORTH:case ae.SOUTH:case ae.WEST:case ae.EAST:At(s,h);break;case ae.BY:{const[d,f]=r.slice(l+1);Ee(d)&&Ee(f)&&(s.x=Gn(s.x+d,0,c),s.y=Gn(s.y+f,0,u)),l+=2;break}case ae.AT:{const[d,f]=r.slice(l+1);Ee(d)&&Ee(f)&&(s.x=Gn(d,0,c),s.y=Gn(f,0,u)),l+=2;break}case ae.FLOW:At(s,a);break;case ae.SEEK:{const d=BN(t,e,n);Ls(d)&&At(s,zi(i,d));break}case ae.RNDNS:At(s,ji(ae.NORTH,ae.SOUTH));break;case ae.RNDNE:At(s,ji(ae.NORTH,ae.EAST));break;case ae.RND:At(s,ji(ae.NORTH,ae.SOUTH,ae.WEST,ae.EAST));break;case ae.CW:case ae.CCW:case ae.OPP:case ae.RNDP:{const d=Rh(t,e,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case ae.CW:switch(zi(i,d)){case ae.NORTH:At(s,ae.EAST);break;case ae.SOUTH:At(s,ae.WEST);break;case ae.EAST:At(s,ae.SOUTH);break;case ae.WEST:At(s,ae.NORTH);break}break;case ae.CCW:switch(zi(i,d)){case ae.NORTH:At(s,ae.WEST);break;case ae.SOUTH:At(s,ae.EAST);break;case ae.EAST:At(s,ae.NORTH);break;case ae.WEST:At(s,ae.SOUTH);break}break;case ae.OPP:switch(zi(i,d)){case ae.NORTH:At(s,ae.SOUTH);break;case ae.SOUTH:At(s,ae.NORTH);break;case ae.EAST:At(s,ae.WEST);break;case ae.WEST:At(s,ae.EAST);break}break;case ae.RNDP:switch(zi(i,d)){case ae.NORTH:case ae.SOUTH:s.x+=ji(-1,1);break;case ae.WEST:case ae.EAST:s.y+=ji(-1,1);break}break}break}}}return s}function Ky(t,e){return k(t==null?void 0:t.objects[e])?(delete t.objects[e],!0):!1}function BN(t,e,n){if(!k(t)||!k(e))return;const r=t.objects[n];if(k(r))return r;if(Ls(e))return Zp(e,Ms(t,"player"))}const O={timestamp:0,book:void 0,board:void 0,element:void 0,player:"",isplayer:!1,words:[],get:void 0};var V=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NUMBER=5]="NUMBER",t[t.STRING=6]="STRING",t[t.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=9]="MAYBE_COLLISION",t[t.MAYBE_COLOR=10]="MAYBE_COLOR",t[t.MAYBE_KIND=11]="MAYBE_KIND",t[t.MAYBE_DIR=12]="MAYBE_DIR",t[t.MAYBE_NUMBER=13]="MAYBE_NUMBER",t[t.MAYBE_STRING=14]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",t[t.ANY=16]="ANY",t))(V||{});function It(t,e){throw new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function Y(t,e,n){var o,a,c,u;const r=O.words;O.words=t;const i=[];let s=e;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,d]=dc(s);Ar(h)||It("terrain or object",h),s=d,i.push(h);break}case 1:{const[h,d]=$y(s);qr(h)||It("solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 2:{const[h,d]=mc(s);sn(h)||It("color",h),s=d,i.push(h);break}case 3:{const[h,d]=Hp(s);Wi(h)?(s=d,i.push(h)):It("kind",h);break}case 4:{const[h,d]=Yl(s);if(Hn(h)){const f=((o=O.element)==null?void 0:o.x)??0,p=((a=O.element)==null?void 0:a.y)??0,m={x:f,y:p},b=k(O.board)&&k(O.element)?Rh(O.board,O.element,O.player,h,m):m;s=d,i.push(b)}else It("direction",h);break}case 5:{const[h,d]=Mt(s);if(ke(h)){const f=parseFloat(h);Ee(f)?i.push(f):It("number",h)}else Ee(h)?i.push(h):It("number",h);s=d;break}case 6:{const h=O.words[s];ke(h)||It("string",h),++s,i.push(h);break}case 7:{const[h,d]=Mt(s,!1);let f=h;if(ke(f)){const p=parseFloat(f);Ee(p)&&(f=p)}else Ee(f)||It("number or string",f);s=d,i.push(f);break}case 8:{const[h,d]=dc(s);h!==void 0&&!Ar(h)&&It("optional terrain or object",h),s=d,i.push(h);break}case 9:{const[h,d]=dc(s);h!==void 0&&!qr(h)&&It("optional solid, walk, swim, bullet, walkable or swimmable",h),s=d,i.push(h);break}case 10:{const[h,d]=mc(s);h!==void 0&&!sn(h)&&It("optional color",h),s=d,i.push(h);break}case 11:{const[h,d]=Hp(s);h!==void 0&&!Wi(h)&&It("optional kind",h),s=d,i.push(h);break}case 12:{const[h,d]=Yl(s);if(Hn(h)){const f=((c=O.element)==null?void 0:c.x)??0,p=((u=O.element)==null?void 0:u.y)??0,m={x:f,y:p},b=O.board?Rh(O.board,O.element,O.player,h,m):m;s=d,i.push(b)}else h===void 0?(s=d,i.push(void 0)):It("optional direction",h);break}case 13:{const[h,d]=Mt(s);if(ke(h)){const f=parseFloat(h);Ee(f)?i.push(f):It("optional number",h)}else Ee(h)||h===void 0?i.push(h):It("optional number",h);s=d;break}case 14:{const h=O.words[s];h!==void 0&&!ke(h)&&It("optional string",h),++s,i.push(h);break}case 15:{const[h,d]=Mt(s,!1);let f=h;if(ke(f)){const p=parseFloat(f);Ee(p)&&(f=p)}else f!==void 0&&!Ee(f)&&It("number or string",f);s=d,i.push(f);break}case 16:{const[h,d]=Mt(s);s=d,i.push(h);break}}return O.words=r,[...i,s]}const FN=["echo","reverb","chorus","phaser","distortion","vibrato"];function qy(t,e,n){const[r]=Y(n,0,[V.MAYBE_STRING]),i=r??"",s=e.get(i);fk("audio",t,ke(s)?s:i)}function tr(t,e){const[n]=Y(e,0,[V.NUMBER_OR_STRING]);if(Ee(n))jl("audio",t,"volume",n);else if(FN.includes(Pe(n))){const[r,i]=Y(e,1,[V.NUMBER_OR_STRING,V.MAYBE_NUMBER_OR_STRING]);gk("audio",t,n,r,i)}else{const[r]=Y(e,1,[V.MAYBE_NUMBER_OR_STRING]);if(Ee(r)){const i=e.length-1,s=new Array(i).fill(V.NUMBER),o=Y(e,1,s).slice(0,i),a=o.length===1?o[0]:o;jl("audio",t,n,a)}else{const[i]=Y(e,1,[V.MAYBE_NUMBER_OR_STRING]);jl("audio",t,n,i)}}}const $N=gr().command("mainvolume",(t,e)=>{const[n]=Y(e,0,[V.NUMBER]);return dk("audio",n,O.player),0}).command("drumvolume",(t,e)=>{const[n]=Y(e,0,[V.NUMBER]);return pk("audio",n,O.player),0}).command("ttsvolume",(t,e)=>{const[n]=Y(e,0,[V.NUMBER]);return mk("audio",n,O.player),0}).command("play",(t,e)=>(qy(1,t,e),0)).command("synth",(t,e)=>{for(let n=1;n<=8;++n)tr(n,e);return 0}).command("synth1",(t,e)=>(tr(1,e),0)).command("synth2",(t,e)=>(tr(2,e),0)).command("synth3",(t,e)=>(tr(3,e),0)).command("synth4",(t,e)=>(tr(4,e),0)).command("synth5",(t,e)=>(tr(5,e),0)).command("synth6",(t,e)=>(tr(6,e),0)).command("synth7",(t,e)=>(tr(7,e),0)).command("synth8",(t,e)=>(tr(8,e),0)).command("bgplay",(t,e)=>(qy(0,t,e),0)).command("bgsynth",(t,e)=>(tr(0,e),0)).command("tts",(t,e)=>{const[n,r]=Y(e,0,[V.STRING,V.MAYBE_STRING]);return hk("audio",r??"",n),0});function yc(t,e,n,r){const i=ke(e)?e:e.id,s=ke(e)?void 0:{x:e.x??0,y:e.y??0},o=ke(n)?n:n.id,a=i??s;k(o)&&k(a)&&t.send(o,r,a)}function jN(t,e,n,r){k(n==null?void 0:n.id)?(n.headless=!0,co(t,e,n)):Vy(e,r,"empty")}function Xy(t,e,n,r,i){const s=_N(e,n,r,i);if(k(s)){yc(t,s,t.id(),"thud"),r.kind===We.PLAYER?yc(t,t.id(),s,"touch"):r.collision===He.ISBULLET?yc(t,t.id(),s,"shot"):yc(t,t.id(),s,"bump");const o=vn(e,s);return(s.destructible??(o==null?void 0:o.destructible))&&jN(e,n,s,i),!1}return!0}function Zy(t,e,n){if(!Ls(O.element))return 0;const[r,i]=Y(e,0,[V.DIR,V.MAYBE_KIND]),s=i??["bullet"],o=EN(O.book,O.board,s,{x:O.element.x,y:O.element.y});if(k(o)){o.arg=n,o.collision=He.ISBULLET,o.destructible=1,o.stepx=r.x-O.element.x,o.stepy=r.y-O.element.y;const a=vn(O.book,o),c=o.code??(a==null?void 0:a.code)??"";L_(O.book,O.board,o,c,1),o.x===O.element.x&&o.y===O.element.y?o.headless=!0:t.bucket(o.id)}return t.yield(),0}const zN=gr().command("change",(t,e)=>{if(!k(O.book)||!k(O.board))return 0;const[n,r]=Y(e,0,[V.KIND,V.KIND]);hc(O.book,O.board);const i=la(n)??"",s=Ms(O.board,i),o=Xp(s,n),a=la(r),c=Vp(r),u=Kp(r);return o.forEach(l=>{if(ts(O.book,l)===a)k(c)&&(l.color=c),k(u)&&(l.bg=u);else{if(k(l.id)&&(co(O.book,O.board,l),!fc(O.book,l,O.timestamp)))return;Ls(l)&&Eh(O.book,O.board,r,l)}}),0}).command("put",(t,e)=>{if(!k(O.book)||!k(O.board))return 0;const[n,r]=Y(e,0,[V.DIR,V.KIND]);return hc(O.book,O.board),Eh(O.book,O.board,r,n),0}).command("shootwith",(t,e)=>{const[n,r]=Y(e,0,[V.ANY]);return Zy(t,e.slice(r),n)}).command("shoot",Zy).command("throwstar",()=>0),WN=navigator.userAgent.includes("Mac")?"cmd":"ctrl",Xr="$dkpurple",GN="$196",HN="$205";function on(t,e){return`$${t}${e}$blue`}function Jy(t,e){return`$${t}${e}$ondkblue`}function Qe(t,e){In(t,e)}function VN(t,e){const n=GN.repeat(e);Qe(t,`${Xr}${n}`)}function Ih(t,e){const n=HN.repeat(e);Qe(t,`${Xr}${n}`)}function lo(t,e){Qe(t,`${Xr} ${" ".repeat(e.length)} `),VN(t,e.length+2),Qe(t,`${Xr} $white${e} `),Ih(t,e.length+2)}function Tr(t,e){Qe(t,`${Xr} ${" ".repeat(e.length)} `),Qe(t,`${Xr} $gray${e} `),Ih(t,e.length+2)}function De(t,e,n){Qe(t,`${Xr} $white${e} $blue${n}`)}function $e(t,e){Qe(t,`${Xr}$blue${e}`)}function ns(t=""){zl("cli",t,O.player)}const KN=gr().command("send",(t,e)=>{const[n,r]=Y(e,0,[V.STRING,V.ANY]);switch(n){case"helpmenu":lo("cli","H E L P"),De("cli","#help controls","zss controls and inputs"),Qe("cli","!helpcontrols;read help controls"),Qe("cli",""),De("cli","#help text","text formatting"),Qe("cli","!helptext;read help text"),Qe("cli",""),De("cli","#help developer","developer commands"),Qe("cli","!helpdeveloper;read help developer"),Qe("cli",""),De("cli","#help player","player settings"),Qe("cli","!helpplayer;read help player"),Tr("cli","keyboard input"),De("cli","?","open console"),De("cli","esc","close console"),De("cli","tab","move console"),De("cli","up / down arrow keys","navigate console items"),De("cli","left / right arrow keys","change console items"),De("cli","enter","interact with console items"),De("cli","alt + arrow keys","skip words and console lines"),De("cli",`${WN} + up / down arrow keys`,"input history");break;case"helpcontrols":lo("cli","zss controls and inputs"),Tr("cli","keyboard input"),De("cli","arrow keys","move"),De("cli","shift + arrow keys","shoot"),De("cli","enter","ok / accept"),De("cli","escape","cancel / close"),De("cli","tab","menu / action"),Tr("cli","mouse input"),$e("cli","todo ???"),Tr("cli","controller input"),De("cli","left stick","move"),De("cli","right stick","aim"),De("cli","a","ok / accept"),De("cli","b","cancel / close"),De("cli","y","menu / action"),De("cli","x","shoot"),De("cli","triggers","shoot");break;case"helptext":lo("cli","text formatting"),Tr("cli","typography"),$e("cli","plain text"),$e("cli","$centering text"),$e("cli",'"\\"@quoted strings for special chars\\""'),$e("cli","$$0-255 for ascii chars $159$176$240"),$e("cli",`use color names like ${on("red","$$red")} to change foreground color`),$e("cli",`use color names like ${Jy("ongreen","$$ongreen")} to change background color`),$e("cli",`use clear ${Jy("onclear","to change background to")} transparent`),Tr("cli","hyperlinks"),$e("cli",`${on("white",'"!hotkey"')} message shortcut;${on("gray","Label")}`),$e("cli",`${on("white",'"!range"')} flag [labelmin] [labelmax];${on("gray","Input Label")}`),$e("cli",`${on("white",'"!select"')} flag ...list of values;${on("gray","Input Label")}`),$e("cli",`${on("white",'"!number"')} flag [minvalue] [maxvalue];${on("gray","Input Label")}`),$e("cli",`${on("white",'"!text"')} flag;${on("gray","Input Label")}`),$e("cli",`${on("white",'"!copyit"')} flag;${on("gray","Input Label")}`);break;case"helpdeveloper":lo("cli","developer commands"),De("cli","#books","list books in memory"),De("cli","#pages","list pages in opened book"),De("cli","@[pagetype:]page name","create & edit a new codepage in the currently opened book"),De("cli","#trash","list books and pages from open book you can delete"),De("cli","#save","flush state to register");break;case"helpplayer":lo("cli","player settings"),$e("cli","todo");break;default:In("$2",`${n} ${r??""}`);break}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(xt),s=i.join(" ");switch(Pe(r)){case _n(he.LOADER):n=Ti(We.CONTENT,s,Re.LOADER);break;default:n=Ti(We.CONTENT,[r,...i].join(" "),Re.OBJECT);break;case _n(he.BOARD):n=Ti(We.CONTENT,s,Re.BOARD);break;case _n(he.OBJECT):n=Ti(We.CONTENT,s,Re.OBJECT);break;case _n(he.TERRAIN):n=Ti(We.CONTENT,s,Re.TERRAIN);break;case _n(he.CHARSET):n=Ti(We.CONTENT,s,Re.CHARSET);break;case _n(he.PALETTE):n=Ti(We.CONTENT,s,Re.PALETTE);break}return k(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(xt).join(" ");return In("$2",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=xt(n),s=r.map(xt).join(" ");return In("$2",`!${s};${i}`),0}).command("dev",()=>(ns(),ck("cli",O.player),0)).command("share",()=>(ns(),lk("cli",O.player),0)).command("bookcreate",(t,e)=>{const[n]=Y(e,0,[V.MAYBE_STRING]),r=O_(n);return k(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=Y(e,0,[V.STRING]),r=Jr(n);return k(r)?($e("cli",`opened [book] ${r.name}`),Rc(We.MAIN,r.id),t.command("pages")):Bt("cli","bookopen",`book ${n} not found`,O.player),0}).command("booktrash",(t,e)=>{const[n]=Y(e,0,[V.STRING]),r=Gt(We.MAIN),i=Jr(n);return k(i)&&(r===i&&Rc(We.MAIN,""),vM(n),$e("cli",`trashed [book] ${i.name}`),ns(),t.command("pages")),0}).command("pageopen",(t,e)=>{const[n]=Y(e,0,[V.STRING]),r=ir(We.MAIN);if(!k(r))return 0;const i=vi(r,n);if(k(i)){const s=Sr(i),o=ac(i);$e("cli",`opened [${o}] ${s}`),_p(gp(r.id,i.id),i.code);const a=ac(i);_k("cli",r.id,i.id,a,`${s} - ${r.name}`,O.player)}else Bt("cli","pageopen",`page ${n} not found`,O.player);return 0}).command("pagetrash",(t,e)=>{const[n]=Y(e,0,[V.STRING]),r=ir(We.MAIN),i=dN(r,n);if(k(n)){const s=Sr(i),o=ac(i);$e("cli",`trashed [${o}] ${s}`),ns(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(xt).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{Tr("cli","books");const t=Gt(We.MAIN);De("cli","main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=Gt(We.CONTENT);De("cli","content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),Ih("cli",7);const n=Tc();return n.length?n.forEach(r=>{Qe("cli",`!bookopen ${r.id};${r.name}`)}):$e("cli","no books found"),Qe("cli","!bookcreate;create a new book"),0}).command("pages",()=>{Tr("cli","pages");const t=ir(We.MAIN);return k(t)&&(De("cli","main",`${t.name} $GREEN${t.id}`),t.pages.length?t.pages.forEach(e=>{const n=Sr(e),r=ac(e);Qe("cli",`!pageopen ${e.id};[${r}] ${n}`)}):(Qe("cli",""),$e("cli","no pages found"),$e("cli","use @ to create a page"),$e("cli","@board name of board"),$e("cli","@object name of object"),$e("cli","@terrain name of terrain"),$e("cli","You can omit the type and it will default to object"),$e("cli","@object name of object"),$e("cli","@name of object"))),0}).command("trash",()=>{Tr("cli","$REDTRASH"),$e("cli","books");const t=Tc();t.length&&(t.forEach(n=>{Qe("cli",`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Qe("cli",""));const e=Gt(We.MAIN);return k(e)&&($e("cli",`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=Sr(n);Qe("cli",`!pagetrash ${n.id};$REDTRASH ${r}`)}),Qe("cli","")),0}).command("save",()=>(ns(),0)).command("savewith",(t,e)=>{const[n]=Y(e,0,[V.STRING]);return ns(n),0}).command("nuke",()=>(uk("cli",O.player),0)).command("joincode",()=>(sk("cli",O.player),0)).command("chat",(t,e)=>{const[n,r]=Y(e,0,[V.MAYBE_STRING]);switch(Pe(n??"")){case"connect":{const[i]=Y(e,r,[V.STRING]);ek("cli",i,O.player);break}case"close":tk("cli",O.player);break}return 0}).command("broadcast",(t,e)=>{const[n,r]=Y(e,0,[V.MAYBE_STRING]);switch(Pe(n??"")){default:case"create":ZE("cli",O.player);break;case"close":JE("cli",O.player);break;case"start":{const[i]=Y(e,r,[V.STRING]);YE("cli",i,O.player);break}case"stop":QE("cli",O.player);break}return 0});function qN(t){const e=Uy[t];if(k(e))return e;const n=Fy[t];if(k(n))return n;const r=pc[t];if(k(r))return r;const i=$p[t];if(k(i))return i}const XN=gr({get(t,e){const n=qN(e);return k(n)?[!0,n]:[!1,void 0]}}),ZN=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Yy=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),JN=["NORTH","SOUTH","WEST","EAST"];function YN(t){const e=ss(t);if(Ee(e.inputcurrent)||(e.inputcurrent=0),ze(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Ft.NONE,i=0]=n??[Ft.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&Lk?1:0,e.inputctrl=i&Mk?1:0,e.inputshift=i&Uk?1:0,r){case Ft.MOVE_UP:case Ft.MOVE_DOWN:case Ft.MOVE_LEFT:case Ft.MOVE_RIGHT:e.inputmove=[JN[r-Ft.MOVE_UP]];break;case Ft.OK_BUTTON:e.inputok=1;break;case Ft.CANCEL_BUTTON:e.inputcancel=1;break;case Ft.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Ft.NONE&&o!==r}),e}const QN=gr({get(t,e){var s,o;if(O.isplayer&&ZN.has(e)){const a=YN(((s=O.element)==null?void 0:s.id)??"")[e];return[k(a),a]}const n=(o=O.element)==null?void 0:o[e];if(k(n)||Yy.has(e))return[!0,n];const i=ss(O.player)[e];return[k(i),i]},set(t,e,n){var s;const r=(s=O.element)==null?void 0:s[e];if(k(r)||Yy.has(e))return k(O.element)&&(O.element[e]=n),[!0,n];const i=ss(O.player);return i[e]=n,[!0,n]},everytick(t){var e,n;(e=O.element)!=null&&e.headless&&t.command("die"),k((n=O.element)==null?void 0:n.x)&&k(O.element.y)&&k(O.element.stepx)&&k(O.element.stepy)&&Xy(t,O.book,O.board,O.element,{x:O.element.x+O.element.stepx,y:O.element.y+O.element.stepy})===!1&&(O.element.stepx=0,O.element.stepy=0,pN(O.book,O.element,"destructible")&&(O.element.headless=!0,fc(O.book,O.element,O.timestamp)))}}).command("become",(t,e)=>{var i,s;const n={x:((i=O.element)==null?void 0:i.x)??0,y:((s=O.element)==null?void 0:s.y)??0},[r]=Y(e,0,[V.KIND]);return hc(O.book,O.board),co(O.book,O.board,O.element),fc(O.book,O.element,O.timestamp)&&Eh(O.book,O.board,r,n),t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=Y(e,0,[V.NUMBER]);return k(O.element)&&(O.element.char=n),0}).command("color",(t,e)=>{const[n]=Y(e,0,[V.COLOR]);return k(O.element)&&k(n)&&gc(O.element,n),0}).command("go",(t,e)=>{if(k(O.element)){const[n]=Y(e,0,[V.DIR]);if(Xy(t,O.book,O.board,O.element,n),t.yield(),O.element.x===n.x&&O.element.y===n.y)return 0}return 1}).command("try",(t,e)=>{const[,n]=Y(e,0,[V.DIR]);return t.command("go",...e)&&n<e.length&&t.command(...e.slice(n)),0}).command("walk",(t,e)=>{if(!k(O.element))return 0;const[n]=Y(e,0,[V.DIR]),r=O.element.x??0,i=O.element.y??0;return O.element.stepx=n.x-r,O.element.stepy=n.y-i,0}),eL=gr().command("clear",(t,e)=>(e.forEach(n=>t.set(xt(n),0)),0)).command("set",(t,e)=>{const[n,r]=Y(e,0,[V.STRING,V.ANY]);return t.set(n,r),0}).command("take",(t,e)=>{const[n,r,i]=Y(e,0,[V.STRING,V.MAYBE_NUMBER]),s=t.get(n),o=r??1;if(!Ee(s))return 1;const a=s-o;return a<0?(i<e.length&&t.command(...e.slice(i)),1):(t.set(n,a),0)}).command("give",(t,e)=>{const[n,r,i]=Y(e,0,[V.STRING,V.MAYBE_NUMBER]),s=t.get(n),o=Ee(s)?s:0,a=r??1;if(!Ee(a))return 0;const c=s===void 0?1:0;return c&&i<e.length&&t.command(...e.slice(i)),t.set(n,o+a),c}),tL=gr({get(){return[!1,void 0]},set(t,e,n){return zk(t,e,n),[!1,void 0]},tick(){var e;const t=((e=O.element)==null?void 0:e.name)??"scroll";Hl(O.player,"scroll",ln.SCROLL,void 0,t)},everytick(){const t=Wk(O.player);if(t&&k(O.element)){O.element.tickertext=t,O.element.tickertime=O.timestamp;const e=_h(O.book,O.element,1,Te.WHITE,Te.ONCLEAR);In(`$${Te[e.color]}$${e.char}`,t)}}}).command("send",(t,e)=>{var l,h;const[n,r]=Y(e,0,[V.STRING,V.ANY]),[i,s]=n.split(":"),o=k(s)?i:"self",a=s??i;function c(d){d.forEach(f=>{k(f.id)&&t.send(f.id,a,r)})}const u=Pe(o);switch(u){case"all":for(const d of Object.keys(((l=O.board)==null?void 0:l.objects)??{}))t.send(d,a,r);break;case"self":t.message({id:at(),sender:t.id(),target:a,data:r});break;case"others":for(const d of Object.keys(((h=O.board)==null?void 0:h.objects)??{}))d!==t.id()&&t.send(d,a,r);break;default:{c(eu(O.board,[o]));const d=t.get(u);ze(d)?c(eu(O.board,d)):c(eu(O.board,[d]));break}}return 0}).command("stat",(t,e)=>{const n=J0(e.map(xt));switch(n.type){case he.OBJECT:k(O.element)&&(O.element.name=n.values.join(" "));break}return 0}).command("text",(t,e)=>{const n=e.map(xt).join("");return Gk(O.player,n),0}).command("hyperlink",(t,e)=>{const[n,r,...i]=e,s=xt(n),o=xt(r);return Hk(O.player,t,s,o,i),0}).command("gadget",(t,e)=>{const[n]=Y(e,0,[V.STRING]),r=Ck[Pe(n)];if(r===ln.SCROLL){const[i,s]=Y(e,1,[V.MAYBE_STRING,V.MAYBE_NUMBER]);Hl(O.player,n,r,s,i)}else if(k(r)){const[i,s]=Y(e,1,[V.MAYBE_NUMBER,V.MAYBE_STRING]);Hl(O.player,n,r,i,s)}return 0}),nL=gr().command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=Y(e,0,[V.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(xt(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(xt(e[0])),0)).command("cycle",(t,e)=>{if(k(O.element)){const[n]=Y(e,0,[V.NUMBER]);O.element.cycle=Gn(Math.round(n),1,255)}return 0}).command("die",t=>{var e;return(e=O.element)!=null&&e.headless&&co(O.book,O.board,O.element),fc(O.book,O.element,O.timestamp),t.endofprogram(),0}).command("endgame",()=>(wk("element",O.player),0)).command("run",(t,e)=>{const[n]=Y(e,0,[V.STRING]);return Ic(n),0}).command("runwith",(t,e)=>{const[n,r]=Y(e,0,[V.ANY,V.STRING]);return t.set("arg",n),Ic(r),0}),Qy={},e_={};function rL(t){return Qy[t]}function _c(t){return e_[t]}function iL(t,e){const n=Gt(We.MAIN);if(!k(n))return;const r=Cy(n,Re.LOADER).filter(i=>!!Qi(i)[t]);for(let i=0;i<r.length;++i){const s=at();Qy[s]=t,e_[s]=e,AM(s,r[i].code)}}function t_(t,e){if(!k(t))return;const n=Pe(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const sL=(t,e)=>{const n=_c(t.id());if(!k(n))return 0;const[r,i]=Y(e,0,[V.STRING]),s=Pe(r);switch(s){case"seek":{const[o]=Y(e,i,[V.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=Y(e,i,[V.STRING]);t.set(o,t_(n,s));break}case"text":{const[o,a]=Y(e,i,[V.STRING,V.STRING]),c=t_(n,o);if(Ee(c)&&ke(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);t.set(a,h),n.cursor+=c}break}}return 0},oL=(t,e)=>{const n=_c(t.id());if(!k(n))return 0;const[r,i]=Y(e,0,[V.STRING]);switch(Pe(r)){case"seek":{const[o]=Y(e,i,[V.NUMBER]);n.cursor=Gn(o,0,n.lines.length-1);break}case"line":n.cursor=Gn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o);if(k(c)){let u=1;for(let l=i;l<e.length;){const[h,d]=Y(e,l,[V.STRING]);k(c[u])&&t.set(h,c[u]),++u,l=d}}break}}return 0},aL=gr({get(t,e){switch(rL(t.id())){case"chat":{const r=_c(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"binary":{const r=_c(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=Y(e,0,[V.STRING,V.ANY]);return t.message({id:at(),sender:t.id(),target:n,data:r}),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(xt).join(" ");return In("$2",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=xt(n),s=r.map(xt).join(" ");return In("$2",`!${s};${i}`),0}).command("load",(t,e)=>{const n=e.map(xt).join(" "),r=t.get(n)??n;return ir(We.CONTENT,r),0}).command("reload",(t,e)=>{const n=e.map(xt).join(" "),r=t.get(n)??n,i=ir(We.CONTENT,r);return i.pages=[],0}).command("bin",sL).command("txt",oL);var uo=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.CODE_PAGE=3]="CODE_PAGE",t))(uo||{});const cL={audio:$N,board:zN,cli:KN,const:XN,element:QN,flags:eL,gadget:tL,lifecycle:nL,loader:aL},xh=["const","flags","audio","board","lifecycle","element"],lL={0:[],1:["cli",...xh],2:["loader",...xh],3:["gadget",...xh]},uL={0:new Map,1:new Map,2:new Map,3:new Map};function ho(t){return(lL[t]??[]).map(n=>cL[n]).filter(k)}function hL(t,e){const n=uL[t];if(!n.has(e)){let r;const i=ho(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!k(r));++s);n.set(e,r)}return n.get(e)}function fL(t,e,n){const r=ho(t);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(e,n);if(s)return[s,o]}return[!1,void 0]}function dL(t,e,n,r){const i=ho(t);for(let s=0;s<i.length;++s){const[o]=i[s].set(e,n,r);if(o)return[o,r]}return[!1,void 0]}function pL(t,e){const n=ho(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function n_(t,e){const n=ho(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var r_={},i_={},s_={};const o_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");s_.encode=function(t){if(0<=t&&t<o_.length)return o_[t];throw new TypeError("Must be between 0 and 63: "+t)};const mL=s_,a_=5,c_=1<<a_,gL=c_-1,yL=c_;function _L(t){return t<0?(-t<<1)+1:(t<<1)+0}i_.encode=function(e){let n="",r,i=_L(e);do r=i&gL,i>>>=a_,i>0&&(r|=yL),n+=mL.encode(r);while(i>0);return n};var fo={};(function(t){function e(I,R,B){if(R in I)return I[R];if(arguments.length===3)return B;throw new Error('"'+R+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(I){const R=I.match(n);return R?{scheme:R[1],auth:R[2],host:R[3],port:R[4],path:R[5]}:null}t.urlParse=i;function s(I){let R="";return I.scheme&&(R+=I.scheme+":"),R+="//",I.auth&&(R+=I.auth+"@"),I.host&&(R+=I.host),I.port&&(R+=":"+I.port),I.path&&(R+=I.path),R}t.urlGenerate=s;const o=32;function a(I){const R=[];return function(B){for(let q=0;q<R.length;q++)if(R[q].input===B){const ie=R[0];return R[0]=R[q],R[q]=ie,R[0].result}const L=I(B);return R.unshift({input:B,result:L}),R.length>o&&R.pop(),L}}const c=a(function(R){let B=R;const L=i(R);if(L){if(!L.path)return R;B=L.path}const q=t.isAbsolute(B),ie=[];let x=0,v=0;for(;;)if(x=v,v=B.indexOf("/",x),v===-1){ie.push(B.slice(x));break}else for(ie.push(B.slice(x,v));v<B.length&&B[v]==="/";)v++;let g=0;for(v=ie.length-1;v>=0;v--){const N=ie[v];N==="."?ie.splice(v,1):N===".."?g++:g>0&&(N===""?(ie.splice(v+1,g),g=0):(ie.splice(v,2),g--))}return B=ie.join("/"),B===""&&(B=q?"/":"."),L?(L.path=B,s(L)):B});t.normalize=c;function u(I,R){I===""&&(I="."),R===""&&(R=".");const B=i(R),L=i(I);if(L&&(I=L.path||"/"),B&&!B.scheme)return L&&(B.scheme=L.scheme),s(B);if(B||R.match(r))return R;if(L&&!L.host&&!L.path)return L.host=R,s(L);const q=R.charAt(0)==="/"?R:c(I.replace(/\/+$/,"")+"/"+R);return L?(L.path=q,s(L)):q}t.join=u,t.isAbsolute=function(I){return I.charAt(0)==="/"||n.test(I)};function l(I,R){I===""&&(I="."),I=I.replace(/\/$/,"");let B=0;for(;R.indexOf(I+"/")!==0;){const L=I.lastIndexOf("/");if(L<0||(I=I.slice(0,L),I.match(/^([^\/]+:\/)?\/*$/)))return R;++B}return Array(B+1).join("../")+R.substr(I.length+1)}t.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function d(I){return I}function f(I){return m(I)?"$"+I:I}t.toSetString=h?d:f;function p(I){return m(I)?I.slice(1):I}t.fromSetString=h?d:p;function m(I){if(!I)return!1;const R=I.length;if(R<9||I.charCodeAt(R-1)!==95||I.charCodeAt(R-2)!==95||I.charCodeAt(R-3)!==111||I.charCodeAt(R-4)!==116||I.charCodeAt(R-5)!==111||I.charCodeAt(R-6)!==114||I.charCodeAt(R-7)!==112||I.charCodeAt(R-8)!==95||I.charCodeAt(R-9)!==95)return!1;for(let B=R-10;B>=0;B--)if(I.charCodeAt(B)!==36)return!1;return!0}function b(I,R,B){let L=w(I.source,R.source);return L!==0||(L=I.originalLine-R.originalLine,L!==0)||(L=I.originalColumn-R.originalColumn,L!==0||B)||(L=I.generatedColumn-R.generatedColumn,L!==0)||(L=I.generatedLine-R.generatedLine,L!==0)?L:w(I.name,R.name)}t.compareByOriginalPositions=b;function _(I,R,B){let L=I.generatedLine-R.generatedLine;return L!==0||(L=I.generatedColumn-R.generatedColumn,L!==0||B)||(L=w(I.source,R.source),L!==0)||(L=I.originalLine-R.originalLine,L!==0)||(L=I.originalColumn-R.originalColumn,L!==0)?L:w(I.name,R.name)}t.compareByGeneratedPositionsDeflated=_;function w(I,R){return I===R?0:I===null?1:R===null?-1:I>R?1:-1}function E(I,R){let B=I.generatedLine-R.generatedLine;return B!==0||(B=I.generatedColumn-R.generatedColumn,B!==0)||(B=w(I.source,R.source),B!==0)||(B=I.originalLine-R.originalLine,B!==0)||(B=I.originalColumn-R.originalColumn,B!==0)?B:w(I.name,R.name)}t.compareByGeneratedPositionsInflated=E;function S(I){return JSON.parse(I.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=S;function C(I,R,B){if(R=R||"",I&&(I[I.length-1]!=="/"&&R[0]!=="/"&&(I+="/"),R=I+R),B){const L=i(B);if(!L)throw new Error("sourceMapURL could not be parsed");if(L.path){const q=L.path.lastIndexOf("/");q>=0&&(L.path=L.path.substring(0,q+1))}R=u(s(L),R)}return c(R)}t.computeSourceURL=C})(fo);var Oh={};let bL=class j_{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new j_;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};Oh.ArraySet=bL;var l_={};const u_=fo;function wL(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||u_.compareByGeneratedPositionsInflated(t,e)<=0}let vL=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){wL(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(u_.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};l_.MappingList=vL;const po=i_,ft=fo,bc=Oh.ArraySet,EL=l_.MappingList;let h_=class z_{constructor(e){e||(e={}),this._file=ft.getArg(e,"file",null),this._sourceRoot=ft.getArg(e,"sourceRoot",null),this._skipValidation=ft.getArg(e,"skipValidation",!1),this._sources=new bc,this._names=new bc,this._mappings=new EL,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new z_({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=ft.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=ft.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=ft.getArg(e,"generated"),r=ft.getArg(e,"original",null);let i=ft.getArg(e,"source",null),s=ft.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=ft.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ft.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[ft.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=ft.relative(s,i));const o=this._mappings.toArray().length>0?new bc:this._sources,a=new bc;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=ft.join(r,c.source)),s!=null&&(c.source=ft.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const u=e.sourceContentFor(c);u!=null&&(r!=null&&(c=ft.join(r,c)),s!=null&&(c=ft.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const d=this._mappings.toArray();for(let f=0,p=d.length;f<p;f++){if(u=d[f],c="",u.generatedLine!==n)for(e=0;u.generatedLine!==n;)c+=";",n++;else if(f>0){if(!ft.compareByGeneratedPositionsInflated(u,d[f-1]))continue;c+=","}c+=po.encode(u.generatedColumn-e),e=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=po.encode(h-o),o=h,c+=po.encode(u.originalLine-1-i),i=u.originalLine-1,c+=po.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=po.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=ft.relative(n,r));const i=ft.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};h_.prototype._version=3,r_.SourceMapGenerator=h_;var f_={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(f_);var mo={exports:{}},kL={},SL=Object.freeze({__proto__:null,default:kL}),d_=W_(SL);if((function(){return typeof window<"u"&&this===window}).call()){let t=null;mo.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},mo.exports.initialize=e=>t=e}else{const t=d_,e=d_;mo.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},mo.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var p_=mo.exports;const AL=p_;function TL(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let go=null;var RL=function(){if(go)return go;const e=[];return go=AL().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,d){const f=new TL;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=u+1,f.originalColumn=l,h&&(f.name=d)),e[e.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw go=null,n}),go};const fe=fo,Ch=f_,wc=Oh.ArraySet,IL=p_,xL=RL,Nh=Symbol("smcInternal");class lt{constructor(e,n){return e==Nh?Promise.resolve(this):CL(e,n)}static initialize(e){IL.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return NL(e,n)}static async with(e,n,r){const i=await new lt(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}lt.prototype._version=3,lt.GENERATED_ORDER=1,lt.ORIGINAL_ORDER=2,lt.GREATEST_LOWER_BOUND=1,lt.LEAST_UPPER_BOUND=2;class yo extends lt{constructor(e,n){return super(Nh).then(r=>{let i=e;typeof e=="string"&&(i=fe.parseSourceMapInput(e));const s=fe.getArg(i,"version");let o=fe.getArg(i,"sources");const a=fe.getArg(i,"names",[]);let c=fe.getArg(i,"sourceRoot",null);const u=fe.getArg(i,"sourcesContent",null),l=fe.getArg(i,"mappings"),h=fe.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=fe.normalize(c)),o=o.map(String).map(fe.normalize).map(function(d){return c&&fe.isAbsolute(c)&&fe.isAbsolute(d)?fe.relative(c,d):d}),r._names=wc.fromArray(a.map(String),!0),r._sources=wc.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return fe.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,xL().then(d=>(r._wasm=d,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=fe.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new yo(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||lt.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=fe.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case lt.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case lt.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=fe.getArg(e,"source");const r=fe.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:fe.getArg(e,"line"),generatedColumn:fe.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=fe.getArg(e,"bias",lt.GREATEST_LOWER_BOUND);r==null&&(r=lt.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=fe.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=fe.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=fe.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:fe.getArg(i,"originalLine",null),column:fe.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=fe.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=fe.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=fe.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:fe.getArg(e,"line"),originalColumn:fe.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=fe.getArg(e,"bias",lt.GREATEST_LOWER_BOUND);i==null&&(i=lt.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:fe.getArg(s,"generatedLine",null),column:fe.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}yo.prototype.consumer=lt;class OL extends lt{constructor(e,n){return super(Nh).then(r=>{let i=e;typeof e=="string"&&(i=fe.parseSourceMapInput(e));const s=fe.getArg(i,"version"),o=fe.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new wc,r._names=new wc,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=fe.getArg(c,"offset"),l=fe.getArg(u,"line"),h=fe.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new lt(fe.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(fe.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(fe.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:fe.getArg(e,"line"),generatedColumn:fe.getArg(e,"column")},r=Ch.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(fe.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=fe.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const d={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(e,n,r){const i=n||null,s=r||lt.GENERATED_ORDER;let o;switch(s){case lt.GENERATED_ORDER:o=this._generatedMappings;break;case lt.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=fe.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return Ch.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=fe.getArg(e,"line"),r={source:fe.getArg(e,"source"),originalLine:n,originalColumn:fe.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",fe.compareByOriginalPositions,Ch.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:fe.getArg(o,"generatedLine",null),column:fe.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:fe.getArg(o,"generatedLine",null),column:fe.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function CL(t,e){let n=t;typeof t=="string"&&(n=fe.parseSourceMapInput(t));const r=n.sections!=null?new OL(n,e):new yo(n,e);return Promise.resolve(r)}function NL(t,e){return yo.fromSourceMap(t,e)}var m_={};const LL=r_.SourceMapGenerator,vc=fo,ML=/(\r?\n)/,UL=10,rs="$$$isSourceNode$$$";let PL=class Kh{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[rs]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new Kh,s=e.split(ML);let o=0;const a=function(){const f=m(),p=m()||"";return f+p;function m(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(f){if(l!==null)if(c<f.generatedLine)d(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,f.generatedColumn-u);s[o]=h.substr(f.generatedColumn-u),u=f.generatedColumn,d(l,p),l=f;return}for(;c<f.generatedLine;)i.add(a()),c++;u<f.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,f.generatedColumn)),s[o]=h.substr(f.generatedColumn),u=f.generatedColumn),l=f},this),o<s.length&&(l&&d(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=vc.join(r,f)),i.setSourceContent(f,p))}),i;function d(f,p){if(f===null||f.source===void 0)i.add(p);else{const m=r?vc.join(r,f.source):f.source;i.add(new Kh(f.originalLine,f.originalColumn,m,p,f.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[rs]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[rs]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[rs]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[rs]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[vc.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][rs]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(vc.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new LL(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,d=u.length;h<d;h++)u.charCodeAt(h)===UL?(n.line++,n.column=0,h+1===d?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};m_.SourceNode=PL;var DL=m_.SourceNode;const BL=Jl(32,126).map(t=>String.fromCharCode(t)),FL=rn({name:"Whitespace",pattern:/ +/}),$L=rn({name:"WhitespaceSkipped",pattern:/ +/,group:vt.SKIPPED}),Lh=rn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),g_=rn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:BL}),Mh=rn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Uh=rn({name:"EscapedDollar",pattern:"$$"}),Ph=rn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),Dh=rn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),y_=rn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function jL(t,e=""){return rn({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const __=Object.keys(pc).map(t=>jL(`\\$(${t})`,t)),zL=[FL,Lh,...__,Mh,g_,Dh,Uh,y_,Ph],WL=new vt(zL,{skipValidations:!Wn,ensureOptimizations:Wn}),GL=new vt([$L,Lh,...__,Mh,g_,Dh,Uh,y_,Ph],{skipValidations:!Wn,ensureOptimizations:Wn});function Bh(t,e=!1){return e?GL.tokenize(t):WL.tokenize(t)}function b_(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function w_(t){t.active={...t.reset}}function v_(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const u=e.x+e.y*e.width;e.char[u]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[u]=e.active.color),e.active.bg!==void 0&&(e.bg[u]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case Uh:s("$");break;case Dh:if(e.measureonly!==!0&&i()){const u=e.x+e.y*e.width;e.char[u]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[u]=e.active.color),e.active.bg!==void 0&&(e.bg[u]=e.active.bg)}r();break;case Mh:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case Lh:{e.x=e.active.leftedge??0,++e.y;break}default:{const u=c.tokenType.name,l=pc[u],h=SN(Te[l]),d=AN(Te[l]);l==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):k(h)?e.active.color=h:k(d)?e.active.bg=d:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(k(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){w_(e);const u=String.fromCharCode(e.writefullwidth).repeat(c),l=e.x+e.y*e.width;qL(l,l+u.length,e.active.color,e.active.bg,e),KL(l,u,e)}}}function HL(t,e,n){const r=Bh(t);r.tokens&&(v_(r.tokens,e),w_(e))}function VL(t,e,n){const r=Bh(t);if(!r.tokens)return;const i=b_(e,n,Te.WHITE,Te.BLACK);return i.measureonly=!0,v_(r.tokens,i),i.x>0&&++i.y,i}function KL(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++)}function qL(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r}let E_=0;const k_=Wn,XL=["Command","lines"];class ZL extends bC{constructor(){super(X0,{traceInitPerf:Wn,skipValidations:!Wn,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});ye(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));ye(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(to)}])}));ye(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));ye(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));ye(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));ye(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(E0)}));ye(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Zu)}));ye(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(w0)}])}));ye(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(v0)}));ye(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(k0),this.SUBRULE(this.words),this.CONSUME(S0)}));ye(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Ji),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));ye(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));ye(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));ye(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_debugger)},{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));ye(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(nh),this.SUBRULE(this.words)}));ye(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(D0),this.SUBRULE(this.words)}));ye(this,"command_debugger",this.RULED("command_debugger",()=>{this.CONSUME(j0)}));ye(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(rh),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));ye(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ya),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(to)),this.CONSUME4(Ji),this.CONSUME4(ih)}}])}));ye(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ya),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Ji),this.CONSUME(ih)}}])}));ye(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ya),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));ye(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Ji),this.CONSUME(sh),this.CONSUME(rh),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));ye(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Ji),this.CONSUME(sh),this.OPTION(()=>this.SUBRULE(this.command_fork))}));ye(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(z0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(W0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(G0),this.SUBRULE(this.words)}));ye(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(H0),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));ye(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(V0)}));ye(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(K0)}));ye(this,"command_play",this.RULED("command_play",()=>{this.CONSUME($0)}));ye(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Ju),this.SUBRULE2(this.and_test)})}));ye(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Qu),this.SUBRULE2(this.not_test)})}));ye(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Yu),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));ye(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));ye(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(R0)},{ALT:()=>this.CONSUME(I0)},{ALT:()=>this.CONSUME(x0)},{ALT:()=>this.CONSUME(O0)},{ALT:()=>this.CONSUME(C0)},{ALT:()=>this.CONSUME(N0)}])}));ye(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Ju),this.SUBRULE2(this.and_test_value)})}));ye(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Qu),this.SUBRULE2(this.not_test_value)})}));ye(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Yu),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));ye(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));ye(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(eh)},{ALT:()=>this.CONSUME(th)}]),this.SUBRULE(this.term)}));ye(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));ye(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(M0)},{ALT:()=>this.CONSUME(nh)},{ALT:()=>this.CONSUME(U0)},{ALT:()=>this.CONSUME(P0)}]),this.SUBRULE(this.factor)}));ye(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(eh)},{ALT:()=>this.CONSUME(th)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));ye(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(L0),this.SUBRULE(this.factor)})}));ye(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));ye(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(A0)},{ALT:()=>this.CONSUME(zt)},{ALT:()=>this.CONSUME(T0)},{ALT:()=>{this.CONSUME(B0),this.SUBRULE(this.expr),this.CONSUME(F0)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=XL.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(E_++).toString().padStart(3),c=s?"font-weight: bold;":"";if(k_&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),k_&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),E_--},i)}}const is=new ZL;if(Xk){const t=is.getGAstProductions(),e=CC(t);console.info(e)}const JL=is.getBaseCstVisitorConstructor();var oe=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(oe||{}),ki=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(ki||{}),nr=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(nr||{}),Ec=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(Ec||{});function YL(t){return!!(t!=null&&t.tokenType)}function Rr(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class QL extends JL{constructor(){super();ye(this,"unique",0);Wn&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&YL(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:Rr(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:Rr(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:Rr(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:Rr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:Rr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,"if","",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=at(),i=at();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=at(),i=at();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,"if",r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=at(),i=at();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=at(),i=at(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=at(),i=at(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){return this.createcodenode(n,{type:22,words:this.go(n.words)})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=Rr(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=Rr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=Rr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(Rr(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const eM=new QL,Qt={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},kc="zss.js";function Le(t,e){return new DL(t.startLine??1,t.startColumn??1,kc,e)}function Fh(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function $h(t){return`'${Fh(t)}'`}function Sc(t){if(t.startsWith('"'))return Sc(t.replaceAll(/(^"|"$)/g,""));const e=Bh(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===Ph?`', api.get('${Fh(r.image.substring(1))}'), '`:Fh(r.image)).join("")}'].join('')`}function Si(t){return t.filter(e=>e!==void 0).map(Be)}function S_(t){return Le(t,"")}function tM(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function dt(t,e,n){return Le(t,[`api.${e}(`,...tM(n,", "),")"])}function nM(t){if(t.type===oe.COMPARE&&t.compare.type===oe.COMPARE_ITEM)switch(t.compare.method){case ki.IS_EQ:return dt(t,"isEq",[Be(t.lhs),Be(t.rhs)]);case ki.IS_NOT_EQ:return dt(t,"isNotEq",[Be(t.lhs),Be(t.rhs)]);case ki.IS_LESS_THAN:return dt(t,"isLessThan",[Be(t.lhs),Be(t.rhs)]);case ki.IS_GREATER_THAN:return dt(t,"isGreaterThan",[Be(t.lhs),Be(t.rhs)]);case ki.IS_LESS_THAN_OR_EQ:return dt(t,"isLessThanOrEq",[Be(t.lhs),Be(t.rhs)]);case ki.IS_GREATER_THAN_OR_EQ:return dt(t,"isGreaterThanOrEq",[Be(t.lhs),Be(t.rhs)])}return Le(t,"")}function Ai(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",Be(n),")"])}function A_(t,e,n){return t.prepend(`api.${e}(`),t.add([Be(n),")"])}function rM(t,e){if(t.type===oe.OPERATOR_ITEM)switch(t.operator){case nr.PLUS:return Ai(e,"opPlus",t.rhs);case nr.MINUS:return Ai(e,"opMinus",t.rhs);case nr.POWER:return Ai(e,"opPower",t.rhs);case nr.MULTIPLY:return Ai(e,"opMultiply",t.rhs);case nr.DIVIDE:return Ai(e,"opDivide",t.rhs);case nr.MOD_DIVIDE:return Ai(e,"opModDivide",t.rhs);case nr.FLOOR_DIVIDE:return Ai(e,"opFloorDivide",t.rhs);case nr.UNI_PLUS:return A_(e,"opUniPlus",t.rhs);case nr.UNI_MINUS:return A_(e,"opUniMinus",t.rhs)}return Le(t,"")}function iM(t){if(t.type===oe.OPERATOR){const e=t.lhs?Be(t.lhs):Le(t,"");return t.items.forEach(n=>rM(n,e)),e}return Le(t,"")}function Ac(t,e){return Le(t,[dt(t,"jump",[`${e}`]),"; continue;"])}function Ir(t){return Qt.linelookup[t??""]??-1}function jh(t,e){Qt.linelookup[t]=e}function _o(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case oe.WHILE:case oe.REPEAT:case oe.FOREACH:case oe.ELSE_IF:i.type===e&&(i.done=n);break;case oe.IF_BLOCK:case oe.IF_CHECK:i.type===e&&(i.skip=n);break;case oe.LINE:_o(i.stmts,e,n);break}}}function T_(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case oe.WHILE:case oe.REPEAT:case oe.FOREACH:case oe.ELSE_IF:i.type===e&&jh(i.done,n);break;case oe.IF_BLOCK:case oe.IF_CHECK:i.type===e&&jh(i.skip,n);break;case oe.LINE:T_(i.stmts,e,n);break}}}function Be(t){var e;switch(t.type){case oe.PROGRAM:return Le(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(Be).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${kc}`]);case oe.API:return Le(t,["  ",dt(t,t.method,Si(t.words)),`;
`]);case oe.LINE:return Le(t,[`case ${t.lineindex}:
`,...t.stmts.map(Be).flat(),`  break;
`]);case oe.MARK:return Le(t,`  // ${t.comment}
`);case oe.GOTO:{const n=Ir(t.id);return Le(t,["  ",Ac(t,n),`
`])}case oe.COUNT:return Le(t,`${t.index}`);case oe.LITERAL:switch(t.literal){case Ec.NUMBER:return Le(t,`${t.value}`);case Ec.STRING:return Le(t,$h(t.value));case Ec.TEMPLATE:return Le(t,Sc(t.value))}return S_(t);case oe.TEXT:return Le(t,["  ",dt(t,"text",[Sc(t.value)]),`;
`]);case oe.STAT:if(Qt.isfirststat){Qt.isfirststat=!1;const n=t.value.trim().split(" ").map($h);return Le(t,["  ",dt(t,"stat",n),`;
`])}return Le(t,`  // skipped ${t.value}
`);case oe.LABEL:{const n=Pe(t.name),r=t.active?"label":"comment";Qt.labels[n]||(Qt.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Qt.labels[n].push(i),Le(t,`  // ${i} '${n}' ${r}
`)}case oe.HYPERLINK:return Le(t,["  ",dt(t,"hyperlink",[Sc(t.text),...Si(t.link)]),`;
`]);case oe.MOVE:{const n=dt(t,"command",[$h("go"),Si(t.words)].flat());return t.wait?Le(t,["  if (",n,`) { continue; };
`]):Le(t,["  ",n,`;
`])}case oe.COMMAND:return Le(t,["  ",dt(t,"command",Si(t.words)),`;
`]);case oe.IF:{const n=((e=t.block)==null?void 0:e.type)===oe.IF_BLOCK?t.block:void 0;if(k(n)){_o([t.check],oe.IF_CHECK,n.skip);const r=Le(t,Be(t.check));return n.lines.forEach(i=>r.add(Be(i))),T_(n.altlines,oe.ELSE_IF,Ir(n.done)),n.altlines.forEach(i=>r.add(Be(i))),r}return Le(t,Be(t.check))}case oe.IF_CHECK:{const n=Ir(t.skip);return n===-1?Le(t,["  ",dt(t,t.method,Si(t.words)),`;
`]):Le(t,["  if (!",dt(t,t.method,Si(t.words)),") { ",Ac(t,n),` }
`])}case oe.ELSE_IF:case oe.ELSE:{const n=Le(t,"");return t.lines.forEach(r=>n.add(Be(r))),n}case oe.WHILE:{const n=Ir(t.loop),r=Ir(t.done),i=Le(t,"");return _o(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.REPEAT:{const n=Ir(t.loop),r=Ir(t.done),i=Le(t,"");return _o(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.WAITFOR:{const n=Le(t,"");return n.add(["  if (!",dt(t,"if",Si(t.words)),`) { api.i(${t.lineindex-1}); }
`]),n}case oe.FOREACH:{const n=Ir(t.loop),r=Ir(t.done),i=Le(t,"");return _o(t.lines,oe.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case oe.BREAK:s.goto=r;break;case oe.CONTINUE:s.goto=n;break}i.add(Be(s))}),i}case oe.BREAK:return Le(t,["  ",Ac(t,t.goto),`
`]);case oe.CONTINUE:return Le(t,["  ",Ac(t,t.goto),`
`]);case oe.OR:return dt(t,"or",t.items.map(Be));case oe.AND:return dt(t,"and",t.items.map(Be));case oe.NOT:return dt(t,"not",t.items.map(Be));case oe.COMPARE:return nM(t);case oe.OPERATOR:return iM(t);case oe.EXPR:return dt(t,"expr",t.words.map(Be));default:return console.error("<unsupported node>",t.type,t),S_(t)}}function rr(t){if(k(t))switch(t.type===oe.LINE&&++Qt.lineindex,t.lineindex=Qt.lineindex,t.type){case oe.PROGRAM:t.lines.forEach(rr);break;case oe.LINE:t.stmts.forEach(rr);break;case oe.MARK:jh(t.id,t.lineindex);break;case oe.IF:rr(t.check),rr(t.block);break;case oe.IF_BLOCK:t.lines.forEach(rr),t.altlines.forEach(rr);break;case oe.ELSE_IF:t.lines.forEach(rr);break;case oe.ELSE:case oe.WHILE:case oe.REPEAT:case oe.FOREACH:t.lines.forEach(rr);break;case oe.MOVE:case oe.COMMAND:case oe.WAITFOR:case oe.IF_CHECK:t.words.forEach(rr);break}}function sM(t){return Qt.labels={},Qt.internal=1,Qt.lineindex=0,Qt.isfirststat=!0,rr(t),{...Be(t).toStringWithSourceMap({file:`${kc}.map`}),...Qt}}function oM(t){return ze(t)?t.length>0?1:0:t??0}function xt(t){return`${t??""}`}function R_(t){return`${t}_chip`}function aM(t,e,n){var c,u;const r=R_(t),i=ss(r);let s;ze(i.lb)||(i.lb=ar(Object.entries(n.labels??{})),i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((c=n.errors)==null?void 0:c.length)??0)!==0?1:0);function o(l,h){O.words=h;const d=hL(e,l);return k(d)?d(a,h):l!=="send"?o("send",[l,...h]):0}const a={halt(){bM(r)},id(){return t},senderid(l=t){return`vm:${l??t}`},set(l,h){const[d,f]=dL(e,a,l,h);if(d)return f},get(l){const[h,d]=fL(e,a,l);if(h)return d},bucket(l){const h=a.get("bucket");ze(h)?h.push(l):a.set("bucket",[l])},tick(l){const h=Ee(i.ps)?i.ps:0,d=h%l===0;if(i.ps=h+1,d===!1)return!1;if(a.shouldtick()===!1)return n_(e,a),!1;i.lc=0,i.ys=0,O.get=a.get,pL(e,a);try{const f=s==null?void 0:s.next();f!=null&&f.done&&(i.es=1)}catch(f){Bt("chip","crash",f.message),i.es=1}return n_(e,a),!0},isended(){return i.es===1},shouldtick(){return i.es===0||a.hm()!==0},shouldhalt(){return Ee(i.lc)?++i.lc>mr.HALT_AT_COUNT:!0},hm(){if(ze(i.mg)&&ze(i.lb)){const[,l]=i.mg;if(k(l))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l)return f.find(p=>Ee(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||a.shouldhalt()},emit(l,h,d){_e.emit(l,a.senderid(),h,d)},send(l,h,d,f){_e.emit(`${a.senderid(l)}:${h}`,t,d,f)},lock(l){i.lk=l},unlock(){i.lk=""},message(l){i.lk&&l.sender!==i.lk||(i.mg=[l.id,l.target,l.data,l.sender,l.player])},zap(l){if(ze(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l){const p=f.findIndex(m=>m>0);p>=0&&(f[p]*=-1)}}},restore(l){if(ze(i.lb))for(let h=0;h<i.lb.length;++h){const[d,f]=i.lb[h];if(d===l)for(let p=0;p<f.length;p++)f[h]=Math.abs(f[h])}},getcase(){i.ec=Ee(i.ec)?i.ec:1;const l=a.hm();if(l&&ze(i.mg)){const[,,h,d,f]=i.mg;a.set("sender",d),k(h)&&a.set("arg",h),f&&a.set("player",f),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=Ee(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){a.yield(),i.es=1},stacktrace(l){const h=qk.parse(l),[d]=h.filter(f=>f.fileName===kc);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(l){return o("text",[l])},stat(...l){return o("stat",l)},hyperlink(...l){return o("hyperlink",l)},command(...l){if(l.length===0)return 0;const[h,...d]=l;return o(xt(h),d)},if(...l){const[h,d]=Y(l,0,[V.ANY]),f=oM(h);return f&&d<l.length&&a.command(...l.slice(d)),f?1:0},repeatstart(l,...h){const[d,f]=Y(h,0,[V.NUMBER]),p=`repeatcount${l}`,m=`repeatwords${l}`;i[p]=d,i[m]=f<h.length?h.slice(f):void 0},repeat(l){const h=`repeatcount${l}`,d=`repeatwords${l}`;if(!Ee(i[h]))return 0;const f=i[h];i[h]=f-1;const p=f>0,m=i[d];return p&&ze(m)&&a.command(...m),p?1:0},foreachstart(l,...h){const[d,f,p,m]=Y(h,0,[V.STRING,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER]);let b=Math.min(f,p),_=Math.max(f,p);const w=(m??0)||1;if(w<0){const E=b;b=_,_=E}return a.set(d,b-w),0},foreach(l,...h){const[d,f,p,m,b]=Y(h,0,[V.STRING,V.NUMBER,V.NUMBER,V.MAYBE_NUMBER]);let _=Math.min(f,p),w=Math.max(f,p);const E=(m??0)||1;if(E<0){const I=_;_=w,w=I}let S=a.get(d);!Ee(S)||S<_||S>w?S=_:S+=E;const C=S<=w?1:0;return C&&(a.set(d,S),b<h.length&&a.command(...h.slice(b))),C},or(...l){let h=0;for(let d=0;d<l.length;){const[f,p]=Y(l,d,[V.ANY]);if(h=f,h)break;d=p}return h},and(...l){let h=0;for(let d=0;d<l.length;){const[f,p]=Y(l,d,[V.ANY]);if(h=f,!h)break;d=p}return h},not(...l){const[h]=Y(l,0,[V.ANY]);return h?0:1},expr(...l){const[h]=Y(l,0,[V.ANY]);return h},isEq(l,h){const[d]=Y([l],0,[V.ANY]),[f]=Y([h],0,[V.ANY]);return typeof d=="object"||typeof f=="object"?Ab(d,f)?1:0:d===f?1:0},isNotEq(l,h){return this.isEq(l,h)?0:1},isLessThan(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return d<f?1:0},isGreaterThan(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return d>f?1:0},isLessThanOrEq(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return d<=f?1:0},isGreaterThanOrEq(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return d>=f?1:0},opPlus(l,h){const[d]=Y([l],0,[V.ANY]),[f]=Y([h],0,[V.ANY]);return d+f},opMinus(l,h){const[d]=Y([l],0,[V.ANY]),[f]=Y([h],0,[V.ANY]);return d-f},opPower(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return Math.pow(d,f)},opMultiply(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return d*f},opDivide(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return d/f},opModDivide(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return d%f},opFloorDivide(l,h){const[d]=Y([l],0,[V.NUMBER]),[f]=Y([h],0,[V.NUMBER]);return Math.floor(d/f)},opUniPlus(l){const[h]=Y([l],0,[V.NUMBER]);return+h},opUniMinus(l){const[h]=Y([l],0,[V.NUMBER]);return-h}};return s=(u=n.code)==null?void 0:u.call(n,a),a}function zh(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];ze(r)?r.forEach(i=>{e.push(zh(i))}):e.push(zh(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function cM(t){const e=Z0(`${t}
`);if(e.errors.length>0)return e;is.input=e.tokens;const n=is.program();if(is.errors.length>0)return{tokens:e.tokens,errors:is.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=eM.go(n);return r?(zh(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Wh=Object.getPrototypeOf(function*(){}).constructor;function lM(t,e){const n=`compile-${t}`;console.time(n);const r=cM(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=sM(r.ast);if(i.code){Zk&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Wh("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Wh("api"," ")}}}return{...r,...i,source:"",code:new Wh("api"," ")}}function uM(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=lM(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},has(i){return k(e[i])},isended(i){const s=e[i];return k(s)?s.isended():!0},halt(i){const s=e[i];return k(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},tick(i,s,o,a,c){var l;let u=e[i];if(!k(e[i])){const h=n(a,c);if(u=e[i]=aM(i,s,h),(l=h.errors)!=null&&l.length){const[d]=h.errors,f=((d==null?void 0:d.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((_,w)=>[_,w]);p.slice(f-5,f).forEach(([_,w])=>{Bt("os","build",`$grey${w+1} $grey${_}`)});const[m,b]=p[f]??[];if(ke(m)&&k(b)){const _=(d.column??1)-1,w=_+d.length,E=_<m.length?m:`${m}*`,S=E.substring(0,_),C=E.substring(_,w),I=E.substring(w);Bt("os","build",`$red${b+1} $grey${S}$red${C}$grey${I}`)}return d.message.split(`
`).forEach(_=>{Bt("os","build",_)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=ef(i.target),a=e[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}function hM(t,e,n,r){const i=[],s=Math.abs(n-t),o=Math.abs(r-e),a=t<n?1:-1,c=e<r?1:-1;let u=s-o;for(i.push({x:t,y:e});t!==n||e!==r;){const l=2*u;l>-o&&(u-=o,t+=a),l<s&&(u+=s,e+=c),i.push({x:t,y:e})}return i}function I_(t,e,n,r,i){t.push({x:e+r,y:n+i}),t.push({x:e-r,y:n+i}),t.push({x:e+r,y:n-i}),t.push({x:e-r,y:n-i})}function fM(t,e,n){const r=[];let i=5-4*n,s=0,o=n,a=(-2*n+5)*4,c=3*4;for(;s<=o;)I_(r,t,e,s,o),I_(r,t,e,o,s),i>0?(i+=a,o-=1,s+=1,a+=4*4,c+=2*2):(i+=c,s+=1,a+=2*4,c+=2*4);return r}let x_=0;function dM(){switch(x_++){case 0:return Te.BLUE;case 1:return Te.GREEN;case 2:return Te.CYAN;case 3:return Te.RED;case 4:return Te.PURPLE;case 5:return Te.YELLOW;default:return x_=0,Te.WHITE}}const pM=new Os;function mM(t,e,n,r,i){const s=[];let o=e;const a=o===0,c=et,u=un,l=a?Te.BLACK:Te.ONCLEAR,h=Ep(t,o++,c,u,l);s.push(h);const d=o++,f=Ik(t,d);s.push(f);const p=xk(t,o++,c,u,r.isdark?1:0);s.push(p);const m=Ep(t,o++,c,u,Te.ONCLEAR);s.push(m);const b={...b_(et,un,dM(),Te.ONCLEAR),...m},_=Ok(t,o++);i&&s.push(_);for(let S=0;S<r.terrain.length;++S){const C=r.terrain[S],I=_h(n,C,0,Te.BLACK,Te.ONCLEAR);h.char[S]=I.char,h.color[S]=I.color,h.bg[S]=I.bg}function w(S,C){if(!(S<0||S>=c||C<0||C>=u))return p.alphas[S+C*c]}const E=Object.values(r.objects??{});for(let S=0;S<E.length;++S){const C=E[S];if(k(C.removed)||k(C.headless))continue;const I=C.id??"",R=_h(n,C,1,Te.WHITE,Te.ONCLEAR),B=Rk(t,d,I);if(B.x=C.x??0,B.y=C.y??0,B.char=R.char,B.color=R.color,B.bg=R.bg,f.sprites.push(B),r.isdark&&Ee(R.light)){const ie=fM(B.x,B.y,R.light);for(let x=0;x<ie.length;++x){let v=0;const g=ie[x],N=hM(B.x,B.y,g.x,g.y);for(let W=0;W<N.length;W++){const M=N[W];if(M.x<0||M.x>=c||M.y<0||M.y>=u)break;const H=pM.subVectors(M,B).length()/(R.light+1),$=1-Gn(H+v,0,1),D=M.x+M.y*c;p.alphas[D]=Gn(p.alphas[D]-$,0,1);const ce=LN(r,M);if(ce<0||!k(r==null?void 0:r.lookup))break;if(M.x!==B.x||M.y!==B.y){const Fe=Ei(r,r.lookup[ce]??"");k(Fe)&&(v+=.5)}const Q=r.terrain[ce],te=vn(n,Q),ve=(Q==null?void 0:Q.collision)??(te==null?void 0:te.collision);if(Ql(He.ISWALK,ve))break}}}const L=[[.01,.01,.01],[.01,1,.01],[.01,.01,.01]].flat(),q=ar(p.alphas);for(let ie=0;ie<p.alphas.length;++ie){const x=ie%c,v=Math.floor(ie/c),g=[[w(x-1,v-1),w(x,v-1),w(x+1,v-1)],[w(x-1,v),w(x,v),w(x+1,v)],[w(x-1,v+1),w(x,v+1),w(x+1,v+1)]].flat().map((M,J)=>k(M)?[M*L[J],L[J]]:void 0).filter(k),N=g.map(([,M])=>M).reduce((M,J)=>M+J,0),W=g.map(([M])=>M).reduce((M,J)=>M+J,0);q[ie]=W/N}if(p.alphas=ar(q),ke(C.tickertext)&&Ee(C.tickertime)&&C.tickertext.length){const ie=et,x=VL(C.tickertext,ie,un-1),v=(x==null?void 0:x.measuredwidth)??1,g=C.x??0,N=C.y??0,W=N<un*.5;b.x=g-Math.floor(v*.5),b.y=N+(W?1:-1),b.x+v>et&&(b.x=et-v),b.x<0&&(b.x=0),HL(C.tickertext,b)}I===t&&(_.focusx=B.x,_.focusy=B.y,_.focusid=I)}return s}const xr=uM();var We=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(We||{});const pt={defaultplayer:rb(),software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function gM(t){pt.defaultplayer=t}function Zr(){return pt.defaultplayer}function Tc(){return[...pt.books.values()]}function yM(){const[t]=pt.books.values();return t}function Jr(t){const e=Pe(t);return pt.books.get(t)??Tc().find(n=>n.name===e)}function Rc(t,e){k(Jr(e))&&(pt.software[t]=e)}function Gt(t){return Jr(pt.software[t])}function O_(t){const e=xy([]);return ke(t)&&(e.name=t),C_(e),In("memory",`created [book] ${e.name}`),e}function _M(t){let e=Jr(t);return k(e)||(e=xy([]),e.name=t),C_(e),In("memory",`created [book] ${e.name}`),e}function ir(t,e){let n=k(e)?_M(e):Gt(t);return k(n)||(k(n)||(n=yM()),k(n)||(n=O_(e)),k(n)&&In("memory",`opened [book] ${n.name} for ${t}`)),Rc(t,n.id),n}function Ti(t,e,n){const r=ir(t);let i=vi(r,e);if(k(i))return i;const s=Ry(n);return i=oN(s==="object"?`@${e}
`:`@${s} ${e}
`,{}),fN(r,i),zl("memory","",pt.defaultplayer),i}function ss(t){const e=ir("main");return es(e,t)}function bM(t){const e=ir("main");return bh(e,t)}function wM(t,e){pt.books.clear(),t.forEach(r=>{pt.books.set(r.id,r),r.name==="main"&&(pt.software.main=r.id)});const n=Jr(e);if(k(n)&&Rc("main",n.id),!pt.software.main){const r=pt.books.values().next();r.value&&(pt.software.main=r.value.id)}}function C_(t){return pt.books.set(t.id,t),t.id}function vM(t){const e=Jr(t);e&&pt.books.delete(e.id)}function EM(t){if(!ke(t)||!t)return Bt("memory","login",`failed for playerid ==>${t}<==`,t);const e=Gt("main");if(!k(e))return Bt("memory","login:main","login failed to find book 'main'",t);const n=uc(e,t);if(k(n))return!0;const r=Cy(e,Re.BOARD).filter(o=>{const a=Qi(o);return k(a.title)});if(r.length===0)return Bt("memory","login:title","login failed to find board with 'title' stat",t);const i=lc(e,"player");if(!k(i))return Bt("memory","login:player","login failed to find object type 'player'",t);const s=cc(Fp(t,r));if(k(s)){const o=i.name??"player",a=Th(s,{x:0,y:0},o,t);if(k(a==null?void 0:a.id))return a.player=t,wh(e,t,s.id),!0}return!1}function N_(t){const e=Gt("main"),n=uc(e,t);wh(e,t,""),co(e,n,Ei(n,t)),Ky(n,t),bh(e,t),bh(e,R_(t))}function kM(t){const e=Gt("main"),n=My(e);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Qh(c)&&k(t[c])===!1&&(t[c]=0,wh(e,c,i.id))}}}function SM(t){xr.message(t)}function L_(t,e,n,r,i=Ob){if(!k(t)||!k(e)||!k(n))return;const s={...O},o=n.id??"";O.book=t,O.board=e,O.element=n,O.isplayer=Qh(o),O.player=n.player??pt.defaultplayer;const a=vn(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Ah(n);if(xr.tick(u,uo.CODE_PAGE,Ee(c)?c:i,l,r),Ee(n==null?void 0:n.tickertime)&&O.timestamp-n.tickertime>To*5&&(n.tickertime=0,n.tickertext=""),O.isplayer){const h=ss(O.element.id??"");h.inputcurrent=0}Tb(s).forEach(h=>{O[h]=s[h]})}function AM(t,e){pt.loaders.set(t,e)}function TM(){const t=Gt("main");if(!k(t))return;const e=t.timestamp+1,n=mr.HALT_AT_COUNT;mr.HALT_AT_COUNT=n*2,pt.loaders.forEach((i,s)=>{xr.tick(s,uo.LOADER,1,"loader",i),xr.isended(s)&&(xr.halt(s),pt.loaders.delete(s))}),mr.HALT_AT_COUNT=n,t.timestamp=e,O.timestamp=e,My(t).forEach(i=>{const s=vN(t,i,e);for(let o=0;o<s.length;++o){const{id:a,type:c,code:u,object:l}=s[o];c===Re.ERROR?xr.halt(a):L_(t,i,l,u)}})}function RM(){xr.gc()}function IM(t,e=""){const n=ir("main");if(!k(n))return;const r=`${t}_cli`;O.timestamp=n.timestamp,O.book=n,O.board=uc(n,t),O.element=Ei(O.board,t),O.player=t,O.isplayer=!0;const i=mr.HALT_AT_COUNT;mr.HALT_AT_COUNT=i*8,mp("memory","running",n.timestamp,r,e),xr.once(r,uo.CLI,"cli",e),mr.HALT_AT_COUNT=i}function Ic(t){const e=ir("main"),n=vi(e,t);if(!k(e)||!k(n)||!k(O.element))return;const r=`${t}_run`,i=Ah(O.element),s=(n==null?void 0:n.code)??"";xr.once(r,uo.CODE_PAGE,i,s)}function xM(t){const e=Gt("main"),n=uc(e,t),r=[];if(!k(e)||!k(n))return r;const i=ao(e,n.over??""),s=ao(e,n.under??""),o=[i,n,s].filter(k);let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=mM(t,a,e,u,u===n);a+=l.length,r.push(...l)}return r}function OM(t){const e=Gt(We.MAIN),n=es(e,We.GADGETSTORE);delete n[t]}$k(t=>{const e=Gt(We.MAIN),n=es(e,We.GADGETSTORE);let r=n[t];return k(r)||(n[t]=r=Wl()),r});const M_=as("gadgetserver",["tock"],t=>{const e=Gt(We.MAIN),n=(e==null?void 0:e.activelist)??[],r=es(e,We.GADGETSYNC);switch(t.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=ui(s);o.layers=xM(s);const a=r[s]??{},c=of(a,o);c.length&&(r[s]=ar(o),rk(M_.name(),c,s))}break;case"desync":t.player&&nk(M_.name(),ui(t.player),t.player);break;case"clearscroll":t.player&&jk(t.player);break;case"clearplayer":t.player&&OM(t.player);break}});function Gh(t,e){function n(r){console.error(r),Bt(t,"crash",r.message)}e().catch(n)}function xc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var U_={exports:{}};/*!

  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>

  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  */(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof xc=="function"&&xc;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var d=new Error("Cannot find module '"+u+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[u]={exports:{}};r[u][0].call(f.exports,function(p){var m=r[u][1][p];return o(m||p)},f,f.exports,n,r,i,s)}return i[u].exports}for(var a=typeof xc=="function"&&xc,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,d,f,p,m,b=[],_=0,w=c.length,E=w,S=s.getTypeOf(c)!=="string";_<c.length;)E=w-_,h=S?(u=c[_++],l=_<w?c[_++]:0,_<w?c[_++]:0):(u=c.charCodeAt(_++),l=_<w?c.charCodeAt(_++):0,_<w?c.charCodeAt(_++):0),d=u>>2,f=(3&u)<<4|l>>4,p=1<E?(15&l)<<2|h>>6:64,m=2<E?63&h:64,b.push(a.charAt(d)+a.charAt(f)+a.charAt(p)+a.charAt(m));return b.join("")},i.decode=function(c){var u,l,h,d,f,p,m=0,b=0,_="data:";if(c.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var w,E=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&E--,c.charAt(c.length-2)===a.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=o.uint8array?new Uint8Array(0|E):new Array(0|E);m<c.length;)u=a.indexOf(c.charAt(m++))<<2|(d=a.indexOf(c.charAt(m++)))>>4,l=(15&d)<<4|(f=a.indexOf(c.charAt(m++)))>>2,h=(3&f)<<6|(p=a.indexOf(c.charAt(m++))),w[b++]=u,f!==64&&(w[b++]=l),p!==64&&(w[b++]=h);return w}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,d,f,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=d,this.compression=f,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,d){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,d){var f=o,p=d+h;u^=-1;for(var m=d;m<p;m++)u=u>>>8^f[255&(u^l[m])];return-1^u}(0|c,a,a.length,0):function(u,l,h,d){var f=o,p=d+h;u^=-1;for(var m=d;m<p;m++)u=u>>>8^f[255&(u^l.charCodeAt(m))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,d){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(d){h.push({data:d,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(f,p){var m,b="";for(m=0;m<p;m++)b+=String.fromCharCode(255&f),f>>>=8;return b}function o(f,p,m,b,_,w){var E,S,C=f.file,I=f.compression,R=w!==u.utf8encode,B=a.transformTo("string",w(C.name)),L=a.transformTo("string",u.utf8encode(C.name)),q=C.comment,ie=a.transformTo("string",w(q)),x=a.transformTo("string",u.utf8encode(q)),v=L.length!==C.name.length,g=x.length!==q.length,N="",W="",M="",J=C.dir,H=C.date,ee={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(ee.crc32=f.crc32,ee.compressedSize=f.compressedSize,ee.uncompressedSize=f.uncompressedSize);var $=0;p&&($|=8),R||!v&&!g||($|=2048);var D=0,ce=0;J&&(D|=16),_==="UNIX"?(ce=798,D|=function(te,ve){var Fe=te;return te||(Fe=ve?16893:33204),(65535&Fe)<<16}(C.unixPermissions,J)):(ce=20,D|=function(te){return 63&(te||0)}(C.dosPermissions)),E=H.getUTCHours(),E<<=6,E|=H.getUTCMinutes(),E<<=5,E|=H.getUTCSeconds()/2,S=H.getUTCFullYear()-1980,S<<=4,S|=H.getUTCMonth()+1,S<<=5,S|=H.getUTCDate(),v&&(W=s(1,1)+s(l(B),4)+L,N+="up"+s(W.length,2)+W),g&&(M=s(1,1)+s(l(ie),4)+x,N+="uc"+s(M.length,2)+M);var Q="";return Q+=`
\0`,Q+=s($,2),Q+=I.magic,Q+=s(E,2),Q+=s(S,2),Q+=s(ee.crc32,4),Q+=s(ee.compressedSize,4),Q+=s(ee.uncompressedSize,4),Q+=s(B.length,2),Q+=s(N.length,2),{fileRecord:h.LOCAL_FILE_HEADER+Q+B+N,dirRecord:h.CENTRAL_FILE_HEADER+s(ce,2)+Q+s(ie.length,2)+"\0\0\0\0"+s(D,4)+s(b,4)+B+N+ie}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function d(f,p,m,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(f){var p=f.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-b-1))/m:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var p=this.streamFiles&&!f.file.dir;if(p){var m=o(f,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var p=this.streamFiles&&!f.file.dir,m=o(f,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:function(b){return h.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-f,b=function(_,w,E,S,C){var I=a.transformTo("string",C(S));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(_,2)+s(_,2)+s(w,4)+s(E,4)+s(I.length,2)+I}(this.dirRecords.length,m,f,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var p=this;return f.on("data",function(m){p.processChunk(m)}),f.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),f.on("error",function(m){p.error(m)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var p=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var m=0;m<p.length;m++)try{p[m].error(f)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,p=0;p<f.length;p++)f[p].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(d,f){h++;var p=function(w,E){var S=w||E,C=s[S];if(!C)throw new Error(S+" is not a valid compression method !");return C}(f.options.compression,c.compression),m=f.options.compressionOptions||c.compressionOptions||{},b=f.dir,_=f.date;f._compressWorker(p,m).withStreamInfo("file",{name:d,dir:b,date:_,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(d){l.error(d)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(d){return new o.Promise(function(f,p){var m=d.decompressed.getContentWorker().pipe(new u);m.on("error",function(b){p(b)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(d,f){var p=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(m){var b=new c(f);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],_=m.files;if(f.checkCRC32)for(var w=0;w<_.length;w++)b.push(h(_[w]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),_=b.files,w=0;w<_.length;w++){var E=_[w],S=E.fileNameStr,C=s.resolve(E.fileNameStr);p.file(C,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:f.createFolders}),E.dir||(p.file(C).unsafeOriginalName=S)}return b.zipComment.length&&(p.comment=b.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,d){l.push(h)||l._helper.pause(),u&&u(d)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(C,I,R){var B,L=a.getTypeOf(I),q=a.extend(R||{},l);q.date=q.date||new Date,q.compression!==null&&(q.compression=q.compression.toUpperCase()),typeof q.unixPermissions=="string"&&(q.unixPermissions=parseInt(q.unixPermissions,8)),q.unixPermissions&&16384&q.unixPermissions&&(q.dir=!0),q.dosPermissions&&16&q.dosPermissions&&(q.dir=!0),q.dir&&(C=_(C)),q.createFolders&&(B=b(C))&&w.call(this,B,!0);var ie=L==="string"&&q.binary===!1&&q.base64===!1;R&&R.binary!==void 0||(q.binary=!ie),(I instanceof h&&I.uncompressedSize===0||q.dir||!I||I.length===0)&&(q.base64=!1,q.binary=!0,I="",q.compression="STORE",L="string");var x=null;x=I instanceof h||I instanceof c?I:p.isNode&&p.isStream(I)?new m(C,I):a.prepareContent(C,I,q.binary,q.optimizedBinaryString,q.base64);var v=new d(C,x,q);this.files[C]=v}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),d=n("./zipObject"),f=n("./generate"),p=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),b=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var I=C.lastIndexOf("/");return 0<I?C.substring(0,I):""},_=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},w=function(C,I){return I=I!==void 0?I:l.createFolders,C=_(C),this.files[C]||s.call(this,C,null,{dir:!0,createFolders:I}),this.files[C]};function E(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var I,R,B;for(I in this.files)B=this.files[I],(R=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&C(R,B)},filter:function(C){var I=[];return this.forEach(function(R,B){C(R,B)&&I.push(B)}),I},file:function(C,I,R){if(arguments.length!==1)return C=this.root+C,s.call(this,C,I,R),this;if(E(C)){var B=C;return this.filter(function(q,ie){return!ie.dir&&B.test(q)})}var L=this.files[this.root+C];return L&&!L.dir?L:null},folder:function(C){if(!C)return this;if(E(C))return this.filter(function(L,q){return q.dir&&C.test(L)});var I=this.root+C,R=w.call(this,I),B=this.clone();return B.root=R.name,B},remove:function(C){C=this.root+C;var I=this.files[C];if(I||(C.slice(-1)!=="/"&&(C+="/"),I=this.files[C]),I&&!I.dir)delete this.files[C];else for(var R=this.filter(function(L,q){return q.name.slice(0,C.length)===C}),B=0;B<R.length;B++)delete this.files[R[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var I,R={};try{if((R=a.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=R.type.toLowerCase(),R.compression=R.compression.toUpperCase(),R.type==="binarystring"&&(R.type="string"),!R.type)throw new Error("No output type specified.");a.checkSupport(R.type),R.platform!=="darwin"&&R.platform!=="freebsd"&&R.platform!=="linux"&&R.platform!=="sunos"||(R.platform="UNIX"),R.platform==="win32"&&(R.platform="DOS");var B=R.comment||this.comment||"";I=f.generateWorker(this,R,B)}catch(L){(I=new c("error")).error(L)}return new u(I,R.type||"string",R.mimeType)},generateAsync:function(C,I){return this.generateInternalStream(C).accumulate(I)},generateNodeStream:function(C,I){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(I)}};r.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===u&&this.data[d+2]===l&&this.data[d+3]===h)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&u===d[1]&&l===d[2]&&h===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var d=s.getTypeOf(h);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,m){return new l.Promise(function(b,_){var w=[],E=p._internalType,S=p._outputType,C=p._mimeType;p.on("data",function(I,R){w.push(I),m&&m(R)}).on("error",function(I){w=[],_(I)}).on("end",function(){try{var I=function(R,B,L){switch(R){case"blob":return s.newBlob(s.transformTo("arraybuffer",B),L);case"base64":return c.encode(B);default:return s.transformTo(R,B)}}(S,function(R,B){var L,q=0,ie=null,x=0;for(L=0;L<B.length;L++)x+=B[L].length;switch(R){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(ie=new Uint8Array(x),L=0;L<B.length;L++)ie.set(B[L],q),q+=B[L].length;return ie;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+R+"'")}}(E,w),C);b(I)}catch(R){_(R)}w=[]}).resume()})}function f(p,m,b){var _=m;switch(m){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=m,this._mimeType=b,s.checkSupport(_),this._worker=p.pipe(new o(_)),p.lock()}catch(w){this._worker=new a("error"),this._worker.error(w)}}f.prototype={accumulate:function(p){return d(this,p)},on:function(p,m){var b=this;return p==="data"?this._worker.on(p,function(_){m.call(b,_.data,_.meta)}):this._worker.on(p,function(){s.delay(m,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(f){return o.nodebuffer?a.newBufferFrom(f,"utf-8"):function(p){var m,b,_,w,E,S=p.length,C=0;for(w=0;w<S;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<S&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),C+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(C):new Array(C),w=E=0;E<C;w++)(64512&(b=p.charCodeAt(w)))==55296&&w+1<S&&(64512&(_=p.charCodeAt(w+1)))==56320&&(b=65536+(b-55296<<10)+(_-56320),w++),b<128?m[E++]=b:(b<2048?m[E++]=192|b>>>6:(b<65536?m[E++]=224|b>>>12:(m[E++]=240|b>>>18,m[E++]=128|b>>>12&63),m[E++]=128|b>>>6&63),m[E++]=128|63&b);return m}(f)},i.utf8decode=function(f){return o.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):function(p){var m,b,_,w,E=p.length,S=new Array(2*E);for(m=b=0;m<E;)if((_=p[m++])<128)S[b++]=_;else if(4<(w=u[_]))S[b++]=65533,m+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&m<E;)_=_<<6|63&p[m++],w--;1<w?S[b++]=65533:_<65536?S[b++]=_:(_-=65536,S[b++]=55296|_>>10&1023,S[b++]=56320|1023&_)}return S.length!==b&&(S.subarray?S=S.subarray(0,b):S.length=b),s.applyFromCharCode(S)}(f=s.transformTo(o.uint8array?"uint8array":"array",f))},s.inherits(h,c),h.prototype.processChunk=function(f){var p=s.transformTo(o.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var b=function(w,E){var S;for((E=E||w.length)>w.length&&(E=w.length),S=E-1;0<=S&&(192&w[S])==128;)S--;return S<0||S===0?E:S+u[w[S]]>E?S:E}(p),_=p;b!==p.length&&(o.uint8array?(_=p.subarray(0,b),this.leftOver=p.subarray(b,p.length)):(_=p.slice(0,b),this.leftOver=p.slice(b,p.length))),this.push({data:i.utf8decode(_),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(d,c),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(m){return m}function l(m,b){for(var _=0;_<m.length;++_)b[_]=255&m.charCodeAt(_);return b}n("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(m),_.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,b,_){var w=[],E=0,S=m.length;if(S<=_)return String.fromCharCode.apply(null,m);for(;E<S;)b==="array"||b==="nodebuffer"?w.push(String.fromCharCode.apply(null,m.slice(E,Math.min(E+_,S)))):w.push(String.fromCharCode.apply(null,m.subarray(E,Math.min(E+_,S)))),E+=_;return w.join("")},stringifyByChar:function(m){for(var b="",_=0;_<m.length;_++)b+=String.fromCharCode(m[_]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var b=65536,_=i.getTypeOf(m),w=!0;if(_==="uint8array"?w=h.applyCanBeUsed.uint8array:_==="nodebuffer"&&(w=h.applyCanBeUsed.nodebuffer),w)for(;1<b;)try{return h.stringifyByChunk(m,_,b)}catch{b=Math.floor(b/2)}return h.stringifyByChar(m)}function f(m,b){for(var _=0;_<m.length;_++)b[_]=m[_];return b}i.applyFromCharCode=d;var p={};p.string={string:u,array:function(m){return l(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return l(m,new Uint8Array(m.length))},nodebuffer:function(m){return l(m,a.allocBuffer(m.length))}},p.array={string:d,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return f(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:d,array:function(m){return f(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return f(m,new Uint8Array(m.length))},nodebuffer:u},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var _=i.getTypeOf(b);return p[_][m](b)},i.resolve=function(m){for(var b=m.split("/"),_=[],w=0;w<b.length;w++){var E=b[w];E==="."||E===""&&w!==0&&w!==b.length-1||(E===".."?_.pop():_.push(E))}return _.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,_,w="";for(_=0;_<(m||"").length;_++)w+="\\x"+((b=m.charCodeAt(_))<16?"0":"")+b.toString(16).toUpperCase();return w},i.delay=function(m,b,_){setImmediate(function(){m.apply(_||null,b||[])})},i.inherits=function(m,b){function _(){}_.prototype=b.prototype,m.prototype=new _},i.extend=function(){var m,b,_={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&_[b]===void 0&&(_[b]=arguments[m][b]);return _},i.prepareContent=function(m,b,_,w,E){return c.Promise.resolve(b).then(function(S){return s.blob&&(S instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(S))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,I){var R=new FileReader;R.onload=function(B){C(B.target.result)},R.onerror=function(B){I(B.target.error)},R.readAsArrayBuffer(S)}):S}).then(function(S){var C=i.getTypeOf(S);return C?(C==="arraybuffer"?S=i.transformTo("uint8array",S):C==="string"&&(E?S=o.decode(S):_&&w!==!0&&(S=function(I){return l(I,s.uint8array?new Uint8Array(I.length):new Array(I.length))}(S))),S):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(h)+")")}},isSignature:function(h,d){var f=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===d;return this.reader.setIndex(f),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),d=u.uint8array?"uint8array":"array",f=o.transformTo(d,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,d,f,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[h]={id:h,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,d;for(h=0;h<this.files.length;h++)d=this.files[h],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var d=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var p=d-f;if(0<p)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function d(f,p){this.options=f,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var p,m;if(f.skip(22),this.fileNameLength=f.readInt(2),m=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(b){for(var _ in l)if(Object.prototype.hasOwnProperty.call(l,_)&&l[_].magic===b)return l[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var p=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(p),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var p,m,b,_=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<_;)p=f.readInt(2),m=f.readInt(2),b=f.readData(m),this.extraFields[p]={id:p,length:m,value:b};f.setIndex(_)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var _=o.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var p=s(f.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(f.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,m,b){this.name=p,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,b="string";try{if(!p)throw new Error("No output type specified.");var _=(b=p.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var w=!this._dataBinary;w&&!_&&(m=m.pipe(new c.Utf8EncodeWorker)),!w&&_&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(E){(m=new l("error")).error(E)}return new o(m,b,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(b,p,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)s.prototype[h[f]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var d=new s.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var f=[];function p(){var m,b;a=!0;for(var _=f.length;_;){for(b=f,f=[],m=-1;++m<_;)b[m]();_=f.length}a=!1}r.exports=function(m){f.push(m)!==1||a||o()}}).call(this,typeof Ut<"u"?Ut:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,_!==o&&m(this,_)}function d(_,w,E){this.promise=_,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function f(_,w,E){s(function(){var S;try{S=w(E)}catch(C){return a.reject(_,C)}S===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,S)})}function p(_){var w=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof w=="function")return function(){w.apply(_,arguments)}}function m(_,w){var E=!1;function S(R){E||(E=!0,a.reject(_,R))}function C(R){E||(E=!0,a.resolve(_,R))}var I=b(function(){w(C,S)});I.status==="error"&&S(I.value)}function b(_,w){var E={};try{E.value=_(w),E.status="success"}catch(S){E.status="error",E.value=S}return E}(r.exports=h).prototype.finally=function(_){if(typeof _!="function")return this;var w=this.constructor;return this.then(function(E){return w.resolve(_()).then(function(){return E})},function(E){return w.resolve(_()).then(function(){throw E})})},h.prototype.catch=function(_){return this.then(null,_)},h.prototype.then=function(_,w){if(typeof _!="function"&&this.state===u||typeof w!="function"&&this.state===c)return this;var E=new this.constructor(o);return this.state!==l?f(E,this.state===u?_:w,this.outcome):this.queue.push(new d(E,_,w)),E},d.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},d.prototype.otherCallFulfilled=function(_){f(this.promise,this.onFulfilled,_)},d.prototype.callRejected=function(_){a.reject(this.promise,_)},d.prototype.otherCallRejected=function(_){f(this.promise,this.onRejected,_)},a.resolve=function(_,w){var E=b(p,w);if(E.status==="error")return a.reject(_,E.value);var S=E.value;if(S)m(_,S);else{_.state=u,_.outcome=w;for(var C=-1,I=_.queue.length;++C<I;)_.queue[C].callFulfilled(w)}return _},a.reject=function(_,w){_.state=c,_.outcome=w;for(var E=-1,S=_.queue.length;++E<S;)_.queue[E].callRejected(w);return _},h.resolve=function(_){return _ instanceof this?_:a.resolve(new this(o),_)},h.reject=function(_){var w=new this(o);return a.reject(w,_)},h.all=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=_.length,S=!1;if(!E)return this.resolve([]);for(var C=new Array(E),I=0,R=-1,B=new this(o);++R<E;)L(_[R],R);return B;function L(q,ie){w.resolve(q).then(function(x){C[ie]=x,++I!==E||S||(S=!0,a.resolve(B,C))},function(x){S||(S=!0,a.reject(B,x))})}},h.race=function(_){var w=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=_.length,S=!1;if(!E)return this.resolve([]);for(var C=-1,I=new this(o);++C<E;)R=_[C],w.resolve(R).then(function(B){S||(S=!0,a.resolve(I,B))},function(B){S||(S=!0,a.reject(I,B))});var R;return I}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,d=-1,f=0,p=8;function m(_){if(!(this instanceof m))return new m(_);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},_||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var E=s.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(E!==h)throw new Error(c[E]);if(w.header&&s.deflateSetHeader(this.strm,w.header),w.dictionary){var S;if(S=typeof w.dictionary=="string"?a.string2buf(w.dictionary):l.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(E=s.deflateSetDictionary(this.strm,S))!==h)throw new Error(c[E]);this._dict_set=!0}}function b(_,w){var E=new m(w);if(E.push(_,!0),E.err)throw E.msg||c[E.err];return E.result}m.prototype.push=function(_,w){var E,S,C=this.strm,I=this.options.chunkSize;if(this.ended)return!1;S=w===~~w?w:w===!0?4:0,typeof _=="string"?C.input=a.string2buf(_):l.call(_)==="[object ArrayBuffer]"?C.input=new Uint8Array(_):C.input=_,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(I),C.next_out=0,C.avail_out=I),(E=s.deflate(C,S))!==1&&E!==h)return this.onEnd(E),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(C.output,C.next_out))):this.onData(o.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&E!==1);return S===4?(E=s.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h):S!==2||(this.onEnd(h),!(C.avail_out=0))},m.prototype.onData=function(_){this.chunks.push(_)},m.prototype.onEnd=function(_){_===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(_,w){return(w=w||{}).raw=!0,b(_,w)},i.gzip=function(_,w){return(w=w||{}).gzip=!0,b(_,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),d=Object.prototype.toString;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var _=s.inflateInit2(this.strm,b.windowBits);if(_!==c.Z_OK)throw new Error(u[_]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,b){var _=new f(b);if(_.push(m,!0),_.err)throw _.msg||u[_.err];return _.result}f.prototype.push=function(m,b){var _,w,E,S,C,I,R=this.strm,B=this.options.chunkSize,L=this.options.dictionary,q=!1;if(this.ended)return!1;w=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?R.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?R.input=new Uint8Array(m):R.input=m,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new o.Buf8(B),R.next_out=0,R.avail_out=B),(_=s.inflate(R,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&L&&(I=typeof L=="string"?a.string2buf(L):d.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,_=s.inflateSetDictionary(this.strm,I)),_===c.Z_BUF_ERROR&&q===!0&&(_=c.Z_OK,q=!1),_!==c.Z_STREAM_END&&_!==c.Z_OK)return this.onEnd(_),!(this.ended=!0);R.next_out&&(R.avail_out!==0&&_!==c.Z_STREAM_END&&(R.avail_in!==0||w!==c.Z_FINISH&&w!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=a.utf8border(R.output,R.next_out),S=R.next_out-E,C=a.buf2string(R.output,E),R.next_out=S,R.avail_out=B-S,S&&o.arraySet(R.output,R.output,E,S,0),this.onData(C)):this.onData(o.shrinkBuf(R.output,R.next_out)))),R.avail_in===0&&R.avail_out===0&&(q=!0)}while((0<R.avail_in||R.avail_out===0)&&_!==c.Z_STREAM_END);return _===c.Z_STREAM_END&&(w=c.Z_FINISH),w===c.Z_FINISH?(_=s.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===c.Z_OK):w!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(R.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=f,i.inflate=p,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,p(m,b)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,d){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),d);else for(var f=0;f<h;f++)c[d+f]=u[l+f]},flattenChunks:function(c){var u,l,h,d,f,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=d=0,l=c.length;u<l;u++)f=c[u],p.set(f,d),d+=f.length;return p}},a={arraySet:function(c,u,l,h,d){for(var f=0;f<h;f++)c[d+f]=u[l+f]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,d){if(d<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,d));for(var f="",p=0;p<d;p++)f+=String.fromCharCode(h[p]);return f}c[254]=c[254]=1,i.string2buf=function(h){var d,f,p,m,b,_=h.length,w=0;for(m=0;m<_;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),w+=f<128?1:f<2048?2:f<65536?3:4;for(d=new s.Buf8(w),m=b=0;b<w;m++)(64512&(f=h.charCodeAt(m)))==55296&&m+1<_&&(64512&(p=h.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?d[b++]=f:(f<2048?d[b++]=192|f>>>6:(f<65536?d[b++]=224|f>>>12:(d[b++]=240|f>>>18,d[b++]=128|f>>>12&63),d[b++]=128|f>>>6&63),d[b++]=128|63&f);return d},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var d=new s.Buf8(h.length),f=0,p=d.length;f<p;f++)d[f]=h.charCodeAt(f);return d},i.buf2string=function(h,d){var f,p,m,b,_=d||h.length,w=new Array(2*_);for(f=p=0;f<_;)if((m=h[f++])<128)w[p++]=m;else if(4<(b=c[m]))w[p++]=65533,f+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&f<_;)m=m<<6|63&h[f++],b--;1<b?w[p++]=65533:m<65536?w[p++]=m:(m-=65536,w[p++]=55296|m>>10&1023,w[p++]=56320|1023&m)}return l(w,p)},i.utf8border=function(h,d){var f;for((d=d||h.length)>h.length&&(d=h.length),f=d-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?d:f+c[h[f]]>d?f:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var d=u;d<h;d++)o=o>>>8^l[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,d=4,f=0,p=-2,m=-1,b=4,_=2,w=8,E=9,S=286,C=30,I=19,R=2*S+1,B=15,L=3,q=258,ie=q+L+1,x=42,v=113,g=1,N=2,W=3,M=4;function J(y,K){return y.msg=l[K],K}function H(y){return(y<<1)-(4<y?9:0)}function ee(y){for(var K=y.length;0<=--K;)y[K]=0}function $(y){var K=y.state,G=K.pending;G>y.avail_out&&(G=y.avail_out),G!==0&&(o.arraySet(y.output,K.pending_buf,K.pending_out,G,y.next_out),y.next_out+=G,K.pending_out+=G,y.total_out+=G,y.avail_out-=G,K.pending-=G,K.pending===0&&(K.pending_out=0))}function D(y,K){a._tr_flush_block(y,0<=y.block_start?y.block_start:-1,y.strstart-y.block_start,K),y.block_start=y.strstart,$(y.strm)}function ce(y,K){y.pending_buf[y.pending++]=K}function Q(y,K){y.pending_buf[y.pending++]=K>>>8&255,y.pending_buf[y.pending++]=255&K}function te(y,K){var G,T,A=y.max_chain_length,F=y.strstart,X=y.prev_length,Z=y.nice_match,z=y.strstart>y.w_size-ie?y.strstart-(y.w_size-ie):0,ne=y.window,ue=y.w_mask,re=y.prev,de=y.strstart+q,Je=ne[F+X-1],Ue=ne[F+X];y.prev_length>=y.good_match&&(A>>=2),Z>y.lookahead&&(Z=y.lookahead);do if(ne[(G=K)+X]===Ue&&ne[G+X-1]===Je&&ne[G]===ne[F]&&ne[++G]===ne[F+1]){F+=2,G++;do;while(ne[++F]===ne[++G]&&ne[++F]===ne[++G]&&ne[++F]===ne[++G]&&ne[++F]===ne[++G]&&ne[++F]===ne[++G]&&ne[++F]===ne[++G]&&ne[++F]===ne[++G]&&ne[++F]===ne[++G]&&F<de);if(T=q-(de-F),F=de-q,X<T){if(y.match_start=K,Z<=(X=T))break;Je=ne[F+X-1],Ue=ne[F+X]}}while((K=re[K&ue])>z&&--A!=0);return X<=y.lookahead?X:y.lookahead}function ve(y){var K,G,T,A,F,X,Z,z,ne,ue,re=y.w_size;do{if(A=y.window_size-y.lookahead-y.strstart,y.strstart>=re+(re-ie)){for(o.arraySet(y.window,y.window,re,re,0),y.match_start-=re,y.strstart-=re,y.block_start-=re,K=G=y.hash_size;T=y.head[--K],y.head[K]=re<=T?T-re:0,--G;);for(K=G=re;T=y.prev[--K],y.prev[K]=re<=T?T-re:0,--G;);A+=re}if(y.strm.avail_in===0)break;if(X=y.strm,Z=y.window,z=y.strstart+y.lookahead,ne=A,ue=void 0,ue=X.avail_in,ne<ue&&(ue=ne),G=ue===0?0:(X.avail_in-=ue,o.arraySet(Z,X.input,X.next_in,ue,z),X.state.wrap===1?X.adler=c(X.adler,Z,ue,z):X.state.wrap===2&&(X.adler=u(X.adler,Z,ue,z)),X.next_in+=ue,X.total_in+=ue,ue),y.lookahead+=G,y.lookahead+y.insert>=L)for(F=y.strstart-y.insert,y.ins_h=y.window[F],y.ins_h=(y.ins_h<<y.hash_shift^y.window[F+1])&y.hash_mask;y.insert&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[F+L-1])&y.hash_mask,y.prev[F&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=F,F++,y.insert--,!(y.lookahead+y.insert<L)););}while(y.lookahead<ie&&y.strm.avail_in!==0)}function Fe(y,K){for(var G,T;;){if(y.lookahead<ie){if(ve(y),y.lookahead<ie&&K===h)return g;if(y.lookahead===0)break}if(G=0,y.lookahead>=L&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),G!==0&&y.strstart-G<=y.w_size-ie&&(y.match_length=te(y,G)),y.match_length>=L)if(T=a._tr_tally(y,y.strstart-y.match_start,y.match_length-L),y.lookahead-=y.match_length,y.match_length<=y.max_lazy_match&&y.lookahead>=L){for(y.match_length--;y.strstart++,y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart,--y.match_length!=0;);y.strstart++}else y.strstart+=y.match_length,y.match_length=0,y.ins_h=y.window[y.strstart],y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+1])&y.hash_mask;else T=a._tr_tally(y,0,y.window[y.strstart]),y.lookahead--,y.strstart++;if(T&&(D(y,!1),y.strm.avail_out===0))return g}return y.insert=y.strstart<L-1?y.strstart:L-1,K===d?(D(y,!0),y.strm.avail_out===0?W:M):y.last_lit&&(D(y,!1),y.strm.avail_out===0)?g:N}function we(y,K){for(var G,T,A;;){if(y.lookahead<ie){if(ve(y),y.lookahead<ie&&K===h)return g;if(y.lookahead===0)break}if(G=0,y.lookahead>=L&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),y.prev_length=y.match_length,y.prev_match=y.match_start,y.match_length=L-1,G!==0&&y.prev_length<y.max_lazy_match&&y.strstart-G<=y.w_size-ie&&(y.match_length=te(y,G),y.match_length<=5&&(y.strategy===1||y.match_length===L&&4096<y.strstart-y.match_start)&&(y.match_length=L-1)),y.prev_length>=L&&y.match_length<=y.prev_length){for(A=y.strstart+y.lookahead-L,T=a._tr_tally(y,y.strstart-1-y.prev_match,y.prev_length-L),y.lookahead-=y.prev_length-1,y.prev_length-=2;++y.strstart<=A&&(y.ins_h=(y.ins_h<<y.hash_shift^y.window[y.strstart+L-1])&y.hash_mask,G=y.prev[y.strstart&y.w_mask]=y.head[y.ins_h],y.head[y.ins_h]=y.strstart),--y.prev_length!=0;);if(y.match_available=0,y.match_length=L-1,y.strstart++,T&&(D(y,!1),y.strm.avail_out===0))return g}else if(y.match_available){if((T=a._tr_tally(y,0,y.window[y.strstart-1]))&&D(y,!1),y.strstart++,y.lookahead--,y.strm.avail_out===0)return g}else y.match_available=1,y.strstart++,y.lookahead--}return y.match_available&&(T=a._tr_tally(y,0,y.window[y.strstart-1]),y.match_available=0),y.insert=y.strstart<L-1?y.strstart:L-1,K===d?(D(y,!0),y.strm.avail_out===0?W:M):y.last_lit&&(D(y,!1),y.strm.avail_out===0)?g:N}function be(y,K,G,T,A){this.good_length=y,this.max_lazy=K,this.nice_length=G,this.max_chain=T,this.func=A}function Ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*R),this.dyn_dtree=new o.Buf16(2*(2*C+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),ee(this.dyn_ltree),ee(this.dyn_dtree),ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(B+1),this.heap=new o.Buf16(2*S+1),ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*S+1),ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function je(y){var K;return y&&y.state?(y.total_in=y.total_out=0,y.data_type=_,(K=y.state).pending=0,K.pending_out=0,K.wrap<0&&(K.wrap=-K.wrap),K.status=K.wrap?x:v,y.adler=K.wrap===2?0:1,K.last_flush=h,a._tr_init(K),f):J(y,p)}function mt(y){var K=je(y);return K===f&&function(G){G.window_size=2*G.w_size,ee(G.head),G.max_lazy_match=s[G.level].max_lazy,G.good_match=s[G.level].good_length,G.nice_match=s[G.level].nice_length,G.max_chain_length=s[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=L-1,G.match_available=0,G.ins_h=0}(y.state),K}function Et(y,K,G,T,A,F){if(!y)return p;var X=1;if(K===m&&(K=6),T<0?(X=0,T=-T):15<T&&(X=2,T-=16),A<1||E<A||G!==w||T<8||15<T||K<0||9<K||F<0||b<F)return J(y,p);T===8&&(T=9);var Z=new Ge;return(y.state=Z).strm=y,Z.wrap=X,Z.gzhead=null,Z.w_bits=T,Z.w_size=1<<Z.w_bits,Z.w_mask=Z.w_size-1,Z.hash_bits=A+7,Z.hash_size=1<<Z.hash_bits,Z.hash_mask=Z.hash_size-1,Z.hash_shift=~~((Z.hash_bits+L-1)/L),Z.window=new o.Buf8(2*Z.w_size),Z.head=new o.Buf16(Z.hash_size),Z.prev=new o.Buf16(Z.w_size),Z.lit_bufsize=1<<A+6,Z.pending_buf_size=4*Z.lit_bufsize,Z.pending_buf=new o.Buf8(Z.pending_buf_size),Z.d_buf=1*Z.lit_bufsize,Z.l_buf=3*Z.lit_bufsize,Z.level=K,Z.strategy=F,Z.method=G,mt(y)}s=[new be(0,0,0,0,function(y,K){var G=65535;for(G>y.pending_buf_size-5&&(G=y.pending_buf_size-5);;){if(y.lookahead<=1){if(ve(y),y.lookahead===0&&K===h)return g;if(y.lookahead===0)break}y.strstart+=y.lookahead,y.lookahead=0;var T=y.block_start+G;if((y.strstart===0||y.strstart>=T)&&(y.lookahead=y.strstart-T,y.strstart=T,D(y,!1),y.strm.avail_out===0)||y.strstart-y.block_start>=y.w_size-ie&&(D(y,!1),y.strm.avail_out===0))return g}return y.insert=0,K===d?(D(y,!0),y.strm.avail_out===0?W:M):(y.strstart>y.block_start&&(D(y,!1),y.strm.avail_out),g)}),new be(4,4,8,4,Fe),new be(4,5,16,8,Fe),new be(4,6,32,32,Fe),new be(4,4,16,16,we),new be(8,16,32,32,we),new be(8,16,128,128,we),new be(8,32,128,256,we),new be(32,128,258,1024,we),new be(32,258,258,4096,we)],i.deflateInit=function(y,K){return Et(y,K,w,15,8,0)},i.deflateInit2=Et,i.deflateReset=mt,i.deflateResetKeep=je,i.deflateSetHeader=function(y,K){return y&&y.state?y.state.wrap!==2?p:(y.state.gzhead=K,f):p},i.deflate=function(y,K){var G,T,A,F;if(!y||!y.state||5<K||K<0)return y?J(y,p):p;if(T=y.state,!y.output||!y.input&&y.avail_in!==0||T.status===666&&K!==d)return J(y,y.avail_out===0?-5:p);if(T.strm=y,G=T.last_flush,T.last_flush=K,T.status===x)if(T.wrap===2)y.adler=0,ce(T,31),ce(T,139),ce(T,8),T.gzhead?(ce(T,(T.gzhead.text?1:0)+(T.gzhead.hcrc?2:0)+(T.gzhead.extra?4:0)+(T.gzhead.name?8:0)+(T.gzhead.comment?16:0)),ce(T,255&T.gzhead.time),ce(T,T.gzhead.time>>8&255),ce(T,T.gzhead.time>>16&255),ce(T,T.gzhead.time>>24&255),ce(T,T.level===9?2:2<=T.strategy||T.level<2?4:0),ce(T,255&T.gzhead.os),T.gzhead.extra&&T.gzhead.extra.length&&(ce(T,255&T.gzhead.extra.length),ce(T,T.gzhead.extra.length>>8&255)),T.gzhead.hcrc&&(y.adler=u(y.adler,T.pending_buf,T.pending,0)),T.gzindex=0,T.status=69):(ce(T,0),ce(T,0),ce(T,0),ce(T,0),ce(T,0),ce(T,T.level===9?2:2<=T.strategy||T.level<2?4:0),ce(T,3),T.status=v);else{var X=w+(T.w_bits-8<<4)<<8;X|=(2<=T.strategy||T.level<2?0:T.level<6?1:T.level===6?2:3)<<6,T.strstart!==0&&(X|=32),X+=31-X%31,T.status=v,Q(T,X),T.strstart!==0&&(Q(T,y.adler>>>16),Q(T,65535&y.adler)),y.adler=1}if(T.status===69)if(T.gzhead.extra){for(A=T.pending;T.gzindex<(65535&T.gzhead.extra.length)&&(T.pending!==T.pending_buf_size||(T.gzhead.hcrc&&T.pending>A&&(y.adler=u(y.adler,T.pending_buf,T.pending-A,A)),$(y),A=T.pending,T.pending!==T.pending_buf_size));)ce(T,255&T.gzhead.extra[T.gzindex]),T.gzindex++;T.gzhead.hcrc&&T.pending>A&&(y.adler=u(y.adler,T.pending_buf,T.pending-A,A)),T.gzindex===T.gzhead.extra.length&&(T.gzindex=0,T.status=73)}else T.status=73;if(T.status===73)if(T.gzhead.name){A=T.pending;do{if(T.pending===T.pending_buf_size&&(T.gzhead.hcrc&&T.pending>A&&(y.adler=u(y.adler,T.pending_buf,T.pending-A,A)),$(y),A=T.pending,T.pending===T.pending_buf_size)){F=1;break}F=T.gzindex<T.gzhead.name.length?255&T.gzhead.name.charCodeAt(T.gzindex++):0,ce(T,F)}while(F!==0);T.gzhead.hcrc&&T.pending>A&&(y.adler=u(y.adler,T.pending_buf,T.pending-A,A)),F===0&&(T.gzindex=0,T.status=91)}else T.status=91;if(T.status===91)if(T.gzhead.comment){A=T.pending;do{if(T.pending===T.pending_buf_size&&(T.gzhead.hcrc&&T.pending>A&&(y.adler=u(y.adler,T.pending_buf,T.pending-A,A)),$(y),A=T.pending,T.pending===T.pending_buf_size)){F=1;break}F=T.gzindex<T.gzhead.comment.length?255&T.gzhead.comment.charCodeAt(T.gzindex++):0,ce(T,F)}while(F!==0);T.gzhead.hcrc&&T.pending>A&&(y.adler=u(y.adler,T.pending_buf,T.pending-A,A)),F===0&&(T.status=103)}else T.status=103;if(T.status===103&&(T.gzhead.hcrc?(T.pending+2>T.pending_buf_size&&$(y),T.pending+2<=T.pending_buf_size&&(ce(T,255&y.adler),ce(T,y.adler>>8&255),y.adler=0,T.status=v)):T.status=v),T.pending!==0){if($(y),y.avail_out===0)return T.last_flush=-1,f}else if(y.avail_in===0&&H(K)<=H(G)&&K!==d)return J(y,-5);if(T.status===666&&y.avail_in!==0)return J(y,-5);if(y.avail_in!==0||T.lookahead!==0||K!==h&&T.status!==666){var Z=T.strategy===2?function(z,ne){for(var ue;;){if(z.lookahead===0&&(ve(z),z.lookahead===0)){if(ne===h)return g;break}if(z.match_length=0,ue=a._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,ue&&(D(z,!1),z.strm.avail_out===0))return g}return z.insert=0,ne===d?(D(z,!0),z.strm.avail_out===0?W:M):z.last_lit&&(D(z,!1),z.strm.avail_out===0)?g:N}(T,K):T.strategy===3?function(z,ne){for(var ue,re,de,Je,Ue=z.window;;){if(z.lookahead<=q){if(ve(z),z.lookahead<=q&&ne===h)return g;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=L&&0<z.strstart&&(re=Ue[de=z.strstart-1])===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]){Je=z.strstart+q;do;while(re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&re===Ue[++de]&&de<Je);z.match_length=q-(Je-de),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=L?(ue=a._tr_tally(z,1,z.match_length-L),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(ue=a._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),ue&&(D(z,!1),z.strm.avail_out===0))return g}return z.insert=0,ne===d?(D(z,!0),z.strm.avail_out===0?W:M):z.last_lit&&(D(z,!1),z.strm.avail_out===0)?g:N}(T,K):s[T.level].func(T,K);if(Z!==W&&Z!==M||(T.status=666),Z===g||Z===W)return y.avail_out===0&&(T.last_flush=-1),f;if(Z===N&&(K===1?a._tr_align(T):K!==5&&(a._tr_stored_block(T,0,0,!1),K===3&&(ee(T.head),T.lookahead===0&&(T.strstart=0,T.block_start=0,T.insert=0))),$(y),y.avail_out===0))return T.last_flush=-1,f}return K!==d?f:T.wrap<=0?1:(T.wrap===2?(ce(T,255&y.adler),ce(T,y.adler>>8&255),ce(T,y.adler>>16&255),ce(T,y.adler>>24&255),ce(T,255&y.total_in),ce(T,y.total_in>>8&255),ce(T,y.total_in>>16&255),ce(T,y.total_in>>24&255)):(Q(T,y.adler>>>16),Q(T,65535&y.adler)),$(y),0<T.wrap&&(T.wrap=-T.wrap),T.pending!==0?f:1)},i.deflateEnd=function(y){var K;return y&&y.state?(K=y.state.status)!==x&&K!==69&&K!==73&&K!==91&&K!==103&&K!==v&&K!==666?J(y,p):(y.state=null,K===v?J(y,-3):f):p},i.deflateSetDictionary=function(y,K){var G,T,A,F,X,Z,z,ne,ue=K.length;if(!y||!y.state||(F=(G=y.state).wrap)===2||F===1&&G.status!==x||G.lookahead)return p;for(F===1&&(y.adler=c(y.adler,K,ue,0)),G.wrap=0,ue>=G.w_size&&(F===0&&(ee(G.head),G.strstart=0,G.block_start=0,G.insert=0),ne=new o.Buf8(G.w_size),o.arraySet(ne,K,ue-G.w_size,G.w_size,0),K=ne,ue=G.w_size),X=y.avail_in,Z=y.next_in,z=y.input,y.avail_in=ue,y.next_in=0,y.input=K,ve(G);G.lookahead>=L;){for(T=G.strstart,A=G.lookahead-(L-1);G.ins_h=(G.ins_h<<G.hash_shift^G.window[T+L-1])&G.hash_mask,G.prev[T&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=T,T++,--A;);G.strstart=T,G.lookahead=L-1,ve(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=L-1,G.match_available=0,y.next_in=Z,y.input=z,y.avail_in=X,G.wrap=F,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,d,f,p,m,b,_,w,E,S,C,I,R,B,L,q,ie,x,v,g,N;a=s.state,c=s.next_in,g=s.input,u=c+(s.avail_in-5),l=s.next_out,N=s.output,h=l-(o-s.avail_out),d=l+(s.avail_out-257),f=a.dmax,p=a.wsize,m=a.whave,b=a.wnext,_=a.window,w=a.hold,E=a.bits,S=a.lencode,C=a.distcode,I=(1<<a.lenbits)-1,R=(1<<a.distbits)-1;e:do{E<15&&(w+=g[c++]<<E,E+=8,w+=g[c++]<<E,E+=8),B=S[w&I];t:for(;;){if(w>>>=L=B>>>24,E-=L,(L=B>>>16&255)===0)N[l++]=65535&B;else{if(!(16&L)){if(!(64&L)){B=S[(65535&B)+(w&(1<<L)-1)];continue t}if(32&L){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}q=65535&B,(L&=15)&&(E<L&&(w+=g[c++]<<E,E+=8),q+=w&(1<<L)-1,w>>>=L,E-=L),E<15&&(w+=g[c++]<<E,E+=8,w+=g[c++]<<E,E+=8),B=C[w&R];n:for(;;){if(w>>>=L=B>>>24,E-=L,!(16&(L=B>>>16&255))){if(!(64&L)){B=C[(65535&B)+(w&(1<<L)-1)];continue n}s.msg="invalid distance code",a.mode=30;break e}if(ie=65535&B,E<(L&=15)&&(w+=g[c++]<<E,(E+=8)<L&&(w+=g[c++]<<E,E+=8)),f<(ie+=w&(1<<L)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(w>>>=L,E-=L,(L=l-h)<ie){if(m<(L=ie-L)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(v=_,(x=0)===b){if(x+=p-L,L<q){for(q-=L;N[l++]=_[x++],--L;);x=l-ie,v=N}}else if(b<L){if(x+=p+b-L,(L-=b)<q){for(q-=L;N[l++]=_[x++],--L;);if(x=0,b<q){for(q-=L=b;N[l++]=_[x++],--L;);x=l-ie,v=N}}}else if(x+=b-L,L<q){for(q-=L;N[l++]=_[x++],--L;);x=l-ie,v=N}for(;2<q;)N[l++]=v[x++],N[l++]=v[x++],N[l++]=v[x++],q-=3;q&&(N[l++]=v[x++],1<q&&(N[l++]=v[x++]))}else{for(x=l-ie;N[l++]=N[x++],N[l++]=N[x++],N[l++]=N[x++],2<(q-=3););q&&(N[l++]=N[x++],1<q&&(N[l++]=N[x++]))}break}}break}}while(c<u&&l<d);c-=q=E>>3,w&=(1<<(E-=q<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<d?d-l+257:257-(l-d),a.hold=w,a.bits=E}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,d=0,f=-2,p=1,m=852,b=592;function _(x){return(x>>>24&255)+(x>>>8&65280)+((65280&x)<<8)+((255&x)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(x){var v;return x&&x.state?(v=x.state,x.total_in=x.total_out=v.total=0,x.msg="",v.wrap&&(x.adler=1&v.wrap),v.mode=p,v.last=0,v.havedict=0,v.dmax=32768,v.head=null,v.hold=0,v.bits=0,v.lencode=v.lendyn=new s.Buf32(m),v.distcode=v.distdyn=new s.Buf32(b),v.sane=1,v.back=-1,d):f}function S(x){var v;return x&&x.state?((v=x.state).wsize=0,v.whave=0,v.wnext=0,E(x)):f}function C(x,v){var g,N;return x&&x.state?(N=x.state,v<0?(g=0,v=-v):(g=1+(v>>4),v<48&&(v&=15)),v&&(v<8||15<v)?f:(N.window!==null&&N.wbits!==v&&(N.window=null),N.wrap=g,N.wbits=v,S(x))):f}function I(x,v){var g,N;return x?(N=new w,(x.state=N).window=null,(g=C(x,v))!==d&&(x.state=null),g):f}var R,B,L=!0;function q(x){if(L){var v;for(R=new s.Buf32(512),B=new s.Buf32(32),v=0;v<144;)x.lens[v++]=8;for(;v<256;)x.lens[v++]=9;for(;v<280;)x.lens[v++]=7;for(;v<288;)x.lens[v++]=8;for(u(l,x.lens,0,288,R,0,x.work,{bits:9}),v=0;v<32;)x.lens[v++]=5;u(h,x.lens,0,32,B,0,x.work,{bits:5}),L=!1}x.lencode=R,x.lenbits=9,x.distcode=B,x.distbits=5}function ie(x,v,g,N){var W,M=x.state;return M.window===null&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new s.Buf8(M.wsize)),N>=M.wsize?(s.arraySet(M.window,v,g-M.wsize,M.wsize,0),M.wnext=0,M.whave=M.wsize):(N<(W=M.wsize-M.wnext)&&(W=N),s.arraySet(M.window,v,g-N,W,M.wnext),(N-=W)?(s.arraySet(M.window,v,g-N,N,0),M.wnext=N,M.whave=M.wsize):(M.wnext+=W,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=W))),0}i.inflateReset=S,i.inflateReset2=C,i.inflateResetKeep=E,i.inflateInit=function(x){return I(x,15)},i.inflateInit2=I,i.inflate=function(x,v){var g,N,W,M,J,H,ee,$,D,ce,Q,te,ve,Fe,we,be,Ge,je,mt,Et,y,K,G,T,A=0,F=new s.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!x||!x.state||!x.output||!x.input&&x.avail_in!==0)return f;(g=x.state).mode===12&&(g.mode=13),J=x.next_out,W=x.output,ee=x.avail_out,M=x.next_in,N=x.input,H=x.avail_in,$=g.hold,D=g.bits,ce=H,Q=ee,K=d;e:for(;;)switch(g.mode){case p:if(g.wrap===0){g.mode=13;break}for(;D<16;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if(2&g.wrap&&$===35615){F[g.check=0]=255&$,F[1]=$>>>8&255,g.check=a(g.check,F,2,0),D=$=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&$)<<8)+($>>8))%31){x.msg="incorrect header check",g.mode=30;break}if((15&$)!=8){x.msg="unknown compression method",g.mode=30;break}if(D-=4,y=8+(15&($>>>=4)),g.wbits===0)g.wbits=y;else if(y>g.wbits){x.msg="invalid window size",g.mode=30;break}g.dmax=1<<y,x.adler=g.check=1,g.mode=512&$?10:12,D=$=0;break;case 2:for(;D<16;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if(g.flags=$,(255&g.flags)!=8){x.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){x.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=$>>8&1),512&g.flags&&(F[0]=255&$,F[1]=$>>>8&255,g.check=a(g.check,F,2,0)),D=$=0,g.mode=3;case 3:for(;D<32;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}g.head&&(g.head.time=$),512&g.flags&&(F[0]=255&$,F[1]=$>>>8&255,F[2]=$>>>16&255,F[3]=$>>>24&255,g.check=a(g.check,F,4,0)),D=$=0,g.mode=4;case 4:for(;D<16;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}g.head&&(g.head.xflags=255&$,g.head.os=$>>8),512&g.flags&&(F[0]=255&$,F[1]=$>>>8&255,g.check=a(g.check,F,2,0)),D=$=0,g.mode=5;case 5:if(1024&g.flags){for(;D<16;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}g.length=$,g.head&&(g.head.extra_len=$),512&g.flags&&(F[0]=255&$,F[1]=$>>>8&255,g.check=a(g.check,F,2,0)),D=$=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(H<(te=g.length)&&(te=H),te&&(g.head&&(y=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),s.arraySet(g.head.extra,N,M,te,y)),512&g.flags&&(g.check=a(g.check,N,te,M)),H-=te,M+=te,g.length-=te),g.length))break e;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(H===0)break e;for(te=0;y=N[M+te++],g.head&&y&&g.length<65536&&(g.head.name+=String.fromCharCode(y)),y&&te<H;);if(512&g.flags&&(g.check=a(g.check,N,te,M)),H-=te,M+=te,y)break e}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(H===0)break e;for(te=0;y=N[M+te++],g.head&&y&&g.length<65536&&(g.head.comment+=String.fromCharCode(y)),y&&te<H;);if(512&g.flags&&(g.check=a(g.check,N,te,M)),H-=te,M+=te,y)break e}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;D<16;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if($!==(65535&g.check)){x.msg="header crc mismatch",g.mode=30;break}D=$=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),x.adler=g.check=0,g.mode=12;break;case 10:for(;D<32;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}x.adler=g.check=_($),D=$=0,g.mode=11;case 11:if(g.havedict===0)return x.next_out=J,x.avail_out=ee,x.next_in=M,x.avail_in=H,g.hold=$,g.bits=D,2;x.adler=g.check=1,g.mode=12;case 12:if(v===5||v===6)break e;case 13:if(g.last){$>>>=7&D,D-=7&D,g.mode=27;break}for(;D<3;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}switch(g.last=1&$,D-=1,3&($>>>=1)){case 0:g.mode=14;break;case 1:if(q(g),g.mode=20,v!==6)break;$>>>=2,D-=2;break e;case 2:g.mode=17;break;case 3:x.msg="invalid block type",g.mode=30}$>>>=2,D-=2;break;case 14:for($>>>=7&D,D-=7&D;D<32;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if((65535&$)!=($>>>16^65535)){x.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&$,D=$=0,g.mode=15,v===6)break e;case 15:g.mode=16;case 16:if(te=g.length){if(H<te&&(te=H),ee<te&&(te=ee),te===0)break e;s.arraySet(W,N,M,te,J),H-=te,M+=te,ee-=te,J+=te,g.length-=te;break}g.mode=12;break;case 17:for(;D<14;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if(g.nlen=257+(31&$),$>>>=5,D-=5,g.ndist=1+(31&$),$>>>=5,D-=5,g.ncode=4+(15&$),$>>>=4,D-=4,286<g.nlen||30<g.ndist){x.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;D<3;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}g.lens[X[g.have++]]=7&$,$>>>=3,D-=3}for(;g.have<19;)g.lens[X[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,G={bits:g.lenbits},K=u(0,g.lens,0,19,g.lencode,0,g.work,G),g.lenbits=G.bits,K){x.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;be=(A=g.lencode[$&(1<<g.lenbits)-1])>>>16&255,Ge=65535&A,!((we=A>>>24)<=D);){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if(Ge<16)$>>>=we,D-=we,g.lens[g.have++]=Ge;else{if(Ge===16){for(T=we+2;D<T;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if($>>>=we,D-=we,g.have===0){x.msg="invalid bit length repeat",g.mode=30;break}y=g.lens[g.have-1],te=3+(3&$),$>>>=2,D-=2}else if(Ge===17){for(T=we+3;D<T;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}D-=we,y=0,te=3+(7&($>>>=we)),$>>>=3,D-=3}else{for(T=we+7;D<T;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}D-=we,y=0,te=11+(127&($>>>=we)),$>>>=7,D-=7}if(g.have+te>g.nlen+g.ndist){x.msg="invalid bit length repeat",g.mode=30;break}for(;te--;)g.lens[g.have++]=y}}if(g.mode===30)break;if(g.lens[256]===0){x.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,G={bits:g.lenbits},K=u(l,g.lens,0,g.nlen,g.lencode,0,g.work,G),g.lenbits=G.bits,K){x.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,G={bits:g.distbits},K=u(h,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,G),g.distbits=G.bits,K){x.msg="invalid distances set",g.mode=30;break}if(g.mode=20,v===6)break e;case 20:g.mode=21;case 21:if(6<=H&&258<=ee){x.next_out=J,x.avail_out=ee,x.next_in=M,x.avail_in=H,g.hold=$,g.bits=D,c(x,Q),J=x.next_out,W=x.output,ee=x.avail_out,M=x.next_in,N=x.input,H=x.avail_in,$=g.hold,D=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;be=(A=g.lencode[$&(1<<g.lenbits)-1])>>>16&255,Ge=65535&A,!((we=A>>>24)<=D);){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if(be&&!(240&be)){for(je=we,mt=be,Et=Ge;be=(A=g.lencode[Et+(($&(1<<je+mt)-1)>>je)])>>>16&255,Ge=65535&A,!(je+(we=A>>>24)<=D);){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}$>>>=je,D-=je,g.back+=je}if($>>>=we,D-=we,g.back+=we,g.length=Ge,be===0){g.mode=26;break}if(32&be){g.back=-1,g.mode=12;break}if(64&be){x.msg="invalid literal/length code",g.mode=30;break}g.extra=15&be,g.mode=22;case 22:if(g.extra){for(T=g.extra;D<T;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}g.length+=$&(1<<g.extra)-1,$>>>=g.extra,D-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;be=(A=g.distcode[$&(1<<g.distbits)-1])>>>16&255,Ge=65535&A,!((we=A>>>24)<=D);){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if(!(240&be)){for(je=we,mt=be,Et=Ge;be=(A=g.distcode[Et+(($&(1<<je+mt)-1)>>je)])>>>16&255,Ge=65535&A,!(je+(we=A>>>24)<=D);){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}$>>>=je,D-=je,g.back+=je}if($>>>=we,D-=we,g.back+=we,64&be){x.msg="invalid distance code",g.mode=30;break}g.offset=Ge,g.extra=15&be,g.mode=24;case 24:if(g.extra){for(T=g.extra;D<T;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}g.offset+=$&(1<<g.extra)-1,$>>>=g.extra,D-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){x.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(ee===0)break e;if(te=Q-ee,g.offset>te){if((te=g.offset-te)>g.whave&&g.sane){x.msg="invalid distance too far back",g.mode=30;break}ve=te>g.wnext?(te-=g.wnext,g.wsize-te):g.wnext-te,te>g.length&&(te=g.length),Fe=g.window}else Fe=W,ve=J-g.offset,te=g.length;for(ee<te&&(te=ee),ee-=te,g.length-=te;W[J++]=Fe[ve++],--te;);g.length===0&&(g.mode=21);break;case 26:if(ee===0)break e;W[J++]=g.length,ee--,g.mode=21;break;case 27:if(g.wrap){for(;D<32;){if(H===0)break e;H--,$|=N[M++]<<D,D+=8}if(Q-=ee,x.total_out+=Q,g.total+=Q,Q&&(x.adler=g.check=g.flags?a(g.check,W,Q,J-Q):o(g.check,W,Q,J-Q)),Q=ee,(g.flags?$:_($))!==g.check){x.msg="incorrect data check",g.mode=30;break}D=$=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;D<32;){if(H===0)break e;H--,$+=N[M++]<<D,D+=8}if($!==(4294967295&g.total)){x.msg="incorrect length check",g.mode=30;break}D=$=0}g.mode=29;case 29:K=1;break e;case 30:K=-3;break e;case 31:return-4;case 32:default:return f}return x.next_out=J,x.avail_out=ee,x.next_in=M,x.avail_in=H,g.hold=$,g.bits=D,(g.wsize||Q!==x.avail_out&&g.mode<30&&(g.mode<27||v!==4))&&ie(x,x.output,x.next_out,Q-x.avail_out)?(g.mode=31,-4):(ce-=x.avail_in,Q-=x.avail_out,x.total_in+=ce,x.total_out+=Q,g.total+=Q,g.wrap&&Q&&(x.adler=g.check=g.flags?a(g.check,W,Q,x.next_out-Q):o(g.check,W,Q,x.next_out-Q)),x.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(ce==0&&Q===0||v===4)&&K===d&&(K=-5),K)},i.inflateEnd=function(x){if(!x||!x.state)return f;var v=x.state;return v.window&&(v.window=null),x.state=null,d},i.inflateGetHeader=function(x,v){var g;return x&&x.state&&2&(g=x.state).wrap?((g.head=v).done=!1,d):f},i.inflateSetDictionary=function(x,v){var g,N=v.length;return x&&x.state?(g=x.state).wrap!==0&&g.mode!==11?f:g.mode===11&&o(1,v,N,0)!==g.check?-3:ie(x,v,N,N)?(g.mode=31,-4):(g.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,d,f,p,m,b,_){var w,E,S,C,I,R,B,L,q,ie=_.bits,x=0,v=0,g=0,N=0,W=0,M=0,J=0,H=0,ee=0,$=0,D=null,ce=0,Q=new s.Buf16(16),te=new s.Buf16(16),ve=null,Fe=0;for(x=0;x<=15;x++)Q[x]=0;for(v=0;v<f;v++)Q[h[d+v]]++;for(W=ie,N=15;1<=N&&Q[N]===0;N--);if(N<W&&(W=N),N===0)return p[m++]=20971520,p[m++]=20971520,_.bits=1,0;for(g=1;g<N&&Q[g]===0;g++);for(W<g&&(W=g),x=H=1;x<=15;x++)if(H<<=1,(H-=Q[x])<0)return-1;if(0<H&&(l===0||N!==1))return-1;for(te[1]=0,x=1;x<15;x++)te[x+1]=te[x]+Q[x];for(v=0;v<f;v++)h[d+v]!==0&&(b[te[h[d+v]]++]=v);if(R=l===0?(D=ve=b,19):l===1?(D=o,ce-=257,ve=a,Fe-=257,256):(D=c,ve=u,-1),x=g,I=m,J=v=$=0,S=-1,C=(ee=1<<(M=W))-1,l===1&&852<ee||l===2&&592<ee)return 1;for(;;){for(B=x-J,q=b[v]<R?(L=0,b[v]):b[v]>R?(L=ve[Fe+b[v]],D[ce+b[v]]):(L=96,0),w=1<<x-J,g=E=1<<M;p[I+($>>J)+(E-=w)]=B<<24|L<<16|q|0,E!==0;);for(w=1<<x-1;$&w;)w>>=1;if(w!==0?($&=w-1,$+=w):$=0,v++,--Q[x]==0){if(x===N)break;x=h[d+b[v]]}if(W<x&&($&C)!==S){for(J===0&&(J=W),I+=g,H=1<<(M=x-J);M+J<N&&!((H-=Q[M+J])<=0);)M++,H<<=1;if(ee+=1<<M,l===1&&852<ee||l===2&&592<ee)return 1;p[S=$&C]=W<<24|M<<16|I-m|0}}return $!==0&&(p[I+$]=x-J<<24|64<<16|0),_.bits=W,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(A){for(var F=A.length;0<=--F;)A[F]=0}var u=0,l=29,h=256,d=h+1+l,f=30,p=19,m=2*d+1,b=15,_=16,w=7,E=256,S=16,C=17,I=18,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ie=new Array(2*(d+2));c(ie);var x=new Array(2*f);c(x);var v=new Array(512);c(v);var g=new Array(256);c(g);var N=new Array(l);c(N);var W,M,J,H=new Array(f);function ee(A,F,X,Z,z){this.static_tree=A,this.extra_bits=F,this.extra_base=X,this.elems=Z,this.max_length=z,this.has_stree=A&&A.length}function $(A,F){this.dyn_tree=A,this.max_code=0,this.stat_desc=F}function D(A){return A<256?v[A]:v[256+(A>>>7)]}function ce(A,F){A.pending_buf[A.pending++]=255&F,A.pending_buf[A.pending++]=F>>>8&255}function Q(A,F,X){A.bi_valid>_-X?(A.bi_buf|=F<<A.bi_valid&65535,ce(A,A.bi_buf),A.bi_buf=F>>_-A.bi_valid,A.bi_valid+=X-_):(A.bi_buf|=F<<A.bi_valid&65535,A.bi_valid+=X)}function te(A,F,X){Q(A,X[2*F],X[2*F+1])}function ve(A,F){for(var X=0;X|=1&A,A>>>=1,X<<=1,0<--F;);return X>>>1}function Fe(A,F,X){var Z,z,ne=new Array(b+1),ue=0;for(Z=1;Z<=b;Z++)ne[Z]=ue=ue+X[Z-1]<<1;for(z=0;z<=F;z++){var re=A[2*z+1];re!==0&&(A[2*z]=ve(ne[re]++,re))}}function we(A){var F;for(F=0;F<d;F++)A.dyn_ltree[2*F]=0;for(F=0;F<f;F++)A.dyn_dtree[2*F]=0;for(F=0;F<p;F++)A.bl_tree[2*F]=0;A.dyn_ltree[2*E]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0}function be(A){8<A.bi_valid?ce(A,A.bi_buf):0<A.bi_valid&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0}function Ge(A,F,X,Z){var z=2*F,ne=2*X;return A[z]<A[ne]||A[z]===A[ne]&&Z[F]<=Z[X]}function je(A,F,X){for(var Z=A.heap[X],z=X<<1;z<=A.heap_len&&(z<A.heap_len&&Ge(F,A.heap[z+1],A.heap[z],A.depth)&&z++,!Ge(F,Z,A.heap[z],A.depth));)A.heap[X]=A.heap[z],X=z,z<<=1;A.heap[X]=Z}function mt(A,F,X){var Z,z,ne,ue,re=0;if(A.last_lit!==0)for(;Z=A.pending_buf[A.d_buf+2*re]<<8|A.pending_buf[A.d_buf+2*re+1],z=A.pending_buf[A.l_buf+re],re++,Z===0?te(A,z,F):(te(A,(ne=g[z])+h+1,F),(ue=R[ne])!==0&&Q(A,z-=N[ne],ue),te(A,ne=D(--Z),X),(ue=B[ne])!==0&&Q(A,Z-=H[ne],ue)),re<A.last_lit;);te(A,E,F)}function Et(A,F){var X,Z,z,ne=F.dyn_tree,ue=F.stat_desc.static_tree,re=F.stat_desc.has_stree,de=F.stat_desc.elems,Je=-1;for(A.heap_len=0,A.heap_max=m,X=0;X<de;X++)ne[2*X]!==0?(A.heap[++A.heap_len]=Je=X,A.depth[X]=0):ne[2*X+1]=0;for(;A.heap_len<2;)ne[2*(z=A.heap[++A.heap_len]=Je<2?++Je:0)]=1,A.depth[z]=0,A.opt_len--,re&&(A.static_len-=ue[2*z+1]);for(F.max_code=Je,X=A.heap_len>>1;1<=X;X--)je(A,ne,X);for(z=de;X=A.heap[1],A.heap[1]=A.heap[A.heap_len--],je(A,ne,1),Z=A.heap[1],A.heap[--A.heap_max]=X,A.heap[--A.heap_max]=Z,ne[2*z]=ne[2*X]+ne[2*Z],A.depth[z]=(A.depth[X]>=A.depth[Z]?A.depth[X]:A.depth[Z])+1,ne[2*X+1]=ne[2*Z+1]=z,A.heap[1]=z++,je(A,ne,1),2<=A.heap_len;);A.heap[--A.heap_max]=A.heap[1],function(Ue,kn){var bo,sr,wo,ut,Oc,Vh,Cr=kn.dyn_tree,F_=kn.max_code,jM=kn.stat_desc.static_tree,zM=kn.stat_desc.has_stree,WM=kn.stat_desc.extra_bits,$_=kn.stat_desc.extra_base,vo=kn.stat_desc.max_length,Cc=0;for(ut=0;ut<=b;ut++)Ue.bl_count[ut]=0;for(Cr[2*Ue.heap[Ue.heap_max]+1]=0,bo=Ue.heap_max+1;bo<m;bo++)vo<(ut=Cr[2*Cr[2*(sr=Ue.heap[bo])+1]+1]+1)&&(ut=vo,Cc++),Cr[2*sr+1]=ut,F_<sr||(Ue.bl_count[ut]++,Oc=0,$_<=sr&&(Oc=WM[sr-$_]),Vh=Cr[2*sr],Ue.opt_len+=Vh*(ut+Oc),zM&&(Ue.static_len+=Vh*(jM[2*sr+1]+Oc)));if(Cc!==0){do{for(ut=vo-1;Ue.bl_count[ut]===0;)ut--;Ue.bl_count[ut]--,Ue.bl_count[ut+1]+=2,Ue.bl_count[vo]--,Cc-=2}while(0<Cc);for(ut=vo;ut!==0;ut--)for(sr=Ue.bl_count[ut];sr!==0;)F_<(wo=Ue.heap[--bo])||(Cr[2*wo+1]!==ut&&(Ue.opt_len+=(ut-Cr[2*wo+1])*Cr[2*wo],Cr[2*wo+1]=ut),sr--)}}(A,F),Fe(ne,Je,A.bl_count)}function y(A,F,X){var Z,z,ne=-1,ue=F[1],re=0,de=7,Je=4;for(ue===0&&(de=138,Je=3),F[2*(X+1)+1]=65535,Z=0;Z<=X;Z++)z=ue,ue=F[2*(Z+1)+1],++re<de&&z===ue||(re<Je?A.bl_tree[2*z]+=re:z!==0?(z!==ne&&A.bl_tree[2*z]++,A.bl_tree[2*S]++):re<=10?A.bl_tree[2*C]++:A.bl_tree[2*I]++,ne=z,Je=(re=0)===ue?(de=138,3):z===ue?(de=6,3):(de=7,4))}function K(A,F,X){var Z,z,ne=-1,ue=F[1],re=0,de=7,Je=4;for(ue===0&&(de=138,Je=3),Z=0;Z<=X;Z++)if(z=ue,ue=F[2*(Z+1)+1],!(++re<de&&z===ue)){if(re<Je)for(;te(A,z,A.bl_tree),--re!=0;);else z!==0?(z!==ne&&(te(A,z,A.bl_tree),re--),te(A,S,A.bl_tree),Q(A,re-3,2)):re<=10?(te(A,C,A.bl_tree),Q(A,re-3,3)):(te(A,I,A.bl_tree),Q(A,re-11,7));ne=z,Je=(re=0)===ue?(de=138,3):z===ue?(de=6,3):(de=7,4)}}c(H);var G=!1;function T(A,F,X,Z){Q(A,(u<<1)+(Z?1:0),3),function(z,ne,ue,re){be(z),ce(z,ue),ce(z,~ue),s.arraySet(z.pending_buf,z.window,ne,ue,z.pending),z.pending+=ue}(A,F,X)}i._tr_init=function(A){G||(function(){var F,X,Z,z,ne,ue=new Array(b+1);for(z=Z=0;z<l-1;z++)for(N[z]=Z,F=0;F<1<<R[z];F++)g[Z++]=z;for(g[Z-1]=z,z=ne=0;z<16;z++)for(H[z]=ne,F=0;F<1<<B[z];F++)v[ne++]=z;for(ne>>=7;z<f;z++)for(H[z]=ne<<7,F=0;F<1<<B[z]-7;F++)v[256+ne++]=z;for(X=0;X<=b;X++)ue[X]=0;for(F=0;F<=143;)ie[2*F+1]=8,F++,ue[8]++;for(;F<=255;)ie[2*F+1]=9,F++,ue[9]++;for(;F<=279;)ie[2*F+1]=7,F++,ue[7]++;for(;F<=287;)ie[2*F+1]=8,F++,ue[8]++;for(Fe(ie,d+1,ue),F=0;F<f;F++)x[2*F+1]=5,x[2*F]=ve(F,5);W=new ee(ie,R,h+1,d,b),M=new ee(x,B,0,f,b),J=new ee(new Array(0),L,0,p,w)}(),G=!0),A.l_desc=new $(A.dyn_ltree,W),A.d_desc=new $(A.dyn_dtree,M),A.bl_desc=new $(A.bl_tree,J),A.bi_buf=0,A.bi_valid=0,we(A)},i._tr_stored_block=T,i._tr_flush_block=function(A,F,X,Z){var z,ne,ue=0;0<A.level?(A.strm.data_type===2&&(A.strm.data_type=function(re){var de,Je=4093624447;for(de=0;de<=31;de++,Je>>>=1)if(1&Je&&re.dyn_ltree[2*de]!==0)return o;if(re.dyn_ltree[18]!==0||re.dyn_ltree[20]!==0||re.dyn_ltree[26]!==0)return a;for(de=32;de<h;de++)if(re.dyn_ltree[2*de]!==0)return a;return o}(A)),Et(A,A.l_desc),Et(A,A.d_desc),ue=function(re){var de;for(y(re,re.dyn_ltree,re.l_desc.max_code),y(re,re.dyn_dtree,re.d_desc.max_code),Et(re,re.bl_desc),de=p-1;3<=de&&re.bl_tree[2*q[de]+1]===0;de--);return re.opt_len+=3*(de+1)+5+5+4,de}(A),z=A.opt_len+3+7>>>3,(ne=A.static_len+3+7>>>3)<=z&&(z=ne)):z=ne=X+5,X+4<=z&&F!==-1?T(A,F,X,Z):A.strategy===4||ne===z?(Q(A,2+(Z?1:0),3),mt(A,ie,x)):(Q(A,4+(Z?1:0),3),function(re,de,Je,Ue){var kn;for(Q(re,de-257,5),Q(re,Je-1,5),Q(re,Ue-4,4),kn=0;kn<Ue;kn++)Q(re,re.bl_tree[2*q[kn]+1],3);K(re,re.dyn_ltree,de-1),K(re,re.dyn_dtree,Je-1)}(A,A.l_desc.max_code+1,A.d_desc.max_code+1,ue+1),mt(A,A.dyn_ltree,A.dyn_dtree)),we(A),Z&&be(A)},i._tr_tally=function(A,F,X){return A.pending_buf[A.d_buf+2*A.last_lit]=F>>>8&255,A.pending_buf[A.d_buf+2*A.last_lit+1]=255&F,A.pending_buf[A.l_buf+A.last_lit]=255&X,A.last_lit++,F===0?A.dyn_ltree[2*X]++:(A.matches++,F--,A.dyn_ltree[2*(g[X]+h+1)]++,A.dyn_dtree[2*D(F)]++),A.last_lit===A.lit_bufsize-1},i._tr_align=function(A){Q(A,2,3),te(A,E,ie),function(F){F.bi_valid===16?(ce(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):8<=F.bi_valid&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)}(A)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,d=1,f={},p=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(S){process.nextTick(function(){w(S)})}:function(){if(o.postMessage&&!o.importScripts){var S=!0,C=o.onmessage;return o.onmessage=function(){S=!1},o.postMessage("","*"),o.onmessage=C,S}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",E,!1):o.attachEvent("onmessage",E),function(S){o.postMessage(h+S,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(S){w(S.data)},function(S){l.port2.postMessage(S)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(S){var C=m.createElement("script");C.onreadystatechange=function(){w(S),C.onreadystatechange=null,u.removeChild(C),C=null},u.appendChild(C)}):function(S){setTimeout(w,0,S)},b.setImmediate=function(S){typeof S!="function"&&(S=new Function(""+S));for(var C=new Array(arguments.length-1),I=0;I<C.length;I++)C[I]=arguments[I+1];var R={callback:S,args:C};return f[d]=R,c(d),d++},b.clearImmediate=_}function _(S){delete f[S]}function w(S){if(p)setTimeout(w,0,S);else{var C=f[S];if(C){p=!0;try{(function(I){var R=I.callback,B=I.args;switch(B.length){case 0:R();break;case 1:R(B[0]);break;case 2:R(B[0],B[1]);break;case 3:R(B[0],B[1],B[2]);break;default:R.apply(a,B)}})(C)}finally{_(S),p=!1}}}}function E(S){S.source===o&&typeof S.data=="string"&&S.data.indexOf(h)===0&&w(+S.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Ut<"u"?Ut:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(U_);var CM=U_.exports,P_=Ii(CM);function NM(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return e+n}function LM(t){return t.replace(/\+/g,"-").replace(/\//g,"_")}const MM=new Date("1980/09/02");async function UM(t){return new Promise((e,n)=>{const r=new P_;for(let i=0;i<t.length;++i){const s=t[i],o=uN(s);if(o){const a=iN(o);k(a)&&r.file(s.id,a,{date:MM})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{e(LM(i))}).catch(n)})}async function PM(t){return new Promise((e,n)=>{const r=new P_;r.loadAsync(NM(t),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=hN(sN(c));k(u)&&i.push(u)}e(i)}).catch(n)})}const DM=16,Ri={},BM=64;let D_=0;const Or={},os={};async function Hh(t=""){RM();const e=Tc(),n=Gt(We.MAIN);if(e.length&&k(n)){const r=await UM(e),i=`${t}${new Date().toISOString()} ${n.name} ${r.length} chars`;ak(En.name(),i,r,Zr())}}let B_=!1;const En=as("vm",["init","tick","second"],t=>{var e;switch(t.target){case"init":k(t.player)&&!B_&&(B_=!0,t.player,gM(t.player),En.reply(t,"ackinit",!0,t.player));break;case"books":t.player===Zr()&&Gh("vm:books",async()=>{if(ze(t.data)){const[n,r]=t.data,i=await PM(n),s=i.map(o=>o.name);wM(i,r),Qe(En.name(),`loading ${s.join(", ")}`),En.reply(t,"ackbooks",!0,t.player)}});break;case"login":t.player&&EM(t.player)&&(Ri[t.player]=0,Qe(En.name(),`login from ${t.player}`),En.reply(t,"acklogin",!0,t.player));break;case"endgame":t.player===Zr()&&Gh("vm:endgame",async()=>{t.player&&(N_(t.player),ik("vm",t.player),await Hh(),await Cb(1e3),bk(En.name(),t.player))});break;case"doot":t.player&&(Ri[t.player]=0,mp(En.name(),"active",t.player));break;case"input":if(t.player){const n=ss(t.player),[r=Ft.NONE,i=0]=t.data??[Ft.NONE,0];ze(n.inputqueue)||(n.inputqueue=[]),r!==Ft.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(t.player&&ze(t.data)){const[n,r]=t.data;if(!k(os[r])){const i=gp(n,r);os[r]=wp(i,s=>{const o=Jr(n),a=vi(o,r);k(a)&&(a.code=s,lN(a))})}Or[n]=Or[n]??{},Or[n][r]=Or[n][r]??new Set,Or[n][r].add(t.player)}break;case"coderelease":if(t.player&&ze(t.data)){const[n,r]=t.data;k(Or[n])&&k(Or[n][r])&&(Or[n][r].delete(t.player),Or[n][r].size===0&&((e=os[r])==null||e.call(os),os[r]=void 0))}break;case"tick":t.player!=="locked"&&TM();break;case"second":{kM(Ri);const n=Object.keys(Ri);for(let r=0;r<n.length;++r)++Ri[n[r]];for(let r=0;r<n.length;++r){const i=n[r];Ri[i]>=DM&&(delete Ri[i],N_(i),In(En.name(),"player logout",i),En.emit("logout",void 0,i))}Nb()===!1&&++D_>=BM&&(D_=0,zl(En.name(),"",Zr()));break}case"flush":t.player===Zr()&&Gh("vm:flush",async()=>{ke(t.data)?await Hh(`${t.data} `):await Hh()});break;case"cli":t.player===Zr()&&IM(t.player,t.data);break;case"loader":if(t.player===Zr()&&ze(t.data)){const[n,r]=t.data;ke(n)&&iL(n,r)}break;default:SM(t);break}});function FM(){ok(En.name(),Zr())}const{forward:$M}=xb(t=>postMessage(t));onmessage=function(e){$M(e.data)},setTimeout(FM,100)})();

var hM=Object.defineProperty;var fM=(Hr,Nn,_n)=>Nn in Hr?hM(Hr,Nn,{enumerable:!0,configurable:!0,writable:!0,value:_n}):Hr[Nn]=_n;var Ot=(Hr,Nn,_n)=>fM(Hr,typeof Nn!="symbol"?Nn+"":Nn,_n);(function(){"use strict";const Hr=new Set,Nn={emit(e,t,n,r,i){Nn.invoke(Sb(e,t,n,r,i))},invoke(e){switch(e.target){}Hr.forEach(t=>t.handle(e))},connect(e){Hr.add(e)},disconnect(e){Hr.delete(e)}};var _n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function go(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function H1(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var id={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(_n,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var u=r();s=u(" "),o=u(" "),a=u(" ");for(var l=0;l<i.length;l++)s-=u(i[l]),s<0&&(s+=1),o-=u(i[l]),o<0&&(o+=1),a-=u(i[l]),a<0&&(a+=1);u=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(id);var Y1=id.exports,sd=go(Y1),od={};(function(e){var t=_n&&_n.__spreadArray||function(u,l,h){if(h||arguments.length===2)for(var f=0,d=l.length,p;f<d;f++)(p||!(f in l))&&(p||(p=Array.prototype.slice.call(l,0,f)),p[f]=l[f]);return u.concat(p||Array.prototype.slice.call(l))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(u){return u[Math.floor(Math.random()*u.length)]}function r(u){return u.reduce(function(l,h){return l.length>h.length?l:h})}function i(u){return u.reduce(function(l,h){return l.length<h.length?l:h})}function s(u){u===void 0&&(u={}),typeof u=="string"&&(u={separator:u}),typeof u=="boolean"&&(u={capitalize:u});var l=u.separator,h=l===void 0?"":l,f=u.capitalize,d=f===void 0?!0:f,p=u.adjectiveCount,g=p===void 0?1:p,k=u.addAdverb,E=k===void 0?!1:k,T=t(t(t([],t([],Array(g),!0).map(function(v){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),E?[n(e.adverbs)]:[],!0);return d&&(T=T.map(function(v){return v.charAt(0).toUpperCase()+v.substr(1)})),T.join(h)}e.humanId=s;function o(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f;return e.adjectives.length*h*e.nouns.length*e.verbs.length*(d?e.adverbs.length:1)}e.poolSize=o;function a(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,g=p===void 0?"":p;return r(e.adjectives).length*h+h*g.length+r(e.nouns).length+g.length+r(e.verbs).length+(d?r(e.adverbs).length+g.length:0)}e.maxLength=a;function c(u){u===void 0&&(u={});var l=u.adjectiveCount,h=l===void 0?1:l,f=u.addAdverb,d=f===void 0?!1:f,p=u.separator,g=p===void 0?"":p;return i(e.adjectives).length*h+h*g.length+i(e.nouns).length+g.length+i(e.verbs).length+(d?i(e.adverbs).length+g.length:0)}e.minLength=c,e.default=s})(od);var V1=go(od);const q1="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let X1=e=>crypto.getRandomValues(new Uint8Array(e)),J1=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},ad=(e,t=21)=>J1(e,t,X1),Z1=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=q1[n[e]&63];return t};var cd="abcdefghijklmnopqrstuvwxyz",ld="ABCDEFGHIJKLMNOPQRSTUVWXYZ",ud="0123456789",Q1="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",tb="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const eb=ud,nb=cd,rb=ld;var ib=eb+nb+rb,Ll={lowercase:cd,uppercase:ld,numbers:ud,nolookalikes:Q1,nolookalikesSafe:tb,alphanumeric:ib};function Ie(){return`sid_${Z1(12).replaceAll("-",".")}`}ad(Ll.numbers,4),ad(`${Ll.numbers}${Ll.lowercase}`,16);function Es(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function sb(){return V1({capitalize:!1,adjectiveCount:1})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var ob=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),ab=Object.prototype.hasOwnProperty;function Ml(e,t){return ab.call(e,t)}function Ul(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)Ml(e,i)&&r.push(i);return r}function bn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Fl(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function Ki(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function hd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Pl(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Pl(e[t]))return!0}else if(typeof e=="object"){for(var r=Ul(e),i=r.length,s=0;s<i;s++)if(Pl(e[r[s]]))return!0}}return!1}function fd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var dd=function(e){ob(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,fd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=fd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Ae=dd,cb=bn,ws={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=ka(n,this.path);r&&(r=bn(r));var i=Wi(n,{op:"remove",path:this.from}).removed;return Wi(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=ka(n,this.from);return Wi(n,{op:"add",path:this.path,value:bn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:yo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},lb={add:function(e,t,n){return Fl(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:ws.move,copy:ws.copy,test:ws.test,_get:ws._get};function ka(e,t){if(t=="")return e;var n={op:"_get",path:t};return Wi(e,n),n.value}function Wi(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):xa(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=ka(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=yo(e,t.value),o.test===!1)throw new Ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Ae("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=bn(e));var a=t.path||"",c=a.split("/"),u=e,l=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=xa;;){if(d=c[l],d&&d.indexOf("~")!=-1&&(d=hd(d)),i&&(d=="__proto__"||d=="prototype"&&l>0&&c[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&f===void 0&&(u[d]===void 0?f=c.slice(0,l).join("/"):l==h-1&&(f=t.path),f!==void 0&&p(t,0,e,f)),l++,Array.isArray(u)){if(d==="-")d=u.length;else{if(n&&!Fl(d))throw new Ae("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);Fl(d)&&(d=~~d)}if(l>=h){if(n&&t.op==="add"&&d>u.length)throw new Ae("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=lb[t.op].call(t,u,d,e);if(o.test===!1)throw new Ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(l>=h){var o=ws[t.op].call(t,u,d,e);if(o.test===!1)throw new Ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(u=u[d],n&&l<h&&(!u||typeof u!="object"))throw new Ae("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Bl(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Ae("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=bn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=Wi(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function ub(e,t,n){var r=Wi(e,t);if(r.test===!1)throw new Ae("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function xa(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Ae("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(ws[e.op]){if(typeof e.path!="string")throw new Ae("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Ae('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Ae("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Ae("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&Pl(e.value))throw new Ae("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Ae("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Ae("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=pd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Ae("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Ae("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function pd(e,t,n){try{if(!Array.isArray(e))throw new Ae("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Bl(bn(t),bn(e),n||!0);else{n=n||xa;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Ae)return i;throw i}}function yo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!yo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!yo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var hb=Object.freeze({__proto__:null,JsonPatchError:Ae,_areEquals:yo,applyOperation:Wi,applyPatch:Bl,applyReducer:ub,deepClone:cb,getValueByPointer:ka,validate:pd,validator:xa});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Dl=new WeakMap,fb=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),db=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function pb(e){return Dl.get(e)}function mb(e,t){return e.observers.get(t)}function gb(e,t){e.observers.delete(t.callback)}function yb(e,t){t.unobserve()}function _b(e,t){var n=[],r,i=pb(e);if(!i)i=new fb(e),Dl.set(e,i);else{var s=mb(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=bn(e),t){r.callback=t,r.next=null;var o=function(){$l(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){$l(r),clearTimeout(r.next),gb(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new db(t,r)),r}function $l(e,t){t===void 0&&(t=!1);var n=Dl.get(e.object);jl(n.value,e.object,e.patches,"",t),e.patches.length&&Bl(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function jl(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=Ul(t),o=Ul(e),a=!1,c=o.length-1;c>=0;c--){var u=o[c],l=e[u];if(Ml(t,u)&&!(t[u]===void 0&&l!==void 0&&Array.isArray(t)===!1)){var h=t[u];typeof l=="object"&&l!=null&&typeof h=="object"&&h!=null&&Array.isArray(l)===Array.isArray(h)?jl(l,h,n,r+"/"+Ki(u),i):l!==h&&(i&&n.push({op:"test",path:r+"/"+Ki(u),value:bn(l)}),n.push({op:"replace",path:r+"/"+Ki(u),value:bn(h)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Ki(u),value:bn(l)}),n.push({op:"remove",path:r+"/"+Ki(u)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var u=s[c];!Ml(e,u)&&t[u]!==void 0&&n.push({op:"add",path:r+"/"+Ki(u),value:bn(t[u])})}}}function md(e,t,n){n===void 0&&(n=!1);var r=[];return jl(e,t,r,"",n),r}var bb=Object.freeze({__proto__:null,compare:md,generate:$l,observe:_b,unobserve:yb});Object.assign({},hb,bb,{JsonPatchError:dd,deepClone:bn,escapePathComponent:Ki,unescapePathComponent:hd});var Eb=typeof Element<"u",wb=typeof Map=="function",kb=typeof Set=="function",xb=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ta(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ta(e[r],t[r]))return!1;return!0}var s;if(wb&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ta(r.value[1],t.get(r.value[0])))return!1;return!0}if(kb&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(xb&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(Eb&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ta(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var Tb=function(t,n){try{return Ta(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},Ab=go(Tb);function w(e){return e!=null}const mr=Object.keys;function On(e){return bn(e)}function vb(e){return typeof e=="boolean"}function Lt(e){return typeof e=="number"&&isNaN(e)===!1}function St(e){return typeof e=="string"}function ee(e){return Array.isArray(e)}function zl(e){return e}var $t=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))($t||{}),Gt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Gt||{}),jn=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(jn||{}),yt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(yt||{}),Et=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.LINK=11]="LINK",e[e.HOTKEY=12]="HOTKEY",e[e.COPYIT=13]="COPYIT",e[e.OPENIT=14]="OPENIT",e[e.ZSSEDIT=15]="ZSSEDIT",e[e.CHAREDIT=16]="CHAREDIT",e[e.COLOREDIT=17]="COLOREDIT",e))(Et||{});function Ut(e){return e.toLowerCase().trim()}function Sb(e,t,n,r,i){return{session:e,id:Ie(),target:t,sender:n,data:r,player:i}}function Gi(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function ks(e,t=[],n=zl,r=""){const i=Ie(),s=Ut(e),o=t.map(Ut);let a=r;const c={id(){return i},name(){return e},session(u){return w(u)?u.session===a?u.session:"":a},topics(){return t},emit(u,l,h){Nn.emit(a,u,i,l,h)},reply(u,l,h,f){c.emit(`${u.sender}:${l}`,h,f)},replynext(u,l,h,f){setTimeout(()=>c.emit(`${u.sender}:${l}`,h,f),64)},handle(u){const{target:l,path:h}=Gi(u.target),f=Ut(l);!a&&f==="ready"&&(a=u.session),f==="bridge"&&w(u.session)&&(a=u.session),o.findIndex(d=>d==="all"||d===f)!==-1&&n(u),(i===l||f==="all"||s===f)&&n({...u,target:h})}};return Nn.connect(c),c}function Rb(e){return w(e)&&typeof e=="object"&&St(e.id)&&St(e.target)&&St(e.sender)}function oe(e,t,n,r){const i=r??"";return e.emit(`error:${t}`,n,i),eE(e,n,i)}function Ib(e,t,n){e.emit("broadcast:startstream",t,n)}function Nb(e,t){e.emit("broadcast:stopstream",void 0,t)}function Ob(e,t,n){e.emit("chat:connect",t,n)}function Cb(e,t){e.emit("chat:disconnect",void 0,t)}function Lb(e,t,n){e.emit("gadgetclient:paint",t,n)}function Mb(e,t,n){e.emit("gadgetclient:patch",t,n)}function Ub(e,t){e.emit("gadgetserver:clearscroll",void 0,t)}function Fb(e,t,n,r,i,s,o){e.emit("network:fetch",[t,n,r,i,s],o)}function Pb(e,t,n){e.emit("network:start",t,n)}function Bb(e){e.emit("ready")}function Kl(e,t){e.emit("register:loginready",!0,t)}function Db(e,t,n,r){e.emit("register:savemem",[t,n],r)}function $b(e,t,n){e.emit("register:forkmem",[t],n)}function jb(e,t,n){e.emit("register:copy",t,n)}function zb(e,t,n,r){e.emit("register:copyjsonfile",[t,n],r)}function gd(e,t,n,r){e.emit("register:downloadjsonfile",[t,n],r)}function Kb(e,t){e.emit("register:dev",void 0,t)}function Wb(e,t){e.emit("register:share",void 0,t)}function Gb(e,t){e.emit("register:nuke",void 0,t)}function Hb(e,t,n){e.emit("synth:tts",[t,n])}function Yb(e,t){e.emit("synth:tta",[t])}function Vb(e,t,n){e.emit("synth:play",[t,n])}function qb(e,t){e.emit("synth:bpm",t)}function Xb(e,t){e.emit("synth:playvolume",t)}function Jb(e,t){e.emit("synth:bgplayvolume",t)}function Zb(e,t){e.emit("synth:ttsvolume",t)}function Wl(e,t,n,r){e.emit("synth:voice",[t,n,r])}function Qb(e,t,n,r,i){e.emit("synth:voicefx",[t,n,r,i])}function gr(e,...t){return e.emit("tape:info",t),!0}function yd(e,...t){return e.emit("tape:debug",t),!0}function tE(e,t,n){e.emit("tape:inspector",t,n)}function eE(e,...t){return e.emit("tape:error",t),!1}function _d(e,t,n,r,i,s){e.emit("tape:editor:open",[t,n,r,i],s)}function bd(e,t){e.emit("vm:logout",void 0,t)}function Aa(e,t){return`${e}:${t.join(":")}`}function nE(e,t){e.emit("vm:restart",void 0,t)}function Ed(e,t){e.emit("vm:flush",void 0,t)}function rE(e,t){e.emit("vm:fork",void 0,t)}function iE(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function sE(e,t){return{filename:e,json:t}}function oE(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function Gl(e,t,n,r,i,s){let o;switch(n){case"file":o=i;break;case"text":o=iE(r,i);break;case"json":o=sE(r,i);break;case"binary":o=oE(r,i);break}setTimeout(()=>{e.emit("vm:loader",[t,n,r,o],s)},1)}function aE(e){const t=new Set;function n(s){Rb(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Nn.invoke(s))}const r=ks("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Nn.disconnect(r)}return{forward:n,disconnect:i}}const Hl=66.666,va=Math.round(1e3/Hl),cE=3;function lE(e){return new Promise(t=>setTimeout(t,e))}const Yl=ks("clock");let Vl=0,Sa=0,ql=0,wd=performance.now();function kd(){const e=performance.now(),t=e-wd;ql+=t,ql>=Hl&&(ql%=Hl,Yl.emit("tick",Sa),Yl.emit("tock",Sa),++Vl,++Sa,Vl>=va&&(Vl%=va,Yl.emit("second",Sa))),wd=e,setTimeout(kd,2)}kd();const xd=1,Td=2,Xl=4,Jl=8,_o=32,Yr=64,Cn=128,Ra=31,Zl=63,Hi=127,uE=2147483647,_i=Math.floor,Ia=Math.abs,Ad=(e,t)=>e<t?e:t,Yi=(e,t)=>e>t?e:t,vd=e=>e!==0?e<0:1/e<0,Sd=Number.MAX_SAFE_INTEGER,hE=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&_i(e)===e),xs=()=>new Set,Ql=e=>e[e.length-1],fE=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},bi=Array.from,dE=Array.isArray,pE=e=>e.toLowerCase(),mE=/^\s*/g,gE=e=>e.replace(mE,""),yE=/([A-Z])/g,Rd=(e,t)=>gE(e.replace(yE,n=>`${t}${pE(n)}`)),_E=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},bo=typeof TextEncoder<"u"?new TextEncoder:null,bE=bo?e=>bo.encode(e):_E;let Eo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Eo&&Eo.decode(new Uint8Array).length===1&&(Eo=null);const Ei=e=>new Error(e),yr=()=>{throw Ei("Method unimplemented")},_r=()=>{throw Ei("Unexpected case")};class wo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const wi=()=>new wo,EE=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},nr=e=>{const t=new Uint8Array(EE(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},wE=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Yi(n,t)*2),e.cpos=0)},He=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},tu=He,Pt=(e,t)=>{for(;t>Hi;)He(e,Cn|Hi&t),t=_i(t/128);He(e,Hi&t)},eu=(e,t)=>{const n=vd(t);for(n&&(t=-t),He(e,(t>Zl?Cn:0)|(n?Yr:0)|Zl&t),t=_i(t/64);t>0;)He(e,(t>Hi?Cn:0)|Hi&t),t=_i(t/128)},nu=new Uint8Array(3e4),kE=nu.length/3,xE=(e,t)=>{if(t.length<kE){const n=bo.encodeInto(t,nu).written||0;Pt(e,n);for(let r=0;r<n;r++)He(e,nu[r])}else nn(e,bE(t))},TE=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;Pt(e,r);for(let i=0;i<r;i++)He(e,n.codePointAt(i))},Ts=bo&&bo.encodeInto?xE:TE,Na=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=Ad(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Yi(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},nn=(e,t)=>{Pt(e,t.byteLength),Na(e,t)},ru=(e,t)=>{wE(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},AE=(e,t)=>ru(e,4).setFloat32(0,t,!1),vE=(e,t)=>ru(e,8).setFloat64(0,t,!1),SE=(e,t)=>ru(e,8).setBigInt64(0,t,!1),Id=new DataView(new ArrayBuffer(4)),RE=e=>(Id.setFloat32(0,e),Id.getFloat32(0)===e),ko=(e,t)=>{switch(typeof t){case"string":He(e,119),Ts(e,t);break;case"number":hE(t)&&Ia(t)<=uE?(He(e,125),eu(e,t)):RE(t)?(He(e,124),AE(e,t)):(He(e,123),vE(e,t));break;case"bigint":He(e,122),SE(e,t);break;case"object":if(t===null)He(e,126);else if(dE(t)){He(e,117),Pt(e,t.length);for(let n=0;n<t.length;n++)ko(e,t[n])}else if(t instanceof Uint8Array)He(e,116),nn(e,t);else{He(e,118);const n=Object.keys(t);Pt(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ts(e,i),ko(e,t[i])}}break;case"boolean":He(e,t?120:121);break;default:He(e,127)}};class Nd extends wo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&Pt(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Od=e=>{e.count>0&&(eu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&Pt(e.encoder,e.count-2))};class Oa{constructor(){this.encoder=new wo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Od(this),this.count=1,this.s=t)}toUint8Array(){return Od(this),nr(this.encoder)}}const Cd=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);eu(e.encoder,t),e.count>1&&Pt(e.encoder,e.count-2)}};class iu{constructor(){this.encoder=new wo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Cd(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Cd(this),nr(this.encoder)}}class IE{constructor(){this.sarr=[],this.s="",this.lensE=new Oa}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new wo;return this.sarr.push(this.s),this.s="",Ts(t,this.sarr.join("")),Na(t,this.lensE.toUint8Array()),nr(t)}}const Ld=Ei("Unexpected end of array"),Md=Ei("Integer out of Range");class Ca{constructor(t){this.arr=t,this.pos=0}}const Vi=e=>new Ca(e),NE=e=>e.pos!==e.arr.length,OE=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},ln=e=>OE(e,Bt(e)),As=e=>e.arr[e.pos++],Bt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&Hi)*n,n*=128,i<Cn)return t;if(t>Sd)throw Md}throw Ld},su=e=>{let t=e.arr[e.pos++],n=t&Zl,r=64;const i=(t&Yr)>0?-1:1;if(!(t&Cn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&Hi)*r,r*=128,t<Cn)return i*n;if(n>Sd)throw Md}throw Ld},vs=Eo?e=>Eo.decode(ln(e)):e=>{let t=Bt(e);if(t===0)return"";{let n=String.fromCodePoint(As(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(As(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},ou=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},CE=[e=>{},e=>null,su,e=>ou(e,4).getFloat32(0,!1),e=>ou(e,8).getFloat64(0,!1),e=>ou(e,8).getBigInt64(0,!1),e=>!1,e=>!0,vs,e=>{const t=Bt(e),n={};for(let r=0;r<t;r++){const i=vs(e);n[i]=xo(e)}return n},e=>{const t=Bt(e),n=[];for(let r=0;r<t;r++)n.push(xo(e));return n},ln],xo=e=>CE[127-As(e)](e);class Ud extends Ca{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),NE(this)?this.count=Bt(this)+1:this.count=-1),this.count--,this.s}}class La extends Ca{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=su(this);const t=vd(this.s);this.count=1,t&&(this.s=-this.s,this.count=Bt(this)+2)}return this.count--,this.s}}class au extends Ca{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=su(this),n=t&1;this.diff=_i(t/2),this.count=1,n&&(this.count=Bt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class LE{constructor(t){this.decoder=new La(t),this.str=vs(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}var Ht={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var To=Symbol.for("react.element"),ME=Symbol.for("react.portal"),UE=Symbol.for("react.fragment"),FE=Symbol.for("react.strict_mode"),PE=Symbol.for("react.profiler"),BE=Symbol.for("react.provider"),DE=Symbol.for("react.context"),$E=Symbol.for("react.forward_ref"),jE=Symbol.for("react.suspense"),zE=Symbol.for("react.memo"),KE=Symbol.for("react.lazy"),Fd=Symbol.iterator;function WE(e){return e===null||typeof e!="object"?null:(e=Fd&&e[Fd]||e["@@iterator"],typeof e=="function"?e:null)}var Pd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Bd=Object.assign,Dd={};function Ss(e,t,n){this.props=e,this.context=t,this.refs=Dd,this.updater=n||Pd}Ss.prototype.isReactComponent={},Ss.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},Ss.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function $d(){}$d.prototype=Ss.prototype;function cu(e,t,n){this.props=e,this.context=t,this.refs=Dd,this.updater=n||Pd}var lu=cu.prototype=new $d;lu.constructor=cu,Bd(lu,Ss.prototype),lu.isPureReactComponent=!0;var jd=Array.isArray,zd=Object.prototype.hasOwnProperty,uu={current:null},Kd={key:!0,ref:!0,__self:!0,__source:!0};function Wd(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)zd.call(t,r)&&!Kd.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),u=0;u<a;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:To,type:e,key:s,ref:o,props:i,_owner:uu.current}}function GE(e,t){return{$$typeof:To,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function hu(e){return typeof e=="object"&&e!==null&&e.$$typeof===To}function HE(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Gd=/\/+/g;function fu(e,t){return typeof e=="object"&&e!==null&&e.key!=null?HE(""+e.key):t.toString(36)}function Ma(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case To:case ME:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+fu(o,0):r,jd(i)?(n="",e!=null&&(n=e.replace(Gd,"$&/")+"/"),Ma(i,t,n,"",function(u){return u})):i!=null&&(hu(i)&&(i=GE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Gd,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",jd(e))for(var a=0;a<e.length;a++){s=e[a];var c=r+fu(s,a);o+=Ma(s,t,n,c,i)}else if(c=WE(e),typeof c=="function")for(e=c.call(e),a=0;!(s=e.next()).done;)s=s.value,c=r+fu(s,a++),o+=Ma(s,t,n,c,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Ua(e,t,n){if(e==null)return e;var r=[],i=0;return Ma(e,r,"","",function(s){return t.call(n,s,i++)}),r}function YE(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var un={current:null},Fa={transition:null},VE={ReactCurrentDispatcher:un,ReactCurrentBatchConfig:Fa,ReactCurrentOwner:uu};function Hd(){throw Error("act(...) is not supported in production builds of React.")}Ht.Children={map:Ua,forEach:function(e,t,n){Ua(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ua(e,function(){t++}),t},toArray:function(e){return Ua(e,function(t){return t})||[]},only:function(e){if(!hu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Ht.Component=Ss,Ht.Fragment=UE,Ht.Profiler=PE,Ht.PureComponent=cu,Ht.StrictMode=FE,Ht.Suspense=jE,Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VE,Ht.act=Hd,Ht.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Bd({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=uu.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)zd.call(t,c)&&!Kd.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:To,type:e.type,key:i,ref:s,props:r,_owner:o}},Ht.createContext=function(e){return e={$$typeof:DE,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:BE,_context:e},e.Consumer=e},Ht.createElement=Wd,Ht.createFactory=function(e){var t=Wd.bind(null,e);return t.type=e,t},Ht.createRef=function(){return{current:null}},Ht.forwardRef=function(e){return{$$typeof:$E,render:e}},Ht.isValidElement=hu,Ht.lazy=function(e){return{$$typeof:KE,_payload:{_status:-1,_result:e},_init:YE}},Ht.memo=function(e,t){return{$$typeof:zE,type:e,compare:t===void 0?null:t}},Ht.startTransition=function(e){var t=Fa.transition;Fa.transition={};try{e()}finally{Fa.transition=t}},Ht.unstable_act=Hd,Ht.useCallback=function(e,t){return un.current.useCallback(e,t)},Ht.useContext=function(e){return un.current.useContext(e)},Ht.useDebugValue=function(){},Ht.useDeferredValue=function(e){return un.current.useDeferredValue(e)},Ht.useEffect=function(e,t){return un.current.useEffect(e,t)},Ht.useId=function(){return un.current.useId()},Ht.useImperativeHandle=function(e,t,n){return un.current.useImperativeHandle(e,t,n)},Ht.useInsertionEffect=function(e,t){return un.current.useInsertionEffect(e,t)},Ht.useLayoutEffect=function(e,t){return un.current.useLayoutEffect(e,t)},Ht.useMemo=function(e,t){return un.current.useMemo(e,t)},Ht.useReducer=function(e,t,n){return un.current.useReducer(e,t,n)},Ht.useRef=function(e){return un.current.useRef(e)},Ht.useState=function(e){return un.current.useState(e)},Ht.useSyncExternalStore=function(e,t,n){return un.current.useSyncExternalStore(e,t,n)},Ht.useTransition=function(){return un.current.useTransition()},Ht.version="18.3.1";const Rs=globalThis||void 0||self,rr=()=>new Map,du=e=>{const t=rr();return e.forEach((n,r)=>{t.set(r,n)}),t},ki=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},qE=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},XE=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class JE{constructor(){this._observers=rr()}on(t,n){return ki(this._observers,t,xs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return bi((this._observers.get(t)||rr()).values()).forEach(r=>r(...n))}destroy(){this._observers=rr()}}const ZE=crypto.getRandomValues.bind(crypto),Yd=()=>ZE(new Uint32Array(1))[0],QE="10000000-1000-4000-8000"+-1e11,tw=()=>QE.replace(/[018]/g,e=>(e^Yd()&15>>e/4).toString(16)),Vd=e=>new Promise(e);Promise.all.bind(Promise);var qd={},Pa={};Pa.byteLength=rw,Pa.toByteArray=sw,Pa.fromByteArray=cw;for(var br=[],zn=[],ew=typeof Uint8Array<"u"?Uint8Array:Array,pu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Is=0,nw=pu.length;Is<nw;++Is)br[Is]=pu[Is],zn[pu.charCodeAt(Is)]=Is;zn[45]=62,zn[95]=63;function Xd(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function rw(e){var t=Xd(e),n=t[0],r=t[1];return(n+r)*3/4-r}function iw(e,t,n){return(t+n)*3/4-n}function sw(e){var t,n=Xd(e),r=n[0],i=n[1],s=new ew(iw(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=zn[e.charCodeAt(c)]<<18|zn[e.charCodeAt(c+1)]<<12|zn[e.charCodeAt(c+2)]<<6|zn[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=zn[e.charCodeAt(c)]<<2|zn[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=zn[e.charCodeAt(c)]<<10|zn[e.charCodeAt(c+1)]<<4|zn[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function ow(e){return br[e>>18&63]+br[e>>12&63]+br[e>>6&63]+br[e&63]}function aw(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(ow(r));return i.join("")}function cw(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(aw(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(br[t>>2]+br[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(br[t>>10]+br[t>>4&63]+br[t<<2&63]+"=")),i.join("")}var mu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */mu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=s*256+e[t+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=o*256+e[t+h],h+=f,l-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(d?-1:1)*o*Math.pow(2,s-r)},mu.write=function(e,t,n,r,i,s){var o,a,c,u=s*8-i-1,l=(1<<u)-1,h=l>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?t+=f/c:t+=f*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(t*c-1)*Math.pow(2,i),o=o+h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;e[n+d]=o&255,d+=p,o/=256,u-=8);e[n+d-p]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=Pa,n=mu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;l.TYPED_ARRAY_SUPPORT=c(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const A=new s(1),m={foo:function(){return 42}};return Object.setPrototypeOf(m,s.prototype),Object.setPrototypeOf(A,m),A.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function u(A){if(A>i)throw new RangeError('The value "'+A+'" is invalid for option "size"');const m=new s(A);return Object.setPrototypeOf(m,l.prototype),m}function l(A,m,y){if(typeof A=="number"){if(typeof m=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(A)}return h(A,m,y)}l.poolSize=8192;function h(A,m,y){if(typeof A=="string")return g(A,m);if(o.isView(A))return E(A);if(A==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A);if(ft(A,o)||A&&ft(A.buffer,o)||typeof a<"u"&&(ft(A,a)||A&&ft(A.buffer,a)))return T(A,m,y);if(typeof A=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const S=A.valueOf&&A.valueOf();if(S!=null&&S!==A)return l.from(S,m,y);const D=v(A);if(D)return D;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof A[Symbol.toPrimitive]=="function")return l.from(A[Symbol.toPrimitive]("string"),m,y);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof A)}l.from=function(A,m,y){return h(A,m,y)},Object.setPrototypeOf(l.prototype,s.prototype),Object.setPrototypeOf(l,s);function f(A){if(typeof A!="number")throw new TypeError('"size" argument must be of type number');if(A<0)throw new RangeError('The value "'+A+'" is invalid for option "size"')}function d(A,m,y){return f(A),A<=0?u(A):m!==void 0?typeof y=="string"?u(A).fill(m,y):u(A).fill(m):u(A)}l.alloc=function(A,m,y){return d(A,m,y)};function p(A){return f(A),u(A<0?0:N(A)|0)}l.allocUnsafe=function(A){return p(A)},l.allocUnsafeSlow=function(A){return p(A)};function g(A,m){if((typeof m!="string"||m==="")&&(m="utf8"),!l.isEncoding(m))throw new TypeError("Unknown encoding: "+m);const y=L(A,m)|0;let S=u(y);const D=S.write(A,m);return D!==y&&(S=S.slice(0,D)),S}function k(A){const m=A.length<0?0:N(A.length)|0,y=u(m);for(let S=0;S<m;S+=1)y[S]=A[S]&255;return y}function E(A){if(ft(A,s)){const m=new s(A);return T(m.buffer,m.byteOffset,m.byteLength)}return k(A)}function T(A,m,y){if(m<0||A.byteLength<m)throw new RangeError('"offset" is outside of buffer bounds');if(A.byteLength<m+(y||0))throw new RangeError('"length" is outside of buffer bounds');let S;return m===void 0&&y===void 0?S=new s(A):y===void 0?S=new s(A,m):S=new s(A,m,y),Object.setPrototypeOf(S,l.prototype),S}function v(A){if(l.isBuffer(A)){const m=N(A.length)|0,y=u(m);return y.length===0||A.copy(y,0,0,m),y}if(A.length!==void 0)return typeof A.length!="number"||vt(A.length)?u(0):k(A);if(A.type==="Buffer"&&Array.isArray(A.data))return k(A.data)}function N(A){if(A>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return A|0}function U(A){return+A!=A&&(A=0),l.alloc(+A)}l.isBuffer=function(m){return m!=null&&m._isBuffer===!0&&m!==l.prototype},l.compare=function(m,y){if(ft(m,s)&&(m=l.from(m,m.offset,m.byteLength)),ft(y,s)&&(y=l.from(y,y.offset,y.byteLength)),!l.isBuffer(m)||!l.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(m===y)return 0;let S=m.length,D=y.length;for(let J=0,et=Math.min(S,D);J<et;++J)if(m[J]!==y[J]){S=m[J],D=y[J];break}return S<D?-1:D<S?1:0},l.isEncoding=function(m){switch(String(m).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(m,y){if(!Array.isArray(m))throw new TypeError('"list" argument must be an Array of Buffers');if(m.length===0)return l.alloc(0);let S;if(y===void 0)for(y=0,S=0;S<m.length;++S)y+=m[S].length;const D=l.allocUnsafe(y);let J=0;for(S=0;S<m.length;++S){let et=m[S];if(ft(et,s))J+et.length>D.length?(l.isBuffer(et)||(et=l.from(et)),et.copy(D,J)):s.prototype.set.call(D,et,J);else if(l.isBuffer(et))et.copy(D,J);else throw new TypeError('"list" argument must be an Array of Buffers');J+=et.length}return D};function L(A,m){if(l.isBuffer(A))return A.length;if(o.isView(A)||ft(A,o))return A.byteLength;if(typeof A!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof A);const y=A.length,S=arguments.length>2&&arguments[2]===!0;if(!S&&y===0)return 0;let D=!1;for(;;)switch(m){case"ascii":case"latin1":case"binary":return y;case"utf8":case"utf-8":return ot(A).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y*2;case"hex":return y>>>1;case"base64":return pt(A).length;default:if(D)return S?-1:ot(A).length;m=(""+m).toLowerCase(),D=!0}}l.byteLength=L;function O(A,m,y){let S=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((y===void 0||y>this.length)&&(y=this.length),y<=0)||(y>>>=0,m>>>=0,y<=m))return"";for(A||(A="utf8");;)switch(A){case"hex":return z(this,m,y);case"utf8":case"utf-8":return j(this,m,y);case"ascii":return ht(this,m,y);case"latin1":case"binary":return G(this,m,y);case"base64":return Z(this,m,y);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,m,y);default:if(S)throw new TypeError("Unknown encoding: "+A);A=(A+"").toLowerCase(),S=!0}}l.prototype._isBuffer=!0;function B(A,m,y){const S=A[m];A[m]=A[y],A[y]=S}l.prototype.swap16=function(){const m=this.length;if(m%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let y=0;y<m;y+=2)B(this,y,y+1);return this},l.prototype.swap32=function(){const m=this.length;if(m%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let y=0;y<m;y+=4)B(this,y,y+3),B(this,y+1,y+2);return this},l.prototype.swap64=function(){const m=this.length;if(m%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let y=0;y<m;y+=8)B(this,y,y+7),B(this,y+1,y+6),B(this,y+2,y+5),B(this,y+3,y+4);return this},l.prototype.toString=function(){const m=this.length;return m===0?"":arguments.length===0?j(this,0,m):O.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(m){if(!l.isBuffer(m))throw new TypeError("Argument must be a Buffer");return this===m?!0:l.compare(this,m)===0},l.prototype.inspect=function(){let m="";const y=e.INSPECT_MAX_BYTES;return m=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(m+=" ... "),"<Buffer "+m+">"},r&&(l.prototype[r]=l.prototype.inspect),l.prototype.compare=function(m,y,S,D,J){if(ft(m,s)&&(m=l.from(m,m.offset,m.byteLength)),!l.isBuffer(m))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof m);if(y===void 0&&(y=0),S===void 0&&(S=m?m.length:0),D===void 0&&(D=0),J===void 0&&(J=this.length),y<0||S>m.length||D<0||J>this.length)throw new RangeError("out of range index");if(D>=J&&y>=S)return 0;if(D>=J)return-1;if(y>=S)return 1;if(y>>>=0,S>>>=0,D>>>=0,J>>>=0,this===m)return 0;let et=J-D,Ft=S-y;const be=Math.min(et,Ft),ge=this.slice(D,J),Ee=m.slice(y,S);for(let se=0;se<be;++se)if(ge[se]!==Ee[se]){et=ge[se],Ft=Ee[se];break}return et<Ft?-1:Ft<et?1:0};function F(A,m,y,S,D){if(A.length===0)return-1;if(typeof y=="string"?(S=y,y=0):y>2147483647?y=2147483647:y<-2147483648&&(y=-2147483648),y=+y,vt(y)&&(y=D?0:A.length-1),y<0&&(y=A.length+y),y>=A.length){if(D)return-1;y=A.length-1}else if(y<0)if(D)y=0;else return-1;if(typeof m=="string"&&(m=l.from(m,S)),l.isBuffer(m))return m.length===0?-1:nt(A,m,y,S,D);if(typeof m=="number")return m=m&255,typeof s.prototype.indexOf=="function"?D?s.prototype.indexOf.call(A,m,y):s.prototype.lastIndexOf.call(A,m,y):nt(A,[m],y,S,D);throw new TypeError("val must be string, number or Buffer")}function nt(A,m,y,S,D){let J=1,et=A.length,Ft=m.length;if(S!==void 0&&(S=String(S).toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(A.length<2||m.length<2)return-1;J=2,et/=2,Ft/=2,y/=2}function be(Ee,se){return J===1?Ee[se]:Ee.readUInt16BE(se*J)}let ge;if(D){let Ee=-1;for(ge=y;ge<et;ge++)if(be(A,ge)===be(m,Ee===-1?0:ge-Ee)){if(Ee===-1&&(Ee=ge),ge-Ee+1===Ft)return Ee*J}else Ee!==-1&&(ge-=ge-Ee),Ee=-1}else for(y+Ft>et&&(y=et-Ft),ge=y;ge>=0;ge--){let Ee=!0;for(let se=0;se<Ft;se++)if(be(A,ge+se)!==be(m,se)){Ee=!1;break}if(Ee)return ge}return-1}l.prototype.includes=function(m,y,S){return this.indexOf(m,y,S)!==-1},l.prototype.indexOf=function(m,y,S){return F(this,m,y,S,!0)},l.prototype.lastIndexOf=function(m,y,S){return F(this,m,y,S,!1)};function dt(A,m,y,S){y=Number(y)||0;const D=A.length-y;S?(S=Number(S),S>D&&(S=D)):S=D;const J=m.length;S>J/2&&(S=J/2);let et;for(et=0;et<S;++et){const Ft=parseInt(m.substr(et*2,2),16);if(vt(Ft))return et;A[y+et]=Ft}return et}function M(A,m,y,S){return _t(ot(m,A.length-y),A,y,S)}function R(A,m,y,S){return _t(lt(m),A,y,S)}function _(A,m,y,S){return _t(pt(m),A,y,S)}function P(A,m,y,S){return _t(X(m,A.length-y),A,y,S)}l.prototype.write=function(m,y,S,D){if(y===void 0)D="utf8",S=this.length,y=0;else if(S===void 0&&typeof y=="string")D=y,S=this.length,y=0;else if(isFinite(y))y=y>>>0,isFinite(S)?(S=S>>>0,D===void 0&&(D="utf8")):(D=S,S=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const J=this.length-y;if((S===void 0||S>J)&&(S=J),m.length>0&&(S<0||y<0)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");D||(D="utf8");let et=!1;for(;;)switch(D){case"hex":return dt(this,m,y,S);case"utf8":case"utf-8":return M(this,m,y,S);case"ascii":case"latin1":case"binary":return R(this,m,y,S);case"base64":return _(this,m,y,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,m,y,S);default:if(et)throw new TypeError("Unknown encoding: "+D);D=(""+D).toLowerCase(),et=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Z(A,m,y){return m===0&&y===A.length?t.fromByteArray(A):t.fromByteArray(A.slice(m,y))}function j(A,m,y){y=Math.min(A.length,y);const S=[];let D=m;for(;D<y;){const J=A[D];let et=null,Ft=J>239?4:J>223?3:J>191?2:1;if(D+Ft<=y){let be,ge,Ee,se;switch(Ft){case 1:J<128&&(et=J);break;case 2:be=A[D+1],(be&192)===128&&(se=(J&31)<<6|be&63,se>127&&(et=se));break;case 3:be=A[D+1],ge=A[D+2],(be&192)===128&&(ge&192)===128&&(se=(J&15)<<12|(be&63)<<6|ge&63,se>2047&&(se<55296||se>57343)&&(et=se));break;case 4:be=A[D+1],ge=A[D+2],Ee=A[D+3],(be&192)===128&&(ge&192)===128&&(Ee&192)===128&&(se=(J&15)<<18|(be&63)<<12|(ge&63)<<6|Ee&63,se>65535&&se<1114112&&(et=se))}}et===null?(et=65533,Ft=1):et>65535&&(et-=65536,S.push(et>>>10&1023|55296),et=56320|et&1023),S.push(et),D+=Ft}return tt(S)}const ut=4096;function tt(A){const m=A.length;if(m<=ut)return String.fromCharCode.apply(String,A);let y="",S=0;for(;S<m;)y+=String.fromCharCode.apply(String,A.slice(S,S+=ut));return y}function ht(A,m,y){let S="";y=Math.min(A.length,y);for(let D=m;D<y;++D)S+=String.fromCharCode(A[D]&127);return S}function G(A,m,y){let S="";y=Math.min(A.length,y);for(let D=m;D<y;++D)S+=String.fromCharCode(A[D]);return S}function z(A,m,y){const S=A.length;(!m||m<0)&&(m=0),(!y||y<0||y>S)&&(y=S);let D="";for(let J=m;J<y;++J)D+=ce[A[J]];return D}function bt(A,m,y){const S=A.slice(m,y);let D="";for(let J=0;J<S.length-1;J+=2)D+=String.fromCharCode(S[J]+S[J+1]*256);return D}l.prototype.slice=function(m,y){const S=this.length;m=~~m,y=y===void 0?S:~~y,m<0?(m+=S,m<0&&(m=0)):m>S&&(m=S),y<0?(y+=S,y<0&&(y=0)):y>S&&(y=S),y<m&&(y=m);const D=this.subarray(m,y);return Object.setPrototypeOf(D,l.prototype),D};function st(A,m,y){if(A%1!==0||A<0)throw new RangeError("offset is not uint");if(A+m>y)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(m,y,S){m=m>>>0,y=y>>>0,S||st(m,y,this.length);let D=this[m],J=1,et=0;for(;++et<y&&(J*=256);)D+=this[m+et]*J;return D},l.prototype.readUintBE=l.prototype.readUIntBE=function(m,y,S){m=m>>>0,y=y>>>0,S||st(m,y,this.length);let D=this[m+--y],J=1;for(;y>0&&(J*=256);)D+=this[m+--y]*J;return D},l.prototype.readUint8=l.prototype.readUInt8=function(m,y){return m=m>>>0,y||st(m,1,this.length),this[m]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(m,y){return m=m>>>0,y||st(m,2,this.length),this[m]|this[m+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(m,y){return m=m>>>0,y||st(m,2,this.length),this[m]<<8|this[m+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(m,y){return m=m>>>0,y||st(m,4,this.length),(this[m]|this[m+1]<<8|this[m+2]<<16)+this[m+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]*16777216+(this[m+1]<<16|this[m+2]<<8|this[m+3])},l.prototype.readBigUInt64LE=Mt(function(m){m=m>>>0,Q(m,"offset");const y=this[m],S=this[m+7];(y===void 0||S===void 0)&&C(m,this.length-8);const D=y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24,J=this[++m]+this[++m]*2**8+this[++m]*2**16+S*2**24;return BigInt(D)+(BigInt(J)<<BigInt(32))}),l.prototype.readBigUInt64BE=Mt(function(m){m=m>>>0,Q(m,"offset");const y=this[m],S=this[m+7];(y===void 0||S===void 0)&&C(m,this.length-8);const D=y*2**24+this[++m]*2**16+this[++m]*2**8+this[++m],J=this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+S;return(BigInt(D)<<BigInt(32))+BigInt(J)}),l.prototype.readIntLE=function(m,y,S){m=m>>>0,y=y>>>0,S||st(m,y,this.length);let D=this[m],J=1,et=0;for(;++et<y&&(J*=256);)D+=this[m+et]*J;return J*=128,D>=J&&(D-=Math.pow(2,8*y)),D},l.prototype.readIntBE=function(m,y,S){m=m>>>0,y=y>>>0,S||st(m,y,this.length);let D=y,J=1,et=this[m+--D];for(;D>0&&(J*=256);)et+=this[m+--D]*J;return J*=128,et>=J&&(et-=Math.pow(2,8*y)),et},l.prototype.readInt8=function(m,y){return m=m>>>0,y||st(m,1,this.length),this[m]&128?(255-this[m]+1)*-1:this[m]},l.prototype.readInt16LE=function(m,y){m=m>>>0,y||st(m,2,this.length);const S=this[m]|this[m+1]<<8;return S&32768?S|4294901760:S},l.prototype.readInt16BE=function(m,y){m=m>>>0,y||st(m,2,this.length);const S=this[m+1]|this[m]<<8;return S&32768?S|4294901760:S},l.prototype.readInt32LE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]|this[m+1]<<8|this[m+2]<<16|this[m+3]<<24},l.prototype.readInt32BE=function(m,y){return m=m>>>0,y||st(m,4,this.length),this[m]<<24|this[m+1]<<16|this[m+2]<<8|this[m+3]},l.prototype.readBigInt64LE=Mt(function(m){m=m>>>0,Q(m,"offset");const y=this[m],S=this[m+7];(y===void 0||S===void 0)&&C(m,this.length-8);const D=this[m+4]+this[m+5]*2**8+this[m+6]*2**16+(S<<24);return(BigInt(D)<<BigInt(32))+BigInt(y+this[++m]*2**8+this[++m]*2**16+this[++m]*2**24)}),l.prototype.readBigInt64BE=Mt(function(m){m=m>>>0,Q(m,"offset");const y=this[m],S=this[m+7];(y===void 0||S===void 0)&&C(m,this.length-8);const D=(y<<24)+this[++m]*2**16+this[++m]*2**8+this[++m];return(BigInt(D)<<BigInt(32))+BigInt(this[++m]*2**24+this[++m]*2**16+this[++m]*2**8+S)}),l.prototype.readFloatLE=function(m,y){return m=m>>>0,y||st(m,4,this.length),n.read(this,m,!0,23,4)},l.prototype.readFloatBE=function(m,y){return m=m>>>0,y||st(m,4,this.length),n.read(this,m,!1,23,4)},l.prototype.readDoubleLE=function(m,y){return m=m>>>0,y||st(m,8,this.length),n.read(this,m,!0,52,8)},l.prototype.readDoubleBE=function(m,y){return m=m>>>0,y||st(m,8,this.length),n.read(this,m,!1,52,8)};function at(A,m,y,S,D,J){if(!l.isBuffer(A))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>D||m<J)throw new RangeError('"value" argument is out of bounds');if(y+S>A.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(m,y,S,D){if(m=+m,y=y>>>0,S=S>>>0,!D){const Ft=Math.pow(2,8*S)-1;at(this,m,y,S,Ft,0)}let J=1,et=0;for(this[y]=m&255;++et<S&&(J*=256);)this[y+et]=m/J&255;return y+S},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(m,y,S,D){if(m=+m,y=y>>>0,S=S>>>0,!D){const Ft=Math.pow(2,8*S)-1;at(this,m,y,S,Ft,0)}let J=S-1,et=1;for(this[y+J]=m&255;--J>=0&&(et*=256);)this[y+J]=m/et&255;return y+S},l.prototype.writeUint8=l.prototype.writeUInt8=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,1,255,0),this[y]=m&255,y+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,2,65535,0),this[y]=m&255,this[y+1]=m>>>8,y+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,2,65535,0),this[y]=m>>>8,this[y+1]=m&255,y+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,4,4294967295,0),this[y+3]=m>>>24,this[y+2]=m>>>16,this[y+1]=m>>>8,this[y]=m&255,y+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,4,4294967295,0),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4};function Ct(A,m,y,S,D){rt(m,S,D,A,y,7);let J=Number(m&BigInt(4294967295));A[y++]=J,J=J>>8,A[y++]=J,J=J>>8,A[y++]=J,J=J>>8,A[y++]=J;let et=Number(m>>BigInt(32)&BigInt(4294967295));return A[y++]=et,et=et>>8,A[y++]=et,et=et>>8,A[y++]=et,et=et>>8,A[y++]=et,y}function Zt(A,m,y,S,D){rt(m,S,D,A,y,7);let J=Number(m&BigInt(4294967295));A[y+7]=J,J=J>>8,A[y+6]=J,J=J>>8,A[y+5]=J,J=J>>8,A[y+4]=J;let et=Number(m>>BigInt(32)&BigInt(4294967295));return A[y+3]=et,et=et>>8,A[y+2]=et,et=et>>8,A[y+1]=et,et=et>>8,A[y]=et,y+8}l.prototype.writeBigUInt64LE=Mt(function(m,y=0){return Ct(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Mt(function(m,y=0){return Zt(this,m,y,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(m,y,S,D){if(m=+m,y=y>>>0,!D){const be=Math.pow(2,8*S-1);at(this,m,y,S,be-1,-be)}let J=0,et=1,Ft=0;for(this[y]=m&255;++J<S&&(et*=256);)m<0&&Ft===0&&this[y+J-1]!==0&&(Ft=1),this[y+J]=(m/et>>0)-Ft&255;return y+S},l.prototype.writeIntBE=function(m,y,S,D){if(m=+m,y=y>>>0,!D){const be=Math.pow(2,8*S-1);at(this,m,y,S,be-1,-be)}let J=S-1,et=1,Ft=0;for(this[y+J]=m&255;--J>=0&&(et*=256);)m<0&&Ft===0&&this[y+J+1]!==0&&(Ft=1),this[y+J]=(m/et>>0)-Ft&255;return y+S},l.prototype.writeInt8=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,1,127,-128),m<0&&(m=255+m+1),this[y]=m&255,y+1},l.prototype.writeInt16LE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,2,32767,-32768),this[y]=m&255,this[y+1]=m>>>8,y+2},l.prototype.writeInt16BE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,2,32767,-32768),this[y]=m>>>8,this[y+1]=m&255,y+2},l.prototype.writeInt32LE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,4,2147483647,-2147483648),this[y]=m&255,this[y+1]=m>>>8,this[y+2]=m>>>16,this[y+3]=m>>>24,y+4},l.prototype.writeInt32BE=function(m,y,S){return m=+m,y=y>>>0,S||at(this,m,y,4,2147483647,-2147483648),m<0&&(m=4294967295+m+1),this[y]=m>>>24,this[y+1]=m>>>16,this[y+2]=m>>>8,this[y+3]=m&255,y+4},l.prototype.writeBigInt64LE=Mt(function(m,y=0){return Ct(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Mt(function(m,y=0){return Zt(this,m,y,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function At(A,m,y,S,D,J){if(y+S>A.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("Index out of range")}function xt(A,m,y,S,D){return m=+m,y=y>>>0,D||At(A,m,y,4),n.write(A,m,y,S,23,4),y+4}l.prototype.writeFloatLE=function(m,y,S){return xt(this,m,y,!0,S)},l.prototype.writeFloatBE=function(m,y,S){return xt(this,m,y,!1,S)};function Dt(A,m,y,S,D){return m=+m,y=y>>>0,D||At(A,m,y,8),n.write(A,m,y,S,52,8),y+8}l.prototype.writeDoubleLE=function(m,y,S){return Dt(this,m,y,!0,S)},l.prototype.writeDoubleBE=function(m,y,S){return Dt(this,m,y,!1,S)},l.prototype.copy=function(m,y,S,D){if(!l.isBuffer(m))throw new TypeError("argument should be a Buffer");if(S||(S=0),!D&&D!==0&&(D=this.length),y>=m.length&&(y=m.length),y||(y=0),D>0&&D<S&&(D=S),D===S||m.length===0||this.length===0)return 0;if(y<0)throw new RangeError("targetStart out of bounds");if(S<0||S>=this.length)throw new RangeError("Index out of range");if(D<0)throw new RangeError("sourceEnd out of bounds");D>this.length&&(D=this.length),m.length-y<D-S&&(D=m.length-y+S);const J=D-S;return this===m&&typeof s.prototype.copyWithin=="function"?this.copyWithin(y,S,D):s.prototype.set.call(m,this.subarray(S,D),y),J},l.prototype.fill=function(m,y,S,D){if(typeof m=="string"){if(typeof y=="string"?(D=y,y=0,S=this.length):typeof S=="string"&&(D=S,S=this.length),D!==void 0&&typeof D!="string")throw new TypeError("encoding must be a string");if(typeof D=="string"&&!l.isEncoding(D))throw new TypeError("Unknown encoding: "+D);if(m.length===1){const et=m.charCodeAt(0);(D==="utf8"&&et<128||D==="latin1")&&(m=et)}}else typeof m=="number"?m=m&255:typeof m=="boolean"&&(m=Number(m));if(y<0||this.length<y||this.length<S)throw new RangeError("Out of range index");if(S<=y)return this;y=y>>>0,S=S===void 0?this.length:S>>>0,m||(m=0);let J;if(typeof m=="number")for(J=y;J<S;++J)this[J]=m;else{const et=l.isBuffer(m)?m:l.from(m,D),Ft=et.length;if(Ft===0)throw new TypeError('The value "'+m+'" is invalid for argument "value"');for(J=0;J<S-y;++J)this[J+y]=et[J%Ft]}return this};const Wt={};function _e(A,m,y){Wt[A]=class extends y{constructor(){super(),Object.defineProperty(this,"message",{value:m.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${A}]`,this.stack,delete this.name}get code(){return A}set code(D){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:D,writable:!0})}toString(){return`${this.name} [${A}]: ${this.message}`}}}_e("ERR_BUFFER_OUT_OF_BOUNDS",function(A){return A?`${A} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),_e("ERR_INVALID_ARG_TYPE",function(A,m){return`The "${A}" argument must be of type number. Received type ${typeof m}`},TypeError),_e("ERR_OUT_OF_RANGE",function(A,m,y){let S=`The value of "${A}" is out of range.`,D=y;return Number.isInteger(y)&&Math.abs(y)>2**32?D=Re(String(y)):typeof y=="bigint"&&(D=String(y),(y>BigInt(2)**BigInt(32)||y<-(BigInt(2)**BigInt(32)))&&(D=Re(D)),D+="n"),S+=` It must be ${m}. Received ${D}`,S},RangeError);function Re(A){let m="",y=A.length;const S=A[0]==="-"?1:0;for(;y>=S+4;y-=3)m=`_${A.slice(y-3,y)}${m}`;return`${A.slice(0,y)}${m}`}function b(A,m,y){Q(m,"offset"),(A[m]===void 0||A[m+y]===void 0)&&C(m,A.length-(y+1))}function rt(A,m,y,S,D,J){if(A>y||A<m){const et=typeof m=="bigint"?"n":"";let Ft;throw m===0||m===BigInt(0)?Ft=`>= 0${et} and < 2${et} ** ${(J+1)*8}${et}`:Ft=`>= -(2${et} ** ${(J+1)*8-1}${et}) and < 2 ** ${(J+1)*8-1}${et}`,new Wt.ERR_OUT_OF_RANGE("value",Ft,A)}b(S,D,J)}function Q(A,m){if(typeof A!="number")throw new Wt.ERR_INVALID_ARG_TYPE(m,"number",A)}function C(A,m,y){throw Math.floor(A)!==A?(Q(A,y),new Wt.ERR_OUT_OF_RANGE("offset","an integer",A)):m<0?new Wt.ERR_BUFFER_OUT_OF_BOUNDS:new Wt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${m}`,A)}const I=/[^+/0-9A-Za-z-_]/g;function H(A){if(A=A.split("=")[0],A=A.trim().replace(I,""),A.length<2)return"";for(;A.length%4!==0;)A=A+"=";return A}function ot(A,m){m=m||1/0;let y;const S=A.length;let D=null;const J=[];for(let et=0;et<S;++et){if(y=A.charCodeAt(et),y>55295&&y<57344){if(!D){if(y>56319){(m-=3)>-1&&J.push(239,191,189);continue}else if(et+1===S){(m-=3)>-1&&J.push(239,191,189);continue}D=y;continue}if(y<56320){(m-=3)>-1&&J.push(239,191,189),D=y;continue}y=(D-55296<<10|y-56320)+65536}else D&&(m-=3)>-1&&J.push(239,191,189);if(D=null,y<128){if((m-=1)<0)break;J.push(y)}else if(y<2048){if((m-=2)<0)break;J.push(y>>6|192,y&63|128)}else if(y<65536){if((m-=3)<0)break;J.push(y>>12|224,y>>6&63|128,y&63|128)}else if(y<1114112){if((m-=4)<0)break;J.push(y>>18|240,y>>12&63|128,y>>6&63|128,y&63|128)}else throw new Error("Invalid code point")}return J}function lt(A){const m=[];for(let y=0;y<A.length;++y)m.push(A.charCodeAt(y)&255);return m}function X(A,m){let y,S,D;const J=[];for(let et=0;et<A.length&&!((m-=2)<0);++et)y=A.charCodeAt(et),S=y>>8,D=y%256,J.push(D),J.push(S);return J}function pt(A){return t.toByteArray(H(A))}function _t(A,m,y,S){let D;for(D=0;D<S&&!(D+y>=m.length||D>=A.length);++D)m[D+y]=A[D];return D}function ft(A,m){return A instanceof m||A!=null&&A.constructor!=null&&A.constructor.name!=null&&A.constructor.name===m.name}function vt(A){return A!==A}const ce=function(){const A="0123456789abcdef",m=new Array(256);for(let y=0;y<16;++y){const S=y*16;for(let D=0;D<16;++D)m[S+D]=A[y]+A[D]}return m}();function Mt(A){return typeof BigInt>"u"?In:A}function In(){throw new Error("BigInt not supported")}})(qd);const Ze=qd.Buffer;function lw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Jd={exports:{}},Ne=Jd.exports={},Er,wr;function gu(){throw new Error("setTimeout has not been defined")}function yu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Er=setTimeout:Er=gu}catch{Er=gu}try{typeof clearTimeout=="function"?wr=clearTimeout:wr=yu}catch{wr=yu}})();function Zd(e){if(Er===setTimeout)return setTimeout(e,0);if((Er===gu||!Er)&&setTimeout)return Er=setTimeout,setTimeout(e,0);try{return Er(e,0)}catch{try{return Er.call(null,e,0)}catch{return Er.call(this,e,0)}}}function uw(e){if(wr===clearTimeout)return clearTimeout(e);if((wr===yu||!wr)&&clearTimeout)return wr=clearTimeout,clearTimeout(e);try{return wr(e)}catch{try{return wr.call(null,e)}catch{return wr.call(this,e)}}}var Vr=[],Ns=!1,qi,Ba=-1;function hw(){!Ns||!qi||(Ns=!1,qi.length?Vr=qi.concat(Vr):Ba=-1,Vr.length&&Qd())}function Qd(){if(!Ns){var e=Zd(hw);Ns=!0;for(var t=Vr.length;t;){for(qi=Vr,Vr=[];++Ba<t;)qi&&qi[Ba].run();Ba=-1,t=Vr.length}qi=null,Ns=!1,uw(e)}}Ne.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Vr.push(new tp(e,t)),Vr.length===1&&!Ns&&Zd(Qd)};function tp(e,t){this.fun=e,this.array=t}tp.prototype.run=function(){this.fun.apply(null,this.array)},Ne.title="browser",Ne.browser=!0,Ne.env={},Ne.argv=[],Ne.version="",Ne.versions={};function qr(){}Ne.on=qr,Ne.addListener=qr,Ne.once=qr,Ne.off=qr,Ne.removeListener=qr,Ne.removeAllListeners=qr,Ne.emit=qr,Ne.prependListener=qr,Ne.prependOnceListener=qr,Ne.listeners=function(e){return[]},Ne.binding=function(e){throw new Error("process.binding is not supported")},Ne.cwd=function(){return"/"},Ne.chdir=function(e){throw new Error("process.chdir is not supported")},Ne.umask=function(){return 0};var fw=Jd.exports;const xi=lw(fw),ep=e=>e===void 0?null:e;class dw{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let np=new dw,pw=!0;try{typeof localStorage<"u"&&localStorage&&(np=localStorage,pw=!1)}catch{}const mw=np,gw=Object.assign,yw=Object.keys,_w=(e,t)=>{for(const n in e)t(e[n],n)},rp=e=>yw(e).length,bw=e=>{for(const t in e)return!1;return!0},Ew=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},ww=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),kw=(e,t)=>e===t||rp(e)===rp(t)&&Ew(e,(n,r)=>(n!==void 0||ww(t,r))&&t[r]===n),xw=Object.freeze,ip=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&ip(e[t])}return xw(e)},_u=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&_u(e,t,n+1)}},Tw=e=>e,Aw=(e,t)=>t.includes(e);var sp={};const Ao=typeof xi<"u"&&xi.release&&/node|io\.js/.test(xi.release.name)&&Object.prototype.toString.call(typeof xi<"u"?xi:0)==="[object process]";let kr;const vw=()=>{if(kr===void 0)if(Ao){kr=rr();const e=xi.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&kr.set(t,""),t=r):t!==null&&(kr.set(t,r),t=null)}t!==null&&kr.set(t,"")}else typeof location=="object"?(kr=rr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");kr.set(`--${Rd(t,"-")}`,n),kr.set(`-${Rd(t,"-")}`,n)}})):kr=rr();return kr},bu=e=>vw().has(e),Da=e=>ep(Ao?sp[e.toUpperCase().replaceAll("-","_")]:mw.getItem(e)),op=e=>bu("--"+e)||Da(e)!==null;op("production");const Sw=Ao&&Aw(sp.FORCE_COLOR,["true","1","2"])||!bu("--no-colors")&&!op("no-color")&&(!Ao||xi.stdout.isTTY)&&(!Ao||bu("--color")||Da("COLORTERM")!==null||(Da("TERM")||"").includes("color")),Rw=e=>new Uint8Array(e),Iw=e=>{const t=Rw(e.byteLength);return t.set(e),t};class Nw{constructor(t,n){this.left=t,this.right=n}}const Xr=(e,t)=>new Nw(e,t);typeof DOMParser<"u"&&new DOMParser;const Ow=e=>qE(e,(t,n)=>`${n}:${t};`).join(""),Jr=Symbol,ap=Jr(),cp=Jr(),Cw=Jr(),Lw=Jr(),Mw=Jr(),lp=Jr(),Uw=Jr(),Eu=Jr(),Fw=Jr(),Pw=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},Bw={[ap]:Xr("font-weight","bold"),[cp]:Xr("font-weight","normal"),[Cw]:Xr("color","blue"),[Mw]:Xr("color","green"),[Lw]:Xr("color","grey"),[lp]:Xr("color","red"),[Uw]:Xr("color","purple"),[Eu]:Xr("color","orange"),[Fw]:Xr("color","black")},up=Sw?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=rr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=Bw[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=Ow(r);s>0||u.length>0?(t.push("%c"+a),n.push(u)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:Pw,Dw=(...e)=>{console.log(...up(e)),hp.forEach(t=>t.print(e))},$w=(...e)=>{console.warn(...up(e)),e.unshift(Eu),hp.forEach(t=>t.print(e))},hp=xs(),fp=e=>({[Symbol.iterator](){return this},next:e}),jw=(e,t)=>fp(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),wu=(e,t)=>fp(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class ku{constructor(t,n){this.clock=t,this.len=n}}class vo{constructor(){this.clients=new Map}}const dp=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];Op(e,s,a.clock,a.len,n)}}),zw=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=_i((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},pp=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&zw(n,t.clock)!==null},xu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=Yi(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},Kw=e=>{const t=new vo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)fE(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return xu(t),t},$a=(e,t,n,r)=>{ki(e.clients,t,()=>[]).push(new ku(n,r))},Ww=()=>new vo,Gw=e=>{const t=Ww();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let u=n[s+1];s+1<n.length&&u.deleted;u=n[++s+1])c+=u.length;i.push(new ku(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Os=(e,t)=>{Pt(e.restEncoder,t.clients.size),bi(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),Pt(e.restEncoder,n);const i=r.length;Pt(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Tu=e=>{const t=new vo,n=Bt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Bt(e.restDecoder),s=Bt(e.restDecoder);if(s>0){const o=ki(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new ku(e.readDsClock(),e.readDsLen()))}}return t},mp=(e,t,n)=>{const r=new vo,i=Bt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Bt(e.restDecoder),a=Bt(e.restDecoder),c=n.clients.get(o)||[],u=Ye(n,o);for(let l=0;l<a;l++){const h=e.readDsClock(),f=h+e.readDsLen();if(h<u){u<f&&$a(r,o,u,f-u);let d=xr(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,ec(t,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,ec(t,p,f-p.id.clock)),p.delete(t))}else $a(r,o,h,f-h)}}if(r.clients.size>0){const s=new Xi;return Pt(s.restEncoder,0),Os(s,r),s.toUint8Array()}return null},gp=Yd;class Cs extends JE{constructor({guid:t=tw(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=gp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Rp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Vd(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const c=()=>Vd(u=>{const l=h=>{(h===void 0||h===!0)&&(this.off("sync",l),u())};this.on("sync",l)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&le(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(bi(this.subdocs).map(t=>t.guid))}transact(t,n=null){return le(this,t,n)}get(t,n=Qe){const r=ki(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==Qe&&i!==n)if(i===Qe){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Fs)}getText(t=""){return this.get(t,Zr)}getMap(t=""){return this.get(t,Ps)}getXmlElement(t=""){return this.get(t,Ds)}getXmlFragment(t=""){return this.get(t,Ji)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,bi(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Cs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,le(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class yp{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Bt(this.restDecoder)}readDsLen(){return Bt(this.restDecoder)}}class _p extends yp{readLeftID(){return Vt(Bt(this.restDecoder),Bt(this.restDecoder))}readRightID(){return Vt(Bt(this.restDecoder),Bt(this.restDecoder))}readClient(){return Bt(this.restDecoder)}readInfo(){return As(this.restDecoder)}readString(){return vs(this.restDecoder)}readParentInfo(){return Bt(this.restDecoder)===1}readTypeRef(){return Bt(this.restDecoder)}readLen(){return Bt(this.restDecoder)}readAny(){return xo(this.restDecoder)}readBuf(){return Iw(ln(this.restDecoder))}readJSON(){return JSON.parse(vs(this.restDecoder))}readKey(){return vs(this.restDecoder)}}class Hw{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Bt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Bt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Ls extends Hw{constructor(t){super(t),this.keys=[],Bt(t),this.keyClockDecoder=new au(ln(t)),this.clientDecoder=new La(ln(t)),this.leftClockDecoder=new au(ln(t)),this.rightClockDecoder=new au(ln(t)),this.infoDecoder=new Ud(ln(t),As),this.stringDecoder=new LE(ln(t)),this.parentInfoDecoder=new Ud(ln(t),As),this.typeRefDecoder=new La(ln(t)),this.lenDecoder=new La(ln(t))}readLeftID(){return new Ms(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ms(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return xo(this.restDecoder)}readBuf(){return ln(this.restDecoder)}readJSON(){return xo(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class bp{constructor(){this.restEncoder=wi()}toUint8Array(){return nr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){Pt(this.restEncoder,t)}writeDsLen(t){Pt(this.restEncoder,t)}}class So extends bp{writeLeftID(t){Pt(this.restEncoder,t.client),Pt(this.restEncoder,t.clock)}writeRightID(t){Pt(this.restEncoder,t.client),Pt(this.restEncoder,t.clock)}writeClient(t){Pt(this.restEncoder,t)}writeInfo(t){tu(this.restEncoder,t)}writeString(t){Ts(this.restEncoder,t)}writeParentInfo(t){Pt(this.restEncoder,t?1:0)}writeTypeRef(t){Pt(this.restEncoder,t)}writeLen(t){Pt(this.restEncoder,t)}writeAny(t){ko(this.restEncoder,t)}writeBuf(t){nn(this.restEncoder,t)}writeJSON(t){Ts(this.restEncoder,JSON.stringify(t))}writeKey(t){Ts(this.restEncoder,t)}}class Ep{constructor(){this.restEncoder=wi(),this.dsCurrVal=0}toUint8Array(){return nr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,Pt(this.restEncoder,n)}writeDsLen(t){t===0&&_r(),Pt(this.restEncoder,t-1),this.dsCurrVal+=t}}class Xi extends Ep{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new iu,this.clientEncoder=new Oa,this.leftClockEncoder=new iu,this.rightClockEncoder=new iu,this.infoEncoder=new Nd(tu),this.stringEncoder=new IE,this.parentInfoEncoder=new Nd(tu),this.typeRefEncoder=new Oa,this.lenEncoder=new Oa}toUint8Array(){const t=wi();return Pt(t,0),nn(t,this.keyClockEncoder.toUint8Array()),nn(t,this.clientEncoder.toUint8Array()),nn(t,this.leftClockEncoder.toUint8Array()),nn(t,this.rightClockEncoder.toUint8Array()),nn(t,nr(this.infoEncoder)),nn(t,this.stringEncoder.toUint8Array()),nn(t,nr(this.parentInfoEncoder)),nn(t,this.typeRefEncoder.toUint8Array()),nn(t,this.lenEncoder.toUint8Array()),Na(t,nr(this.restEncoder)),nr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){ko(this.restEncoder,t)}writeBuf(t){nn(this.restEncoder,t)}writeJSON(t){ko(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Yw=(e,t,n,r)=>{r=Yi(r,t[0].id.clock);const i=xr(t,r);Pt(e.restEncoder,t.length-i),e.writeClient(n),Pt(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Au=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{Ye(t,s)>i&&r.set(s,i)}),za(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Pt(e.restEncoder,r.size),bi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Yw(e,t.clients.get(i),i,s)})},Vw=(e,t)=>{const n=rr(),r=Bt(e.restDecoder);for(let i=0;i<r;i++){const s=Bt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Bt(e.restDecoder);n.set(a,{i:0,refs:o});for(let u=0;u<s;u++){const l=e.readInfo();switch(Ra&l){case 0:{const h=e.readLen();o[u]=new Kn(Vt(a,c),h),c+=h;break}case 10:{const h=Bt(e.restDecoder);o[u]=new Wn(Vt(a,c),h),c+=h;break}default:{const h=(l&(Yr|Cn))===0,f=new De(Vt(a,c),null,(l&Cn)===Cn?e.readLeftID():null,null,(l&Yr)===Yr?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(l&_o)===_o?e.readString():null,n0(e,l));o[u]=f,c+=f.length}}}}return n},qw=(e,t,n)=>{const r=[];let i=bi(n.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=n.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=n.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new Rp,c=new Map,u=(d,p)=>{const g=c.get(d);(g==null||g>p)&&c.set(d,p)};let l=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,g=n.get(p);g?(g.i--,a.clients.set(p,g.refs.slice(g.i)),n.delete(p),g.i=0,g.refs=[]):a.clients.set(p,[d]),i=i.filter(k=>k!==p)}r.length=0};for(;;){if(l.constructor!==Wn){const p=ki(h,l.id.client,()=>Ye(t,l.id.client))-l.id.clock;if(p<0)r.push(l),u(l.id.client,l.id.clock-1),f();else{const g=l.getMissing(e,t);if(g!==null){r.push(l);const k=n.get(g)||{refs:[],i:0};if(k.refs.length===k.i)u(g,Ye(t,g)),f();else{l=k.refs[k.i++];continue}}else(p===0||p<l.length)&&(l.integrate(e,p),h.set(l.id.client,l.id.clock+l.length))}}if(r.length>0)l=r.pop();else if(o!==null&&o.i<o.refs.length)l=o.refs[o.i++];else{if(o=s(),o===null)break;l=o.refs[o.i++]}}if(a.clients.size>0){const d=new Xi;return Au(d,a,new Map),Pt(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},Xw=(e,t)=>Au(e,t.doc.store,t.beforeState),Jw=(e,t,n,r=new Ls(e))=>le(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=Vw(r,o),u=qw(i,a,c),l=a.pendingStructs;if(l){for(const[f,d]of l.missing)if(d<Ye(a,f)){s=!0;break}if(u){for(const[f,d]of u.missing){const p=l.missing.get(f);(p==null||p>d)&&l.missing.set(f,d)}l.update=Wa([l.update,u.update])}}else a.pendingStructs=u;const h=mp(r,i,a);if(a.pendingDs){const f=new Ls(Vi(a.pendingDs));Bt(f.restDecoder);const d=mp(f,i,a);h&&d?a.pendingDs=Wa([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,wp(i.doc,f)}},n,!1),wp=(e,t,n,r=Ls)=>{const i=Vi(t);Jw(i,e,n,new r(i))},Zw=(e,t,n)=>wp(e,t,n,_p),Qw=(e,t,n=new Map)=>{Au(e,t.store,n),Os(e,Gw(t.store))},tk=(e,t=new Uint8Array([0]),n=new Xi)=>{const r=kp(t);Qw(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(mk(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===So)return dk(i.map((s,o)=>o===0?s:yk(s)));if(n.constructor===Xi)return Wa(i)}return i[0]},ek=(e,t)=>tk(e,t,new So),nk=e=>{const t=new Map,n=Bt(e.restDecoder);for(let r=0;r<n;r++){const i=Bt(e.restDecoder),s=Bt(e.restDecoder);t.set(i,s)}return t},kp=e=>nk(new yp(Vi(e))),xp=(e,t)=>(Pt(e.restEncoder,t.size),bi(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Pt(e.restEncoder,n),Pt(e.restEncoder,r)}),e),rk=(e,t)=>xp(e,za(t.store)),ik=(e,t=new Ep)=>(e instanceof Map?xp(t,e):rk(t,e),t.toUint8Array()),sk=e=>ik(e,new bp);class ok{constructor(){this.l=[]}}const Tp=()=>new ok,Ap=(e,t)=>e.l.push(t),vp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Sp=(e,t,n)=>_u(e.l,[t,n]);class Ms{constructor(t,n){this.client=t,this.clock=n}}const ja=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,Vt=(e,t)=>new Ms(e,t),ak=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw _r()},Us=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!pp(t.ds,e.id),vu=(e,t)=>{const n=ki(e.meta,vu,xs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<Ye(r,s)&&Ti(e,Vt(s,i))}),dp(e,t.ds,i=>{}),n.add(t))};class Rp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const za=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},Ye=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Ip=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw _r()}n.push(t)},xr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=_i(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=_i((n+r)/2)}throw _r()},Su=(e,t)=>{const n=e.clients.get(t.client);return n[xr(n,t.clock)]},Ru=(e,t,n)=>{const r=xr(t,n),i=t[r];return i.id.clock<n&&i instanceof De?(t.splice(r+1,0,ec(e,i,n-i.id.clock)),r+1):r},Ti=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Ru(e,n,t.clock)]},Np=(e,t,n)=>{const r=t.clients.get(n.client),i=xr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Kn&&r.splice(i+1,0,ec(e,s,n.clock-s.id.clock+1)),s},ck=(e,t,n)=>{const r=e.clients.get(t.id.client);r[xr(r,t.id.clock)]=n},Op=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=Ru(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&Ru(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class lk{constructor(t,n,r){this.doc=t,this.deleteSet=new vo,this.beforeState=za(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Cp=(e,t)=>t.deleteSet.clients.size===0&&!XE(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(xu(t.deleteSet),Xw(e,t),Os(e,t.deleteSet),!0),Lp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&ki(e.changed,t,xs).add(n)},Ka=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof De&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},uk=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let u=xr(s,a.clock),l=s[u];u<s.length&&l.id.clock<c;l=s[++u]){const h=s[u];if(a.clock+a.len<=h.id.clock)break;h instanceof De&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},hk=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=Ad(i.length-1,1+xr(i,o.clock+o.len-1));for(let c=a,u=i[c];c>0&&u.id.clock>=o.clock;u=i[c])c-=1+Ka(i,c)}})},Mp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{xu(s),n.afterState=za(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(c=c.filter(l=>l.target._item===null||!l.target._item.deleted),c.forEach(l=>{l.currentTarget=u,l._path=null}),c.sort((l,h)=>l.path.length-h.path.length),Sp(u._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),_u(a,[]),n._needFormattingCleanup&&Ok(n)}finally{r.gc&&uk(s,i,r.gcFilter),hk(s,i),n.afterState.forEach((l,h)=>{const f=n.beforeState.get(h)||0;if(f!==l){const d=i.clients.get(h),p=Yi(xr(d,f),1);for(let g=d.length-1;g>=p;)g-=1+Ka(d,g)}});for(let l=o.length-1;l>=0;l--){const{client:h,clock:f}=o[l].id,d=i.clients.get(h),p=xr(d,f);p+1<d.length&&Ka(d,p+1)>1||p>0&&Ka(d,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Dw(Eu,ap,"[yjs] ",cp,lp,"Changed the client-id because another client seems to be using it."),r.clientID=gp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const l=new So;Cp(l,n)&&r.emit("update",[l.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const l=new Xi;Cp(l,n)&&r.emit("updateV2",[l.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:u}=n;(a.size>0||u.size>0||c.size>0)&&(a.forEach(l=>{l.clientID=r.clientID,l.collectionid==null&&(l.collectionid=r.collectionid),r.subdocs.add(l)}),u.forEach(l=>r.subdocs.delete(l)),r.emit("subdocs",[{loaded:c,added:a,removed:u},r,n]),u.forEach(l=>l.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Mp(e,t+1)}}},le=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new lk(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&Mp(i,0)}}return o};function*fk(e){const t=Bt(e.restDecoder);for(let n=0;n<t;n++){const r=Bt(e.restDecoder),i=e.readClient();let s=Bt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Bt(e.restDecoder);yield new Wn(Vt(i,s),c),s+=c}else if(Ra&a){const c=(a&(Yr|Cn))===0,u=new De(Vt(i,s),null,(a&Cn)===Cn?e.readLeftID():null,null,(a&Yr)===Yr?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&_o)===_o?e.readString():null,n0(e,a));yield u,s+=u.length}else{const c=e.readLen();yield new Kn(Vt(i,s),c),s+=c}}}}class Iu{constructor(t,n){this.gen=fk(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Wn);return this.curr}}class Nu{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const dk=e=>Wa(e,_p,So),pk=(e,t)=>{if(e.constructor===Kn){const{client:n,clock:r}=e.id;return new Kn(Vt(n,r+t),e.length-t)}else if(e.constructor===Wn){const{client:n,clock:r}=e.id;return new Wn(Vt(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new De(Vt(r,i+t),null,Vt(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Wa=(e,t=Ls,n=Xi)=>{if(e.length===1)return e[0];const r=e.map(l=>new t(Vi(l)));let i=r.map(l=>new Iu(l,!0)),s=null;const o=new n,a=new Nu(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===Wn?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const l=i[0],h=l.curr.id.client;if(s!==null){let f=l.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=l.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Ai(a,s.struct,s.offset),s={struct:f,offset:0},l.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===Wn)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Ai(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Wn(Vt(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===Wn?s.struct.length-=p:f=pk(f,p)),s.struct.mergeWith(f)||(Ai(a,s.struct,s.offset),s={struct:f,offset:0},l.next())}}else s={struct:l.curr,offset:0},l.next();for(let f=l.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==Wn;f=l.next())Ai(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Ai(a,s.struct,s.offset),s=null),Ou(a);const c=r.map(l=>Tu(l)),u=Kw(c);return Os(o,u),o.toUint8Array()},mk=(e,t,n=Ls,r=Xi)=>{const i=kp(t),s=new r,o=new Nu(s),a=new n(Vi(e)),c=new Iu(a,!1);for(;c.curr;){const l=c.curr,h=l.id.client,f=i.get(h)||0;if(c.curr.constructor===Wn){c.next();continue}if(l.id.clock+l.length>f)for(Ai(o,l,Yi(f-l.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Ai(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}Ou(o);const u=Tu(a);return Os(s,u),s.toUint8Array()},Up=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:nr(e.encoder.restEncoder)}),e.encoder.restEncoder=wi(),e.written=0)},Ai=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Up(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),Pt(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Ou=e=>{Up(e);const t=e.encoder.restEncoder;Pt(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];Pt(t,r.written),Na(t,r.restEncoder)}},gk=(e,t,n,r)=>{const i=new n(Vi(e)),s=new Iu(i,!1),o=new r,a=new Nu(o);for(let u=s.curr;u!==null;u=s.next())Ai(a,t(u),0);Ou(a);const c=Tu(i);return Os(o,c),o.toUint8Array()},yk=e=>gk(e,Tw,Ls,So),Fp="You must not compute changes after the event-handler fired.";class Ga{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=_k(this.currentTarget,this.target))}deletes(t){return pp(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ei(Fp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Ql(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Ql(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Ql(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ei(Fp);const n=this.target,r=xs(),i=xs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=u.length,i.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const _k=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},rn=()=>{$w("Invalid access: Add Yjs type to a document before reading data.")},Pp=80;let Cu=0;class bk{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Cu++}}const Ek=e=>{e.timestamp=Cu++},Bp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Cu++},wk=(e,t,n)=>{if(e.length>=Pp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Bp(r,t,n),r}else{const r=new bk(t,n);return e.push(r),r}},Ha=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Ia(t-s.index)<Ia(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Ek(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Ia(n.index-i)<r.parent.length/Pp?(Bp(n,r,i),n):wk(e._searchMarker,r,i)},Ro=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=Yi(t,i.index+n))}},Ya=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;ki(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Sp(r._eH,n,t)};class Qe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Tp(),this._dEH=Tp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw yr()}clone(){throw yr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ap(this._eH,t)}observeDeep(t){Ap(this._dEH,t)}unobserve(t){vp(this._eH,t)}unobserveDeep(t){vp(this._dEH,t)}toJSON(){}}const Dp=(e,t,n)=>{e.doc??rn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},$p=e=>{e.doc??rn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Io=(e,t)=>{let n=0,r=e._start;for(e.doc??rn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},jp=(e,t)=>{const n=[];return Io(e,(r,i)=>{n.push(t(r,i,e))}),n},kk=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},zp=(e,t)=>{e.doc??rn();const n=Ha(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Va=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let u=[];const l=()=>{u.length>0&&(i=new De(Vt(o,Ye(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Qi(u)),i.integrate(e,0),u=[])};r.forEach(h=>{if(h===null)u.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(h);break;default:switch(l(),h.constructor){case Uint8Array:case ArrayBuffer:i=new De(Vt(o,Ye(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new No(new Uint8Array(h))),i.integrate(e,0);break;case Cs:i=new De(Vt(o,Ye(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Co(h)),i.integrate(e,0);break;default:if(h instanceof Qe)i=new De(Vt(o,Ye(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Qr(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),l()},Kp=()=>Ei("Length exceeded!"),Wp=(e,t,n,r)=>{if(n>t._length)throw Kp();if(n===0)return t._searchMarker&&Ro(t._searchMarker,n,r.length),Va(e,t,null,r);const i=n,s=Ha(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Ti(e,Vt(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Ro(t._searchMarker,i,r.length),Va(e,t,o,r)},xk=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return Va(e,t,i,n)},Gp=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=Ha(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Ti(e,Vt(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ti(e,Vt(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Kp();t._searchMarker&&Ro(t._searchMarker,i,-s+r)},qa=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Lu=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new Qi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Qi([r]);break;case Uint8Array:a=new No(r);break;case Cs:a=new Co(r);break;default:if(r instanceof Qe)a=new Qr(r);else throw new Error("Unexpected content type")}new De(Vt(o,Ye(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Mu=(e,t)=>{e.doc??rn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Hp=e=>{const t={};return e.doc??rn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Yp=(e,t)=>{e.doc??rn();const n=e._map.get(t);return n!==void 0&&!n.deleted},Tk=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Us(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},Xa=e=>(e.doc??rn(),jw(e._map.entries(),t=>!t[1].deleted));class Ak extends Ga{}class Fs extends Qe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Fs;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Fs}clone(){const t=new Fs;return t.insert(0,this.toArray().map(n=>n instanceof Qe?n.clone():n)),t}get length(){return this.doc??rn(),this._length}_callObserver(t,n){super._callObserver(t,n),Ya(this,t,new Ak(this,t))}insert(t,n){this.doc!==null?le(this.doc,r=>{Wp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?le(this.doc,n=>{xk(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?le(this.doc,r=>{Gp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return zp(this,t)}toArray(){return $p(this)}slice(t=0,n=this.length){return Dp(this,t,n)}toJSON(){return this.map(t=>t instanceof Qe?t.toJSON():t)}map(t){return jp(this,t)}forEach(t){Io(this,t)}[Symbol.iterator](){return kk(this)}_write(t){t.writeTypeRef(Xk)}}const vk=e=>new Fs;class Sk extends Ga{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Ps extends Qe{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Ps}clone(){const t=new Ps;return this.forEach((n,r)=>{t.set(r,n instanceof Qe?n.clone():n)}),t}_callObserver(t,n){Ya(this,t,new Sk(this,t,n))}toJSON(){this.doc??rn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof Qe?i.toJSON():i}}),t}get size(){return[...Xa(this)].length}keys(){return wu(Xa(this),t=>t[0])}values(){return wu(Xa(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return wu(Xa(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??rn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?le(this.doc,n=>{qa(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?le(this.doc,r=>{Lu(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Mu(this,t)}has(t){return Yp(this,t)}clear(){this.doc!==null?le(this.doc,t=>{this.forEach(function(n,r,i){qa(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Jk)}}const Rk=e=>new Ps,vi=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&kw(e,t);class Uu{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&_r(),this.right.content.constructor){case Be:this.right.deleted||Bs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Vp=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Be:t.right.deleted||Bs(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Ti(e,Vt(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Ja=(e,t,n,r)=>{const i=new Map,s=r?Ha(t,n):null;if(s){const o=new Uu(s.p.left,s.p,s.index,i);return Vp(e,o,n-s.index)}else{const o=new Uu(null,t._start,0,i);return Vp(e,o,n)}},qp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Be&&vi(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,u=n.right,l=new De(Vt(s,Ye(i.store,s)),c,c&&c.lastId,u,u&&u.id,t,null,new Be(a,o));l.integrate(e,0),n.right=l,n.forward()})},Bs=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Xp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Be&&vi(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Jp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],u=n.currentAttributes.get(a)??null;if(!vi(u,c)){o.set(a,u);const{left:l,right:h}=n;n.right=new De(Vt(s,Ye(i.store,s)),l,l&&l.lastId,h,h&&h.id,t,null,new Be(a,c)),n.right.integrate(e,0),n.forward()}}return o},Fu=(e,t,n,r,i)=>{n.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=e.doc,o=s.clientID;Xp(n,i);const a=Jp(e,t,n,i),c=r.constructor===String?new Tr(r):r instanceof Qe?new Qr(r):new Zi(r);let{left:u,right:l,index:h}=n;t._searchMarker&&Ro(t._searchMarker,n.index,c.getLength()),l=new De(Vt(o,Ye(s.store,o)),u,u&&u.lastId,l,l&&l.id,t,null,c),l.integrate(e,0),n.right=l,n.index=h,n.forward(),qp(e,t,n,a)},Zp=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Xp(n,i);const a=Jp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Be));){if(!n.right.deleted)switch(n.right.content.constructor){case Be:{const{key:c,value:u}=n.right.content,l=i[c];if(l!==void 0){if(vi(l,u))a.delete(c);else{if(r===0)break t;a.set(c,u)}n.right.delete(e)}else n.currentAttributes.set(c,u);break}default:r<n.right.length&&Ti(e,Vt(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new De(Vt(o,Ye(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Tr(c)),n.right.integrate(e,0),n.forward()}qp(e,t,n,a)},Qp=(e,t,n,r,i)=>{let s=t;const o=rr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Be){const u=s.content;o.set(u.key,u)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const u=t.content;switch(u.constructor){case Be:{const{key:l,value:h}=u,f=r.get(l)??null;(o.get(l)!==u||f===h)&&(t.delete(e),a++,!c&&(i.get(l)??null)===h&&f!==h&&(f===null?i.delete(l):i.set(l,f))),!c&&!t.deleted&&Bs(i,u);break}}}t=t.right}return a},Ik=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Be){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Nk=e=>{let t=0;return le(e.doc,n=>{let r=e._start,i=e._start,s=rr();const o=du(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Be:Bs(o,i.content);break;default:t+=Qp(n,r,i,s,o),s=du(o),r=i;break}i=i.right}}),t},Ok=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&Op(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Be&&o.constructor!==Kn&&t.add(o.parent)})}le(n,r=>{dp(e,e.deleteSet,i=>{if(i instanceof Kn||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Be?t.add(s):Ik(r,i)});for(const i of t)Nk(i)})},t0=(e,t,n)=>{const r=n,i=du(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Qr:case Zi:case Tr:n<t.right.length&&Ti(e,Vt(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Qp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Ro(o._searchMarker,t.index,-r+n),t};class Ck extends Ga{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];le(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let u="",l=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof u=="object"||u.length>0)&&(d={insert:u},i.size>0&&(d.attributes={},i.forEach((p,g)=>{p!==null&&(d.attributes[g]=p)}))),u="";break;case"retain":l>0&&(d={retain:l},bw(c)||(d.attributes=gw({},c))),l=0;break}d&&n.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case Qr:case Zi:this.adds(o)?this.deletes(o)||(f(),a="insert",u=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=1);break;case Tr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),l+=o.length);break;case Be:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=i.get(d)??null;vi(g,p)?p!==null&&o.delete(r):(a==="retain"&&f(),vi(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const g=i.get(d)??null;vi(g,p)||(a==="retain"&&f(),c[d]=g)}else if(!o.deleted){s.set(d,p);const g=c[d];g!==void 0&&(vi(g,p)?g!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),Bs(i,o.content));break}}o=o.right}for(f();n.length>0;){const d=n[n.length-1];if(d.retain!==void 0&&d.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Zr extends Qe{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??rn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Zr}clone(){const t=new Zr;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new Ck(this,t,n);Ya(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??rn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Tr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?le(this.doc,r=>{const i=new Uu(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Fu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Zp(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&t0(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??rn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function u(){if(a.length>0){const h={};let f=!1;s.forEach((p,g)=>{f=!0,h[g]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const l=()=>{for(;c!==null;){if(Us(c,t)||n!==void 0&&Us(c,n))switch(c.content.constructor){case Tr:{const h=s.get("ychange");t!==void 0&&!Us(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(u(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Us(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(u(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(u(),s.delete("ychange")),a+=c.content.str;break}case Qr:case Zi:{u();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case Be:Us(c,t)&&(u(),Bs(s,c.content));break}c=c.right}u()};return t||n?le(o,h=>{t&&vu(h,t),n&&vu(h,n),l()},"cleanup"):l(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?le(i,s=>{const o=Ja(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Fu(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?le(i,s=>{const o=Ja(s,this,t,!r);Fu(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?le(r,i=>{t0(i,Ja(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?le(i,s=>{const o=Ja(s,this,t,!1);o.right!==null&&Zp(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?le(this.doc,n=>{qa(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?le(this.doc,r=>{Lu(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Mu(this,t)}getAttributes(){return Hp(this)}_write(t){t.writeTypeRef(Zk)}}const Lk=e=>new Zr;class Pu{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??rn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Ds||n.constructor===Ji)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Ji extends Qe{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ji}clone(){const t=new Ji;return t.insert(0,this.toArray().map(n=>n instanceof Qe?n.clone():n)),t}get length(){return this.doc??rn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Pu(this,t)}querySelector(t){t=t.toUpperCase();const r=new Pu(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),bi(new Pu(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Ya(this,t,new Fk(this,n,t))}toString(){return jp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Io(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?le(this.doc,r=>{Wp(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)le(this.doc,r=>{const i=t&&t instanceof Qe?t._item:t;Va(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Ei("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?le(this.doc,r=>{Gp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return $p(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return zp(this,t)}slice(t=0,n=this.length){return Dp(this,t,n)}forEach(t){Io(this,t)}_write(t){t.writeTypeRef(tx)}}const Mk=e=>new Ji;class Ds extends Ji{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Ds(this.nodeName)}clone(){const t=new Ds(this.nodeName),n=this.getAttributes();return _w(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof Qe?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?le(this.doc,n=>{qa(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?le(this.doc,r=>{Lu(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Mu(this,t)}hasAttribute(t){return Yp(this,t)}getAttributes(t){return t?Tk(this,t):Hp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Io(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Qk),t.writeKey(this.nodeName)}}const Uk=e=>new Ds(e.readKey());class Fk extends Ga{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Za extends Ps{constructor(t){super(),this.hookName=t}_copy(){return new Za(this.hookName)}clone(){const t=new Za(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(ex),t.writeKey(this.hookName)}}const Pk=e=>new Za(e.readKey());class Qa extends Zr{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Qa}clone(){const t=new Qa;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(nx)}}const Bk=e=>new Qa;class Bu{constructor(t,n){this.id=t,this.length=n}get deleted(){throw yr()}mergeWith(t){return!1}write(t,n,r){throw yr()}integrate(t,n){throw yr()}}const Dk=0;class Kn extends Bu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ip(t.doc.store,this)}write(t,n){t.writeInfo(Dk),t.writeLen(this.length-n)}getMissing(t,n){return null}}class No{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new No(this.content)}splice(t){throw yr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const $k=e=>new No(e.readBuf());class Oo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Oo(this.len)}splice(t){const n=new Oo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){$a(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const jk=e=>new Oo(e.readLen()),e0=(e,t)=>new Cs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Co{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Co(e0(this.doc.guid,this.opts))}splice(t){throw yr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const zk=e=>new Co(e0(e.readString(),e.readAny()));class Zi{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Zi(this.embed)}splice(t){throw yr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Kk=e=>new Zi(e.readJSON());class Be{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Be(this.key,this.value)}splice(t){throw yr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Wk=e=>new Be(e.readKey(),e.readJSON());class tc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new tc(this.arr)}splice(t){const n=new tc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const Gk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new tc(n)},Hk=Da("node_env")==="development";class Qi{constructor(t){this.arr=t,Hk&&ip(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Qi(this.arr)}splice(t){const n=new Qi(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const Yk=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Qi(n)};class Tr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Tr(this.str)}splice(t){const n=new Tr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Vk=e=>new Tr(e.readString()),qk=[vk,Rk,Lk,Uk,Mk,Pk,Bk],Xk=0,Jk=1,Zk=2,Qk=3,tx=4,ex=5,nx=6;class Qr{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Qr(this.type._copy())}splice(t){throw yr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const rx=e=>new Qr(qk[e.readTypeRef()](e)),ec=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new De(Vt(r,i+n),t,Vt(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=Vt(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class De extends Bu{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Td:0}set marker(t){(this.info&Jl)>0!==t&&(this.info^=Jl)}get marker(){return(this.info&Jl)>0}get keep(){return(this.info&xd)>0}set keep(t){this.keep!==t&&(this.info^=xd)}get countable(){return(this.info&Td)>0}get deleted(){return(this.info&Xl)>0}set deleted(t){this.deleted!==t&&(this.info^=Xl)}markDeleted(){this.info|=Xl}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Ye(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Ye(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ms&&this.id.client!==this.parent.client&&this.parent.clock>=Ye(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Np(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ti(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Kn||this.right&&this.right.constructor===Kn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===De?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===De&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ms){const r=Su(n,this.parent);r.constructor===Kn?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Np(t,t.doc.store,Vt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),ja(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(ja(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Su(t.doc.store,i.origin)))s.has(Su(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ip(t.doc.store,this),this.content.integrate(t,this),Lp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Kn(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:Vt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&ja(t.origin,this.lastId)&&this.right===t&&ja(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),$a(t.deleteSet,this.id.client,this.id.clock,this.length),Lp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw _r();this.content.gc(t),n?ck(t,this,new Kn(this.id,this.length)):this.content=new Oo(this.length)}write(t,n){const r=n>0?Vt(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&Ra|(r===null?0:Cn)|(i===null?0:Yr)|(s===null?0:_o);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const u=ak(a);t.writeParentInfo(!0),t.writeString(u)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Ms?(t.writeParentInfo(!1),t.writeLeftID(a)):_r();s!==null&&t.writeString(s)}this.content.write(t,n)}}const n0=(e,t)=>ix[t&Ra](e),ix=[()=>{_r()},jk,Gk,$k,Vk,Kk,Wk,rx,Yk,zk,()=>{_r()}],sx=10;class Wn extends Bu{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){_r()}write(t,n){t.writeInfo(sx),Pt(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const r0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Rs<"u"?Rs:{},i0="__ $YJS$ __";r0[i0]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),r0[i0]=!0;const Du=0,s0=1,o0=2,ox=(e,t)=>{Pt(e,Du);const n=sk(t);nn(e,n)},a0=(e,t,n)=>{Pt(e,s0),nn(e,ek(t,n))},ax=(e,t,n)=>a0(t,n,ln(e)),c0=(e,t,n)=>{try{Zw(t,ln(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},cx=(e,t)=>{Pt(e,o0),nn(e,t)},lx=c0,ux=(e,t,n,r)=>{const i=Bt(e);switch(i){case Du:ax(e,t,n);break;case s0:c0(e,n,r);break;case o0:lx(e,n,r);break;default:throw new Error("Unknown message type")}return i};let l0=!1;const Ar=new Cs;function u0(e,t,n){const r=Ar.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function hx(e,t){u0(e,0,t)}function $u(e,t){const n=new Zr(t);u0(e,1,n)}function fx(e,t){Ar.getMap().set(e,t)}function dx(e,t){const n=Ar.getMap(),r=new Zr(t);n.set(e,r)}function h0(e,t){const n=Ar.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function px(e,t){return h0(e,n=>{Lt(n)&&t(n)})}function f0(e,t){return h0(e,n=>{n instanceof Zr&&t(n.toJSON())})}function nc(e){return nr(e)}const Gn=ks("modem",["second"],e=>{if(Gn.session(e))switch(e.target){case"second":!l0&&e.data%2===0&&Gn.emit("modem:join");break;case"join":if(e.sender!==Gn.id()){Gn.reply(e,"joinack");const t=wi();ox(t,Ar),Gn.reply(e,"sync",nc(t));const n=wi();a0(n,Ar),Gn.reply(e,"sync",nc(n))}break;case"joinack":e.sender!==Gn.id()&&(l0=!0);break;case"sync":{if(e.sender!==Gn.id()&&w(e.data))try{const t=Vi(e.data),n=wi();ux(t,n,Ar,Gn)===Du&&Gn.emit("modem:sync",nc(n))}catch(t){oe(Gn,"sync",t.message)}break}}});function d0(e){const t=wi();cx(t,e),Gn.emit("modem:sync",nc(t))}Ar.on("update",d0),Ar.on("destroy",()=>{Ar.off("update",d0)});function mx(e,t){return e%t}function gx(e,t){return Math.floor(e/t)}function p0(e,t){return{x:mx(e,t),y:gx(e,t)}}function rc(e,t){return e.x+e.y*t}function m0(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function g0(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let u=a;u<=c;++u)for(let l=s;l<=o;++l)i.push({x:l,y:u});return i}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const y0="170",yx="",ir="srgb",_0="srgb-linear",b0="linear",ju="srgb";function $s(e,t,n){return Math.max(t,Math.min(n,e))}function _x(e,t){return(e%t+t)%t}function zu(e,t,n){return(1-n)*e+n*t}class Lo{constructor(t=0,n=0){Lo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Math.max(t.x,Math.min(n.x,this.x)),this.y=Math.max(t.y,Math.min(n.y,this.y)),this}clampScalar(t,n){return this.x=Math.max(t,Math.min(n,this.x)),this.y=Math.max(t,Math.min(n,this.y)),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos($s(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Mo{constructor(t,n,r,i,s,o,a,c,u){Mo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,u)}set(t,n,r,i,s,o,a,c,u){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=n,l[4]=s,l[5]=c,l[6]=r,l[7]=o,l[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],u=r[1],l=r[4],h=r[7],f=r[2],d=r[5],p=r[8],g=i[0],k=i[3],E=i[6],T=i[1],v=i[4],N=i[7],U=i[2],L=i[5],O=i[8];return s[0]=o*g+a*T+c*U,s[3]=o*k+a*v+c*L,s[6]=o*E+a*N+c*O,s[1]=u*g+l*T+h*U,s[4]=u*k+l*v+h*L,s[7]=u*E+l*N+h*O,s[2]=f*g+d*T+p*U,s[5]=f*k+d*v+p*L,s[8]=f*E+d*N+p*O,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8];return n*o*l-n*a*u-r*s*l+r*a*c+i*s*u-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=a*c-l*s,d=u*s-o*c,p=n*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return t[0]=h*g,t[1]=(i*u-l*r)*g,t[2]=(a*r-i*o)*g,t[3]=f*g,t[4]=(l*n-i*c)*g,t[5]=(i*s-a*n)*g,t[6]=d*g,t[7]=(r*c-u*n)*g,t[8]=(o*n-r*s)*g,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),u=Math.sin(s);return this.set(r*c,r*u,-r*(c*o+u*a)+o+t,-i*u,i*c,-i*(-u*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(Ku.makeScale(t,n)),this}rotate(t){return this.premultiply(Ku.makeRotation(-t)),this}translate(t,n){return this.premultiply(Ku.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ku=new Mo,Hn={enabled:!0,workingColorSpace:_0,spaces:{},convert:function(e,t,n){return this.enabled===!1||t===n||!t||!n||(this.spaces[t].transfer===ju&&(e.r=js(e.r),e.g=js(e.g),e.b=js(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===ju&&(e.r=zs(e.r),e.g=zs(e.g),e.b=zs(e.b))),e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===yx?b0:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}};function js(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function zs(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const E0=[.64,.33,.3,.6,.15,.06],w0=[.2126,.7152,.0722],k0=[.3127,.329],x0=new Mo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),T0=new Mo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);Hn.define({[_0]:{primaries:E0,whitePoint:k0,transfer:b0,toXYZ:x0,fromXYZ:T0,luminanceCoefficients:w0,workingColorSpaceConfig:{unpackColorSpace:ir},outputColorSpaceConfig:{drawingBufferColorSpace:ir}},[ir]:{primaries:E0,whitePoint:k0,transfer:ju,toXYZ:x0,fromXYZ:T0,luminanceCoefficients:w0,outputColorSpaceConfig:{drawingBufferColorSpace:ir}}});const A0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Si={h:0,s:0,l:0},ic={h:0,s:0,l:0};function Wu(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class Gu{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=ir){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Hn.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Hn.workingColorSpace){return this.r=t,this.g=n,this.b=r,Hn.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Hn.workingColorSpace){if(t=_x(t,1),n=$s(n,0,1),r=$s(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=Wu(o,s,t+1/3),this.g=Wu(o,s,t),this.b=Wu(o,s,t-1/3)}return Hn.toWorkingColorSpace(this,i),this}setStyle(t,n=ir){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=ir){const r=A0[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=js(t.r),this.g=js(t.g),this.b=js(t.b),this}copyLinearToSRGB(t){return this.r=zs(t.r),this.g=zs(t.g),this.b=zs(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ir){return Hn.fromWorkingColorSpace(sn.copy(this),t),Math.round($s(sn.r*255,0,255))*65536+Math.round($s(sn.g*255,0,255))*256+Math.round($s(sn.b*255,0,255))}getHexString(t=ir){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Hn.workingColorSpace){Hn.fromWorkingColorSpace(sn.copy(this),n);const r=sn.r,i=sn.g,s=sn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,u;const l=(a+o)/2;if(a===o)c=0,u=0;else{const h=o-a;switch(u=l<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return t.h=c,t.s=u,t.l=l,t}getRGB(t,n=Hn.workingColorSpace){return Hn.fromWorkingColorSpace(sn.copy(this),n),t.r=sn.r,t.g=sn.g,t.b=sn.b,t}getStyle(t=ir){Hn.fromWorkingColorSpace(sn.copy(this),t);const n=sn.r,r=sn.g,i=sn.b;return t!==ir?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Si),this.setHSL(Si.h+t,Si.s+n,Si.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Si),t.getHSL(ic);const r=zu(Si.h,ic.h,n),i=zu(Si.s,ic.s,n),s=zu(Si.l,ic.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const sn=new Gu;Gu.NAMES=A0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:y0}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=y0),new Lo,new Lo;function Ln(e,t,n){return Math.max(t,Math.min(n,e))}function Hu(e){return e*180/Math.PI}const bx=sd("089fad0j9awfem09wavefc09uwaef");function Ex(){return bx()}function wx(e){return sd(e)()}function Ri(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(Ex()*i)}function v0(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(wx(e)*s)}function S0(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function kx(e){return e[Ri(0,e.length-1)]}function xx(e,t){return t[v0(e,0,t.length-1)]}function Mn(...e){return kx(e.flat())}function R0(e,...t){return xx(e,t.flat())}function Tx(e){return[...new Set(e)].filter(w)}var I0={exports:{}},Yu={exports:{}},N0;function Ax(){return N0||(N0=1,function(e,t){(function(n,r){e.exports=r()})(_n,function(){function n(g){return!isNaN(parseFloat(g))&&isFinite(g)}function r(g){return g.charAt(0).toUpperCase()+g.substring(1)}function i(g){return function(){return this[g]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],u=["evalOrigin"],l=s.concat(o,a,c,u);function h(g){if(g)for(var k=0;k<l.length;k++)g[l[k]]!==void 0&&this["set"+r(l[k])](g[l[k]])}h.prototype={getArgs:function(){return this.args},setArgs:function(g){if(Object.prototype.toString.call(g)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=g},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(g){if(g instanceof h)this.evalOrigin=g;else if(g instanceof Object)this.evalOrigin=new h(g);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var g=this.getFileName()||"",k=this.getLineNumber()||"",E=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?g?"[eval] ("+g+":"+k+":"+E+")":"[eval]:"+k+":"+E:T?T+" ("+g+":"+k+":"+E+")":g+":"+k+":"+E}},h.fromString=function(k){var E=k.indexOf("("),T=k.lastIndexOf(")"),v=k.substring(0,E),N=k.substring(E+1,T).split(","),U=k.substring(T+1);if(U.indexOf("@")===0)var L=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),O=L[1],B=L[2],F=L[3];return new h({functionName:v,args:N||void 0,fileName:O,lineNumber:B||void 0,columnNumber:F||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=function(g){return function(k){this[g]=!!k}}(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=function(g){return function(k){if(!n(k))throw new TypeError(g+" must be a Number");this[g]=Number(k)}}(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=function(g){return function(k){this[g]=String(k)}}(a[p]);return h})}(Yu)),Yu.exports}(function(e,t){(function(n,r){e.exports=r(Ax())})(_n,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var u=/(.+?)(?::(\d+))?(?::(\d+))?$/,l=u.exec(c.replace(/[()]/g,""));return[l[1],l[2]||void 0,l[3]||void 0]},parseV8OrIE:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(s)},this);return u.map(function(l){l.indexOf("(eval ")>-1&&(l=l.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=l.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,g=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:g,lineNumber:d[1],columnNumber:d[2],source:l})},this)},parseFFOrSafari:function(c){var u=c.stack.split(`
`).filter(function(l){return!l.match(o)},this);return u.map(function(l){if(l.indexOf(" > eval")>-1&&(l=l.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),l.indexOf("@")===-1&&l.indexOf(":")===-1)return new r({functionName:l});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=l.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(l.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:l})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)/i,l=c.message.split(`
`),h=[],f=2,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera10:function(c){for(var u=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,l=c.stacktrace.split(`
`),h=[],f=0,d=l.length;f<d;f+=2){var p=u.exec(l[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:l[f]}))}return h},parseOpera11:function(c){var u=c.stack.split(`
`).filter(function(l){return!!l.match(i)&&!l.match(/^Error created at/)},this);return u.map(function(l){var h=l.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,g;d.match(/\(([^)]*)\)/)&&(g=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var k=g===void 0||g==="[arguments not available]"?void 0:g.split(",");return new r({functionName:p,args:k,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:l})},this)}}})})(I0);var vx=I0.exports,Sx=go(vx);const Vu=14,sc=3,oc=8,ac=14,cc=16,Rx=16,Ix=16;function lc(e,t){return new Array(e).fill(t)}function Nx(e,t,n,r,i=0){const s=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:lc(s,0),color:lc(s,0),bg:lc(s,i)}}function Ox(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:$t.ONCLEAR}}function Cx(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Lx(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:lc(s,i)}}function Mx(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function Ux(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5}}function O0(e,t){return`${e}:${t}`}const Fx=1,Px=16,Bx=256;var hn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(hn||{});const vr=!!JSON.parse("false"),Dx=!!JSON.parse("false");JSON.parse("false");const $x=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const ti={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return oc*ti.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return ac*ti.DRAW_CHAR_SCALE}},K=ks("SOFTWARE");function ei(e){const t={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},listcommands(){return mr(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function we(e){return`${e??""}`}function Uo(e,t){const n=parseFloat(we(e));return isNaN(n)?t:n}const jx=["echo","reverb","chorus","phaser","distortion","vibrato","fc"];function C0(e,t){const[n]=it(e,0,[q.NAME]);Vb(K,n,t)}function ni(e,t){const[n,r]=it(t,0,[q.NUMBER_OR_STRING]);if(Lt(n))Wl(K,e,"volume",n);else if(jx.includes(Ut(n))){const[i,s]=it(t,r,[q.NUMBER_OR_STRING,q.MAYBE_NUMBER_OR_STRING]);Qb(K,e,n,i,s)}else{const[i]=it(t,r,[q.MAYBE_NUMBER_OR_STRING]);if(Lt(i)){const s=t.length-r,o=new Array(s).fill(q.NUMBER),a=it(t,r,o).slice(0,s),c=a.length===1?a[0]:a;Wl(K,e,n,c)}else{const[s]=it(t,r,[q.MAYBE_NUMBER_OR_STRING]);Wl(K,e,n,s)}}}const zx=ei().command("tts",(e,t)=>{const[n,r]=it(t,0,[q.STRING]),i=t.slice(r).map(we).join("");return Hb(K,n,i),0}).command("tta",(e,t)=>{const n=t.map(we).join("");return Yb(K,n),0}).command("bpm",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return qb(K,n),0}).command("vol",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return Xb(K,n),0}).command("bgvol",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return Jb(K,n),0}).command("ttsvol",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return Zb(K,n),0}).command("play",(e,t)=>(C0(t,!1),0)).command("bgplay",(e,t)=>(C0(t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)ni(n,t);return 0}).command("synth1",(e,t)=>(ni(0,t),0)).command("synth2",(e,t)=>(ni(1,t),0)).command("synth3",(e,t)=>(ni(2,t),0)).command("synth4",(e,t)=>(ni(3,t),0)).command("synth5",(e,t)=>(ni(4,t),0)).command("synth6",(e,t)=>(ni(5,t),0)).command("synth7",(e,t)=>(ni(6,t),0)).command("synth8",(e,t)=>(ni(7,t),0));function Kx(e){return w(e)&&e<$t.ONBLACK?e:void 0}function Wx(e){return w(e)&&e>$t.WHITE&&e<$t.ONCLEAR?e-$t.ONBLACK:void 0}const Fo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function Un(e){return ee(e)&&M0(e[0])}function L0(e){return Un(e)&&e[0].startsWith("ON")}function M0(e){return w($t[e])&&St(e)}function U0(e){if(St(e))return Fo[Ut(e)]}function Gx(e){return e.map(t=>$t[t]).find(t=>w(t)&&t<$t.ONBLACK)}function Hx(e){return e.map(t=>$t[t]).find(t=>w(t)&&t>=$t.ONBLACK)}function Yx(e){if(Un(e))return e;if(M0(e))return[e];const t=U0(e);if(w(t))return[t]}function F0(e){const t=x.words[e],n=Yx(t);return Un(n)?[n,e+1]:[void 0,e]}function uc(e){const t=[];let n=e;const[r,i]=F0(e);if(Un(r)&&(t.push(...r),n=i),Un(t)&&!L0(t)){const[s,o]=F0(i);L0(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function P0(e){const t={};return e.every(n=>{const r=$t[n];w(r)&&(r<$t.ONBLACK?t.color=r:t.bg=r-$t.ONBLACK)}),t}function Ks(e){return ee(e)&&typeof e[0]=="string"}function Vx(e){const t=x.words[e];return St(t)?[t,e+1]:[void 0,e]}function B0(e){const t=x.words[e];if(Ks(t))return[t,e+1];const[n,r]=uc(e),[i,s]=Vx(r);return St(i)?[[i,n],s]:[void 0,e]}function hc(e){if(!Ks(e))return;const[t]=e;return t}function D0(e){if(!Ks(e))return;const[,t]=e,n=w(t)?Gx(t):void 0;return w(n)?n:void 0}function $0(e){if(!Ks(e))return;const[,t]=e,n=w(t)?Hx(t):void 0;return w(n)?n:void 0}const ne=60,Ve=25;var kt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(kt||{});function qu(e,t){const n=e??Gt.ISWALK,r=t??Gt.ISWALK;switch(n){case Gt.ISWALK:return r!==Gt.ISWALK;case Gt.ISSWIM:return r!==Gt.ISSWIM;case Gt.ISSOLID:return!0;case Gt.ISBULLET:return r!==Gt.ISWALK&&r!==Gt.ISSWIM}}function fc(e,t,n){const r=e==null?void 0:e.objects[n];if(w(r))return r;if(w(t)){const i=Po(e,"player"),s={x:t.x??0,y:t.y??0};K0(s,i)}}function Po(e,t){var r,i;return t==="empty"?[...(e==null?void 0:e.terrain)??[]].map((o,a)=>{if(!(o!=null&&o.name)&&!(o!=null&&o.kind))return{...p0(a,ne),name:"empty"}}).filter(w):[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(w)}function j0(e,t){const n=hc(t),r=D0(t),i=$0(t);return e.filter(s=>{var o,a,c;return!(w(n)&&Ut((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||w(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??$t.WHITE)!==r||w(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??$t.BLACK)!==i)}).filter(w)}function z0(e,t){return w(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(w(i))return i;const s=Po(e,Ut(n));if(s.length)return s}else if(lo(n)&&n.x>=0&&n.x<ne&&n.y>=0&&n.y<Ve){const i=n.x+n.y*ne,s=(r=e.lookup)==null?void 0:r[i];return w(s)?e.objects[s]:e.terrain[i]}}).flat().filter(w):[]}function K0(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var Xu;try{Xu=new TextDecoder}catch{}var mt,Yn,$=0,ue={},qt,Ii,Vn=0,Sr=0,qe,ri,En=[],Yt,W0={useRecords:!1,mapsAsObjects:!0};class G0{}const H0=new G0;H0.name="MessagePack 0xC1";var Ni=!1,Y0=2,V0;try{new Function("")}catch{Y0=1/0}class Bo{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(mt)return am(()=>(eh(),this?this.unpack(t,n):Bo.prototype.unpack.call(W0,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof Ze<"u"?Ze.from(t):new Uint8Array(t)),typeof n=="object"?(Yn=n.end||t.length,$=n.start||0):($=0,Yn=n>-1?n:t.length),Sr=0,Ii=null,qe=null,mt=t;try{Yt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw mt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof Bo){if(ue=this,this.structures)return qt=this.structures,dc(n);(!qt||qt.length>0)&&(qt=[])}else ue=W0,(!qt||qt.length>0)&&(qt=[]);return dc(n)}unpackMultiple(t,n){let r,i=0;try{Ni=!0;let s=t.length,o=this?this.unpack(t,s):pc.unpack(t,s);if(n){if(n(o,i,$)===!1)return;for(;$<s;)if(i=$,n(dc(),i,$)===!1)return}else{for(r=[o];$<s;)i=$,r.push(dc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Ni=!1,eh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function dc(e){try{if(!ue.trusted&&!Ni){let n=qt.sharedLength||0;n<qt.length&&(qt.length=n)}let t;if(ue.randomAccessStructure&&mt[$]<64&&mt[$]>=32&&V0?(t=V0(mt,$,Yn,ue),mt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),$=Yn):t=Oe(),qe&&($=qe.postBundlePosition,qe=null),Ni&&(qt.restoreStructures=null),$==Yn)qt&&qt.restoreStructures&&q0(),qt=null,mt=null,ri&&(ri=null);else{if($>Yn)throw new Error("Unexpected end of MessagePack data");if(!Ni){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw qt&&qt.restoreStructures&&q0(),eh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||$>Yn)&&(t.incomplete=!0),t}}function q0(){for(let e in qt.restoreStructures)qt[e]=qt.restoreStructures[e];qt.restoreStructures=null}function Oe(){let e=mt[$++];if(e<160)if(e<128){if(e<64)return e;{let t=qt[e&63]||ue.getStructures&&J0()[e&63];return t?(t.read||(t.read=Ju(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,ue.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=rm();r==="__proto__"&&(r="__proto_"),t[r]=Oe()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Oe(),Oe());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=Oe();return ue.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Sr>=$)return Ii.slice($-Vn,($+=t)-Vn);if(Sr==0&&Yn<140){let n=t<16?Qu(t):tm(t);if(n!=null)return n}return Zu(t)}else{let t;switch(e){case 192:return null;case 193:return qe?(t=Oe(),t>0?qe[1].slice(qe.position1,qe.position1+=t):qe[0].slice(qe.position0,qe.position0-=t)):H0;case 194:return!1;case 195:return!0;case 196:if(t=mt[$++],t===void 0)throw new Error("Unexpected end of buffer");return th(t);case 197:return t=Yt.getUint16($),$+=2,th(t);case 198:return t=Yt.getUint32($),$+=4,th(t);case 199:return ts(mt[$++]);case 200:return t=Yt.getUint16($),$+=2,ts(t);case 201:return t=Yt.getUint32($),$+=4,ts(t);case 202:if(t=Yt.getFloat32($),ue.useFloat32>2){let n=nh[(mt[$]&127)<<1|mt[$+1]>>7];return $+=4,(n*t+(t>0?.5:-.5)>>0)/n}return $+=4,t;case 203:return t=Yt.getFloat64($),$+=8,t;case 204:return mt[$++];case 205:return t=Yt.getUint16($),$+=2,t;case 206:return t=Yt.getUint32($),$+=4,t;case 207:return ue.int64AsType==="number"?(t=Yt.getUint32($)*4294967296,t+=Yt.getUint32($+4)):ue.int64AsType==="string"?t=Yt.getBigUint64($).toString():ue.int64AsType==="auto"?(t=Yt.getBigUint64($),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Yt.getBigUint64($),$+=8,t;case 208:return Yt.getInt8($++);case 209:return t=Yt.getInt16($),$+=2,t;case 210:return t=Yt.getInt32($),$+=4,t;case 211:return ue.int64AsType==="number"?(t=Yt.getInt32($)*4294967296,t+=Yt.getUint32($+4)):ue.int64AsType==="string"?t=Yt.getBigInt64($).toString():ue.int64AsType==="auto"?(t=Yt.getBigInt64($),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Yt.getBigInt64($),$+=8,t;case 212:if(t=mt[$++],t==114)return sm(mt[$++]&63);{let n=En[t];if(n)return n.read?($++,n.read(Oe())):n.noBuffer?($++,n()):n(mt.subarray($,++$));throw new Error("Unknown extension "+t)}case 213:return t=mt[$],t==114?($++,sm(mt[$++]&63,mt[$++])):ts(2);case 214:return ts(4);case 215:return ts(8);case 216:return ts(16);case 217:return t=mt[$++],Sr>=$?Ii.slice($-Vn,($+=t)-Vn):Xx(t);case 218:return t=Yt.getUint16($),$+=2,Sr>=$?Ii.slice($-Vn,($+=t)-Vn):Jx(t);case 219:return t=Yt.getUint32($),$+=4,Sr>=$?Ii.slice($-Vn,($+=t)-Vn):Zx(t);case 220:return t=Yt.getUint16($),$+=2,Z0(t);case 221:return t=Yt.getUint32($),$+=4,Z0(t);case 222:return t=Yt.getUint16($),$+=2,Q0(t);case 223:return t=Yt.getUint32($),$+=4,Q0(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const qx=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Ju(e,t){function n(){if(n.count++>Y0){let i=e.read=new Function("r","return function(){return "+(ue.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":qx.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Oe);return e.highByte===0&&(e.read=X0(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=Oe()}return ue.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?X0(t,n):n}const X0=(e,t)=>function(){let n=mt[$++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=qt[r]||J0()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Ju(i,e)),i.read()};function J0(){let e=am(()=>(mt=null,ue.getStructures()));return qt=ue._mergeStructures(e,qt)}var Zu=Do,Xx=Do,Jx=Do,Zx=Do;function Do(e){let t;if(e<16&&(t=Qu(e)))return t;if(e>64&&Xu)return Xu.decode(mt.subarray($,$+=e));const n=$+e,r=[];for(t="";$<n;){const i=mt[$++];if(!(i&128))r.push(i);else if((i&224)===192){const s=mt[$++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=mt[$++]&63,o=mt[$++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=mt[$++]&63,o=mt[$++]&63,a=mt[$++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=Xe.apply(String,r),r.length=0)}return r.length>0&&(t+=Xe.apply(String,r)),t}function Z0(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=Oe();return ue.freezeData?Object.freeze(t):t}function Q0(e){if(ue.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=rm();r==="__proto__"&&(r="__proto_"),t[r]=Oe()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(Oe(),Oe());return t}}var Xe=String.fromCharCode;function tm(e){let t=$,n=new Array(e);for(let r=0;r<e;r++){const i=mt[$++];if((i&128)>0){$=t;return}n[r]=i}return Xe.apply(String,n)}function Qu(e){if(e<4)if(e<2){if(e===0)return"";{let t=mt[$++];if((t&128)>1){$-=1;return}return Xe(t)}}else{let t=mt[$++],n=mt[$++];if((t&128)>0||(n&128)>0){$-=2;return}if(e<3)return Xe(t,n);let r=mt[$++];if((r&128)>0){$-=3;return}return Xe(t,n,r)}else{let t=mt[$++],n=mt[$++],r=mt[$++],i=mt[$++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){$-=4;return}if(e<6){if(e===4)return Xe(t,n,r,i);{let s=mt[$++];if((s&128)>0){$-=5;return}return Xe(t,n,r,i,s)}}else if(e<8){let s=mt[$++],o=mt[$++];if((s&128)>0||(o&128)>0){$-=6;return}if(e<7)return Xe(t,n,r,i,s,o);let a=mt[$++];if((a&128)>0){$-=7;return}return Xe(t,n,r,i,s,o,a)}else{let s=mt[$++],o=mt[$++],a=mt[$++],c=mt[$++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){$-=8;return}if(e<10){if(e===8)return Xe(t,n,r,i,s,o,a,c);{let u=mt[$++];if((u&128)>0){$-=9;return}return Xe(t,n,r,i,s,o,a,c,u)}}else if(e<12){let u=mt[$++],l=mt[$++];if((u&128)>0||(l&128)>0){$-=10;return}if(e<11)return Xe(t,n,r,i,s,o,a,c,u,l);let h=mt[$++];if((h&128)>0){$-=11;return}return Xe(t,n,r,i,s,o,a,c,u,l,h)}else{let u=mt[$++],l=mt[$++],h=mt[$++],f=mt[$++];if((u&128)>0||(l&128)>0||(h&128)>0||(f&128)>0){$-=12;return}if(e<14){if(e===12)return Xe(t,n,r,i,s,o,a,c,u,l,h,f);{let d=mt[$++];if((d&128)>0){$-=13;return}return Xe(t,n,r,i,s,o,a,c,u,l,h,f,d)}}else{let d=mt[$++],p=mt[$++];if((d&128)>0||(p&128)>0){$-=14;return}if(e<15)return Xe(t,n,r,i,s,o,a,c,u,l,h,f,d,p);let g=mt[$++];if((g&128)>0){$-=15;return}return Xe(t,n,r,i,s,o,a,c,u,l,h,f,d,p,g)}}}}}function em(){let e=mt[$++],t;if(e<192)t=e-160;else switch(e){case 217:t=mt[$++];break;case 218:t=Yt.getUint16($),$+=2;break;case 219:t=Yt.getUint32($),$+=4;break;default:throw new Error("Expected string")}return Do(t)}function th(e){return ue.copyBuffers?Uint8Array.prototype.slice.call(mt,$,$+=e):mt.subarray($,$+=e)}function ts(e){let t=mt[$++];if(En[t]){let n;return En[t](mt.subarray($,n=$+=e),r=>{$=r;try{return Oe()}finally{$=n}})}else throw new Error("Unknown extension type "+t)}var nm=new Array(4096);function rm(){let e=mt[$++];if(e>=160&&e<192){if(e=e-160,Sr>=$)return Ii.slice($-Vn,($+=e)-Vn);if(!(Sr==0&&Yn<180))return Zu(e)}else return $--,im(Oe());let t=(e<<5^(e>1?Yt.getUint16($):e>0?mt[$]:0))&4095,n=nm[t],r=$,i=$+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Yt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=mt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return $=r,n.string;i-=3,r=$}for(n=[],nm[t]=n,n.bytes=e;r<i;)s=Yt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=mt[r++],n.push(s);let a=e<16?Qu(e):tm(e);return a!=null?n.string=a:n.string=Zu(e)}function im(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const sm=(e,t)=>{let n=Oe().map(im),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=qt[e];return i&&(i.isShared||Ni)&&((qt.restoreStructures||(qt.restoreStructures=[]))[e]=i),qt[e]=n,n.read=Ju(n,r),n.read()};En[0]=()=>{},En[0].noBuffer=!0,En[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let Qx={Error,TypeError,ReferenceError};En[101]=()=>{let e=Oe();return(Qx[e[0]]||Error)(e[1],{cause:e[2]})},En[105]=e=>{if(ue.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Yt.getUint32($-4);ri||(ri=new Map);let n=mt[$],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};ri.set(t,i);let s=Oe();return i.used?Object.assign(r,s):(i.target=s,s)},En[112]=e=>{if(ue.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Yt.getUint32($-4),n=ri.get(t);return n.used=!0,n.target},En[115]=()=>new Set(Oe());const om=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let tT=typeof globalThis=="object"?globalThis:window;En[116]=e=>{let t=e[0],n=om[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new tT[n](Uint8Array.prototype.slice.call(e,1).buffer)},En[120]=()=>{let e=Oe();return new RegExp(e[0],e[1])};const eT=[];En[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=$;return $+=t-e.length,qe=eT,qe=[em(),em()],qe.position0=0,qe.position1=0,qe.postBundlePosition=$,$=n,Oe()},En[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function am(e){let t=Yn,n=$,r=Vn,i=Sr,s=Ii,o=ri,a=qe,c=new Uint8Array(mt.slice(0,Yn)),u=qt,l=qt.slice(0,qt.length),h=ue,f=Ni,d=e();return Yn=t,$=n,Vn=r,Sr=i,Ii=s,ri=o,qe=a,mt=c,Ni=f,qt=u,qt.splice(0,qt.length,...l),ue=h,Yt=new DataView(mt.buffer,mt.byteOffset,mt.byteLength),d}function eh(){mt=null,ri=null,qt=null}const nh=new Array(147);for(let e=0;e<256;e++)nh[e]=+("1e"+Math.floor(45.15-e*.30103));var pc=new Bo({useRecords:!1});const nT=pc.unpack;pc.unpackMultiple,pc.unpack;let rT=new Float32Array(1);new Uint8Array(rT.buffer,0,4);let mc;try{mc=new TextEncoder}catch{}let rh,cm;const gc=typeof Ze<"u",yc=gc?function(e){return Ze.allocUnsafeSlow(e)}:Uint8Array,lm=gc?Ze:Uint8Array,um=gc?4294967296:2144337920;let V,$o,he,W=0,fn,ke=null,iT;const sT=21760,oT=/[\u0080-\uFFFF]/,Ws=Symbol("record-id");class aT extends Bo{constructor(t){super(t),this.offset=0;let n,r,i,s,o=lm.prototype.utf8Write?function(R,_){return V.utf8Write(R,_,V.byteLength-_)}:mc&&mc.encodeInto?function(R,_){return mc.encodeInto(R,V.subarray(_)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,l=t.maxSharedStructures;if(l==null&&(l=u?32:0),l>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let h=t.maxOwnStructures;h==null&&(h=u?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let f=l>32||h+l>64,d=l+64,p=l+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],k=0,E=0;this.pack=this.encode=function(R,_){if(V||(V=new yc(8192),he=V.dataView||(V.dataView=new DataView(V.buffer,0,8192)),W=0),fn=V.length-10,fn-W<2048?(V=new yc(V.length),he=V.dataView||(V.dataView=new DataView(V.buffer,0,V.length)),fn=V.length-10,W=0):W=W+7&2147483640,n=W,_&pT&&(W+=_&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof R!="string"?(ke=[],ke.size=1/0):ke=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Z=i.sharedLength||0;if(Z>l)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let j=0;j<Z;j++){let ut=i[j];if(!ut)continue;let tt,ht=i.transitions;for(let G=0,z=ut.length;G<z;G++){let bt=ut[G];tt=ht[bt],tt||(tt=ht[bt]=Object.create(null)),ht=tt}ht[Ws]=j+64}this.lastNamedStructuresLength=Z}c||(i.nextId=Z+64)}r&&(r=!1);let P;try{a.randomAccessStructure&&R&&R.constructor&&R.constructor===Object?M(R):N(R);let Z=ke;if(ke&&dm(n,N,0),s&&s.idsToInsert){let j=s.idsToInsert.sort((G,z)=>G.offset>z.offset?1:-1),ut=j.length,tt=-1;for(;Z&&ut>0;){let G=j[--ut].offset+n;G<Z.stringsPosition+n&&tt===-1&&(tt=0),G>Z.position+n?tt>=0&&(tt+=6):(tt>=0&&(he.setUint32(Z.position+n,he.getUint32(Z.position+n)+tt),tt=-1),Z=Z.previous,ut++)}tt>=0&&Z&&he.setUint32(Z.position+n,he.getUint32(Z.position+n)+tt),W+=j.length*6,W>fn&&F(W),a.offset=W;let ht=lT(V.subarray(n,W),j);return s=null,ht}return a.offset=W,_&fT?(V.start=n,V.end=W,V):V.subarray(n,W)}catch(Z){throw P=Z,Z}finally{if(i&&(T(),r&&a.saveStructures)){let Z=i.sharedLength||0,j=V.subarray(n,W),ut=uT(i,a);if(!P)return a.saveStructures(ut,ut.isCompatible)===!1?a.pack(R,_):(a.lastNamedStructuresLength=Z,V.length>1073741824&&(V=null),j)}V.length>1073741824&&(V=null),_&dT&&(W=n)}};const T=()=>{E<10&&E++;let R=i.sharedLength||0;if(i.length>R&&!c&&(i.length=R),k>1e4)i.transitions=null,E=0,k=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let _=0,P=g.length;_<P;_++)g[_][Ws]=0;g=[]}},v=R=>{var _=R.length;_<16?V[W++]=144|_:_<65536?(V[W++]=220,V[W++]=_>>8,V[W++]=_&255):(V[W++]=221,he.setUint32(W,_),W+=4);for(let P=0;P<_;P++)N(R[P])},N=R=>{W>fn&&(V=F(W));var _=typeof R,P;if(_==="string"){let Z=R.length;if(ke&&Z>=4&&Z<4096){if((ke.size+=Z)>sT){let ht,G=(ke[0]?ke[0].length*3+ke[1].length:0)+10;W+G>fn&&(V=F(W+G));let z;ke.position?(z=ke,V[W]=200,W+=3,V[W++]=98,ht=W-n,W+=4,dm(n,N,0),he.setUint16(ht+n-3,W-n-ht)):(V[W++]=214,V[W++]=98,ht=W-n,W+=4),ke=["",""],ke.previous=z,ke.size=0,ke.position=ht}let tt=oT.test(R);ke[tt?0:1]+=R,V[W++]=193,N(tt?-Z:Z);return}let j;Z<32?j=1:Z<256?j=2:Z<65536?j=3:j=5;let ut=Z*3;if(W+ut>fn&&(V=F(W+ut)),Z<64||!o){let tt,ht,G,z=W+j;for(tt=0;tt<Z;tt++)ht=R.charCodeAt(tt),ht<128?V[z++]=ht:ht<2048?(V[z++]=ht>>6|192,V[z++]=ht&63|128):(ht&64512)===55296&&((G=R.charCodeAt(tt+1))&64512)===56320?(ht=65536+((ht&1023)<<10)+(G&1023),tt++,V[z++]=ht>>18|240,V[z++]=ht>>12&63|128,V[z++]=ht>>6&63|128,V[z++]=ht&63|128):(V[z++]=ht>>12|224,V[z++]=ht>>6&63|128,V[z++]=ht&63|128);P=z-W-j}else P=o(R,W+j);P<32?V[W++]=160|P:P<256?(j<2&&V.copyWithin(W+2,W+1,W+1+P),V[W++]=217,V[W++]=P):P<65536?(j<3&&V.copyWithin(W+3,W+2,W+2+P),V[W++]=218,V[W++]=P>>8,V[W++]=P&255):(j<5&&V.copyWithin(W+5,W+3,W+3+P),V[W++]=219,he.setUint32(W,P),W+=4),W+=P}else if(_==="number")if(R>>>0===R)R<32||R<128&&this.useRecords===!1||R<64&&!this.randomAccessStructure?V[W++]=R:R<256?(V[W++]=204,V[W++]=R):R<65536?(V[W++]=205,V[W++]=R>>8,V[W++]=R&255):(V[W++]=206,he.setUint32(W,R),W+=4);else if(R>>0===R)R>=-32?V[W++]=256+R:R>=-128?(V[W++]=208,V[W++]=R+256):R>=-32768?(V[W++]=209,he.setInt16(W,R),W+=2):(V[W++]=210,he.setInt32(W,R),W+=4);else{let Z;if((Z=this.useFloat32)>0&&R<4294967296&&R>=-2147483648){V[W++]=202,he.setFloat32(W,R);let j;if(Z<4||(j=R*nh[(V[W]&127)<<1|V[W+1]>>7])>>0===j){W+=4;return}else W--}V[W++]=203,he.setFloat64(W,R),W+=8}else if(_==="object"||_==="function")if(!R)V[W++]=192;else{if(s){let j=s.get(R);if(j){if(!j.id){let ut=s.idsToInsert||(s.idsToInsert=[]);j.id=ut.push(j)}V[W++]=214,V[W++]=112,he.setUint32(W,j.id),W+=4;return}else s.set(R,{offset:W-n})}let Z=R.constructor;if(Z===Object)B(R);else if(Z===Array)v(R);else if(Z===Map)if(this.mapAsEmptyObject)V[W++]=128;else{P=R.size,P<16?V[W++]=128|P:P<65536?(V[W++]=222,V[W++]=P>>8,V[W++]=P&255):(V[W++]=223,he.setUint32(W,P),W+=4);for(let[j,ut]of R)N(j),N(ut)}else{for(let j=0,ut=rh.length;j<ut;j++){let tt=cm[j];if(R instanceof tt){let ht=rh[j];if(ht.write){ht.type&&(V[W++]=212,V[W++]=ht.type,V[W++]=0);let at=ht.write.call(this,R);at===R?Array.isArray(R)?v(R):B(R):N(at);return}let G=V,z=he,bt=W;V=null;let st;try{st=ht.pack.call(this,R,at=>(V=G,G=null,W+=at,W>fn&&F(W),{target:V,targetView:he,position:W-at}),N)}finally{G&&(V=G,he=z,W=bt,fn=V.length-10)}st&&(st.length+W>fn&&F(st.length+W),W=cT(st,V,W,ht.type));return}}if(Array.isArray(R))v(R);else{if(R.toJSON){const j=R.toJSON();if(j!==R)return N(j)}if(_==="function")return N(this.writeFunction&&this.writeFunction(R));B(R)}}}else if(_==="boolean")V[W++]=R?195:194;else if(_==="bigint"){if(R<BigInt(1)<<BigInt(63)&&R>=-(BigInt(1)<<BigInt(63)))V[W++]=211,he.setBigInt64(W,R);else if(R<BigInt(1)<<BigInt(64)&&R>0)V[W++]=207,he.setBigUint64(W,R);else if(this.largeBigIntToFloat)V[W++]=203,he.setFloat64(W,Number(R));else{if(this.largeBigIntToString)return N(R.toString());if(this.useBigIntExtension&&R<BigInt(2)**BigInt(1023)&&R>-(BigInt(2)**BigInt(1023))){V[W++]=199,W++,V[W++]=66;let Z=[],j;do{let ut=R&BigInt(255);j=(ut&BigInt(128))===(R<BigInt(0)?BigInt(128):BigInt(0)),Z.push(ut),R>>=BigInt(8)}while(!((R===BigInt(0)||R===BigInt(-1))&&j));V[W-2]=Z.length;for(let ut=Z.length;ut>0;)V[W++]=Number(Z[--ut]);return}else throw new RangeError(R+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}W+=8}else if(_==="undefined")this.encodeUndefinedAsNil?V[W++]=192:(V[W++]=212,V[W++]=0,V[W++]=0);else throw new Error("Unknown type: "+_)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?R=>{let _;if(this.skipValues){_=[];for(let j in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(j))&&!this.skipValues.includes(R[j])&&_.push(j)}else _=Object.keys(R);let P=_.length;P<16?V[W++]=128|P:P<65536?(V[W++]=222,V[W++]=P>>8,V[W++]=P&255):(V[W++]=223,he.setUint32(W,P),W+=4);let Z;if(this.coercibleKeyAsNumber)for(let j=0;j<P;j++){Z=_[j];let ut=Number(Z);N(isNaN(ut)?Z:ut),N(R[Z])}else for(let j=0;j<P;j++)N(Z=_[j]),N(R[Z])}:R=>{V[W++]=222;let _=W-n;W+=2;let P=0;for(let Z in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(Z))&&(N(Z),N(R[Z]),P++);if(P>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');V[_+++n]=P>>8,V[_+n]=P&255},L=this.useRecords===!1?U:t.progressiveRecords&&!f?R=>{let _,P=i.transitions||(i.transitions=Object.create(null)),Z=W++-n,j;for(let ut in R)if(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(ut)){if(_=P[ut],_)P=_;else{let tt=Object.keys(R),ht=P;P=i.transitions;let G=0;for(let z=0,bt=tt.length;z<bt;z++){let st=tt[z];_=P[st],_||(_=P[st]=Object.create(null),G++),P=_}Z+n+1==W?(W--,nt(P,tt,G)):dt(P,tt,Z,G),j=!0,P=ht[ut]}N(R[ut])}if(!j){let ut=P[Ws];ut?V[Z+n]=ut:dt(P,Object.keys(R),Z,0)}}:R=>{let _,P=i.transitions||(i.transitions=Object.create(null)),Z=0;for(let ut in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(ut))&&(_=P[ut],_||(_=P[ut]=Object.create(null),Z++),P=_);let j=P[Ws];j?j>=96&&f?(V[W++]=((j-=96)&31)+96,V[W++]=j>>5):V[W++]=j:nt(P,P.__keys__||Object.keys(R),Z);for(let ut in R)(typeof R.hasOwnProperty!="function"||R.hasOwnProperty(ut))&&N(R[ut])},O=typeof this.useRecords=="function"&&this.useRecords,B=O?R=>{O(R)?L(R):U(R)}:L,F=R=>{let _;if(R>16777216){if(R-n>um)throw new Error("Packed buffer would be larger than maximum buffer size");_=Math.min(um,Math.round(Math.max((R-n)*(R>67108864?1.25:2),4194304)/4096)*4096)}else _=(Math.max(R-n<<2,V.length-1)>>12)+1<<12;let P=new yc(_);return he=P.dataView||(P.dataView=new DataView(P.buffer,0,_)),R=Math.min(R,V.length),V.copy?V.copy(P,0,n,R):P.set(V.slice(n,R)),W-=n,n=0,fn=P.length-10,V=P},nt=(R,_,P)=>{let Z=i.nextId;Z||(Z=64),Z<d&&this.shouldShareStructure&&!this.shouldShareStructure(_)?(Z=i.nextOwnId,Z<p||(Z=d),i.nextOwnId=Z+1):(Z>=p&&(Z=d),i.nextId=Z+1);let j=_.highByte=Z>=96&&f?Z-96>>5:-1;R[Ws]=Z,R.__keys__=_,i[Z-64]=_,Z<d?(_.isShared=!0,i.sharedLength=Z-63,r=!0,j>=0?(V[W++]=(Z&31)+96,V[W++]=j):V[W++]=Z):(j>=0?(V[W++]=213,V[W++]=114,V[W++]=(Z&31)+96,V[W++]=j):(V[W++]=212,V[W++]=114,V[W++]=Z),P&&(k+=E*P),g.length>=h&&(g.shift()[Ws]=0),g.push(R),N(_))},dt=(R,_,P,Z)=>{let j=V,ut=W,tt=fn,ht=n;V=$o,W=0,n=0,V||($o=V=new yc(8192)),fn=V.length-10,nt(R,_,Z),$o=V;let G=W;if(V=j,W=ut,fn=tt,n=ht,G>1){let z=W+G-1;z>fn&&F(z);let bt=P+n;V.copyWithin(bt+G,bt+1,W),V.set($o.slice(0,G),bt),W=z}else V[P+n]=$o[0]},M=R=>{let _=iT(R,V,n,W,i,F,(P,Z,j)=>{if(j)return r=!0;W=Z;let ut=V;return N(P),T(),ut!==V?{position:W,targetView:he,target:V}:W},this);if(_===0)return B(R);W=_}}useBuffer(t){V=t,V.dataView||(V.dataView=new DataView(V.buffer,V.byteOffset,V.byteLength)),W=0}set position(t){W=t}get position(){return W}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}cm=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,G0],rh=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?hm(e,16,t):fm(gc?Ze.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==lm&&this.moreTypes?hm(e,om.indexOf(n.name),t):fm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function hm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function fm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function cT(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function lT(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function dm(e,t,n){if(ke.length>0){he.setUint32(ke.position+e,W+n-ke.position-e),ke.stringsPosition=W-e;let r=ke;ke=null,t(r[0]),t(r[1])}}function uT(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let pm=new aT({useRecords:!1});const hT=pm.pack;pm.pack;const fT=512,dT=1024,pT=2048;function Ce(){return null}function Gs(e,t,n={}){if(!w(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];w(c)&&(a=c(a));const u=t[o];w(u)&&(o=u),a!==null&&r.push(o,a)}return r}function jo(e,t,n={}){if(w(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];w(a)&&(s=a);const c=n[s];w(c)&&(o=c(o)),r[s]=o}return r}catch(r){oe(K,"binary",r.message)}}function mT(e){try{const t=On(e);return hT(t)}catch(t){oe(K,"binary",t.message)}}function gT(e){try{return nT(e)}catch(t){oe(K,"binary",t.message)}}function mm(){return{id:Ie()}}var _c=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.destructible=16]="destructible",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e))(_c||{});function bc(e){return w(e==null?void 0:e.id)?Gs(e,_c,{category:Ce,kinddata:Ce,stopped:Ce,removed:Ce,bucket:Ce}):Gs(e,_c,{id:Ce,x:Ce,y:Ce,lx:Ce,ly:Ce,code:Ce,category:Ce,kinddata:Ce,stopped:Ce,removed:Ce,bucket:Ce})}function Ec(e){return jo(e,_c)}function ih(e){var t;return((t=e==null?void 0:e.id)==null?void 0:t.length)??!1}function wc(e,t){if(!w(e)||!Un(t))return;const{color:n,bg:r}=P0(t);w(n)&&(e.color=n),w(r)&&(e.bg=r)}function Oi(e){var t;return Ut((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function gm(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function ym(e){const t=Math.floor(e.length/sc);if(t*sc!==e.length){oe(K,"size","wrong number of bytes for a palette");return}const n=gm(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function yT(e,t){return e&1<<t?255:0}function _m(e){const t=Math.floor(e.length/Vu);if(t*Vu!==e.length){oe(K,"size","wrong number of bytes for a charset");return}const n=Math.ceil(t/cc),r=oc*cc,i=gm(r,ac*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const u=o*ac+a,l=e[c];for(let h=0;h<oc;++h){const f=s*oc+h;i.bits[f+u*r]=yT(l,7-h)}++a,a===ac&&(a=0,++s,s===cc&&(s=0,++o))}return i}const _T=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),bT=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]);var bm=typeof Rs=="object"&&Rs&&Rs.Object===Object&&Rs,ET=typeof self=="object"&&self&&self.Object===Object&&self,Rr=bm||ET||Function("return this")(),qn=Rr.Symbol,Em=Object.prototype,wT=Em.hasOwnProperty,kT=Em.toString,zo=qn?qn.toStringTag:void 0;function xT(e){var t=wT.call(e,zo),n=e[zo];try{e[zo]=void 0;var r=!0}catch{}var i=kT.call(e);return r&&(t?e[zo]=n:delete e[zo]),i}var TT=Object.prototype,AT=TT.toString;function vT(e){return AT.call(e)}var ST="[object Null]",RT="[object Undefined]",wm=qn?qn.toStringTag:void 0;function Ci(e){return e==null?e===void 0?RT:ST:wm&&wm in Object(e)?xT(e):vT(e)}function sr(e){return e!=null&&typeof e=="object"}var IT="[object Symbol]";function kc(e){return typeof e=="symbol"||sr(e)&&Ci(e)==IT}function xc(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var Jt=Array.isArray,NT=1/0,km=qn?qn.prototype:void 0,xm=km?km.toString:void 0;function Tm(e){if(typeof e=="string")return e;if(Jt(e))return xc(e,Tm)+"";if(kc(e))return xm?xm.call(e):"";var t=e+"";return t=="0"&&1/e==-NT?"-0":t}var OT=/\s/;function CT(e){for(var t=e.length;t--&&OT.test(e.charAt(t)););return t}var LT=/^\s+/;function MT(e){return e&&e.slice(0,CT(e)+1).replace(LT,"")}function Xn(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Am=NaN,UT=/^[-+]0x[0-9a-f]+$/i,FT=/^0b[01]+$/i,PT=/^0o[0-7]+$/i,BT=parseInt;function DT(e){if(typeof e=="number")return e;if(kc(e))return Am;if(Xn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Xn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=MT(e);var n=FT.test(e);return n||PT.test(e)?BT(e.slice(2),n?2:8):UT.test(e)?Am:+e}var vm=1/0,$T=17976931348623157e292;function jT(e){if(!e)return e===0?e:0;if(e=DT(e),e===vm||e===-vm){var t=e<0?-1:1;return t*$T}return e===e?e:0}function Tc(e){var t=jT(e),n=t%1;return t===t?n?t-n:t:0}function Hs(e){return e}var zT="[object AsyncFunction]",KT="[object Function]",WT="[object GeneratorFunction]",GT="[object Proxy]";function ii(e){if(!Xn(e))return!1;var t=Ci(e);return t==KT||t==WT||t==zT||t==GT}var sh=Rr["__core-js_shared__"],Sm=function(){var e=/[^.]+$/.exec(sh&&sh.keys&&sh.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function HT(e){return!!Sm&&Sm in e}var YT=Function.prototype,VT=YT.toString;function es(e){if(e!=null){try{return VT.call(e)}catch{}try{return e+""}catch{}}return""}var qT=/[\\^$.*+?()[\]{}|]/g,XT=/^\[object .+?Constructor\]$/,JT=Function.prototype,ZT=Object.prototype,QT=JT.toString,tA=ZT.hasOwnProperty,eA=RegExp("^"+QT.call(tA).replace(qT,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nA(e){if(!Xn(e)||HT(e))return!1;var t=ii(e)?eA:XT;return t.test(es(e))}function rA(e,t){return e==null?void 0:e[t]}function ns(e,t){var n=rA(e,t);return nA(n)?n:void 0}var oh=ns(Rr,"WeakMap"),Rm=Object.create,iA=function(){function e(){}return function(t){if(!Xn(t))return{};if(Rm)return Rm(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function sA(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function $e(){}function oA(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var aA=800,cA=16,lA=Date.now;function uA(e){var t=0,n=0;return function(){var r=lA(),i=cA-(r-n);if(n=r,i>0){if(++t>=aA)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function hA(e){return function(){return e}}var Ac=function(){try{var e=ns(Object,"defineProperty");return e({},"",{}),e}catch{}}(),fA=Ac?function(e,t){return Ac(e,"toString",{configurable:!0,enumerable:!1,value:hA(t),writable:!0})}:Hs,dA=uA(fA);function Im(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Nm(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function pA(e){return e!==e}function mA(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function ah(e,t,n){return t===t?mA(e,t,n):Nm(e,pA,n)}function Om(e,t){var n=e==null?0:e.length;return!!n&&ah(e,t,0)>-1}var gA=9007199254740991,yA=/^(?:0|[1-9]\d*)$/;function vc(e,t){var n=typeof e;return t=t??gA,!!t&&(n=="number"||n!="symbol"&&yA.test(e))&&e>-1&&e%1==0&&e<t}function ch(e,t,n){t=="__proto__"&&Ac?Ac(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Ko(e,t){return e===t||e!==e&&t!==t}var _A=Object.prototype,bA=_A.hasOwnProperty;function Sc(e,t,n){var r=e[t];(!(bA.call(e,t)&&Ko(r,n))||n===void 0&&!(t in e))&&ch(e,t,n)}function lh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?ch(n,a,c):Sc(n,a,c)}return n}var Cm=Math.max;function EA(e,t,n){return t=Cm(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=Cm(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),sA(e,this,a)}}function uh(e,t){return dA(EA(e,t,Hs),e+"")}var wA=9007199254740991;function hh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=wA}function Ir(e){return e!=null&&hh(e.length)&&!ii(e)}function Lm(e,t,n){if(!Xn(n))return!1;var r=typeof t;return(r=="number"?Ir(n)&&vc(t,n.length):r=="string"&&t in n)?Ko(n[t],e):!1}function kA(e){return uh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&Lm(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var xA=Object.prototype;function Wo(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||xA;return e===n}function TA(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var AA="[object Arguments]";function Mm(e){return sr(e)&&Ci(e)==AA}var Um=Object.prototype,vA=Um.hasOwnProperty,SA=Um.propertyIsEnumerable,Rc=Mm(function(){return arguments}())?Mm:function(e){return sr(e)&&vA.call(e,"callee")&&!SA.call(e,"callee")};function RA(){return!1}var Fm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Pm=Fm&&typeof module=="object"&&module&&!module.nodeType&&module,IA=Pm&&Pm.exports===Fm,Bm=IA?Rr.Buffer:void 0,NA=Bm?Bm.isBuffer:void 0,Go=NA||RA,OA="[object Arguments]",CA="[object Array]",LA="[object Boolean]",MA="[object Date]",UA="[object Error]",FA="[object Function]",PA="[object Map]",BA="[object Number]",DA="[object Object]",$A="[object RegExp]",jA="[object Set]",zA="[object String]",KA="[object WeakMap]",WA="[object ArrayBuffer]",GA="[object DataView]",HA="[object Float32Array]",YA="[object Float64Array]",VA="[object Int8Array]",qA="[object Int16Array]",XA="[object Int32Array]",JA="[object Uint8Array]",ZA="[object Uint8ClampedArray]",QA="[object Uint16Array]",tv="[object Uint32Array]",ye={};ye[HA]=ye[YA]=ye[VA]=ye[qA]=ye[XA]=ye[JA]=ye[ZA]=ye[QA]=ye[tv]=!0,ye[OA]=ye[CA]=ye[WA]=ye[LA]=ye[GA]=ye[MA]=ye[UA]=ye[FA]=ye[PA]=ye[BA]=ye[DA]=ye[$A]=ye[jA]=ye[zA]=ye[KA]=!1;function ev(e){return sr(e)&&hh(e.length)&&!!ye[Ci(e)]}function Ic(e){return function(t){return e(t)}}var Dm=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ho=Dm&&typeof module=="object"&&module&&!module.nodeType&&module,nv=Ho&&Ho.exports===Dm,fh=nv&&bm.process,Li=function(){try{var e=Ho&&Ho.require&&Ho.require("util").types;return e||fh&&fh.binding&&fh.binding("util")}catch{}}(),$m=Li&&Li.isTypedArray,dh=$m?Ic($m):ev,rv=Object.prototype,iv=rv.hasOwnProperty;function jm(e,t){var n=Jt(e),r=!n&&Rc(e),i=!n&&!r&&Go(e),s=!n&&!r&&!i&&dh(e),o=n||r||i||s,a=o?TA(e.length,String):[],c=a.length;for(var u in e)(t||iv.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||vc(u,c)))&&a.push(u);return a}function zm(e,t){return function(n){return e(t(n))}}var sv=zm(Object.keys,Object),ov=Object.prototype,av=ov.hasOwnProperty;function Km(e){if(!Wo(e))return sv(e);var t=[];for(var n in Object(e))av.call(e,n)&&n!="constructor"&&t.push(n);return t}function Jn(e){return Ir(e)?jm(e):Km(e)}var cv=Object.prototype,lv=cv.hasOwnProperty,wn=kA(function(e,t){if(Wo(t)||Ir(t)){lh(t,Jn(t),e);return}for(var n in t)lv.call(t,n)&&Sc(e,n,t[n])});function uv(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var hv=Object.prototype,fv=hv.hasOwnProperty;function dv(e){if(!Xn(e))return uv(e);var t=Wo(e),n=[];for(var r in e)r=="constructor"&&(t||!fv.call(e,r))||n.push(r);return n}function Wm(e){return Ir(e)?jm(e,!0):dv(e)}var pv=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mv=/^\w*$/;function ph(e,t){if(Jt(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||kc(e)?!0:mv.test(e)||!pv.test(e)||t!=null&&e in Object(t)}var Yo=ns(Object,"create");function gv(){this.__data__=Yo?Yo(null):{},this.size=0}function yv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _v="__lodash_hash_undefined__",bv=Object.prototype,Ev=bv.hasOwnProperty;function wv(e){var t=this.__data__;if(Yo){var n=t[e];return n===_v?void 0:n}return Ev.call(t,e)?t[e]:void 0}var kv=Object.prototype,xv=kv.hasOwnProperty;function Tv(e){var t=this.__data__;return Yo?t[e]!==void 0:xv.call(t,e)}var Av="__lodash_hash_undefined__";function vv(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Yo&&t===void 0?Av:t,this}function rs(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}rs.prototype.clear=gv,rs.prototype.delete=yv,rs.prototype.get=wv,rs.prototype.has=Tv,rs.prototype.set=vv;function Sv(){this.__data__=[],this.size=0}function Nc(e,t){for(var n=e.length;n--;)if(Ko(e[n][0],t))return n;return-1}var Rv=Array.prototype,Iv=Rv.splice;function Nv(e){var t=this.__data__,n=Nc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Iv.call(t,n,1),--this.size,!0}function Ov(e){var t=this.__data__,n=Nc(t,e);return n<0?void 0:t[n][1]}function Cv(e){return Nc(this.__data__,e)>-1}function Lv(e,t){var n=this.__data__,r=Nc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function si(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}si.prototype.clear=Sv,si.prototype.delete=Nv,si.prototype.get=Ov,si.prototype.has=Cv,si.prototype.set=Lv;var Vo=ns(Rr,"Map");function Mv(){this.size=0,this.__data__={hash:new rs,map:new(Vo||si),string:new rs}}function Uv(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Oc(e,t){var n=e.__data__;return Uv(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Fv(e){var t=Oc(this,e).delete(e);return this.size-=t?1:0,t}function Pv(e){return Oc(this,e).get(e)}function Bv(e){return Oc(this,e).has(e)}function Dv(e,t){var n=Oc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function oi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}oi.prototype.clear=Mv,oi.prototype.delete=Fv,oi.prototype.get=Pv,oi.prototype.has=Bv,oi.prototype.set=Dv;var $v="Expected a function";function mh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError($v);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(mh.Cache||oi),n}mh.Cache=oi;var jv=500;function zv(e){var t=mh(e,function(r){return n.size===jv&&n.clear(),r}),n=t.cache;return t}var Kv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Wv=/\\(\\)?/g,Gv=zv(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Kv,function(n,r,i,s){t.push(i?s.replace(Wv,"$1"):r||n)}),t});function Gm(e){return e==null?"":Tm(e)}function Cc(e,t){return Jt(e)?e:ph(e,t)?[e]:Gv(Gm(e))}var Hv=1/0;function qo(e){if(typeof e=="string"||kc(e))return e;var t=e+"";return t=="0"&&1/e==-Hv?"-0":t}function gh(e,t){t=Cc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[qo(t[n++])];return n&&n==r?e:void 0}function Yv(e,t,n){var r=e==null?void 0:gh(e,t);return r===void 0?n:r}function yh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Hm=qn?qn.isConcatSpreadable:void 0;function Vv(e){return Jt(e)||Rc(e)||!!(Hm&&e&&e[Hm])}function _h(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=Vv),i||(i=[]);++s<o;){var a=e[s];n(a)?yh(i,a):r||(i[i.length]=a)}return i}function Fn(e){var t=e==null?0:e.length;return t?_h(e):[]}var Ym=zm(Object.getPrototypeOf,Object);function bh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function qv(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:bh(e,t,n)}var Xv="\\ud800-\\udfff",Jv="\\u0300-\\u036f",Zv="\\ufe20-\\ufe2f",Qv="\\u20d0-\\u20ff",t2=Jv+Zv+Qv,e2="\\ufe0e\\ufe0f",n2="\\u200d",r2=RegExp("["+n2+Xv+t2+e2+"]");function Vm(e){return r2.test(e)}function i2(e){return e.split("")}var qm="\\ud800-\\udfff",s2="\\u0300-\\u036f",o2="\\ufe20-\\ufe2f",a2="\\u20d0-\\u20ff",c2=s2+o2+a2,l2="\\ufe0e\\ufe0f",u2="["+qm+"]",Eh="["+c2+"]",wh="\\ud83c[\\udffb-\\udfff]",h2="(?:"+Eh+"|"+wh+")",Xm="[^"+qm+"]",Jm="(?:\\ud83c[\\udde6-\\uddff]){2}",Zm="[\\ud800-\\udbff][\\udc00-\\udfff]",f2="\\u200d",Qm=h2+"?",tg="["+l2+"]?",d2="(?:"+f2+"(?:"+[Xm,Jm,Zm].join("|")+")"+tg+Qm+")*",p2=tg+Qm+d2,m2="(?:"+[Xm+Eh+"?",Eh,Jm,Zm,u2].join("|")+")",g2=RegExp(wh+"(?="+wh+")|"+m2+p2,"g");function y2(e){return e.match(g2)||[]}function _2(e){return Vm(e)?y2(e):i2(e)}function b2(e){return function(t){t=Gm(t);var n=Vm(t)?_2(t):void 0,r=n?n[0]:t.charAt(0),i=n?qv(n,1).join(""):t.slice(1);return r[e]()+i}}var eg=b2("toUpperCase");function E2(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function w2(){this.__data__=new si,this.size=0}function k2(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function x2(e){return this.__data__.get(e)}function T2(e){return this.__data__.has(e)}var A2=200;function v2(e,t){var n=this.__data__;if(n instanceof si){var r=n.__data__;if(!Vo||r.length<A2-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new oi(r)}return n.set(e,t),this.size=n.size,this}function Nr(e){var t=this.__data__=new si(e);this.size=t.size}Nr.prototype.clear=w2,Nr.prototype.delete=k2,Nr.prototype.get=x2,Nr.prototype.has=T2,Nr.prototype.set=v2;function S2(e,t){return e&&lh(t,Jn(t),e)}var ng=typeof exports=="object"&&exports&&!exports.nodeType&&exports,rg=ng&&typeof module=="object"&&module&&!module.nodeType&&module,R2=rg&&rg.exports===ng,ig=R2?Rr.Buffer:void 0,sg=ig?ig.allocUnsafe:void 0;function I2(e,t){var n=e.length,r=sg?sg(n):new e.constructor(n);return e.copy(r),r}function kh(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function og(){return[]}var N2=Object.prototype,O2=N2.propertyIsEnumerable,ag=Object.getOwnPropertySymbols,xh=ag?function(e){return e==null?[]:(e=Object(e),kh(ag(e),function(t){return O2.call(e,t)}))}:og;function C2(e,t){return lh(e,xh(e),t)}var L2=Object.getOwnPropertySymbols,M2=L2?function(e){for(var t=[];e;)yh(t,xh(e)),e=Ym(e);return t}:og;function cg(e,t,n){var r=t(e);return Jt(e)?r:yh(r,n(e))}function Th(e){return cg(e,Jn,xh)}function U2(e){return cg(e,Wm,M2)}var Ah=ns(Rr,"DataView"),vh=ns(Rr,"Promise"),Ys=ns(Rr,"Set"),lg="[object Map]",F2="[object Object]",ug="[object Promise]",hg="[object Set]",fg="[object WeakMap]",dg="[object DataView]",P2=es(Ah),B2=es(Vo),D2=es(vh),$2=es(Ys),j2=es(oh),Zn=Ci;(Ah&&Zn(new Ah(new ArrayBuffer(1)))!=dg||Vo&&Zn(new Vo)!=lg||vh&&Zn(vh.resolve())!=ug||Ys&&Zn(new Ys)!=hg||oh&&Zn(new oh)!=fg)&&(Zn=function(e){var t=Ci(e),n=t==F2?e.constructor:void 0,r=n?es(n):"";if(r)switch(r){case P2:return dg;case B2:return lg;case D2:return ug;case $2:return hg;case j2:return fg}return t});var z2=Object.prototype,K2=z2.hasOwnProperty;function W2(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&K2.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Lc=Rr.Uint8Array;function G2(e){var t=new e.constructor(e.byteLength);return new Lc(t).set(new Lc(e)),t}function H2(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var Y2=/\w*$/;function V2(e){var t=new e.constructor(e.source,Y2.exec(e));return t.lastIndex=e.lastIndex,t}var pg=qn?qn.prototype:void 0,mg=pg?pg.valueOf:void 0;function q2(e){return mg?Object(mg.call(e)):{}}function X2(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var J2="[object Boolean]",Z2="[object Date]",Q2="[object Map]",tS="[object Number]",eS="[object RegExp]",nS="[object Set]",rS="[object String]",iS="[object Symbol]",sS="[object ArrayBuffer]",oS="[object DataView]",aS="[object Float32Array]",cS="[object Float64Array]",lS="[object Int8Array]",uS="[object Int16Array]",hS="[object Int32Array]",fS="[object Uint8Array]",dS="[object Uint8ClampedArray]",pS="[object Uint16Array]",mS="[object Uint32Array]";function gS(e,t,n){var r=e.constructor;switch(t){case sS:return G2(e);case J2:case Z2:return new r(+e);case oS:return H2(e);case aS:case cS:case lS:case uS:case hS:case fS:case dS:case pS:case mS:return X2(e);case Q2:return new r;case tS:case rS:return new r(e);case eS:return V2(e);case nS:return new r;case iS:return q2(e)}}function yS(e){return typeof e.constructor=="function"&&!Wo(e)?iA(Ym(e)):{}}var _S="[object Map]";function bS(e){return sr(e)&&Zn(e)==_S}var gg=Li&&Li.isMap,ES=gg?Ic(gg):bS,wS="[object Set]";function kS(e){return sr(e)&&Zn(e)==wS}var yg=Li&&Li.isSet,xS=yg?Ic(yg):kS,_g="[object Arguments]",TS="[object Array]",AS="[object Boolean]",vS="[object Date]",SS="[object Error]",bg="[object Function]",RS="[object GeneratorFunction]",IS="[object Map]",NS="[object Number]",Eg="[object Object]",OS="[object RegExp]",CS="[object Set]",LS="[object String]",MS="[object Symbol]",US="[object WeakMap]",FS="[object ArrayBuffer]",PS="[object DataView]",BS="[object Float32Array]",DS="[object Float64Array]",$S="[object Int8Array]",jS="[object Int16Array]",zS="[object Int32Array]",KS="[object Uint8Array]",WS="[object Uint8ClampedArray]",GS="[object Uint16Array]",HS="[object Uint32Array]",fe={};fe[_g]=fe[TS]=fe[FS]=fe[PS]=fe[AS]=fe[vS]=fe[BS]=fe[DS]=fe[$S]=fe[jS]=fe[zS]=fe[IS]=fe[NS]=fe[Eg]=fe[OS]=fe[CS]=fe[LS]=fe[MS]=fe[KS]=fe[WS]=fe[GS]=fe[HS]=!0,fe[SS]=fe[bg]=fe[US]=!1;function Mc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!Xn(e))return e;var a=Jt(e);if(a)return o=W2(e),oA(e,o);var c=Zn(e),u=c==bg||c==RS;if(Go(e))return I2(e);if(c==Eg||c==_g||u&&!i)return o=u?{}:yS(e),C2(e,S2(o,e));if(!fe[c])return i?e:{};o=gS(e,c),s||(s=new Nr);var l=s.get(e);if(l)return l;s.set(e,o),xS(e)?e.forEach(function(d){o.add(Mc(d,t,n,d,e,s))}):ES(e)&&e.forEach(function(d,p){o.set(p,Mc(d,t,n,p,e,s))});var h=Th,f=a?void 0:h(e);return Im(f||e,function(d,p){f&&(p=d,d=e[p]),Sc(o,p,Mc(d,t,n,p,e,s))}),o}var YS=4;function tn(e){return Mc(e,YS)}function Xo(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var VS="__lodash_hash_undefined__";function qS(e){return this.__data__.set(e,VS),this}function XS(e){return this.__data__.has(e)}function Vs(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new oi;++t<n;)this.add(e[t])}Vs.prototype.add=Vs.prototype.push=qS,Vs.prototype.has=XS;function wg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Sh(e,t){return e.has(t)}var JS=1,ZS=2;function kg(e,t,n,r,i,s){var o=n&JS,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var h=-1,f=!0,d=n&ZS?new Vs:void 0;for(s.set(e,t),s.set(t,e);++h<a;){var p=e[h],g=t[h];if(r)var k=o?r(g,p,h,t,e,s):r(p,g,h,e,t,s);if(k!==void 0){if(k)continue;f=!1;break}if(d){if(!wg(t,function(E,T){if(!Sh(d,T)&&(p===E||i(p,E,n,r,s)))return d.push(T)})){f=!1;break}}else if(!(p===g||i(p,g,n,r,s))){f=!1;break}}return s.delete(e),s.delete(t),f}function QS(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Rh(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var tR=1,eR=2,nR="[object Boolean]",rR="[object Date]",iR="[object Error]",sR="[object Map]",oR="[object Number]",aR="[object RegExp]",cR="[object Set]",lR="[object String]",uR="[object Symbol]",hR="[object ArrayBuffer]",fR="[object DataView]",xg=qn?qn.prototype:void 0,Ih=xg?xg.valueOf:void 0;function dR(e,t,n,r,i,s,o){switch(n){case fR:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case hR:return!(e.byteLength!=t.byteLength||!s(new Lc(e),new Lc(t)));case nR:case rR:case oR:return Ko(+e,+t);case iR:return e.name==t.name&&e.message==t.message;case aR:case lR:return e==t+"";case sR:var a=QS;case cR:var c=r&tR;if(a||(a=Rh),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;r|=eR,o.set(e,t);var l=kg(a(e),a(t),r,i,s,o);return o.delete(e),l;case uR:if(Ih)return Ih.call(e)==Ih.call(t)}return!1}var pR=1,mR=Object.prototype,gR=mR.hasOwnProperty;function yR(e,t,n,r,i,s){var o=n&pR,a=Th(e),c=a.length,u=Th(t),l=u.length;if(c!=l&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in t:gR.call(t,f)))return!1}var d=s.get(e),p=s.get(t);if(d&&p)return d==t&&p==e;var g=!0;s.set(e,t),s.set(t,e);for(var k=o;++h<c;){f=a[h];var E=e[f],T=t[f];if(r)var v=o?r(T,E,f,t,e,s):r(E,T,f,e,t,s);if(!(v===void 0?E===T||i(E,T,n,r,s):v)){g=!1;break}k||(k=f=="constructor")}if(g&&!k){var N=e.constructor,U=t.constructor;N!=U&&"constructor"in e&&"constructor"in t&&!(typeof N=="function"&&N instanceof N&&typeof U=="function"&&U instanceof U)&&(g=!1)}return s.delete(e),s.delete(t),g}var _R=1,Tg="[object Arguments]",Ag="[object Array]",Uc="[object Object]",bR=Object.prototype,vg=bR.hasOwnProperty;function ER(e,t,n,r,i,s){var o=Jt(e),a=Jt(t),c=o?Ag:Zn(e),u=a?Ag:Zn(t);c=c==Tg?Uc:c,u=u==Tg?Uc:u;var l=c==Uc,h=u==Uc,f=c==u;if(f&&Go(e)){if(!Go(t))return!1;o=!0,l=!1}if(f&&!l)return s||(s=new Nr),o||dh(e)?kg(e,t,n,r,i,s):dR(e,t,c,n,r,i,s);if(!(n&_R)){var d=l&&vg.call(e,"__wrapped__"),p=h&&vg.call(t,"__wrapped__");if(d||p){var g=d?e.value():e,k=p?t.value():t;return s||(s=new Nr),i(g,k,n,r,s)}}return f?(s||(s=new Nr),yR(e,t,n,r,i,s)):!1}function Nh(e,t,n,r,i){return e===t?!0:e==null||t==null||!sr(e)&&!sr(t)?e!==e&&t!==t:ER(e,t,n,r,Nh,i)}var wR=1,kR=2;function xR(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],u=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var l=new Nr,h;if(!(h===void 0?Nh(u,c,wR|kR,r,l):h))return!1}}return!0}function Sg(e){return e===e&&!Xn(e)}function TR(e){for(var t=Jn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Sg(i)]}return t}function Rg(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function AR(e){var t=TR(e);return t.length==1&&t[0][2]?Rg(t[0][0],t[0][1]):function(n){return n===e||xR(n,e,t)}}function vR(e,t){return e!=null&&t in Object(e)}function Ig(e,t,n){t=Cc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=qo(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&hh(i)&&vc(o,i)&&(Jt(e)||Rc(e)))}function SR(e,t){return e!=null&&Ig(e,t,vR)}var RR=1,IR=2;function NR(e,t){return ph(e)&&Sg(t)?Rg(qo(e),t):function(n){var r=Yv(n,e);return r===void 0&&r===t?SR(n,e):Nh(t,r,RR|IR)}}function OR(e){return function(t){return t==null?void 0:t[e]}}function CR(e){return function(t){return gh(t,e)}}function LR(e){return ph(e)?OR(qo(e)):CR(e)}function Or(e){return typeof e=="function"?e:e==null?Hs:typeof e=="object"?Jt(e)?NR(e[0],e[1]):AR(e):LR(e)}function MR(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function UR(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var FR=UR();function PR(e,t){return e&&FR(e,t,Jn)}function BR(e,t){return function(n,r){if(n==null)return n;if(!Ir(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var is=BR(PR);function DR(e,t,n,r){return is(e,function(i,s,o){t(r,i,n(i),o)}),r}function $R(e,t){return function(n,r){var i=Jt(n)?MR:DR,s=t?t():{};return i(n,e,Or(r),s)}}var Ng=Object.prototype,jR=Ng.hasOwnProperty,Oh=uh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Lm(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Wm(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Ko(l,Ng[u])&&!jR.call(e,u))&&(e[u]=s[u])}return e});function Og(e){return sr(e)&&Ir(e)}var zR=200;function KR(e,t,n,r){var i=-1,s=Om,o=!0,a=e.length,c=[],u=t.length;if(!a)return c;t.length>=zR&&(s=Sh,o=!1,t=new Vs(t));t:for(;++i<a;){var l=e[i],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;c.push(l)}else s(t,h,r)||c.push(l)}return c}var Fc=uh(function(e,t){return Og(e)?KR(e,_h(t,1,Og,!0)):[]});function qs(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function en(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Tc(t),bh(e,t<0?0:t,r)):[]}function Jo(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Tc(t),t=r-t,bh(e,0,t<0?0:t)):[]}function WR(e){return typeof e=="function"?e:Hs}function It(e,t){var n=Jt(e)?Im:is;return n(e,WR(t))}function GR(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function HR(e,t){var n=!0;return is(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function or(e,t,n){var r=Jt(e)?GR:HR;return r(e,Or(t))}function Cg(e,t){var n=[];return is(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function Qn(e,t){var n=Jt(e)?kh:Cg;return n(e,Or(t))}function YR(e){return function(t,n,r){var i=Object(t);if(!Ir(t)){var s=Or(n);t=Jn(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var VR=Math.max;function qR(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Tc(n);return i<0&&(i=VR(r+i,0)),Nm(e,Or(t),i)}var Xs=YR(qR);function ar(e){return e&&e.length?e[0]:void 0}function XR(e,t){var n=-1,r=Ir(e)?Array(e.length):[];return is(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function wt(e,t){var n=Jt(e)?xc:XR;return n(e,Or(t))}function tr(e,t){return _h(wt(e,t))}var JR=Object.prototype,ZR=JR.hasOwnProperty,Lg=$R(function(e,t,n){ZR.call(e,n)?e[n].push(t):ch(e,n,[t])}),QR=Object.prototype,tI=QR.hasOwnProperty;function eI(e,t){return e!=null&&tI.call(e,t)}function Rt(e,t){return e!=null&&Ig(e,t,eI)}var nI="[object String]";function kn(e){return typeof e=="string"||!Jt(e)&&sr(e)&&Ci(e)==nI}function rI(e,t){return xc(t,function(n){return e[n]})}function Me(e){return e==null?[]:rI(e,Jn(e))}var iI=Math.max;function dn(e,t,n,r){e=Ir(e)?e:Me(e),n=n&&!r?Tc(n):0;var i=e.length;return n<0&&(n=iI(i+n,0)),kn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&ah(e,t,n)>-1}function Mg(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return ah(e,t,i)}var sI="[object Map]",oI="[object Set]",aI=Object.prototype,cI=aI.hasOwnProperty;function de(e){if(e==null)return!0;if(Ir(e)&&(Jt(e)||typeof e=="string"||typeof e.splice=="function"||Go(e)||dh(e)||Rc(e)))return!e.length;var t=Zn(e);if(t==sI||t==oI)return!e.size;if(Wo(e))return!Km(e).length;for(var n in e)if(cI.call(e,n))return!1;return!0}var lI="[object RegExp]";function uI(e){return sr(e)&&Ci(e)==lI}var Ug=Li&&Li.isRegExp,ai=Ug?Ic(Ug):uI;function ci(e){return e===void 0}var hI="Expected a function";function fI(e){if(typeof e!="function")throw new TypeError(hI);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function dI(e,t,n,r){if(!Xn(e))return e;t=Cc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=qo(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];u=void 0,u===void 0&&(u=Xn(l)?l:vc(t[i+1])?[]:{})}Sc(a,c,u),a=a[c]}return e}function pI(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=gh(e,o);n(a,o)&&dI(s,Cc(o,e),a)}return s}function cr(e,t){if(e==null)return{};var n=xc(U2(e),function(r){return[r]});return t=Or(t),pI(e,n,function(r,i){return t(r,i[0])})}function mI(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function xn(e,t,n){var r=Jt(e)?E2:mI,i=arguments.length<3;return r(e,Or(t),n,i,is)}function Pc(e,t){var n=Jt(e)?kh:Cg;return n(e,fI(Or(t)))}function gI(e,t){var n;return is(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function Ch(e,t,n){var r=Jt(e)?wg:gI;return r(e,Or(t))}var yI=1/0,_I=Ys&&1/Rh(new Ys([,-0]))[1]==yI?function(e){return new Ys(e)}:$e,bI=200;function EI(e,t,n){var r=-1,i=Om,s=e.length,o=!0,a=[],c=a;if(s>=bI){var u=_I(e);if(u)return Rh(u);o=!1,i=Sh,c=new Vs}else c=a;t:for(;++r<s;){var l=e[r],h=l;if(l=l!==0?l:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue t;a.push(l)}else i(c,h,n)||(c!==a&&c.push(h),a.push(l))}return a}function Bc(e){return e&&e.length?EI(e):[]}function Lh(e){console&&console.error&&console.error(`Error: ${e}`)}function Fg(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Pg(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Bg(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function wI(e){return kI(e)?e.LABEL:e.name}function kI(e){return kn(e.LABEL)&&e.LABEL!==""}class Cr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),It(this.definition,n=>{n.accept(t)})}}class Tn extends Cr{constructor(t){super([]),this.idx=1,wn(this,cr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class Js extends Cr{constructor(t){super(t.definition),this.orgText="",wn(this,cr(t,n=>n!==void 0))}}class An extends Cr{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,wn(this,cr(t,n=>n!==void 0))}}class vn extends Cr{constructor(t){super(t.definition),this.idx=1,wn(this,cr(t,n=>n!==void 0))}}class Lr extends Cr{constructor(t){super(t.definition),this.idx=1,wn(this,cr(t,n=>n!==void 0))}}class Mr extends Cr{constructor(t){super(t.definition),this.idx=1,wn(this,cr(t,n=>n!==void 0))}}class je extends Cr{constructor(t){super(t.definition),this.idx=1,wn(this,cr(t,n=>n!==void 0))}}class lr extends Cr{constructor(t){super(t.definition),this.idx=1,wn(this,cr(t,n=>n!==void 0))}}class ur extends Cr{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,wn(this,cr(t,n=>n!==void 0))}}class xe{constructor(t){this.idx=1,wn(this,cr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function xI(e){return wt(e,Dc)}function Dc(e){function t(n){return wt(n,Dc)}if(e instanceof Tn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return kn(e.label)&&(n.label=e.label),n}else{if(e instanceof An)return{type:"Alternative",definition:t(e.definition)};if(e instanceof vn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Lr)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Mr)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:Dc(new xe({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof lr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:Dc(new xe({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof je)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof ur)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof xe){const n={type:"Terminal",name:e.terminalType.name,label:wI(e.terminalType),idx:e.idx};kn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=ai(r)?r.source:r),n}else{if(e instanceof Js)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class ss{visit(t){const n=t;switch(n.constructor){case Tn:return this.visitNonTerminal(n);case An:return this.visitAlternative(n);case vn:return this.visitOption(n);case Lr:return this.visitRepetitionMandatory(n);case Mr:return this.visitRepetitionMandatoryWithSeparator(n);case lr:return this.visitRepetitionWithSeparator(n);case je:return this.visitRepetition(n);case ur:return this.visitAlternation(n);case xe:return this.visitTerminal(n);case Js:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function TI(e){return e instanceof An||e instanceof vn||e instanceof je||e instanceof Lr||e instanceof Mr||e instanceof lr||e instanceof xe||e instanceof Js}function $c(e,t=[]){return e instanceof vn||e instanceof je||e instanceof lr?!0:e instanceof ur?Ch(e.definition,r=>$c(r,t)):e instanceof Tn&&dn(t,e)?!1:e instanceof Cr?(e instanceof Tn&&t.push(e),or(e.definition,r=>$c(r,t))):!1}function AI(e){return e instanceof ur}function Ur(e){if(e instanceof Tn)return"SUBRULE";if(e instanceof vn)return"OPTION";if(e instanceof ur)return"OR";if(e instanceof Lr)return"AT_LEAST_ONE";if(e instanceof Mr)return"AT_LEAST_ONE_SEP";if(e instanceof lr)return"MANY_SEP";if(e instanceof je)return"MANY";if(e instanceof xe)return"CONSUME";throw Error("non exhaustive match")}class jc{walk(t,n=[]){It(t.definition,(r,i)=>{const s=en(t.definition,i+1);if(r instanceof Tn)this.walkProdRef(r,s,n);else if(r instanceof xe)this.walkTerminal(r,s,n);else if(r instanceof An)this.walkFlat(r,s,n);else if(r instanceof vn)this.walkOption(r,s,n);else if(r instanceof Lr)this.walkAtLeastOne(r,s,n);else if(r instanceof Mr)this.walkAtLeastOneSep(r,s,n);else if(r instanceof lr)this.walkManySep(r,s,n);else if(r instanceof je)this.walkMany(r,s,n);else if(r instanceof ur)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new vn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=Dg(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new vn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=Dg(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);It(t.definition,s=>{const o=new An({definition:[s]});this.walk(o,i)})}}function Dg(e,t,n){return[new vn({definition:[new xe({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function Zo(e){if(e instanceof Tn)return Zo(e.referencedRule);if(e instanceof xe)return RI(e);if(TI(e))return vI(e);if(AI(e))return SI(e);throw Error("non exhaustive match")}function vI(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=$c(s),t=t.concat(Zo(s)),r=r+1,i=n.length>r;return Bc(t)}function SI(e){const t=wt(e.definition,n=>Zo(n));return Bc(Fn(t))}function RI(e){return[e.terminalType]}const $g="_~IN~_";class II extends jc{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=OI(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new An({definition:s}),a=Zo(o);this.follows[i]=a}}function NI(e){const t={};return It(e,n=>{const r=new II(n).startWalking();wn(t,r)}),t}function OI(e,t){return e.name+t+$g}function Nt(e){return e.charCodeAt(0)}function Mh(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function Qo(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function Zs(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function CI(){throw Error("Internal Error - Should never get here!")}function jg(e){return e.type==="Character"}const zc=[];for(let e=Nt("0");e<=Nt("9");e++)zc.push(e);const Kc=[Nt("_")].concat(zc);for(let e=Nt("a");e<=Nt("z");e++)Kc.push(e);for(let e=Nt("A");e<=Nt("Z");e++)Kc.push(e);const zg=[Nt(" "),Nt("\f"),Nt(`
`),Nt("\r"),Nt("	"),Nt("\v"),Nt("	"),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt(""),Nt("\u2028"),Nt("\u2029"),Nt(""),Nt(""),Nt(""),Nt("\uFEFF")],LI=/[0-9a-fA-F]/,Wc=/[0-9]/,MI=/[1-9]/;class UI{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Qo(r,"global");break;case"i":Qo(r,"ignoreCase");break;case"m":Qo(r,"multiLine");break;case"u":Qo(r,"unicode");break;case"y":Qo(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}Zs(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return CI()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;Zs(n);break}if(!(t===!0&&n===void 0)&&Zs(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),Zs(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Nt(`
`),Nt("\r"),Nt("\u2028"),Nt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=zc;break;case"D":t=zc,n=!0;break;case"s":t=zg;break;case"S":t=zg,n=!0;break;case"w":t=Kc;break;case"W":t=Kc,n=!0;break}if(Zs(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Nt("\f");break;case"n":t=Nt(`
`);break;case"r":t=Nt("\r");break;case"t":t=Nt("	");break;case"v":t=Nt("\v");break}if(Zs(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Nt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Nt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Nt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,jg(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,jg(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else Mh(r.value,t),t.push(Nt("-")),Mh(i.value,t)}else Mh(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Nt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(MI.test(t)===!1)throw Error("Expecting a positive integer");for(;Wc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(Wc.test(t)===!1)throw Error("Expecting an integer");for(;Wc.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Nt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Wc.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(LI.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class Uh{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let Gc={};const FI=new UI;function Hc(e){const t=e.toString();if(Gc.hasOwnProperty(t))return Gc[t];{const n=FI.pattern(t);return Gc[t]=n,n}}function PI(){Gc={}}const Kg="Complement Sets are not supported for first char optimization",Yc=`Unable to use "first char" lexer optimizations:
`;function BI(e,t=!1){try{const n=Hc(e);return Fh(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Kg)t&&Fg(`${Yc}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Lh(`${Yc}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Fh(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Fh(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Vc(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(Kg);It(o.value,c=>{if(typeof c=="number")Vc(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Vc(l,t,n);else{for(let l=u.from;l<=u.to&&l<ea;l++)Vc(l,t,n);if(u.to>=ea){const l=u.from>=ea?u.from:ea,h=u.to,f=Mi(l),d=Mi(h);for(let p=f;p<=d;p++)t[p]=p}}}});break;case"Group":Fh(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Ph(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Me(t)}function Vc(e,t,n){const r=Mi(e);t[r]=r,n===!0&&DI(e,t)}function DI(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Mi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Mi(i.charCodeAt(0));t[s]=s}}}function Wg(e,t){return Xs(e.value,n=>{if(typeof n=="number")return dn(t,n);{const r=n;return Xs(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Ph(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?Jt(e.value)?or(e.value,Ph):Ph(e.value):!1}class $I extends Uh{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){dn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Wg(t,this.targetCharCodes)===void 0&&(this.found=!0):Wg(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Bh(e,t){if(t instanceof RegExp){const n=Hc(t),r=new $I(e);return r.visit(n),r.found}else return Xs(t,n=>dn(e,n.charCodeAt(0)))!==void 0}const os="PATTERN",ta="defaultMode",qc="modes";let Gg=typeof new RegExp("(?:)").sticky=="boolean";function jI(e,t){t=Oh(t,{useSticky:Gg,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,v)=>v()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{uN()});let r;n("Reject Lexer.NA",()=>{r=Pc(e,T=>T[os]===ze.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=wt(r,T=>{const v=T[os];if(ai(v)){const N=v.source;return N.length===1&&N!=="^"&&N!=="$"&&N!=="."&&!v.ignoreCase?N:N.length===2&&N[0]==="\\"&&!dn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],N[1])?N[1]:t.useSticky?Yg(v):Hg(v)}else{if(ii(v))return i=!0,{exec:v};if(typeof v=="object")return i=!0,v;if(typeof v=="string"){if(v.length===1)return v;{const N=v.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(N);return t.useSticky?Yg(U):Hg(U)}}else throw Error("non exhaustive match")}})});let o,a,c,u,l;n("misc mapping",()=>{o=wt(r,T=>T.tokenTypeIdx),a=wt(r,T=>{const v=T.GROUP;if(v!==ze.SKIPPED){if(kn(v))return v;if(ci(v))return!1;throw Error("non exhaustive match")}}),c=wt(r,T=>{const v=T.LONGER_ALT;if(v)return Jt(v)?wt(v,U=>Mg(r,U)):[Mg(r,v)]}),u=wt(r,T=>T.PUSH_MODE),l=wt(r,T=>Rt(T,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const T=Xg(t.lineTerminatorCharacters);h=wt(r,v=>!1),t.positionTracking!=="onlyOffset"&&(h=wt(r,v=>Rt(v,"LINE_BREAKS")?!!v.LINE_BREAKS:qg(v,T)===!1&&Bh(T,v.PATTERN)))});let f,d,p,g;n("Misc Mapping #2",()=>{f=wt(r,Vg),d=wt(s,aN),p=xn(r,(T,v)=>{const N=v.GROUP;return kn(N)&&N!==ze.SKIPPED&&(T[N]=[]),T},{}),g=wt(s,(T,v)=>({pattern:s[v],longerAlt:c[v],canLineTerminator:h[v],isCustom:f[v],short:d[v],group:a[v],push:u[v],pop:l[v],tokenTypeIdx:o[v],tokenType:r[v]}))});let k=!0,E=[];return t.safeMode||n("First Char Optimization",()=>{E=xn(r,(T,v,N)=>{if(typeof v.PATTERN=="string"){const U=v.PATTERN.charCodeAt(0),L=Mi(U);Dh(T,L,g[N])}else if(Jt(v.START_CHARS_HINT)){let U;It(v.START_CHARS_HINT,L=>{const O=typeof L=="string"?L.charCodeAt(0):L,B=Mi(O);U!==B&&(U=B,Dh(T,B,g[N]))})}else if(ai(v.PATTERN))if(v.PATTERN.unicode)k=!1,t.ensureOptimizations&&Lh(`${Yc}	Unable to analyze < ${v.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=BI(v.PATTERN,t.ensureOptimizations);de(U)&&(k=!1),It(U,L=>{Dh(T,L,g[N])})}else t.ensureOptimizations&&Lh(`${Yc}	TokenType: <${v.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),k=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:g,charCodeToPatternIdxToConfig:E,hasCustom:i,canBeOptimized:k}}function zI(e,t){let n=[];const r=WI(e);n=n.concat(r.errors);const i=GI(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(KI(s)),n=n.concat(QI(s)),n=n.concat(tN(s,t)),n=n.concat(eN(s)),n}function KI(e){let t=[];const n=Qn(e,r=>ai(r[os]));return t=t.concat(YI(n)),t=t.concat(XI(n)),t=t.concat(JI(n)),t=t.concat(ZI(n)),t=t.concat(VI(n)),t}function WI(e){const t=Qn(e,i=>!Rt(i,os)),n=wt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:ve.MISSING_PATTERN,tokenTypes:[i]})),r=Fc(e,t);return{errors:n,valid:r}}function GI(e){const t=Qn(e,i=>{const s=i[os];return!ai(s)&&!ii(s)&&!Rt(s,"exec")&&!kn(s)}),n=wt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ve.INVALID_PATTERN,tokenTypes:[i]})),r=Fc(e,t);return{errors:n,valid:r}}const HI=/[^\\][$]/;function YI(e){class t extends Uh{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Qn(e,i=>{const s=i.PATTERN;try{const o=Hc(s),a=new t;return a.visit(o),a.found}catch{return HI.test(s.source)}});return wt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ve.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function VI(e){const t=Qn(e,r=>r.PATTERN.test(""));return wt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:ve.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const qI=/[^\\[][\^]|^\^/;function XI(e){class t extends Uh{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Qn(e,i=>{const s=i.PATTERN;try{const o=Hc(s),a=new t;return a.visit(o),a.found}catch{return qI.test(s.source)}});return wt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ve.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function JI(e){const t=Qn(e,r=>{const i=r[os];return i instanceof RegExp&&(i.multiline||i.global)});return wt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ve.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function ZI(e){const t=[];let n=wt(e,s=>xn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!dn(t,a)&&a.PATTERN!==ze.NA&&(t.push(a),o.push(a)),o),[]));n=Xo(n);const r=Qn(n,s=>s.length>1);return wt(r,s=>{const o=wt(s,c=>c.name);return{message:`The same RegExp pattern ->${ar(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:ve.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function QI(e){const t=Qn(e,r=>{if(!Rt(r,"GROUP"))return!1;const i=r.GROUP;return i!==ze.SKIPPED&&i!==ze.NA&&!kn(i)});return wt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ve.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function tN(e,t){const n=Qn(e,i=>i.PUSH_MODE!==void 0&&!dn(t,i.PUSH_MODE));return wt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:ve.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function eN(e){const t=[],n=xn(e,(r,i,s)=>{const o=i.PATTERN;return o===ze.NA||(kn(o)?r.push({str:o,idx:s,tokenType:i}):ai(o)&&rN(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return It(e,(r,i)=>{It(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&nN(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:ve.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function nN(e,t){if(ai(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(ii(t))return t(e,0,[],{});if(Rt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function rN(e){return Xs([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Hg(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Yg(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function iN(e,t,n){const r=[];return Rt(e,ta)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ta+`> property in its definition
`,type:ve.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Rt(e,qc)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+qc+`> property in its definition
`,type:ve.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Rt(e,qc)&&Rt(e,ta)&&!Rt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${ta}: <${e.defaultMode}>which does not exist
`,type:ve.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Rt(e,qc)&&It(e.modes,(i,s)=>{It(i,(o,a)=>{if(ci(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:ve.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Rt(o,"LONGER_ALT")){const c=Jt(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];It(c,u=>{!ci(u)&&!dn(i,u)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${u.name}> on token <${o.name}> outside of mode <${s}>
`,type:ve.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function sN(e,t,n){const r=[];let i=!1;const s=Xo(Fn(Me(e.modes))),o=Pc(s,c=>c[os]===ze.NA),a=Xg(n);return t&&It(o,c=>{const u=qg(c,a);if(u!==!1){const h={message:lN(c,u),type:u.issue,tokenType:c};r.push(h)}else Rt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):Bh(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:ve.NO_LINE_BREAKS_FLAGS}),r}function oN(e){const t={},n=Jn(e);return It(n,r=>{const i=e[r];if(Jt(i))t[r]=[];else throw Error("non exhaustive match")}),t}function Vg(e){const t=e.PATTERN;if(ai(t))return!1;if(ii(t))return!0;if(Rt(t,"exec"))return!0;if(kn(t))return!1;throw Error("non exhaustive match")}function aN(e){return kn(e)&&e.length===1?e.charCodeAt(0):!1}const cN={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function qg(e,t){if(Rt(e,"LINE_BREAKS"))return!1;if(ai(e.PATTERN)){try{Bh(t,e.PATTERN)}catch(n){return{issue:ve.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(kn(e.PATTERN))return!1;if(Vg(e))return{issue:ve.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function lN(e,t){if(t.issue===ve.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===ve.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Xg(e){return wt(e,n=>kn(n)?n.charCodeAt(0):n)}function Dh(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const ea=256;let Xc=[];function Mi(e){return e<ea?e:Xc[e]}function uN(){if(de(Xc)){Xc=new Array(65536);for(let e=0;e<65536;e++)Xc[e]=e>255?255+~~(e/255):e}}function na(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function Jc(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let Jg=1;const Zg={};function ra(e){const t=hN(e);fN(t),pN(t),dN(t),It(t,n=>{n.isParent=n.categoryMatches.length>0})}function hN(e){let t=tn(e),n=e,r=!0;for(;r;){n=Xo(Fn(wt(n,s=>s.CATEGORIES)));const i=Fc(n,t);t=t.concat(i),de(i)?r=!1:n=i}return t}function fN(e){It(e,t=>{ty(t)||(Zg[Jg]=t,t.tokenTypeIdx=Jg++),ey(t)&&!Jt(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),ey(t)||(t.CATEGORIES=[]),mN(t)||(t.categoryMatches=[]),gN(t)||(t.categoryMatchesMap={})})}function dN(e){It(e,t=>{t.categoryMatches=[],It(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(Zg[r].tokenTypeIdx)})})}function pN(e){It(e,t=>{Qg([],t)})}function Qg(e,t){It(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),It(t.CATEGORIES,n=>{const r=e.concat(t);dn(r,n)||Qg(r,n)})}function ty(e){return Rt(e,"tokenTypeIdx")}function ey(e){return Rt(e,"CATEGORIES")}function mN(e){return Rt(e,"categoryMatches")}function gN(e){return Rt(e,"categoryMatchesMap")}function yN(e){return Rt(e,"tokenTypeIdx")}const _N={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var ve;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(ve||(ve={}));const ia={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:_N,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(ia);let ze=class{constructor(t,n=ia){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Pg(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=wn({},ia,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===ia.lineTerminatorsPattern)this.config.lineTerminatorsPattern=cN;else if(this.config.lineTerminatorCharacters===ia.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Jt(t)?i={modes:{defaultMode:tn(t)},defaultMode:ta}:(s=!1,i=tn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(iN(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(sN(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},It(i.modes,(a,c)=>{i.modes[c]=Pc(a,u=>ci(u))});const o=Jn(i.modes);if(It(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(zI(a,o))}),de(this.lexerDefinitionErrors)){ra(a);let u;this.TRACE_INIT("analyzeTokenTypes",()=>{u=jI(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=wn({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!de(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=wt(this.lexerDefinitionErrors,u=>u.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}It(this.lexerDefinitionWarning,a=>{Fg(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Gg?(this.chopInput=Hs,this.match=this.matchWithTest):(this.updateLastIndex=$e,this.match=this.matchWithExec),s&&(this.handleModes=$e),this.trackStartLines===!1&&(this.computeNewColumn=Hs),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=$e),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=xn(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!de(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{PI()}),this.TRACE_INIT("toFastProperties",()=>{Bg(this)})})}tokenize(t,n=this.defaultMode){if(!de(this.lexerDefinitionErrors)){const i=wt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,h,f,d,p,g,k,E;const T=t,v=T.length;let N=0,U=0;const L=this.hasCustom?0:Math.floor(t.length/10),O=new Array(L),B=[];let F=this.trackStartLines?1:void 0,nt=this.trackStartLines?1:void 0;const dt=oN(this.emptyGroups),M=this.trackStartLines,R=this.config.lineTerminatorsPattern;let _=0,P=[],Z=[];const j=[],ut=[];Object.freeze(ut);let tt;function ht(){return P}function G(Ct){const Zt=Mi(Ct),At=Z[Zt];return At===void 0?ut:At}const z=Ct=>{if(j.length===1&&Ct.tokenType.PUSH_MODE===void 0){const Zt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ct);B.push({offset:Ct.startOffset,line:Ct.startLine,column:Ct.startColumn,length:Ct.image.length,message:Zt})}else{j.pop();const Zt=qs(j);P=this.patternIdxToConfig[Zt],Z=this.charCodeToPatternIdxToConfig[Zt],_=P.length;const At=this.canModeBeOptimized[Zt]&&this.config.safeMode===!1;Z&&At?tt=G:tt=ht}};function bt(Ct){j.push(Ct),Z=this.charCodeToPatternIdxToConfig[Ct],P=this.patternIdxToConfig[Ct],_=P.length,_=P.length;const Zt=this.canModeBeOptimized[Ct]&&this.config.safeMode===!1;Z&&Zt?tt=G:tt=ht}bt.call(this,n);let st;const at=this.config.recoveryEnabled;for(;N<v;){c=null;const Ct=T.charCodeAt(N),Zt=tt(Ct),At=Zt.length;for(r=0;r<At;r++){st=Zt[r];const xt=st.pattern;u=null;const Dt=st.short;if(Dt!==!1?Ct===Dt&&(c=xt):st.isCustom===!0?(E=xt.exec(T,N,O,dt),E!==null?(c=E[0],E.payload!==void 0&&(u=E.payload)):c=null):(this.updateLastIndex(xt,N),c=this.match(xt,t,N)),c!==null){if(a=st.longerAlt,a!==void 0){const Wt=a.length;for(s=0;s<Wt;s++){const _e=P[a[s]],Re=_e.pattern;if(l=null,_e.isCustom===!0?(E=Re.exec(T,N,O,dt),E!==null?(o=E[0],E.payload!==void 0&&(l=E.payload)):o=null):(this.updateLastIndex(Re,N),o=this.match(Re,t,N)),o&&o.length>c.length){c=o,u=l,st=_e;break}}}break}}if(c!==null){if(h=c.length,f=st.group,f!==void 0&&(d=st.tokenTypeIdx,p=this.createTokenInstance(c,N,d,st.tokenType,F,nt,h),this.handlePayload(p,u),f===!1?U=this.addToken(O,U,p):dt[f].push(p)),t=this.chopInput(t,h),N=N+h,nt=this.computeNewColumn(nt,h),M===!0&&st.canLineTerminator===!0){let xt=0,Dt,Wt;R.lastIndex=0;do Dt=R.test(c),Dt===!0&&(Wt=R.lastIndex-1,xt++);while(Dt===!0);xt!==0&&(F=F+xt,nt=h-Wt,this.updateTokenEndLineColumnLocation(p,f,Wt,xt,F,nt,h))}this.handleModes(st,z,bt,p)}else{const xt=N,Dt=F,Wt=nt;let _e=at===!1;for(;_e===!1&&N<v;)for(t=this.chopInput(t,1),N++,i=0;i<_;i++){const Re=P[i],b=Re.pattern,rt=Re.short;if(rt!==!1?T.charCodeAt(N)===rt&&(_e=!0):Re.isCustom===!0?_e=b.exec(T,N,O,dt)!==null:(this.updateLastIndex(b,N),_e=b.exec(t)!==null),_e===!0)break}if(g=N-xt,nt=this.computeNewColumn(nt,g),k=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,xt,g,Dt,Wt),B.push({offset:xt,line:Dt,column:Wt,length:g,message:k}),at===!1)break}}return this.hasCustom||(O.length=U),{tokens:O,groups:dt,errors:B}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1+-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};ze.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",ze.NA=/NOT_APPLICABLE/;function sa(e){return ny(e)?e.LABEL:e.name}function ny(e){return kn(e.LABEL)&&e.LABEL!==""}const bN="parent",ry="categories",iy="label",sy="group",oy="push_mode",ay="pop_mode",cy="longer_alt",ly="line_breaks",uy="start_chars_hint";function Pn(e){return EN(e)}function EN(e){const t=e.pattern,n={};if(n.name=e.name,ci(t)||(n.PATTERN=t),Rt(e,bN))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Rt(e,ry)&&(n.CATEGORIES=e[ry]),ra([n]),Rt(e,iy)&&(n.LABEL=e[iy]),Rt(e,sy)&&(n.GROUP=e[sy]),Rt(e,ay)&&(n.POP_MODE=e[ay]),Rt(e,oy)&&(n.PUSH_MODE=e[oy]),Rt(e,cy)&&(n.LONGER_ALT=e[cy]),Rt(e,ly)&&(n.LINE_BREAKS=e[ly]),Rt(e,uy)&&(n.START_CHARS_HINT=e[uy]),n}const as=Pn({name:"EOF",pattern:ze.NA});ra([as]);function Zc(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function wN(e,t){return na(e,t)}const hy={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${ny(e)?`--> ${sa(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+ar(t).image+"'";if(r)return s+r+a;{const c=xn(e,(f,d)=>f.concat(d),[]),u=wt(c,f=>`[${wt(f,d=>sa(d)).join(", ")}]`),h=`one of these possible Token sequences:
${wt(u,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+ar(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${wt(e,u=>`[${wt(u,l=>sa(l)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(hy);const kN={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},cs={buildDuplicateFoundError(e,t){function n(l){return l instanceof xe?l.terminalType.name:l instanceof Tn?l.nonTerminalName:""}const r=e.name,i=ar(t),s=i.idx,o=Ur(i),a=n(i),c=s>0;let u=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return u=u.replace(/[ \t]+/g," "),u=u.replace(/\s\s+/g,`
`),u},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=wt(e.prefixPath,i=>sa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=wt(e.prefixPath,i=>sa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Ur(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=wt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof Js?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function xN(e,t){const n=new TN(e,t);return n.resolveRefs(),n.errors}class TN extends ss{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){It(Me(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:pn.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class AN extends jc{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=tn(this.path.ruleStack).reverse(),this.occurrenceStack=tn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){de(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class vN extends AN{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new An({definition:i});this.possibleTokTypes=Zo(s),this.found=!0}}}class Qc extends jc{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class SN extends Qc{walkMany(t,n,r){if(t.idx===this.occurrence){const i=ar(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof xe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class fy extends Qc{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=ar(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof xe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class RN extends Qc{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=ar(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof xe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class dy extends Qc{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=ar(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof xe&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function $h(e,t,n=[]){n=tn(n);let r=[],i=0;function s(a){return a.concat(en(e,i+1))}function o(a){const c=$h(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof An)return o(a.definition);if(a instanceof Tn)return o(a.definition);if(a instanceof vn)r=o(a.definition);else if(a instanceof Lr){const c=a.definition.concat([new je({definition:a.definition})]);return o(c)}else if(a instanceof Mr){const c=[new An({definition:a.definition}),new je({definition:[new xe({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof lr){const c=a.definition.concat([new je({definition:[new xe({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof je){const c=a.definition.concat([new je({definition:a.definition})]);r=o(c)}else{if(a instanceof ur)return It(a.definition,c=>{de(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof xe)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:en(e,i)}),r}function py(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!de(h);){const f=h.pop();if(f===o){a&&qs(h).idx<=u&&h.pop();continue}const d=f.def,p=f.idx,g=f.ruleStack,k=f.occurrenceStack;if(de(d))continue;const E=d[0];if(E===i){const T={idx:p,def:en(d),ruleStack:Jo(g),occurrenceStack:Jo(k)};h.push(T)}else if(E instanceof xe)if(p<c-1){const T=p+1,v=t[T];if(n(v,E.terminalType)){const N={idx:T,def:en(d),ruleStack:g,occurrenceStack:k};h.push(N)}}else if(p===c-1)l.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:g,occurrenceStack:k}),a=!0;else throw Error("non exhaustive match");else if(E instanceof Tn){const T=tn(g);T.push(E.nonTerminalName);const v=tn(k);v.push(E.idx);const N={idx:p,def:E.definition.concat(s,en(d)),ruleStack:T,occurrenceStack:v};h.push(N)}else if(E instanceof vn){const T={idx:p,def:en(d),ruleStack:g,occurrenceStack:k};h.push(T),h.push(o);const v={idx:p,def:E.definition.concat(en(d)),ruleStack:g,occurrenceStack:k};h.push(v)}else if(E instanceof Lr){const T=new je({definition:E.definition,idx:E.idx}),v=E.definition.concat([T],en(d)),N={idx:p,def:v,ruleStack:g,occurrenceStack:k};h.push(N)}else if(E instanceof Mr){const T=new xe({terminalType:E.separator}),v=new je({definition:[T].concat(E.definition),idx:E.idx}),N=E.definition.concat([v],en(d)),U={idx:p,def:N,ruleStack:g,occurrenceStack:k};h.push(U)}else if(E instanceof lr){const T={idx:p,def:en(d),ruleStack:g,occurrenceStack:k};h.push(T),h.push(o);const v=new xe({terminalType:E.separator}),N=new je({definition:[v].concat(E.definition),idx:E.idx}),U=E.definition.concat([N],en(d)),L={idx:p,def:U,ruleStack:g,occurrenceStack:k};h.push(L)}else if(E instanceof je){const T={idx:p,def:en(d),ruleStack:g,occurrenceStack:k};h.push(T),h.push(o);const v=new je({definition:E.definition,idx:E.idx}),N=E.definition.concat([v],en(d)),U={idx:p,def:N,ruleStack:g,occurrenceStack:k};h.push(U)}else if(E instanceof ur)for(let T=E.definition.length-1;T>=0;T--){const v=E.definition[T],N={idx:p,def:v.definition.concat(en(d)),ruleStack:g,occurrenceStack:k};h.push(N),h.push(o)}else if(E instanceof An)h.push({idx:p,def:E.definition.concat(en(d)),ruleStack:g,occurrenceStack:k});else if(E instanceof Js)h.push(IN(E,p,g,k));else throw Error("non exhaustive match")}return l}function IN(e,t,n,r){const i=tn(n);i.push(e.name);const s=tn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Se;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Se||(Se={}));function my(e){if(e instanceof vn||e==="Option")return Se.OPTION;if(e instanceof je||e==="Repetition")return Se.REPETITION;if(e instanceof Lr||e==="RepetitionMandatory")return Se.REPETITION_MANDATORY;if(e instanceof Mr||e==="RepetitionMandatoryWithSeparator")return Se.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof lr||e==="RepetitionWithSeparator")return Se.REPETITION_WITH_SEPARATOR;if(e instanceof ur||e==="Alternation")return Se.ALTERNATION;throw Error("non exhaustive match")}function NN(e,t,n,r,i,s){const o=zh(e,t,n),a=by(o)?Jc:na;return s(o,r,a,i)}function ON(e,t,n,r,i,s){const o=Kh(e,t,i,n),a=by(o)?Jc:na;return s(o[0],a,r)}function CN(e,t,n,r){const i=e.length,s=or(e,o=>or(o,a=>a.length===1));if(t)return function(o){const a=wt(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let f=0;f<l;f++){const d=u[f],p=d.length;for(let g=0;g<p;g++){const k=this.LA(g+1);if(n(k,d[g])===!1)continue t}return c}}};if(s&&!r){const o=wt(e,c=>Fn(c)),a=xn(o,(c,u,l)=>(It(u,h=>{Rt(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=l),It(h.categoryMatches,f=>{Rt(c,f)||(c[f]=l)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let u=0;u<c;u++){const l=a[u],h=l.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(n(d,l[f])===!1)continue t}return o}}}}function LN(e,t,n){const r=or(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Fn(e);if(s.length===1&&de(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=xn(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,It(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue t}return!0}return!1}}class MN extends jc{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Se.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Se.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Se.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Se.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Se.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class gy extends ss{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Se.OPTION)}visitRepetition(t){this.checkIsTarget(t,Se.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Se.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Se.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Se.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Se.ALTERNATION)}}function yy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function jh(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function UN(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function _y(e,t){const n=wt(e,o=>$h([o],1)),r=yy(n.length),i=wt(n,o=>{const a={};return It(o,c=>{const u=jh(c.partialPath);It(u,l=>{a[l]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=yy(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const h=u[l].partialPath,f=u[l].suffixDef,d=jh(h);if(UN(i,d,c)||de(f)||h.length===t){const g=r[c];if(Wh(g,h)===!1){g.push(h);for(let k=0;k<d.length;k++){const E=d[k];i[c][E]=!0}}}else{const g=$h(f,o+1,h);s[c]=s[c].concat(g),It(g,k=>{const E=jh(k.partialPath);It(E,T=>{i[c][T]=!0})})}}}}return r}function zh(e,t,n,r){const i=new gy(e,Se.ALTERNATION,r);return t.accept(i),_y(i.result,n)}function Kh(e,t,n,r){const i=new gy(e,n);t.accept(i);const s=i.result,a=new MN(t,e,n).startWalking(),c=new An({definition:s}),u=new An({definition:a});return _y([c,u],r)}function Wh(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function FN(e,t){return e.length<t.length&&or(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function by(e){return or(e,t=>or(t,n=>or(n,r=>de(r.categoryMatches))))}function PN(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return wt(t,n=>Object.assign({type:pn.CUSTOM_LOOKAHEAD_VALIDATION},n))}function BN(e,t,n,r){const i=tr(e,c=>DN(c,n)),s=JN(e,t,n),o=tr(e,c=>YN(c,n)),a=tr(e,c=>zN(c,e,r,n));return i.concat(s,o,a)}function DN(e,t){const n=new jN;e.accept(n);const r=n.allProductions,i=Lg(r,$N),s=cr(i,a=>a.length>1);return wt(Me(s),a=>{const c=ar(a),u=t.buildDuplicateFoundError(e,a),l=Ur(c),h={message:u,type:pn.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:l,occurrence:c.idx},f=Ey(c);return f&&(h.parameter=f),h})}function $N(e){return`${Ur(e)}_#_${e.idx}_#_${Ey(e)}`}function Ey(e){return e instanceof xe?e.terminalType.name:e instanceof Tn?e.nonTerminalName:""}class jN extends ss{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function zN(e,t,n,r){const i=[];if(xn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:pn.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function KN(e,t,n){const r=[];let i;return dn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:pn.INVALID_RULE_OVERRIDE,ruleName:e})),r}function wy(e,t,n,r=[]){const i=[],s=tl(t.definition);if(de(s))return[];{const o=e.name;dn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:pn.LEFT_RECURSION,ruleName:o});const c=Fc(s,r.concat([e])),u=tr(c,l=>{const h=tn(r);return h.push(l),wy(e,l,n,h)});return i.concat(u)}}function tl(e){let t=[];if(de(e))return t;const n=ar(e);if(n instanceof Tn)t.push(n.referencedRule);else if(n instanceof An||n instanceof vn||n instanceof Lr||n instanceof Mr||n instanceof lr||n instanceof je)t=t.concat(tl(n.definition));else if(n instanceof ur)t=Fn(wt(n.definition,s=>tl(s.definition)));else if(!(n instanceof xe))throw Error("non exhaustive match");const r=$c(n),i=e.length>1;if(r&&i){const s=en(e);return t.concat(tl(s))}else return t}class Gh extends ss{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function WN(e,t){const n=new Gh;e.accept(n);const r=n.alternations;return tr(r,s=>{const o=Jo(s.definition);return tr(o,(a,c)=>{const u=py([a],[],na,1);return de(u)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:pn.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function GN(e,t,n){const r=new Gh;e.accept(r);let i=r.alternations;return i=Pc(i,o=>o.ignoreAmbiguities===!0),tr(i,o=>{const a=o.idx,c=o.maxLookahead||t,u=zh(a,e,c,o),l=qN(u,o,e,n),h=XN(u,o,e,n);return l.concat(h)})}class HN extends ss{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function YN(e,t){const n=new Gh;e.accept(n);const r=n.alternations;return tr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:pn.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function VN(e,t,n){const r=[];return It(e,i=>{const s=new HN;i.accept(s);const o=s.allProductions;It(o,a=>{const c=my(a),u=a.maxLookahead||t,l=a.idx,f=Kh(l,i,c,u)[0];if(de(Fn(f))){const d=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:pn.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function qN(e,t,n,r){const i=[],s=xn(e,(a,c,u)=>(t.definition[u].ignoreAmbiguities===!0||It(c,l=>{const h=[u];It(e,(f,d)=>{u!==d&&Wh(f,l)&&t.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!Wh(i,l)&&(i.push(l),a.push({alts:h,path:l}))}),a),[]);return wt(s,a=>{const c=wt(a.alts,l=>l+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:pn.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function XN(e,t,n,r){const i=xn(e,(o,a,c)=>{const u=wt(a,l=>({idx:c,path:l}));return o.concat(u)},[]);return Xo(tr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,u=o.path,l=Qn(i,f=>t.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&FN(f.path,u));return wt(l,f=>{const d=[f.idx+1,c+1],p=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:d,prefixPath:f.path}),type:pn.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:d}})}))}function JN(e,t,n){const r=[],i=wt(t,s=>s.name);return It(e,s=>{const o=s.name;if(dn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:pn.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function ZN(e){const t=Oh(e,{errMsgProvider:kN}),n={};return It(e.rules,r=>{n[r.name]=r}),xN(n,t.errMsgProvider)}function QN(e){return e=Oh(e,{errMsgProvider:cs}),BN(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const ky="MismatchedTokenException",xy="NoViableAltException",Ty="EarlyExitException",Ay="NotAllInputParsedException",vy=[ky,xy,Ty,Ay];Object.freeze(vy);function el(e){return dn(vy,e.name)}class nl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Sy extends nl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ky}}class tO extends nl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=xy}}class eO extends nl{constructor(t,n){super(t,n),this.name=Ay}}class nO extends nl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ty}}const Hh={},Ry="InRuleRecoveryException";class rO extends Error{constructor(t){super(t),this.name=Ry}}class iO{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Rt(t,"recoveryEnabled")?t.recoveryEnabled:li.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=sO)}getTokenToInsert(t){const n=Zc(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const u=this.LA(1);let l=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:u,previous:f,ruleName:this.getCurrRuleFullName()}),p=new Sy(d,u,this.LA(0));p.resyncedTokens=Jo(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(l,i)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(l,s)?c=!0:(l=this.SKIP_TOKEN(),this.addToResyncTokens(l,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new rO("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||de(n))return!1;const r=this.LA(1);return Xs(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return dn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Xs(t,s=>wN(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Hh;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return wt(t,(r,i)=>i===0?Hh:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=wt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Fn(t)}getFollowSetFromFollowKey(t){if(t===Hh)return[as];const n=t.ruleName+t.idxInCallingRule+$g+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,as)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Jo(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=tn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return wt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function sO(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&u===void 0&&(u=as,l=1),!(u===void 0||l===void 0)&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const oO=4,Ui=8,Iy=1<<Ui,Ny=2<<Ui,Yh=3<<Ui,Vh=4<<Ui,qh=5<<Ui,rl=6<<Ui;function Xh(e,t,n){return n|t|e}class aO{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:li.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(de(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return tr(t,n=>wy(n,n,cs))}validateEmptyOrAlternatives(t){return tr(t,n=>WN(n,cs))}validateAmbiguousAlternationAlternatives(t,n){return tr(t,r=>GN(r,n,cs))}validateSomeNonEmptyLookaheadPath(t,n){return VN(t,n,cs)}buildLookaheadForAlternation(t){return NN(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,CN)}buildLookaheadForOptional(t){return ON(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,my(t.prodType),LN)}}class cO{initLooksAhead(t){this.dynamicTokensEnabled=Rt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:li.dynamicTokensEnabled,this.maxLookahead=Rt(t,"maxLookahead")?t.maxLookahead:li.maxLookahead,this.lookaheadStrategy=Rt(t,"lookaheadStrategy")?t.lookaheadStrategy:new aO({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){It(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=uO(n);It(r,u=>{const l=u.idx===0?"":u.idx;this.TRACE_INIT(`${Ur(u)}${l}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:u.idx,rule:n,maxLookahead:u.maxLookahead||this.maxLookahead,hasPredicates:u.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=Xh(this.fullRuleNameToShort[n.name],Iy,u.idx);this.setLaFuncCache(f,h)})}),It(i,u=>{this.computeLookaheadFunc(n,u.idx,Yh,"Repetition",u.maxLookahead,Ur(u))}),It(s,u=>{this.computeLookaheadFunc(n,u.idx,Ny,"Option",u.maxLookahead,Ur(u))}),It(o,u=>{this.computeLookaheadFunc(n,u.idx,Vh,"RepetitionMandatory",u.maxLookahead,Ur(u))}),It(a,u=>{this.computeLookaheadFunc(n,u.idx,rl,"RepetitionMandatoryWithSeparator",u.maxLookahead,Ur(u))}),It(c,u=>{this.computeLookaheadFunc(n,u.idx,qh,"RepetitionWithSeparator",u.maxLookahead,Ur(u))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Xh(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return Xh(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class lO extends ss{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const il=new lO;function uO(e){il.reset(),e.accept(il);const t=il.dslMethods;return il.reset(),t}function Oy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function Cy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function hO(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function fO(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const dO="name";function Ly(e,t){Object.defineProperty(e,dO,{enumerable:!1,configurable:!0,writable:!1,value:t})}function pO(e,t){const n=Jn(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const u=o[c];u.tokenTypeIdx===void 0&&this[u.name](u.children,t)}}}function mO(e,t){const n=function(){};Ly(n,e+"BaseSemantics");const r={visit:function(i,s){if(Jt(i)&&(i=i[0]),!ci(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=yO(this,t);if(!de(i)){const s=wt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function gO(e,t,n){const r=function(){};Ly(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return It(t,s=>{i[s]=pO}),r.prototype=i,r.prototype.constructor=r,r}var Jh;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Jh||(Jh={}));function yO(e,t){return _O(e,t)}function _O(e,t){const n=Qn(t,i=>ii(e[i])===!1),r=wt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:Jh.MISSING_METHOD,methodName:i}));return Xo(r)}class bO{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Rt(t,"nodeLocationTracking")?t.nodeLocationTracking:li.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=$e,this.cstFinallyStateUpdate=$e,this.cstPostTerminal=$e,this.cstPostNonTerminal=$e,this.cstPostRule=$e;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Cy,this.setNodeLocationFromNode=Cy,this.cstPostRule=$e,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=$e,this.setNodeLocationFromNode=$e,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Oy,this.setNodeLocationFromNode=Oy,this.cstPostRule=$e,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=$e,this.setNodeLocationFromNode=$e,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=$e,this.setNodeLocationFromNode=$e,this.cstPostRule=$e,this.setInitialNodeLocation=$e;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];hO(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];fO(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(ci(this.baseCstVisitorConstructor)){const t=mO(this.className,Jn(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ci(this.baseCstVisitorWithDefaultsConstructor)){const t=gO(this.className,Jn(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class EO{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):al}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?al:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class wO{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=cl){if(dn(this.definedRulesNames,t)){const o={message:cs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:pn.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=cl){const i=KN(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(el(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return xI(Me(this.gastProductionsCache))}}class kO{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Jc,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Rt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Jt(t)){if(de(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Jt(t))this.tokensMap=xn(t,(s,o)=>(s[o.name]=o,s),{});else if(Rt(t,"modes")&&or(Fn(Me(t.modes)),yN)){const s=Fn(Me(t.modes)),o=Bc(s);this.tokensMap=xn(o,(a,c)=>(a[c.name]=c,a),{})}else if(Xn(t))this.tokensMap=tn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=as;const r=Rt(t,"modes")?Fn(Me(t.modes)):Me(t),i=or(r,s=>de(s.categoryMatches));this.tokenMatcher=i?Jc:na,ra(Me(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Rt(r,"resyncEnabled")?r.resyncEnabled:cl.resyncEnabled,s=Rt(r,"recoveryValueFunc")?r.recoveryValueFunc:cl.recoveryValueFunc,o=this.ruleShortNameIdx<<oO+Ui;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...l){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...l){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,l)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(el(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ny,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Vh,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Se.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Vh,t,RN)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(rl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,dy],a,rl,t,dy)}else throw this.raiseEarlyExitException(t,Se.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Yh,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Yh,t,SN,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(qh,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,fy],a,qh,t,fy)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,rl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Iy,n),i=Jt(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new eO(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw el(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Sy(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===Ry?r:s}}else throw r}saveRecogState(){const t=this.errors,n=tn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),as)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class xO{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Rt(t,"errorMessageProvider")?t.errorMessageProvider:li.errorMessageProvider}SAVE_ERROR(t){if(el(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:tn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return tn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=Kh(t,s,n,this.maxLookahead)[0],c=[];for(let l=1;l<=this.maxLookahead;l++)c.push(this.LA(l));const u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new nO(u,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=zh(t,i,this.maxLookahead),o=[];for(let u=1;u<=this.maxLookahead;u++)o.push(this.LA(u));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new tO(c,this.LA(1),a))}}class TO{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(ci(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return py([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=ar(t.ruleStack),i=this.getGAstProductions()[n];return new vN(i,t).startWalking()}}const sl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(sl);const My=!0,Uy=Math.pow(2,Ui)-1,Fy=Pn({name:"RECORDING_PHASE_TOKEN",pattern:ze.NA});ra([Fy]);const Py=Zc(Fy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Py);const AO={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class vO{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return al}topLevelRuleRecord(t,n){try{const r=new Js({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return oa.call(this,vn,t,n)}atLeastOneInternalRecord(t,n){oa.call(this,Lr,n,t)}atLeastOneSepFirstInternalRecord(t,n){oa.call(this,Mr,n,t,My)}manyInternalRecord(t,n){oa.call(this,je,n,t)}manySepFirstInternalRecord(t,n){oa.call(this,lr,n,t,My)}orInternalRecord(t,n){return SO.call(this,t,n)}subruleInternalRecord(t,n,r){if(ol(n),!t||Rt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${By(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=qs(this.recordingProdStack),s=t.ruleName,o=new Tn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?AO:sl}consumeInternalRecord(t,n,r){if(ol(n),!ty(t)){const o=new Error(`<CONSUME${By(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=qs(this.recordingProdStack),s=new xe({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),Py}}function oa(e,t,n,r=!1){ol(n);const i=qs(this.recordingProdStack),s=ii(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Rt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),sl}function SO(e,t){ol(t);const n=qs(this.recordingProdStack),r=Jt(e)===!1,i=r===!1?e:e.DEF,s=new ur({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Rt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=Ch(i,a=>ii(a.GATE));return s.hasPredicates=o,n.definition.push(s),It(i,a=>{const c=new An({definition:[]});s.definition.push(c),Rt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Rt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),sl}function By(e){return e===0?"":`${e}`}function ol(e){if(e<0||e>Uy){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Uy+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class RO{initPerformanceTracer(t){if(Rt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=li.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=Pg(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function IO(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const al=Zc(as,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(al);const li=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:hy,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),cl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var pn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(pn||(pn={}));let Zh=class K1{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Bg(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),It(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=ZN({rules:Me(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(de(r)&&this.skipValidations===!1){const i=QN({rules:Me(this.gastProductionsCache),tokenTypes:Me(this.tokensMap),errMsgProvider:cs,grammarName:n}),s=PN({lookaheadStrategy:this.lookaheadStrategy,rules:Me(this.gastProductionsCache),tokenTypes:Me(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),de(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=NI(Me(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Me(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Me(this.gastProductionsCache))})),!K1.DEFER_DEFINITION_ERRORS_HANDLING&&!de(this.definitionErrors))throw t=wt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Rt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Rt(n,"skipValidations")?n.skipValidations:li.skipValidations}};Zh.DEFER_DEFINITION_ERRORS_HANDLING=!1,IO(Zh,[iO,cO,bO,EO,kO,wO,xO,TO,vO,RO]);class NO extends Zh{constructor(t,n=li){const r=tn(n);r.outputCst=!0,super(t,r)}}function OO(e){const t=new CO,n=Me(e);return wt(n,r=>t.visitRule(r))}class CO extends ss{visitRule(t){const n=this.visitEach(t.definition),r=Lg(n,s=>s.propertyName),i=wt(r,(s,o)=>{const a=!Ch(s,u=>!u.canBeNull);let c=s[0].type;return s.length>1&&(c=wt(s,u=>u.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:ll(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:ll(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:ll(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:ll(t)}]}visitEachAndOverrideWith(t,n){return wt(this.visitEach(t),r=>wn({},r,n))}visitEach(t){return Fn(wt(t,n=>this.visit(n)))}}function ll(e){return e instanceof Tn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function LO(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(Fn(wt(e,r=>MO(r)))),t.includeVisitorInterface&&(n=n.concat(BO(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function MO(e){const t=UO(e),n=FO(e);return[t,n]}function UO(e){const t=$y(e.name),n=Qh(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function FO(e){return`export type ${Qh(e.name)} = {
  ${wt(e.properties,n=>PO(n)).join(`
  `)}
};`}function PO(e){const t=$O(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function BO(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${wt(t,n=>DO(n)).join(`
  `)}
}`}function DO(e){const t=Qh(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function $O(e){if(Jt(e)){const t=Bc(wt(e,r=>Dy(r)));return"("+xn(t,(r,i)=>r+" | "+i)+")"}else return Dy(e)}function Dy(e){return e.kind==="token"?"IToken":$y(e.name)}function $y(e){return eg(e)+"CstNode"}function Qh(e){return eg(e)+"CstChildren"}const jO={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function zO(e,t){const n=Object.assign(Object.assign({},jO),t),r=OO(e);return LO(r,n)}const tf=S0(32,126).map(e=>String.fromCharCode(e));function zt(e){return Pn({...e,name:`token_${e.name}`})}function Fr(e,t=!1){return zt(t?{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on,group:ze.SKIPPED}:{name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:on})}const aa=zt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),KO=zt({name:"whitespace",pattern:/ +/,group:ze.SKIPPED}),WO=zt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:ze.SKIPPED}),ef=zt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Qs=zt({name:"command",pattern:/#/,start_chars_hint:["#"]});let jy=!1;function GO(e,t,n){if(!jy)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==aa)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const zy=zt({name:"text",pattern:GO,line_breaks:!1,start_chars_hint:tf.filter(e=>"@#/?':!".includes(e)===!1)}),Ky=zt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Wy=zt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Gy=zt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Hy=zt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),on=zt({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:tf}),Yy=zt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Vy=zt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),qy=zt({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:on}),Xy=zt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:on}),Jy=zt({name:"islessthan",pattern:/<|below/,longer_alt:on}),Zy=zt({name:"isgreaterthan",pattern:/>|above/,longer_alt:on}),Qy=zt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:on}),t_=zt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:on}),nf=zt({name:"or",pattern:/or/i,longer_alt:on}),rf=zt({name:"not",pattern:/not/i,longer_alt:on}),sf=zt({name:"and",pattern:/and/i,longer_alt:on}),of=zt({name:"plus",pattern:/\+/}),af=zt({name:"minus",pattern:/-/}),e_=zt({name:"power",pattern:/\*\*/}),n_=zt({name:"multiply",pattern:/\*/}),cf=zt({name:"divide",pattern:/\//}),r_=zt({name:"moddivide",pattern:/%/}),i_=zt({name:"floordivide",pattern:/%%/}),s_=zt({name:"query",pattern:/\?/}),o_=zt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),a_=zt({name:"rparen",pattern:/\)/,pop_mode:!0}),c_=zt({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:tf,longer_alt:on}),lf=zt({name:"if",pattern:/if|try|take|give/,longer_alt:on}),ul=Fr("do"),HO=Fr("to",!0),uf=Fr("done"),YO=Fr("then",!0),hf=Fr("else"),l_=Fr("while"),u_=Fr("repeat"),h_=Fr("waitfor"),f_=zt({name:"foreach",pattern:/foreach|for/,longer_alt:on}),d_=Fr("break"),p_=Fr("continue");function m_(e){return[...e,Vy,qy,Xy,Qy,Jy,t_,Zy,nf,rf,sf,of,af,e_,n_,cf,i_,r_,s_,o_,a_,Yy,on]}const g_=m_([zy,ef,c_,Qs,Ky,Wy,Gy,Hy,aa,KO,d_,p_,uf,ul,hf,f_,lf,u_,YO,HO,h_,l_]),VO=new ze({defaultMode:"use_newlines",modes:{use_newlines:g_,ignore_newlines:m_([WO])}},{skipValidations:!vr,ensureOptimizations:vr});function y_(e){jy=!0;const t=VO.tokenize(e||` 
`),[n]=(ee(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(Zc(aa,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function qO(e,t,n=!0){if(n){const[r,...i]=t;switch(Ut(r??"")){default:return{type:Et.OBJECT,values:t};case"loader":return{type:Et.LOADER,values:i};case"board":return{type:Et.BOARD,values:i};case"object":return{type:Et.OBJECT,values:i};case"terrain":return{type:Et.TERRAIN,values:i};case"charset":return{type:Et.CHARSET,values:i};case"palette":return{type:Et.PALETTE,values:i}}}else{const[r,i,...s]=t,o=Ut(i??""),a=[r,e,...s];switch(o){default:return{type:Et.CONST,values:t};case"rn":case"range":return{type:Et.RANGE,values:a};case"sl":case"select":return{type:Et.SELECT,values:a};case"nm":case"number":return{type:Et.NUMBER,values:a};case"tx":case"text":return{type:Et.TEXT,values:a};case"ln":case"link":return{type:Et.LINK,values:a};case"hk":case"hotkey":return{type:Et.HOTKEY,values:a};case"copyit":return{type:Et.COPYIT,values:a};case"openit":return{type:Et.OPENIT,values:a};case"zssedit":return{type:Et.ZSSEDIT,values:a};case"charedit":return{type:Et.CHAREDIT,values:a};case"coloredit":return{type:Et.COLOREDIT,values:a}}}}function Bn(e){switch(e){case Et.LOADER:return"loader";case Et.BOARD:return"board";case Et.OBJECT:return"object";case Et.TERRAIN:return"terrain";case Et.CHARSET:return"charset";case Et.PALETTE:return"palette";case Et.CONST:return"const";case Et.RANGE:return"range";case Et.SELECT:return"select";case Et.NUMBER:return"number";case Et.TEXT:return"text";case Et.LINK:return"link";case Et.HOTKEY:return"hotkey";case Et.COPYIT:return"copyit";case Et.OPENIT:return"openit";case Et.ZSSEDIT:return"zssedit";case Et.CHAREDIT:return"charedit";case Et.COLOREDIT:return"coloredit"}}var ff=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(ff||{});function __(e){return Gs(e,ff,{bits:t=>Array.from(t)})}function b_(e){return jo(e,ff,{bits:t=>new Uint8Array(t)})}function XO(e,t){return{id:Ie(),code:e,...t}}var df=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(df||{});function JO(e){return Gs(e,df,{board:kL,object:bc,terrain:bc,charset:__,palette:__,stats:Ce})}function ZO(e){return jo(e,df,{board:xL,object:Ec,terrain:Ec,charset:b_,palette:b_})}function ca(e){const t={...ls(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function QO(e){return w(e)?(e.stats=void 0,ls(e)):{}}function E_(e){const t=y_(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===ef){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),u=a.split(" "),l=qO(St(c)?c:"",u,r),h=Ut(l.values.join(" "));switch(r=!1,l.type){case Et.LOADER:n.type=kt.LOADER,n.name=h;break;case Et.BOARD:n.type=kt.BOARD,n.name=h;break;case Et.OBJECT:n.type=kt.OBJECT,n.name=h||"object";break;case Et.TERRAIN:n.type=kt.TERRAIN,n.name=h;break;case Et.CHARSET:n.type=kt.CHARSET,n.name=h;break;case Et.PALETTE:n.type=kt.PALETTE,n.name=h;break;case Et.CONST:{const[f,d]=l.values;if(St(f)){const p=Ut(f);if(St(d)){const g=parseFloat(d);n[p]=Lt(g)?g:d}else Lt(d)?n[p]=d:n[p]=1}break}case Et.RANGE:case Et.SELECT:case Et.NUMBER:case Et.TEXT:case Et.LINK:case Et.HOTKEY:case Et.ZSSEDIT:case Et.CHAREDIT:case Et.COLOREDIT:{const[f,...d]=l.values;if(St(f)){const p=Ut(f);n[p]=[Bn(l.type),...d]}break}}}}return n}function ls(e){var t;return w(e)?(w((t=e.stats)==null?void 0:t.type)||(e.stats=E_(e.code),w(e.stats.type)||(e.stats.type=kt.OBJECT)),e.stats):{}}function w_(e){switch(e){default:case kt.ERROR:return"error";case kt.LOADER:return Bn(Et.LOADER);case kt.BOARD:return Bn(Et.BOARD);case kt.OBJECT:return Bn(Et.OBJECT);case kt.TERRAIN:return Bn(Et.TERRAIN);case kt.CHARSET:return Bn(Et.CHARSET);case kt.PALETTE:return Bn(Et.PALETTE)}}function Pr(e){return ls(e).type??kt.ERROR}function us(e){return w_(Pr(e))}function Je(e){return ls(e).name??""}function k_(e,t){return ls(e)[t]}const hl=new Gu;function pf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ee(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"ispushable":t.pushable=1;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Gt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Gt.ISSWIM;break;case"issolid":t.collision=Gt.ISSOLID;break;case"isbullet":t.collision=Gt.ISBULLET;break;case"isdestructible":t.destructible=1;break}}}function Br(e){var t;if(w(e))switch(Pr(e)){default:return;case kt.ERROR:return e.code??"";case kt.LOADER:return e.code??"";case kt.BOARD:{w(e.board)||(e.board=wL()),e.board.id=e.id;const n=ca(e);return e.board.isdark=n.isdark??e.board.isdark?1:0,e.board.startx=n.startx??e.board.startx,e.board.starty=n.starty??e.board.starty,e.board.over=n.over??e.board.over,e.board.under=n.under??e.board.under,e.board.exitnorth=n.exitnorth??e.board.exitnorth,e.board.exitsouth=n.exitsouth??e.board.exitsouth,e.board.exitwest=n.exitwest??e.board.exitwest,e.board.exiteast=n.exiteast??e.board.exiteast,e.board.timelimit=n.timelimit??e.board.timelimit,e.board.restartonzap=n.restartonzap??e.board.restartonzap,e.board.maxplayershots=n.maxplayershots??e.board.maxplayershots,e.board}case kt.OBJECT:return w(e.object)||(e.object=mm()),e.object.name=Je(e),e.object.category=jn.ISOBJECT,pf(ca(e),e.object),e.object;case kt.TERRAIN:return w(e.terrain)||(e.terrain=mm()),e.terrain.name=Je(e),e.terrain.category=jn.ISTERRAIN,pf(ca(e),e.terrain),e.terrain;case kt.PALETTE:{if(w(e.palette)||(e.palette=ym(bT)),w((t=e.palette)==null?void 0:t.bits)){const n=ca(e),r=mr(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&St(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){hl.set(o);const c=a*sc,u=hl.r*63,l=hl.g*63,h=hl.b*63;e.palette.bits[c+0]=Ln(u,0,63),e.palette.bits[c+1]=Ln(l,0,63),e.palette.bits[c+2]=Ln(h,0,63)}}}}return e.palette}case kt.CHARSET:return w(e.charset)||(e.charset=_m(_T)),e.charset}}function x_(e){return{id:Ie(),name:sb(),timestamp:0,activelist:[],pages:e,flags:{}}}var mf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e))(mf||{});function tC(e){return Gs(e,mf,{pages:t=>t.map(JO),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function eC(e){return jo(e,mf,{pages:t=>t.map(ZO)})}function Fi(e,t){if(!w(e))return;const n=Ut(t);return e.pages.find(i=>i.id===t||n===Je(i))}function ui(e,t,n){if(!w(e))return;const r=Ut(n);return e.pages.find(s=>Pr(s)===t&&(s.id===n||r===Je(s)))}function gf(e,t,n){let r=ui(e,t,n);if(!w(r)){const i=w_(t);r=XO(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),T_(e,r)}return r}function hs(e,t){return w(e)?e.pages.filter(n=>Pr(n)===t):[]}function Pi(e,t,n){return w(e)?e.pages.filter(r=>Pr(r)===t).filter(r=>{const i=ls(r);return w(i[n])}):[]}function T_(e,t){if(!w(e)||!w(t))return!1;const n=Fi(e,t.id);return w(n)?!1:(e.pages.push(t),!0)}function nC(e,t){const n=Fi(e,t);if(w(e)&&w(n)){const r=Ut(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Je(i)),n}}function Bi(e,t){if(w(t)&&w(t.kind))return w(t.kinddata)||(t.kinddata=w(t.id)?la(e,t.kind):yf(e,t.kind)),t.kinddata}function A_(e,t,n){const r=Bi(e,t);return(t==null?void 0:t[n])??(r==null?void 0:r[n])}function v_(e,t,n,r,i){const s=Bi(e,t);return{char:(t==null?void 0:t.char)??(s==null?void 0:s.char)??n,color:(t==null?void 0:t.color)??(s==null?void 0:s.color)??r,bg:(t==null?void 0:t.bg)??(s==null?void 0:s.bg)??i,light:(t==null?void 0:t.light)??(s==null?void 0:s.light)??0}}function la(e,t){const n=t??"",r=ui(e,kt.OBJECT,n);if(w(r)){const i=Br(r);return{...On(i),name:n,code:r.code}}}function yf(e,t){const n=t??"",r=ui(e,kt.TERRAIN,n);if(w(r)){const i=Br(r);return{...On(i),name:n,code:r.code}}}function to(e,t){const n=Fi(e,t);return Br(n)}function hi(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function S_(e,t){e&&delete e.flags[t]}function R_(e,t,n){const r=hi(e,t);return r==null?void 0:r[n]}function rC(e,t,n,r){const i=hi(e,t);return i&&(i[n]=r),r}function fs(e,t){const n=R_(e,t,"board");return to(e,St(n)?n:"")}function iC(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function fl(e,t,n){if(!w(e))return;rC(e,t,"board",n);const r=to(e,n);w(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function ua(e,t,n,r){if(!w(e))return;const i=fs(e,t);if(!w(i))return;const s=Rn(i,t);if(!ih(s)||!(s!=null&&s.id))return;const o=to(e,n);if(!w(o)||(fi(e,o),bf(e,o,Gt.ISWALK,r)))return;delete i.objects[s.id];const a=Kr(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Kr(o,s);o.lookup&&(o.lookup[c]=s.id),fl(e,t,o.id)}function sC(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=R_(e,r,"board");return St(i)?i:""});return Tx(n)}function _f(e){return sC(e).map(n=>to(e,n)).filter(w)}function bf(e,t,n,r){if(!w(e)||!w(t)||!w(t.lookup)||r.x<0||r.x>=ne||r.y<0||r.y>=Ve)return!0;const i=r.x+r.y*ne,s=Rn(t,t.lookup[i]??"404");if(w(s))return!0;const o=t.terrain[i];if(w(o)){const a=Bi(e,o),c=o.collision??(a==null?void 0:a.collision);return qu(n,c)}return!1}function oC(e,t,n,r){const i=Rn(t,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=A_(e,i,"collision");return bf(e,t,a,r)}function I_(e,t,n,r){var l,h;const i=Rn(t,(n==null?void 0:n.id)??"");if(!w(e)||!w(t)||!w(i)||!w(i.x)||!w(i.y)||!w(t.lookup)||r.x<0||r.x>=ne||r.y<0||r.y>=Ve)return{name:"edge",kind:"edge",collision:Gt.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Kr(t,i),o=Kr(t,r),a=i.collision??((l=i==null?void 0:i.kinddata)==null?void 0:l.collision)??Gt.ISWALK,c=Rn(t,t.lookup[o]??"");if(w(c))return{...c};const u=t.terrain[o];if(w(u)){const f=u.collision??((h=u==null?void 0:u.kinddata)==null?void 0:h.collision)??Gt.ISWALK;if(qu(a,f))return{...u,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,w(i.removed)||(t.lookup[s]=void 0,t.lookup[o]=i.id??"")}function Ef(e,t,n,r){var s;if(!w(e)||!w(t)||!w(t.named)||!w(n))return;const i=Ut(n.name??((s=n.kinddata)==null?void 0:s.name)??"");t.named[i]||(t.named[i]=new Set),t.named[i].add((n==null?void 0:n.id)??r??"")}function aC(e,t,n){if(!(!w(e)||!w(t)||!w(t.lookup)||!w(n==null?void 0:n.id))&&!w(n.removed)){const r=n.x??0,i=n.y??0;t.lookup[r+i*ne]=n.id}}function fi(e,t){var a;if(!w(e)||!w(t)||w(t.lookup)&&w(t.named))return;const n=new Array(ne*Ve).fill(void 0),r={},i=Object.values(t.objects);for(let c=0;c<i.length;++c){const u=i[c];if(w(u.x)&&w(u.y)&&w(u.id)&&!w(u.removed)){u.category=jn.ISOBJECT,n[u.x+u.y*ne]=u.id;const l=Ut(u.name??((a=u.kinddata)==null?void 0:a.name)??"");r[l]||(r[l]=new Set),r[l].add(u.id)}}let s=0,o=0;for(let c=0;c<t.terrain.length;++c){const u=t.terrain[c];if(w(u)){u.x=s,u.y=o,u.category=jn.ISTERRAIN;const l=Oi(u);r[l]||(r[l]=new Set),r[l].add(c)}++s,s>=ne&&(s=0,++o)}t.lookup=n,t.named=r}function di(e,t,n,r){return!w(n)||Oi(n)==="player"?!1:(n.id?(n.removed=r,wf(e,t,n)):(yi(t,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0}),cC(e,t,n)),!0)}function cC(e,t,n){var r;if(w(e)&&w(t)&&w(n==null?void 0:n.x)&&w(n.y)){const i=Oi(n),s=Kr(t,n);w((r=t.named)==null?void 0:r[i])&&t.named[i].delete(s)}}function wf(e,t,n){var r;if(w(e)&&w(t)&&w(n==null?void 0:n.id)){if(w(t.lookup)&&w(n.x)&&w(n.y)){const s=n.x+n.y*ne;t.lookup[s]===n.id&&(t.lookup[s]=void 0)}const i=Oi(n);w((r=t.named)==null?void 0:r[i])&&w(n.id)&&t.named[i].delete(n.id)}}function lC(e,t,n){const r=[];if(!w(e)||!w(t))return r;const i=Object.values(t.objects);for(let s=0;s<i.length;++s){const o=i[s];w(o.id)&&w(o.removed)&&n-o.removed>va*5&&(r.push(o.id),I1(t,o.id))}return r}function uC(e,t,n){const r=[];if(!w(e)||!w(t))return r;t.lookup=void 0,fi(e,t);const i=Object.values(t.objects);for(let o=0;o<i.length;++o){const a=i[o];if(!w(a.id))continue;a.lx=a.x,a.ly=a.y;const c=Bi(e,a),u=a.code??(c==null?void 0:c.code)??"";u&&r.push({id:a.id,type:kt.OBJECT,code:u,object:a,terrain:void 0})}const s=lC(e,t,n);for(let o=0;o<s.length;++o)r.push({id:s[o],type:kt.ERROR,code:"",object:void 0,terrain:void 0});return r}function hC(e,t,n,r){if(w(e)&&w(t)&&w(n)){const[i,s]=n,o=la(e,i);if(w(o)&&w(o.name)){const a=Xf(t,r,i);return wc(a,s),a}}}function dl(e,t,n,r,i){if(w(e)&&w(t)&&w(n)){const[s,o]=n,a=yf(e,s);if(w(a)){const u=AL(t,r,s);if(w(u)){wc(u,o);const l=rc(r,ne);return Ef(e,t,u,l),u}}const c=la(e,s);if(w(c)&&w(c.name)){const u=Xf(t,r,s,i);if(w(u))return wc(u,o),aC(e,t,u),Ef(e,t,u),u}}}const fC=S0(32,126).map(e=>String.fromCharCode(e)),dC=Pn({name:"Whitespace",pattern:/ +/}),pC=Pn({name:"WhitespaceSkipped",pattern:/ +/,group:ze.SKIPPED}),kf=Pn({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),N_=Pn({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:fC}),xf=Pn({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Tf=Pn({name:"EscapedDollar",pattern:"$$"}),Af=Pn({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),vf=Pn({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),O_=Pn({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function mC(e,t=""){return Pn({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const C_=Object.keys(Fo).map(e=>mC(`\\$(${e})`,e)),gC=[dC,kf,...C_,xf,N_,vf,Tf,O_,Af],yC=new ze(gC,{skipValidations:!vr,ensureOptimizations:vr}),_C=new ze([pC,kf,...C_,xf,N_,vf,Tf,O_,Af],{skipValidations:!vr,ensureOptimizations:vr});function Sf(e,t=!1){return t?_C.tokenize(e):yC.tokenize(e)}function Rf(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function L_(e){e.active={...e.reset}}function M_(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case Tf:s("$");break;case vf:if(t.measureonly!==!0&&i()){const u=t.x+t.y*t.width;t.char[u]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[u]=t.active.color),t.active.bg!==void 0&&(t.bg[u]=t.active.bg)}r();break;case xf:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case kf:{t.x=t.active.leftedge??0,++t.y;break}default:{const u=c.tokenType.name,l=Fo[u],h=Kx($t[l]),f=Wx($t[l]);l==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):w(h)?t.active.color=h:w(f)?t.active.bg=f:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(w(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){L_(t);const u=String.fromCharCode(t.writefullwidth).repeat(c),l=t.x+t.y*t.width;EC(l,l+u.length,t.active.color,t.active.bg,t),bC(l,u,t)}}}function U_(e,t,n){const r=Sf(e);r.tokens&&(M_(r.tokens,t),n&&L_(t),t.changed())}function F_(e,t,n){const r=Sf(e);if(!r.tokens)return;const i=Rf(t,n,$t.WHITE,$t.BLACK);return i.measureonly=!0,M_(r.tokens,i),i.x>0&&++i.y,i}function bC(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function EC(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function P_(e,t,n){if(!lo(x.element))return 0;const[r,i]=it(t,0,[q.DIR,q.MAYBE_KIND]),s=i??["bullet"],o=hC(x.book,x.board,s,{x:x.element.x,y:x.element.y});if(w(o)){w(n)&&(o.arg=n),o.party=x.elementid,o.collision=Gt.ISBULLET,o.destructible=1,o.stepx=r.x-x.element.x,o.stepy=r.y-x.element.y,o.bg=$t.ONCLEAR;const a=Bi(x.book,o),c=o.code??(a==null?void 0:a.code)??"";x1(x.book,x.board,o,c,1)}return e.yield(),0}function pl(e,t,n,r){var h,f;if(!lo(x.element)||!w(x.book)||!w(x.board)||!w(x.element))return 0;fi(x.book,x.board);const[i,s]=it(t,0,[q.DIR,q.KIND]),o=Wr(x.board,i);if((o==null?void 0:o.category)===jn.ISOBJECT&&(o!=null&&o.pushable)){const d={x:((h=x.element)==null?void 0:h.x)??0,y:((f=x.element)==null?void 0:f.y)??0},p=We(i,zi(d,i));I_(x.book,x.board,o,p)}const[a]=s,c=la(x.book,a)??yf(x.book,a),u=(c==null?void 0:c.collision)??Gt.ISWALK;if(!bf(x.book,x.board,u,i)){const d=dl(x.book,x.board,s,i,n);w(d)&&w(r)&&(d.arg=r)}return 0}const wC=ei().command("board",(e,t)=>{if(!w(x.book))return 0;const[n,r,i]=it(t,0,[q.NAME,q.MAYBE_NUMBER,q.MAYBE_NUMBER]),s=Pi(x.book,kt.BOARD,n);if(s.length){const o=Mn(...s);w(o)&&ua(x.book,x.elementfocus,o.id,{x:r??Math.round(ne*.5),y:i??Math.round(Ve*.5)})}return 0}).command("edge",(e,t)=>{var s,o;if(!w(x.book)||!w(x.board)||!w(x.element))return 0;const[n,r]=it(t,0,[q.DIR,q.NAME]),i=Pi(x.book,kt.BOARD,r);if(i.length){const a={x:((s=x.element)==null?void 0:s.x)??0,y:((o=x.element)==null?void 0:o.y)??0},c=zi(a,n),u=Mn(...i);switch(c){case yt.NORTH:x.board.exitnorth=u.id;break;case yt.SOUTH:x.board.exitsouth=u.id;break;case yt.WEST:x.board.exitwest=u.id;break;case yt.EAST:x.board.exiteast=u.id;break}}return 0}).command("shove",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;fi(x.book,x.board);const[n,r]=it(t,0,[q.DIR,q.DIR]),i=Wr(x.board,n);return ih(i)&&Wf(x.book,x.board,i,r),0}).command("duplicate",()=>(!w(x.book)||!w(x.board),0)).command("replace",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;fi(x.book,x.board);const[n,r]=it(t,0,[q.DIR,q.KIND]),i=Wr(x.board,n);return ih(i)&&di(x.book,x.board,i,x.timestamp),dl(x.book,x.board,r,n),0}).command("write",(e,t)=>{var u;if(!w(x.book)||!w(x.board))return 0;fi(x.book,x.board);const[n,r,i]=it(t,0,[q.DIR,q.COLOR,q.STRING]),{color:s,bg:o}=P0(r),a=((u=F_(i,256,1))==null?void 0:u.measuredwidth)??1,c=Rf(256,1,s??$t.WHITE,o??$t.BLACK);U_(i,c,!1);for(let l=0;l<a;++l){const h=yi(x.board,{x:n.x+l,y:n.y,char:c.char[l],color:c.color[l],bg:c.bg[l]});if(w(h)){const f=(h.x??0)+(h.y??0)*ne;Ef(x.book,x.board,h,f)}}return 0}).command("change",(e,t)=>{if(!w(x.book)||!w(x.board))return 0;fi(x.book,x.board);const[n,r]=it(t,0,[q.KIND,q.KIND]),i=hc(n)??"",s=Po(x.board,i),o=j0(s,n),a=hc(r),c=D0(r),u=$0(r);return o.forEach(l=>{if(Oi(l)===a)w(c)&&(l.color=c),w(u)&&(l.bg=u);else{if(w(l.id)&&di(x.book,x.board,l,x.timestamp))return 0;lo(l)&&dl(x.book,x.board,r,l)}}),0}).command("putwith",(e,t)=>{const[n,r]=it(t,0,[q.ANY]);return pl(e,t.slice(r),void 0,n)}).command("put",(e,t)=>pl(e,t)).command("oneof",(e,t)=>{const[n,r]=it(t,0,[q.ANY]);return w(x.board)&&Rn(x.board,n)?0:pl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=it(t,0,[q.ANY,q.ANY]);return w(x.board)&&Rn(x.board,r)?0:pl(e,t.slice(i),r,n)}).command("shootwith",(e,t)=>{const[n,r]=it(t,0,[q.ANY]);return P_(e,t.slice(r),n)}).command("shoot",P_),Di="$dkpurple",kC="$196",xC="$205";function mn(e,t){return`$${e}${t}$blue`}function B_(e,t){return`$${e}${t}$ondkblue`}function Kt(e,t){gr(e,t)}function TC(e,t){const n=kC.repeat(t);Kt(e,`${Di}${n}`)}function If(e,t){const n=xC.repeat(t);Kt(e,`${Di}${n}`)}function ds(e,t){Kt(e,`${Di} ${" ".repeat(t.length)} `),TC(e,t.length+2),Kt(e,`${Di} $white${t} `),If(e,t.length+2)}function Dr(e,t){Kt(e,`${Di} ${" ".repeat(t.length)} `),Kt(e,`${Di} $gray${t} `),If(e,t.length+2)}function Qt(e,t,n){Kt(e,`${Di} $white${t} $blue${n}`)}function ie(e,t){Kt(e,`${Di}$blue${t}`)}function D_(e){const[t,n]=e.split(":"),r=w(n);return[r?t:"self",r?n:e]}const AC=navigator.userAgent.includes("Mac")?"cmd":"ctrl";function ha(){Ed(K,gi())}const vC=ei().command("send",(e,t)=>{const[n,r]=it(t,0,[q.NAME,q.ANY]);switch(Ut(n)){case"helpmenu":ds(K,"H E L P"),Kt(K,""),Qt(K,"#help controls","zss controls and inputs"),Kt(K,"!helpcontrols;read help controls"),Kt(K,""),Qt(K,"#help text","text formatting"),Kt(K,"!helptext;read help text"),Kt(K,""),Qt(K,"#help developer","developer commands"),Kt(K,"!helpdeveloper;read help developer"),Kt(K,""),Qt(K,"#help player","player settings"),Kt(K,"!helpplayer;read help player"),Dr(K,"keyboard input"),Qt(K,"?","open console"),Qt(K,"esc","close console"),Qt(K,"tab","move console"),Qt(K,"up / down arrow keys","navigate console items"),Qt(K,"left / right arrow keys","change console items"),Qt(K,"enter","interact with console items"),Qt(K,"alt + arrow keys","skip words and console lines"),Qt(K,`${AC} + up / down arrow keys`,"input history");break;case"helpcontrols":ds(K,"zss controls and inputs"),Dr(K,"keyboard input"),Qt(K,"arrow keys","move"),Qt(K,"shift + arrow keys","shoot"),Qt(K,"enter","ok / accept"),Qt(K,"escape","cancel / close"),Qt(K,"tab","menu / action"),Dr(K,"controller input"),Qt(K,"left stick","move"),Qt(K,"right stick","aim"),Qt(K,"a","ok / accept"),Qt(K,"b","cancel / close"),Qt(K,"y","menu / action"),Qt(K,"x","shoot"),Qt(K,"triggers","shoot");break;case"helptext":ds(K,"text formatting"),Dr(K,"typography"),ie(K,"plain text"),ie(K,"$centering text"),ie(K,'"\\"@quoted strings for special chars\\""'),ie(K,"$$0-255 for ascii chars $159$176$240"),ie(K,`use color names like ${mn("red","$$red")} to change foreground color`),ie(K,`use color names like ${B_("ongreen","$$ongreen")} to change background color`),ie(K,`use clear ${B_("onclear","to change background to")} transparent`),Dr(K,"hyperlinks"),ie(K,`${mn("white",'"!hotkey"')} message shortcut;${mn("gray","Label")}`),ie(K,`${mn("white",'"!range"')} flag [labelmin] [labelmax];${mn("gray","Input Label")}`),ie(K,`${mn("white",'"!select"')} flag ...list of values;${mn("gray","Input Label")}`),ie(K,`${mn("white",'"!number"')} flag [minvalue] [maxvalue];${mn("gray","Input Label")}`),ie(K,`${mn("white",'"!text"')} flag;${mn("gray","Input Label")}`),ie(K,`${mn("white",'"!copyit"')} flag;${mn("gray","Input Label")}`),ie(K,`${mn("white",'"!openit"')} flag;${mn("gray","Input Label")}`);break;case"helpdeveloper":ds(K,"developer commands"),Qt(K,"#books","list books in memory"),Qt(K,"#pages","list pages in opened book"),Qt(K,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),Qt(K,"#trash","list books and pages from open book you can delete"),Qt(K,"#save","flush state to register"),Qt(K,"#share","creates a click to copy share url and QR code");break;case"helpplayer":ds(K,"player settings"),ie(K,"todo");break;default:{const[i,s]=D_(n);Gf(i==="self"&&x.elementisplayer?`${x.elementfocus}:${s}`:n,r);break}}return 0}).command("stat",(e,t)=>{let n;const[r,...i]=t.map(we),s=i.join(" ");switch(Ut(r)){case Bn(Et.LOADER):n=gs(jt.CONTENT,s,kt.LOADER);break;default:n=gs(jt.CONTENT,[r,...i].join(" "),kt.OBJECT);break;case Bn(Et.BOARD):n=gs(jt.CONTENT,s,kt.BOARD);break;case Bn(Et.OBJECT):n=gs(jt.CONTENT,s,kt.OBJECT);break;case Bn(Et.TERRAIN):n=gs(jt.CONTENT,s,kt.TERRAIN);break;case Bn(Et.CHARSET):n=gs(jt.CONTENT,s,kt.CHARSET);break;case Bn(Et.PALETTE):n=gs(jt.CONTENT,s,kt.PALETTE);break}return w(n)&&e.command("pageopen",n.id),0}).command("text",(e,t)=>{const n=t.map(we).join(" ");return gr(K,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=we(n),s=r.map(we).join(" ");return gr(K,`!${s};${i}`),0}).command("bookcreate",(e,t)=>{const[n]=it(t,0,[q.MAYBE_NAME]),r=E1(n);return w(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=fr(n);return w(r)?(ie(K,`opened [book] ${r.name}`),Sl(jt.MAIN,r.id),e.command("pages")):oe(K,"bookopen",`book ${n} not found`,x.elementfocus),0}).command("booktrash",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=pe(jt.MAIN),i=fr(n);return w(i)&&(r===i&&Sl(jt.MAIN,""),cL(n),ie(K,`trashed [book] ${i.name}`),ha(),e.command("pages")),0}).command("pageopen",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=$n(jt.MAIN);if(!w(r))return 0;const i=Fi(r,n);if(w(i)){const s=Je(i),o=us(i);ie(K,`opened [${o}] ${s}`),$u(Aa(r.id,[i.id]),i.code);const a=us(i);_d(K,r.id,[i.id],a,`${s} - ${r.name}`,x.elementfocus)}else oe(K,"pageopen",`page ${n} not found`,x.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=$n(jt.MAIN),i=nC(r,n);if(w(n)){const s=Je(i),o=us(i);ie(K,`trashed [${o}] ${s}`),ha(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(we).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Dr(K,"books");const e=pe(jt.MAIN);Qt(K,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=pe(jt.CONTENT);Qt(K,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),If(K,7);const n=co();return n.length?n.forEach(r=>{Kt(K,`!bookopen ${r.id};${r.name}`)}):ie(K,"no books found"),Kt(K,"!bookcreate;create a new book"),0}).command("pages",()=>{Dr(K,"pages");const e=$n(jt.MAIN);return w(e)&&(Qt(K,"main",`${e.name} $GREEN${e.id}`),e.pages.length?[...e.pages].sort((n,r)=>{const i=Pr(n),s=Pr(r);return i===s?Je(n).localeCompare(Je(r)):s-i}).forEach(n=>{const r=Je(n),i=us(n);Kt(K,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Kt(K,""),ie(K,"no pages found"),ie(K,"use @ to create a page"),ie(K,"@board name of board"),ie(K,"@object name of object"),ie(K,"@terrain name of terrain"),ie(K,"You can omit the type and it will default to object"),ie(K,"@object name of object"),ie(K,"@name of object"))),0}).command("trash",()=>{Dr(K,"$REDTRASH"),ie(K,"books");const e=co();e.length&&(e.forEach(n=>{Kt(K,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Kt(K,""));const t=pe(jt.MAIN);return w(t)&&(ie(K,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Je(n);Kt(K,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Kt(K,"")),0}).command("dev",()=>(ha(),Kb(K,x.elementfocus),0)).command("share",()=>(ha(),Wb(K,x.elementfocus),0)).command("save",()=>(ha(),0)).command("fork",()=>(rE(K,x.elementfocus),0)).command("nuke",()=>(Gb(K,x.elementfocus),0)).command("restart",()=>(nE(K,x.elementfocus),0)).command("export",()=>{ds(K,"E X P O R T"),Dr(K,"books");const e=co();return e.length&&e.forEach(t=>Kt(K,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=fr(n);return w(r)&&(ds(K,"E X P O R T"),Dr(K,"pages"),setTimeout(()=>{if(r.pages.length){const i=On(r.pages).sort((s,o)=>{const a=Pr(s),c=Pr(o);return a===c?Je(s).localeCompare(Je(o)):c-a});Kt(K,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Je(s),a=us(s);Kt(K,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=fr(n);return w(r)&&gd(K,On(r),`${r.name}.book.json`,x.elementfocus),0}).command("pageexport",(e,t)=>{const[n]=it(t,0,[q.NAME]),{target:r,path:i}=Gi(n),s=fr(r),o=Fi(s,i);return w(o)&&gd(K,On(o),`${Je(o)}.${us(o)}.json`,x.elementfocus),0}).command("gadget",()=>(tE(K,void 0,x.elementfocus),0)).command("joincode",(e,t)=>{const[n]=it(t,0,[q.MAYBE_NAME]);return Pb(K,!!n,x.elementfocus),0}).command("twitchbroadcast",(e,t)=>{const[n]=it(t,0,[q.NAME]);switch(Ut(n)){default:Ib(K,n,x.elementfocus);break;case"stop":Nb(K,x.elementfocus);break}return 0}),SC=ei().command("palette",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=w1(),i=ui(x.book,kt.PALETTE,n);return w(i)?(r.palette=i.id,Kt(K,`loaded palette ${n}`)):oe(K,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=w1(),i=ui(x.book,kt.CHARSET,n);return w(i)?(r.charset=i.id,Kt(K,`loaded charset ${n}`)):oe(K,"not-found",`unabled to find charset ${n}`),0}),Nf={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function $r(e){return ee(e)&&$_(e[0])}function $_(e){return w(jn[e])&&St(e)}function j_(e){if(St(e))return Nf[Ut(e)]}function z_(e){if($r(e))return e;if($_(e))return[e];const t=j_(e);if(w(t))return[t]}function ml(e){const t=x.words[e],n=z_(t);if($r(n))return[n,e+1];const[r,i]=cn(e),s=z_(r);return $r(s)?[s,i]:[void 0,e]}const Of={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Gt.ISSOLID,Gt.ISWALK,Gt.ISSWIM,Gt.ISBULLET,Gt.ISWALK,Gt.ISSWIM;function pi(e){return ee(e)&&Cf(e[0])}function Cf(e){return w(Gt[e])&&St(e)}function RC(e){if(St(e))return Of[Ut(e)]}function K_(e){const t=x.words[e];if(pi(t))return[t,e+1];if(Cf(t))return[[t],e+1];const[n,r]=cn(e);return pi(n)?[n,r]:Cf(n)?[[n],r]:[void 0,e]}const IC=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),W_=new Set(["party","player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),NC=["NORTH","SOUTH","WEST","EAST"];function OC(e){const t=ys(e);if(Lt(t.inputcurrent)||(t.inputcurrent=0),ee(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=hn.NONE,i=0]=n??[hn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&Fx?1:0,t.inputctrl=i&Px?1:0,t.inputshift=i&Bx?1:0,r){case hn.MOVE_UP:case hn.MOVE_DOWN:case hn.MOVE_LEFT:case hn.MOVE_RIGHT:t.inputmove=[NC[r-hn.MOVE_UP]];break;case hn.OK_BUTTON:t.inputok=1;break;case hn.CANCEL_BUTTON:t.inputcancel=1;break;case hn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==hn.NONE&&o!==r}),t}function CC(e){const t=Nf[e];if(w(t))return t;const n=Of[e];if(w(n))return n;const r=Fo[e];if(w(r))return r;const i=Hf[e];if(w(i))return i}const LC=ei({get(e,t){var o,a,c,u,l,h,f,d,p,g,k,E,T,v,N,U,L;const n=CC(t);if(w(n))return[!0,n];if(x.elementisplayer&&IC.has(t)){const O=OC(x.elementid)[t];return[w(O),O]}const r=fc(x.board,x.element,x.elementfocus),i=(r==null?void 0:r.id)??x.elementfocus;switch(t){case"isdark":return[!0,(o=x.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=x.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=x.board)==null?void 0:c.starty)??0];case"over":return[!0,((u=x.board)==null?void 0:u.over)??""];case"under":return[!0,((l=x.board)==null?void 0:l.under)??""];case"exitnorth":return[!0,((h=x.board)==null?void 0:h.exitnorth)??""];case"exitsouth":return[!0,((f=x.board)==null?void 0:f.exitsouth)??""];case"exitwest":return[!0,((d=x.board)==null?void 0:d.exitwest)??""];case"exiteast":return[!0,((p=x.board)==null?void 0:p.exiteast)??""];case"timelimit":return[!0,((g=x.board)==null?void 0:g.timelimit)??0];case"restartonzap":return[!0,((k=x.board)==null?void 0:k.restartonzap)??0];case"maxplayershots":return[!0,((E=x.board)==null?void 0:E.maxplayershots)??0];case"boardid":return[!0,((T=x.board)==null?void 0:T.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((v=x.element)==null?void 0:v.id)??""];case"thisx":return[!0,((N=x.element)==null?void 0:N.x)??-1];case"thisy":return[!0,((U=x.element)==null?void 0:U.y)??-1];default:{const O=(L=x.element)==null?void 0:L[t];if(W_.has(t))return[!0,O];break}}const s=ys(i)[t];return[w(s),s]},set(e,t,n){const r=fc(x.board,x.element,x.elementfocus),i=(r==null?void 0:r.id)??x.elementfocus;switch(t){case"isdark":w(x.board)&&(x.board.isdark=n?1:0);break;case"startx":w(x.board)&&(x.board.startx=Uo(n,0));break;case"starty":w(x.board)&&(x.board.starty=Uo(n,0));break;case"over":w(x.board)&&(x.board.over=we(n));break;case"under":w(x.board)&&(x.board.under=we(n));break;case"exitnorth":w(x.board)&&(x.board.exitnorth=we(n));break;case"exitsouth":w(x.board)&&(x.board.exitsouth=we(n));break;case"exitwest":w(x.board)&&(x.board.exitwest=we(n));break;case"exiteast":w(x.board)&&(x.board.exiteast=we(n));break;case"timelimit":w(x.board)&&(x.board.timelimit=Uo(n,0));break;case"restartonzap":w(x.board)&&(x.board.restartonzap=n?1:0);break;case"maxplayershots":w(x.board)&&(x.board.maxplayershots=Uo(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(W_.has(t))return w(x.element)&&(x.element[t]=n),[!0,n];break}}const s=ys(i);return w(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=x.element)!=null&&e.removed)&&(w((t=x.element)==null?void 0:t.stepx)||w((n=x.element)==null?void 0:n.stepy))){const s={x:((r=x.element)==null?void 0:r.x)??0,y:((i=x.element)==null?void 0:i.y)??0};Wf(x.book,x.board,x.element,{x:s.x+(x.element.stepx??0),y:s.y+(x.element.stepy??0)})===!1&&(x.element.stepx=0,x.element.stepy=0,A_(x.book,x.element,"destructible")&&di(x.book,x.board,x.element,x.timestamp))}}}).command("clear",(e,t)=>(t.forEach(n=>e.set(we(n),0)),0)).command("set",(e,t)=>{const[n,r]=it(t,0,[q.NAME,q.ANY]);return e.set(n,r),0}).command("become",(e,t)=>{var r,i;const[n]=it(t,0,[q.KIND]);if(fi(x.book,x.board),wf(x.book,x.board,x.element),di(x.book,x.board,x.element,x.timestamp)){const s={x:((r=x.element)==null?void 0:r.x)??0,y:((i=x.element)==null?void 0:i.y)??0};dl(x.book,x.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=it(t,0,[q.NUMBER]);return w(x.element)&&(x.element.char=n),0}).command("color",(e,t)=>{const[n]=it(t,0,[q.COLOR]);return w(x.element)&&w(n)&&wc(x.element,n),0}).command("go",(e,t)=>{if(w(x.element)){const[n]=it(t,0,[q.DIR]);if(Wf(x.book,x.board,x.element,n),e.yield(),x.element.x===n.x&&x.element.y===n.y)return 0}return 1}).command("walk",(e,t)=>{if(!w(x.element))return 0;const[n]=it(t,0,[q.DIR]),r=x.element.x??0,i=x.element.y??0;return x.element.stepx=n.x-r,x.element.stepy=n.y-i,0}),MC=ei().command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=it(t,0,[q.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(we(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(we(t[0])),0)).command("cycle",(e,t)=>{if(w(x.element)){const[n]=it(t,0,[q.NUMBER]);x.element.cycle=Ln(Math.round(n),1,255)}return 0}).command("die",e=>(di(x.book,x.board,x.element,x.timestamp),e.endofprogram(),0)).command("endgame",()=>(x.elementisplayer&&bd(K,x.elementid),0)).command("run",(e,t)=>{const[n]=it(t,0,[q.NAME]);return Rl(n),0}).command("runwith",(e,t)=>{const[n,r]=it(t,0,[q.ANY,q.NAME]);return e.set("arg",n),Rl(r),0}),gl={};function UC(e){var t;return(t=gl[e])==null?void 0:t.arg}function FC(e){var t;return(t=gl[e])==null?void 0:t.format}function eo(e){var t;return(t=gl[e])==null?void 0:t.content}function PC(e,t,n,r,i){const s=pe(jt.MAIN);if(!w(s))return;const o=hs(s,kt.LOADER).filter(a=>{const c=ls(a),u=c.format,l=St(u)?new RegExp(u).test(t):!1,h=c.event,f=St(h)?new RegExp(h).test(n):!1;return St(u)&&St(h)?l&&f:St(u)?l:St(h)?f:!1});for(let a=0;a<o.length;++a){const c=`${Ie()}_loader`;gl[c]={arg:e,format:t,content:r,player:i},dL(c,o[a].code)}}function G_(e,t){if(!w(e))return;const n=Ut(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const BC=(e,t)=>{const n=eo(e.id());if(!w(n))return 0;const[r,i]=it(t,0,[q.NAME]),s=Ut(r);switch(s){case"seek":{const[o]=it(t,i,[q.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=it(t,i,[q.NAME]);e.set(o,G_(n,s));break}case"text":{const[o,a]=it(t,i,[q.NAME,q.NAME]),c=G_(n,o);if(Lt(c)&&St(a)){const u=new Uint8Array(n.bytes.buffer,n.cursor,c),h=new TextDecoder("utf-8").decode(u);e.set(a,h),n.cursor+=c}break}case"palette":{const[o]=it(t,i,[q.NAME]),a=gf(x.book,kt.PALETTE,o),c=Br(a);if(w(c)){const u=Ix*sc,l=ym(new Uint8Array(n.bytes.buffer,n.cursor,u));w(l)&&(c.bits=l.bits),n.cursor+=u}break}case"charset":{const[o]=it(t,i,[q.NAME]),a=gf(x.book,kt.CHARSET,o),c=Br(a);if(w(c)){const u=cc*Rx*Vu,l=_m(new Uint8Array(n.bytes.buffer,n.cursor,u));w(l)&&(c.bits=l.bits),n.cursor+=u}break}}return 0},no=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",yl=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!yl(e[n],t[n]))return!1;return!0}if(no(e)&&no(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!yl(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},_l=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(no(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},DC=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",H_=e=>e>="0"&&e<="9"||e==="-",$C=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var Y;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(Y||(Y={}));const Y_={"(":Y.TOK_LPAREN,")":Y.TOK_RPAREN,"*":Y.TOK_STAR,",":Y.TOK_COMMA,".":Y.TOK_DOT,":":Y.TOK_COLON,"@":Y.TOK_CURRENT,$:Y.TOK_ROOT,"]":Y.TOK_RBRACKET,"{":Y.TOK_LBRACE,"}":Y.TOK_RBRACE},jC={"!":!0,"<":!0,"=":!0,">":!0},zC={"	":!0,"\n":!0,"\r":!0," ":!0};class KC{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(DC(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:Y.TOK_UNQUOTEDIDENTIFIER,value:i});else if(Y_[t[this._current]]!==void 0)n.push({start:this._current,type:Y_[t[this._current]],value:t[this._current]}),this._current+=1;else if(H_(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:Y.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:Y.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:Y.TOK_LITERAL,value:o})}else if(jC[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(zC[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:Y.TOK_AND,value:"&&"})):n.push({start:r,type:Y.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:Y.TOK_OR,value:"||"})):n.push({start:r,type:Y.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&$C(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;H_(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:Y.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:Y.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:Y.TOK_FLATTEN,value:"[]"}):{start:n,type:Y.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_NE,value:"!="}):{start:n,type:Y.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_LTE,value:"<="}):{start:n,type:Y.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:Y.TOK_GTE,value:">="}):{start:n,type:Y.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:Y.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const WC=new KC,an={[Y.TOK_EOF]:0,[Y.TOK_UNQUOTEDIDENTIFIER]:0,[Y.TOK_QUOTEDIDENTIFIER]:0,[Y.TOK_RBRACKET]:0,[Y.TOK_RPAREN]:0,[Y.TOK_COMMA]:0,[Y.TOK_RBRACE]:0,[Y.TOK_NUMBER]:0,[Y.TOK_CURRENT]:0,[Y.TOK_EXPREF]:0,[Y.TOK_ROOT]:0,[Y.TOK_PIPE]:1,[Y.TOK_OR]:2,[Y.TOK_AND]:3,[Y.TOK_EQ]:5,[Y.TOK_GT]:5,[Y.TOK_LT]:5,[Y.TOK_GTE]:5,[Y.TOK_LTE]:5,[Y.TOK_NE]:5,[Y.TOK_FLATTEN]:9,[Y.TOK_STAR]:20,[Y.TOK_FILTER]:21,[Y.TOK_DOT]:40,[Y.TOK_NOT]:45,[Y.TOK_LBRACE]:50,[Y.TOK_LBRACKET]:55,[Y.TOK_LPAREN]:60};class GC{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==Y.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...WC.tokenize(t),{type:Y.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<an[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case Y.TOK_LITERAL:return{type:"Literal",value:t.value};case Y.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case Y.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===Y.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Y.TOK_NOT:return r=this.expression(an.Not),{type:"NotExpression",children:[r]};case Y.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===Y.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(an.Star),{type:"ValueProjection",children:[n,r]};case Y.TOK_FILTER:return this.led(t.type,{type:"Identity"});case Y.TOK_LBRACE:return this.parseMultiselectHash();case Y.TOK_FLATTEN:return n={type:Y.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(an.Flatten),{type:"Projection",children:[n,r]};case Y.TOK_LBRACKET:return this.lookahead(0)===Y.TOK_NUMBER||this.lookahead(0)===Y.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Y.TOK_STAR&&this.lookahead(1)===Y.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(an.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Y.TOK_CURRENT:return{type:Y.TOK_CURRENT};case Y.TOK_ROOT:return{type:Y.TOK_ROOT};case Y.TOK_EXPREF:return i=this.expression(an.Expref),{type:"ExpressionReference",children:[i]};case Y.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Y.TOK_RPAREN;)this.lookahead(0)===Y.TOK_CURRENT?(i={type:Y.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Y.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case Y.TOK_DOT:const i=an.Dot;return this.lookahead(0)!==Y.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case Y.TOK_PIPE:return r=this.expression(an.Pipe),{type:Y.TOK_PIPE,children:[n,r]};case Y.TOK_OR:return r=this.expression(an.Or),{type:"OrExpression",children:[n,r]};case Y.TOK_AND:return r=this.expression(an.And),{type:"AndExpression",children:[n,r]};case Y.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==Y.TOK_RPAREN;)this.lookahead(0)===Y.TOK_CURRENT?(a={type:Y.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Y.TOK_COMMA&&this.match(Y.TOK_COMMA),o.push(a);return this.match(Y.TOK_RPAREN),{name:s,type:"Function",children:o};case Y.TOK_FILTER:const u=this.expression(0);return this.match(Y.TOK_RBRACKET),r=this.lookahead(0)===Y.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(an.Filter),{type:"FilterProjection",children:[n,r,u]};case Y.TOK_FLATTEN:const l={type:Y.TOK_FLATTEN,children:[n]},h=this.parseProjectionRHS(an.Flatten);return{type:"Projection",children:[l,h]};case Y.TOK_EQ:case Y.TOK_NE:case Y.TOK_GT:case Y.TOK_GTE:case Y.TOK_LT:case Y.TOK_LTE:return this.parseComparator(n,t);case Y.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===Y.TOK_NUMBER||f.type===Y.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(Y.TOK_STAR),this.match(Y.TOK_RBRACKET),r=this.parseProjectionRHS(an.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Y.TOK_COLON||this.lookahead(1)===Y.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Y.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(an.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==Y.TOK_RBRACKET&&n<3;){if(r===Y.TOK_COLON)n+=1,this.advance();else if(r===Y.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Y.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(an[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([Y.TOK_UNQUOTEDIDENTIFIER,Y.TOK_QUOTEDIDENTIFIER,Y.TOK_STAR].includes(n))return this.expression(t);if(n===Y.TOK_LBRACKET)return this.match(Y.TOK_LBRACKET),this.parseMultiselectList();if(n===Y.TOK_LBRACE)return this.match(Y.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(an[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Y.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===Y.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===Y.TOK_DOT)return this.match(Y.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==Y.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===Y.TOK_COMMA&&(this.match(Y.TOK_COMMA),this.lookahead(0)===Y.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Y.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[Y.TOK_UNQUOTEDIDENTIFIER,Y.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Y.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Y.TOK_COMMA)this.match(Y.TOK_COMMA);else if(this.lookahead(0)===Y.TOK_RBRACE){this.match(Y.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const HC=new GC;var ct;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(ct||(ct={}));class YC{constructor(t){this.TYPE_NAME_TABLE={[ct.TYPE_NUMBER]:"number",[ct.TYPE_ANY]:"any",[ct.TYPE_STRING]:"string",[ct.TYPE_ARRAY]:"array",[ct.TYPE_OBJECT]:"object",[ct.TYPE_BOOLEAN]:"boolean",[ct.TYPE_EXPREF]:"expression",[ct.TYPE_NULL]:"null",[ct.TYPE_ARRAY_NUMBER]:"Array<number>",[ct.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>no(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ct.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ct.TYPE_NUMBER,ct.TYPE_STRING]);let o=-1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c>o&&(o=c,a=i[u]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===ct.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[ct.TYPE_NUMBER,ct.TYPE_STRING]);let o=1/0,a,c;for(let u=0;u<i.length;u+=1)c=s&&s(i[u]),c!==void 0&&c<o&&(o=c,a=i[u]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==ct.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===ct.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![ct.TYPE_NUMBER,ct.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,u)=>{const l=i.visit(s,c[1]),h=i.visit(s,u[1]);if(this.getTypeName(l)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(l)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return l>h?1:l<h?-1:c[0]-u[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===ct.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===ct.TYPE_NUMBER?n:r===ct.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===ct.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case ct.TYPE_NUMBER:return"number";case ct.TYPE_STRING:return"string";case ct.TYPE_ARRAY:return"array";case ct.TYPE_OBJECT:return"object";case ct.TYPE_BOOLEAN:return"boolean";case ct.TYPE_EXPREF:return"expref";case ct.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[ct.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[ct.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[ct.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY]},{types:[ct.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[ct.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[ct.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY,ct.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[ct.TYPE_EXPREF]},{types:[ct.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[ct.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[ct.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[ct.TYPE_STRING,ct.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[ct.TYPE_ARRAY_STRING,ct.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[ct.TYPE_ARRAY]},{types:[ct.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[ct.TYPE_STRING]},{types:[ct.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[ct.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[ct.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[ct.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[ct.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[ct.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[ct.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(g=>{var k;return(k=!g.optional)!==null&&k!==void 0?k:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,u=n.length<a,l=n.length>r.length,h=u&&(!c&&a>1||c)?"at least ":"";if(c&&u||!c&&(u||l))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${h}${a} argument${o&&"s"||""} but received ${n.length}`);let f,d,p;for(let g=0;g<r.length;g+=1){p=!1,f=r[g].types,d=this.getTypeName(n[g]);let k;for(k=0;k<f.length;k+=1)if(d!==void 0&&this.typeMatches(d,f[k],n[g])){p=!0;break}if(!p&&d!==void 0){const E=f.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${g+1} to be type (${E}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(t,n,r){if(n===ct.TYPE_ANY)return!0;if(n===ct.TYPE_ARRAY_STRING||n===ct.TYPE_ARRAY_NUMBER||n===ct.TYPE_ARRAY){if(n===ct.TYPE_ARRAY)return t===ct.TYPE_ARRAY;if(t===ct.TYPE_ARRAY){let i;n===ct.TYPE_ARRAY_NUMBER?i=ct.TYPE_NUMBER:n===ct.TYPE_ARRAY_STRING&&(i=ct.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return ct.TYPE_STRING;case"[object Number]":return ct.TYPE_NUMBER;case"[object Array]":return ct.TYPE_ARRAY;case"[object Boolean]":return ct.TYPE_BOOLEAN;case"[object Null]":return ct.TYPE_NULL;case"[object Object]":return t.jmespathType===Y.TOK_EXPREF?ct.TYPE_EXPREF:ct.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class VC{constructor(){this._rootValue=null,this.runtime=new YC(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,u,l,h,f,d;switch(t.type){case"Field":return n===null?null:no(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),f=1;f<t.children.length;f+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return u=this.visit(t.children[0],n),l=this.visit(t.children[1],u),l;case"Index":if(!Array.isArray(n))return null;let p=t.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const g=[...t.children],k=this.computeSliceParams(n.length,g),[E,T,v]=k;if(s=[],v>0)for(f=E;f<T;f+=v)s.push(n[f]);else for(f=E;f>T;f+=v)s.push(n[f]);return s;case"Projection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(t.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(t.children[0],n),!no(d))return null;h=[];const N=Object.values(d);for(f=0;f<N.length;f+=1)i=this.visit(t.children[1],N[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(t.children[0],n),!Array.isArray(d))return null;const U=[],L=[];for(f=0;f<d.length;f+=1)r=this.visit(t.children[2],d[f]),_l(r)||U.push(d[f]);for(let M=0;M<U.length;M+=1)i=this.visit(t.children[1],U[M]),i!==null&&L.push(i);return L;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case Y.TOK_EQ:s=yl(o,a);break;case Y.TOK_NE:s=!yl(o,a);break;case Y.TOK_GT:s=o>a;break;case Y.TOK_GTE:s=o>=a;break;case Y.TOK_LT:s=o<a;break;case Y.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case Y.TOK_FLATTEN:const O=this.visit(t.children[0],n);if(!Array.isArray(O))return null;let B=[];for(f=0;f<O.length;f+=1)i=O[f],Array.isArray(i)?B=[...B,...i]:B.push(i);return B;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(h=[],f=0;f<t.children.length;f+=1)h.push(this.visit(t.children[f],n));return h;case"MultiSelectHash":if(n===null)return null;h={};let F;for(f=0;f<t.children.length;f+=1)F=t.children[f],h[F.name]=this.visit(F.value,n);return h;case"OrExpression":return r=this.visit(t.children[0],n),_l(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),_l(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),_l(o);case"Literal":return t.value;case Y.TOK_PIPE:return u=this.visit(t.children[0],n),this.visit(t.children[1],u);case Y.TOK_CURRENT:return n;case Y.TOK_ROOT:return this._rootValue;case"Function":const nt=[];for(let M=0;M<t.children.length;M+=1)nt.push(this.visit(t.children[M],n));return this.runtime.callFunction(t.name,nt);case"ExpressionReference":const dt=t.children[0];return dt.jmespathType=Y.TOK_EXPREF,dt;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const qC=new VC;ct.TYPE_ANY,ct.TYPE_ARRAY,ct.TYPE_ARRAY_NUMBER,ct.TYPE_ARRAY_STRING,ct.TYPE_BOOLEAN,ct.TYPE_EXPREF,ct.TYPE_NULL,ct.TYPE_NUMBER,ct.TYPE_OBJECT,ct.TYPE_STRING;function XC(e,t){const n=HC.parse(t);return qC.search(n,e)}const JC=(e,t)=>{const n=eo(e.id());if(!w(n))return 0;const[r,i]=it(t,0,[q.NAME,q.NAME]),s=XC(n.json,r);return e.set(i,s),0},ZC=(e,t)=>{const n=eo(e.id());if(!w(n))return 0;const[r,i]=it(t,0,[q.NAME]);switch(Ut(r)){case"seek":{const[o]=it(t,i,[q.NUMBER]);n.cursor=Ln(o,0,n.lines.length-1);break}case"line":n.cursor=Ln(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let u=1;for(let l=i;l<t.length;){const[h,f]=it(t,l,[q.NAME]);e.set(h,c[u]??0),++u,l=f}break}}return 0},QC=ei({get(e,t){const n=FC(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=eo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(e,t)=>{const[n,r]=it(t,0,[q.NAME,q.ANY]);return Gf(n,r),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(we).join(" ");return gr(K,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=we(n),s=r.map(we).join(" ");return gr(K,"$175",`!${s};${i}`),0}).command("txt",ZC).command("json",JC).command("bin",BC).command("with",(e,t)=>{const[n]=it(t,0,[q.NAME]),r=Pi(x.book,kt.BOARD,n);if(r.length){const i=Mn(...r);w(i)&&(x.board=Br(i),x.element={x:Ri(0,ne-1),y:Ri(0,Ve-1)})}return 0});function V_(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,u]=it(i,a,[q.ANY]);ee(c)&&!pr(c)&&!$r(c)&&!pi(c)&&!Un(c)?o.push(...c):o.push(c),a=u}switch(Ut(r)){case"get":case"post:json":Fb(K,e,t,n,r,o,x.elementfocus);break}return 0}const t4=ei().command("fetch",(e,t)=>{const[n,r,i="get",s]=it(t,0,[q.NAME,q.NAME,q.MAYBE_STRING]);return V_(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=it(t,0,[q.ANY,q.NAME,q.NAME,q.MAYBE_STRING]);return V_(n,r,i,s,t,o),0}).command("twitchchat",(e,t)=>{const[n]=it(t,0,[q.ANY]);switch(Ut(n)){default:Ob(K,n,x.elementfocus);break;case"close":Cb(K,x.elementfocus);break}return 0}),e4=ei({set(e,t,n){return CL(e,t,n),[!1,void 0]},everytick(){const e=Gr(x.elementid),[t]=e;if(e.length===1&&St(t)){if(w(x.element))if(t.trim().length===0){const n=yn(x.elementid);n.sidebar=[]}else x.element.tickertext=t,x.element.tickertime=x.timestamp}else if(e.length>1)if(x.elementisplayer){const n=yn(x.elementid);n.sidebar=e}else{const n=yn(x.elementfocus);n.scroll=e}}}).command("send",(e,t)=>{var c,u;const[n,r]=it(t,0,[q.NAME,q.ANY]),[i,s]=D_(n);function o(l){for(let h=0;h<l.length;++h){const f=l[h];w(f.id)&&e.send(f.id,s,r)}}switch(Ut(i)){case"all":for(const l of Object.keys(((c=x.board)==null?void 0:c.objects)??{}))e.send(l,s,r);break;case"self":e.message({session:K.session(),id:Ie(),sender:e.id(),target:s,data:r});break;case"others":for(const l of Object.keys(((u=x.board)==null?void 0:u.objects)??{}))l!==e.id()&&e.send(l,s,r);break;default:{o(z0(x.board,[i]));break}}return 0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(we).join("");return ae(x.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=we(n);return te(x.elementid,e.id(),i,r,e.get,e.set),0});var $i=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))($i||{});const n4={audio:zx,board:wC,cli:vC,display:SC,element:LC,runtime:e4,lifecycle:MC,loader:QC,network:t4},Lf=["audio","board","display","network","lifecycle","element"],r4={0:[],1:["cli",...Lf],2:["loader",...Lf],3:["runtime",...Lf]},i4={0:new Map,1:new Map,2:new Map,3:new Map};function ro(e){return(r4[e]??[]).map(n=>n4[n]).filter(w)}function Mf(e){const t=[],n=ro(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function s4(e,t){const n=i4[e];if(!n.has(t)){let r;const i=ro(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!w(r));++s);n.set(t,r)}return n.get(t)}function o4(e,t,n){const r=ro(e);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(t,n);if(s)return[s,o]}return[!1,void 0]}function a4(e,t,n,r){const i=ro(e);for(let s=0;s<i.length;++s){const[o]=i[s].set(t,n,r);if(o)return[o,r]}return[!1,void 0]}function c4(e,t){const n=ro(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function q_(e,t){const n=ro(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var X_={},J_={},Z_={};const Q_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Z_.encode=function(e){if(0<=e&&e<Q_.length)return Q_[e];throw new TypeError("Must be between 0 and 63: "+e)};const l4=Z_,t1=5,e1=1<<t1,u4=e1-1,h4=e1;function f4(e){return e<0?(-e<<1)+1:(e<<1)+0}J_.encode=function(t){let n="",r,i=f4(t);do r=i&u4,i>>>=t1,i>0&&(r|=h4),n+=l4.encode(r);while(i>0);return n};var fa={};(function(e){function t(L,O,B){if(O in L)return L[O];if(arguments.length===3)return B;throw new Error('"'+O+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(L){const O=L.match(n);return O?{scheme:O[1],auth:O[2],host:O[3],port:O[4],path:O[5]}:null}e.urlParse=i;function s(L){let O="";return L.scheme&&(O+=L.scheme+":"),O+="//",L.auth&&(O+=L.auth+"@"),L.host&&(O+=L.host),L.port&&(O+=":"+L.port),L.path&&(O+=L.path),O}e.urlGenerate=s;const o=32;function a(L){const O=[];return function(B){for(let nt=0;nt<O.length;nt++)if(O[nt].input===B){const dt=O[0];return O[0]=O[nt],O[nt]=dt,O[0].result}const F=L(B);return O.unshift({input:B,result:F}),O.length>o&&O.pop(),F}}const c=a(function(O){let B=O;const F=i(O);if(F){if(!F.path)return O;B=F.path}const nt=e.isAbsolute(B),dt=[];let M=0,R=0;for(;;)if(M=R,R=B.indexOf("/",M),R===-1){dt.push(B.slice(M));break}else for(dt.push(B.slice(M,R));R<B.length&&B[R]==="/";)R++;let _=0;for(R=dt.length-1;R>=0;R--){const P=dt[R];P==="."?dt.splice(R,1):P===".."?_++:_>0&&(P===""?(dt.splice(R+1,_),_=0):(dt.splice(R,2),_--))}return B=dt.join("/"),B===""&&(B=nt?"/":"."),F?(F.path=B,s(F)):B});e.normalize=c;function u(L,O){L===""&&(L="."),O===""&&(O=".");const B=i(O),F=i(L);if(F&&(L=F.path||"/"),B&&!B.scheme)return F&&(B.scheme=F.scheme),s(B);if(B||O.match(r))return O;if(F&&!F.host&&!F.path)return F.host=O,s(F);const nt=O.charAt(0)==="/"?O:c(L.replace(/\/+$/,"")+"/"+O);return F?(F.path=nt,s(F)):nt}e.join=u,e.isAbsolute=function(L){return L.charAt(0)==="/"||n.test(L)};function l(L,O){L===""&&(L="."),L=L.replace(/\/$/,"");let B=0;for(;O.indexOf(L+"/")!==0;){const F=L.lastIndexOf("/");if(F<0||(L=L.slice(0,F),L.match(/^([^\/]+:\/)?\/*$/)))return O;++B}return Array(B+1).join("../")+O.substr(L.length+1)}e.relative=l;const h=function(){return!("__proto__"in Object.create(null))}();function f(L){return L}function d(L){return g(L)?"$"+L:L}e.toSetString=h?f:d;function p(L){return g(L)?L.slice(1):L}e.fromSetString=h?f:p;function g(L){if(!L)return!1;const O=L.length;if(O<9||L.charCodeAt(O-1)!==95||L.charCodeAt(O-2)!==95||L.charCodeAt(O-3)!==111||L.charCodeAt(O-4)!==116||L.charCodeAt(O-5)!==111||L.charCodeAt(O-6)!==114||L.charCodeAt(O-7)!==112||L.charCodeAt(O-8)!==95||L.charCodeAt(O-9)!==95)return!1;for(let B=O-10;B>=0;B--)if(L.charCodeAt(B)!==36)return!1;return!0}function k(L,O,B){let F=T(L.source,O.source);return F!==0||(F=L.originalLine-O.originalLine,F!==0)||(F=L.originalColumn-O.originalColumn,F!==0||B)||(F=L.generatedColumn-O.generatedColumn,F!==0)||(F=L.generatedLine-O.generatedLine,F!==0)?F:T(L.name,O.name)}e.compareByOriginalPositions=k;function E(L,O,B){let F=L.generatedLine-O.generatedLine;return F!==0||(F=L.generatedColumn-O.generatedColumn,F!==0||B)||(F=T(L.source,O.source),F!==0)||(F=L.originalLine-O.originalLine,F!==0)||(F=L.originalColumn-O.originalColumn,F!==0)?F:T(L.name,O.name)}e.compareByGeneratedPositionsDeflated=E;function T(L,O){return L===O?0:L===null?1:O===null?-1:L>O?1:-1}function v(L,O){let B=L.generatedLine-O.generatedLine;return B!==0||(B=L.generatedColumn-O.generatedColumn,B!==0)||(B=T(L.source,O.source),B!==0)||(B=L.originalLine-O.originalLine,B!==0)||(B=L.originalColumn-O.originalColumn,B!==0)?B:T(L.name,O.name)}e.compareByGeneratedPositionsInflated=v;function N(L){return JSON.parse(L.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=N;function U(L,O,B){if(O=O||"",L&&(L[L.length-1]!=="/"&&O[0]!=="/"&&(L+="/"),O=L+O),B){const F=i(B);if(!F)throw new Error("sourceMapURL could not be parsed");if(F.path){const nt=F.path.lastIndexOf("/");nt>=0&&(F.path=F.path.substring(0,nt+1))}O=u(s(F),O)}return c(O)}e.computeSourceURL=U})(fa);var Uf={};let d4=class W1{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new W1;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Uf.ArraySet=d4;var n1={};const r1=fa;function p4(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||r1.compareByGeneratedPositionsInflated(e,t)<=0}let m4=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){p4(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(r1.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};n1.MappingList=m4;const da=J_,Ue=fa,bl=Uf.ArraySet,g4=n1.MappingList;let i1=class G1{constructor(t){t||(t={}),this._file=Ue.getArg(t,"file",null),this._sourceRoot=Ue.getArg(t,"sourceRoot",null),this._skipValidation=Ue.getArg(t,"skipValidation",!1),this._sources=new bl,this._names=new bl,this._mappings=new g4,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new G1({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=Ue.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=Ue.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=Ue.getArg(t,"generated"),r=Ue.getArg(t,"original",null);let i=Ue.getArg(t,"source",null),s=Ue.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=Ue.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[Ue.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[Ue.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=Ue.relative(s,i));const o=this._mappings.toArray().length>0?new bl:this._sources,a=new bl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=Ue.join(r,c.source)),s!=null&&(c.source=Ue.relative(s,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const u=c.source;u!=null&&!o.has(u)&&o.add(u);const l=c.name;l!=null&&!a.has(l)&&a.add(l)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const u=t.sourceContentFor(c);u!=null&&(r!=null&&(c=Ue.join(r,c)),s!=null&&(c=Ue.relative(s,c)),this.setSourceContent(c,u))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,u,l,h;const f=this._mappings.toArray();for(let d=0,p=f.length;d<p;d++){if(u=f[d],c="",u.generatedLine!==n)for(t=0;u.generatedLine!==n;)c+=";",n++;else if(d>0){if(!Ue.compareByGeneratedPositionsInflated(u,f[d-1]))continue;c+=","}c+=da.encode(u.generatedColumn-t),t=u.generatedColumn,u.source!=null&&(h=this._sources.indexOf(u.source),c+=da.encode(h-o),o=h,c+=da.encode(u.originalLine-1-i),i=u.originalLine-1,c+=da.encode(u.originalColumn-r),r=u.originalColumn,u.name!=null&&(l=this._names.indexOf(u.name),c+=da.encode(l-s),s=l)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=Ue.relative(n,r));const i=Ue.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};i1.prototype._version=3,X_.SourceMapGenerator=i1;var s1={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,u=o(i,s[c],!0);return u===0?c:u>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(s1);var pa={exports:{}},y4={},_4=Object.freeze({__proto__:null,default:y4}),o1=H1(_4);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;pa.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},pa.exports.initialize=t=>e=t}else{const e=o1,t=o1;pa.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},pa.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var a1=pa.exports;const b4=a1;function E4(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let ma=null;var w4=function(){if(ma)return ma;const t=[];return ma=b4().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,u,l,h,f){const d=new E4;d.generatedLine=r+1,d.generatedColumn=i,s&&(d.lastGeneratedColumn=o-1),a&&(d.source=c,d.originalLine=u+1,d.originalColumn=l,h&&(d.name=f)),t[t.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw ma=null,n}),ma};const Tt=fa,Ff=s1,El=Uf.ArraySet,k4=a1,x4=w4,Pf=Symbol("smcInternal");class Le{constructor(t,n){return t==Pf?Promise.resolve(this):A4(t,n)}static initialize(t){k4.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return v4(t,n)}static async with(t,n,r){const i=await new Le(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Le.prototype._version=3,Le.GENERATED_ORDER=1,Le.ORIGINAL_ORDER=2,Le.GREATEST_LOWER_BOUND=1,Le.LEAST_UPPER_BOUND=2;class ga extends Le{constructor(t,n){return super(Pf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version");let o=Tt.getArg(i,"sources");const a=Tt.getArg(i,"names",[]);let c=Tt.getArg(i,"sourceRoot",null);const u=Tt.getArg(i,"sourcesContent",null),l=Tt.getArg(i,"mappings"),h=Tt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Tt.normalize(c)),o=o.map(String).map(Tt.normalize).map(function(f){return c&&Tt.isAbsolute(c)&&Tt.isAbsolute(f)?Tt.relative(c,f):f}),r._names=El.fromArray(a.map(String),!0),r._sources=El.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(f){return Tt.computeSourceURL(c,f,n)}),r.sourceRoot=c,r.sourcesContent=u,r._mappings=l,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,x4().then(f=>(r._wasm=f,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Tt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new ga(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||Le.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Tt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case Le.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Le.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Tt.getArg(t,"source");const r=Tt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Tt.getArg(t,"bias",Le.GREATEST_LOWER_BOUND);r==null&&(r=Le.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Tt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Tt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Tt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Tt.getArg(i,"originalLine",null),column:Tt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Tt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Tt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Tt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Tt.getArg(t,"line"),originalColumn:Tt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Tt.getArg(t,"bias",Le.GREATEST_LOWER_BOUND);i==null&&(i=Le.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Tt.getArg(s,"generatedLine",null),column:Tt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}ga.prototype.consumer=Le;class T4 extends Le{constructor(t,n){return super(Pf).then(r=>{let i=t;typeof t=="string"&&(i=Tt.parseSourceMapInput(t));const s=Tt.getArg(i,"version"),o=Tt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new El,r._names=new El,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const u=Tt.getArg(c,"offset"),l=Tt.getArg(u,"line"),h=Tt.getArg(u,"column");if(l<a.line||l===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=u,new Le(Tt.getArg(c,"map"),n).then(d=>({generatedOffset:{generatedLine:l+1,generatedColumn:h+1},consumer:d}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Tt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Tt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Tt.getArg(t,"line"),generatedColumn:Tt.getArg(t,"column")},r=Ff.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Tt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const u=a[c];let l=Tt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(l),l=this._sources.indexOf(l);let h=null;u.name&&(this._names.add(u.name),h=this._names.indexOf(u.name));const f={source:l,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:h};r.push(f),typeof f.originalLine=="number"&&i.push(f)}}}eachMapping(t,n,r){const i=n||null,s=r||Le.GENERATED_ORDER;let o;switch(s){case Le.GENERATED_ORDER:o=this._generatedMappings;break;case Le.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let u=null;return c.source!==null&&(u=this._sources.at(c.source),u=Tt.computeSourceURL(a,u,this._sourceMapURL)),{source:u,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return Ff.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Tt.getArg(t,"line"),r={source:Tt.getArg(t,"source"),originalLine:n,originalColumn:Tt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Tt.compareByOriginalPositions,Ff.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Tt.getArg(o,"generatedLine",null),column:Tt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function A4(e,t){let n=e;typeof e=="string"&&(n=Tt.parseSourceMapInput(e));const r=n.sections!=null?new T4(n,t):new ga(n,t);return Promise.resolve(r)}function v4(e,t){return ga.fromSourceMap(e,t)}var c1={};const S4=X_.SourceMapGenerator,wl=fa,R4=/(\r?\n)/,I4=10,io="$$$isSourceNode$$$";let N4=class rd{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[io]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new rd,s=t.split(R4);let o=0;const a=function(){const d=g(),p=g()||"";return d+p;function g(){return o<s.length?s[o++]:void 0}};let c=1,u=0,l=null,h;return n.eachMapping(function(d){if(l!==null)if(c<d.generatedLine)f(l,a()),c++,u=0;else{h=s[o]||"";const p=h.substr(0,d.generatedColumn-u);s[o]=h.substr(d.generatedColumn-u),u=d.generatedColumn,f(l,p),l=d;return}for(;c<d.generatedLine;)i.add(a()),c++;u<d.generatedColumn&&(h=s[o]||"",i.add(h.substr(0,d.generatedColumn)),s[o]=h.substr(d.generatedColumn),u=d.generatedColumn),l=d},this),o<s.length&&(l&&f(l,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(d){const p=n.sourceContentFor(d);p!=null&&(r!=null&&(d=wl.join(r,d)),i.setSourceContent(d,p))}),i;function f(d,p){if(d===null||d.source===void 0)i.add(p);else{const g=r?wl.join(r,d.source):d.source;i.add(new rd(d.originalLine,d.originalColumn,g,p,d.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[io]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[io]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[io]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[io]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[wl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][io]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(wl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new S4(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(u,l){n.code+=u,l.source!==null&&l.line!==null&&l.column!==null?((s!==l.source||o!==l.line||a!==l.column||c!==l.name)&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name}),s=l.source,o=l.line,a=l.column,c=l.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let h=0,f=u.length;h<f;h++)u.charCodeAt(h)===I4?(n.line++,n.column=0,h+1===f?(s=null,i=!1):i&&r.addMapping({source:l.source,original:{line:l.line,column:l.column},generated:{line:n.line,column:n.column},name:l.name})):n.column++}),this.walkSourceContents(function(u,l){r.setSourceContent(u,l)}),{code:n.code,map:r}}};c1.SourceNode=N4;var O4=c1.SourceNode;let l1=0;const u1=vr,C4=["Command","lines"];class L4 extends NO{constructor(){super(g_,{traceInitPerf:vr,skipValidations:!vr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Ot(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Ot(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(aa)}])}));Ot(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Ot(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Ot(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Ot(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Wy)}));Ot(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(ef)}));Ot(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(zy)}])}));Ot(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Ky)}));Ot(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Gy),this.SUBRULE(this.words),this.CONSUME(Hy)}));Ot(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Qs),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Ot(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Ot(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Ot(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Ot(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(cf),this.SUBRULE(this.words)}));Ot(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(s_),this.SUBRULE(this.words)}));Ot(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(lf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Ot(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ul),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(aa)),this.CONSUME4(Qs),this.CONSUME4(uf)}}])}));Ot(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ul),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Qs),this.CONSUME(uf)}}])}));Ot(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(ul),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Ot(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Qs),this.CONSUME(hf),this.CONSUME(lf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Qs),this.CONSUME(hf),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Ot(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(l_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(u_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(h_),this.SUBRULE(this.words)}));Ot(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(f_),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Ot(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(d_)}));Ot(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(p_)}));Ot(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(c_)}));Ot(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(nf),this.SUBRULE2(this.and_test)})}));Ot(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(sf),this.SUBRULE2(this.not_test)})}));Ot(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(rf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Ot(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Ot(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(qy)},{ALT:()=>this.CONSUME(Xy)},{ALT:()=>this.CONSUME(Jy)},{ALT:()=>this.CONSUME(Zy)},{ALT:()=>this.CONSUME(Qy)},{ALT:()=>this.CONSUME(t_)}])}));Ot(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(nf),this.SUBRULE2(this.and_test_value)})}));Ot(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(sf),this.SUBRULE2(this.not_test_value)})}));Ot(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(rf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Ot(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Ot(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(of)},{ALT:()=>this.CONSUME(af)}]),this.SUBRULE(this.term)}));Ot(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Ot(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(n_)},{ALT:()=>this.CONSUME(cf)},{ALT:()=>this.CONSUME(r_)},{ALT:()=>this.CONSUME(i_)}]),this.SUBRULE(this.factor)}));Ot(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(of)},{ALT:()=>this.CONSUME(af)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Ot(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(e_),this.SUBRULE(this.factor)})}));Ot(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Ot(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Yy)},{ALT:()=>this.CONSUME(on)},{ALT:()=>this.CONSUME(Vy)},{ALT:()=>{this.CONSUME(o_),this.SUBRULE(this.expr),this.CONSUME(a_)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=C4.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(l1++).toString().padStart(3),c=s?"font-weight: bold;":"";if(u1&&!this.RECORDING_PHASE){const u=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${u.join(" ")}`,c)}r(),u1&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),l1--},i)}}const so=new L4;if(Dx){const e=so.getGAstProductions(),t=zO(e);console.info(t)}const M4=so.getBaseCstVisitorConstructor();var gt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(gt||{}),ps=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(ps||{}),jr=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(jr||{}),kl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(kl||{});function U4(e){return!!(e!=null&&e.tokenType)}function hr(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class F4 extends M4{constructor(){super();Ot(this,"unique",0);vr&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&U4(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():w(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:hr(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:hr(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:hr(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:hr(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:hr(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,hr(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Ie(),i=Ie();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Ie(),i=Ie();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,hr(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Ie(),i=Ie();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Ie(),i=Ie(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Ie(),i=Ie(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Ie();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=hr(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=hr(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=hr(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(hr(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const P4=new F4,Sn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},xl="zss.js";function Xt(e,t){return new O4(e.startLine??1,e.startColumn??1,xl,t)}function Bf(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Df(e){return`'${Bf(e)}'`}function Tl(e){if(e.startsWith('"'))return Tl(e.replaceAll(/(^"|"$)/g,""));const t=Sf(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===Af?`', api.get('${Bf(r.image.substring(1))}'), '`:Bf(r.image)).join("")}'].join('')`}function oo(e){return e.filter(t=>t!==void 0).map(re)}function h1(e){return Xt(e,"")}function B4(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function Ke(e,t,n){return Xt(e,[`api.${t}(`,...B4(n,", "),")"])}function D4(e){if(e.type===gt.COMPARE&&e.compare.type===gt.COMPARE_ITEM)switch(e.compare.method){case ps.IS_EQ:return Ke(e,"isEq",[re(e.lhs),re(e.rhs)]);case ps.IS_NOT_EQ:return Ke(e,"isNotEq",[re(e.lhs),re(e.rhs)]);case ps.IS_LESS_THAN:return Ke(e,"isLessThan",[re(e.lhs),re(e.rhs)]);case ps.IS_GREATER_THAN:return Ke(e,"isGreaterThan",[re(e.lhs),re(e.rhs)]);case ps.IS_LESS_THAN_OR_EQ:return Ke(e,"isLessThanOrEq",[re(e.lhs),re(e.rhs)]);case ps.IS_GREATER_THAN_OR_EQ:return Ke(e,"isGreaterThanOrEq",[re(e.lhs),re(e.rhs)])}return Xt(e,"")}function ms(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",re(n),")"])}function f1(e,t,n){return e.prepend(`api.${t}(`),e.add([re(n),")"])}function $4(e,t){if(e.type===gt.OPERATOR_ITEM)switch(e.operator){case jr.PLUS:return ms(t,"opPlus",e.rhs);case jr.MINUS:return ms(t,"opMinus",e.rhs);case jr.POWER:return ms(t,"opPower",e.rhs);case jr.MULTIPLY:return ms(t,"opMultiply",e.rhs);case jr.DIVIDE:return ms(t,"opDivide",e.rhs);case jr.MOD_DIVIDE:return ms(t,"opModDivide",e.rhs);case jr.FLOOR_DIVIDE:return ms(t,"opFloorDivide",e.rhs);case jr.UNI_PLUS:return f1(t,"opUniPlus",e.rhs);case jr.UNI_MINUS:return f1(t,"opUniMinus",e.rhs)}return Xt(e,"")}function j4(e){if(e.type===gt.OPERATOR){const t=e.lhs?re(e.lhs):Xt(e,"");return e.items.forEach(n=>$4(n,t)),t}return Xt(e,"")}function Al(e,t){return Xt(e,[Ke(e,"jump",[`${t}`]),"; continue;"])}function mi(e){return Sn.linelookup[e??""]??-1}function $f(e,t){Sn.linelookup[e]=t}function ao(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&(i.done=n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&(i.skip=n);break;case gt.LINE:ao(i.stmts,t,n);break}}}function d1(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.ELSE_IF:i.type===t&&$f(i.done,n);break;case gt.IF_BLOCK:case gt.IF_CHECK:i.type===t&&$f(i.skip,n);break;case gt.LINE:d1(i.stmts,t,n);break}}}function re(e){var t;switch(e.type){case gt.PROGRAM:return Xt(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(re).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${xl}`]);case gt.API:return Xt(e,["  ",Ke(e,e.method,oo(e.words)),`;
`]);case gt.LINE:return Xt(e,[`case ${e.lineindex}:
`,...e.stmts.map(re).flat(),`  break;
`]);case gt.MARK:return Xt(e,`  // ${e.comment}
`);case gt.GOTO:{const n=mi(e.id);return Xt(e,["  ",Al(e,n),`
`])}case gt.COUNT:return Xt(e,`${e.index}`);case gt.LITERAL:switch(e.literal){case kl.NUMBER:return Xt(e,`${e.value}`);case kl.STRING:return Xt(e,Df(e.value));case kl.TEMPLATE:return Xt(e,Tl(e.value))}return h1(e);case gt.TEXT:return Xt(e,["  ",Ke(e,"text",[Tl(e.value)]),`;
`]);case gt.STAT:if(Sn.isfirststat){Sn.isfirststat=!1;const n=e.value.trim().split(" ").map(Df);return Xt(e,["  ",Ke(e,"stat",n),`;
`])}return Xt(e,`  // skipped ${e.value}
`);case gt.LABEL:{const n=Ut(e.name),r=e.active?"label":"comment";Sn.labels[n]||(Sn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Sn.labels[n].push(i),Xt(e,`  // ${i} '${n}' ${r}
`)}case gt.HYPERLINK:return Xt(e,["  ",Ke(e,"hyperlink",[Tl(e.text),...oo(e.link)]),`;
`]);case gt.MOVE:{const n=Ke(e,"command",[Df("go"),oo(e.words)].flat());return e.wait?Xt(e,["  if (",n,`) { continue; };
`]):Xt(e,["  ",n,`;
`])}case gt.COMMAND:return Xt(e,["  if (",Ke(e,"command",oo(e.words)),`) { continue; };
`]);case gt.IF:{const n=((t=e.block)==null?void 0:t.type)===gt.IF_BLOCK?e.block:void 0;if(w(n)){ao([e.check],gt.IF_CHECK,n.skip);const r=Xt(e,re(e.check));return n.lines.forEach(i=>r.add(re(i))),d1(n.altlines,gt.ELSE_IF,mi(n.done)),n.altlines.forEach(i=>r.add(re(i))),r}return Xt(e,re(e.check))}case gt.IF_CHECK:{const n=mi(e.skip);return n===-1?Xt(e,["  ",Ke(e,e.method,oo(e.words)),`;
`]):Xt(e,["  if (!",Ke(e,e.method,oo(e.words)),") { ",Al(e,n),` }
`])}case gt.ELSE_IF:case gt.ELSE:{const n=Xt(e,"");return e.lines.forEach(r=>n.add(re(r))),n}case gt.WHILE:{const n=mi(e.loop),r=mi(e.done),i=Xt(e,"");return ao(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case gt.REPEAT:{const n=mi(e.loop),r=mi(e.done),i=Xt(e,"");return ao(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case gt.WAITFOR:{const n=Xt(e,"");return ao(e.lines,gt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(re(r))}),n}case gt.FOREACH:{const n=mi(e.loop),r=mi(e.done),i=Xt(e,"");return ao(e.lines,gt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case gt.BREAK:s.goto=r;break;case gt.CONTINUE:s.goto=n;break}i.add(re(s))}),i}case gt.BREAK:return Xt(e,["  ",Al(e,e.goto),`
`]);case gt.CONTINUE:return Xt(e,["  ",Al(e,e.goto),`
`]);case gt.OR:return Ke(e,"or",e.items.map(re));case gt.AND:return Ke(e,"and",e.items.map(re));case gt.NOT:return Ke(e,"not",e.items.map(re));case gt.COMPARE:return D4(e);case gt.OPERATOR:return j4(e);case gt.EXPR:return Ke(e,"expr",e.words.map(re));default:return console.error("<unsupported node>",e.type,e),h1(e)}}function zr(e){if(w(e))switch(e.type===gt.LINE&&++Sn.lineindex,e.lineindex=Sn.lineindex,e.type){case gt.PROGRAM:e.lines.forEach(zr);break;case gt.LINE:e.stmts.forEach(zr);break;case gt.MARK:$f(e.id,e.lineindex);break;case gt.IF:zr(e.check),zr(e.block);break;case gt.IF_BLOCK:e.lines.forEach(zr),e.altlines.forEach(zr);break;case gt.ELSE_IF:e.lines.forEach(zr);break;case gt.ELSE:case gt.WHILE:case gt.REPEAT:case gt.FOREACH:case gt.WAITFOR:e.lines.forEach(zr);break;case gt.MOVE:case gt.COMMAND:case gt.IF_CHECK:e.words.forEach(zr);break}}function z4(e){return Sn.labels={},Sn.internal=1,Sn.lineindex=0,Sn.isfirststat=!0,zr(e),{...re(e).toStringWithSourceMap({file:`${xl}.map`}),...Sn}}function p1(e){return ee(e)?e.length>0?1:0:e??0}function K4(e){return`${e}_chip`}function m1(e=""){return`vm:${e??""}`}function W4(e,t,n){var u,l;const r=K4(e),i=ys(r);let s;const o=On(Object.entries(n.labels??{}));(!ee(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((u=n.errors)==null?void 0:u.length)??0)!==0?1:0);function a(h,f){x.words=f;const d=s4(t,h);return w(d)?d(c,f):h!=="send"?a("send",[h,...f]):0}const c={halt(){oL(r)},id(){return e},set(h,f){const[d,p]=a4(t,c,h,f);if(d)return p},get(h){const[f,d]=o4(t,c,h);if(f)return d},tick(h){const f=Lt(i.ps)?i.ps:0,d=f%h===0;if(i.ps=f+1,d===!1)return!1;if(c.shouldtick()===!1)return q_(t,c),!1;i.lc=0,i.ys=0,x.get=c.get,c4(t,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){oe(K,"crash",p.message),i.es=1}return q_(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Lt(i.lc)?++i.lc>ti.HALT_AT_COUNT:!0},hm(){if(ee(i.mg)&&ee(i.lb)){const[h]=i.mg;if(w(h))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)return p.find(g=>Lt(g)&&g>0)??0}}return 0},yield(){i.ys=1},jump(h){i.ec=h},sy(){return!!i.ys||c.shouldhalt()},send(h,f,d,p){K.emit(`${m1(h)}:${f}`,d,p)},lock(h){i.lk=h},unlock(){i.lk=""},message(h){i.lk&&h.sender!==i.lk||(i.mg=[h.target,h.data,h.sender,h.player])},zap(h){if(ee(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h){const g=p.findIndex(k=>k>0);g>=0&&(p[g]*=-1)}}},restore(h){if(ee(i.lb))for(let f=0;f<i.lb.length;++f){const[d,p]=i.lb[f];if(d===h)for(let g=0;g<p.length;g++)p[f]=Math.abs(p[f])}},getcase(){i.ec=Lt(i.ec)?i.ec:1;const h=c.hm();if(h&&ee(i.mg)){const[,f,d,p]=i.mg;c.set("sender",d),w(f)&&c.set("arg",f),St(p)&&(c.set("player",p),x.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=h}return i.ec},nextcase(){const h=Lt(i.ec)?i.ec:1;return i.ec=h+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(h){const f=Sx.parse(h),[d]=f.filter(p=>p.fileName===xl);return{line:(d==null?void 0:d.lineNumber)??0,column:(d==null?void 0:d.columnNumber)??0}},text(h){return a("text",[h])},stat(...h){return a("stat",h)},hyperlink(...h){return a("hyperlink",h)},command(...h){if(h.length===0)return 0;const[f,...d]=h;return a(Ut(we(f)),d)},if(...h){const[f,d]=it(h,0,[q.ANY]),p=p1(f);return p&&d<h.length&&c.command(...h.slice(d)),p?1:0},try(...h){const[,f]=it(h,0,[q.DIR]),d=c.command("go",...h);return d&&f<h.length&&c.command(...h.slice(f)),d?1:0},take(...h){const[f,d,p]=it(h,0,[q.NAME,q.ANY]),g=Lt(d),k=g?p:1,E=c.get(f),T=g?d:1;if(!Lt(E))return k<h.length&&c.command(...h.slice(k)),1;const v=E-T;return v<0?(k<h.length&&c.command(...h.slice(k)),1):(c.set(f,v),0)},give(...h){const[f,d,p]=it(h,0,[q.NAME,q.ANY]),g=Lt(d),k=g?p:1,E=c.get(f),T=g?d:1,v=E===void 0?1:0;return v&&k<h.length&&c.command(...h.slice(k)),c.set(f,Uo(E,0)+T),v},repeatstart(h,...f){const[d,p]=it(f,0,[q.NUMBER]),g=`repeatcount${h}`,k=`repeatwords${h}`;i[g]=d,i[k]=p<f.length?f.slice(p):void 0},repeat(h){const f=`repeatcount${h}`,d=`repeatwords${h}`;if(!Lt(i[f]))return 0;const p=i[f];i[f]=p-1;const g=p>0,k=i[d];return g&&ee(k)&&c.command(...k),g?1:0},foreachstart(h,...f){const[d,p,g,k]=it(f,0,[q.NAME,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let E=Math.min(p,g),T=Math.max(p,g);const v=(k??0)||1;if(v<0){const N=E;E=T,T=N}return c.set(d,E-v),0},foreach(h,...f){const[d,p,g,k,E]=it(f,0,[q.NAME,q.NUMBER,q.NUMBER,q.MAYBE_NUMBER]);let T=Math.min(p,g),v=Math.max(p,g);const N=(k??0)||1;if(N<0){const O=T;T=v,v=O}let U=c.get(d);!Lt(U)||U<T||U>v?U=T:U+=N;const L=U<=v?1:0;return L&&(c.set(d,U),E<f.length&&c.command(...f.slice(E))),L},waitfor(...h){const[f]=it(h,0,[q.ANY]),d=p1(f);return d||c.yield(),d?1:0},or(...h){let f=0;for(let d=0;d<h.length;){const[p,g]=it(h,d,[q.ANY]);if(f=p,f)break;d=g}return f},and(...h){let f=0;for(let d=0;d<h.length;){const[p,g]=it(h,d,[q.ANY]);if(f=p,!f)break;d=g}return f},not(...h){const[f]=it(h,0,[q.ANY]);return f?0:1},expr(...h){const[f]=it(h,0,[q.ANY]);return f},isEq(h,f){const[d]=it([h],0,[q.ANY]),[p]=it([f],0,[q.ANY]);return typeof d=="object"||typeof p=="object"?Ab(d,p)?1:0:d===p?1:0},isNotEq(h,f){return this.isEq(h,f)?0:1},isLessThan(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d<p?1:0},isGreaterThan(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d>p?1:0},isLessThanOrEq(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d<=p?1:0},isGreaterThanOrEq(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d>=p?1:0},opPlus(h,f){const[d]=it([h],0,[q.ANY]),[p]=it([f],0,[q.ANY]);return d+p},opMinus(h,f){const[d]=it([h],0,[q.ANY]),[p]=it([f],0,[q.ANY]);return d-p},opPower(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return Math.pow(d,p)},opMultiply(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d*p},opDivide(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d/p},opModDivide(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return d%p},opFloorDivide(h,f){const[d]=it([h],0,[q.NUMBER]),[p]=it([f],0,[q.NUMBER]);return Math.floor(d/p)},opUniPlus(h){const[f]=it([h],0,[q.NUMBER]);return+f},opUniMinus(h){const[f]=it([h],0,[q.NUMBER]);return-f}};return s=(l=n.code)==null?void 0:l.call(n,c),c}function jf(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ee(r)?r.forEach(i=>{t.push(jf(i))}):t.push(jf(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function G4(e){const t=y_(`${e}
`);if(t.errors.length>0)return t;so.input=t.tokens;const n=so.program();if(so.errors.length>0)return{tokens:t.tokens,errors:so.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=P4.go(n);return r?(jf(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const zf=Object.getPrototypeOf(function*(){}).constructor;function H4(e,t){const n=`compile-${e}`;console.time(n);const r=G4(t);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=z4(r.ast);if(i.code){$x&&console.info(i.code);try{return{...r,...i,source:i.code,code:new zf("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new zf("api"," ")}}}return{...r,...i,source:"",code:new zf("api"," ")}}function Y4(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=H4(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return w(s)?s.isended():!0},halt(i){const s=t[i];return w(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];w(o)&&o.set("arg",s)},tick(i,s,o,a,c){var l;let u=t[i];if(!w(t[i])){const h=n(a,c);if(u=t[i]=W4(i,s,h),(l=h.errors)!=null&&l.length){const[f]=h.errors,d=((f==null?void 0:f.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((E,T)=>[E,T]);p.slice(d-5,d).forEach(([E,T])=>{oe(K,"build",`$grey${T+1} $grey${E}`)});const[g,k]=p[d]??[];if(St(g)&&w(k)){const E=(f.column??1)-1,T=E+f.length,v=E<g.length?g:`${g}*`,N=v.substring(0,E),U=v.substring(E,T),L=v.substring(T);oe(K,"build",`$red${k+1} $grey${N}$red${U}$grey${L}`)}return f.message.split(`
`).forEach(E=>{oe(K,"build",E)}),!1}}return!!(u!=null&&u.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Gi(i.target),a=t[s];if(w(a)){const c={...i,target:o};a.message(c)}}};return r}let g1=0;function V4(){switch(g1++){case 0:return $t.BLUE;case 1:return $t.GREEN;case 2:return $t.CYAN;case 3:return $t.RED;case 4:return $t.PURPLE;case 5:return $t.YELLOW;default:return g1=0,$t.WHITE}}const Fe=new Lo,gn={},vl={};function y1(e,t,n,r,i=0){const s=`tiles:${e}:${t}`;return w(gn[s])||(gn[s]=Nx(e,t,n,r,i)),gn[s]}function q4(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return w(vl[s])||(vl[s]=Ox(e,t,n)),vl[s].id=i,vl[s]}function X4(e,t){const n=`sprites:${e}:${t}`;return w(gn[n])||(gn[n]=Cx(e,t)),gn[n]}function J4(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return w(gn[s])||(gn[s]=Lx(e,t,n,r,i)),gn[s]}function _1(e,t,n,r){const i=`media:${e}:${t}`;w(gn[i])||(gn[i]=Mx(e,t,n,r));const s=gn[i];return s.mime=n,s.media=r,s}function Z4(e,t){const n=`control:${e}:${t}`;return w(gn[n])||(gn[n]=Ux(e,t)),gn[n]}const ji=.4;function b1(e,t){const n=[];Fe.x=e-ji,Fe.y=t-ji,n.push(Fe.angle()),Fe.x=e+ji,Fe.y=t-ji,n.push(Fe.angle()),Fe.x=e-ji,Fe.y=t+ji,n.push(Fe.angle()),Fe.x=e+ji,Fe.y=t+ji,n.push(Fe.angle());const r=Math.round(Hu(Math.min(...n))),i=Math.round(Hu(Math.max(...n)));return Math.abs(r-i)>180?[i,r]:[r,i]}function Q4(e,t,n,r,i){var L;if(!w(r)||!w(r.terrain)||!w(r.objects))return[];const s=[];let o=t;const a=o===0,c=ne,u=Ve,l=a?$t.BLACK:$t.ONCLEAR,h=y1(e,o++,c,u,l);s.push(h);const f=o++,d=X4(e,f);d.sprites=[],s.push(d);const p=r.isdark?1:0,g=J4(e,o++,c,u,p);s.push(g),g.alphas.fill(p);const k=y1(e,o++,c,u,$t.ONCLEAR);s.push(k),k.char.fill(0);const E={...Rf(ne,Ve,V4(),$t.ONCLEAR),...k},T=Z4(e,o++);i&&s.push(T);for(let O=0;O<r.terrain.length;++O){const B=r.terrain[O],F=v_(n,B,0,$t.BLACK,$t.ONCLEAR);h.char[O]=F.char,h.color[O]=F.color,h.bg[O]=F.bg}const v=Object.values(r.objects??{});for(let O=0;O<v.length;++O){const B=v[O];if(w(B.removed))continue;const F=B.id??"",nt=v_(n,B,1,$t.WHITE,$t.BLACK),dt=q4(e,f,F,O);if(dt.x=B.x??0,dt.y=B.y??0,dt.char=nt.char,dt.color=nt.color,dt.bg=nt.bg,d.sprites.push(dt),p){if(nt.light>0){const M=[],R=Ln(Math.round(nt.light),1,10),_=R*.5,P=Kr(r,dt),Z=1/_;if(g.alphas[P]=0,R>1)for(let j=1;j<=R;++j)for(let ut=dt.y-j;ut<=dt.y+j;++ut)for(let tt=dt.x-j;tt<=dt.x+j;++tt){if(tt===dt.x&&ut===dt.y)continue;Fe.x=tt-dt.x,Fe.y=ut-dt.y;const ht=Fe.length();if(ht>R)continue;const G=Kr(r,{x:tt,y:ut});if(G===-1)continue;const z=Math.round(Hu(Fe.angle()));let bt=0;for(let At=0;At<M.length;++At){const xt=M[At];z>=xt[0]&&z<=xt[1]&&(bt=Math.max(bt,xt[2]))}g.alphas[G]=Math.min(g.alphas[G],bt+(ht<_?0:(ht-_)*Z)),g.alphas[G]=Ln(g.alphas[G],0,1);const st=Rn(r,((L=r.lookup)==null?void 0:L[G])??"");if(w(st)){const At=[...b1(Fe.x,Fe.y),.25];M.push(At)}const at=r.terrain[G],Ct=Bi(n,at),Zt=(at==null?void 0:at.collision)??(Ct==null?void 0:Ct.collision);if(qu(Gt.ISBULLET,Zt)){const At=[...b1(Fe.x,Fe.y),1];let xt=0;for(xt=0;xt<M.length;++xt){const Dt=M[xt];if(Dt[1]>Dt[0]&&At[1]>=Dt[0]&&At[0]<=Dt[1]&&At[2]>=1&&Dt[2]>=1){M[xt]=[Math.min(At[0],Dt[0]),Math.max(At[1],Dt[1]),1];break}}xt===M.length&&M.push(At)}}}else if(Es(F)){const M=Kr(r,dt);g.alphas[M]=0}}if(St(B.tickertext)&&Lt(B.tickertime)&&B.tickertext.length){const M=ne,R=F_(B.tickertext,M,Ve-1),_=(R==null?void 0:R.measuredwidth)??1,P=B.x??0,Z=B.y??0,j=Z<Ve*.5;E.x=P-Math.floor(_*.5),E.y=Z+(j?1:-1),E.x+_>ne&&(E.x=ne-_),E.x<0&&(E.x=0),U_(B.tickertext,E,!0)}F===e&&(T.focusx=dt.x,T.focusy=dt.y,T.focusid=F)}const N=pe(jt.MAIN),U=hi(N,jt.MAIN);if(St(U.palette)){const O=ui(N,kt.PALETTE,U.palette),B=Br(O);w(B==null?void 0:B.bits)&&s.push(_1(e,o++,"image/palette",Array.from(B.bits)))}if(St(U.charset)){const O=ui(N,kt.CHARSET,U.charset),B=Br(O);w(B==null?void 0:B.bits)&&s.push(_1(e,o++,"image/charset",Array.from(B.bits)))}return s}const Dn=Y4();var jt=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.CONTENT="content",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))(jt||{});const Te={halt:!1,session:Ie(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function tL(){return Te.session}function gi(){return Te.operator}function eL(e){Te.operator=e}function nL(e){Te.halt=e}function rL(){return Te.halt}function co(){return[...Te.books.values()]}function iL(){const[e]=Te.books.values();return e}function fr(e){const t=Ut(e);return Te.books.get(e)??co().find(n=>n.name===t)}function Sl(e,t){w(fr(t))&&(Te.software[e]=t)}function pe(e){return fr(Te.software[e])}function E1(e){const t=x_([]);return St(e)&&(t.name=e),Kf(t),gr(K,`created [book] ${t.name}`),t}function sL(e){let t=fr(e);return w(t)||(t=x_([]),t.name=e),Kf(t),gr(K,`created [book] ${t.name}`),t}function $n(e,t){let n=w(t)?sL(t):pe(e);return w(n)||(w(n)||(n=iL()),w(n)||(n=E1(t)),w(n)&&gr(K,`opened [book] ${n.name} for ${e}`)),Sl(e,n.id),n}function gs(e,t,n){return gf($n(e),n,t)}function ys(e){const t=$n("main");return hi(t,e)}function w1(){const e=$n("main");return hi(e,"main")}function oL(e){const t=$n("main");return S_(t,e)}function aL(e,t){Te.books.clear(),e.forEach(r=>{Te.books.set(r.id,r),r.name==="main"&&(Te.software.main=r.id)});const n=fr(t);if(w(n)&&Sl("main",n.id),!Te.software.main){const r=Te.books.values().next();r.value&&(Te.software.main=r.value.id)}}function Kf(e){return Te.books.set(e.id,e),e.id}function cL(e){const t=fr(e);t&&Te.books.delete(t.id)}function lL(e){if(!St(e)||!e)return oe(K,"login",`failed for playerid ==>${e}<==`,e);const t=pe("main");if(!w(t))return oe(K,"login:main","login failed to find book 'main'",e);const n=fs(t,e);if(w(n))return!0;const r=Pi(t,kt.BOARD,"title");if(r.length===0)return oe(K,"login:title","login failed to find board with 'title' stat",e);const i=la(t,"player");if(!w(i))return oe(K,"login:player","login failed to find object type 'player'",e);const s=R0(e,r),o=Br(s);if(w(o)){const a=k_(s,"startx"),c=k_(s,"starty"),u=Lt(a)?a:Math.round(ne*.5),l=Lt(c)?c:Math.round(Ve*.5),h=i.name??"player",f=Xf(o,{x:u,y:l},h,e);if(w(f==null?void 0:f.id))return f.player=e,fl(t,e,o.id),!0}return!1}function uL(e){const t=pe("main"),n=fs(t,e);fl(t,e,""),wf(t,n,Rn(n,e)),I1(n,e),Dn.halt(e),S_(t,e)}function dr(e){const t=pe("main");return fs(t,e)}function hL(e){const t=pe("main"),n=iC(t,e),r=fs(t,e),i=Rn(r,e);return n&&w(i)}function fL(e){const t=pe("main"),n=_f(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;Es(c)&&w(e[c])===!1&&(e[c]=0,fl(t,c,i.id))}}}function k1(e){Dn.message(e)}function ya(e,t,n,r){const i=Oi(e);St(t.id)&&K.emit("vm:touched",[t.id,i,n],r)}function Wf(e,t,n,r){if(!w(n))return!1;const i=I_(e,t,n,r);if(w(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=Pi(e,kt.BOARD,(t==null?void 0:t.exitwest)??"");if(o.length){const a=Mn(o);ua(e,n.id??"",a.id,{x:ne-1,y:r.y})}}else if(r.x>=ne){const o=Pi(e,kt.BOARD,(t==null?void 0:t.exiteast)??"");if(o.length){const a=Mn(o);ua(e,n.id??"",a.id,{x:0,y:r.y})}}else if(r.y<0){const o=Pi(e,kt.BOARD,(t==null?void 0:t.exitnorth)??"");if(o.length){const a=Mn(o);ua(e,n.id??"",a.id,{x:r.x,y:Ve-1})}}else if(r.y>=Ve){const o=Pi(e,kt.BOARD,(t==null?void 0:t.exitsouth)??"");if(o.length){const a=Mn(o);ua(e,n.id??"",a.id,{x:r.x,y:0})}}}else ya(i,n,"thud",void 0);if(n.kind==="player")ya(n,i,"touch",n.id);else if(n.collision===Gt.ISBULLET){const o=Es(n.party),a=Es(i.id);o!==a?ya(n,i,"shot",n.party):ya(i,n,"thud",void 0)}else ya(n,i,"bump",void 0);const s=Bi(e,i);return i.destructible??(s==null?void 0:s.destructible)?(w(i==null?void 0:i.id)?di(x.book,x.board,i,x.timestamp):yi(t,{x:r.x,y:r.y}),!0):!1}return!0}function x1(e,t,n,r,i=cE){var h;if(!w(e)||!w(t)||!w(n))return;const s={...x};x.book=e,x.board=t,x.element=n,x.elementid=n.id??"",x.elementisplayer=Es(x.elementid);const o=x.element.player??Te.operator;x.elementfocus=x.elementisplayer?x.elementid:o;const a=Bi(e,n),c=n.cycle??(a==null?void 0:a.cycle)??i,u=n.id??"",l=Ut(n.name??((h=n.kinddata)==null?void 0:h.name)??"");if(Dn.tick(u,$i.RUNTIME,Lt(c)?c:i,l,r),Lt(n==null?void 0:n.tickertime)&&x.timestamp-n.tickertime>va*5&&(n.tickertime=0,n.tickertext=""),x.elementisplayer){const f=ys(x.elementid);Lt(f.inputcurrent)&&(f.inputcurrent=0)}mr(s).forEach(f=>{x[f]=s[f]})}function dL(e,t){Te.loaders.set(e,t)}function pL(e){Dn.halt(e)}function mL(){const e=Dn.ids();for(let n=0;n<e.length;++n)Dn.halt(e[n]);const t=pe("main");w(t)&&(t.flags={})}function gL(){const e=pe("main");if(!w(e))return;const t=e.timestamp+1,n=ti.HALT_AT_COUNT;ti.HALT_AT_COUNT=n*2,Te.loaders.forEach((i,s)=>{const o={...x};x.timestamp=e.timestamp,x.book=e,x.board=void 0,x.element=void 0,x.elementid=s,x.elementisplayer=!1,x.elementfocus=Te.operator;const a=UC(s);w(a)&&Dn.arg(s,a),Dn.tick(s,$i.LOADER,1,"loader",i),Dn.isended(s)&&(Dn.halt(s),Te.loaders.delete(s)),mr(o).forEach(c=>{x[c]=o[c]})}),ti.HALT_AT_COUNT=n,e.timestamp=t,x.timestamp=t;const r=_f(e);for(let i=0;i<r.length;++i){const s=r[i],o=uC(e,s,t);for(let a=0;a<o.length;++a){const{id:c,type:u,code:l,object:h}=o[a];u===kt.ERROR?Dn.halt(c):x1(e,s,h,l)}}}function Gf(e,t){const n=pe("main");if(!w(n))return;function r(a,c){for(let u=0;u<a.length;++u){const l=a[u];if(w(l.id)){const h=`${m1(l.id)}:${c}`;K.emit(h,t)}}}const{target:i,path:s}=Gi(e),o=_f(n);for(let a=0;a<o.length;++a){const c=o[a];switch(Ut(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(z0(c,[i]),s);break}}}}function yL(e,t=""){var s;const n=$n("main");if(!w(n))return;const r=`${e}_cli`;x.timestamp=n.timestamp,x.book=n,x.board=fs(n,e),x.element=Rn(x.board,e),x.elementid=((s=x.element)==null?void 0:s.id)??"",x.elementisplayer=!0,x.elementfocus=x.elementid||e;const i=ti.HALT_AT_COUNT;ti.HALT_AT_COUNT=i*8,yd(K,"running",n.timestamp,r,t),Dn.once(r,$i.CLI,"cli",t),ti.HALT_AT_COUNT=i}function Rl(e){var o;const t=$n("main"),n=Fi(t,e);if(!w(t)||!w(n)||!w(x.element))return;const r=`${e}_run`,i=Ut(x.element.name??((o=x.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";Dn.once(r,$i.RUNTIME,i,s)}function _L(e){const t=pe("main"),n=fs(t,e),r=[];if(!w(t)||!w(n))return r;const i=to(t,n.over??""),s=to(t,n.under??""),o=[i,n,s];let a=0;for(let c=0;c<o.length;++c){const u=o[c],l=Q4(e,a,t,u,u===n);a+=l.length,r.push(...l)}return r}function cn(e){var r,i,s,o,a;const t=x.words[e],n=e+1;if(j_(t)){const[c,u]=ml(e);if(w(c))return[c,u]}if(RC(t)){const[c,u]=K_(e);if(w(c))return[c,u]}if(U0(t)){const[c,u]=uc(e);if(w(c))return[c,u]}if(St(t)&&Ut(t)==="rnd"){const[c,u]=cn(n),[l,h]=cn(u);return Lt(c)&&Lt(l)?[Ri(c,l),h]:Lt(c)?[Ri(0,c),u]:[Ri(0,1),n]}if(A1(t)){const[c,u]=Yf(e);if(w(c))return[c,u]}if(!w(t))return[void 0,e];if(Lt(t)||ee(t))return[t,n];if(St(t)){const c=Ut(t),u=(r=x.get)==null?void 0:r.call(x,t);if(w(u))return[u,n];switch(c){case"aligned":case"alligned":{const l=fc(x.board,x.element,x.elementfocus);return!w(x.element)||!w(l)?[0,n]:[x.element.x===l.x||x.element.y===l.y?1:0,n]}case"contact":{const l=fc(x.board,x.element,x.elementfocus);if(!w(x.element)||!w(l))return[0,n];const h=(l.x??0)-(((i=x.element)==null?void 0:i.x)??0),f=(l.y??0)-(((s=x.element)==null?void 0:s.y)??0);return[h===0&&Math.abs(f)<2||f===0&&Math.abs(h)<2?1:0,n]}case"blocked":{const[l,h]=it(x.words,n,[q.DIR]);return[oC(x.book,x.board,x.element,l)?1:0,h]}case"any":{const[l,h]=it(x.words,n,[q.KIND]),f=hc(l)??"",d=Po(x.board,f);return[j0(d,l).length?1:0,h]}case"rnd":return[Ri(0,1),n];case"abs":{const[l,h]=it(x.words,n,[q.NUMBER]);return[Math.abs(l),h]}case"ceil":{const[l,h]=it(x.words,n,[q.NUMBER]);return[Math.ceil(l),h]}case"floor":{const[l,h]=it(x.words,n,[q.NUMBER]);return[Math.floor(l),h]}case"round":{const[l,h]=it(x.words,n,[q.NUMBER]);return[Math.round(l),h]}case"clamp":{const[l,h,f,d]=it(x.words,n,[q.NUMBER,q.NUMBER,q.NUMBER]);return[Ln(l,h,f),d]}case"min":{const l=[];for(let h=n;h<x.words.length;){const[f,d]=cn(h);ee(f)&&!pr(f)&&!$r(f)&&!pi(f)&&!Un(f)&&l.push(...f),h=d,l.push(f)}return[Math.min(...l),x.words.length]}case"max":{const l=[];for(let h=n;h<x.words.length;){const[f,d]=cn(h);ee(f)&&!pr(f)&&!$r(f)&&!pi(f)&&!Un(f)&&l.push(...f),h=d,l.push(f)}return[Math.max(...l),x.words.length]}case"pick":{const l=[];for(let h=n;h<x.words.length;){const[f,d]=cn(h);ee(f)&&!pr(f)&&!$r(f)&&!pi(f)&&!Un(f)&&l.push(...f),h=d,l.push(f)}return[Mn(l),x.words.length]}case"pickwith":{const l=[],[h,f]=it(x.words,n,[q.NUMBER_OR_STRING]);for(let d=f;d<x.words.length;){const[p,g]=cn(d);ee(p)&&!pr(p)&&!$r(p)&&!pi(p)&&!Un(p)&&l.push(...p),d=g,l.push(p)}return[R0(`${h}`,l),x.words.length]}case"random":{const[l,h,f]=it(x.words,n,[q.NUMBER,q.MAYBE_NUMBER]);return[Ri(l,h??0),f]}case"randomwith":{const[l,h,f,d]=it(x.words,n,[q.NUMBER_OR_STRING,q.NUMBER,q.MAYBE_NUMBER]);return[v0(`${l}`,h,f??0),d]}case"run":{const[l,h]=it(x.words,n,[q.NAME]);return Rl(l),[(o=x.get)==null?void 0:o.call(x,"arg"),h]}case"runwith":{const[l,h,f]=it(x.words,n,[q.ANY,q.NAME]);return w(x.element)&&(x.element.arg=l),Rl(h),[(a=x.get)==null?void 0:a.call(x,"arg"),f]}}}return[t,n]}function lo(e){return w(e)&&w(e.x)&&w(e.y)}function We(e,t){switch(t){case yt.NORTH:--e.y;break;case yt.SOUTH:++e.y;break;case yt.WEST:--e.x;break;case yt.EAST:++e.x;break}return e}function zi(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return yt.WEST;if(n>0)return yt.EAST;if(r<0)return yt.NORTH;if(r>0)return yt.SOUTH}const Hf={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST"};function pr(e){return ee(e)&&T1(e[0])}function T1(e){return w(yt[e])&&St(e)}function bL(e){const t=yt[e];return w(t)?t:yt.IDLE}function A1(e){if(St(e))return Hf[Ut(e)]}function v1(e){if(pr(e))return e;if(T1(e))return[e];const t=A1(e);if(w(t))return[t]}function S1(e){const t=x.words[e],n=v1(t);if(pr(n))return[n,e+1];const[r,i]=cn(e),s=v1(r);return pr(s)?[s,i]:[void 0,e]}function Yf(e){const t=[];let[n,r]=S1(e);for(;pr(n);){if(t.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=it(x.words,r,[q.NUMBER,q.NUMBER]);t.push(o,a),r=c}const[i,s]=S1(r);n=i,r=s}return t.length?[t,r]:[void 0,e]}function EL(){return new Array(ne*Ve).map(()=>{})}function wL(e=zl){const t={terrain:EL(),objects:{},id:""};return e(t)}var Vf=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e))(Vf||{});function kL(e){return Gs(e,Vf,{terrain:t=>t.map(bc),objects:t=>Object.values(t).filter(n=>!n.removed).map(bc),id:Ce,named:Ce,lookup:Ce,codepage:Ce})}function xL(e){return jo(e,Vf,{terrain:t=>t.map(Ec),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Ec(t[r]);w(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function Kr(e,t){return!w(e)||!w(t==null?void 0:t.x)||!w(t==null?void 0:t.y)||t.x<0||t.x>=ne||t.y<0||t.y>=Ve?-1:t.x+t.y*ne}function Wr(e,t){const n=Kr(e,t);if(n<0||!w(e==null?void 0:e.lookup))return;const r=Rn(e,e.lookup[n]??"");return w(r)?r:e.terrain[n]}function TL(e,t){const n=Rn(e,t);if(w(n))return n;const r=parseFloat(t),i=p0(isNaN(r)?-1:r,ne);return R1(e,i.x,i.y)}function R1(e,t,n){return(t>=0&&t<ne)??(n>=0&&n<Ve)?e==null?void 0:e.terrain[t+n*ne]:void 0}function yi(e,t){if(!w(e)||!w(t)||!w(t.x)||!w(t.y)||t.x<0||t.x>=ne||t.y<0||t.y>=Ve)return;const n=On(t),r=t.x+t.y*ne;return e.terrain[r]=n,e.terrain[r]}function qf(e,t){if(!w(e)||!w(t))return;const n=On(t);return n.id=n.id??Ie(),e.objects[n.id]=n,e.objects[n.id]}function AL(e,t,n){return yi(e,{...t,kind:n})}function Xf(e,t,n,r){return qf(e,{...t,kind:n,id:r})}function Rn(e,t){if(e)return e.objects[t]}function Jf(e,t,n,r,i){if(!w(e)||!w(t))return{x:0,y:0};const s={x:t.x??0,y:t.y??0},o={x:t.lx??s.x,y:t.ly??s.y},a=zi(o,s),c=ne-1,u=Ve-1;for(let l=0;l<r.length;++l){const h=bL(r[l]);switch(h){case yt.IDLE:break;case yt.NORTH:case yt.SOUTH:case yt.WEST:case yt.EAST:We(s,h);break;case yt.BY:{const[f,d]=r.slice(l+1);Lt(f)&&Lt(d)&&(s.x=Ln(s.x+f,0,c),s.y=Ln(s.y+d,0,u)),l+=2;break}case yt.AT:{const[f,d]=r.slice(l+1);Lt(f)&&Lt(d)&&(s.x=Ln(f,0,c),s.y=Ln(d,0,u)),l+=2;break}case yt.FLOW:We(s,a);break;case yt.SEEK:{const f=vL(e,t,n);lo(f)&&We(s,zi(i,f));break}case yt.RNDNS:We(s,Mn(yt.NORTH,yt.SOUTH));break;case yt.RNDNE:We(s,Mn(yt.NORTH,yt.EAST));break;case yt.RND:We(s,Mn(yt.NORTH,yt.SOUTH,yt.WEST,yt.EAST));break;case yt.CW:case yt.CCW:case yt.OPP:case yt.RNDP:{const f=Jf(e,t,n,r.slice(l+1),i);switch(s.x=i.x,s.y=i.y,h){case yt.CW:switch(zi(i,f)){case yt.NORTH:We(s,yt.EAST);break;case yt.SOUTH:We(s,yt.WEST);break;case yt.EAST:We(s,yt.SOUTH);break;case yt.WEST:We(s,yt.NORTH);break}break;case yt.CCW:switch(zi(i,f)){case yt.NORTH:We(s,yt.WEST);break;case yt.SOUTH:We(s,yt.EAST);break;case yt.EAST:We(s,yt.NORTH);break;case yt.WEST:We(s,yt.SOUTH);break}break;case yt.OPP:switch(zi(i,f)){case yt.NORTH:We(s,yt.SOUTH);break;case yt.SOUTH:We(s,yt.NORTH);break;case yt.EAST:We(s,yt.WEST);break;case yt.WEST:We(s,yt.EAST);break}break;case yt.RNDP:switch(zi(i,f)){case yt.NORTH:case yt.SOUTH:s.x+=Mn(-1,1);break;case yt.WEST:case yt.EAST:s.y+=Mn(-1,1);break}break}break}}}return s}function I1(e,t){return w(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function vL(e,t,n){if(!w(e)||!w(t))return;const r=e.objects[n];if(w(r))return r;if(lo(t))return K0(t,Po(e,"player"))}const x={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var q=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NAME=5]="NAME",e[e.NUMBER=6]="NUMBER",e[e.STRING=7]="STRING",e[e.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=10]="MAYBE_COLLISION",e[e.MAYBE_COLOR=11]="MAYBE_COLOR",e[e.MAYBE_KIND=12]="MAYBE_KIND",e[e.MAYBE_DIR=13]="MAYBE_DIR",e[e.MAYBE_NAME=14]="MAYBE_NAME",e[e.MAYBE_NUMBER=15]="MAYBE_NUMBER",e[e.MAYBE_STRING=16]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",e[e.ANY=18]="ANY",e))(q||{});function Pe(e,t,n){throw console.info(n,x.element,x.elementid,x.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function it(e,t,n){var o,a,c,u;const r=x.words;x.words=e;const i=[];let s=t;for(let l=0;l<n.length;++l)switch(n[l]){case 0:{const[h,f]=ml(s);$r(h)||Pe("terrain or object",h,e),s=f,i.push(h);break}case 1:{const[h,f]=K_(s);pi(h)||Pe("solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 2:{const[h,f]=uc(s);Un(h)||Pe("color",h,e),s=f,i.push(h);break}case 3:{const[h,f]=B0(s);Ks(h)?(s=f,i.push(h)):Pe("kind",h,e);break}case 4:{const[h,f]=Yf(s);if(pr(h)){const d={x:((o=x.element)==null?void 0:o.x)??0,y:((a=x.element)==null?void 0:a.y)??0},p=w(x.board)&&w(x.element)?Jf(x.board,x.element,x.elementfocus,h,d):d;s=f,i.push(p)}else Pe("direction",h,e);break}case 5:{const h=x.words[s];St(h)||Pe("string",h,e),++s,i.push(h);break}case 6:{const[h,f]=cn(s);if(St(h)){const d=parseFloat(h);Lt(d)?i.push(d):Pe("number",h,e)}else Lt(h)?i.push(h):Pe("number",h,e);s=f;break}case 7:{const[h,f]=cn(s);St(h)||Pe("string",h,e),s=f,i.push(h);break}case 8:{const[h,f]=cn(s);let d=h;if(St(d)){const p=parseFloat(d);Lt(p)&&(d=p)}else Lt(d)||Pe("number or string",d,e);s=f,i.push(d);break}case 9:{const[h,f]=ml(s);h!==void 0&&!$r(h)&&Pe("optional terrain or object",h,e),s=f,i.push(h);break}case 10:{const[h,f]=ml(s);h!==void 0&&!pi(h)&&Pe("optional solid, walk, swim, bullet, walkable or swimmable",h,e),s=f,i.push(h);break}case 11:{const[h,f]=uc(s);h!==void 0&&!Un(h)&&Pe("optional color",h,e),s=f,i.push(h);break}case 12:{const[h,f]=B0(s);h!==void 0&&!Ks(h)&&Pe("optional kind",h,e),s=f,i.push(h);break}case 13:{const[h,f]=Yf(s);if(pr(h)){const d=((c=x.element)==null?void 0:c.x)??0,p=((u=x.element)==null?void 0:u.y)??0,g={x:d,y:p},k=x.board?Jf(x.board,x.element,x.elementfocus,h,g):g;s=f,i.push(k)}else h===void 0?(s=f,i.push(void 0)):Pe("optional direction",h,e);break}case 14:{const h=x.words[s];h!==void 0&&!St(h)&&Pe("optional string",h,e),++s,i.push(h);break}case 15:{const[h,f]=cn(s);if(St(h)){const d=parseFloat(h);Lt(d)?i.push(d):Pe("optional number",h,e)}else Lt(h)||h===void 0?i.push(h):Pe("optional number",h,e);s=f;break}case 16:{const[h,f]=cn(s);h!==void 0&&!St(h)&&Pe("optional string",h,e),s=f,i.push(h);break}case 17:{const[h,f]=cn(s);let d=h;if(St(d)){const p=parseFloat(d);Lt(p)&&(d=p)}else d!==void 0&&!Lt(d)&&Pe("number or string",d,e);s=f,i.push(d);break}case 18:{const[h,f]=cn(s);s=f,i.push(h);break}}return x.words=r,[...i,s]}const Il={},uo={};function Zf(){return{id:Ie(),layers:[],scroll:[],sidebar:[]}}const SL=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),RL=new Set(["tx","text"]),IL={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},N1={};let O1=e=>{let t=N1[e];return w(t)||(N1[e]=t=Zf()),t};function NL(e){O1=e}function yn(e){return O1(e)}function Qf(e){return w(Il[e])||(Il[e]=[]),Il[e]}function OL(e){const t=yn(e);t.scroll=[]}function CL(e,t,n){Object.values(uo).forEach(r=>{if(r[t]!==void 0){const i=O0(e.id(),t);Lt(n)&&fx(i,n),St(n)&&dx(i,n)}})}function Gr(e){const t=Qf(e);return Il[e]=[],t}function ae(e,t){Qf(e).push(t)}function te(e,t,n,r,i=()=>0,s=zl){const o=[t,n,...r],a=Ut(`${o[3]}`),c={...x};function u(l,h){w(h)&&h!==i(l)&&(x.board=c.board,x.element=c.element,x.elementfocus=c.elementfocus,s(l,h))}if(SL.has(a)){const l=`${o[2]}`;uo[t]=uo[t]??{};const h=i(l)??IL[a];if(uo[t][l]===void 0){const f=O0(t,l);Lt(h)&&hx(f,h),St(h)&&$u(f,h),RL.has(a)?uo[t][l]=f0(f,d=>{u(l,d)}):uo[t][l]=px(f,d=>{u(l,d)})}}Qf(e).push(o)}NL(e=>{if(Es(e)){const t=pe(jt.MAIN),n=hi(t,jt.GADGETSTORE);let r=n[e];return w(r)||(n[e]=r=Zf()),r}return Zf()});const td=ks("gadgetserver",["tock"],e=>{if(!td.session(e))return;const t=pe(jt.MAIN),n=(t==null?void 0:t.activelist)??[],r=hi(t,jt.GADGETSYNC);switch(e.target){case"tock":for(let i=0;i<n.length;++i){const s=n[i],o=yn(s);o.layers=_L(s);const a=r[s]??{},c=md(a,o);c.length&&(r[s]=On(o),Mb(td,c,s))}break;case"desync":e.player&&Lb(td,yn(e.player),e.player);break;case"clearscroll":e.player&&OL(e.player);break;case"clearplayer":if(e.player){const i=pe(jt.MAIN),s=hi(i,jt.GADGETSTORE);delete s[e.player];const o=hi(i,jt.GADGETSYNC);delete o[e.player]}break}});function Nl(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var C1={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(u,l){if(!i[u]){if(!r[u]){var h=typeof Nl=="function"&&Nl;if(!l&&h)return h(u,!0);if(a)return a(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[u]={exports:{}};r[u][0].call(d.exports,function(p){var g=r[u][1][p];return o(g||p)},d,d.exports,n,r,i,s)}return i[u].exports}for(var a=typeof Nl=="function"&&Nl,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var u,l,h,f,d,p,g,k=[],E=0,T=c.length,v=T,N=s.getTypeOf(c)!=="string";E<c.length;)v=T-E,h=N?(u=c[E++],l=E<T?c[E++]:0,E<T?c[E++]:0):(u=c.charCodeAt(E++),l=E<T?c.charCodeAt(E++):0,E<T?c.charCodeAt(E++):0),f=u>>2,d=(3&u)<<4|l>>4,p=1<v?(15&l)<<2|h>>6:64,g=2<v?63&h:64,k.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(g));return k.join("")},i.decode=function(c){var u,l,h,f,d,p,g=0,k=0,E="data:";if(c.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var T,v=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&v--,c.charAt(c.length-2)===a.charAt(64)&&v--,v%1!=0)throw new Error("Invalid base64 input, bad content length.");for(T=o.uint8array?new Uint8Array(0|v):new Array(0|v);g<c.length;)u=a.indexOf(c.charAt(g++))<<2|(f=a.indexOf(c.charAt(g++)))>>4,l=(15&f)<<4|(d=a.indexOf(c.charAt(g++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(g++))),T[k++]=u,d!==64&&(T[k++]=l),p!==64&&(T[k++]=h);return T}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function u(l,h,f,d,p){this.compressedSize=l,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}u.prototype={getContentWorker:function(){var l=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return l.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(l,h,f){return l.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],u=0;u<256;u++){a=u;for(var l=0;l<8;l++)a=1&a?3988292384^a>>>1:a>>>1;c[u]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var g=f;g<p;g++)u=u>>>8^d[255&(u^l[g])];return-1^u}(0|c,a,a.length,0):function(u,l,h,f){var d=o,p=f+h;u^=-1;for(var g=f;g<p;g++)u=u>>>8^d[255&(u^l.charCodeAt(g))];return-1^u}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),u=s?"uint8array":"array";function l(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(l,c),l.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,h.data),!1)},l.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new l("Deflate",h)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(d,p){var g,k="";for(g=0;g<p;g++)k+=String.fromCharCode(255&d),d>>>=8;return k}function o(d,p,g,k,E,T){var v,N,U=d.file,L=d.compression,O=T!==u.utf8encode,B=a.transformTo("string",T(U.name)),F=a.transformTo("string",u.utf8encode(U.name)),nt=U.comment,dt=a.transformTo("string",T(nt)),M=a.transformTo("string",u.utf8encode(nt)),R=F.length!==U.name.length,_=M.length!==nt.length,P="",Z="",j="",ut=U.dir,tt=U.date,ht={crc32:0,compressedSize:0,uncompressedSize:0};p&&!g||(ht.crc32=d.crc32,ht.compressedSize=d.compressedSize,ht.uncompressedSize=d.uncompressedSize);var G=0;p&&(G|=8),O||!R&&!_||(G|=2048);var z=0,bt=0;ut&&(z|=16),E==="UNIX"?(bt=798,z|=function(at,Ct){var Zt=at;return at||(Zt=Ct?16893:33204),(65535&Zt)<<16}(U.unixPermissions,ut)):(bt=20,z|=function(at){return 63&(at||0)}(U.dosPermissions)),v=tt.getUTCHours(),v<<=6,v|=tt.getUTCMinutes(),v<<=5,v|=tt.getUTCSeconds()/2,N=tt.getUTCFullYear()-1980,N<<=4,N|=tt.getUTCMonth()+1,N<<=5,N|=tt.getUTCDate(),R&&(Z=s(1,1)+s(l(B),4)+F,P+="up"+s(Z.length,2)+Z),_&&(j=s(1,1)+s(l(dt),4)+M,P+="uc"+s(j.length,2)+j);var st="";return st+=`
\0`,st+=s(G,2),st+=L.magic,st+=s(v,2),st+=s(N,2),st+=s(ht.crc32,4),st+=s(ht.compressedSize,4),st+=s(ht.uncompressedSize,4),st+=s(B.length,2),st+=s(P.length,2),{fileRecord:h.LOCAL_FILE_HEADER+st+B+P,dirRecord:h.CENTRAL_FILE_HEADER+s(bt,2)+st+s(dt.length,2)+"\0\0\0\0"+s(z,4)+s(k,4)+B+P+dt}}var a=n("../utils"),c=n("../stream/GenericWorker"),u=n("../utf8"),l=n("../crc32"),h=n("../signature");function f(d,p,g,k){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=g,this.encodeFileName=k,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,g=this.entriesCount,k=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:g?(p+100*(g-k-1))/g:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var g=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,g=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),p)this.push({data:function(k){return h.DATA_DESCRIPTOR+s(k.crc32,4)+s(k.compressedSize,4)+s(k.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var g=this.bytesWritten-d,k=function(E,T,v,N,U){var L=a.transformTo("string",U(N));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(E,2)+s(E,2)+s(T,4)+s(v,4)+s(L.length,2)+L}(this.dirRecords.length,g,d,this.zipComment,this.encodeFileName);this.push({data:k,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(g){p.processChunk(g)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(g){p.error(g)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var g=0;g<p.length;g++)try{p[g].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,u){var l=new o(c.streamFiles,u,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=function(T,v){var N=T||v,U=s[N];if(!U)throw new Error(N+" is not a valid compression method !");return U}(d.options.compression,c.compression),g=d.options.compressionOptions||c.compressionOptions||{},k=d.dir,E=d.date;d._compressWorker(p,g).withStreamInfo("file",{name:f,dir:k,date:E,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(l)}),l.entriesCount=h}catch(f){l.error(f)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),u=n("./stream/Crc32Probe"),l=n("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var g=f.decompressed.getContentWorker().pipe(new u);g.on("error",function(k){p(k)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(g){var k=new c(d);return k.load(g),k}).then(function(g){var k=[o.Promise.resolve(g)],E=g.files;if(d.checkCRC32)for(var T=0;T<E.length;T++)k.push(h(E[T]));return o.Promise.all(k)}).then(function(g){for(var k=g.shift(),E=k.files,T=0;T<E.length;T++){var v=E[T],N=v.fileNameStr,U=s.resolve(v.fileNameStr);p.file(U,v.decompressed,{binary:!0,optimizedBinaryString:!0,date:v.date,dir:v.dir,comment:v.fileCommentStr.length?v.fileCommentStr:null,unixPermissions:v.unixPermissions,dosPermissions:v.dosPermissions,createFolders:d.createFolders}),v.dir||(p.file(U).unsafeOriginalName=N)}return k.zipComment.length&&(p.comment=k.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,u){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(u)}s.inherits(a,o),a.prototype._bindStream=function(c){var u=this;(this._stream=c).pause(),c.on("data",function(l){u.push({data:l,meta:{percent:0}})}).on("error",function(l){u.isPaused?this.generatedError=l:u.error(l)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,u){s.call(this,c),this._helper=a;var l=this;a.on("data",function(h,f){l.push(h)||l._helper.pause(),u&&u(f)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof Ze<"u",newBufferFrom:function(s,o){if(Ze.from&&Ze.from!==Uint8Array.from)return Ze.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Ze(s,o)},allocBuffer:function(s){if(Ze.alloc)return Ze.alloc(s);var o=new Ze(s);return o.fill(0),o},isBuffer:function(s){return Ze.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,L,O){var B,F=a.getTypeOf(L),nt=a.extend(O||{},l);nt.date=nt.date||new Date,nt.compression!==null&&(nt.compression=nt.compression.toUpperCase()),typeof nt.unixPermissions=="string"&&(nt.unixPermissions=parseInt(nt.unixPermissions,8)),nt.unixPermissions&&16384&nt.unixPermissions&&(nt.dir=!0),nt.dosPermissions&&16&nt.dosPermissions&&(nt.dir=!0),nt.dir&&(U=E(U)),nt.createFolders&&(B=k(U))&&T.call(this,B,!0);var dt=F==="string"&&nt.binary===!1&&nt.base64===!1;O&&O.binary!==void 0||(nt.binary=!dt),(L instanceof h&&L.uncompressedSize===0||nt.dir||!L||L.length===0)&&(nt.base64=!1,nt.binary=!0,L="",nt.compression="STORE",F="string");var M=null;M=L instanceof h||L instanceof c?L:p.isNode&&p.isStream(L)?new g(U,L):a.prepareContent(U,L,nt.binary,nt.optimizedBinaryString,nt.base64);var R=new f(U,M,nt);this.files[U]=R}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),u=n("./stream/StreamHelper"),l=n("./defaults"),h=n("./compressedObject"),f=n("./zipObject"),d=n("./generate"),p=n("./nodejsUtils"),g=n("./nodejs/NodejsStreamInputAdapter"),k=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var L=U.lastIndexOf("/");return 0<L?U.substring(0,L):""},E=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},T=function(U,L){return L=L!==void 0?L:l.createFolders,U=E(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:L}),this.files[U]};function v(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var N={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var L,O,B;for(L in this.files)B=this.files[L],(O=L.slice(this.root.length,L.length))&&L.slice(0,this.root.length)===this.root&&U(O,B)},filter:function(U){var L=[];return this.forEach(function(O,B){U(O,B)&&L.push(B)}),L},file:function(U,L,O){if(arguments.length!==1)return U=this.root+U,s.call(this,U,L,O),this;if(v(U)){var B=U;return this.filter(function(nt,dt){return!dt.dir&&B.test(nt)})}var F=this.files[this.root+U];return F&&!F.dir?F:null},folder:function(U){if(!U)return this;if(v(U))return this.filter(function(F,nt){return nt.dir&&U.test(F)});var L=this.root+U,O=T.call(this,L),B=this.clone();return B.root=O.name,B},remove:function(U){U=this.root+U;var L=this.files[U];if(L||(U.slice(-1)!=="/"&&(U+="/"),L=this.files[U]),L&&!L.dir)delete this.files[U];else for(var O=this.filter(function(F,nt){return nt.name.slice(0,U.length)===U}),B=0;B<O.length;B++)delete this.files[O[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var L,O={};try{if((O=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=O.type.toLowerCase(),O.compression=O.compression.toUpperCase(),O.type==="binarystring"&&(O.type="string"),!O.type)throw new Error("No output type specified.");a.checkSupport(O.type),O.platform!=="darwin"&&O.platform!=="freebsd"&&O.platform!=="linux"&&O.platform!=="sunos"||(O.platform="UNIX"),O.platform==="win32"&&(O.platform="DOS");var B=O.comment||this.comment||"";L=d.generateWorker(this,O,B)}catch(F){(L=new c("error")).error(F)}return new u(L,O.type||"string",O.mimeType)},generateAsync:function(U,L){return this.generateInternalStream(U).accumulate(L)},generateNodeStream:function(U,L){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(L)}};r.exports=N},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===u&&this.data[f+2]===l&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),u=a.charCodeAt(1),l=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&u===f[1]&&l===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,u=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)u=(u<<8)+this.byteAt(c);return this.index+=a,u},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),u=n("./NodeBufferReader"),l=n("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new u(h):o.uint8array?new l(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(l){u.dataIsReady=!0,u.data=l,u.max=l&&l.length||0,u.type=s.getTypeOf(l),u.isPaused||u._tickAndRepeat()},function(l){u.error(l)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,u);break;case"uint8array":c=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":c=this.data.slice(this.index,u)}return this.index=u,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),u=n("../support"),l=n("../external"),h=null;if(u.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,g){return new l.Promise(function(k,E){var T=[],v=p._internalType,N=p._outputType,U=p._mimeType;p.on("data",function(L,O){T.push(L),g&&g(O)}).on("error",function(L){T=[],E(L)}).on("end",function(){try{var L=function(O,B,F){switch(O){case"blob":return s.newBlob(s.transformTo("arraybuffer",B),F);case"base64":return c.encode(B);default:return s.transformTo(O,B)}}(N,function(O,B){var F,nt=0,dt=null,M=0;for(F=0;F<B.length;F++)M+=B[F].length;switch(O){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(dt=new Uint8Array(M),F=0;F<B.length;F++)dt.set(B[F],nt),nt+=B[F].length;return dt;case"nodebuffer":return Ze.concat(B);default:throw new Error("concat : unsupported type '"+O+"'")}}(v,T),U);k(L)}catch(O){E(O)}T=[]}).resume()})}function d(p,g,k){var E=g;switch(g){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=g,this._mimeType=k,s.checkSupport(E),this._worker=p.pipe(new o(E)),p.lock()}catch(T){this._worker=new a("error"),this._worker.error(T)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,g){var k=this;return p==="data"?this._worker.on(p,function(E){g.call(k,E.data,E.meta)}):this._worker.on(p,function(){s.delay(g,arguments,k)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Ze<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),u=new Array(256),l=0;l<256;l++)u[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;u[254]=u[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):function(p){var g,k,E,T,v,N=p.length,U=0;for(T=0;T<N;T++)(64512&(k=p.charCodeAt(T)))==55296&&T+1<N&&(64512&(E=p.charCodeAt(T+1)))==56320&&(k=65536+(k-55296<<10)+(E-56320),T++),U+=k<128?1:k<2048?2:k<65536?3:4;for(g=o.uint8array?new Uint8Array(U):new Array(U),T=v=0;v<U;T++)(64512&(k=p.charCodeAt(T)))==55296&&T+1<N&&(64512&(E=p.charCodeAt(T+1)))==56320&&(k=65536+(k-55296<<10)+(E-56320),T++),k<128?g[v++]=k:(k<2048?g[v++]=192|k>>>6:(k<65536?g[v++]=224|k>>>12:(g[v++]=240|k>>>18,g[v++]=128|k>>>12&63),g[v++]=128|k>>>6&63),g[v++]=128|63&k);return g}(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):function(p){var g,k,E,T,v=p.length,N=new Array(2*v);for(g=k=0;g<v;)if((E=p[g++])<128)N[k++]=E;else if(4<(T=u[E]))N[k++]=65533,g+=T-1;else{for(E&=T===2?31:T===3?15:7;1<T&&g<v;)E=E<<6|63&p[g++],T--;1<T?N[k++]=65533:E<65536?N[k++]=E:(E-=65536,N[k++]=55296|E>>10&1023,N[k++]=56320|1023&E)}return N.length!==k&&(N.subarray?N=N.subarray(0,k):N.length=k),s.applyFromCharCode(N)}(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var g=p;(p=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),p.set(g,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var k=function(T,v){var N;for((v=v||T.length)>T.length&&(v=T.length),N=v-1;0<=N&&(192&T[N])==128;)N--;return N<0||N===0?v:N+u[T[N]]>v?N:v}(p),E=p;k!==p.length&&(o.uint8array?(E=p.subarray(0,k),this.leftOver=p.subarray(k,p.length)):(E=p.slice(0,k),this.leftOver=p.slice(k,p.length))),this.push({data:i.utf8decode(E),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function u(g){return g}function l(g,k){for(var E=0;E<g.length;++E)k[E]=255&g.charCodeAt(E);return k}n("setimmediate"),i.newBlob=function(g,k){i.checkSupport("blob");try{return new Blob([g],{type:k})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(g),E.getBlob(k)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(g,k,E){var T=[],v=0,N=g.length;if(N<=E)return String.fromCharCode.apply(null,g);for(;v<N;)k==="array"||k==="nodebuffer"?T.push(String.fromCharCode.apply(null,g.slice(v,Math.min(v+E,N)))):T.push(String.fromCharCode.apply(null,g.subarray(v,Math.min(v+E,N)))),v+=E;return T.join("")},stringifyByChar:function(g){for(var k="",E=0;E<g.length;E++)k+=String.fromCharCode(g[E]);return k},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(g){var k=65536,E=i.getTypeOf(g),T=!0;if(E==="uint8array"?T=h.applyCanBeUsed.uint8array:E==="nodebuffer"&&(T=h.applyCanBeUsed.nodebuffer),T)for(;1<k;)try{return h.stringifyByChunk(g,E,k)}catch{k=Math.floor(k/2)}return h.stringifyByChar(g)}function d(g,k){for(var E=0;E<g.length;E++)k[E]=g[E];return k}i.applyFromCharCode=f;var p={};p.string={string:u,array:function(g){return l(g,new Array(g.length))},arraybuffer:function(g){return p.string.uint8array(g).buffer},uint8array:function(g){return l(g,new Uint8Array(g.length))},nodebuffer:function(g){return l(g,a.allocBuffer(g.length))}},p.array={string:f,array:u,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},p.arraybuffer={string:function(g){return f(new Uint8Array(g))},array:function(g){return d(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:u,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},p.uint8array={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:u,nodebuffer:function(g){return a.newBufferFrom(g)}},p.nodebuffer={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return p.nodebuffer.uint8array(g).buffer},uint8array:function(g){return d(g,new Uint8Array(g.length))},nodebuffer:u},i.transformTo=function(g,k){if(k=k||"",!g)return k;i.checkSupport(g);var E=i.getTypeOf(k);return p[E][g](k)},i.resolve=function(g){for(var k=g.split("/"),E=[],T=0;T<k.length;T++){var v=k[T];v==="."||v===""&&T!==0&&T!==k.length-1||(v===".."?E.pop():E.push(v))}return E.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(g)?"nodebuffer":s.uint8array&&g instanceof Uint8Array?"uint8array":s.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!s[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var k,E,T="";for(E=0;E<(g||"").length;E++)T+="\\x"+((k=g.charCodeAt(E))<16?"0":"")+k.toString(16).toUpperCase();return T},i.delay=function(g,k,E){setImmediate(function(){g.apply(E||null,k||[])})},i.inherits=function(g,k){function E(){}E.prototype=k.prototype,g.prototype=new E},i.extend=function(){var g,k,E={};for(g=0;g<arguments.length;g++)for(k in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],k)&&E[k]===void 0&&(E[k]=arguments[g][k]);return E},i.prepareContent=function(g,k,E,T,v){return c.Promise.resolve(k).then(function(N){return s.blob&&(N instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(N))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,L){var O=new FileReader;O.onload=function(B){U(B.target.result)},O.onerror=function(B){L(B.target.error)},O.readAsArrayBuffer(N)}):N}).then(function(N){var U=i.getTypeOf(N);return U?(U==="arraybuffer"?N=i.transformTo("uint8array",N):U==="string"&&(v?N=o.decode(N):E&&T!==!0&&(N=function(L){return l(L,s.uint8array?new Uint8Array(L.length):new Array(L.length))}(N))),N):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),u=n("./support");function l(h){this.files=[],this.loadOptions=h}l.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),u=n("./utf8"),l=n("./compressions"),h=n("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,g;if(d.skip(22),this.fileNameLength=d.readInt(2),g=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(k){for(var E in l)if(Object.prototype.hasOwnProperty.call(l,E)&&l[E].magic===k)return l[E];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,g,k,E=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<E;)p=d.readInt(2),g=d.readInt(2),k=d.readData(g),this.extraFields[p]={id:p,length:g,value:k};d.setIndex(E)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var g=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var k=this.findExtraFieldUnicodeComment();if(k!==null)this.fileCommentStr=k;else{var E=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:u.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(p,g,k){this.name=p,this.dir=k.dir,this.date=k.date,this.comment=k.comment,this.unixPermissions=k.unixPermissions,this.dosPermissions=k.dosPermissions,this._data=g,this._dataBinary=k.binary,this.options={compression:k.compression,compressionOptions:k.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),u=n("./compressedObject"),l=n("./stream/GenericWorker");s.prototype={internalStream:function(p){var g=null,k="string";try{if(!p)throw new Error("No output type specified.");var E=(k=p.toLowerCase())==="string"||k==="text";k!=="binarystring"&&k!=="text"||(k="string"),g=this._decompressWorker();var T=!this._dataBinary;T&&!E&&(g=g.pipe(new c.Utf8EncodeWorker)),!T&&E&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(v){(g=new l("error")).error(v)}return new o(g,k,"")},async:function(p,g){return this.internalStream(p).accumulate(g)},nodeStream:function(p,g){return this.internalStream(p||"nodebuffer").toNodejsStream(g)},_compressWorker:function(p,g){if(this._data instanceof u&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var k=this._decompressWorker();return this._dataBinary||(k=k.pipe(new c.Utf8EncodeWorker)),u.createWorkerFrom(k,p,g)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof l?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var u=0,l=new c(p),h=s.document.createTextNode("");l.observe(h,{characterData:!0}),o=function(){h.data=u=++u%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var g=s.document.createElement("script");g.onreadystatechange=function(){p(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},s.document.documentElement.appendChild(g)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var g,k;a=!0;for(var E=d.length;E;){for(k=d,d=[],g=-1;++g<E;)k[g]();E=d.length}a=!1}r.exports=function(g){d.push(g)!==1||a||o()}}).call(this,typeof _n<"u"?_n:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],u=["FULFILLED"],l=["PENDING"];function h(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,E!==o&&g(this,E)}function f(E,T,v){this.promise=E,typeof T=="function"&&(this.onFulfilled=T,this.callFulfilled=this.otherCallFulfilled),typeof v=="function"&&(this.onRejected=v,this.callRejected=this.otherCallRejected)}function d(E,T,v){s(function(){var N;try{N=T(v)}catch(U){return a.reject(E,U)}N===E?a.reject(E,new TypeError("Cannot resolve promise with itself")):a.resolve(E,N)})}function p(E){var T=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof T=="function")return function(){T.apply(E,arguments)}}function g(E,T){var v=!1;function N(O){v||(v=!0,a.reject(E,O))}function U(O){v||(v=!0,a.resolve(E,O))}var L=k(function(){T(U,N)});L.status==="error"&&N(L.value)}function k(E,T){var v={};try{v.value=E(T),v.status="success"}catch(N){v.status="error",v.value=N}return v}(r.exports=h).prototype.finally=function(E){if(typeof E!="function")return this;var T=this.constructor;return this.then(function(v){return T.resolve(E()).then(function(){return v})},function(v){return T.resolve(E()).then(function(){throw v})})},h.prototype.catch=function(E){return this.then(null,E)},h.prototype.then=function(E,T){if(typeof E!="function"&&this.state===u||typeof T!="function"&&this.state===c)return this;var v=new this.constructor(o);return this.state!==l?d(v,this.state===u?E:T,this.outcome):this.queue.push(new f(v,E,T)),v},f.prototype.callFulfilled=function(E){a.resolve(this.promise,E)},f.prototype.otherCallFulfilled=function(E){d(this.promise,this.onFulfilled,E)},f.prototype.callRejected=function(E){a.reject(this.promise,E)},f.prototype.otherCallRejected=function(E){d(this.promise,this.onRejected,E)},a.resolve=function(E,T){var v=k(p,T);if(v.status==="error")return a.reject(E,v.value);var N=v.value;if(N)g(E,N);else{E.state=u,E.outcome=T;for(var U=-1,L=E.queue.length;++U<L;)E.queue[U].callFulfilled(T)}return E},a.reject=function(E,T){E.state=c,E.outcome=T;for(var v=-1,N=E.queue.length;++v<N;)E.queue[v].callRejected(T);return E},h.resolve=function(E){return E instanceof this?E:a.resolve(new this(o),E)},h.reject=function(E){var T=new this(o);return a.reject(T,E)},h.all=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=E.length,N=!1;if(!v)return this.resolve([]);for(var U=new Array(v),L=0,O=-1,B=new this(o);++O<v;)F(E[O],O);return B;function F(nt,dt){T.resolve(nt).then(function(M){U[dt]=M,++L!==v||N||(N=!0,a.resolve(B,U))},function(M){N||(N=!0,a.reject(B,M))})}},h.race=function(E){var T=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var v=E.length,N=!1;if(!v)return this.resolve([]);for(var U=-1,L=new this(o);++U<v;)O=E[U],T.resolve(O).then(function(B){N||(N=!0,a.resolve(L,B))},function(B){N||(N=!0,a.reject(L,B))});var O;return L}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),u=n("./zlib/zstream"),l=Object.prototype.toString,h=0,f=-1,d=0,p=8;function g(E){if(!(this instanceof g))return new g(E);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},E||{});var T=this.options;T.raw&&0<T.windowBits?T.windowBits=-T.windowBits:T.gzip&&0<T.windowBits&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var v=s.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(v!==h)throw new Error(c[v]);if(T.header&&s.deflateSetHeader(this.strm,T.header),T.dictionary){var N;if(N=typeof T.dictionary=="string"?a.string2buf(T.dictionary):l.call(T.dictionary)==="[object ArrayBuffer]"?new Uint8Array(T.dictionary):T.dictionary,(v=s.deflateSetDictionary(this.strm,N))!==h)throw new Error(c[v]);this._dict_set=!0}}function k(E,T){var v=new g(T);if(v.push(E,!0),v.err)throw v.msg||c[v.err];return v.result}g.prototype.push=function(E,T){var v,N,U=this.strm,L=this.options.chunkSize;if(this.ended)return!1;N=T===~~T?T:T===!0?4:0,typeof E=="string"?U.input=a.string2buf(E):l.call(E)==="[object ArrayBuffer]"?U.input=new Uint8Array(E):U.input=E,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(L),U.next_out=0,U.avail_out=L),(v=s.deflate(U,N))!==1&&v!==h)return this.onEnd(v),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||N!==4&&N!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&v!==1);return N===4?(v=s.deflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===h):N!==2||(this.onEnd(h),!(U.avail_out=0))},g.prototype.onData=function(E){this.chunks.push(E)},g.prototype.onEnd=function(E){E===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=g,i.deflate=k,i.deflateRaw=function(E,T){return(T=T||{}).raw=!0,k(E,T)},i.gzip=function(E,T){return(T=T||{}).gzip=!0,k(E,T)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),u=n("./zlib/messages"),l=n("./zlib/zstream"),h=n("./zlib/gzheader"),f=Object.prototype.toString;function d(g){if(!(this instanceof d))return new d(g);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},g||{});var k=this.options;k.raw&&0<=k.windowBits&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15)),!(0<=k.windowBits&&k.windowBits<16)||g&&g.windowBits||(k.windowBits+=32),15<k.windowBits&&k.windowBits<48&&!(15&k.windowBits)&&(k.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var E=s.inflateInit2(this.strm,k.windowBits);if(E!==c.Z_OK)throw new Error(u[E]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(g,k){var E=new d(k);if(E.push(g,!0),E.err)throw E.msg||u[E.err];return E.result}d.prototype.push=function(g,k){var E,T,v,N,U,L,O=this.strm,B=this.options.chunkSize,F=this.options.dictionary,nt=!1;if(this.ended)return!1;T=k===~~k?k:k===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?O.input=a.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?O.input=new Uint8Array(g):O.input=g,O.next_in=0,O.avail_in=O.input.length;do{if(O.avail_out===0&&(O.output=new o.Buf8(B),O.next_out=0,O.avail_out=B),(E=s.inflate(O,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&F&&(L=typeof F=="string"?a.string2buf(F):f.call(F)==="[object ArrayBuffer]"?new Uint8Array(F):F,E=s.inflateSetDictionary(this.strm,L)),E===c.Z_BUF_ERROR&&nt===!0&&(E=c.Z_OK,nt=!1),E!==c.Z_STREAM_END&&E!==c.Z_OK)return this.onEnd(E),!(this.ended=!0);O.next_out&&(O.avail_out!==0&&E!==c.Z_STREAM_END&&(O.avail_in!==0||T!==c.Z_FINISH&&T!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(v=a.utf8border(O.output,O.next_out),N=O.next_out-v,U=a.buf2string(O.output,v),O.next_out=N,O.avail_out=B-N,N&&o.arraySet(O.output,O.output,v,N,0),this.onData(U)):this.onData(o.shrinkBuf(O.output,O.next_out)))),O.avail_in===0&&O.avail_out===0&&(nt=!0)}while((0<O.avail_in||O.avail_out===0)&&E!==c.Z_STREAM_END);return E===c.Z_STREAM_END&&(T=c.Z_FINISH),T===c.Z_FINISH?(E=s.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===c.Z_OK):T!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(O.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(g,k){return(k=k||{}).raw=!0,p(g,k)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var l=u.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var h in l)l.hasOwnProperty(h)&&(c[h]=l[h])}}return c},i.shrinkBuf=function(c,u){return c.length===u?c:c.subarray?c.subarray(0,u):(c.length=u,c)};var o={arraySet:function(c,u,l,h,f){if(u.subarray&&c.subarray)c.set(u.subarray(l,l+h),f);else for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){var u,l,h,f,d,p;for(u=h=0,l=c.length;u<l;u++)h+=c[u].length;for(p=new Uint8Array(h),u=f=0,l=c.length;u<l;u++)d=c[u],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,u,l,h,f){for(var d=0;d<h;d++)c[f+d]=u[l+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function l(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,g,k,E=h.length,T=0;for(g=0;g<E;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<E&&(64512&(p=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),g++),T+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(T),g=k=0;k<T;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<E&&(64512&(p=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),g++),d<128?f[k++]=d:(d<2048?f[k++]=192|d>>>6:(d<65536?f[k++]=224|d>>>12:(f[k++]=240|d>>>18,f[k++]=128|d>>>12&63),f[k++]=128|d>>>6&63),f[k++]=128|63&d);return f},i.buf2binstring=function(h){return l(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,g,k,E=f||h.length,T=new Array(2*E);for(d=p=0;d<E;)if((g=h[d++])<128)T[p++]=g;else if(4<(k=c[g]))T[p++]=65533,d+=k-1;else{for(g&=k===2?31:k===3?15:7;1<k&&d<E;)g=g<<6|63&h[d++],k--;1<k?T[p++]=65533:g<65536?T[p++]=g:(g-=65536,T[p++]=55296|g>>10&1023,T[p++]=56320|1023&g)}return l(T,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var u=65535&s|0,l=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;l=l+(u=u+o[c++]|0)|0,--h;);u%=65521,l%=65521}return u|l<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,u){var l=s,h=u+c;o^=-1;for(var f=u;f<h;f++)o=o>>>8^l[255&(o^a[f])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),u=n("./crc32"),l=n("./messages"),h=0,f=4,d=0,p=-2,g=-1,k=4,E=2,T=8,v=9,N=286,U=30,L=19,O=2*N+1,B=15,F=3,nt=258,dt=nt+F+1,M=42,R=113,_=1,P=2,Z=3,j=4;function ut(b,rt){return b.msg=l[rt],rt}function tt(b){return(b<<1)-(4<b?9:0)}function ht(b){for(var rt=b.length;0<=--rt;)b[rt]=0}function G(b){var rt=b.state,Q=rt.pending;Q>b.avail_out&&(Q=b.avail_out),Q!==0&&(o.arraySet(b.output,rt.pending_buf,rt.pending_out,Q,b.next_out),b.next_out+=Q,rt.pending_out+=Q,b.total_out+=Q,b.avail_out-=Q,rt.pending-=Q,rt.pending===0&&(rt.pending_out=0))}function z(b,rt){a._tr_flush_block(b,0<=b.block_start?b.block_start:-1,b.strstart-b.block_start,rt),b.block_start=b.strstart,G(b.strm)}function bt(b,rt){b.pending_buf[b.pending++]=rt}function st(b,rt){b.pending_buf[b.pending++]=rt>>>8&255,b.pending_buf[b.pending++]=255&rt}function at(b,rt){var Q,C,I=b.max_chain_length,H=b.strstart,ot=b.prev_length,lt=b.nice_match,X=b.strstart>b.w_size-dt?b.strstart-(b.w_size-dt):0,pt=b.window,_t=b.w_mask,ft=b.prev,vt=b.strstart+nt,ce=pt[H+ot-1],Mt=pt[H+ot];b.prev_length>=b.good_match&&(I>>=2),lt>b.lookahead&&(lt=b.lookahead);do if(pt[(Q=rt)+ot]===Mt&&pt[Q+ot-1]===ce&&pt[Q]===pt[H]&&pt[++Q]===pt[H+1]){H+=2,Q++;do;while(pt[++H]===pt[++Q]&&pt[++H]===pt[++Q]&&pt[++H]===pt[++Q]&&pt[++H]===pt[++Q]&&pt[++H]===pt[++Q]&&pt[++H]===pt[++Q]&&pt[++H]===pt[++Q]&&pt[++H]===pt[++Q]&&H<vt);if(C=nt-(vt-H),H=vt-nt,ot<C){if(b.match_start=rt,lt<=(ot=C))break;ce=pt[H+ot-1],Mt=pt[H+ot]}}while((rt=ft[rt&_t])>X&&--I!=0);return ot<=b.lookahead?ot:b.lookahead}function Ct(b){var rt,Q,C,I,H,ot,lt,X,pt,_t,ft=b.w_size;do{if(I=b.window_size-b.lookahead-b.strstart,b.strstart>=ft+(ft-dt)){for(o.arraySet(b.window,b.window,ft,ft,0),b.match_start-=ft,b.strstart-=ft,b.block_start-=ft,rt=Q=b.hash_size;C=b.head[--rt],b.head[rt]=ft<=C?C-ft:0,--Q;);for(rt=Q=ft;C=b.prev[--rt],b.prev[rt]=ft<=C?C-ft:0,--Q;);I+=ft}if(b.strm.avail_in===0)break;if(ot=b.strm,lt=b.window,X=b.strstart+b.lookahead,pt=I,_t=void 0,_t=ot.avail_in,pt<_t&&(_t=pt),Q=_t===0?0:(ot.avail_in-=_t,o.arraySet(lt,ot.input,ot.next_in,_t,X),ot.state.wrap===1?ot.adler=c(ot.adler,lt,_t,X):ot.state.wrap===2&&(ot.adler=u(ot.adler,lt,_t,X)),ot.next_in+=_t,ot.total_in+=_t,_t),b.lookahead+=Q,b.lookahead+b.insert>=F)for(H=b.strstart-b.insert,b.ins_h=b.window[H],b.ins_h=(b.ins_h<<b.hash_shift^b.window[H+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[H+F-1])&b.hash_mask,b.prev[H&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=H,H++,b.insert--,!(b.lookahead+b.insert<F)););}while(b.lookahead<dt&&b.strm.avail_in!==0)}function Zt(b,rt){for(var Q,C;;){if(b.lookahead<dt){if(Ct(b),b.lookahead<dt&&rt===h)return _;if(b.lookahead===0)break}if(Q=0,b.lookahead>=F&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+F-1])&b.hash_mask,Q=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),Q!==0&&b.strstart-Q<=b.w_size-dt&&(b.match_length=at(b,Q)),b.match_length>=F)if(C=a._tr_tally(b,b.strstart-b.match_start,b.match_length-F),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=F){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+F-1])&b.hash_mask,Q=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,--b.match_length!=0;);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else C=a._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(C&&(z(b,!1),b.strm.avail_out===0))return _}return b.insert=b.strstart<F-1?b.strstart:F-1,rt===f?(z(b,!0),b.strm.avail_out===0?Z:j):b.last_lit&&(z(b,!1),b.strm.avail_out===0)?_:P}function At(b,rt){for(var Q,C,I;;){if(b.lookahead<dt){if(Ct(b),b.lookahead<dt&&rt===h)return _;if(b.lookahead===0)break}if(Q=0,b.lookahead>=F&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+F-1])&b.hash_mask,Q=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=F-1,Q!==0&&b.prev_length<b.max_lazy_match&&b.strstart-Q<=b.w_size-dt&&(b.match_length=at(b,Q),b.match_length<=5&&(b.strategy===1||b.match_length===F&&4096<b.strstart-b.match_start)&&(b.match_length=F-1)),b.prev_length>=F&&b.match_length<=b.prev_length){for(I=b.strstart+b.lookahead-F,C=a._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-F),b.lookahead-=b.prev_length-1,b.prev_length-=2;++b.strstart<=I&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+F-1])&b.hash_mask,Q=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),--b.prev_length!=0;);if(b.match_available=0,b.match_length=F-1,b.strstart++,C&&(z(b,!1),b.strm.avail_out===0))return _}else if(b.match_available){if((C=a._tr_tally(b,0,b.window[b.strstart-1]))&&z(b,!1),b.strstart++,b.lookahead--,b.strm.avail_out===0)return _}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(C=a._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<F-1?b.strstart:F-1,rt===f?(z(b,!0),b.strm.avail_out===0?Z:j):b.last_lit&&(z(b,!1),b.strm.avail_out===0)?_:P}function xt(b,rt,Q,C,I){this.good_length=b,this.max_lazy=rt,this.nice_length=Q,this.max_chain=C,this.func=I}function Dt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*O),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*L+1)),ht(this.dyn_ltree),ht(this.dyn_dtree),ht(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(B+1),this.heap=new o.Buf16(2*N+1),ht(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*N+1),ht(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Wt(b){var rt;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=E,(rt=b.state).pending=0,rt.pending_out=0,rt.wrap<0&&(rt.wrap=-rt.wrap),rt.status=rt.wrap?M:R,b.adler=rt.wrap===2?0:1,rt.last_flush=h,a._tr_init(rt),d):ut(b,p)}function _e(b){var rt=Wt(b);return rt===d&&function(Q){Q.window_size=2*Q.w_size,ht(Q.head),Q.max_lazy_match=s[Q.level].max_lazy,Q.good_match=s[Q.level].good_length,Q.nice_match=s[Q.level].nice_length,Q.max_chain_length=s[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=F-1,Q.match_available=0,Q.ins_h=0}(b.state),rt}function Re(b,rt,Q,C,I,H){if(!b)return p;var ot=1;if(rt===g&&(rt=6),C<0?(ot=0,C=-C):15<C&&(ot=2,C-=16),I<1||v<I||Q!==T||C<8||15<C||rt<0||9<rt||H<0||k<H)return ut(b,p);C===8&&(C=9);var lt=new Dt;return(b.state=lt).strm=b,lt.wrap=ot,lt.gzhead=null,lt.w_bits=C,lt.w_size=1<<lt.w_bits,lt.w_mask=lt.w_size-1,lt.hash_bits=I+7,lt.hash_size=1<<lt.hash_bits,lt.hash_mask=lt.hash_size-1,lt.hash_shift=~~((lt.hash_bits+F-1)/F),lt.window=new o.Buf8(2*lt.w_size),lt.head=new o.Buf16(lt.hash_size),lt.prev=new o.Buf16(lt.w_size),lt.lit_bufsize=1<<I+6,lt.pending_buf_size=4*lt.lit_bufsize,lt.pending_buf=new o.Buf8(lt.pending_buf_size),lt.d_buf=1*lt.lit_bufsize,lt.l_buf=3*lt.lit_bufsize,lt.level=rt,lt.strategy=H,lt.method=Q,_e(b)}s=[new xt(0,0,0,0,function(b,rt){var Q=65535;for(Q>b.pending_buf_size-5&&(Q=b.pending_buf_size-5);;){if(b.lookahead<=1){if(Ct(b),b.lookahead===0&&rt===h)return _;if(b.lookahead===0)break}b.strstart+=b.lookahead,b.lookahead=0;var C=b.block_start+Q;if((b.strstart===0||b.strstart>=C)&&(b.lookahead=b.strstart-C,b.strstart=C,z(b,!1),b.strm.avail_out===0)||b.strstart-b.block_start>=b.w_size-dt&&(z(b,!1),b.strm.avail_out===0))return _}return b.insert=0,rt===f?(z(b,!0),b.strm.avail_out===0?Z:j):(b.strstart>b.block_start&&(z(b,!1),b.strm.avail_out),_)}),new xt(4,4,8,4,Zt),new xt(4,5,16,8,Zt),new xt(4,6,32,32,Zt),new xt(4,4,16,16,At),new xt(8,16,32,32,At),new xt(8,16,128,128,At),new xt(8,32,128,256,At),new xt(32,128,258,1024,At),new xt(32,258,258,4096,At)],i.deflateInit=function(b,rt){return Re(b,rt,T,15,8,0)},i.deflateInit2=Re,i.deflateReset=_e,i.deflateResetKeep=Wt,i.deflateSetHeader=function(b,rt){return b&&b.state?b.state.wrap!==2?p:(b.state.gzhead=rt,d):p},i.deflate=function(b,rt){var Q,C,I,H;if(!b||!b.state||5<rt||rt<0)return b?ut(b,p):p;if(C=b.state,!b.output||!b.input&&b.avail_in!==0||C.status===666&&rt!==f)return ut(b,b.avail_out===0?-5:p);if(C.strm=b,Q=C.last_flush,C.last_flush=rt,C.status===M)if(C.wrap===2)b.adler=0,bt(C,31),bt(C,139),bt(C,8),C.gzhead?(bt(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),bt(C,255&C.gzhead.time),bt(C,C.gzhead.time>>8&255),bt(C,C.gzhead.time>>16&255),bt(C,C.gzhead.time>>24&255),bt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),bt(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(bt(C,255&C.gzhead.extra.length),bt(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(b.adler=u(b.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(bt(C,0),bt(C,0),bt(C,0),bt(C,0),bt(C,0),bt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),bt(C,3),C.status=R);else{var ot=T+(C.w_bits-8<<4)<<8;ot|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(ot|=32),ot+=31-ot%31,C.status=R,st(C,ot),C.strstart!==0&&(st(C,b.adler>>>16),st(C,65535&b.adler)),b.adler=1}if(C.status===69)if(C.gzhead.extra){for(I=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),G(b),I=C.pending,C.pending!==C.pending_buf_size));)bt(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){I=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),G(b),I=C.pending,C.pending===C.pending_buf_size)){H=1;break}H=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,bt(C,H)}while(H!==0);C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),H===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){I=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),G(b),I=C.pending,C.pending===C.pending_buf_size)){H=1;break}H=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,bt(C,H)}while(H!==0);C.gzhead.hcrc&&C.pending>I&&(b.adler=u(b.adler,C.pending_buf,C.pending-I,I)),H===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&G(b),C.pending+2<=C.pending_buf_size&&(bt(C,255&b.adler),bt(C,b.adler>>8&255),b.adler=0,C.status=R)):C.status=R),C.pending!==0){if(G(b),b.avail_out===0)return C.last_flush=-1,d}else if(b.avail_in===0&&tt(rt)<=tt(Q)&&rt!==f)return ut(b,-5);if(C.status===666&&b.avail_in!==0)return ut(b,-5);if(b.avail_in!==0||C.lookahead!==0||rt!==h&&C.status!==666){var lt=C.strategy===2?function(X,pt){for(var _t;;){if(X.lookahead===0&&(Ct(X),X.lookahead===0)){if(pt===h)return _;break}if(X.match_length=0,_t=a._tr_tally(X,0,X.window[X.strstart]),X.lookahead--,X.strstart++,_t&&(z(X,!1),X.strm.avail_out===0))return _}return X.insert=0,pt===f?(z(X,!0),X.strm.avail_out===0?Z:j):X.last_lit&&(z(X,!1),X.strm.avail_out===0)?_:P}(C,rt):C.strategy===3?function(X,pt){for(var _t,ft,vt,ce,Mt=X.window;;){if(X.lookahead<=nt){if(Ct(X),X.lookahead<=nt&&pt===h)return _;if(X.lookahead===0)break}if(X.match_length=0,X.lookahead>=F&&0<X.strstart&&(ft=Mt[vt=X.strstart-1])===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]){ce=X.strstart+nt;do;while(ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&ft===Mt[++vt]&&vt<ce);X.match_length=nt-(ce-vt),X.match_length>X.lookahead&&(X.match_length=X.lookahead)}if(X.match_length>=F?(_t=a._tr_tally(X,1,X.match_length-F),X.lookahead-=X.match_length,X.strstart+=X.match_length,X.match_length=0):(_t=a._tr_tally(X,0,X.window[X.strstart]),X.lookahead--,X.strstart++),_t&&(z(X,!1),X.strm.avail_out===0))return _}return X.insert=0,pt===f?(z(X,!0),X.strm.avail_out===0?Z:j):X.last_lit&&(z(X,!1),X.strm.avail_out===0)?_:P}(C,rt):s[C.level].func(C,rt);if(lt!==Z&&lt!==j||(C.status=666),lt===_||lt===Z)return b.avail_out===0&&(C.last_flush=-1),d;if(lt===P&&(rt===1?a._tr_align(C):rt!==5&&(a._tr_stored_block(C,0,0,!1),rt===3&&(ht(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),G(b),b.avail_out===0))return C.last_flush=-1,d}return rt!==f?d:C.wrap<=0?1:(C.wrap===2?(bt(C,255&b.adler),bt(C,b.adler>>8&255),bt(C,b.adler>>16&255),bt(C,b.adler>>24&255),bt(C,255&b.total_in),bt(C,b.total_in>>8&255),bt(C,b.total_in>>16&255),bt(C,b.total_in>>24&255)):(st(C,b.adler>>>16),st(C,65535&b.adler)),G(b),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?d:1)},i.deflateEnd=function(b){var rt;return b&&b.state?(rt=b.state.status)!==M&&rt!==69&&rt!==73&&rt!==91&&rt!==103&&rt!==R&&rt!==666?ut(b,p):(b.state=null,rt===R?ut(b,-3):d):p},i.deflateSetDictionary=function(b,rt){var Q,C,I,H,ot,lt,X,pt,_t=rt.length;if(!b||!b.state||(H=(Q=b.state).wrap)===2||H===1&&Q.status!==M||Q.lookahead)return p;for(H===1&&(b.adler=c(b.adler,rt,_t,0)),Q.wrap=0,_t>=Q.w_size&&(H===0&&(ht(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0),pt=new o.Buf8(Q.w_size),o.arraySet(pt,rt,_t-Q.w_size,Q.w_size,0),rt=pt,_t=Q.w_size),ot=b.avail_in,lt=b.next_in,X=b.input,b.avail_in=_t,b.next_in=0,b.input=rt,Ct(Q);Q.lookahead>=F;){for(C=Q.strstart,I=Q.lookahead-(F-1);Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[C+F-1])&Q.hash_mask,Q.prev[C&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=C,C++,--I;);Q.strstart=C,Q.lookahead=F-1,Ct(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=F-1,Q.match_available=0,b.next_in=lt,b.input=X,b.avail_in=ot,Q.wrap=H,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,u,l,h,f,d,p,g,k,E,T,v,N,U,L,O,B,F,nt,dt,M,R,_,P;a=s.state,c=s.next_in,_=s.input,u=c+(s.avail_in-5),l=s.next_out,P=s.output,h=l-(o-s.avail_out),f=l+(s.avail_out-257),d=a.dmax,p=a.wsize,g=a.whave,k=a.wnext,E=a.window,T=a.hold,v=a.bits,N=a.lencode,U=a.distcode,L=(1<<a.lenbits)-1,O=(1<<a.distbits)-1;t:do{v<15&&(T+=_[c++]<<v,v+=8,T+=_[c++]<<v,v+=8),B=N[T&L];e:for(;;){if(T>>>=F=B>>>24,v-=F,(F=B>>>16&255)===0)P[l++]=65535&B;else{if(!(16&F)){if(!(64&F)){B=N[(65535&B)+(T&(1<<F)-1)];continue e}if(32&F){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}nt=65535&B,(F&=15)&&(v<F&&(T+=_[c++]<<v,v+=8),nt+=T&(1<<F)-1,T>>>=F,v-=F),v<15&&(T+=_[c++]<<v,v+=8,T+=_[c++]<<v,v+=8),B=U[T&O];n:for(;;){if(T>>>=F=B>>>24,v-=F,!(16&(F=B>>>16&255))){if(!(64&F)){B=U[(65535&B)+(T&(1<<F)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(dt=65535&B,v<(F&=15)&&(T+=_[c++]<<v,(v+=8)<F&&(T+=_[c++]<<v,v+=8)),d<(dt+=T&(1<<F)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(T>>>=F,v-=F,(F=l-h)<dt){if(g<(F=dt-F)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(R=E,(M=0)===k){if(M+=p-F,F<nt){for(nt-=F;P[l++]=E[M++],--F;);M=l-dt,R=P}}else if(k<F){if(M+=p+k-F,(F-=k)<nt){for(nt-=F;P[l++]=E[M++],--F;);if(M=0,k<nt){for(nt-=F=k;P[l++]=E[M++],--F;);M=l-dt,R=P}}}else if(M+=k-F,F<nt){for(nt-=F;P[l++]=E[M++],--F;);M=l-dt,R=P}for(;2<nt;)P[l++]=R[M++],P[l++]=R[M++],P[l++]=R[M++],nt-=3;nt&&(P[l++]=R[M++],1<nt&&(P[l++]=R[M++]))}else{for(M=l-dt;P[l++]=P[M++],P[l++]=P[M++],P[l++]=P[M++],2<(nt-=3););nt&&(P[l++]=P[M++],1<nt&&(P[l++]=P[M++]))}break}}break}}while(c<u&&l<f);c-=nt=v>>3,T&=(1<<(v-=nt<<3))-1,s.next_in=c,s.next_out=l,s.avail_in=c<u?u-c+5:5-(c-u),s.avail_out=l<f?f-l+257:257-(l-f),a.hold=T,a.bits=v}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),u=n("./inftrees"),l=1,h=2,f=0,d=-2,p=1,g=852,k=592;function E(M){return(M>>>24&255)+(M>>>8&65280)+((65280&M)<<8)+((255&M)<<24)}function T(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function v(M){var R;return M&&M.state?(R=M.state,M.total_in=M.total_out=R.total=0,M.msg="",R.wrap&&(M.adler=1&R.wrap),R.mode=p,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new s.Buf32(g),R.distcode=R.distdyn=new s.Buf32(k),R.sane=1,R.back=-1,f):d}function N(M){var R;return M&&M.state?((R=M.state).wsize=0,R.whave=0,R.wnext=0,v(M)):d}function U(M,R){var _,P;return M&&M.state?(P=M.state,R<0?(_=0,R=-R):(_=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?d:(P.window!==null&&P.wbits!==R&&(P.window=null),P.wrap=_,P.wbits=R,N(M))):d}function L(M,R){var _,P;return M?(P=new T,(M.state=P).window=null,(_=U(M,R))!==f&&(M.state=null),_):d}var O,B,F=!0;function nt(M){if(F){var R;for(O=new s.Buf32(512),B=new s.Buf32(32),R=0;R<144;)M.lens[R++]=8;for(;R<256;)M.lens[R++]=9;for(;R<280;)M.lens[R++]=7;for(;R<288;)M.lens[R++]=8;for(u(l,M.lens,0,288,O,0,M.work,{bits:9}),R=0;R<32;)M.lens[R++]=5;u(h,M.lens,0,32,B,0,M.work,{bits:5}),F=!1}M.lencode=O,M.lenbits=9,M.distcode=B,M.distbits=5}function dt(M,R,_,P){var Z,j=M.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),P>=j.wsize?(s.arraySet(j.window,R,_-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(P<(Z=j.wsize-j.wnext)&&(Z=P),s.arraySet(j.window,R,_-P,Z,j.wnext),(P-=Z)?(s.arraySet(j.window,R,_-P,P,0),j.wnext=P,j.whave=j.wsize):(j.wnext+=Z,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=Z))),0}i.inflateReset=N,i.inflateReset2=U,i.inflateResetKeep=v,i.inflateInit=function(M){return L(M,15)},i.inflateInit2=L,i.inflate=function(M,R){var _,P,Z,j,ut,tt,ht,G,z,bt,st,at,Ct,Zt,At,xt,Dt,Wt,_e,Re,b,rt,Q,C,I=0,H=new s.Buf8(4),ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!M||!M.state||!M.output||!M.input&&M.avail_in!==0)return d;(_=M.state).mode===12&&(_.mode=13),ut=M.next_out,Z=M.output,ht=M.avail_out,j=M.next_in,P=M.input,tt=M.avail_in,G=_.hold,z=_.bits,bt=tt,st=ht,rt=f;t:for(;;)switch(_.mode){case p:if(_.wrap===0){_.mode=13;break}for(;z<16;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(2&_.wrap&&G===35615){H[_.check=0]=255&G,H[1]=G>>>8&255,_.check=a(_.check,H,2,0),z=G=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&G)<<8)+(G>>8))%31){M.msg="incorrect header check",_.mode=30;break}if((15&G)!=8){M.msg="unknown compression method",_.mode=30;break}if(z-=4,b=8+(15&(G>>>=4)),_.wbits===0)_.wbits=b;else if(b>_.wbits){M.msg="invalid window size",_.mode=30;break}_.dmax=1<<b,M.adler=_.check=1,_.mode=512&G?10:12,z=G=0;break;case 2:for(;z<16;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(_.flags=G,(255&_.flags)!=8){M.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){M.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=G>>8&1),512&_.flags&&(H[0]=255&G,H[1]=G>>>8&255,_.check=a(_.check,H,2,0)),z=G=0,_.mode=3;case 3:for(;z<32;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}_.head&&(_.head.time=G),512&_.flags&&(H[0]=255&G,H[1]=G>>>8&255,H[2]=G>>>16&255,H[3]=G>>>24&255,_.check=a(_.check,H,4,0)),z=G=0,_.mode=4;case 4:for(;z<16;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}_.head&&(_.head.xflags=255&G,_.head.os=G>>8),512&_.flags&&(H[0]=255&G,H[1]=G>>>8&255,_.check=a(_.check,H,2,0)),z=G=0,_.mode=5;case 5:if(1024&_.flags){for(;z<16;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}_.length=G,_.head&&(_.head.extra_len=G),512&_.flags&&(H[0]=255&G,H[1]=G>>>8&255,_.check=a(_.check,H,2,0)),z=G=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(tt<(at=_.length)&&(at=tt),at&&(_.head&&(b=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),s.arraySet(_.head.extra,P,j,at,b)),512&_.flags&&(_.check=a(_.check,P,at,j)),tt-=at,j+=at,_.length-=at),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(tt===0)break t;for(at=0;b=P[j+at++],_.head&&b&&_.length<65536&&(_.head.name+=String.fromCharCode(b)),b&&at<tt;);if(512&_.flags&&(_.check=a(_.check,P,at,j)),tt-=at,j+=at,b)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(tt===0)break t;for(at=0;b=P[j+at++],_.head&&b&&_.length<65536&&(_.head.comment+=String.fromCharCode(b)),b&&at<tt;);if(512&_.flags&&(_.check=a(_.check,P,at,j)),tt-=at,j+=at,b)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;z<16;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(G!==(65535&_.check)){M.msg="header crc mismatch",_.mode=30;break}z=G=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),M.adler=_.check=0,_.mode=12;break;case 10:for(;z<32;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}M.adler=_.check=E(G),z=G=0,_.mode=11;case 11:if(_.havedict===0)return M.next_out=ut,M.avail_out=ht,M.next_in=j,M.avail_in=tt,_.hold=G,_.bits=z,2;M.adler=_.check=1,_.mode=12;case 12:if(R===5||R===6)break t;case 13:if(_.last){G>>>=7&z,z-=7&z,_.mode=27;break}for(;z<3;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}switch(_.last=1&G,z-=1,3&(G>>>=1)){case 0:_.mode=14;break;case 1:if(nt(_),_.mode=20,R!==6)break;G>>>=2,z-=2;break t;case 2:_.mode=17;break;case 3:M.msg="invalid block type",_.mode=30}G>>>=2,z-=2;break;case 14:for(G>>>=7&z,z-=7&z;z<32;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if((65535&G)!=(G>>>16^65535)){M.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&G,z=G=0,_.mode=15,R===6)break t;case 15:_.mode=16;case 16:if(at=_.length){if(tt<at&&(at=tt),ht<at&&(at=ht),at===0)break t;s.arraySet(Z,P,j,at,ut),tt-=at,j+=at,ht-=at,ut+=at,_.length-=at;break}_.mode=12;break;case 17:for(;z<14;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(_.nlen=257+(31&G),G>>>=5,z-=5,_.ndist=1+(31&G),G>>>=5,z-=5,_.ncode=4+(15&G),G>>>=4,z-=4,286<_.nlen||30<_.ndist){M.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;z<3;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}_.lens[ot[_.have++]]=7&G,G>>>=3,z-=3}for(;_.have<19;)_.lens[ot[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,Q={bits:_.lenbits},rt=u(0,_.lens,0,19,_.lencode,0,_.work,Q),_.lenbits=Q.bits,rt){M.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;xt=(I=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,Dt=65535&I,!((At=I>>>24)<=z);){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(Dt<16)G>>>=At,z-=At,_.lens[_.have++]=Dt;else{if(Dt===16){for(C=At+2;z<C;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(G>>>=At,z-=At,_.have===0){M.msg="invalid bit length repeat",_.mode=30;break}b=_.lens[_.have-1],at=3+(3&G),G>>>=2,z-=2}else if(Dt===17){for(C=At+3;z<C;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}z-=At,b=0,at=3+(7&(G>>>=At)),G>>>=3,z-=3}else{for(C=At+7;z<C;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}z-=At,b=0,at=11+(127&(G>>>=At)),G>>>=7,z-=7}if(_.have+at>_.nlen+_.ndist){M.msg="invalid bit length repeat",_.mode=30;break}for(;at--;)_.lens[_.have++]=b}}if(_.mode===30)break;if(_.lens[256]===0){M.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,Q={bits:_.lenbits},rt=u(l,_.lens,0,_.nlen,_.lencode,0,_.work,Q),_.lenbits=Q.bits,rt){M.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,Q={bits:_.distbits},rt=u(h,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,Q),_.distbits=Q.bits,rt){M.msg="invalid distances set",_.mode=30;break}if(_.mode=20,R===6)break t;case 20:_.mode=21;case 21:if(6<=tt&&258<=ht){M.next_out=ut,M.avail_out=ht,M.next_in=j,M.avail_in=tt,_.hold=G,_.bits=z,c(M,st),ut=M.next_out,Z=M.output,ht=M.avail_out,j=M.next_in,P=M.input,tt=M.avail_in,G=_.hold,z=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;xt=(I=_.lencode[G&(1<<_.lenbits)-1])>>>16&255,Dt=65535&I,!((At=I>>>24)<=z);){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(xt&&!(240&xt)){for(Wt=At,_e=xt,Re=Dt;xt=(I=_.lencode[Re+((G&(1<<Wt+_e)-1)>>Wt)])>>>16&255,Dt=65535&I,!(Wt+(At=I>>>24)<=z);){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}G>>>=Wt,z-=Wt,_.back+=Wt}if(G>>>=At,z-=At,_.back+=At,_.length=Dt,xt===0){_.mode=26;break}if(32&xt){_.back=-1,_.mode=12;break}if(64&xt){M.msg="invalid literal/length code",_.mode=30;break}_.extra=15&xt,_.mode=22;case 22:if(_.extra){for(C=_.extra;z<C;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}_.length+=G&(1<<_.extra)-1,G>>>=_.extra,z-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;xt=(I=_.distcode[G&(1<<_.distbits)-1])>>>16&255,Dt=65535&I,!((At=I>>>24)<=z);){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(!(240&xt)){for(Wt=At,_e=xt,Re=Dt;xt=(I=_.distcode[Re+((G&(1<<Wt+_e)-1)>>Wt)])>>>16&255,Dt=65535&I,!(Wt+(At=I>>>24)<=z);){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}G>>>=Wt,z-=Wt,_.back+=Wt}if(G>>>=At,z-=At,_.back+=At,64&xt){M.msg="invalid distance code",_.mode=30;break}_.offset=Dt,_.extra=15&xt,_.mode=24;case 24:if(_.extra){for(C=_.extra;z<C;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}_.offset+=G&(1<<_.extra)-1,G>>>=_.extra,z-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){M.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ht===0)break t;if(at=st-ht,_.offset>at){if((at=_.offset-at)>_.whave&&_.sane){M.msg="invalid distance too far back",_.mode=30;break}Ct=at>_.wnext?(at-=_.wnext,_.wsize-at):_.wnext-at,at>_.length&&(at=_.length),Zt=_.window}else Zt=Z,Ct=ut-_.offset,at=_.length;for(ht<at&&(at=ht),ht-=at,_.length-=at;Z[ut++]=Zt[Ct++],--at;);_.length===0&&(_.mode=21);break;case 26:if(ht===0)break t;Z[ut++]=_.length,ht--,_.mode=21;break;case 27:if(_.wrap){for(;z<32;){if(tt===0)break t;tt--,G|=P[j++]<<z,z+=8}if(st-=ht,M.total_out+=st,_.total+=st,st&&(M.adler=_.check=_.flags?a(_.check,Z,st,ut-st):o(_.check,Z,st,ut-st)),st=ht,(_.flags?G:E(G))!==_.check){M.msg="incorrect data check",_.mode=30;break}z=G=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;z<32;){if(tt===0)break t;tt--,G+=P[j++]<<z,z+=8}if(G!==(4294967295&_.total)){M.msg="incorrect length check",_.mode=30;break}z=G=0}_.mode=29;case 29:rt=1;break t;case 30:rt=-3;break t;case 31:return-4;case 32:default:return d}return M.next_out=ut,M.avail_out=ht,M.next_in=j,M.avail_in=tt,_.hold=G,_.bits=z,(_.wsize||st!==M.avail_out&&_.mode<30&&(_.mode<27||R!==4))&&dt(M,M.output,M.next_out,st-M.avail_out)?(_.mode=31,-4):(bt-=M.avail_in,st-=M.avail_out,M.total_in+=bt,M.total_out+=st,_.total+=st,_.wrap&&st&&(M.adler=_.check=_.flags?a(_.check,Z,st,M.next_out-st):o(_.check,Z,st,M.next_out-st)),M.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(bt==0&&st===0||R===4)&&rt===f&&(rt=-5),rt)},i.inflateEnd=function(M){if(!M||!M.state)return d;var R=M.state;return R.window&&(R.window=null),M.state=null,f},i.inflateGetHeader=function(M,R){var _;return M&&M.state&&2&(_=M.state).wrap?((_.head=R).done=!1,f):d},i.inflateSetDictionary=function(M,R){var _,P=R.length;return M&&M.state?(_=M.state).wrap!==0&&_.mode!==11?d:_.mode===11&&o(1,R,P,0)!==_.check?-3:dt(M,R,P,P)?(_.mode=31,-4):(_.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(l,h,f,d,p,g,k,E){var T,v,N,U,L,O,B,F,nt,dt=E.bits,M=0,R=0,_=0,P=0,Z=0,j=0,ut=0,tt=0,ht=0,G=0,z=null,bt=0,st=new s.Buf16(16),at=new s.Buf16(16),Ct=null,Zt=0;for(M=0;M<=15;M++)st[M]=0;for(R=0;R<d;R++)st[h[f+R]]++;for(Z=dt,P=15;1<=P&&st[P]===0;P--);if(P<Z&&(Z=P),P===0)return p[g++]=20971520,p[g++]=20971520,E.bits=1,0;for(_=1;_<P&&st[_]===0;_++);for(Z<_&&(Z=_),M=tt=1;M<=15;M++)if(tt<<=1,(tt-=st[M])<0)return-1;if(0<tt&&(l===0||P!==1))return-1;for(at[1]=0,M=1;M<15;M++)at[M+1]=at[M]+st[M];for(R=0;R<d;R++)h[f+R]!==0&&(k[at[h[f+R]]++]=R);if(O=l===0?(z=Ct=k,19):l===1?(z=o,bt-=257,Ct=a,Zt-=257,256):(z=c,Ct=u,-1),M=_,L=g,ut=R=G=0,N=-1,U=(ht=1<<(j=Z))-1,l===1&&852<ht||l===2&&592<ht)return 1;for(;;){for(B=M-ut,nt=k[R]<O?(F=0,k[R]):k[R]>O?(F=Ct[Zt+k[R]],z[bt+k[R]]):(F=96,0),T=1<<M-ut,_=v=1<<j;p[L+(G>>ut)+(v-=T)]=B<<24|F<<16|nt|0,v!==0;);for(T=1<<M-1;G&T;)T>>=1;if(T!==0?(G&=T-1,G+=T):G=0,R++,--st[M]==0){if(M===P)break;M=h[f+k[R]]}if(Z<M&&(G&U)!==N){for(ut===0&&(ut=Z),L+=_,tt=1<<(j=M-ut);j+ut<P&&!((tt-=st[j+ut])<=0);)j++,tt<<=1;if(ht+=1<<j,l===1&&852<ht||l===2&&592<ht)return 1;p[N=G&U]=Z<<24|j<<16|L-g|0}}return G!==0&&(p[L+G]=M-ut<<24|64<<16|0),E.bits=Z,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(I){for(var H=I.length;0<=--H;)I[H]=0}var u=0,l=29,h=256,f=h+1+l,d=30,p=19,g=2*f+1,k=15,E=16,T=7,v=256,N=16,U=17,L=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],nt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],dt=new Array(2*(f+2));c(dt);var M=new Array(2*d);c(M);var R=new Array(512);c(R);var _=new Array(256);c(_);var P=new Array(l);c(P);var Z,j,ut,tt=new Array(d);function ht(I,H,ot,lt,X){this.static_tree=I,this.extra_bits=H,this.extra_base=ot,this.elems=lt,this.max_length=X,this.has_stree=I&&I.length}function G(I,H){this.dyn_tree=I,this.max_code=0,this.stat_desc=H}function z(I){return I<256?R[I]:R[256+(I>>>7)]}function bt(I,H){I.pending_buf[I.pending++]=255&H,I.pending_buf[I.pending++]=H>>>8&255}function st(I,H,ot){I.bi_valid>E-ot?(I.bi_buf|=H<<I.bi_valid&65535,bt(I,I.bi_buf),I.bi_buf=H>>E-I.bi_valid,I.bi_valid+=ot-E):(I.bi_buf|=H<<I.bi_valid&65535,I.bi_valid+=ot)}function at(I,H,ot){st(I,ot[2*H],ot[2*H+1])}function Ct(I,H){for(var ot=0;ot|=1&I,I>>>=1,ot<<=1,0<--H;);return ot>>>1}function Zt(I,H,ot){var lt,X,pt=new Array(k+1),_t=0;for(lt=1;lt<=k;lt++)pt[lt]=_t=_t+ot[lt-1]<<1;for(X=0;X<=H;X++){var ft=I[2*X+1];ft!==0&&(I[2*X]=Ct(pt[ft]++,ft))}}function At(I){var H;for(H=0;H<f;H++)I.dyn_ltree[2*H]=0;for(H=0;H<d;H++)I.dyn_dtree[2*H]=0;for(H=0;H<p;H++)I.bl_tree[2*H]=0;I.dyn_ltree[2*v]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0}function xt(I){8<I.bi_valid?bt(I,I.bi_buf):0<I.bi_valid&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0}function Dt(I,H,ot,lt){var X=2*H,pt=2*ot;return I[X]<I[pt]||I[X]===I[pt]&&lt[H]<=lt[ot]}function Wt(I,H,ot){for(var lt=I.heap[ot],X=ot<<1;X<=I.heap_len&&(X<I.heap_len&&Dt(H,I.heap[X+1],I.heap[X],I.depth)&&X++,!Dt(H,lt,I.heap[X],I.depth));)I.heap[ot]=I.heap[X],ot=X,X<<=1;I.heap[ot]=lt}function _e(I,H,ot){var lt,X,pt,_t,ft=0;if(I.last_lit!==0)for(;lt=I.pending_buf[I.d_buf+2*ft]<<8|I.pending_buf[I.d_buf+2*ft+1],X=I.pending_buf[I.l_buf+ft],ft++,lt===0?at(I,X,H):(at(I,(pt=_[X])+h+1,H),(_t=O[pt])!==0&&st(I,X-=P[pt],_t),at(I,pt=z(--lt),ot),(_t=B[pt])!==0&&st(I,lt-=tt[pt],_t)),ft<I.last_lit;);at(I,v,H)}function Re(I,H){var ot,lt,X,pt=H.dyn_tree,_t=H.stat_desc.static_tree,ft=H.stat_desc.has_stree,vt=H.stat_desc.elems,ce=-1;for(I.heap_len=0,I.heap_max=g,ot=0;ot<vt;ot++)pt[2*ot]!==0?(I.heap[++I.heap_len]=ce=ot,I.depth[ot]=0):pt[2*ot+1]=0;for(;I.heap_len<2;)pt[2*(X=I.heap[++I.heap_len]=ce<2?++ce:0)]=1,I.depth[X]=0,I.opt_len--,ft&&(I.static_len-=_t[2*X+1]);for(H.max_code=ce,ot=I.heap_len>>1;1<=ot;ot--)Wt(I,pt,ot);for(X=vt;ot=I.heap[1],I.heap[1]=I.heap[I.heap_len--],Wt(I,pt,1),lt=I.heap[1],I.heap[--I.heap_max]=ot,I.heap[--I.heap_max]=lt,pt[2*X]=pt[2*ot]+pt[2*lt],I.depth[X]=(I.depth[ot]>=I.depth[lt]?I.depth[ot]:I.depth[lt])+1,pt[2*ot+1]=pt[2*lt+1]=X,I.heap[1]=X++,Wt(I,pt,1),2<=I.heap_len;);I.heap[--I.heap_max]=I.heap[1],function(Mt,In){var A,m,y,S,D,J,et=In.dyn_tree,Ft=In.max_code,be=In.stat_desc.static_tree,ge=In.stat_desc.has_stree,Ee=In.stat_desc.extra_bits,se=In.stat_desc.extra_base,wa=In.stat_desc.max_length,Cl=0;for(S=0;S<=k;S++)Mt.bl_count[S]=0;for(et[2*Mt.heap[Mt.heap_max]+1]=0,A=Mt.heap_max+1;A<g;A++)wa<(S=et[2*et[2*(m=Mt.heap[A])+1]+1]+1)&&(S=wa,Cl++),et[2*m+1]=S,Ft<m||(Mt.bl_count[S]++,D=0,se<=m&&(D=Ee[m-se]),J=et[2*m],Mt.opt_len+=J*(S+D),ge&&(Mt.static_len+=J*(be[2*m+1]+D)));if(Cl!==0){do{for(S=wa-1;Mt.bl_count[S]===0;)S--;Mt.bl_count[S]--,Mt.bl_count[S+1]+=2,Mt.bl_count[wa]--,Cl-=2}while(0<Cl);for(S=wa;S!==0;S--)for(m=Mt.bl_count[S];m!==0;)Ft<(y=Mt.heap[--A])||(et[2*y+1]!==S&&(Mt.opt_len+=(S-et[2*y+1])*et[2*y],et[2*y+1]=S),m--)}}(I,H),Zt(pt,ce,I.bl_count)}function b(I,H,ot){var lt,X,pt=-1,_t=H[1],ft=0,vt=7,ce=4;for(_t===0&&(vt=138,ce=3),H[2*(ot+1)+1]=65535,lt=0;lt<=ot;lt++)X=_t,_t=H[2*(lt+1)+1],++ft<vt&&X===_t||(ft<ce?I.bl_tree[2*X]+=ft:X!==0?(X!==pt&&I.bl_tree[2*X]++,I.bl_tree[2*N]++):ft<=10?I.bl_tree[2*U]++:I.bl_tree[2*L]++,pt=X,ce=(ft=0)===_t?(vt=138,3):X===_t?(vt=6,3):(vt=7,4))}function rt(I,H,ot){var lt,X,pt=-1,_t=H[1],ft=0,vt=7,ce=4;for(_t===0&&(vt=138,ce=3),lt=0;lt<=ot;lt++)if(X=_t,_t=H[2*(lt+1)+1],!(++ft<vt&&X===_t)){if(ft<ce)for(;at(I,X,I.bl_tree),--ft!=0;);else X!==0?(X!==pt&&(at(I,X,I.bl_tree),ft--),at(I,N,I.bl_tree),st(I,ft-3,2)):ft<=10?(at(I,U,I.bl_tree),st(I,ft-3,3)):(at(I,L,I.bl_tree),st(I,ft-11,7));pt=X,ce=(ft=0)===_t?(vt=138,3):X===_t?(vt=6,3):(vt=7,4)}}c(tt);var Q=!1;function C(I,H,ot,lt){st(I,(u<<1)+(lt?1:0),3),function(X,pt,_t,ft){xt(X),bt(X,_t),bt(X,~_t),s.arraySet(X.pending_buf,X.window,pt,_t,X.pending),X.pending+=_t}(I,H,ot)}i._tr_init=function(I){Q||(function(){var H,ot,lt,X,pt,_t=new Array(k+1);for(X=lt=0;X<l-1;X++)for(P[X]=lt,H=0;H<1<<O[X];H++)_[lt++]=X;for(_[lt-1]=X,X=pt=0;X<16;X++)for(tt[X]=pt,H=0;H<1<<B[X];H++)R[pt++]=X;for(pt>>=7;X<d;X++)for(tt[X]=pt<<7,H=0;H<1<<B[X]-7;H++)R[256+pt++]=X;for(ot=0;ot<=k;ot++)_t[ot]=0;for(H=0;H<=143;)dt[2*H+1]=8,H++,_t[8]++;for(;H<=255;)dt[2*H+1]=9,H++,_t[9]++;for(;H<=279;)dt[2*H+1]=7,H++,_t[7]++;for(;H<=287;)dt[2*H+1]=8,H++,_t[8]++;for(Zt(dt,f+1,_t),H=0;H<d;H++)M[2*H+1]=5,M[2*H]=Ct(H,5);Z=new ht(dt,O,h+1,f,k),j=new ht(M,B,0,d,k),ut=new ht(new Array(0),F,0,p,T)}(),Q=!0),I.l_desc=new G(I.dyn_ltree,Z),I.d_desc=new G(I.dyn_dtree,j),I.bl_desc=new G(I.bl_tree,ut),I.bi_buf=0,I.bi_valid=0,At(I)},i._tr_stored_block=C,i._tr_flush_block=function(I,H,ot,lt){var X,pt,_t=0;0<I.level?(I.strm.data_type===2&&(I.strm.data_type=function(ft){var vt,ce=4093624447;for(vt=0;vt<=31;vt++,ce>>>=1)if(1&ce&&ft.dyn_ltree[2*vt]!==0)return o;if(ft.dyn_ltree[18]!==0||ft.dyn_ltree[20]!==0||ft.dyn_ltree[26]!==0)return a;for(vt=32;vt<h;vt++)if(ft.dyn_ltree[2*vt]!==0)return a;return o}(I)),Re(I,I.l_desc),Re(I,I.d_desc),_t=function(ft){var vt;for(b(ft,ft.dyn_ltree,ft.l_desc.max_code),b(ft,ft.dyn_dtree,ft.d_desc.max_code),Re(ft,ft.bl_desc),vt=p-1;3<=vt&&ft.bl_tree[2*nt[vt]+1]===0;vt--);return ft.opt_len+=3*(vt+1)+5+5+4,vt}(I),X=I.opt_len+3+7>>>3,(pt=I.static_len+3+7>>>3)<=X&&(X=pt)):X=pt=ot+5,ot+4<=X&&H!==-1?C(I,H,ot,lt):I.strategy===4||pt===X?(st(I,2+(lt?1:0),3),_e(I,dt,M)):(st(I,4+(lt?1:0),3),function(ft,vt,ce,Mt){var In;for(st(ft,vt-257,5),st(ft,ce-1,5),st(ft,Mt-4,4),In=0;In<Mt;In++)st(ft,ft.bl_tree[2*nt[In]+1],3);rt(ft,ft.dyn_ltree,vt-1),rt(ft,ft.dyn_dtree,ce-1)}(I,I.l_desc.max_code+1,I.d_desc.max_code+1,_t+1),_e(I,I.dyn_ltree,I.dyn_dtree)),At(I),lt&&xt(I)},i._tr_tally=function(I,H,ot){return I.pending_buf[I.d_buf+2*I.last_lit]=H>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&H,I.pending_buf[I.l_buf+I.last_lit]=255&ot,I.last_lit++,H===0?I.dyn_ltree[2*ot]++:(I.matches++,H--,I.dyn_ltree[2*(_[ot]+h+1)]++,I.dyn_dtree[2*z(H)]++),I.last_lit===I.lit_bufsize-1},i._tr_align=function(I){st(I,2,3),at(I,v,dt),function(H){H.bi_valid===16?(bt(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):8<=H.bi_valid&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)}(I)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,u,l,h,f=1,d={},p=!1,g=o.document,k=Object.getPrototypeOf&&Object.getPrototypeOf(o);k=k&&k.setTimeout?k:o,c={}.toString.call(o.process)==="[object process]"?function(N){xi.nextTick(function(){T(N)})}:function(){if(o.postMessage&&!o.importScripts){var N=!0,U=o.onmessage;return o.onmessage=function(){N=!1},o.postMessage("","*"),o.onmessage=U,N}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",v,!1):o.attachEvent("onmessage",v),function(N){o.postMessage(h+N,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(N){T(N.data)},function(N){l.port2.postMessage(N)}):g&&"onreadystatechange"in g.createElement("script")?(u=g.documentElement,function(N){var U=g.createElement("script");U.onreadystatechange=function(){T(N),U.onreadystatechange=null,u.removeChild(U),U=null},u.appendChild(U)}):function(N){setTimeout(T,0,N)},k.setImmediate=function(N){typeof N!="function"&&(N=new Function(""+N));for(var U=new Array(arguments.length-1),L=0;L<U.length;L++)U[L]=arguments[L+1];var O={callback:N,args:U};return d[f]=O,c(f),f++},k.clearImmediate=E}function E(N){delete d[N]}function T(N){if(p)setTimeout(T,0,N);else{var U=d[N];if(U){p=!0;try{(function(L){var O=L.callback,B=L.args;switch(B.length){case 0:O();break;case 1:O(B[0]);break;case 2:O(B[0],B[1]);break;case 3:O(B[0],B[1],B[2]);break;default:O.apply(a,B)}})(U)}finally{E(N),p=!1}}}}function v(N){N.source===o&&typeof N.data=="string"&&N.data.indexOf(h)===0&&T(+N.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof _n<"u"?_n:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(C1);var LL=C1.exports,ed=go(LL);const L1={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(L1);var er=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},ho,_a,_s;class ML{constructor(...t){ho.set(this,new Map),_a.set(this,new Map),_s.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),er(this,_s,"f").has(r)||er(this,_s,"f").set(r,new Set);const s=er(this,_s,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&er(this,_a,"f").set(r,a),o=!1,c)continue;const u=er(this,ho,"f").get(a);if(u&&u!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${u} -> ${a}". Pass \`force=true\` to override this definition.`);er(this,ho,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:er(this,ho,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&er(this,_a,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:er(this,_s,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of er(this,_s,"f").values())Object.freeze(t);return this}_getTestState(){return{types:er(this,ho,"f"),extensions:er(this,_a,"f")}}}ho=new WeakMap,_a=new WeakMap,_s=new WeakMap;var UL=new ML(L1)._freeze();function M1(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return UL.getType(e)??"application/octet-stream"}async function FL(e,t){try{gr(K,e.name);const n=await e.arrayBuffer();(await new ed().loadAsync(n)).forEach((s,o)=>{o.async("uint8array").then(a=>{const c=M1(s,a),u=new File([a],o.name,{type:c});t(u)}).catch(a=>{oe(K,"crash",a.message)})})}catch(n){oe(K,"crash",n.message)}}async function PL(e,t){try{gr(K,e.name);const n=await e.arrayBuffer();t(new Uint8Array(n))}catch(n){oe(K,"crash",n.message)}}function U1(e,t){function n(r){if(w(t))switch(r){case"text/plain":t.text().then(i=>Gl(K,void 0,"text",`file:${t.name}`,i,e)).catch(i=>oe(K,"crash",i.message));break;case"application/json":t.text().then(i=>Gl(K,void 0,"json",`file:${t.name}`,i,e)).catch(i=>oe(K,"crash",i.message));break;case"application/zip":FL(t,i=>U1(e,i)).catch(i=>oe(K,"crash",i.message));break;case"application/octet-stream":PL(t,i=>Gl(K,void 0,"binary",`file:${t.name}`,i,e)).catch(i=>oe(K,"crash",i.message));break;default:t.arrayBuffer().then(i=>{const s=M1(t.name,new Uint8Array(i));if(s)n(s);else return oe(K,"parsewebfile",`unsupported file ${t.name}`)}).catch(i=>oe(K,"crash",i.message));return}}n((t==null?void 0:t.type)??"")}function ba(e,t){function n(r){oe(e,"crash",r.message)}t().catch(n)}function BL(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function DL(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const $L=new Date("1980/09/02");async function F1(e){return console.info("saved",e),new Promise((t,n)=>{const r=new ed;for(let i=0;i<e.length;++i){const s=e[i],o=tC(s);if(o){const a=mT(o);w(a)&&r.file(s.id,a,{date:$L})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(DL(i))}).catch(n)})}async function jL(e){return new Promise((t,n)=>{const r=new ed;r.loadAsync(BL(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),u=eC(gT(c));w(u)&&i.push(u)}t(i)}).catch(n)})}const P1="$yellow$205$205$205$196";function B1(e,t){return`${e.x},${e.y},${t.x},${t.y}`}let Ge;function zL(){return!!Ge}function KL(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,u=[],l=[];for(let h=i;h<=o;++h)for(let f=r;f<=s;++f){const d={x:f-r,y:h-i},p=Wr(e,{x:f,y:h});(p==null?void 0:p.category)===jn.ISOBJECT?(u.push(On(R1(e,f,h))),Oi(p)!=="player"&&l.push({...On(p),...d,id:"blank"})):u.push({...On(p),...d})}return{board:e.id,width:a,height:c,terrain:u,objects:l}}function WL(e,t,n,r){const i=dr(e);if(w(i))switch(Ge=KL(i,t,n),r){case"copyobjects":Ge.terrain=[];break;case"copyterrain":Ge.objects=[];break}}function GL(e,t,n){const r=B1(t,n);ae(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ae(e,P1),te(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),te(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),te(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=yn(e);i.scroll=Gr(e)}function HL(e,t,n,r){const i=dr(e);if(!w(i)||!w(Ge))return;const s=Math.min(t.x,n.x),o=Math.min(t.y,n.y),a=Math.max(t.x,n.x),c=Math.max(t.y,n.y),u=a-s+1,l=c-o+1,h=Math.min(Ge.width,u),f=Math.min(Ge.height,l);switch(r){case"pasteall":{for(let d=0;d<f;++d)for(let p=0;p<h;++p){const g=rc({x:p,y:d},Ge.width);yi(i,{...Ge.terrain[g],x:s+p,y:o+d})}for(let d=0;d<Ge.objects.length;++d){const p=Ge.objects[d];w(p.x)&&w(p.y)&&m0(p.x,p.y,0,u-1,l-1,0)&&qf(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break}case"pasteobjects":for(let d=0;d<Ge.objects.length;++d){const p=Ge.objects[d];w(p.x)&&w(p.y)&&m0(p.x,p.y,0,u-1,l-1,0)&&qf(i,{...p,id:void 0,x:s+p.x,y:o+p.y})}break;case"pasteterrain":for(let d=0;d<f;++d)for(let p=0;p<h;++p){const g=rc({x:p,y:d},Ge.width);yi(i,{...Ge.terrain[g],x:s+p,y:o+d})}break;case"pasteterraintiled":for(let d=o;d<=c;++d)for(let p=s;p<=a;++p){const g=(p-s)%Ge.width,k=(d-o)%Ge.height,E=rc({x:g,y:k},Ge.width);yi(i,{...Ge.terrain[E],x:p,y:d})}break}}function YL(e,t,n){const r=B1(t,n);ae(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ae(e,P1),te(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),te(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),te(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),te(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=yn(e);i.scroll=Gr(e)}const fo="$yellow$205$205$205$196";function Ol(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function VL(e,t,n,r){const i=dr(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){Lt(l)&&(s=l,g0(t.x,t.y,n.x,n.y).forEach(h=>{const f=Wr(i,h);w(f)&&(f[u]=l)}))}ae(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ae(e,fo),te(e,`batch:${Ol(t,n)}`,"char",[r,"charedit"],o,a);const c=yn(e);c.scroll=Gr(e)}function qL(e,t,n,r){const i=dr(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){if(console.info("memoryinspectcolorarea",u,l),Lt(l)){s=l;for(let h=t.y;h<=n.y;++h)for(let f=t.x;f<=n.x;++f){const d=Wr(i,{x:f,y:h});w(d)&&(d[u]=l)}}}ae(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ae(e,fo),te(e,`batch:${Ol(t,n)}`,"color",[r,"coloredit"],o,a);const c=yn(e);c.scroll=Gr(e)}function XL(e,t,n,r){const i=dr(e);if(!w(i))return;let s=0;function o(){return s}function a(u,l){Lt(l)&&(s=l,g0(t.x,t.y,n.x,n.y).forEach(h=>{const f=Wr(i,h);w(f)&&(f[u]=l)}))}ae(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),ae(e,fo),te(e,`batch:${Ol(t,n)}`,"color",[r,"coloredit"],o,a);const c=yn(e);c.scroll=Gr(e)}function JL(e,t,n){const r=Ol(t,n);ae(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ae(e,fo),te(e,"batch","copy elements",[`copy:${r}`,"hk","1"," 1 ","next"]),zL()&&te(e,"batch","paste elements",[`paste:${r}`,"hk","2"," 2 ","next"]),te(e,"batch","copy coords",[`copycoords:${r}`,"hk","5"," 5 "]),ae(e,fo),te(e,"batch","set chars:",[`chars:${r}`,"hk","a"," A ","next"]),te(e,"batch","set colors:",[`colors:${r}`,"hk","c"," C ","next"]),te(e,"batch","set bgs:",[`bgs:${r}`,"hk","b"," B ","next"]),ae(e,fo),te(e,"batch","make empty",[`empty:${r}`,"hk","0"," 0 ","next"])}const Ea="$yellow$205$205$205$196";function nd(e,t){return`inspect:${t!=null&&t.id?t.id:Kr(e,t)}`}function ZL(e,t,n){const r=$n(jt.MAIN);if(!w(r))return;const i=dr(e);if(!w(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){w(t)&&(t[f]=d)}const a=t.category===jn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=nd(i,t);ae(e,`${a}: ${c} ${u}`),ae(e,Ea),te(e,l,"color",[n,"coloredit"],s,o);const h=yn(e);h.scroll=Gr(e)}function QL(e,t,n){const r=$n(jt.MAIN);if(!w(r))return;const i=dr(e);if(!w(i))return;function s(f){var p;return(t==null?void 0:t[f])??((p=t==null?void 0:t.kinddata)==null?void 0:p[f])??0}function o(f,d){w(t)&&(t[f]=d)}const a=t.category===jn.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",u=`${t.x??-1}, ${t.y??-1}`,l=nd(i,t);ae(e,`${a}: ${c} ${u}`),ae(e,Ea),te(e,l,"char",[n,"charedit"],s,o);const h=yn(e);h.scroll=Gr(e)}function D1(e,t,n,r,i,s){var h,f,d;function o(p){var k;const g=(r==null?void 0:r[p])??((k=r==null?void 0:r.kinddata)==null?void 0:k[p]);if(!w(g))switch(p){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Gt.ISWALK;case"pushable":return 0;case"destructible":return 0}return g}function a(p,g){w(r)&&(r[p]=g)}s?ae(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):ae(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`),ae(e,Ea);const c=nd(t,r);s?(te(e,c,"cycle",["cycle","number","1","255"],o,a),te(e,c,"collision",["collision","select","iswalking",`${Gt.ISWALK}`,"isswimming",`${Gt.ISSWIM}`],o,a)):te(e,c,"collision",["collision","select","iswalkable",`${Gt.ISWALK}`,"isswimable",`${Gt.ISSWIM}`,"issolid",`${Gt.ISSOLID}`],o,a),s&&te(e,c,"pushable",["pushable","select","no","0","yes","1"],o,a),te(e,c,"destructible",["destructible","select","no","0","yes","1"],o,a);const u=ca(n),l=mr(u);for(let p=0;p<l.length;++p){const g=l[p];switch(g){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"destructible":break;default:if(ee(u[g])){const[k,E,...T]=u[g];St(E)&&te(e,c,E||g,[g,k,...T],o,a)}break}}ae(e,Ea),te(e,c,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],o,a),te(e,c,`color: ${r.color??((f=r.kinddata)==null?void 0:f.color)??15}`,["color","hk","c"," C ","next"],o,a),te(e,c,`bg: ${r.bg??((d=r.kinddata)==null?void 0:d.bg)??0}`,["bg","hk","b"," B ","next"],o,a),ae(e,Ea),te(e,c,"make empty",["empty","hk","0"],o,a)}const $1="$yellow$205$205$205$196";function tM(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function eM(e,t,n,r){const i=$n(jt.MAIN);if(!w(i))return;const s=dr(e);if(w(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Wr(s,{x:a,y:o});(c==null?void 0:c.category)===jn.ISOBJECT&&di(i,s,c,i.timestamp),yi(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=Wr(s,{x:a,y:o});(c==null?void 0:c.category)===jn.ISOBJECT&&di(i,s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)yi(s,{x:a,y:o});break}}}function nM(e,t,n){const r=tM(t,n);ae(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),ae(e,$1),te(e,"batch","clear terrain & objects",[`emptyall:${r}`,"hk","1"]),te(e,"batch","clear objects",[`emptyobjects:${r}`,"hk","2"]),te(e,"batch","clear terrain",[`emptyterrain:${r}`,"hk","3"]);const i=yn(e);i.scroll=Gr(e)}function rM(e,t,n){const r=$n(jt.MAIN);if(!w(r))return;const i=dr(e);if(!w(i))return;if(fi(r,i),t.x===n.x&&t.y===n.y){const o=Wr(i,t);if(w(o)){const a=ui(r,kt.TERRAIN,o.kind??"");w(a)&&D1(e,i,a,o,t,!1);const c=ui(r,kt.OBJECT,o.kind??"");w(c)&&D1(e,i,c,o,t,!0)}else ae(e,`empty: ${t.x}, ${t.y}`),ae(e,$1)}else JL(e,t,n);const s=yn(e);s.scroll=Gr(e)}function iM(e,t){const n=pe(jt.MAIN);if(!w(n))return;const r=dr(t);if(!w(r))return;const i=Gi(e),s=TL(r,i.target);if(w(s))switch(i.path){case"bg":case"color":ZL(t,s,i.path);break;case"char":QL(t,s,i.path);break;case"empty":di(n,r,s,n.timestamp);break;case"code":ba(K,async()=>{if(!w(t))return;const o=Oi(s),a="object";ie(K,`opened [${a}] ${o}`);const c=[r.id,s.id??""];$u(Aa(n.id,c),s.code??""),Ub(K,t),await lE(800),_d(K,n.id,[r.id,s.id??""],a,`${o} - ${n.name}`,t)});break;default:console.info("unknown inspect",i);break}}function sM(e,t){const n=dr(t);if(!w(n))return;const r=Gi(e),[i,s,o,a]=r.path.split(",").map(l=>parseFloat(l)),c={x:i,y:s},u={x:o,y:a};switch(r.target){case"copy":GL(t,c,u);break;case"copyall":case"copyobjects":case"copyterrain":WL(t,c,u,r.target);break;case"paste":YL(t,c,u);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":HL(t,c,u,r.target);break;case"empty":nM(t,c,u);break;case"emptyall":case"emptyobjects":case"emptyterrain":eM(t,c,u,r.target);break;case"chars":VL(t,c,u,"char");break;case"colors":qL(t,c,u,"color");break;case"bgs":XL(t,c,u,"bg");break;case"copycoords":{jb(K,r.path,gi());break}default:console.info("unknown batch",r);break}}const oM=16,bs={},aM=64;let j1=0;const po={},mo={};async function z1(e){const t=co(),n=pe(jt.MAIN);if(t.length&&w(n)){const r=await F1(t),i=e?"autosave":`${new Date().toISOString()} ${n.name} ${r.length} chars`;Db(me,i,r,gi())}}async function cM(){const e=co(),t=pe(jt.MAIN);if(e.length&&w(t)){const n=await F1(e);$b(me,n,gi())}}const me=ks("vm",["tick","second"],e=>{var t;if(me.session(e))switch(e.target){case"operator":w(e.player)&&(eL(e.player),Kt(me,`operator set to ${e.player}`),me.replynext(e,"ackoperator",!0,e.player));break;case"zsswords":if(e.player===gi()){const n=pe(jt.MAIN);me.replynext(e,"ackzsswords",{cli:Mf($i.CLI),loader:Mf($i.LOADER),runtime:Mf($i.RUNTIME),flags:[...mr(ys(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["player","pushable","collision","destructible","ispushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isdestructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"],kinds:[...hs(n,kt.OBJECT).map(r=>Je(r)),...mr(Nf)],altkinds:[...hs(n,kt.TERRAIN),...hs(n,kt.BOARD),...hs(n,kt.PALETTE),...hs(n,kt.CHARSET),...hs(n,kt.LOADER)].map(r=>Je(r)),colors:[...mr(Fo)],dirs:[...mr(Hf).filter(r=>["cw","ccw","oop","rndp"].includes(r)===!1)],dirmods:["cw","ccw","oop","rndp",...mr(Of)]},e.player)}break;case"books":e.player===gi()&&ba(me,async()=>{if(e.player&&ee(e.data)){const[n,r]=e.data,i=await jL(n),s=i.map(o=>o.name);aL(i,r),Kt(me,`loading ${s.join(", ")}`),Kl(me,e.player)}});break;case"joinack":w(e.player)&&!hL(e.player)&&Kl(me,e.player);break;case"logout":w(e.player)&&(uL(e.player),delete bs[e.player],Kt(me,`player ${e.player} logout`),Kl(me,e.player));break;case"login":w(e.player)&&lL(e.player)&&(bs[e.player]=0,Kt(me,`login from ${e.player}`),me.replynext(e,"acklogin",!0,e.player));break;case"doot":w(e.player)&&(bs[e.player]=0,yd(me,"active",e.player));break;case"input":if(w(e.player)){const n=ys(e.player),[r=hn.NONE,i=0]=e.data??[hn.NONE,0];ee(n.inputqueue)||(n.inputqueue=[]),r!==hn.NONE&&n.inputqueue.push([r,i])}break;case"codewatch":if(w(e.player)&&ee(e.data)){const[n,r]=e.data,i=Aa(n,r);w(mo[i])||(mo[i]=f0(i,s=>{const[o,a]=r,c=fr(n),u=Fi(c,o);if(w(u))if(Pr(u)===kt.BOARD&&w(a)){const l=Br(u),h=Rn(l,a);w(h)&&(h.code=s,pf(E_(s),h))}else u.code=s,QO(u)})),po[i]=po[i]??new Set,po[i].add(e.player)}break;case"coderelease":if(e.player&&ee(e.data)){const[n,r]=e.data,[,i]=r,s=Aa(n,r);w(po[s])&&(po[s].delete(e.player),po[s].size===0&&((t=mo[s])==null||t.call(mo),mo[s]=void 0,St(i)&&pL(i)))}break;case"halt":e.player===gi()&&vb(e.data)&&nL(e.data);break;case"tick":rL()||gL();break;case"synthsend":St(e.data)&&Gf(e.data,void 0);break;case"second":{fL(bs);const n=Object.keys(bs);for(let r=0;r<n.length;++r)++bs[n[r]];for(let r=0;r<n.length;++r){const i=n[r];bs[i]>=oM&&bd(me,i)}++j1>=aM&&(j1=0,ba(me,async()=>{await z1(!0)}));break}case"copyjsonfile":{const n=pe(jt.MAIN);if(w(n)&&ee(e.data)){const[r]=e.data,i=Fi(n,r);w(i)&&zb(me,i,`${Je(i)}.${us(i)}.json`,gi())}break}case"fork":ba(me,async()=>{await cM()});break;case"flush":ba(me,async()=>{await z1()});break;case"cli":w(e.player)&&yL(e.player,e.data);break;case"restart":e.player===gi()&&(mL(),Ed(me,e.player));break;case"inspect":if(w(e.player)&&ee(e.data)){const[n,r]=e.data;rM(e.player,n,r)}break;case"loader":if(w(e.player)&&ee(e.data)){const[n,r,i,s]=e.data;if(r==="file")U1(e.player,s);else if(r==="json"&&/file:.*\.book.json/.test(i)){Kt(me,`loading ${i}`);const o=JSON.parse(s.json),a=pe(jt.MAIN);w(a)&&w(o.data)&&St(o.exported)&&(Kf(o.data),Kt(me,`loaded ${o.exported}`))}else if(r==="json"&&/file:.*\..*\.json/.test(i)){Kt(me,`loading ${i}`);const o=JSON.parse(s.json),a=pe(jt.MAIN);w(a)&&w(o.data)&&St(o.exported)&&(T_(a,o.data),Kt(me,`loaded ${o.exported}`))}else PC(n,r,i,s,e.player)}break;default:{const{target:n,path:r}=Gi(e.target);switch(Ut(n)){case"batch":w(e.player)&&sM(r,e.player);break;case"inspect":w(e.player)&&iM(r,e.player);break;case"touched":if(ee(e.data)){const[i,s,o]=e.data;k1({...e,target:`${i}:${o}`,data:void 0,sender:s})}break;default:k1(e);break}break}}},tL());function lM(){Bb(me)}const{forward:uM}=aE(e=>postMessage(e));onmessage=function(t){uM(t.data)},setTimeout(lM,100)})();

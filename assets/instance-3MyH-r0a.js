var aL=Object.defineProperty;var cL=(Fe,nt,Sn)=>nt in Fe?aL(Fe,nt,{enumerable:!0,configurable:!0,writable:!0,value:Sn}):Fe[nt]=Sn;var P=(Fe,nt,Sn)=>(cL(Fe,typeof nt!="symbol"?nt+"":nt,Sn),Sn);(function(){"use strict";const Fe=new Set,nt={emit(e,t,n,r){nt.invoke(ug(e,t,n,r))},invoke(e){Fe.forEach(t=>t.handle(e))},connect(e){Fe.add(e)},disconnect(e){Fe.delete(e)}},Sn="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ag=e=>crypto.getRandomValues(new Uint8Array(e)),cg=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,s=-~(1.6*r*t/e.length);return(i=t)=>{let o="";for(;;){let a=n(s),c=s;for(;c--;)if(o+=e[a[c]&r]||"",o.length===i)return o}}},Xc=(e,t=21)=>cg(e,t,ag),lg=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=Sn[n[e]&63];return t};function $e(){return lg()}function ug(e,t,n,r){return{id:$e(),target:e,sender:t,data:n,player:r}}function Jc(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Nr(e,t,n){const r=$e(),s=e.toLowerCase(),i=t.map(a=>a.toLowerCase()),o={id(){return r},name(){return e},tags(){return t},emit(a,c,l){nt.emit(a,r,c,l)},reply(a,c,l,u){o.emit(`${a.sender}:${c}`,l,u)},handle(a){const{target:c,path:l}=Jc(a.target),u=c.toLowerCase();i.findIndex(h=>h==="all"||h===u)!==-1&&n(a),(r===c||u==="all"||s===u)&&n({...a,target:l})}};return nt.connect(o),o}function hg(e){const t=new Set;function n(r){t.has(r.id)||(t.add(r.id),nt.invoke(r))}return Nr("forward",["all"],r=>{t.has(r.id)||(t.add(r.id),e(r))}),n}var Rs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function oo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function fg(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}),n}var Qc="abcdefghijklmnopqrstuvwxyz",Zc="ABCDEFGHIJKLMNOPQRSTUVWXYZ",tl="0123456789",dg="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",pg="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const gg=tl,mg=Qc,Eg=Zc;var _g=gg+mg+Eg,ao={lowercase:Qc,uppercase:Zc,numbers:tl,nolookalikes:dg,nolookalikesSafe:pg,alphanumeric:_g},V=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.CLEAR=32]="CLEAR",e[e.SHADOW=33]="SHADOW",e[e.BORROW=34]="BORROW",e))(V||{});function vs(e,t){return new Array(e).fill(t)}function yg(e,t,n,r,s=0){const i=n*r;return{id:`tiles:${e}:${t}`,type:1,width:n,height:r,char:vs(i,0),color:vs(i,0),bg:vs(i,s)}}function Tg(e,t,n,r=1,s=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:s,bg:32}}function Sg(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function Ag(e,t,n,r,s=0){const i=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:vs(i,s)}}function wg(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:2}}var Vt=(e=>(e[e.START=0]="START",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.TOP=3]="TOP",e[e.BOTTOM=4]="BOTTOM",e[e.SCROLL=5]="SCROLL",e))(Vt||{});const Rg={start:0,left:1,right:2,top:3,bottom:4,scroll:5},vg={0:1,1:20,2:20,3:1,4:1,5:40},Ng=1,bg=16,Lg=256;var dt=(e=>(e[e.NONE=0]="NONE",e[e.MOVE_UP=1]="MOVE_UP",e[e.MOVE_DOWN=2]="MOVE_DOWN",e[e.MOVE_LEFT=3]="MOVE_LEFT",e[e.MOVE_RIGHT=4]="MOVE_RIGHT",e[e.OK_BUTTON=5]="OK_BUTTON",e[e.CANCEL_BUTTON=6]="CANCEL_BUTTON",e[e.MENU_BUTTON=7]="MENU_BUTTON",e))(dt||{});function Vn(e,t,n,r){const s=r??"anon";return nt.emit(`error:${t}`,e,n,s),xg(e,n,s)}function Cg(e,t,n){nt.emit("gadgetclient:reset",e,t,n)}function Ig(e,t,n){nt.emit("gadgetclient:patch",e,t,n)}function Og(e,t,n){nt.emit("register:read",e,[t],n)}function kg(e,t,n,r){nt.emit("register:write",e,[t,n],r)}function co(e,...t){return nt.emit("tape:info",e,t),!0}function Mg(e,...t){return nt.emit("tape:debug",e,t),!0}function xg(e,...t){return nt.emit("tape:error",e,t),!1}var el={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Rs,function(){return n.importState=function(s){var i=new n;return i.importState(s),i},n;function n(){return function(s){var i=0,o=0,a=0,c=1;s.length==0&&(s=[+new Date]);var l=r();i=l(" "),o=l(" "),a=l(" ");for(var u=0;u<s.length;u++)i-=l(s[u]),i<0&&(i+=1),o-=l(s[u]),o<0&&(o+=1),a-=l(s[u]),a<0&&(a+=1);l=null;var h=function(){var d=2091639*i+c*23283064365386963e-26;return i=o,o=a,a=d-(c=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=s,h.exportState=function(){return[i,o,a,c]},h.importState=function(d){i=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var s=4022871197,i=function(o){o=o.toString();for(var a=0;a<o.length;a++){s+=o.charCodeAt(a);var c=.02519603282416938*s;s=c>>>0,c-=s,c*=s,s=c>>>0,c-=s,s+=c*4294967296}return(s>>>0)*23283064365386963e-26};return i.version="Mash 0.9",i}})})(el);var Ug=el.exports,Pg=oo(Ug);const Dg=Pg("089fad0j9awfem09wavefc09uwaef");function An(e,t=0,n=1){return Math.max(t,Math.min(n,e))}function Fg(){return Dg()}function Ns(e,t){const n=Math.min(e,t),s=Math.max(e,t)-n+1;return n+Math.floor(Fg()*s)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var $g=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var i in s)s.hasOwnProperty(i)&&(r[i]=s[i])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Bg=Object.prototype.hasOwnProperty;function lo(e,t){return Bg.call(e,t)}function uo(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var s in e)lo(e,s)&&r.push(s);return r}function It(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ho(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function wn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function nl(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function fo(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(fo(e[t]))return!0}else if(typeof e=="object"){for(var r=uo(e),s=r.length,i=0;i<s;i++)if(fo(e[r[i]]))return!0}}return!1}function rl(e,t){var n=[e];for(var r in t){var s=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof s<"u"&&n.push(r+": "+s)}return n.join(`
`)}var sl=function(e){$g(t,e);function t(n,r,s,i,o){var a=this.constructor,c=e.call(this,rl(n,{name:r,index:s,operation:i,tree:o}))||this;return c.name=r,c.index=s,c.operation=i,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=rl(n,{name:r,index:s,operation:i,tree:o}),c}return t}(Error),rt=sl,Gg=It,zn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=bs(n,this.path);r&&(r=It(r));var s=Rn(n,{op:"remove",path:this.from}).removed;return Rn(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=bs(n,this.from);return Rn(n,{op:"add",path:this.path,value:It(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:br(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},jg={add:function(e,t,n){return ho(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:zn.move,copy:zn.copy,test:zn.test,_get:zn._get};function bs(e,t){if(t=="")return e;var n={op:"_get",path:t};return Rn(e,n),n.value}function Rn(e,t,n,r,s,i){if(n===void 0&&(n=!1),r===void 0&&(r=!0),s===void 0&&(s=!0),i===void 0&&(i=0),n&&(typeof n=="function"?n(t,0,e,t.path):Ls(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=bs(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=br(e,t.value),o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new rt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return o}}else{r||(e=It(e));var a=t.path||"",c=a.split("/"),l=e,u=1,h=c.length,d=void 0,f=void 0,m=void 0;for(typeof n=="function"?m=n:m=Ls;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=nl(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=c.slice(0,u).join("/"):u==h-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!ho(f))throw new rt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);ho(f)&&(f=~~f)}if(u>=h){if(n&&t.op==="add"&&f>l.length)throw new rt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);var o=jg[t.op].call(t,l,f,e);if(o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o}}else if(u>=h){var o=zn[t.op].call(t,l,f,e);if(o.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return o}if(l=l[f],n&&u<h&&(!l||typeof l!="object"))throw new rt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,e)}}}function po(e,t,n,r,s){if(r===void 0&&(r=!0),s===void 0&&(s=!0),n&&!Array.isArray(t))throw new rt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=It(e));for(var i=new Array(t.length),o=0,a=t.length;o<a;o++)i[o]=Rn(e,t[o],n,!0,s,o),e=i[o].newDocument;return i.newDocument=e,i}function Kg(e,t,n){var r=Rn(e,t);if(r.test===!1)throw new rt("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Ls(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new rt("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(zn[e.op]){if(typeof e.path!="string")throw new rt("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new rt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new rt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new rt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&fo(e.value))throw new rt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var s=e.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new rt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new rt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=il([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new rt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new rt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function il(e,t,n){try{if(!Array.isArray(e))throw new rt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)po(It(t),It(e),n||!0);else{n=n||Ls;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(s){if(s instanceof rt)return s;throw s}}function br(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),s,i,o;if(n&&r){if(i=e.length,i!=t.length)return!1;for(s=i;s--!==0;)if(!br(e[s],t[s]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(i=a.length,i!==Object.keys(t).length)return!1;for(s=i;s--!==0;)if(!t.hasOwnProperty(a[s]))return!1;for(s=i;s--!==0;)if(o=a[s],!br(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var Wg=Object.freeze({__proto__:null,JsonPatchError:rt,_areEquals:br,applyOperation:Rn,applyPatch:po,applyReducer:Kg,deepClone:Gg,getValueByPointer:bs,validate:il,validator:Ls});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var go=new WeakMap,Hg=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Vg=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function zg(e){return go.get(e)}function Yg(e,t){return e.observers.get(t)}function qg(e,t){e.observers.delete(t.callback)}function Xg(e,t){t.unobserve()}function Jg(e,t){var n=[],r,s=zg(e);if(!s)s=new Hg(e),go.set(e,s);else{var i=Yg(s,t);r=i&&i.observer}if(r)return r;if(r={},s.value=It(e),t){r.callback=t,r.next=null;var o=function(){mo(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){mo(r),clearTimeout(r.next),qg(s,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},s.observers.set(t,new Vg(t,r)),r}function mo(e,t){t===void 0&&(t=!1);var n=go.get(e.object);Eo(n.value,e.object,e.patches,"",t),e.patches.length&&po(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Eo(e,t,n,r,s){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var i=uo(t),o=uo(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(lo(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var h=t[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?Eo(u,h,n,r+"/"+wn(l),s):u!==h&&(s&&n.push({op:"test",path:r+"/"+wn(l),value:It(u)}),n.push({op:"replace",path:r+"/"+wn(l),value:It(h)}))}else Array.isArray(e)===Array.isArray(t)?(s&&n.push({op:"test",path:r+"/"+wn(l),value:It(u)}),n.push({op:"remove",path:r+"/"+wn(l)}),a=!0):(s&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&i.length==o.length))for(var c=0;c<i.length;c++){var l=i[c];!lo(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+wn(l),value:It(t[l])})}}}function _o(e,t,n){n===void 0&&(n=!1);var r=[];return Eo(e,t,r,"",n),r}var Qg=Object.freeze({__proto__:null,compare:_o,generate:mo,observe:Jg,unobserve:Xg});Object.assign({},Wg,Qg,{JsonPatchError:sl,deepClone:It,escapePathComponent:wn,unescapePathComponent:nl});function E(e){return e!=null}function Zg(e,t){return _o(e,t).length===0}function tm(e){return It(e)}function Nt(e){return typeof e=="number"}function st(e){return typeof e=="string"}function Be(e){return Array.isArray(e)}function em(e){return e}function yo(e,t,n){typeof e!="number"&&(e=0,t=0,n=1),typeof t!="number"&&(t=e,e=0,n=1),typeof n!="number"&&(n=1);const r=[],s=Math.min(e,t),i=Math.max(e,t);for(let o=s;o<=i;o+=n)r.push(o);return r}function nm(e){return e[Ns(0,e.length-1)]}function Ge(...e){return nm(e.flat())}function rm(e){return[...new Set(e)].filter(E)}function sm(...e){const t=e.flat().filter(E);return t.reduce((n,r)=>n+r,0)/t.length}function ol(e,t){const n=e??ht.WALK,r=t??ht.WALK;switch(n){case ht.WALK:return r!==ht.WALK;case ht.SWIM:return r!==ht.SWIM;case ht.SOLID:return!0;case ht.BULLET:return r!==ht.WALK&&r!==ht.SWIM}}function To(e,t){var r,s;return[...((s=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:s.values())??[]].map(i=>typeof i=="string"?e==null?void 0:e.objects[i]:e==null?void 0:e.terrain[i]).filter(E)}function im(e,t){const n=No(t),r=bl(t),s=Ll(t);return e.filter(i=>!(E(n)&&hm(i)!==n||E(r)&&fm(i)!==r||E(s)&&dm(i)!==s)).filter(E)}function So(e,t){return E(e)?t.map(n=>{var r;if(typeof n=="string"){const s=e.objects[n];if(E(s))return s;const i=To(e,n.toLowerCase());if(i.length)return i}else if(_e(n)&&n.x>=0&&n.x<e.width&&n.y>=0&&n.y<e.height){const s=n.x+n.y*e.width,i=(r=e.lookup)==null?void 0:r[s];return E(i)?e.objects[i]:e.terrain[s]}}).flat().filter(E):[]}function om(e,t){let n=0,r;for(let s=0;s<t.length;++s){const i=t[s];if(i){const o=e.x-(i.x??0),a=e.y-(i.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=i)}}return r}const al=60,cl=25,am=new Array(al*cl);function cm(e=em){const t={id:$e(),x:0,y:0,width:al,height:cl,terrain:am.slice(0),objects:{}};return e(t)}function lm(e,t){return!E(e)||t.x<0||t.x>=e.width||t.y<0||t.y>=e.height?-1:t.x+t.y*e.width}function um(e,t){const n=lm(e,t);if(n<0||!E(e==null?void 0:e.lookup))return;const r=Ao(e,e.lookup[n]??"");return E(r)?r:e.terrain[n]}function hm(e){var t;return((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"object").toLowerCase()}function fm(e){var t;return(e==null?void 0:e.color)??((t=e==null?void 0:e.kinddata)==null?void 0:t.color)??V.BLACK}function dm(e){var t;return(e==null?void 0:e.bg)??((t=e==null?void 0:e.kinddata)==null?void 0:t.bg)??V.BLACK}function Cs(e,t){if(!E(e)||!Yt(t))return;const n=Al(t);E(n)&&(e.color=n);const r=wl(t);E(r)&&(e.bg=r)}function pm(e,t){if(!E(e)||!E(t)||!E(t.x)||!E(t.y)||t.x<0||t.x>=e.width||t.y<0||t.y>=e.height)return;const n={...t},r=t.x+t.y*e.width;return e.terrain[r]=n,t}function ll(e,t){if(!E(e)||!E(t))return;const n={...t,id:t.id??$e()};return e.objects[n.id]=n,n}function ul(e,t,n){return pm(e,{...t,kind:n})}function hl(e,t,n){return ll(e,{...t,kind:n})}function Ao(e,t){if(e)return e.objects[t]}function Yn(e,t,n){if(!E(e)||!E(t))return{x:0,y:0};const r={x:t.x??0,y:t.y??0},s={x:t.lx??r.x,y:t.ly??r.y},i={...r},o=sn(s,r),a=e.width-1,c=e.height-1;for(let l=0;l<n.length;++l){const u=Em(n[l]);switch(u){case W.IDLE:break;case W.NORTH:case W.SOUTH:case W.WEST:case W.EAST:zt(r,u);break;case W.BY:{const[h,d]=n.slice(l+1);Nt(h)&&Nt(d)&&(r.x=An(r.x+h,0,a),r.y=An(r.y+d,0,c)),l+=2;break}case W.AT:{const[h,d]=n.slice(l+1);Nt(h)&&Nt(d)&&(r.x=An(h,0,a),r.y=An(d,0,c)),l+=2;break}case W.FLOW:zt(r,o);break;case W.SEEK:{const h=Ro(e,t);_e(h)&&zt(r,sn(i,h));break}case W.RNDNS:zt(r,Ge(W.NORTH,W.SOUTH));break;case W.RNDNE:zt(r,Ge(W.NORTH,W.EAST));break;case W.RND:zt(r,Ge(W.NORTH,W.SOUTH,W.WEST,W.EAST));break;case W.CW:{const h=Yn(e,t,n.slice(l+1));zt(r,sn(i,h));break}case W.CCW:{const h=Yn(e,t,n.slice(l+1));zt(r,sn(i,h));break}case W.OPP:{const h=Yn(e,t,n.slice(l+1));zt(r,sn(i,h));break}case W.RNDP:{const h=Yn(e,t,n.slice(l+1));switch(sn(i,h)){case W.NORTH:case W.SOUTH:r.x+=Ge(-1,1);break;case W.WEST:case W.EAST:r.y+=Ge(-1,1);break}break}}}return r}function wo(e,t){return E(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function Ro(e,t){var s;if(!E(e)||!E(t))return;const n=((s=t.stats)==null?void 0:s.player)??"",r=e.objects[n];if(E(r))return r;if(_e(t))return om(t,To(e,"player"))}function gm(e,t,n){return{book:e.book,board:e.board,object:e.object,terrain:e.terrain,charset:e.charset,palette:e.palette,words:t,get:n}}var W=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e))(W||{}),ht=(e=>(e[e.SOLID=0]="SOLID",e[e.WALK=1]="WALK",e[e.SWIM=2]="SWIM",e[e.BULLET=3]="BULLET",e))(ht||{}),Is=(e=>(e[e.TERRAIN=0]="TERRAIN",e[e.OBJECT=1]="OBJECT",e))(Is||{});function _e(e){return E(e)&&E(e.x)&&E(e.y)}function zt(e,t){switch(t){case 1:--e.y;break;case 2:++e.y;break;case 3:--e.x;break;case 4:++e.x;break}return e}function sn(e,t){const n=t.x-e.x,r=t.y-e.y;if(n<0)return 3;if(n>0)return 4;if(r<0)return 1;if(r>0)return 2}const fl={terrain:"TERRAIN",object:"OBJECT"};function on(e){return Be(e)&&dl(e[0])}function dl(e){return E(Is[e])&&st(e)}function pl(e){if(st(e))return fl[e.toLowerCase()]}function gl(e){if(on(e))return e;if(dl(e))return[e];const t=pl(e);if(E(t))return[t]}function Os(e,t){const n=e.words[t],r=gl(n);if(on(r))return[r,t+1];const[s,i]=Ot(e,t),o=gl(s);return on(o)?[o,i]:[void 0,t]}const ml={solid:"SOLID",walk:"WALK",swim:"SWIM",bullet:"BULLET",walkable:"WALK",swimmable:"SWIM"};function vn(e){return Be(e)&&vo(e[0])}function vo(e){return E(ht[e])&&st(e)}function mm(e){if(st(e))return ml[e.toLowerCase()]}function El(e,t){const n=e.words[t];if(vn(n))return[n,t+1];if(vo(n))return[[n],t+1];const[r,s]=Ot(e,t);return vn(r)?[r,s]:vo(r)?[[r],s]:[void 0,t]}const _l={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",clear:"CLEAR",shadow:"SHADOW",borrow:"BORROW",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY"};function Yt(e){return Be(e)&&Tl(e[0])}function yl(e){return Yt(e)&&e[0].startsWith("ON")}function Tl(e){return E(V[e])&&st(e)}function Sl(e){if(st(e))return _l[e.toLowerCase()]}function Al(e){return e.map(t=>V[t]).find(t=>E(t)&&t<V.ONBLACK)}function wl(e){return e.map(t=>V[t]).find(t=>E(t)&&t>=V.ONBLACK)}function Rl(e){if(Yt(e))return e;if(Tl(e))return[e];const t=Sl(e);if(E(t))return[t]}function vl(e,t){const n=e.words[t],r=Rl(n);if(Yt(r))return[r,t+1];const[s,i]=Ot(e,t),o=Rl(s);return Yt(o)?[o,i]:[void 0,t]}function ks(e,t){const n=[];let r=t;const[s,i]=vl(e,t);if(Yt(s)&&(n.push(...s),r=i),Yt(n)&&!yl(n)){const[o,a]=vl(e,i);yl(o)&&(r=a)}return n.length?[n,r]:[void 0,t]}function qn(e){return Be(e)&&typeof e[0]=="string"}function Nl(e,t){const n=e.words[t];if(qn(n))return[n,t+1];const[r,s]=ks(e,t),[i,o]=Ot(e,s,!1);return st(i)?[[i,r],o]:[void 0,t]}function No(e){if(!qn(e))return;const[t]=e;return t}function bl(e){if(!qn(e))return;const[,t]=e,n=E(t)?Al(t):void 0;return E(n)?n:void 0}function Ll(e){if(!qn(e))return;const[,t]=e,n=E(t)?wl(t):void 0;return E(n)?n:void 0}const Cl={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function je(e){return Be(e)&&Il(e[0])}function Il(e){return E(W[e])&&st(e)}function Em(e){const t=W[e];return E(t)?t:0}function Ol(e){if(st(e))return Cl[e.toLowerCase()]}function kl(e){if(je(e))return e;if(Il(e))return[e];const t=Ol(e);if(E(t))return[t]}function Ml(e,t){const n=e.words[t],r=kl(n);if(je(r))return[r,t+1];const[s,i]=Ot(e,t),o=kl(s);return je(o)?[o,i]:[void 0,t]}function bo(e,t){const n=[];let[r,s]=Ml(e,t);for(;je(r);){if(n.push(...r),r[0]==="AT"||r[0]==="BY"){const[a,c,l]=L(e,s,[5,5]);n.push(a,c),s=l}const[i,o]=Ml(e,s);r=i,s=o}return n.length?[n,s]:[void 0,t]}function Ot(e,t,n=!0){const r=e.words[t];if(pl(r)){const[s,i]=Os(e,t);if(E(s))return[s,i]}if(mm(r)){const[s,i]=El(e,t);if(E(s))return[s,i]}if(Sl(r)){const[s,i]=ks(e,t);if(E(s))return[s,i]}if(st(r)&&r.toLowerCase()==="rnd"){const[s,i]=Ot(e,t+1),[o,a]=Ot(e,i);return Nt(s)&&Nt(o)?[Ns(s,o),a]:Nt(s)?[Ns(0,s),i]:[Ns(0,1),t+1]}if(Ol(r)){const[s,i]=bo(e,t);if(E(s))return[s,i]}if(!E(r))return[void 0,t];if(_e(r)||Nt(r)||Be(r))return[r,t+1];if(st(r)){const s=r.toLowerCase();if(n){const i=e.get(r);if(E(i))return[i,t+1]}switch(s){case"aligned":case"alligned":break;case"contact":break;case"blocked":break;case"any":break;case"abs":{const[i,o]=L(e,t+1,[5]);return[Math.abs(i),o]}case"ceil":{const[i,o]=L(e,t+1,[5]);return[Math.ceil(i),o]}case"floor":{const[i,o]=L(e,t+1,[5]);return[Math.floor(i),o]}case"round":{const[i,o]=L(e,t+1,[5]);return[Math.round(i),o]}case"min":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Ot(e,o);if(Be(a)&&!_e(a)&&!je(a)&&!on(a)&&!vn(a)&&!Yt(a))return[Ge(a),c];o=c,i.push(a)}return[Math.min(...i),e.words.length]}case"max":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Ot(e,o);if(Be(a)&&!_e(a)&&!je(a)&&!on(a)&&!vn(a)&&!Yt(a))return[Ge(a),c];o=c,i.push(a)}return[Math.max(...i),e.words.length]}case"clamp":{const[i,o,a,c]=L(e,t+1,[5,5,5]);return[An(i,o,a),c]}case"pick":{const i=[];for(let o=t+1;o<e.words.length;){const[a,c]=Ot(e,o);if(Be(a)&&!_e(a)&&!je(a)&&!on(a)&&!vn(a)&&!Yt(a))return[Ge(a),c];o=c,i.push(a)}return[Ge(i),e.words.length]}case"range":{const[i,o,a,c]=L(e,t+1,[5,13,13]);return[yo(i,o,a),c]}}}return[r,t+1]}var N=(e=>(e[e.CATEGORY=0]="CATEGORY",e[e.COLLISION=1]="COLLISION",e[e.COLOR=2]="COLOR",e[e.KIND=3]="KIND",e[e.DIR=4]="DIR",e[e.NUMBER=5]="NUMBER",e[e.STRING=6]="STRING",e[e.NUMBER_OR_STRING=7]="NUMBER_OR_STRING",e[e.MAYBE_CATEGORY=8]="MAYBE_CATEGORY",e[e.MAYBE_COLLISION=9]="MAYBE_COLLISION",e[e.MAYBE_COLOR=10]="MAYBE_COLOR",e[e.MAYBE_KIND=11]="MAYBE_KIND",e[e.MAYBE_DIR=12]="MAYBE_DIR",e[e.MAYBE_NUMBER=13]="MAYBE_NUMBER",e[e.MAYBE_STRING=14]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=15]="MAYBE_NUMBER_OR_STRING",e[e.ANY=16]="ANY",e))(N||{});function bt(e,t){throw new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function L(e,t,n){const r=[];let s=t;for(let i=0;i<n.length;++i)switch(n[i]){case 0:{const[o,a]=Os(e,s);on(o)||bt("terrain or object",o),s=a,r.push(o);break}case 1:{const[o,a]=El(e,s);vn(o)||bt("solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 2:{const[o,a]=ks(e,s);Yt(o)||bt("color",o),s=a,r.push(o);break}case 3:{const[o,a]=Nl(e,s);qn(o)?(s=a,r.push(o)):bt("kind",o);break}case 4:{const[o,a]=bo(e,s);if(je(o)){const c=e.board?Yn(e.board,e.object,o):{x:0,y:0};s=a,r.push(c)}else bt("direction",o);break}case 5:{const[o,a]=Ot(e,s);Nt(o)||bt("number",o),s=a,r.push(o);break}case 6:{const o=e.words[s];st(o)||bt("string",o),++s,r.push(o);break}case 7:{const[o,a]=Ot(e,s,!1);!Nt(o)&&!st(o)&&bt("number or string",o),s=a,r.push(o);break}case 8:{const[o,a]=Os(e,s);o!==void 0&&!on(o)&&bt("optional terrain or object",o),s=a,r.push(o);break}case 9:{const[o,a]=Os(e,s);o!==void 0&&!vn(o)&&bt("optional solid, walk, swim, bullet, walkable or swimmable",o),s=a,r.push(o);break}case 10:{const[o,a]=ks(e,s);o!==void 0&&!Yt(o)&&bt("optional color",o),s=a,r.push(o);break}case 11:{const[o,a]=Nl(e,s);o!==void 0&&!qn(o)&&bt("optional kind",o),s=a,r.push(o);break}case 12:{const[o,a]=bo(e,s);if(je(o)){const c=e.board?Yn(e.board,e.object,o):{x:0,y:0};s=a,r.push(c)}else o===void 0?(s=a,r.push(void 0)):bt("optional direction",o);break}case 13:{const[o,a]=Ot(e,s);o!==void 0&&!Nt(o)&&bt("optional number",o),s=a,r.push(o);break}case 14:{const o=e.words[s];o!==void 0&&!st(o)&&bt("optional string",o),++s,r.push(o);break}case 15:{const[o,a]=Ot(e,s,!1);o!==void 0&&!Nt(o)&&!st(o)&&bt("optional number or string",o),s=a,r.push(o);break}case 16:{const[o,a]=Ot(e,s);s=a,r.push(o);break}}return[...r,s]}const Lo=40,Co=Math.round(1e3/Lo),_m=3;var xl=typeof global=="object"&&global&&global.Object===Object&&global,ym=typeof self=="object"&&self&&self.Object===Object&&self,ye=xl||ym||Function("return this")(),qt=ye.Symbol,Ul=Object.prototype,Tm=Ul.hasOwnProperty,Sm=Ul.toString,Lr=qt?qt.toStringTag:void 0;function Am(e){var t=Tm.call(e,Lr),n=e[Lr];try{e[Lr]=void 0;var r=!0}catch{}var s=Sm.call(e);return r&&(t?e[Lr]=n:delete e[Lr]),s}var wm=Object.prototype,Rm=wm.toString;function vm(e){return Rm.call(e)}var Nm="[object Null]",bm="[object Undefined]",Pl=qt?qt.toStringTag:void 0;function an(e){return e==null?e===void 0?bm:Nm:Pl&&Pl in Object(e)?Am(e):vm(e)}function oe(e){return e!=null&&typeof e=="object"}var Lm="[object Symbol]";function Ms(e){return typeof e=="symbol"||oe(e)&&an(e)==Lm}function xs(e,t){for(var n=-1,r=e==null?0:e.length,s=Array(r);++n<r;)s[n]=t(e[n],n,e);return s}var j=Array.isArray,Cm=1/0,Dl=qt?qt.prototype:void 0,Fl=Dl?Dl.toString:void 0;function $l(e){if(typeof e=="string")return e;if(j(e))return xs(e,$l)+"";if(Ms(e))return Fl?Fl.call(e):"";var t=e+"";return t=="0"&&1/e==-Cm?"-0":t}var Im=/\s/;function Om(e){for(var t=e.length;t--&&Im.test(e.charAt(t)););return t}var km=/^\s+/;function Mm(e){return e&&e.slice(0,Om(e)+1).replace(km,"")}function Xt(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Bl=NaN,xm=/^[-+]0x[0-9a-f]+$/i,Um=/^0b[01]+$/i,Pm=/^0o[0-7]+$/i,Dm=parseInt;function Fm(e){if(typeof e=="number")return e;if(Ms(e))return Bl;if(Xt(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Xt(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Mm(e);var n=Um.test(e);return n||Pm.test(e)?Dm(e.slice(2),n?2:8):xm.test(e)?Bl:+e}var Gl=1/0,$m=17976931348623157e292;function Bm(e){if(!e)return e===0?e:0;if(e=Fm(e),e===Gl||e===-Gl){var t=e<0?-1:1;return t*$m}return e===e?e:0}function Us(e){var t=Bm(e),n=t%1;return t===t?n?t-n:t:0}function Xn(e){return e}var Gm="[object AsyncFunction]",jm="[object Function]",Km="[object GeneratorFunction]",Wm="[object Proxy]";function Ke(e){if(!Xt(e))return!1;var t=an(e);return t==jm||t==Km||t==Gm||t==Wm}var Io=ye["__core-js_shared__"],jl=function(){var e=/[^.]+$/.exec(Io&&Io.keys&&Io.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Hm(e){return!!jl&&jl in e}var Vm=Function.prototype,zm=Vm.toString;function Nn(e){if(e!=null){try{return zm.call(e)}catch{}try{return e+""}catch{}}return""}var Ym=/[\\^$.*+?()[\]{}|]/g,qm=/^\[object .+?Constructor\]$/,Xm=Function.prototype,Jm=Object.prototype,Qm=Xm.toString,Zm=Jm.hasOwnProperty,tE=RegExp("^"+Qm.call(Zm).replace(Ym,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function eE(e){if(!Xt(e)||Hm(e))return!1;var t=Ke(e)?tE:qm;return t.test(Nn(e))}function nE(e,t){return e==null?void 0:e[t]}function bn(e,t){var n=nE(e,t);return eE(n)?n:void 0}var Oo=bn(ye,"WeakMap"),Kl=Object.create,rE=function(){function e(){}return function(t){if(!Xt(t))return{};if(Kl)return Kl(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function sE(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function pt(){}function iE(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var oE=800,aE=16,cE=Date.now;function lE(e){var t=0,n=0;return function(){var r=cE(),s=aE-(r-n);if(n=r,s>0){if(++t>=oE)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function uE(e){return function(){return e}}var Ps=function(){try{var e=bn(Object,"defineProperty");return e({},"",{}),e}catch{}}(),hE=Ps?function(e,t){return Ps(e,"toString",{configurable:!0,enumerable:!1,value:uE(t),writable:!0})}:Xn,fE=lE(hE);function Wl(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function Hl(e,t,n,r){for(var s=e.length,i=n+-1;++i<s;)if(t(e[i],i,e))return i;return-1}function dE(e){return e!==e}function pE(e,t,n){for(var r=n-1,s=e.length;++r<s;)if(e[r]===t)return r;return-1}function ko(e,t,n){return t===t?pE(e,t,n):Hl(e,dE,n)}function Vl(e,t){var n=e==null?0:e.length;return!!n&&ko(e,t,0)>-1}var gE=9007199254740991,mE=/^(?:0|[1-9]\d*)$/;function Ds(e,t){var n=typeof e;return t=t??gE,!!t&&(n=="number"||n!="symbol"&&mE.test(e))&&e>-1&&e%1==0&&e<t}function Mo(e,t,n){t=="__proto__"&&Ps?Ps(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Cr(e,t){return e===t||e!==e&&t!==t}var EE=Object.prototype,_E=EE.hasOwnProperty;function Fs(e,t,n){var r=e[t];(!(_E.call(e,t)&&Cr(r,n))||n===void 0&&!(t in e))&&Mo(e,t,n)}function xo(e,t,n,r){var s=!n;n||(n={});for(var i=-1,o=t.length;++i<o;){var a=t[i],c=void 0;c===void 0&&(c=e[a]),s?Mo(n,a,c):Fs(n,a,c)}return n}var zl=Math.max;function yE(e,t,n){return t=zl(t===void 0?e.length-1:t,0),function(){for(var r=arguments,s=-1,i=zl(r.length-t,0),o=Array(i);++s<i;)o[s]=r[t+s];s=-1;for(var a=Array(t+1);++s<t;)a[s]=r[s];return a[t]=n(o),sE(e,this,a)}}function Uo(e,t){return fE(yE(e,t,Xn),e+"")}var TE=9007199254740991;function Po(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=TE}function Te(e){return e!=null&&Po(e.length)&&!Ke(e)}function Yl(e,t,n){if(!Xt(n))return!1;var r=typeof t;return(r=="number"?Te(n)&&Ds(t,n.length):r=="string"&&t in n)?Cr(n[t],e):!1}function SE(e){return Uo(function(t,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,o=s>2?n[2]:void 0;for(i=e.length>3&&typeof i=="function"?(s--,i):void 0,o&&Yl(n[0],n[1],o)&&(i=s<3?void 0:i,s=1),t=Object(t);++r<s;){var a=n[r];a&&e(t,a,r,i)}return t})}var AE=Object.prototype;function Ir(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||AE;return e===n}function wE(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var RE="[object Arguments]";function ql(e){return oe(e)&&an(e)==RE}var Xl=Object.prototype,vE=Xl.hasOwnProperty,NE=Xl.propertyIsEnumerable,$s=ql(function(){return arguments}())?ql:function(e){return oe(e)&&vE.call(e,"callee")&&!NE.call(e,"callee")};function bE(){return!1}var Jl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ql=Jl&&typeof module=="object"&&module&&!module.nodeType&&module,LE=Ql&&Ql.exports===Jl,Zl=LE?ye.Buffer:void 0,CE=Zl?Zl.isBuffer:void 0,Or=CE||bE,IE="[object Arguments]",OE="[object Array]",kE="[object Boolean]",ME="[object Date]",xE="[object Error]",UE="[object Function]",PE="[object Map]",DE="[object Number]",FE="[object Object]",$E="[object RegExp]",BE="[object Set]",GE="[object String]",jE="[object WeakMap]",KE="[object ArrayBuffer]",WE="[object DataView]",HE="[object Float32Array]",VE="[object Float64Array]",zE="[object Int8Array]",YE="[object Int16Array]",qE="[object Int32Array]",XE="[object Uint8Array]",JE="[object Uint8ClampedArray]",QE="[object Uint16Array]",ZE="[object Uint32Array]",J={};J[HE]=J[VE]=J[zE]=J[YE]=J[qE]=J[XE]=J[JE]=J[QE]=J[ZE]=!0,J[IE]=J[OE]=J[KE]=J[kE]=J[WE]=J[ME]=J[xE]=J[UE]=J[PE]=J[DE]=J[FE]=J[$E]=J[BE]=J[GE]=J[jE]=!1;function t_(e){return oe(e)&&Po(e.length)&&!!J[an(e)]}function Bs(e){return function(t){return e(t)}}var tu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kr=tu&&typeof module=="object"&&module&&!module.nodeType&&module,e_=kr&&kr.exports===tu,Do=e_&&xl.process,cn=function(){try{var e=kr&&kr.require&&kr.require("util").types;return e||Do&&Do.binding&&Do.binding("util")}catch{}}(),eu=cn&&cn.isTypedArray,Fo=eu?Bs(eu):t_,n_=Object.prototype,r_=n_.hasOwnProperty;function nu(e,t){var n=j(e),r=!n&&$s(e),s=!n&&!r&&Or(e),i=!n&&!r&&!s&&Fo(e),o=n||r||s||i,a=o?wE(e.length,String):[],c=a.length;for(var l in e)(t||r_.call(e,l))&&!(o&&(l=="length"||s&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||Ds(l,c)))&&a.push(l);return a}function ru(e,t){return function(n){return e(t(n))}}var s_=ru(Object.keys,Object),i_=Object.prototype,o_=i_.hasOwnProperty;function su(e){if(!Ir(e))return s_(e);var t=[];for(var n in Object(e))o_.call(e,n)&&n!="constructor"&&t.push(n);return t}function Jt(e){return Te(e)?nu(e):su(e)}var a_=Object.prototype,c_=a_.hasOwnProperty,Bt=SE(function(e,t){if(Ir(t)||Te(t)){xo(t,Jt(t),e);return}for(var n in t)c_.call(t,n)&&Fs(e,n,t[n])});function l_(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var u_=Object.prototype,h_=u_.hasOwnProperty;function f_(e){if(!Xt(e))return l_(e);var t=Ir(e),n=[];for(var r in e)r=="constructor"&&(t||!h_.call(e,r))||n.push(r);return n}function iu(e){return Te(e)?nu(e,!0):f_(e)}var d_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,p_=/^\w*$/;function $o(e,t){if(j(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Ms(e)?!0:p_.test(e)||!d_.test(e)||t!=null&&e in Object(t)}var Mr=bn(Object,"create");function g_(){this.__data__=Mr?Mr(null):{},this.size=0}function m_(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var E_="__lodash_hash_undefined__",__=Object.prototype,y_=__.hasOwnProperty;function T_(e){var t=this.__data__;if(Mr){var n=t[e];return n===E_?void 0:n}return y_.call(t,e)?t[e]:void 0}var S_=Object.prototype,A_=S_.hasOwnProperty;function w_(e){var t=this.__data__;return Mr?t[e]!==void 0:A_.call(t,e)}var R_="__lodash_hash_undefined__";function v_(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Mr&&t===void 0?R_:t,this}function Ln(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ln.prototype.clear=g_,Ln.prototype.delete=m_,Ln.prototype.get=T_,Ln.prototype.has=w_,Ln.prototype.set=v_;function N_(){this.__data__=[],this.size=0}function Gs(e,t){for(var n=e.length;n--;)if(Cr(e[n][0],t))return n;return-1}var b_=Array.prototype,L_=b_.splice;function C_(e){var t=this.__data__,n=Gs(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():L_.call(t,n,1),--this.size,!0}function I_(e){var t=this.__data__,n=Gs(t,e);return n<0?void 0:t[n][1]}function O_(e){return Gs(this.__data__,e)>-1}function k_(e,t){var n=this.__data__,r=Gs(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function We(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}We.prototype.clear=N_,We.prototype.delete=C_,We.prototype.get=I_,We.prototype.has=O_,We.prototype.set=k_;var xr=bn(ye,"Map");function M_(){this.size=0,this.__data__={hash:new Ln,map:new(xr||We),string:new Ln}}function x_(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function js(e,t){var n=e.__data__;return x_(t)?n[typeof t=="string"?"string":"hash"]:n.map}function U_(e){var t=js(this,e).delete(e);return this.size-=t?1:0,t}function P_(e){return js(this,e).get(e)}function D_(e){return js(this,e).has(e)}function F_(e,t){var n=js(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function He(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}He.prototype.clear=M_,He.prototype.delete=U_,He.prototype.get=P_,He.prototype.has=D_,He.prototype.set=F_;var $_="Expected a function";function Bo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError($_);var n=function(){var r=arguments,s=t?t.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var o=e.apply(this,r);return n.cache=i.set(s,o)||i,o};return n.cache=new(Bo.Cache||He),n}Bo.Cache=He;var B_=500;function G_(e){var t=Bo(e,function(r){return n.size===B_&&n.clear(),r}),n=t.cache;return t}var j_=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,K_=/\\(\\)?/g,W_=G_(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(j_,function(n,r,s,i){t.push(s?i.replace(K_,"$1"):r||n)}),t});function H_(e){return e==null?"":$l(e)}function Ks(e,t){return j(e)?e:$o(e,t)?[e]:W_(H_(e))}var V_=1/0;function Ur(e){if(typeof e=="string"||Ms(e))return e;var t=e+"";return t=="0"&&1/e==-V_?"-0":t}function Go(e,t){t=Ks(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Ur(t[n++])];return n&&n==r?e:void 0}function z_(e,t,n){var r=e==null?void 0:Go(e,t);return r===void 0?n:r}function jo(e,t){for(var n=-1,r=t.length,s=e.length;++n<r;)e[s+n]=t[n];return e}var ou=qt?qt.isConcatSpreadable:void 0;function Y_(e){return j(e)||$s(e)||!!(ou&&e&&e[ou])}function Ko(e,t,n,r,s){var i=-1,o=e.length;for(n||(n=Y_),s||(s=[]);++i<o;){var a=e[i];n(a)?jo(s,a):r||(s[s.length]=a)}return s}function ae(e){var t=e==null?0:e.length;return t?Ko(e):[]}var au=ru(Object.getPrototypeOf,Object);function cu(e,t,n){var r=-1,s=e.length;t<0&&(t=-t>s?0:s+t),n=n>s?s:n,n<0&&(n+=s),s=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(s);++r<s;)i[r]=e[r+t];return i}function q_(e,t,n,r){var s=-1,i=e==null?0:e.length;for(r&&i&&(n=e[++s]);++s<i;)n=t(n,e[s],s,e);return n}function X_(){this.__data__=new We,this.size=0}function J_(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Q_(e){return this.__data__.get(e)}function Z_(e){return this.__data__.has(e)}var ty=200;function ey(e,t){var n=this.__data__;if(n instanceof We){var r=n.__data__;if(!xr||r.length<ty-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new He(r)}return n.set(e,t),this.size=n.size,this}function Se(e){var t=this.__data__=new We(e);this.size=t.size}Se.prototype.clear=X_,Se.prototype.delete=J_,Se.prototype.get=Q_,Se.prototype.has=Z_,Se.prototype.set=ey;function ny(e,t){return e&&xo(t,Jt(t),e)}var lu=typeof exports=="object"&&exports&&!exports.nodeType&&exports,uu=lu&&typeof module=="object"&&module&&!module.nodeType&&module,ry=uu&&uu.exports===lu,hu=ry?ye.Buffer:void 0,fu=hu?hu.allocUnsafe:void 0;function sy(e,t){var n=e.length,r=fu?fu(n):new e.constructor(n);return e.copy(r),r}function Wo(e,t){for(var n=-1,r=e==null?0:e.length,s=0,i=[];++n<r;){var o=e[n];t(o,n,e)&&(i[s++]=o)}return i}function du(){return[]}var iy=Object.prototype,oy=iy.propertyIsEnumerable,pu=Object.getOwnPropertySymbols,Ho=pu?function(e){return e==null?[]:(e=Object(e),Wo(pu(e),function(t){return oy.call(e,t)}))}:du;function ay(e,t){return xo(e,Ho(e),t)}var cy=Object.getOwnPropertySymbols,ly=cy?function(e){for(var t=[];e;)jo(t,Ho(e)),e=au(e);return t}:du;function gu(e,t,n){var r=t(e);return j(e)?r:jo(r,n(e))}function Vo(e){return gu(e,Jt,Ho)}function uy(e){return gu(e,iu,ly)}var zo=bn(ye,"DataView"),Yo=bn(ye,"Promise"),Jn=bn(ye,"Set"),mu="[object Map]",hy="[object Object]",Eu="[object Promise]",_u="[object Set]",yu="[object WeakMap]",Tu="[object DataView]",fy=Nn(zo),dy=Nn(xr),py=Nn(Yo),gy=Nn(Jn),my=Nn(Oo),Qt=an;(zo&&Qt(new zo(new ArrayBuffer(1)))!=Tu||xr&&Qt(new xr)!=mu||Yo&&Qt(Yo.resolve())!=Eu||Jn&&Qt(new Jn)!=_u||Oo&&Qt(new Oo)!=yu)&&(Qt=function(e){var t=an(e),n=t==hy?e.constructor:void 0,r=n?Nn(n):"";if(r)switch(r){case fy:return Tu;case dy:return mu;case py:return Eu;case gy:return _u;case my:return yu}return t});var Ey=Object.prototype,_y=Ey.hasOwnProperty;function yy(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&_y.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Ws=ye.Uint8Array;function Ty(e){var t=new e.constructor(e.byteLength);return new Ws(t).set(new Ws(e)),t}function Sy(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var Ay=/\w*$/;function wy(e){var t=new e.constructor(e.source,Ay.exec(e));return t.lastIndex=e.lastIndex,t}var Su=qt?qt.prototype:void 0,Au=Su?Su.valueOf:void 0;function Ry(e){return Au?Object(Au.call(e)):{}}function vy(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var Ny="[object Boolean]",by="[object Date]",Ly="[object Map]",Cy="[object Number]",Iy="[object RegExp]",Oy="[object Set]",ky="[object String]",My="[object Symbol]",xy="[object ArrayBuffer]",Uy="[object DataView]",Py="[object Float32Array]",Dy="[object Float64Array]",Fy="[object Int8Array]",$y="[object Int16Array]",By="[object Int32Array]",Gy="[object Uint8Array]",jy="[object Uint8ClampedArray]",Ky="[object Uint16Array]",Wy="[object Uint32Array]";function Hy(e,t,n){var r=e.constructor;switch(t){case xy:return Ty(e);case Ny:case by:return new r(+e);case Uy:return Sy(e);case Py:case Dy:case Fy:case $y:case By:case Gy:case jy:case Ky:case Wy:return vy(e);case Ly:return new r;case Cy:case ky:return new r(e);case Iy:return wy(e);case Oy:return new r;case My:return Ry(e)}}function Vy(e){return typeof e.constructor=="function"&&!Ir(e)?rE(au(e)):{}}var zy="[object Map]";function Yy(e){return oe(e)&&Qt(e)==zy}var wu=cn&&cn.isMap,qy=wu?Bs(wu):Yy,Xy="[object Set]";function Jy(e){return oe(e)&&Qt(e)==Xy}var Ru=cn&&cn.isSet,Qy=Ru?Bs(Ru):Jy,vu="[object Arguments]",Zy="[object Array]",tT="[object Boolean]",eT="[object Date]",nT="[object Error]",Nu="[object Function]",rT="[object GeneratorFunction]",sT="[object Map]",iT="[object Number]",bu="[object Object]",oT="[object RegExp]",aT="[object Set]",cT="[object String]",lT="[object Symbol]",uT="[object WeakMap]",hT="[object ArrayBuffer]",fT="[object DataView]",dT="[object Float32Array]",pT="[object Float64Array]",gT="[object Int8Array]",mT="[object Int16Array]",ET="[object Int32Array]",_T="[object Uint8Array]",yT="[object Uint8ClampedArray]",TT="[object Uint16Array]",ST="[object Uint32Array]",z={};z[vu]=z[Zy]=z[hT]=z[fT]=z[tT]=z[eT]=z[dT]=z[pT]=z[gT]=z[mT]=z[ET]=z[sT]=z[iT]=z[bu]=z[oT]=z[aT]=z[cT]=z[lT]=z[_T]=z[yT]=z[TT]=z[ST]=!0,z[nT]=z[Nu]=z[uT]=!1;function Hs(e,t,n,r,s,i){var o;if(o!==void 0)return o;if(!Xt(e))return e;var a=j(e);if(a)return o=yy(e),iE(e,o);var c=Qt(e),l=c==Nu||c==rT;if(Or(e))return sy(e);if(c==bu||c==vu||l&&!s)return o=l?{}:Vy(e),ay(e,ny(o,e));if(!z[c])return s?e:{};o=Hy(e,c),i||(i=new Se);var u=i.get(e);if(u)return u;i.set(e,o),Qy(e)?e.forEach(function(f){o.add(Hs(f,t,n,f,e,i))}):qy(e)&&e.forEach(function(f,m){o.set(m,Hs(f,t,n,m,e,i))});var h=Vo,d=a?void 0:h(e);return Wl(d||e,function(f,m){d&&(m=f,f=e[m]),Fs(o,m,Hs(f,t,n,m,e,i))}),o}var AT=4;function wt(e){return Hs(e,AT)}function Pr(e){for(var t=-1,n=e==null?0:e.length,r=0,s=[];++t<n;){var i=e[t];i&&(s[r++]=i)}return s}var wT="__lodash_hash_undefined__";function RT(e){return this.__data__.set(e,wT),this}function vT(e){return this.__data__.has(e)}function Qn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new He;++t<n;)this.add(e[t])}Qn.prototype.add=Qn.prototype.push=RT,Qn.prototype.has=vT;function Lu(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function qo(e,t){return e.has(t)}var NT=1,bT=2;function Cu(e,t,n,r,s,i){var o=n&NT,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=i.get(e),u=i.get(t);if(l&&u)return l==t&&u==e;var h=-1,d=!0,f=n&bT?new Qn:void 0;for(i.set(e,t),i.set(t,e);++h<a;){var m=e[h],_=t[h];if(r)var w=o?r(_,m,h,t,e,i):r(m,_,h,e,t,i);if(w!==void 0){if(w)continue;d=!1;break}if(f){if(!Lu(t,function(R,A){if(!qo(f,A)&&(m===R||s(m,R,n,r,i)))return f.push(A)})){d=!1;break}}else if(!(m===_||s(m,_,n,r,i))){d=!1;break}}return i.delete(e),i.delete(t),d}function LT(e){var t=-1,n=Array(e.size);return e.forEach(function(r,s){n[++t]=[s,r]}),n}function Xo(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var CT=1,IT=2,OT="[object Boolean]",kT="[object Date]",MT="[object Error]",xT="[object Map]",UT="[object Number]",PT="[object RegExp]",DT="[object Set]",FT="[object String]",$T="[object Symbol]",BT="[object ArrayBuffer]",GT="[object DataView]",Iu=qt?qt.prototype:void 0,Jo=Iu?Iu.valueOf:void 0;function jT(e,t,n,r,s,i,o){switch(n){case GT:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case BT:return!(e.byteLength!=t.byteLength||!i(new Ws(e),new Ws(t)));case OT:case kT:case UT:return Cr(+e,+t);case MT:return e.name==t.name&&e.message==t.message;case PT:case FT:return e==t+"";case xT:var a=LT;case DT:var c=r&CT;if(a||(a=Xo),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=IT,o.set(e,t);var u=Cu(a(e),a(t),r,s,i,o);return o.delete(e),u;case $T:if(Jo)return Jo.call(e)==Jo.call(t)}return!1}var KT=1,WT=Object.prototype,HT=WT.hasOwnProperty;function VT(e,t,n,r,s,i){var o=n&KT,a=Vo(e),c=a.length,l=Vo(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var d=a[h];if(!(o?d in t:HT.call(t,d)))return!1}var f=i.get(e),m=i.get(t);if(f&&m)return f==t&&m==e;var _=!0;i.set(e,t),i.set(t,e);for(var w=o;++h<c;){d=a[h];var R=e[d],A=t[d];if(r)var T=o?r(A,R,d,t,e,i):r(R,A,d,e,t,i);if(!(T===void 0?R===A||s(R,A,n,r,i):T)){_=!1;break}w||(w=d=="constructor")}if(_&&!w){var b=e.constructor,y=t.constructor;b!=y&&"constructor"in e&&"constructor"in t&&!(typeof b=="function"&&b instanceof b&&typeof y=="function"&&y instanceof y)&&(_=!1)}return i.delete(e),i.delete(t),_}var zT=1,Ou="[object Arguments]",ku="[object Array]",Vs="[object Object]",YT=Object.prototype,Mu=YT.hasOwnProperty;function qT(e,t,n,r,s,i){var o=j(e),a=j(t),c=o?ku:Qt(e),l=a?ku:Qt(t);c=c==Ou?Vs:c,l=l==Ou?Vs:l;var u=c==Vs,h=l==Vs,d=c==l;if(d&&Or(e)){if(!Or(t))return!1;o=!0,u=!1}if(d&&!u)return i||(i=new Se),o||Fo(e)?Cu(e,t,n,r,s,i):jT(e,t,c,n,r,s,i);if(!(n&zT)){var f=u&&Mu.call(e,"__wrapped__"),m=h&&Mu.call(t,"__wrapped__");if(f||m){var _=f?e.value():e,w=m?t.value():t;return i||(i=new Se),s(_,w,n,r,i)}}return d?(i||(i=new Se),VT(e,t,n,r,s,i)):!1}function Qo(e,t,n,r,s){return e===t?!0:e==null||t==null||!oe(e)&&!oe(t)?e!==e&&t!==t:qT(e,t,n,r,Qo,s)}var XT=1,JT=2;function QT(e,t,n,r){var s=n.length,i=s;if(e==null)return!i;for(e=Object(e);s--;){var o=n[s];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++s<i;){o=n[s];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new Se,h;if(!(h===void 0?Qo(l,c,XT|JT,r,u):h))return!1}}return!0}function xu(e){return e===e&&!Xt(e)}function ZT(e){for(var t=Jt(e),n=t.length;n--;){var r=t[n],s=e[r];t[n]=[r,s,xu(s)]}return t}function Uu(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function tS(e){var t=ZT(e);return t.length==1&&t[0][2]?Uu(t[0][0],t[0][1]):function(n){return n===e||QT(n,e,t)}}function eS(e,t){return e!=null&&t in Object(e)}function Pu(e,t,n){t=Ks(t,e);for(var r=-1,s=t.length,i=!1;++r<s;){var o=Ur(t[r]);if(!(i=e!=null&&n(e,o)))break;e=e[o]}return i||++r!=s?i:(s=e==null?0:e.length,!!s&&Po(s)&&Ds(o,s)&&(j(e)||$s(e)))}function nS(e,t){return e!=null&&Pu(e,t,eS)}var rS=1,sS=2;function iS(e,t){return $o(e)&&xu(t)?Uu(Ur(e),t):function(n){var r=z_(n,e);return r===void 0&&r===t?nS(n,e):Qo(t,r,rS|sS)}}function oS(e){return function(t){return t==null?void 0:t[e]}}function aS(e){return function(t){return Go(t,e)}}function cS(e){return $o(e)?oS(Ur(e)):aS(e)}function Ae(e){return typeof e=="function"?e:e==null?Xn:typeof e=="object"?j(e)?iS(e[0],e[1]):tS(e):cS(e)}function lS(e,t,n,r){for(var s=-1,i=e==null?0:e.length;++s<i;){var o=e[s];t(r,o,n(o),e)}return r}function uS(e){return function(t,n,r){for(var s=-1,i=Object(t),o=r(t),a=o.length;a--;){var c=o[++s];if(n(i[c],c,i)===!1)break}return t}}var hS=uS();function fS(e,t){return e&&hS(e,t,Jt)}function dS(e,t){return function(n,r){if(n==null)return n;if(!Te(n))return e(n,r);for(var s=n.length,i=-1,o=Object(n);++i<s&&r(o[i],i,o)!==!1;);return n}}var Cn=dS(fS);function pS(e,t,n,r){return Cn(e,function(s,i,o){t(r,s,n(s),o)}),r}function gS(e,t){return function(n,r){var s=j(n)?lS:pS,i=t?t():{};return s(n,e,Ae(r),i)}}var Du=Object.prototype,mS=Du.hasOwnProperty,Zo=Uo(function(e,t){e=Object(e);var n=-1,r=t.length,s=r>2?t[2]:void 0;for(s&&Yl(t[0],t[1],s)&&(r=1);++n<r;)for(var i=t[n],o=iu(i),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||Cr(u,Du[l])&&!mS.call(e,l))&&(e[l]=i[l])}return e});function Fu(e){return oe(e)&&Te(e)}var ES=200;function _S(e,t,n,r){var s=-1,i=Vl,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=ES&&(i=qo,o=!1,t=new Qn(t));t:for(;++s<a;){var u=e[s],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=l;d--;)if(t[d]===h)continue t;c.push(u)}else i(t,h,r)||c.push(u)}return c}var zs=Uo(function(e,t){return Fu(e)?_S(e,Ko(t,1,Fu,!0)):[]});function Zn(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function Rt(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Us(t),cu(e,t<0?0:t,r)):[]}function Dr(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Us(t),t=r-t,cu(e,0,t<0?0:t)):[]}function yS(e){return typeof e=="function"?e:Xn}function M(e,t){var n=j(e)?Wl:Cn;return n(e,yS(t))}function TS(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function SS(e,t){var n=!0;return Cn(e,function(r,s,i){return n=!!t(r,s,i),n}),n}function ce(e,t,n){var r=j(e)?TS:SS;return r(e,Ae(t))}function $u(e,t){var n=[];return Cn(e,function(r,s,i){t(r,s,i)&&n.push(r)}),n}function Zt(e,t){var n=j(e)?Wo:$u;return n(e,Ae(t))}function AS(e){return function(t,n,r){var s=Object(t);if(!Te(t)){var i=Ae(n);t=Jt(t),n=function(a){return i(s[a],a,s)}}var o=e(t,n,r);return o>-1?s[i?t[o]:o]:void 0}}var wS=Math.max;function RS(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var s=n==null?0:Us(n);return s<0&&(s=wS(r+s,0)),Hl(e,Ae(t),s)}var tr=AS(RS);function le(e){return e&&e.length?e[0]:void 0}function vS(e,t){var n=-1,r=Te(e)?Array(e.length):[];return Cn(e,function(s,i,o){r[++n]=t(s,i,o)}),r}function C(e,t){var n=j(e)?xs:vS;return n(e,Ae(t))}function te(e,t){return Ko(C(e,t))}var NS=Object.prototype,bS=NS.hasOwnProperty,LS=gS(function(e,t,n){bS.call(e,n)?e[n].push(t):Mo(e,n,[t])}),CS=Object.prototype,IS=CS.hasOwnProperty;function OS(e,t){return e!=null&&IS.call(e,t)}function k(e,t){return e!=null&&Pu(e,t,OS)}var kS="[object String]";function Pt(e){return typeof e=="string"||!j(e)&&oe(e)&&an(e)==kS}function MS(e,t){return xs(t,function(n){return e[n]})}function gt(e){return e==null?[]:MS(e,Jt(e))}var xS=Math.max;function kt(e,t,n,r){e=Te(e)?e:gt(e),n=n&&!r?Us(n):0;var s=e.length;return n<0&&(n=xS(s+n,0)),Pt(e)?n<=s&&e.indexOf(t,n)>-1:!!s&&ko(e,t,n)>-1}function Bu(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var s=0;return ko(e,t,s)}var US="[object Map]",PS="[object Set]",DS=Object.prototype,FS=DS.hasOwnProperty;function Y(e){if(e==null)return!0;if(Te(e)&&(j(e)||typeof e=="string"||typeof e.splice=="function"||Or(e)||Fo(e)||$s(e)))return!e.length;var t=Qt(e);if(t==US||t==PS)return!e.size;if(Ir(e))return!su(e).length;for(var n in e)if(FS.call(e,n))return!1;return!0}var $S="[object RegExp]";function BS(e){return oe(e)&&an(e)==$S}var Gu=cn&&cn.isRegExp,Ve=Gu?Bs(Gu):BS;function ze(e){return e===void 0}var GS="Expected a function";function jS(e){if(typeof e!="function")throw new TypeError(GS);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function KS(e,t,n,r){if(!Xt(e))return e;t=Ks(t,e);for(var s=-1,i=t.length,o=i-1,a=e;a!=null&&++s<i;){var c=Ur(t[s]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(s!=o){var u=a[c];l=void 0,l===void 0&&(l=Xt(u)?u:Ds(t[s+1])?[]:{})}Fs(a,c,l),a=a[c]}return e}function WS(e,t,n){for(var r=-1,s=t.length,i={};++r<s;){var o=t[r],a=Go(e,o);n(a,o)&&KS(i,Ks(o,e),a)}return i}function ue(e,t){if(e==null)return{};var n=xs(uy(e),function(r){return[r]});return t=Ae(t),WS(e,n,function(r,s){return t(r,s[0])})}function HS(e,t,n,r,s){return s(e,function(i,o,a){n=r?(r=!1,i):t(n,i,o,a)}),n}function Gt(e,t,n){var r=j(e)?q_:HS,s=arguments.length<3;return r(e,Ae(t),n,s,Cn)}function Ys(e,t){var n=j(e)?Wo:$u;return n(e,jS(Ae(t)))}function VS(e,t){var n;return Cn(e,function(r,s,i){return n=t(r,s,i),!n}),!!n}function ju(e,t,n){var r=j(e)?Lu:VS;return r(e,Ae(t))}var zS=1/0,YS=Jn&&1/Xo(new Jn([,-0]))[1]==zS?function(e){return new Jn(e)}:pt,qS=200;function XS(e,t,n){var r=-1,s=Vl,i=e.length,o=!0,a=[],c=a;if(i>=qS){var l=YS(e);if(l)return Xo(l);o=!1,s=qo,c=new Qn}else c=a;t:for(;++r<i;){var u=e[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var d=c.length;d--;)if(c[d]===h)continue t;a.push(u)}else s(c,h,n)||(c!==a&&c.push(h),a.push(u))}return a}function ta(e){return e&&e.length?XS(e):[]}function ea(e){console&&console.error&&console.error(`Error: ${e}`)}function Ku(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function Wu(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function Hu(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function JS(e){return QS(e)?e.LABEL:e.name}function QS(e){return Pt(e.LABEL)&&e.LABEL!==""}class we{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),M(this.definition,n=>{n.accept(t)})}}class jt extends we{constructor(t){super([]),this.idx=1,Bt(this,ue(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class er extends we{constructor(t){super(t.definition),this.orgText="",Bt(this,ue(t,n=>n!==void 0))}}class Dt extends we{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,Bt(this,ue(t,n=>n!==void 0))}}class Ft extends we{constructor(t){super(t.definition),this.idx=1,Bt(this,ue(t,n=>n!==void 0))}}class Re extends we{constructor(t){super(t.definition),this.idx=1,Bt(this,ue(t,n=>n!==void 0))}}class ve extends we{constructor(t){super(t.definition),this.idx=1,Bt(this,ue(t,n=>n!==void 0))}}class mt extends we{constructor(t){super(t.definition),this.idx=1,Bt(this,ue(t,n=>n!==void 0))}}class he extends we{constructor(t){super(t.definition),this.idx=1,Bt(this,ue(t,n=>n!==void 0))}}class fe extends we{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Bt(this,ue(t,n=>n!==void 0))}}class Q{constructor(t){this.idx=1,Bt(this,ue(t,n=>n!==void 0))}accept(t){t.visit(this)}}function ZS(e){return C(e,qs)}function qs(e){function t(n){return C(n,qs)}if(e instanceof jt){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Pt(e.label)&&(n.label=e.label),n}else{if(e instanceof Dt)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Ft)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof Re)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof ve)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:qs(new Q({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof he)return{type:"RepetitionWithSeparator",idx:e.idx,separator:qs(new Q({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof mt)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof fe)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Q){const n={type:"Terminal",name:e.terminalType.name,label:JS(e.terminalType),idx:e.idx};Pt(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ve(r)?r.source:r),n}else{if(e instanceof er)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class nr{visit(t){const n=t;switch(n.constructor){case jt:return this.visitNonTerminal(n);case Dt:return this.visitAlternative(n);case Ft:return this.visitOption(n);case Re:return this.visitRepetitionMandatory(n);case ve:return this.visitRepetitionMandatoryWithSeparator(n);case he:return this.visitRepetitionWithSeparator(n);case mt:return this.visitRepetition(n);case fe:return this.visitAlternation(n);case Q:return this.visitTerminal(n);case er:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function tA(e){return e instanceof Dt||e instanceof Ft||e instanceof mt||e instanceof Re||e instanceof ve||e instanceof he||e instanceof Q||e instanceof er}function Xs(e,t=[]){return e instanceof Ft||e instanceof mt||e instanceof he?!0:e instanceof fe?ju(e.definition,r=>Xs(r,t)):e instanceof jt&&kt(t,e)?!1:e instanceof we?(e instanceof jt&&t.push(e),ce(e.definition,r=>Xs(r,t))):!1}function eA(e){return e instanceof fe}function Ne(e){if(e instanceof jt)return"SUBRULE";if(e instanceof Ft)return"OPTION";if(e instanceof fe)return"OR";if(e instanceof Re)return"AT_LEAST_ONE";if(e instanceof ve)return"AT_LEAST_ONE_SEP";if(e instanceof he)return"MANY_SEP";if(e instanceof mt)return"MANY";if(e instanceof Q)return"CONSUME";throw Error("non exhaustive match")}class Js{walk(t,n=[]){M(t.definition,(r,s)=>{const i=Rt(t.definition,s+1);if(r instanceof jt)this.walkProdRef(r,i,n);else if(r instanceof Q)this.walkTerminal(r,i,n);else if(r instanceof Dt)this.walkFlat(r,i,n);else if(r instanceof Ft)this.walkOption(r,i,n);else if(r instanceof Re)this.walkAtLeastOne(r,i,n);else if(r instanceof ve)this.walkAtLeastOneSep(r,i,n);else if(r instanceof he)this.walkManySep(r,i,n);else if(r instanceof mt)this.walkMany(r,i,n);else if(r instanceof fe)this.walkOr(r,i,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const s=n.concat(r);this.walk(t,s)}walkOption(t,n,r){const s=n.concat(r);this.walk(t,s)}walkAtLeastOne(t,n,r){const s=[new Ft({definition:t.definition})].concat(n,r);this.walk(t,s)}walkAtLeastOneSep(t,n,r){const s=Vu(t,n,r);this.walk(t,s)}walkMany(t,n,r){const s=[new Ft({definition:t.definition})].concat(n,r);this.walk(t,s)}walkManySep(t,n,r){const s=Vu(t,n,r);this.walk(t,s)}walkOr(t,n,r){const s=n.concat(r);M(t.definition,i=>{const o=new Dt({definition:[i]});this.walk(o,s)})}}function Vu(e,t,n){return[new Ft({definition:[new Q({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function Fr(e){if(e instanceof jt)return Fr(e.referencedRule);if(e instanceof Q)return sA(e);if(tA(e))return nA(e);if(eA(e))return rA(e);throw Error("non exhaustive match")}function nA(e){let t=[];const n=e.definition;let r=0,s=n.length>r,i,o=!0;for(;s&&o;)i=n[r],o=Xs(i),t=t.concat(Fr(i)),r=r+1,s=n.length>r;return ta(t)}function rA(e){const t=C(e.definition,n=>Fr(n));return ta(ae(t))}function sA(e){return[e.terminalType]}const zu="_~IN~_";class iA extends Js{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const s=aA(t.referencedRule,t.idx)+this.topProd.name,i=n.concat(r),o=new Dt({definition:i}),a=Fr(o);this.follows[s]=a}}function oA(e){const t={};return M(e,n=>{const r=new iA(n).startWalking();Bt(t,r)}),t}function aA(e,t){return e.name+t+zu}function x(e){return e.charCodeAt(0)}function na(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function $r(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function rr(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function cA(){throw Error("Internal Error - Should never get here!")}function Yu(e){return e.type==="Character"}const Qs=[];for(let e=x("0");e<=x("9");e++)Qs.push(e);const Zs=[x("_")].concat(Qs);for(let e=x("a");e<=x("z");e++)Zs.push(e);for(let e=x("A");e<=x("Z");e++)Zs.push(e);const qu=[x(" "),x("\f"),x(`
`),x("\r"),x("	"),x("\v"),x("	"),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x(" "),x("\u2028"),x("\u2029"),x(" "),x(" "),x("　"),x("\uFEFF")],lA=/[0-9a-fA-F]/,ti=/[0-9]/,uA=/[1-9]/;class hA{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":$r(r,"global");break;case"i":$r(r,"ignoreCase");break;case"m":$r(r,"multiLine");break;case"u":$r(r,"unicode");break;case"y":$r(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}rr(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return cA()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const s=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:s,atMost:s};break;case",":let i;this.isDigit()?(i=this.integerIncludingZero(),n={atLeast:s,atMost:i}):n={atLeast:s,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;rr(n);break}if(!(t===!0&&n===void 0)&&rr(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),rr(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[x(`
`),x("\r"),x("\u2028"),x("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=Qs;break;case"D":t=Qs,n=!0;break;case"s":t=qu;break;case"S":t=qu,n=!0;break;case"w":t=Zs;break;case"W":t=Zs,n=!0;break}if(rr(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=x("\f");break;case"n":t=x(`
`);break;case"r":t=x("\r");break;case"t":t=x("	");break;case"v":t=x("\v");break}if(rr(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:x("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:x(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:x(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,Yu(r)&&this.isRangeDash()){this.consumeChar("-");const s=this.classAtom();if(s.type,Yu(s)){if(s.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:s.value})}else na(r.value,t),t.push(x("-")),na(s.value,t)}else na(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:x("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(uA.test(t)===!1)throw Error("Expecting a positive integer");for(;ti.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(ti.test(t)===!1)throw Error("Expecting an integer");for(;ti.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:x(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return ti.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let s=0;s<t;s++){const i=this.popChar();if(lA.test(i)===!1)throw Error("Expecting a HexDecimal digits");n+=i}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class ra{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(s=>{this.visit(s)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let ei={};const fA=new hA;function ni(e){const t=e.toString();if(ei.hasOwnProperty(t))return ei[t];{const n=fA.pattern(t);return ei[t]=n,n}}function dA(){ei={}}const Xu="Complement Sets are not supported for first char optimization",ri=`Unable to use "first char" lexer optimizations:
`;function pA(e,t=!1){try{const n=ni(e);return sa(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Xu)t&&Ku(`${ri}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),ea(`${ri}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function sa(e,t,n){switch(e.type){case"Disjunction":for(let s=0;s<e.value.length;s++)sa(e.value[s],t,n);break;case"Alternative":const r=e.value;for(let s=0;s<r.length;s++){const i=r[s];switch(i.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=i;switch(o.type){case"Character":si(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(Xu);M(o.value,c=>{if(typeof c=="number")si(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)si(u,t,n);else{for(let u=l.from;u<=l.to&&u<Gr;u++)si(u,t,n);if(l.to>=Gr){const u=l.from>=Gr?l.from:Gr,h=l.to,d=ln(u),f=ln(h);for(let m=d;m<=f;m++)t[m]=m}}}});break;case"Group":sa(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&ia(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return gt(t)}function si(e,t,n){const r=ln(e);t[r]=r,n===!0&&gA(e,t)}function gA(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const s=ln(r.charCodeAt(0));t[s]=s}else{const s=n.toLowerCase();if(s!==n){const i=ln(s.charCodeAt(0));t[i]=i}}}function Ju(e,t){return tr(e.value,n=>{if(typeof n=="number")return kt(t,n);{const r=n;return tr(t,s=>r.from<=s&&s<=r.to)!==void 0}})}function ia(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?j(e.value)?ce(e.value,ia):ia(e.value):!1}class mA extends ra{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){kt(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Ju(t,this.targetCharCodes)===void 0&&(this.found=!0):Ju(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function oa(e,t){if(t instanceof RegExp){const n=ni(t),r=new mA(e);return r.visit(n),r.found}else return tr(t,n=>kt(e,n.charCodeAt(0)))!==void 0}const In="PATTERN",Br="defaultMode",ii="modes";let Qu=typeof new RegExp("(?:)").sticky=="boolean";function EA(e,t){t=Zo(t,{useSticky:Qu,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(A,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{BA()});let r;n("Reject Lexer.NA",()=>{r=Ys(e,A=>A[In]===yt.NA)});let s=!1,i;n("Transform Patterns",()=>{s=!1,i=C(r,A=>{const T=A[In];if(Ve(T)){const b=T.source;return b.length===1&&b!=="^"&&b!=="$"&&b!=="."&&!T.ignoreCase?b:b.length===2&&b[0]==="\\"&&!kt(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],b[1])?b[1]:t.useSticky?th(T):Zu(T)}else{if(Ke(T))return s=!0,{exec:T};if(typeof T=="object")return s=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const b=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),y=new RegExp(b);return t.useSticky?th(y):Zu(y)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=C(r,A=>A.tokenTypeIdx),a=C(r,A=>{const T=A.GROUP;if(T!==yt.SKIPPED){if(Pt(T))return T;if(ze(T))return!1;throw Error("non exhaustive match")}}),c=C(r,A=>{const T=A.LONGER_ALT;if(T)return j(T)?C(T,y=>Bu(r,y)):[Bu(r,T)]}),l=C(r,A=>A.PUSH_MODE),u=C(r,A=>k(A,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const A=rh(t.lineTerminatorCharacters);h=C(r,T=>!1),t.positionTracking!=="onlyOffset"&&(h=C(r,T=>k(T,"LINE_BREAKS")?!!T.LINE_BREAKS:nh(T,A)===!1&&oa(A,T.PATTERN)))});let d,f,m,_;n("Misc Mapping #2",()=>{d=C(r,eh),f=C(i,DA),m=Gt(r,(A,T)=>{const b=T.GROUP;return Pt(b)&&b!==yt.SKIPPED&&(A[b]=[]),A},{}),_=C(i,(A,T)=>({pattern:i[T],longerAlt:c[T],canLineTerminator:h[T],isCustom:d[T],short:f[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let w=!0,R=[];return t.safeMode||n("First Char Optimization",()=>{R=Gt(r,(A,T,b)=>{if(typeof T.PATTERN=="string"){const y=T.PATTERN.charCodeAt(0),g=ln(y);aa(A,g,_[b])}else if(j(T.START_CHARS_HINT)){let y;M(T.START_CHARS_HINT,g=>{const p=typeof g=="string"?g.charCodeAt(0):g,S=ln(p);y!==S&&(y=S,aa(A,S,_[b]))})}else if(Ve(T.PATTERN))if(T.PATTERN.unicode)w=!1,t.ensureOptimizations&&ea(`${ri}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const y=pA(T.PATTERN,t.ensureOptimizations);Y(y)&&(w=!1),M(y,g=>{aa(A,g,_[b])})}else t.ensureOptimizations&&ea(`${ri}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),w=!1;return A},[])}),{emptyGroups:m,patternIdxToConfig:_,charCodeToPatternIdxToConfig:R,hasCustom:s,canBeOptimized:w}}function _A(e,t){let n=[];const r=TA(e);n=n.concat(r.errors);const s=SA(r.valid),i=s.valid;return n=n.concat(s.errors),n=n.concat(yA(i)),n=n.concat(CA(i)),n=n.concat(IA(i,t)),n=n.concat(OA(i)),n}function yA(e){let t=[];const n=Zt(e,r=>Ve(r[In]));return t=t.concat(wA(n)),t=t.concat(NA(n)),t=t.concat(bA(n)),t=t.concat(LA(n)),t=t.concat(RA(n)),t}function TA(e){const t=Zt(e,s=>!k(s,In)),n=C(t,s=>({message:"Token Type: ->"+s.name+"<- missing static 'PATTERN' property",type:it.MISSING_PATTERN,tokenTypes:[s]})),r=zs(e,t);return{errors:n,valid:r}}function SA(e){const t=Zt(e,s=>{const i=s[In];return!Ve(i)&&!Ke(i)&&!k(i,"exec")&&!Pt(i)}),n=C(t,s=>({message:"Token Type: ->"+s.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:it.INVALID_PATTERN,tokenTypes:[s]})),r=zs(e,t);return{errors:n,valid:r}}const AA=/[^\\][$]/;function wA(e){class t extends ra{constructor(){super(...arguments),this.found=!1}visitEndAnchor(i){this.found=!0}}const n=Zt(e,s=>{const i=s.PATTERN;try{const o=ni(i),a=new t;return a.visit(o),a.found}catch{return AA.test(i.source)}});return C(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:it.EOI_ANCHOR_FOUND,tokenTypes:[s]}))}function RA(e){const t=Zt(e,r=>r.PATTERN.test(""));return C(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:it.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const vA=/[^\\[][\^]|^\^/;function NA(e){class t extends ra{constructor(){super(...arguments),this.found=!1}visitStartAnchor(i){this.found=!0}}const n=Zt(e,s=>{const i=s.PATTERN;try{const o=ni(i),a=new t;return a.visit(o),a.found}catch{return vA.test(i.source)}});return C(n,s=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+s.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:it.SOI_ANCHOR_FOUND,tokenTypes:[s]}))}function bA(e){const t=Zt(e,r=>{const s=r[In];return s instanceof RegExp&&(s.multiline||s.global)});return C(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:it.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function LA(e){const t=[];let n=C(e,i=>Gt(e,(o,a)=>(i.PATTERN.source===a.PATTERN.source&&!kt(t,a)&&a.PATTERN!==yt.NA&&(t.push(a),o.push(a)),o),[]));n=Pr(n);const r=Zt(n,i=>i.length>1);return C(r,i=>{const o=C(i,c=>c.name);return{message:`The same RegExp pattern ->${le(i).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:it.DUPLICATE_PATTERNS_FOUND,tokenTypes:i}})}function CA(e){const t=Zt(e,r=>{if(!k(r,"GROUP"))return!1;const s=r.GROUP;return s!==yt.SKIPPED&&s!==yt.NA&&!Pt(s)});return C(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:it.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function IA(e,t){const n=Zt(e,s=>s.PUSH_MODE!==void 0&&!kt(t,s.PUSH_MODE));return C(n,s=>({message:`Token Type: ->${s.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${s.PUSH_MODE}<-which does not exist`,type:it.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[s]}))}function OA(e){const t=[],n=Gt(e,(r,s,i)=>{const o=s.PATTERN;return o===yt.NA||(Pt(o)?r.push({str:o,idx:i,tokenType:s}):Ve(o)&&MA(o)&&r.push({str:o.source,idx:i,tokenType:s})),r},[]);return M(e,(r,s)=>{M(n,({str:i,idx:o,tokenType:a})=>{if(s<o&&kA(i,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:it.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function kA(e,t){if(Ve(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(Ke(t))return t(e,0,[],{});if(k(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function MA(e){return tr([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function Zu(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function th(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function xA(e,t,n){const r=[];return k(e,Br)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Br+`> property in its definition
`,type:it.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),k(e,ii)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+ii+`> property in its definition
`,type:it.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),k(e,ii)&&k(e,Br)&&!k(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Br}: <${e.defaultMode}>which does not exist
`,type:it.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),k(e,ii)&&M(e.modes,(s,i)=>{M(s,(o,a)=>{if(ze(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${i}> at index: <${a}>
`,type:it.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(k(o,"LONGER_ALT")){const c=j(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];M(c,l=>{!ze(l)&&!kt(s,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${i}>
`,type:it.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function UA(e,t,n){const r=[];let s=!1;const i=Pr(ae(gt(e.modes))),o=Ys(i,c=>c[In]===yt.NA),a=rh(n);return t&&M(o,c=>{const l=nh(c,a);if(l!==!1){const h={message:$A(c,l),type:l.issue,tokenType:c};r.push(h)}else k(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(s=!0):oa(a,c.PATTERN)&&(s=!0)}),t&&!s&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:it.NO_LINE_BREAKS_FLAGS}),r}function PA(e){const t={},n=Jt(e);return M(n,r=>{const s=e[r];if(j(s))t[r]=[];else throw Error("non exhaustive match")}),t}function eh(e){const t=e.PATTERN;if(Ve(t))return!1;if(Ke(t))return!0;if(k(t,"exec"))return!0;if(Pt(t))return!1;throw Error("non exhaustive match")}function DA(e){return Pt(e)&&e.length===1?e.charCodeAt(0):!1}const FA={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function nh(e,t){if(k(e,"LINE_BREAKS"))return!1;if(Ve(e.PATTERN)){try{oa(t,e.PATTERN)}catch(n){return{issue:it.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Pt(e.PATTERN))return!1;if(eh(e))return{issue:it.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function $A(e,t){if(t.issue===it.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===it.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function rh(e){return C(e,n=>Pt(n)?n.charCodeAt(0):n)}function aa(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Gr=256;let oi=[];function ln(e){return e<Gr?e:oi[e]}function BA(){if(Y(oi)){oi=new Array(65536);for(let e=0;e<65536;e++)oi[e]=e>255?255+~~(e/255):e}}function jr(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function ai(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let sh=1;const ih={};function Kr(e){const t=GA(e);jA(t),WA(t),KA(t),M(t,n=>{n.isParent=n.categoryMatches.length>0})}function GA(e){let t=wt(e),n=e,r=!0;for(;r;){n=Pr(ae(C(n,i=>i.CATEGORIES)));const s=zs(n,t);t=t.concat(s),Y(s)?r=!1:n=s}return t}function jA(e){M(e,t=>{ah(t)||(ih[sh]=t,t.tokenTypeIdx=sh++),ch(t)&&!j(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),ch(t)||(t.CATEGORIES=[]),HA(t)||(t.categoryMatches=[]),VA(t)||(t.categoryMatchesMap={})})}function KA(e){M(e,t=>{t.categoryMatches=[],M(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push(ih[r].tokenTypeIdx)})})}function WA(e){M(e,t=>{oh([],t)})}function oh(e,t){M(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),M(t.CATEGORIES,n=>{const r=e.concat(t);kt(r,n)||oh(r,n)})}function ah(e){return k(e,"tokenTypeIdx")}function ch(e){return k(e,"CATEGORIES")}function HA(e){return k(e,"categoryMatches")}function VA(e){return k(e,"categoryMatchesMap")}function zA(e){return k(e,"tokenTypeIdx")}const YA={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,s){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var it;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(it||(it={}));const Wr={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:YA,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Wr);class yt{constructor(t,n=Wr){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(s,i)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${s}>`);const{time:a,value:c}=Wu(i),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${s}> time: ${a}ms`),this.traceInitIndent--,c}else return i()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Bt({},Wr,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let s,i=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Wr.lineTerminatorsPattern)this.config.lineTerminatorsPattern=FA;else if(this.config.lineTerminatorCharacters===Wr.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),j(t)?s={modes:{defaultMode:wt(t)},defaultMode:Br}:(i=!1,s=wt(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(xA(s,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(UA(s,this.trackStartLines,this.config.lineTerminatorCharacters))})),s.modes=s.modes?s.modes:{},M(s.modes,(a,c)=>{s.modes[c]=Ys(a,l=>ze(l))});const o=Jt(s.modes);if(M(s.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(_A(a,o))}),Y(this.lexerDefinitionErrors)){Kr(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=EA(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Bt({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=s.defaultMode,!Y(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=C(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}M(this.lexerDefinitionWarning,a=>{Ku(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Qu?(this.chopInput=Xn,this.match=this.matchWithTest):(this.updateLastIndex=pt,this.match=this.matchWithExec),i&&(this.handleModes=pt),this.trackStartLines===!1&&(this.computeNewColumn=Xn),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=pt),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=Gt(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!Y(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{dA()}),this.TRACE_INIT("toFastProperties",()=>{Hu(this)})})}tokenize(t,n=this.defaultMode){if(!Y(this.lexerDefinitionErrors)){const s=C(this.lexerDefinitionErrors,i=>i.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+s)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,s,i,o,a,c,l,u,h,d,f,m,_,w,R;const A=t,T=A.length;let b=0,y=0;const g=this.hasCustom?0:Math.floor(t.length/10),p=new Array(g),S=[];let v=this.trackStartLines?1:void 0,K=this.trackStartLines?1:void 0;const ut=PA(this.emptyGroups),Rr=this.trackStartLines,At=this.config.lineTerminatorsPattern;let De=0,se=[],As=[];const io=[],Zp=[];Object.freeze(Zp);let ws;function tg(){return se}function eg(Ct){const ie=ln(Ct),vr=As[ie];return vr===void 0?Zp:vr}const oL=Ct=>{if(io.length===1&&Ct.tokenType.PUSH_MODE===void 0){const ie=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ct);S.push({offset:Ct.startOffset,line:Ct.startLine,column:Ct.startColumn,length:Ct.image.length,message:ie})}else{io.pop();const ie=Zn(io);se=this.patternIdxToConfig[ie],As=this.charCodeToPatternIdxToConfig[ie],De=se.length;const vr=this.canModeBeOptimized[ie]&&this.config.safeMode===!1;As&&vr?ws=eg:ws=tg}};function ng(Ct){io.push(Ct),As=this.charCodeToPatternIdxToConfig[Ct],se=this.patternIdxToConfig[Ct],De=se.length,De=se.length;const ie=this.canModeBeOptimized[Ct]&&this.config.safeMode===!1;As&&ie?ws=eg:ws=tg}ng.call(this,n);let Ee;const rg=this.config.recoveryEnabled;for(;b<T;){c=null;const Ct=A.charCodeAt(b),ie=ws(Ct),vr=ie.length;for(r=0;r<vr;r++){Ee=ie[r];const Ht=Ee.pattern;l=null;const nn=Ee.short;if(nn!==!1?Ct===nn&&(c=Ht):Ee.isCustom===!0?(R=Ht.exec(A,b,p,ut),R!==null?(c=R[0],R.payload!==void 0&&(l=R.payload)):c=null):(this.updateLastIndex(Ht,b),c=this.match(Ht,t,b)),c!==null){if(a=Ee.longerAlt,a!==void 0){const Tn=a.length;for(i=0;i<Tn;i++){const rn=se[a[i]],Hn=rn.pattern;if(u=null,rn.isCustom===!0?(R=Hn.exec(A,b,p,ut),R!==null?(o=R[0],R.payload!==void 0&&(u=R.payload)):o=null):(this.updateLastIndex(Hn,b),o=this.match(Hn,t,b)),o&&o.length>c.length){c=o,l=u,Ee=rn;break}}}break}}if(c!==null){if(h=c.length,d=Ee.group,d!==void 0&&(f=Ee.tokenTypeIdx,m=this.createTokenInstance(c,b,f,Ee.tokenType,v,K,h),this.handlePayload(m,l),d===!1?y=this.addToken(p,y,m):ut[d].push(m)),t=this.chopInput(t,h),b=b+h,K=this.computeNewColumn(K,h),Rr===!0&&Ee.canLineTerminator===!0){let Ht=0,nn,Tn;At.lastIndex=0;do nn=At.test(c),nn===!0&&(Tn=At.lastIndex-1,Ht++);while(nn===!0);Ht!==0&&(v=v+Ht,K=h-Tn,this.updateTokenEndLineColumnLocation(m,d,Tn,Ht,v,K,h))}this.handleModes(Ee,oL,ng,m)}else{const Ht=b,nn=v,Tn=K;let rn=rg===!1;for(;rn===!1&&b<T;)for(t=this.chopInput(t,1),b++,s=0;s<De;s++){const Hn=se[s],Yc=Hn.pattern,sg=Hn.short;if(sg!==!1?A.charCodeAt(b)===sg&&(rn=!0):Hn.isCustom===!0?rn=Yc.exec(A,b,p,ut)!==null:(this.updateLastIndex(Yc,b),rn=Yc.exec(t)!==null),rn===!0)break}if(_=b-Ht,K=this.computeNewColumn(K,_),w=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(A,Ht,_,nn,Tn),S.push({offset:Ht,line:nn,column:Tn,length:_,message:w}),rg===!1)break}}return this.hasCustom||(p.length=y),{tokens:p,groups:ut,errors:S}}handleModes(t,n,r,s){if(t.pop===!0){const i=t.push;n(s),i!==void 0&&r.call(this,i)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,s,i,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,s===1&&c===!0||(t.endLine=i+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,s){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:s}}createStartOnlyToken(t,n,r,s,i,o){return{image:t,startOffset:n,startLine:i,startColumn:o,tokenTypeIdx:r,tokenType:s}}createFullToken(t,n,r,s,i,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:s}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}}yt.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",yt.NA=/NOT_APPLICABLE/;function Hr(e){return lh(e)?e.LABEL:e.name}function lh(e){return Pt(e.LABEL)&&e.LABEL!==""}const qA="parent",uh="categories",hh="label",fh="group",dh="push_mode",ph="pop_mode",gh="longer_alt",mh="line_breaks",Eh="start_chars_hint";function U(e){return XA(e)}function XA(e){const t=e.pattern,n={};if(n.name=e.name,ze(t)||(n.PATTERN=t),k(e,qA))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return k(e,uh)&&(n.CATEGORIES=e[uh]),Kr([n]),k(e,hh)&&(n.LABEL=e[hh]),k(e,fh)&&(n.GROUP=e[fh]),k(e,ph)&&(n.POP_MODE=e[ph]),k(e,dh)&&(n.PUSH_MODE=e[dh]),k(e,gh)&&(n.LONGER_ALT=e[gh]),k(e,mh)&&(n.LINE_BREAKS=e[mh]),k(e,Eh)&&(n.START_CHARS_HINT=e[Eh]),n}const On=U({name:"EOF",pattern:yt.NA});Kr([On]);function ci(e,t,n,r,s,i,o,a){return{image:t,startOffset:n,endOffset:r,startLine:s,endLine:i,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function JA(e,t){return jr(e,t)}const _h={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${lh(e)?`--> ${Hr(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:s}){const i="Expecting: ",a=`
but found: '`+le(t).image+"'";if(r)return i+r+a;{const c=Gt(e,(d,f)=>d.concat(f),[]),l=C(c,d=>`[${C(d,f=>Hr(f)).join(", ")}]`),h=`one of these possible Token sequences:
${C(l,(d,f)=>`  ${f+1}. ${d}`).join(`
`)}`;return i+h+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const s="Expecting: ",o=`
but found: '`+le(t).image+"'";if(n)return s+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${C(e,l=>`[${C(l,u=>Hr(u)).join(",")}]`).join(" ,")}>`;return s+c+o}}};Object.freeze(_h);const QA={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},kn={buildDuplicateFoundError(e,t){function n(u){return u instanceof Q?u.terminalType.name:u instanceof jt?u.nonTerminalName:""}const r=e.name,s=le(t),i=s.idx,o=Ne(s),a=n(s),c=i>0;let l=`->${o}${c?i:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=C(e.prefixPath,s=>Hr(s)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=C(e.prefixPath,s=>Hr(s)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Ne(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=C(e.leftRecursionPath,i=>i.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof er?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function ZA(e,t){const n=new tw(e,t);return n.resolveRefs(),n.errors}class tw extends nr{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){M(gt(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:Mt.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class ew extends Js{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=wt(this.path.ruleStack).reverse(),this.occurrenceStack=wt(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const s=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,s)}}updateExpectedNext(){Y(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class nw extends ew{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const s=n.concat(r),i=new Dt({definition:s});this.possibleTokTypes=Fr(i),this.found=!0}}}class li extends Js{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class rw extends li{walkMany(t,n,r){if(t.idx===this.occurrence){const s=le(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Q&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkMany(t,n,r)}}class yh extends li{walkManySep(t,n,r){if(t.idx===this.occurrence){const s=le(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Q&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkManySep(t,n,r)}}class sw extends li{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const s=le(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Q&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOne(t,n,r)}}class Th extends li{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const s=le(n.concat(r));this.result.isEndOfRule=s===void 0,s instanceof Q&&(this.result.token=s.terminalType,this.result.occurrence=s.idx)}else super.walkAtLeastOneSep(t,n,r)}}function ca(e,t,n=[]){n=wt(n);let r=[],s=0;function i(a){return a.concat(Rt(e,s+1))}function o(a){const c=ca(i(a),t,n);return r.concat(c)}for(;n.length<t&&s<e.length;){const a=e[s];if(a instanceof Dt)return o(a.definition);if(a instanceof jt)return o(a.definition);if(a instanceof Ft)r=o(a.definition);else if(a instanceof Re){const c=a.definition.concat([new mt({definition:a.definition})]);return o(c)}else if(a instanceof ve){const c=[new Dt({definition:a.definition}),new mt({definition:[new Q({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof he){const c=a.definition.concat([new mt({definition:[new Q({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof mt){const c=a.definition.concat([new mt({definition:a.definition})]);r=o(c)}else{if(a instanceof fe)return M(a.definition,c=>{Y(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Q)n.push(a.terminalType);else throw Error("non exhaustive match")}s++}return r.push({partialPath:n,suffixDef:Rt(e,s)}),r}function Sh(e,t,n,r){const s="EXIT_NONE_TERMINAL",i=[s],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!Y(h);){const d=h.pop();if(d===o){a&&Zn(h).idx<=l&&h.pop();continue}const f=d.def,m=d.idx,_=d.ruleStack,w=d.occurrenceStack;if(Y(f))continue;const R=f[0];if(R===s){const A={idx:m,def:Rt(f),ruleStack:Dr(_),occurrenceStack:Dr(w)};h.push(A)}else if(R instanceof Q)if(m<c-1){const A=m+1,T=t[A];if(n(T,R.terminalType)){const b={idx:A,def:Rt(f),ruleStack:_,occurrenceStack:w};h.push(b)}}else if(m===c-1)u.push({nextTokenType:R.terminalType,nextTokenOccurrence:R.idx,ruleStack:_,occurrenceStack:w}),a=!0;else throw Error("non exhaustive match");else if(R instanceof jt){const A=wt(_);A.push(R.nonTerminalName);const T=wt(w);T.push(R.idx);const b={idx:m,def:R.definition.concat(i,Rt(f)),ruleStack:A,occurrenceStack:T};h.push(b)}else if(R instanceof Ft){const A={idx:m,def:Rt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T={idx:m,def:R.definition.concat(Rt(f)),ruleStack:_,occurrenceStack:w};h.push(T)}else if(R instanceof Re){const A=new mt({definition:R.definition,idx:R.idx}),T=R.definition.concat([A],Rt(f)),b={idx:m,def:T,ruleStack:_,occurrenceStack:w};h.push(b)}else if(R instanceof ve){const A=new Q({terminalType:R.separator}),T=new mt({definition:[A].concat(R.definition),idx:R.idx}),b=R.definition.concat([T],Rt(f)),y={idx:m,def:b,ruleStack:_,occurrenceStack:w};h.push(y)}else if(R instanceof he){const A={idx:m,def:Rt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T=new Q({terminalType:R.separator}),b=new mt({definition:[T].concat(R.definition),idx:R.idx}),y=R.definition.concat([b],Rt(f)),g={idx:m,def:y,ruleStack:_,occurrenceStack:w};h.push(g)}else if(R instanceof mt){const A={idx:m,def:Rt(f),ruleStack:_,occurrenceStack:w};h.push(A),h.push(o);const T=new mt({definition:R.definition,idx:R.idx}),b=R.definition.concat([T],Rt(f)),y={idx:m,def:b,ruleStack:_,occurrenceStack:w};h.push(y)}else if(R instanceof fe)for(let A=R.definition.length-1;A>=0;A--){const T=R.definition[A],b={idx:m,def:T.definition.concat(Rt(f)),ruleStack:_,occurrenceStack:w};h.push(b),h.push(o)}else if(R instanceof Dt)h.push({idx:m,def:R.definition.concat(Rt(f)),ruleStack:_,occurrenceStack:w});else if(R instanceof er)h.push(iw(R,m,_,w));else throw Error("non exhaustive match")}return u}function iw(e,t,n,r){const s=wt(n);s.push(e.name);const i=wt(r);return i.push(1),{idx:t,def:e.definition,ruleStack:s,occurrenceStack:i}}var ot;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(ot||(ot={}));function Ah(e){if(e instanceof Ft||e==="Option")return ot.OPTION;if(e instanceof mt||e==="Repetition")return ot.REPETITION;if(e instanceof Re||e==="RepetitionMandatory")return ot.REPETITION_MANDATORY;if(e instanceof ve||e==="RepetitionMandatoryWithSeparator")return ot.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof he||e==="RepetitionWithSeparator")return ot.REPETITION_WITH_SEPARATOR;if(e instanceof fe||e==="Alternation")return ot.ALTERNATION;throw Error("non exhaustive match")}function ow(e,t,n,r,s,i){const o=ua(e,t,n),a=Nh(o)?ai:jr;return i(o,r,a,s)}function aw(e,t,n,r,s,i){const o=ha(e,t,s,n),a=Nh(o)?ai:jr;return i(o[0],a,r)}function cw(e,t,n,r){const s=e.length,i=ce(e,o=>ce(o,a=>a.length===1));if(t)return function(o){const a=C(o,c=>c.GATE);for(let c=0;c<s;c++){const l=e[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))t:for(let d=0;d<u;d++){const f=l[d],m=f.length;for(let _=0;_<m;_++){const w=this.LA(_+1);if(n(w,f[_])===!1)continue t}return c}}};if(i&&!r){const o=C(e,c=>ae(c)),a=Gt(o,(c,l,u)=>(M(l,h=>{k(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),M(h.categoryMatches,d=>{k(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<s;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let d=0;d<h;d++){const f=this.LA(d+1);if(n(f,u[d])===!1)continue t}return o}}}}function lw(e,t,n){const r=ce(e,i=>i.length===1),s=e.length;if(r&&!n){const i=ae(e);if(i.length===1&&Y(i[0].categoryMatches)){const a=i[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=Gt(i,(a,c,l)=>(a[c.tokenTypeIdx]=!0,M(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let i=0;i<s;i++){const o=e[i],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class uw extends Js{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,s){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(s),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,ot.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,ot.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,ot.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,ot.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,ot.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class wh extends nr{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,ot.OPTION)}visitRepetition(t){this.checkIsTarget(t,ot.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,ot.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,ot.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,ot.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,ot.ALTERNATION)}}function Rh(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function la(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],s=[];for(let i=0;i<t.length;i++){const o=t[i];s.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];s.push(o+c)}}t=s}return t}function hw(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const s=e[r];for(let i=0;i<t.length;i++){const o=t[i];if(s[o]===!0)return!1}}return!0}function vh(e,t){const n=C(e,o=>ca([o],1)),r=Rh(n.length),s=C(n,o=>{const a={};return M(o,c=>{const l=la(c.partialPath);M(l,u=>{a[u]=!0})}),a});let i=n;for(let o=1;o<=t;o++){const a=i;i=Rh(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,d=l[u].suffixDef,f=la(h);if(hw(s,f,c)||Y(d)||h.length===t){const _=r[c];if(fa(_,h)===!1){_.push(h);for(let w=0;w<f.length;w++){const R=f[w];s[c][R]=!0}}}else{const _=ca(d,o+1,h);i[c]=i[c].concat(_),M(_,w=>{const R=la(w.partialPath);M(R,A=>{s[c][A]=!0})})}}}}return r}function ua(e,t,n,r){const s=new wh(e,ot.ALTERNATION,r);return t.accept(s),vh(s.result,n)}function ha(e,t,n,r){const s=new wh(e,n);t.accept(s);const i=s.result,a=new uw(t,e,n).startWalking(),c=new Dt({definition:i}),l=new Dt({definition:a});return vh([c,l],r)}function fa(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let s=0;s<r.length;s++){const i=t[s],o=r[s];if((i===o||o.categoryMatchesMap[i.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function fw(e,t){return e.length<t.length&&ce(e,(n,r)=>{const s=t[r];return n===s||s.categoryMatchesMap[n.tokenTypeIdx]})}function Nh(e){return ce(e,t=>ce(t,n=>ce(n,r=>Y(r.categoryMatches))))}function dw(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return C(t,n=>Object.assign({type:Mt.CUSTOM_LOOKAHEAD_VALIDATION},n))}function pw(e,t,n,r){const s=te(e,c=>gw(c,n)),i=bw(e,t,n),o=te(e,c=>ww(c,n)),a=te(e,c=>_w(c,e,r,n));return s.concat(i,o,a)}function gw(e,t){const n=new Ew;e.accept(n);const r=n.allProductions,s=LS(r,mw),i=ue(s,a=>a.length>1);return C(gt(i),a=>{const c=le(a),l=t.buildDuplicateFoundError(e,a),u=Ne(c),h={message:l,type:Mt.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=bh(c);return d&&(h.parameter=d),h})}function mw(e){return`${Ne(e)}_#_${e.idx}_#_${bh(e)}`}function bh(e){return e instanceof Q?e.terminalType.name:e instanceof jt?e.nonTerminalName:""}class Ew extends nr{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function _w(e,t,n,r){const s=[];if(Gt(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});s.push({message:o,type:Mt.DUPLICATE_RULE_NAME,ruleName:e.name})}return s}function yw(e,t,n){const r=[];let s;return kt(t,e)||(s=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:s,type:Mt.INVALID_RULE_OVERRIDE,ruleName:e})),r}function Lh(e,t,n,r=[]){const s=[],i=ui(t.definition);if(Y(i))return[];{const o=e.name;kt(i,e)&&s.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:Mt.LEFT_RECURSION,ruleName:o});const c=zs(i,r.concat([e])),l=te(c,u=>{const h=wt(r);return h.push(u),Lh(e,u,n,h)});return s.concat(l)}}function ui(e){let t=[];if(Y(e))return t;const n=le(e);if(n instanceof jt)t.push(n.referencedRule);else if(n instanceof Dt||n instanceof Ft||n instanceof Re||n instanceof ve||n instanceof he||n instanceof mt)t=t.concat(ui(n.definition));else if(n instanceof fe)t=ae(C(n.definition,i=>ui(i.definition)));else if(!(n instanceof Q))throw Error("non exhaustive match");const r=Xs(n),s=e.length>1;if(r&&s){const i=Rt(e);return t.concat(ui(i))}else return t}class da extends nr{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function Tw(e,t){const n=new da;e.accept(n);const r=n.alternations;return te(r,i=>{const o=Dr(i.definition);return te(o,(a,c)=>{const l=Sh([a],[],jr,1);return Y(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:i,emptyChoiceIdx:c}),type:Mt.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:i.idx,alternative:c+1}]:[]})})}function Sw(e,t,n){const r=new da;e.accept(r);let s=r.alternations;return s=Ys(s,o=>o.ignoreAmbiguities===!0),te(s,o=>{const a=o.idx,c=o.maxLookahead||t,l=ua(a,e,c,o),u=vw(l,o,e,n),h=Nw(l,o,e,n);return u.concat(h)})}class Aw extends nr{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function ww(e,t){const n=new da;e.accept(n);const r=n.alternations;return te(r,i=>i.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:i}),type:Mt.TOO_MANY_ALTS,ruleName:e.name,occurrence:i.idx}]:[])}function Rw(e,t,n){const r=[];return M(e,s=>{const i=new Aw;s.accept(i);const o=i.allProductions;M(o,a=>{const c=Ah(a),l=a.maxLookahead||t,u=a.idx,d=ha(u,s,c,l)[0];if(Y(ae(d))){const f=n.buildEmptyRepetitionError({topLevelRule:s,repetition:a});r.push({message:f,type:Mt.NO_NON_EMPTY_LOOKAHEAD,ruleName:s.name})}})}),r}function vw(e,t,n,r){const s=[],i=Gt(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||M(c,u=>{const h=[l];M(e,(d,f)=>{l!==f&&fa(d,u)&&t.definition[f].ignoreAmbiguities!==!0&&h.push(f)}),h.length>1&&!fa(s,u)&&(s.push(u),a.push({alts:h,path:u}))}),a),[]);return C(i,a=>{const c=C(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:Mt.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function Nw(e,t,n,r){const s=Gt(e,(o,a,c)=>{const l=C(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return Pr(te(s,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Zt(s,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&fw(d.path,l));return C(u,d=>{const f=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:f,prefixPath:d.path}),type:Mt.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:f}})}))}function bw(e,t,n){const r=[],s=C(t,i=>i.name);return M(e,i=>{const o=i.name;if(kt(s,o)){const a=n.buildNamespaceConflictError(i);r.push({message:a,type:Mt.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function Lw(e){const t=Zo(e,{errMsgProvider:QA}),n={};return M(e.rules,r=>{n[r.name]=r}),ZA(n,t.errMsgProvider)}function Cw(e){return e=Zo(e,{errMsgProvider:kn}),pw(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const Ch="MismatchedTokenException",Ih="NoViableAltException",Oh="EarlyExitException",kh="NotAllInputParsedException",Mh=[Ch,Ih,Oh,kh];Object.freeze(Mh);function hi(e){return kt(Mh,e.name)}class fi extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class xh extends fi{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ch}}class Iw extends fi{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ih}}class Ow extends fi{constructor(t,n){super(t,n),this.name=kh}}class kw extends fi{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Oh}}const pa={},Uh="InRuleRecoveryException";class Mw extends Error{constructor(t){super(t),this.name=Uh}}class xw{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=k(t,"recoveryEnabled")?t.recoveryEnabled:Ye.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Uw)}getTokenToInsert(t){const n=ci(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,s){const i=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const d=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:s,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new xh(f,l,this.LA(0));m.resyncedTokens=Dr(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,s)){h();return}else if(r.call(this)){h(),t.apply(this,n);return}else this.tokenMatcher(u,i)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new Mw("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||Y(n))return!1;const r=this.LA(1);return tr(n,i=>this.tokenMatcher(r,i))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return kt(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const s=tr(t,i=>JA(n,i));if(s!==void 0)return s;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return pa;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return C(t,(r,s)=>s===0?pa:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[s],inRule:this.shortRuleNameToFullName(t[s-1])})}flattenFollowSet(){const t=C(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return ae(t)}getFollowSetFromFollowKey(t){if(t===pa)return[On];const n=t.ruleName+t.idxInCallingRule+zu+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,On)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Dr(n)}attemptInRepetitionRecovery(t,n,r,s,i,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),s=wt(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:s,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return C(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function Uw(e,t,n,r,s,i,o){const a=this.getKeyForAutomaticLookahead(r,s);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),f=this.getGAstProductions()[d];c=new i(f,s).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=On,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const Pw=4,un=8,Ph=1<<un,Dh=2<<un,ga=3<<un,ma=4<<un,Ea=5<<un,di=6<<un;function _a(e,t,n){return n|t|e}class Dw{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ye.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(Y(n)){const r=this.validateEmptyOrAlternatives(t.rules),s=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),i=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...s,...i]}return n}validateNoLeftRecursion(t){return te(t,n=>Lh(n,n,kn))}validateEmptyOrAlternatives(t){return te(t,n=>Tw(n,kn))}validateAmbiguousAlternationAlternatives(t,n){return te(t,r=>Sw(r,n,kn))}validateSomeNonEmptyLookaheadPath(t,n){return Rw(t,n,kn)}buildLookaheadForAlternation(t){return ow(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,cw)}buildLookaheadForOptional(t){return aw(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Ah(t.prodType),lw)}}class Fw{initLooksAhead(t){this.dynamicTokensEnabled=k(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ye.dynamicTokensEnabled,this.maxLookahead=k(t,"maxLookahead")?t.maxLookahead:Ye.maxLookahead,this.lookaheadStrategy=k(t,"lookaheadStrategy")?t.lookaheadStrategy:new Dw({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){M(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:s,option:i,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=Bw(n);M(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Ne(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=_a(this.fullRuleNameToShort[n.name],Ph,l.idx);this.setLaFuncCache(d,h)})}),M(s,l=>{this.computeLookaheadFunc(n,l.idx,ga,"Repetition",l.maxLookahead,Ne(l))}),M(i,l=>{this.computeLookaheadFunc(n,l.idx,Dh,"Option",l.maxLookahead,Ne(l))}),M(o,l=>{this.computeLookaheadFunc(n,l.idx,ma,"RepetitionMandatory",l.maxLookahead,Ne(l))}),M(a,l=>{this.computeLookaheadFunc(n,l.idx,di,"RepetitionMandatoryWithSeparator",l.maxLookahead,Ne(l))}),M(c,l=>{this.computeLookaheadFunc(n,l.idx,Ea,"RepetitionWithSeparator",l.maxLookahead,Ne(l))})})})}computeLookaheadFunc(t,n,r,s,i,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:s}),c=_a(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return _a(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class $w extends nr{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const pi=new $w;function Bw(e){pi.reset(),e.accept(pi);const t=pi.dslMethods;return pi.reset(),t}function Fh(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function $h(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function Gw(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function jw(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const Kw="name";function Bh(e,t){Object.defineProperty(e,Kw,{enumerable:!1,configurable:!0,writable:!1,value:t})}function Ww(e,t){const n=Jt(e),r=n.length;for(let s=0;s<r;s++){const i=n[s],o=e[i],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function Hw(e,t){const n=function(){};Bh(n,e+"BaseSemantics");const r={visit:function(s,i){if(j(s)&&(s=s[0]),!ze(s))return this[s.name](s.children,i)},validateVisitor:function(){const s=zw(this,t);if(!Y(s)){const i=C(s,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${i.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function Vw(e,t,n){const r=function(){};Bh(r,e+"BaseSemanticsWithDefaults");const s=Object.create(n.prototype);return M(t,i=>{s[i]=Ww}),r.prototype=s,r.prototype.constructor=r,r}var ya;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(ya||(ya={}));function zw(e,t){return Yw(e,t)}function Yw(e,t){const n=Zt(t,s=>Ke(e[s])===!1),r=C(n,s=>({msg:`Missing visitor method: <${s}> on ${e.constructor.name} CST Visitor.`,type:ya.MISSING_METHOD,methodName:s}));return Pr(r)}class qw{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=k(t,"nodeLocationTracking")?t.nodeLocationTracking:Ye.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=pt,this.cstFinallyStateUpdate=pt,this.cstPostTerminal=pt,this.cstPostNonTerminal=pt,this.cstPostRule=pt;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=$h,this.setNodeLocationFromNode=$h,this.cstPostRule=pt,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=pt,this.setNodeLocationFromNode=pt,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=Fh,this.setNodeLocationFromNode=Fh,this.cstPostRule=pt,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=pt,this.setNodeLocationFromNode=pt,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=pt,this.setNodeLocationFromNode=pt,this.cstPostRule=pt,this.setInitialNodeLocation=pt;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];Gw(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];jw(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(ze(this.baseCstVisitorConstructor)){const t=Hw(this.className,Jt(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ze(this.baseCstVisitorWithDefaultsConstructor)){const t=Vw(this.className,Jt(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class Xw{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Ei}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?Ei:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class Jw{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=_i){if(kt(this.definedRulesNames,t)){const o={message:kn.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:Mt.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const s=this.defineRule(t,n,r);return this[t]=s,s}OVERRIDE_RULE(t,n,r=_i){const s=yw(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(s);const i=this.defineRule(t,n,r);return this[t]=i,i}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(s){if(hi(s))return!1;throw s}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return ZS(gt(this.gastProductionsCache))}}class Qw{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=ai,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},k(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(j(t)){if(Y(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(j(t))this.tokensMap=Gt(t,(i,o)=>(i[o.name]=o,i),{});else if(k(t,"modes")&&ce(ae(gt(t.modes)),zA)){const i=ae(gt(t.modes)),o=ta(i);this.tokensMap=Gt(o,(a,c)=>(a[c.name]=c,a),{})}else if(Xt(t))this.tokensMap=wt(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=On;const r=k(t,"modes")?ae(gt(t.modes)):gt(t),s=ce(r,i=>Y(i.categoryMatches));this.tokenMatcher=s?ai:jr,Kr(gt(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const s=k(r,"resyncEnabled")?r.resyncEnabled:_i.resyncEnabled,i=k(r,"recoveryValueFunc")?r.recoveryValueFunc:_i.recoveryValueFunc,o=this.ruleShortNameIdx<<Pw+un;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,s,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const s=this.RULE_STACK.length===1,i=n&&!this.isBackTracking()&&this.recoveryEnabled;if(hi(t)){const o=t;if(i){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(s)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(Dh,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof t!="function"){i=t.DEF;const o=t.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=t;if(s.call(this)===!0)return i.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(ma,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const o=n.GATE;if(o!==void 0){const a=s;s=()=>o.call(this)&&a.call(this)}}else i=n;if(s.call(this)===!0){let o=this.doSingleRepetition(i);for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i)}else throw this.raiseEarlyExitException(t,ot.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],s,ma,t,sw)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(di,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,a,s,Th],a,di,t,Th)}else throw this.raiseEarlyExitException(t,ot.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(ga,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let s=this.getLaFuncFromCache(r),i;if(typeof n!="function"){i=n.DEF;const a=n.GATE;if(a!==void 0){const c=s;s=()=>a.call(this)&&c.call(this)}}else i=n;let o=!0;for(;s.call(this)===!0&&o===!0;)o=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],s,ga,t,rw,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ea,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const s=n.DEF,i=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){s.call(this);const a=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,i,a,s,yh],a,Ea,t,yh)}}repetitionSepSecondInternal(t,n,r,s,i){for(;r();)this.CONSUME(n),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,s,i],r,di,t,i)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(Ph,n),s=j(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,s);if(o!==void 0)return s[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new Ow(n,t))}}subruleInternal(t,n,r){let s;try{const i=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,s=t.apply(this,i),this.cstPostNonTerminal(s,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),s}catch(i){throw this.subruleInternalError(i,r,t.ruleName)}}subruleInternalError(t,n,r){throw hi(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let s;try{const i=this.LA(1);this.tokenMatcher(i,t)===!0?(this.consumeToken(),s=i):this.consumeInternalError(t,i,r)}catch(i){s=this.consumeInternalRecovery(t,n,i)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,s),s}consumeInternalError(t,n,r){let s;const i=this.LA(0);throw r!==void 0&&r.ERR_MSG?s=r.ERR_MSG:s=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new xh(s,n,i))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const s=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,s)}catch(i){throw i.name===Uh?r:i}}else throw r}saveRecogState(){const t=this.errors,n=wt(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),On)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class Zw{initErrorHandler(t){this._errors=[],this.errorMessageProvider=k(t,"errorMessageProvider")?t.errorMessageProvider:Ye.errorMessageProvider}SAVE_ERROR(t){if(hi(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:wt(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return wt(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const s=this.getCurrRuleFullName(),i=this.getGAstProductions()[s],a=ha(t,i,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:s});throw this.SAVE_ERROR(new kw(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),s=this.getGAstProductions()[r],i=ua(t,s,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:i,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new Iw(c,this.LA(1),a))}}class tR{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(ze(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return Sh([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=le(t.ruleStack),s=this.getGAstProductions()[n];return new nw(s,t).startWalking()}}const gi={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(gi);const Gh=!0,jh=Math.pow(2,un)-1,Kh=U({name:"RECORDING_PHASE_TOKEN",pattern:yt.NA});Kr([Kh]);const Wh=ci(Kh,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(Wh);const eR={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class nR{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,s){return this.consumeInternalRecord(r,t,s)},this[`SUBRULE${n}`]=function(r,s){return this.subruleInternalRecord(r,t,s)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return Ei}topLevelRuleRecord(t,n){try{const r=new er({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Vr.call(this,Ft,t,n)}atLeastOneInternalRecord(t,n){Vr.call(this,Re,n,t)}atLeastOneSepFirstInternalRecord(t,n){Vr.call(this,ve,n,t,Gh)}manyInternalRecord(t,n){Vr.call(this,mt,n,t)}manySepFirstInternalRecord(t,n){Vr.call(this,he,n,t,Gh)}orInternalRecord(t,n){return rR.call(this,t,n)}subruleInternalRecord(t,n,r){if(mi(n),!t||k(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Hh(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const s=Zn(this.recordingProdStack),i=t.ruleName,o=new jt({idx:n,nonTerminalName:i,label:r==null?void 0:r.LABEL,referencedRule:void 0});return s.definition.push(o),this.outputCst?eR:gi}consumeInternalRecord(t,n,r){if(mi(n),!ah(t)){const o=new Error(`<CONSUME${Hh(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const s=Zn(this.recordingProdStack),i=new Q({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return s.definition.push(i),Wh}}function Vr(e,t,n,r=!1){mi(n);const s=Zn(this.recordingProdStack),i=Ke(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),k(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),i.call(this),s.definition.push(o),this.recordingProdStack.pop(),gi}function rR(e,t){mi(t);const n=Zn(this.recordingProdStack),r=j(e)===!1,s=r===!1?e:e.DEF,i=new fe({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});k(e,"MAX_LOOKAHEAD")&&(i.maxLookahead=e.MAX_LOOKAHEAD);const o=ju(s,a=>Ke(a.GATE));return i.hasPredicates=o,n.definition.push(i),M(s,a=>{const c=new Dt({definition:[]});i.definition.push(c),k(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:k(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),gi}function Hh(e){return e===0?"":`${e}`}function mi(e){if(e<0||e>jh){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${jh+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class sR{initPerformanceTracer(t){if(k(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ye.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:s,value:i}=Wu(n),o=s>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${s}ms`),this.traceInitIndent--,i}else return n()}}function iR(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(s=>{if(s==="constructor")return;const i=Object.getOwnPropertyDescriptor(r,s);i&&(i.get||i.set)?Object.defineProperty(e.prototype,s,i):e.prototype[s]=n.prototype[s]})})}const Ei=ci(On,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Ei);const Ye=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:_h,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),_i=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Mt;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Mt||(Mt={}));class zr{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Hu(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),M(this.definedRulesNames,s=>{const o=this[s].originalGrammarAction;let a;this.TRACE_INIT(`${s} Rule`,()=>{a=this.topLevelRuleRecord(s,o)}),this.gastProductionsCache[s]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=Lw({rules:gt(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(Y(r)&&this.skipValidations===!1){const s=Cw({rules:gt(this.gastProductionsCache),tokenTypes:gt(this.tokensMap),errMsgProvider:kn,grammarName:n}),i=dw({lookaheadStrategy:this.lookaheadStrategy,rules:gt(this.gastProductionsCache),tokenTypes:gt(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(s,i)}}),Y(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const s=oA(gt(this.gastProductionsCache));this.resyncFollows=s}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var s,i;(i=(s=this.lookaheadStrategy).initialize)===null||i===void 0||i.call(s,{rules:gt(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(gt(this.gastProductionsCache))})),!zr.DEFER_DEFINITION_ERRORS_HANDLING&&!Y(this.definitionErrors))throw t=C(this.definitionErrors,s=>s.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),k(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=k(n,"skipValidations")?n.skipValidations:Ye.skipValidations}}zr.DEFER_DEFINITION_ERRORS_HANDLING=!1,iR(zr,[xw,Fw,qw,Xw,Qw,Jw,Zw,tR,nR,sR]);class oR extends zr{constructor(t,n=Ye){const r=wt(n);r.outputCst=!0,super(t,r)}}const be=!!JSON.parse("false");JSON.parse("false");const aR=!!JSON.parse("false"),Ta=yo(32,126).map(e=>String.fromCharCode(e)),Yr=U({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),cR=U({name:"Whitespace",pattern:/ +/,group:yt.SKIPPED}),lR=U({name:"Whitespace",pattern:/\s+/,line_breaks:!0,group:yt.SKIPPED}),Sa=U({name:"Stat",pattern:/@.*/,start_chars_hint:["@"]}),de=U({name:"Command",pattern:/#/,start_chars_hint:["#"]});let Vh=!1;function uR(e,t,n){if(!Vh)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Yr)return null;let s=t;for(;e[s]===" ";)s++;if("@#/?':!".includes(e[s]))return null;let i=t+1;for(;i<e.length&&e[i]!==`
`;)i++;return[e.substring(t,i)]}const zh=U({name:"Text",pattern:uR,line_breaks:!1,start_chars_hint:Ta.filter(e=>"@#/?':!".includes(e)===!1)}),Yh=U({name:"Comment",pattern:/'.*/,start_chars_hint:["'"]}),qh=U({name:"Label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Xh=U({name:"HyperLink",pattern:/!/,start_chars_hint:["!"]}),Jh=U({name:"HyperLinkText",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Kt=U({name:"StringLiteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:Ta}),Qh=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Zh=U({name:"NumberLiteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/});function ee(e){return U({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Kt})}const tf=U({name:"IsEq",pattern:/=|is|eq|equal/,longer_alt:Kt}),ef=U({name:"IsNotEq",pattern:/!=|not ?eq|not ?equal/,longer_alt:Kt}),nf=U({name:"IsLessThan",pattern:/<|below/,longer_alt:Kt}),rf=U({name:"IsGreaterThan",pattern:/>|above/,longer_alt:Kt}),sf=U({name:"IsLessThanOrEqual",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:Kt}),of=U({name:"IsGreaterThanOrEqual",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:Kt}),Aa=U({name:"Or",pattern:/or/i,longer_alt:Kt}),wa=U({name:"Not",pattern:/not/i,longer_alt:Kt}),Ra=U({name:"And",pattern:/and/i,longer_alt:Kt}),va=U({name:"Plus",pattern:/\+/}),Na=U({name:"Minus",pattern:/-/}),af=U({name:"Power",pattern:/\*\*/}),cf=U({name:"Multiply",pattern:/\*/}),ba=U({name:"Divide",pattern:/\//}),lf=U({name:"ModDivide",pattern:/%/}),uf=U({name:"FloorDivide",pattern:/%%/}),hf=U({name:"Query",pattern:/\?/}),ff=U({name:"LParen",pattern:/\(/,push_mode:"ignore_newlines"}),df=U({name:"RParen",pattern:/\)/,pop_mode:!0}),pf=U({name:"play",pattern:/play .*/,start_chars_hint:Ta,longer_alt:Kt}),La=ee("if"),Mn=ee("do"),Ca=ee("else"),gf=ee("endif"),mf=ee("while"),Ef=ee("endwhile"),_f=ee("repeat"),yf=ee("endrepeat"),Ia=ee("read"),Tf=ee("endread"),Sf=ee("break"),Af=ee("continue");function wf(e){return[...e,Zh,tf,ef,sf,nf,of,rf,Aa,wa,Ra,va,Na,af,cf,ba,uf,lf,hf,ff,df,Qh,Kt]}const Rf=wf([zh,Sa,pf,de,Yh,qh,Xh,Jh,Yr,cR,La,Mn,Ca,gf,mf,Ef,_f,yf,Ia,Tf,Sf,Af]),hR=new yt({defaultMode:"use_newlines",modes:{use_newlines:Rf,ignore_newlines:wf([lR])}},{skipValidations:!be,ensureOptimizations:be});function Oa(e){Vh=!0;const t=hR.tokenize(e||` 
`),[n]=(Array.isArray(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(ci(Yr,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}var at=(e=>(e[e.ERROR=0]="ERROR",e[e.FUNC=1]="FUNC",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(at||{});function qr(e,t){return{id:$e(),code:e,...t}}function fR(e){return e.map(t=>t.image)}function dR(e,t){const[n,r,...s]=t;if(E(e.stats)&&E(n))switch(n.image.toLowerCase()){case"rn":case"range":case"sl":case"select":case"nm":case"number":case"tx":case"text":case"ln":case"link":if(E(r)){const i=r.image.toLowerCase();e.stats[i]=fR(s??[])}break}}function vf(e){const t={...ka(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function ka(e){var r;if(!E(e))return{};if(E((r=e.stats)==null?void 0:r.type))return e.stats;e.stats={};const t=Oa(e.code);let n=!0;for(let s=0;s<t.tokens.length;++s){const i=t.tokens[s];if(i.tokenType===Sa){const[o,...a]=i.image.slice(1).split(" "),c=o.toLowerCase(),l=a.join(" "),u=l.toLowerCase();switch(c){case"stat":{const h=Oa(`!${l}`);h.tokens.length&&dR(e,h.tokens);break}case"flags":e.stats.flags=u;break;case"func":e.stats.type=1,e.stats.name=u;break;case"board":e.stats.type=2,e.stats.name=u;break;case"object":e.stats.type=3,e.stats.name=u;break;case"terrain":e.stats.type=4,e.stats.name=u;break;case"charset":e.stats.type=5,e.stats.name=u;break;case"palette":e.stats.type=6,e.stats.name=u;break;default:n?e.stats.name=[c,...a].join(" "):e.stats[c]=1;break}n=!1}}return E(e.stats.type)||(e.stats.type=3),e.stats}function pR(e){return ka(e).type??0}function gR(e){return(ka(e).name??"").toLowerCase()}function mR(e,t){return{id:$e(),name:e,pages:t,flags:{},players:{}}}function Ma(e,t,n){if(!E(e))return;const r=n.toLowerCase();return e.pages.find(i=>pR(i)===t&&(i.id===n||r===gR(i)))}function xa(e,t,n){const r=Ma(e,t,n);if(r)switch(t){case at.ERROR:return r.error;case at.FUNC:return r.code;case at.BOARD:return r.board;case at.OBJECT:return r.object;case at.TERRAIN:return r.terrain;case at.CHARSET:return r.charset;case at.PALETTE:return r.palette}}function Le(e,t){if(E(t)&&E(t.kind))return E(t.kinddata)||(t.kinddata=E(t.id)?yi(e,t.kind):Nf(e,t.kind)),t.kinddata}function yi(e,t){const n=t??"",r=Ma(e,at.OBJECT,n),s=xa(e,at.OBJECT,n);if(E(r)){const i=vf(r);return{...s,...i,name:n,code:r.code}}else return}function Nf(e,t){const n=t??"",r=Ma(e,at.TERRAIN,n),s=xa(e,at.TERRAIN,n);if(E(r)){const i=vf(r);return{...s,...i,name:n,code:r.code}}else return}function sr(e,t){return xa(e,at.BOARD,t)}function bf(e,t){if(e)return e.flags[t]=e.flags[t]??{},e.flags[t]}function ER(e,t,n){const r=bf(e,t);return r==null?void 0:r[n]}function _R(e,t,n,r){const s=bf(e,t);return s&&(s[n]=r),r}function Lf(e,t){return sr(e,(e==null?void 0:e.players[t])??"")}function yR(e,t,n){E(e)&&E(sr(e,n))&&(e.players[t]=n)}function TR(e){return rm(Object.values((e==null?void 0:e.players)??[])).map(t=>sr(e,t)).filter(E)}function SR(e,t,n,r){const s=Ao(t,(n==null?void 0:n.id)??"");if(!E(e)||!E(t)||!E(s)||!E(s.x)||!E(s.y)||!E(t.lookup)||r.x<0||r.x>=t.width||r.y<0||r.y>=t.height)return{kind:"edge",collision:ht.SOLID,x:r.x,y:r.y};if(s.x-r.x===0&&s.y-r.y===0)return;const i=r.x+r.y*t.width,o=Le(e,s),a=s.collision??(o==null?void 0:o.collision),c=Ao(t,t.lookup[i]??"");if(E(c))return{...c};const l=t.terrain[i];if(E(l)){const u=Le(e,l),h=l.collision??(u==null?void 0:u.collision);if(ol(a,h))return{...l,x:r.x,y:r.y}}s.x=r.x,s.y=r.y,E(s.removed)||(t.lookup[i]=void 0,t.lookup[s.x+s.y*t.width]=s.id??"")}function ir(e,t){const n=Le(e,t);return E(t==null?void 0:t.id)&&E(t.x)&&E(t.y)?(t.name??(n==null?void 0:n.name)??"object").toLowerCase():((t==null?void 0:t.name)??(n==null?void 0:n.name)??"terrain").toLowerCase()}function Ua(e,t,n,r){if(!E(e)||!E(t)||!E(t.named)||!E(n))return;const s=ir(e,n);t.named[s]||(t.named[s]=new Set),t.named[s].add((n==null?void 0:n.id)??r??"")}function AR(e,t,n){if(!(!E(e)||!E(t)||!E(t.lookup)||!E(n==null?void 0:n.id))&&!E(n.removed)){const r=n.x??0,s=n.y??0;t.lookup[r+s*t.width]=n.id}}function Xr(e,t){if(!E(e)||!E(t)||E(t.lookup)&&E(t.named))return;const n=new Array(t.width*t.height).fill(void 0),r={},s=Object.values(t.objects);for(let a=0;a<s.length;++a){const c=s[a];if(E(c.x)&&E(c.y)&&E(c.id)&&!E(c.removed)){c.category=Is.OBJECT,n[c.x+c.y*t.width]=c.id;const l=ir(e,c);r[l]||(r[l]=new Set),r[l].add(c.id)}}let i=0,o=0;for(let a=0;a<t.terrain.length;++a){const c=t.terrain[a];if(E(c)){c.x=i,c.y=o,c.category=Is.TERRAIN;const l=ir(e,c);r[l]||(r[l]=new Set),r[l].add(a)}++i,i>=t.width&&(i=0,++o)}t.lookup=n,t.named=r}function Pa(e,t,n){return ir(e,t)!=="player"&&E(t)?(t.removed=n,!0):!1}function Ti(e,t,n){var r;if(E(e)&&E(t)&&E(n==null?void 0:n.id)){if(E(t.lookup)&&E(n.x)&&E(n.y)){const i=n.x+n.y*t.width;t.lookup[i]===n.id&&delete t.lookup[i]}const s=ir(e,n);E((r=t.named)==null?void 0:r[s])&&E(n.id)&&t.named[s].delete(n.id)}}function wR(e,t,n){if(!E(e)||!E(t))return;const r=Object.values(t.objects);for(let s=0;s<r.length;++s){const i=r[s];E(i.id)&&E(i.removed)&&n-i.removed>Co*5&&wo(t,i.id)}}function RR(e,t,n){const r=[];if(!E(e)||!E(t))return r;t.lookup=void 0,Xr(e,t);const s=Object.values(t.objects);for(let i=0;i<s.length;++i){const o=s[i];if(!E(o.id))continue;o.lx=o.x,o.ly=o.y;const a=Le(e,o),c=o.code??(a==null?void 0:a.code)??"";c&&r.push({id:o.id,type:at.OBJECT,code:c,object:o,terrain:void 0})}return wR(e,t,n),r}var Jr=(e=>(e[e.VIEW=0]="VIEW",e[e.EDIT=1]="EDIT",e))(Jr||{});function Cf(e){return{id:$e(),type:e}}function If(e,t){const n=Cf(0);return n.book=e,n.board=t,n}function vR(e,t){const n=Cf(1);return n.book=e,n.board=t,n}const pe={defaultplayer:"",books:new Map,chips:new Map,frames:new Map};function NR(e){pe.defaultplayer=e}function Of(e){const t=[If(void 0,void 0)];return pe.frames.set(e,t),t}function bR(e,t,n){const r=Si(e);E(r)&&r.push(If(t,n))}function LR(e,t,n){const r=Si(e);E(r)&&r.push(vR(t,n))}function Si(e){return pe.frames.get(e)??Of(e)}function Qr(e){const t=e.toLowerCase();return pe.books.get(e)??[...pe.books.values()].find(n=>n.name.toLowerCase()===t)}function CR(e){return pe.books.clear(),pe.books.set(e.id,e),e.id}function IR(e){return pe.books.set(e.id,e),e.id}function Z(e){let t=pe.chips.get(e);return E(t)||(t={book:void 0,board:void 0,object:void 0,terrain:void 0,charset:void 0,palette:void 0,inputqueue:new Set,inputmods:{[dt.NONE]:0,[dt.MOVE_UP]:0,[dt.MOVE_DOWN]:0,[dt.MOVE_LEFT]:0,[dt.MOVE_RIGHT]:0,[dt.OK_BUTTON]:0,[dt.CANCEL_BUTTON]:0,[dt.MENU_BUTTON]:0},inputcurrent:void 0},pe.chips.set(e,t)),t}function O(e,t){const n=Z(e.id());return gm(n,t,e.get)}const Ai="main",Da="player",Fa="title";function OR(e){if(!st(e)||!e)return Vn("memory","login",`failed for playerid ==>${e}<==`,e);const t=Qr(Ai);if(!E(t))return Vn("memory","login",`login failed to find book ${Ai}`,e);const n=sr(t,Fa);if(!E(n))return Vn("memory","login",`login failed to find board ${Fa}`,e);const r=yi(t,Da);if(!E(r))return Vn("memory","login",`login failed to find object type ${Da}`,e);const s=ll(n,{id:e,x:0,y:0,kind:Da,stats:{player:e}});return E(s==null?void 0:s.id)&&yR(t,e,Fa),!0}function kR(e){pe.books.forEach(t=>wo(Lf(t,e),e))}function MR(e,t){const n=Qr(Ai);TR(n).forEach(r=>{const s=RR(n,r,t);for(let i=0;i<s.length;++i){const o=s[i],a=Z(o.id);a.book=n,a.board=r,a.object=o.object,a.inputcurrent=void 0,e.tick(o.id,o.type,t,o.code)}})}function xR(e,t,n,r){const s=`${n}_func`,i=Z(s);i.book=void 0,i.board=void 0,i.inputcurrent=void 0,console.info("running",t,s,r),e.tick(s,at.FUNC,t,r),e.halt(s)}function UR(e,t,n,r,s,i){const o=[];let a=t;const c=a===0,l=r.width??0,u=r.height??0,h=c?V.BLACK:V.CLEAR,d=yg(e,a++,l,u,h);o.push(d);const f=Ag(e,a++,l,u);o.push(f);const m=a++,_=Sg(e,m);o.push(_);const w=wg(e,a++);s&&o.push(w),r.terrain.forEach((y,g)=>{if(y){const p=Le(n,y);d.char[g]=y.char??(p==null?void 0:p.char)??0,d.color[g]=y.color??(p==null?void 0:p.color)??h,d.bg[g]=y.bg??(p==null?void 0:p.bg)??h,d.color[g]!==V.CLEAR&&(i[g]=d.color[g])}});const R=r.objects??{};Object.values(R).forEach(y=>{if(E(y.removed)||E(y.headless))return;const g=y.id??"",p=Le(n,y),S=Tg(e,m,g),v=y.lx??y.x??0,K=y.ly??y.y??0,ut=v+K*r.width;S.x=y.x??0,S.y=y.y??0,S.char=y.char??(p==null?void 0:p.char)??1,S.color=y.color??(p==null?void 0:p.color)??V.WHITE,S.bg=y.bg??(p==null?void 0:p.bg)??V.BORROW,_.sprites.push(S),S.bg===V.SHADOW&&(S.bg=V.CLEAR,f.alphas[v+K*l]=.5),S.bg===V.BORROW&&(S.bg=i[ut]??V.BLACK),S.color!==V.CLEAR&&(i[ut]=S.color),g===e&&(w.focusx=S.x,w.focusy=S.y,w.focusid=g)});function A(y,g){if(!(y<0||y>=r.width||g<0||g>=r.height))return f.alphas[y+g*r.width]}const T=[[1,1,1,1,1],[1,3,5,3,1],[1,5,12,5,1],[1,3,5,3,1],[1,1,1,1,1]].flat(),b=new Array(f.alphas.length);for(let y=0;y<f.alphas.length;++y){const g=y%r.width,p=Math.floor(y/r.width),S=[[A(g-2,p-2),A(g-1,p-2),A(g,p-2),A(g+1,p-2),A(g+2,p-2)],[A(g-2,p-1),A(g-1,p-1),A(g,p-1),A(g+1,p-1),A(g+2,p-1)],[A(g-2,p),A(g-1,p),A(g,p),A(g+1,p),A(g+2,p)],[A(g-2,p+1),A(g-1,p+1),A(g,p+1),A(g+1,p+1),A(g+2,p+1)],[A(g-2,p+2),A(g-1,p+2),A(g,p+2),A(g+1,p+2),A(g+2,p+2)]].flat().map((v,K)=>E(v)?v*T[K]:void 0).filter(E);b[y]=An(sm(S),0,1)}return f.alphas=b,o}function kf(e){switch(e.type){case Jr.EDIT:return 1;case Jr.VIEW:return 2}return 0}function PR(e){const t=Qr(Ai),n=Lf(t,e),r=[];if(!E(t)||!E(n))return r;let s=0;const i=[...Si(n.id??"")],o=new Array(n.width*n.height).fill(0);return i.sort((a,c)=>kf(a)-kf(c)),i.forEach(a=>{const c=Qr(a.book??"")??t,l=sr(c,a.board??"")??n;if(E(c)&&E(l)){const u=UR(e,s,c,l,a.type===Jr.VIEW,o);s+=u.length,r.push(...u)}}),r}var Mf={exports:{}},$a={exports:{}},xf;function DR(){return xf||(xf=1,function(e,t){(function(n,r){e.exports=r()})(Rs,function(){function n(_){return!isNaN(parseFloat(_))&&isFinite(_)}function r(_){return _.charAt(0).toUpperCase()+_.substring(1)}function s(_){return function(){return this[_]}}var i=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=i.concat(o,a,c,l);function h(_){if(_)for(var w=0;w<u.length;w++)_[u[w]]!==void 0&&this["set"+r(u[w])](_[u[w]])}h.prototype={getArgs:function(){return this.args},setArgs:function(_){if(Object.prototype.toString.call(_)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=_},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(_){if(_ instanceof h)this.evalOrigin=_;else if(_ instanceof Object)this.evalOrigin=new h(_);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var _=this.getFileName()||"",w=this.getLineNumber()||"",R=this.getColumnNumber()||"",A=this.getFunctionName()||"";return this.getIsEval()?_?"[eval] ("+_+":"+w+":"+R+")":"[eval]:"+w+":"+R:A?A+" ("+_+":"+w+":"+R+")":_+":"+w+":"+R}},h.fromString=function(w){var R=w.indexOf("("),A=w.lastIndexOf(")"),T=w.substring(0,R),b=w.substring(R+1,A).split(","),y=w.substring(A+1);if(y.indexOf("@")===0)var g=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(y,""),p=g[1],S=g[2],v=g[3];return new h({functionName:T,args:b||void 0,fileName:p,lineNumber:S||void 0,columnNumber:v||void 0})};for(var d=0;d<i.length;d++)h.prototype["get"+r(i[d])]=s(i[d]),h.prototype["set"+r(i[d])]=function(_){return function(w){this[_]=!!w}}(i[d]);for(var f=0;f<o.length;f++)h.prototype["get"+r(o[f])]=s(o[f]),h.prototype["set"+r(o[f])]=function(_){return function(w){if(!n(w))throw new TypeError(_+" must be a Number");this[_]=Number(w)}}(o[f]);for(var m=0;m<a.length;m++)h.prototype["get"+r(a[m])]=s(a[m]),h.prototype["set"+r(a[m])]=function(_){return function(w){this[_]=String(w)}}(a[m]);return h})}($a)),$a.exports}(function(e,t){(function(n,r){e.exports=r(DR())})(Rs,function(r){var s=/(^|@)\S+:\d+/,i=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(i))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=h.match(/ (\(.+\)$)/);h=d?h.replace(d[0],""):h;var f=this.extractLocation(d?d[1]:h),m=d&&h||void 0,_=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:m,fileName:_,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(h),f=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(h,""));return new r({functionName:f,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],d=2,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],d=0,f=u.length;d<f;d+=2){var m=l.exec(u[d]);m&&h.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),d=this.extractLocation(h.pop()),f=h.shift()||"",m=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,_;f.match(/\(([^)]*)\)/)&&(_=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var w=_===void 0||_==="[arguments not available]"?void 0:_.split(",");return new r({functionName:m,args:w,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Mf);var FR=Mf.exports,$R=oo(FR),Uf={},Pf={},Df={};const Ff="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");Df.encode=function(e){if(0<=e&&e<Ff.length)return Ff[e];throw new TypeError("Must be between 0 and 63: "+e)};const BR=Df,$f=5,Bf=1<<$f,GR=Bf-1,jR=Bf;function KR(e){return e<0?(-e<<1)+1:(e<<1)+0}Pf.encode=function(t){let n="",r,s=KR(t);do r=s&GR,s>>>=$f,s>0&&(r|=jR),n+=BR.encode(r);while(s>0);return n};var Zr={};(function(e){function t(g,p,S){if(p in g)return g[p];if(arguments.length===3)return S;throw new Error('"'+p+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function s(g){const p=g.match(n);return p?{scheme:p[1],auth:p[2],host:p[3],port:p[4],path:p[5]}:null}e.urlParse=s;function i(g){let p="";return g.scheme&&(p+=g.scheme+":"),p+="//",g.auth&&(p+=g.auth+"@"),g.host&&(p+=g.host),g.port&&(p+=":"+g.port),g.path&&(p+=g.path),p}e.urlGenerate=i;const o=32;function a(g){const p=[];return function(S){for(let K=0;K<p.length;K++)if(p[K].input===S){const ut=p[0];return p[0]=p[K],p[K]=ut,p[0].result}const v=g(S);return p.unshift({input:S,result:v}),p.length>o&&p.pop(),v}}const c=a(function(p){let S=p;const v=s(p);if(v){if(!v.path)return p;S=v.path}const K=e.isAbsolute(S),ut=[];let Rr=0,At=0;for(;;)if(Rr=At,At=S.indexOf("/",Rr),At===-1){ut.push(S.slice(Rr));break}else for(ut.push(S.slice(Rr,At));At<S.length&&S[At]==="/";)At++;let De=0;for(At=ut.length-1;At>=0;At--){const se=ut[At];se==="."?ut.splice(At,1):se===".."?De++:De>0&&(se===""?(ut.splice(At+1,De),De=0):(ut.splice(At,2),De--))}return S=ut.join("/"),S===""&&(S=K?"/":"."),v?(v.path=S,i(v)):S});e.normalize=c;function l(g,p){g===""&&(g="."),p===""&&(p=".");const S=s(p),v=s(g);if(v&&(g=v.path||"/"),S&&!S.scheme)return v&&(S.scheme=v.scheme),i(S);if(S||p.match(r))return p;if(v&&!v.host&&!v.path)return v.host=p,i(v);const K=p.charAt(0)==="/"?p:c(g.replace(/\/+$/,"")+"/"+p);return v?(v.path=K,i(v)):K}e.join=l,e.isAbsolute=function(g){return g.charAt(0)==="/"||n.test(g)};function u(g,p){g===""&&(g="."),g=g.replace(/\/$/,"");let S=0;for(;p.indexOf(g+"/")!==0;){const v=g.lastIndexOf("/");if(v<0||(g=g.slice(0,v),g.match(/^([^\/]+:\/)?\/*$/)))return p;++S}return Array(S+1).join("../")+p.substr(g.length+1)}e.relative=u;const h=function(){return!("__proto__"in Object.create(null))}();function d(g){return g}function f(g){return _(g)?"$"+g:g}e.toSetString=h?d:f;function m(g){return _(g)?g.slice(1):g}e.fromSetString=h?d:m;function _(g){if(!g)return!1;const p=g.length;if(p<9||g.charCodeAt(p-1)!==95||g.charCodeAt(p-2)!==95||g.charCodeAt(p-3)!==111||g.charCodeAt(p-4)!==116||g.charCodeAt(p-5)!==111||g.charCodeAt(p-6)!==114||g.charCodeAt(p-7)!==112||g.charCodeAt(p-8)!==95||g.charCodeAt(p-9)!==95)return!1;for(let S=p-10;S>=0;S--)if(g.charCodeAt(S)!==36)return!1;return!0}function w(g,p,S){let v=A(g.source,p.source);return v!==0||(v=g.originalLine-p.originalLine,v!==0)||(v=g.originalColumn-p.originalColumn,v!==0||S)||(v=g.generatedColumn-p.generatedColumn,v!==0)||(v=g.generatedLine-p.generatedLine,v!==0)?v:A(g.name,p.name)}e.compareByOriginalPositions=w;function R(g,p,S){let v=g.generatedLine-p.generatedLine;return v!==0||(v=g.generatedColumn-p.generatedColumn,v!==0||S)||(v=A(g.source,p.source),v!==0)||(v=g.originalLine-p.originalLine,v!==0)||(v=g.originalColumn-p.originalColumn,v!==0)?v:A(g.name,p.name)}e.compareByGeneratedPositionsDeflated=R;function A(g,p){return g===p?0:g===null?1:p===null?-1:g>p?1:-1}function T(g,p){let S=g.generatedLine-p.generatedLine;return S!==0||(S=g.generatedColumn-p.generatedColumn,S!==0)||(S=A(g.source,p.source),S!==0)||(S=g.originalLine-p.originalLine,S!==0)||(S=g.originalColumn-p.originalColumn,S!==0)?S:A(g.name,p.name)}e.compareByGeneratedPositionsInflated=T;function b(g){return JSON.parse(g.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=b;function y(g,p,S){if(p=p||"",g&&(g[g.length-1]!=="/"&&p[0]!=="/"&&(g+="/"),p=g+p),S){const v=s(S);if(!v)throw new Error("sourceMapURL could not be parsed");if(v.path){const K=v.path.lastIndexOf("/");K>=0&&(v.path=v.path.substring(0,K+1))}p=l(i(v),p)}return c(p)}e.computeSourceURL=y})(Zr);var Ba={};let WR=class ig{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new ig;for(let s=0,i=t.length;s<i;s++)r.add(t[s],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),s=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,s)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};Ba.ArraySet=WR;var Gf={};const jf=Zr;function HR(e,t){const n=e.generatedLine,r=t.generatedLine,s=e.generatedColumn,i=t.generatedColumn;return r>n||r==n&&i>=s||jf.compareByGeneratedPositionsInflated(e,t)<=0}let VR=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){HR(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(jf.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};Gf.MappingList=VR;const ts=Pf,ft=Zr,wi=Ba.ArraySet,zR=Gf.MappingList;let Kf=class og{constructor(t){t||(t={}),this._file=ft.getArg(t,"file",null),this._sourceRoot=ft.getArg(t,"sourceRoot",null),this._skipValidation=ft.getArg(t,"skipValidation",!1),this._sources=new wi,this._names=new wi,this._mappings=new zR,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new og({file:t.file,sourceRoot:n});return t.eachMapping(function(s){const i={generated:{line:s.generatedLine,column:s.generatedColumn}};s.source!=null&&(i.source=s.source,n!=null&&(i.source=ft.relative(n,i.source)),i.original={line:s.originalLine,column:s.originalColumn},s.name!=null&&(i.name=s.name)),r.addMapping(i)}),t.sources.forEach(function(s){let i=s;n!==null&&(i=ft.relative(n,s)),r._sources.has(i)||r._sources.add(i);const o=t.sourceContentFor(s);o!=null&&r.setSourceContent(s,o)}),r}addMapping(t){const n=ft.getArg(t,"generated"),r=ft.getArg(t,"original",null);let s=ft.getArg(t,"source",null),i=ft.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,s,i),s!=null&&(s=String(s),this._sources.has(s)||this._sources.add(s)),i!=null&&(i=String(i),this._names.has(i)||this._names.add(i)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:s,name:i})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=ft.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ft.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[ft.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let s=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);s=t.file}const i=this._sourceRoot;i!=null&&(s=ft.relative(i,s));const o=this._mappings.toArray().length>0?new wi:this._sources,a=new wi;this._mappings.unsortedForEach(function(c){if(c.source===s&&c.originalLine!=null){const h=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});h.source!=null&&(c.source=h.source,r!=null&&(c.source=ft.join(r,c.source)),i!=null&&(c.source=ft.relative(i,c.source)),c.originalLine=h.line,c.originalColumn=h.column,h.name!=null&&(c.name=h.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=ft.join(r,c)),i!=null&&(c=ft.relative(i,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,s){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!s)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:s}))}}_serializeMappings(){let t=0,n=1,r=0,s=0,i=0,o=0,a="",c,l,u,h;const d=this._mappings.toArray();for(let f=0,m=d.length;f<m;f++){if(l=d[f],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!ft.compareByGeneratedPositionsInflated(l,d[f-1]))continue;c+=","}c+=ts.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(h=this._sources.indexOf(l.source),c+=ts.encode(h-o),o=h,c+=ts.encode(l.originalLine-1-s),s=l.originalLine-1,c+=ts.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=ts.encode(u-i),i=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=ft.relative(n,r));const s=ft.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,s)?this._sourcesContents[s]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};Kf.prototype._version=3,Uf.SourceMapGenerator=Kf;var Wf={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,s,i,o,a){const c=Math.floor((r-n)/2)+n,l=o(s,i[c],!0);return l===0?c:l>0?r-c>1?t(c,r,s,i,o,a):a==e.LEAST_UPPER_BOUND?r<i.length?r:-1:c:c-n>1?t(n,c,s,i,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,s,i,o){if(s.length===0)return-1;let a=t(-1,s.length,r,s,i,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&i(s[a],s[a-1],!0)===0;)--a;return a}})(Wf);var es={exports:{}},YR={},qR=Object.freeze({__proto__:null,default:YR}),Hf=fg(qR);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;es.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},es.exports.initialize=t=>e=t}else{const e=Hf,t=Hf;es.exports=function(){return new Promise((r,s)=>{const i=t.join(__dirname,"mappings.wasm");e.readFile(i,null,(o,a)=>{if(o){s(o);return}r(a.buffer)})})},es.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var Vf=es.exports;const XR=Vf;function JR(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let ns=null;var QR=function(){if(ns)return ns;const t=[];return ns=XR().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,s,i,o,a,c,l,u,h,d){const f=new JR;f.generatedLine=r+1,f.generatedColumn=s,i&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,h&&(f.name=d)),t[t.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,s)=>{t.push(r);try{s()}finally{t.pop()}}})).then(null,n=>{throw ns=null,n}),ns};const I=Zr,Ga=Wf,Ri=Ba.ArraySet,ZR=Vf,tv=QR,ja=Symbol("smcInternal");class ct{constructor(t,n){return t==ja?Promise.resolve(this):nv(t,n)}static initialize(t){ZR.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return rv(t,n)}static async with(t,n,r){const s=await new ct(t,n);try{return await r(s)}finally{s.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}ct.prototype._version=3,ct.GENERATED_ORDER=1,ct.ORIGINAL_ORDER=2,ct.GREATEST_LOWER_BOUND=1,ct.LEAST_UPPER_BOUND=2;class rs extends ct{constructor(t,n){return super(ja).then(r=>{let s=t;typeof t=="string"&&(s=I.parseSourceMapInput(t));const i=I.getArg(s,"version");let o=I.getArg(s,"sources");const a=I.getArg(s,"names",[]);let c=I.getArg(s,"sourceRoot",null);const l=I.getArg(s,"sourcesContent",null),u=I.getArg(s,"mappings"),h=I.getArg(s,"file",null);if(i!=r._version)throw new Error("Unsupported version: "+i);return c&&(c=I.normalize(c)),o=o.map(String).map(I.normalize).map(function(d){return c&&I.isAbsolute(c)&&I.isAbsolute(d)?I.relative(c,d):d}),r._names=Ri.fromArray(a.map(String),!0),r._sources=Ri.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return I.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=h,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,tv().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=I.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new rs(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,s=this._wasm.exports.allocate_mappings(r),i=new Uint8Array(this._wasm.exports.memory.buffer,s,r);for(let a=0;a<r;a++)i[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(s);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const s=n||null,i=r||ct.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=I.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(s,a)},()=>{switch(i){case ct.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case ct.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=I.getArg(t,"source");const r=I.getArg(t,"line"),s=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(s<0)throw new Error("Column numbers must be >= 0");const i=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),i.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,s)}),i}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:I.getArg(t,"line"),generatedColumn:I.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=I.getArg(t,"bias",ct.GREATEST_LOWER_BOUND);r==null&&(r=ct.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(i=>s=i,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),s&&s.generatedLine===n.generatedLine){let i=I.getArg(s,"source",null);i!==null&&(i=this._sources.at(i),i=I.computeSourceURL(this.sourceRoot,i,this._sourceMapURL));let o=I.getArg(s,"name",null);return o!==null&&(o=this._names.at(o)),{source:i,line:I.getArg(s,"originalLine",null),column:I.getArg(s,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let s=t;this.sourceRoot!=null&&(s=I.relative(this.sourceRoot,s));let i;if(this.sourceRoot!=null&&(i=I.urlParse(this.sourceRoot))){const o=s.replace(/^file:\/\//,"");if(i.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!i.path||i.path=="/")&&this._sources.has("/"+s))return this.sourcesContent[this._sources.indexOf("/"+s)]}if(n)return null;throw new Error('"'+s+'" is not in the SourceMap.')}generatedPositionFor(t){let n=I.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:I.getArg(t,"line"),originalColumn:I.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let s=I.getArg(t,"bias",ct.GREATEST_LOWER_BOUND);s==null&&(s=ct.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(o=>i=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,s)}),i&&i.source===r.source){let o=i.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:I.getArg(i,"generatedLine",null),column:I.getArg(i,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}rs.prototype.consumer=ct;class ev extends ct{constructor(t,n){return super(ja).then(r=>{let s=t;typeof t=="string"&&(s=I.parseSourceMapInput(t));const i=I.getArg(s,"version"),o=I.getArg(s,"sections");if(i!=r._version)throw new Error("Unsupported version: "+i);r._sources=new Ri,r._names=new Ri,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=I.getArg(c,"offset"),u=I.getArg(l,"line"),h=I.getArg(l,"column");if(u<a.line||u===a.line&&h<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new ct(I.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:h+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(I.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(I.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:I.getArg(t,"line"),generatedColumn:I.getArg(t,"column")},r=Ga.search(n,this._sections,function(i,o){const a=i.generatedLine-o.generatedOffset.generatedLine;return a||i.generatedColumn-o.generatedOffset.generatedColumn}),s=this._sections[r];return s?s.consumer.originalPositionFor({line:n.generatedLine-(s.generatedOffset.generatedLine-1),column:n.generatedColumn-(s.generatedOffset.generatedLine===n.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const i=this._sections[r].consumer.sourceContentFor(t,!0);if(i)return i}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(I.getArg(t,"source"))===-1)continue;const s=r.consumer.generatedPositionFor(t);if(s)return{line:s.line+(r.generatedOffset.generatedLine-1),column:s.column+(r.generatedOffset.generatedLine===s.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],s=this.__originalMappingsUnsorted=[];for(let i=0;i<this._sections.length;i++){const o=this._sections[i],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=I.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let h=null;l.name&&(this._names.add(l.name),h=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:h};r.push(d),typeof d.originalLine=="number"&&s.push(d)}}}eachMapping(t,n,r){const s=n||null,i=r||ct.GENERATED_ORDER;let o;switch(i){case ct.GENERATED_ORDER:o=this._generatedMappings;break;case ct.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=I.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,s)}_findMapping(t,n,r,s,i,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[s]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[s]);return Ga.search(t,n,i,o)}allGeneratedPositionsFor(t){const n=I.getArg(t,"line"),r={source:I.getArg(t,"source"),originalLine:n,originalColumn:I.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const s=[];let i=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",I.compareByOriginalPositions,Ga.LEAST_UPPER_BOUND);if(i>=0){let o=this._originalMappings[i];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:I.getArg(o,"generatedLine",null),column:I.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),s.push({line:I.getArg(o,"generatedLine",null),column:I.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++i]}}}return s}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function nv(e,t){let n=e;typeof e=="string"&&(n=I.parseSourceMapInput(e));const r=n.sections!=null?new ev(n,t):new rs(n,t);return Promise.resolve(r)}function rv(e,t){return rs.fromSourceMap(e,t)}var zf={};const sv=Uf.SourceMapGenerator,vi=Zr,iv=/(\r?\n)/,ov=10,or="$$$isSourceNode$$$";let av=class qc{constructor(t,n,r,s,i){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=i??null,this[or]=!0,s!=null&&this.add(s)}static fromStringWithSourceMap(t,n,r){const s=new qc,i=t.split(iv);let o=0;const a=function(){const f=_(),m=_()||"";return f+m;function _(){return o<i.length?i[o++]:void 0}};let c=1,l=0,u=null,h;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)d(u,a()),c++,l=0;else{h=i[o]||"";const m=h.substr(0,f.generatedColumn-l);i[o]=h.substr(f.generatedColumn-l),l=f.generatedColumn,d(u,m),u=f;return}for(;c<f.generatedLine;)s.add(a()),c++;l<f.generatedColumn&&(h=i[o]||"",s.add(h.substr(0,f.generatedColumn)),i[o]=h.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<i.length&&(u&&d(u,a()),s.add(i.splice(o).join(""))),n.sources.forEach(function(f){const m=n.sourceContentFor(f);m!=null&&(r!=null&&(f=vi.join(r,f)),s.setSourceContent(f,m))}),s;function d(f,m){if(f===null||f.source===void 0)s.add(m);else{const _=r?vi.join(r,f.source):f.source;s.add(new qc(f.originalLine,f.originalColumn,_,m,f.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[or]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[or]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,s=this.children.length;r<s;r++)n=this.children[r],n[or]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const s=this.children.length;if(s>0){for(n=[],r=0;r<s-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[or]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[vi.toSetString(t)]=n}walkSourceContents(t){for(let r=0,s=this.children.length;r<s;r++)this.children[r][or]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,s=n.length;r<s;r++)t(vi.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new sv(t);let s=!1,i=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((i!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),i=u.source,o=u.line,a=u.column,c=u.name,s=!0):s&&(r.addMapping({generated:{line:n.line,column:n.column}}),i=null,s=!1);for(let h=0,d=l.length;h<d;h++)l.charCodeAt(h)===ov?(n.line++,n.column=0,h+1===d?(i=null,s=!1):s&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};zf.SourceNode=av;var cv=zf.SourceNode,Yf={exports:{}},B={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ss=Symbol.for("react.element"),lv=Symbol.for("react.portal"),uv=Symbol.for("react.fragment"),hv=Symbol.for("react.strict_mode"),fv=Symbol.for("react.profiler"),dv=Symbol.for("react.provider"),pv=Symbol.for("react.context"),gv=Symbol.for("react.forward_ref"),mv=Symbol.for("react.suspense"),Ev=Symbol.for("react.memo"),_v=Symbol.for("react.lazy"),qf=Symbol.iterator;function yv(e){return e===null||typeof e!="object"?null:(e=qf&&e[qf]||e["@@iterator"],typeof e=="function"?e:null)}var Xf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Jf=Object.assign,Qf={};function ar(e,t,n){this.props=e,this.context=t,this.refs=Qf,this.updater=n||Xf}ar.prototype.isReactComponent={},ar.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},ar.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Zf(){}Zf.prototype=ar.prototype;function Ka(e,t,n){this.props=e,this.context=t,this.refs=Qf,this.updater=n||Xf}var Wa=Ka.prototype=new Zf;Wa.constructor=Ka,Jf(Wa,ar.prototype),Wa.isPureReactComponent=!0;var td=Array.isArray,ed=Object.prototype.hasOwnProperty,Ha={current:null},nd={key:!0,ref:!0,__self:!0,__source:!0};function rd(e,t,n){var r,s={},i=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)ed.call(t,r)&&!nd.hasOwnProperty(r)&&(s[r]=t[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:ss,type:e,key:i,ref:o,props:s,_owner:Ha.current}}function Tv(e,t){return{$$typeof:ss,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Va(e){return typeof e=="object"&&e!==null&&e.$$typeof===ss}function Sv(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var sd=/\/+/g;function za(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Sv(""+e.key):t.toString(36)}function Ni(e,t,n,r,s){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case ss:case lv:o=!0}}if(o)return o=e,s=s(o),e=r===""?"."+za(o,0):r,td(s)?(n="",e!=null&&(n=e.replace(sd,"$&/")+"/"),Ni(s,t,n,"",function(l){return l})):s!=null&&(Va(s)&&(s=Tv(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(sd,"$&/")+"/")+e)),t.push(s)),1;if(o=0,r=r===""?".":r+":",td(e))for(var a=0;a<e.length;a++){i=e[a];var c=r+za(i,a);o+=Ni(i,t,n,c,s)}else if(c=yv(e),typeof c=="function")for(e=c.call(e),a=0;!(i=e.next()).done;)i=i.value,c=r+za(i,a++),o+=Ni(i,t,n,c,s);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function bi(e,t,n){if(e==null)return e;var r=[],s=0;return Ni(e,r,"","",function(i){return t.call(n,i,s++)}),r}function Av(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var xt={current:null},Li={transition:null},wv={ReactCurrentDispatcher:xt,ReactCurrentBatchConfig:Li,ReactCurrentOwner:Ha};function id(){throw Error("act(...) is not supported in production builds of React.")}B.Children={map:bi,forEach:function(e,t,n){bi(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return bi(e,function(){t++}),t},toArray:function(e){return bi(e,function(t){return t})||[]},only:function(e){if(!Va(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},B.Component=ar,B.Fragment=uv,B.Profiler=fv,B.PureComponent=Ka,B.StrictMode=hv,B.Suspense=mv,B.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wv,B.act=id,B.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Jf({},e.props),s=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=Ha.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(c in t)ed.call(t,c)&&!nd.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&a!==void 0?a[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:ss,type:e.type,key:s,ref:i,props:r,_owner:o}},B.createContext=function(e){return e={$$typeof:pv,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:dv,_context:e},e.Consumer=e},B.createElement=rd,B.createFactory=function(e){var t=rd.bind(null,e);return t.type=e,t},B.createRef=function(){return{current:null}},B.forwardRef=function(e){return{$$typeof:gv,render:e}},B.isValidElement=Va,B.lazy=function(e){return{$$typeof:_v,_payload:{_status:-1,_result:e},_init:Av}},B.memo=function(e,t){return{$$typeof:Ev,type:e,compare:t===void 0?null:t}},B.startTransition=function(e){var t=Li.transition;Li.transition={};try{e()}finally{Li.transition=t}},B.unstable_act=id,B.useCallback=function(e,t){return xt.current.useCallback(e,t)},B.useContext=function(e){return xt.current.useContext(e)},B.useDebugValue=function(){},B.useDeferredValue=function(e){return xt.current.useDeferredValue(e)},B.useEffect=function(e,t){return xt.current.useEffect(e,t)},B.useId=function(){return xt.current.useId()},B.useImperativeHandle=function(e,t,n){return xt.current.useImperativeHandle(e,t,n)},B.useInsertionEffect=function(e,t){return xt.current.useInsertionEffect(e,t)},B.useLayoutEffect=function(e,t){return xt.current.useLayoutEffect(e,t)},B.useMemo=function(e,t){return xt.current.useMemo(e,t)},B.useReducer=function(e,t,n){return xt.current.useReducer(e,t,n)},B.useRef=function(e){return xt.current.useRef(e)},B.useState=function(e){return xt.current.useState(e)},B.useSyncExternalStore=function(e,t,n){return xt.current.useSyncExternalStore(e,t,n)},B.useTransition=function(){return xt.current.useTransition()},B.version="18.3.1",Yf.exports=B;var Rv=Yf.exports;const vv=yo(32,126).map(e=>String.fromCharCode(e)),Nv=U({name:"Whitespace",pattern:/ +/}),bv=U({name:"WhitespaceSkipped",pattern:/ +/,group:yt.SKIPPED}),od=U({name:"StringLiteral",pattern:/[^ $]+/,start_chars_hint:vv}),ad=U({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ya=U({name:"MaybeFlag",pattern:/\$[^ $]+/}),cd=U({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),ld=U({name:"ContinueLine",pattern:/\\/});function ud(e,t=""){return U({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const hd=[["blue"],["green"],["cyan"],["red"],["purple"],["yellow"],["white"],["dkblue"],["dkgreen"],["dkcyan"],["dkred"],["dkpurple"],["dkyellow|brown","brown"],["dkwhite|ltgray|ltgrey|gray|grey","gray"],["dkgray|dkgrey|ltblack","dkgray"],["black"],["clear"]],fd=hd.map(([e,t])=>ud(`\\$(${e})`,t||e)),dd=[...hd.map(([e,t])=>ud(`\\$on(${e})`,`on${t||e}`))],Lv=[Nv,ld,...fd,...dd,ad,od,cd,Ya],Cv=new yt(Lv,{skipValidations:!be,ensureOptimizations:be}),Iv=new yt([bv,ld,...fd,...dd,ad,od,cd,Ya],{skipValidations:!be,ensureOptimizations:be});function Ov(e,t=!1){return t?Iv.tokenize(e):Cv.tokenize(e)}function kv(e,t,n,r){return{measureonly:!1,resetCheck:!0,x:0,y:0,isEven:!0,resetColor:n,resetBg:r,activeColor:n,activeBg:r,width:e,height:t,leftEdge:void 0,rightEdge:void 0,bottomEdge:void 0,char:[],color:[],bg:[]}}Rv.createContext(kv(1,1,15,1));let Mv=0,pd=0;const gd=be,xv=["Command","lines"];class Uv extends oR{constructor(){super(Rf,{traceInitPerf:be,skipValidations:!be,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});P(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));P(this,"line",this.RULED("line",()=>{this.OPTION(()=>this.SUBRULE(this.stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Yr))}));P(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stat)},{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.label)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));P(this,"stat",this.RULED("stat",()=>{this.CONSUME(Sa)}));P(this,"text",this.RULED("text",()=>{this.CONSUME(zh)}));P(this,"label",this.RULED("label",()=>{this.CONSUME(qh)}));P(this,"comment",this.RULED("comment",()=>{this.CONSUME(Yh)}));P(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>{this.CONSUME(de),this.AT_LEAST_ONE1(()=>this.SUBRULE1(this.command))}},{ALT:()=>{this.AT_LEAST_ONE2(()=>this.SUBRULE2(this.command))}}])}));P(this,"command",this.RULED("command",()=>{this.OR([{ALT:()=>this.SUBRULE(this.flat_cmd)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));P(this,"flat_cmd",this.RULED("flat_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.hyperlink)},{ALT:()=>this.SUBRULE(this.Short_go)},{ALT:()=>this.SUBRULE(this.Short_try)},{ALT:()=>this.SUBRULE(this.Command_play)}])}));P(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.Command_if)},{ALT:()=>this.SUBRULE(this.Command_read)},{ALT:()=>this.SUBRULE(this.Command_while)},{ALT:()=>this.SUBRULE(this.Command_repeat)},{ALT:()=>this.SUBRULE(this.Command_break)},{ALT:()=>this.SUBRULE(this.Command_continue)}])}));P(this,"hyperlink",this.RULED("hyperlink",()=>{this.CONSUME(Xh),this.SUBRULE(this.words),this.CONSUME(Jh)}));P(this,"Short_go",this.RULED("Short_go",()=>{this.CONSUME(ba),this.SUBRULE(this.words)}));P(this,"Short_try",this.RULED("Short_try",()=>{this.CONSUME(hf),this.SUBRULE(this.words)}));P(this,"Command_play",this.RULED("Command_play",()=>{this.CONSUME(pf)}));P(this,"do_line",this.RULED("do_line",()=>{this.OPTION(()=>this.SUBRULE(this.do_stmt)),this.AT_LEAST_ONE(()=>this.CONSUME(Yr))}));P(this,"do_stmt",this.RULED("do_stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.text)},{ALT:()=>this.SUBRULE(this.comment)},{ALT:()=>this.SUBRULE(this.commands)}])}));P(this,"Command_if",this.RULED("Command_if",()=>{this.CONSUME(La),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else_if",this.RULED("Command_else_if",()=>{this.CONSUME(de),this.CONSUME(Ca),this.CONSUME(La),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.OR2([{GATE:this.BACKTRACK(this.Command_else_if),ALT:()=>this.SUBRULE(this.Command_else_if)},{GATE:this.BACKTRACK(this.Command_else),ALT:()=>this.SUBRULE(this.Command_else)},{GATE:this.BACKTRACK(this.Command_endif),ALT:()=>this.SUBRULE(this.Command_endif)}])}}])})}));P(this,"Command_else",this.RULED("Command_else",()=>{this.CONSUME(de),this.CONSUME(Ca),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.SUBRULE(this.Command_endif)}}])})}));P(this,"Command_endif",this.RULED("Command_endif",()=>{this.CONSUME(de),this.CONSUME(gf)}));P(this,"Command_while",this.RULED("Command_while",()=>{this.CONSUME(de),this.CONSUME(mf),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(de),this.CONSUME4(Ef)}}])})}));P(this,"Command_repeat",this.RULED("Command_repeat",()=>{this.CONSUME(de),this.CONSUME(_f),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(de),this.CONSUME4(yf)}}])})}));P(this,"Command_read",this.RULED("Command_read",()=>{this.CONSUME(de),this.CONSUME(Ia),this.SUBRULE(this.words),this.OPTION(()=>{this.OR([{ALT:()=>this.SUBRULE(this.command)},{ALT:()=>{this.CONSUME(Mn),this.AT_LEAST_ONE(()=>this.SUBRULE(this.do_line)),this.CONSUME4(de),this.CONSUME4(Tf)}}])})}));P(this,"Command_break",this.RULED("Command_break",()=>{this.CONSUME(Sf)}));P(this,"Command_continue",this.RULED("Command_continue",()=>{this.CONSUME(Af)}));P(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Aa),this.SUBRULE2(this.and_test)})}));P(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(Ra),this.SUBRULE2(this.not_test)})}));P(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(wa),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));P(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));P(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(tf)},{ALT:()=>this.CONSUME(ef)},{ALT:()=>this.CONSUME(nf)},{ALT:()=>this.CONSUME(rf)},{ALT:()=>this.CONSUME(sf)},{ALT:()=>this.CONSUME(of)}])}));P(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Aa),this.SUBRULE2(this.and_test_value)})}));P(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(Ra),this.SUBRULE2(this.not_test_value)})}));P(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(wa),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));P(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));P(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(va)},{ALT:()=>this.CONSUME(Na)}]),this.SUBRULE(this.term)}));P(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));P(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(cf)},{ALT:()=>this.CONSUME(ba)},{ALT:()=>this.CONSUME(lf)},{ALT:()=>this.CONSUME(uf)}]),this.SUBRULE(this.factor)}));P(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(va)},{ALT:()=>this.CONSUME(Na)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));P(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(af),this.SUBRULE(this.factor)})}));P(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));P(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(Qh)},{ALT:()=>this.CONSUME(Kt)},{ALT:()=>this.CONSUME(Zh)},{ALT:()=>this.CONSUME(Ia)},{ALT:()=>{this.CONSUME(ff),this.SUBRULE(this.expr),this.CONSUME(df)}}])}));this.performSelfAnalysis()}PEEK(n,r,...s){console.info(n,s.map(i=>[i.image,i.tokenType]),r)}RULED(n,r,s){const i=xv.some(o=>n.includes(o));return this.RULE(n,()=>{const o=Mv++,a=pd++,c=a.toString().padStart(3),l=" ".repeat(a),u=i?"font-weight: bold;":"";if(gd&&!this.RECORDING_PHASE){const d=[this.LA(0),this.LA(1),this.LA(2)].map(f=>[`[${f.tokenType.name}]`,f.image.replaceAll(`
`,"\\n")]).flat();console.info(`${c}%c${l}> ${n} ${o} ${d.join(" ")}`,u)}r(),gd&&!this.RECORDING_PHASE&&console.info(`${c}%c${l}< ${n} ${o}`,u),pd--},s)}}const is=new Uv,Pv=is.getBaseCstVisitorConstructor();var q=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.TEXT=1]="TEXT",e[e.LABEL=2]="LABEL",e[e.HYPERLINK=3]="HYPERLINK",e[e.STAT=4]="STAT",e[e.MOVE=5]="MOVE",e[e.COMMAND=6]="COMMAND",e[e.LITERAL=7]="LITERAL",e[e.IF=8]="IF",e[e.ELSE_IF=9]="ELSE_IF",e[e.ELSE=10]="ELSE",e[e.WHILE=11]="WHILE",e[e.BREAK=12]="BREAK",e[e.CONTINUE=13]="CONTINUE",e[e.REPEAT=14]="REPEAT",e[e.READ=15]="READ",e[e.OR=16]="OR",e[e.AND=17]="AND",e[e.NOT=18]="NOT",e[e.COMPARE=19]="COMPARE",e[e.OPERATOR=20]="OPERATOR",e[e.OPERATOR_ITEM=21]="OPERATOR_ITEM",e[e.EXPR=22]="EXPR",e))(q||{}),xn=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(xn||{}),Ce=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(Ce||{}),Ci=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(Ci||{});function uL(e){return e}function tt(e,t){return((t==null?void 0:t.map(n=>e.visit(n)).filter(n=>n))||[]).flat()}function qe(e){return e.image}function md(e,t){return $(e,{type:7,literal:1,value:t})}function Dv(e){return!!(e!=null&&e.tokenType)}function Fv(e){const t=Object.values(e).flat().filter(n=>!!n).map(n=>n&&Dv(n)?{startLine:n.startLine,startColumn:n.startColumn,startOffset:n.startOffset,endLine:n.endLine,endColumn:n.endColumn,endOffset:n.endOffset}:n!=null&&n.location?{...n.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(n=>n.startLine!==0&&n.endLine!==0);return{startLine:Math.min(...t.map(n=>n.startLine||1)),startColumn:Math.min(...t.map(n=>n.startColumn||1)),startOffset:Math.min(...t.map(n=>n.startOffset||1)),endLine:Math.max(...t.map(n=>n.endLine||1)),endColumn:Math.max(...t.map(n=>n.endColumn||1)),endOffset:Math.max(...t.map(n=>n.endOffset||1))}}function $(e,t){return{...t,...Fv(e)}}class $v extends Pv{constructor(){super(),be&&this.validateVisitor()}program(t){return $(t,{type:0,lines:tt(this,t.line)})}line(t){if(t.stmt)return this.visit(t.stmt)}stmt(t){if(t.stat)return this.visit(t.stat);if(t.text)return this.visit(t.text);if(t.label)return this.visit(t.label);if(t.comment)return this.visit(t.comment);if(t.commands)return this.visit(t.commands)}stat(){}text(t){if(t.Text)return $(t,{type:1,value:qe(t.Text[0])})}label(t){var n;return $(t,{type:2,active:!0,name:qe(((n=t.Label)==null?void 0:n[0])??":").slice(1).trim()})}comment(t){return $(t,{type:2,active:!1,name:qe(t.Comment[0]).slice(1).trim()})}commands(t){return tt(this,t.command)}command(t){if(t.flat_cmd)return this.visit(t.flat_cmd);if(t.structured_cmd)return this.visit(t.structured_cmd)}flat_cmd(t){if(t.words)return $(t,{type:6,words:tt(this,t.words).flat()});if(t.hyperlink)return this.visit(t.hyperlink);if(t.Short_go)return this.visit(t.Short_go);if(t.Short_try)return this.visit(t.Short_try);if(t.Command_play)return this.visit(t.Command_play)}structured_cmd(t){if(t.Command_if)return this.visit(t.Command_if);if(t.Command_read)return this.visit(t.Command_read);if(t.Command_while)return this.visit(t.Command_while);if(t.Command_repeat)return this.visit(t.Command_repeat);if(t.Command_break)return this.visit(t.Command_break);if(t.Command_continue)return this.visit(t.Command_continue)}hyperlink(t){var n;return $(t,{type:3,link:tt(this,t.words).flat(),text:qe(((n=t.HyperLinkText)==null?void 0:n[0])??";").slice(1)})}Short_go(t){if(t.Divide)return $(t,{type:5,wait:!0,words:tt(this,t.words).flat()})}Short_try(t){if(t.Query)return $(t,{type:5,wait:!1,words:tt(this,t.words).flat()})}Command_play(t){if(t.play)return $(t,{type:6,words:[md(t,"play"),md(t,qe(t.play[0]).replace("play","").trim())]})}do_line(t){return this.visit(t.do_stmt)}do_stmt(t){if(t.text)return this.visit(t.text);if(t.comment)return this.visit(t.comment);if(t.commands)return this.visit(t.commands)}Command_if(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat(),s=[this.visit(t.Command_else_if),this.visit(t.Command_else)].flat();return $(t,{type:8,method:"if",words:n.filter(E),lines:r.filter(E),branches:s.filter(E)})}Command_else_if(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat(),s=tt(this,t.Command_else_if).flat();return[$(t,{type:9,method:"if",words:n.filter(E),lines:r.filter(E)}),...s.filter(E),this.visit(t.Command_else)]}Command_else(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat();return $(t,{type:10,method:"if",words:n.filter(E),lines:r.filter(E)})}Command_endif(){}Command_while(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat();return $(t,{type:11,words:n.filter(E),lines:r.filter(E)})}Command_repeat(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat();return $(t,{type:14,words:n.filter(E),lines:r.filter(E)})}Command_read(t){const n=tt(this,t.words).flat(),r=[this.visit(t.command),...tt(this,t.do_line)].flat();return $(t,{type:15,words:n.filter(E),lines:r.filter(E)})}Command_break(t){return $(t,{type:12})}Command_continue(t){return $(t,{type:13})}expr(t){return t.and_test.length===1?this.visit(t.and_test):$(t,{type:16,items:this.visit(t.and_test)})}and_test(t){return t.not_test.length===1?this.visit(t.not_test):$(t,{type:17,items:this.visit(t.not_test)})}not_test(t){if(t.comparison)return this.visit(t.comparison);if(t.not_test)return $(t,{type:18,items:this.visit(t.not_test)})}comparison(t){return t.arith_expr.length===1?this.visit(t.arith_expr):$(t,{type:19,lhs:this.visit(t.arith_expr[0]),compare:this.visit(t.comp_op),rhs:this.visit(t.arith_expr[1])})}comp_op(t){if(t.is||t.IsEq)return 0;if(t.IsNotEq)return 1;if(t.IsLessThan)return 2;if(t.IsGreaterThan)return 3;if(t.IsLessThanOrEqual)return 4;if(t.IsGreaterThanOrEqual)return 5}expr_value(t){return t.and_test_value.length===1?this.visit(t.and_test_value):$(t,{type:16,items:this.visit(t.and_test_value)})}and_test_value(t){return t.not_test_value.length===1?this.visit(t.not_test_value):$(t,{type:17,items:this.visit(t.not_test_value)})}not_test_value(t){if(t.arith_expr)return this.visit(t.arith_expr);if(t.not_test)return $(t,{type:18,items:this.visit(t.not_test)})}arith_expr(t){const n=this.visit(t.term);return t.arith_expr_item?$(t,{type:20,lhs:n,items:tt(this,t.arith_expr_item)}):n}arith_expr_item(t){return $(t,{type:21,operator:t.Plus?1:2,rhs:this.visit(t.term)})}term(t){return t.term_item?$(t,{type:20,lhs:this.visit(t.factor),items:tt(this,t.term_item)}):this.visit(t.factor)}term_item(t){let n=0;return t.Multiply&&(n=4),t.Divide&&(n=5),t.ModDivide&&(n=6),t.FloorDivide&&(n=7),$(t,{type:21,operator:n,rhs:this.visit(t.factor)})}factor(t){if(t.power)return this.visit(t.power);let n=0;return t.Plus&&(n=8),t.Minus&&(n=9),$(t,{type:20,lhs:void 0,items:[$(t,{type:21,operator:n,rhs:this.visit(t.factor)})]})}power(t){const n=this.visit(t.token);return t.factor?$(t,{type:20,lhs:n,items:[$(t,{type:21,operator:3,rhs:this.visit(t.factor)})]}):n}words(t){return tt(this,t.expr)}token(t){if(t.StringLiteralDouble){const n=qe(t.StringLiteralDouble[0]);return $(t,{type:7,literal:2,value:n.substring(1,n.length-1)})}if(t.StringLiteral)return $(t,{type:7,literal:1,value:qe(t.StringLiteral[0])});if(t.NumberLiteral)return $(t,{type:7,literal:0,value:parseFloat(qe(t.NumberLiteral[0]))});if(t.read)return $(t,{type:7,literal:1,value:qe(t.read[0])});if(t.LParen)return $(t,{type:22,words:tt(this,t.expr).flat()})}}const Bv=new $v,$t={internal:0,labels:{},labelIndex:0},os="if (api.hm()) { continue zss; }",qa=`if (api.sy()) { yield 1; ${os} };`,Ii=`yield 1; ${os}`,Oi="zss.js";function lt(e,t){return new cv(e.startLine||1,e.startColumn||1,Oi,t)}function Xa(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function Gv(e){return`'${Xa(e)}'`}function ki(e){if(e.startsWith('"'))return ki(e.substring(1,e.length-1));const t=Ov(e);return t.errors.length?e:`'${t.tokens.map(r=>r.tokenType===Ya?`', api.group('${Xa(r.image.substring(1))}'), '`:Xa(r.image)).join("")}'`}function Ie(e){return e.filter(t=>t!==void 0).map(H)}function Ed(e){return lt(e,"")}function jv(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function et(e,t,n){return lt(e,[`api.${t}(`,...jv(n,", "),")"])}function Kv(e){if(e.type===q.COMPARE)switch(e.compare){case xn.IS_EQ:return et(e,"isEq",[H(e.lhs),H(e.rhs)]);case xn.IS_NOT_EQ:return et(e,"isNotEq",[H(e.lhs),H(e.rhs)]);case xn.IS_LESS_THAN:return et(e,"isLessThan",[H(e.lhs),H(e.rhs)]);case xn.IS_GREATER_THAN:return et(e,"isGreaterThan",[H(e.lhs),H(e.rhs)]);case xn.IS_LESS_THAN_OR_EQ:return et(e,"isLessThanOrEq",[H(e.lhs),H(e.rhs)]);case xn.IS_GREATER_THAN_OR_EQ:return et(e,"isGreaterThanOrEq",[H(e.lhs),H(e.rhs)])}return lt(e,"")}function Un(e,t,n,r){return t.prepend(`api.${n}(`),t.add([", ",H(r),")"])}function _d(e,t,n,r){return t.prepend(`api.${n}(`),t.add([H(r),")"])}function Wv(e,t){if(e.type===q.OPERATOR_ITEM)switch(e.operator){case Ce.PLUS:return Un(e,t,"opPlus",e.rhs);case Ce.MINUS:return Un(e,t,"opMinus",e.rhs);case Ce.POWER:return Un(e,t,"opPower",e.rhs);case Ce.MULTIPLY:return Un(e,t,"opMultiply",e.rhs);case Ce.DIVIDE:return Un(e,t,"opDivide",e.rhs);case Ce.MOD_DIVIDE:return Un(e,t,"opModDivide",e.rhs);case Ce.FLOOR_DIVIDE:return Un(e,t,"opFloorDivide",e.rhs);case Ce.UNI_PLUS:return _d(e,t,"opUniPlus",e.rhs);case Ce.UNI_MINUS:return _d(e,t,"opUniMinus",e.rhs)}return lt(e,"")}function Hv(e){if(e.type===q.OPERATOR){const t=e.lhs?H(e.lhs):lt(e,"");return e.items.forEach(n=>Wv(n,t)),t}return lt(e,"")}function H(e){switch(e.type){case q.PROGRAM:return lt(e,[`try { // first-line
`,`zss: while (true) {
`,`switch (api.getcase()) {
`,`default:
`,`case 1: 
`,...e.lines.map(t=>[H(t),`
`]).flat(),`}
`,`api.endofprogram();
`,`while(true) { ${Ii} }
`,`}
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${Oi}`]);case q.LITERAL:switch(e.literal){case Ci.NUMBER:return lt(e,`${e.value}`);case Ci.STRING:return lt(e,Gv(e.value));case Ci.TEMPLATE:return lt(e,ki(e.value))}return Ed(e);case q.TEXT:return et(e,"text",[ki(e.value)]);case q.STAT:return et(e,"stat",Ie(e.words));case q.LABEL:{const t=$t.labelIndex++;return $t.labels[e.name]||($t.labels[e.name]=[]),$t.labels[e.name].push(e.active?t:-t),lt(e,`case ${t}: // ${e.name}`)}case q.HYPERLINK:return et(e,"hyperlink",[ki(e.text),...Ie(e.link)]);case q.MOVE:return lt(e,["while (",et(e,"move",[e.wait?"true":"false",...Ie(e.words)]),`) { ${Ii} };
         ${qa} ${os}`]);case q.COMMAND:return lt(e,["while (",et(e,"command",Ie(e.words)),`) { ${Ii} };
         ${qa} ${os}`]);case q.IF:{const t=lt(e,["if (",et(e,`${e.method}`,Ie(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),e.branches&&e.branches.forEach(n=>t.add(H(n))),t.add("}"),t}case q.ELSE_IF:{const t=lt(e,["} else if (",et(e,e.method,Ie(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t}case q.ELSE:{const t=lt(e,`} else {
`);return e.words.length&&t.add(["while (",et(e,"command",Ie(e.words)),`) { ${Ii} };`]),e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t}case q.WHILE:{const t=lt(e,["while (",et(e,"if",Ie(e.words)),`) {
`]);return e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t.add("}"),t}case q.REPEAT:{const t=lt(e,[et(e,"repeatstart",[`${$t.internal}`,...Ie(e.words)]),`;
while (`,et(e,"repeat",[`${$t.internal}`]),`) {
         ${qa} ${os}
`]);return $t.internal+=1,e.lines&&e.lines.forEach(n=>t.add([H(n),`
`])),t.add("}"),t}case q.READ:{const[t,...n]=e.words,r=lt(e,[et(e,"readStart",[`${$t.internal}`,H(t)]),`;
while (`,et(e,"read",[`${$t.internal}`,...Ie(n)]),`) {
`]);return $t.internal+=1,e.lines&&e.lines.forEach(s=>r.add([H(s),`
`])),r.add("}"),r}case q.BREAK:return lt(e,`break;
`);case q.CONTINUE:return lt(e,`continue;
`);case q.OR:return et(e,"or",e.items.map(H));case q.AND:return et(e,"and",e.items.map(H));case q.NOT:return et(e,"not",e.items.map(H));case q.COMPARE:return Kv(e);case q.OPERATOR:return Hv(e);case q.EXPR:return et(e,"expr",e.words.map(H));default:return console.error("<unsupported node>",e),Ed(e)}}function Vv(e){return $t.internal=0,$t.labels={restart:[1]},$t.labelIndex=2,{...H(e).toStringWithSourceMap({file:`${Oi}.map`}),...$t}}const zv=64;function Yv(e){return Array.isArray(e)?e.length>0?1:0:e??0}function Xe(e){return`${e??""}`}function qv(e,t){var b;const n=tm(t.labels??{});let r,s="",i,o=0;const a={},c={},l={};let u=!1,h=_m,d=0,f=0,m=!1;const _=[];let w={};function R(y){if(w[y]===void 0)for(let g=0;g<_.length;++g){const p=_[g].getcommand(y);p&&(w[y]=p)}return w[y]}function A(y,g){const p=R(y);if(!p)throw new Error(`unknown firmware command ${y}`);return p(T,g)}const T={id(){return e},senderid(y=T.id()){return`vm${y??T.id()}`},install(y){E(y)&&(w={},_.push(y))},set(y,g){const p=y.toLowerCase();for(let S=0;S<_.length;++S){const[v]=_[S].set(T,p,g);if(v)return g}return g},get(y){const g=y.toLowerCase();for(let p=0;p<_.length;++p){const[S,v]=_[p].get(T,g);if(S)return v}},cycle(y){h=y},timestamp(){return f},tick(y){f=y;for(let p=0;p<_.length;++p)_[p].shouldtick(T);if(!T.shouldtick())return!1;const g=d%h===0;if(++d,!g)return!1;o=0,u=!1;for(let p=0;p<_.length;++p)_[p].tick(T);try{const p=r==null?void 0:r.next();p!=null&&p.done&&(console.error("we crashed?",t.source),m=!0)}catch(p){console.error("we crashed?",p),m=!0}for(let p=0;p<_.length;++p)_[p].tock(T);return!0},shouldtick(){return m===!1||T.hm()!==0},shouldhalt(){return o++>zv},hm(){var g;const y=(i==null?void 0:i.target)??"";return((g=n[y])==null?void 0:g.find(p=>p>0))??0},yield(){u=!0},sy(){return u||T.shouldhalt()},emit(y,g){nt.emit(y,T.senderid(),g)},send(y,g,p){nt.emit(`${T.senderid(y)}:${g}`,e,p)},lock(y){s=y},unlock(){s=""},message(y){switch(y.target){case"urlstate":{const[g,p]=y.data;T.set(g,p);break}default:if(s&&y.sender!==s)return;i=y;break}},zap(y){const g=n[y];if(g){const p=g.findIndex(S=>S>0);p>=0&&(g[p]*=-1)}},restore(y){const g=n[y];if(g)for(let p=0;p<g.length;p++)g[p]=Math.abs(g[p])},getcase(){if(i){const y=T.hm();return T.set("sender",i.sender),T.set("data",i.data),i.player&&T.set("player",i.player),i=void 0,u=!1,m=!1,y}return 0},endofprogram(){T.yield(),m=!0},stacktrace(y){const g=$R.parse(y),[p]=g.filter(S=>S.fileName===Oi);return{line:(p==null?void 0:p.lineNumber)??0,column:(p==null?void 0:p.columnNumber)??0}},text(y){return A("text",[y])},stat(...y){return A("stat",y)},hyperlink(...y){return A("hyperlink",y)},move(y,...g){const p=T.command("go",...g);return T.yield(),p&&y?1:0},command(...y){if(y.length===0)return 0;const[g,...p]=y,S=R(Xe(g));return S?S(T,p):A("send",[g,...p])},if(...y){const[g,p]=L(O(T,y),0,[N.ANY]),S=Yv(g);return S&&p<y.length&&T.command(...y.slice(p)),S},repeatstart(y,...g){const[p,S]=L(O(T,g),0,[N.NUMBER]);a[y]=p,c[y]=S<g.length?g.slice(S):void 0},repeat(y){const g=a[y]??0;a[y]=g-1;const p=g>0,S=c[y];return p&&S&&T.command(...S),p},readstart(y,g){if(!st(g))return;const p=T.get(g)??[];l[y]=Array.isArray(p)?p:[p]},read(y,...g){const p=l[y];if(Array.isArray(p)===!1)return!1;const S=p.shift();if(S===void 0)return!1;const v=g.map(Xe);switch(typeof S){case"number":case"string":v.forEach(K=>{T.set(K,S)});break;case"object":v.forEach(K=>{const ut=S[K];T.set(K,ut)});break}return!0},or(...y){let g=0;for(let p=0;p<y.length;){const[S,v]=L(O(T,y),0,[N.ANY]);if(g=S,g)break;p=v}return g},and(...y){let g=0;for(let p=0;p<y.length;){const[S,v]=L(O(T,y),0,[N.ANY]);if(g=S,!g)break;p=v}return g},not(...y){const[g]=L(O(T,y),0,[N.ANY]);return g?0:1},expr(...y){const[g]=L(O(T,y),0,[N.ANY]);return g},isEq(y,g){const[p]=L(O(T,[y]),0,[N.ANY]),[S]=L(O(T,[g]),0,[N.ANY]);return Zg(p,S)?1:0},isNotEq(y,g){const[p]=L(O(T,[y]),0,[N.ANY]),[S]=L(O(T,[g]),0,[N.ANY]);return p!==S?1:0},isLessThan(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return p<S?1:0},isGreaterThan(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return p>S?1:0},isLessThanOrEq(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return p<=S?1:0},isGreaterThanOrEq(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return p>=S?1:0},opPlus(y,g){const[p]=L(O(T,[y]),0,[N.ANY]),[S]=L(O(T,[g]),0,[N.ANY]);return p+S},opMinus(y,g){const[p]=L(O(T,[y]),0,[N.ANY]),[S]=L(O(T,[g]),0,[N.ANY]);return p-S},opPower(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return Math.pow(p,S)},opMultiply(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return p*S},opDivide(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return p/S},opModDivide(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return p%S},opFloorDivide(y,g){const[p]=L(O(T,[y]),0,[N.NUMBER]),[S]=L(O(T,[g]),0,[N.NUMBER]);return Math.floor(p/S)},opUniPlus(y){const[g]=L(O(T,[y]),0,[N.NUMBER]);return+g},opUniMinus(y){const[g]=L(O(T,[y]),0,[N.NUMBER]);return-g}};return r=(b=t.code)==null?void 0:b.call(t,T),T}function Ja(e){const t={},n={...e,getcommand(r){return t[r]},command(r,s){return t[r]=s,n}};return n}var yd={exports:{}};/*! Case - v1.6.2 - 2020-03-24
* Copyright (c) 2020 Nathan Bubna; Licensed MIT, GPL */(function(e){(function(){var t=function(f,m){return m=m||"",f.replace(/(^|-)/g,"$1\\u"+m).replace(/,/g,"\\u"+m)},n=t("20-26,28-2F,3A-40,5B-60,7B-7E,A0-BF,D7,F7","00"),r="a-z"+t("DF-F6,F8-FF","00"),s="A-Z"+t("C0-D6,D8-DE","00"),i="A|An|And|As|At|But|By|En|For|If|In|Of|On|Or|The|To|Vs?\\.?|Via",o=function(f,m,_,w){return f=f||n,m=m||r,_=_||s,w=w||i,{capitalize:new RegExp("(^|["+f+"])(["+m+"])","g"),pascal:new RegExp("(^|["+f+"])+(["+m+_+"])","g"),fill:new RegExp("["+f+"]+(.|$)","g"),sentence:new RegExp('(^\\s*|[\\?\\!\\.]+"?\\s+"?|,\\s+")(['+m+"])","g"),improper:new RegExp("\\b("+w+")\\b","g"),relax:new RegExp("([^"+_+"])(["+_+"]*)(["+_+"])(?=[^"+_+"]|$)","g"),upper:new RegExp("^[^"+m+"]+$"),hole:/[^\s]\s[^\s]/,apostrophe:/'/g,room:new RegExp("["+f+"]")}},a=o(),c={re:a,unicodes:t,regexps:o,types:[],up:String.prototype.toUpperCase,low:String.prototype.toLowerCase,cap:function(f){return c.up.call(f.charAt(0))+f.slice(1)},decap:function(f){return c.low.call(f.charAt(0))+f.slice(1)},deapostrophe:function(f){return f.replace(a.apostrophe,"")},fill:function(f,m,_){return m!=null&&(f=f.replace(a.fill,function(w,R){return R?m+R:""})),_&&(f=c.deapostrophe(f)),f},prep:function(f,m,_,w){if(f=f==null?"":f+"",!w&&a.upper.test(f)&&(f=c.low.call(f)),!m&&!a.hole.test(f)){var R=c.fill(f," ");a.hole.test(R)&&(f=R)}return!_&&!a.room.test(f)&&(f=f.replace(a.relax,c.relax)),f},relax:function(f,m,_,w){return m+" "+(_?_+" ":"")+w}},l={_:c,of:function(f){for(var m=0,_=c.types.length;m<_;m++)if(l[c.types[m]].apply(l,arguments)===f)return c.types[m]},flip:function(f){return f.replace(/\w/g,function(m){return(m==c.up.call(m)?c.low:c.up).call(m)})},random:function(f){return f.replace(/\w/g,function(m){return(Math.round(Math.random())?c.up:c.low).call(m)})},type:function(f,m){l[f]=m,c.types.push(f)}},u={lower:function(f,m,_){return c.fill(c.low.call(c.prep(f,m)),m,_)},snake:function(f){return l.lower(f,"_",!0)},constant:function(f){return l.upper(f,"_",!0)},camel:function(f){return c.decap(l.pascal(f))},kebab:function(f){return l.lower(f,"-",!0)},upper:function(f,m,_){return c.fill(c.up.call(c.prep(f,m,!1,!0)),m,_)},capital:function(f,m,_){return c.fill(c.prep(f).replace(a.capitalize,function(w,R,A){return R+c.up.call(A)}),m,_)},header:function(f){return l.capital(f,"-",!0)},pascal:function(f){return c.fill(c.prep(f,!1,!0).replace(a.pascal,function(m,_,w){return c.up.call(w)}),"",!0)},title:function(f){return l.capital(f).replace(a.improper,function(m,_,w,R){return w>0&&w<R.lastIndexOf(" ")?c.low.call(m):m})},sentence:function(f,m,_){return f=l.lower(f).replace(a.sentence,function(w,R,A){return R+c.up.call(A)}),m&&m.forEach(function(w){f=f.replace(new RegExp("\\b"+l.lower(w)+"\\b","g"),c.cap)}),_&&_.forEach(function(w){f=f.replace(new RegExp("(\\b"+l.lower(w)+"\\. +)(\\w)"),function(R,A,T){return A+c.low.call(T)})}),f}};u.squish=u.pascal,l.default=l;for(var h in u)l.type(h,u[h]);var d=typeof d=="function"?d:function(){};d(e.exports?e.exports=l:this.Case=l)}).call(Rs)})(yd);var Xv=yd.exports,Jv=oo(Xv);const Td=1,Sd=2,Qa=4,Za=8,as=32,Je=64,Wt=128,Mi=31,tc=63,Pn=127,Qv=2147483647,hn=Math.floor,xi=Math.abs,Ad=(e,t)=>e<t?e:t,Dn=(e,t)=>e>t?e:t,wd=e=>e!==0?e<0:1/e<0,Rd=Number.MAX_SAFE_INTEGER,Zv=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&hn(e)===e),cr=()=>new Set,ec=e=>e[e.length-1],tN=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},fn=Array.from,eN=Array.isArray,nN=e=>e.toLowerCase(),rN=/^\s*/g,sN=e=>e.replace(rN,""),iN=/([A-Z])/g,vd=(e,t)=>sN(e.replace(iN,n=>`${t}${nN(n)}`)),oN=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},cs=typeof TextEncoder<"u"?new TextEncoder:null,aN=cs?e=>cs.encode(e):oN;let ls=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ls&&ls.decode(new Uint8Array).length===1&&(ls=null);const dn=e=>new Error(e),Oe=()=>{throw dn("Method unimplemented")},ke=()=>{throw dn("Unexpected case")};class us{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const pn=()=>new us,cN=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},ge=e=>{const t=new Uint8Array(cN(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},lN=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Dn(n,t)*2),e.cpos=0)},Tt=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},nc=Tt,D=(e,t)=>{for(;t>Pn;)Tt(e,Wt|Pn&t),t=hn(t/128);Tt(e,Pn&t)},rc=(e,t)=>{const n=wd(t);for(n&&(t=-t),Tt(e,(t>tc?Wt:0)|(n?Je:0)|tc&t),t=hn(t/64);t>0;)Tt(e,(t>Pn?Wt:0)|Pn&t),t=hn(t/128)},sc=new Uint8Array(3e4),uN=sc.length/3,hN=(e,t)=>{if(t.length<uN){const n=cs.encodeInto(t,sc).written||0;D(e,n);for(let r=0;r<n;r++)Tt(e,sc[r])}else Lt(e,aN(t))},fN=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;D(e,r);for(let s=0;s<r;s++)Tt(e,n.codePointAt(s))},lr=cs&&cs.encodeInto?hN:fN,Ui=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=Ad(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Dn(n*2,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},Lt=(e,t)=>{D(e,t.byteLength),Ui(e,t)},ic=(e,t)=>{lN(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},dN=(e,t)=>ic(e,4).setFloat32(0,t,!1),pN=(e,t)=>ic(e,8).setFloat64(0,t,!1),gN=(e,t)=>ic(e,8).setBigInt64(0,t,!1),Nd=new DataView(new ArrayBuffer(4)),mN=e=>(Nd.setFloat32(0,e),Nd.getFloat32(0)===e),hs=(e,t)=>{switch(typeof t){case"string":Tt(e,119),lr(e,t);break;case"number":Zv(t)&&xi(t)<=Qv?(Tt(e,125),rc(e,t)):mN(t)?(Tt(e,124),dN(e,t)):(Tt(e,123),pN(e,t));break;case"bigint":Tt(e,122),gN(e,t);break;case"object":if(t===null)Tt(e,126);else if(eN(t)){Tt(e,117),D(e,t.length);for(let n=0;n<t.length;n++)hs(e,t[n])}else if(t instanceof Uint8Array)Tt(e,116),Lt(e,t);else{Tt(e,118);const n=Object.keys(t);D(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];lr(e,s),hs(e,t[s])}}break;case"boolean":Tt(e,t?120:121);break;default:Tt(e,127)}};class bd extends us{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&D(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Ld=e=>{e.count>0&&(rc(e.encoder,e.count===1?e.s:-e.s),e.count>1&&D(e.encoder,e.count-2))};class Pi{constructor(){this.encoder=new us,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Ld(this),this.count=1,this.s=t)}toUint8Array(){return Ld(this),ge(this.encoder)}}const Cd=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);rc(e.encoder,t),e.count>1&&D(e.encoder,e.count-2)}};class oc{constructor(){this.encoder=new us,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Cd(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Cd(this),ge(this.encoder)}}class EN{constructor(){this.sarr=[],this.s="",this.lensE=new Pi}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new us;return this.sarr.push(this.s),this.s="",lr(t,this.sarr.join("")),Ui(t,this.lensE.toUint8Array()),ge(t)}}const Id=dn("Unexpected end of array"),Od=dn("Integer out of Range");class Di{constructor(t){this.arr=t,this.pos=0}}const Fn=e=>new Di(e),_N=e=>e.pos!==e.arr.length,yN=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Ut=e=>yN(e,F(e)),ur=e=>e.arr[e.pos++],F=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const s=e.arr[e.pos++];if(t=t+(s&Pn)*n,n*=128,s<Wt)return t;if(t>Rd)throw Od}throw Id},ac=e=>{let t=e.arr[e.pos++],n=t&tc,r=64;const s=(t&Je)>0?-1:1;if(!(t&Wt))return s*n;const i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n=n+(t&Pn)*r,r*=128,t<Wt)return s*n;if(n>Rd)throw Od}throw Id},hr=ls?e=>ls.decode(Ut(e)):e=>{let t=F(e);if(t===0)return"";{let n=String.fromCodePoint(ur(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ur(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},cc=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},TN=[e=>{},e=>null,ac,e=>cc(e,4).getFloat32(0,!1),e=>cc(e,8).getFloat64(0,!1),e=>cc(e,8).getBigInt64(0,!1),e=>!1,e=>!0,hr,e=>{const t=F(e),n={};for(let r=0;r<t;r++){const s=hr(e);n[s]=fs(e)}return n},e=>{const t=F(e),n=[];for(let r=0;r<t;r++)n.push(fs(e));return n},Ut],fs=e=>TN[127-ur(e)](e);class kd extends Di{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),_N(this)?this.count=F(this)+1:this.count=-1),this.count--,this.s}}class Fi extends Di{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=ac(this);const t=wd(this.s);this.count=1,t&&(this.s=-this.s,this.count=F(this)+2)}return this.count--,this.s}}class lc extends Di{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=ac(this),n=t&1;this.diff=hn(t/2),this.count=1,n&&(this.count=F(this)+2)}return this.s+=this.diff,this.count--,this.s}}class SN{constructor(t){this.decoder=new Fi(t),this.str=hr(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const me=()=>new Map,uc=e=>{const t=me();return e.forEach((n,r)=>{t.set(r,n)}),t},gn=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},AN=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},wN=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1};class RN{constructor(){this._observers=me()}on(t,n){return gn(this._observers,t,cr).add(n),n}once(t,n){const r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return fn((this._observers.get(t)||me()).values()).forEach(r=>r(...n))}destroy(){this._observers=me()}}const vN=crypto.getRandomValues.bind(crypto),Md=()=>vN(new Uint32Array(1))[0],NN="10000000-1000-4000-8000"+-1e11,bN=()=>NN.replace(/[018]/g,e=>(e^Md()&15>>e/4).toString(16)),xd=e=>new Promise(e);Promise.all.bind(Promise);const Ud=e=>e===void 0?null:e;class LN{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Pd=new LN,CN=!0;try{typeof localStorage<"u"&&localStorage&&(Pd=localStorage,CN=!1)}catch{}const IN=Pd,ON=Object.assign,kN=Object.keys,MN=(e,t)=>{for(const n in e)t(e[n],n)},Dd=e=>kN(e).length,xN=e=>{for(const t in e)return!1;return!0},UN=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},PN=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),DN=(e,t)=>e===t||Dd(e)===Dd(t)&&UN(e,(n,r)=>(n!==void 0||PN(t,r))&&t[r]===n),hc=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&hc(e,t,n+1)}},FN=e=>e,$N=(e,t)=>t.includes(e);var Fd={};const ds=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Me;const BN=()=>{if(Me===void 0)if(ds){Me=me();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Me.set(t,""),t=r):t!==null&&(Me.set(t,r),t=null)}t!==null&&Me.set(t,"")}else typeof location=="object"?(Me=me(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Me.set(`--${vd(t,"-")}`,n),Me.set(`-${vd(t,"-")}`,n)}})):Me=me();return Me},fc=e=>BN().has(e),dc=e=>Ud(ds?Fd[e.toUpperCase().replaceAll("-","_")]:IN.getItem(e));(e=>fc("--"+e)||dc(e)!==null)("production");const $d=ds&&$N(Fd.FORCE_COLOR,["true","1","2"]),GN=!fc("no-colors")&&(!ds||process.stdout.isTTY||$d)&&(!ds||fc("color")||$d||dc("COLORTERM")!==null||(dc("TERM")||"").includes("color")),jN=e=>new Uint8Array(e),KN=e=>{const t=jN(e.byteLength);return t.set(e),t};class WN{constructor(t,n){this.left=t,this.right=n}}const Qe=(e,t)=>new WN(e,t);typeof DOMParser<"u"&&new DOMParser;const HN=e=>AN(e,(t,n)=>`${n}:${t};`).join(""),Ze=Symbol,Bd=Ze(),Gd=Ze(),VN=Ze(),zN=Ze(),YN=Ze(),jd=Ze(),qN=Ze(),Kd=Ze(),XN=Ze(),JN=e=>{var r;e.length===1&&((r=e[0])==null?void 0:r.constructor)===Function&&(e=e[0]());const t=[];let n=0;for(;n<e.length;n++){const s=e[n];s===void 0||s.constructor===String||s.constructor===Number||s.constructor===Object&&t.push(JSON.stringify(s))}return t},QN={[Bd]:Qe("font-weight","bold"),[Gd]:Qe("font-weight","normal"),[VN]:Qe("color","blue"),[YN]:Qe("color","green"),[zN]:Qe("color","grey"),[jd]:Qe("color","red"),[qN]:Qe("color","purple"),[Kd]:Qe("color","orange"),[XN]:Qe("color","black")},ZN=GN?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=me();let s=[],i=0;for(;i<e.length;i++){const a=e[i],c=QN[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=HN(r);i>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(i>0&&(s=n,s.unshift(t.join("")));i<e.length;i++){const a=e[i];a instanceof Symbol||s.push(a)}return s}:JN,t0=(...e)=>{console.log(...ZN(e)),e0.forEach(t=>t.print(e))},e0=cr(),Wd=e=>({[Symbol.iterator](){return this},next:e}),n0=(e,t)=>Wd(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),pc=(e,t)=>Wd(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class gc{constructor(t,n){this.clock=t,this.len=n}}class ps{constructor(){this.clients=new Map}}const Hd=(e,t,n)=>t.clients.forEach((r,s)=>{const i=e.doc.store.clients.get(s);for(let o=0;o<r.length;o++){const a=r[o];lp(e,i,a.clock,a.len,n)}}),r0=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=hn((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},Vd=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&r0(n,t.clock)!==null},mc=e=>{e.clients.forEach(t=>{t.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<t.length;n++){const s=t[r-1],i=t[n];s.clock+s.len>=i.clock?s.len=Dn(s.len,i.clock+i.len-s.clock):(r<n&&(t[r]=i),r++)}t.length=r})},s0=e=>{const t=new ps;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let o=n+1;o<e.length;o++)tN(i,e[o].clients.get(s)||[]);t.clients.set(s,i)}});return mc(t),t},$i=(e,t,n,r)=>{gn(e.clients,t,()=>[]).push(new gc(n,r))},i0=()=>new ps,o0=e=>{const t=i0();return e.clients.forEach((n,r)=>{const s=[];for(let i=0;i<n.length;i++){const o=n[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<n.length)for(let l=n[i+1];i+1<n.length&&l.deleted;l=n[++i+1])c+=l.length;s.push(new gc(a,c))}}s.length>0&&t.clients.set(r,s)}),t},fr=(e,t)=>{D(e.restEncoder,t.clients.size),fn(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),D(e.restEncoder,n);const s=r.length;D(e.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},Ec=e=>{const t=new ps,n=F(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const s=F(e.restDecoder),i=F(e.restDecoder);if(i>0){const o=gn(t.clients,s,()=>[]);for(let a=0;a<i;a++)o.push(new gc(e.readDsClock(),e.readDsLen()))}}return t},zd=(e,t,n)=>{const r=new ps,s=F(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const o=F(e.restDecoder),a=F(e.restDecoder),c=n.clients.get(o)||[],l=St(n,o);for(let u=0;u<a;u++){const h=e.readDsClock(),d=h+e.readDsLen();if(h<l){l<d&&$i(r,o,l,d-l);let f=xe(c,h),m=c[f];for(!m.deleted&&m.id.clock<h&&(c.splice(f+1,0,to(t,m,h-m.id.clock)),f++);f<c.length&&(m=c[f++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(f,0,to(t,m,d-m.id.clock)),m.delete(t))}else $i(r,o,h,d-h)}}if(r.clients.size>0){const i=new $n;return D(i.restEncoder,0),fr(i,r),i.toUint8Array()}return null},Yd=Md;class dr extends RN{constructor({guid:t=bN(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Yd(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new op,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=xd(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>xd(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&X(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(fn(this.subdocs).map(t=>t.guid))}transact(t,n=null){return X(this,t,n)}get(t,n=vt){const r=gn(this.share,t,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==vt&&s!==n)if(s===vt){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(t,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Er)}getText(t=""){return this.get(t,Bn)}getMap(t=""){return this.get(t,_r)}getXmlElement(t=""){return this.get(t,Tr)}getXmlFragment(t=""){return this.get(t,Gn)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){fn(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new dr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,X(t.parent.doc,r=>{const s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class qd{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return F(this.restDecoder)}readDsLen(){return F(this.restDecoder)}}class Xd extends qd{readLeftID(){return G(F(this.restDecoder),F(this.restDecoder))}readRightID(){return G(F(this.restDecoder),F(this.restDecoder))}readClient(){return F(this.restDecoder)}readInfo(){return ur(this.restDecoder)}readString(){return hr(this.restDecoder)}readParentInfo(){return F(this.restDecoder)===1}readTypeRef(){return F(this.restDecoder)}readLen(){return F(this.restDecoder)}readAny(){return fs(this.restDecoder)}readBuf(){return KN(Ut(this.restDecoder))}readJSON(){return JSON.parse(hr(this.restDecoder))}readKey(){return hr(this.restDecoder)}}class a0{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=F(this.restDecoder),this.dsCurrVal}readDsLen(){const t=F(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class pr extends a0{constructor(t){super(t),this.keys=[],F(t),this.keyClockDecoder=new lc(Ut(t)),this.clientDecoder=new Fi(Ut(t)),this.leftClockDecoder=new lc(Ut(t)),this.rightClockDecoder=new lc(Ut(t)),this.infoDecoder=new kd(Ut(t),ur),this.stringDecoder=new SN(Ut(t)),this.parentInfoDecoder=new kd(Ut(t),ur),this.typeRefDecoder=new Fi(Ut(t)),this.lenDecoder=new Fi(Ut(t))}readLeftID(){return new gr(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new gr(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return fs(this.restDecoder)}readBuf(){return Ut(this.restDecoder)}readJSON(){return fs(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Jd{constructor(){this.restEncoder=pn()}toUint8Array(){return ge(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){D(this.restEncoder,t)}writeDsLen(t){D(this.restEncoder,t)}}class gs extends Jd{writeLeftID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeRightID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeClient(t){D(this.restEncoder,t)}writeInfo(t){nc(this.restEncoder,t)}writeString(t){lr(this.restEncoder,t)}writeParentInfo(t){D(this.restEncoder,t?1:0)}writeTypeRef(t){D(this.restEncoder,t)}writeLen(t){D(this.restEncoder,t)}writeAny(t){hs(this.restEncoder,t)}writeBuf(t){Lt(this.restEncoder,t)}writeJSON(t){lr(this.restEncoder,JSON.stringify(t))}writeKey(t){lr(this.restEncoder,t)}}class Qd{constructor(){this.restEncoder=pn(),this.dsCurrVal=0}toUint8Array(){return ge(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,D(this.restEncoder,n)}writeDsLen(t){t===0&&ke(),D(this.restEncoder,t-1),this.dsCurrVal+=t}}class $n extends Qd{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new oc,this.clientEncoder=new Pi,this.leftClockEncoder=new oc,this.rightClockEncoder=new oc,this.infoEncoder=new bd(nc),this.stringEncoder=new EN,this.parentInfoEncoder=new bd(nc),this.typeRefEncoder=new Pi,this.lenEncoder=new Pi}toUint8Array(){const t=pn();return D(t,0),Lt(t,this.keyClockEncoder.toUint8Array()),Lt(t,this.clientEncoder.toUint8Array()),Lt(t,this.leftClockEncoder.toUint8Array()),Lt(t,this.rightClockEncoder.toUint8Array()),Lt(t,ge(this.infoEncoder)),Lt(t,this.stringEncoder.toUint8Array()),Lt(t,ge(this.parentInfoEncoder)),Lt(t,this.typeRefEncoder.toUint8Array()),Lt(t,this.lenEncoder.toUint8Array()),Ui(t,ge(this.restEncoder)),ge(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){hs(this.restEncoder,t)}writeBuf(t){Lt(this.restEncoder,t)}writeJSON(t){hs(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const c0=(e,t,n,r)=>{r=Dn(r,t[0].id.clock);const s=xe(t,r);D(e.restEncoder,t.length-s),e.writeClient(n),D(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},_c=(e,t,n)=>{const r=new Map;n.forEach((s,i)=>{St(t,i)>s&&r.set(i,s)}),Gi(t).forEach((s,i)=>{n.has(i)||r.set(i,0)}),D(e.restEncoder,r.size),fn(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{c0(e,t.clients.get(s),s,i)})},l0=(e,t)=>{const n=me(),r=F(e.restDecoder);for(let s=0;s<r;s++){const i=F(e.restDecoder),o=new Array(i),a=e.readClient();let c=F(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const u=e.readInfo();switch(Mi&u){case 0:{const h=e.readLen();o[l]=new ne(G(a,c),h),c+=h;break}case 10:{const h=F(e.restDecoder);o[l]=new re(G(a,c),h),c+=h;break}default:{const h=(u&(Je|Wt))===0,d=new _t(G(a,c),null,(u&Wt)===Wt?e.readLeftID():null,null,(u&Je)===Je?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(u&as)===as?e.readString():null,xp(e,u));o[l]=d,c+=d.length}}}}return n},u0=(e,t,n)=>{const r=[];let s=fn(n.keys()).sort((f,m)=>f-m);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new op,c=new Map,l=(f,m)=>{const _=c.get(f);(_==null||_>m)&&c.set(f,m)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of r){const m=f.id.client,_=n.get(m);_?(_.i--,a.clients.set(m,_.refs.slice(_.i)),n.delete(m),_.i=0,_.refs=[]):a.clients.set(m,[f]),s=s.filter(w=>w!==m)}r.length=0};for(;;){if(u.constructor!==re){const m=gn(h,u.id.client,()=>St(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const _=u.getMissing(e,t);if(_!==null){r.push(u);const w=n.get(_)||{refs:[],i:0};if(w.refs.length===w.i)l(_,St(t,_)),d();else{u=w.refs[w.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new $n;return _c(f,a,new Map),D(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},h0=(e,t)=>_c(e,t.doc.store,t.beforeState),f0=(e,t,n,r=new pr(e))=>X(t,s=>{s.local=!1;let i=!1;const o=s.doc,a=o.store,c=l0(r,o),l=u0(s,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<St(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const m=u.missing.get(d);(m==null||m>f)&&u.missing.set(d,f)}u.update=Ki([u.update,l.update])}}else a.pendingStructs=l;const h=zd(r,s,a);if(a.pendingDs){const d=new pr(Fn(a.pendingDs));F(d.restDecoder);const f=zd(d,s,a);h&&f?a.pendingDs=Ki([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,Zd(s.doc,d)}},n,!1),Zd=(e,t,n,r=pr)=>{const s=Fn(t);f0(s,e,n,new r(s))},d0=(e,t,n)=>Zd(e,t,n,Xd),p0=(e,t,n=new Map)=>{_c(e,t.store,n),fr(e,o0(t.store))},g0=(e,t=new Uint8Array([0]),n=new $n)=>{const r=tp(t);p0(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(I0(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===gs)return L0(s.map((i,o)=>o===0?i:k0(i)));if(n.constructor===$n)return Ki(s)}return s[0]},m0=(e,t)=>g0(e,t,new gs),E0=e=>{const t=new Map,n=F(e.restDecoder);for(let r=0;r<n;r++){const s=F(e.restDecoder),i=F(e.restDecoder);t.set(s,i)}return t},tp=e=>E0(new qd(Fn(e))),ep=(e,t)=>(D(e.restEncoder,t.size),fn(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{D(e.restEncoder,n),D(e.restEncoder,r)}),e),_0=(e,t)=>ep(e,Gi(t.store)),y0=(e,t=new Qd)=>(e instanceof Map?ep(t,e):_0(t,e),t.toUint8Array()),T0=e=>y0(e,new Jd);class S0{constructor(){this.l=[]}}const np=()=>new S0,rp=(e,t)=>e.l.push(t),sp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ip=(e,t,n)=>hc(e.l,[t,n]);class gr{constructor(t,n){this.client=t,this.clock=n}}const Bi=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,G=(e,t)=>new gr(e,t),A0=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw ke()},mr=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Vd(t.ds,e.id),yc=(e,t)=>{const n=gn(e.meta,yc,cr),r=e.doc.store;n.has(t)||(t.sv.forEach((s,i)=>{s<St(r,i)&&mn(e,G(i,s))}),Hd(e,t.ds,s=>{}),n.add(t))};class op{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Gi=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},St=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ap=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw ke()}n.push(t)},xe=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=hn(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=hn((n+r)/2)}throw ke()},Tc=(e,t)=>{const n=e.clients.get(t.client);return n[xe(n,t.clock)]},Sc=(e,t,n)=>{const r=xe(t,n),s=t[r];return s.id.clock<n&&s instanceof _t?(t.splice(r+1,0,to(e,s,n-s.id.clock)),r+1):r},mn=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Sc(e,n,t.clock)]},cp=(e,t,n)=>{const r=t.clients.get(n.client),s=xe(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==ne&&r.splice(s+1,0,to(e,i,n.clock-i.id.clock+1)),i},w0=(e,t,n)=>{const r=e.clients.get(t.id.client);r[xe(r,t.id.clock)]=n},lp=(e,t,n,r,s)=>{if(r===0)return;const i=n+r;let o=Sc(e,t,n),a;do a=t[o++],i<a.id.clock+a.length&&Sc(e,t,i),s(a);while(o<t.length&&t[o].id.clock<i)};class R0{constructor(t,n,r){this.doc=t,this.deleteSet=new ps,this.beforeState=Gi(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const up=(e,t)=>t.deleteSet.clients.size===0&&!wN(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(mc(t.deleteSet),h0(e,t),fr(e,t.deleteSet),!0),hp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&gn(e.changed,t,cr).add(n)},ji=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof _t&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=t-s;return i&&e.splice(t+1-i,i),i},v0=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const i=t.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],c=a.clock+a.len;for(let l=xe(i,a.clock),u=i[l];l<i.length&&u.id.clock<c;u=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof _t&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},N0=(e,t)=>{e.clients.forEach((n,r)=>{const s=t.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Ad(s.length-1,1+xe(s,o.clock+o.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=o.clock;l=s[c])c-=1+ji(s,c)}})},fp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{mc(i),n.afterState=Gi(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),ip(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),hc(a,[]),n._needFormattingCleanup&&V0(n)}finally{r.gc&&v0(i,s,r.gcFilter),N0(i,s),n.afterState.forEach((u,h)=>{const d=n.beforeState.get(h)||0;if(d!==u){const f=s.clients.get(h),m=Dn(xe(f,d),1);for(let _=f.length-1;_>=m;)_-=1+ji(f,_)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=s.clients.get(h),m=xe(f,d);m+1<f.length&&ji(f,m+1)>1||m>0&&ji(f,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(t0(Kd,Bd,"[yjs] ",Gd,jd,"Changed the client-id because another client seems to be using it."),r.clientID=Yd()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new gs;up(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new $n;up(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):fp(e,t+1)}}},X=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,o=null;e._transaction===null&&(i=!0,e._transaction=new R0(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const a=e._transaction===s[0];e._transaction=null,a&&fp(s,0)}}return o};function*b0(e){const t=F(e.restDecoder);for(let n=0;n<t;n++){const r=F(e.restDecoder),s=e.readClient();let i=F(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=F(e.restDecoder);yield new re(G(s,i),c),i+=c}else if(Mi&a){const c=(a&(Je|Wt))===0,l=new _t(G(s,i),null,(a&Wt)===Wt?e.readLeftID():null,null,(a&Je)===Je?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&as)===as?e.readString():null,xp(e,a));yield l,i+=l.length}else{const c=e.readLen();yield new ne(G(s,i),c),i+=c}}}}class Ac{constructor(t,n){this.gen=b0(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===re);return this.curr}}class wc{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const L0=e=>Ki(e,Xd,gs),C0=(e,t)=>{if(e.constructor===ne){const{client:n,clock:r}=e.id;return new ne(G(n,r+t),e.length-t)}else if(e.constructor===re){const{client:n,clock:r}=e.id;return new re(G(n,r+t),e.length-t)}else{const n=e,{client:r,clock:s}=n.id;return new _t(G(r,s+t),null,G(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Ki=(e,t=pr,n=$n)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Fn(u)));let s=r.map(u=>new Ac(u,!0)),i=null;const o=new n,a=new wc(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const m=d.curr.id.clock-f.curr.id.clock;return m===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===re?1:-1:m}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)En(a,i.struct,i.offset),i={struct:d,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===re)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{En(a,i.struct,i.offset);const m=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new re(G(h,i.struct.id.clock+i.struct.length),m),offset:0}}else{const m=i.struct.id.clock+i.struct.length-d.id.clock;m>0&&(i.struct.constructor===re?i.struct.length-=m:d=C0(d,m)),i.struct.mergeWith(d)||(En(a,i.struct,i.offset),i={struct:d,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==re;d=u.next())En(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(En(a,i.struct,i.offset),i=null),Rc(a);const c=r.map(u=>Ec(u)),l=s0(c);return fr(o,l),o.toUint8Array()},I0=(e,t,n=pr,r=$n)=>{const s=tp(t),i=new r,o=new wc(i),a=new n(Fn(e)),c=new Ac(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=s.get(h)||0;if(c.curr.constructor===re){c.next();continue}if(u.id.clock+u.length>d)for(En(o,u,Dn(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)En(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Rc(o);const l=Ec(a);return fr(i,l),i.toUint8Array()},dp=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:ge(e.encoder.restEncoder)}),e.encoder.restEncoder=pn(),e.written=0)},En=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&dp(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),D(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Rc=e=>{dp(e);const t=e.encoder.restEncoder;D(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];D(t,r.written),Ui(t,r.restEncoder)}},O0=(e,t,n,r)=>{const s=new n(Fn(e)),i=new Ac(s,!1),o=new r,a=new wc(o);for(let l=i.curr;l!==null;l=i.next())En(a,t(l),0);Rc(a);const c=Ec(s);return fr(o,c),o.toUint8Array()},k0=e=>O0(e,FN,pr,gs),pp="You must not compute changes after the event-handler fired.";class Wi{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=M0(this.currentTarget,this.target))}deletes(t){return Vd(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw dn(pp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=ec(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=ec(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=ec(i.content.getContent());else return;t.set(s,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw dn(pp);const n=this.target,r=cr(),s=cr(),i=[];if(t={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const M0=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}t=t._item.parent}return n},gp=80;let vc=0;class x0{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=vc++}}const U0=e=>{e.timestamp=vc++},mp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=vc++},P0=(e,t,n)=>{if(e.length>=gp){const r=e.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return mp(r,t,n),r}else{const r=new x0(t,n);return e.push(r),r}},Hi=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((i,o)=>xi(t-i.index)<xi(t-o.index)?i:o);let r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,U0(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&xi(n.index-s)<r.parent.length/gp?(mp(n,r,s),n):P0(e._searchMarker,r,s)},ms=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){e.splice(r,1);continue}s.p=i,i.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=Dn(t,s.index+n))}},Vi=(e,t,n)=>{const r=e,s=t.changedParentTypes;for(;gn(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;ip(r._eH,n,t)};class vt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=np(),this._dEH=np(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Oe()}clone(){throw Oe()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){rp(this._eH,t)}observeDeep(t){rp(this._dEH,t)}unobserve(t){sp(this._eH,t)}unobserveDeep(t){sp(this._dEH,t)}toJSON(){}}const Ep=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)s.push(o[a]),r--;t=0}}i=i.right}return s},_p=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},Es=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)t(s[i],n++,e)}r=r.right}},yp=(e,t)=>{const n=[];return Es(e,(r,s)=>{n.push(t(r,s,e))}),n},D0=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Tp=(e,t)=>{const n=Hi(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},zi=(e,t,n,r)=>{let s=n;const i=e.doc,o=i.clientID,a=i.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new _t(G(o,St(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Kn(l)),s.integrate(e,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new _t(G(o,St(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new _s(new Uint8Array(h))),s.integrate(e,0);break;case dr:s=new _t(G(o,St(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Ts(h)),s.integrate(e,0);break;default:if(h instanceof vt)s=new _t(G(o,St(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new tn(h)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Sp=()=>dn("Length exceeded!"),Ap=(e,t,n,r)=>{if(n>t._length)throw Sp();if(n===0)return t._searchMarker&&ms(t._searchMarker,n,r.length),zi(e,t,null,r);const s=n,i=Hi(t,n);let o=t._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&mn(e,G(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&ms(t._searchMarker,s,r.length),zi(e,t,o,r)},F0=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return zi(e,t,s,n)},wp=(e,t,n,r)=>{if(r===0)return;const s=n,i=r,o=Hi(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&mn(e,G(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&mn(e,G(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Sp();t._searchMarker&&ms(t._searchMarker,s,-i+r)},Yi=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Nc=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,o=i.clientID;let a;if(r==null)a=new Kn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Kn([r]);break;case Uint8Array:a=new _s(r);break;case dr:a=new Ts(r);break;default:if(r instanceof vt)a=new tn(r);else throw new Error("Unexpected content type")}new _t(G(o,St(i.store,o)),s,s&&s.lastId,null,null,t,n,a).integrate(e,0)},bc=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Rp=e=>{const t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},vp=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},$0=(e,t)=>{const n={};return e._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!t.sv.has(i.id.client)||i.id.clock>=(t.sv.get(i.id.client)||0));)i=i.left;i!==null&&mr(i,t)&&(n[s]=i.content.getContent()[i.length-1])}),n},qi=e=>n0(e.entries(),t=>!t[1].deleted);class B0 extends Wi{constructor(t,n){super(t,n),this._transaction=n}}class Er extends vt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Er;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Er}clone(){const t=new Er;return t.insert(0,this.toArray().map(n=>n instanceof vt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),Vi(this,t,new B0(this,t))}insert(t,n){this.doc!==null?X(this.doc,r=>{Ap(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?X(this.doc,n=>{F0(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?X(this.doc,r=>{wp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Tp(this,t)}toArray(){return _p(this)}slice(t=0,n=this.length){return Ep(this,t,n)}toJSON(){return this.map(t=>t instanceof vt?t.toJSON():t)}map(t){return yp(this,t)}forEach(t){Es(this,t)}[Symbol.iterator](){return D0(this)}_write(t){t.writeTypeRef(ub)}}const G0=e=>new Er;class j0 extends Wi{constructor(t,n,r){super(t,n),this.keysChanged=r}}class _r extends vt{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new _r}clone(){const t=new _r;return this.forEach((n,r)=>{t.set(r,n instanceof vt?n.clone():n)}),t}_callObserver(t,n){Vi(this,t,new j0(this,t,n))}toJSON(){const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];t[r]=s instanceof vt?s.toJSON():s}}),t}get size(){return[...qi(this._map)].length}keys(){return pc(qi(this._map),t=>t[0])}values(){return pc(qi(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return pc(qi(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?X(this.doc,n=>{Yi(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?X(this.doc,r=>{Nc(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return bc(this,t)}has(t){return vp(this,t)}clear(){this.doc!==null?X(this.doc,t=>{this.forEach(function(n,r,s){Yi(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(hb)}}const K0=e=>new _r,_n=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&DN(e,t);class Lc{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&ke(),this.right.content.constructor){case Et:this.right.deleted||yr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Np=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Et:t.right.deleted||yr(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&mn(e,G(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Xi=(e,t,n,r)=>{const s=new Map,i=r?Hi(t,n):null;if(i){const o=new Lc(i.p.left,i.p,i.index,s);return Np(e,o,n-i.index)}else{const o=new Lc(null,t._start,0,s);return Np(e,o,n)}},bp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Et&&_n(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new _t(G(i,St(s.store,i)),c,c&&c.lastId,l,l&&l.id,t,null,new Et(a,o));u.integrate(e,0),n.right=u,n.forward()})},yr=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Lp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Et&&_n(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Cp=(e,t,n,r)=>{const s=e.doc,i=s.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!_n(l,c)){o.set(a,l);const{left:u,right:h}=n;n.right=new _t(G(i,St(s.store,i)),u,u&&u.lastId,h,h&&h.id,t,null,new Et(a,c)),n.right.integrate(e,0),n.forward()}}return o},Cc=(e,t,n,r,s)=>{n.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});const i=e.doc,o=i.clientID;Lp(n,s);const a=Cp(e,t,n,s),c=r.constructor===String?new Ue(r):r instanceof vt?new tn(r):new jn(r);let{left:l,right:u,index:h}=n;t._searchMarker&&ms(t._searchMarker,n.index,c.getLength()),u=new _t(G(o,St(i.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=h,n.forward(),bp(e,t,n,a)},Ip=(e,t,n,r,s)=>{const i=e.doc,o=i.clientID;Lp(n,s);const a=Cp(e,t,n,s);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Et));){if(!n.right.deleted)switch(n.right.content.constructor){case Et:{const{key:c,value:l}=n.right.content,u=s[c];if(u!==void 0){if(_n(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&mn(e,G(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new _t(G(o,St(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Ue(c)),n.right.integrate(e,0),n.forward()}bp(e,t,n,a)},Op=(e,t,n,r,s)=>{let i=t;const o=me();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Et){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;t!==i;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case Et:{const{key:u,value:h}=l,d=r.get(u)??null;(o.get(u)!==l||d===h)&&(t.delete(e),a++,!c&&(s.get(u)??null)===h&&d!==h&&(d===null?s.delete(u):s.set(u,d))),!c&&!t.deleted&&yr(s,l);break}}}t=t.right}return a},W0=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Et){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},H0=e=>{let t=0;return X(e.doc,n=>{let r=e._start,s=e._start,i=me();const o=uc(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Et:yr(o,s.content);break;default:t+=Op(n,r,s,i,o),i=uc(o),r=s;break}s=s.right}}),t},V0=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const i=e.beforeState.get(r)||0;s!==i&&lp(e,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===Et&&o.constructor!==ne&&t.add(o.parent)})}X(n,r=>{Hd(e,e.deleteSet,s=>{if(s instanceof ne||!s.parent._hasFormatting||t.has(s.parent))return;const i=s.parent;s.content.constructor===Et?t.add(i):W0(r,s)});for(const s of t)H0(s)})},kp=(e,t,n)=>{const r=n,s=uc(t.currentAttributes),i=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case tn:case jn:case Ue:n<t.right.length&&mn(e,G(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}i&&Op(e,i,t.right,s,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&ms(o._searchMarker,t.index,-r+n),t};class z0 extends Wi{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];X(t,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((m,_)=>{m!==null&&(f.attributes[_]=m)}))),l="";break;case"retain":u>0&&(f={retain:u},xN(c)||(f.attributes=ON({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case tn:case jn:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Ue:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Et:{const{key:f,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const _=s.get(f)??null;_n(_,m)?m!==null&&o.delete(r):(a==="retain"&&d(),_n(m,i.get(f)??null)?delete c[f]:c[f]=m)}}else if(this.deletes(o)){i.set(f,m);const _=s.get(f)??null;_n(_,m)||(a==="retain"&&d(),c[f]=_)}else if(!o.deleted){i.set(f,m);const _=c[f];_!==void 0&&(_n(_,m)?_!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[f]:c[f]=m))}o.deleted||(a==="insert"&&d(),yr(s,o.content));break}}o=o.right}for(d();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Bn extends vt{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Bn}clone(){const t=new Bn;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new z0(this,t,n);Vi(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ue&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?X(this.doc,r=>{const s=new Lc(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const o=t[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===t.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Cc(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Ip(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&kp(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){const s=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;i.forEach((m,_)=>{d=!0,h[_]=m});const f={insert:a};d&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(mr(c,t)||n!==void 0&&mr(c,n))switch(c.content.constructor){case Ue:{const h=i.get("ychange");t!==void 0&&!mr(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!mr(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case tn:case jn:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((f,m)=>{d[m]=f})}s.push(h);break}case Et:mr(c,t)&&(l(),yr(i,c.content));break}c=c.right}l()};return t||n?X(o,h=>{t&&yc(h,t),n&&yc(h,n),u()},"cleanup"):u(),s}insert(t,n,r){if(n.length<=0)return;const s=this.doc;s!==null?X(s,i=>{const o=Xi(i,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),Cc(i,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const s=this.doc;s!==null?X(s,i=>{const o=Xi(i,this,t,!r);Cc(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?X(r,s=>{kp(s,Xi(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const s=this.doc;s!==null?X(s,i=>{const o=Xi(i,this,t,!1);o.right!==null&&Ip(i,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?X(this.doc,n=>{Yi(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?X(this.doc,r=>{Nc(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return bc(this,t)}getAttributes(){return Rp(this)}_write(t){t.writeTypeRef(fb)}}const Y0=e=>new Bn;class Ic{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Tr||n.constructor===Gn)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Gn extends vt{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Gn}clone(){const t=new Gn;return t.insert(0,this.toArray().map(n=>n instanceof vt?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Ic(this,t)}querySelector(t){t=t.toUpperCase();const r=new Ic(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),fn(new Ic(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Vi(this,t,new J0(this,n,t))}toString(){return yp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),Es(this,i=>{s.insertBefore(i.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?X(this.doc,r=>{Ap(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)X(this.doc,r=>{const s=t&&t instanceof vt?t._item:t;zi(r,this,s,n)});else{const r=this._prelimContent,s=t===null?0:r.findIndex(i=>i===t)+1;if(s===0&&t!==null)throw dn("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?X(this.doc,r=>{wp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return _p(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Tp(this,t)}slice(t=0,n=this.length){return Ep(this,t,n)}forEach(t){Es(this,t)}_write(t){t.writeTypeRef(pb)}}const q0=e=>new Gn;class Tr extends Gn{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new Tr(this.nodeName)}clone(){const t=new Tr(this.nodeName),n=this.getAttributes();return MN(n,(r,s)=>{typeof r=="string"&&t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof vt?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(t){this.doc!==null?X(this.doc,n=>{Yi(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?X(this.doc,r=>{Nc(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return bc(this,t)}hasAttribute(t){return vp(this,t)}getAttributes(t){return t?$0(this,t):Rp(this)}toDOM(t=document,n={},r){const s=t.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return Es(this,o=>{s.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(db),t.writeKey(this.nodeName)}}const X0=e=>new Tr(e.readKey());class J0 extends Wi{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Ji extends _r{constructor(t){super(),this.hookName=t}_copy(){return new Ji(this.hookName)}clone(){const t=new Ji(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const s=n[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(gb),t.writeKey(this.hookName)}}const Q0=e=>new Ji(e.readKey());class Qi extends Bn{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Qi}clone(){const t=new Qi;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{const n=[];for(const s in t.attributes){const i=[];for(const o in t.attributes[s])i.push({key:o,value:t.attributes[s][o]});i.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:s,attrs:i})}n.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const i=n[s];r+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(mb)}}const Z0=e=>new Qi;class Oc{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Oe()}mergeWith(t){return!1}write(t,n,r){throw Oe()}integrate(t,n){throw Oe()}}const tb=0;class ne extends Oc{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),ap(t.doc.store,this)}write(t,n){t.writeInfo(tb),t.writeLen(this.length-n)}getMissing(t,n){return null}}class _s{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new _s(this.content)}splice(t){throw Oe()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const eb=e=>new _s(e.readBuf());class ys{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ys(this.len)}splice(t){const n=new ys(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){$i(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const nb=e=>new ys(e.readLen()),Mp=(e,t)=>new dr({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ts{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ts(Mp(this.doc.guid,this.opts))}splice(t){throw Oe()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const rb=e=>new Ts(Mp(e.readString(),e.readAny()));class jn{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new jn(this.embed)}splice(t){throw Oe()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const sb=e=>new jn(e.readJSON());class Et{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Et(this.key,this.value)}splice(t){throw Oe()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const ib=e=>new Et(e.readKey(),e.readJSON());class Zi{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Zi(this.arr)}splice(t){const n=new Zi(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const ob=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new Zi(n)};class Kn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Kn(this.arr)}splice(t){const n=new Kn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];t.writeAny(i)}}getRef(){return 8}}const ab=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Kn(n)};class Ue{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ue(this.str)}splice(t){const n=new Ue(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const cb=e=>new Ue(e.readString()),lb=[G0,K0,Y0,X0,q0,Q0,Z0],ub=0,hb=1,fb=2,db=3,pb=4,gb=5,mb=6;class tn{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new tn(this.type._copy())}splice(t){throw Oe()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Eb=e=>new tn(lb[e.readTypeRef()](e)),to=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new _t(G(r,s+n),t,G(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),t.redone!==null&&(i.redone=G(t.redone.client,t.redone.clock+n)),t.right=i,i.right!==null&&(i.right.left=i),e._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),t.length=n,i};class _t extends Oc{constructor(t,n,r,s,i,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Sd:0}set marker(t){(this.info&Za)>0!==t&&(this.info^=Za)}get marker(){return(this.info&Za)>0}get keep(){return(this.info&Td)>0}set keep(t){this.keep!==t&&(this.info^=Td)}get countable(){return(this.info&Sd)>0}get deleted(){return(this.info&Qa)>0}set deleted(t){this.deleted!==t&&(this.info^=Qa)}markDeleted(){this.info|=Qa}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=St(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=St(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===gr&&this.id.client!==this.parent.client&&this.parent.clock>=St(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=cp(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=mn(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ne||this.right&&this.right.constructor===ne)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===_t&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===_t&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===gr){const r=Tc(n,this.parent);r.constructor===ne?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=cp(t,t.doc.store,G(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Bi(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Bi(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(Tc(t.doc.store,s.origin)))i.has(Tc(t.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ap(t.doc.store,this),this.content.integrate(t,this),hp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ne(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:G(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Bi(t.origin,this.lastId)&&this.right===t&&Bi(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),$i(t.deleteSet,this.id.client,this.id.clock,this.length),hp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw ke();this.content.gc(t),n?w0(t,this,new ne(this.id,this.length)):this.content=new ys(this.length)}write(t,n){const r=n>0?G(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&Mi|(r===null?0:Wt)|(s===null?0:Je)|(i===null?0:as);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=A0(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===gr?(t.writeParentInfo(!1),t.writeLeftID(a)):ke();i!==null&&t.writeString(i)}this.content.write(t,n)}}const xp=(e,t)=>_b[t&Mi](e),_b=[()=>{ke()},nb,ob,eb,cb,sb,ib,Eb,ab,rb,()=>{ke()}],yb=10;class re extends Oc{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){ke()}write(t,n){t.writeInfo(yb),D(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Up=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Pp="__ $YJS$ __";Up[Pp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Up[Pp]=!0;const kc=0,Dp=1,Fp=2,Tb=(e,t)=>{D(e,kc);const n=T0(t);Lt(e,n)},$p=(e,t,n)=>{D(e,Dp),Lt(e,m0(t,n))},Sb=(e,t,n)=>$p(t,n,Ut(e)),Bp=(e,t,n)=>{try{d0(t,Ut(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Ab=(e,t)=>{D(e,Fp),Lt(e,t)},wb=Bp,Rb=(e,t,n,r)=>{const s=F(e);switch(s){case kc:Sb(e,t,n);break;case Dp:Bp(e,n,r);break;case Fp:wb(e,n,r);break;default:throw new Error("Unknown message type")}return s},Sr={},Mc={},xc={},Ss={},Pe=Nr("shared",["second"],e=>{switch(e.target){case"second":Object.keys(xc).forEach(t=>{const n=Ss[t];n===void 0?Pe.emit("shared:join",t):n<10?Ss[t]=n+1:delete Ss[t]}),Object.keys(Mc).forEach(t=>{Pe.emit("shared:active",t)});break;case"join":{const t=e.data,n=Sr[t];if(n&&Mc[t]){Pe.reply(e,"joinack",t);const r=pn();Tb(r,n),Pe.reply(e,"sync",no(t,r));const s=pn();$p(s,n),Pe.reply(e,"sync",no(t,s))}break}case"joinack":{const t=e.data;Sr[t]&&xc[t]&&(Ss[t]=0);break}case"active":{const t=e.data;Sr[t]&&xc[t]&&(Ss[t]=0);break}case"sync":{const[t,n,r]=e.data,s=Sr[n];if(s&&t!==Pe.id()){const i=Fn(r),o=pn();if(Rb(i,o,s,Pe)===kc){const c=no(n,o);Pe.emit("shared:sync",c)}}break}}});function vb(e){let t=Sr[e];if(t)return t;Sr[e]=t=new dr({guid:e});function n(r){const s=pn();Ab(s,r),Pe.emit("shared:sync",no(e,s))}return t.on("update",n),t.on("destroy",()=>{t==null||t.off("update",n)}),t}function eo(e){return vb(e).getMap()}function no(e,t){const n=ge(t);return[Pe.id()??"",e,n]}function Gp(e,t){const n=e.get(t);return n!=null&&n.toJSON?n.toJSON():n}function jp(e,t,n){typeof n=="string"?e.set(t,new Bn(n)):e.set(t,n)}function Nb(e,t,n){Mc[e]=!0;const r=eo(e);r.get(t)===void 0&&n!==void 0&&jp(r,t,n)}function bb(e,t,n){const r=eo(e),s=Gp(r,t);(s===void 0||n!==s)&&jp(r,t,n)}function Lb(e,t,n){const r=eo(e);function s(){n(Gp(r,t))}function i(o){o.keysChanged.has(t)&&s()}return s(),r.observe(i),()=>{r.unobserve(i)}}function Cb(e,t,n){const r=eo(e);let s=r.get(t);function i(){n(s)}function o(c){c.keysChanged.has(t)&&s===void 0&&a(),s&&r.unobserve(o)}function a(){s=r.get(t),s?(s.observeDeep(i),i()):r.observe(o)}return a(),()=>{s?s.unobserveDeep(i):r.unobserve(o)}}const yn={};function Kp(e,t){return e.player=t,e.layers=[],e.layout=[],e.layoutreset=!0,e.layoutfocus="scroll",e}function Wp(e){e.text=[],Object.values(yn[e.id]??{}).forEach(t=>t==null?void 0:t()),yn[e.id]={}}function Hp(e){const t=e.layout.find(n=>n.name===e.layoutfocus);if(!t){const n={id:$e(),name:e.layoutfocus,edge:Vt.RIGHT,size:20,text:[]};return e.layout.push(n),e.layoutreset=!1,n}return t}const Uc={},Ib=new Set(["hk","hotkey","rn","range","sl","select","nm","number","tx","text"]),Ob=new Set(["rn","range","sl","select","nm","number","tx","text"]),kb=new Set(["tx","text"]),Mb={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:""};function Wn(e){let t=Uc[e];return E(t)?t:Uc[e]=t=Kp({},e)}function xb(){return Object.keys(Uc)}function Ub(e){const t=Wn(e);t.layout=t.layout.filter(n=>n.edge!==Vt.SCROLL)}function Pb(e,t,n){Object.values(yn).forEach(r=>{r[t]!==void 0&&bb(e.id(),t,n)})}function Db(e){const t=Wn(e.id());t.layout=t.layout.filter(n=>n.edge!==Vt.SCROLL||n.text.length>0)}function Pc(e,t,n,r,s){const i=Wn(e.id()),o=r,a=s??Jv.capital(t),c=i.layout.find(l=>l.name===a);if(c)i.layoutreset=!0,i.layoutfocus=a,Nt(o)&&(c.size=o);else switch(n){case Vt.START:Kp(i,e.id());break;case Vt.LEFT:case Vt.RIGHT:case Vt.TOP:case Vt.BOTTOM:case Vt.SCROLL:{const l={id:$e(),name:a,edge:n,size:o??vg[n],text:[]};i.layout.push(l),i.layoutfocus=a;break}}}function Fb(e,t){const n=Wn(e.id()),r=Hp(n);n.layoutreset&&(n.layoutreset=!1,Wp(r)),r.text.push(t)}function $b(e,t,n,r){const s=Wn(e.id()),i=Hp(s);s.layoutreset&&(s.layoutreset=!1,Wp(i));const o=n.toLowerCase(),a=[e.id(),t,...Ib.has(o)?[o]:["hypertext",n],...r],c=a[2];if(Ob.has(c)){const l=`${a[3]??""}`;yn[i.id]=yn[i.id]??{};const u=e.get(l);yn[i.id][l]===void 0&&(Nb(e.id(),l,u??Mb[c]),kb.has(c)?yn[i.id][l]=Cb(e.id(),l,h=>{if(h!==void 0){const d=h.toJSON();d!==e.get(l)&&e.set(l,d)}}):yn[i.id][l]=Lb(e.id(),l,h=>{h!==void 0&&h!==e.get(l)&&e.set(l,h)}))}i.text.push(a)}const Bb=Ja({get(e,t){return[!1,void 0]},set(e,t,n){return[!1,void 0]},shouldtick(e){},tick(e){},tock(e){}}).command("clear",(e,t)=>{const n=Xe(t[0]);return e.set(n,void 0),0}).command("end",e=>(e.endofprogram(),0)).command("give",(e,t)=>{const[n,r,s]=L(O(e,t),0,[N.STRING,N.MAYBE_NUMBER]),i=e.get(n),o=Nt(i)?i:0,a=r??1;if(!Nt(a))return 0;const c=i===void 0?1:0;return c&&s<t.length&&e.command(...t.slice(s)),e.set(n,o+a),c}).command("idle",e=>(e.yield(),0)).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Xe(t[0])),0)).command("set",(e,t)=>{const[n,r]=L(O(e,t),0,[N.STRING,N.ANY]);return e.set(n,r),0}).command("take",(e,t)=>{const[n,r,s]=L(O(e,t),0,[N.STRING,N.MAYBE_NUMBER]),i=e.get(n),o=r??1;if(!Nt(i))return 1;const a=i-o;return a<0?(s<t.length&&e.command(...t.slice(s)),1):(e.set(n,a),0)}).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Xe(t[0])),0)).command("text",(e,t)=>{const n=t.map(Xe).join("");return Fb(e,n),0}).command("hyperlink",(e,t)=>{const[n,r,...s]=t,i=Xe(n),o=Xe(r);return $b(e,i,o,s),0}),Gb=Ja({get(){return[!1,void 0]},set(e,t,n){return Pb(e,t,n),[!1,void 0]},shouldtick(){},tick(e){var r,s;const t=Z(e.id()),n=((r=t.object)==null?void 0:r.name)??((s=t.object)==null?void 0:s.kind)??"Scroll";Pc(e,"scroll",Vt.SCROLL,void 0,n)},tock(e){Db(e)}}).command("register",(e,t)=>{var o,a;const r=((a=(o=Z(e.id()).object)==null?void 0:o.stats)==null?void 0:a.player)??"",[s,i]=L(O(e,t),0,[N.STRING,N.STRING]);switch(s.toLowerCase()){case"read":Og(e.senderid(),i,r);break;case"write":kg(e.senderid(),i,e.get(i),r);break;default:Vn(e.senderid(),"register",`unknown #regsiter [action] ${s}`,r);break}return 0}).command("color",(e,t)=>{const n=Z(e.id()),[r]=L(O(e,t),0,[N.COLOR]);return E(n.object)&&E(r)&&Cs(n.object,r),0}).command("gadget",(e,t)=>{const n=O(e,t),[r]=L(n,0,[N.STRING]),s=Rg[r.toLowerCase()];if(s===Vt.SCROLL){const[,i,o]=L(n,0,[N.STRING,N.MAYBE_STRING,N.MAYBE_NUMBER]);Pc(e,r,s,o,i)}else{const[,i,o]=L(n,0,[N.STRING,N.MAYBE_NUMBER,N.MAYBE_STRING]);Pc(e,r,s,i,o)}return 0}).command("book",(e,t)=>{const[n,r]=L(O(e,t),0,[N.STRING,N.STRING]),s=n.toLowerCase();switch(r.toLowerCase()){case"create":IR(mR(s,[qr("@board title",{board:cm(o=>o)}),qr("@terrain dirt",{terrain:{char:176,bg:V.BLACK,color:V.DKYELLOW,collision:ht.WALK}}),qr("@terrain dirt2",{terrain:{char:176,bg:V.BLACK,color:V.DKGRAY,collision:ht.WALK}}),qr("@terrain wall",{terrain:{char:177,bg:V.DKGREEN,color:V.GREEN,collision:ht.SOLID}}),qr("@terrain wall2",{terrain:{char:176,bg:V.DKGREEN,color:V.GREEN,collision:ht.SOLID}})]));break}return 0}).command("frame",(e,t)=>{var c;const n=Z(e.id()),[r,s,i]=L(O(e,t),0,[N.STRING,N.MAYBE_STRING,N.MAYBE_STRING]),o=((c=n.board)==null?void 0:c.id)??"",a=r.toLowerCase();if(a==="reset")Of(o);else if(E(s)&&E(i))switch(s.toLowerCase()){case"edit":LR(o,a,i);break;case"view":bR(o,a,i);break}return 0});function Dc(e,t){if(!(!E(e)||!E(t))){E(e.stats)||(e.stats={});for(const[n,r]of Object.entries(t)){const s=n.toLowerCase();e.stats[s]=r}}}function jb(e,t,n,r){if(E(e)&&E(t)&&E(n)){const[s,i]=n,o=yi(e,s);if(E(o)&&E(o.name)){const a=hl(t,r,s);return E(a)&&(a.headless=!0,Cs(a,i),Ua(e,t,a)),a}}}function ro(e,t,n,r){if(E(e)&&E(t)&&E(n)){const[s,i]=n,o=Nf(e,s);if(E(o)){const c=ul(t,r,s);Cs(c,i);const l=r.x+r.y*t.width;return Ua(e,t,c,l),c}const a=yi(e,s);if(E(a)&&E(a.name)){const c=hl(t,r,s);return Cs(c,i),AR(e,t,c),Ua(e,t,c),c}}}const Vp=new Set(["cycle","player","sender","inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu","data"]),Kb=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]);function Wb(e){const t=fl[e];if(E(t))return t;const n=ml[e];if(E(n))return n;const r=_l[e];if(E(r))return r;const s=Cl[e];if(E(s))return s}const Hb=["NORTH","SOUTH","WEST","EAST"];function Vb(e){const t=Z(e.id??"");if(t.inputcurrent!==void 0)return;const[n=dt.NONE]=t.inputqueue;e.stats===void 0&&(e.stats={}),e.stats.inputmove=[],e.stats.inputok=0,e.stats.inputcancel=0,e.stats.inputmenu=0;const r=t.inputmods[n];switch(e.stats.inputalt=r&Ng?1:0,e.stats.inputctrl=r&bg?1:0,e.stats.inputshift=r&Lg?1:0,n){case dt.MOVE_UP:case dt.MOVE_DOWN:case dt.MOVE_LEFT:case dt.MOVE_RIGHT:e.stats.inputmove=[Hb[n-dt.MOVE_UP]];break;case dt.OK_BUTTON:e.stats.inputok=1;break;case dt.CANCEL_BUTTON:e.stats.inputcancel=1;break;case dt.MENU_BUTTON:e.stats.inputmenu=1;break}t.inputcurrent=n,t.inputqueue.delete(n)}function Ar(e,t,n,r){const s=st(t)?t:t.id,i=st(t)?void 0:{x:t.x??0,y:t.y??0},o=st(n)?n:n.id,a=s??i;E(o)&&E(a)&&e.send(o,r,a)}function zp(e,t,n,r){E(n==null?void 0:n.id)?(n.headless=!0,Ti(e,t,n)):ul(t,r,"empty")}function Yp(e,t,n,r,s){const i=SR(t,n,r,s);if(E(i)){Ar(e,i,e.id(),"thud"),r.kind==="player"?Ar(e,e.id(),i,"touch"):r.collision===ht.BULLET?Ar(e,e.id(),i,"shot"):Ar(e,e.id(),i,"bump");const o=Le(t,i);return(i.destructible??(o==null?void 0:o.destructible))&&zp(t,n,i,s),!1}return!0}function Fc(e,t){if(st(e)){const n=e.toLowerCase();switch(n){case"edit":return[n,t+1]}}return[void 0,t]}function $c(e,t,n){let r;const s=Si((t==null?void 0:t.id)??"");switch(n){case"edit":{r=s.find(a=>a.type===Jr.EDIT);break}}const i=r?Qr((r==null?void 0:r.book)??""):e,o=r?sr(i,(r==null?void 0:r.board)??""):t;return{maybebook:i,maybeboard:o}}const zb=Ja({get(e,t){var o;const n=Wb(t);if(E(n))return[!0,n];const r=Z(e.id());if(r.object){Kb.has(t)&&Vb(r.object);const a=(o=r.object.stats)==null?void 0:o[t];if(E(a)||Vp.has(t))return[!0,a]}const s=r.board?Ro(r.board,r.object):void 0,i=ER(r.book,(s==null?void 0:s.id)??"",t);return[E(i),i]},set(e,t,n){var i,o;const r=Z(e.id());if(E(r.object)&&(E((o=(i=r.object)==null?void 0:i.stats)==null?void 0:o[t])||Vp.has(t)))return r.object.stats||(r.object.stats={}),r.object.stats[t]=n,[!0,n];const s=r.board?Ro(r.board,r.object):void 0;return _R(r.book,(s==null?void 0:s.id)??"",t,n),[!0,n]},shouldtick(e){var n,r,s,i,o,a;const t=Z(e.id());!E((n=t.object)==null?void 0:n.x)||!E((r=t.object)==null?void 0:r.y)||!E((i=(s=t.object)==null?void 0:s.stats)==null?void 0:i.stepx)||!E((a=(o=t.object)==null?void 0:o.stats)==null?void 0:a.stepy)||Yp(e,t.book,t.board,t.object,{x:t.object.x+t.object.stats.stepx,y:t.object.y+t.object.stats.stepy})||Dc(t.object,{stepx:0,stepy:0})},tick(){},tock(e){var n;(n=Z(e.id()).object)!=null&&n.headless&&e.command("die")}}).command("become",(e,t)=>{var i,o;const n=Z(e.id()),r={x:((i=n.object)==null?void 0:i.x)??0,y:((o=n.object)==null?void 0:o.y)??0},[s]=L(O(e,t),0,[N.KIND]);return Xr(n.book,n.board),Ti(n.book,n.board,n.object),Pa(n.book,n.object,e.timestamp())&&ro(n.book,n.board,s,r),e.endofprogram(),0}).command("bind",(e,t)=>0).command("change",(e,t)=>{const n=Z(e.id()),[r,s]=Fc(t[0],0),[i,o]=L(O(e,t),s,[N.KIND,N.KIND]),{maybebook:a,maybeboard:c}=$c(n.book,n.board,r);Xr(a,c);const l=No(i)??"",u=To(c,l),h=im(u,i),d=No(o),f=bl(o),m=Ll(o);return h.forEach(_=>{if(ir(a,_)===d)E(f)&&(_.color=f),E(m)&&(_.bg=m);else{if(E(_.id))switch(Ti(a,c,_),r){case"edit":if(!wo(c,_.id))return;break;default:if(!Pa(a,_,e.timestamp()))return;break}_e(_)&&ro(a,c,o,_)}}),0}).command("char",(e,t)=>{const n=Z(e.id()),[r]=L(O(e,t),0,[N.NUMBER]);return E(n.object)&&(n.object.char=r),0}).command("cycle",(e,t)=>{const[n]=L(O(e,t),0,[N.NUMBER]);return e.cycle(An(Math.round(n),1,255)),0}).command("die",e=>{var n;const t=Z(e.id());return(n=t.object)!=null&&n.headless&&Ti(t.book,t.board,t.object),Pa(t.book,t.object,e.timestamp()),e.endofprogram(),0}).command("endgame",e=>(e.set("health",0),0)).command("go",(e,t)=>{const n=Z(e.id());if(!E(n.object))return 1;const[r]=L(O(e,t),0,[N.DIR]);return Yp(e,n.book,n.board,n.object,r),n.object.x!==r.x&&n.object.y!==r.y?1:0}).command("play",(e,t)=>{const[n]=L(O(e,t),0,[N.STRING]),r=e.get(n);return st(r)?e.emit("pcspeaker:play",[-1,r]):e.emit("pcspeaker:play",[-1,n]),0}).command("put",(e,t)=>{const n=Z(e.id()),[r,s]=Fc(t[0],0),[i,o]=L(O(e,t),s,[N.DIR,N.KIND]),{maybebook:a,maybeboard:c}=$c(n.book,n.board,r);return Xr(a,c),ro(a,c,o,i),0}).command("send",(e,t)=>{var h,d;const n=Z(e.id()),[r,s]=L(O(e,t),0,[N.STRING,N.ANY]),[i,o]=r.split(":"),a=E(o)?i:"self",c=o??i;function l(f){f.forEach(m=>{E(m.id)&&e.send(m.id,c,s)})}const u=a.toLowerCase();switch(u){case"all":for(const f of Object.keys(((h=n.board)==null?void 0:h.objects)??{}))e.send(f,c,s);break;case"self":e.send(e.id(),c,s);break;case"others":for(const f of Object.keys(((d=n.board)==null?void 0:d.objects)??{}))f!==e.id()&&e.send(f,c,s);break;case"player":break;default:{l(So(n.board,[a]));const f=e.get(u);Array.isArray(f)?l(So(n.board,f)):l(So(n.board,[f]));break}}return 0}).command("shoot",(e,t)=>{const n=Z(e.id());if(!_e(n.object))return 0;const[r,s]=Fc(t[0],0),[i,o]=L(O(e,t),s,[N.DIR,N.MAYBE_KIND]),{maybebook:a,maybeboard:c}=$c(n.book,n.board,r),l=sn(n.object,i),u=zt({x:0,y:0},l),h=zt({x:n.object.x,y:n.object.y},l);Xr(a,c);let d=um(c,h);if(E(d)&&!E(d.id)){const f=Le(a,n.object),m=Le(a,d);ol(d.collision??(f==null?void 0:f.collision),d.collision??(m==null?void 0:m.collision))||(d=void 0)}if(E(d)){E(d.id)&&Ar(e,e.id(),d,"shot");const f=Le(a,d);(d.destructible??(f==null?void 0:f.destructible))&&zp(a,c,d,h);const m=jb(a,c,o??["bullet"],h);E(m)&&(m.collision=ht.BULLET,Ar(e,d,e.id(),"thud"))}else{const f=ro(a,c,o??["bullet"],h);E(f)&&(f.collision=ht.BULLET,Dc(f,{stepx:u.x,stepy:u.y}))}return e.yield(),0}).command("throwstar",(e,t)=>e.command("shoot",...t,"star")?1:0).command("try",(e,t)=>{const[,n]=L(O(e,t),0,[N.DIR]);return e.command("go",...t)&&n<t.length&&e.command(...t.slice(n)),e.yield(),0}).command("walk",(e,t)=>{const n=Z(e.id());if(!_e(n.object))return 0;const[r]=L(O(e,t),0,[N.DIR]),s=sn(n.object,r),i=zt({x:0,y:0},s);return Dc(n.object,{stepx:i.x,stepy:i.y}),0}).command("stat",(e,t)=>{const n=Z(e.id());return n.object&&(n.object.name=t.map(Xe).join(" ")),0}),Yb={all:Bb,zzt:zb,zss:Gb},qb={[at.ERROR]:[],[at.FUNC]:["all"],[at.BOARD]:["all"],[at.OBJECT]:["all","zss","zzt"],[at.TERRAIN]:["all"],[at.CHARSET]:["all"],[at.PALETTE]:["all"]};function Xb(e,t){(qb[t]??[]).forEach(r=>e.install(Yb[r]))}function Bc(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset||0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];Array.isArray(r)?r.forEach(s=>{t.push(Bc(s))}):t.push(Bc(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)||0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)||0))},e.range}function Jb(e){const t=Oa(`${e}
`);if(t.errors.length>0)return{errors:t.errors,tokens:[]};is.input=t.tokens;const n=is.program();if(is.errors.length>0)return{tokens:t.tokens,errors:is.errors};const r=Bv.visit(n);return r?(Bc(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:["no ast output"]}}const Gc=Object.getPrototypeOf(function*(){}).constructor;function Qb(e){const t=Jb(e);if(t.errors&&t.errors.length>0)return t;if(!t.ast)return{...t,errors:["no ast output"]};const n=Vv(t.ast);if(n.code){aR&&console.info(n.code);try{return{...t,...n,source:n.code,code:new Gc("api",n.code)}}catch(r){return{errors:[{message:r.message}],source:"there was an error",code:new Gc("api"," ")}}}return{...t,...n,source:"there was an error",code:new Gc("api"," ")}}function Zb(){const e={},t={};function n(s){const i=e[s];if(i)return i;const o=Qb(s);return e[s]=o,o}return{ids(){return Object.keys(t)},has(s){return E(t[s])},halt(s){const i=t[s];return i&&delete t[s],!!i},tick(s,i,o,a){var l;let c=t[s];if(!E(t[s])){const u=n(a);if((l=u.errors)!=null&&l.length)return Vn("os","build",JSON.stringify(u.errors),""),!1;c=t[s]=qv(s,u),Xb(c,i)}return!!(c!=null&&c.tick(o))},message(s){const{target:i,path:o}=Jc(s.target),a=t[i];E(a)&&a.message({...s,target:o})}}}const tL=Xc(ao.numbers,4),eL=Xc(`${ao.numbers}${ao.lowercase}`,16),jc=`pid_${tL()}_${eL()}`;NR(jc);const Kc=Zb();let Wc=0;const nL=32,wr={},en=Nr("vm",["tick","second"],e=>{switch(e.target){case"mem":e.player===jc&&(CR(e.data),co(en.name(),"ackmem",e.player),en.emit("ackmem",void 0,e.player));break;case"login":e.player&&OR(e.player)&&(wr[e.player]=0,co(en.name(),"acklogin",e.player),en.emit("acklogin",void 0,e.player));break;case"doot":e.player&&(wr[e.player]=0,Mg(en.name(),e.player,"active"),en.emit("doot",void 0,e.player));break;case"input":if(e.player){const t=Z(e.player),[n=dt.NONE,r=0]=e.data??{};t.inputqueue.add(n),t.inputmods[n]=r}break;case"tick":Wc=e.data??0,MR(Kc,Wc);break;case"second":Object.keys(wr).forEach(t=>{++wr[t],wr[t]>=nL&&(delete wr[t],kR(t),co(en.name(),"logout",t),en.emit("logout",void 0,t))});break;case"cli":xR(Kc,Wc,e.player??"",e.data??"");break;default:Kc.message(e);break}});function rL(){en.emit("ready",void 0,jc)}const Hc=Nr("clock",[],()=>{});let Vc=0,qp=performance.now(),zc=0,so=0;function sL(){Hc.emit("tick",so),Hc.emit("tock",so),++zc,++so,zc>=Co&&(zc%=Co,Hc.emit("second",so))}function Xp(){const e=performance.now(),t=e-qp;Vc+=t,Vc>=Lo&&(Vc%=Lo,sL()),qp=e,setTimeout(Xp)}Xp();const Jp={},Qp=Nr("gadgetserver",["tock"],e=>{switch(e.target){case"tock":xb().forEach(t=>{const n=Wn(t);n.layers=PR(t);const r=_o(Jp[t]??{},n);r.length&&(Jp[t]=It(n),Ig(Qp.name(),r,t))});break;case"desync":if(e.player){const t=Wn(e.player);Cg(Qp.name(),t,e.player)}break;case"clearscroll":e.player&&Ub(e.player);break}}),iL=hg(e=>postMessage(e));onmessage=function(t){iL(t.data)},queueMicrotask(rL)})();

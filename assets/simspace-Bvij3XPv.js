var Y$=Object.defineProperty;var V$=(fi,Xn,Ln)=>Xn in fi?Y$(fi,Xn,{enumerable:!0,configurable:!0,writable:!0,value:Ln}):fi[Xn]=Ln;var Et=(fi,Xn,Ln)=>V$(fi,typeof Xn!="symbol"?Xn+"":Xn,Ln);(function(){"use strict";const fi=new Set,Xn={emit(e,t,n,r,i){Xn.invoke(UE(e,t,n,r,i))},invoke(e){fi.forEach(t=>t.handle(e))},connect(e){fi.add(e)},disconnect(e){fi.delete(e)}};var Ln=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Us(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function tE(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var Fd={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Ln,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var f=function(){var d=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=d-(c=d|0)};return f.next=f,f.uint32=function(){return f()*4294967296},f.fract53=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.version="Alea 0.9",f.args=i,f.exportState=function(){return[s,o,a,c]},f.importState=function(d){s=+d[0]||0,o=+d[1]||0,a=+d[2]||0,c=+d[3]||0},f}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Fd);var eE=Fd.exports,Bd=Us(eE),Pd={};(function(e){var t=Ln&&Ln.__spreadArray||function(l,u,f){if(f||arguments.length===2)for(var d=0,h=u.length,m;d<h;d++)(m||!(d in u))&&(m||(m=Array.prototype.slice.call(u,0,d)),m[d]=u[d]);return l.concat(m||Array.prototype.slice.call(u))};Object.defineProperty(e,"__esModule",{value:!0}),e.minLength=e.maxLength=e.poolSize=e.humanId=e.adverbs=e.verbs=e.nouns=e.adjectives=void 0,e.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],e.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],e.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],e.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,f){return u.length>f.length?u:f})}function i(l){return l.reduce(function(u,f){return u.length<f.length?u:f})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,f=u===void 0?"":u,d=l.capitalize,h=d===void 0?!0:d,m=l.adjectiveCount,p=m===void 0?1:m,b=l.addAdverb,y=b===void 0?!1:b,v=t(t(t([],t([],Array(p),!0).map(function(T){return n(e.adjectives)}),!0),[n(e.nouns),n(e.verbs)],!1),y?[n(e.adverbs)]:[],!0);return h&&(v=v.map(function(T){return T.charAt(0).toUpperCase()+T.substr(1)})),v.join(f)}e.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d;return e.adjectives.length*f*e.nouns.length*e.verbs.length*(h?e.adverbs.length:1)}e.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return r(e.adjectives).length*f+f*p.length+r(e.nouns).length+p.length+r(e.verbs).length+(h?r(e.adverbs).length+p.length:0)}e.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,f=u===void 0?1:u,d=l.addAdverb,h=d===void 0?!1:d,m=l.separator,p=m===void 0?"":m;return i(e.adjectives).length*f+f*p.length+i(e.nouns).length+p.length+i(e.verbs).length+(h?i(e.adverbs).length+p.length:0)}e.minLength=c,e.default=s})(Pd);var $d=Us(Pd);const nE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let rE=e=>crypto.getRandomValues(new Uint8Array(e)),iE=(e,t,n)=>{let r=(2<<Math.log2(e.length-1))-1,i=-~(1.6*r*t/e.length);return(s=t)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=e[a[c]&r]||"",o.length===s)return o}}},Dd=(e,t=21)=>iE(e,t,rE),sE=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=nE[n[e]&63];return t};var jd="abcdefghijklmnopqrstuvwxyz",zd="ABCDEFGHIJKLMNOPQRSTUVWXYZ",Wd="0123456789",oE="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",aE="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const cE=Wd,lE=jd,uE=zd;var hE=cE+lE+uE,ru={lowercase:jd,uppercase:zd,numbers:Wd,nolookalikes:oE,nolookalikesSafe:aE,alphanumeric:hE};function De(){return`sid_${sE(12).replaceAll("-",".")}`}Dd(ru.numbers,4),Dd(`${ru.numbers}${ru.lowercase}`,16);function _n(e){return(e==null?void 0:e.startsWith("pid_"))??!1}function fE(){return $d({capitalize:!1,adjectiveCount:1})}function dE(){return $d({addAdverb:!1,capitalize:!1,adjectiveCount:0})}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var pE=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),mE=Object.prototype.hasOwnProperty;function iu(e,t){return mE.call(e,t)}function su(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)iu(e,i)&&r.push(i);return r}function Mn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ou(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function is(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Gd(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function au(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(au(e[t]))return!0}else if(typeof e=="object"){for(var r=su(e),i=r.length,s=0;s<i;s++)if(au(e[r[s]]))return!0}}return!1}function Kd(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var Hd=function(e){pE(t,e);function t(n,r,i,s,o){var a=this.constructor,c=e.call(this,Kd(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Kd(n,{name:r,index:i,operation:s,tree:o}),c}return t}(Error),Fe=Hd,gE=Mn,Fs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=za(n,this.path);r&&(r=Mn(r));var i=ss(n,{op:"remove",path:this.from}).removed;return ss(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=za(n,this.from);return ss(n,{op:"add",path:this.path,value:Mn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Mo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},_E={add:function(e,t,n){return ou(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Fs.move,copy:Fs.copy,test:Fs.test,_get:Fs._get};function za(e,t){if(t=="")return e;var n={op:"_get",path:t};return ss(e,n),n.value}function ss(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Wa(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=za(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Mo(e,t.value),o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Mn(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,h=void 0,m=void 0;for(typeof n=="function"?m=n:m=Wa;;){if(h=c[u],h&&h.indexOf("~")!=-1&&(h=Gd(h)),i&&(h=="__proto__"||h=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&m(t,0,e,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!ou(h))throw new Fe("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);ou(h)&&(h=~~h)}if(u>=f){if(n&&t.op==="add"&&h>l.length)throw new Fe("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=_E[t.op].call(t,l,h,e);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Fs[t.op].call(t,l,h,e);if(o.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[h],n&&u<f&&(!l||typeof l!="object"))throw new Fe("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function cu(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Mn(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=ss(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function yE(e,t,n){var r=ss(e,t);if(r.test===!1)throw new Fe("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function Wa(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Fe("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Fs[e.op]){if(typeof e.path!="string")throw new Fe("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Fe('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Fe("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&au(e.value))throw new Fe("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Fe("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Fe("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=Yd([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Fe("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Fe("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function Yd(e,t,n){try{if(!Array.isArray(e))throw new Fe("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)cu(Mn(t),Mn(e),n||!0);else{n=n||Wa;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Fe)return i;throw i}}function Mo(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!Mo(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!Mo(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}var bE=Object.freeze({__proto__:null,JsonPatchError:Fe,_areEquals:Mo,applyOperation:ss,applyPatch:cu,applyReducer:yE,deepClone:gE,getValueByPointer:za,validate:Yd,validator:Wa});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var lu=new WeakMap,kE=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),wE=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function EE(e){return lu.get(e)}function xE(e,t){return e.observers.get(t)}function vE(e,t){e.observers.delete(t.callback)}function TE(e,t){t.unobserve()}function AE(e,t){var n=[],r,i=EE(e);if(!i)i=new kE(e),lu.set(e,i);else{var s=xE(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Mn(e),t){r.callback=t,r.next=null;var o=function(){uu(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){uu(r),clearTimeout(r.next),vE(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new wE(t,r)),r}function uu(e,t){t===void 0&&(t=!1);var n=lu.get(e.object);hu(n.value,e.object,e.patches,"",t),e.patches.length&&cu(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function hu(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=su(t),o=su(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(iu(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?hu(u,f,n,r+"/"+is(l),i):u!==f&&(i&&n.push({op:"test",path:r+"/"+is(l),value:Mn(u)}),n.push({op:"replace",path:r+"/"+is(l),value:Mn(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+is(l),value:Mn(u)}),n.push({op:"remove",path:r+"/"+is(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!iu(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+is(l),value:Mn(t[l])})}}}function Vd(e,t,n){n===void 0&&(n=!1);var r=[];return hu(e,t,r,"",n),r}var SE=Object.freeze({__proto__:null,compare:Vd,generate:uu,observe:AE,unobserve:TE});Object.assign({},bE,SE,{JsonPatchError:Hd,deepClone:Mn,escapePathComponent:is,unescapePathComponent:Gd});var RE=typeof Element<"u",OE=typeof Map=="function",NE=typeof Set=="function",IE=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Ga(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Ga(e[r],t[r]))return!1;return!0}var s;if(OE&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;for(s=e.entries();!(r=s.next()).done;)if(!Ga(r.value[1],t.get(r.value[0])))return!1;return!0}if(NE&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(s=e.entries();!(r=s.next()).done;)if(!t.has(r.value[0]))return!1;return!0}if(IE&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(e[r]!==t[r])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(i=Object.keys(e),n=i.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,i[r]))return!1;if(RE&&e instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&e.$$typeof)&&!Ga(e[i[r]],t[i[r]]))return!1;return!0}return e!==e&&t!==t}var CE=function(t,n){try{return Ga(t,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},LE=Us(CE);function k(e){return e!=null}const qn=Object.keys;function wr(e){return Mn(e)}function ME(e){return typeof e=="boolean"}function xt(e){return typeof e=="number"&&isNaN(e)===!1}function yt(e){return typeof e=="string"}function ue(e){return Array.isArray(e)}function fu(e){return e}var Ot=(e=>(e[e.BLACK=0]="BLACK",e[e.DKBLUE=1]="DKBLUE",e[e.DKGREEN=2]="DKGREEN",e[e.DKCYAN=3]="DKCYAN",e[e.DKRED=4]="DKRED",e[e.DKPURPLE=5]="DKPURPLE",e[e.DKYELLOW=6]="DKYELLOW",e[e.LTGRAY=7]="LTGRAY",e[e.DKGRAY=8]="DKGRAY",e[e.BLUE=9]="BLUE",e[e.GREEN=10]="GREEN",e[e.CYAN=11]="CYAN",e[e.RED=12]="RED",e[e.PURPLE=13]="PURPLE",e[e.YELLOW=14]="YELLOW",e[e.WHITE=15]="WHITE",e[e.ONBLACK=16]="ONBLACK",e[e.ONDKBLUE=17]="ONDKBLUE",e[e.ONDKGREEN=18]="ONDKGREEN",e[e.ONDKCYAN=19]="ONDKCYAN",e[e.ONDKRED=20]="ONDKRED",e[e.ONDKPURPLE=21]="ONDKPURPLE",e[e.ONDKYELLOW=22]="ONDKYELLOW",e[e.ONLTGRAY=23]="ONLTGRAY",e[e.ONDKGRAY=24]="ONDKGRAY",e[e.ONBLUE=25]="ONBLUE",e[e.ONGREEN=26]="ONGREEN",e[e.ONCYAN=27]="ONCYAN",e[e.ONRED=28]="ONRED",e[e.ONPURPLE=29]="ONPURPLE",e[e.ONYELLOW=30]="ONYELLOW",e[e.ONWHITE=31]="ONWHITE",e[e.ONCLEAR=32]="ONCLEAR",e))(Ot||{}),Wt=(e=>(e[e.ISWALK=0]="ISWALK",e[e.ISSOLID=1]="ISSOLID",e[e.ISSWIM=2]="ISSWIM",e[e.ISBULLET=3]="ISBULLET",e))(Wt||{}),Un=(e=>(e[e.ISTERRAIN=0]="ISTERRAIN",e[e.ISOBJECT=1]="ISOBJECT",e))(Un||{}),mt=(e=>(e[e.IDLE=0]="IDLE",e[e.NORTH=1]="NORTH",e[e.SOUTH=2]="SOUTH",e[e.WEST=3]="WEST",e[e.EAST=4]="EAST",e[e.BY=5]="BY",e[e.AT=6]="AT",e[e.FLOW=7]="FLOW",e[e.SEEK=8]="SEEK",e[e.RNDNS=9]="RNDNS",e[e.RNDNE=10]="RNDNE",e[e.RND=11]="RND",e[e.CW=12]="CW",e[e.CCW=13]="CCW",e[e.OPP=14]="OPP",e[e.RNDP=15]="RNDP",e[e.AWAY=16]="AWAY",e[e.TOWARD=17]="TOWARD",e[e.PLAYER=18]="PLAYER",e[e.FIND=19]="FIND",e[e.FLEE=20]="FLEE",e[e.TO=21]="TO",e[e.MID=22]="MID",e[e.OVER=23]="OVER",e[e.UNDER=24]="UNDER",e))(mt||{}),At=(e=>(e[e.LOADER=0]="LOADER",e[e.BOARD=1]="BOARD",e[e.OBJECT=2]="OBJECT",e[e.TERRAIN=3]="TERRAIN",e[e.CHARSET=4]="CHARSET",e[e.PALETTE=5]="PALETTE",e[e.CONST=6]="CONST",e[e.RANGE=7]="RANGE",e[e.SELECT=8]="SELECT",e[e.NUMBER=9]="NUMBER",e[e.TEXT=10]="TEXT",e[e.HOTKEY=11]="HOTKEY",e[e.COPYIT=12]="COPYIT",e[e.OPENIT=13]="OPENIT",e[e.ZSSEDIT=14]="ZSSEDIT",e[e.CHAREDIT=15]="CHAREDIT",e[e.COLOREDIT=16]="COLOREDIT",e))(At||{});function It(e){return(e==null?void 0:e.toLowerCase().trim())??""}function UE(e,t,n,r,i){return{session:e,player:t,id:De(),sender:n,target:r,data:i}}function Fn(e){const[t,...n]=e.split(":");return{target:t,path:n.join(":")}}function Bs(e,t=[],n=fu,r=""){const i=De(),s=It(e),o=t.map(It);let a=r;const c={id(){return i},name(){return e},session(l){return k(l)?l.session===a?l.session:"":a},topics(){return t},emit(l,u,f){Xn.emit(a,l,i,u,f)},reply(l,u,f){c.emit(l.player,`${l.sender}:${u}`,f)},replynext(l,u,f){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,f),64)},handle(l){const{target:u,path:f}=Fn(l.target),d=It(u);!a&&d==="ready"&&(a=l.session),d==="bridge"&&k(l.session)&&(a=l.session),o.findIndex(h=>h==="all"||h===d)!==-1&&n(l),(i===u||d==="all"||s===d)&&n({...l,target:f})}};return Xn.connect(c),c}function FE(e){return typeof e=="object"&&yt(e.session)&&yt(e.player)&&yt(e.id)&&yt(e.sender)&&yt(e.target)}function de(e,t,n,...r){return e.emit(t,"error",[`$red${n}$blue>>`,...r]),!1}function BE(e,t,...n){return e.emit(t,"info",n),!0}function xe(e,t,...n){return e.emit(t,"log",n),!0}function Xd(e,t,n){e.emit(t,"toast",n)}function PE(e,t,n){e.emit(t,"bridge:streamstart",n)}function $E(e,t){e.emit(t,"bridge:streamstop",void 0)}function DE(e,t,n){e.emit(t,"bridge:chatstart",n)}function jE(e,t){e.emit(t,"bridge:chatstop")}function zE(e,t,n,r,i,s,o){e.emit(t,"bridge:fetch",[n,r,i,s,o])}function WE(e,t){e.emit(t,"bridge:talkstart",t)}function GE(e,t){e.emit(t,"bridge:talkstop",t)}function KE(e,t){e.emit(t,"bridge:mediastart",t)}function HE(e,t){e.emit(t,"bridge:mediastop",t)}function YE(e,t,n){e.emit(t,"bridge:start",n)}function VE(e,t,n){e.emit(t,"bridge:tab",n)}function XE(e,t,n){e.emit(t,"gadgetclient:paint",n)}function qE(e,t,n){e.emit(t,"gadgetclient:patch",n)}function JE(e,t){e.emit(t,"gadgetserver:clearscroll")}function ZE(e){e.emit("","ready")}function qd(e,t){e.emit(t,"register:loginfail")}function du(e,t){e.emit(t,"register:loginready",!0)}function QE(e,t,n,r){e.emit(t,"register:savemem",[n,r])}function tx(e,t,n){e.emit(t,"register:forkmem",[n])}function ex(e,t,n,r){e.emit(t,"register:itchiopublishmem",[n,r])}function pu(e,t,n){e.emit(t,"register:copy",n)}function nx(e,t,n,r){e.emit(t,"register:copyjsonfile",[n,r])}function Jd(e,t,n,r){e.emit(t,"register:downloadjsonfile",[n,r])}function rx(e,t){e.emit(t,"register:dev",void 0)}function ix(e,t){e.emit(t,"register:share",void 0)}function sx(e,t){e.emit(t,"register:nuke",void 0)}function ox(e,t){e.emit(t,"register:enterar",void 0)}function ax(e,t,n,r){e.emit(t,"synth:tts",[n,r])}function cx(e,t,n,r,i){e.emit(t,"synth:play",[n,r,i])}function lx(e,t,n){e.emit(t,"synth:focus",n)}function ux(e,t,n){e.emit(t,"synth:bpm",n)}function hx(e,t,n){e.emit(t,"synth:playvolume",n)}function fx(e,t,n){e.emit(t,"synth:bgplayvolume",n)}function dx(e,t,n){e.emit(t,"synth:ttsvolume",n)}function mu(e,t,n,r,i){e.emit(t,"synth:voice",[n,r,i])}function Zd(e,t,n,r,i,s){e.emit(t,"synth:voicefx",[n,r,i,s])}function Qd(e,t,n,r){e.emit(t,"register:config",[n,r])}function px(e,t){e.emit(t,"register:configshow")}function mx(e,t){e.emit(t,"register:inspector")}function t0(e,t,n,r,i,s){e.emit(t,"register:editor:open",[n,r,i,s])}function gx(e,t){e.emit(t,"vm:local")}function e0(e,t){e.emit(t,"vm:logout")}function Ka(e,t){const[n,r]=t;return`${e}:${[n,r].filter(k).join(":")}`}function _x(e,t,n){e.emit(t,"vm:cli",n)}function yx(e,t){e.emit(t,"vm:restart")}function n0(e,t){e.emit(t,"vm:flush")}function bx(e,t){e.emit(t,"vm:fork")}function kx(e,t){e.emit(t,"vm:itchiopublish")}function wx(e,t){return{filename:e,cursor:0,lines:t.split(`
`)}}function Ex(e,t){return{filename:e,json:t}}function xx(e,t){return{filename:e,cursor:0,bytes:t,dataview:new DataView(t.buffer)}}function gu(e,t,n,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=wx(i,s);break;case"json":o=Ex(i,s);break;case"binary":o=xx(i,s);break}setTimeout(()=>{e.emit(t,"vm:loader",[n,r,i,o])},1)}function vx(e){const t=new Set;function n(s){FE(s)&&s.target!=="tick"&&s.target!=="tock"&&t.has(s.id)===!1&&(t.add(s.id),Xn.invoke(s))}const r=Bs("forward",["all"],s=>{t.has(s.id)||(t.add(s.id),e(s))});function i(){Xn.disconnect(r)}return{forward:n,disconnect:i}}function Tx(e){switch(e.target){case"log":case"info":case"error":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const t=Fn(e.target);switch(t.target){case"vm":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(t.path){case"sync":case"joinack":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}const _u=66.666,Ha=Math.round(1e3/_u),Ax=3;function r0(e){return new Promise(t=>setTimeout(t,e))}const yu=Bs("clock");let bu=0,Ya=0,ku=0,i0=performance.now();function s0(){const e=performance.now(),t=e-i0;ku+=t,ku>=_u&&(ku%=_u,yu.emit("","tick",Ya),yu.emit("","tock",Ya),++bu,++Ya,bu>=Ha&&(bu%=Ha,yu.emit("","second",Ya))),i0=e,setTimeout(s0,2)}s0();function Sx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o0={exports:{}},je=o0.exports={},jr,zr;function wu(){throw new Error("setTimeout has not been defined")}function Eu(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?jr=setTimeout:jr=wu}catch{jr=wu}try{typeof clearTimeout=="function"?zr=clearTimeout:zr=Eu}catch{zr=Eu}})();function a0(e){if(jr===setTimeout)return setTimeout(e,0);if((jr===wu||!jr)&&setTimeout)return jr=setTimeout,setTimeout(e,0);try{return jr(e,0)}catch{try{return jr.call(null,e,0)}catch{return jr.call(this,e,0)}}}function Rx(e){if(zr===clearTimeout)return clearTimeout(e);if((zr===Eu||!zr)&&clearTimeout)return zr=clearTimeout,clearTimeout(e);try{return zr(e)}catch{try{return zr.call(null,e)}catch{return zr.call(this,e)}}}var di=[],Ps=!1,os,Va=-1;function Ox(){!Ps||!os||(Ps=!1,os.length?di=os.concat(di):Va=-1,di.length&&c0())}function c0(){if(!Ps){var e=a0(Ox);Ps=!0;for(var t=di.length;t;){for(os=di,di=[];++Va<t;)os&&os[Va].run();Va=-1,t=di.length}os=null,Ps=!1,Rx(e)}}je.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];di.push(new l0(e,t)),di.length===1&&!Ps&&a0(c0)};function l0(e,t){this.fun=e,this.array=t}l0.prototype.run=function(){this.fun.apply(null,this.array)},je.title="browser",je.browser=!0,je.env={},je.argv=[],je.version="",je.versions={};function pi(){}je.on=pi,je.addListener=pi,je.once=pi,je.off=pi,je.removeListener=pi,je.removeAllListeners=pi,je.emit=pi,je.prependListener=pi,je.prependOnceListener=pi,je.listeners=function(e){return[]},je.binding=function(e){throw new Error("process.binding is not supported")},je.cwd=function(){return"/"},je.chdir=function(e){throw new Error("process.chdir is not supported")},je.umask=function(){return 0};var Nx=o0.exports;const Er=Sx(Nx);var Yt={},xu=Symbol.for("react.transitional.element"),Ix=Symbol.for("react.portal"),Cx=Symbol.for("react.fragment"),Lx=Symbol.for("react.strict_mode"),Mx=Symbol.for("react.profiler"),Ux=Symbol.for("react.consumer"),Fx=Symbol.for("react.context"),Bx=Symbol.for("react.forward_ref"),Px=Symbol.for("react.suspense"),$x=Symbol.for("react.memo"),u0=Symbol.for("react.lazy"),h0=Symbol.iterator;function Dx(e){return e===null||typeof e!="object"?null:(e=h0&&e[h0]||e["@@iterator"],typeof e=="function"?e:null)}var f0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},d0=Object.assign,p0={};function $s(e,t,n){this.props=e,this.context=t,this.refs=p0,this.updater=n||f0}$s.prototype.isReactComponent={},$s.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},$s.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function m0(){}m0.prototype=$s.prototype;function vu(e,t,n){this.props=e,this.context=t,this.refs=p0,this.updater=n||f0}var Tu=vu.prototype=new m0;Tu.constructor=vu,d0(Tu,$s.prototype),Tu.isPureReactComponent=!0;var g0=Array.isArray,ve={H:null,A:null,T:null,S:null,V:null},_0=Object.prototype.hasOwnProperty;function Au(e,t,n,r,i,s){return n=s.ref,{$$typeof:xu,type:e,key:t,ref:n!==void 0?n:null,props:s}}function jx(e,t){return Au(e.type,t,void 0,void 0,void 0,e.props)}function Su(e){return typeof e=="object"&&e!==null&&e.$$typeof===xu}function zx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var y0=/\/+/g;function Ru(e,t){return typeof e=="object"&&e!==null&&e.key!=null?zx(""+e.key):t.toString(36)}function b0(){}function Wx(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(b0,b0):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function Ds(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case xu:case Ix:o=!0;break;case u0:return o=e._init,Ds(o(e._payload),t,n,r,i)}}if(o)return i=i(e),o=r===""?"."+Ru(e,0):r,g0(i)?(n="",o!=null&&(n=o.replace(y0,"$&/")+"/"),Ds(i,t,n,"",function(l){return l})):i!=null&&(Su(i)&&(i=jx(i,n+(i.key==null||e&&e.key===i.key?"":(""+i.key).replace(y0,"$&/")+"/")+o)),t.push(i)),1;o=0;var a=r===""?".":r+":";if(g0(e))for(var c=0;c<e.length;c++)r=e[c],s=a+Ru(r,c),o+=Ds(r,t,n,s,i);else if(c=Dx(e),typeof c=="function")for(e=c.call(e),c=0;!(r=e.next()).done;)r=r.value,s=a+Ru(r,c++),o+=Ds(r,t,n,s,i);else if(s==="object"){if(typeof e.then=="function")return Ds(Wx(e),t,n,r,i);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return o}function Xa(e,t,n){if(e==null)return e;var r=[],i=0;return Ds(e,r,"","",function(s){return t.call(n,s,i++)}),r}function Gx(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var k0=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof Er=="object"&&typeof Er.emit=="function"){Er.emit("uncaughtException",e);return}console.error(e)};function Kx(){}Yt.Children={map:Xa,forEach:function(e,t,n){Xa(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Xa(e,function(){t++}),t},toArray:function(e){return Xa(e,function(t){return t})||[]},only:function(e){if(!Su(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Yt.Component=$s,Yt.Fragment=Cx,Yt.Profiler=Mx,Yt.PureComponent=vu,Yt.StrictMode=Lx,Yt.Suspense=Px,Yt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ve,Yt.__COMPILER_RUNTIME={__proto__:null,c:function(e){return ve.H.useMemoCache(e)}},Yt.cache=function(e){return function(){return e.apply(null,arguments)}},Yt.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var r=d0({},e.props),i=e.key,s=void 0;if(t!=null)for(o in t.ref!==void 0&&(s=void 0),t.key!==void 0&&(i=""+t.key),t)!_0.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(r[o]=t[o]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];r.children=a}return Au(e.type,i,void 0,void 0,s,r)},Yt.createContext=function(e){return e={$$typeof:Fx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:Ux,_context:e},e},Yt.createElement=function(e,t,n){var r,i={},s=null;if(t!=null)for(r in t.key!==void 0&&(s=""+t.key),t)_0.call(t,r)&&r!=="key"&&r!=="__self"&&r!=="__source"&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var a=Array(o),c=0;c<o;c++)a[c]=arguments[c+2];i.children=a}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return Au(e,s,void 0,void 0,null,i)},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(e){return{$$typeof:Bx,render:e}},Yt.isValidElement=Su,Yt.lazy=function(e){return{$$typeof:u0,_payload:{_status:-1,_result:e},_init:Gx}},Yt.memo=function(e,t){return{$$typeof:$x,type:e,compare:t===void 0?null:t}},Yt.startTransition=function(e){var t=ve.T,n={};ve.T=n;try{var r=e(),i=ve.S;i!==null&&i(n,r),typeof r=="object"&&r!==null&&typeof r.then=="function"&&r.then(Kx,k0)}catch(s){k0(s)}finally{ve.T=t}},Yt.unstable_useCacheRefresh=function(){return ve.H.useCacheRefresh()},Yt.use=function(e){return ve.H.use(e)},Yt.useActionState=function(e,t,n){return ve.H.useActionState(e,t,n)},Yt.useCallback=function(e,t){return ve.H.useCallback(e,t)},Yt.useContext=function(e){return ve.H.useContext(e)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(e,t){return ve.H.useDeferredValue(e,t)},Yt.useEffect=function(e,t,n){var r=ve.H;if(typeof n=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return r.useEffect(e,t)},Yt.useId=function(){return ve.H.useId()},Yt.useImperativeHandle=function(e,t,n){return ve.H.useImperativeHandle(e,t,n)},Yt.useInsertionEffect=function(e,t){return ve.H.useInsertionEffect(e,t)},Yt.useLayoutEffect=function(e,t){return ve.H.useLayoutEffect(e,t)},Yt.useMemo=function(e,t){return ve.H.useMemo(e,t)},Yt.useOptimistic=function(e,t){return ve.H.useOptimistic(e,t)},Yt.useReducer=function(e,t,n){return ve.H.useReducer(e,t,n)},Yt.useRef=function(e){return ve.H.useRef(e)},Yt.useState=function(e){return ve.H.useState(e)},Yt.useSyncExternalStore=function(e,t,n){return ve.H.useSyncExternalStore(e,t,n)},Yt.useTransition=function(){return ve.H.useTransition()},Yt.version="19.1.0";/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy WÃ¤rting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const w0="0123456789abcdef",E0=[],qa=[];for(let e=0;e<256;e++)E0[e]=w0[e>>4&15]+w0[e&15],e<16&&(e<10?qa[48+e]=e:qa[87+e]=e);const x0=e=>{const t=e.length;let n="",r=0;for(;r<t;)n+=E0[e[r++]];return n},Ja=e=>{const t=e.length>>1,n=t<<1,r=new Uint8Array(t);let i=0,s=0;for(;s<n;)r[i++]=qa[e.charCodeAt(s++)]<<4|qa[e.charCodeAt(s++)];return r};for(var v0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hx=typeof Uint8Array>"u"?[]:new Uint8Array(256),Za=0;Za<v0.length;Za++)Hx[v0.charCodeAt(Za)]=Za;new TextDecoder,new TextEncoder;const T0=typeof window<"u"?window:self,A0=T0.crypto||T0.msCrypto||{};A0.subtle||A0.webkitSubtle;const js=globalThis||void 0||self,xr=()=>new Map,Ou=e=>{const t=xr();return e.forEach((n,r)=>{t.set(r,n)}),t},Mi=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},Yx=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},Vx=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},zs=()=>new Set,Nu=e=>e[e.length-1],Xx=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},as=Array.from,qx=Array.isArray;class Jx{constructor(){this._observers=xr()}on(t,n){return Mi(this._observers,t,zs).add(n),n}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return as((this._observers.get(t)||xr()).values()).forEach(r=>r(...n))}destroy(){this._observers=xr()}}const Ui=Math.floor,Qa=Math.abs,S0=(e,t)=>e<t?e:t,cs=(e,t)=>e>t?e:t,R0=e=>e!==0?e<0:1/e<0,O0=1,N0=2,Iu=4,Cu=8,Uo=32,mi=64,Jn=128,tc=31,Lu=63,ls=127,Zx=2147483647,I0=Number.MAX_SAFE_INTEGER,Qx=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ui(e)===e),tv=e=>e.toLowerCase(),ev=/^\s*/g,nv=e=>e.replace(ev,""),rv=/([A-Z])/g,C0=(e,t)=>nv(e.replace(rv,n=>`${t}${tv(n)}`)),iv=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Fo=typeof TextEncoder<"u"?new TextEncoder:null,sv=Fo?e=>Fo.encode(e):iv;let Bo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Bo&&Bo.decode(new Uint8Array).length===1&&(Bo=null);class Po{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ec=()=>new Po,ov=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Wr=e=>{const t=new Uint8Array(ov(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},av=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(cs(n,t)*2),e.cpos=0)},rn=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Mu=rn,oe=(e,t)=>{for(;t>ls;)rn(e,Jn|ls&t),t=Ui(t/128);rn(e,ls&t)},Uu=(e,t)=>{const n=R0(t);for(n&&(t=-t),rn(e,(t>Lu?Jn:0)|(n?mi:0)|Lu&t),t=Ui(t/64);t>0;)rn(e,(t>ls?Jn:0)|ls&t),t=Ui(t/128)},Fu=new Uint8Array(3e4),cv=Fu.length/3,lv=(e,t)=>{if(t.length<cv){const n=Fo.encodeInto(t,Fu).written||0;oe(e,n);for(let r=0;r<n;r++)rn(e,Fu[r])}else Zn(e,sv(t))},uv=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;oe(e,r);for(let i=0;i<r;i++)rn(e,n.codePointAt(i))},Ws=Fo&&Fo.encodeInto?lv:uv,nc=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=S0(n-r,t.length),s=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(cs(n*2,s)),e.cbuf.set(t.subarray(i)),e.cpos=s)},Zn=(e,t)=>{oe(e,t.byteLength),nc(e,t)},Bu=(e,t)=>{av(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},hv=(e,t)=>Bu(e,4).setFloat32(0,t,!1),fv=(e,t)=>Bu(e,8).setFloat64(0,t,!1),dv=(e,t)=>Bu(e,8).setBigInt64(0,t,!1),L0=new DataView(new ArrayBuffer(4)),pv=e=>(L0.setFloat32(0,e),L0.getFloat32(0)===e),$o=(e,t)=>{switch(typeof t){case"string":rn(e,119),Ws(e,t);break;case"number":Qx(t)&&Qa(t)<=Zx?(rn(e,125),Uu(e,t)):pv(t)?(rn(e,124),hv(e,t)):(rn(e,123),fv(e,t));break;case"bigint":rn(e,122),dv(e,t);break;case"object":if(t===null)rn(e,126);else if(qx(t)){rn(e,117),oe(e,t.length);for(let n=0;n<t.length;n++)$o(e,t[n])}else if(t instanceof Uint8Array)rn(e,116),Zn(e,t);else{rn(e,118);const n=Object.keys(t);oe(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ws(e,i),$o(e,t[i])}}break;case"boolean":rn(e,t?120:121);break;default:rn(e,127)}};class M0 extends Po{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&oe(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const U0=e=>{e.count>0&&(Uu(e.encoder,e.count===1?e.s:-e.s),e.count>1&&oe(e.encoder,e.count-2))};class rc{constructor(){this.encoder=new Po,this.s=0,this.count=0}write(t){this.s===t?this.count++:(U0(this),this.count=1,this.s=t)}toUint8Array(){return U0(this),Wr(this.encoder)}}const F0=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);Uu(e.encoder,t),e.count>1&&oe(e.encoder,e.count-2)}};class Pu{constructor(){this.encoder=new Po,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(F0(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return F0(this),Wr(this.encoder)}}class mv{constructor(){this.sarr=[],this.s="",this.lensE=new rc}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Po;return this.sarr.push(this.s),this.s="",Ws(t,this.sarr.join("")),nc(t,this.lensE.toUint8Array()),Wr(t)}}const Fi=e=>new Error(e),Gr=()=>{throw Fi("Method unimplemented")},Kr=()=>{throw Fi("Unexpected case")},B0=Fi("Unexpected end of array"),P0=Fi("Integer out of Range");class ic{constructor(t){this.arr=t,this.pos=0}}const Gs=e=>new ic(e),gv=e=>e.pos!==e.arr.length,_v=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Qn=e=>_v(e,Xt(e)),Ks=e=>e.arr[e.pos++],Xt=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&ls)*n,n*=128,i<Jn)return t;if(t>I0)throw P0}throw B0},$u=e=>{let t=e.arr[e.pos++],n=t&Lu,r=64;const i=(t&mi)>0?-1:1;if(!(t&Jn))return i*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&ls)*r,r*=128,t<Jn)return i*n;if(n>I0)throw P0}throw B0},Hs=Bo?e=>Bo.decode(Qn(e)):e=>{let t=Xt(e);if(t===0)return"";{let n=String.fromCodePoint(Ks(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ks(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Du=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},yv=[e=>{},e=>null,$u,e=>Du(e,4).getFloat32(0,!1),e=>Du(e,8).getFloat64(0,!1),e=>Du(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Hs,e=>{const t=Xt(e),n={};for(let r=0;r<t;r++){const i=Hs(e);n[i]=Do(e)}return n},e=>{const t=Xt(e),n=[];for(let r=0;r<t;r++)n.push(Do(e));return n},Qn],Do=e=>yv[127-Ks(e)](e);class $0 extends ic{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),gv(this)?this.count=Xt(this)+1:this.count=-1),this.count--,this.s}}class sc extends ic{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=$u(this);const t=R0(this.s);this.count=1,t&&(this.s=-this.s,this.count=Xt(this)+2)}return this.count--,this.s}}class ju extends ic{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=$u(this),n=t&1;this.diff=Ui(t/2),this.count=1,n&&(this.count=Xt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class bv{constructor(t){this.decoder=new sc(t),this.str=Hs(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const kv=crypto.getRandomValues.bind(crypto),D0=()=>kv(new Uint32Array(1))[0],wv="10000000-1000-4000-8000"+-1e11,Ev=()=>wv.replace(/[018]/g,e=>(e^D0()&15>>e/4).toString(16)),j0=e=>new Promise(e);Promise.all.bind(Promise);var z0={},oc={};oc.byteLength=Tv,oc.toByteArray=Sv,oc.fromByteArray=Nv;for(var Hr=[],or=[],xv=typeof Uint8Array<"u"?Uint8Array:Array,zu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ys=0,vv=zu.length;Ys<vv;++Ys)Hr[Ys]=zu[Ys],or[zu.charCodeAt(Ys)]=Ys;or[45]=62,or[95]=63;function W0(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");n===-1&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function Tv(e){var t=W0(e),n=t[0],r=t[1];return(n+r)*3/4-r}function Av(e,t,n){return(t+n)*3/4-n}function Sv(e){var t,n=W0(e),r=n[0],i=n[1],s=new xv(Av(e,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)t=or[e.charCodeAt(c)]<<18|or[e.charCodeAt(c+1)]<<12|or[e.charCodeAt(c+2)]<<6|or[e.charCodeAt(c+3)],s[o++]=t>>16&255,s[o++]=t>>8&255,s[o++]=t&255;return i===2&&(t=or[e.charCodeAt(c)]<<2|or[e.charCodeAt(c+1)]>>4,s[o++]=t&255),i===1&&(t=or[e.charCodeAt(c)]<<10|or[e.charCodeAt(c+1)]<<4|or[e.charCodeAt(c+2)]>>2,s[o++]=t>>8&255,s[o++]=t&255),s}function Rv(e){return Hr[e>>18&63]+Hr[e>>12&63]+Hr[e>>6&63]+Hr[e&63]}function Ov(e,t,n){for(var r,i=[],s=t;s<n;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(e[s+2]&255),i.push(Rv(r));return i.join("")}function Nv(e){for(var t,n=e.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(Ov(e,o,o+s>a?a:o+s));return r===1?(t=e[n-1],i.push(Hr[t>>2]+Hr[t<<4&63]+"==")):r===2&&(t=(e[n-2]<<8)+e[n-1],i.push(Hr[t>>10]+Hr[t>>4&63]+Hr[t<<2&63]+"=")),i.join("")}var Wu={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Wu.read=function(e,t,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,f=n?i-1:0,d=n?-1:1,h=e[t+f];for(f+=d,s=h&(1<<-u)-1,h>>=-u,u+=a;u>0;s=s*256+e[t+f],f+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+e[t+f],f+=d,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(h?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(h?-1:1)*o*Math.pow(2,s-r)},Wu.write=function(e,t,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,m=r?1:-1,p=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=d/c:t+=d*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(t*c-1)*Math.pow(2,i),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[n+h]=a&255,h+=m,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;e[n+h]=o&255,h+=m,o/=256,l-=8);e[n+h-m]|=p*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=oc,n=Wu,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=u,e.SlowBuffer=U,e.INSPECT_MAX_BYTES=50;const i=2147483647;e.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const R=new s(1),g={foo:function(){return 42}};return Object.setPrototypeOf(g,s.prototype),Object.setPrototypeOf(R,g),R.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(R){if(R>i)throw new RangeError('The value "'+R+'" is invalid for option "size"');const g=new s(R);return Object.setPrototypeOf(g,u.prototype),g}function u(R,g,_){if(typeof R=="number"){if(typeof g=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(R)}return f(R,g,_)}u.poolSize=8192;function f(R,g,_){if(typeof R=="string")return p(R,g);if(o.isView(R))return y(R);if(R==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R);if(gt(R,o)||R&&gt(R.buffer,o)||typeof a<"u"&&(gt(R,a)||R&&gt(R.buffer,a)))return v(R,g,_);if(typeof R=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const M=R.valueOf&&R.valueOf();if(M!=null&&M!==R)return u.from(M,g,_);const G=T(R);if(G)return G;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof R[Symbol.toPrimitive]=="function")return u.from(R[Symbol.toPrimitive]("string"),g,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R)}u.from=function(R,g,_){return f(R,g,_)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function d(R){if(typeof R!="number")throw new TypeError('"size" argument must be of type number');if(R<0)throw new RangeError('The value "'+R+'" is invalid for option "size"')}function h(R,g,_){return d(R),R<=0?l(R):g!==void 0?typeof _=="string"?l(R).fill(g,_):l(R).fill(g):l(R)}u.alloc=function(R,g,_){return h(R,g,_)};function m(R){return d(R),l(R<0?0:A(R)|0)}u.allocUnsafe=function(R){return m(R)},u.allocUnsafeSlow=function(R){return m(R)};function p(R,g){if((typeof g!="string"||g==="")&&(g="utf8"),!u.isEncoding(g))throw new TypeError("Unknown encoding: "+g);const _=S(R,g)|0;let M=l(_);const G=M.write(R,g);return G!==_&&(M=M.slice(0,G)),M}function b(R){const g=R.length<0?0:A(R.length)|0,_=l(g);for(let M=0;M<g;M+=1)_[M]=R[M]&255;return _}function y(R){if(gt(R,s)){const g=new s(R);return v(g.buffer,g.byteOffset,g.byteLength)}return b(R)}function v(R,g,_){if(g<0||R.byteLength<g)throw new RangeError('"offset" is outside of buffer bounds');if(R.byteLength<g+(_||0))throw new RangeError('"length" is outside of buffer bounds');let M;return g===void 0&&_===void 0?M=new s(R):_===void 0?M=new s(R,g):M=new s(R,g,_),Object.setPrototypeOf(M,u.prototype),M}function T(R){if(u.isBuffer(R)){const g=A(R.length)|0,_=l(g);return _.length===0||R.copy(_,0,0,g),_}if(R.length!==void 0)return typeof R.length!="number"||Ct(R.length)?l(0):b(R);if(R.type==="Buffer"&&Array.isArray(R.data))return b(R.data)}function A(R){if(R>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return R|0}function U(R){return+R!=R&&(R=0),u.alloc(+R)}u.isBuffer=function(g){return g!=null&&g._isBuffer===!0&&g!==u.prototype},u.compare=function(g,_){if(gt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),gt(_,s)&&(_=u.from(_,_.offset,_.byteLength)),!u.isBuffer(g)||!u.isBuffer(_))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(g===_)return 0;let M=g.length,G=_.length;for(let tt=0,ot=Math.min(M,G);tt<ot;++tt)if(g[tt]!==_[tt]){M=g[tt],G=_[tt];break}return M<G?-1:G<M?1:0},u.isEncoding=function(g){switch(String(g).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(g,_){if(!Array.isArray(g))throw new TypeError('"list" argument must be an Array of Buffers');if(g.length===0)return u.alloc(0);let M;if(_===void 0)for(_=0,M=0;M<g.length;++M)_+=g[M].length;const G=u.allocUnsafe(_);let tt=0;for(M=0;M<g.length;++M){let ot=g[M];if(gt(ot,s))tt+ot.length>G.length?(u.isBuffer(ot)||(ot=u.from(ot)),ot.copy(G,tt)):s.prototype.set.call(G,ot,tt);else if(u.isBuffer(ot))ot.copy(G,tt);else throw new TypeError('"list" argument must be an Array of Buffers');tt+=ot.length}return G};function S(R,g){if(u.isBuffer(R))return R.length;if(o.isView(R)||gt(R,o))return R.byteLength;if(typeof R!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof R);const _=R.length,M=arguments.length>2&&arguments[2]===!0;if(!M&&_===0)return 0;let G=!1;for(;;)switch(g){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ht(R).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _*2;case"hex":return _>>>1;case"base64":return _t(R).length;default:if(G)return M?-1:ht(R).length;g=(""+g).toLowerCase(),G=!0}}u.byteLength=S;function C(R,g,_){let M=!1;if((g===void 0||g<0)&&(g=0),g>this.length||((_===void 0||_>this.length)&&(_=this.length),_<=0)||(_>>>=0,g>>>=0,_<=g))return"";for(R||(R="utf8");;)switch(R){case"hex":return P(this,g,_);case"utf8":case"utf-8":return B(this,g,_);case"ascii":return rt(this,g,_);case"latin1":case"binary":return z(this,g,_);case"base64":return $(this,g,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ft(this,g,_);default:if(M)throw new TypeError("Unknown encoding: "+R);R=(R+"").toLowerCase(),M=!0}}u.prototype._isBuffer=!0;function j(R,g,_){const M=R[g];R[g]=R[_],R[_]=M}u.prototype.swap16=function(){const g=this.length;if(g%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let _=0;_<g;_+=2)j(this,_,_+1);return this},u.prototype.swap32=function(){const g=this.length;if(g%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let _=0;_<g;_+=4)j(this,_,_+3),j(this,_+1,_+2);return this},u.prototype.swap64=function(){const g=this.length;if(g%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let _=0;_<g;_+=8)j(this,_,_+7),j(this,_+1,_+6),j(this,_+2,_+5),j(this,_+3,_+4);return this},u.prototype.toString=function(){const g=this.length;return g===0?"":arguments.length===0?B(this,0,g):C.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(g){if(!u.isBuffer(g))throw new TypeError("Argument must be a Buffer");return this===g?!0:u.compare(this,g)===0},u.prototype.inspect=function(){let g="";const _=e.INSPECT_MAX_BYTES;return g=this.toString("hex",0,_).replace(/(.{2})/g,"$1 ").trim(),this.length>_&&(g+=" ... "),"<Buffer "+g+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(g,_,M,G,tt){if(gt(g,s)&&(g=u.from(g,g.offset,g.byteLength)),!u.isBuffer(g))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof g);if(_===void 0&&(_=0),M===void 0&&(M=g?g.length:0),G===void 0&&(G=0),tt===void 0&&(tt=this.length),_<0||M>g.length||G<0||tt>this.length)throw new RangeError("out of range index");if(G>=tt&&_>=M)return 0;if(G>=tt)return-1;if(_>=M)return 1;if(_>>>=0,M>>>=0,G>>>=0,tt>>>=0,this===g)return 0;let ot=tt-G,Ht=M-_;const Ie=Math.min(ot,Ht),we=this.slice(G,tt),Ce=g.slice(_,M);for(let he=0;he<Ie;++he)if(we[he]!==Ce[he]){ot=we[he],Ht=Ce[he];break}return ot<Ht?-1:Ht<ot?1:0};function N(R,g,_,M,G){if(R.length===0)return-1;if(typeof _=="string"?(M=_,_=0):_>2147483647?_=2147483647:_<-2147483648&&(_=-2147483648),_=+_,Ct(_)&&(_=G?0:R.length-1),_<0&&(_=R.length+_),_>=R.length){if(G)return-1;_=R.length-1}else if(_<0)if(G)_=0;else return-1;if(typeof g=="string"&&(g=u.from(g,M)),u.isBuffer(g))return g.length===0?-1:W(R,g,_,M,G);if(typeof g=="number")return g=g&255,typeof s.prototype.indexOf=="function"?G?s.prototype.indexOf.call(R,g,_):s.prototype.lastIndexOf.call(R,g,_):W(R,[g],_,M,G);throw new TypeError("val must be string, number or Buffer")}function W(R,g,_,M,G){let tt=1,ot=R.length,Ht=g.length;if(M!==void 0&&(M=String(M).toLowerCase(),M==="ucs2"||M==="ucs-2"||M==="utf16le"||M==="utf-16le")){if(R.length<2||g.length<2)return-1;tt=2,ot/=2,Ht/=2,_/=2}function Ie(Ce,he){return tt===1?Ce[he]:Ce.readUInt16BE(he*tt)}let we;if(G){let Ce=-1;for(we=_;we<ot;we++)if(Ie(R,we)===Ie(g,Ce===-1?0:we-Ce)){if(Ce===-1&&(Ce=we),we-Ce+1===Ht)return Ce*tt}else Ce!==-1&&(we-=we-Ce),Ce=-1}else for(_+Ht>ot&&(_=ot-Ht),we=_;we>=0;we--){let Ce=!0;for(let he=0;he<Ht;he++)if(Ie(R,we+he)!==Ie(g,he)){Ce=!1;break}if(Ce)return we}return-1}u.prototype.includes=function(g,_,M){return this.indexOf(g,_,M)!==-1},u.prototype.indexOf=function(g,_,M){return N(this,g,_,M,!0)},u.prototype.lastIndexOf=function(g,_,M){return N(this,g,_,M,!1)};function q(R,g,_,M){_=Number(_)||0;const G=R.length-_;M?(M=Number(M),M>G&&(M=G)):M=G;const tt=g.length;M>tt/2&&(M=tt/2);let ot;for(ot=0;ot<M;++ot){const Ht=parseInt(g.substr(ot*2,2),16);if(Ct(Ht))return ot;R[_+ot]=Ht}return ot}function L(R,g,_,M){return vt(ht(g,R.length-_),R,_,M)}function O(R,g,_,M){return vt(pt(g),R,_,M)}function w(R,g,_,M){return vt(_t(g),R,_,M)}function I(R,g,_,M){return vt(Z(g,R.length-_),R,_,M)}u.prototype.write=function(g,_,M,G){if(_===void 0)G="utf8",M=this.length,_=0;else if(M===void 0&&typeof _=="string")G=_,M=this.length,_=0;else if(isFinite(_))_=_>>>0,isFinite(M)?(M=M>>>0,G===void 0&&(G="utf8")):(G=M,M=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const tt=this.length-_;if((M===void 0||M>tt)&&(M=tt),g.length>0&&(M<0||_<0)||_>this.length)throw new RangeError("Attempt to write outside buffer bounds");G||(G="utf8");let ot=!1;for(;;)switch(G){case"hex":return q(this,g,_,M);case"utf8":case"utf-8":return L(this,g,_,M);case"ascii":case"latin1":case"binary":return O(this,g,_,M);case"base64":return w(this,g,_,M);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,g,_,M);default:if(ot)throw new TypeError("Unknown encoding: "+G);G=(""+G).toLowerCase(),ot=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function $(R,g,_){return g===0&&_===R.length?t.fromByteArray(R):t.fromByteArray(R.slice(g,_))}function B(R,g,_){_=Math.min(R.length,_);const M=[];let G=g;for(;G<_;){const tt=R[G];let ot=null,Ht=tt>239?4:tt>223?3:tt>191?2:1;if(G+Ht<=_){let Ie,we,Ce,he;switch(Ht){case 1:tt<128&&(ot=tt);break;case 2:Ie=R[G+1],(Ie&192)===128&&(he=(tt&31)<<6|Ie&63,he>127&&(ot=he));break;case 3:Ie=R[G+1],we=R[G+2],(Ie&192)===128&&(we&192)===128&&(he=(tt&15)<<12|(Ie&63)<<6|we&63,he>2047&&(he<55296||he>57343)&&(ot=he));break;case 4:Ie=R[G+1],we=R[G+2],Ce=R[G+3],(Ie&192)===128&&(we&192)===128&&(Ce&192)===128&&(he=(tt&15)<<18|(Ie&63)<<12|(we&63)<<6|Ce&63,he>65535&&he<1114112&&(ot=he))}}ot===null?(ot=65533,Ht=1):ot>65535&&(ot-=65536,M.push(ot>>>10&1023|55296),ot=56320|ot&1023),M.push(ot),G+=Ht}return Q(M)}const it=4096;function Q(R){const g=R.length;if(g<=it)return String.fromCharCode.apply(String,R);let _="",M=0;for(;M<g;)_+=String.fromCharCode.apply(String,R.slice(M,M+=it));return _}function rt(R,g,_){let M="";_=Math.min(R.length,_);for(let G=g;G<_;++G)M+=String.fromCharCode(R[G]&127);return M}function z(R,g,_){let M="";_=Math.min(R.length,_);for(let G=g;G<_;++G)M+=String.fromCharCode(R[G]);return M}function P(R,g,_){const M=R.length;(!g||g<0)&&(g=0),(!_||_<0||_>M)&&(_=M);let G="";for(let tt=g;tt<_;++tt)G+=fe[R[tt]];return G}function ft(R,g,_){const M=R.slice(g,_);let G="";for(let tt=0;tt<M.length-1;tt+=2)G+=String.fromCharCode(M[tt]+M[tt+1]*256);return G}u.prototype.slice=function(g,_){const M=this.length;g=~~g,_=_===void 0?M:~~_,g<0?(g+=M,g<0&&(g=0)):g>M&&(g=M),_<0?(_+=M,_<0&&(_=0)):_>M&&(_=M),_<g&&(_=g);const G=this.subarray(g,_);return Object.setPrototypeOf(G,u.prototype),G};function lt(R,g,_){if(R%1!==0||R<0)throw new RangeError("offset is not uint");if(R+g>_)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||lt(g,_,this.length);let G=this[g],tt=1,ot=0;for(;++ot<_&&(tt*=256);)G+=this[g+ot]*tt;return G},u.prototype.readUintBE=u.prototype.readUIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||lt(g,_,this.length);let G=this[g+--_],tt=1;for(;_>0&&(tt*=256);)G+=this[g+--_]*tt;return G},u.prototype.readUint8=u.prototype.readUInt8=function(g,_){return g=g>>>0,_||lt(g,1,this.length),this[g]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(g,_){return g=g>>>0,_||lt(g,2,this.length),this[g]|this[g+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(g,_){return g=g>>>0,_||lt(g,2,this.length),this[g]<<8|this[g+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),(this[g]|this[g+1]<<8|this[g+2]<<16)+this[g+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]*16777216+(this[g+1]<<16|this[g+2]<<8|this[g+3])},u.prototype.readBigUInt64LE=zt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&D(g,this.length-8);const G=_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24,tt=this[++g]+this[++g]*2**8+this[++g]*2**16+M*2**24;return BigInt(G)+(BigInt(tt)<<BigInt(32))}),u.prototype.readBigUInt64BE=zt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&D(g,this.length-8);const G=_*2**24+this[++g]*2**16+this[++g]*2**8+this[++g],tt=this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M;return(BigInt(G)<<BigInt(32))+BigInt(tt)}),u.prototype.readIntLE=function(g,_,M){g=g>>>0,_=_>>>0,M||lt(g,_,this.length);let G=this[g],tt=1,ot=0;for(;++ot<_&&(tt*=256);)G+=this[g+ot]*tt;return tt*=128,G>=tt&&(G-=Math.pow(2,8*_)),G},u.prototype.readIntBE=function(g,_,M){g=g>>>0,_=_>>>0,M||lt(g,_,this.length);let G=_,tt=1,ot=this[g+--G];for(;G>0&&(tt*=256);)ot+=this[g+--G]*tt;return tt*=128,ot>=tt&&(ot-=Math.pow(2,8*_)),ot},u.prototype.readInt8=function(g,_){return g=g>>>0,_||lt(g,1,this.length),this[g]&128?(255-this[g]+1)*-1:this[g]},u.prototype.readInt16LE=function(g,_){g=g>>>0,_||lt(g,2,this.length);const M=this[g]|this[g+1]<<8;return M&32768?M|4294901760:M},u.prototype.readInt16BE=function(g,_){g=g>>>0,_||lt(g,2,this.length);const M=this[g+1]|this[g]<<8;return M&32768?M|4294901760:M},u.prototype.readInt32LE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]|this[g+1]<<8|this[g+2]<<16|this[g+3]<<24},u.prototype.readInt32BE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),this[g]<<24|this[g+1]<<16|this[g+2]<<8|this[g+3]},u.prototype.readBigInt64LE=zt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&D(g,this.length-8);const G=this[g+4]+this[g+5]*2**8+this[g+6]*2**16+(M<<24);return(BigInt(G)<<BigInt(32))+BigInt(_+this[++g]*2**8+this[++g]*2**16+this[++g]*2**24)}),u.prototype.readBigInt64BE=zt(function(g){g=g>>>0,nt(g,"offset");const _=this[g],M=this[g+7];(_===void 0||M===void 0)&&D(g,this.length-8);const G=(_<<24)+this[++g]*2**16+this[++g]*2**8+this[++g];return(BigInt(G)<<BigInt(32))+BigInt(this[++g]*2**24+this[++g]*2**16+this[++g]*2**8+M)}),u.prototype.readFloatLE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),n.read(this,g,!0,23,4)},u.prototype.readFloatBE=function(g,_){return g=g>>>0,_||lt(g,4,this.length),n.read(this,g,!1,23,4)},u.prototype.readDoubleLE=function(g,_){return g=g>>>0,_||lt(g,8,this.length),n.read(this,g,!0,52,8)},u.prototype.readDoubleBE=function(g,_){return g=g>>>0,_||lt(g,8,this.length),n.read(this,g,!1,52,8)};function ut(R,g,_,M,G,tt){if(!u.isBuffer(R))throw new TypeError('"buffer" argument must be a Buffer instance');if(g>G||g<tt)throw new RangeError('"value" argument is out of bounds');if(_+M>R.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(g,_,M,G){if(g=+g,_=_>>>0,M=M>>>0,!G){const Ht=Math.pow(2,8*M)-1;ut(this,g,_,M,Ht,0)}let tt=1,ot=0;for(this[_]=g&255;++ot<M&&(tt*=256);)this[_+ot]=g/tt&255;return _+M},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(g,_,M,G){if(g=+g,_=_>>>0,M=M>>>0,!G){const Ht=Math.pow(2,8*M)-1;ut(this,g,_,M,Ht,0)}let tt=M-1,ot=1;for(this[_+tt]=g&255;--tt>=0&&(ot*=256);)this[_+tt]=g/ot&255;return _+M},u.prototype.writeUint8=u.prototype.writeUInt8=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,1,255,0),this[_]=g&255,_+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,2,65535,0),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,2,65535,0),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,4,4294967295,0),this[_+3]=g>>>24,this[_+2]=g>>>16,this[_+1]=g>>>8,this[_]=g&255,_+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,4,4294967295,0),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4};function jt(R,g,_,M,G){ct(g,M,G,R,_,7);let tt=Number(g&BigInt(4294967295));R[_++]=tt,tt=tt>>8,R[_++]=tt,tt=tt>>8,R[_++]=tt,tt=tt>>8,R[_++]=tt;let ot=Number(g>>BigInt(32)&BigInt(4294967295));return R[_++]=ot,ot=ot>>8,R[_++]=ot,ot=ot>>8,R[_++]=ot,ot=ot>>8,R[_++]=ot,_}function Qt(R,g,_,M,G){ct(g,M,G,R,_,7);let tt=Number(g&BigInt(4294967295));R[_+7]=tt,tt=tt>>8,R[_+6]=tt,tt=tt>>8,R[_+5]=tt,tt=tt>>8,R[_+4]=tt;let ot=Number(g>>BigInt(32)&BigInt(4294967295));return R[_+3]=ot,ot=ot>>8,R[_+2]=ot,ot=ot>>8,R[_+1]=ot,ot=ot>>8,R[_]=ot,_+8}u.prototype.writeBigUInt64LE=zt(function(g,_=0){return jt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=zt(function(g,_=0){return Qt(this,g,_,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(g,_,M,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*M-1);ut(this,g,_,M,Ie-1,-Ie)}let tt=0,ot=1,Ht=0;for(this[_]=g&255;++tt<M&&(ot*=256);)g<0&&Ht===0&&this[_+tt-1]!==0&&(Ht=1),this[_+tt]=(g/ot>>0)-Ht&255;return _+M},u.prototype.writeIntBE=function(g,_,M,G){if(g=+g,_=_>>>0,!G){const Ie=Math.pow(2,8*M-1);ut(this,g,_,M,Ie-1,-Ie)}let tt=M-1,ot=1,Ht=0;for(this[_+tt]=g&255;--tt>=0&&(ot*=256);)g<0&&Ht===0&&this[_+tt+1]!==0&&(Ht=1),this[_+tt]=(g/ot>>0)-Ht&255;return _+M},u.prototype.writeInt8=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,1,127,-128),g<0&&(g=255+g+1),this[_]=g&255,_+1},u.prototype.writeInt16LE=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,2,32767,-32768),this[_]=g&255,this[_+1]=g>>>8,_+2},u.prototype.writeInt16BE=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,2,32767,-32768),this[_]=g>>>8,this[_+1]=g&255,_+2},u.prototype.writeInt32LE=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,4,2147483647,-2147483648),this[_]=g&255,this[_+1]=g>>>8,this[_+2]=g>>>16,this[_+3]=g>>>24,_+4},u.prototype.writeInt32BE=function(g,_,M){return g=+g,_=_>>>0,M||ut(this,g,_,4,2147483647,-2147483648),g<0&&(g=4294967295+g+1),this[_]=g>>>24,this[_+1]=g>>>16,this[_+2]=g>>>8,this[_+3]=g&255,_+4},u.prototype.writeBigInt64LE=zt(function(g,_=0){return jt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=zt(function(g,_=0){return Qt(this,g,_,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Dt(R,g,_,M,G,tt){if(_+M>R.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("Index out of range")}function Pt(R,g,_,M,G){return g=+g,_=_>>>0,G||Dt(R,g,_,4),n.write(R,g,_,M,23,4),_+4}u.prototype.writeFloatLE=function(g,_,M){return Pt(this,g,_,!0,M)},u.prototype.writeFloatBE=function(g,_,M){return Pt(this,g,_,!1,M)};function le(R,g,_,M,G){return g=+g,_=_>>>0,G||Dt(R,g,_,8),n.write(R,g,_,M,52,8),_+8}u.prototype.writeDoubleLE=function(g,_,M){return le(this,g,_,!0,M)},u.prototype.writeDoubleBE=function(g,_,M){return le(this,g,_,!1,M)},u.prototype.copy=function(g,_,M,G){if(!u.isBuffer(g))throw new TypeError("argument should be a Buffer");if(M||(M=0),!G&&G!==0&&(G=this.length),_>=g.length&&(_=g.length),_||(_=0),G>0&&G<M&&(G=M),G===M||g.length===0||this.length===0)return 0;if(_<0)throw new RangeError("targetStart out of bounds");if(M<0||M>=this.length)throw new RangeError("Index out of range");if(G<0)throw new RangeError("sourceEnd out of bounds");G>this.length&&(G=this.length),g.length-_<G-M&&(G=g.length-_+M);const tt=G-M;return this===g&&typeof s.prototype.copyWithin=="function"?this.copyWithin(_,M,G):s.prototype.set.call(g,this.subarray(M,G),_),tt},u.prototype.fill=function(g,_,M,G){if(typeof g=="string"){if(typeof _=="string"?(G=_,_=0,M=this.length):typeof M=="string"&&(G=M,M=this.length),G!==void 0&&typeof G!="string")throw new TypeError("encoding must be a string");if(typeof G=="string"&&!u.isEncoding(G))throw new TypeError("Unknown encoding: "+G);if(g.length===1){const ot=g.charCodeAt(0);(G==="utf8"&&ot<128||G==="latin1")&&(g=ot)}}else typeof g=="number"?g=g&255:typeof g=="boolean"&&(g=Number(g));if(_<0||this.length<_||this.length<M)throw new RangeError("Out of range index");if(M<=_)return this;_=_>>>0,M=M===void 0?this.length:M>>>0,g||(g=0);let tt;if(typeof g=="number")for(tt=_;tt<M;++tt)this[tt]=g;else{const ot=u.isBuffer(g)?g:u.from(g,G),Ht=ot.length;if(Ht===0)throw new TypeError('The value "'+g+'" is invalid for argument "value"');for(tt=0;tt<M-_;++tt)this[tt+_]=ot[tt%Ht]}return this};const qt={};function Ne(R,g,_){qt[R]=class extends _{constructor(){super(),Object.defineProperty(this,"message",{value:g.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${R}]`,this.stack,delete this.name}get code(){return R}set code(G){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:G,writable:!0})}toString(){return`${this.name} [${R}]: ${this.message}`}}}Ne("ERR_BUFFER_OUT_OF_BOUNDS",function(R){return R?`${R} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Ne("ERR_INVALID_ARG_TYPE",function(R,g){return`The "${R}" argument must be of type number. Received type ${typeof g}`},TypeError),Ne("ERR_OUT_OF_RANGE",function(R,g,_){let M=`The value of "${R}" is out of range.`,G=_;return Number.isInteger(_)&&Math.abs(_)>2**32?G=$e(String(_)):typeof _=="bigint"&&(G=String(_),(_>BigInt(2)**BigInt(32)||_<-(BigInt(2)**BigInt(32)))&&(G=$e(G)),G+="n"),M+=` It must be ${g}. Received ${G}`,M},RangeError);function $e(R){let g="",_=R.length;const M=R[0]==="-"?1:0;for(;_>=M+4;_-=3)g=`_${R.slice(_-3,_)}${g}`;return`${R.slice(0,_)}${g}`}function x(R,g,_){nt(g,"offset"),(R[g]===void 0||R[g+_]===void 0)&&D(g,R.length-(_+1))}function ct(R,g,_,M,G,tt){if(R>_||R<g){const ot=typeof g=="bigint"?"n":"";let Ht;throw g===0||g===BigInt(0)?Ht=`>= 0${ot} and < 2${ot} ** ${(tt+1)*8}${ot}`:Ht=`>= -(2${ot} ** ${(tt+1)*8-1}${ot}) and < 2 ** ${(tt+1)*8-1}${ot}`,new qt.ERR_OUT_OF_RANGE("value",Ht,R)}x(M,G,tt)}function nt(R,g){if(typeof R!="number")throw new qt.ERR_INVALID_ARG_TYPE(g,"number",R)}function D(R,g,_){throw Math.floor(R)!==R?(nt(R,_),new qt.ERR_OUT_OF_RANGE("offset","an integer",R)):g<0?new qt.ERR_BUFFER_OUT_OF_BOUNDS:new qt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${g}`,R)}const F=/[^+/0-9A-Za-z-_]/g;function V(R){if(R=R.split("=")[0],R=R.trim().replace(F,""),R.length<2)return"";for(;R.length%4!==0;)R=R+"=";return R}function ht(R,g){g=g||1/0;let _;const M=R.length;let G=null;const tt=[];for(let ot=0;ot<M;++ot){if(_=R.charCodeAt(ot),_>55295&&_<57344){if(!G){if(_>56319){(g-=3)>-1&&tt.push(239,191,189);continue}else if(ot+1===M){(g-=3)>-1&&tt.push(239,191,189);continue}G=_;continue}if(_<56320){(g-=3)>-1&&tt.push(239,191,189),G=_;continue}_=(G-55296<<10|_-56320)+65536}else G&&(g-=3)>-1&&tt.push(239,191,189);if(G=null,_<128){if((g-=1)<0)break;tt.push(_)}else if(_<2048){if((g-=2)<0)break;tt.push(_>>6|192,_&63|128)}else if(_<65536){if((g-=3)<0)break;tt.push(_>>12|224,_>>6&63|128,_&63|128)}else if(_<1114112){if((g-=4)<0)break;tt.push(_>>18|240,_>>12&63|128,_>>6&63|128,_&63|128)}else throw new Error("Invalid code point")}return tt}function pt(R){const g=[];for(let _=0;_<R.length;++_)g.push(R.charCodeAt(_)&255);return g}function Z(R,g){let _,M,G;const tt=[];for(let ot=0;ot<R.length&&!((g-=2)<0);++ot)_=R.charCodeAt(ot),M=_>>8,G=_%256,tt.push(G),tt.push(M);return tt}function _t(R){return t.toByteArray(V(R))}function vt(R,g,_,M){let G;for(G=0;G<M&&!(G+_>=g.length||G>=R.length);++G)g[G+_]=R[G];return G}function gt(R,g){return R instanceof g||R!=null&&R.constructor!=null&&R.constructor.name!=null&&R.constructor.name===g.name}function Ct(R){return R!==R}const fe=function(){const R="0123456789abcdef",g=new Array(256);for(let _=0;_<16;++_){const M=_*16;for(let G=0;G<16;++G)g[M+G]=R[_]+R[G]}return g}();function zt(R){return typeof BigInt>"u"?Vn:R}function Vn(){throw new Error("BigInt not supported")}})(z0);const fn=z0.Buffer,G0=e=>e===void 0?null:e;class Iv{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let K0=new Iv,Cv=!0;try{typeof localStorage<"u"&&localStorage&&(K0=localStorage,Cv=!1)}catch{}const Lv=K0,Mv=Object.assign,Uv=Object.keys,Fv=(e,t)=>{for(const n in e)t(e[n],n)},H0=e=>Uv(e).length,Bv=e=>{for(const t in e)return!1;return!0},Pv=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},$v=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Dv=(e,t)=>e===t||H0(e)===H0(t)&&Pv(e,(n,r)=>(n!==void 0||$v(t,r))&&t[r]===n),jv=Object.freeze,Y0=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&Y0(e[t])}return jv(e)},Gu=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Gu(e,t,n+1)}},zv=e=>e,Wv=(e,t)=>t.includes(e);var V0={};const jo=typeof Er<"u"&&Er.release&&/node|io\.js/.test(Er.release.name)&&Object.prototype.toString.call(typeof Er<"u"?Er:0)==="[object process]";let Yr;const Gv=()=>{if(Yr===void 0)if(jo){Yr=xr();const e=Er.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&Yr.set(t,""),t=r):t!==null&&(Yr.set(t,r),t=null)}t!==null&&Yr.set(t,"")}else typeof location=="object"?(Yr=xr(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Yr.set(`--${C0(t,"-")}`,n),Yr.set(`-${C0(t,"-")}`,n)}})):Yr=xr();return Yr},Ku=e=>Gv().has(e),ac=e=>G0(jo?V0[e.toUpperCase().replaceAll("-","_")]:Lv.getItem(e)),X0=e=>Ku("--"+e)||ac(e)!==null;X0("production");const Kv=jo&&Wv(V0.FORCE_COLOR,["true","1","2"])||!Ku("--no-colors")&&!X0("no-color")&&(!jo||Er.stdout.isTTY)&&(!jo||Ku("--color")||ac("COLORTERM")!==null||(ac("TERM")||"").includes("color")),Hv=e=>new Uint8Array(e),Yv=e=>{const t=Hv(e.byteLength);return t.set(e),t};class Vv{constructor(t,n){this.left=t,this.right=n}}const gi=(e,t)=>new Vv(e,t);typeof DOMParser<"u"&&new DOMParser;const Xv=e=>Yx(e,(t,n)=>`${n}:${t};`).join(""),_i=Symbol,q0=_i(),J0=_i(),qv=_i(),Jv=_i(),Zv=_i(),Z0=_i(),Qv=_i(),Hu=_i(),tT=_i(),eT=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){const s=e[r];s instanceof Symbol||n.push(s)}return n},nT={[q0]:gi("font-weight","bold"),[J0]:gi("font-weight","normal"),[qv]:gi("color","blue"),[Zv]:gi("color","green"),[Jv]:gi("color","grey"),[Z0]:gi("color","red"),[Qv]:gi("color","purple"),[Hu]:gi("color","orange"),[tT]:gi("color","black")},Q0=Kv?e=>{var o;e.length===1&&((o=e[0])==null?void 0:o.constructor)===Function&&(e=e[0]());const t=[],n=[],r=xr();let i=[],s=0;for(;s<e.length;s++){const a=e[s],c=nT[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=Xv(r);s>0||l.length>0?(t.push("%c"+a),n.push(l)):t.push(a)}else break}}for(s>0&&(i=n,i.unshift(t.join("")));s<e.length;s++){const a=e[s];a instanceof Symbol||i.push(a)}return i}:eT,rT=(...e)=>{console.log(...Q0(e)),tp.forEach(t=>t.print(e))},iT=(...e)=>{console.warn(...Q0(e)),e.unshift(Hu),tp.forEach(t=>t.print(e))},tp=zs(),ep=e=>({[Symbol.iterator](){return this},next:e}),sT=(e,t)=>ep(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Yu=(e,t)=>ep(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class Vu{constructor(t,n){this.clock=t,this.len=n}}class zo{constructor(){this.clients=new Map}}const np=(e,t,n)=>t.clients.forEach((r,i)=>{const s=e.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];yp(e,s,a.clock,a.len,n)}}),oT=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ui((n+r)/2),s=e[i],o=s.clock;if(o<=t){if(t<o+s.len)return i;n=i+1}else r=i-1}return null},rp=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&oT(n,t.clock)!==null},Xu=e=>{e.clients.forEach(t=>{t.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],s=t[n];i.clock+i.len>=s.clock?i.len=cs(i.len,s.clock+s.len-i.clock):(r<n&&(t[r]=s),r++)}t.length=r})},aT=e=>{const t=new zo;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const s=r.slice();for(let o=n+1;o<e.length;o++)Xx(s,e[o].clients.get(i)||[]);t.clients.set(i,s)}});return Xu(t),t},cc=(e,t,n,r)=>{Mi(e.clients,t,()=>[]).push(new Vu(n,r))},cT=()=>new zo,lT=e=>{const t=cT();return e.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new Vu(a,c))}}i.length>0&&t.clients.set(r,i)}),t},Vs=(e,t)=>{oe(e.restEncoder,t.clients.size),as(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),oe(e.restEncoder,n);const i=r.length;oe(e.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];e.writeDsClock(o.clock),e.writeDsLen(o.len)}})},qu=e=>{const t=new zo,n=Xt(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=Xt(e.restDecoder),s=Xt(e.restDecoder);if(s>0){const o=Mi(t.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new Vu(e.readDsClock(),e.readDsLen()))}}return t},ip=(e,t,n)=>{const r=new zo,i=Xt(e.restDecoder);for(let s=0;s<i;s++){e.resetDsCurVal();const o=Xt(e.restDecoder),a=Xt(e.restDecoder),c=n.clients.get(o)||[],l=sn(n,o);for(let u=0;u<a;u++){const f=e.readDsClock(),d=f+e.readDsLen();if(f<l){l<d&&cc(r,o,l,d-l);let h=Vr(c,f),m=c[h];for(!m.deleted&&m.id.clock<f&&(c.splice(h+1,0,Ec(t,m,f-m.id.clock)),h++);h<c.length&&(m=c[h++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&c.splice(h,0,Ec(t,m,d-m.id.clock)),m.delete(t))}else cc(r,o,f,d-f)}}if(r.clients.size>0){const s=new us;return oe(s.restEncoder,0),Vs(s,r),s.toUint8Array()}return null},sp=D0;class Xs extends Jx{constructor({guid:t=Ev(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=sp(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new mp,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=j0(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>j0(l=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const t=this._item;t!==null&&!this.shouldLoad&&pe(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(as(this.subdocs).map(t=>t.guid))}transact(t,n=null){return pe(this,t,n)}get(t,n=dn){const r=Mi(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==dn&&i!==n)if(i===dn){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Qs)}getText(t=""){return this.get(t,yi)}getMap(t=""){return this.get(t,to)}getXmlElement(t=""){return this.get(t,no)}getXmlFragment(t=""){return this.get(t,hs)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,as(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Xs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,pe(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class op{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return Xt(this.restDecoder)}readDsLen(){return Xt(this.restDecoder)}}class ap extends op{readLeftID(){return te(Xt(this.restDecoder),Xt(this.restDecoder))}readRightID(){return te(Xt(this.restDecoder),Xt(this.restDecoder))}readClient(){return Xt(this.restDecoder)}readInfo(){return Ks(this.restDecoder)}readString(){return Hs(this.restDecoder)}readParentInfo(){return Xt(this.restDecoder)===1}readTypeRef(){return Xt(this.restDecoder)}readLen(){return Xt(this.restDecoder)}readAny(){return Do(this.restDecoder)}readBuf(){return Yv(Qn(this.restDecoder))}readJSON(){return JSON.parse(Hs(this.restDecoder))}readKey(){return Hs(this.restDecoder)}}class uT{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Xt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=Xt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class qs extends uT{constructor(t){super(t),this.keys=[],Xt(t),this.keyClockDecoder=new ju(Qn(t)),this.clientDecoder=new sc(Qn(t)),this.leftClockDecoder=new ju(Qn(t)),this.rightClockDecoder=new ju(Qn(t)),this.infoDecoder=new $0(Qn(t),Ks),this.stringDecoder=new bv(Qn(t)),this.parentInfoDecoder=new $0(Qn(t),Ks),this.typeRefDecoder=new sc(Qn(t)),this.lenDecoder=new sc(Qn(t))}readLeftID(){return new Js(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Js(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Do(this.restDecoder)}readBuf(){return Qn(this.restDecoder)}readJSON(){return Do(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class hT{constructor(){this.restEncoder=ec()}toUint8Array(){return Wr(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){oe(this.restEncoder,t)}writeDsLen(t){oe(this.restEncoder,t)}}class Wo extends hT{writeLeftID(t){oe(this.restEncoder,t.client),oe(this.restEncoder,t.clock)}writeRightID(t){oe(this.restEncoder,t.client),oe(this.restEncoder,t.clock)}writeClient(t){oe(this.restEncoder,t)}writeInfo(t){Mu(this.restEncoder,t)}writeString(t){Ws(this.restEncoder,t)}writeParentInfo(t){oe(this.restEncoder,t?1:0)}writeTypeRef(t){oe(this.restEncoder,t)}writeLen(t){oe(this.restEncoder,t)}writeAny(t){$o(this.restEncoder,t)}writeBuf(t){Zn(this.restEncoder,t)}writeJSON(t){Ws(this.restEncoder,JSON.stringify(t))}writeKey(t){Ws(this.restEncoder,t)}}class fT{constructor(){this.restEncoder=ec(),this.dsCurrVal=0}toUint8Array(){return Wr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,oe(this.restEncoder,n)}writeDsLen(t){t===0&&Kr(),oe(this.restEncoder,t-1),this.dsCurrVal+=t}}class us extends fT{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Pu,this.clientEncoder=new rc,this.leftClockEncoder=new Pu,this.rightClockEncoder=new Pu,this.infoEncoder=new M0(Mu),this.stringEncoder=new mv,this.parentInfoEncoder=new M0(Mu),this.typeRefEncoder=new rc,this.lenEncoder=new rc}toUint8Array(){const t=ec();return oe(t,0),Zn(t,this.keyClockEncoder.toUint8Array()),Zn(t,this.clientEncoder.toUint8Array()),Zn(t,this.leftClockEncoder.toUint8Array()),Zn(t,this.rightClockEncoder.toUint8Array()),Zn(t,Wr(this.infoEncoder)),Zn(t,this.stringEncoder.toUint8Array()),Zn(t,Wr(this.parentInfoEncoder)),Zn(t,this.typeRefEncoder.toUint8Array()),Zn(t,this.lenEncoder.toUint8Array()),nc(t,Wr(this.restEncoder)),Wr(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){$o(this.restEncoder,t)}writeBuf(t){Zn(this.restEncoder,t)}writeJSON(t){$o(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const dT=(e,t,n,r)=>{r=cs(r,t[0].id.clock);const i=Vr(t,r);oe(e.restEncoder,t.length-i),e.writeClient(n),oe(e.restEncoder,r);const s=t[i];s.write(e,r-s.id.clock);for(let o=i+1;o<t.length;o++)t[o].write(e,0)},Ju=(e,t,n)=>{const r=new Map;n.forEach((i,s)=>{sn(t,s)>i&&r.set(s,i)}),Qu(t).forEach((i,s)=>{n.has(s)||r.set(s,0)}),oe(e.restEncoder,r.size),as(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{dT(e,t.clients.get(i),i,s)})},pT=(e,t)=>{const n=xr(),r=Xt(e.restDecoder);for(let i=0;i<r;i++){const s=Xt(e.restDecoder),o=new Array(s),a=e.readClient();let c=Xt(e.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=e.readInfo();switch(tc&u){case 0:{const f=e.readLen();o[l]=new ar(te(a,c),f),c+=f;break}case 10:{const f=Xt(e.restDecoder);o[l]=new cr(te(a,c),f),c+=f;break}default:{const f=(u&(mi|Jn))===0,d=new Ze(te(a,c),null,(u&Jn)===Jn?e.readLeftID():null,null,(u&mi)===mi?e.readRightID():null,f?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,f&&(u&Uo)===Uo?e.readString():null,Wp(e,u));o[l]=d,c+=d.length}}}}return n},mT=(e,t,n)=>{const r=[];let i=as(n.keys()).sort((h,m)=>h-m);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let h=n.get(i[i.length-1]);for(;h.refs.length===h.i;)if(i.pop(),i.length>0)h=n.get(i[i.length-1]);else return null;return h};let o=s();if(o===null)return null;const a=new mp,c=new Map,l=(h,m)=>{const p=c.get(h);(p==null||p>m)&&c.set(h,m)};let u=o.refs[o.i++];const f=new Map,d=()=>{for(const h of r){const m=h.id.client,p=n.get(m);p?(p.i--,a.clients.set(m,p.refs.slice(p.i)),n.delete(m),p.i=0,p.refs=[]):a.clients.set(m,[h]),i=i.filter(b=>b!==m)}r.length=0};for(;;){if(u.constructor!==cr){const m=Mi(f,u.id.client,()=>sn(t,u.id.client))-u.id.clock;if(m<0)r.push(u),l(u.id.client,u.id.clock-1),d();else{const p=u.getMissing(e,t);if(p!==null){r.push(u);const b=n.get(p)||{refs:[],i:0};if(b.refs.length===b.i)l(p,sn(t,p)),d();else{u=b.refs[b.i++];continue}}else(m===0||m<u.length)&&(u.integrate(e,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const h=new us;return Ju(h,a,new Map),oe(h.restEncoder,0),{missing:c,update:h.toUint8Array()}}return null},gT=(e,t)=>Ju(e,t.doc.store,t.beforeState),_T=(e,t,n,r=new qs(e))=>pe(t,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=pT(r,o),l=mT(i,a,c),u=a.pendingStructs;if(u){for(const[d,h]of u.missing)if(h<sn(a,d)){s=!0;break}if(l){for(const[d,h]of l.missing){const m=u.missing.get(d);(m==null||m>h)&&u.missing.set(d,h)}u.update=hc([u.update,l.update])}}else a.pendingStructs=l;const f=ip(r,i,a);if(a.pendingDs){const d=new qs(Gs(a.pendingDs));Xt(d.restDecoder);const h=ip(d,i,a);f&&h?a.pendingDs=hc([f,h]):a.pendingDs=f||h}else a.pendingDs=f;if(s){const d=a.pendingStructs.update;a.pendingStructs=null,cp(i.doc,d)}},n,!1),cp=(e,t,n,r=qs)=>{const i=Gs(t);_T(i,e,n,new r(i))},lp=(e,t,n)=>cp(e,t,n,ap),yT=(e,t,n=new Map)=>{Ju(e,t.store,n),Vs(e,lT(t.store))},bT=(e,t=new Uint8Array([0]),n=new us)=>{const r=up(t);yT(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(IT(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Wo)return OT(i.map((s,o)=>o===0?s:LT(s)));if(n.constructor===us)return hc(i)}return i[0]},kT=(e,t)=>bT(e,t,new Wo),wT=e=>{const t=new Map,n=Xt(e.restDecoder);for(let r=0;r<n;r++){const i=Xt(e.restDecoder),s=Xt(e.restDecoder);t.set(i,s)}return t},up=e=>wT(new op(Gs(e)));class ET{constructor(){this.l=[]}}const hp=()=>new ET,fp=(e,t)=>e.l.push(t),dp=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},pp=(e,t,n)=>Gu(e.l,[t,n]);class Js{constructor(t,n){this.client=t,this.clock=n}}const lc=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,te=(e,t)=>new Js(e,t),xT=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Kr()},Zs=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!rp(t.ds,e.id),Zu=(e,t)=>{const n=Mi(e.meta,Zu,zs),r=e.doc.store;n.has(t)||(t.sv.forEach((i,s)=>{i<sn(r,s)&&Bi(e,te(s,i))}),np(e,t.ds,i=>{}),n.add(t))};class mp{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Qu=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},sn=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},gp=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Kr()}n.push(t)},Vr=(e,t)=>{let n=0,r=e.length-1,i=e[r],s=i.id.clock;if(s===t)return r;let o=Ui(t/(s+i.length-1)*r);for(;n<=r;){if(i=e[o],s=i.id.clock,s<=t){if(t<s+i.length)return o;n=o+1}else r=o-1;o=Ui((n+r)/2)}throw Kr()},th=(e,t)=>{const n=e.clients.get(t.client);return n[Vr(n,t.clock)]},eh=(e,t,n)=>{const r=Vr(t,n),i=t[r];return i.id.clock<n&&i instanceof Ze?(t.splice(r+1,0,Ec(e,i,n-i.id.clock)),r+1):r},Bi=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[eh(e,n,t.clock)]},_p=(e,t,n)=>{const r=t.clients.get(n.client),i=Vr(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==ar&&r.splice(i+1,0,Ec(e,s,n.clock-s.id.clock+1)),s},vT=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Vr(r,t.id.clock)]=n},yp=(e,t,n,r,i)=>{if(r===0)return;const s=n+r;let o=eh(e,t,n),a;do a=t[o++],s<a.id.clock+a.length&&eh(e,t,s),i(a);while(o<t.length&&t[o].id.clock<s)};class TT{constructor(t,n,r){this.doc=t,this.deleteSet=new zo,this.beforeState=Qu(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const bp=(e,t)=>t.deleteSet.clients.size===0&&!Vx(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Xu(t.deleteSet),gT(e,t),Vs(e,t.deleteSet),!0),kp=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&Mi(e.changed,t,zs).add(n)},uc=(e,t)=>{let n=e[t],r=e[t-1],i=t;for(;i>0;n=r,r=e[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=t-i;return s&&e.splice(t+1-s,s),s},AT=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const s=t.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=Vr(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const f=s[l];if(a.clock+a.len<=f.id.clock)break;f instanceof Ze&&f.deleted&&!f.keep&&n(f)&&f.gc(t,!1)}}}},ST=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=S0(i.length-1,1+Vr(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+uc(i,c)}})},wp=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{Xu(s),n.afterState=Qu(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,f)=>u.path.length-f.path.length),pp(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Gu(a,[]),n._needFormattingCleanup&&YT(n)}finally{r.gc&&AT(s,i,r.gcFilter),ST(s,i),n.afterState.forEach((u,f)=>{const d=n.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),m=cs(Vr(h,d),1);for(let p=h.length-1;p>=m;)p-=1+uc(h,p)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),m=Vr(h,d);m+1<h.length&&uc(h,m+1)>1||m>0&&uc(h,m)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(rT(Hu,q0,"[yjs] ",J0,Z0,"Changed the client-id because another client seems to be using it."),r.clientID=sp()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new Wo;bp(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new us;bp(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):wp(e,t+1)}}},pe=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let s=!1,o=null;e._transaction===null&&(s=!0,e._transaction=new TT(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(s){const a=e._transaction===i[0];e._transaction=null,a&&wp(i,0)}}return o};function*RT(e){const t=Xt(e.restDecoder);for(let n=0;n<t;n++){const r=Xt(e.restDecoder),i=e.readClient();let s=Xt(e.restDecoder);for(let o=0;o<r;o++){const a=e.readInfo();if(a===10){const c=Xt(e.restDecoder);yield new cr(te(i,s),c),s+=c}else if(tc&a){const c=(a&(mi|Jn))===0,l=new Ze(te(i,s),null,(a&Jn)===Jn?e.readLeftID():null,null,(a&mi)===mi?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(a&Uo)===Uo?e.readString():null,Wp(e,a));yield l,s+=l.length}else{const c=e.readLen();yield new ar(te(i,s),c),s+=c}}}}class nh{constructor(t,n){this.gen=RT(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===cr);return this.curr}}class rh{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const OT=e=>hc(e,ap,Wo),NT=(e,t)=>{if(e.constructor===ar){const{client:n,clock:r}=e.id;return new ar(te(n,r+t),e.length-t)}else if(e.constructor===cr){const{client:n,clock:r}=e.id;return new cr(te(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new Ze(te(r,i+t),null,te(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},hc=(e,t=qs,n=us)=>{if(e.length===1)return e[0];const r=e.map(u=>new t(Gs(u)));let i=r.map(u=>new nh(u,!0)),s=null;const o=new n,a=new rh(o);for(;i=i.filter(d=>d.curr!==null),i.sort((d,h)=>{if(d.curr.id.client===h.curr.id.client){const m=d.curr.id.clock-h.curr.id.clock;return m===0?d.curr.constructor===h.curr.constructor?0:d.curr.constructor===cr?1:-1:m}else return h.curr.id.client-d.curr.id.client}),i.length!==0;){const u=i[0],f=u.curr.id.client;if(s!==null){let d=u.curr,h=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),h=!0;if(d===null||d.id.client!==f||h&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===cr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Pi(a,s.struct,s.offset);const m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new cr(te(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{const m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===cr?s.struct.length-=m:d=NT(d,m)),s.struct.mergeWith(d)||(Pi(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==cr;d=u.next())Pi(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Pi(a,s.struct,s.offset),s=null),ih(a);const c=r.map(u=>qu(u)),l=aT(c);return Vs(o,l),o.toUint8Array()},IT=(e,t,n=qs,r=us)=>{const i=up(t),s=new r,o=new rh(s),a=new n(Gs(e)),c=new nh(a,!1);for(;c.curr;){const u=c.curr,f=u.id.client,d=i.get(f)||0;if(c.curr.constructor===cr){c.next();continue}if(u.id.clock+u.length>d)for(Pi(o,u,cs(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===f;)Pi(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===f&&c.curr.id.clock+c.curr.length<=d;)c.next()}ih(o);const l=qu(a);return Vs(s,l),s.toUint8Array()},Ep=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Wr(e.encoder.restEncoder)}),e.encoder.restEncoder=ec(),e.written=0)},Pi=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Ep(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),oe(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},ih=e=>{Ep(e);const t=e.encoder.restEncoder;oe(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];oe(t,r.written),nc(t,r.restEncoder)}},CT=(e,t,n,r)=>{const i=new n(Gs(e)),s=new nh(i,!1),o=new r,a=new rh(o);for(let l=s.curr;l!==null;l=s.next())Pi(a,t(l),0);ih(a);const c=qu(i);return Vs(o,c),o.toUint8Array()},LT=e=>CT(e,zv,qs,Wo),xp="You must not compute changes after the event-handler fired.";class fc{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=MT(this.currentTarget,this.target))}deletes(t){return rp(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(xp);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=Nu(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Nu(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Nu(s.content.getContent());else return;t.set(i,{action:o,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fi(xp);const n=this.target,r=zs(),i=zs(),s=[];if(t={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=t}return t}}const MT=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}t=t._item.parent}return n},yn=()=>{iT("Invalid access: Add Yjs type to a document before reading data.")},vp=80;let sh=0;class UT{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=sh++}}const FT=e=>{e.timestamp=sh++},Tp=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=sh++},BT=(e,t,n)=>{if(e.length>=vp){const r=e.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return Tp(r,t,n),r}else{const r=new UT(t,n);return e.push(r),r}},dc=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,o)=>Qa(t-s.index)<Qa(t-o.index)?s:o);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,FT(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Qa(n.index-i)<r.parent.length/vp?(Tp(n,r,i),n):BT(e._searchMarker,r,i)},Go=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){e.splice(r,1);continue}i.p=s,s.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=cs(t,i.index+n))}},pc=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;Mi(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;pp(r._eH,n,t)};class dn{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=hp(),this._dEH=hp(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Gr()}clone(){throw Gr()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){fp(this._eH,t)}observeDeep(t){fp(this._dEH,t)}unobserve(t){dp(this._eH,t)}unobserveDeep(t){dp(this._dEH,t)}toJSON(){}}const Ap=(e,t,n)=>{e.doc??yn(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let s=e._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=t)t-=o.length;else{for(let a=t;a<o.length&&r>0;a++)i.push(o[a]),r--;t=0}}s=s.right}return i},Sp=e=>{e.doc??yn();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},Ko=(e,t)=>{let n=0,r=e._start;for(e.doc??yn();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)t(i[s],n++,e)}r=r.right}},Rp=(e,t)=>{const n=[];return Ko(e,(r,i)=>{n.push(t(r,i,e))}),n},PT=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},Op=(e,t)=>{e.doc??yn();const n=dc(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},mc=(e,t,n,r)=>{let i=n;const s=e.doc,o=s.clientID,a=s.store,c=n===null?t._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new Ze(te(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new ds(l)),i.integrate(e,0),l=[])};r.forEach(f=>{if(f===null)l.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new Ze(te(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Ho(new Uint8Array(f))),i.integrate(e,0);break;case Xs:i=new Ze(te(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new Vo(f)),i.integrate(e,0);break;default:if(f instanceof dn)i=new Ze(te(o,sn(a,o)),i,i&&i.lastId,c,c&&c.id,t,null,new bi(f)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Np=()=>Fi("Length exceeded!"),Ip=(e,t,n,r)=>{if(n>t._length)throw Np();if(n===0)return t._searchMarker&&Go(t._searchMarker,n,r.length),mc(e,t,null,r);const i=n,s=dc(t,n);let o=t._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Bi(e,te(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&Go(t._searchMarker,i,r.length),mc(e,t,o,r)},$T=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return mc(e,t,i,n)},Cp=(e,t,n,r)=>{if(r===0)return;const i=n,s=r,o=dc(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Bi(e,te(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Bi(e,te(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw Np();t._searchMarker&&Go(t._searchMarker,i,-s+r)},gc=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},oh=(e,t,n,r)=>{const i=t._map.get(n)||null,s=e.doc,o=s.clientID;let a;if(r==null)a=new ds([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ds([r]);break;case Uint8Array:a=new Ho(r);break;case Xs:a=new Vo(r);break;default:if(r instanceof dn)a=new bi(r);else throw new Error("Unexpected content type")}new Ze(te(o,sn(s.store,o)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},ah=(e,t)=>{e.doc??yn();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Lp=e=>{const t={};return e.doc??yn(),e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Mp=(e,t)=>{e.doc??yn();const n=e._map.get(t);return n!==void 0&&!n.deleted},DT=(e,t)=>{const n={};return e._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Zs(s,t)&&(n[i]=s.content.getContent()[s.length-1])}),n},_c=e=>(e.doc??yn(),sT(e._map.entries(),t=>!t[1].deleted));class jT extends fc{}class Qs extends dn{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Qs;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Qs}clone(){const t=new Qs;return t.insert(0,this.toArray().map(n=>n instanceof dn?n.clone():n)),t}get length(){return this.doc??yn(),this._length}_callObserver(t,n){super._callObserver(t,n),pc(this,t,new jT(this,t))}insert(t,n){this.doc!==null?pe(this.doc,r=>{Ip(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?pe(this.doc,n=>{$T(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{Cp(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Op(this,t)}toArray(){return Sp(this)}slice(t=0,n=this.length){return Ap(this,t,n)}toJSON(){return this.map(t=>t instanceof dn?t.toJSON():t)}map(t){return Rp(this,t)}forEach(t){Ko(this,t)}[Symbol.iterator](){return PT(this)}_write(t){t.writeTypeRef(fA)}}const zT=e=>new Qs;class WT extends fc{constructor(t,n,r){super(t,n),this.keysChanged=r}}class to extends dn{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new to}clone(){const t=new to;return this.forEach((n,r)=>{t.set(r,n instanceof dn?n.clone():n)}),t}_callObserver(t,n){pc(this,t,new WT(this,t,n))}toJSON(){this.doc??yn();const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof dn?i.toJSON():i}}),t}get size(){return[..._c(this)].length}keys(){return Yu(_c(this),t=>t[0])}values(){return Yu(_c(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Yu(_c(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??yn(),this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?pe(this.doc,n=>{gc(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?pe(this.doc,r=>{oh(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return ah(this,t)}has(t){return Mp(this,t)}clear(){this.doc!==null?pe(this.doc,t=>{this.forEach(function(n,r,i){gc(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(dA)}}const GT=e=>new to,$i=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Dv(e,t);class ch{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Kr(),this.right.content.constructor){case Je:this.right.deleted||eo(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Up=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Je:t.right.deleted||eo(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&Bi(e,te(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},yc=(e,t,n,r)=>{const i=new Map,s=r?dc(t,n):null;if(s){const o=new ch(s.p.left,s.p,s.index,i);return Up(e,o,n-s.index)}else{const o=new ch(null,t._start,0,i);return Up(e,o,n)}},Fp=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Je&&$i(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new Ze(te(s,sn(i.store,s)),c,c&&c.lastId,l,l&&l.id,t,null,new Je(a,o));u.integrate(e,0),n.right=u,n.forward()})},eo=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Bp=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Je&&$i(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},Pp=(e,t,n,r)=>{const i=e.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!$i(l,c)){o.set(a,l);const{left:u,right:f}=n;n.right=new Ze(te(s,sn(i.store,s)),u,u&&u.lastId,f,f&&f.id,t,null,new Je(a,c)),n.right.integrate(e,0),n.forward()}}return o},lh=(e,t,n,r,i)=>{n.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=e.doc,o=s.clientID;Bp(n,i);const a=Pp(e,t,n,i),c=r.constructor===String?new Xr(r):r instanceof dn?new bi(r):new fs(r);let{left:l,right:u,index:f}=n;t._searchMarker&&Go(t._searchMarker,n.index,c.getLength()),u=new Ze(te(o,sn(s.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=f,n.forward(),Fp(e,t,n,a)},$p=(e,t,n,r,i)=>{const s=e.doc,o=s.clientID;Bp(n,i);const a=Pp(e,t,n,i);t:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Je));){if(!n.right.deleted)switch(n.right.content.constructor){case Je:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if($i(u,l))a.delete(c);else{if(r===0)break t;a.set(c,l)}n.right.delete(e)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&Bi(e,te(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new Ze(te(o,sn(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Xr(c)),n.right.integrate(e,0),n.forward()}Fp(e,t,n,a)},Dp=(e,t,n,r,i)=>{let s=t;const o=xr();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;t!==s;){if(n===t&&(c=!0),!t.deleted){const l=t.content;switch(l.constructor){case Je:{const{key:u,value:f}=l,d=r.get(u)??null;(o.get(u)!==l||d===f)&&(t.delete(e),a++,!c&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!c&&!t.deleted&&eo(i,l);break}}}t=t.right}return a},KT=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Je){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},HT=e=>{let t=0;return pe(e.doc,n=>{let r=e._start,i=e._start,s=xr();const o=Ou(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:eo(o,i.content);break;default:t+=Dp(n,r,i,s,o),s=Ou(o),r=i;break}i=i.right}}),t},YT=e=>{const t=new Set,n=e.doc;for(const[r,i]of e.afterState.entries()){const s=e.beforeState.get(r)||0;i!==s&&yp(e,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==ar&&t.add(o.parent)})}pe(n,r=>{np(e,e.deleteSet,i=>{if(i instanceof ar||!i.parent._hasFormatting||t.has(i.parent))return;const s=i.parent;i.content.constructor===Je?t.add(s):KT(r,i)});for(const i of t)HT(i)})},jp=(e,t,n)=>{const r=n,i=Ou(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case bi:case fs:case Xr:n<t.right.length&&Bi(e,te(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&Dp(e,s,t.right,i,t.currentAttributes);const o=(t.left||t.right).parent;return o._searchMarker&&Go(o._searchMarker,t.index,-r+n),t};class VT extends fc{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];pe(t,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof l=="object"||l.length>0)&&(h={insert:l},i.size>0&&(h.attributes={},i.forEach((m,p)=>{m!==null&&(h.attributes[p]=m)}))),l="";break;case"retain":u>0&&(h={retain:u},Bv(c)||(h.attributes=Mv({},c))),u=0;break}h&&n.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case bi:case fs:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Xr:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:m}=o.content;if(this.adds(o)){if(!this.deletes(o)){const p=i.get(h)??null;$i(p,m)?m!==null&&o.delete(r):(a==="retain"&&d(),$i(m,s.get(h)??null)?delete c[h]:c[h]=m)}}else if(this.deletes(o)){s.set(h,m);const p=i.get(h)??null;$i(p,m)||(a==="retain"&&d(),c[h]=p)}else if(!o.deleted){s.set(h,m);const p=c[h];p!==void 0&&($i(p,m)?p!==null&&o.delete(r):(a==="retain"&&d(),m===null?delete c[h]:c[h]=m))}o.deleted||(a==="insert"&&d(),eo(i,o.content));break}}o=o.right}for(d();n.length>0;){const h=n[n.length-1];if(h.retain!==void 0&&h.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class yi extends dn{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??yn(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new yi}clone(){const t=new yi;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new VT(this,t,n);pc(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??yn();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Xr&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?pe(this.doc,r=>{const i=new ch(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const o=t[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===t.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&lh(r,this,i,a,o.attributes||{})}else o.retain!==void 0?$p(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&jp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){this.doc??yn();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const f={};let d=!1;s.forEach((m,p)=>{d=!0,f[p]=m});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;c!==null;){if(Zs(c,t)||n!==void 0&&Zs(c,n))switch(c.content.constructor){case Xr:{const f=s.get("ychange");t!==void 0&&!Zs(c,t)?(f===void 0||f.user!==c.id.client||f.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Zs(c,n)?(f===void 0||f.user!==c.id.client||f.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):f!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case bi:case fs:{l();const f={insert:c.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,m)=>{d[m]=h})}i.push(f);break}case Je:Zs(c,t)&&(l(),eo(s,c.content));break}c=c.right}l()};return t||n?pe(o,f=>{t&&Zu(f,t),n&&Zu(f,n),u()},"cleanup"):u(),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?pe(i,s=>{const o=yc(s,this,t,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),lh(s,this,o,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){const i=this.doc;i!==null?pe(i,s=>{const o=yc(s,this,t,!r);lh(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?pe(r,i=>{jp(i,yc(i,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?pe(i,s=>{const o=yc(s,this,t,!1);o.right!==null&&$p(s,this,o,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{gc(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{oh(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return ah(this,t)}getAttributes(){return Lp(this)}_write(t){t.writeTypeRef(pA)}}const XT=e=>new yi;class uh{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??yn()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===no||n.constructor===hs)&&n._start!==null)t=n._start;else for(;t!==null;){const r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class hs extends dn{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new hs}clone(){const t=new hs;return t.insert(0,this.toArray().map(n=>n instanceof dn?n.clone():n)),t}get length(){return this.doc??yn(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new uh(this,t)}querySelector(t){t=t.toUpperCase();const r=new uh(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),as(new uh(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){pc(this,t,new ZT(this,n,t))}toString(){return Rp(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Ko(this,s=>{i.insertBefore(s.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?pe(this.doc,r=>{Ip(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)pe(this.doc,r=>{const i=t&&t instanceof dn?t._item:t;mc(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(s=>s===t)+1;if(i===0&&t!==null)throw Fi("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?pe(this.doc,r=>{Cp(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Sp(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Op(this,t)}slice(t=0,n=this.length){return Ap(this,t,n)}forEach(t){Ko(this,t)}_write(t){t.writeTypeRef(gA)}}const qT=e=>new hs;class no extends hs{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new no(this.nodeName)}clone(){const t=new no(this.nodeName),n=this.getAttributes();return Fv(n,(r,i)=>{typeof r=="string"&&t.setAttribute(i,r)}),t.insert(0,this.toArray().map(r=>r instanceof dn?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const a in t)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+t[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?pe(this.doc,n=>{gc(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?pe(this.doc,r=>{oh(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return ah(this,t)}hasAttribute(t){return Mp(this,t)}getAttributes(t){return t?DT(this,t):Lp(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Ko(this,o=>{i.appendChild(o.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(mA),t.writeKey(this.nodeName)}}const JT=e=>new no(e.readKey());class ZT extends fc{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class bc extends to{constructor(t){super(),this.hookName=t}_copy(){return new bc(this.hookName)}clone(){const t=new bc(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(_A),t.writeKey(this.hookName)}}const QT=e=>new bc(e.readKey());class kc extends yi{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new kc}clone(){const t=new kc;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const s=[];for(const o in t.attributes[i])s.push({key:o,value:t.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(yA)}}const tA=e=>new kc;class hh{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Gr()}mergeWith(t){return!1}write(t,n,r){throw Gr()}integrate(t,n){throw Gr()}}const eA=0;class ar extends hh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),gp(t.doc.store,this)}write(t,n){t.writeInfo(eA),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Ho{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ho(this.content)}splice(t){throw Gr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const nA=e=>new Ho(e.readBuf());class Yo{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Yo(this.len)}splice(t){const n=new Yo(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){cc(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const rA=e=>new Yo(e.readLen()),zp=(e,t)=>new Xs({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Vo{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Vo(zp(this.doc.guid,this.opts))}splice(t){throw Gr()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const iA=e=>new Vo(zp(e.readString(),e.readAny()));class fs{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new fs(this.embed)}splice(t){throw Gr()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const sA=e=>new fs(e.readJSON());class Je{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(t){throw Gr()}mergeWith(t){return!1}integrate(t,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const oA=e=>new Je(e.readKey(),e.readJSON());class wc{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new wc(this.arr)}splice(t){const n=new wc(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const aA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new wc(n)},cA=ac("node_env")==="development";class ds{constructor(t){this.arr=t,cA&&Y0(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ds(this.arr)}splice(t){const n=new ds(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];t.writeAny(s)}}getRef(){return 8}}const lA=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ds(n)};class Xr{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Xr(this.str)}splice(t){const n=new Xr(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const uA=e=>new Xr(e.readString()),hA=[zT,GT,XT,JT,qT,QT,tA],fA=0,dA=1,pA=2,mA=3,gA=4,_A=5,yA=6;class bi{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new bi(this.type._copy())}splice(t){throw Gr()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const bA=e=>new bi(hA[e.readTypeRef()](e)),Ec=(e,t,n)=>{const{client:r,clock:i}=t.id,s=new Ze(te(r,i+n),t,te(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=te(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s};class Ze extends hh{constructor(t,n,r,i,s,o,a,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?N0:0}set marker(t){(this.info&Cu)>0!==t&&(this.info^=Cu)}get marker(){return(this.info&Cu)>0}get keep(){return(this.info&O0)>0}set keep(t){this.keep!==t&&(this.info^=O0)}get countable(){return(this.info&N0)>0}get deleted(){return(this.info&Iu)>0}set deleted(t){this.deleted!==t&&(this.info^=Iu)}markDeleted(){this.info|=Iu}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=sn(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=sn(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Js&&this.id.client!==this.parent.client&&this.parent.clock>=sn(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=_p(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Bi(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ar||this.right&&this.right.constructor===ar)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Js){const r=th(n,this.parent);r.constructor===ar?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=_p(t,t.doc.store,te(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),lc(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(lc(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(th(t.doc.store,i.origin)))s.has(th(t.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),gp(t.doc.store,this),this.content.integrate(t,this),kp(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ar(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:te(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&lc(t.origin,this.lastId)&&this.right===t&&lc(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),cc(t.deleteSet,this.id.client,this.id.clock,this.length),kp(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Kr();this.content.gc(t),n?vT(t,this,new ar(this.id,this.length)):this.content=new Yo(this.length)}write(t,n){const r=n>0?te(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&tc|(r===null?0:Jn)|(i===null?0:mi)|(s===null?0:Uo);if(t.writeInfo(o),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=xT(a);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===Js?(t.writeParentInfo(!1),t.writeLeftID(a)):Kr();s!==null&&t.writeString(s)}this.content.write(t,n)}}const Wp=(e,t)=>kA[t&tc](e),kA=[()=>{Kr()},rA,aA,nA,uA,sA,oA,bA,lA,iA,()=>{Kr()}],wA=10;class cr extends hh{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Kr()}write(t,n){t.writeInfo(wA),oe(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const Gp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof js<"u"?js:{},Kp="__ $YJS$ __";Gp[Kp]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Gp[Kp]=!0;let Hp=!1;const tr=new Xs;function Yp(e,t,n){const r=tr.getMap();if(!r.has(e))switch(t){case 0:case 1:r.set(e,n);break}}function EA(e,t){Yp(e,0,t)}function fh(e,t){const n=new yi(t);Yp(e,1,n)}function xA(e,t){tr.getMap().set(e,t)}function vA(e,t){const n=tr.getMap(),r=new yi(t);n.set(e,r)}function Vp(e,t){const n=tr.getMap();function r(i){const s=n.get(e);for(let o=0;o<i.length;++o)(i[o].target===n||i[o].target===s)&&t(s)}return n.has(e)&&t(n.get(e)),n.observeDeep(r),()=>{n.observeDeep(r)}}function TA(e,t){return Vp(e,n=>{xt(n)&&t(n)})}function Xp(e,t){return Vp(e,n=>{n instanceof yi&&t(n.toJSON())})}const ps=Bs("modem",["second"],e=>{if(ps.session(e))switch(e.target){case"second":!Hp&&e.data%2===0&&ps.emit(e.player,"modem:join");break;case"join":e.sender!==ps.id()&&ps.reply(e,"joinack",x0(kT(tr)));break;case"joinack":e.sender!==ps.id()&&(Hp=!0,lp(tr,Ja(e.data),tr));break;case"sync":{e.sender!==ps.id()&&k(e.data)&&lp(tr,Ja(e.data),tr);break}}});function qp(e,t){t!==tr&&ps.emit("","modem:sync",x0(e))}tr.on("update",qp),tr.on("destroy",()=>{tr.off("update",qp)});function AA(e,t){return e%t}function SA(e,t){return Math.floor(e/t)}function RA(e,t){return{x:AA(e,t),y:SA(e,t)}}function lr(e,t){return e.x+e.y*t}function ro(e,t){return`${e.x},${e.y},${t.x},${t.y}`}function dh(e,t,n,r,i,s){return e>=s&&e<=r&&t>=n&&t<=i}function Jp(e,t,n,r){const i=[],s=Math.min(e,n),o=Math.max(e,n),a=Math.min(t,r),c=Math.max(t,r);for(let l=a;l<=c;++l)for(let u=s;u<=o;++u)i.push({x:u,y:l});return i}function Zp(e,t,n,r){const i=[],s=Math.abs(n-e),o=Math.abs(r-t),a=e<n?1:-1,c=t<r?1:-1;let l=s-o;for(i.push({x:e,y:t});e!==n||t!==r;){const u=2*l;u>-o&&(l-=o,e+=a),u<s&&(l+=s,t+=c),i.push({x:e,y:t})}return i}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Qp="176",OA="",vr="srgb",tm="srgb-linear",em="linear",ph="srgb";function Tr(e,t,n){return Math.max(t,Math.min(n,e))}function NA(e,t){return(e%t+t)%t}function mh(e,t,n){return(1-n)*e+n*t}class Xo{constructor(t=0,n=0){Xo.prototype.isVector2=!0,this.x=t,this.y=n}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,n){return this.x=t,this.y=n,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,n){switch(t){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this}addScaledVector(t,n){return this.x+=t.x*n,this.y+=t.y*n,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const n=this.x,r=this.y,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,n){return this.x=Tr(this.x,t.x,n.x),this.y=Tr(this.y,t.y,n.y),this}clampScalar(t,n){return this.x=Tr(this.x,t,n),this.y=Tr(this.y,t,n),this}clampLength(t,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Tr(r,t,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const n=Math.sqrt(this.lengthSq()*t.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(t)/n;return Math.acos(Tr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const n=this.x-t.x,r=this.y-t.y;return n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,n){return this.x+=(t.x-this.x)*n,this.y+=(t.y-this.y)*n,this}lerpVectors(t,n,r){return this.x=t.x+(n.x-t.x)*r,this.y=t.y+(n.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,n=0){return this.x=t[n],this.y=t[n+1],this}toArray(t=[],n=0){return t[n]=this.x,t[n+1]=this.y,t}fromBufferAttribute(t,n){return this.x=t.getX(n),this.y=t.getY(n),this}rotateAround(t,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-t.x,o=this.y-t.y;return this.x=s*r-o*i+t.x,this.y=s*i+o*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qo{constructor(t,n,r,i,s,o,a,c,l){qo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,n,r,i,s,o,a,c,l)}set(t,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const n=this.elements,r=t.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(t,n,r){return t.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const n=t.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,n){const r=t.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],f=r[7],d=r[2],h=r[5],m=r[8],p=i[0],b=i[3],y=i[6],v=i[1],T=i[4],A=i[7],U=i[2],S=i[5],C=i[8];return s[0]=o*p+a*v+c*U,s[3]=o*b+a*T+c*S,s[6]=o*y+a*A+c*C,s[1]=l*p+u*v+f*U,s[4]=l*b+u*T+f*S,s[7]=l*y+u*A+f*C,s[2]=d*p+h*v+m*U,s[5]=d*b+h*T+m*S,s[8]=d*y+h*A+m*C,this}multiplyScalar(t){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this}determinant(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const t=this.elements,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],f=u*o-a*l,d=a*c-u*s,h=l*s-o*c,m=n*f+r*d+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=f*p,t[1]=(i*l-u*r)*p,t[2]=(a*r-i*o)*p,t[3]=d*p,t[4]=(u*n-i*c)*p,t[5]=(i*s-a*n)*p,t[6]=h*p,t[7]=(r*c-l*n)*p,t[8]=(o*n-r*s)*p,this}transpose(){let t;const n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const n=this.elements;return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],this}setUvTransform(t,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(t,n){return this.premultiply(gh.makeScale(t,n)),this}rotate(t){return this.premultiply(gh.makeRotation(-t)),this}translate(t,n){return this.premultiply(gh.makeTranslation(t,n)),this}makeTranslation(t,n){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,n,0,0,1),this}makeRotation(t){const n=Math.cos(t),r=Math.sin(t);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(t,n){return this.set(t,0,0,0,n,0,0,0,1),this}equals(t){const n=this.elements,r=t.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(t,n=0){for(let r=0;r<9;r++)this.elements[r]=t[r+n];return this}toArray(t=[],n=0){const r=this.elements;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const gh=new qo,nm=new qo().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),rm=new qo().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function IA(){const e={enabled:!0,workingColorSpace:tm,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===ph&&(i.r=io(i.r),i.g=io(i.g),i.b=io(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===ph&&(i.r=so(i.r),i.g=so(i.g),i.b=so(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===OA?em:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[tm]:{primaries:t,whitePoint:r,transfer:em,toXYZ:nm,fromXYZ:rm,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:vr},outputColorSpaceConfig:{drawingBufferColorSpace:vr}},[vr]:{primaries:t,whitePoint:r,transfer:ph,toXYZ:nm,fromXYZ:rm,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:vr}}}),e}const Ar=IA();function io(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function so(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}const im={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Di={h:0,s:0,l:0},xc={h:0,s:0,l:0};function _h(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*6*(2/3-n):e}class yh{constructor(t,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,n,r)}set(t,n,r){if(n===void 0&&r===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,n,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,n=vr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Ar.toWorkingColorSpace(this,n),this}setRGB(t,n,r,i=Ar.workingColorSpace){return this.r=t,this.g=n,this.b=r,Ar.toWorkingColorSpace(this,i),this}setHSL(t,n,r,i=Ar.workingColorSpace){if(t=NA(t,1),n=Tr(n,0,1),r=Tr(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=_h(o,s,t+1/3),this.g=_h(o,s,t),this.b=_h(o,s,t-1/3)}return Ar.toWorkingColorSpace(this,i),this}setStyle(t,n=vr){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,n);return this}setColorName(t,n=vr){const r=im[t.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=io(t.r),this.g=io(t.g),this.b=io(t.b),this}copyLinearToSRGB(t){return this.r=so(t.r),this.g=so(t.g),this.b=so(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=vr){return Ar.fromWorkingColorSpace(bn.copy(this),t),Math.round(Tr(bn.r*255,0,255))*65536+Math.round(Tr(bn.g*255,0,255))*256+Math.round(Tr(bn.b*255,0,255))}getHexString(t=vr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,n=Ar.workingColorSpace){Ar.fromWorkingColorSpace(bn.copy(this),n);const r=bn.r,i=bn.g,s=bn.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const f=o-a;switch(l=u<=.5?f/(o+a):f/(2-o-a),o){case r:c=(i-s)/f+(i<s?6:0);break;case i:c=(s-r)/f+2;break;case s:c=(r-i)/f+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,n=Ar.workingColorSpace){return Ar.fromWorkingColorSpace(bn.copy(this),n),t.r=bn.r,t.g=bn.g,t.b=bn.b,t}getStyle(t=vr){Ar.fromWorkingColorSpace(bn.copy(this),t);const n=bn.r,r=bn.g,i=bn.b;return t!==vr?`color(${t} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(t,n,r){return this.getHSL(Di),this.setHSL(Di.h+t,Di.s+n,Di.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,n){return this.r=t.r+n.r,this.g=t.g+n.g,this.b=t.b+n.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,n){return this.r+=(t.r-this.r)*n,this.g+=(t.g-this.g)*n,this.b+=(t.b-this.b)*n,this}lerpColors(t,n,r){return this.r=t.r+(n.r-t.r)*r,this.g=t.g+(n.g-t.g)*r,this.b=t.b+(n.b-t.b)*r,this}lerpHSL(t,n){this.getHSL(Di),t.getHSL(xc);const r=mh(Di.h,xc.h,n),i=mh(Di.s,xc.s,n),s=mh(Di.l,xc.l,n);return this.setHSL(r,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const n=this.r,r=this.g,i=this.b,s=t.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,n=0){return this.r=t[n],this.g=t[n+1],this.b=t[n+2],this}toArray(t=[],n=0){return t[n]=this.r,t[n+1]=this.g,t[n+2]=this.b,t}fromBufferAttribute(t,n){return this.r=t.getX(n),this.g=t.getY(n),this.b=t.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const bn=new yh;yh.NAMES=im,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Qp}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Qp),new Xo,new Xo;function pn(e,t,n){return Math.max(t,Math.min(n,e))}function sm(e){return e/180*Math.PI}function om(e){return e*180/Math.PI}const CA=Bd("089fad0j9awfem09wavefc09uwaef");function LA(){return CA()}function MA(e){return Bd(e)()}function ur(e,t){const n=Math.min(e,t),i=Math.max(e,t)-n+1;return n+Math.floor(LA()*i)}function am(e,t,n){const r=Math.min(t,n),s=Math.max(t,n)-r+1;return r+Math.floor(MA(e)*s)}function cm(e,t,n){typeof n!="number"&&(n=1);const r=[],i=Math.min(e,t),s=Math.max(e,t);for(let o=i;o<=s;o+=n)r.push(o);return r}function UA(e){return e[ur(0,e.length-1)]}function FA(e,t){return t[am(e,0,t.length-1)]}function kn(...e){return UA(e.flat())}function BA(e,...t){return FA(e,t.flat())}function PA(e){return[...new Set(e)].filter(k)}function ms(e){return k(e)&&k(e.x)&&k(e.y)}function ze(e,t){switch(t){case mt.NORTH:--e.y;break;case mt.SOUTH:++e.y;break;case mt.WEST:--e.x;break;case mt.EAST:++e.x;break}return e}function $A(e,t){return e<0?mt.WEST:e>0?mt.EAST:t<0?mt.NORTH:t>0?mt.SOUTH:mt.IDLE}function Sr(e,t){return $A(t.x-e.x,t.y-e.y)}const bh={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",player:"PLAYER",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER"};function Rr(e){return ue(e)&&lm(e[0])}function lm(e){return k(mt[e])&&yt(e)}function DA(e){const t=mt[e];return k(t)?t:mt.IDLE}function kh(e){if(yt(e))return bh[It(e)]}function jA(e){if(Rr(e))return e;if(lm(e))return[e];const t=kh(e);if(k(t))return[t]}function um(e){const t=E.words[e],n=jA(t);return Rr(n)?[n,e+1]:[void 0,e]}function hm(e){var i,s;const t=[];let[n,r]=um(e);for(;Rr(n);){switch(t.push(...n),n[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[c,l,u]=st(E.words,r,[H.NUMBER,H.NUMBER]);t.push(c,l),r=u;break}case"FLEE":case"FIND":{const[c,l]=st(E.words,r,[H.KIND]);console.info("kind",c),r=l;break}case"TO":{const[c,l,u]=st(E.words,r,[H.DIR,H.DIR]),f=((i=E.element)==null?void 0:i.x)??0,d=((s=E.element)==null?void 0:s.y)??0;c.destpt.x-=f,c.destpt.y-=d,l.destpt.x-=f,l.destpt.y-=d,t.push(f+c.destpt.x+l.destpt.x,d+c.destpt.y+l.destpt.y),r=u;break}}switch(n[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":break;default:return[t,r]}const[o,a]=um(r);n=o,r=a}return t.length?[t,r]:[void 0,e]}function zA(e){return k(e)&&e<Ot.ONBLACK?e:void 0}function WA(e){return k(e)&&e>Ot.WHITE&&e<Ot.ONCLEAR?e-Ot.ONBLACK:void 0}const Jo={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function qr(e){return ue(e)&&dm(e[0])}function fm(e){return qr(e)&&e[0].startsWith("ON")}function dm(e){return k(Ot[e])&&yt(e)}function vc(e){if(yt(e))return Jo[It(e)]}function pm(e){return e.map(t=>Ot[t]).find(t=>k(t)&&t<Ot.ONBLACK)}function mm(e){return e.map(t=>Ot[t]).find(t=>k(t)&&t>=Ot.ONBLACK)}function GA(e){if(qr(e))return e;if(dm(e))return[e];const t=vc(e);if(k(t))return[t]}function gm(e){const t=E.words[e],n=GA(t);return qr(n)?[n,e+1]:[void 0,e]}function wh(e){const t=[];let n=e;const[r,i]=gm(e);if(qr(r)&&(t.push(...r),n=i),qr(t)&&!fm(t)){const[s,o]=gm(i);fm(s)&&(n=o)}return t.length?[t,n]:[void 0,e]}function _m(e){const t={};for(let n=0;n<e.length;++n){const r=e[n],i=Ot[r];k(i)&&(i<Ot.ONBLACK?t.color=i:t.bg=i-Ot.ONBLACK)}return t}function oo(e){return ue(e)&&typeof e[0]=="string"}function KA(e){const t=E.words[e];return yt(t)?[t,e+1]:[void 0,e]}function ym(e){const t=E.words[e];if(oo(t))return[t,e+1];const[n,r]=wh(e),[i,s]=KA(r);return yt(i)?[[i,n],s]:[void 0,e]}function Tc(e){if(!oo(e))return;const[t]=e;return t}function Eh(e){if(!oo(e))return;const[,t]=e,n=k(t)?pm(t):void 0;return k(n)?n:void 0}function bm(e){if(!oo(e))return;const[,t]=e,n=k(t)?mm(t):void 0;return k(n)?n:void 0}const St=60,Vt=25,xh=St*Vt;var bt=(e=>(e[e.ERROR=0]="ERROR",e[e.LOADER=1]="LOADER",e[e.BOARD=2]="BOARD",e[e.OBJECT=3]="OBJECT",e[e.TERRAIN=4]="TERRAIN",e[e.CHARSET=5]="CHARSET",e[e.PALETTE=6]="PALETTE",e))(bt||{});function Zo(e,t){const n=e??Wt.ISWALK,r=t??Wt.ISWALK;switch(n){case Wt.ISWALK:return r!==Wt.ISWALK;case Wt.ISSWIM:return r!==Wt.ISSWIM;case Wt.ISSOLID:return!0;case Wt.ISBULLET:return r!==Wt.ISWALK&&r!==Wt.ISSWIM}}function Qo(e,t,n){const r=e==null?void 0:e.objects[n];if(k(r))return r;const i=ta(e,"player");return k(t)?(t.x<0&&(t.x=ur(0,St-1)),t.y<0&&(t.y=ur(0,Vt-1)),wm(t,i)):kn(...i)}function ta(e,t){var r,i;return[...((i=(r=e==null?void 0:e.named)==null?void 0:r[t])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?e==null?void 0:e.objects[s]:e==null?void 0:e.terrain[s]).filter(k)}function HA(e){const t=[];for(let n=0;n<Vt;++n)for(let r=0;r<St;++r){const i={x:r,y:n},s=ie(e,i);!(s!=null&&s.name)&&!(s!=null&&s.kind)&&t.push(i)}return t}function Ac(e,t){const n=Tc(t),r=Eh(t),i=bm(t);return ta(e,n??"").filter(s=>{var o,a,c;return!(k(n)&&It((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||k(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??Ot.WHITE)!==r||k(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??Ot.BLACK)!==i)}).filter(k)}function km(e,t){return k(e)?t.map(n=>{var r;if(typeof n=="string"){const i=e.objects[n];if(k(i))return i;const s=ta(e,It(n));if(s.length)return s}else if(ms(n)&&n.x>=0&&n.x<St&&n.y>=0&&n.y<Vt){const i=n.x+n.y*St,s=(r=e.lookup)==null?void 0:r[i];return k(s)?e.objects[s]:e.terrain[i]}}).flat().filter(k):[]}function wm(e,t){let n=0,r;for(let i=0;i<t.length;++i){const s=t[i];if(s){const o=e.x-(s.x??0),a=e.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var vh;try{vh=new TextDecoder}catch{}var kt,hr,K=0,me={},ee,ji,fr=0,Jr=0,on,ki,Bn=[],Jt,Em={useRecords:!1,mapsAsObjects:!0};class xm{}const vm=new xm;vm.name="MessagePack 0xC1";var zi=!1,Tm=2,Am;try{new Function("")}catch{Tm=1/0}class ea{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.sequential&&t.trusted!==!1&&(t.trusted=!0,!t.structures&&t.useRecords!=!1&&(t.structures=[],t.maxSharedStructures||(t.maxSharedStructures=0))),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0),t.int64AsNumber&&(t.int64AsType="number")),Object.assign(this,t)}unpack(t,n){if(kt)return $m(()=>(Oh(),this?this.unpack(t,n):ea.prototype.unpack.call(Em,t,n)));!t.buffer&&t.constructor===ArrayBuffer&&(t=typeof fn<"u"?fn.from(t):new Uint8Array(t)),typeof n=="object"?(hr=n.end||t.length,K=n.start||0):(K=0,hr=n>-1?n:t.length),Jr=0,ji=null,on=null,kt=t;try{Jt=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(r){throw kt=null,t instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof ea){if(me=this,this.structures)return ee=this.structures,Sc(n);(!ee||ee.length>0)&&(ee=[])}else me=Em,(!ee||ee.length>0)&&(ee=[]);return Sc(n)}unpackMultiple(t,n){let r,i=0;try{zi=!0;let s=t.length,o=this?this.unpack(t,s):Rc.unpack(t,s);if(n){if(n(o,i,K)===!1)return;for(;K<s;)if(i=K,n(Sc(),i,K)===!1)return}else{for(r=[o];K<s;)i=K,r.push(Sc());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{zi=!1,Oh()}}_mergeStructures(t,n){t=t||[],Object.isFrozen(t)&&(t=t.map(r=>r.slice(0)));for(let r=0,i=t.length;r<i;r++){let s=t[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}t.sharedLength=t.length;for(let r in n||[])if(r>=0){let i=t[r],s=n[r];s&&(i&&((t.restoreStructures||(t.restoreStructures=[]))[r]=i),t[r]=s)}return this.structures=t}decode(t,n){return this.unpack(t,n)}}function Sc(e){try{if(!me.trusted&&!zi){let n=ee.sharedLength||0;n<ee.length&&(ee.length=n)}let t;if(me.randomAccessStructure&&kt[K]<64&&kt[K]>=32&&Am?(t=Am(kt,K,hr,me),kt=null,!(e&&e.lazy)&&t&&(t=t.toJSON()),K=hr):t=We(),on&&(K=on.postBundlePosition,on=null),zi&&(ee.restoreStructures=null),K==hr)ee&&ee.restoreStructures&&Sm(),ee=null,kt=null,ki&&(ki=null);else{if(K>hr)throw new Error("Unexpected end of MessagePack data");if(!zi){let n;try{n=JSON.stringify(t,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return t}catch(t){throw ee&&ee.restoreStructures&&Sm(),Oh(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer")||K>hr)&&(t.incomplete=!0),t}}function Sm(){for(let e in ee.restoreStructures)ee[e]=ee.restoreStructures[e];ee.restoreStructures=null}function We(){let e=kt[K++];if(e<160)if(e<128){if(e<64)return e;{let t=ee[e&63]||me.getStructures&&Om()[e&63];return t?(t.read||(t.read=Th(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Um();r==="__proto__"&&(r="__proto_"),t[r]=We()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(We(),We());return t}else{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=We();return me.freezeData?Object.freeze(t):t}else if(e<192){let t=e-160;if(Jr>=K)return ji.slice(K-fr,(K+=t)-fr);if(Jr==0&&hr<140){let n=t<16?Sh(t):Cm(t);if(n!=null)return n}return Ah(t)}else{let t;switch(e){case 192:return null;case 193:return on?(t=We(),t>0?on[1].slice(on.position1,on.position1+=t):on[0].slice(on.position0,on.position0-=t)):vm;case 194:return!1;case 195:return!0;case 196:if(t=kt[K++],t===void 0)throw new Error("Unexpected end of buffer");return Rh(t);case 197:return t=Jt.getUint16(K),K+=2,Rh(t);case 198:return t=Jt.getUint32(K),K+=4,Rh(t);case 199:return gs(kt[K++]);case 200:return t=Jt.getUint16(K),K+=2,gs(t);case 201:return t=Jt.getUint32(K),K+=4,gs(t);case 202:if(t=Jt.getFloat32(K),me.useFloat32>2){let n=Nh[(kt[K]&127)<<1|kt[K+1]>>7];return K+=4,(n*t+(t>0?.5:-.5)>>0)/n}return K+=4,t;case 203:return t=Jt.getFloat64(K),K+=8,t;case 204:return kt[K++];case 205:return t=Jt.getUint16(K),K+=2,t;case 206:return t=Jt.getUint32(K),K+=4,t;case 207:return me.int64AsType==="number"?(t=Jt.getUint32(K)*4294967296,t+=Jt.getUint32(K+4)):me.int64AsType==="string"?t=Jt.getBigUint64(K).toString():me.int64AsType==="auto"?(t=Jt.getBigUint64(K),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Jt.getBigUint64(K),K+=8,t;case 208:return Jt.getInt8(K++);case 209:return t=Jt.getInt16(K),K+=2,t;case 210:return t=Jt.getInt32(K),K+=4,t;case 211:return me.int64AsType==="number"?(t=Jt.getInt32(K)*4294967296,t+=Jt.getUint32(K+4)):me.int64AsType==="string"?t=Jt.getBigInt64(K).toString():me.int64AsType==="auto"?(t=Jt.getBigInt64(K),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=Jt.getBigInt64(K),K+=8,t;case 212:if(t=kt[K++],t==114)return Bm(kt[K++]&63);{let n=Bn[t];if(n)return n.read?(K++,n.read(We())):n.noBuffer?(K++,n()):n(kt.subarray(K,++K));throw new Error("Unknown extension "+t)}case 213:return t=kt[K],t==114?(K++,Bm(kt[K++]&63,kt[K++])):gs(2);case 214:return gs(4);case 215:return gs(8);case 216:return gs(16);case 217:return t=kt[K++],Jr>=K?ji.slice(K-fr,(K+=t)-fr):VA(t);case 218:return t=Jt.getUint16(K),K+=2,Jr>=K?ji.slice(K-fr,(K+=t)-fr):XA(t);case 219:return t=Jt.getUint32(K),K+=4,Jr>=K?ji.slice(K-fr,(K+=t)-fr):qA(t);case 220:return t=Jt.getUint16(K),K+=2,Nm(t);case 221:return t=Jt.getUint32(K),K+=4,Nm(t);case 222:return t=Jt.getUint16(K),K+=2,Im(t);case 223:return t=Jt.getUint32(K),K+=4,Im(t);default:if(e>=224)return e-256;if(e===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+e)}}}const YA=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Th(e,t){function n(){if(n.count++>Tm){let i=e.read=new Function("r","return function(){return "+(me.freezeData?"Object.freeze":"")+"({"+e.map(s=>s==="__proto__"?"__proto_:r()":YA.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(We);return e.highByte===0&&(e.read=Rm(t,e.read)),i()}let r={};for(let i=0,s=e.length;i<s;i++){let o=e[i];o==="__proto__"&&(o="__proto_"),r[o]=We()}return me.freezeData?Object.freeze(r):r}return n.count=0,e.highByte===0?Rm(t,n):n}const Rm=(e,t)=>function(){let n=kt[K++];if(n===0)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),i=ee[r]||Om()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=Th(i,e)),i.read()};function Om(){let e=$m(()=>(kt=null,me.getStructures()));return ee=me._mergeStructures(e,ee)}var Ah=na,VA=na,XA=na,qA=na;function na(e){let t;if(e<16&&(t=Sh(e)))return t;if(e>64&&vh)return vh.decode(kt.subarray(K,K+=e));const n=K+e,r=[];for(t="";K<n;){const i=kt[K++];if(!(i&128))r.push(i);else if((i&224)===192){const s=kt[K++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=kt[K++]&63,o=kt[K++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=kt[K++]&63,o=kt[K++]&63,a=kt[K++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(t+=an.apply(String,r),r.length=0)}return r.length>0&&(t+=an.apply(String,r)),t}function Nm(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=We();return me.freezeData?Object.freeze(t):t}function Im(e){if(me.mapsAsObjects){let t={};for(let n=0;n<e;n++){let r=Um();r==="__proto__"&&(r="__proto_"),t[r]=We()}return t}else{let t=new Map;for(let n=0;n<e;n++)t.set(We(),We());return t}}var an=String.fromCharCode;function Cm(e){let t=K,n=new Array(e);for(let r=0;r<e;r++){const i=kt[K++];if((i&128)>0){K=t;return}n[r]=i}return an.apply(String,n)}function Sh(e){if(e<4)if(e<2){if(e===0)return"";{let t=kt[K++];if((t&128)>1){K-=1;return}return an(t)}}else{let t=kt[K++],n=kt[K++];if((t&128)>0||(n&128)>0){K-=2;return}if(e<3)return an(t,n);let r=kt[K++];if((r&128)>0){K-=3;return}return an(t,n,r)}else{let t=kt[K++],n=kt[K++],r=kt[K++],i=kt[K++];if((t&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){K-=4;return}if(e<6){if(e===4)return an(t,n,r,i);{let s=kt[K++];if((s&128)>0){K-=5;return}return an(t,n,r,i,s)}}else if(e<8){let s=kt[K++],o=kt[K++];if((s&128)>0||(o&128)>0){K-=6;return}if(e<7)return an(t,n,r,i,s,o);let a=kt[K++];if((a&128)>0){K-=7;return}return an(t,n,r,i,s,o,a)}else{let s=kt[K++],o=kt[K++],a=kt[K++],c=kt[K++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){K-=8;return}if(e<10){if(e===8)return an(t,n,r,i,s,o,a,c);{let l=kt[K++];if((l&128)>0){K-=9;return}return an(t,n,r,i,s,o,a,c,l)}}else if(e<12){let l=kt[K++],u=kt[K++];if((l&128)>0||(u&128)>0){K-=10;return}if(e<11)return an(t,n,r,i,s,o,a,c,l,u);let f=kt[K++];if((f&128)>0){K-=11;return}return an(t,n,r,i,s,o,a,c,l,u,f)}else{let l=kt[K++],u=kt[K++],f=kt[K++],d=kt[K++];if((l&128)>0||(u&128)>0||(f&128)>0||(d&128)>0){K-=12;return}if(e<14){if(e===12)return an(t,n,r,i,s,o,a,c,l,u,f,d);{let h=kt[K++];if((h&128)>0){K-=13;return}return an(t,n,r,i,s,o,a,c,l,u,f,d,h)}}else{let h=kt[K++],m=kt[K++];if((h&128)>0||(m&128)>0){K-=14;return}if(e<15)return an(t,n,r,i,s,o,a,c,l,u,f,d,h,m);let p=kt[K++];if((p&128)>0){K-=15;return}return an(t,n,r,i,s,o,a,c,l,u,f,d,h,m,p)}}}}}function Lm(){let e=kt[K++],t;if(e<192)t=e-160;else switch(e){case 217:t=kt[K++];break;case 218:t=Jt.getUint16(K),K+=2;break;case 219:t=Jt.getUint32(K),K+=4;break;default:throw new Error("Expected string")}return na(t)}function Rh(e){return me.copyBuffers?Uint8Array.prototype.slice.call(kt,K,K+=e):kt.subarray(K,K+=e)}function gs(e){let t=kt[K++];if(Bn[t]){let n;return Bn[t](kt.subarray(K,n=K+=e),r=>{K=r;try{return We()}finally{K=n}})}else throw new Error("Unknown extension type "+t)}var Mm=new Array(4096);function Um(){let e=kt[K++];if(e>=160&&e<192){if(e=e-160,Jr>=K)return ji.slice(K-fr,(K+=e)-fr);if(!(Jr==0&&hr<180))return Ah(e)}else return K--,Fm(We());let t=(e<<5^(e>1?Jt.getUint16(K):e>0?kt[K]:0))&4095,n=Mm[t],r=K,i=K+e-3,s,o=0;if(n&&n.bytes==e){for(;r<i;){if(s=Jt.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=kt[r++],s!=n[o++]){r=1879048192;break}if(r===i)return K=r,n.string;i-=3,r=K}for(n=[],Mm[t]=n,n.bytes=e;r<i;)s=Jt.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=kt[r++],n.push(s);let a=e<16?Sh(e):Cm(e);return a!=null?n.string=a:n.string=Ah(e)}function Fm(e){if(typeof e=="string")return e;if(typeof e=="number"||typeof e=="boolean"||typeof e=="bigint")return e.toString();if(e==null)return e+"";throw new Error("Invalid property type for record",typeof e)}const Bm=(e,t)=>{let n=We().map(Fm),r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let i=ee[e];return i&&(i.isShared||zi)&&((ee.restoreStructures||(ee.restoreStructures=[]))[e]=i),ee[e]=n,n.read=Th(n,r),n.read()};Bn[0]=()=>{},Bn[0].noBuffer=!0,Bn[66]=e=>{let t=e.length,n=BigInt(e[0]&128?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let JA={Error,TypeError,ReferenceError};Bn[101]=()=>{let e=We();return(JA[e[0]]||Error)(e[1],{cause:e[2]})},Bn[105]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Jt.getUint32(K-4);ki||(ki=new Map);let n=kt[K],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};ki.set(t,i);let s=We();return i.used?Object.assign(r,s):(i.target=s,s)},Bn[112]=e=>{if(me.structuredClone===!1)throw new Error("Structured clone extension is disabled");let t=Jt.getUint32(K-4),n=ki.get(t);return n.used=!0,n.target},Bn[115]=()=>new Set(We());const Pm=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");let ZA=typeof globalThis=="object"?globalThis:window;Bn[116]=e=>{let t=e[0],n=Pm[t];if(!n){if(t===16){let r=new ArrayBuffer(e.length-1);return new Uint8Array(r).set(e.subarray(1)),r}throw new Error("Could not find typed array for code "+t)}return new ZA[n](Uint8Array.prototype.slice.call(e,1).buffer)},Bn[120]=()=>{let e=We();return new RegExp(e[0],e[1])};const QA=[];Bn[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=K;return K+=t-e.length,on=QA,on=[Lm(),Lm()],on.position0=0,on.position1=0,on.postBundlePosition=K,K=n,We()},Bn[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function $m(e){let t=hr,n=K,r=fr,i=Jr,s=ji,o=ki,a=on,c=new Uint8Array(kt.slice(0,hr)),l=ee,u=ee.slice(0,ee.length),f=me,d=zi,h=e();return hr=t,K=n,fr=r,Jr=i,ji=s,ki=o,on=a,kt=c,zi=d,ee=l,ee.splice(0,ee.length,...u),me=f,Jt=new DataView(kt.buffer,kt.byteOffset,kt.byteLength),h}function Oh(){kt=null,ki=null,ee=null}const Nh=new Array(147);for(let e=0;e<256;e++)Nh[e]=+("1e"+Math.floor(45.15-e*.30103));var Rc=new ea({useRecords:!1});const tS=Rc.unpack;Rc.unpackMultiple,Rc.unpack;let eS=new Float32Array(1);new Uint8Array(eS.buffer,0,4);let Oc;try{Oc=new TextEncoder}catch{}let Ih,Dm;const Nc=typeof fn<"u",Ic=Nc?function(e){return fn.allocUnsafeSlow(e)}:Uint8Array,jm=Nc?fn:Uint8Array,zm=Nc?4294967296:2144337920;let J,ra,ge,Y=0,An,Le=null,nS;const rS=21760,iS=/[\u0080-\uFFFF]/,ao=Symbol("record-id");class sS extends ea{constructor(t){super(t),this.offset=0;let n,r,i,s,o=jm.prototype.utf8Write?function(O,w){return J.utf8Write(O,w,J.byteLength-w)}:Oc&&Oc.encodeInto?function(O,w){return Oc.encodeInto(O,J.subarray(w)).written}:!1,a=this;t||(t={});let c=t&&t.sequential,l=t.structures||t.saveStructures,u=t.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");t.structuredClone&&t.moreTypes==null&&(this.moreTypes=!0);let f=t.maxOwnStructures;f==null&&(f=l?32:64),!this.structures&&t.useRecords!=!1&&(this.structures=[]);let d=u>32||f+u>64,h=u+64,m=u+f+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let p=[],b=0,y=0;this.pack=this.encode=function(O,w){if(J||(J=new Ic(8192),ge=J.dataView||(J.dataView=new DataView(J.buffer,0,8192)),Y=0),An=J.length-10,An-Y<2048?(J=new Ic(J.length),ge=J.dataView||(J.dataView=new DataView(J.buffer,0,J.length)),An=J.length-10,Y=0):Y=Y+7&2147483640,n=Y,w&fS&&(Y+=w&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof O!="string"?(Le=[],Le.size=1/0):Le=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let $=i.sharedLength||0;if($>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let B=0;B<$;B++){let it=i[B];if(!it)continue;let Q,rt=i.transitions;for(let z=0,P=it.length;z<P;z++){let ft=it[z];Q=rt[ft],Q||(Q=rt[ft]=Object.create(null)),rt=Q}rt[ao]=B+64}this.lastNamedStructuresLength=$}c||(i.nextId=$+64)}r&&(r=!1);let I;try{a.randomAccessStructure&&O&&O.constructor&&O.constructor===Object?L(O):A(O);let $=Le;if(Le&&Km(n,A,0),s&&s.idsToInsert){let B=s.idsToInsert.sort((z,P)=>z.offset>P.offset?1:-1),it=B.length,Q=-1;for(;$&&it>0;){let z=B[--it].offset+n;z<$.stringsPosition+n&&Q===-1&&(Q=0),z>$.position+n?Q>=0&&(Q+=6):(Q>=0&&(ge.setUint32($.position+n,ge.getUint32($.position+n)+Q),Q=-1),$=$.previous,it++)}Q>=0&&$&&ge.setUint32($.position+n,ge.getUint32($.position+n)+Q),Y+=B.length*6,Y>An&&N(Y),a.offset=Y;let rt=aS(J.subarray(n,Y),B);return s=null,rt}return a.offset=Y,w&uS?(J.start=n,J.end=Y,J):J.subarray(n,Y)}catch($){throw I=$,$}finally{if(i&&(v(),r&&a.saveStructures)){let $=i.sharedLength||0,B=J.subarray(n,Y),it=cS(i,a);if(!I)return a.saveStructures(it,it.isCompatible)===!1?a.pack(O,w):(a.lastNamedStructuresLength=$,J.length>1073741824&&(J=null),B)}J.length>1073741824&&(J=null),w&hS&&(Y=n)}};const v=()=>{y<10&&y++;let O=i.sharedLength||0;if(i.length>O&&!c&&(i.length=O),b>1e4)i.transitions=null,y=0,b=0,p.length>0&&(p=[]);else if(p.length>0&&!c){for(let w=0,I=p.length;w<I;w++)p[w][ao]=0;p=[]}},T=O=>{var w=O.length;w<16?J[Y++]=144|w:w<65536?(J[Y++]=220,J[Y++]=w>>8,J[Y++]=w&255):(J[Y++]=221,ge.setUint32(Y,w),Y+=4);for(let I=0;I<w;I++)A(O[I])},A=O=>{Y>An&&(J=N(Y));var w=typeof O,I;if(w==="string"){let $=O.length;if(Le&&$>=4&&$<4096){if((Le.size+=$)>rS){let rt,z=(Le[0]?Le[0].length*3+Le[1].length:0)+10;Y+z>An&&(J=N(Y+z));let P;Le.position?(P=Le,J[Y]=200,Y+=3,J[Y++]=98,rt=Y-n,Y+=4,Km(n,A,0),ge.setUint16(rt+n-3,Y-n-rt)):(J[Y++]=214,J[Y++]=98,rt=Y-n,Y+=4),Le=["",""],Le.previous=P,Le.size=0,Le.position=rt}let Q=iS.test(O);Le[Q?0:1]+=O,J[Y++]=193,A(Q?-$:$);return}let B;$<32?B=1:$<256?B=2:$<65536?B=3:B=5;let it=$*3;if(Y+it>An&&(J=N(Y+it)),$<64||!o){let Q,rt,z,P=Y+B;for(Q=0;Q<$;Q++)rt=O.charCodeAt(Q),rt<128?J[P++]=rt:rt<2048?(J[P++]=rt>>6|192,J[P++]=rt&63|128):(rt&64512)===55296&&((z=O.charCodeAt(Q+1))&64512)===56320?(rt=65536+((rt&1023)<<10)+(z&1023),Q++,J[P++]=rt>>18|240,J[P++]=rt>>12&63|128,J[P++]=rt>>6&63|128,J[P++]=rt&63|128):(J[P++]=rt>>12|224,J[P++]=rt>>6&63|128,J[P++]=rt&63|128);I=P-Y-B}else I=o(O,Y+B);I<32?J[Y++]=160|I:I<256?(B<2&&J.copyWithin(Y+2,Y+1,Y+1+I),J[Y++]=217,J[Y++]=I):I<65536?(B<3&&J.copyWithin(Y+3,Y+2,Y+2+I),J[Y++]=218,J[Y++]=I>>8,J[Y++]=I&255):(B<5&&J.copyWithin(Y+5,Y+3,Y+3+I),J[Y++]=219,ge.setUint32(Y,I),Y+=4),Y+=I}else if(w==="number")if(O>>>0===O)O<32||O<128&&this.useRecords===!1||O<64&&!this.randomAccessStructure?J[Y++]=O:O<256?(J[Y++]=204,J[Y++]=O):O<65536?(J[Y++]=205,J[Y++]=O>>8,J[Y++]=O&255):(J[Y++]=206,ge.setUint32(Y,O),Y+=4);else if(O>>0===O)O>=-32?J[Y++]=256+O:O>=-128?(J[Y++]=208,J[Y++]=O+256):O>=-32768?(J[Y++]=209,ge.setInt16(Y,O),Y+=2):(J[Y++]=210,ge.setInt32(Y,O),Y+=4);else{let $;if(($=this.useFloat32)>0&&O<4294967296&&O>=-2147483648){J[Y++]=202,ge.setFloat32(Y,O);let B;if($<4||(B=O*Nh[(J[Y]&127)<<1|J[Y+1]>>7])>>0===B){Y+=4;return}else Y--}J[Y++]=203,ge.setFloat64(Y,O),Y+=8}else if(w==="object"||w==="function")if(!O)J[Y++]=192;else{if(s){let B=s.get(O);if(B){if(!B.id){let it=s.idsToInsert||(s.idsToInsert=[]);B.id=it.push(B)}J[Y++]=214,J[Y++]=112,ge.setUint32(Y,B.id),Y+=4;return}else s.set(O,{offset:Y-n})}let $=O.constructor;if($===Object)j(O);else if($===Array)T(O);else if($===Map)if(this.mapAsEmptyObject)J[Y++]=128;else{I=O.size,I<16?J[Y++]=128|I:I<65536?(J[Y++]=222,J[Y++]=I>>8,J[Y++]=I&255):(J[Y++]=223,ge.setUint32(Y,I),Y+=4);for(let[B,it]of O)A(B),A(it)}else{for(let B=0,it=Ih.length;B<it;B++){let Q=Dm[B];if(O instanceof Q){let rt=Ih[B];if(rt.write){rt.type&&(J[Y++]=212,J[Y++]=rt.type,J[Y++]=0);let ut=rt.write.call(this,O);ut===O?Array.isArray(O)?T(O):j(O):A(ut);return}let z=J,P=ge,ft=Y;J=null;let lt;try{lt=rt.pack.call(this,O,ut=>(J=z,z=null,Y+=ut,Y>An&&N(Y),{target:J,targetView:ge,position:Y-ut}),A)}finally{z&&(J=z,ge=P,Y=ft,An=J.length-10)}lt&&(lt.length+Y>An&&N(lt.length+Y),Y=oS(lt,J,Y,rt.type));return}}if(Array.isArray(O))T(O);else{if(O.toJSON){const B=O.toJSON();if(B!==O)return A(B)}if(w==="function")return A(this.writeFunction&&this.writeFunction(O));j(O)}}}else if(w==="boolean")J[Y++]=O?195:194;else if(w==="bigint"){if(O<BigInt(1)<<BigInt(63)&&O>=-(BigInt(1)<<BigInt(63)))J[Y++]=211,ge.setBigInt64(Y,O);else if(O<BigInt(1)<<BigInt(64)&&O>0)J[Y++]=207,ge.setBigUint64(Y,O);else if(this.largeBigIntToFloat)J[Y++]=203,ge.setFloat64(Y,Number(O));else{if(this.largeBigIntToString)return A(O.toString());if(this.useBigIntExtension&&O<BigInt(2)**BigInt(1023)&&O>-(BigInt(2)**BigInt(1023))){J[Y++]=199,Y++,J[Y++]=66;let $=[],B;do{let it=O&BigInt(255);B=(it&BigInt(128))===(O<BigInt(0)?BigInt(128):BigInt(0)),$.push(it),O>>=BigInt(8)}while(!((O===BigInt(0)||O===BigInt(-1))&&B));J[Y-2]=$.length;for(let it=$.length;it>0;)J[Y++]=Number($[--it]);return}else throw new RangeError(O+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Y+=8}else if(w==="undefined")this.encodeUndefinedAsNil?J[Y++]=192:(J[Y++]=212,J[Y++]=0,J[Y++]=0);else throw new Error("Unknown type: "+w)},U=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?O=>{let w;if(this.skipValues){w=[];for(let B in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(B))&&!this.skipValues.includes(O[B])&&w.push(B)}else w=Object.keys(O);let I=w.length;I<16?J[Y++]=128|I:I<65536?(J[Y++]=222,J[Y++]=I>>8,J[Y++]=I&255):(J[Y++]=223,ge.setUint32(Y,I),Y+=4);let $;if(this.coercibleKeyAsNumber)for(let B=0;B<I;B++){$=w[B];let it=Number($);A(isNaN(it)?$:it),A(O[$])}else for(let B=0;B<I;B++)A($=w[B]),A(O[$])}:O=>{J[Y++]=222;let w=Y-n;Y+=2;let I=0;for(let $ in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty($))&&(A($),A(O[$]),I++);if(I>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');J[w+++n]=I>>8,J[w+n]=I&255},S=this.useRecords===!1?U:t.progressiveRecords&&!d?O=>{let w,I=i.transitions||(i.transitions=Object.create(null)),$=Y++-n,B;for(let it in O)if(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(it)){if(w=I[it],w)I=w;else{let Q=Object.keys(O),rt=I;I=i.transitions;let z=0;for(let P=0,ft=Q.length;P<ft;P++){let lt=Q[P];w=I[lt],w||(w=I[lt]=Object.create(null),z++),I=w}$+n+1==Y?(Y--,W(I,Q,z)):q(I,Q,$,z),B=!0,I=rt[it]}A(O[it])}if(!B){let it=I[ao];it?J[$+n]=it:q(I,Object.keys(O),$,0)}}:O=>{let w,I=i.transitions||(i.transitions=Object.create(null)),$=0;for(let it in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(it))&&(w=I[it],w||(w=I[it]=Object.create(null),$++),I=w);let B=I[ao];B?B>=96&&d?(J[Y++]=((B-=96)&31)+96,J[Y++]=B>>5):J[Y++]=B:W(I,I.__keys__||Object.keys(O),$);for(let it in O)(typeof O.hasOwnProperty!="function"||O.hasOwnProperty(it))&&A(O[it])},C=typeof this.useRecords=="function"&&this.useRecords,j=C?O=>{C(O)?S(O):U(O)}:S,N=O=>{let w;if(O>16777216){if(O-n>zm)throw new Error("Packed buffer would be larger than maximum buffer size");w=Math.min(zm,Math.round(Math.max((O-n)*(O>67108864?1.25:2),4194304)/4096)*4096)}else w=(Math.max(O-n<<2,J.length-1)>>12)+1<<12;let I=new Ic(w);return ge=I.dataView||(I.dataView=new DataView(I.buffer,0,w)),O=Math.min(O,J.length),J.copy?J.copy(I,0,n,O):I.set(J.slice(n,O)),Y-=n,n=0,An=I.length-10,J=I},W=(O,w,I)=>{let $=i.nextId;$||($=64),$<h&&this.shouldShareStructure&&!this.shouldShareStructure(w)?($=i.nextOwnId,$<m||($=h),i.nextOwnId=$+1):($>=m&&($=h),i.nextId=$+1);let B=w.highByte=$>=96&&d?$-96>>5:-1;O[ao]=$,O.__keys__=w,i[$-64]=w,$<h?(w.isShared=!0,i.sharedLength=$-63,r=!0,B>=0?(J[Y++]=($&31)+96,J[Y++]=B):J[Y++]=$):(B>=0?(J[Y++]=213,J[Y++]=114,J[Y++]=($&31)+96,J[Y++]=B):(J[Y++]=212,J[Y++]=114,J[Y++]=$),I&&(b+=y*I),p.length>=f&&(p.shift()[ao]=0),p.push(O),A(w))},q=(O,w,I,$)=>{let B=J,it=Y,Q=An,rt=n;J=ra,Y=0,n=0,J||(ra=J=new Ic(8192)),An=J.length-10,W(O,w,$),ra=J;let z=Y;if(J=B,Y=it,An=Q,n=rt,z>1){let P=Y+z-1;P>An&&N(P);let ft=I+n;J.copyWithin(ft+z,ft+1,Y),J.set(ra.slice(0,z),ft),Y=P}else J[I+n]=ra[0]},L=O=>{let w=nS(O,J,n,Y,i,N,(I,$,B)=>{if(B)return r=!0;Y=$;let it=J;return A(I),v(),it!==J?{position:Y,targetView:ge,target:J}:Y},this);if(w===0)return j(O);Y=w}}useBuffer(t){J=t,J.dataView||(J.dataView=new DataView(J.buffer,J.byteOffset,J.byteLength)),Y=0}set position(t){Y=t}get position(){return Y}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}Dm=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,xm],Ih=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=t(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=t(10);i[o++]=215,i[o++]=255,s.setUint32(o,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=t(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=t(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,e.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:i,position:s}=t(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?Wm(e,16,t):Gm(Nc?fn.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==jm&&this.moreTypes?Wm(e,Pm.indexOf(n.name),t):Gm(e,t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];function Wm(e,t,n,r){let i=e.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=t,e.buffer||(e=new Uint8Array(e)),s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function Gm(e,t){let n=e.byteLength;var r,i;if(n<256){var{target:r,position:i}=t(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=t(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=t(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(e,i)}function oS(e,t,n,r){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=i&255):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=i&255)}return t[n++]=r,t.set(e,n),n+=i,n}function aS(e,t){let n,r=t.length*6,i=e.length-r;for(;n=t.pop();){let s=n.offset,o=n.id;e.copyWithin(s+r,s,i),r-=6;let a=s+r;e[a++]=214,e[a++]=105,e[a++]=o>>24,e[a++]=o>>16&255,e[a++]=o>>8&255,e[a++]=o&255,i=s}return e}function Km(e,t,n){if(Le.length>0){ge.setUint32(Le.position+e,Y+n-Le.position-e),Le.stringsPosition=Y-e;let r=Le;Le=null,t(r[0]),t(r[1])}}function cS(e,t){return e.isCompatible=n=>{let r=!n||(t.lastNamedStructuresLength||0)===n.length;return r||t._mergeStructures(n),r},e}let Hm=new sS({useRecords:!1});const lS=Hm.pack;Hm.pack;const uS=512,hS=1024,fS=2048,et=Bs("SOFTWARE");function Te(){return null}function co(e,t,n={}){if(!k(e))return;const r=[],i=Object.keys(e);for(let s=0;s<i.length;++s){let o=i[s],a=e[o];const c=n[o];k(c)&&(a=c(a));const l=t[o];k(l)&&(o=l),a!==null&&r.push(o,a)}return r}function ia(e,t,n={}){if(k(e))try{const r={};for(let i=0;i<e.length;i+=2){let s=e[i],o=e[i+1];const a=t[s];k(a)&&(s=a);const c=n[s];k(c)&&(o=c(o)),r[s]=o}return r}catch(r){de(et,"","binary",r.message)}}function dS(e){try{const t=wr(e);return lS(t)}catch(t){de(et,"","binary",t.message)}}function pS(e){try{return tS(e)}catch(t){de(et,"","binary",t.message)}}function Ym(){return{id:De()}}var Cc=(e=>(e[e.kind=0]="kind",e[e.id=1]="id",e[e.x=2]="x",e[e.y=3]="y",e[e.lx=4]="lx",e[e.ly=5]="ly",e[e.code=6]="code",e[e.name=7]="name",e[e.char=8]="char",e[e.color=9]="color",e[e.bg=10]="bg",e[e.light=11]="light",e[e.player=12]="player",e[e.bucket=13]="bucket",e[e.pushable=14]="pushable",e[e.collision=15]="collision",e[e.breakable=16]="breakable",e[e.tickertext=17]="tickertext",e[e.tickertime=18]="tickertime",e[e.p1=19]="p1",e[e.p2=20]="p2",e[e.p3=21]="p3",e[e.cycle=22]="cycle",e[e.stepx=23]="stepx",e[e.stepy=24]="stepy",e[e.sender=25]="sender",e[e.arg=26]="arg",e[e.stopped=27]="stopped",e[e.removed=28]="removed",e[e.party=29]="party",e[e.group=30]="group",e[e.lightdir=31]="lightdir",e[e.item=32]="item",e[e.p4=33]="p4",e[e.p5=34]="p5",e[e.p6=35]="p6",e[e.displaychar=36]="displaychar",e[e.displaycolor=37]="displaycolor",e[e.displaybg=38]="displaybg",e))(Cc||{});function Lc(e){return k(e==null?void 0:e.id)?co(e,Cc,{category:Te,kinddata:Te,stopped:Te,removed:Te,bucket:Te}):co(e,Cc,{id:Te,x:Te,y:Te,lx:Te,ly:Te,code:Te,category:Te,kinddata:Te,stopped:Te,removed:Te,bucket:Te})}function Mc(e){return ia(e,Cc)}function Ge(e){var t;return(((t=e==null?void 0:e.id)==null?void 0:t.length)??0)>0}function sa(e,t){if(!k(e)||!qr(t))return;const{color:n,bg:r}=_m(t);k(n)&&(e.color=n),k(r)&&(e.bg=r)}function Or(e){var t;return It((e==null?void 0:e.name)??((t=e==null?void 0:e.kinddata)==null?void 0:t.name)??"")}function Ae(e){var o;if(!k(e)||k(e.lookup)&&k(e.named))return;const t=new Array(St*Vt).fill(void 0),n={},r=Object.values(e.objects);for(let a=0;a<r.length;++a){const c=r[a];if(k(c.x)&&k(c.y)&&k(c.id)&&!k(c.removed)){c.category=Un.ISOBJECT,t[c.x+c.y*St]=c.id;const l=It(c.name??((o=c.kinddata)==null?void 0:o.name)??"");n[l]||(n[l]=new Set),n[l].add(c.id)}}let i=0,s=0;for(let a=0;a<e.terrain.length;++a){const c=e.terrain[a];if(k(c)){c.x=i,c.y=s,c.category=Un.ISTERRAIN;const l=Or(c);n[l]||(n[l]=new Set),n[l].add(a)}++i,i>=St&&(i=0,++s)}e.lookup=t,e.named=n}function oa(e){k(e)&&(delete e.named,delete e.lookup,Ae(e))}function Vm(e,t,n){var i;if(!k(e)||!k(e.named)||!k(t))return;const r=It(t.name??((i=t.kinddata)==null?void 0:i.name)??"");e.named[r]||(e.named[r]=new Set),e.named[r].add((t==null?void 0:t.id)??n??"")}function mS(e,t){if(!(!k(e)||!k(e.lookup)||!k(t==null?void 0:t.id))&&!k(t.removed)){const n=t.x??0,r=t.y??0;e.lookup[n+r*St]=t.id}}function gS(e,t){var n;if(k(e)&&k(t==null?void 0:t.x)&&k(t.y)){const r=Or(t),i=Dr(e,t);k((n=e.named)==null?void 0:n[r])&&e.named[r].delete(i)}}function Ch(e,t){var n;if(k(e)&&k(t==null?void 0:t.id)){if(k(e.lookup)&&k(t.x)&&k(t.y)){const i=t.x+t.y*St;e.lookup[i]===t.id&&(e.lookup[i]=void 0)}const r=Or(t);k((n=e.named)==null?void 0:n[r])&&k(t.id)&&e.named[r].delete(t.id)}}var Xm={exports:{}},Lh={exports:{}},qm;function _S(){return qm||(qm=1,function(e,t){(function(n,r){e.exports=r()})(Ln,function(){function n(p){return!isNaN(parseFloat(p))&&isFinite(p)}function r(p){return p.charAt(0).toUpperCase()+p.substring(1)}function i(p){return function(){return this[p]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function f(p){if(p)for(var b=0;b<u.length;b++)p[u[b]]!==void 0&&this["set"+r(u[b])](p[u[b]])}f.prototype={getArgs:function(){return this.args},setArgs:function(p){if(Object.prototype.toString.call(p)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=p},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(p){if(p instanceof f)this.evalOrigin=p;else if(p instanceof Object)this.evalOrigin=new f(p);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var p=this.getFileName()||"",b=this.getLineNumber()||"",y=this.getColumnNumber()||"",v=this.getFunctionName()||"";return this.getIsEval()?p?"[eval] ("+p+":"+b+":"+y+")":"[eval]:"+b+":"+y:v?v+" ("+p+":"+b+":"+y+")":p+":"+b+":"+y}},f.fromString=function(b){var y=b.indexOf("("),v=b.lastIndexOf(")"),T=b.substring(0,y),A=b.substring(y+1,v).split(","),U=b.substring(v+1);if(U.indexOf("@")===0)var S=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(U,""),C=S[1],j=S[2],N=S[3];return new f({functionName:T,args:A||void 0,fileName:C,lineNumber:j||void 0,columnNumber:N||void 0})};for(var d=0;d<s.length;d++)f.prototype["get"+r(s[d])]=i(s[d]),f.prototype["set"+r(s[d])]=function(p){return function(b){this[p]=!!b}}(s[d]);for(var h=0;h<o.length;h++)f.prototype["get"+r(o[h])]=i(o[h]),f.prototype["set"+r(o[h])]=function(p){return function(b){if(!n(b))throw new TypeError(p+" must be a Number");this[p]=Number(b)}}(o[h]);for(var m=0;m<a.length;m++)f.prototype["get"+r(a[m])]=i(a[m]),f.prototype["set"+r(a[m])]=function(p){return function(b){this[p]=String(b)}}(a[m]);return f})}(Lh)),Lh.exports}(function(e,t){(function(n,r){e.exports=r(_S())})(Ln,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var f=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),d=f.match(/ (\(.+\)$)/);f=d?f.replace(d[0],""):f;var h=this.extractLocation(d?d[1]:f),m=d&&f||void 0,p=["eval","<anonymous>"].indexOf(h[0])>-1?void 0:h[0];return new r({functionName:m,fileName:p,lineNumber:h[1],columnNumber:h[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var f=/((.*".+"[^@]*)?[^@]*)(?:@)/,d=u.match(f),h=d&&d[1]?d[1]:void 0,m=this.extractLocation(u.replace(f,""));return new r({functionName:h,fileName:m[0],lineNumber:m[1],columnNumber:m[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),f=[],d=2,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),f=[],d=0,h=u.length;d<h;d+=2){var m=l.exec(u[d]);m&&f.push(new r({functionName:m[3]||void 0,fileName:m[2],lineNumber:m[1],source:u[d]}))}return f},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var f=u.split("@"),d=this.extractLocation(f.pop()),h=f.shift()||"",m=h.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,p;h.match(/\(([^)]*)\)/)&&(p=h.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var b=p===void 0||p==="[arguments not available]"?void 0:p.split(",");return new r({functionName:m,args:b,fileName:d[0],lineNumber:d[1],columnNumber:d[2],source:u})},this)}}})})(Xm);var yS=Xm.exports,bS=Us(yS);const Mh=14,Uc=3,Wi=8,Gi=14,Fc=16,kS=16,wS=16;var Bc=(e=>(e[e.FAR=1]="FAR",e[e.MID=1.5]="MID",e[e.NEAR=3]="NEAR",e))(Bc||{});function aa(e,t){return new Array(e).fill(t)}function ES(e,t,n,r,i,s=0){const o=r*i;return{id:`tiles:${e}:${t}`,type:1,tag:n,width:r,height:i,char:aa(o,0),color:aa(o,0),bg:aa(o,s),wall:aa(o,0)}}function xS(e,t,n,r=1,i=15){return{id:`sprites:${e}:${t}:${n}`,x:0,y:0,char:r,color:i,bg:Ot.ONCLEAR}}function vS(e,t){return{id:`sprites:${e}:${t}`,type:2,sprites:[]}}function TS(e,t,n,r,i=0){const s=n*r;return{id:`dither:${e}:${t}`,type:3,width:n,height:r,alphas:aa(s,i)}}function AS(e,t,n,r){return{id:`media:${e}:${t}`,type:4,mime:n,media:r}}function SS(e,t){return{id:`control:${e}:${t}`,type:5,focusx:0,focusy:0,focusid:e,viewscale:1.5,graphics:"flat",facing:0}}function Jm(e,t){return`${e}:${t}`}const RS=1,OS=16,NS=256;var Sn=(e=>(e[e.NONE=0]="NONE",e[e.ALT=1]="ALT",e[e.CTRL=2]="CTRL",e[e.SHIFT=3]="SHIFT",e[e.MOVE_UP=4]="MOVE_UP",e[e.MOVE_DOWN=5]="MOVE_DOWN",e[e.MOVE_LEFT=6]="MOVE_LEFT",e[e.MOVE_RIGHT=7]="MOVE_RIGHT",e[e.OK_BUTTON=8]="OK_BUTTON",e[e.CANCEL_BUTTON=9]="CANCEL_BUTTON",e[e.MENU_BUTTON=10]="MENU_BUTTON",e))(Sn||{});const Zr=!!JSON.parse("false"),IS=!!JSON.parse("false");JSON.parse("false");const Zm=!!JSON.parse("false");JSON.parse("false"),JSON.parse("false"),JSON.parse("false"),JSON.parse("false");const wi={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Wi*wi.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Gi*wi.DRAW_CHAR_SCALE}};function Ei(e){const t={},n={tick(){},everytick(){},listcommands(){return qn(t)},...e,getcommand(r){return t[r]},command(r,i){return t[r]=i,n}};return n}function Se(e){return`${e??""}`}function ca(e,t){const n=parseFloat(Se(e));return isNaN(n)?t:n}function Qm(e,t,n){var i;const[r]=st(t,0,[H.MAYBE_NAME]);cx(et,e,((i=E.board)==null?void 0:i.id)??"",r??"",n)}function Pn(e,t,n,r){const[i,s]=st(r,0,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);Zd(et,e,t,n,i,s)}const CS=["echo","reverb","phaser","distortion","vibrato","fc","fcrush","autowah"];function tg(e,t,n){const[r,i]=st(n,0,[H.NUMBER_OR_STRING]);if(xt(r))mu(et,e,t,"volume",r);else if(CS.includes(It(r))){const[s,o]=st(n,i,[H.NUMBER_OR_STRING,H.MAYBE_NUMBER_OR_STRING]);Zd(et,e,t,r,s,o)}else{const[s]=st(n,i,[H.MAYBE_NUMBER_OR_STRING]);if(xt(s)){const o=n.length-i,a=new Array(o).fill(H.NUMBER),c=st(n,i,a).slice(0,o),l=c.length===1?c[0]:c;mu(et,e,t,r,l)}else{const[o]=st(n,i,[H.MAYBE_NUMBER_OR_STRING]);mu(et,e,t,r,o)}}}let eg="en-US-GuyNeural";const Uh=Ei().command("talk",(e,t)=>{const[n]=st(t,0,[H.ANY]);switch(It(n)){default:WE(et,E.elementfocus);break;case"stop":GE(et,E.elementfocus);break}return 0}).command("media",(e,t)=>{const[n]=st(t,0,[H.ANY]);switch(It(n)){default:KE(et,E.elementfocus);break;case"stop":HE(et,E.elementfocus);break}return 0}).command("tts",(e,t)=>{const n=t.map(Se).join("");return ax(et,E.elementfocus,eg,n),0}).command("ttsvoice",(e,t)=>(eg=t.map(Se).join(""),0)).command("bpm",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return ux(et,E.elementfocus,n),0}).command("vol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return hx(et,E.elementfocus,n),0}).command("bgvol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return fx(et,E.elementfocus,n),0}).command("ttsvol",(e,t)=>{const[n]=st(t,0,[H.NUMBER]);return dx(et,E.elementfocus,n),0}).command("play",(e,t)=>(Qm(E.elementfocus,t,!1),0)).command("bgplay",(e,t)=>(Qm(E.elementfocus,t,!0),0)).command("synth",(e,t)=>{for(let n=0;n<8;++n)tg(E.elementfocus,n,t);return 0}).command("echo",(e,t)=>{for(let n=0;n<3;++n)Pn(E.elementfocus,n,"echo",t);return 0}).command("fcrush",(e,t)=>{for(let n=0;n<3;++n)Pn(E.elementfocus,n,"fc",t);return 0}).command("phaser",(e,t)=>{for(let n=0;n<3;++n)Pn(E.elementfocus,n,"phaser",t);return 0}).command("reverb",(e,t)=>{for(let n=0;n<3;++n)Pn(E.elementfocus,n,"reverb",t);return 0}).command("distort",(e,t)=>{for(let n=0;n<3;++n)Pn(E.elementfocus,n,"distort",t);return 0}).command("vibrato",(e,t)=>{for(let n=0;n<3;++n)Pn(E.elementfocus,n,"vibrato",t);return 0}).command("autowah",(e,t)=>{for(let n=0;n<3;++n)Pn(E.elementfocus,n,"autowah",t);return 0});for(let e=0;e<8;++e)Uh.command(`synth${e+1}`,(t,n)=>(tg(E.elementfocus,e,n),0));for(let e=0;e<3;++e){const t=e+1;Uh.command(`echo${t}`,(n,r)=>(Pn(E.elementfocus,e,"echo",r),0)).command(`fcrush${t}`,(n,r)=>(Pn(E.elementfocus,e,"fcrush",r),0)).command(`phaser${t}`,(n,r)=>(Pn(E.elementfocus,e,"phaser",r),0)).command(`reverb${t}`,(n,r)=>(Pn(E.elementfocus,e,"reverb",r),0)).command(`distort${t}`,(n,r)=>(Pn(E.elementfocus,e,"distort",r),0)).command(`vibrato${t}`,(n,r)=>(Pn(E.elementfocus,e,"vibrato",r),0)).command(`autowah${t}`,(n,r)=>(Pn(E.elementfocus,e,"autowah",r),0))}function Fh(e,t,n,r=!1){if(!k(e)||!k(e.lookup)||n.x<0||n.x>=St||n.y<0||n.y>=Vt)return!0;const i=n.x+n.y*St,s=Cn(e,e.lookup[i]??"404");if(k(s))return!(r&&_n(s.id));const o=e.terrain[i];return k(o)?Zo(t,Gt(o,"collision")):!1}function LS(e,t,n){const r=Cn(e,(t==null?void 0:t.id)??""),i=(r==null?void 0:r.x)??-1,s=(r==null?void 0:r.y)??-1;if(i-n.x===0&&s-n.y===0)return!0;const o=Gt(r,"collision");return Fh(e,o,n)}function Bh(e,t,n){var d;const r=Cn(e,(t==null?void 0:t.id)??"");if(!k(e)||!k(r)||!k(r.x)||!k(r.y)||!k(e.lookup)||n.x<0||n.x>=St||n.y<0||n.y>=Vt)return{name:"edge",kind:"edge",collision:Wt.ISSOLID,x:n.x,y:n.y};if(r.x-n.x===0&&r.y-n.y===0)return;const i=Dr(e,r),s=Dr(e,n),o=Gt(r,"collision"),a=_n(r==null?void 0:r.id),c=Gt(r,"collision")===Wt.ISBULLET,l=Cn(e,e.lookup[s]??""),u=_n((l==null?void 0:l.id)??"");if(k(l)&&(!a||!u)){const h=Gt(r,"group"),m=Gt(l,"group");if((h||m)&&h!=m)return{...l};const p=!!Gt(l,"item");if(a&&p)return r.x=n.x,r.y=n.y,{...l};const b=!!Gt(l,"breakable");if(c&&b)return r.x=n.x,r.y=n.y,{...l};if(o===Wt.ISBULLET)return{...l};if(!!Gt(l,"pushable")){const v=Sr({x:r.x,y:r.y},n),T=ze({x:l.x??0,y:l.y??0},v),A=Bh(e,l,T);if(k(A))return{...l}}else return{...l}}const f=e.terrain[s];if(k(f)){const h=f.collision??((d=f==null?void 0:f.kinddata)==null?void 0:d.collision)??Wt.ISWALK;if(Zo(o,h))return{...f,x:n.x,y:n.y}}r.x=n.x,r.y=n.y,k(r.removed)||(e.lookup[i]=void 0,e.lookup[s]=r.id??"")}function MS(e,t){const n=[];if(!k(e))return n;const r=Object.values(e.objects);for(let i=0;i<r.length;++i){const s=r[i];k(s.id)&&k(s.removed)&&t-s.removed>Ha*5&&(n.push(s.id),Cw(e,s.id))}return n}function US(e,t){const n=[];if(!k(e))return n;e.lookup=void 0,Ae(e);const r=Object.values(e.objects);for(let s=0;s<r.length;++s){const o=r[s];if(!k(o.id))continue;o.lx=o.x,o.ly=o.y;const a=ui(o),c=`${(a==null?void 0:a.code)??""}
${o.code??""}`;if(c){if(o.removed){const l=t-o.removed,u=Gt(o,"cycle");if(l>u)continue}n.push({id:o.id,type:bt.OBJECT,code:c,object:o,terrain:void 0})}}const i=MS(e,t);for(let s=0;s<i.length;++s)n.push({id:i[s],type:bt.ERROR,code:"",object:void 0,terrain:void 0});return n}function ng(e,t,n){const r=[],i=[];if(!k(e))return{objectelements:r,terrainelements:i};function s(a,c){switch(n){case"all":return!0;case"self":return(a==null?void 0:a.id)===t;case"others":return(a==null?void 0:a.id)!==t;case"terrain":return c===!0;case"object":return c===!1}const l=Gt(a,n);return k(l)||Or(a)===n||Gt(a,"group")===n}const o=Object.values(e.objects);for(let a=0;a<o.length;++a){const c=o[a];s(c,!1)&&r.push(c)}for(let a=0;a<xh;++a){const c=e.terrain[a];k(c)&&s(c,!0)&&i.push(c)}return{objectelements:r,terrainelements:i}}function rg(e,t){return{width:e,height:t,size:e*t,bits:new Uint8Array(e*t).fill(0)}}function ig(e){const t=Math.floor(e.length/Uc);if(t*Uc!==e.length)return;const n=rg(3,t);for(let r=0;r<n.bits.length;++r)n.bits[r]=e[r];return n}function FS(e,t){return e&1<<t?255:0}function sg(e){const t=Math.floor(e.length/Mh);if(t*Mh!==e.length)return;const n=Math.ceil(t/Fc),r=Wi*Fc,i=rg(r,Gi*n);let s=0,o=0,a=0;for(let c=0;c<e.length;++c){const l=o*Gi+a,u=e[c];for(let f=0;f<Wi;++f){const d=s*Wi+f;i.bits[d+l*r]=FS(u,7-f)}++a,a===Gi&&(a=0,++s,s===Fc&&(s=0,++o))}return i}const BS=Ja("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),PS=Ja("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f");var og=typeof js=="object"&&js&&js.Object===Object&&js,$S=typeof self=="object"&&self&&self.Object===Object&&self,Qr=og||$S||Function("return this")(),dr=Qr.Symbol,ag=Object.prototype,DS=ag.hasOwnProperty,jS=ag.toString,la=dr?dr.toStringTag:void 0;function zS(e){var t=DS.call(e,la),n=e[la];try{e[la]=void 0;var r=!0}catch{}var i=jS.call(e);return r&&(t?e[la]=n:delete e[la]),i}var WS=Object.prototype,GS=WS.toString;function KS(e){return GS.call(e)}var HS="[object Null]",YS="[object Undefined]",cg=dr?dr.toStringTag:void 0;function Ki(e){return e==null?e===void 0?YS:HS:cg&&cg in Object(e)?zS(e):KS(e)}function Nr(e){return e!=null&&typeof e=="object"}var VS="[object Symbol]";function Pc(e){return typeof e=="symbol"||Nr(e)&&Ki(e)==VS}function $c(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var se=Array.isArray,XS=1/0,lg=dr?dr.prototype:void 0,ug=lg?lg.toString:void 0;function hg(e){if(typeof e=="string")return e;if(se(e))return $c(e,hg)+"";if(Pc(e))return ug?ug.call(e):"";var t=e+"";return t=="0"&&1/e==-XS?"-0":t}var qS=/\s/;function JS(e){for(var t=e.length;t--&&qS.test(e.charAt(t)););return t}var ZS=/^\s+/;function QS(e){return e&&e.slice(0,JS(e)+1).replace(ZS,"")}function pr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var fg=NaN,tR=/^[-+]0x[0-9a-f]+$/i,eR=/^0b[01]+$/i,nR=/^0o[0-7]+$/i,rR=parseInt;function iR(e){if(typeof e=="number")return e;if(Pc(e))return fg;if(pr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=pr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=QS(e);var n=eR.test(e);return n||nR.test(e)?rR(e.slice(2),n?2:8):tR.test(e)?fg:+e}var dg=1/0,sR=17976931348623157e292;function oR(e){if(!e)return e===0?e:0;if(e=iR(e),e===dg||e===-dg){var t=e<0?-1:1;return t*sR}return e===e?e:0}function Dc(e){var t=oR(e),n=t%1;return t===t?n?t-n:t:0}function lo(e){return e}var aR="[object AsyncFunction]",cR="[object Function]",lR="[object GeneratorFunction]",uR="[object Proxy]";function xi(e){if(!pr(e))return!1;var t=Ki(e);return t==cR||t==lR||t==aR||t==uR}var Ph=Qr["__core-js_shared__"],pg=function(){var e=/[^.]+$/.exec(Ph&&Ph.keys&&Ph.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function hR(e){return!!pg&&pg in e}var fR=Function.prototype,dR=fR.toString;function _s(e){if(e!=null){try{return dR.call(e)}catch{}try{return e+""}catch{}}return""}var pR=/[\\^$.*+?()[\]{}|]/g,mR=/^\[object .+?Constructor\]$/,gR=Function.prototype,_R=Object.prototype,yR=gR.toString,bR=_R.hasOwnProperty,kR=RegExp("^"+yR.call(bR).replace(pR,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function wR(e){if(!pr(e)||hR(e))return!1;var t=xi(e)?kR:mR;return t.test(_s(e))}function ER(e,t){return e==null?void 0:e[t]}function ys(e,t){var n=ER(e,t);return wR(n)?n:void 0}var $h=ys(Qr,"WeakMap"),mg=Object.create,xR=function(){function e(){}return function(t){if(!pr(t))return{};if(mg)return mg(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function vR(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Qe(){}function TR(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}var AR=800,SR=16,RR=Date.now;function OR(e){var t=0,n=0;return function(){var r=RR(),i=SR-(r-n);if(n=r,i>0){if(++t>=AR)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function NR(e){return function(){return e}}var jc=function(){try{var e=ys(Object,"defineProperty");return e({},"",{}),e}catch{}}(),IR=jc?function(e,t){return jc(e,"toString",{configurable:!0,enumerable:!1,value:NR(t),writable:!0})}:lo,CR=OR(IR);function gg(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function _g(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function LR(e){return e!==e}function MR(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function Dh(e,t,n){return t===t?MR(e,t,n):_g(e,LR,n)}function yg(e,t){var n=e==null?0:e.length;return!!n&&Dh(e,t,0)>-1}var UR=9007199254740991,FR=/^(?:0|[1-9]\d*)$/;function zc(e,t){var n=typeof e;return t=t??UR,!!t&&(n=="number"||n!="symbol"&&FR.test(e))&&e>-1&&e%1==0&&e<t}function jh(e,t,n){t=="__proto__"&&jc?jc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ua(e,t){return e===t||e!==e&&t!==t}var BR=Object.prototype,PR=BR.hasOwnProperty;function Wc(e,t,n){var r=e[t];(!(PR.call(e,t)&&ua(r,n))||n===void 0&&!(t in e))&&jh(e,t,n)}function zh(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?jh(n,a,c):Wc(n,a,c)}return n}var bg=Math.max;function $R(e,t,n){return t=bg(t===void 0?e.length-1:t,0),function(){for(var r=arguments,i=-1,s=bg(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),vR(e,this,a)}}function Wh(e,t){return CR($R(e,t,lo),e+"")}var DR=9007199254740991;function Gh(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=DR}function ti(e){return e!=null&&Gh(e.length)&&!xi(e)}function kg(e,t,n){if(!pr(n))return!1;var r=typeof t;return(r=="number"?ti(n)&&zc(t,n.length):r=="string"&&t in n)?ua(n[t],e):!1}function jR(e){return Wh(function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=e.length>3&&typeof s=="function"?(i--,s):void 0,o&&kg(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r,s)}return t})}var zR=Object.prototype;function ha(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||zR;return e===n}function WR(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var GR="[object Arguments]";function wg(e){return Nr(e)&&Ki(e)==GR}var Eg=Object.prototype,KR=Eg.hasOwnProperty,HR=Eg.propertyIsEnumerable,Gc=wg(function(){return arguments}())?wg:function(e){return Nr(e)&&KR.call(e,"callee")&&!HR.call(e,"callee")};function YR(){return!1}var xg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,vg=xg&&typeof module=="object"&&module&&!module.nodeType&&module,VR=vg&&vg.exports===xg,Tg=VR?Qr.Buffer:void 0,XR=Tg?Tg.isBuffer:void 0,fa=XR||YR,qR="[object Arguments]",JR="[object Array]",ZR="[object Boolean]",QR="[object Date]",tO="[object Error]",eO="[object Function]",nO="[object Map]",rO="[object Number]",iO="[object Object]",sO="[object RegExp]",oO="[object Set]",aO="[object String]",cO="[object WeakMap]",lO="[object ArrayBuffer]",uO="[object DataView]",hO="[object Float32Array]",fO="[object Float64Array]",dO="[object Int8Array]",pO="[object Int16Array]",mO="[object Int32Array]",gO="[object Uint8Array]",_O="[object Uint8ClampedArray]",yO="[object Uint16Array]",bO="[object Uint32Array]",Ee={};Ee[hO]=Ee[fO]=Ee[dO]=Ee[pO]=Ee[mO]=Ee[gO]=Ee[_O]=Ee[yO]=Ee[bO]=!0,Ee[qR]=Ee[JR]=Ee[lO]=Ee[ZR]=Ee[uO]=Ee[QR]=Ee[tO]=Ee[eO]=Ee[nO]=Ee[rO]=Ee[iO]=Ee[sO]=Ee[oO]=Ee[aO]=Ee[cO]=!1;function kO(e){return Nr(e)&&Gh(e.length)&&!!Ee[Ki(e)]}function Kc(e){return function(t){return e(t)}}var Ag=typeof exports=="object"&&exports&&!exports.nodeType&&exports,da=Ag&&typeof module=="object"&&module&&!module.nodeType&&module,wO=da&&da.exports===Ag,Kh=wO&&og.process,Hi=function(){try{var e=da&&da.require&&da.require("util").types;return e||Kh&&Kh.binding&&Kh.binding("util")}catch{}}(),Sg=Hi&&Hi.isTypedArray,Hh=Sg?Kc(Sg):kO,EO=Object.prototype,xO=EO.hasOwnProperty;function Rg(e,t){var n=se(e),r=!n&&Gc(e),i=!n&&!r&&fa(e),s=!n&&!r&&!i&&Hh(e),o=n||r||i||s,a=o?WR(e.length,String):[],c=a.length;for(var l in e)(t||xO.call(e,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||zc(l,c)))&&a.push(l);return a}function Og(e,t){return function(n){return e(t(n))}}var vO=Og(Object.keys,Object),TO=Object.prototype,AO=TO.hasOwnProperty;function Ng(e){if(!ha(e))return vO(e);var t=[];for(var n in Object(e))AO.call(e,n)&&n!="constructor"&&t.push(n);return t}function mr(e){return ti(e)?Rg(e):Ng(e)}var SO=Object.prototype,RO=SO.hasOwnProperty,$n=jR(function(e,t){if(ha(t)||ti(t)){zh(t,mr(t),e);return}for(var n in t)RO.call(t,n)&&Wc(e,n,t[n])});function OO(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var NO=Object.prototype,IO=NO.hasOwnProperty;function CO(e){if(!pr(e))return OO(e);var t=ha(e),n=[];for(var r in e)r=="constructor"&&(t||!IO.call(e,r))||n.push(r);return n}function Ig(e){return ti(e)?Rg(e,!0):CO(e)}var LO=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,MO=/^\w*$/;function Yh(e,t){if(se(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Pc(e)?!0:MO.test(e)||!LO.test(e)||t!=null&&e in Object(t)}var pa=ys(Object,"create");function UO(){this.__data__=pa?pa(null):{},this.size=0}function FO(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var BO="__lodash_hash_undefined__",PO=Object.prototype,$O=PO.hasOwnProperty;function DO(e){var t=this.__data__;if(pa){var n=t[e];return n===BO?void 0:n}return $O.call(t,e)?t[e]:void 0}var jO=Object.prototype,zO=jO.hasOwnProperty;function WO(e){var t=this.__data__;return pa?t[e]!==void 0:zO.call(t,e)}var GO="__lodash_hash_undefined__";function KO(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=pa&&t===void 0?GO:t,this}function bs(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}bs.prototype.clear=UO,bs.prototype.delete=FO,bs.prototype.get=DO,bs.prototype.has=WO,bs.prototype.set=KO;function HO(){this.__data__=[],this.size=0}function Hc(e,t){for(var n=e.length;n--;)if(ua(e[n][0],t))return n;return-1}var YO=Array.prototype,VO=YO.splice;function XO(e){var t=this.__data__,n=Hc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():VO.call(t,n,1),--this.size,!0}function qO(e){var t=this.__data__,n=Hc(t,e);return n<0?void 0:t[n][1]}function JO(e){return Hc(this.__data__,e)>-1}function ZO(e,t){var n=this.__data__,r=Hc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function vi(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}vi.prototype.clear=HO,vi.prototype.delete=XO,vi.prototype.get=qO,vi.prototype.has=JO,vi.prototype.set=ZO;var ma=ys(Qr,"Map");function QO(){this.size=0,this.__data__={hash:new bs,map:new(ma||vi),string:new bs}}function tN(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Yc(e,t){var n=e.__data__;return tN(t)?n[typeof t=="string"?"string":"hash"]:n.map}function eN(e){var t=Yc(this,e).delete(e);return this.size-=t?1:0,t}function nN(e){return Yc(this,e).get(e)}function rN(e){return Yc(this,e).has(e)}function iN(e,t){var n=Yc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function Ti(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ti.prototype.clear=QO,Ti.prototype.delete=eN,Ti.prototype.get=nN,Ti.prototype.has=rN,Ti.prototype.set=iN;var sN="Expected a function";function Vh(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(sN);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(Vh.Cache||Ti),n}Vh.Cache=Ti;var oN=500;function aN(e){var t=Vh(e,function(r){return n.size===oN&&n.clear(),r}),n=t.cache;return t}var cN=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,lN=/\\(\\)?/g,uN=aN(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(cN,function(n,r,i,s){t.push(i?s.replace(lN,"$1"):r||n)}),t});function Cg(e){return e==null?"":hg(e)}function Vc(e,t){return se(e)?e:Yh(e,t)?[e]:uN(Cg(e))}var hN=1/0;function ga(e){if(typeof e=="string"||Pc(e))return e;var t=e+"";return t=="0"&&1/e==-hN?"-0":t}function Xh(e,t){t=Vc(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[ga(t[n++])];return n&&n==r?e:void 0}function fN(e,t,n){var r=e==null?void 0:Xh(e,t);return r===void 0?n:r}function qh(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var Lg=dr?dr.isConcatSpreadable:void 0;function dN(e){return se(e)||Gc(e)||!!(Lg&&e&&e[Lg])}function Jh(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=dN),i||(i=[]);++s<o;){var a=e[s];n(a)?qh(i,a):r||(i[i.length]=a)}return i}function er(e){var t=e==null?0:e.length;return t?Jh(e):[]}var Mg=Og(Object.getPrototypeOf,Object);function Zh(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function pN(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Zh(e,t,n)}var mN="\\ud800-\\udfff",gN="\\u0300-\\u036f",_N="\\ufe20-\\ufe2f",yN="\\u20d0-\\u20ff",bN=gN+_N+yN,kN="\\ufe0e\\ufe0f",wN="\\u200d",EN=RegExp("["+wN+mN+bN+kN+"]");function Ug(e){return EN.test(e)}function xN(e){return e.split("")}var Fg="\\ud800-\\udfff",vN="\\u0300-\\u036f",TN="\\ufe20-\\ufe2f",AN="\\u20d0-\\u20ff",SN=vN+TN+AN,RN="\\ufe0e\\ufe0f",ON="["+Fg+"]",Qh="["+SN+"]",tf="\\ud83c[\\udffb-\\udfff]",NN="(?:"+Qh+"|"+tf+")",Bg="[^"+Fg+"]",Pg="(?:\\ud83c[\\udde6-\\uddff]){2}",$g="[\\ud800-\\udbff][\\udc00-\\udfff]",IN="\\u200d",Dg=NN+"?",jg="["+RN+"]?",CN="(?:"+IN+"(?:"+[Bg,Pg,$g].join("|")+")"+jg+Dg+")*",LN=jg+Dg+CN,MN="(?:"+[Bg+Qh+"?",Qh,Pg,$g,ON].join("|")+")",UN=RegExp(tf+"(?="+tf+")|"+MN+LN,"g");function FN(e){return e.match(UN)||[]}function BN(e){return Ug(e)?FN(e):xN(e)}function PN(e){return function(t){t=Cg(t);var n=Ug(t)?BN(t):void 0,r=n?n[0]:t.charAt(0),i=n?pN(n,1).join(""):t.slice(1);return r[e]()+i}}var zg=PN("toUpperCase");function $N(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function DN(){this.__data__=new vi,this.size=0}function jN(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function zN(e){return this.__data__.get(e)}function WN(e){return this.__data__.has(e)}var GN=200;function KN(e,t){var n=this.__data__;if(n instanceof vi){var r=n.__data__;if(!ma||r.length<GN-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ti(r)}return n.set(e,t),this.size=n.size,this}function ei(e){var t=this.__data__=new vi(e);this.size=t.size}ei.prototype.clear=DN,ei.prototype.delete=jN,ei.prototype.get=zN,ei.prototype.has=WN,ei.prototype.set=KN;function HN(e,t){return e&&zh(t,mr(t),e)}var Wg=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Gg=Wg&&typeof module=="object"&&module&&!module.nodeType&&module,YN=Gg&&Gg.exports===Wg,Kg=YN?Qr.Buffer:void 0,Hg=Kg?Kg.allocUnsafe:void 0;function VN(e,t){var n=e.length,r=Hg?Hg(n):new e.constructor(n);return e.copy(r),r}function ef(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function Yg(){return[]}var XN=Object.prototype,qN=XN.propertyIsEnumerable,Vg=Object.getOwnPropertySymbols,nf=Vg?function(e){return e==null?[]:(e=Object(e),ef(Vg(e),function(t){return qN.call(e,t)}))}:Yg;function JN(e,t){return zh(e,nf(e),t)}var ZN=Object.getOwnPropertySymbols,QN=ZN?function(e){for(var t=[];e;)qh(t,nf(e)),e=Mg(e);return t}:Yg;function Xg(e,t,n){var r=t(e);return se(e)?r:qh(r,n(e))}function rf(e){return Xg(e,mr,nf)}function tI(e){return Xg(e,Ig,QN)}var sf=ys(Qr,"DataView"),of=ys(Qr,"Promise"),uo=ys(Qr,"Set"),qg="[object Map]",eI="[object Object]",Jg="[object Promise]",Zg="[object Set]",Qg="[object WeakMap]",t_="[object DataView]",nI=_s(sf),rI=_s(ma),iI=_s(of),sI=_s(uo),oI=_s($h),gr=Ki;(sf&&gr(new sf(new ArrayBuffer(1)))!=t_||ma&&gr(new ma)!=qg||of&&gr(of.resolve())!=Jg||uo&&gr(new uo)!=Zg||$h&&gr(new $h)!=Qg)&&(gr=function(e){var t=Ki(e),n=t==eI?e.constructor:void 0,r=n?_s(n):"";if(r)switch(r){case nI:return t_;case rI:return qg;case iI:return Jg;case sI:return Zg;case oI:return Qg}return t});var aI=Object.prototype,cI=aI.hasOwnProperty;function lI(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&cI.call(e,"index")&&(n.index=e.index,n.input=e.input),n}var Xc=Qr.Uint8Array;function uI(e){var t=new e.constructor(e.byteLength);return new Xc(t).set(new Xc(e)),t}function hI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}var fI=/\w*$/;function dI(e){var t=new e.constructor(e.source,fI.exec(e));return t.lastIndex=e.lastIndex,t}var e_=dr?dr.prototype:void 0,n_=e_?e_.valueOf:void 0;function pI(e){return n_?Object(n_.call(e)):{}}function mI(e,t){var n=e.buffer;return new e.constructor(n,e.byteOffset,e.length)}var gI="[object Boolean]",_I="[object Date]",yI="[object Map]",bI="[object Number]",kI="[object RegExp]",wI="[object Set]",EI="[object String]",xI="[object Symbol]",vI="[object ArrayBuffer]",TI="[object DataView]",AI="[object Float32Array]",SI="[object Float64Array]",RI="[object Int8Array]",OI="[object Int16Array]",NI="[object Int32Array]",II="[object Uint8Array]",CI="[object Uint8ClampedArray]",LI="[object Uint16Array]",MI="[object Uint32Array]";function UI(e,t,n){var r=e.constructor;switch(t){case vI:return uI(e);case gI:case _I:return new r(+e);case TI:return hI(e);case AI:case SI:case RI:case OI:case NI:case II:case CI:case LI:case MI:return mI(e);case yI:return new r;case bI:case EI:return new r(e);case kI:return dI(e);case wI:return new r;case xI:return pI(e)}}function FI(e){return typeof e.constructor=="function"&&!ha(e)?xR(Mg(e)):{}}var BI="[object Map]";function PI(e){return Nr(e)&&gr(e)==BI}var r_=Hi&&Hi.isMap,$I=r_?Kc(r_):PI,DI="[object Set]";function jI(e){return Nr(e)&&gr(e)==DI}var i_=Hi&&Hi.isSet,zI=i_?Kc(i_):jI,s_="[object Arguments]",WI="[object Array]",GI="[object Boolean]",KI="[object Date]",HI="[object Error]",o_="[object Function]",YI="[object GeneratorFunction]",VI="[object Map]",XI="[object Number]",a_="[object Object]",qI="[object RegExp]",JI="[object Set]",ZI="[object String]",QI="[object Symbol]",tC="[object WeakMap]",eC="[object ArrayBuffer]",nC="[object DataView]",rC="[object Float32Array]",iC="[object Float64Array]",sC="[object Int8Array]",oC="[object Int16Array]",aC="[object Int32Array]",cC="[object Uint8Array]",lC="[object Uint8ClampedArray]",uC="[object Uint16Array]",hC="[object Uint32Array]",_e={};_e[s_]=_e[WI]=_e[eC]=_e[nC]=_e[GI]=_e[KI]=_e[rC]=_e[iC]=_e[sC]=_e[oC]=_e[aC]=_e[VI]=_e[XI]=_e[a_]=_e[qI]=_e[JI]=_e[ZI]=_e[QI]=_e[cC]=_e[lC]=_e[uC]=_e[hC]=!0,_e[HI]=_e[o_]=_e[tC]=!1;function qc(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!pr(e))return e;var a=se(e);if(a)return o=lI(e),TR(e,o);var c=gr(e),l=c==o_||c==YI;if(fa(e))return VN(e);if(c==a_||c==s_||l&&!i)return o=l?{}:FI(e),JN(e,HN(o,e));if(!_e[c])return i?e:{};o=UI(e,c),s||(s=new ei);var u=s.get(e);if(u)return u;s.set(e,o),zI(e)?e.forEach(function(h){o.add(qc(h,t,n,h,e,s))}):$I(e)&&e.forEach(function(h,m){o.set(m,qc(h,t,n,m,e,s))});var f=rf,d=a?void 0:f(e);return gg(d||e,function(h,m){d&&(m=h,h=e[m]),Wc(o,m,qc(h,t,n,m,e,s))}),o}var fC=4;function mn(e){return qc(e,fC)}function _a(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}var dC="__lodash_hash_undefined__";function pC(e){return this.__data__.set(e,dC),this}function mC(e){return this.__data__.has(e)}function ho(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Ti;++t<n;)this.add(e[t])}ho.prototype.add=ho.prototype.push=pC,ho.prototype.has=mC;function c_(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function af(e,t){return e.has(t)}var gC=1,_C=2;function l_(e,t,n,r,i,s){var o=n&gC,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e),u=s.get(t);if(l&&u)return l==t&&u==e;var f=-1,d=!0,h=n&_C?new ho:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var m=e[f],p=t[f];if(r)var b=o?r(p,m,f,t,e,s):r(m,p,f,e,t,s);if(b!==void 0){if(b)continue;d=!1;break}if(h){if(!c_(t,function(y,v){if(!af(h,v)&&(m===y||i(m,y,n,r,s)))return h.push(v)})){d=!1;break}}else if(!(m===p||i(m,p,n,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}function yC(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function cf(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var bC=1,kC=2,wC="[object Boolean]",EC="[object Date]",xC="[object Error]",vC="[object Map]",TC="[object Number]",AC="[object RegExp]",SC="[object Set]",RC="[object String]",OC="[object Symbol]",NC="[object ArrayBuffer]",IC="[object DataView]",u_=dr?dr.prototype:void 0,lf=u_?u_.valueOf:void 0;function CC(e,t,n,r,i,s,o){switch(n){case IC:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case NC:return!(e.byteLength!=t.byteLength||!s(new Xc(e),new Xc(t)));case wC:case EC:case TC:return ua(+e,+t);case xC:return e.name==t.name&&e.message==t.message;case AC:case RC:return e==t+"";case vC:var a=yC;case SC:var c=r&bC;if(a||(a=cf),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;r|=kC,o.set(e,t);var u=l_(a(e),a(t),r,i,s,o);return o.delete(e),u;case OC:if(lf)return lf.call(e)==lf.call(t)}return!1}var LC=1,MC=Object.prototype,UC=MC.hasOwnProperty;function FC(e,t,n,r,i,s){var o=n&LC,a=rf(e),c=a.length,l=rf(t),u=l.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var d=a[f];if(!(o?d in t:UC.call(t,d)))return!1}var h=s.get(e),m=s.get(t);if(h&&m)return h==t&&m==e;var p=!0;s.set(e,t),s.set(t,e);for(var b=o;++f<c;){d=a[f];var y=e[d],v=t[d];if(r)var T=o?r(v,y,d,t,e,s):r(y,v,d,e,t,s);if(!(T===void 0?y===v||i(y,v,n,r,s):T)){p=!1;break}b||(b=d=="constructor")}if(p&&!b){var A=e.constructor,U=t.constructor;A!=U&&"constructor"in e&&"constructor"in t&&!(typeof A=="function"&&A instanceof A&&typeof U=="function"&&U instanceof U)&&(p=!1)}return s.delete(e),s.delete(t),p}var BC=1,h_="[object Arguments]",f_="[object Array]",Jc="[object Object]",PC=Object.prototype,d_=PC.hasOwnProperty;function $C(e,t,n,r,i,s){var o=se(e),a=se(t),c=o?f_:gr(e),l=a?f_:gr(t);c=c==h_?Jc:c,l=l==h_?Jc:l;var u=c==Jc,f=l==Jc,d=c==l;if(d&&fa(e)){if(!fa(t))return!1;o=!0,u=!1}if(d&&!u)return s||(s=new ei),o||Hh(e)?l_(e,t,n,r,i,s):CC(e,t,c,n,r,i,s);if(!(n&BC)){var h=u&&d_.call(e,"__wrapped__"),m=f&&d_.call(t,"__wrapped__");if(h||m){var p=h?e.value():e,b=m?t.value():t;return s||(s=new ei),i(p,b,n,r,s)}}return d?(s||(s=new ei),FC(e,t,n,r,i,s)):!1}function uf(e,t,n,r,i){return e===t?!0:e==null||t==null||!Nr(e)&&!Nr(t)?e!==e&&t!==t:$C(e,t,n,r,uf,i)}var DC=1,jC=2;function zC(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var o=n[i];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++i<s;){o=n[i];var a=o[0],c=e[a],l=o[1];if(o[2]){if(c===void 0&&!(a in e))return!1}else{var u=new ei,f;if(!(f===void 0?uf(l,c,DC|jC,r,u):f))return!1}}return!0}function p_(e){return e===e&&!pr(e)}function WC(e){for(var t=mr(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,p_(i)]}return t}function m_(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function GC(e){var t=WC(e);return t.length==1&&t[0][2]?m_(t[0][0],t[0][1]):function(n){return n===e||zC(n,e,t)}}function KC(e,t){return e!=null&&t in Object(e)}function g_(e,t,n){t=Vc(t,e);for(var r=-1,i=t.length,s=!1;++r<i;){var o=ga(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:(i=e==null?0:e.length,!!i&&Gh(i)&&zc(o,i)&&(se(e)||Gc(e)))}function HC(e,t){return e!=null&&g_(e,t,KC)}var YC=1,VC=2;function XC(e,t){return Yh(e)&&p_(t)?m_(ga(e),t):function(n){var r=fN(n,e);return r===void 0&&r===t?HC(n,e):uf(t,r,YC|VC)}}function qC(e){return function(t){return t==null?void 0:t[e]}}function JC(e){return function(t){return Xh(t,e)}}function ZC(e){return Yh(e)?qC(ga(e)):JC(e)}function ni(e){return typeof e=="function"?e:e==null?lo:typeof e=="object"?se(e)?XC(e[0],e[1]):GC(e):ZC(e)}function QC(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}function tL(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return t}}var eL=tL();function nL(e,t){return e&&eL(e,t,mr)}function rL(e,t){return function(n,r){if(n==null)return n;if(!ti(n))return e(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var ks=rL(nL);function iL(e,t,n,r){return ks(e,function(i,s,o){t(r,i,n(i),o)}),r}function sL(e,t){return function(n,r){var i=se(n)?QC:iL,s=t?t():{};return i(n,e,ni(r),s)}}var __=Object.prototype,oL=__.hasOwnProperty,hf=Wh(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&kg(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Ig(s),a=-1,c=o.length;++a<c;){var l=o[a],u=e[l];(u===void 0||ua(u,__[l])&&!oL.call(e,l))&&(e[l]=s[l])}return e});function y_(e){return Nr(e)&&ti(e)}var aL=200;function cL(e,t,n,r){var i=-1,s=yg,o=!0,a=e.length,c=[],l=t.length;if(!a)return c;t.length>=aL&&(s=af,o=!1,t=new ho(t));t:for(;++i<a;){var u=e[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=l;d--;)if(t[d]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var Zc=Wh(function(e,t){return y_(e)?cL(e,Jh(t,1,y_,!0)):[]});function fo(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function gn(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Dc(t),Zh(e,t<0?0:t,r)):[]}function ya(e,t,n){var r=e==null?0:e.length;return r?(t=t===void 0?1:Dc(t),t=r-t,Zh(e,0,t<0?0:t)):[]}function lL(e){return typeof e=="function"?e:lo}function Ut(e,t){var n=se(e)?gg:ks;return n(e,lL(t))}function uL(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function hL(e,t){var n=!0;return ks(e,function(r,i,s){return n=!!t(r,i,s),n}),n}function Ir(e,t,n){var r=se(e)?uL:hL;return r(e,ni(t))}function b_(e,t){var n=[];return ks(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function _r(e,t){var n=se(e)?ef:b_;return n(e,ni(t))}function fL(e){return function(t,n,r){var i=Object(t);if(!ti(t)){var s=ni(n);t=mr(t),n=function(a){return s(i[a],a,i)}}var o=e(t,n,r);return o>-1?i[s?t[o]:o]:void 0}}var dL=Math.max;function pL(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:Dc(n);return i<0&&(i=dL(r+i,0)),_g(e,ni(t),i)}var po=fL(pL);function Cr(e){return e&&e.length?e[0]:void 0}function mL(e,t){var n=-1,r=ti(e)?Array(e.length):[];return ks(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function Tt(e,t){var n=se(e)?$c:mL;return n(e,ni(t))}function yr(e,t){return Jh(Tt(e,t))}var gL=Object.prototype,_L=gL.hasOwnProperty,k_=sL(function(e,t,n){_L.call(e,n)?e[n].push(t):jh(e,n,[t])}),yL=Object.prototype,bL=yL.hasOwnProperty;function kL(e,t){return e!=null&&bL.call(e,t)}function Mt(e,t){return e!=null&&g_(e,t,kL)}var wL="[object String]";function Dn(e){return typeof e=="string"||!se(e)&&Nr(e)&&Ki(e)==wL}function EL(e,t){return $c(t,function(n){return e[n]})}function Ve(e){return e==null?[]:EL(e,mr(e))}var xL=Math.max;function Rn(e,t,n,r){e=ti(e)?e:Ve(e),n=n&&!r?Dc(n):0;var i=e.length;return n<0&&(n=xL(i+n,0)),Dn(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Dh(e,t,n)>-1}function w_(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=0;return Dh(e,t,i)}var vL="[object Map]",TL="[object Set]",AL=Object.prototype,SL=AL.hasOwnProperty;function ye(e){if(e==null)return!0;if(ti(e)&&(se(e)||typeof e=="string"||typeof e.splice=="function"||fa(e)||Hh(e)||Gc(e)))return!e.length;var t=gr(e);if(t==vL||t==TL)return!e.size;if(ha(e))return!Ng(e).length;for(var n in e)if(SL.call(e,n))return!1;return!0}var RL="[object RegExp]";function OL(e){return Nr(e)&&Ki(e)==RL}var E_=Hi&&Hi.isRegExp,Ai=E_?Kc(E_):OL;function Si(e){return e===void 0}var NL="Expected a function";function IL(e){if(typeof e!="function")throw new TypeError(NL);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function CL(e,t,n,r){if(!pr(e))return e;t=Vc(t,e);for(var i=-1,s=t.length,o=s-1,a=e;a!=null&&++i<s;){var c=ga(t[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=pr(u)?u:zc(t[i+1])?[]:{})}Wc(a,c,l),a=a[c]}return e}function LL(e,t,n){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Xh(e,o);n(a,o)&&CL(s,Vc(o,e),a)}return s}function Lr(e,t){if(e==null)return{};var n=$c(tI(e),function(r){return[r]});return t=ni(t),LL(e,n,function(r,i){return t(r,i[0])})}function ML(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function jn(e,t,n){var r=se(e)?$N:ML,i=arguments.length<3;return r(e,ni(t),n,i,ks)}function Qc(e,t){var n=se(e)?ef:b_;return n(e,IL(ni(t)))}function UL(e,t){var n;return ks(e,function(r,i,s){return n=t(r,i,s),!n}),!!n}function ff(e,t,n){var r=se(e)?c_:UL;return r(e,ni(t))}var FL=1/0,BL=uo&&1/cf(new uo([,-0]))[1]==FL?function(e){return new uo(e)}:Qe,PL=200;function $L(e,t,n){var r=-1,i=yg,s=e.length,o=!0,a=[],c=a;if(s>=PL){var l=BL(e);if(l)return cf(l);o=!1,i=af,c=new ho}else c=a;t:for(;++r<s;){var u=e[r],f=u;if(u=u!==0?u:0,o&&f===f){for(var d=c.length;d--;)if(c[d]===f)continue t;a.push(u)}else i(c,f,n)||(c!==a&&c.push(f),a.push(u))}return a}function tl(e){return e&&e.length?$L(e):[]}function df(e){console&&console.error&&console.error(`Error: ${e}`)}function x_(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function v_(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function T_(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function DL(e){return jL(e)?e.LABEL:e.name}function jL(e){return Dn(e.LABEL)&&e.LABEL!==""}class ri{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),Ut(this.definition,n=>{n.accept(t)})}}class zn extends ri{constructor(t){super([]),this.idx=1,$n(this,Lr(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class mo extends ri{constructor(t){super(t.definition),this.orgText="",$n(this,Lr(t,n=>n!==void 0))}}class Wn extends ri{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,$n(this,Lr(t,n=>n!==void 0))}}class Gn extends ri{constructor(t){super(t.definition),this.idx=1,$n(this,Lr(t,n=>n!==void 0))}}class ii extends ri{constructor(t){super(t.definition),this.idx=1,$n(this,Lr(t,n=>n!==void 0))}}class si extends ri{constructor(t){super(t.definition),this.idx=1,$n(this,Lr(t,n=>n!==void 0))}}class tn extends ri{constructor(t){super(t.definition),this.idx=1,$n(this,Lr(t,n=>n!==void 0))}}class Mr extends ri{constructor(t){super(t.definition),this.idx=1,$n(this,Lr(t,n=>n!==void 0))}}class Ur extends ri{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,$n(this,Lr(t,n=>n!==void 0))}}class Me{constructor(t){this.idx=1,$n(this,Lr(t,n=>n!==void 0))}accept(t){t.visit(this)}}function zL(e){return Tt(e,el)}function el(e){function t(n){return Tt(n,el)}if(e instanceof zn){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return Dn(e.label)&&(n.label=e.label),n}else{if(e instanceof Wn)return{type:"Alternative",definition:t(e.definition)};if(e instanceof Gn)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof ii)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof si)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:el(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Mr)return{type:"RepetitionWithSeparator",idx:e.idx,separator:el(new Me({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof tn)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof Ur)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof Me){const n={type:"Terminal",name:e.terminalType.name,label:DL(e.terminalType),idx:e.idx};Dn(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ai(r)?r.source:r),n}else{if(e instanceof mo)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}}}class ws{visit(t){const n=t;switch(n.constructor){case zn:return this.visitNonTerminal(n);case Wn:return this.visitAlternative(n);case Gn:return this.visitOption(n);case ii:return this.visitRepetitionMandatory(n);case si:return this.visitRepetitionMandatoryWithSeparator(n);case Mr:return this.visitRepetitionWithSeparator(n);case tn:return this.visitRepetition(n);case Ur:return this.visitAlternation(n);case Me:return this.visitTerminal(n);case mo:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function WL(e){return e instanceof Wn||e instanceof Gn||e instanceof tn||e instanceof ii||e instanceof si||e instanceof Mr||e instanceof Me||e instanceof mo}function nl(e,t=[]){return e instanceof Gn||e instanceof tn||e instanceof Mr?!0:e instanceof Ur?ff(e.definition,r=>nl(r,t)):e instanceof zn&&Rn(t,e)?!1:e instanceof ri?(e instanceof zn&&t.push(e),Ir(e.definition,r=>nl(r,t))):!1}function GL(e){return e instanceof Ur}function oi(e){if(e instanceof zn)return"SUBRULE";if(e instanceof Gn)return"OPTION";if(e instanceof Ur)return"OR";if(e instanceof ii)return"AT_LEAST_ONE";if(e instanceof si)return"AT_LEAST_ONE_SEP";if(e instanceof Mr)return"MANY_SEP";if(e instanceof tn)return"MANY";if(e instanceof Me)return"CONSUME";throw Error("non exhaustive match")}class rl{walk(t,n=[]){Ut(t.definition,(r,i)=>{const s=gn(t.definition,i+1);if(r instanceof zn)this.walkProdRef(r,s,n);else if(r instanceof Me)this.walkTerminal(r,s,n);else if(r instanceof Wn)this.walkFlat(r,s,n);else if(r instanceof Gn)this.walkOption(r,s,n);else if(r instanceof ii)this.walkAtLeastOne(r,s,n);else if(r instanceof si)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Mr)this.walkManySep(r,s,n);else if(r instanceof tn)this.walkMany(r,s,n);else if(r instanceof Ur)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new Gn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=A_(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new Gn({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=A_(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);Ut(t.definition,s=>{const o=new Wn({definition:[s]});this.walk(o,i)})}}function A_(e,t,n){return[new Gn({definition:[new Me({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function ba(e){if(e instanceof zn)return ba(e.referencedRule);if(e instanceof Me)return YL(e);if(WL(e))return KL(e);if(GL(e))return HL(e);throw Error("non exhaustive match")}function KL(e){let t=[];const n=e.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=nl(s),t=t.concat(ba(s)),r=r+1,i=n.length>r;return tl(t)}function HL(e){const t=Tt(e.definition,n=>ba(n));return tl(er(t))}function YL(e){return[e.terminalType]}const S_="_~IN~_";class VL extends rl{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=qL(t.referencedRule,t.idx)+this.topProd.name,s=n.concat(r),o=new Wn({definition:s}),a=ba(o);this.follows[i]=a}}function XL(e){const t={};return Ut(e,n=>{const r=new VL(n).startWalking();$n(t,r)}),t}function qL(e,t){return e.name+t+S_}function Bt(e){return e.charCodeAt(0)}function pf(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function ka(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function go(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function JL(){throw Error("Internal Error - Should never get here!")}function R_(e){return e.type==="Character"}const il=[];for(let e=Bt("0");e<=Bt("9");e++)il.push(e);const sl=[Bt("_")].concat(il);for(let e=Bt("a");e<=Bt("z");e++)sl.push(e);for(let e=Bt("A");e<=Bt("Z");e++)sl.push(e);const O_=[Bt(" "),Bt("\f"),Bt(`
`),Bt("\r"),Bt("	"),Bt("\v"),Bt("	"),Bt("Â "),Bt("á"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("â"),Bt("\u2028"),Bt("\u2029"),Bt("â¯"),Bt("â"),Bt("ã"),Bt("\uFEFF")],ZL=/[0-9a-fA-F]/,ol=/[0-9]/,QL=/[1-9]/;class t6{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx}pattern(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":ka(r,"global");break;case"i":ka(r,"ignoreCase");break;case"m":ka(r,"multiLine");break;case"u":ka(r,"unicode");break;case"y":ka(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const t=[],n=this.idx;for(t.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(n)}}alternative(){const t=[],n=this.idx;for(;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}go(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(t)}}return JL()}quantifier(t=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(t===!0&&n===void 0)return;go(n);break}if(!(t===!0&&n===void 0)&&go(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let t;const n=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group();break}if(t===void 0&&this.isPatternCharacter()&&(t=this.patternCharacter()),go(t))return t.loc=this.loc(n),this.isQuantifier()&&(t.quantifier=this.quantifier()),t}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[Bt(`
`),Bt("\r"),Bt("\u2028"),Bt("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let t,n=!1;switch(this.popChar()){case"d":t=il;break;case"D":t=il,n=!0;break;case"s":t=O_;break;case"S":t=O_,n=!0;break;case"w":t=sl;break;case"W":t=sl,n=!0;break}if(go(t))return{type:"Set",value:t,complement:n}}controlEscapeAtom(){let t;switch(this.popChar()){case"f":t=Bt("\f");break;case"n":t=Bt(`
`);break;case"r":t=Bt("\r");break;case"t":t=Bt("	");break;case"v":t=Bt("\v");break}if(go(t))return{type:"Character",value:t}}controlLetterEscapeAtom(){this.consumeChar("c");const t=this.popChar();if(/[a-zA-Z]/.test(t)===!1)throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:Bt("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const t=this.popChar();return{type:"Character",value:Bt(t)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const t=this.popChar();return{type:"Character",value:Bt(t)}}}characterClass(){const t=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,R_(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,R_(i)){if(i.value<r.value)throw Error("Range out of order in character class");t.push({from:r.value,to:i.value})}else pf(r.value,t),t.push(Bt("-")),pf(i.value,t)}else pf(r.value,t)}return this.consumeChar("]"),{type:"Set",complement:n,value:t}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:Bt("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:t,value:n};return t&&(r.idx=this.groupIdx),r}positiveInteger(){let t=this.popChar();if(QL.test(t)===!1)throw Error("Expecting a positive integer");for(;ol.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}integerIncludingZero(){let t=this.popChar();if(ol.test(t)===!1)throw Error("Expecting an integer");for(;ol.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)}patternCharacter(){const t=this.popChar();switch(t){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:Bt(t)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return ol.test(this.peekChar(0))}isClassAtom(t=0){switch(this.peekChar(t)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const t=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(t)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(t){let n="";for(let i=0;i<t;i++){const s=this.popChar();if(ZL.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(t=0){return this.input[this.idx+t]}popChar(){const t=this.peekChar(0);return this.consumeChar(void 0),t}consumeChar(t){if(t!==void 0&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(t){return{begin:t,end:this.idx}}}class mf{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t);break}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let al={};const e6=new t6;function cl(e){const t=e.toString();if(al.hasOwnProperty(t))return al[t];{const n=e6.pattern(t);return al[t]=n,n}}function n6(){al={}}const N_="Complement Sets are not supported for first char optimization",ll=`Unable to use "first char" lexer optimizations:
`;function r6(e,t=!1){try{const n=cl(e);return gf(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===N_)t&&x_(`${ll}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),df(`${ll}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function gf(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)gf(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":ul(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(N_);Ut(o.value,c=>{if(typeof c=="number")ul(c,t,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)ul(u,t,n);else{for(let u=l.from;u<=l.to&&u<Ea;u++)ul(u,t,n);if(l.to>=Ea){const u=l.from>=Ea?l.from:Ea,f=l.to,d=Yi(u),h=Yi(f);for(let m=d;m<=h;m++)t[m]=m}}}});break;case"Group":gf(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&_f(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ve(t)}function ul(e,t,n){const r=Yi(e);t[r]=r,n===!0&&i6(e,t)}function i6(e,t){const n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){const i=Yi(r.charCodeAt(0));t[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Yi(i.charCodeAt(0));t[s]=s}}}function I_(e,t){return po(e.value,n=>{if(typeof n=="number")return Rn(t,n);{const r=n;return po(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function _f(e){const t=e.quantifier;return t&&t.atLeast===0?!0:e.value?se(e.value)?Ir(e.value,_f):_f(e.value):!1}class s6 extends mf{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":this.visitLookahead(t);return;case"NegativeLookahead":this.visitNegativeLookahead(t);return}super.visitChildren(t)}}visitCharacter(t){Rn(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?I_(t,this.targetCharCodes)===void 0&&(this.found=!0):I_(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function yf(e,t){if(t instanceof RegExp){const n=cl(t),r=new s6(e);return r.visit(n),r.found}else return po(t,n=>Rn(e,n.charCodeAt(0)))!==void 0}const Es="PATTERN",wa="defaultMode",hl="modes";let C_=typeof new RegExp("(?:)").sticky=="boolean";function o6(e,t){t=hf(t,{useSticky:C_,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(v,T)=>T()});const n=t.tracer;n("initCharCodeToOptimizedIndexMap",()=>{O6()});let r;n("Reject Lexer.NA",()=>{r=Qc(e,v=>v[Es]===cn.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Tt(r,v=>{const T=v[Es];if(Ai(T)){const A=T.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!T.ignoreCase?A:A.length===2&&A[0]==="\\"&&!Rn(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:t.useSticky?M_(T):L_(T)}else{if(xi(T))return i=!0,{exec:T};if(typeof T=="object")return i=!0,T;if(typeof T=="string"){if(T.length===1)return T;{const A=T.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),U=new RegExp(A);return t.useSticky?M_(U):L_(U)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Tt(r,v=>v.tokenTypeIdx),a=Tt(r,v=>{const T=v.GROUP;if(T!==cn.SKIPPED){if(Dn(T))return T;if(Si(T))return!1;throw Error("non exhaustive match")}}),c=Tt(r,v=>{const T=v.LONGER_ALT;if(T)return se(T)?Tt(T,U=>w_(r,U)):[w_(r,T)]}),l=Tt(r,v=>v.PUSH_MODE),u=Tt(r,v=>Mt(v,"POP_MODE"))});let f;n("Line Terminator Handling",()=>{const v=B_(t.lineTerminatorCharacters);f=Tt(r,T=>!1),t.positionTracking!=="onlyOffset"&&(f=Tt(r,T=>Mt(T,"LINE_BREAKS")?!!T.LINE_BREAKS:F_(T,v)===!1&&yf(v,T.PATTERN)))});let d,h,m,p;n("Misc Mapping #2",()=>{d=Tt(r,U_),h=Tt(s,A6),m=jn(r,(v,T)=>{const A=T.GROUP;return Dn(A)&&A!==cn.SKIPPED&&(v[A]=[]),v},{}),p=Tt(s,(v,T)=>({pattern:s[T],longerAlt:c[T],canLineTerminator:f[T],isCustom:d[T],short:h[T],group:a[T],push:l[T],pop:u[T],tokenTypeIdx:o[T],tokenType:r[T]}))});let b=!0,y=[];return t.safeMode||n("First Char Optimization",()=>{y=jn(r,(v,T,A)=>{if(typeof T.PATTERN=="string"){const U=T.PATTERN.charCodeAt(0),S=Yi(U);bf(v,S,p[A])}else if(se(T.START_CHARS_HINT)){let U;Ut(T.START_CHARS_HINT,S=>{const C=typeof S=="string"?S.charCodeAt(0):S,j=Yi(C);U!==j&&(U=j,bf(v,j,p[A]))})}else if(Ai(T.PATTERN))if(T.PATTERN.unicode)b=!1,t.ensureOptimizations&&df(`${ll}	Unable to analyze < ${T.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const U=r6(T.PATTERN,t.ensureOptimizations);ye(U)&&(b=!1),Ut(U,S=>{bf(v,S,p[A])})}else t.ensureOptimizations&&df(`${ll}	TokenType: <${T.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),b=!1;return v},[])}),{emptyGroups:m,patternIdxToConfig:p,charCodeToPatternIdxToConfig:y,hasCustom:i,canBeOptimized:b}}function a6(e,t){let n=[];const r=l6(e);n=n.concat(r.errors);const i=u6(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(c6(s)),n=n.concat(y6(s)),n=n.concat(b6(s,t)),n=n.concat(k6(s)),n}function c6(e){let t=[];const n=_r(e,r=>Ai(r[Es]));return t=t.concat(f6(n)),t=t.concat(m6(n)),t=t.concat(g6(n)),t=t.concat(_6(n)),t=t.concat(d6(n)),t}function l6(e){const t=_r(e,i=>!Mt(i,Es)),n=Tt(t,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:Be.MISSING_PATTERN,tokenTypes:[i]})),r=Zc(e,t);return{errors:n,valid:r}}function u6(e){const t=_r(e,i=>{const s=i[Es];return!Ai(s)&&!xi(s)&&!Mt(s,"exec")&&!Dn(s)}),n=Tt(t,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:Be.INVALID_PATTERN,tokenTypes:[i]})),r=Zc(e,t);return{errors:n,valid:r}}const h6=/[^\\][$]/;function f6(e){class t extends mf{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=_r(e,i=>{const s=i.PATTERN;try{const o=cl(s),a=new t;return a.visit(o),a.found}catch{return h6.test(s.source)}});return Tt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function d6(e){const t=_r(e,r=>r.PATTERN.test(""));return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:Be.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const p6=/[^\\[][\^]|^\^/;function m6(e){class t extends mf{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=_r(e,i=>{const s=i.PATTERN;try{const o=cl(s),a=new t;return a.visit(o),a.found}catch{return p6.test(s.source)}});return Tt(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:Be.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function g6(e){const t=_r(e,r=>{const i=r[Es];return i instanceof RegExp&&(i.multiline||i.global)});return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:Be.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function _6(e){const t=[];let n=Tt(e,s=>jn(e,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Rn(t,a)&&a.PATTERN!==cn.NA&&(t.push(a),o.push(a)),o),[]));n=_a(n);const r=_r(n,s=>s.length>1);return Tt(r,s=>{const o=Tt(s,c=>c.name);return{message:`The same RegExp pattern ->${Cr(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:Be.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function y6(e){const t=_r(e,r=>{if(!Mt(r,"GROUP"))return!1;const i=r.GROUP;return i!==cn.SKIPPED&&i!==cn.NA&&!Dn(i)});return Tt(t,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:Be.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function b6(e,t){const n=_r(e,i=>i.PUSH_MODE!==void 0&&!Rn(t,i.PUSH_MODE));return Tt(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:Be.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function k6(e){const t=[],n=jn(e,(r,i,s)=>{const o=i.PATTERN;return o===cn.NA||(Dn(o)?r.push({str:o,idx:s,tokenType:i}):Ai(o)&&E6(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Ut(e,(r,i)=>{Ut(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&w6(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:c,type:Be.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),t}function w6(e,t){if(Ai(t)){const n=t.exec(e);return n!==null&&n.index===0}else{if(xi(t))return t(e,0,[],{});if(Mt(t,"exec"))return t.exec(e,0,[],{});if(typeof t=="string")return t===e;throw Error("non exhaustive match")}}function E6(e){return po([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>e.source.indexOf(n)!==-1)===void 0}function L_(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function M_(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function x6(e,t,n){const r=[];return Mt(e,wa)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+wa+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Mt(e,hl)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+hl+`> property in its definition
`,type:Be.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Mt(e,hl)&&Mt(e,wa)&&!Mt(e.modes,e.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${wa}: <${e.defaultMode}>which does not exist
`,type:Be.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Mt(e,hl)&&Ut(e.modes,(i,s)=>{Ut(i,(o,a)=>{if(Si(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:Be.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Mt(o,"LONGER_ALT")){const c=se(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Ut(c,l=>{!Si(l)&&!Rn(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:Be.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function v6(e,t,n){const r=[];let i=!1;const s=_a(er(Ve(e.modes))),o=Qc(s,c=>c[Es]===cn.NA),a=B_(n);return t&&Ut(o,c=>{const l=F_(c,a);if(l!==!1){const f={message:R6(c,l),type:l.issue,tokenType:c};r.push(f)}else Mt(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):yf(a,c.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:Be.NO_LINE_BREAKS_FLAGS}),r}function T6(e){const t={},n=mr(e);return Ut(n,r=>{const i=e[r];if(se(i))t[r]=[];else throw Error("non exhaustive match")}),t}function U_(e){const t=e.PATTERN;if(Ai(t))return!1;if(xi(t))return!0;if(Mt(t,"exec"))return!0;if(Dn(t))return!1;throw Error("non exhaustive match")}function A6(e){return Dn(e)&&e.length===1?e.charCodeAt(0):!1}const S6={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function F_(e,t){if(Mt(e,"LINE_BREAKS"))return!1;if(Ai(e.PATTERN)){try{yf(t,e.PATTERN)}catch(n){return{issue:Be.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Dn(e.PATTERN))return!1;if(U_(e))return{issue:Be.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function R6(e,t){if(t.issue===Be.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${e.name}> Token Type
	 Root cause: ${t.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===Be.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${e.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function B_(e){return Tt(e,n=>Dn(n)?n.charCodeAt(0):n)}function bf(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const Ea=256;let fl=[];function Yi(e){return e<Ea?e:fl[e]}function O6(){if(ye(fl)){fl=new Array(65536);for(let e=0;e<65536;e++)fl[e]=e>255?255+~~(e/255):e}}function xa(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}function dl(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let P_=1;const $_={};function va(e){const t=N6(e);I6(t),L6(t),C6(t),Ut(t,n=>{n.isParent=n.categoryMatches.length>0})}function N6(e){let t=mn(e),n=e,r=!0;for(;r;){n=_a(er(Tt(n,s=>s.CATEGORIES)));const i=Zc(n,t);t=t.concat(i),ye(i)?r=!1:n=i}return t}function I6(e){Ut(e,t=>{j_(t)||($_[P_]=t,t.tokenTypeIdx=P_++),z_(t)&&!se(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),z_(t)||(t.CATEGORIES=[]),M6(t)||(t.categoryMatches=[]),U6(t)||(t.categoryMatchesMap={})})}function C6(e){Ut(e,t=>{t.categoryMatches=[],Ut(t.categoryMatchesMap,(n,r)=>{t.categoryMatches.push($_[r].tokenTypeIdx)})})}function L6(e){Ut(e,t=>{D_([],t)})}function D_(e,t){Ut(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),Ut(t.CATEGORIES,n=>{const r=e.concat(t);Rn(r,n)||D_(r,n)})}function j_(e){return Mt(e,"tokenTypeIdx")}function z_(e){return Mt(e,"CATEGORIES")}function M6(e){return Mt(e,"categoryMatches")}function U6(e){return Mt(e,"categoryMatchesMap")}function F6(e){return Mt(e,"tokenTypeIdx")}const B6={buildUnableToPopLexerModeMessage(e){return`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(e,t,n,r,i){return`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`}};var Be;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(Be||(Be={}));const Ta={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:B6,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Ta);let cn=class{constructor(t,n=Ta){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=v_(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=$n({},Ta,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Ta.lineTerminatorsPattern)this.config.lineTerminatorsPattern=S6;else if(this.config.lineTerminatorCharacters===Ta.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),se(t)?i={modes:{defaultMode:mn(t)},defaultMode:wa}:(s=!1,i=mn(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(x6(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(v6(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Ut(i.modes,(a,c)=>{i.modes[c]=Qc(a,l=>Si(l))});const o=mr(i.modes);if(Ut(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(a6(a,o))}),ye(this.lexerDefinitionErrors)){va(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=o6(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=$n({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ye(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Tt(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Ut(this.lexerDefinitionWarning,a=>{x_(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(C_?(this.chopInput=lo,this.match=this.matchWithTest):(this.updateLastIndex=Qe,this.match=this.matchWithExec),s&&(this.handleModes=Qe),this.trackStartLines===!1&&(this.computeNewColumn=lo),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Qe),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=jn(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!ye(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{n6()}),this.TRACE_INIT("toFastProperties",()=>{T_(this)})})}tokenize(t,n=this.defaultMode){if(!ye(this.lexerDefinitionErrors)){const i=Tt(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,l,u,f,d,h,m,p,b,y;const v=t,T=v.length;let A=0,U=0;const S=this.hasCustom?0:Math.floor(t.length/10),C=new Array(S),j=[];let N=this.trackStartLines?1:void 0,W=this.trackStartLines?1:void 0;const q=T6(this.emptyGroups),L=this.trackStartLines,O=this.config.lineTerminatorsPattern;let w=0,I=[],$=[];const B=[],it=[];Object.freeze(it);let Q;function rt(){return I}function z(jt){const Qt=Yi(jt),Dt=$[Qt];return Dt===void 0?it:Dt}const P=jt=>{if(B.length===1&&jt.tokenType.PUSH_MODE===void 0){const Qt=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(jt);j.push({offset:jt.startOffset,line:jt.startLine,column:jt.startColumn,length:jt.image.length,message:Qt})}else{B.pop();const Qt=fo(B);I=this.patternIdxToConfig[Qt],$=this.charCodeToPatternIdxToConfig[Qt],w=I.length;const Dt=this.canModeBeOptimized[Qt]&&this.config.safeMode===!1;$&&Dt?Q=z:Q=rt}};function ft(jt){B.push(jt),$=this.charCodeToPatternIdxToConfig[jt],I=this.patternIdxToConfig[jt],w=I.length,w=I.length;const Qt=this.canModeBeOptimized[jt]&&this.config.safeMode===!1;$&&Qt?Q=z:Q=rt}ft.call(this,n);let lt;const ut=this.config.recoveryEnabled;for(;A<T;){c=null;const jt=v.charCodeAt(A),Qt=Q(jt),Dt=Qt.length;for(r=0;r<Dt;r++){lt=Qt[r];const Pt=lt.pattern;l=null;const le=lt.short;if(le!==!1?jt===le&&(c=Pt):lt.isCustom===!0?(y=Pt.exec(v,A,C,q),y!==null?(c=y[0],y.payload!==void 0&&(l=y.payload)):c=null):(this.updateLastIndex(Pt,A),c=this.match(Pt,t,A)),c!==null){if(a=lt.longerAlt,a!==void 0){const qt=a.length;for(s=0;s<qt;s++){const Ne=I[a[s]],$e=Ne.pattern;if(u=null,Ne.isCustom===!0?(y=$e.exec(v,A,C,q),y!==null?(o=y[0],y.payload!==void 0&&(u=y.payload)):o=null):(this.updateLastIndex($e,A),o=this.match($e,t,A)),o&&o.length>c.length){c=o,l=u,lt=Ne;break}}}break}}if(c!==null){if(f=c.length,d=lt.group,d!==void 0&&(h=lt.tokenTypeIdx,m=this.createTokenInstance(c,A,h,lt.tokenType,N,W,f),this.handlePayload(m,l),d===!1?U=this.addToken(C,U,m):q[d].push(m)),t=this.chopInput(t,f),A=A+f,W=this.computeNewColumn(W,f),L===!0&&lt.canLineTerminator===!0){let Pt=0,le,qt;O.lastIndex=0;do le=O.test(c),le===!0&&(qt=O.lastIndex-1,Pt++);while(le===!0);Pt!==0&&(N=N+Pt,W=f-qt,this.updateTokenEndLineColumnLocation(m,d,qt,Pt,N,W,f))}this.handleModes(lt,P,ft,m)}else{const Pt=A,le=N,qt=W;let Ne=ut===!1;for(;Ne===!1&&A<T;)for(t=this.chopInput(t,1),A++,i=0;i<w;i++){const $e=I[i],x=$e.pattern,ct=$e.short;if(ct!==!1?v.charCodeAt(A)===ct&&(Ne=!0):$e.isCustom===!0?Ne=x.exec(v,A,C,q)!==null:(this.updateLastIndex(x,A),Ne=x.exec(t)!==null),Ne===!0)break}if(p=A-Pt,W=this.computeNewColumn(W,p),b=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(v,Pt,p,le,qt),j.push({offset:Pt,line:le,column:qt,length:p,message:b}),ut===!1)break}}return this.hasCustom||(C.length=U),{tokens:C,groups:q,errors:j}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(t.endLine=s+l,t.endColumn=o-1+-l))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,n++,n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}};cn.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",cn.NA=/NOT_APPLICABLE/;function Aa(e){return W_(e)?e.LABEL:e.name}function W_(e){return Dn(e.LABEL)&&e.LABEL!==""}const P6="parent",G_="categories",K_="label",H_="group",Y_="push_mode",V_="pop_mode",X_="longer_alt",q_="line_breaks",J_="start_chars_hint";function nr(e){return $6(e)}function $6(e){const t=e.pattern,n={};if(n.name=e.name,Si(t)||(n.PATTERN=t),Mt(e,P6))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Mt(e,G_)&&(n.CATEGORIES=e[G_]),va([n]),Mt(e,K_)&&(n.LABEL=e[K_]),Mt(e,H_)&&(n.GROUP=e[H_]),Mt(e,V_)&&(n.POP_MODE=e[V_]),Mt(e,Y_)&&(n.PUSH_MODE=e[Y_]),Mt(e,X_)&&(n.LONGER_ALT=e[X_]),Mt(e,q_)&&(n.LINE_BREAKS=e[q_]),Mt(e,J_)&&(n.START_CHARS_HINT=e[J_]),n}const xs=nr({name:"EOF",pattern:cn.NA});va([xs]);function pl(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}function D6(e,t){return xa(e,t)}const Z_={buildMismatchTokenMessage({expected:e,actual:t,previous:n,ruleName:r}){return`Expecting ${W_(e)?`--> ${Aa(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:e,ruleName:t}){return"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+Cr(t).image+"'";if(r)return s+r+a;{const c=jn(e,(d,h)=>d.concat(h),[]),l=Tt(c,d=>`[${Tt(d,h=>Aa(h)).join(", ")}]`),f=`one of these possible Token sequences:
${Tt(l,(d,h)=>`  ${h+1}. ${d}`).join(`
`)}`;return s+f+a}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+Cr(t).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Tt(e,l=>`[${Tt(l,u=>Aa(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(Z_);const j6={buildRuleNotFoundError(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"}},vs={buildDuplicateFoundError(e,t){function n(u){return u instanceof Me?u.terminalType.name:u instanceof zn?u.nonTerminalName:""}const r=e.name,i=Cr(t),s=i.idx,o=oi(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(e){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(e){const t=Tt(e.prefixPath,i=>Aa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=Tt(e.prefixPath,i=>Aa(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=oi(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(e){return"deprecated"},buildEmptyAlternationError(e){return`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(e){return`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(e){const t=e.topLevelRule.name,n=Tt(e.leftRecursionPath,s=>s.name),r=`${t} --> ${n.concat([t]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(e){return"deprecated"},buildDuplicateRuleNameError(e){let t;return e.topLevelRule instanceof mo?t=e.topLevelRule.name:t=e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};function z6(e,t){const n=new W6(e,t);return n.resolveRefs(),n.errors}class W6 extends ws{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){Ut(Ve(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:On.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class G6 extends rl{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=mn(this.path.ruleStack).reverse(),this.occurrenceStack=mn(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){ye(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class K6 extends G6{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new Wn({definition:i});this.possibleTokTypes=ba(s),this.found=!0}}}class ml extends rl{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class H6 extends ml{walkMany(t,n,r){if(t.idx===this.occurrence){const i=Cr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class Q_ extends ml{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=Cr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class Y6 extends ml{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=Cr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class ty extends ml{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=Cr(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Me&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function kf(e,t,n=[]){n=mn(n);let r=[],i=0;function s(a){return a.concat(gn(e,i+1))}function o(a){const c=kf(s(a),t,n);return r.concat(c)}for(;n.length<t&&i<e.length;){const a=e[i];if(a instanceof Wn)return o(a.definition);if(a instanceof zn)return o(a.definition);if(a instanceof Gn)r=o(a.definition);else if(a instanceof ii){const c=a.definition.concat([new tn({definition:a.definition})]);return o(c)}else if(a instanceof si){const c=[new Wn({definition:a.definition}),new tn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Mr){const c=a.definition.concat([new tn({definition:[new Me({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof tn){const c=a.definition.concat([new tn({definition:a.definition})]);r=o(c)}else{if(a instanceof Ur)return Ut(a.definition,c=>{ye(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Me)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:gn(e,i)}),r}function ey(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,l=c-r-1,u=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!ye(f);){const d=f.pop();if(d===o){a&&fo(f).idx<=l&&f.pop();continue}const h=d.def,m=d.idx,p=d.ruleStack,b=d.occurrenceStack;if(ye(h))continue;const y=h[0];if(y===i){const v={idx:m,def:gn(h),ruleStack:ya(p),occurrenceStack:ya(b)};f.push(v)}else if(y instanceof Me)if(m<c-1){const v=m+1,T=t[v];if(n(T,y.terminalType)){const A={idx:v,def:gn(h),ruleStack:p,occurrenceStack:b};f.push(A)}}else if(m===c-1)u.push({nextTokenType:y.terminalType,nextTokenOccurrence:y.idx,ruleStack:p,occurrenceStack:b}),a=!0;else throw Error("non exhaustive match");else if(y instanceof zn){const v=mn(p);v.push(y.nonTerminalName);const T=mn(b);T.push(y.idx);const A={idx:m,def:y.definition.concat(s,gn(h)),ruleStack:v,occurrenceStack:T};f.push(A)}else if(y instanceof Gn){const v={idx:m,def:gn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T={idx:m,def:y.definition.concat(gn(h)),ruleStack:p,occurrenceStack:b};f.push(T)}else if(y instanceof ii){const v=new tn({definition:y.definition,idx:y.idx}),T=y.definition.concat([v],gn(h)),A={idx:m,def:T,ruleStack:p,occurrenceStack:b};f.push(A)}else if(y instanceof si){const v=new Me({terminalType:y.separator}),T=new tn({definition:[v].concat(y.definition),idx:y.idx}),A=y.definition.concat([T],gn(h)),U={idx:m,def:A,ruleStack:p,occurrenceStack:b};f.push(U)}else if(y instanceof Mr){const v={idx:m,def:gn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T=new Me({terminalType:y.separator}),A=new tn({definition:[T].concat(y.definition),idx:y.idx}),U=y.definition.concat([A],gn(h)),S={idx:m,def:U,ruleStack:p,occurrenceStack:b};f.push(S)}else if(y instanceof tn){const v={idx:m,def:gn(h),ruleStack:p,occurrenceStack:b};f.push(v),f.push(o);const T=new tn({definition:y.definition,idx:y.idx}),A=y.definition.concat([T],gn(h)),U={idx:m,def:A,ruleStack:p,occurrenceStack:b};f.push(U)}else if(y instanceof Ur)for(let v=y.definition.length-1;v>=0;v--){const T=y.definition[v],A={idx:m,def:T.definition.concat(gn(h)),ruleStack:p,occurrenceStack:b};f.push(A),f.push(o)}else if(y instanceof Wn)f.push({idx:m,def:y.definition.concat(gn(h)),ruleStack:p,occurrenceStack:b});else if(y instanceof mo)f.push(V6(y,m,p,b));else throw Error("non exhaustive match")}return u}function V6(e,t,n,r){const i=mn(n);i.push(e.name);const s=mn(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var Pe;(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(Pe||(Pe={}));function ny(e){if(e instanceof Gn||e==="Option")return Pe.OPTION;if(e instanceof tn||e==="Repetition")return Pe.REPETITION;if(e instanceof ii||e==="RepetitionMandatory")return Pe.REPETITION_MANDATORY;if(e instanceof si||e==="RepetitionMandatoryWithSeparator")return Pe.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Mr||e==="RepetitionWithSeparator")return Pe.REPETITION_WITH_SEPARATOR;if(e instanceof Ur||e==="Alternation")return Pe.ALTERNATION;throw Error("non exhaustive match")}function X6(e,t,n,r,i,s){const o=Ef(e,t,n),a=oy(o)?dl:xa;return s(o,r,a,i)}function q6(e,t,n,r,i,s){const o=xf(e,t,i,n),a=oy(o)?dl:xa;return s(o[0],a,r)}function J6(e,t,n,r){const i=e.length,s=Ir(e,o=>Ir(o,a=>a.length===1));if(t)return function(o){const a=Tt(o,c=>c.GATE);for(let c=0;c<i;c++){const l=e[c],u=l.length,f=a[c];if(!(f!==void 0&&f.call(this)===!1))t:for(let d=0;d<u;d++){const h=l[d],m=h.length;for(let p=0;p<m;p++){const b=this.LA(p+1);if(n(b,h[p])===!1)continue t}return c}}};if(s&&!r){const o=Tt(e,c=>er(c)),a=jn(o,(c,l,u)=>(Ut(l,f=>{Mt(c,f.tokenTypeIdx)||(c[f.tokenTypeIdx]=u),Ut(f.categoryMatches,d=>{Mt(c,d)||(c[d]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;t:for(let l=0;l<c;l++){const u=a[l],f=u.length;for(let d=0;d<f;d++){const h=this.LA(d+1);if(n(h,u[d])===!1)continue t}return o}}}}function Z6(e,t,n){const r=Ir(e,s=>s.length===1),i=e.length;if(r&&!n){const s=er(e);if(s.length===1&&ye(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=jn(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Ut(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){t:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(t(l,o[c])===!1)continue t}return!0}return!1}}class Q6 extends rl{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(t,n,r){this.checkIsTarget(t,Pe.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,Pe.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class ry extends ws{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||t===this.targetRef)&&(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,Pe.OPTION)}visitRepetition(t){this.checkIsTarget(t,Pe.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,Pe.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,Pe.ALTERNATION)}}function iy(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function wf(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function tM(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++){const o=t[s];if(i[o]===!0)return!1}}return!0}function sy(e,t){const n=Tt(e,o=>kf([o],1)),r=iy(n.length),i=Tt(n,o=>{const a={};return Ut(o,c=>{const l=wf(c.partialPath);Ut(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=iy(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const f=l[u].partialPath,d=l[u].suffixDef,h=wf(f);if(tM(i,h,c)||ye(d)||f.length===t){const p=r[c];if(vf(p,f)===!1){p.push(f);for(let b=0;b<h.length;b++){const y=h[b];i[c][y]=!0}}}else{const p=kf(d,o+1,f);s[c]=s[c].concat(p),Ut(p,b=>{const y=wf(b.partialPath);Ut(y,v=>{i[c][v]=!0})})}}}}return r}function Ef(e,t,n,r){const i=new ry(e,Pe.ALTERNATION,r);return t.accept(i),sy(i.result,n)}function xf(e,t,n,r){const i=new ry(e,n);t.accept(i);const s=i.result,a=new Q6(t,e,n).startWalking(),c=new Wn({definition:s}),l=new Wn({definition:a});return sy([c,l],r)}function vf(e,t){t:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue t}return!0}}return!1}function eM(e,t){return e.length<t.length&&Ir(e,(n,r)=>{const i=t[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function oy(e){return Ir(e,t=>Ir(t,n=>Ir(n,r=>ye(r.categoryMatches))))}function nM(e){const t=e.lookaheadStrategy.validate({rules:e.rules,tokenTypes:e.tokenTypes,grammarName:e.grammarName});return Tt(t,n=>Object.assign({type:On.CUSTOM_LOOKAHEAD_VALIDATION},n))}function rM(e,t,n,r){const i=yr(e,c=>iM(c,n)),s=gM(e,t,n),o=yr(e,c=>fM(c,n)),a=yr(e,c=>aM(c,e,r,n));return i.concat(s,o,a)}function iM(e,t){const n=new oM;e.accept(n);const r=n.allProductions,i=k_(r,sM),s=Lr(i,a=>a.length>1);return Tt(Ve(s),a=>{const c=Cr(a),l=t.buildDuplicateFoundError(e,a),u=oi(c),f={message:l,type:On.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:c.idx},d=ay(c);return d&&(f.parameter=d),f})}function sM(e){return`${oi(e)}_#_${e.idx}_#_${ay(e)}`}function ay(e){return e instanceof Me?e.terminalType.name:e instanceof zn?e.nonTerminalName:""}class oM extends ws{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function aM(e,t,n,r){const i=[];if(jn(t,(o,a)=>a.name===e.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});i.push({message:o,type:On.DUPLICATE_RULE_NAME,ruleName:e.name})}return i}function cM(e,t,n){const r=[];let i;return Rn(t,e)||(i=`Invalid rule override, rule: ->${e}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:On.INVALID_RULE_OVERRIDE,ruleName:e})),r}function cy(e,t,n,r=[]){const i=[],s=gl(t.definition);if(ye(s))return[];{const o=e.name;Rn(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:On.LEFT_RECURSION,ruleName:o});const c=Zc(s,r.concat([e])),l=yr(c,u=>{const f=mn(r);return f.push(u),cy(e,u,n,f)});return i.concat(l)}}function gl(e){let t=[];if(ye(e))return t;const n=Cr(e);if(n instanceof zn)t.push(n.referencedRule);else if(n instanceof Wn||n instanceof Gn||n instanceof ii||n instanceof si||n instanceof Mr||n instanceof tn)t=t.concat(gl(n.definition));else if(n instanceof Ur)t=er(Tt(n.definition,s=>gl(s.definition)));else if(!(n instanceof Me))throw Error("non exhaustive match");const r=nl(n),i=e.length>1;if(r&&i){const s=gn(e);return t.concat(gl(s))}else return t}class Tf extends ws{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function lM(e,t){const n=new Tf;e.accept(n);const r=n.alternations;return yr(r,s=>{const o=ya(s.definition);return yr(o,(a,c)=>{const l=ey([a],[],xa,1);return ye(l)?[{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:s,emptyChoiceIdx:c}),type:On.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:s.idx,alternative:c+1}]:[]})})}function uM(e,t,n){const r=new Tf;e.accept(r);let i=r.alternations;return i=Qc(i,o=>o.ignoreAmbiguities===!0),yr(i,o=>{const a=o.idx,c=o.maxLookahead||t,l=Ef(a,e,c,o),u=pM(l,o,e,n),f=mM(l,o,e,n);return u.concat(f)})}class hM extends ws{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function fM(e,t){const n=new Tf;e.accept(n);const r=n.alternations;return yr(r,s=>s.definition.length>255?[{message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:s}),type:On.TOO_MANY_ALTS,ruleName:e.name,occurrence:s.idx}]:[])}function dM(e,t,n){const r=[];return Ut(e,i=>{const s=new hM;i.accept(s);const o=s.allProductions;Ut(o,a=>{const c=ny(a),l=a.maxLookahead||t,u=a.idx,d=xf(u,i,c,l)[0];if(ye(er(d))){const h=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:h,type:On.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function pM(e,t,n,r){const i=[],s=jn(e,(a,c,l)=>(t.definition[l].ignoreAmbiguities===!0||Ut(c,u=>{const f=[l];Ut(e,(d,h)=>{l!==h&&vf(d,u)&&t.definition[h].ignoreAmbiguities!==!0&&f.push(h)}),f.length>1&&!vf(i,u)&&(i.push(u),a.push({alts:f,path:u}))}),a),[]);return Tt(s,a=>{const c=Tt(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:c,prefixPath:a.path}),type:On.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:a.alts}})}function mM(e,t,n,r){const i=jn(e,(o,a,c)=>{const l=Tt(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return _a(yr(i,o=>{if(t.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=_r(i,d=>t.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<c&&eM(d.path,l));return Tt(u,d=>{const h=[d.idx+1,c+1],m=t.idx===0?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:h,prefixPath:d.path}),type:On.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:m,alternatives:h}})}))}function gM(e,t,n){const r=[],i=Tt(t,s=>s.name);return Ut(e,s=>{const o=s.name;if(Rn(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:On.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function _M(e){const t=hf(e,{errMsgProvider:j6}),n={};return Ut(e.rules,r=>{n[r.name]=r}),z6(n,t.errMsgProvider)}function yM(e){return e=hf(e,{errMsgProvider:vs}),rM(e.rules,e.tokenTypes,e.errMsgProvider,e.grammarName)}const ly="MismatchedTokenException",uy="NoViableAltException",hy="EarlyExitException",fy="NotAllInputParsedException",dy=[ly,uy,hy,fy];Object.freeze(dy);function _l(e){return Rn(dy,e.name)}class yl extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class py extends yl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=ly}}class bM extends yl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=uy}}class kM extends yl{constructor(t,n){super(t,n),this.name=fy}}class wM extends yl{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=hy}}const Af={},my="InRuleRecoveryException";class EM extends Error{constructor(t){super(t),this.name=my}}class xM{initRecoverable(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Mt(t,"recoveryEnabled")?t.recoveryEnabled:Ri.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=vM)}getTokenToInsert(t){const n=pl(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(t){return!0}canTokenTypeBeDeletedInRecovery(t){return!0}tryInRepetitionRecovery(t,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const f=()=>{const d=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:d,ruleName:this.getCurrRuleFullName()}),m=new py(h,l,this.LA(0));m.resyncedTokens=ya(a),this.SAVE_ERROR(m)};for(;!c;)if(this.tokenMatcher(u,i)){f();return}else if(r.call(this)){f(),t.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(t,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),t)||this.isBackTracking()||this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,n)))}getFollowsForInRuleRecovery(t,n){const r=this.getCurrentGrammarPath(t,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(t,n){if(this.canRecoverWithSingleTokenInsertion(t,n))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new EM("sad sad panda")}canPerformInRuleRecovery(t,n){return this.canRecoverWithSingleTokenInsertion(t,n)||this.canRecoverWithSingleTokenDeletion(t)}canRecoverWithSingleTokenInsertion(t,n){if(!this.canTokenTypeBeInsertedInRecovery(t)||ye(n))return!1;const r=this.LA(1);return po(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(t){return this.canTokenTypeBeDeletedInRecovery(t)?this.tokenMatcher(this.LA(2),t):!1}isInCurrentRuleReSyncSet(t){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Rn(r,t)}findReSyncTokenType(){const t=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=po(t,s=>D6(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Af;const t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const t=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Tt(t,(r,i)=>i===0?Af:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(t[i-1])})}flattenFollowSet(){const t=Tt(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return er(t)}getFollowSetFromFollowKey(t){if(t===Af)return[xs];const n=t.ruleName+t.idxInCallingRule+S_+t.inRule;return this.resyncFollows[n]}addToResyncTokens(t,n){return this.tokenMatcher(t,xs)||n.push(t),n}reSyncTo(t){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,t)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return ya(n)}attemptInRepetitionRecovery(t,n,r,i,s,o,a){}getCurrentGrammarPath(t,n){const r=this.getHumanReadableRuleStack(),i=mn(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:t,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Tt(this.RULE_STACK,t=>this.shortRuleNameToFullName(t))}}function vM(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const d=this.getCurrRuleFullName(),h=this.getGAstProductions()[d];c=new s(h,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&l===void 0&&(l=xs,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(e,t,n,l)}const TM=4,Vi=8,gy=1<<Vi,_y=2<<Vi,Sf=3<<Vi,Rf=4<<Vi,Of=5<<Vi,bl=6<<Vi;function Nf(e,t,n){return n|t|e}class AM{constructor(t){var n;this.maxLookahead=(n=t==null?void 0:t.maxLookahead)!==null&&n!==void 0?n:Ri.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(ye(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return yr(t,n=>cy(n,n,vs))}validateEmptyOrAlternatives(t){return yr(t,n=>lM(n,vs))}validateAmbiguousAlternationAlternatives(t,n){return yr(t,r=>uM(r,n,vs))}validateSomeNonEmptyLookaheadPath(t,n){return dM(t,n,vs)}buildLookaheadForAlternation(t){return X6(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,J6)}buildLookaheadForOptional(t){return q6(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,ny(t.prodType),Z6)}}class SM{initLooksAhead(t){this.dynamicTokensEnabled=Mt(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ri.dynamicTokensEnabled,this.maxLookahead=Mt(t,"maxLookahead")?t.maxLookahead:Ri.maxLookahead,this.lookaheadStrategy=Mt(t,"lookaheadStrategy")?t.lookaheadStrategy:new AM({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(t){Ut(t,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=OM(n);Ut(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${oi(l)}${u}`,()=>{const f=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),d=Nf(this.fullRuleNameToShort[n.name],gy,l.idx);this.setLaFuncCache(d,f)})}),Ut(i,l=>{this.computeLookaheadFunc(n,l.idx,Sf,"Repetition",l.maxLookahead,oi(l))}),Ut(s,l=>{this.computeLookaheadFunc(n,l.idx,_y,"Option",l.maxLookahead,oi(l))}),Ut(o,l=>{this.computeLookaheadFunc(n,l.idx,Rf,"RepetitionMandatory",l.maxLookahead,oi(l))}),Ut(a,l=>{this.computeLookaheadFunc(n,l.idx,bl,"RepetitionMandatoryWithSeparator",l.maxLookahead,oi(l))}),Ut(c,l=>{this.computeLookaheadFunc(n,l.idx,Of,"RepetitionWithSeparator",l.maxLookahead,oi(l))})})})}computeLookaheadFunc(t,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:t,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=Nf(this.fullRuleNameToShort[t.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(t,n){const r=this.getLastExplicitRuleShortName();return Nf(r,t,n)}getLaFuncFromCache(t){return this.lookAheadFuncsCache.get(t)}setLaFuncCache(t,n){this.lookAheadFuncsCache.set(t,n)}}class RM extends ws{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(t){this.dslMethods.option.push(t)}visitRepetitionWithSeparator(t){this.dslMethods.repetitionWithSeparator.push(t)}visitRepetitionMandatory(t){this.dslMethods.repetitionMandatory.push(t)}visitRepetitionMandatoryWithSeparator(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)}visitRepetition(t){this.dslMethods.repetition.push(t)}visitAlternation(t){this.dslMethods.alternation.push(t)}}const kl=new RM;function OM(e){kl.reset(),e.accept(kl);const t=kl.dslMethods;return kl.reset(),t}function yy(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function by(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function NM(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}function IM(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}const CM="name";function ky(e,t){Object.defineProperty(e,CM,{enumerable:!1,configurable:!0,writable:!1,value:t})}function LM(e,t){const n=mr(e),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=e[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,t)}}}function MM(e,t){const n=function(){};ky(n,e+"BaseSemantics");const r={visit:function(i,s){if(se(i)&&(i=i[0]),!Si(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=FM(this,t);if(!ye(i)){const s=Tt(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=t,n}function UM(e,t,n){const r=function(){};ky(r,e+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return Ut(t,s=>{i[s]=LM}),r.prototype=i,r.prototype.constructor=r,r}var If;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(If||(If={}));function FM(e,t){return BM(e,t)}function BM(e,t){const n=_r(t,i=>xi(e[i])===!1),r=Tt(n,i=>({msg:`Missing visitor method: <${i}> on ${e.constructor.name} CST Visitor.`,type:If.MISSING_METHOD,methodName:i}));return _a(r)}class PM{initTreeBuilder(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Mt(t,"nodeLocationTracking")?t.nodeLocationTracking:Ri.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Qe,this.cstFinallyStateUpdate=Qe,this.cstPostTerminal=Qe,this.cstPostNonTerminal=Qe,this.cstPostRule=Qe;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=by,this.setNodeLocationFromNode=by,this.cstPostRule=Qe,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=yy,this.setNodeLocationFromNode=yy,this.cstPostRule=Qe,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Qe,this.setNodeLocationFromNode=Qe,this.cstPostRule=Qe,this.setInitialNodeLocation=Qe;else throw Error(`Invalid <nodeLocationTracking> config option: "${t.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(t){t.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(t){const n=this.LA(1);t.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(t){const n={name:t,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(t){const n=this.LA(0),r=t.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];NM(r,n,t),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(t,n){const r=this.CST_STACK[this.CST_STACK.length-1];IM(r,n,t),this.setNodeLocationFromNode(r.location,t.location)}getBaseCstVisitorConstructor(){if(Si(this.baseCstVisitorConstructor)){const t=MM(this.className,mr(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Si(this.baseCstVisitorWithDefaultsConstructor)){const t=UM(this.className,mr(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-1]}getPreviousExplicitRuleShortName(){const t=this.RULE_STACK;return t[t.length-2]}getLastExplicitRuleOccurrenceIndex(){const t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]}}class $M{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(t){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):xl}LA(t){const n=this.currIdx+t;return n<0||this.tokVectorLength<=n?xl:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(t){this.currIdx=t}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class DM{ACTION(t){return t.call(this)}consume(t,n,r){return this.consumeInternal(n,t,r)}subrule(t,n,r){return this.subruleInternal(n,t,r)}option(t,n){return this.optionInternal(n,t)}or(t,n){return this.orInternal(n,t)}many(t,n){return this.manyInternal(t,n)}atLeastOne(t,n){return this.atLeastOneInternal(t,n)}CONSUME(t,n){return this.consumeInternal(t,0,n)}CONSUME1(t,n){return this.consumeInternal(t,1,n)}CONSUME2(t,n){return this.consumeInternal(t,2,n)}CONSUME3(t,n){return this.consumeInternal(t,3,n)}CONSUME4(t,n){return this.consumeInternal(t,4,n)}CONSUME5(t,n){return this.consumeInternal(t,5,n)}CONSUME6(t,n){return this.consumeInternal(t,6,n)}CONSUME7(t,n){return this.consumeInternal(t,7,n)}CONSUME8(t,n){return this.consumeInternal(t,8,n)}CONSUME9(t,n){return this.consumeInternal(t,9,n)}SUBRULE(t,n){return this.subruleInternal(t,0,n)}SUBRULE1(t,n){return this.subruleInternal(t,1,n)}SUBRULE2(t,n){return this.subruleInternal(t,2,n)}SUBRULE3(t,n){return this.subruleInternal(t,3,n)}SUBRULE4(t,n){return this.subruleInternal(t,4,n)}SUBRULE5(t,n){return this.subruleInternal(t,5,n)}SUBRULE6(t,n){return this.subruleInternal(t,6,n)}SUBRULE7(t,n){return this.subruleInternal(t,7,n)}SUBRULE8(t,n){return this.subruleInternal(t,8,n)}SUBRULE9(t,n){return this.subruleInternal(t,9,n)}OPTION(t){return this.optionInternal(t,0)}OPTION1(t){return this.optionInternal(t,1)}OPTION2(t){return this.optionInternal(t,2)}OPTION3(t){return this.optionInternal(t,3)}OPTION4(t){return this.optionInternal(t,4)}OPTION5(t){return this.optionInternal(t,5)}OPTION6(t){return this.optionInternal(t,6)}OPTION7(t){return this.optionInternal(t,7)}OPTION8(t){return this.optionInternal(t,8)}OPTION9(t){return this.optionInternal(t,9)}OR(t){return this.orInternal(t,0)}OR1(t){return this.orInternal(t,1)}OR2(t){return this.orInternal(t,2)}OR3(t){return this.orInternal(t,3)}OR4(t){return this.orInternal(t,4)}OR5(t){return this.orInternal(t,5)}OR6(t){return this.orInternal(t,6)}OR7(t){return this.orInternal(t,7)}OR8(t){return this.orInternal(t,8)}OR9(t){return this.orInternal(t,9)}MANY(t){this.manyInternal(0,t)}MANY1(t){this.manyInternal(1,t)}MANY2(t){this.manyInternal(2,t)}MANY3(t){this.manyInternal(3,t)}MANY4(t){this.manyInternal(4,t)}MANY5(t){this.manyInternal(5,t)}MANY6(t){this.manyInternal(6,t)}MANY7(t){this.manyInternal(7,t)}MANY8(t){this.manyInternal(8,t)}MANY9(t){this.manyInternal(9,t)}MANY_SEP(t){this.manySepFirstInternal(0,t)}MANY_SEP1(t){this.manySepFirstInternal(1,t)}MANY_SEP2(t){this.manySepFirstInternal(2,t)}MANY_SEP3(t){this.manySepFirstInternal(3,t)}MANY_SEP4(t){this.manySepFirstInternal(4,t)}MANY_SEP5(t){this.manySepFirstInternal(5,t)}MANY_SEP6(t){this.manySepFirstInternal(6,t)}MANY_SEP7(t){this.manySepFirstInternal(7,t)}MANY_SEP8(t){this.manySepFirstInternal(8,t)}MANY_SEP9(t){this.manySepFirstInternal(9,t)}AT_LEAST_ONE(t){this.atLeastOneInternal(0,t)}AT_LEAST_ONE1(t){return this.atLeastOneInternal(1,t)}AT_LEAST_ONE2(t){this.atLeastOneInternal(2,t)}AT_LEAST_ONE3(t){this.atLeastOneInternal(3,t)}AT_LEAST_ONE4(t){this.atLeastOneInternal(4,t)}AT_LEAST_ONE5(t){this.atLeastOneInternal(5,t)}AT_LEAST_ONE6(t){this.atLeastOneInternal(6,t)}AT_LEAST_ONE7(t){this.atLeastOneInternal(7,t)}AT_LEAST_ONE8(t){this.atLeastOneInternal(8,t)}AT_LEAST_ONE9(t){this.atLeastOneInternal(9,t)}AT_LEAST_ONE_SEP(t){this.atLeastOneSepFirstInternal(0,t)}AT_LEAST_ONE_SEP1(t){this.atLeastOneSepFirstInternal(1,t)}AT_LEAST_ONE_SEP2(t){this.atLeastOneSepFirstInternal(2,t)}AT_LEAST_ONE_SEP3(t){this.atLeastOneSepFirstInternal(3,t)}AT_LEAST_ONE_SEP4(t){this.atLeastOneSepFirstInternal(4,t)}AT_LEAST_ONE_SEP5(t){this.atLeastOneSepFirstInternal(5,t)}AT_LEAST_ONE_SEP6(t){this.atLeastOneSepFirstInternal(6,t)}AT_LEAST_ONE_SEP7(t){this.atLeastOneSepFirstInternal(7,t)}AT_LEAST_ONE_SEP8(t){this.atLeastOneSepFirstInternal(8,t)}AT_LEAST_ONE_SEP9(t){this.atLeastOneSepFirstInternal(9,t)}RULE(t,n,r=vl){if(Rn(this.definedRulesNames,t)){const o={message:vs.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:On.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(o)}this.definedRulesNames.push(t);const i=this.defineRule(t,n,r);return this[t]=i,i}OVERRIDE_RULE(t,n,r=vl){const i=cM(t,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(t,n,r);return this[t]=s,s}BACKTRACK(t,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return t.apply(this,n),!0}catch(i){if(_l(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return zL(Ve(this.gastProductionsCache))}}class jM{initRecognizerEngine(t,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=dl,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Mt(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(se(t)){if(ye(t))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof t[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(se(t))this.tokensMap=jn(t,(s,o)=>(s[o.name]=o,s),{});else if(Mt(t,"modes")&&Ir(er(Ve(t.modes)),F6)){const s=er(Ve(t.modes)),o=tl(s);this.tokensMap=jn(o,(a,c)=>(a[c.name]=c,a),{})}else if(pr(t))this.tokensMap=mn(t);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=xs;const r=Mt(t,"modes")?er(Ve(t.modes)):Ve(t),i=Ir(r,s=>ye(s.categoryMatches));this.tokenMatcher=i?dl:xa,va(Ve(this.tokensMap))}defineRule(t,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${t}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Mt(r,"resyncEnabled")?r.resyncEnabled:vl.resyncEnabled,s=Mt(r,"recoveryValueFunc")?r.recoveryValueFunc:vl.recoveryValueFunc,o=this.ruleShortNameIdx<<TM+Vi;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=t,this.fullRuleNameToShort[t]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u);const f=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(f),f}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,t,this.subruleIdx),n.apply(this,u)}catch(f){return this.invokeRuleCatch(f,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:t,originalGrammarAction:n})}invokeRuleCatch(t,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(_l(t)){const o=t;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(t);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(t);throw o}}else throw t}optionInternal(t,n){const r=this.getKeyForAutomaticLookahead(_y,n);return this.optionInternalLogic(t,n,r)}optionInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(t,n){const r=this.getKeyForAutomaticLookahead(Rf,t);return this.atLeastOneInternalLogic(t,n,r)}atLeastOneInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,n],i,Rf,t,Y6)}atLeastOneSepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(bl,t);this.atLeastOneSepFirstInternalLogic(t,n,r)}atLeastOneSepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,ty],a,bl,t,ty)}else throw this.raiseEarlyExitException(t,Pe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(t,n){const r=this.getKeyForAutomaticLookahead(Sf,t);return this.manyInternalLogic(t,n,r)}manyInternalLogic(t,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[t,n],i,Sf,t,H6,o)}manySepFirstInternal(t,n){const r=this.getKeyForAutomaticLookahead(Of,t);this.manySepFirstInternalLogic(t,n,r)}manySepFirstInternalLogic(t,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,s,a,i,Q_],a,Of,t,Q_)}}repetitionSepSecondInternal(t,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,n,r,i,s],r,bl,t,s)}doSingleRepetition(t){const n=this.getLexerPosition();return t.call(this),this.getLexerPosition()>n}orInternal(t,n){const r=this.getKeyForAutomaticLookahead(gy,n),i=se(t)?t:t.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,t.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const t=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new kM(n,t))}}subruleInternal(t,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=t.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:t.ruleName),i}catch(s){throw this.subruleInternalError(s,r,t.ruleName)}}subruleInternalError(t,n,r){throw _l(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete t.partialCstResult),t}consumeInternal(t,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,t)===!0?(this.consumeToken(),i=s):this.consumeInternalError(t,s,r)}catch(s){i=this.consumeInternalRecovery(t,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:t.name,i),i}consumeInternalError(t,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new py(i,n,s))}consumeInternalRecovery(t,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(t,n);try{return this.tryInRuleRecovery(t,i)}catch(s){throw s.name===my?r:s}}else throw r}saveRecogState(){const t=this.errors,n=mn(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK}ruleInvocationStateUpdate(t,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]}shortRuleNameToFullName(t){return this.shortRuleNameToFull[t]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),xs)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class zM{initErrorHandler(t){this._errors=[],this.errorMessageProvider=Mt(t,"errorMessageProvider")?t.errorMessageProvider:Ri.errorMessageProvider}SAVE_ERROR(t){if(_l(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:mn(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return mn(this._errors)}set errors(t){this._errors=t}raiseEarlyExitException(t,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=xf(t,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new wM(l,this.LA(1),this.LA(0)))}raiseNoAltException(t,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Ef(t,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new bM(c,this.LA(1),a))}}class WM{initContentAssist(){}computeContentAssist(t,n){const r=this.gastProductionsCache[t];if(Si(r))throw Error(`Rule ->${t}<- does not exist in this grammar.`);return ey([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(t){const n=Cr(t.ruleStack),i=this.getGAstProductions()[n];return new K6(i,t).startWalking()}}const wl={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(wl);const wy=!0,Ey=Math.pow(2,Vi)-1,xy=nr({name:"RECORDING_PHASE_TOKEN",pattern:cn.NA});va([xy]);const vy=pl(xy,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(vy);const GM={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class KM{initGastRecorder(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let t=0;t<10;t++){const n=t>0?t:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,t,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,t,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,t)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,t)},this[`MANY${n}`]=function(r){this.manyInternalRecord(t,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(t,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(t,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(t,r)}}this.consume=function(t,n,r){return this.consumeInternalRecord(n,t,r)},this.subrule=function(t,n,r){return this.subruleInternalRecord(n,t,r)},this.option=function(t,n){return this.optionInternalRecord(n,t)},this.or=function(t,n){return this.orInternalRecord(n,t)},this.many=function(t,n){this.manyInternalRecord(t,n)},this.atLeastOne=function(t,n){this.atLeastOneInternalRecord(t,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const t=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete t[`CONSUME${r}`],delete t[`SUBRULE${r}`],delete t[`OPTION${r}`],delete t[`OR${r}`],delete t[`MANY${r}`],delete t[`MANY_SEP${r}`],delete t[`AT_LEAST_ONE${r}`],delete t[`AT_LEAST_ONE_SEP${r}`]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA})}ACTION_RECORD(t){}BACKTRACK_RECORD(t,n){return()=>!0}LA_RECORD(t){return xl}topLevelRuleRecord(t,n){try{const r=new mo({definition:[],name:t});return r.name=t,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(t,n){return Sa.call(this,Gn,t,n)}atLeastOneInternalRecord(t,n){Sa.call(this,ii,n,t)}atLeastOneSepFirstInternalRecord(t,n){Sa.call(this,si,n,t,wy)}manyInternalRecord(t,n){Sa.call(this,tn,n,t)}manySepFirstInternalRecord(t,n){Sa.call(this,Mr,n,t,wy)}orInternalRecord(t,n){return HM.call(this,t,n)}subruleInternalRecord(t,n,r){if(El(n),!t||Mt(t,"ruleName")===!1){const a=new Error(`<SUBRULE${Ty(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=fo(this.recordingProdStack),s=t.ruleName,o=new zn({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?GM:wl}consumeInternalRecord(t,n,r){if(El(n),!j_(t)){const o=new Error(`<CONSUME${Ty(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(t)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=fo(this.recordingProdStack),s=new Me({idx:n,terminalType:t,label:r==null?void 0:r.LABEL});return i.definition.push(s),vy}}function Sa(e,t,n,r=!1){El(n);const i=fo(this.recordingProdStack),s=xi(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),Mt(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),wl}function HM(e,t){El(t);const n=fo(this.recordingProdStack),r=se(e)===!1,i=r===!1?e:e.DEF,s=new Ur({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});Mt(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=ff(i,a=>xi(a.GATE));return s.hasPredicates=o,n.definition.push(s),Ut(i,a=>{const c=new Wn({definition:[]});s.definition.push(c),Mt(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Mt(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),wl}function Ty(e){return e===0?"":`${e}`}function El(e){if(e<0||e>Ey){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${Ey+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}class YM{initPerformanceTracer(t){if(Mt(t,"traceInitPerf")){const n=t.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Ri.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(t,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${t}>`);const{time:i,value:s}=v_(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${t}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function VM(e,t){t.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(e.prototype,i,s):e.prototype[i]=n.prototype[i]})})}const xl=pl(xs,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(xl);const Ri=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Z_,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),vl=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var On;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(On||(On={}));let Cf=class Jw{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{T_(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Ut(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=_M({rules:Ve(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ye(r)&&this.skipValidations===!1){const i=yM({rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),errMsgProvider:vs,grammarName:n}),s=nM({lookaheadStrategy:this.lookaheadStrategy,rules:Ve(this.gastProductionsCache),tokenTypes:Ve(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ye(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=XL(Ve(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ve(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ve(this.gastProductionsCache))})),!Jw.DEFER_DEFINITION_ERRORS_HANDLING&&!ye(this.definitionErrors))throw t=Tt(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),Mt(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Mt(n,"skipValidations")?n.skipValidations:Ri.skipValidations}};Cf.DEFER_DEFINITION_ERRORS_HANDLING=!1,VM(Cf,[xM,SM,PM,$M,jM,DM,zM,WM,KM,YM]);class XM extends Cf{constructor(t,n=Ri){const r=mn(n);r.outputCst=!0,super(t,r)}}function qM(e){const t=new JM,n=Ve(e);return Tt(n,r=>t.visitRule(r))}class JM extends ws{visitRule(t){const n=this.visitEach(t.definition),r=k_(n,s=>s.propertyName),i=Tt(r,(s,o)=>{const a=!ff(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Tt(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:t.name,properties:i}}visitAlternative(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitOption(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetition(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitRepetitionMandatory(t){return this.visitEach(t.definition)}visitRepetitionMandatoryWithSeparator(t){return this.visitEach(t.definition).concat({propertyName:t.separator.name,canBeNull:!0,type:Tl(t.separator)})}visitRepetitionWithSeparator(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0}).concat({propertyName:t.separator.name,canBeNull:!0,type:Tl(t.separator)})}visitAlternation(t){return this.visitEachAndOverrideWith(t.definition,{canBeNull:!0})}visitTerminal(t){return[{propertyName:t.label||t.terminalType.name,canBeNull:!1,type:Tl(t)}]}visitNonTerminal(t){return[{propertyName:t.label||t.nonTerminalName,canBeNull:!1,type:Tl(t)}]}visitEachAndOverrideWith(t,n){return Tt(this.visitEach(t),r=>$n({},r,n))}visitEach(t){return er(Tt(t,n=>this.visit(n)))}}function Tl(e){return e instanceof zn?{kind:"rule",name:e.referencedRule.name}:{kind:"token"}}function ZM(e,t){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(er(Tt(e,r=>QM(r)))),t.includeVisitorInterface&&(n=n.concat(rU(t.visitorInterfaceName,e))),n.join(`

`)+`
`}function QM(e){const t=tU(e),n=eU(e);return[t,n]}function tU(e){const t=Sy(e.name),n=Lf(e.name);return`export interface ${t} extends CstNode {
  name: "${e.name}";
  children: ${n};
}`}function eU(e){return`export type ${Lf(e.name)} = {
  ${Tt(e.properties,n=>nU(n)).join(`
  `)}
};`}function nU(e){const t=sU(e.type);return`${e.name}${e.optional?"?":""}: ${t}[];`}function rU(e,t){return`export interface ${e}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Tt(t,n=>iU(n)).join(`
  `)}
}`}function iU(e){const t=Lf(e.name);return`${e.name}(children: ${t}, param?: IN): OUT;`}function sU(e){if(se(e)){const t=tl(Tt(e,r=>Ay(r)));return"("+jn(t,(r,i)=>r+" | "+i)+")"}else return Ay(e)}function Ay(e){return e.kind==="token"?"IToken":Sy(e.name)}function Sy(e){return zg(e)+"CstNode"}function Lf(e){return zg(e)+"CstChildren"}const oU={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function aU(e,t){const n=Object.assign(Object.assign({},oU),t),r=qM(e);return ZM(r,n)}const Ra=cm(32,126).map(e=>String.fromCharCode(e));function Kt(e){return nr({...e,name:`token_${e.name}`})}function at(e){return Kt({name:e,pattern:new RegExp(e.toLowerCase(),"i"),longer_alt:Xe})}const Oa=Kt({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),cU=Kt({name:"whitespace",pattern:/ +/,group:cn.SKIPPED}),lU=Kt({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:cn.SKIPPED}),Mf=Kt({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),_o=Kt({name:"command",pattern:/#/,start_chars_hint:["#"]});let Ry=!1;function uU(e,t,n){if(!Ry)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==Oa)return null;let i=t;for(;e[i]===" ";)i++;if("@#/?':!".includes(e[i]))return null;let s=t+1;for(;s<e.length&&e[s]!==`
`;)s++;const o=e.substring(t,s);return o.trim().length===0?null:[o]}const Oy=Kt({name:"text",pattern:uU,line_breaks:!1,start_chars_hint:Ra.filter(e=>"@#/?':!".includes(e)===!1)}),Ny=Kt({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),Uf=Kt({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),Iy=Kt({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),Cy=Kt({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),Xe=Kt({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:Ra}),Al=Kt({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),Ff=Kt({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),Ly=at("isterrain"),My=at("isobject"),Uy=at("issolid"),Fy=at("iswalk"),By=at("isswim"),Py=at("isbullet"),$y=at("iswalking"),Dy=at("iswalkable"),jy=at("isswimming"),zy=at("isswimmable"),Wy=at("black"),Gy=at("dkblue"),Ky=at("dkgreen"),Hy=at("dkcyan"),Yy=at("dkred"),Vy=at("dkpurple"),Xy=at("dkyellow"),qy=at("ltgray"),Jy=at("dkgray"),Zy=at("blue"),Qy=at("green"),tb=at("cyan"),eb=at("red"),nb=at("purple"),rb=at("yellow"),ib=at("white"),sb=at("brown"),ob=at("dkwhite"),ab=at("ltgrey"),cb=at("gray"),lb=at("grey"),ub=at("dkgrey"),hb=at("ltblack"),fb=at("onblack"),db=at("ondkblue"),pb=at("ondkgreen"),mb=at("ondkcyan"),gb=at("ondkred"),_b=at("ondkpurple"),yb=at("ondkyellow"),bb=at("onltgray"),kb=at("ondkgray"),wb=at("onblue"),Eb=at("ongreen"),xb=at("oncyan"),vb=at("onred"),Tb=at("onpurple"),Ab=at("onyellow"),Sb=at("onwhite"),Rb=at("onbrown"),Ob=at("ondkwhite"),Nb=at("onltgrey"),Ib=at("ongray"),Cb=at("ongrey"),Lb=at("ondkgrey"),Mb=at("onltblack"),Ub=at("onclear"),Fb=at("idle"),Bb=at("up"),Pb=at("down"),$b=at("left"),Db=at("right"),jb=at("by"),zb=at("at"),Wb=at("flow"),Gb=at("seek"),Kb=at("rndns"),Hb=at("rndne"),Yb=at("rnd"),Vb=at("cw"),Xb=at("ccw"),qb=at("opp"),Jb=at("rndp"),Zb=at("away"),Qb=at("toward"),t1=at("find"),e1=at("flee"),n1=at("to"),r1=at("i"),i1=at("u"),s1=at("north"),o1=at("n"),a1=at("d"),c1=at("south"),l1=at("s"),u1=at("l"),h1=at("west"),f1=at("w"),d1=at("r"),p1=at("east"),m1=at("e"),g1=at("over"),_1=at("under"),y1=Kt({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:Xe}),b1=at("contact"),k1=at("blocked"),w1=at("any"),E1=at("count"),x1=at("color"),v1=at("detect"),T1=at("abs"),A1=at("intceil"),S1=at("intfloor"),R1=at("intround"),O1=at("clamp"),N1=at("min"),I1=at("max"),C1=at("pick"),L1=at("pickwith"),M1=at("random"),U1=at("randomwith"),F1=at("run"),B1=at("runwith"),P1=Kt({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),$1=Kt({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:Xe}),D1=Kt({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:Xe}),j1=Kt({name:"islessthan",pattern:/<|below/i,longer_alt:Xe}),z1=Kt({name:"isgreaterthan",pattern:/>|above/i,longer_alt:Xe}),W1=Kt({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:Xe}),G1=Kt({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:Xe}),Bf=Kt({name:"or",pattern:/or/i,longer_alt:Xe}),Pf=Kt({name:"not",pattern:/not/i,longer_alt:Xe}),$f=Kt({name:"and",pattern:/and/i,longer_alt:Xe}),Df=Kt({name:"plus",pattern:/\+/}),jf=Kt({name:"minus",pattern:/-/}),K1=Kt({name:"power",pattern:/\*\*/}),H1=Kt({name:"multiply",pattern:/\*/}),zf=Kt({name:"divide",pattern:/\//}),Y1=Kt({name:"moddivide",pattern:/%/}),V1=Kt({name:"floordivide",pattern:/%%/}),X1=Kt({name:"query",pattern:/\?/}),q1=Kt({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),J1=Kt({name:"rparen",pattern:/\)/,pop_mode:!0}),Z1=Kt({name:"command_play",pattern:/(play|bgplay) .*/i,start_chars_hint:Ra,longer_alt:Xe}),Q1=Kt({name:"command_toast",pattern:/toast .*/i,start_chars_hint:Ra,longer_alt:Xe}),tk=Kt({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:Ra,longer_alt:Xe}),Wf=Kt({name:"if",pattern:/if|try|take|give/i,longer_alt:Xe}),Sl=at("do"),Gf=at("done"),Kf=at("else"),ek=at("while"),nk=at("repeat"),rk=at("waitfor"),ik=Kt({name:"foreach",pattern:/foreach|for/i,longer_alt:Xe}),sk=at("break"),ok=at("continue");function ak(e){return[Pb,...e,Ff,Ly,My,Uy,Dy,$y,Fy,zy,jy,By,Py,Wy,Gy,Ky,Hy,Yy,Vy,Xy,qy,Jy,Zy,Qy,tb,eb,nb,rb,ib,sb,ob,ab,cb,lb,ub,hb,fb,db,pb,mb,gb,_b,yb,bb,kb,wb,Eb,xb,vb,Tb,Ab,Sb,Rb,Ob,Nb,Ib,Cb,Lb,Mb,Ub,Fb,Bb,$b,Db,jb,zb,Wb,Gb,Jb,Kb,Hb,Yb,Vb,Xb,qb,Zb,Qb,t1,e1,n1,s1,c1,h1,p1,g1,_1,y1,b1,k1,w1,E1,x1,v1,T1,A1,S1,R1,O1,N1,I1,L1,C1,U1,M1,B1,F1,P1,$1,D1,W1,j1,G1,z1,Bf,Pf,$f,Df,jf,K1,H1,zf,V1,Y1,X1,q1,J1,r1,i1,o1,a1,l1,u1,f1,d1,m1,Al,Xe]}const ck=ak([Oy,Mf,Z1,Q1,tk,_o,Ny,Uf,Iy,Cy,Oa,cU,sk,ok,Gf,Sl,Kf,ik,Wf,nk,rk,ek]),hU=new cn({defaultMode:"use_newlines",modes:{use_newlines:ck,ignore_newlines:ak([lU])}},{skipValidations:!Zr,ensureOptimizations:Zr,positionTracking:"full"});function lk(e){Ry=!0;const t=hU.tokenize(e||` 
`),[n]=(ue(t.tokens)?t.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&t.tokens.push(pl(Oa,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),t}function fU(e,t,n=!0){if(n){const[r,...i]=t;switch(It(r??"")){default:return{type:At.OBJECT,values:t};case"loader":return{type:At.LOADER,values:i};case"board":return{type:At.BOARD,values:i};case"object":return{type:At.OBJECT,values:i};case"terrain":return{type:At.TERRAIN,values:i};case"charset":return{type:At.CHARSET,values:i};case"palette":return{type:At.PALETTE,values:i}}}else{const[r,i,...s]=t,o=It(i??""),a=[r,e,...s];switch(o){default:return{type:At.CONST,values:t};case"rn":case"range":return{type:At.RANGE,values:a};case"sl":case"select":return{type:At.SELECT,values:a};case"nm":case"number":return{type:At.NUMBER,values:a};case"tx":case"text":return{type:At.TEXT,values:a};case"hk":case"hotkey":return{type:At.HOTKEY,values:a};case"copyit":return{type:At.COPYIT,values:a};case"openit":return{type:At.OPENIT,values:a};case"zssedit":return{type:At.ZSSEDIT,values:a};case"charedit":return{type:At.CHAREDIT,values:a};case"coloredit":return{type:At.COLOREDIT,values:a}}}}function rr(e){switch(e){case At.LOADER:return"loader";case At.BOARD:return"board";case At.OBJECT:return"object";case At.TERRAIN:return"terrain";case At.CHARSET:return"charset";case At.PALETTE:return"palette";case At.CONST:return"const";case At.RANGE:return"range";case At.SELECT:return"select";case At.NUMBER:return"number";case At.TEXT:return"text";case At.HOTKEY:return"hotkey";case At.COPYIT:return"copyit";case At.OPENIT:return"openit";case At.ZSSEDIT:return"zssedit";case At.CHAREDIT:return"charedit";case At.COLOREDIT:return"coloredit"}}var Hf=(e=>(e[e.width=0]="width",e[e.height=1]="height",e[e.bits=2]="bits",e))(Hf||{});function uk(e){return co(e,Hf,{bits:t=>Array.from(t)})}function hk(e){return ia(e,Hf,{bits:t=>new Uint8Array(t)})}function fk(e,t){return{id:De(),code:e,...t}}var Yf=(e=>(e[e.id=0]="id",e[e.code=1]="code",e[e.board=2]="board",e[e.object=3]="object",e[e.terrain=4]="terrain",e[e.charset=5]="charset",e[e.palette=6]="palette",e[e.eighttrack=7]="eighttrack",e))(Yf||{});function dU(e){return co(e,Yf,{board:KP,object:Lc,terrain:Lc,charset:uk,palette:uk,stats:Te})}function pU(e){return ia(e,Yf,{board:HP,object:Mc,terrain:Mc,charset:hk,palette:hk})}function Na(e){const t={...Ts(e)};return Object.keys(t).forEach(n=>{switch(n){case"type":case"name":delete t[n];break}}),t}function mU(e){return k(e)?(e.stats=void 0,Ts(e)):{}}function dk(e){const t=lk(e),n={};let r=!0;for(let i=0;i<t.tokens.length;++i){const s=t.tokens[i];if(s.tokenType===Mf){const o=s.image.slice(1),[a,c]=o.split(";").map(d=>d.trim()),l=a.split(" "),u=fU(yt(c)?c:"",l,r),f=It(u.values.join(" "));switch(r=!1,u.type){case At.LOADER:n.type=bt.LOADER,n.name=f;break;case At.BOARD:n.type=bt.BOARD,n.name=f;break;case At.OBJECT:n.type=bt.OBJECT,n.name=f||"object";break;case At.TERRAIN:n.type=bt.TERRAIN,n.name=f;break;case At.CHARSET:n.type=bt.CHARSET,n.name=f;break;case At.PALETTE:n.type=bt.PALETTE,n.name=f;break;case At.CONST:{const[d,h]=u.values;if(yt(d)){const m=It(d);if(yt(h)){const p=parseFloat(h);n[m]=xt(p)?p:h}else xt(h)?n[m]=h:n[m]=1}break}case At.RANGE:case At.SELECT:case At.NUMBER:case At.TEXT:case At.HOTKEY:case At.ZSSEDIT:case At.CHAREDIT:case At.COLOREDIT:{const[d,...h]=u.values;if(yt(d)){const m=It(d);n[m]=[rr(u.type),...h]}break}}}}return n}function Ts(e){var t;return k(e)?(k((t=e.stats)==null?void 0:t.type)||(e.stats=dk(e.code),k(e.stats.type)||(e.stats.type=bt.OBJECT)),e.stats):{}}function pk(e){switch(e){default:case bt.ERROR:return"error";case bt.LOADER:return rr(At.LOADER);case bt.BOARD:return rr(At.BOARD);case bt.OBJECT:return rr(At.OBJECT);case bt.TERRAIN:return rr(At.TERRAIN);case bt.CHARSET:return rr(At.CHARSET);case bt.PALETTE:return rr(At.PALETTE)}}function ai(e){return Ts(e).type??bt.ERROR}function Oi(e){return pk(ai(e))}function Ue(e){return Ts(e).name??""}function Vf(e,t){return Ts(e)[t]}const Rl=new yh;function gU(e){if(!yt(e))return;const t=vc(e);if(k(t)&&k(Ot[t]))return Ot[t];const n=It(e),r=mt[n];if(k(r))return r}function Xf(e,t){const n=Object.keys(e);for(let r=0;r<n.length;++r){const i=n[r],s=e[i];if(!ue(s))switch(i){case"name":case"char":case"displaychar":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"cycle":case"stepx":case"stepy":t[i]=e[i];break;case"color":case"bg":case"displaycolor":case"displaybg":case"lightdir":t[i]=gU(e[i])??e[i];break;case"isitem":t.item=1;break;case"notitem":t.item=0;break;case"ispushable":t.pushable=1;break;case"notpushable":t.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":t.collision=Wt.ISWALK;break;case"isswim":case"isswimming":case"isswimable":t.collision=Wt.ISSWIM;break;case"issolid":t.collision=Wt.ISSOLID;break;case"isbullet":t.collision=Wt.ISBULLET;break;case"isbreakable":t.breakable=1;break;case"notbreakable":t.breakable=0;break}}}function Re(e){var t;if(k(e))switch(ai(e)){default:return;case bt.ERROR:return e.code??"";case bt.LOADER:return e.code??"";case bt.BOARD:{k(e.board)||(e.board=Xl()),e.board.id=e.id;const n=Na(e);return n.isdark&&(e.board.isdark=1),n.notdark&&(e.board.isdark=0),xt(n.startx)&&(e.board.startx=n.startx),xt(n.starty)&&(e.board.starty=n.starty),yt(n.over)&&(It(n.over)==="empty"?e.board.over=void 0:e.board.over=n.over,e.board.overboard=void 0),yt(n.under)&&(It(n.under)==="empty"?e.board.under=void 0:e.board.under=n.under,e.board.underboard=void 0),yt(n.camera)&&(It(n.camera)==="empty"?e.board.camera=void 0:e.board.camera=n.camera),yt(n.graphics)&&(It(n.graphics)==="empty"?e.board.graphics=void 0:e.board.graphics=n.graphics),xt(n.facing)&&(e.board.facing=n.facing),yt(n.facing)&&It(n.facing)==="empty"&&(e.board.facing=void 0),yt(n.exitnorth)&&(e.board.exitnorth=n.exitnorth),yt(n.exitsouth)&&(e.board.exitsouth=n.exitsouth),yt(n.exitwest)&&(e.board.exitwest=n.exitwest),yt(n.exiteast)&&(e.board.exiteast=n.exiteast),xt(n.timelimit)&&(e.board.timelimit=n.timelimit),n.restartonzap&&(e.board.restartonzap=1),n.norestartonzap&&(e.board.restartonzap=0),xt(n.maxplayershots)&&(e.board.maxplayershots=n.maxplayershots),e.board}case bt.OBJECT:return k(e.object)||(e.object=Ym()),e.object.id=e.id,e.object.code=e.code,e.object.name=Ue(e),e.object.category=Un.ISOBJECT,Xf(Na(e),e.object),e.object;case bt.TERRAIN:return k(e.terrain)||(e.terrain=Ym()),e.terrain.id=e.id,e.terrain.name=Ue(e),e.terrain.category=Un.ISTERRAIN,Xf(Na(e),e.terrain),e.terrain;case bt.PALETTE:{if(k(e.palette)||(e.palette=ig(PS)),k((t=e.palette)==null?void 0:t.bits)){const n=Na(e),r=qn(n);for(let i=0;i<r.length;++i){const s=r[i].toLowerCase(),o=n[s];if(s.startsWith("color")&&yt(o)){const a=parseFloat(s.replace("color",""));if(a>=0&&a<=15){Rl.set(o);const c=a*Uc,l=Rl.r*63,u=Rl.g*63,f=Rl.b*63;e.palette.bits[c+0]=pn(l,0,63),e.palette.bits[c+1]=pn(u,0,63),e.palette.bits[c+2]=pn(f,0,63)}}}}return e.palette}case bt.CHARSET:return k(e.charset)||(e.charset=sg(BS)),e.charset}}function qf(e){return{id:De(),name:fE(),timestamp:0,activelist:[],pages:e,flags:{}}}var Jf=(e=>(e[e.id=0]="id",e[e.name=1]="name",e[e.timestamp=2]="timestamp",e[e.activelist=3]="activelist",e[e.pages=4]="pages",e[e.flags=5]="flags",e[e.token=6]="token",e))(Jf||{});function _U(e){return co(e,Jf,{pages:t=>t.map(dU),flags:t=>{const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];Object.keys(t[i]).length===0&&delete t[i]}return t}})}function yU(e){return ia(e,Jf,{pages:t=>t.map(pU)})}function mk(e){k(e)&&(e.token=`${dE()}${ur(1111,9999)}`)}function As(e,t){if(!k(e))return;const n=It(t);return e.pages.find(i=>i.id===t||n===Ue(i))}function en(e,t,n){if(!k(e))return;const r=It(n);return e.pages.find(s=>ai(s)===t&&(s.id===n||r===Ue(s)))}function Zf(e,t,n){let r=en(e,t,n);if(!k(r)){const i=pk(t);return r=fk(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),Qf(e,r),[r,!0]}return[r,!1]}function Ss(e,t){return k(e)?e.pages.filter(n=>ai(n)===t):[]}function gk(e,t,n){if(!k(e))return[];const r=It(n);return e.pages.filter(s=>ai(s)===t).filter(s=>{const o=Ts(s),a=It(Ue(s));return s.id===n||r===a||k(o[n])})}function Ia(e){return k(e)?wr(e.pages).sort((n,r)=>{const i=ai(n),s=ai(r);return i===s?Ue(n).localeCompare(Ue(r)):s-i}):[]}function _k(e,t){if(k(t)){const n=en(e,bt.TERRAIN,t.kind??"");if(k(n))return n;const r=en(e,bt.OBJECT,t.kind??"");if(k(r))return r}}function Qf(e,t){if(!k(e)||!k(t))return!1;const n=As(e,t.id);return k(n)?!1:(e.pages.push(t),mk(e),!0)}function yk(e,t){const n=As(e,t);if(k(e)&&k(n)){const r=It(t);return e.pages=e.pages.filter(i=>i.id!==t&&r!==Ue(i)),mk(e),n}}function Rs(e,t,n,r){const i=e==null?void 0:e.kinddata;return{char:(e==null?void 0:e.displaychar)??(i==null?void 0:i.displaychar)??(e==null?void 0:e.char)??(i==null?void 0:i.char)??t,color:(e==null?void 0:e.displaycolor)??(i==null?void 0:i.displaycolor)??(e==null?void 0:e.color)??(i==null?void 0:i.color)??n,bg:(e==null?void 0:e.displaybg)??(i==null?void 0:i.displaybg)??(e==null?void 0:e.bg)??(i==null?void 0:i.bg)??r,light:(e==null?void 0:e.light)??(i==null?void 0:i.light)??0}}function bU(e,t){return!!(e!=null&&e.flags[t])}function Ni(e,t){return e?(e.flags[t]=e.flags[t]??{},e.flags[t]):{}}function bk(e,t){e&&delete e.flags[t]}function kk(e,t,n){const r=Ni(e,t);return r==null?void 0:r[n]}function kU(e,t,n,r){const i=Ni(e,t);return i&&(i[n]=r),r}function wk(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ie(t,{x:s,y:i});Ge(o)&&xn(t,o,e.timestamp),Oe(t,{x:s,y:i})}}function wU(e,t,n){for(let r=t.y;r<=n.y;++r)for(let i=t.x;i<=n.x;++i)Oe(e,{x:i,y:r})}function Ek(e,t,n,r){for(let i=n.y;i<=r.y;++i)for(let s=n.x;s<=r.x;++s){const o=ie(t,{x:s,y:i});Ge(o)&&xn(t,o,e.timestamp),Oe(t,{x:s,y:i})}}function yo(e,t){k(e)&&(e.name=t.name,e.char=t.char,e.color=t.color,e.bg=t.bg,e.p1=t.p1,e.p2=t.p2,e.p3=t.p3,e.code=t.code,e.group=t.group,e.party=t.party,e.cycle=t.cycle,e.light=t.light,e.stepx=t.stepx,e.stepy=t.stepy,e.pushable=t.pushable,e.collision=t.collision,e.breakable=t.breakable,e.tickertext=t.tickertext,e.tickertime=t.tickertime)}function Ol(e,t,n,r,i){switch(i){case"all":case"object":case"terrain":break;default:return EU(e,t,n,"",i)}if(!k(E.book))return;const s=E.book,o=en(s,bt.BOARD,e),a=Re(o);if(!k(a))return;const c=en(s,bt.BOARD,t),l=Re(c);if(!k(l))return;Ae(a),Ae(l);let u=!1;if(k(a)&&k(l)){switch(i){case"all":wk(s,l,n,r);break;case"object":Ek(s,l,n,r);break;case"terrain":wU(l,n,r);break;default:u=!0;break}for(let f=n.y;f<=r.y;++f)for(let d=n.x;d<=r.x;++d){let h=!1,m=!1;switch(i){case"all":h=!0,m=!0;break;case"object":h=!0;break;case"terrain":m=!0;break}const p={x:d,y:f};let b,y=ie(a,p);if(Ge(y)?(b=es(a,d,f),_n(y==null?void 0:y.id)&&(y=void 0)):(b=y,y=void 0),k(b)&&(m||u&&Gt(b,"group")===i)){u&&wk(s,l,p,p);const v=$r(l,[b.kind??""],p);yo(v,b)}if(k(y)&&(h||u&&Gt(y,"group")===i)){u&&Ek(s,l,p,p);const v=$r(l,[y.kind??""],p);yo(v,y)}}oa(l)}}function EU(e,t,n,r,i){if(!k(E.book))return;const s=E.book,o=en(s,bt.BOARD,e),a=Re(o);if(!k(a))return;const c=en(s,bt.BOARD,t),l=Re(c);if(k(l)&&(Ae(a),Ae(l),k(a)&&k(l))){const{terrainelements:u,objectelements:f}=ng(a,r,i);if(u.length===0&&f.length===0)return;const d={x:St,y:Vt};for(let h=0;h<u.length;++h){const m=u[h];xt(m.x)&&(d.x=Math.min(d.x,m.x)),xt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<f.length;++h){const m=f[h];xt(m.x)&&(d.x=Math.min(d.x,m.x)),xt(m.y)&&(d.y=Math.min(d.y,m.y))}for(let h=0;h<u.length;++h){const m=u[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},b=ie(l,p);k(b)&&(Ge(b)&&xn(l,b,s.timestamp),Oe(l,p));const y=$r(l,[m.kind??""],p);yo(y,m)}for(let h=0;h<f.length;++h){const m=f[h],p={x:n.x+(m.x??0)-d.x,y:n.y+(m.y??0)-d.y},b=$r(l,[m.kind??""],p);yo(b,m)}oa(l)}}function Ca(e,t){const n=kk(e,t,"board"),r=Pr(bt.BOARD,n);return Re(r)}function xU(e,t){return(e==null?void 0:e.activelist.includes(t))??!1}function Nl(e,t,n){if(!k(e))return;kU(e,t,"board",n);const r=un(n);k(r)?e.activelist.includes(t)||e.activelist.push(t):e.activelist=e.activelist.filter(i=>i!==t)}function bo(e,t,n,r,i=!1){if(!k(e))return;const s=hn(t);if(!k(s))return;const o=Cn(s,t);if(!Ge(o)||!(o!=null&&o.id))return;const a=un(n);if(!k(a)||(Ae(a),i===!1&&Fh(a,Wt.ISWALK,r,!0)))return;delete s.objects[o.id];const c=Dr(s,o);s.lookup&&(s.lookup[c]=void 0),o.x=r.x,o.y=r.y,a.objects[o.id]=o;const l=Dr(a,o);a.lookup&&(a.lookup[l]=o.id),Nl(e,t,a.id)}function vU(e){const n=((e==null?void 0:e.activelist)??[]).map(r=>{const i=kk(e,r,"board");return yt(i)?i:""});return PA(n)}function ko(e){const t=vU(e),n=new Set,r=[];for(let i=0;i<t.length;++i){const s=un(t[i]);if(k(s)&&!n.has(s.id)){if(yt(s.over))if(yt(s.overboard)){const o=un(s.overboard);k(o)?n.has(o.id)||r.push(o):delete s.overboard}else{const o=un(s.over);k(o)&&(s.overboard=o.id)}else yt(s.overboard)&&delete s.overboard;if(r.push(s),yt(s.under))if(yt(s.underboard)){const o=un(s.underboard);k(o)||delete s.underboard}else{const o=un(s.under);k(o)&&(s.underboard=o.id)}else yt(s.underboard)&&delete s.underboard}}return r}const TU=cm(32,126).map(e=>String.fromCharCode(e)),AU=nr({name:"Whitespace",pattern:/ +/}),SU=nr({name:"WhitespaceSkipped",pattern:/ +/,group:cn.SKIPPED}),td=nr({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),xk=nr({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:TU}),ed=nr({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),nd=nr({name:"EscapedDollar",pattern:"$$"}),rd=nr({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),id=nr({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),vk=nr({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function RU(e,t=""){return nr({name:t||e,pattern:new RegExp(e.toLowerCase(),"i")})}const Tk=Object.keys(Jo).map(e=>RU(`\\$(${e})`,e)),OU=[AU,td,...Tk,ed,xk,id,nd,vk,rd],NU=new cn(OU,{skipValidations:!Zr,ensureOptimizations:Zr}),IU=new cn([SU,td,...Tk,ed,xk,id,nd,vk,rd],{skipValidations:!Zr,ensureOptimizations:Zr});function sd(e,t=!1){return t?IU.tokenize(e):NU.tokenize(e)}function od(e,t,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:e,height:t,char:[],color:[],bg:[],changed(){}}}function Ak(e){e.active={...e.reset}}function Sk(e,t){const n=t.y;function r(){++t.x;const a=t.active.rightedge??t.width-1;!t.disablewrap&&t.x>a&&(t.x=t.active.leftedge??0,++t.y),t.x>t.measuredwidth&&(t.measuredwidth=t.x)}function i(){return t.x>=(t.active.leftedge??0)&&t.x<=(t.active.rightedge??t.width-1)&&t.y>=(t.active.topedge??0)&&t.y<=(t.active.bottomedge??t.height-1)}function s(a){for(let c=0;c<a.length;++c){if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=a.charCodeAt(c),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r()}}for(let a=0;a<e.length;++a){const c=e[a];switch(c.tokenType){case nd:s("$");break;case id:if(t.measureonly!==!0&&i()){const l=t.x+t.y*t.width;t.char[l]=parseFloat(c.image.replace("$","")),t.active.color!==void 0&&(t.color[l]=t.active.color),t.active.bg!==void 0&&(t.bg[l]=t.active.bg)}r();break;case ed:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case td:{t.x=t.active.leftedge??0,++t.y;break}default:{const l=c.tokenType.name,u=Jo[l],f=zA(Ot[u]),d=WA(Ot[u]);u==="ONCLEAR"?(t.active.color=t.reset.color,t.active.bg=t.reset.bg):k(f)?t.active.color=f:k(d)?t.active.bg=d:s(c.image);break}}}t.x>t.measuredwidth&&(t.measuredwidth=t.x+1);const o=t.active.leftedge??0;if(k(t.writefullwidth)&&(t.x>o||t.y===n)){const c=(t.active.rightedge??t.width-1)-t.x;if(c>0){Ak(t);const l=String.fromCharCode(t.writefullwidth).repeat(c),u=t.x+t.y*t.width;LU(u,u+l.length,t.active.color,t.active.bg,t),CU(u,l,t)}}}function Rk(e,t,n){const r=sd(e);r.tokens&&(Sk(r.tokens,t),n&&Ak(t),t.changed())}function Ok(e,t,n){const r=sd(e);if(!r.tokens)return;const i=od(t,n,Ot.WHITE,Ot.BLACK);return i.measureonly=!0,Sk(r.tokens,i),i.x>0&&++i.y,i}function CU(e,t,n){let r=0;const i=e+t.length;for(let s=e;s<i;++s)n.char[s]=t.charCodeAt(r++);n.changed()}function LU(e,t,n,r,i){const s=Math.min(e,t),o=Math.max(e,t);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function Il(e,t,n){if(!ms(E.element))return 0;const[r,i]=st(t,0,[H.DIR,H.MAYBE_KIND]),s=i??["bullet"],o=OP(E.board,s,{x:E.element.x,y:E.element.y});if(k(o)){k(n)&&(o.arg=n),o.cycle=1,o.party=E.elementid,o.collision=Wt.ISBULLET,o.breakable=1,o.stepx=r.destpt.x-E.element.x,o.stepy=r.destpt.y-E.element.y,o.bg=Ot.ONCLEAR;const a=ui(o),c=o.code??(a==null?void 0:a.code)??"";Rw(E.book,E.board,o,c)}return e.yield(),0}function Cl(e,t,n,r){var l,u;if(!ms(E.element)||!k(E.book)||!k(E.board)||!k(E.element))return 0;Ae(E.board);const[i,s]=st(t,0,[H.DIR,H.KIND]),o=ie(E.board,i.destpt);if((o==null?void 0:o.category)===Un.ISOBJECT&&(o!=null&&o.pushable)){const f={x:((l=E.element)==null?void 0:l.x)??0,y:((u=E.element)==null?void 0:u.y)??0},d=ze(i.destpt,Sr(f,i.destpt));Bh(E.board,o,d)}const[a]=s,c=ui({kind:a});if(Ge(c)||$r(E.board,s,i.destpt,n),Ge(c)){const f=Gt(c,"collision");if(!Fh(E.board,f,i.destpt)){const h=$r(E.board,s,i.destpt,n);k(h)&&k(r)&&(h.arg=r)}}return 0}function Nk(e,t,n){if(!k(E.book)||!k(E.board))return 0;Ae(E.board);const[r,i]=st(t,0,[H.DIR,H.DIR]),s=ie(E.board,r.destpt);return Ge(s),0}const MU={x:0,y:0},UU={x:St-1,y:Vt-1},FU="all",BU=Ei().command("goto",(e,t)=>{var a,c;if(!k(E.book)||!k(E.board))return 0;const[n,r]=st(t,0,[H.STRING]),[i,s]=st(t,r,[H.MAYBE_NUMBER,H.MAYBE_NUMBER]),o=un(n);if(k(o)){Ae(o);const l={x:((a=E.element)==null?void 0:a.x)??i??Math.round(St*.5),y:((c=E.element)==null?void 0:c.y)??s??Math.round(Vt*.5)},u=Or(E.element),{color:f}=Rs(E.element,-1,-1,-1),d=[];f>-1&&d.push(...Ac(o,[u,[Ot[f]]]));const h=kn(d);k(h)&&xt(h.x)&&xt(h.y)&&(l.x=h.x,l.y=h.y),bo(E.book,E.elementfocus,o.id,l,!0)}return 0}).command("build",(e,t)=>{if(!k(E.book)||!k(E.board)||!k(E.element))return 0;const[n,r]=st(t,0,[H.NAME,H.MAYBE_STRING]),i=Xl();if(k(i)){if(yt(r)){const s=un(r);k(s)&&Ol(s.id,i.id,MU,UU,FU)}e.set(n,i.id)}return 0}).command("shove",(e,t)=>{if(!k(E.book)||!k(E.board))return 0;Ae(E.board);const[n,r]=st(t,0,[H.DIR,H.DIR]),i=ie(E.board,n.destpt);return Ge(i)&&ts(E.book,E.board,i,r.destpt),0}).command("dupe",Nk).command("duplicate",Nk).command("write",(e,t)=>{var d;if(!k(E.book)||!k(E.board))return 0;Ae(E.board);const[n,r,i]=st(t,0,[H.DIR,H.COLOR]),s=t.slice(i).map(Se).join(" "),{color:o,bg:a}=_m(r),c=((d=Ok(s,256,1))==null?void 0:d.measuredwidth)??1,l=od(256,1,o??Ot.WHITE,a??Ot.BLACK);Rk(s,l,!1);const u=c-1;switch(Sr(n.startpt,n.destpt)){case mt.EAST:for(let h=0;h<c;++h)Oe(E.board,{x:n.destpt.x+h,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case mt.WEST:for(let h=0;h<c;++h)Oe(E.board,{x:n.destpt.x+h-u,y:n.destpt.y,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case mt.NORTH:for(let h=0;h<c;++h)Oe(E.board,{x:n.destpt.x,y:n.destpt.y+h-u,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break;case mt.SOUTH:for(let h=0;h<c;++h)Oe(E.board,{x:n.destpt.x,y:n.destpt.y+h,name:"text",char:l.char[h],color:l.color[h],bg:l.bg[h]});break}return 0}).command("change",(e,t)=>{if(!k(E.book)||!k(E.board))return 0;Ae(E.board);const[n,r]=st(t,0,[H.KIND,H.KIND]);(Tc(n)??"")==="empty"&&HA(E.board).forEach(c=>{$r(E.board,r,c)});const s=Tc(r),o=Eh(r),a=bm(r);return Ac(E.board,n).forEach(c=>{if(k(o)&&(c.color=o),k(a)&&(c.bg=a),Or(c)!==s){const l=Gt(c,"color"),u=Gt(c,"bg");if(xn(E.board,c,E.timestamp),s!=="empty"){const f={x:c.x??0,y:c.y??0},d=$r(E.board,r,f);k(d)&&(d.color=l,d.bg=u)}}}),0}).command("put",(e,t)=>Cl(e,t)).command("putwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Cl(e,t.slice(r),void 0,n)}).command("oneof",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return k(E.board)&&Cn(E.board,n)?0:Cl(e,t.slice(r),n)}).command("oneofwith",(e,t)=>{const[n,r,i]=st(t,0,[H.ANY,H.ANY]);return k(E.board)&&Cn(E.board,r)?0:Cl(e,t.slice(i),r,n)}).command("shoot",Il).command("shootwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Il(e,t.slice(r),n)}).command("throwstar",(e,t)=>Il(e,[...t,"star"])).command("throwstarwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY]);return Il(e,[...t.slice(r),"star"],n)}),Xi="$dkpurple",PU="$196",$U="$205",Ke="$yellow$205$205$205$196";function be(e,t,n){BE(e,t,n)}function DU(e,t,n){const r=PU.repeat(n);be(e,t,`${Xi}${r}`)}function ad(e,t,n){const r=$U.repeat(n);be(e,t,`${Xi}${r}`)}function cd(e,t,n){be(e,t,`${Xi} ${" ".repeat(n.length)} `),DU(e,t,n.length+2),be(e,t,`${Xi} $white${n} `),ad(e,t,n.length+2)}function Os(e,t,n){be(e,t,`${Xi} ${" ".repeat(n.length)} `),be(e,t,`${Xi} $gray${n} `),ad(e,t,n.length+2)}function Ns(e,t,n,r){be(e,t,`${Xi} $white${n} $blue${r}`)}function Kn(e,t,n){be(e,t,`${Xi}$blue${n}`)}function jU(e,t,n,r){be(e,t,`!${n};${r}`)}var zU=`desc;$DKGRAYname and type of codepage
`,WU=Object.freeze({__proto__:null,default:zU}),GU="desc;changes object into specified element",KU=Object.freeze({__proto__:null,default:GU}),HU="desc;like #play but for sound effects",YU=Object.freeze({__proto__:null,default:HU}),VU="",XU=Object.freeze({__proto__:null,default:VU}),qU="",JU=Object.freeze({__proto__:null,default:qU}),ZU="",QU=Object.freeze({__proto__:null,default:ZU}),t3="",e3=Object.freeze({__proto__:null,default:t3}),n3="",r3=Object.freeze({__proto__:null,default:n3}),i3="",s3=Object.freeze({__proto__:null,default:i3}),o3="",a3=Object.freeze({__proto__:null,default:o3}),c3="",l3=Object.freeze({__proto__:null,default:c3}),u3="",h3=Object.freeze({__proto__:null,default:u3}),f3="",d3=Object.freeze({__proto__:null,default:f3}),p3="",m3=Object.freeze({__proto__:null,default:p3}),g3="",_3=Object.freeze({__proto__:null,default:g3}),y3="",b3=Object.freeze({__proto__:null,default:y3}),k3="",w3=Object.freeze({__proto__:null,default:k3}),E3="",x3=Object.freeze({__proto__:null,default:E3}),v3=`desc;$DKGRAYstarts a section of an if-do-done block
`,T3=Object.freeze({__proto__:null,default:v3}),A3=`desc;$DKGRAYcompletes an if-do-done block
`,S3=Object.freeze({__proto__:null,default:A3}),R3="",O3=Object.freeze({__proto__:null,default:R3}),N3="",I3=Object.freeze({__proto__:null,default:N3}),C3="",L3=Object.freeze({__proto__:null,default:C3}),M3=`desc;$DKGRAYelse logic in an if-do-done block
`,U3=Object.freeze({__proto__:null,default:M3}),F3=`desc;$DKGRAYconditional else logic in an if-do-done block
`,B3=Object.freeze({__proto__:null,default:F3}),P3="",$3=Object.freeze({__proto__:null,default:P3}),D3="",j3=Object.freeze({__proto__:null,default:D3}),z3="",W3=Object.freeze({__proto__:null,default:z3}),G3="",K3=Object.freeze({__proto__:null,default:G3}),H3="",Y3=Object.freeze({__proto__:null,default:H3}),V3="",X3=Object.freeze({__proto__:null,default:V3}),q3="",J3=Object.freeze({__proto__:null,default:q3}),Z3="",Q3=Object.freeze({__proto__:null,default:Z3}),t8=`desc;$DKGRAYhalt until the next cycle
`,e8=Object.freeze({__proto__:null,default:t8}),n8=`desc;$DKGRAYevals condition for true or false
`,r8=Object.freeze({__proto__:null,default:n8}),i8="",s8=Object.freeze({__proto__:null,default:i8}),o8="",a8=Object.freeze({__proto__:null,default:o8}),c8="",l8=Object.freeze({__proto__:null,default:c8}),u8="",h8=Object.freeze({__proto__:null,default:u8}),f8="",d8=Object.freeze({__proto__:null,default:f8}),p8="",m8=Object.freeze({__proto__:null,default:p8}),g8="",_8=Object.freeze({__proto__:null,default:g8}),y8="",b8=Object.freeze({__proto__:null,default:y8}),k8="",w8=Object.freeze({__proto__:null,default:k8}),E8="",x8=Object.freeze({__proto__:null,default:E8}),v8="",T8=Object.freeze({__proto__:null,default:v8}),A8="",S8=Object.freeze({__proto__:null,default:A8}),R8="",O8=Object.freeze({__proto__:null,default:R8}),N8="",I8=Object.freeze({__proto__:null,default:N8}),C8="",L8=Object.freeze({__proto__:null,default:C8}),M8="",U8=Object.freeze({__proto__:null,default:M8}),F8="",B8=Object.freeze({__proto__:null,default:F8}),P8="",$8=Object.freeze({__proto__:null,default:P8}),D8="",j8=Object.freeze({__proto__:null,default:D8}),z8="",W8=Object.freeze({__proto__:null,default:z8}),G8="",K8=Object.freeze({__proto__:null,default:G8}),H8=`desc;$DKGRAYlaunches a bullet
words;dir
words2;dir,kind
`,Y8=Object.freeze({__proto__:null,default:H8}),V8="",X8=Object.freeze({__proto__:null,default:V8}),q8="",J8=Object.freeze({__proto__:null,default:q8}),Z8="",Q8=Object.freeze({__proto__:null,default:Z8}),t2="",e2=Object.freeze({__proto__:null,default:t2}),n2="",r2=Object.freeze({__proto__:null,default:n2}),i2="",s2=Object.freeze({__proto__:null,default:i2}),o2="",a2=Object.freeze({__proto__:null,default:o2}),c2="",l2=Object.freeze({__proto__:null,default:c2}),u2="",h2=Object.freeze({__proto__:null,default:u2}),f2="",d2=Object.freeze({__proto__:null,default:f2}),p2="",m2=Object.freeze({__proto__:null,default:p2}),g2="",_2=Object.freeze({__proto__:null,default:g2}),y2="",b2=Object.freeze({__proto__:null,default:y2}),k2="",w2=Object.freeze({__proto__:null,default:k2}),E2="",x2=Object.freeze({__proto__:null,default:E2}),v2="",T2=Object.freeze({__proto__:null,default:v2}),A2="",S2=Object.freeze({__proto__:null,default:A2}),R2="",O2=Object.freeze({__proto__:null,default:R2}),N2="",I2=Object.freeze({__proto__:null,default:N2}),C2=`desc;$DKGRAYdesignates an inactive label or comment
`,L2=Object.freeze({__proto__:null,default:C2}),M2=`desc;$DKGRAYadds hyperlink text

`,U2=Object.freeze({__proto__:null,default:M2}),F2=`desc;$DKGRAYsends the given message when hotkey is pressed

`,B2=Object.freeze({__proto__:null,default:F2}),P2=`desc;$DKGRAYread number input into given stat/flag
`,$2=Object.freeze({__proto__:null,default:P2}),D2=`desc;$DKGRAYa slider input from 1 to 9 

`,j2=Object.freeze({__proto__:null,default:D2}),z2=`desc;$DKGRAYlist with label value pairs to pick from
`,W2=Object.freeze({__proto__:null,default:z2}),G2=`desc;$DKGRAYread text input into given stat/flag
`,K2=Object.freeze({__proto__:null,default:G2}),H2=`desc;$DKGRAYdesignates a starting point for running code
`,Y2=Object.freeze({__proto__:null,default:H2}),V2=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,X2=Object.freeze({__proto__:null,default:V2}),q2=`desc;$DKGRAYwill move the object in the given direction
`,J2=Object.freeze({__proto__:null,default:q2}),Z2=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,Q2=Object.freeze({__proto__:null,default:Z2}),tF=`desc;$DKGRAYcustom 8x14 charset
`,eF=Object.freeze({__proto__:null,default:tF}),nF=`desc;$DKGRAYsets stat to given value

`,rF=Object.freeze({__proto__:null,default:nF}),iF=`desc;$DKGRAYsends the given message when hotkey is pressed

`,sF=Object.freeze({__proto__:null,default:iF}),oF=`desc;$DKGRAYread external content and/or handle events
`,aF=Object.freeze({__proto__:null,default:oF}),cF=`desc;$DKGRAYread number input into given stat/flag
`,lF=Object.freeze({__proto__:null,default:cF}),uF=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,hF=Object.freeze({__proto__:null,default:uF}),fF=`desc;$DKGRAYcustom palette colors
`,dF=Object.freeze({__proto__:null,default:fF}),pF=`desc;$DKGRAYa slider input from 1 to 9 

`,mF=Object.freeze({__proto__:null,default:pF}),gF=`desc;$DKGRAYlist with label value pairs to pick from
`,_F=Object.freeze({__proto__:null,default:gF}),yF=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,bF=Object.freeze({__proto__:null,default:yF}),kF=`desc;$DKGRAYread text input into given stat/flag
`,wF=Object.freeze({__proto__:null,default:kF}),EF=`desc;$DKGRAYadds text
`,xF=Object.freeze({__proto__:null,default:EF}),vF=`header;zss controls and inputs
section;keyboard input
option;arrow keys;move
option;shift + arrow keys;shoot
option;enter;ok / accept
option;escape;cancel / close
option;tab;menu / action
section;controller input
option;left stick;move
option;right stick;aim
option;a;ok / accept
option;b;cancel / close
option;y;menu / action
option;x;shoot
option;triggers;shoot
`,TF=Object.freeze({__proto__:null,default:vF}),AF=`header;developer commands
option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,SF=Object.freeze({__proto__:null,default:AF}),RF=`header;H E L P
keyboard input
option;? or /;open terminal
option;esc;close terminal, scroll, or editor
option;tab;change layout
option;up or down arrow keys;navigate terminal items
option;left or right arrow keys;change terminal items
option;enter;activate terminal items
option;alt + arrow keys;skip words and terminal lines
option;ctrl + up / down arrow keys;input history
$32
option;controls;zss controls and inputs
!helpcontrols;read help controls
$32
option;text;zss text and inputs
!helptext;read help text
$32
option;developer;developer commands
!helpdeveloper;read help developer
$32
option;player;player settings & hotkeys
!helpplayer;read help player
`,OF=Object.freeze({__proto__:null,default:RF}),NF=`header;player settings
#set user "name goes here"
`,IF=Object.freeze({__proto__:null,default:NF}),CF=`header;text formatting
section;typography
plain text
use"@quoted strings for special chars"
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$BLUE to change foreground color
use color names like $ONGREEN$$ongreen$ONCLEAR to change background color
use onclear $WHITE$$onclear$BLUE to change background to transparent
section;hyperlinks
option;!hotkey label <shortcut> [shortcutword];
send the given #label when the <shortcut> is pressed
!openit https://github.com/ianstormtaylor/is-hotkey;$BLUEuses is-hotkey
option;!range flag [minword] [maxword];
uses the standard 1 to 9 values input range
option;!select flag ...list of <word> <value> pairs;
gives a user a way to cycle through preset values
option;!text flag;
write user text input into a flag
`,LF=Object.freeze({__proto__:null,default:CF});const Ik=Object.assign({"./editor/codepagename.txt":WU,"./editor/command/become.txt":KU,"./editor/command/bgplay.txt":YU,"./editor/command/bgvol.txt":XU,"./editor/command/bind.txt":JU,"./editor/command/board.txt":QU,"./editor/command/bpm.txt":e3,"./editor/command/break.txt":r3,"./editor/command/change.txt":s3,"./editor/command/char.txt":a3,"./editor/command/charset.txt":l3,"./editor/command/clear.txt":h3,"./editor/command/color.txt":d3,"./editor/command/continue.txt":m3,"./editor/command/copy.txt":_3,"./editor/command/cycle.txt":b3,"./editor/command/die.txt":w3,"./editor/command/distort.txt":x3,"./editor/command/do.txt":T3,"./editor/command/done.txt":S3,"./editor/command/duplicate.txt":O3,"./editor/command/echo.txt":I3,"./editor/command/edge.txt":L3,"./editor/command/else.txt":U3,"./editor/command/elseif.txt":B3,"./editor/command/end.txt":$3,"./editor/command/endgame.txt":j3,"./editor/command/endwith.txt":W3,"./editor/command/fcrush.txt":K3,"./editor/command/fetch.txt":Y3,"./editor/command/fetchwith.txt":X3,"./editor/command/foreach.txt":J3,"./editor/command/go.txt":Q3,"./editor/command/idle.txt":e8,"./editor/command/if.txt":r8,"./editor/command/lock.txt":s8,"./editor/command/oneof.txt":a8,"./editor/command/oneofwith.txt":l8,"./editor/command/palette.txt":h8,"./editor/command/phaser.txt":d8,"./editor/command/pivot.txt":m8,"./editor/command/play.txt":_8,"./editor/command/put.txt":b8,"./editor/command/putwith.txt":w8,"./editor/command/readbin.txt":x8,"./editor/command/readjson.txt":T8,"./editor/command/readline.txt":S8,"./editor/command/readrexpaint.txt":O8,"./editor/command/remix.txt":I8,"./editor/command/repeat.txt":L8,"./editor/command/restore.txt":U8,"./editor/command/reverb.txt":B8,"./editor/command/revert.txt":$8,"./editor/command/run.txt":j8,"./editor/command/runwith.txt":W8,"./editor/command/set.txt":K8,"./editor/command/shoot.txt":Y8,"./editor/command/shootwith.txt":X8,"./editor/command/shove.txt":J8,"./editor/command/snapshot.txt":Q8,"./editor/command/synth.txt":e2,"./editor/command/toast.txt":r2,"./editor/command/tts.txt":s2,"./editor/command/ttsvol.txt":a2,"./editor/command/twitchbroadcast.txt":l2,"./editor/command/twitchchat.txt":h2,"./editor/command/unlock.txt":d2,"./editor/command/vibrato.txt":m2,"./editor/command/vol.txt":_2,"./editor/command/waitfor.txt":b2,"./editor/command/walk.txt":w2,"./editor/command/weave.txt":x2,"./editor/command/while.txt":T2,"./editor/command/with.txt":S2,"./editor/command/write.txt":O2,"./editor/command/zap.txt":I2,"./editor/comment.txt":L2,"./editor/hyperlink.txt":U2,"./editor/hyperlink/hotkey.txt":B2,"./editor/hyperlink/number.txt":$2,"./editor/hyperlink/range.txt":j2,"./editor/hyperlink/select.txt":W2,"./editor/hyperlink/text.txt":K2,"./editor/label.txt":Y2,"./editor/shortgo.txt":X2,"./editor/shorttry.txt":J2,"./editor/stat/board.txt":Q2,"./editor/stat/charset.txt":eF,"./editor/stat/const.txt":rF,"./editor/stat/hotkey.txt":sF,"./editor/stat/loader.txt":aF,"./editor/stat/number.txt":lF,"./editor/stat/object.txt":hF,"./editor/stat/palette.txt":dF,"./editor/stat/range.txt":mF,"./editor/stat/select.txt":_F,"./editor/stat/terrain.txt":bF,"./editor/stat/text.txt":wF,"./editor/text.txt":xF,"./help/controls.txt":TF,"./help/developer.txt":SF,"./help/menu.txt":OF,"./help/player.txt":IF,"./help/text.txt":LF}),Ck={};qn(Ik).forEach(e=>{const t=e.replace(".txt","").replace("./","").replaceAll("/",":");Ck[t]=Ik[e].default});function MF(e){const t=It(e.trim().replaceAll(`
`,"").replace(/:+$/,"")),n=Ck[t];if(k(n))return n;const{target:r,path:i}=Fn(t);switch(r){case"editor":{const s=Fn(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function UF(e,t){const n=(e??"").split(`
`);for(let r=0;r<n.length;++r)t(n[r].split(";"))}function FF(e,t){const[n,...r]=t,i=r[0]??"",s=r[1]??"";switch(It(n.trim())){case"header":cd(et,e,i);break;case"section":Os(et,e,i);break;case"option":Ns(et,e,i,s);break;default:n.trimStart().startsWith("!")?jU(et,e,n.trimStart().slice(1),i):be(et,e,n);break}}function Ii(e){const[t,n]=st(e,0,[H.NAME,H.ANY]);if(It(t)==="send"&&Rr(n)){const[,r,i,s]=st(e,0,[H.NAME,H.DIR,H.MAYBE_NAME]);return yt(i)&&i.startsWith(":")?{targetdir:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetdir:r,label:e.slice(s-1).join(" ")}}else if(yt(t)){const[r,i,s]=st(e,0,[H.NAME,H.MAYBE_NAME]);return yt(i)&&i.startsWith(":")?{targetname:r,label:[i.substring(1).trim(),...e.slice(s)].join(" ")}:{targetname:"self",label:[r,...e.slice(s-1)].join(" ")}}return{targetname:"",label:""}}function Is(){n0(et,sr())}function La(e){UF(MF(`help:${e}`),t=>FF(E.elementfocus,t))}function Lk(e){switch(e.label){case"helpmenu":La("menu");break;case"helpcontrols":La("controls");break;case"helptext":La("text");break;case"helpdeveloper":La("developer");break;case"helpplayer":La("player");break;default:{const t=ce($t.MAIN),n=ko(t);k(e.targetname)?Oo(e.targetname,e.label,void 0,n):k(e.targetdir)&&Oo(e.targetdir.destpt,e.label,void 0,n);break}}}const BF=Ei().command("shortsend",(e,t)=>{const n=Ii(t);return Lk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Lk(n),0}).command("stat",(e,t)=>{const[n,...r]=t.map(Se),i=r.join(" ");function s(o,a){if(k(o)&&(e.command("pageopen",o.id),a)){const c=Ue(o),l=Oi(o);be(et,E.elementfocus,`!pageopen ${o.id};$blue[${l}]$white ${c}`)}}switch(It(n)){case rr(At.LOADER):{const[o,a]=Qi($t.MAIN,i,bt.LOADER);s(o,a);break}default:{const[o,a]=Qi($t.MAIN,[n,...r].join(" "),bt.OBJECT);s(o,a);break}case rr(At.BOARD):{const[o,a]=Qi($t.MAIN,i,bt.BOARD);s(o,a);break}case rr(At.OBJECT):{const[o,a]=Qi($t.MAIN,i,bt.OBJECT);s(o,a);break}case rr(At.TERRAIN):{const[o,a]=Qi($t.MAIN,i,bt.TERRAIN);s(o,a);break}case rr(At.CHARSET):{const[o,a]=Qi($t.MAIN,i,bt.CHARSET);s(o,a);break}case rr(At.PALETTE):{const[o,a]=Qi($t.MAIN,i,bt.PALETTE);s(o,a);break}}return 0}).command("text",(e,t)=>{const n=t.map(Se).join(" ");if(k(E.element)&&E.elementisplayer){const{user:r}=br(E.elementid),i=yt(r)?r:"player";E.element.tickertext=`${i}: ${n}`,E.element.tickertime=E.timestamp;const s=Rs(E.element,1,Ot.WHITE,Ot.BLACK);xe(et,E.elementid,`$${Ot[s.color]}$ON${Ot[s.bg]}$${s.char}$ONCLEAR $WHITE${i}$BLUE ${n}`),gu(et,E.elementid,void 0,"text","chat:message:game",`${i}:${n}`)}return 0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Se(n),s=Ii(r);if(k(s.targetname)){const{user:o}=br(E.elementid),a=yt(o)?o:"player",c=Rs(E.element,1,Ot.WHITE,Ot.BLACK),l=`$${Ot[c.color]}$ON${Ot[c.bg]}$${c.char}$ONCLEAR $WHITE${a}$BLUE ${i}`;xe(et,E.elementid,`!${s.targetname}:${s.label};${l}`)}return 0}).command("config",(e,t)=>{const[n,r]=st(t,0,[H.MAYBE_NAME,H.MAYBE_STRING]);return yt(n)&&yt(r)?Qd(et,E.elementfocus,n,r):px(et,E.elementfocus),0}).command("bookcreate",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]),r=xw(n);return k(r)&&e.command("bookopen",r.id),0}).command("bookopen",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=Br(n);return k(r)?(Qd(et,E.elementfocus,"selected",r.id),Is()):de(et,E.elementfocus,"bookopen",`book ${n} not found`),0}).command("booktrash",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=ce($t.MAIN),i=Br(n);return k(i)&&(r===i&&Ew($t.MAIN,""),CP(n),xe(et,E.elementfocus,`trashed [book] ${i.name}`),Is(),e.command("pages")),0}).command("boardopen",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=un(n);return k(r)&&bo(E.book,E.elementfocus,r.id,{x:ur(0,St-1),y:ur(0,Vt-1)},!0),0}).command("pageopen",(e,t)=>{const[n,r]=st(t,0,[H.NAME,H.MAYBE_NAME]);let i,s;const o=Fr();for(let a=0;a<o.length&&(s=o[a],i=As(s,n),!k(i));++a);if(k(i)&&k(s)){const a=Ue(i),c=Oi(i);xe(et,E.elementfocus,`opened [${c}] ${a}`);const l=[i.id,r];fh(Ka(s.id,l),i.code);const u=Oi(i);t0(et,E.elementfocus,s.id,l,u,`${a} - ${s.name}`)}else de(et,"pageopen",`page ${n} not found`,E.elementfocus);return 0}).command("pagetrash",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=ln($t.MAIN),i=yk(r,n);if(k(n)){const s=Ue(i),o=Oi(i);xe(et,E.elementfocus,`trashed [${o}] ${s}`),Is(),e.command("pages")}return 0}).command("help",(e,t)=>{const n=t.map(Se).join(" ")||"menu";return e.command(`help${n}`),0}).command("books",()=>{Os(et,E.elementfocus,"books");const e=ce($t.MAIN);Ns(et,E.elementfocus,"main",`${(e==null?void 0:e.name)??"empty"} $GREEN${(e==null?void 0:e.id)??""}`);const t=ce($t.MAIN);Ns(et,E.elementfocus,"content",`${(t==null?void 0:t.name)??"empty"} ${(t==null?void 0:t.id)??""}`),ad(et,E.elementfocus,7);const n=Fr();return n.length?n.forEach(r=>{be(et,E.elementfocus,`!bookopen ${r.id};${r.name}`)}):Kn(et,E.elementfocus,"no books found"),be(et,E.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const e=ln($t.MAIN);if(!k(e))return 0;Os(et,E.elementfocus,"pages"),Ns(et,E.elementfocus,"main",`${e.name} $GREEN${e.id}`),e.pages.length?Ia(e).forEach(r=>{const i=Ue(r),s=Oi(r);be(et,E.elementfocus,`!pageopen ${r.id};$blue[${s}]$white ${i}`)}):(be(et,E.elementfocus,""),Kn(et,E.elementfocus,"$white no pages found"),Kn(et,E.elementfocus,"$white use @ to create a page"),Kn(et,E.elementfocus,"$white @board name of board"),Kn(et,E.elementfocus,"$white @object name of object"),Kn(et,E.elementfocus,"$white @terrain name of terrain"),Kn(et,E.elementfocus,"$white You can omit the type and it will default to object"),Kn(et,E.elementfocus,"$white @object name of object"),Kn(et,E.elementfocus,"$white @name of object"));const t=Fr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Ns(et,E.elementfocus,"content",`${r.name} $GREEN${r.id}`),Ia(r).forEach(s=>{const o=Ue(s),a=Oi(s);be(et,E.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{Os(et,E.elementfocus,"boards");const e=ln($t.MAIN);if(k(e)){Ns(et,E.elementfocus,"main",`${e.name} $GREEN${e.id}`);const n=Ia(e);n.filter(r=>ai(r)===bt.BOARD).forEach(r=>{const i=Ue(r);be(et,E.elementfocus,`!boardopen ${r.id};$blue#goto $white $34 ${i} $34`)}),n.length===0&&(be(et,E.elementfocus,""),Kn(et,E.elementfocus,"$white no boards found"),Kn(et,E.elementfocus,"$white use @ to create a board"),Kn(et,E.elementfocus,"$white @board name of board"))}const t=Fr();for(let n=0;n<t.length;++n){const r=t[n];r.id!==e.id&&(Ns(et,E.elementfocus,"content",`${r.name} $GREEN${r.id}`),Ia(r).filter(s=>ai(s)===bt.BOARD).forEach(s=>{const o=Ue(s);be(et,E.elementfocus,`!boardopen ${s.id};$blue#goto $white$34 ${o} $34`)}))}return 0}).command("trash",()=>{Os(et,E.elementfocus,"$REDTRASH"),Kn(et,E.elementfocus,"books");const e=Fr();e.length&&(e.forEach(n=>{be(et,E.elementfocus,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),be(et,E.elementfocus,""));const t=ce($t.MAIN);return k(t)&&(Kn(et,E.elementfocus,`pages in open ${t.name} book`),t.pages.forEach(n=>{const r=Ue(n);be(et,E.elementfocus,`!pagetrash ${n.id};$REDTRASH ${r}`)}),be(et,E.elementfocus,"")),0}).command("dev",()=>(Is(),rx(et,E.elementfocus),0)).command("share",()=>(Is(),ix(et,E.elementfocus),0)).command("save",()=>(Is(),0)).command("fork",()=>(bx(et,E.elementfocus),0)).command("itchiopublish",()=>(kx(et,E.elementfocus),0)).command("nuke",()=>(sx(et,E.elementfocus),0)).command("restart",()=>(yx(et,E.elementfocus),Is(),0)).command("export",()=>{cd(et,E.elementfocus,"E X P O R T"),Os(et,E.elementfocus,"books");const e=Fr();return e.length&&e.forEach(t=>be(et,E.elementfocus,`!bookexport ${t.id};${t.name}`)),0}).command("bookexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=Br(n);return k(r)&&(cd(et,E.elementfocus,"E X P O R T"),Os(et,E.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=Ia(r);be(et,E.elementfocus,`!bookallexport ${n};$blue[all]$white export book`),i.forEach(s=>{const o=Ue(s),a=Oi(s);be(et,E.elementfocus,`!pageexport ${n}:${s.id};$blue[${a}]$white ${o}`)})}},1e3)),0}).command("bookallexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=Br(n);return k(r)&&Jd(et,E.elementfocus,wr(r),`${r.name}.book.json`),0}).command("pageexport",(e,t)=>{const[n]=st(t,0,[H.NAME]),{target:r,path:i}=Fn(n),s=Br(r),o=As(s,i);return k(o)&&Jd(et,E.elementfocus,wr(o),`${Ue(o)}.${Oi(o)}.json`),0}).command("gadget",()=>(mx(et,E.elementfocus),0)).command("joincode",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return YE(et,E.elementfocus,!!n),0}).command("jointab",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return VE(et,E.elementfocus,!!n),0}).command("startlookingglass",()=>(ox(et,E.elementfocus),0)),PF=Ei().command("toast",(e,t)=>{const n=t.map(Se).join("");return Xd(et,E.elementfocus,n),0}).command("ticker",(e,t)=>{const n=t.map(Se).join("");return k(E.element)&&(E.element.tickertext=n,E.element.tickertime=E.timestamp),0}).command("palette",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=Tw(),i=en(E.book,bt.PALETTE,n);return k(i)?(r.palette=i.id,xe(et,E.elementfocus,`loaded palette ${n}`)):de(et,E.elementfocus,"not-found",`unabled to find palette ${n}`),0}).command("charset",(e,t)=>{const[n]=st(t,0,[H.NAME]),r=Tw(),i=en(E.book,bt.CHARSET,n);return k(i)?(r.charset=i.id,xe(et,E.elementfocus,`loaded charset ${n}`)):de(et,E.elementfocus,"not-found",`unabled to find charset ${n}`),0}),ld={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Wt.ISSOLID,Wt.ISWALK,Wt.ISSWIM,Wt.ISBULLET,Wt.ISWALK,Wt.ISSWIM;function Ll(e){return ue(e)&&ud(e[0])}function ud(e){return k(Wt[e])&&yt(e)}function $F(e){if(yt(e))return ld[It(e)]}function DF(e){const t=E.words[e];if(Ll(t))return[t,e+1];if(ud(t))return[[t],e+1];const[n,r]=Hn(e);return Ll(n)?[n,r]:ud(n)?[[n],r]:[void 0,e]}function wo(e,t=0){const n=[];let r=e;for(;r<E.words.length;){const[i,s]=Hn(r);if(ue(i)&&!Rr(i)&&!Ma(i)&&!Ll(i)&&!qr(i)&&n.push(...i),i==="|")return[n,s];if(r=s,n.push(i),t>0&&n.length>=t)return[n,r]}return[n,r]}function Hn(e){var r,i,s,o,a,c,l,u,f;const t=E.words[e],n=e+1;if(Uk(t)){const[d,h]=jF(e);if(k(d))return[d,h]}if($F(t)){const[d,h]=DF(e);if(k(d))return[d,h]}if(vc(t)){const[d,h]=wh(e);if(k(d))return[d,h]}if(yt(t)&&It(t)==="rnd"){const[d,h]=Hn(n),[m,p]=Hn(h);return xt(d)&&xt(m)?[ur(d,m),p]:xt(d)?[ur(0,d),h]:[ur(0,1),n]}if(kh(t)){const[d,h]=hm(e);if(k(d))return[d,h]}if(!k(t))return[void 0,e];if(xt(t)||ue(t))return[t,n];if(yt(t)){const d=It(t),h=(r=E.get)==null?void 0:r.call(E,t);if(k(h))return[h,n];switch(d){case"aligned":case"alligned":{const m=Qo(E.board,{x:((i=E.element)==null?void 0:i.x)??-1,y:((s=E.element)==null?void 0:s.y)??-1},E.elementfocus);return!k(E.element)||!k(m)?[0,n]:[E.element.x===m.x||E.element.y===m.y?1:0,n]}case"contact":{const m=Qo(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus);if(!k(E.element)||!k(m))return[0,n];const p=(m.x??0)-(((c=E.element)==null?void 0:c.x)??0),b=(m.y??0)-(((l=E.element)==null?void 0:l.y)??0);return[p===0&&Math.abs(b)<2||b===0&&Math.abs(p)<2?1:0,n]}case"blocked":{const[m,p]=st(E.words,n,[H.DIR]);return[LS(E.board,E.element,m.destpt)?1:0,p]}case"any":{const[m,p]=st(E.words,n,[H.KIND]);return[Ac(E.board,m).length?1:0,p]}case"count":{const[m,p]=st(E.words,n,[H.KIND]);return[Ac(E.board,m).length,p]}case"color":{const[m,p,b]=st(E.words,n,[H.DIR,H.COLOR]),y=m.layer===mt.MID?ie(E.board,m.destpt):es(E.board,m.destpt.x,m.destpt.y);if(k(y)){const v=Rs(y,-1,-1,-1);return[pm(p)===v.color||mm(p)===v.bg?1:0,b]}return[0,b]}case"detect":{const[m,p,b]=st(E.words,n,[H.DIR,H.KIND]),y=m.layer===mt.MID?ie(E.board,m.destpt):es(E.board,m.destpt.x,m.destpt.y);if(k(y)){const v=It(Tc(p)),T=Eh(p),A=Rs(y,-1,-1,-1);if(v&&v===It(Or(y)))return[1,b];if(k(T)&&T===A.color)return[1,b]}return[0,b]}case"rnd":return[ur(0,1),n];case"abs":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.abs(m),p]}case"intceil":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.ceil(m),p]}case"intfloor":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.floor(m),p]}case"intround":{const[m,p]=st(E.words,n,[H.NUMBER]);return[Math.round(m),p]}case"clamp":{const[m,p,b,y]=st(E.words,n,[H.NUMBER,H.NUMBER,H.NUMBER]);return[pn(m,p,b),y]}case"min":{const[m,p]=wo(n);return[Math.min(...m),p]}case"max":{const[m,p]=wo(n);return[Math.max(...m),p]}case"pick":{const[m,p]=wo(n);return[kn(m),p]}case"pickwith":{const[m,p]=st(E.words,n,[H.NUMBER_OR_STRING]),[b,y]=wo(p);return[BA(`${m}`,b),y]}case"random":{const[m,p]=wo(n,2),[b,y]=m;return[ur(b,y??0),p]}case"randomwith":{const[m,p]=st(E.words,n,[H.NUMBER_OR_STRING]),[b,y]=wo(p,2),[v,T]=b;return[am(`${m}`,v,T??0),y]}case"run":{const[m,p]=st(E.words,n,[H.NAME]);return Vl(m),[(u=E.get)==null?void 0:u.call(E,"arg"),p]}case"runwith":{const[m,p,b]=st(E.words,n,[H.ANY,H.NAME]);return k(E.element)&&(E.element.arg=m),Vl(p),[(f=E.get)==null?void 0:f.call(E,"arg"),b]}}}return[t,n]}const hd={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function Ma(e){return ue(e)&&Mk(e[0])}function Mk(e){return k(Un[e])&&yt(e)}function Uk(e){if(yt(e))return hd[It(e)]}function Fk(e){if(Ma(e))return e;if(Mk(e))return[e];const t=Uk(e);if(k(t))return[t]}function jF(e){const t=E.words[e],n=Fk(t);if(Ma(n))return[n,e+1];const[r,i]=Hn(e),s=Fk(r);return Ma(s)?[s,i]:[void 0,e]}const zF=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),Bk=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"]),WF=["NORTH","SOUTH","WEST","EAST"];function GF(e){const t=br(e);if(xt(t.inputcurrent)||(t.inputcurrent=0),ue(t.inputqueue)||(t.inputqueue=[]),t.inputcurrent>0)return t;const[n]=t.inputqueue,[r=Sn.NONE,i=0]=n??[Sn.NONE,0];switch(t.inputmove=[],t.inputok=0,t.inputcancel=0,t.inputmenu=0,t.inputalt=i&RS?1:0,t.inputctrl=i&OS?1:0,t.inputshift=i&NS?1:0,r){case Sn.MOVE_UP:case Sn.MOVE_DOWN:case Sn.MOVE_LEFT:case Sn.MOVE_RIGHT:t.inputmove=[WF[r-Sn.MOVE_UP]];break;case Sn.OK_BUTTON:t.inputok=1;break;case Sn.CANCEL_BUTTON:t.inputcancel=1;break;case Sn.MENU_BUTTON:t.inputmenu=1;break}return t.inputcurrent=r,t.inputqueue=t.inputqueue.filter(s=>{const[o]=s;return o!==Sn.NONE&&o!==r}),t}function KF(e){const t=hd[e];if(k(t))return t;const n=ld[e];if(k(n))return n;const r=Jo[e];if(k(r))return r;const i=bh[e];if(k(i))return i}const HF=Ei({get(e,t){var o,a,c,l,u,f,d,h,m,p,b,y,v,T,A,U,S,C,j,N,W;const n=KF(t);if(k(n))return[!0,n];if(E.elementisplayer&&zF.has(t)){const q=GF(E.elementid)[t];return[k(q),q]}const r=Qo(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus),i=(r==null?void 0:r.id)??E.elementfocus??sr();switch(t){case"camera":case"graphics":case"facing":if(k((c=E.board)==null?void 0:c[t]))return[!0,(l=E.board)==null?void 0:l[t]];break;case"isdark":return[!0,(u=E.board)!=null&&u.isdark?1:0];case"startx":return[!0,((f=E.board)==null?void 0:f.startx)??0];case"starty":return[!0,((d=E.board)==null?void 0:d.starty)??0];case"over":return[!0,((h=E.board)==null?void 0:h.over)??""];case"under":return[!0,((m=E.board)==null?void 0:m.under)??""];case"exitnorth":return[!0,((p=E.board)==null?void 0:p.exitnorth)??""];case"exitsouth":return[!0,((b=E.board)==null?void 0:b.exitsouth)??""];case"exitwest":return[!0,((y=E.board)==null?void 0:y.exitwest)??""];case"exiteast":return[!0,((v=E.board)==null?void 0:v.exiteast)??""];case"timelimit":return[!0,((T=E.board)==null?void 0:T.timelimit)??0];case"restartonzap":return[!0,((A=E.board)==null?void 0:A.restartonzap)??0];case"maxplayershots":return[!0,((U=E.board)==null?void 0:U.maxplayershots)??0];case"currenttick":return[!0,E.timestamp];case"boardid":return[!0,((S=E.board)==null?void 0:S.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((C=E.element)==null?void 0:C.id)??""];case"thisx":return[!0,((j=E.element)==null?void 0:j.x)??-1];case"thisy":return[!0,((N=E.element)==null?void 0:N.y)??-1];default:{if(Bk.has(t)){const q=(W=E.element)==null?void 0:W[t];return t==="color"&&console.info("reading color",q),[!0,q]}break}}const s=br(i)[t];return[k(s),s]},set(e,t,n){var o,a;const r=Qo(E.board,{x:((o=E.element)==null?void 0:o.x)??-1,y:((a=E.element)==null?void 0:a.y)??-1},E.elementfocus),i=(r==null?void 0:r.id)??E.elementfocus;switch(t){case"camera":case"graphics":case"facing":break;case"isdark":if(k(E.board))return E.board.isdark=n?1:0,[!0,E.board.isdark];break;case"startx":if(k(E.board))return E.board.startx=ca(n,0),[!0,E.board.startx];break;case"starty":if(k(E.board))return E.board.starty=ca(n,0),[!0,E.board.starty];break;case"over":if(k(E.board))return E.board.over=Se(n),[!0,E.board.over];break;case"under":if(k(E.board))return[!0,E.board.under=Se(n)];break;case"exitnorth":if(k(E.board))return[!0,E.board.exitnorth=Se(n)];break;case"exitsouth":if(k(E.board))return[!0,E.board.exitsouth=Se(n)];break;case"exitwest":if(k(E.board))return[!0,E.board.exitwest=Se(n)];break;case"exiteast":if(k(E.board))return[!0,E.board.exiteast=Se(n)];break;case"timelimit":if(k(E.board))return[!0,E.board.timelimit=ca(n,0)];break;case"restartonzap":if(k(E.board))return[!0,E.board.restartonzap=n?1:0];break;case"maxplayershots":if(k(E.board))return[!0,E.board.maxplayershots=ca(n,0)];break;case"currenttick":return[!1,n];case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{if(Bk.has(t))return k(E.element)&&(E.element[t]=n),[!0,n];break}}const s=br(i);return k(s)?(s[t]=n,[!0,n]):[!1,n]},everytick(){var e,t,n,r,i;if(!((e=E.element)!=null&&e.removed)&&(k((t=E.element)==null?void 0:t.stepx)||k((n=E.element)==null?void 0:n.stepy))){const s={x:((r=E.element)==null?void 0:r.x)??0,y:((i=E.element)==null?void 0:i.y)??0};ts(E.book,E.board,E.element,{x:s.x+(E.element.stepx??0),y:s.y+(E.element.stepy??0)})===!1&&(E.element.stepx=0,E.element.stepy=0,Gt(E.element,"breakable")&&xn(E.board,E.element,E.timestamp))}}}).command("clear",(e,t)=>{for(let n=0;n<t.length;++n)e.set(Se(t[n]),0);return 0}).command("set",(e,t)=>{const[n,r]=st(t,0,[H.NAME,H.ANY]);return e.set(n,r??1),0}).command("become",(e,t)=>{var r,i;const[n]=st(t,0,[H.KIND]);if(Ae(E.board),Ch(E.board,E.element),xn(E.board,E.element,E.timestamp)){const s={x:((r=E.element)==null?void 0:r.x)??0,y:((i=E.element)==null?void 0:i.y)??0};$r(E.board,n,s)}return e.endofprogram(),0}).command("bind",()=>0).command("char",(e,t)=>{const[n]=st(t,0,[H.ANY]);if(Rr(n)){const[r,i]=st(t,0,[H.DIR,H.NUMBER]),s=ie(E.board,r.destpt);k(s)&&(s.char=i)}else k(E.element)&&xt(n)&&(E.element.char=n);return 0}).command("color",(e,t)=>{const[n]=st(t,0,[H.ANY]);if(Rr(n)){const[r,i]=st(t,0,[H.DIR,H.COLOR]),s=ie(E.board,r.destpt);k(s)&&sa(E.element,i)}else{const[r]=st(t,0,[H.COLOR]);k(E.element)&&k(r)&&sa(E.element,r)}return 0}).command("go",(e,t)=>{if(k(E.element)){const[n]=st(t,0,[H.DIR]);if(ts(E.book,E.board,E.element,n.destpt),e.yield(),E.element.x===n.destpt.x&&E.element.y===n.destpt.y)return 0}return 1}).command("walk",(e,t)=>{if(!k(E.element))return 0;const[n]=st(t,0,[H.DIR]),r=E.element.x??0,i=E.element.y??0;return E.element.stepx=n.destpt.x-r,E.element.stepy=n.destpt.y-i,0}).command("idle",e=>(e.yield(),0)).command("end",e=>(e.endofprogram(),0)).command("endwith",(e,t)=>{const[n]=st(t,0,[H.ANY]);return e.set("arg",n),e.command("end")}).command("lock",e=>(e.lock(e.id()),0)).command("restore",(e,t)=>(e.restore(Se(t[0])),0)).command("unlock",e=>(e.unlock(),0)).command("zap",(e,t)=>(e.zap(Se(t[0])),0)).command("cycle",(e,t)=>{if(k(E.element)){const[n]=st(t,0,[H.NUMBER]);E.element.cycle=pn(Math.round(n),1,255)}return 0}).command("die",e=>(xn(E.board,E.element,E.timestamp),e.endofprogram(),0)).command("endgame",()=>(e0(et,E.elementfocus),0)).command("run",(e,t)=>{const[n]=st(t,0,[H.NAME]);return Vl(n),0}).command("runwith",(e,t)=>{const[n,r]=st(t,0,[H.ANY,H.NAME]);return e.set("arg",n),Vl(r),0}),Ml={};function YF(e){var t;return(t=Ml[e])==null?void 0:t.arg}function VF(e){var t;return(t=Ml[e])==null?void 0:t.format}function Eo(e){var t;return(t=Ml[e])==null?void 0:t.content}function Pk(e,t,n,r,i){const s=ce($t.MAIN);if(!k(s))return;const o=Ss(s,bt.LOADER).filter(a=>{const c=Ts(a),l=c.format,u=yt(l)?new RegExp(l).test(t):!1,f=c.event,d=yt(f)?new RegExp(f).test(n):!1;return yt(l)&&yt(f)?u&&d:yt(l)?u:yt(f)?d:!1});for(let a=0;a<o.length;++a){const c=`${De()}_loader`;Ml[c]={arg:e,format:t,content:r,player:i},BP(c,o[a].code)}}function $k(e,t){if(!k(e))return;const n=It(t),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=e.dataview.getFloat32(e.cursor,r);return e.cursor+=4,i}case"float64":case"float64le":{const i=e.dataview.getFloat64(e.cursor,r);return e.cursor+=8,i}case"int8":case"int8le":{const i=e.dataview.getInt8(e.cursor);return e.cursor+=1,i}case"int16":case"int16le":{const i=e.dataview.getInt16(e.cursor,r);return e.cursor+=2,i}case"int32":case"int32le":{const i=e.dataview.getInt32(e.cursor,r);return e.cursor+=4,i}case"int64":case"int64le":{const i=e.dataview.getBigInt64(e.cursor,r);return e.cursor+=8,i}case"uint8":case"uint8le":{const i=e.dataview.getUint8(e.cursor);return e.cursor+=1,i}case"uint16":case"uint16le":{const i=e.dataview.getUint16(e.cursor,r);return e.cursor+=2,i}case"uint32":case"uint32le":{const i=e.dataview.getUint32(e.cursor,r);return e.cursor+=4,i}case"uint64":case"uint64le":{const i=e.dataview.getBigUint64(e.cursor,r);return e.cursor+=8,i}}}const XF=(e,t)=>{const n=Eo(e.id());if(!k(n))return 0;const[r,i]=st(t,0,[H.NAME]),s=It(r);switch(s){case"seek":{const[o]=st(t,i,[H.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=st(t,i,[H.NAME]);e.set(o,$k(n,s));break}case"text":{const[o,a]=st(t,i,[H.NAME,H.NAME]),c=$k(n,o);if(xt(c)&&yt(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),f=new TextDecoder("utf-8").decode(l);e.set(a,f),n.cursor+=c}break}case"palette":{const[o]=st(t,i,[H.NAME]),[a]=Zf(E.book,bt.PALETTE,o),c=Re(a);if(k(c)){const l=wS*Uc,u=ig(new Uint8Array(n.bytes.buffer,n.cursor,l));k(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=st(t,i,[H.NAME]),[a]=Zf(E.book,bt.CHARSET,o),c=Re(a);if(k(c)){const l=Fc*kS*Mh,u=sg(new Uint8Array(n.bytes.buffer,n.cursor,l));k(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},xo=e=>e!==null&&Object.prototype.toString.call(e)==="[object Object]",Ul=(e,t)=>{if(e===t)return!0;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(!Ul(e[n],t[n]))return!1;return!0}if(xo(e)&&xo(t)){const n=Object.entries(e),r=new Set(Object.keys(t));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!Ul(s,t[i]))return!1;r.delete(i)}return r.size===0}return!1},Fl=e=>{if(e===""||e===!1||e===null||e===void 0||Array.isArray(e)&&e.length===0)return!0;if(xo(e)){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}return!1},qF=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_",Dk=e=>e>="0"&&e<="9"||e==="-",JF=e=>e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||e==="_";var X;(function(e){e.TOK_EOF="EOF",e.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",e.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",e.TOK_RBRACKET="Rbracket",e.TOK_RPAREN="Rparen",e.TOK_COMMA="Comma",e.TOK_COLON="Colon",e.TOK_RBRACE="Rbrace",e.TOK_NUMBER="Number",e.TOK_CURRENT="Current",e.TOK_ROOT="Root",e.TOK_EXPREF="Expref",e.TOK_PIPE="Pipe",e.TOK_OR="Or",e.TOK_AND="And",e.TOK_EQ="EQ",e.TOK_GT="GT",e.TOK_LT="LT",e.TOK_GTE="GTE",e.TOK_LTE="LTE",e.TOK_NE="NE",e.TOK_FLATTEN="Flatten",e.TOK_STAR="Star",e.TOK_FILTER="Filter",e.TOK_DOT="Dot",e.TOK_NOT="Not",e.TOK_LBRACE="Lbrace",e.TOK_LBRACKET="Lbracket",e.TOK_LPAREN="Lparen",e.TOK_LITERAL="Literal"})(X||(X={}));const jk={"(":X.TOK_LPAREN,")":X.TOK_RPAREN,"*":X.TOK_STAR,",":X.TOK_COMMA,".":X.TOK_DOT,":":X.TOK_COLON,"@":X.TOK_CURRENT,$:X.TOK_ROOT,"]":X.TOK_RBRACKET,"{":X.TOK_LBRACE,"}":X.TOK_RBRACE},ZF={"!":!0,"<":!0,"=":!0,">":!0},QF={"	":!0,"\n":!0,"\r":!0," ":!0};class tB{constructor(){this._current=0}tokenize(t){const n=[];this._current=0;let r,i,s;for(;this._current<t.length;)if(qF(t[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(t),n.push({start:r,type:X.TOK_UNQUOTEDIDENTIFIER,value:i});else if(jk[t[this._current]]!==void 0)n.push({start:this._current,type:jk[t[this._current]],value:t[this._current]}),this._current+=1;else if(Dk(t[this._current]))s=this.consumeNumber(t),n.push(s);else if(t[this._current]==="[")s=this.consumeLBracket(t),n.push(s);else if(t[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(t),n.push({start:r,type:X.TOK_QUOTEDIDENTIFIER,value:i});else if(t[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(t),n.push({start:r,type:X.TOK_LITERAL,value:i});else if(t[this._current]==="`"){r=this._current;const o=this.consumeLiteral(t);n.push({start:r,type:X.TOK_LITERAL,value:o})}else if(ZF[t[this._current]]!==void 0)s=this.consumeOperator(t),s&&n.push(s);else if(QF[t[this._current]]!==void 0)this._current+=1;else if(t[this._current]==="&")r=this._current,this._current+=1,t[this._current]==="&"?(this._current+=1,n.push({start:r,type:X.TOK_AND,value:"&&"})):n.push({start:r,type:X.TOK_EXPREF,value:"&"});else if(t[this._current]==="|")r=this._current,this._current+=1,t[this._current]==="|"?(this._current+=1,n.push({start:r,type:X.TOK_OR,value:"||"})):n.push({start:r,type:X.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${t[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(t){const n=this._current;for(this._current+=1;this._current<t.length&&JF(t[this._current]);)this._current+=1;return t.slice(n,this._current)}consumeQuotedIdentifier(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=='"'&&this._current<r;){let i=this._current;t[i]==="\\"&&(t[i+1]==="\\"||t[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(t.slice(n,this._current))}consumeRawStringLiteral(t){const n=this._current;this._current+=1;const r=t.length;for(;t[this._current]!=="'"&&this._current<r;){let s=this._current;t[s]==="\\"&&(t[s+1]==="\\"||t[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,t.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(t){const n=this._current;this._current+=1;const r=t.length;for(;Dk(t[this._current])&&this._current<r;)this._current+=1;const i=parseInt(t.slice(n,this._current),10);return{start:n,value:i,type:X.TOK_NUMBER}}consumeLBracket(t){const n=this._current;return this._current+=1,t[this._current]==="?"?(this._current+=1,{start:n,type:X.TOK_FILTER,value:"[?"}):t[this._current]==="]"?(this._current+=1,{start:n,type:X.TOK_FLATTEN,value:"[]"}):{start:n,type:X.TOK_LBRACKET,value:"["}}consumeOperator(t){const n=this._current,r=t[n];if(this._current+=1,r==="!")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_NE,value:"!="}):{start:n,type:X.TOK_NOT,value:"!"};if(r==="<")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_LTE,value:"<="}):{start:n,type:X.TOK_LT,value:"<"};if(r===">")return t[this._current]==="="?(this._current+=1,{start:n,type:X.TOK_GTE,value:">="}):{start:n,type:X.TOK_GT,value:">"};if(r==="="&&t[this._current]==="=")return this._current+=1,{start:n,type:X.TOK_EQ,value:"=="}}consumeLiteral(t){this._current+=1;const n=this._current,r=t.length;for(;t[this._current]!=="`"&&this._current<r;){let o=this._current;t[o]==="\\"&&(t[o+1]==="\\"||t[o+1]==="`")?o+=2:o+=1,this._current=o}let i=t.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(t){const n='[{"',r=["true","false","null"],i="-0123456789";if(t==="")return!1;if(n.includes(t[0])||r.includes(t))return!0;if(i.includes(t[0]))try{return JSON.parse(t),!0}catch{return!1}return!1}}const eB=new tB,wn={[X.TOK_EOF]:0,[X.TOK_UNQUOTEDIDENTIFIER]:0,[X.TOK_QUOTEDIDENTIFIER]:0,[X.TOK_RBRACKET]:0,[X.TOK_RPAREN]:0,[X.TOK_COMMA]:0,[X.TOK_RBRACE]:0,[X.TOK_NUMBER]:0,[X.TOK_CURRENT]:0,[X.TOK_EXPREF]:0,[X.TOK_ROOT]:0,[X.TOK_PIPE]:1,[X.TOK_OR]:2,[X.TOK_AND]:3,[X.TOK_EQ]:5,[X.TOK_GT]:5,[X.TOK_LT]:5,[X.TOK_GTE]:5,[X.TOK_LTE]:5,[X.TOK_NE]:5,[X.TOK_FLATTEN]:9,[X.TOK_STAR]:20,[X.TOK_FILTER]:21,[X.TOK_DOT]:40,[X.TOK_NOT]:45,[X.TOK_LBRACE]:50,[X.TOK_LBRACKET]:55,[X.TOK_LPAREN]:60};class nB{constructor(){this.index=0,this.tokens=[]}parse(t){this.loadTokens(t),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==X.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(t){this.tokens=[...eB.tokenize(t),{type:X.TOK_EOF,value:"",start:t.length}]}expression(t){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;t<wn[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(t){return this.tokens[this.index+t].type}lookaheadToken(t){return this.tokens[this.index+t]}advance(){this.index+=1}nud(t){let n,r,i;switch(t.type){case X.TOK_LITERAL:return{type:"Literal",value:t.value};case X.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:t.value};case X.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:t.value};if(this.lookahead(0)===X.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case X.TOK_NOT:return r=this.expression(wn.Not),{type:"NotExpression",children:[r]};case X.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===X.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(wn.Star),{type:"ValueProjection",children:[n,r]};case X.TOK_FILTER:return this.led(t.type,{type:"Identity"});case X.TOK_LBRACE:return this.parseMultiselectHash();case X.TOK_FLATTEN:return n={type:X.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(wn.Flatten),{type:"Projection",children:[n,r]};case X.TOK_LBRACKET:return this.lookahead(0)===X.TOK_NUMBER||this.lookahead(0)===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===X.TOK_STAR&&this.lookahead(1)===X.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(wn.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case X.TOK_CURRENT:return{type:X.TOK_CURRENT};case X.TOK_ROOT:return{type:X.TOK_ROOT};case X.TOK_EXPREF:return i=this.expression(wn.Expref),{type:"ExpressionReference",children:[i]};case X.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(i={type:X.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(X.TOK_RPAREN),o[0];default:this.errorToken(t)}}led(t,n){let r;switch(t){case X.TOK_DOT:const i=wn.Dot;return this.lookahead(0)!==X.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case X.TOK_PIPE:return r=this.expression(wn.Pipe),{type:X.TOK_PIPE,children:[n,r]};case X.TOK_OR:return r=this.expression(wn.Or),{type:"OrExpression",children:[n,r]};case X.TOK_AND:return r=this.expression(wn.And),{type:"AndExpression",children:[n,r]};case X.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==X.TOK_RPAREN;)this.lookahead(0)===X.TOK_CURRENT?(a={type:X.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===X.TOK_COMMA&&this.match(X.TOK_COMMA),o.push(a);return this.match(X.TOK_RPAREN),{name:s,type:"Function",children:o};case X.TOK_FILTER:const l=this.expression(0);return this.match(X.TOK_RBRACKET),r=this.lookahead(0)===X.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(wn.Filter),{type:"FilterProjection",children:[n,r,l]};case X.TOK_FLATTEN:const u={type:X.TOK_FLATTEN,children:[n]},f=this.parseProjectionRHS(wn.Flatten);return{type:"Projection",children:[u,f]};case X.TOK_EQ:case X.TOK_NE:case X.TOK_GT:case X.TOK_GTE:case X.TOK_LT:case X.TOK_LTE:return this.parseComparator(n,t);case X.TOK_LBRACKET:const d=this.lookaheadToken(0);return d.type===X.TOK_NUMBER||d.type===X.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(X.TOK_STAR),this.match(X.TOK_RBRACKET),r=this.parseProjectionRHS(wn.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(t){if(this.lookahead(0)===t){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${t}, got: ${n.type}`)}}errorToken(t,n=""){const r=new Error(n||`Invalid token (${t.type}): "${t.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===X.TOK_COLON||this.lookahead(1)===X.TOK_COLON)return this.parseSliceExpression();const t={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(X.TOK_RBRACKET),t}projectIfSlice(t,n){const r={type:"IndexExpression",children:[t,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(wn.Star)],type:"Projection"}:r}parseSliceExpression(){const t=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==X.TOK_RBRACKET&&n<3;){if(r===X.TOK_COLON)n+=1,this.advance();else if(r===X.TOK_NUMBER)t[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(X.TOK_RBRACKET),{children:t,type:"Slice"}}parseComparator(t,n){const r=this.expression(wn[n]);return{type:"Comparator",name:n,children:[t,r]}}parseDotRHS(t){const n=this.lookahead(0);if([X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER,X.TOK_STAR].includes(n))return this.expression(t);if(n===X.TOK_LBRACKET)return this.match(X.TOK_LBRACKET),this.parseMultiselectList();if(n===X.TOK_LBRACE)return this.match(X.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(t){if(wn[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===X.TOK_LBRACKET)return this.expression(t);if(this.lookahead(0)===X.TOK_FILTER)return this.expression(t);if(this.lookahead(0)===X.TOK_DOT)return this.match(X.TOK_DOT),this.parseDotRHS(t);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const t=[];for(;this.lookahead(0)!==X.TOK_RBRACKET;){const n=this.expression(0);if(t.push(n),this.lookahead(0)===X.TOK_COMMA&&(this.match(X.TOK_COMMA),this.lookahead(0)===X.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(X.TOK_RBRACKET),{type:"MultiSelectList",children:t}}parseMultiselectHash(){const t=[],n=[X.TOK_UNQUOTEDIDENTIFIER,X.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(X.TOK_COLON),s=this.expression(0),t.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===X.TOK_COMMA)this.match(X.TOK_COMMA);else if(this.lookahead(0)===X.TOK_RBRACE){this.match(X.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:t}}}const rB=new nB;var dt;(function(e){e[e.TYPE_NUMBER=0]="TYPE_NUMBER",e[e.TYPE_ANY=1]="TYPE_ANY",e[e.TYPE_STRING=2]="TYPE_STRING",e[e.TYPE_ARRAY=3]="TYPE_ARRAY",e[e.TYPE_OBJECT=4]="TYPE_OBJECT",e[e.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",e[e.TYPE_EXPREF=6]="TYPE_EXPREF",e[e.TYPE_NULL=7]="TYPE_NULL",e[e.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",e[e.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(dt||(dt={}));class iB{constructor(t){this.TYPE_NAME_TABLE={[dt.TYPE_NUMBER]:"number",[dt.TYPE_ANY]:"any",[dt.TYPE_STRING]:"string",[dt.TYPE_ARRAY]:"array",[dt.TYPE_OBJECT]:"object",[dt.TYPE_BOOLEAN]:"boolean",[dt.TYPE_EXPREF]:"expression",[dt.TYPE_NULL]:"null",[dt.TYPE_ARRAY_NUMBER]:"Array<number>",[dt.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>xo(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===dt.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[dt.TYPE_NUMBER,dt.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===dt.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[dt.TYPE_NUMBER,dt.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==dt.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===dt.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![dt.TYPE_NUMBER,dt.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),f=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(f)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(f)]}`);return u>f?1:u<f?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===dt.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===dt.TYPE_NUMBER?n:r===dt.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===dt.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case dt.TYPE_NUMBER:return"number";case dt.TYPE_STRING:return"string";case dt.TYPE_ARRAY:return"array";case dt.TYPE_OBJECT:return"object";case dt.TYPE_BOOLEAN:return"boolean";case dt.TYPE_EXPREF:return"expref";case dt.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[dt.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[dt.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[dt.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[dt.TYPE_STRING,dt.TYPE_ARRAY]},{types:[dt.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[dt.TYPE_STRING]},{types:[dt.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[dt.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[dt.TYPE_STRING]},{types:[dt.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[dt.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[dt.TYPE_STRING,dt.TYPE_ARRAY,dt.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[dt.TYPE_EXPREF]},{types:[dt.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[dt.TYPE_ARRAY_NUMBER,dt.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[dt.TYPE_ARRAY]},{types:[dt.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[dt.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[dt.TYPE_ARRAY_NUMBER,dt.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[dt.TYPE_ARRAY]},{types:[dt.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[dt.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[dt.TYPE_STRING,dt.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[dt.TYPE_ARRAY_STRING,dt.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[dt.TYPE_ARRAY]},{types:[dt.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[dt.TYPE_STRING]},{types:[dt.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[dt.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[dt.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[dt.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[dt.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[dt.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[dt.TYPE_OBJECT]}]}},this._interpreter=t}registerFunction(t,n,r){if(t in this.functionTable)throw new Error(`Function already defined: ${t}()`);this.functionTable[t]={_func:n.bind(this),_signature:r}}callFunction(t,n){const r=this.functionTable[t];if(r===void 0)throw new Error(`Unknown function: ${t}()`);return this.validateArgs(t,n,r._signature),r._func.call(this,n)}validateInputSignatures(t,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${t}() 'variadic' argument ${r+1} must occur last`)}validateArgs(t,n,r){var i,s;let o;this.validateInputSignatures(t,r);const a=r.filter(p=>{var b;return(b=!p.optional)!==null&&b!==void 0?b:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,f=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${t}() takes ${f}${a} argument${o&&"s"||""} but received ${n.length}`);let d,h,m;for(let p=0;p<r.length;p+=1){m=!1,d=r[p].types,h=this.getTypeName(n[p]);let b;for(b=0;b<d.length;b+=1)if(h!==void 0&&this.typeMatches(h,d[b],n[p])){m=!0;break}if(!m&&h!==void 0){const y=d.map(v=>this.TYPE_NAME_TABLE[v]).join(" | ");throw new Error(`TypeError: ${t}() expected argument ${p+1} to be type (${y}) but received type ${this.TYPE_NAME_TABLE[h]} instead.`)}}}typeMatches(t,n,r){if(n===dt.TYPE_ANY)return!0;if(n===dt.TYPE_ARRAY_STRING||n===dt.TYPE_ARRAY_NUMBER||n===dt.TYPE_ARRAY){if(n===dt.TYPE_ARRAY)return t===dt.TYPE_ARRAY;if(t===dt.TYPE_ARRAY){let i;n===dt.TYPE_ARRAY_NUMBER?i=dt.TYPE_NUMBER:n===dt.TYPE_ARRAY_STRING&&(i=dt.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return t===n;return!1}getTypeName(t){switch(Object.prototype.toString.call(t)){case"[object String]":return dt.TYPE_STRING;case"[object Number]":return dt.TYPE_NUMBER;case"[object Array]":return dt.TYPE_ARRAY;case"[object Boolean]":return dt.TYPE_BOOLEAN;case"[object Null]":return dt.TYPE_NULL;case"[object Object]":return t.jmespathType===X.TOK_EXPREF?dt.TYPE_EXPREF:dt.TYPE_OBJECT;default:return}}createKeyFunction(t,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(t,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class sB{constructor(){this._rootValue=null,this.runtime=new iB(this)}search(t,n){return this._rootValue=n,this.visit(t,n)}visit(t,n){let r,i,s,o,a,c,l,u,f,d,h;switch(t.type){case"Field":return n===null?null:xo(n)?(c=n[t.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(t.children[0],n),d=1;d<t.children.length;d+=1)if(s=this.visit(t.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(t.children[0],n),u=this.visit(t.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let m=t.value;return m<0&&(m=n.length+m),s=n[m],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const p=[...t.children],b=this.computeSliceParams(n.length,p),[y,v,T]=b;if(s=[],T>0)for(d=y;d<v;d+=T)s.push(n[d]);else for(d=y;d>v;d+=T)s.push(n[d]);return s;case"Projection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;for(f=[],d=0;d<h.length;d+=1)i=this.visit(t.children[1],h[d]),i!==null&&f.push(i);return f;case"ValueProjection":if(h=this.visit(t.children[0],n),!xo(h))return null;f=[];const A=Object.values(h);for(d=0;d<A.length;d+=1)i=this.visit(t.children[1],A[d]),i!==null&&f.push(i);return f;case"FilterProjection":if(h=this.visit(t.children[0],n),!Array.isArray(h))return null;const U=[],S=[];for(d=0;d<h.length;d+=1)r=this.visit(t.children[2],h[d]),Fl(r)||U.push(h[d]);for(let L=0;L<U.length;L+=1)i=this.visit(t.children[1],U[L]),i!==null&&S.push(i);return S;case"Comparator":switch(o=this.visit(t.children[0],n),a=this.visit(t.children[1],n),t.name){case X.TOK_EQ:s=Ul(o,a);break;case X.TOK_NE:s=!Ul(o,a);break;case X.TOK_GT:s=o>a;break;case X.TOK_GTE:s=o>=a;break;case X.TOK_LT:s=o<a;break;case X.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${t.name}`)}return s;case X.TOK_FLATTEN:const C=this.visit(t.children[0],n);if(!Array.isArray(C))return null;let j=[];for(d=0;d<C.length;d+=1)i=C[d],Array.isArray(i)?j=[...j,...i]:j.push(i);return j;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(f=[],d=0;d<t.children.length;d+=1)f.push(this.visit(t.children[d],n));return f;case"MultiSelectHash":if(n===null)return null;f={};let N;for(d=0;d<t.children.length;d+=1)N=t.children[d],f[N.name]=this.visit(N.value,n);return f;case"OrExpression":return r=this.visit(t.children[0],n),Fl(r)&&(r=this.visit(t.children[1],n)),r;case"AndExpression":return o=this.visit(t.children[0],n),Fl(o)?o:this.visit(t.children[1],n);case"NotExpression":return o=this.visit(t.children[0],n),Fl(o);case"Literal":return t.value;case X.TOK_PIPE:return l=this.visit(t.children[0],n),this.visit(t.children[1],l);case X.TOK_CURRENT:return n;case X.TOK_ROOT:return this._rootValue;case"Function":const W=[];for(let L=0;L<t.children.length;L+=1)W.push(this.visit(t.children[L],n));return this.runtime.callFunction(t.name,W);case"ExpressionReference":const q=t.children[0];return q.jmespathType=X.TOK_EXPREF,q;default:throw new Error(`Unknown node type: ${t.type}`)}}computeSliceParams(t,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?t-1:0:this.capSliceRange(t,r,s),i=i===null?o?-1:t:this.capSliceRange(t,i,s),[r,i,s]}capSliceRange(t,n,r){let i=n;return i<0?(i+=t,i<0&&(i=r<0?-1:0)):i>=t&&(i=r<0?t-1:t),i}}const oB=new sB;dt.TYPE_ANY,dt.TYPE_ARRAY,dt.TYPE_ARRAY_NUMBER,dt.TYPE_ARRAY_STRING,dt.TYPE_BOOLEAN,dt.TYPE_EXPREF,dt.TYPE_NULL,dt.TYPE_NUMBER,dt.TYPE_OBJECT,dt.TYPE_STRING;function aB(e,t){const n=rB.parse(t);return oB.search(n,e)}const cB=(e,t)=>{const n=Eo(e.id());if(!k(n))return 0;const[r,i]=st(t,0,[H.NAME,H.NAME]),s=aB(n.json,r);return e.set(i,s),0},lB=(e,t)=>{const n=Eo(e.id());if(!k(n))return 0;const[r,i]=st(t,0,[H.NAME]);switch(It(r)){case"seek":{const[o]=st(t,i,[H.NUMBER]);n.cursor=pn(o,0,n.lines.length-1);break}case"line":n.cursor=pn(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<t.length;){const[f,d]=st(t,u,[H.NAME]);e.set(f,c[l]??0),++l,u=d}break}}return 0};function zk(e){const t=ce($t.MAIN),n=ko(t);k(e.targetdir)?Oo(e.targetdir.destpt,e.label,void 0,n):k(e.targetname)&&Oo(e.targetname,e.label,void 0,n)}const uB=Ei({get(e,t){const n=VF(e.id());if(t==="format")return[!0,n];switch(n){case"text":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename]}break}case"binary":{const r=Eo(e.id());switch(t){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("shortsend",(e,t)=>{const n=Ii(t);return zk(n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return zk(n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Se).join(" ");return xe(et,E.elementfocus,"$175",n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Se(n),s=Ii(r);return k(s.targetname)&&xe(et,E.elementfocus,"$175",`!${s.targetname}${s.label};${i}`),0}).command("readline",lB).command("readjson",cB).command("readbin",XF).command("withboard",(e,t)=>{const[n]=st(t,0,[H.STRING]),r=un(n);return k(r)&&(E.board=r,E.element={x:-1,y:-1}),0});function Wk(e,t,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=st(i,a,[H.ANY]);ue(c)&&!Rr(c)&&!Ma(c)&&!Ll(c)&&!qr(c)?o.push(...c):o.push(c),a=l}switch(It(r)){case"get":case"post:json":zE(et,E.elementfocus,e,t,n,r,o);break}return 0}const hB=Ei().command("fetch",(e,t)=>{const[n,r,i="get",s]=st(t,0,[H.NAME,H.NAME,H.MAYBE_STRING]);return Wk(void 0,n,r,i,t,s),0}).command("fetchwith",(e,t)=>{const[n,r,i,s="get",o]=st(t,0,[H.ANY,H.NAME,H.NAME,H.MAYBE_STRING]);return Wk(n,r,i,s,t,o),0}).command("chat",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return n?DE(et,E.elementfocus,n):jE(et,E.elementfocus),0}).command("broadcast",(e,t)=>{const[n]=st(t,0,[H.MAYBE_NAME]);return n?PE(et,E.elementfocus,n):$E(et,E.elementfocus),0});function Gk(e,t){var n,r;if(k(t.targetname))switch(t.targetname){case"all":for(const i of Object.keys(((n=E.board)==null?void 0:n.objects)??{}))e.send(E.elementfocus,i,t.label);break;case"self":e.message({session:et.session(),player:E.elementfocus,id:De(),sender:e.id(),target:t.label});break;case"others":for(const i of Object.keys(((r=E.board)==null?void 0:r.objects)??{}))i!==e.id()&&e.send(E.elementfocus,i,t.label);break;default:{const i=km(E.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];k(o.id)&&e.send(E.elementfocus,o.id,t.label)}break}}else if(k(t.targetdir)){const i=ie(E.board,t.targetdir.destpt);k(i==null?void 0:i.id)&&e.send(E.elementfocus,i.id,t.label)}}const fB=Ei({set(e,t,n){return n$(e,t,n),[!1,void 0]},everytick(){const e=Tn(E.elementid),[t]=e;if(e.length===1&&yt(t)){if(k(E.element))if(t.trim().length===0){const n=Ye(E.elementid);n.sidebar=[]}else E.element.tickertext=t,E.element.tickertime=E.timestamp}else if(e.length>1)if(E.elementisplayer){const n=Ye(E.elementid);n.sidebar=e}else{const n=Ye(E.elementfocus);n.scroll=e}}}).command("shortsend",(e,t)=>{const n=Ii(t);return Gk(e,n),0}).command("send",(e,t)=>{const n=Ii(["send",...t]);return Gk(e,n),0}).command("stat",()=>0).command("text",(e,t)=>{const n=t.map(Se).join("");return Rt(E.elementid,n),0}).command("hyperlink",(e,t)=>{const[n,...r]=t,i=Se(n),s=Ii(r);return k(s.targetname)&&Lt(E.elementid,e.id(),i,`${s.targetname}:${s.label}`.split(" "),e.get,e.set),0});function dB(e,t,n,r,i){if(!k(E.book))return;const s=E.book,o=en(s,bt.BOARD,e),a=Re(o);if(!k(a))return;const c=Xl(),l=i==="all"||i==="object",u=i==="all"||i==="terrain";Ae(a),Ae(c);const f=-Math.tan(t*.5),d=Math.sin(t),h=Math.round(12.5*f),m=Math.round(12.5*d),p=new Array(Vt).fill(0);Zp(h,0,-h,Vt-1).forEach(A=>{A.x<0?p[A.y]=Math.min(p[A.y],A.x):p[A.y]=Math.max(p[A.y],A.x)});const y=new Array(St).fill(0);Zp(0,m,St-1,-m).forEach(A=>{A.y<0?y[A.x]=Math.min(y[A.x],A.y):y[A.x]=Math.max(y[A.x],A.y)});const T=[p,y,p];for(let A=0;A<T.length;++A){const U=T[A];if(A!==1){for(let S=0;S<Vt;++S){const C=U[S],j=S*St;for(let N=0;N<St;N++){const W=(N+C+St)%St;u&&(c.terrain[W+j]=a.terrain[N+j])}}if(l){const S=Object.keys(a.objects);for(let C=0;C<S.length;++C){const j=S[C],{x:N,y:W}=a.objects[j];if(k(N)&&k(W)){const q=U[W];a.objects[j].x=(N+q+St)%St,a.objects[j].lx=a.objects[j].x}}}}if(A===1){for(let S=0;S<St;++S){const C=U[S];for(let j=0;j<Vt;++j){const N=(j+C+Vt)%Vt;u&&(c.terrain[S+N*St]=a.terrain[S+j*St])}}if(l){const S=Object.keys(a.objects);for(let C=0;C<S.length;++C){const j=S[C],{x:N,y:W}=a.objects[j];if(k(N)&&k(W)){const q=U[N];a.objects[j].y=(W+q+Vt)%Vt,a.objects[j].ly=a.objects[j].y}}}}u&&(a.terrain=[...c.terrain]),delete c.named,delete c.lookup,delete a.named,delete a.lookup,Ae(c),Ae(a)}}function pB(e,t){let n=0,r=0,i=0;for(;i<e.length;i++)n+=e[i];for(i=0,t*=n;t&&i<e.length;){if(r+=e[i],t<=r)return i;i++}return 0}var mB=pB;const gB=mB,ne=function(){};ne.prototype.FMX=0,ne.prototype.FMY=0,ne.prototype.FMXxFMY=0,ne.prototype.T=0,ne.prototype.N=0,ne.prototype.initiliazedField=!1,ne.prototype.generationComplete=!1,ne.prototype.wave=null,ne.prototype.compatible=null,ne.prototype.weightLogWeights=null,ne.prototype.sumOfWeights=0,ne.prototype.sumOfWeightLogWeights=0,ne.prototype.startingEntropy=0,ne.prototype.sumsOfOnes=null,ne.prototype.sumsOfWeights=null,ne.prototype.sumsOfWeightLogWeights=null,ne.prototype.entropies=null,ne.prototype.propagator=null,ne.prototype.observed=null,ne.prototype.distribution=null,ne.prototype.stack=null,ne.prototype.stackSize=0,ne.prototype.DX=[-1,0,1,0],ne.prototype.DY=[0,1,0,-1],ne.prototype.opposite=[2,3,0,1],ne.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let e=0;e<this.FMXxFMY;e++){this.wave[e]=new Array(this.T),this.compatible[e]=new Array(this.T);for(let t=0;t<this.T;t++)this.compatible[e][t]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let e=0;e<this.T;e++)this.weightLogWeights[e]=this.weights[e]*Math.log(this.weights[e]),this.sumOfWeights+=this.weights[e],this.sumOfWeightLogWeights+=this.weightLogWeights[e];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},ne.prototype.observe=function(e){let t=1e3,n=-1;for(let s=0;s<this.FMXxFMY;s++){if(this.onBoundary(s%this.FMX,s/this.FMX|0))continue;const o=this.sumsOfOnes[s];if(o===0)return!1;const a=this.entropies[s];if(o>1&&a<=t){const c=1e-6*e();a+c<t&&(t=a+c,n=s)}}if(n===-1){this.observed=new Array(this.FMXxFMY);for(let s=0;s<this.FMXxFMY;s++)for(let o=0;o<this.T;o++)if(this.wave[s][o]){this.observed[s]=o;break}return!0}for(let s=0;s<this.T;s++)this.distribution[s]=this.wave[n][s]?this.weights[s]:0;const r=gB(this.distribution,e()),i=this.wave[n];for(let s=0;s<this.T;s++)i[s]!==(s===r)&&this.ban(n,s);return null},ne.prototype.propagate=function(){for(;this.stackSize>0;){const e=this.stack[this.stackSize-1];this.stackSize--;const t=e[0],n=t%this.FMX,r=t/this.FMX|0;for(let i=0;i<4;i++){const s=this.DX[i],o=this.DY[i];let a=n+s,c=r+o;if(this.onBoundary(a,c))continue;a<0?a+=this.FMX:a>=this.FMX&&(a-=this.FMX),c<0?c+=this.FMY:c>=this.FMY&&(c-=this.FMY);const l=a+c*this.FMX,u=this.propagator[i][e[1]],f=this.compatible[l];for(let d=0;d<u.length;d++){const h=u[d],m=f[h];m[i]--,m[i]==0&&this.ban(l,h)}}}},ne.prototype.singleIteration=function(e){const t=this.observe(e);return t!==null?(this.generationComplete=t,!!t):(this.propagate(),null)},ne.prototype.iterate=function(e,t){this.wave||this.initialize(),this.initiliazedField||this.clear(),e=e||0,t=t||Math.random;for(let n=0;n<e||e===0;n++){const r=this.singleIteration(t);if(r!==null)return!!r}return!0},ne.prototype.generate=function(e){for(e=e||Math.random,this.wave||this.initialize(),this.clear();;){const t=this.singleIteration(e);if(t!==null)return!!t}},ne.prototype.isGenerationComplete=function(){return this.generationComplete},ne.prototype.ban=function(e,t){const n=this.compatible[e][t];for(let i=0;i<4;i++)n[i]=0;this.wave[e][t]=!1,this.stack[this.stackSize]=[e,t],this.stackSize++,this.sumsOfOnes[e]-=1,this.sumsOfWeights[e]-=this.weights[t],this.sumsOfWeightLogWeights[e]-=this.weightLogWeights[t];const r=this.sumsOfWeights[e];this.entropies[e]=Math.log(r)-this.sumsOfWeightLogWeights[e]/r},ne.prototype.clear=function(){for(let e=0;e<this.FMXxFMY;e++){for(let t=0;t<this.T;t++){this.wave[e][t]=!0;for(let n=0;n<4;n++)this.compatible[e][t][n]=this.propagator[this.opposite[n]][t].length}this.sumsOfOnes[e]=this.weights.length,this.sumsOfWeights[e]=this.sumOfWeights,this.sumsOfWeightLogWeights[e]=this.sumOfWeightLogWeights,this.entropies[e]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1};var Kk=ne;const Hk=Kk,Ci=function(t,n,r,i,s,o,a,c,l,u){u=u||0,this.N=i,this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=c;const f=n,d=new Array(f);for(let N=0;N<f;N++)d[N]=new Array(r);this.colors=[];const h={};for(let N=0;N<r;N++)for(let W=0;W<n;W++){const q=(N*n+W)*4,L=[t[q],t[q+1],t[q+2],t[q+3]],O=L.join("-");h.hasOwnProperty(O)||(h[O]=this.colors.length,this.colors.push(L)),d[W][N]=h[O]}const m=this.colors.length,p=Math.pow(m,i*i),b=function(W){let q=new Array(i*i);for(let L=0;L<i;L++)for(let O=0;O<i;O++)q[O+L*i]=W(O,L);return q},y=function(W,q){return b(function(L,O){return d[(W+L)%n][(q+O)%r]})},v=function(W){return b(function(q,L){return W[i-1-L+q*i]})},T=function(W){return b(function(q,L){return W[i-1-q+L*i]})},A=function(W){let q=0,L=1;for(let O=0;O<W.length;O++)q+=W[W.length-1-O]*L,L*=m;return q},U=function(W){let q=W,L=p;const O=new Array(i*i);for(let w=0;w<O.length;w++){L/=m;let I=0;for(;q>=L;)q-=L,I++;O[w]=I}return O},S={},C=[];for(let N=0;N<(a?r:r-i+1);N++)for(let W=0;W<(a?n:n-i+1);W++){const q=new Array(8);q[0]=y(W,N),q[1]=T(q[0]),q[2]=v(q[0]),q[3]=T(q[2]),q[4]=v(q[2]),q[5]=T(q[4]),q[6]=v(q[4]),q[7]=T(q[6]);for(let L=0;L<l;L++){const O=A(q[L]);S[O]?S[O]++:(C.push(O),S[O]=1)}}this.T=C.length,this.ground=(u+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let N=0;N<this.T;N++){const W=parseInt(C[N],10);this.patterns[N]=U(W),this.weights[N]=S[W]}const j=function(W,q,L,O){const w=L<0?0:L,I=L<0?L+i:i,$=O<0?0:O,B=O<0?O+i:i;for(let it=$;it<B;it++)for(let Q=w;Q<I;Q++)if(W[Q+i*it]!=q[Q-L+i*(it-O)])return!1;return!0};this.propagator=new Array(4);for(let N=0;N<4;N++){this.propagator[N]=new Array(this.T);for(let W=0;W<this.T;W++){const q=[];for(let L=0;L<this.T;L++)j(this.patterns[W],this.patterns[L],this.DX[N],this.DY[N])&&q.push(L);this.propagator[N][W]=q}}};Ci.prototype=Object.create(Hk.prototype),Ci.prototype.constructor=Ci,Ci.prototype.onBoundary=function(e,t){return!this.periodic&&(e+this.N>this.FMX||t+this.N>this.FMY||e<0||t<0)},Ci.prototype.clear=function(){if(Hk.prototype.clear.call(this),this.ground!==0){for(let e=0;e<this.FMX;e++){for(let t=0;t<this.T;t++)t!==this.ground&&this.ban(e+(this.FMY-1)*this.FMX,t);for(let t=0;t<this.FMY-1;t++)this.ban(e+t*this.FMX,this.ground)}this.propagate()}},Ci.prototype.graphics=function(e){return e=e||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e),e},Ci.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMY;t++){const n=t<this.FMY-this.N+1?0:this.N-1;for(let r=0;r<this.FMX;r++){const i=r<this.FMX-this.N+1?0:this.N-1,s=(t*this.FMX+r)*4,o=this.colors[this.patterns[this.observed[r-i+(t-n)*this.FMX]][i+n*this.N]];e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3]}}},Ci.prototype.graphicsIncomplete=function(e){for(let t=0;t<this.FMXxFMY;t++){const n=t%this.FMX,r=t/this.FMX|0;let i=0,s=0,o=0,a=0,c=0;for(let u=0;u<this.N;u++)for(let f=0;f<this.N;f++){let d=n-f;d<0&&(d+=this.FMX);let h=r-u;if(h<0&&(h+=this.FMY),this.onBoundary(d,h))continue;const m=d+h*this.FMX;for(let p=0;p<this.T;p++)if(this.wave[m][p]){i++;const b=this.colors[this.patterns[p][f+u*this.N]];s+=b[0],o+=b[1],a+=b[2],c+=b[3]}}const l=t*4;e[l]=s/i,e[l+1]=o/i,e[l+2]=a/i,e[l+3]=c/i}};var _B=Ci;const yB=Kk,qi=function(t,n,r,i,s){const o=t.tilesize||16;this.FMX=r,this.FMY=i,this.FMXxFMY=r*i,this.periodic=s,this.tilesize=o;const a=!!t.unique;let c=null;n&&t.subsets&&t.subsets[n]&&(c=t.subsets[n]);const l=function(A){const U=new Array(o*o);for(let S=0;S<o;S++)for(let C=0;C<o;C++)U[C+S*o]=A(C,S);return U},u=function(A){return l(function(U,S){return A[o-1-S+U*o]})},f=function(A){return l(function(U,S){return A[o-1-U+S*o]})};this.tiles=[];const d=[],h=[],m={};let p,b,y;for(let T=0;T<t.tiles.length;T++){const A=t.tiles[T];if(c!==null&&c.indexOf(A.name)===-1)continue;switch(A.symmetry){case"L":y=4,p=function(S){return(S+1)%4},b=function(S){return S%2===0?S+1:S-1};break;case"T":y=4,p=function(S){return(S+1)%4},b=function(S){return S%2===0?S:4-S};break;case"I":y=2,p=function(S){return 1-S},b=function(S){return S};break;case"\\":y=2,p=function(S){return 1-S},b=function(S){return 1-S};break;case"F":y=8,p=function(S){return S<4?(S+1)%4:4+(S-1)%4},b=function(S){return S<4?S+4:S-4};break;default:y=1,p=function(S){return S},b=function(S){return S};break}this.T=h.length,m[A.name]=this.T;for(let S=0;S<y;S++)h.push([this.T+S,this.T+p(S),this.T+p(p(S)),this.T+p(p(p(S))),this.T+b(S),this.T+b(p(S)),this.T+b(p(p(S))),this.T+b(p(p(p(S))))]);let U;if(a)for(let S=0;S<y;S++)U=A.bitmap[S],this.tiles.push(l(function(C,j){return[U[(o*j+C)*4],U[(o*j+C)*4+1],U[(o*j+C)*4+2],U[(o*j+C)*4+3]]}));else{U=A.bitmap,this.tiles.push(l(function(S,C){return[U[(o*C+S)*4],U[(o*C+S)*4+1],U[(o*C+S)*4+2],U[(o*C+S)*4+3]]}));for(let S=1;S<y;S++)this.tiles.push(S<4?u(this.tiles[this.T+S-1]):f(this.tiles[this.T+S-4]))}for(let S=0;S<y;S++)d.push(A.weight||1)}this.T=h.length,this.weights=d,this.propagator=new Array(4);const v=new Array(4);for(let T=0;T<4;T++){this.propagator[T]=new Array(this.T),v[T]=new Array(this.T);for(let A=0;A<this.T;A++){v[T][A]=new Array(this.T);for(let U=0;U<this.T;U++)v[T][A][U]=!1}}for(let T=0;T<t.neighbors.length;T++){const A=t.neighbors[T],U=A.left.split(" ").filter(function(q){return q.length}),S=A.right.split(" ").filter(function(q){return q.length});if(c!==null&&(c.indexOf(U[0])===-1||c.indexOf(S[0])===-1))continue;const C=h[m[U[0]]][U.length==1?0:parseInt(U[1],10)],j=h[C][1],N=h[m[S[0]]][S.length==1?0:parseInt(S[1],10)],W=h[N][1];v[0][N][C]=!0,v[0][h[N][6]][h[C][6]]=!0,v[0][h[C][4]][h[N][4]]=!0,v[0][h[C][2]][h[N][2]]=!0,v[1][W][j]=!0,v[1][h[j][6]][h[W][6]]=!0,v[1][h[W][4]][h[j][4]]=!0,v[1][h[j][2]][h[W][2]]=!0}for(let T=0;T<this.T;T++)for(let A=0;A<this.T;A++)v[2][T][A]=v[0][A][T],v[3][T][A]=v[1][A][T];for(let T=0;T<4;T++)for(let A=0;A<this.T;A++){const U=[],S=v[T][A];for(let C=0;C<this.T;C++)S[C]&&U.push(C);this.propagator[T][A]=U}};qi.prototype=Object.create(yB.prototype),qi.prototype.constructor=qi,qi.prototype.onBoundary=function(e,t){return!this.periodic&&(e<0||t<0||e>=this.FMX||t>=this.FMY)},qi.prototype.graphics=function(e,t){return e=e||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(e):this.graphicsIncomplete(e,t),e},qi.prototype.graphicsComplete=function(e){for(let t=0;t<this.FMX;t++)for(let n=0;n<this.FMY;n++){const r=this.tiles[this.observed[t+n*this.FMX]];for(let i=0;i<this.tilesize;i++)for(let s=0;s<this.tilesize;s++){const o=(t*this.tilesize+s+(n*this.tilesize+i)*this.FMX*this.tilesize)*4,a=r[s+i*this.tilesize];e[o]=a[0],e[o+1]=a[1],e[o+2]=a[2],e[o+3]=a[3]}}},qi.prototype.graphicsIncomplete=function(e,t){(!t||t.length!==4)&&(t=!1);for(let n=0;n<this.FMX;n++)for(let r=0;r<this.FMY;r++){const i=this.wave[n+r*this.FMX];let s=0,o=0;for(let c=0;c<this.T;c++)i[c]&&(s++,o+=this.weights[c]);const a=1/o;for(let c=0;c<this.tilesize;c++)for(let l=0;l<this.tilesize;l++){const u=(n*this.tilesize+l+(r*this.tilesize+c)*this.FMX*this.tilesize)*4;if(t&&s===this.T)e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];else{let f=0,d=0,h=0,m=0;for(let p=0;p<this.T;p++)if(i[p]){const b=this.tiles[p][l+c*this.tilesize],y=this.weights[p]*a;f+=b[0]*y,d+=b[1]*y,h+=b[2]*y,m+=b[3]*y}e[u]=f,e[u+1]=d,e[u+2]=h,e[u+3]=m}}}};var bB=qi,kB={OverlappingModel:_B,SimpleTiledModel:bB},wB=Us(kB);const Yk=5;function Vk(e,t,n,r,i,s,o){if(!k(E.book))return!1;const a=E.book,c=en(a,bt.BOARD,e),l=en(a,bt.BOARD,t),u=Re(c),f=Re(l);if(!k(u)||!k(f))return!1;Ae(u),Ae(f);let d=0;const h=new Map,m=new Map;let p=0;const b=32,y=new Uint8Array(xh*4);for(let C=0;C<Vt;++C)for(let j=0;j<St;++j){const N=ie(f,{x:j,y:C}),W=(N==null?void 0:N.char)??0,q=(N==null?void 0:N.color)??b,L=(N==null?void 0:N.bg)??b;y[p++]=W,y[p++]=q,y[p++]=L;const O=ui(N),w=It((O==null?void 0:O.name)??"empty"),I=h.get(w);xt(I)?y[p++]=I:(h.set(w,d),m.set(d,w),y[p++]=d++)}const v=s.x-i.x+1,T=s.y-i.y+1,A=new wB.OverlappingModel(y,St,Vt,n,v,T,!1,!1,r,0);let U=0;for(;U<Yk&&!A.generate();++U);if(U===Yk)return!1;p=0;const S=A.graphics();for(let C=i.y;C<=s.y;++C)for(let j=i.x;j<=s.x;++j){const N={x:j,y:C},W=S[p++],q=S[p++],L=S[p++];switch(d=S[p++],o){case"all":{const $=ie(u,{x:j,y:C});Ge($)&&xn(u,$,a.timestamp),Oe(u,{x:j,y:C});break}case"object":{const $=ie(u,{x:j,y:C});Ge($)&&xn(u,$,a.timestamp);break}case"terrain":Oe(u,{x:j,y:C});break}let O=m.get(d)??"";const w=ui({kind:O});switch(o){case"all":break;case"object":Ge(w)||(O="");break;case"terrain":Ge(w)&&(O="");break;default:if(Gt(w,"group")!==o&&(O=""),O){const $=ie(u,{x:j,y:C});Ge($)&&xn(u,$,a.timestamp),Oe(u,{x:j,y:C})}break}const I=O?$r(u,[O],N):void 0;if(!(!k(I)||!k(w))&&(yo(I,w),W>0&&(I.char=W),q<b&&(I.color=q),L<b&&(I.bg=L),Ge(I))){const $=kn(ta(f,O));k($)&&(Oe(u,{...es(f,$.x??0,$.y??0),x:j,y:C}),yo(I,$))}}return!0}function Xk(e){return`zss_snapshot_${e}`}const qk={x:0,y:0},Jk={x:St-1,y:Vt-1},Zk="all";function EB(e){const t=en(E.book,bt.BOARD,e),n=Re(t);if(!k(n))return;const r=Xk(n.id);yk(E.book,r);const[i]=Qi($t.MAIN,r,bt.BOARD),s=Re(i);if(k(s))return Ol(e,s.id,qk,Jk,Zk),s}function xB(e){const t=en(E.book,bt.BOARD,e),n=Re(t);if(!k(n))return;const r=Xk(n.id),i=en(E.book,bt.BOARD,r),s=Re(i);if(k(s))return Ol(s.id,e,qk,Jk,Zk),s}function vB(e,t,n,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return TB(e,t,i,s)}if(!k(E.book))return;const o=E.book,a=en(o,bt.BOARD,e),c=Re(a);if(!k(c))return;const l=Xl();Ae(c);for(let u=n.y;u<=r.y;++u)for(let f=n.x;f<=r.x;++f){let d=!1,h=!1;switch(s){case"all":d=!0,h=!0;break;case"object":d=!0;break;case"terrain":h=!0;break}const m=(f+t.x+St)%St,p=(u+t.y+Vt)%Vt;if(d){const b=ie(c,{x:f,y:u});Ge(b)&&k(b==null?void 0:b.x)&&k(b==null?void 0:b.y)&&(b.x=m,b.lx=m,b.y=p,b.ly=p)}h&&(l.terrain[m+p*St]=c.terrain[f+u*St])}(s==="all"||s==="terrain")&&(c.terrain=[...l.terrain]),oa(c)}function TB(e,t,n,r){if(!k(E.book))return;const i=E.book,s=en(i,bt.BOARD,e),o=Re(s);if(!k(o))return;Ae(o);const{terrainelements:a,objectelements:c}=ng(o,n,r);if(a.length===0&&c.length===0)return;const l=c.map(p=>p.id??""),u=a.map(p=>lr({x:p.x??0,y:p.y??0},St)),f=[],d=[];for(let p=0;p<a.length;++p){const b=a[p],y={x:b.x??-1,y:b.y??-1},v=ie(o,y);k(v)&&Ge(v)&&(f.push(v.id??""),f.push(v.id??""),d.push(lr({x:v.x??0,y:v.y??0},St)))}let h=!1;for(let p=0;p<a.length;++p){const b=a[p],y=Gt(b,"collision"),v={x:b.x??-1,y:b.y??-1},T=lr(v,St),A={x:v.x+t.x,y:v.y+t.y};if(ql(A)){const U=ie(o,A),S=(U==null?void 0:U.id)??"",C=lr({x:(U==null?void 0:U.x)??0,y:(U==null?void 0:U.y)??0},St),j=Gt(U,"collision");if(k(U)&&Ge(U)&&f.includes(S)!==!0&&l.includes(S)!==!0){let N=!1;const W=d.includes(T),q=W?ie(o,v):void 0,L=W?Gt(q,"pushable"):!1,O=W&&L;if(Gt(U,"pushable")&&(y!==Wt.ISWALK||W)){let w=W;k(q)&&L&&(h=ts(i,o,q,{x:(q.x??0)-t.x,y:(q.y??0)-t.y})!==!0,h||(w=!1)),(w||y!==Wt.ISWALK)&&(h=ts(i,o,U,{x:(U.x??0)+t.x,y:(U.y??0)+t.y})!==!0,h&&(N=O))}else(y!==Wt.ISWALK||O)&&(h=!0,N=O);N&&k(q)&&(h=ts(i,o,q,{x:(q.x??0)-t.x,y:(q.y??0)-t.y})!==!0)}else j===Wt.ISSOLID&&u.includes(C)===!1&&(h=!0)}else h=!0}if(h)return;for(let p=0;p<c.length;++p){const b=c[p],y=Gt(b,"collision"),v={x:b.x??0,y:b.y??0},T={x:v.x+t.x,y:v.y+t.y};if(ql(T)){const A=ie(o,T),U=(A==null?void 0:A.id)??"",S=Gt(A,"collision"),C=Gt(A,"group");k(A)&&Ge(A)&&f.includes(U)&&l.includes(U)!==!0?Gt(A,"pushable")?h=ts(i,o,A,T)!==!0:h=!0:Zo(y,S)&&r!==C&&(h=!0)}else h=!0}if(h)return;(t.x>0||t.y>0)&&a.reverse();for(let p=0;p<a.length;++p){const b=a[p],y={x:b.x??-1,y:b.y??-1},v={x:y.x+t.x,y:y.y+t.y},T=es(o,v.x,v.y);if(k(b)&&k(T)){Oe(o,{...b,x:v.x,y:v.y}),Oe(o,{...T,x:y.x,y:y.y});const A=ie(o,y);Ge(A)&&k(A)&&(A.x=(A.x??0)+t.x,A.y=(A.y??0)+t.y,A.lx=(A.lx??0)+t.x,A.ly=(A.ly??0)+t.y)}}oa(o);for(let p=0;p<c.length;++p){const b=c[p],y={x:b.x??-1,y:b.y??-1},v={x:y.x+t.x,y:y.y+t.y};if(!ts(i,o,b,v))break}oa(o)}function Bl(e,t){let n="all";const r={x:0,y:0},i={x:St-1,y:Vt-1};for(let s=t;s<e.length;){const[o,a]=st(e,s,[H.MAYBE_NUMBER_OR_STRING]);if(yt(o))n=It(o),s=a;else if(xt(o)){const[c,l,u,f]=st(e,a,[H.NUMBER,H.MAYBE_NUMBER,H.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=f}else break}return{targetset:n,pt1:r,pt2:i}}const AB=Ei().command("snapshot",()=>(!k(E.book)||!k(E.board)||EB(E.board.id),0)).command("revert",()=>(!k(E.book)||!k(E.board)||xB(E.board.id),0)).command("copy",(e,t)=>{if(!k(E.book)||!k(E.board))return 0;const[n,r]=st(t,0,[H.STRING]),i=bookreadcodepagesbytypeandstat(E.book,bt.BOARD,n),s=kn(...i);if(k(s)){const o=Bl(t,r);Ol(s.id,E.board.id,o.pt1,o.pt2,o.targetset)}return 0}).command("remix",(e,t)=>{if(!k(E.book)||!k(E.board))return 0;const[n,r,i,s]=st(t,0,[H.STRING,H.NUMBER,H.NUMBER]),o=bookreadcodepagesbytypeandstat(E.book,bt.BOARD,n),a=kn(...o);if(k(a)){const c=Bl(t,s);Vk(E.board.id,a.id,r,i,c.pt1,c.pt2,c.targetset)}return 0}).command("weave",(e,t)=>{var o,a;if(!k(E.book)||!k(E.board))return 0;const[n,r]=st(t,0,[H.DIR]),i={x:n.destpt.x-(((o=E.element)==null?void 0:o.x)??0),y:n.destpt.y-(((a=E.element)==null?void 0:a.y)??0)},s=Bl(t,r);return vB(E.board.id,i,s.pt1,s.pt2,E.elementid,s.targetset),0}).command("pivot",(e,t)=>{if(!k(E.book)||!k(E.board))return 0;const[n,r]=st(t,0,[H.NUMBER]),i=Bl(t,r);return dB(E.board.id,sm(n),i.pt1,i.pt2,i.targetset),0});var Ji=(e=>(e[e.ERROR=0]="ERROR",e[e.CLI=1]="CLI",e[e.LOADER=2]="LOADER",e[e.RUNTIME=3]="RUNTIME",e))(Ji||{});const SB={audio:Uh,board:BU,cli:BF,display:PF,element:HF,runtime:fB,loader:uB,network:hB,transform:AB},fd=["audio","board","display","network","transform","element"],RB={0:[],1:["cli",...fd],2:["loader",...fd],3:["runtime",...fd]},OB={0:new Map,1:new Map,2:new Map,3:new Map};function vo(e){return(RB[e]??[]).map(n=>SB[n]).filter(k)}function dd(e){const t=[],n=vo(e);for(let r=0;r<n.length;++r)t.push(...n[r].listcommands());return t}function NB(e,t){const n=OB[e];if(!n.has(t)){let r;const i=vo(e);for(let s=0;s<i.length&&(r=i[s].getcommand(t),!k(r));++s);n.set(t,r)}return n.get(t)}function IB(e,t,n){const r=vo(e);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(t,n);if(o)return[o,a]}}return[!1,void 0]}function CB(e,t,n,r){const i=vo(e);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(t,n,r);if(a)return[a,r]}}return[!1,void 0]}function LB(e,t){const n=vo(e);for(let r=0;r<n.length;++r)n[r].tick(t)}function Qk(e,t){const n=vo(e);for(let r=0;r<n.length;++r)n[r].everytick(t)}var tw={},ew={},nw={};const rw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");nw.encode=function(e){if(0<=e&&e<rw.length)return rw[e];throw new TypeError("Must be between 0 and 63: "+e)};const MB=nw,iw=5,sw=1<<iw,UB=sw-1,FB=sw;function BB(e){return e<0?(-e<<1)+1:(e<<1)+0}ew.encode=function(t){let n="",r,i=BB(t);do r=i&UB,i>>>=iw,i>0&&(r|=FB),n+=MB.encode(r);while(i>0);return n};var Ua={};(function(e){function t(S,C,j){if(C in S)return S[C];if(arguments.length===3)return j;throw new Error('"'+C+'" is a required argument.')}e.getArg=t;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(S){const C=S.match(n);return C?{scheme:C[1],auth:C[2],host:C[3],port:C[4],path:C[5]}:null}e.urlParse=i;function s(S){let C="";return S.scheme&&(C+=S.scheme+":"),C+="//",S.auth&&(C+=S.auth+"@"),S.host&&(C+=S.host),S.port&&(C+=":"+S.port),S.path&&(C+=S.path),C}e.urlGenerate=s;const o=32;function a(S){const C=[];return function(j){for(let W=0;W<C.length;W++)if(C[W].input===j){const q=C[0];return C[0]=C[W],C[W]=q,C[0].result}const N=S(j);return C.unshift({input:j,result:N}),C.length>o&&C.pop(),N}}const c=a(function(C){let j=C;const N=i(C);if(N){if(!N.path)return C;j=N.path}const W=e.isAbsolute(j),q=[];let L=0,O=0;for(;;)if(L=O,O=j.indexOf("/",L),O===-1){q.push(j.slice(L));break}else for(q.push(j.slice(L,O));O<j.length&&j[O]==="/";)O++;let w=0;for(O=q.length-1;O>=0;O--){const I=q[O];I==="."?q.splice(O,1):I===".."?w++:w>0&&(I===""?(q.splice(O+1,w),w=0):(q.splice(O,2),w--))}return j=q.join("/"),j===""&&(j=W?"/":"."),N?(N.path=j,s(N)):j});e.normalize=c;function l(S,C){S===""&&(S="."),C===""&&(C=".");const j=i(C),N=i(S);if(N&&(S=N.path||"/"),j&&!j.scheme)return N&&(j.scheme=N.scheme),s(j);if(j||C.match(r))return C;if(N&&!N.host&&!N.path)return N.host=C,s(N);const W=C.charAt(0)==="/"?C:c(S.replace(/\/+$/,"")+"/"+C);return N?(N.path=W,s(N)):W}e.join=l,e.isAbsolute=function(S){return S.charAt(0)==="/"||n.test(S)};function u(S,C){S===""&&(S="."),S=S.replace(/\/$/,"");let j=0;for(;C.indexOf(S+"/")!==0;){const N=S.lastIndexOf("/");if(N<0||(S=S.slice(0,N),S.match(/^([^\/]+:\/)?\/*$/)))return C;++j}return Array(j+1).join("../")+C.substr(S.length+1)}e.relative=u;const f=function(){return!("__proto__"in Object.create(null))}();function d(S){return S}function h(S){return p(S)?"$"+S:S}e.toSetString=f?d:h;function m(S){return p(S)?S.slice(1):S}e.fromSetString=f?d:m;function p(S){if(!S)return!1;const C=S.length;if(C<9||S.charCodeAt(C-1)!==95||S.charCodeAt(C-2)!==95||S.charCodeAt(C-3)!==111||S.charCodeAt(C-4)!==116||S.charCodeAt(C-5)!==111||S.charCodeAt(C-6)!==114||S.charCodeAt(C-7)!==112||S.charCodeAt(C-8)!==95||S.charCodeAt(C-9)!==95)return!1;for(let j=C-10;j>=0;j--)if(S.charCodeAt(j)!==36)return!1;return!0}function b(S,C,j){let N=v(S.source,C.source);return N!==0||(N=S.originalLine-C.originalLine,N!==0)||(N=S.originalColumn-C.originalColumn,N!==0||j)||(N=S.generatedColumn-C.generatedColumn,N!==0)||(N=S.generatedLine-C.generatedLine,N!==0)?N:v(S.name,C.name)}e.compareByOriginalPositions=b;function y(S,C,j){let N=S.generatedLine-C.generatedLine;return N!==0||(N=S.generatedColumn-C.generatedColumn,N!==0||j)||(N=v(S.source,C.source),N!==0)||(N=S.originalLine-C.originalLine,N!==0)||(N=S.originalColumn-C.originalColumn,N!==0)?N:v(S.name,C.name)}e.compareByGeneratedPositionsDeflated=y;function v(S,C){return S===C?0:S===null?1:C===null?-1:S>C?1:-1}function T(S,C){let j=S.generatedLine-C.generatedLine;return j!==0||(j=S.generatedColumn-C.generatedColumn,j!==0)||(j=v(S.source,C.source),j!==0)||(j=S.originalLine-C.originalLine,j!==0)||(j=S.originalColumn-C.originalColumn,j!==0)?j:v(S.name,C.name)}e.compareByGeneratedPositionsInflated=T;function A(S){return JSON.parse(S.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=A;function U(S,C,j){if(C=C||"",S&&(S[S.length-1]!=="/"&&C[0]!=="/"&&(S+="/"),C=S+C),j){const N=i(j);if(!N)throw new Error("sourceMapURL could not be parsed");if(N.path){const W=N.path.lastIndexOf("/");W>=0&&(N.path=N.path.substring(0,W+1))}C=l(s(N),C)}return c(C)}e.computeSourceURL=U})(Ua);var pd={};let PB=class Zw{constructor(){this._array=[],this._set=new Map}static fromArray(t,n){const r=new Zw;for(let i=0,s=t.length;i<s;i++)r.add(t[i],n);return r}size(){return this._set.size}add(t,n){const r=this.has(t),i=this._array.length;(!r||n)&&this._array.push(t),r||this._set.set(t,i)}has(t){return this._set.has(t)}indexOf(t){const n=this._set.get(t);if(n>=0)return n;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}};pd.ArraySet=PB;var ow={};const aw=Ua;function $B(e,t){const n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,s=t.generatedColumn;return r>n||r==n&&s>=i||aw.compareByGeneratedPositionsInflated(e,t)<=0}let DB=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(t,n){this._array.forEach(t,n)}add(t){$B(this._last,t)?(this._last=t,this._array.push(t)):(this._sorted=!1,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(aw.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};ow.MappingList=DB;const Fa=ew,qe=Ua,Pl=pd.ArraySet,jB=ow.MappingList;let cw=class Qw{constructor(t){t||(t={}),this._file=qe.getArg(t,"file",null),this._sourceRoot=qe.getArg(t,"sourceRoot",null),this._skipValidation=qe.getArg(t,"skipValidation",!1),this._sources=new Pl,this._names=new Pl,this._mappings=new jB,this._sourcesContents=null}static fromSourceMap(t){const n=t.sourceRoot,r=new Qw({file:t.file,sourceRoot:n});return t.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=qe.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),t.sources.forEach(function(i){let s=i;n!==null&&(s=qe.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=t.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(t){const n=qe.getArg(t,"generated"),r=qe.getArg(t,"original",null);let i=qe.getArg(t,"source",null),s=qe.getArg(t,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(t,n){let r=t;this._sourceRoot!=null&&(r=qe.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[qe.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[qe.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(t,n,r){let i=n;if(n==null){if(t.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=t.file}const s=this._sourceRoot;s!=null&&(i=qe.relative(s,i));const o=this._mappings.toArray().length>0?new Pl:this._sources,a=new Pl;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const f=t.originalPositionFor({line:c.originalLine,column:c.originalColumn});f.source!=null&&(c.source=f.source,r!=null&&(c.source=qe.join(r,c.source)),s!=null&&(c.source=qe.relative(s,c.source)),c.originalLine=f.line,c.originalColumn=f.column,f.name!=null&&(c.name=f.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,t.sources.forEach(function(c){const l=t.sourceContentFor(c);l!=null&&(r!=null&&(c=qe.join(r,c)),s!=null&&(c=qe.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(t,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(t&&"line"in t&&"column"in t&&t.line>0&&t.column>=0&&!n&&!r&&!i)){if(!(t&&"line"in t&&"column"in t&&n&&"line"in n&&"column"in n&&t.line>0&&t.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:t,source:r,original:n,name:i}))}}_serializeMappings(){let t=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,f;const d=this._mappings.toArray();for(let h=0,m=d.length;h<m;h++){if(l=d[h],c="",l.generatedLine!==n)for(t=0;l.generatedLine!==n;)c+=";",n++;else if(h>0){if(!qe.compareByGeneratedPositionsInflated(l,d[h-1]))continue;c+=","}c+=Fa.encode(l.generatedColumn-t),t=l.generatedColumn,l.source!=null&&(f=this._sources.indexOf(l.source),c+=Fa.encode(f-o),o=f,c+=Fa.encode(l.originalLine-1-i),i=l.originalLine-1,c+=Fa.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=Fa.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(t,n){return t.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=qe.relative(n,r));const i=qe.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const t={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(t.file=this._file),this._sourceRoot!=null&&(t.sourceRoot=this._sourceRoot),this._sourcesContents&&(t.sourcesContent=this._generateSourcesContent(t.sources,t.sourceRoot)),t}toString(){return JSON.stringify(this.toJSON())}};cw.prototype._version=3,tw.SourceMapGenerator=cw;var lw={};(function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?t(c,r,i,s,o,a):a==e.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?t(n,c,i,s,o,a):a==e.LEAST_UPPER_BOUND?c:n<0?-1:n}e.search=function(r,i,s,o){if(i.length===0)return-1;let a=t(-1,i.length,r,i,s,o||e.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(lw);var Ba={exports:{}},zB={},WB=Object.freeze({__proto__:null,default:zB}),uw=tE(WB);if((function(){return typeof window<"u"&&this===window}).call()){let e=null;Ba.exports=function(){if(typeof e=="string")return fetch(e).then(n=>n.arrayBuffer());if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},Ba.exports.initialize=t=>e=t}else{const e=uw,t=uw;Ba.exports=function(){return new Promise((r,i)=>{const s=t.join(__dirname,"mappings.wasm");e.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},Ba.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var hw=Ba.exports;const GB=hw;function KB(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let Pa=null;var HB=function(){if(Pa)return Pa;const t=[];return Pa=GB().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,f,d){const h=new KB;h.generatedLine=r+1,h.generatedColumn=i,s&&(h.lastGeneratedColumn=o-1),a&&(h.source=c,h.originalLine=l+1,h.originalColumn=u,f&&(h.name=d)),t[t.length-1](h)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{t.push(r);try{i()}finally{t.pop()}}})).then(null,n=>{throw Pa=null,n}),Pa};const Nt=Ua,md=lw,$l=pd.ArraySet,YB=hw,VB=HB,gd=Symbol("smcInternal");class He{constructor(t,n){return t==gd?Promise.resolve(this):qB(t,n)}static initialize(t){YB.initialize(t["lib/mappings.wasm"])}static fromSourceMap(t,n){return JB(t,n)}static async with(t,n,r){const i=await new He(t,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(t,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(t,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(t){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}He.prototype._version=3,He.GENERATED_ORDER=1,He.ORIGINAL_ORDER=2,He.GREATEST_LOWER_BOUND=1,He.LEAST_UPPER_BOUND=2;class $a extends He{constructor(t,n){return super(gd).then(r=>{let i=t;typeof t=="string"&&(i=Nt.parseSourceMapInput(t));const s=Nt.getArg(i,"version");let o=Nt.getArg(i,"sources");const a=Nt.getArg(i,"names",[]);let c=Nt.getArg(i,"sourceRoot",null);const l=Nt.getArg(i,"sourcesContent",null),u=Nt.getArg(i,"mappings"),f=Nt.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Nt.normalize(c)),o=o.map(String).map(Nt.normalize).map(function(d){return c&&Nt.isAbsolute(c)&&Nt.isAbsolute(d)?Nt.relative(c,d):d}),r._names=$l.fromArray(a.map(String),!0),r._sources=$l.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(d){return Nt.computeSourceURL(c,d,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=f,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,VB().then(d=>(r._wasm=d,r))})}_findSourceIndex(t){let n=t;if(this.sourceRoot!=null&&(n=Nt.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==t)return r;return-1}static fromSourceMap(t,n){return new $a(t.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(t,n){const r=t.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=t.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(t,n,r){const i=n||null,s=r||He.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Nt.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),t.call(i,a)},()=>{switch(s){case He.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case He.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(t){let n=Nt.getArg(t,"source");const r=Nt.getArg(t,"line"),i=t.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in t,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const n={generatedLine:Nt.getArg(t,"line"),generatedColumn:Nt.getArg(t,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Nt.getArg(t,"bias",He.GREATEST_LOWER_BOUND);r==null&&(r=He.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Nt.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Nt.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Nt.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Nt.getArg(i,"originalLine",null),column:Nt.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(t){return t==null}):!1}sourceContentFor(t,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(t);if(r>=0)return this.sourcesContent[r];let i=t;this.sourceRoot!=null&&(i=Nt.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Nt.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(t){let n=Nt.getArg(t,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Nt.getArg(t,"line"),originalColumn:Nt.getArg(t,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Nt.getArg(t,"bias",He.GREATEST_LOWER_BOUND);i==null&&(i=He.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Nt.getArg(s,"generatedLine",null),column:Nt.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}$a.prototype.consumer=He;class XB extends He{constructor(t,n){return super(gd).then(r=>{let i=t;typeof t=="string"&&(i=Nt.parseSourceMapInput(t));const s=Nt.getArg(i,"version"),o=Nt.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new $l,r._names=new $l,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Nt.getArg(c,"offset"),u=Nt.getArg(l,"line"),f=Nt.getArg(l,"column");if(u<a.line||u===a.line&&f<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new He(Nt.getArg(c,"map"),n).then(h=>({generatedOffset:{generatedLine:u+1,generatedColumn:f+1},consumer:h}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const t=this._generatedMappingsUnsorted;t.sort(Nt.compareByGeneratedPositionsDeflated),this.__generatedMappings=t}_sortOriginalMappings(){const t=this._originalMappingsUnsorted;t.sort(Nt.compareByOriginalPositions),this.__originalMappings=t}get sources(){const t=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)t.push(this._sections[n].consumer.sources[r]);return t}originalPositionFor(t){const n={generatedLine:Nt.getArg(t,"line"),generatedColumn:Nt.getArg(t,"column")},r=md.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:t.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(t){return t.consumer.hasContentsOfAllSources()})}sourceContentFor(t,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(t,!0);if(s)return s}if(n)return null;throw new Error('"'+t+'" is not in the SourceMap.')}generatedPositionFor(t){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Nt.getArg(t,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(t);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(t,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Nt.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let f=null;l.name&&(this._names.add(l.name),f=this._names.indexOf(l.name));const d={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:f};r.push(d),typeof d.originalLine=="number"&&i.push(d)}}}eachMapping(t,n,r){const i=n||null,s=r||He.GENERATED_ORDER;let o;switch(s){case He.GENERATED_ORDER:o=this._generatedMappings;break;case He.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Nt.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(t,i)}_findMapping(t,n,r,i,s,o){if(t[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+t[r]);if(t[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+t[i]);return md.search(t,n,s,o)}allGeneratedPositionsFor(t){const n=Nt.getArg(t,"line"),r={source:Nt.getArg(t,"source"),originalLine:n,originalColumn:Nt.getArg(t,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Nt.compareByOriginalPositions,md.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(t.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Nt.getArg(o,"generatedLine",null),column:Nt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Nt.getArg(o,"generatedLine",null),column:Nt.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let t=0;t<this._sections.length;t++)this._sections[t].consumer.destroy()}}function qB(e,t){let n=e;typeof e=="string"&&(n=Nt.parseSourceMapInput(e));const r=n.sections!=null?new XB(n,t):new $a(n,t);return Promise.resolve(r)}function JB(e,t){return $a.fromSourceMap(e,t)}var fw={};const ZB=tw.SourceMapGenerator,Dl=Ua,QB=/(\r?\n)/,tP=10,To="$$$isSourceNode$$$";let eP=class Ud{constructor(t,n,r,i,s){this.children=[],this.sourceContents={},this.line=t??null,this.column=n??null,this.source=r??null,this.name=s??null,this[To]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(t,n,r){const i=new Ud,s=t.split(QB);let o=0;const a=function(){const h=p(),m=p()||"";return h+m;function p(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,f;return n.eachMapping(function(h){if(u!==null)if(c<h.generatedLine)d(u,a()),c++,l=0;else{f=s[o]||"";const m=f.substr(0,h.generatedColumn-l);s[o]=f.substr(h.generatedColumn-l),l=h.generatedColumn,d(u,m),u=h;return}for(;c<h.generatedLine;)i.add(a()),c++;l<h.generatedColumn&&(f=s[o]||"",i.add(f.substr(0,h.generatedColumn)),s[o]=f.substr(h.generatedColumn),l=h.generatedColumn),u=h},this),o<s.length&&(u&&d(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(h){const m=n.sourceContentFor(h);m!=null&&(r!=null&&(h=Dl.join(r,h)),i.setSourceContent(h,m))}),i;function d(h,m){if(h===null||h.source===void 0)i.add(m);else{const p=r?Dl.join(r,h.source):h.source;i.add(new Ud(h.originalLine,h.originalColumn,p,m,h.name))}}}add(t){if(Array.isArray(t))t.forEach(function(n){this.add(n)},this);else if(t[To]||typeof t=="string")t&&this.children.push(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}prepend(t){if(Array.isArray(t))for(let n=t.length-1;n>=0;n--)this.prepend(t[n]);else if(t[To]||typeof t=="string")this.children.unshift(t);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+t);return this}walk(t){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[To]?n.walk(t):n!==""&&t(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(t){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(t);n.push(this.children[r]),this.children=n}return this}replaceRight(t,n){const r=this.children[this.children.length-1];return r[To]?r.replaceRight(t,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(t,n):this.children.push("".replace(t,n)),this}setSourceContent(t,n){this.sourceContents[Dl.toSetString(t)]=n}walkSourceContents(t){for(let r=0,i=this.children.length;r<i;r++)this.children[r][To]&&this.children[r].walkSourceContents(t);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)t(Dl.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let t="";return this.walk(function(n){t+=n}),t}toStringWithSourceMap(t){const n={code:"",line:1,column:0},r=new ZB(t);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let f=0,d=l.length;f<d;f++)l.charCodeAt(f)===tP?(n.line++,n.column=0,f+1===d?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};fw.SourceNode=eP;var nP=fw.SourceNode;let dw=0;const pw=Zr,rP=["Command","lines"];class iP extends XM{constructor(){super(ck,{traceInitPerf:Zr,skipValidations:!Zr,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Et(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Et(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(Oa)}])}));Et(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Et(this,"inline",this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Et(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(Uf)}));Et(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(Mf)}));Et(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(Oy)}])}));Et(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(Ny)}));Et(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(Iy),this.OPTION(()=>{this.SUBRULE(this.words)}),this.CONSUME(Cy)}));Et(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(_o),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Et(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Et(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(zf),this.SUBRULE(this.words)}));Et(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(X1),this.SUBRULE(this.words)}));Et(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(Wf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Et(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Sl),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(Oa)),this.CONSUME4(_o),this.CONSUME4(Gf)}}])}));Et(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Sl),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(_o),this.CONSUME(Gf)}}])}));Et(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Sl),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Et(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(_o),this.CONSUME(Kf),this.CONSUME(Wf),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Et(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(_o),this.CONSUME(Kf),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))}));Et(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(ek),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Et(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(nk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Et(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(rk),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Et(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(ik),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Et(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(sk)}));Et(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(ok)}));Et(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(Z1)}));Et(this,"command_toast",this.RULED("command_toast",()=>{this.CONSUME(Q1)}));Et(this,"command_ticker",this.RULED("command_ticker",()=>{this.CONSUME(tk)}));Et(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(Bf),this.SUBRULE2(this.and_test)})}));Et(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME($f),this.SUBRULE2(this.not_test)})}));Et(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(Pf),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Et(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Et(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME($1)},{ALT:()=>this.CONSUME(D1)},{ALT:()=>this.CONSUME(j1)},{ALT:()=>this.CONSUME(z1)},{ALT:()=>this.CONSUME(W1)},{ALT:()=>this.CONSUME(G1)}])}));Et(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(Bf),this.SUBRULE2(this.and_test_value)})}));Et(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME($f),this.SUBRULE2(this.not_test_value)})}));Et(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(Pf),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Et(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Et(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(Df)},{ALT:()=>this.CONSUME(jf)}]),this.SUBRULE(this.term)}));Et(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Et(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(H1)},{ALT:()=>this.CONSUME(zf)},{ALT:()=>this.CONSUME(Y1)},{ALT:()=>this.CONSUME(V1)}]),this.SUBRULE(this.factor)}));Et(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(Df)},{ALT:()=>this.CONSUME(jf)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Et(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(K1),this.SUBRULE(this.factor)})}));Et(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Et(this,"kind",this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)}));Et(this,"category",this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(Ly)},{ALT:()=>this.CONSUME(My)}])}));Et(this,"collision",this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(Uy)},{ALT:()=>this.CONSUME(Fy)},{ALT:()=>this.CONSUME(By)},{ALT:()=>this.CONSUME(Py)},{ALT:()=>this.CONSUME($y)},{ALT:()=>this.CONSUME(Dy)},{ALT:()=>this.CONSUME(jy)},{ALT:()=>this.CONSUME(zy)}])}));Et(this,"color",this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(Wy)},{ALT:()=>this.CONSUME(Gy)},{ALT:()=>this.CONSUME(Ky)},{ALT:()=>this.CONSUME(Hy)},{ALT:()=>this.CONSUME(Yy)},{ALT:()=>this.CONSUME(Vy)},{ALT:()=>this.CONSUME(Xy)},{ALT:()=>this.CONSUME(qy)},{ALT:()=>this.CONSUME(Jy)},{ALT:()=>this.CONSUME(Zy)},{ALT:()=>this.CONSUME(Qy)},{ALT:()=>this.CONSUME(tb)},{ALT:()=>this.CONSUME(eb)},{ALT:()=>this.CONSUME(nb)},{ALT:()=>this.CONSUME(rb)},{ALT:()=>this.CONSUME(ib)},{ALT:()=>this.CONSUME(sb)},{ALT:()=>this.CONSUME(ob)},{ALT:()=>this.CONSUME(ab)},{ALT:()=>this.CONSUME(cb)},{ALT:()=>this.CONSUME(lb)},{ALT:()=>this.CONSUME(ub)},{ALT:()=>this.CONSUME(hb)},{ALT:()=>this.CONSUME(fb)},{ALT:()=>this.CONSUME(db)},{ALT:()=>this.CONSUME(pb)},{ALT:()=>this.CONSUME(mb)},{ALT:()=>this.CONSUME(gb)},{ALT:()=>this.CONSUME(_b)},{ALT:()=>this.CONSUME(yb)},{ALT:()=>this.CONSUME(bb)},{ALT:()=>this.CONSUME(kb)},{ALT:()=>this.CONSUME(wb)},{ALT:()=>this.CONSUME(Eb)},{ALT:()=>this.CONSUME(xb)},{ALT:()=>this.CONSUME(vb)},{ALT:()=>this.CONSUME(Tb)},{ALT:()=>this.CONSUME(Ab)},{ALT:()=>this.CONSUME(Sb)},{ALT:()=>this.CONSUME(Rb)},{ALT:()=>this.CONSUME(Ob)},{ALT:()=>this.CONSUME(Nb)},{ALT:()=>this.CONSUME(Ib)},{ALT:()=>this.CONSUME(Cb)},{ALT:()=>this.CONSUME(Lb)},{ALT:()=>this.CONSUME(Mb)},{ALT:()=>this.CONSUME(Ub)}])}));Et(this,"dir_mod",this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(Vb)},{ALT:()=>this.CONSUME(Xb)},{ALT:()=>this.CONSUME(qb)},{ALT:()=>this.CONSUME(Jb)},{ALT:()=>this.CONSUME(g1)},{ALT:()=>this.CONSUME(_1)}])}));Et(this,"dir",this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(Fb)},{ALT:()=>this.CONSUME(Bb)},{ALT:()=>this.CONSUME(Pb)},{ALT:()=>this.CONSUME($b)},{ALT:()=>this.CONSUME(Db)},{ALT:()=>{this.CONSUME(jb),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)}},{ALT:()=>{this.CONSUME(zb),this.SUBRULE3(this.simple_token),this.SUBRULE4(this.simple_token)}},{ALT:()=>{this.CONSUME(Zb),this.SUBRULE5(this.simple_token),this.SUBRULE6(this.simple_token)}},{ALT:()=>{this.CONSUME(Qb),this.SUBRULE7(this.simple_token),this.SUBRULE8(this.simple_token)}},{ALT:()=>this.CONSUME(Wb)},{ALT:()=>this.CONSUME(Gb)},{ALT:()=>this.CONSUME(Kb)},{ALT:()=>this.CONSUME(Hb)},{ALT:()=>this.CONSUME(Yb)},{ALT:()=>{this.CONSUME(t1),this.SUBRULE1(this.kind)}},{ALT:()=>{this.CONSUME(e1),this.SUBRULE2(this.kind)}},{ALT:()=>{this.CONSUME(n1),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)}},{ALT:()=>this.CONSUME(r1)},{ALT:()=>this.CONSUME(i1)},{ALT:()=>this.CONSUME(s1)},{ALT:()=>this.CONSUME(o1)},{ALT:()=>this.CONSUME(a1)},{ALT:()=>this.CONSUME(c1)},{ALT:()=>this.CONSUME(l1)},{ALT:()=>this.CONSUME(u1)},{ALT:()=>this.CONSUME(h1)},{ALT:()=>this.CONSUME(f1)},{ALT:()=>this.CONSUME(d1)},{ALT:()=>this.CONSUME(p1)},{ALT:()=>this.CONSUME(m1)}])}));Et(this,"token_expr_any",this.RULED("token_expr_any",()=>{this.CONSUME(w1),this.SUBRULE(this.kind)}));Et(this,"token_expr_count",this.RULED("token_expr_count",()=>{this.CONSUME(E1),this.SUBRULE(this.kind)}));Et(this,"token_expr_color",this.RULED("token_expr_color",()=>{this.CONSUME(x1),this.SUBRULE(this.dir),this.SUBRULE(this.color)}));Et(this,"token_expr_detect",this.RULED("token_expr_detect",()=>{this.CONSUME(v1),this.SUBRULE(this.dir),this.SUBRULE(this.kind)}));Et(this,"token_expr_abs",this.RULED("token_expr_abs",()=>{this.CONSUME(T1),this.SUBRULE(this.simple_token)}));Et(this,"token_expr_intceil",this.RULED("token_expr_intceil",()=>{this.CONSUME(A1),this.SUBRULE(this.simple_token)}));Et(this,"token_expr_intfloor",this.RULED("token_expr_intfloor",()=>{this.CONSUME(S1),this.SUBRULE(this.simple_token)}));Et(this,"token_expr_intround",this.RULED("token_expr_intround",()=>{this.CONSUME(R1),this.SUBRULE(this.simple_token)}));Et(this,"token_expr_clamp",this.RULED("token_expr_clamp",()=>{this.CONSUME(O1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)}));Et(this,"token_expr_min",this.RULED("token_expr_min",()=>{this.CONSUME(N1),this.SUBRULE(this.simple_tokens)}));Et(this,"token_expr_max",this.RULED("token_expr_max",()=>{this.CONSUME(I1),this.SUBRULE(this.simple_tokens)}));Et(this,"token_expr_pick",this.RULED("token_expr_pick",()=>{this.CONSUME(C1),this.SUBRULE(this.simple_tokens)}));Et(this,"token_expr_pickwith",this.RULED("token_expr_pickwith",()=>{this.CONSUME(L1),this.SUBRULE(this.simple_token),this.SUBRULE(this.simple_tokens)}));Et(this,"token_expr_random",this.RULED("token_expr_random",()=>{this.CONSUME(M1),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))}));Et(this,"token_expr_randomwith",this.RULED("token_expr_randomwith",()=>{this.CONSUME(U1),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))}));Et(this,"token_expr_run",this.RULED("token_expr_run",()=>{this.CONSUME(F1),this.SUBRULE(this.string_token)}));Et(this,"token_expr_runwith",this.RULED("token_expr_runwith",()=>{this.CONSUME(B1),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)}));Et(this,"token_expr",this.RULED("token_expr",()=>{this.AT_LEAST_ONE(()=>{this.OR([{ALT:()=>this.CONSUME(y1)},{ALT:()=>this.CONSUME(b1)},{ALT:()=>this.CONSUME(k1)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_color)},{ALT:()=>this.SUBRULE(this.token_expr_detect)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])})}));Et(this,"string_token",this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Al)}])}));Et(this,"simple_token",this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(Ff)},{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Al)}])}));Et(this,"simple_tokens",this.RULED("simple_tokens",()=>{this.AT_LEAST_ONE(this.simple_token)}));Et(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.token_expr)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(Uf)},{ALT:()=>this.CONSUME(Al)},{ALT:()=>this.CONSUME(Xe)},{ALT:()=>this.CONSUME(Ff)},{ALT:()=>this.CONSUME(P1)},{ALT:()=>{this.CONSUME(q1),this.SUBRULE(this.expr),this.CONSUME(J1)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=rP.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(dw++).toString().padStart(3),c=s?"font-weight: bold;":"";if(pw&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),pw&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),dw--},i)}}const Ao=new iP;if(IS){const e=Ao.getGAstProductions(),t=aU(e);console.info(t)}const sP=Ao.getBaseCstVisitorConstructor();var wt=(e=>(e[e.PROGRAM=0]="PROGRAM",e[e.API=1]="API",e[e.LINE=2]="LINE",e[e.MARK=3]="MARK",e[e.GOTO=4]="GOTO",e[e.COUNT=5]="COUNT",e[e.TEXT=6]="TEXT",e[e.LABEL=7]="LABEL",e[e.HYPERLINK=8]="HYPERLINK",e[e.STAT=9]="STAT",e[e.MOVE=10]="MOVE",e[e.COMMAND=11]="COMMAND",e[e.LITERAL=12]="LITERAL",e[e.IF=13]="IF",e[e.IF_CHECK=14]="IF_CHECK",e[e.IF_BLOCK=15]="IF_BLOCK",e[e.ELSE_IF=16]="ELSE_IF",e[e.ELSE=17]="ELSE",e[e.WHILE=18]="WHILE",e[e.BREAK=19]="BREAK",e[e.CONTINUE=20]="CONTINUE",e[e.REPEAT=21]="REPEAT",e[e.WAITFOR=22]="WAITFOR",e[e.FOREACH=23]="FOREACH",e[e.OR=24]="OR",e[e.AND=25]="AND",e[e.NOT=26]="NOT",e[e.COMPARE=27]="COMPARE",e[e.COMPARE_ITEM=28]="COMPARE_ITEM",e[e.OPERATOR=29]="OPERATOR",e[e.OPERATOR_ITEM=30]="OPERATOR_ITEM",e[e.EXPR=31]="EXPR",e))(wt||{}),Cs=(e=>(e[e.IS_EQ=0]="IS_EQ",e[e.IS_NOT_EQ=1]="IS_NOT_EQ",e[e.IS_LESS_THAN=2]="IS_LESS_THAN",e[e.IS_GREATER_THAN=3]="IS_GREATER_THAN",e[e.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",e[e.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",e))(Cs||{}),ci=(e=>(e[e.EMPTY=0]="EMPTY",e[e.PLUS=1]="PLUS",e[e.MINUS=2]="MINUS",e[e.POWER=3]="POWER",e[e.MULTIPLY=4]="MULTIPLY",e[e.DIVIDE=5]="DIVIDE",e[e.MOD_DIVIDE=6]="MOD_DIVIDE",e[e.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",e[e.UNI_PLUS=8]="UNI_PLUS",e[e.UNI_MINUS=9]="UNI_MINUS",e))(ci||{}),jl=(e=>(e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.TEMPLATE=2]="TEMPLATE",e))(jl||{});function Ft(e,t){const[n]=e??[];return((n==null?void 0:n.image)??t).trimStart().replaceAll(/^"|"$/g,"")}class oP extends sP{constructor(){super();Et(this,"unique",0);Zr&&this.validateVisitor()}visit(n){if(ue(n)&&(n=n[0]),!!k(n))return this[n.name](n.children,n.location)}createcodenode(n,r){return[{...r,...n,lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createtemplatenode(n,r){return this.createcodenode(n,{type:12,literal:2,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():k(n)?[this.visit(n)].flat():[]}program(n,r){return this.unique=0,this.createcodenode(r,{type:0,lines:[this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}inline(n){return n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.structured_cmd?this.go(n.structured_cmd):[]}stmt_label(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!0,name:Ft(n.token_label,":").slice(1).trim()}))}stmt_stat(n,r){return this.createlinenode(r,this.createcodenode(r,{type:9,value:Ft(n.token_stat,"@").slice(1)}))}stmt_text(n,r){const i=Ft(n.token_text,"");return this.createlinenode(r,this.createcodenode(r,{type:6,value:i}))}stmt_comment(n,r){return this.createlinenode(r,this.createcodenode(r,{type:7,active:!1,name:Ft(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n,r){return this.createlinenode(r,this.createcodenode(r,{type:8,link:this.go(n.words),text:Ft(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n,r){return n.structured_cmd?this.go(n.structured_cmd):this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n,r){return n.token_divide?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n,r){return n.token_query?this.createlinenode(r,this.createcodenode(r,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n,r){const[i]=this.createlogicnode(r,Ft(n.token_if,"if"),"",this.go(n.words)),[s]=this.go(n.command_if_block)??[];return this.createcodenode(r,{type:13,check:i,block:s})}command_if_block(n,r){const i=De(),s=De();return this.createcodenode(r,{type:15,skip:i,done:s,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(r,s,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n,r){const i=De(),s=De();return this.createcodenode(r,{type:16,done:s,lines:[this.createlogicnode(r,Ft(n.token_if,"if"),i,this.go(n.words)),this.go(n.command_fork),this.creategotonode(r,s,"end of if"),this.createmarknode(r,i,"skip")].flat()})}command_else(n,r){const i=[];return n.words&&i.push(...this.createlinenode(r,this.createcodenode(r,{type:11,words:this.go(n.words)}))),n.command_fork&&i.push(...this.go(n.command_fork)),this.createcodenode(r,{type:17,lines:i})}command_while(n,r){const i=De(),s=De();return this.createcodenode(r,{type:18,loop:i,done:s,lines:[this.createmarknode(r,i,"start of while"),this.createlogicnode(r,"if",s,this.go(n.words)),this.go(n.command_block),this.creategotonode(r,i,"loop of while"),this.createmarknode(r,s,"end of while")].flat()})}command_repeat(n,r){const i=De(),s=De(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:21,loop:i,done:s,lines:[this.createapinode(r,"repeatstart",a),this.createmarknode(r,i,"start of repeat"),this.createlogicnode(r,"repeat",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of repeat"),this.createmarknode(r,s,"end of repeat")].flat()})}command_foreach(n,r){const i=De(),s=De(),a=[this.createcountnode(r),this.go(n.words)].flat();return this.createcodenode(r,{type:23,loop:i,done:s,lines:[this.createapinode(r,"foreachstart",a),this.createmarknode(r,i,"start of foreach"),this.createlogicnode(r,"foreach",s,a),this.go(n.command_block),this.creategotonode(r,i,"loop of foreach"),this.createmarknode(r,s,"end of foreach")].flat()})}command_waitfor(n,r){const i=De();return this.createcodenode(r,{type:22,loop:i,lines:[this.createmarknode(r,i,"start of waitfor"),this.createlogicnode(r,"waitfor",i,this.go(n.words))].flat()})}command_break(n,r){return this.createcodenode(r,{type:19,goto:0})}command_continue(n,r){return this.createcodenode(r,{type:20,goto:0})}command_play(n,r){const i=Ft(n.token_command_play,""),s=i.replace("bgplay","").replace("play","").trim(),o=i.includes("bgplay");return[this.createstringnode(r,o?"bgplay":"play"),this.createstringnode(r,s)].flat()}command_toast(n,r){const s=Ft(n.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(r,"toast"),this.createtemplatenode(r,s)].flat()}command_ticker(n,r){const s=Ft(n.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(r,"ticker"),this.createtemplatenode(r,s)].flat()}expr(n,r){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(r,{type:24,items:this.go(n.and_test)})}and_test(n,r){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(r,{type:25,items:this.go(n.not_test)})}not_test(n,r){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(r,{type:26,items:this.go(n.not_test)}):[]}comparison(n,r){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[i,s]=this.go(n.arith_expr),[o]=this.go(n.comp_op);return this.createcodenode(r,{type:27,lhs:i,compare:o,rhs:s})}comp_op(n,r){return n.token_iseq?this.createcodenode(r,{type:28,method:0}):n.token_isnoteq?this.createcodenode(r,{type:28,method:1}):n.token_islessthan?this.createcodenode(r,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(r,{type:28,method:3}):n.token_islessthanorequal?this.createcodenode(r,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(r,{type:28,method:5}):[]}expr_value(n,r){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(r,{type:24,items:this.go(n.and_test_value)})}and_test_value(n,r){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(r,{type:25,items:this.go(n.not_test_value)})}not_test_value(n,r){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(r,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n,r){const i=this.go(n.term);return n.arith_expr_item?this.createcodenode(r,{type:29,lhs:i[0],items:this.go(n.arith_expr_item)}):i}arith_expr_item(n,r){return this.createcodenode(r,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n,r){return n.term_item?this.createcodenode(r,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n,r){let i=0;return n.token_multiply&&(i=4),n.token_divide&&(i=5),n.token_moddivide&&(i=6),n.token_floordivide&&(i=7),this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})}factor(n,r){if(n.power)return this.go(n.power);let i=0;return n.token_plus&&(i=8),n.token_minus&&(i=9),this.createcodenode(r,{type:29,lhs:void 0,items:this.createcodenode(r,{type:30,operator:i,rhs:this.go(n.factor)[0]})})}power(n,r){const i=this.go(n.token);return n.factor?this.createcodenode(r,{type:29,lhs:i[0],items:this.createcodenode(r,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):i}words(n){return this.go(n.expr)}kind(n){return[this.go(n.color),this.go(n.string_token)].flat()}category(n,r){if(n.token_isterrain){const i=Ft(n.token_isterrain,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isobject){const i=Ft(n.token_isobject,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}collision(n,r){if(n.token_iswalkable){const i=Ft(n.token_iswalkable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalking){const i=Ft(n.token_iswalking,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_iswalk){const i=Ft(n.token_iswalk,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimmable){const i=Ft(n.token_isswimmable,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswimming){const i=Ft(n.token_isswimming,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isswim){const i=Ft(n.token_isswim,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_issolid){const i=Ft(n.token_issolid,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_isbullet){const i=Ft(n.token_isbullet,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}color(n,r){let i="ERROR";return n.token_black&&(i="black"),n.token_dkblue&&(i="dkblue"),n.token_dkgreen&&(i="dkgreen"),n.token_dkcyan&&(i="dkcyan"),n.token_dkred&&(i="dkred"),n.token_dkpurple&&(i="dkpurple"),n.token_dkyellow&&(i="dkyellow"),n.token_ltgray&&(i="ltgray"),n.token_dkgray&&(i="dkgray"),n.token_blue&&(i="blue"),n.token_green&&(i="green"),n.token_cyan&&(i="cyan"),n.token_red&&(i="red"),n.token_purple&&(i="purple"),n.token_yellow&&(i="yellow"),n.token_white&&(i="white"),n.token_brown&&(i="brown"),n.token_dkwhite&&(i="dkwhite"),n.token_ltgrey&&(i="ltgrey"),n.token_gray&&(i="gray"),n.token_grey&&(i="grey"),n.token_dkgrey&&(i="dkgrey"),n.token_ltblack&&(i="ltblack"),n.token_onblack&&(i="onblack"),n.token_ondkblue&&(i="ondkblue"),n.token_ondkgreen&&(i="ondkgreen"),n.token_ondkcyan&&(i="ondkcyan"),n.token_ondkred&&(i="ondkred"),n.token_ondkpurple&&(i="ondkpurple"),n.token_ondkyellow&&(i="ondkyellow"),n.token_onltgray&&(i="onltgray"),n.token_ondkgray&&(i="ondkgray"),n.token_onblue&&(i="onblue"),n.token_ongreen&&(i="ongreen"),n.token_oncyan&&(i="oncyan"),n.token_onred&&(i="onred"),n.token_onpurple&&(i="onpurple"),n.token_onyellow&&(i="onyellow"),n.token_onwhite&&(i="onwhite"),n.token_onbrown&&(i="onbrown"),n.token_ondkwhite&&(i="ondkwhite"),n.token_onltgrey&&(i="onltgrey"),n.token_ongray&&(i="ongray"),n.token_ongrey&&(i="ongrey"),n.token_ondkgrey&&(i="ondkgrey"),n.token_onltblack&&(i="onltblack"),n.token_onclear&&(i="onclear"),this.createcodenode(r,{type:12,literal:1,value:i})}dir_mod(n,r){let i="ERROR";return n.token_cw&&(i="cw"),n.token_ccw&&(i="ccw"),n.token_opp&&(i="opp"),n.token_rndp&&(i="rndp"),n.token_over&&(i="over"),n.token_under&&(i="under"),this.createcodenode(r,{type:12,literal:1,value:i})}dir(n,r){const i=this.go(n.dir_mod)??[];return n.token_i&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_i,"")})),n.token_idle&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_idle,"")})),n.token_n&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_n,"")})),n.token_u&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_u,"")})),n.token_north&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_north,"")})),n.token_up&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_up,"")})),n.token_s&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_s,"")})),n.token_d&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_d,"")})),n.token_south&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_south,"")})),n.token_down&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_down,"")})),n.token_w&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_w,"")})),n.token_l&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_l,"")})),n.token_west&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_west,"")})),n.token_e&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_e,"")})),n.token_r&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_r,"")})),n.token_east&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_east,"")})),n.token_right&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_right,"")})),n.token_by&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_by,"")}),...this.go(n.simple_token)),n.token_at&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_at,"")}),...this.go(n.simple_token)),n.token_away&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_away,"")}),...this.go(n.simple_token)),n.token_toward&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_toward,"")}),...this.go(n.simple_token)),n.token_find&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_find,"")}),...this.go(n.kind)),n.token_flee&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_flee,"")}),...this.go(n.kind)),n.token_to&&i.push(...this.createcodenode(r,{type:12,literal:1,value:Ft(n.token_to,"")}),...this.go(n.dir)),i.flat()}token_expr_any(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"any"}),...this.go(n.kind)]}token_expr_count(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"count"}),...this.go(n.kind)]}token_expr_color(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"color"}),...this.go(n.dir),...this.go(n.color)]}token_expr_detect(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"detect"}),...this.go(n.dir),...this.go(n.kind)]}token_expr_abs(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"abs"}),...this.go(n.simple_token)]}token_expr_intceil(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intceil"}),...this.go(n.simple_token)]}token_expr_intfloor(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intfloor"}),...this.go(n.simple_token)]}token_expr_intround(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"intround"}),...this.go(n.simple_token)]}token_expr_clamp(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"clamp"}),...this.go(n.simple_token)]}token_expr_min(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"min"}),...this.go(n.simple_tokens)]}token_expr_max(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"max"}),...this.go(n.simple_tokens)]}token_expr_pick(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pick"}),...this.go(n.simple_tokens)]}token_expr_pickwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"pickwith"}),...this.go(n.simple_tokens)]}token_expr_random(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"random"}),...this.go(n.simple_token)]}token_expr_randomwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"randomwith"}),...this.go(n.simple_token)]}token_expr_run(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"run"}),...this.go(n.string_token)]}token_expr_runwith(n,r){return[...this.createcodenode(r,{type:12,literal:1,value:"runwith"}),...this.go(n.simple_token),...this.go(n.string_token)]}token_expr(n,r){const i=[];return n.token_expr_aligned&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"aligned"})),n.token_contact&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"contact"})),n.token_blocked&&i.push(...this.createcodenode(r,{type:12,literal:1,value:"blocked"})),n.token_expr_any?this.go(n.token_expr_any):n.token_expr_count?this.go(n.token_expr_count):n.token_expr_color?this.go(n.token_expr_color):n.token_expr_detect?this.go(n.token_expr_detect):n.token_expr_abs?this.go(n.token_expr_abs):n.token_expr_intceil?this.go(n.token_expr_intceil):n.token_expr_intfloor?this.go(n.token_expr_intfloor):n.token_expr_intround?this.go(n.token_expr_intround):n.token_expr_clamp?this.go(n.token_expr_clamp):n.token_expr_min?this.go(n.token_expr_min):n.token_expr_max?this.go(n.token_expr_max):n.token_expr_pick?this.go(n.token_expr_pick):n.token_expr_pickwith?this.go(n.token_expr_pickwith):n.token_expr_random?this.go(n.token_expr_random):n.token_expr_randomwith?this.go(n.token_expr_randomwith):n.token_expr_run?this.go(n.token_expr_run):n.token_expr_runwith?this.go(n.token_expr_runwith):i}string_token(n){return[this.go(n.token_stringliteral),this.go(n.token_stringliteraldouble)].flat()}simple_token(n){return[this.go(n.token_numberliteral),this.go(n.token_stringliteral),this.go(n.token_stringliteraldouble)].flat()}simple_tokens(n){return[this.go(n.token_numberliteral),this.go(n.token_stringliteral),this.go(n.token_stringliteraldouble)].flat()}token(n,r){if(n.category)return this.go(n.category);if(n.collision)return this.go(n.collision);if(n.color)return this.go(n.color);if(n.dir)return this.go(n.dir);if(n.token_expr)return this.go(n.token_expr);if(n.command_play)return this.go(n.command_play);if(n.command_toast)return this.go(n.command_toast);if(n.command_ticker)return this.go(n.command_ticker);if(n.token_label){const i=Ft(n.token_label,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_stringliteraldouble){const i=Ft(n.token_stringliteraldouble,"");return this.createcodenode(r,{type:12,literal:2,value:i})}if(n.token_stringliteral){const i=Ft(n.token_stringliteral,"");return this.createcodenode(r,{type:12,literal:1,value:i})}if(n.token_numberliteral){const i=parseFloat(Ft(n.token_numberliteral,"0"));return this.createcodenode(r,{type:12,literal:0,value:i})}if(n.token_lparen)return this.createcodenode(r,{type:31,words:this.go(n.expr)});if(n.token_stop){const i=Ft(n.token_stop,"");return this.createcodenode(r,{type:12,literal:1,value:i})}return[]}}const aP=new oP,Yn={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},zl="zss.js";function re(e,t){return new nP(e.startLine??1,e.startColumn??1,zl,t)}function _d(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function yd(e){return`'${_d(e)}'`}function bd(e){const t=sd(e);return t.errors.length?e:`['${t.tokens.map(r=>r.tokenType===rd?`', api.get('${_d(r.image.substring(1))}'), '`:_d(r.image)).join("")}'].join('')`}function So(e){return e.filter(t=>t!==void 0).map(ae)}function mw(e){return re(e,"")}function cP(e,t){const n=[];return e.forEach(r=>{n.push(r,t)}),n.pop(),n}function nn(e,t,n){return re(e,[`api.${t}(`,...cP(n,", "),")"])}function lP(e){if(e.type===wt.COMPARE&&e.compare.type===wt.COMPARE_ITEM)switch(e.compare.method){case Cs.IS_EQ:return nn(e,"isEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_NOT_EQ:return nn(e,"isNotEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_LESS_THAN:return nn(e,"isLessThan",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_GREATER_THAN:return nn(e,"isGreaterThan",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_LESS_THAN_OR_EQ:return nn(e,"isLessThanOrEq",[ae(e.lhs),ae(e.rhs)]);case Cs.IS_GREATER_THAN_OR_EQ:return nn(e,"isGreaterThanOrEq",[ae(e.lhs),ae(e.rhs)])}return re(e,"")}function Ls(e,t,n){return e.prepend(`api.${t}(`),e.add([", ",ae(n),")"])}function gw(e,t,n){return e.prepend(`api.${t}(`),e.add([ae(n),")"])}function uP(e,t){if(e.type===wt.OPERATOR_ITEM)switch(e.operator){case ci.PLUS:return Ls(t,"opPlus",e.rhs);case ci.MINUS:return Ls(t,"opMinus",e.rhs);case ci.POWER:return Ls(t,"opPower",e.rhs);case ci.MULTIPLY:return Ls(t,"opMultiply",e.rhs);case ci.DIVIDE:return Ls(t,"opDivide",e.rhs);case ci.MOD_DIVIDE:return Ls(t,"opModDivide",e.rhs);case ci.FLOOR_DIVIDE:return Ls(t,"opFloorDivide",e.rhs);case ci.UNI_PLUS:return gw(t,"opUniPlus",e.rhs);case ci.UNI_MINUS:return gw(t,"opUniMinus",e.rhs)}return re(e,"")}function hP(e){if(e.type===wt.OPERATOR){const t=e.lhs?ae(e.lhs):re(e,"");return e.items.forEach(n=>uP(n,t)),t}return re(e,"")}function Wl(e,t){return re(e,[nn(e,"jump",[`${t}`]),"; continue;"])}function Li(e){return Yn.linelookup[e??""]??-1}function kd(e,t){Yn.linelookup[e]=t}function Ro(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&(i.done=n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&(i.skip=n);break;case wt.LINE:Ro(i.stmts,t,n);break}}}function _w(e,t,n){for(let r=0;r<e.length;++r){const i=e[r];switch(i.type){case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.ELSE_IF:i.type===t&&kd(i.done,n);break;case wt.IF_BLOCK:case wt.IF_CHECK:i.type===t&&kd(i.skip,n);break;case wt.LINE:_w(i.stmts,t,n);break}}}function ae(e){var t;switch(e.type){case wt.PROGRAM:return re(e,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...e.lines.map(ae).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${zl}`]);case wt.API:return re(e,["  ",nn(e,e.method,So(e.words)),`;
`]);case wt.LINE:return re(e,[`case ${e.lineindex}:
`,...e.stmts.map(ae).flat(),`  break;
`]);case wt.MARK:return re(e,`  // ${e.comment}
`);case wt.GOTO:{const n=Li(e.id);return re(e,["  ",Wl(e,n),`
`])}case wt.COUNT:return re(e,`${e.index}`);case wt.LITERAL:switch(e.literal){case jl.NUMBER:return re(e,`${e.value}`);case jl.STRING:return re(e,yd(e.value));case jl.TEMPLATE:return re(e,bd(e.value))}return mw(e);case wt.TEXT:return re(e,["  ",nn(e,"text",[bd(e.value)]),`;
`]);case wt.STAT:if(Yn.isfirststat){Yn.isfirststat=!1;const n=e.value.trim().split(" ").map(yd);return re(e,["  ",nn(e,"stat",n),`;
`])}return re(e,`  // skipped ${e.value}
`);case wt.LABEL:{const n=It(e.name),r=e.active?"label":"comment";Yn.labels[n]||(Yn.labels[n]=[]);const i=(e.active?1:-1)*e.lineindex;return Yn.labels[n].push(i),re(e,`  // ${i} '${n}' ${r}
`)}case wt.HYPERLINK:return re(e,["  ",nn(e,"hyperlink",[bd(e.text),...So(e.link)]),`;
`]);case wt.MOVE:{const n=nn(e,"command",[yd("go"),So(e.words)].flat());return e.wait?re(e,["  if (",n,`) { continue; };
`]):re(e,["  ",n,`;
`])}case wt.COMMAND:return re(e,["  if (",nn(e,"command",So(e.words)),`) { continue; };
`]);case wt.IF:{const n=((t=e.block)==null?void 0:t.type)===wt.IF_BLOCK?e.block:void 0;if(k(n)){Ro([e.check],wt.IF_CHECK,n.skip);const r=re(e,ae(e.check));return n.lines.forEach(i=>r.add(ae(i))),_w(n.altlines,wt.ELSE_IF,Li(n.done)),n.altlines.forEach(i=>r.add(ae(i))),r}return re(e,ae(e.check))}case wt.IF_CHECK:{const n=Li(e.skip);return n===-1?re(e,["  ",nn(e,e.method,So(e.words)),`;
`]):re(e,["  if (!",nn(e,e.method,So(e.words)),") { ",Wl(e,n),` }
`])}case wt.ELSE_IF:case wt.ELSE:{const n=re(e,"");return e.lines.forEach(r=>n.add(ae(r))),n}case wt.WHILE:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.REPEAT:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.WAITFOR:{const n=re(e,"");return Ro(e.lines,wt.IF_CHECK,e.loop),e.lines.forEach(r=>{n.add(ae(r))}),n}case wt.FOREACH:{const n=Li(e.loop),r=Li(e.done),i=re(e,"");return Ro(e.lines,wt.IF_CHECK,e.done),e.lines.forEach(s=>{switch(s.type){case wt.BREAK:s.goto=r;break;case wt.CONTINUE:s.goto=n;break}i.add(ae(s))}),i}case wt.BREAK:return re(e,["  ",Wl(e,e.goto),`
`]);case wt.CONTINUE:return re(e,["  ",Wl(e,e.goto),`
`]);case wt.OR:return nn(e,"or",e.items.map(ae));case wt.AND:return nn(e,"and",e.items.map(ae));case wt.NOT:return nn(e,"not",e.items.map(ae));case wt.COMPARE:return lP(e);case wt.OPERATOR:return hP(e);case wt.EXPR:return nn(e,"expr",e.words.map(ae));default:return console.error("<unsupported node>",e.type,e),mw(e)}}function li(e){if(k(e))switch(e.type===wt.LINE&&++Yn.lineindex,e.lineindex=Yn.lineindex,e.type){case wt.PROGRAM:e.lines.forEach(li);break;case wt.LINE:e.stmts.forEach(li);break;case wt.MARK:kd(e.id,e.lineindex);break;case wt.IF:li(e.check),li(e.block);break;case wt.IF_BLOCK:e.lines.forEach(li),e.altlines.forEach(li);break;case wt.ELSE_IF:e.lines.forEach(li);break;case wt.ELSE:case wt.WHILE:case wt.REPEAT:case wt.FOREACH:case wt.WAITFOR:e.lines.forEach(li);break;case wt.MOVE:case wt.COMMAND:case wt.IF_CHECK:e.words.forEach(li);break}}function fP(e){Yn.labels={},Yn.internal=1,Yn.lineindex=0,Yn.isfirststat=!0,li(e)}function dP(e){return fP(e),{...ae(e).toStringWithSourceMap({file:`${zl}.map`}),...Yn}}function yw(e){return ue(e)?e.length>0?1:0:e??0}function pP(e){return`${e}_chip`}function bw(e=""){return`vm:${e??""}`}function mP(e,t,n){var l,u;const r=pP(e),i=br(r);let s;const o=wr(Object.entries(n.labels??{}));(!ue(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(f,d){E.words=d;const h=NB(t,f);return k(h)?h(c,d):f!=="send"?a("shortsend",[f,...d]):0}const c={halt(){NP(r)},id(){return e},set(f,d){const[h,m]=CB(t,c,f,d);if(h)return m},get(f){const[d,h]=IB(t,c,f);if(d)return h},tick(f){const d=xt(i.ps)?i.ps:0,h=d%f===0;if(i.ps=d+1,h===!1)return!1;if(c.shouldtick()===!1)return Qk(t,c),!1;i.lc=0,i.ys=0,E.get=c.get,LB(t,c);try{const m=s==null?void 0:s.next();m!=null&&m.done&&(i.es=1)}catch(m){de(et,E.elementfocus,"crash",m.message),i.es=1}return Qk(t,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return xt(i.lc)?++i.lc>wi.HALT_AT_COUNT:!0},hm(){if(ue(i.mg)&&ue(i.lb)){const[f]=i.mg;if(k(f))for(let d=0;d<i.lb.length;++d){const[h,m]=i.lb[d];if(h===f)return m.find(p=>xt(p)&&p>0)??0}}return 0},yield(){i.ys=1},jump(f){i.ec=f},sy(){return!!i.ys||c.shouldhalt()},send(f,d,h,m){et.emit(f,`${bw(d)}:${h}`,m)},lock(f){i.lk=f},unlock(){i.lk=""},message(f){i.lk&&f.sender!==i.lk||(i.mg=[f.target,f.data,f.sender,f.player])},zap(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f){const m=h[1].findIndex(p=>p>0);if(m>=0&&k(h[1])){h[1][m]*=-1;break}}}},restore(f){if(ue(i.lb))for(let d=0;d<i.lb.length;++d){const h=i.lb[d];if(h[0]===f)for(let m=0;m<h[1].length;m++)h[1][m]=Math.abs(h[1][m])}},getcase(){i.ec=xt(i.ec)?i.ec:1;const f=c.hm();if(f&&ue(i.mg)){const[,d,h,m]=i.mg;c.set("sender",h),k(d)&&c.set("arg",d),m&&(c.set("player",m),E.elementfocus=m),i.mg=void 0,i.ys=0,i.es=0,i.ec=f}return i.ec},nextcase(){const f=xt(i.ec)?i.ec:1;return i.ec=f+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(f){const d=bS.parse(f),[h]=d.filter(m=>m.fileName===zl);return{line:(h==null?void 0:h.lineNumber)??0,column:(h==null?void 0:h.columnNumber)??0}},text(f){return a("text",[f])},stat(...f){return a("stat",f)},hyperlink(...f){return a("hyperlink",f)},command(...f){if(f.length===0)return 0;const[d,...h]=f;return a(It(Se(d)),h)},if(...f){const[d,h]=st(f,0,[H.ANY]),m=yw(d);return m&&h<f.length&&c.command(...f.slice(h)),m?1:0},try(...f){const[,d]=st(f,0,[H.DIR]),h=c.command("go",...f);return h&&d<f.length&&c.command(...f.slice(d)),h?1:0},take(...f){const[d,h,m]=st(f,0,[H.NAME,H.ANY]),p=xt(h),b=p?m:1,y=c.get(d),v=p?h:1;if(!xt(y))return b<f.length&&c.command(...f.slice(b)),1;const T=y-v;return T<0?(b<f.length&&c.command(...f.slice(b)),1):(c.set(d,T),0)},give(...f){const[d,h,m]=st(f,0,[H.NAME,H.ANY]),p=xt(h),b=p?m:1,y=c.get(d),v=p?h:1,T=y===void 0?1:0;return T&&b<f.length&&c.command(...f.slice(b)),c.set(d,ca(y,0)+v),T},repeatstart(f,...d){const[h,m]=st(d,0,[H.NUMBER]),p=`repeatcount${f}`,b=`repeatwords${f}`;i[p]=h,i[b]=m<d.length?d.slice(m):void 0},repeat(f){const d=`repeatcount${f}`,h=`repeatwords${f}`;if(!xt(i[d]))return 0;const m=i[d];i[d]=m-1;const p=m>0,b=i[h];return p&&ue(b)&&c.command(...b),p?1:0},foreachstart(f,...d){const[h,m,p,b]=st(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let y=Math.min(m,p),v=Math.max(m,p);const T=(b??0)||1;if(T<0){const A=y;y=v,v=A}return c.set(h,y-T),0},foreach(f,...d){const[h,m,p,b,y]=st(d,0,[H.NAME,H.NUMBER,H.NUMBER,H.MAYBE_NUMBER]);let v=Math.min(m,p),T=Math.max(m,p);const A=(b??0)||1;if(A<0){const C=v;v=T,T=C}let U=c.get(h);!xt(U)||U<v||U>T?U=v:U+=A;const S=U<=T?1:0;return S&&(c.set(h,U),y<d.length&&c.command(...d.slice(y))),S},waitfor(...f){const[d]=st(f,0,[H.ANY]),h=yw(d);return h||c.yield(),h?1:0},or(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=st(f,h,[H.ANY]);if(d=m,d)break;h=p}return d},and(...f){let d=0;for(let h=0;h<f.length;){const[m,p]=st(f,h,[H.ANY]);if(d=m,!d)break;h=p}return d},not(...f){const[d]=st(f,0,[H.ANY]);return d?0:1},expr(...f){const[d]=st(f,0,[H.ANY]);return d},isEq(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return typeof h=="object"||typeof m=="object"?LE(h,m)?1:0:h===m?1:0},isNotEq(f,d){return this.isEq(f,d)?0:1},isLessThan(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h<m?1:0},isGreaterThan(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h>m?1:0},isLessThanOrEq(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h<=m?1:0},isGreaterThanOrEq(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h>=m?1:0},opPlus(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return h+m},opMinus(f,d){const[h]=st([f],0,[H.ANY]),[m]=st([d],0,[H.ANY]);return h-m},opPower(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return Math.pow(h,m)},opMultiply(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h*m},opDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h/m},opModDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return h%m},opFloorDivide(f,d){const[h]=st([f],0,[H.NUMBER]),[m]=st([d],0,[H.NUMBER]);return Math.floor(h/m)},opUniPlus(f){const[d]=st([f],0,[H.NUMBER]);return+d},opUniMinus(f){const[d]=st([f],0,[H.NUMBER]);return-d}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function wd(e){if(!e||e.type===void 0)return;const t=[{start:e.startOffset,end:e.endOffset??0}];return Object.keys(e).forEach(n=>{if(n!=="parent"){const r=e[n];ue(r)?r.forEach(i=>{t.push(wd(i))}):t.push(wd(r))}}),e.range={start:Math.min(...t.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...t.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},e.range}function gP(e){const t=lk(`${e}
`);if(t.errors.length>0)return t;Ao.input=t.tokens;const n=Ao.program();if(Ao.errors.length>0)return{tokens:t.tokens,errors:Ao.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=aP.go(n);return r?(wd(r),{tokens:t.tokens,cst:n,ast:r}):{tokens:t.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const Ed=Object.getPrototypeOf(function*(){}).constructor;function _P(e,t){const n=`compile-${e}`;console.time(n);const r=gP(t);if(console.timeEnd(n),Zm&&console.info(t,r.errors),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=dP(r.ast);if(i.code){Zm&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Ed("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Ed("api"," ")}}}return{...r,...i,source:"",code:new Ed("api"," ")}}function yP(){const e={},t={};function n(i,s){const o=e[s];if(o)return o;const a=_P(i,s);return e[s]=a,a}const r={ids(){return Object.keys(t)},isended(i){const s=t[i];return k(s)?s.isended():!0},halt(i){const s=t[i];return k(s)&&(s.halt(),delete t[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=t[i];k(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=t[i];if(!k(t[i])){const f=n(a,c);if(l=t[i]=mP(i,s,f),(u=f.errors)!=null&&u.length){const[d]=f.errors,h=((d==null?void 0:d.line)??2)-1,m=c.replaceAll(`\r
`,"").split(`
`).map((y,v)=>[y,v]);m.slice(h-5,h).forEach(([y,v])=>{de(et,sr(),"build",`$grey${v+1} $grey${y}`)});const[p,b]=m[h]??[];if(yt(p)&&k(b)){const y=(d.column??1)-1,v=y+d.length,T=y<p.length?p:`${p}*`,A=T.substring(0,y),U=T.substring(y,v),S=T.substring(v);de(et,sr(),"build",`$red${b+1} $grey${A}$red${U}$grey${S}`)}return d.message.split(`
`).forEach(y=>{de(et,sr(),"build",y)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=Fn(i.target),a=t[s];if(k(a)){const c={...i,target:o};a.message(c)}}};return r}const En=new Xo,Nn={},Gl={};function kw(e,t,n,r,i,s=0){const o=`tiles:${e}:${t}`;return k(Nn[o])||(Nn[o]=ES(e,t,n,r,i,s)),Nn[o]}function bP(e,t,n,r){const i=`sprites:${e}:${t}:${n}`,s=`sprite:${e}:${t}:${r}`;return k(Gl[s])||(Gl[s]=xS(e,t,n)),Gl[s].id=i,Gl[s]}function kP(e,t){const n=`sprites:${e}:${t}`;return k(Nn[n])||(Nn[n]=vS(e,t)),Nn[n]}function wP(e,t,n,r,i=0){const s=`dither:${e}:${t}`;return k(Nn[s])||(Nn[s]=TS(e,t,n,r,i)),Nn[s]}function Kl(e,t,n,r){const i=`media:${e}:${t}`;k(Nn[i])||(Nn[i]=AS(e,t,n,r));const s=Nn[i];return s.mime=n,s.media=r,s}function EP(e,t){const n=`control:${e}:${t}`;return k(Nn[n])||(Nn[n]=SS(e,t)),Nn[n]}const Zi=3;function ww(e,t){const n=[],r=(e.x+.5)*Wi,i=(e.y+.5)*Gi,s=t.x*Wi,o=t.y*Gi,a=s-r,c=o-i;En.x=a-Zi,En.y=c-Zi,n.push(En.angle()),En.x=a+Wi+Zi,En.y=c-Zi,n.push(En.angle()),En.x=a-Zi,En.y=c+Gi+Zi,n.push(En.angle()),En.x=a+Wi+Zi,En.y=c+Gi+Zi,n.push(En.angle());const l=n.map(h=>Math.round(om(h))),u=Math.min(...l),f=Math.max(...l);if(f-u>180){const h=l.filter(y=>y<180),m=l.filter(y=>y>180),p=Math.max(...h);return[Math.min(...m),p]}return[u,f]}function Hl(e,t,n,r,i,s,o,a,c){var T;const l={x:a,y:c},u=Dr(e,l);if(u===-1)return;En.x=a-i.x,En.y=c-i.y;const f=En.length();if(f>s)return;const d=Math.round(om(En.angle()));let h=0;for(let A=0;A<n.length;++A){const[U,S,C]=n[A];U>S?(d>=U||d<=S)&&(h=Math.max(h,C)):d>=U&&d<=S&&(h=Math.max(h,C))}const m=s*.5;t[u]=Math.min(t[u],h+(f<m?0:(f-m)*o)),t[u]=pn(t[u],0,1);const p=Cn(e,((T=e.lookup)==null?void 0:T[u])??"");if(k(p)){const A=[...ww(i,l),.25];r.push(A)}const b=e.terrain[u],y=ui(b),v=(b==null?void 0:b.collision)??(y==null?void 0:y.collision);if(Zo(Wt.ISBULLET,v)){const A=[...ww(i,l),1];r.push(A)}}function xd(e,t,n,r,i,s){if(!k(n)||!k(n.terrain)||!k(n.objects))return[];const o=[];let a=t;const c=St,l=Vt,u=s?Ot.BLACK:Ot.ONCLEAR,f=kw(e,a++,"terrain",c,l,u);o.push(f);const d=a++,h=kP(e,d);h.sprites=[],o.push(h);const m=n.isdark?1:0,p=wP(e,a++,c,l,m);o.push(p),p.alphas.fill(m);const b=kw(e,a++,"tickers",c,l,Ot.ONCLEAR);o.push(b),b.char.fill(0);const y={...od(St,Vt,r,Ot.ONCLEAR),...b},v=EP(e,a++);if(i){o.push(v);const{graphics:j,camera:N,facing:W}=br(e),q=n.graphics??j??"",L=n.camera??N??"",O=n.facing??W??"";if(yt(q)){const w=It(q);switch(w){case"fpv":case"iso":case"mode7":v.graphics=w;break;default:case"flat":v.graphics="flat";break}}if(yt(L))switch(It(L)){default:case"mid":v.viewscale=Bc.MID;break;case"near":v.viewscale=Bc.NEAR;break;case"far":v.viewscale=Bc.FAR;break}xt(O)&&(v.facing=sm(O%360))}for(let j=0;j<n.terrain.length;++j){const N=n.terrain[j],W=Rs(N,0,Ot.WHITE,s?Ot.BLACK:Ot.ONCLEAR),q=Gt(N,"collision");f.char[j]=W.char,f.color[j]=W.color,f.bg[j]=W.bg,f.wall[j]=q===Wt.ISSOLID?1:0}const T=Object.values(n.objects??{}),A=new Set;for(let j=0;j<T.length;++j){const N=T[j];_n(N.id)&&xt(N.x)&&xt(N.y)&&A.add(lr(N,St))}for(let j=0;j<T.length;++j){const N=T[j];if(yt(N.tickertext)&&xt(N.tickertime)&&N.tickertext.length){const O=St,w=Ok(N.tickertext,O,Vt-1),I=(w==null?void 0:w.measuredwidth)??1,$=N.x??0,B=N.y??0,it=B<Vt*.5;y.x=$-Math.floor(I*.5),y.y=B+(it?1:-1),y.x+I>St&&(y.x=St-I),y.x<0&&(y.x=0),Rk(N.tickertext,y,!0)}if(k(N.removed))continue;const W=N.id??"";if(_n(W)===!1&&xt(N.x)&&xt(N.y)&&A.has(lr(N,St))===!0)continue;const q=Rs(N,1,Ot.WHITE,Ot.BLACK),L=bP(e,d,W,j);if(L.x=N.x??0,L.y=N.y??0,L.char=q.char,L.color=q.color,L.bg=q.bg,h.sprites.push(L),m){if(q.light>0){const O=Dr(n,L),w=pn(Math.round(q.light),1,Vt),I=1/(w*.5);if(p.alphas[O]=0,w>1){const $=[];for(let B=1;B<=w;++B){if(B===2){const rt=Gt(N,"lightdir");if(Rr(rt)){const z=Jl(n,N,"",rt,L);switch(Sr(L,z.destpt)){case mt.EAST:$.push([45,315,1]);break;case mt.WEST:$.push([225,135,1]);break;case mt.NORTH:$.push([315,225,1]);break;case mt.SOUTH:$.push([135,45,1]);break}}}const it=[];for(let rt=L.y-B;rt<=L.y+B;++rt)Hl(n,p.alphas,$,it,L,w,I,L.x-B,rt),Hl(n,p.alphas,$,it,L,w,I,L.x+B,rt);const Q=B-1;for(let rt=L.x-Q;rt<=L.x+Q;++rt)Hl(n,p.alphas,$,it,L,w,I,rt,L.y-B),Hl(n,p.alphas,$,it,L,w,I,rt,L.y+B);for(let rt=0;rt<it.length;++rt){const z=it[rt];let P=0;for(P=0;P<$.length;++P){const ft=$[P];if(ft[1]>ft[0]&&z[1]>=ft[0]&&z[0]<=ft[1]&&z[2]>=1&&ft[2]>=1){$[P]=[Math.min(z[0],ft[0]),Math.max(z[1],ft[1]),1];break}}P===$.length&&$.push(z)}}}}else if(_n(W)){const O=Dr(n,L);p.alphas[O]=0}}W===e&&(v.focusx=L.x,v.focusy=L.y,v.focusid=W)}o.push(Kl(e,a++,"text/mood",m?"dark":"bright"));const U=ce($t.MAIN),S=Ni(U,$t.MAIN);if(yt(S.palette)){const j=en(U,bt.PALETTE,S.palette),N=Re(j);k(N==null?void 0:N.bits)&&o.push(Kl(e,a++,"image/palette",Array.from(N.bits)))}if(yt(S.charset)){const j=en(U,bt.CHARSET,S.charset),N=Re(j);k(N==null?void 0:N.bits)&&o.push(Kl(e,a++,"image/charset",Array.from(N.bits)))}const C=Object.keys(n.objects).filter(_n);return o.push(Kl(e,a++,"text/players",C.join(","))),o}const ir=yP();var $t=(e=>(e.MAIN="main",e.TITLE="title",e.PLAYER="player",e.GADGETSTORE="gadgetstore",e.GADGETSYNC="gadgetsync",e))($t||{});const ke={halt:!1,session:De(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function xP(){return ke.session}function sr(){return ke.operator}function vP(e){ke.operator=e}function TP(e){ke.halt=e}function AP(){return ke.halt}function Fr(){return[...ke.books.values()]}function SP(){const[e]=ke.books.values();return e}function Br(e){const t=It(e);return ke.books.get(e)??Fr().find(n=>n.name===t)}function Ew(e,t){k(Br(t))&&(ke.software[e]=t)}function ce(e){return Br(ke.software[e])}function xw(e){const t=qf([]);return yt(e)&&(t.name=e),Yl(t),xe(et,ke.operator,`created [book] ${t.name}`),t}function RP(e){let t=Br(e);return k(t)||(t=qf([]),t.name=e),Yl(t),xe(et,ke.operator,`created [book] ${t.name}`),t}function ln(e,t){let n=k(t)?RP(t):ce(e);return k(n)||(k(n)||(n=SP()),k(n)||(n=xw(t)),k(n)&&xe(et,ke.operator,`opened [book] ${n.name} for ${e}`)),Ew(e,n.id),n}function Qi(e,t,n){return Zf(ln(e),n,t)}function Pr(e,t){const n=ce("main"),r=kn(gk(n,e,t));if(k(r))return r;const i=Fr();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==(n==null?void 0:n.id)){const a=kn(gk(o,e,t));if(k(a))return a}}}function ui(e){if(k(e==null?void 0:e.kinddata))return e.kinddata;if(!yt(e==null?void 0:e.kind)||!e.kind)return;const t=Pr(bt.OBJECT,e.kind);if(k(t))return e.kinddata=Re(t),e.kinddata;const n=Pr(bt.TERRAIN,e.kind);if(k(n))return e.kinddata=Re(n),e.kinddata}function Gt(e,t){const n=e==null?void 0:e.kinddata,r=(n==null?void 0:n.id)??"",i=e==null?void 0:e[t];if(k(i))return i;const s=n==null?void 0:n[t];if(k(s))return s;const o=Pr(bt.OBJECT,r)??Pr(bt.TERRAIN,r),a=Vf(o,t);if(k(a))return a;switch(t){case"group":return"";case"cycle":return Ax;case"item":return 0;case"pushable":return 0;case"breakable":return 0;case"collision":return Wt.ISWALK;default:return}}function $r(e,t,n,r){if(!k(e)||!k(t))return;const[i,s]=t,o=Pr(bt.OBJECT,i);if(k(o)){const c=Ad(e,n,i,r);if(k(c))return sa(c,s),mS(e,c),ui(c),Vm(e,c),c}const a=Pr(bt.TERRAIN,i);if(k(a)){const c=VP(e,n,i);if(k(c)){sa(c,s);const l=lr(n,St);return ui(c),Vm(e,c,l),c}}}function OP(e,t,n){if(!k(e)||!k(t))return;const[r,i]=t,s=Pr(bt.OBJECT,r);if(k(s)){const o=Ad(e,n,r);return sa(o,i),o}}function un(e){const t=Pr(bt.BOARD,e);return Re(t)}function br(e){const t=ln("main");return Ni(t,e)}function vw(e){const t=ln("main");return bU(t,e)}function Tw(){const e=ln("main");return Ni(e,"main")}function NP(e){const t=ln("main");return bk(t,e)}function IP(e,t){ke.books.clear(),e.forEach(r=>{ke.books.set(r.id,r),r.name==="main"&&(ke.software.main=r.id)});const n=Br(t);if(k(n)&&(ke.software.main=n.id),!ke.software.main){const r=ke.books.values().next();r.value&&(ke.software.main=r.value.id)}}function Yl(e){return ke.books.set(e.id,e),e.id}function CP(e){const t=Br(e);t&&ke.books.delete(t.id)}function Aw(e){if(!yt(e)||!e)return de(et,e,"login",`failed for playerid ==>${e}<==`);const t=ce("main");if(!k(t))return de(et,e,"login:main","login failed to find book 'main'","login",`failed for playerid ==>${e}<==`);const n=hn(e),r=Pr(bt.BOARD,"title");if(!k(n)&&!k(r))return de(et,e,"login:title","login failed to find board with 'title' stat");const i=Pr(bt.OBJECT,"player");if(!k(i))return de(et,e,"login:player","login failed to find object type 'player'");const s=Re(r);if(k(s)){const o=Vf(r,"startx"),a=Vf(r,"starty"),c=xt(o)?o:Math.round(St*.5),l=xt(a)?a:Math.round(Vt*.5),u=Ad(s,{x:c,y:l},"player",e);if(k(u==null?void 0:u.id))return u.player=e,Nl(t,e,s.id),!0}return!1}function LP(e){const t=ce("main"),n=Ca(t,e);if(!k(t))return;const r=[e];for(let i=0;i<t.activelist.length;++i){const s=t.activelist[i];s.startsWith(e)&&r.push(s)}for(let i=0;i<r.length;++i){const s=r[i];Nl(t,s,""),Ch(n,Cn(n,s)),Cw(n,s),ir.halt(s),bk(t,s)}}function hn(e){const t=ce("main");return Ca(t,e)}function MP(e){const t=ce("main"),n=xU(t,e),r=Ca(t,e),i=Cn(r,e);return n&&k(i)}function UP(e){const t=ce("main"),n=ko(t);for(let r=0;r<n.length;++r){const i=n[r],s=Object.keys(i.objects);for(let o=0;o<s.length;++o){const c=i.objects[s[o]].id;_n(c)&&k(e[c])===!1&&(e[c]=0,Nl(t,c,i.id))}}}function Sw(e){ir.message(e)}function In(e,t,n,r){const i=Or(t);yt(n.id)&&et.emit(e,"vm:touched",[n.id,i,r])}function FP(e,t,n,r){const i=n.id??"";if(r.x<0){const s=un((t==null?void 0:t.exitwest)??"");k(s)&&bo(e,i,s.id,{x:St-1,y:r.y})}else if(r.x>=St){const s=un((t==null?void 0:t.exiteast)??"");k(s)&&bo(e,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=un((t==null?void 0:t.exitnorth)??"");k(s)&&bo(e,i,s.id,{x:r.x,y:Vt-1})}else if(r.y>=Vt){const s=un((t==null?void 0:t.exitsouth)??"");k(s)&&bo(e,i,s.id,{x:r.x,y:0})}}function ts(e,t,n,r){if(!k(n==null?void 0:n.id))return!1;const i=Bh(t,n,r);if(k(i)){const s=_n(n.id),o=_n(n.party??n.id),a=Gt(n,"collision")===Wt.ISBULLET;let c="";n.party&&o&&(c=n.party),s&&(c=n.id);const l=_n(i.id),u=_n(i.party??i.id),f=Gt(i,"collision")===Wt.ISBULLET,d=o===u;let h="";if(i.party&&u&&(h=i.party),l&&(h=i.id??""),s&&i.kind==="edge"?FP(e,t,n,r):s?l?(In("",i,n,"bump"),In("",n,i,"bump")):f?(In("",i,n,d?"partyshot":"shot"),In(c,n,i,"touch")):(In("",i,n,"thud"),In(c,n,i,"touch")):a?f?(In("",i,n,"thud"),In("",n,i,"thud")):(In("",i,n,l?"touch":"thud"),In(d?"":c,n,i,d?"partyshot":"shot")):l?In(h,i,n,"touch"):f?(In(d?"":h,i,n,d?"partyshot":"shot"),In("",n,i,d?"thud":"touch")):(In("",i,n,"thud"),In("",n,i,"bump")),s&&Gt(i,"item")||a&&Gt(i,"breakable")){if(k(i==null?void 0:i.id)){const m=ie(t,{x:i.x??-1,y:i.y??-1});k(m)&&xn(E.board,m,E.timestamp)}else Oe(t,{x:r.x,y:r.y});return!0}return!1}return!0}function Rw(e,t,n,r){var l;if(!k(e)||!k(t)||!k(n))return;const i={...E};E.book=e,E.board=t,E.element=n,E.elementid=n.id??"",E.elementisplayer=_n(E.elementid);const s=E.element.player??ke.operator;E.elementfocus=E.elementisplayer?E.elementid:s;const o=Gt(n,"cycle"),a=n.id??"",c=It(n.name??((l=n.kinddata)==null?void 0:l.name)??"");if(ir.tick(a,Ji.RUNTIME,o,c,r),xt(n==null?void 0:n.tickertime)&&E.timestamp-n.tickertime>Ha*5&&(n.tickertime=0,n.tickertext=""),E.elementisplayer){const u=br(E.elementid);xt(u.inputcurrent)&&(u.inputcurrent=0)}qn(i).forEach(u=>{E[u]=i[u]})}function BP(e,t){ke.loaders.set(e,t)}function PP(e){ir.halt(e)}function $P(){const e=ir.ids();for(let n=0;n<e.length;++n)ir.halt(e[n]);const t=ce("main");k(t)&&(t.flags={})}function DP(e=!1){const t=ce("main");if(!k(t))return;const n=t.timestamp+1,r=wi.HALT_AT_COUNT;wi.HALT_AT_COUNT=r*2,ke.loaders.forEach((s,o)=>{const a={...E};E.timestamp=t.timestamp,E.book=t,E.board=void 0,E.element=void 0,E.elementid=o,E.elementisplayer=!1,E.elementfocus=sr();const c=YF(o);k(c)&&ir.arg(o,c),ir.tick(o,Ji.LOADER,1,"loader",s),ir.isended(o)&&(ir.halt(o),ke.loaders.delete(o)),qn(a).forEach(l=>{E[l]=a[l]})}),wi.HALT_AT_COUNT=r,t.timestamp=n,E.timestamp=n;const i=ko(t);for(let s=0;s<i.length;++s){const o=i[s];for(let l=0;l<o.terrain.length;++l)ui(o.terrain[l]);const a=Object.keys(o.objects);for(let l=0;l<a.length;++l){const u=a[l];ui(o.objects[u])}const c=US(o,n);for(let l=0;l<c.length;++l){const{id:u,type:f,code:d,object:h}=c[l];f===bt.ERROR?ir.halt(u):(!e||_n((h==null?void 0:h.id)??""))&&Rw(t,o,h,d)}}}function Oo(e,t,n,r){const i=ce("main");if(!k(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(k(c.id)){const l=`${bw(c.id)}:${t}`;et.emit("",l,n)}}}if(ms(e)){for(let o=0;o<r.length;++o){const a=r[o],c=ie(a,e);k(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(It(e)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(km(a,[e]));break}}}}function jP(e){const t=br(e),n=t.playbuffer=yt(t.playbuffer)?t.playbuffer:"";n&&Ow(e,n,!1)}function Ow(e,t,n=!0){var o;const r=ln("main");if(!k(r))return;const i=`${e}_cli`;E.timestamp=r.timestamp,E.book=r,E.board=Ca(r,e),E.element=Cn(E.board,e),E.elementid=((o=E.element)==null?void 0:o.id)??"",E.elementisplayer=!0,E.elementfocus=E.elementid||e;const s=wi.HALT_AT_COUNT;if(wi.HALT_AT_COUNT=s*8,ir.once(i,Ji.CLI,"cli",t),n){const a=br(e);a.playbuffer=t}wi.HALT_AT_COUNT=s}function Vl(e){var a;const t=ln("main"),n=As(t,e);if(!k(t)||!k(n)||!k(E.element))return;const r={...E},i=`${e}_run`,s=It(E.element.name??((a=E.element.kinddata)==null?void 0:a.name)??""),o=(n==null?void 0:n.code)??"";ir.once(i,Ji.RUNTIME,s,o),qn(r).forEach(c=>{E[c]=r[c]})}function zP(e,t){const n=ce("main"),r=Ca(n,e),i=[],s=[],o=[];if(!k(n)||!k(r))return{over:i,under:s,layers:o};const a=r.graphics??"flat",c=un(r.overboard??""),l=un(r.underboard??"");return s.push(...xd(e,0,l,t,!1,!0)),o.push(...xd(e,s.length,r,t,!0,a!=="flat")),i.push(...xd(e,s.length+o.length,c,t,!1,!1)),{over:i,under:s,layers:o}}function WP(e,t,n,r){if(!k(e))return;k(e.distmaps)||(e.distmaps={});const i=`${t}.${n.x}.${n.y}.${r.x}.${r.y}`;let s=e.distmaps[i];if(!k(s)){s=new Array(xh).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(k(c)&&ql(c)){const l=lr(c,St);if(s[l]===-2){const u=es(e,c.x,c.y);Zo(t,Gt(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}e.distmaps[i]=s}return s}function Nw(e,t){return ql(e)?t[lr(e,St)]:-1}function Iw(e,t,n,r,i){if(!k(e))return;const s=WP(e,t,n,r);if(!k(s))return;const o=[{x:n.x,y:n.y-1},{x:n.x,y:n.y+1},{x:n.x-1,y:n.y},{x:n.x+1,y:n.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=Nw(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=Nw(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function GP(){return new Array(St*Vt).map(()=>{})}function Xl(e=fu){const t={terrain:GP(),objects:{},id:""};return e(t)}var vd=(e=>(e[e.terrain=0]="terrain",e[e.objects=1]="objects",e[e.isdark=2]="isdark",e[e.over=3]="over",e[e.under=4]="under",e[e.exitnorth=5]="exitnorth",e[e.exitsouth=6]="exitsouth",e[e.exitwest=7]="exitwest",e[e.exiteast=8]="exiteast",e[e.timelimit=9]="timelimit",e[e.restartonzap=10]="restartonzap",e[e.maxplayershots=11]="maxplayershots",e[e.camera=12]="camera",e[e.graphics=13]="graphics",e))(vd||{});function KP(e){return co(e,vd,{terrain:t=>t.map(Lc),objects:t=>Object.values(t).filter(n=>!n.removed).map(Lc),id:Te,named:Te,lookup:Te,codepage:Te,distmaps:Te,overboard:Te,underboard:Te})}function HP(e){return ia(e,vd,{terrain:t=>t.map(Mc),objects:t=>{const n={};for(let r=0;r<t.length;++r){const i=Mc(t[r]);k(i==null?void 0:i.id)&&(n[i.id]=i)}return n}})}function ql(e){return dh(e.x,e.y,0,St-1,Vt-1,0)}function Dr(e,t){return!k(e)||!k(t==null?void 0:t.x)||!k(t==null?void 0:t.y)||t.x<0||t.x>=St||t.y<0||t.y>=Vt?-1:t.x+t.y*St}function ie(e,t){const n=Dr(e,t);if(n<0||!k(e==null?void 0:e.lookup))return;const r=Cn(e,e.lookup[n]??"");return k(r)?r:e.terrain[n]}function YP(e,t){const n=Cn(e,t);if(k(n))return n;const r=parseFloat(t),i=RA(isNaN(r)?-1:r,St);return es(e,i.x,i.y)}function es(e,t,n){return(t>=0&&t<St)??(n>=0&&n<Vt)?e==null?void 0:e.terrain[t+n*St]:void 0}function Oe(e,t){if(!k(e)||!k(t)||!k(t.x)||!k(t.y)||t.x<0||t.x>=St||t.y<0||t.y>=Vt)return;const n=wr(t),r=t.x+t.y*St;return e.terrain[r]=n,delete e.distmaps,e.terrain[r]}function Td(e,t){if(!k(e)||!k(t))return;const n=wr(t);return n.id=n.id??De(),e.objects[n.id]=n,e.objects[n.id]}function VP(e,t,n){return Oe(e,{...t,kind:n})}function Ad(e,t,n,r){return Td(e,{...t,kind:n,id:r})}function Cn(e,t){if(e)return e.objects[t]}function XP(e,t){const n=Dr(e,t);if(n<0||!k(e==null?void 0:e.lookup))return;const r=Cn(e,e.lookup[n]??"");if(k(r))return r}function xn(e,t,n){return!k(t)||Or(t)==="player"?!1:(t.id?(t.removed=n,Ch(e,t)):(Oe(e,{x:(t==null?void 0:t.x)??0,y:(t==null?void 0:t.y)??0}),gS(e,t)),!0)}function Cw(e,t){return k(e==null?void 0:e.objects[t])?(delete e.objects[t],!0):!1}function qP(e,t,n){if(!k(e)||!k(t))return;const r=e.objects[n];if(k(r))return r;if(ms(t))return wm(t,ta(e,"player"))}function Jl(e,t,n,r,i){const s=mt.MID;if(!k(e)||!k(t))return{dir:r,startpt:i,destpt:i,layer:s};const o={x:t.x??0,y:t.y??0},a={x:t.lx??o.x,y:t.ly??o.y},c=Sr(a,o),l=St-1,u=Vt-1;for(let f=0;f<r.length;++f){const d=DA(r[f]);switch(d){case mt.IDLE:break;case mt.NORTH:case mt.SOUTH:case mt.WEST:case mt.EAST:ze(o,d);break;case mt.BY:{const[h,m]=r.slice(f+1);xt(h)&&xt(m)&&(o.x=pn(o.x+h,0,l),o.y=pn(o.y+m,0,u)),f+=2;break}case mt.TO:case mt.AT:{const[h,m]=r.slice(f+1);xt(h)&&xt(m)&&(o.x=pn(h,0,l),o.y=pn(m,0,u)),f+=2;break}case mt.FLOW:ze(o,c);break;case mt.SEEK:{const h=qP(e,t,n);ms(h)&&ze(o,Sr(i,h));break}case mt.RNDNS:ze(o,kn(mt.NORTH,mt.SOUTH));break;case mt.RNDNE:ze(o,kn(mt.NORTH,mt.EAST));break;case mt.RND:ze(o,kn(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));break;case mt.CW:case mt.CCW:case mt.OPP:case mt.RNDP:{const h=Jl(e,t,n,r.slice(f+1),i);switch(o.x=i.x,o.y=i.y,d){case mt.CW:switch(Sr(i,h.destpt)){case mt.NORTH:ze(o,mt.EAST);break;case mt.SOUTH:ze(o,mt.WEST);break;case mt.EAST:ze(o,mt.SOUTH);break;case mt.WEST:ze(o,mt.NORTH);break}break;case mt.CCW:switch(Sr(i,h.destpt)){case mt.NORTH:ze(o,mt.WEST);break;case mt.SOUTH:ze(o,mt.EAST);break;case mt.EAST:ze(o,mt.NORTH);break;case mt.WEST:ze(o,mt.SOUTH);break}break;case mt.OPP:switch(Sr(i,h.destpt)){case mt.NORTH:ze(o,mt.SOUTH);break;case mt.SOUTH:ze(o,mt.NORTH);break;case mt.EAST:ze(o,mt.WEST);break;case mt.WEST:ze(o,mt.EAST);break}break;case mt.RNDP:switch(Sr(i,h.destpt)){case mt.NORTH:case mt.SOUTH:o.x+=kn(-1,1);break;case mt.WEST:case mt.EAST:o.y+=kn(-1,1);break}break}break}case mt.FLEE:case mt.AWAY:{const[h,m]=r.slice(f+1);if(xt(h)&&xt(m)){const p={x:pn(h,0,l),y:pn(m,0,u)},b=Gt(t,"collision"),y=Iw(e,b,o,p,!0);k(y)&&(o.x=y.x,o.y=y.y)}f+=2;break}case mt.FIND:case mt.TOWARD:{const[h,m]=r.slice(f+1);if(xt(h)&&xt(m)){const p={x:pn(h,0,l),y:pn(m,0,u)};if(ur(1,100)<5)ze(o,kn(mt.NORTH,mt.SOUTH,mt.WEST,mt.EAST));else{const b=Gt(t,"collision"),y=Iw(e,b,o,p,!1);if(k(y))if(y.x!==h&&y.y!==m&&XP(e,y))switch(Sr(i,y)){case mt.EAST:case mt.WEST:o.y+=kn(-1,1);break;case mt.NORTH:case mt.SOUTH:o.x+=kn(-1,1);break}else o.x=y.x,o.y=y.y}}f+=2;break}case mt.PLAYER:{const h=Qo(e,i,n);ms(h)&&(o.x=h.x,o.y=h.y);break}case mt.OVER:case mt.UNDER:{const h=Jl(e,t,n,r.slice(f+1),i);return h.layer=d,h}}}return{dir:r,startpt:i,destpt:o,layer:s}}const E={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var H=(e=>(e[e.COLOR=0]="COLOR",e[e.KIND=1]="KIND",e[e.DIR=2]="DIR",e[e.NAME=3]="NAME",e[e.NUMBER=4]="NUMBER",e[e.STRING=5]="STRING",e[e.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",e[e.MAYBE_KIND=7]="MAYBE_KIND",e[e.MAYBE_NAME=8]="MAYBE_NAME",e[e.MAYBE_NUMBER=9]="MAYBE_NUMBER",e[e.MAYBE_STRING=10]="MAYBE_STRING",e[e.MAYBE_NUMBER_OR_STRING=11]="MAYBE_NUMBER_OR_STRING",e[e.ANY=12]="ANY",e))(H||{});function vn(e,t,n){throw console.info(n,E.element,E.elementid,E.elementfocus),new Error(`Invalid arg, expected: ${e} but got ${JSON.stringify(t)}`)}function Lw(e){var n,r;const t={x:((n=E.element)==null?void 0:n.x)??0,y:((r=E.element)==null?void 0:r.y)??0};return Jl(E.board,E.element,E.elementfocus,e,t)}function st(e,t,n){const r=E.words;E.words=e;const i=[];let s=t;for(let o=0;o<n.length;++o)switch(n[o]){case 1:{const[a,c]=ym(s);oo(a)?(s=c,i.push(a)):vn("kind",a,e);break}case 0:{if(vc(e[s])===void 0){const[a,c]=Hn(s);qr(a)?(s=c,i.push(a)):vn("color",a,e)}else{const[a,c]=wh(s);qr(a)?(s=c,i.push(a)):vn("color",a,e)}break}case 2:{if(kh(e[s])===void 0){const[a,c]=Hn(s);Rr(a)?(s=c,i.push(Lw(a))):vn("direction",a,e)}else{const[a,c]=hm(s);Rr(a)?(s=c,i.push(Lw(a))):vn("direction",a,e)}break}case 3:{const a=E.words[s];yt(a)||vn("string",a,e),++s,i.push(a);break}case 4:{const[a,c]=Hn(s);if(yt(a)){const l=parseFloat(a);xt(l)?i.push(l):vn("number",a,e)}else xt(a)?i.push(a):vn("number",a,e);s=c;break}case 5:{const[a,c]=Hn(s);yt(a)||vn("string",a,e),s=c,i.push(a);break}case 6:{const[a,c]=Hn(s);let l=a;if(yt(l)){const u=parseFloat(l);xt(u)&&(l=u)}else xt(l)||vn("number or string",l,e);s=c,i.push(l);break}case 7:{const[a,c]=ym(s);a!==void 0&&!oo(a)&&vn("optional kind",a,e),s=c,i.push(a);break}case 8:{const a=E.words[s];a!==void 0&&!yt(a)&&vn("optional string",a,e),++s,i.push(a);break}case 9:{const[a,c]=Hn(s);if(yt(a)){const l=parseFloat(a);xt(l)?i.push(l):vn("optional number",a,e)}else xt(a)||a===void 0?i.push(a):vn("optional number",a,e);s=c;break}case 10:{const[a,c]=Hn(s);a!==void 0&&!yt(a)&&vn("optional string",a,e),s=c,i.push(a);break}case 11:{const[a,c]=Hn(s);let l=a;if(yt(l)){const u=parseFloat(l);xt(u)&&(l=u)}else l!==void 0&&!xt(l)&&vn("number or string",l,e);s=c,i.push(l);break}case 12:{const[a,c]=Hn(s);s=c,i.push(a);break}}return E.words=r,[...i,s]}const Zl={},No={};function Sd(){return{id:De(),layers:[],scroll:[],sidebar:[]}}const JP=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),ZP=new Set(["tx","text"]),QP={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},Mw={};let Uw=e=>{let t=Mw[e];return k(t)||(Mw[e]=t=Sd()),t};function t$(e){Uw=e}function Ye(e){return Uw(e)}function Rd(e){return k(Zl[e])||(Zl[e]=[]),Zl[e]}function e$(e){const t=Ye(e);t.scroll=[]}function n$(e,t,n){Object.values(No).forEach(r=>{if(r[t]!==void 0){const i=Jm(e.id(),t);xt(n)&&xA(i,n),yt(n)&&vA(i,n)}})}function Tn(e){const t=Rd(e);return Zl[e]=[],t}function Rt(e,t){Rd(e).push(t)}function Lt(e,t,n,r,i=()=>0,s=fu){const o=[t,n,...r],a=It(`${o[3]}`),c={...E};function l(u,f){k(f)&&f!==i(u)&&(E.board=c.board,E.element=c.element,E.elementfocus=c.elementfocus,s(u,f))}if(JP.has(a)){const u=`${o[2]}`;No[t]=No[t]??{};const f=i(u)??QP[a];if(No[t][u]===void 0){const d=Jm(t,u);xt(f)&&EA(d,f),yt(f)&&fh(d,f),ZP.has(a)?No[t][u]=Xp(d,h=>{l(u,h)}):No[t][u]=TA(d,h=>{l(u,h)})}}Rd(e).push(o)}t$(e=>{if(_n(e)){const t=ce($t.MAIN),n=Ni(t,$t.GADGETSTORE);let r=n[e];return k(r)||(n[e]=r=Sd()),r}return Sd()});let Fw=0;function r$(){switch(Fw++){case 0:return Ot.BLUE;case 1:return Ot.BLACK;case 2:return Ot.GREEN;case 3:return Ot.BLACK;case 4:return Ot.CYAN;case 5:return Ot.BLACK;case 6:return Ot.RED;case 7:return Ot.BLACK;case 8:return Ot.PURPLE;case 9:return Ot.BLACK;case 10:return Ot.YELLOW;case 11:return Ot.BLACK;case 12:return Ot.WHITE;default:return Fw=0,Ot.BLACK}}const Ql=Bs("gadgetserver",["tock","second"],e=>{if(!Ql.session(e))return;const t=ce($t.MAIN),n=(t==null?void 0:t.activelist)??[],r=Ni(t,$t.GADGETSYNC);switch(e.target){case"tock":{const i=r$();for(let s=0;s<n.length;++s){const o=n[s],{over:a,under:c,layers:l}=zP(o,i),u=Ye(o);u.over=a,u.under=c,u.layers=l;const f=r[o]??{},d=Vd(f,u);d.length&&(r[o]=wr(u),qE(Ql,o,d))}break}case"second":for(let i=0;i<n.length;++i){const s=n[i],o=hn(s);k(o)&&lx(Ql,s,o.id)}break;case"desync":XE(Ql,e.player,Ye(e.player));break;case"clearscroll":e$(e.player);break;case"clearplayer":{const i=Ni(t,$t.GADGETSTORE);delete i[e.player];const s=Ni(t,$t.GADGETSYNC);delete s[e.player];break}}});function tu(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bw={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){return function n(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var f=typeof tu=="function"&&tu;if(!u&&f)return f(l,!0);if(a)return a(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[l]={exports:{}};r[l][0].call(h.exports,function(m){var p=r[l][1][m];return o(p||m)},h,h.exports,n,r,i,s)}return i[l].exports}for(var a=typeof tu=="function"&&tu,c=0;c<s.length;c++)o(s[c]);return o}({1:[function(n,r,i){var s=n("./utils"),o=n("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,f,d,h,m,p,b=[],y=0,v=c.length,T=v,A=s.getTypeOf(c)!=="string";y<c.length;)T=v-y,f=A?(l=c[y++],u=y<v?c[y++]:0,y<v?c[y++]:0):(l=c.charCodeAt(y++),u=y<v?c.charCodeAt(y++):0,y<v?c.charCodeAt(y++):0),d=l>>2,h=(3&l)<<4|u>>4,m=1<T?(15&u)<<2|f>>6:64,p=2<T?63&f:64,b.push(a.charAt(d)+a.charAt(h)+a.charAt(m)+a.charAt(p));return b.join("")},i.decode=function(c){var l,u,f,d,h,m,p=0,b=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,T=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&T--,c.charAt(c.length-2)===a.charAt(64)&&T--,T%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|T):new Array(0|T);p<c.length;)l=a.indexOf(c.charAt(p++))<<2|(d=a.indexOf(c.charAt(p++)))>>4,u=(15&d)<<4|(h=a.indexOf(c.charAt(p++)))>>2,f=(3&h)<<6|(m=a.indexOf(c.charAt(p++))),v[b++]=l,h!==64&&(v[b++]=u),m!==64&&(v[b++]=f);return v}},{"./support":30,"./utils":32}],2:[function(n,r,i){var s=n("./external"),o=n("./stream/DataWorker"),a=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,f,d,h,m){this.compressedSize=u,this.uncompressedSize=f,this.crc32=d,this.compression=h,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return u.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,f,d){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,i){var s=n("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,i){var s=n("./utils"),o=function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c}();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u[p])];return-1^l}(0|c,a,a.length,0):function(l,u,f,d){var h=o,m=d+f;l^=-1;for(var p=d;p<m;p++)l=l>>>8^h[255&(l^u.charCodeAt(p))];return-1^l}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(n,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(n,r,i){var s=null;s=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:s}},{lie:37}],7:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=n("pako"),a=n("./utils"),c=n("./stream/GenericWorker"),l=s?"uint8array":"array";function u(f,d){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,f.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},i.compressWorker=function(f){return new u("Deflate",f)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,i){function s(h,m){var p,b="";for(p=0;p<m;p++)b+=String.fromCharCode(255&h),h>>>=8;return b}function o(h,m,p,b,y,v){var T,A,U=h.file,S=h.compression,C=v!==l.utf8encode,j=a.transformTo("string",v(U.name)),N=a.transformTo("string",l.utf8encode(U.name)),W=U.comment,q=a.transformTo("string",v(W)),L=a.transformTo("string",l.utf8encode(W)),O=N.length!==U.name.length,w=L.length!==W.length,I="",$="",B="",it=U.dir,Q=U.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};m&&!p||(rt.crc32=h.crc32,rt.compressedSize=h.compressedSize,rt.uncompressedSize=h.uncompressedSize);var z=0;m&&(z|=8),C||!O&&!w||(z|=2048);var P=0,ft=0;it&&(P|=16),y==="UNIX"?(ft=798,P|=function(ut,jt){var Qt=ut;return ut||(Qt=jt?16893:33204),(65535&Qt)<<16}(U.unixPermissions,it)):(ft=20,P|=function(ut){return 63&(ut||0)}(U.dosPermissions)),T=Q.getUTCHours(),T<<=6,T|=Q.getUTCMinutes(),T<<=5,T|=Q.getUTCSeconds()/2,A=Q.getUTCFullYear()-1980,A<<=4,A|=Q.getUTCMonth()+1,A<<=5,A|=Q.getUTCDate(),O&&($=s(1,1)+s(u(j),4)+N,I+="up"+s($.length,2)+$),w&&(B=s(1,1)+s(u(q),4)+L,I+="uc"+s(B.length,2)+B);var lt="";return lt+=`
\0`,lt+=s(z,2),lt+=S.magic,lt+=s(T,2),lt+=s(A,2),lt+=s(rt.crc32,4),lt+=s(rt.compressedSize,4),lt+=s(rt.uncompressedSize,4),lt+=s(j.length,2),lt+=s(I.length,2),{fileRecord:f.LOCAL_FILE_HEADER+lt+j+I,dirRecord:f.CENTRAL_FILE_HEADER+s(ft,2)+lt+s(q.length,2)+"\0\0\0\0"+s(P,4)+s(b,4)+j+I+q}}var a=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),f=n("../signature");function d(h,m,p,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=p,this.encodeFileName=b,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(d,c),d.prototype.push=function(h){var m=h.meta.percent||0,p=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:p?(m+100*(p-b-1))/p:100}}))},d.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var m=this.streamFiles&&!h.file.dir;if(m){var p=o(h,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(h){this.accumulate=!1;var m=this.streamFiles&&!h.file.dir,p=o(h,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),m)this.push({data:function(b){return f.DATA_DESCRIPTOR+s(b.crc32,4)+s(b.compressedSize,4)+s(b.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var h=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var p=this.bytesWritten-h,b=function(y,v,T,A,U){var S=a.transformTo("string",U(A));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(y,2)+s(y,2)+s(v,4)+s(T,4)+s(S.length,2)+S}(this.dirRecords.length,p,h,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(h){this._sources.push(h);var m=this;return h.on("data",function(p){m.processChunk(p)}),h.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),h.on("error",function(p){m.error(p)}),this},d.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(h){var m=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var p=0;p<m.length;p++)try{m[p].error(h)}catch{}return!0},d.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,m=0;m<h.length;m++)h[m].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,i){var s=n("../compressions"),o=n("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),f=0;try{a.forEach(function(d,h){f++;var m=function(v,T){var A=v||T,U=s[A];if(!U)throw new Error(A+" is not a valid compression method !");return U}(h.options.compression,c.compression),p=h.options.compressionOptions||c.compressionOptions||{},b=h.dir,y=h.date;h._compressWorker(m,p).withStreamInfo("file",{name:d,dir:b,date:y,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(u)}),u.entriesCount=f}catch(d){u.error(d)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=n("./object")).loadAsync=n("./load"),s.support=n("./support"),s.defaults=n("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=n("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,i){var s=n("./utils"),o=n("./external"),a=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function f(d){return new o.Promise(function(h,m){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(b){m(b)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}r.exports=function(d,h){var m=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",d,!0,h.optimizedBinaryString,h.base64).then(function(p){var b=new c(h);return b.load(p),b}).then(function(p){var b=[o.Promise.resolve(p)],y=p.files;if(h.checkCRC32)for(var v=0;v<y.length;v++)b.push(f(y[v]));return o.Promise.all(b)}).then(function(p){for(var b=p.shift(),y=b.files,v=0;v<y.length;v++){var T=y[v],A=T.fileNameStr,U=s.resolve(T.fileNameStr);m.file(U,T.decompressed,{binary:!0,optimizedBinaryString:!0,date:T.date,dir:T.dir,comment:T.fileCommentStr.length?T.fileCommentStr:null,unixPermissions:T.unixPermissions,dosPermissions:T.dosPermissions,createFolders:h.createFolders}),T.dir||(m.file(U).unsafeOriginalName=A)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,i){var s=n("../utils"),o=n("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,i){var s=n("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(f,d){u.push(f)||u._helper.pause(),l&&l(d)}).on("error",function(f){u.emit("error",f)}).on("end",function(){u.push(null)})}n("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(n,r,i){r.exports={isNode:typeof fn<"u",newBufferFrom:function(s,o){if(fn.from&&fn.from!==Uint8Array.from)return fn.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new fn(s,o)},allocBuffer:function(s){if(fn.alloc)return fn.alloc(s);var o=new fn(s);return o.fill(0),o},isBuffer:function(s){return fn.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(n,r,i){function s(U,S,C){var j,N=a.getTypeOf(S),W=a.extend(C||{},u);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(U=y(U)),W.createFolders&&(j=b(U))&&v.call(this,j,!0);var q=N==="string"&&W.binary===!1&&W.base64===!1;C&&C.binary!==void 0||(W.binary=!q),(S instanceof f&&S.uncompressedSize===0||W.dir||!S||S.length===0)&&(W.base64=!1,W.binary=!0,S="",W.compression="STORE",N="string");var L=null;L=S instanceof f||S instanceof c?S:m.isNode&&m.isStream(S)?new p(U,S):a.prepareContent(U,S,W.binary,W.optimizedBinaryString,W.base64);var O=new d(U,L,W);this.files[U]=O}var o=n("./utf8"),a=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),f=n("./compressedObject"),d=n("./zipObject"),h=n("./generate"),m=n("./nodejsUtils"),p=n("./nodejs/NodejsStreamInputAdapter"),b=function(U){U.slice(-1)==="/"&&(U=U.substring(0,U.length-1));var S=U.lastIndexOf("/");return 0<S?U.substring(0,S):""},y=function(U){return U.slice(-1)!=="/"&&(U+="/"),U},v=function(U,S){return S=S!==void 0?S:u.createFolders,U=y(U),this.files[U]||s.call(this,U,null,{dir:!0,createFolders:S}),this.files[U]};function T(U){return Object.prototype.toString.call(U)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(U){var S,C,j;for(S in this.files)j=this.files[S],(C=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&U(C,j)},filter:function(U){var S=[];return this.forEach(function(C,j){U(C,j)&&S.push(j)}),S},file:function(U,S,C){if(arguments.length!==1)return U=this.root+U,s.call(this,U,S,C),this;if(T(U)){var j=U;return this.filter(function(W,q){return!q.dir&&j.test(W)})}var N=this.files[this.root+U];return N&&!N.dir?N:null},folder:function(U){if(!U)return this;if(T(U))return this.filter(function(N,W){return W.dir&&U.test(N)});var S=this.root+U,C=v.call(this,S),j=this.clone();return j.root=C.name,j},remove:function(U){U=this.root+U;var S=this.files[U];if(S||(U.slice(-1)!=="/"&&(U+="/"),S=this.files[U]),S&&!S.dir)delete this.files[U];else for(var C=this.filter(function(N,W){return W.name.slice(0,U.length)===U}),j=0;j<C.length;j++)delete this.files[C[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(U){var S,C={};try{if((C=a.extend(U||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var j=C.comment||this.comment||"";S=h.generateWorker(this,C,j)}catch(N){(S=new c("error")).error(N)}return new l(S,C.type||"string",C.mimeType)},generateAsync:function(U,S){return this.generateInternalStream(U).accumulate(S)},generateNodeStream:function(U,S){return(U=U||{}).type||(U.type="nodebuffer"),this.generateInternalStream(U).toNodejsStream(S)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,i){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===c&&this.data[d+1]===l&&this.data[d+2]===u&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return c===d[0]&&l===d[1]&&u===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(n,r,i){var s=n("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(n,r,i){var s=n("./Uint8ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,i){var s=n("./DataReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(n,r,i){var s=n("./ArrayReader");function o(a){s.call(this,a)}n("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,i){var s=n("../utils"),o=n("../support"),a=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(f){var d=s.getTypeOf(f);return s.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new l(f):o.uint8array?new u(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,i){var s=n("./GenericWorker"),o=n("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,i){var s=n("./GenericWorker"),o=n("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,i){var s=n("../utils"),o=n("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(n,r,i){var s=n("../utils"),o=n("./ConvertWorker"),a=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),f=null;if(l.nodestream)try{f=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(m,p){return new u.Promise(function(b,y){var v=[],T=m._internalType,A=m._outputType,U=m._mimeType;m.on("data",function(S,C){v.push(S),p&&p(C)}).on("error",function(S){v=[],y(S)}).on("end",function(){try{var S=function(C,j,N){switch(C){case"blob":return s.newBlob(s.transformTo("arraybuffer",j),N);case"base64":return c.encode(j);default:return s.transformTo(C,j)}}(A,function(C,j){var N,W=0,q=null,L=0;for(N=0;N<j.length;N++)L+=j[N].length;switch(C){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(q=new Uint8Array(L),N=0;N<j.length;N++)q.set(j[N],W),W+=j[N].length;return q;case"nodebuffer":return fn.concat(j);default:throw new Error("concat : unsupported type '"+C+"'")}}(T,v),U);b(S)}catch(C){y(C)}v=[]}).resume()})}function h(m,p,b){var y=p;switch(p){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=p,this._mimeType=b,s.checkSupport(y),this._worker=m.pipe(new o(y)),m.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(m){return d(this,m)},on:function(m,p){var b=this;return m==="data"?this._worker.on(m,function(y){p.call(b,y.data,y.meta)}):this._worker.on(m,function(){s.delay(p,arguments,b)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof fn<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!n("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,i){for(var s=n("./utils"),o=n("./support"),a=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function d(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return o.nodebuffer?a.newBufferFrom(h,"utf-8"):function(m){var p,b,y,v,T,A=m.length,U=0;for(v=0;v<A;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),U+=b<128?1:b<2048?2:b<65536?3:4;for(p=o.uint8array?new Uint8Array(U):new Array(U),v=T=0;T<U;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<A&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),b<128?p[T++]=b:(b<2048?p[T++]=192|b>>>6:(b<65536?p[T++]=224|b>>>12:(p[T++]=240|b>>>18,p[T++]=128|b>>>12&63),p[T++]=128|b>>>6&63),p[T++]=128|63&b);return p}(h)},i.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):function(m){var p,b,y,v,T=m.length,A=new Array(2*T);for(p=b=0;p<T;)if((y=m[p++])<128)A[b++]=y;else if(4<(v=l[y]))A[b++]=65533,p+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&p<T;)y=y<<6|63&m[p++],v--;1<v?A[b++]=65533:y<65536?A[b++]=y:(y-=65536,A[b++]=55296|y>>10&1023,A[b++]=56320|1023&y)}return A.length!==b&&(A.subarray?A=A.subarray(0,b):A.length=b),s.applyFromCharCode(A)}(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(f,c),f.prototype.processChunk=function(h){var m=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var p=m;(m=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),m.set(p,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(v,T){var A;for((T=T||v.length)>v.length&&(T=v.length),A=T-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?T:A+l[v[A]]>T?A:T}(m),y=m;b!==m.length&&(o.uint8array?(y=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(y=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:i.utf8decode(y),meta:h.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=f,s.inherits(d,c),d.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,i){var s=n("./support"),o=n("./base64"),a=n("./nodejsUtils"),c=n("./external");function l(p){return p}function u(p,b){for(var y=0;y<p.length;++y)b[y]=255&p.charCodeAt(y);return b}n("setimmediate"),i.newBlob=function(p,b){i.checkSupport("blob");try{return new Blob([p],{type:b})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(p),y.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(p,b,y){var v=[],T=0,A=p.length;if(A<=y)return String.fromCharCode.apply(null,p);for(;T<A;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,p.slice(T,Math.min(T+y,A)))):v.push(String.fromCharCode.apply(null,p.subarray(T,Math.min(T+y,A)))),T+=y;return v.join("")},stringifyByChar:function(p){for(var b="",y=0;y<p.length;y++)b+=String.fromCharCode(p[y]);return b},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var b=65536,y=i.getTypeOf(p),v=!0;if(y==="uint8array"?v=f.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return f.stringifyByChunk(p,y,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(p)}function h(p,b){for(var y=0;y<p.length;y++)b[y]=p[y];return b}i.applyFromCharCode=d;var m={};m.string={string:l,array:function(p){return u(p,new Array(p.length))},arraybuffer:function(p){return m.string.uint8array(p).buffer},uint8array:function(p){return u(p,new Uint8Array(p.length))},nodebuffer:function(p){return u(p,a.allocBuffer(p.length))}},m.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(p)}},m.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return h(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return a.newBufferFrom(new Uint8Array(p))}},m.uint8array={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return a.newBufferFrom(p)}},m.nodebuffer={string:d,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return m.nodebuffer.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,b){if(b=b||"",!p)return b;i.checkSupport(p);var y=i.getTypeOf(b);return m[y][p](b)},i.resolve=function(p){for(var b=p.split("/"),y=[],v=0;v<b.length;v++){var T=b[v];T==="."||T===""&&v!==0&&v!==b.length-1||(T===".."?y.pop():y.push(T))}return y.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(p)?"nodebuffer":s.uint8array&&p instanceof Uint8Array?"uint8array":s.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!s[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var b,y,v="";for(y=0;y<(p||"").length;y++)v+="\\x"+((b=p.charCodeAt(y))<16?"0":"")+b.toString(16).toUpperCase();return v},i.delay=function(p,b,y){setImmediate(function(){p.apply(y||null,b||[])})},i.inherits=function(p,b){function y(){}y.prototype=b.prototype,p.prototype=new y},i.extend=function(){var p,b,y={};for(p=0;p<arguments.length;p++)for(b in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],b)&&y[b]===void 0&&(y[b]=arguments[p][b]);return y},i.prepareContent=function(p,b,y,v,T){return c.Promise.resolve(b).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(U,S){var C=new FileReader;C.onload=function(j){U(j.target.result)},C.onerror=function(j){S(j.target.error)},C.readAsArrayBuffer(A)}):A}).then(function(A){var U=i.getTypeOf(A);return U?(U==="arraybuffer"?A=i.transformTo("uint8array",A):U==="string"&&(T?A=o.decode(A):y&&v!==!0&&(A=function(S){return u(S,s.uint8array?new Uint8Array(S.length):new Array(S.length))}(A))),A):c.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./signature"),c=n("./zipEntry"),l=n("./support");function u(f){this.files=[],this.loadOptions=f}u.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var h=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===d;return this.reader.setIndex(h),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",h=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,h,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),d=this.reader.readInt(4),h=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var m=d-h;if(0<m)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,i){var s=n("./reader/readerFor"),o=n("./utils"),a=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),f=n("./support");function d(h,m){this.options=h,this.loadOptions=m}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var m,p;if(h.skip(22),this.fileNameLength=h.readInt(2),p=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===b)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,m,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var m=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(m),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var m,p,b,y=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<y;)m=h.readInt(2),p=h.readInt(2),b=h.readData(p),this.extraFields[m]={id:m,length:p,value:b};h.setIndex(y)},handleUTF8:function(){var h=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var p=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var y=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var m=s(h.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(h.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,i){function s(m,p,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=p,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=n("./stream/StreamHelper"),a=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");s.prototype={internalStream:function(m){var p=null,b="string";try{if(!m)throw new Error("No output type specified.");var y=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),p=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(p=p.pipe(new c.Utf8EncodeWorker)),!v&&y&&(p=p.pipe(new c.Utf8DecodeWorker))}catch(T){(p=new u("error")).error(T)}return new o(p,b,"")},async:function(m,p){return this.internalStream(m).accumulate(p)},nodeStream:function(m,p){return this.internalStream(m||"nodebuffer").toNodejsStream(p)},_compressWorker:function(m,p){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,m,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<f.length;h++)s.prototype[f[h]]=d;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(m),f=s.document.createTextNode("");u.observe(f,{characterData:!0}),o=function(){f.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var p=s.document.createElement("script");p.onreadystatechange=function(){m(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},s.document.documentElement.appendChild(p)}:function(){setTimeout(m,0)};else{var d=new s.MessageChannel;d.port1.onmessage=m,o=function(){d.port2.postMessage(0)}}var h=[];function m(){var p,b;a=!0;for(var y=h.length;y;){for(b=h,h=[],p=-1;++p<y;)b[p]();y=h.length}a=!1}r.exports=function(p){h.push(p)!==1||a||o()}}).call(this,typeof Ln<"u"?Ln:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,i){var s=n("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function f(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&p(this,y)}function d(y,v,T){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof T=="function"&&(this.onRejected=T,this.callRejected=this.otherCallRejected)}function h(y,v,T){s(function(){var A;try{A=v(T)}catch(U){return a.reject(y,U)}A===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,A)})}function m(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function p(y,v){var T=!1;function A(C){T||(T=!0,a.reject(y,C))}function U(C){T||(T=!0,a.resolve(y,C))}var S=b(function(){v(U,A)});S.status==="error"&&A(S.value)}function b(y,v){var T={};try{T.value=y(v),T.status="success"}catch(A){T.status="error",T.value=A}return T}(r.exports=f).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(T){return v.resolve(y()).then(function(){return T})},function(T){return v.resolve(y()).then(function(){throw T})})},f.prototype.catch=function(y){return this.then(null,y)},f.prototype.then=function(y,v){if(typeof y!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var T=new this.constructor(o);return this.state!==u?h(T,this.state===l?y:v,this.outcome):this.queue.push(new d(T,y,v)),T},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){h(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){h(this.promise,this.onRejected,y)},a.resolve=function(y,v){var T=b(m,v);if(T.status==="error")return a.reject(y,T.value);var A=T.value;if(A)p(y,A);else{y.state=l,y.outcome=v;for(var U=-1,S=y.queue.length;++U<S;)y.queue[U].callFulfilled(v)}return y},a.reject=function(y,v){y.state=c,y.outcome=v;for(var T=-1,A=y.queue.length;++T<A;)y.queue[T].callRejected(v);return y},f.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},f.reject=function(y){var v=new this(o);return a.reject(v,y)},f.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,A=!1;if(!T)return this.resolve([]);for(var U=new Array(T),S=0,C=-1,j=new this(o);++C<T;)N(y[C],C);return j;function N(W,q){v.resolve(W).then(function(L){U[q]=L,++S!==T||A||(A=!0,a.resolve(j,U))},function(L){A||(A=!0,a.reject(j,L))})}},f.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var T=y.length,A=!1;if(!T)return this.resolve([]);for(var U=-1,S=new this(o);++U<T;)C=y[U],v.resolve(C).then(function(j){A||(A=!0,a.resolve(S,j))},function(j){A||(A=!0,a.reject(S,j))});var C;return S}},{immediate:36}],38:[function(n,r,i){var s={};(0,n("./lib/utils/common").assign)(s,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,i){var s=n("./zlib/deflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,f=0,d=-1,h=0,m=8;function p(y){if(!(this instanceof p))return new p(y);this.options=o.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var T=s.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(T!==f)throw new Error(c[T]);if(v.header&&s.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?a.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(T=s.deflateSetDictionary(this.strm,A))!==f)throw new Error(c[T]);this._dict_set=!0}}function b(y,v){var T=new p(v);if(T.push(y,!0),T.err)throw T.msg||c[T.err];return T.result}p.prototype.push=function(y,v){var T,A,U=this.strm,S=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof y=="string"?U.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?U.input=new Uint8Array(y):U.input=y,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new o.Buf8(S),U.next_out=0,U.avail_out=S),(T=s.deflate(U,A))!==1&&T!==f)return this.onEnd(T),!(this.ended=!0);U.avail_out!==0&&(U.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(U.output,U.next_out))):this.onData(o.shrinkBuf(U.output,U.next_out)))}while((0<U.avail_in||U.avail_out===0)&&T!==1);return A===4?(T=s.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===f):A!==2||(this.onEnd(f),!(U.avail_out=0))},p.prototype.onData=function(y){this.chunks.push(y)},p.prototype.onEnd=function(y){y===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=p,i.deflate=b,i.deflateRaw=function(y,v){return(v=v||{}).raw=!0,b(y,v)},i.gzip=function(y,v){return(v=v||{}).gzip=!0,b(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,i){var s=n("./zlib/inflate"),o=n("./utils/common"),a=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),f=n("./zlib/gzheader"),d=Object.prototype.toString;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},p||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||p&&p.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=s.inflateInit2(this.strm,b.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function m(p,b){var y=new h(b);if(y.push(p,!0),y.err)throw y.msg||l[y.err];return y.result}h.prototype.push=function(p,b){var y,v,T,A,U,S,C=this.strm,j=this.options.chunkSize,N=this.options.dictionary,W=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof p=="string"?C.input=a.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?C.input=new Uint8Array(p):C.input=p,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(j),C.next_out=0,C.avail_out=j),(y=s.inflate(C,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&N&&(S=typeof N=="string"?a.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,y=s.inflateSetDictionary(this.strm,S)),y===c.Z_BUF_ERROR&&W===!0&&(y=c.Z_OK,W=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&y!==c.Z_STREAM_END&&(C.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(T=a.utf8border(C.output,C.next_out),A=C.next_out-T,U=a.buf2string(C.output,T),C.next_out=A,C.avail_out=j-A,A&&o.arraySet(C.output,C.output,T,A,0),this.onData(U)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(W=!0)}while((0<C.avail_in||C.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(y=s.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(C.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=h,i.inflate=m,i.inflateRaw=function(p,b){return(b=b||{}).raw=!0,m(p,b)},i.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var f in u)u.hasOwnProperty(f)&&(c[f]=u[f])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,f,d){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+f),d);else for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){var l,u,f,d,h,m;for(l=f=0,u=c.length;l<u;l++)f+=c[l].length;for(m=new Uint8Array(f),l=d=0,u=c.length;l<u;l++)h=c[l],m.set(h,d),d+=h.length;return m}},a={arraySet:function(c,l,u,f,d){for(var h=0;h<f;h++)c[d+h]=l[u+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(n,r,i){var s=n("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(f,d));for(var h="",m=0;m<d;m++)h+=String.fromCharCode(f[m]);return h}c[254]=c[254]=1,i.string2buf=function(f){var d,h,m,p,b,y=f.length,v=0;for(p=0;p<y;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),v+=h<128?1:h<2048?2:h<65536?3:4;for(d=new s.Buf8(v),p=b=0;b<v;p++)(64512&(h=f.charCodeAt(p)))==55296&&p+1<y&&(64512&(m=f.charCodeAt(p+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),p++),h<128?d[b++]=h:(h<2048?d[b++]=192|h>>>6:(h<65536?d[b++]=224|h>>>12:(d[b++]=240|h>>>18,d[b++]=128|h>>>12&63),d[b++]=128|h>>>6&63),d[b++]=128|63&h);return d},i.buf2binstring=function(f){return u(f,f.length)},i.binstring2buf=function(f){for(var d=new s.Buf8(f.length),h=0,m=d.length;h<m;h++)d[h]=f.charCodeAt(h);return d},i.buf2string=function(f,d){var h,m,p,b,y=d||f.length,v=new Array(2*y);for(h=m=0;h<y;)if((p=f[h++])<128)v[m++]=p;else if(4<(b=c[p]))v[m++]=65533,h+=b-1;else{for(p&=b===2?31:b===3?15:7;1<b&&h<y;)p=p<<6|63&f[h++],b--;1<b?v[m++]=65533:p<65536?v[m++]=p:(p-=65536,v[m++]=55296|p>>10&1023,v[m++]=56320|1023&p)}return u(v,m)},i.utf8border=function(f,d){var h;for((d=d||f.length)>f.length&&(d=f.length),h=d-1;0<=h&&(192&f[h])==128;)h--;return h<0||h===0?d:h+c[f[h]]>d?h:d}},{"./common":41}],43:[function(n,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--f;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,i){var s=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();r.exports=function(o,a,c,l){var u=s,f=l+c;o^=-1;for(var d=l;d<f;d++)o=o>>>8^u[255&(o^a[d])];return-1^o}},{}],46:[function(n,r,i){var s,o=n("../utils/common"),a=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),f=0,d=4,h=0,m=-2,p=-1,b=4,y=2,v=8,T=9,A=286,U=30,S=19,C=2*A+1,j=15,N=3,W=258,q=W+N+1,L=42,O=113,w=1,I=2,$=3,B=4;function it(x,ct){return x.msg=u[ct],ct}function Q(x){return(x<<1)-(4<x?9:0)}function rt(x){for(var ct=x.length;0<=--ct;)x[ct]=0}function z(x){var ct=x.state,nt=ct.pending;nt>x.avail_out&&(nt=x.avail_out),nt!==0&&(o.arraySet(x.output,ct.pending_buf,ct.pending_out,nt,x.next_out),x.next_out+=nt,ct.pending_out+=nt,x.total_out+=nt,x.avail_out-=nt,ct.pending-=nt,ct.pending===0&&(ct.pending_out=0))}function P(x,ct){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,ct),x.block_start=x.strstart,z(x.strm)}function ft(x,ct){x.pending_buf[x.pending++]=ct}function lt(x,ct){x.pending_buf[x.pending++]=ct>>>8&255,x.pending_buf[x.pending++]=255&ct}function ut(x,ct){var nt,D,F=x.max_chain_length,V=x.strstart,ht=x.prev_length,pt=x.nice_match,Z=x.strstart>x.w_size-q?x.strstart-(x.w_size-q):0,_t=x.window,vt=x.w_mask,gt=x.prev,Ct=x.strstart+W,fe=_t[V+ht-1],zt=_t[V+ht];x.prev_length>=x.good_match&&(F>>=2),pt>x.lookahead&&(pt=x.lookahead);do if(_t[(nt=ct)+ht]===zt&&_t[nt+ht-1]===fe&&_t[nt]===_t[V]&&_t[++nt]===_t[V+1]){V+=2,nt++;do;while(_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&_t[++V]===_t[++nt]&&V<Ct);if(D=W-(Ct-V),V=Ct-W,ht<D){if(x.match_start=ct,pt<=(ht=D))break;fe=_t[V+ht-1],zt=_t[V+ht]}}while((ct=gt[ct&vt])>Z&&--F!=0);return ht<=x.lookahead?ht:x.lookahead}function jt(x){var ct,nt,D,F,V,ht,pt,Z,_t,vt,gt=x.w_size;do{if(F=x.window_size-x.lookahead-x.strstart,x.strstart>=gt+(gt-q)){for(o.arraySet(x.window,x.window,gt,gt,0),x.match_start-=gt,x.strstart-=gt,x.block_start-=gt,ct=nt=x.hash_size;D=x.head[--ct],x.head[ct]=gt<=D?D-gt:0,--nt;);for(ct=nt=gt;D=x.prev[--ct],x.prev[ct]=gt<=D?D-gt:0,--nt;);F+=gt}if(x.strm.avail_in===0)break;if(ht=x.strm,pt=x.window,Z=x.strstart+x.lookahead,_t=F,vt=void 0,vt=ht.avail_in,_t<vt&&(vt=_t),nt=vt===0?0:(ht.avail_in-=vt,o.arraySet(pt,ht.input,ht.next_in,vt,Z),ht.state.wrap===1?ht.adler=c(ht.adler,pt,vt,Z):ht.state.wrap===2&&(ht.adler=l(ht.adler,pt,vt,Z)),ht.next_in+=vt,ht.total_in+=vt,vt),x.lookahead+=nt,x.lookahead+x.insert>=N)for(V=x.strstart-x.insert,x.ins_h=x.window[V],x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[V+N-1])&x.hash_mask,x.prev[V&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=V,V++,x.insert--,!(x.lookahead+x.insert<N)););}while(x.lookahead<q&&x.strm.avail_in!==0)}function Qt(x,ct){for(var nt,D;;){if(x.lookahead<q){if(jt(x),x.lookahead<q&&ct===f)return w;if(x.lookahead===0)break}if(nt=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),nt!==0&&x.strstart-nt<=x.w_size-q&&(x.match_length=ut(x,nt)),x.match_length>=N)if(D=a._tr_tally(x,x.strstart-x.match_start,x.match_length-N),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=N){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else D=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(D&&(P(x,!1),x.strm.avail_out===0))return w}return x.insert=x.strstart<N-1?x.strstart:N-1,ct===d?(P(x,!0),x.strm.avail_out===0?$:B):x.last_lit&&(P(x,!1),x.strm.avail_out===0)?w:I}function Dt(x,ct){for(var nt,D,F;;){if(x.lookahead<q){if(jt(x),x.lookahead<q&&ct===f)return w;if(x.lookahead===0)break}if(nt=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=N-1,nt!==0&&x.prev_length<x.max_lazy_match&&x.strstart-nt<=x.w_size-q&&(x.match_length=ut(x,nt),x.match_length<=5&&(x.strategy===1||x.match_length===N&&4096<x.strstart-x.match_start)&&(x.match_length=N-1)),x.prev_length>=N&&x.match_length<=x.prev_length){for(F=x.strstart+x.lookahead-N,D=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-N),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=F&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,nt=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=N-1,x.strstart++,D&&(P(x,!1),x.strm.avail_out===0))return w}else if(x.match_available){if((D=a._tr_tally(x,0,x.window[x.strstart-1]))&&P(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return w}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(D=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<N-1?x.strstart:N-1,ct===d?(P(x,!0),x.strm.avail_out===0?$:B):x.last_lit&&(P(x,!1),x.strm.avail_out===0)?w:I}function Pt(x,ct,nt,D,F){this.good_length=x,this.max_lazy=ct,this.nice_length=nt,this.max_chain=D,this.func=F}function le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*U+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(j+1),this.heap=new o.Buf16(2*A+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*A+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function qt(x){var ct;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=y,(ct=x.state).pending=0,ct.pending_out=0,ct.wrap<0&&(ct.wrap=-ct.wrap),ct.status=ct.wrap?L:O,x.adler=ct.wrap===2?0:1,ct.last_flush=f,a._tr_init(ct),h):it(x,m)}function Ne(x){var ct=qt(x);return ct===h&&function(nt){nt.window_size=2*nt.w_size,rt(nt.head),nt.max_lazy_match=s[nt.level].max_lazy,nt.good_match=s[nt.level].good_length,nt.nice_match=s[nt.level].nice_length,nt.max_chain_length=s[nt.level].max_chain,nt.strstart=0,nt.block_start=0,nt.lookahead=0,nt.insert=0,nt.match_length=nt.prev_length=N-1,nt.match_available=0,nt.ins_h=0}(x.state),ct}function $e(x,ct,nt,D,F,V){if(!x)return m;var ht=1;if(ct===p&&(ct=6),D<0?(ht=0,D=-D):15<D&&(ht=2,D-=16),F<1||T<F||nt!==v||D<8||15<D||ct<0||9<ct||V<0||b<V)return it(x,m);D===8&&(D=9);var pt=new le;return(x.state=pt).strm=x,pt.wrap=ht,pt.gzhead=null,pt.w_bits=D,pt.w_size=1<<pt.w_bits,pt.w_mask=pt.w_size-1,pt.hash_bits=F+7,pt.hash_size=1<<pt.hash_bits,pt.hash_mask=pt.hash_size-1,pt.hash_shift=~~((pt.hash_bits+N-1)/N),pt.window=new o.Buf8(2*pt.w_size),pt.head=new o.Buf16(pt.hash_size),pt.prev=new o.Buf16(pt.w_size),pt.lit_bufsize=1<<F+6,pt.pending_buf_size=4*pt.lit_bufsize,pt.pending_buf=new o.Buf8(pt.pending_buf_size),pt.d_buf=1*pt.lit_bufsize,pt.l_buf=3*pt.lit_bufsize,pt.level=ct,pt.strategy=V,pt.method=nt,Ne(x)}s=[new Pt(0,0,0,0,function(x,ct){var nt=65535;for(nt>x.pending_buf_size-5&&(nt=x.pending_buf_size-5);;){if(x.lookahead<=1){if(jt(x),x.lookahead===0&&ct===f)return w;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var D=x.block_start+nt;if((x.strstart===0||x.strstart>=D)&&(x.lookahead=x.strstart-D,x.strstart=D,P(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-q&&(P(x,!1),x.strm.avail_out===0))return w}return x.insert=0,ct===d?(P(x,!0),x.strm.avail_out===0?$:B):(x.strstart>x.block_start&&(P(x,!1),x.strm.avail_out),w)}),new Pt(4,4,8,4,Qt),new Pt(4,5,16,8,Qt),new Pt(4,6,32,32,Qt),new Pt(4,4,16,16,Dt),new Pt(8,16,32,32,Dt),new Pt(8,16,128,128,Dt),new Pt(8,32,128,256,Dt),new Pt(32,128,258,1024,Dt),new Pt(32,258,258,4096,Dt)],i.deflateInit=function(x,ct){return $e(x,ct,v,15,8,0)},i.deflateInit2=$e,i.deflateReset=Ne,i.deflateResetKeep=qt,i.deflateSetHeader=function(x,ct){return x&&x.state?x.state.wrap!==2?m:(x.state.gzhead=ct,h):m},i.deflate=function(x,ct){var nt,D,F,V;if(!x||!x.state||5<ct||ct<0)return x?it(x,m):m;if(D=x.state,!x.output||!x.input&&x.avail_in!==0||D.status===666&&ct!==d)return it(x,x.avail_out===0?-5:m);if(D.strm=x,nt=D.last_flush,D.last_flush=ct,D.status===L)if(D.wrap===2)x.adler=0,ft(D,31),ft(D,139),ft(D,8),D.gzhead?(ft(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),ft(D,255&D.gzhead.time),ft(D,D.gzhead.time>>8&255),ft(D,D.gzhead.time>>16&255),ft(D,D.gzhead.time>>24&255),ft(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),ft(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(ft(D,255&D.gzhead.extra.length),ft(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(x.adler=l(x.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(ft(D,0),ft(D,0),ft(D,0),ft(D,0),ft(D,0),ft(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),ft(D,3),D.status=O);else{var ht=v+(D.w_bits-8<<4)<<8;ht|=(2<=D.strategy||D.level<2?0:D.level<6?1:D.level===6?2:3)<<6,D.strstart!==0&&(ht|=32),ht+=31-ht%31,D.status=O,lt(D,ht),D.strstart!==0&&(lt(D,x.adler>>>16),lt(D,65535&x.adler)),x.adler=1}if(D.status===69)if(D.gzhead.extra){for(F=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>F&&(x.adler=l(x.adler,D.pending_buf,D.pending-F,F)),z(x),F=D.pending,D.pending!==D.pending_buf_size));)ft(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>F&&(x.adler=l(x.adler,D.pending_buf,D.pending-F,F)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(D.status===73)if(D.gzhead.name){F=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>F&&(x.adler=l(x.adler,D.pending_buf,D.pending-F,F)),z(x),F=D.pending,D.pending===D.pending_buf_size)){V=1;break}V=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,ft(D,V)}while(V!==0);D.gzhead.hcrc&&D.pending>F&&(x.adler=l(x.adler,D.pending_buf,D.pending-F,F)),V===0&&(D.gzindex=0,D.status=91)}else D.status=91;if(D.status===91)if(D.gzhead.comment){F=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>F&&(x.adler=l(x.adler,D.pending_buf,D.pending-F,F)),z(x),F=D.pending,D.pending===D.pending_buf_size)){V=1;break}V=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,ft(D,V)}while(V!==0);D.gzhead.hcrc&&D.pending>F&&(x.adler=l(x.adler,D.pending_buf,D.pending-F,F)),V===0&&(D.status=103)}else D.status=103;if(D.status===103&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&z(x),D.pending+2<=D.pending_buf_size&&(ft(D,255&x.adler),ft(D,x.adler>>8&255),x.adler=0,D.status=O)):D.status=O),D.pending!==0){if(z(x),x.avail_out===0)return D.last_flush=-1,h}else if(x.avail_in===0&&Q(ct)<=Q(nt)&&ct!==d)return it(x,-5);if(D.status===666&&x.avail_in!==0)return it(x,-5);if(x.avail_in!==0||D.lookahead!==0||ct!==f&&D.status!==666){var pt=D.strategy===2?function(Z,_t){for(var vt;;){if(Z.lookahead===0&&(jt(Z),Z.lookahead===0)){if(_t===f)return w;break}if(Z.match_length=0,vt=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,vt&&(P(Z,!1),Z.strm.avail_out===0))return w}return Z.insert=0,_t===d?(P(Z,!0),Z.strm.avail_out===0?$:B):Z.last_lit&&(P(Z,!1),Z.strm.avail_out===0)?w:I}(D,ct):D.strategy===3?function(Z,_t){for(var vt,gt,Ct,fe,zt=Z.window;;){if(Z.lookahead<=W){if(jt(Z),Z.lookahead<=W&&_t===f)return w;if(Z.lookahead===0)break}if(Z.match_length=0,Z.lookahead>=N&&0<Z.strstart&&(gt=zt[Ct=Z.strstart-1])===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]){fe=Z.strstart+W;do;while(gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&gt===zt[++Ct]&&Ct<fe);Z.match_length=W-(fe-Ct),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=N?(vt=a._tr_tally(Z,1,Z.match_length-N),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(vt=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),vt&&(P(Z,!1),Z.strm.avail_out===0))return w}return Z.insert=0,_t===d?(P(Z,!0),Z.strm.avail_out===0?$:B):Z.last_lit&&(P(Z,!1),Z.strm.avail_out===0)?w:I}(D,ct):s[D.level].func(D,ct);if(pt!==$&&pt!==B||(D.status=666),pt===w||pt===$)return x.avail_out===0&&(D.last_flush=-1),h;if(pt===I&&(ct===1?a._tr_align(D):ct!==5&&(a._tr_stored_block(D,0,0,!1),ct===3&&(rt(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),z(x),x.avail_out===0))return D.last_flush=-1,h}return ct!==d?h:D.wrap<=0?1:(D.wrap===2?(ft(D,255&x.adler),ft(D,x.adler>>8&255),ft(D,x.adler>>16&255),ft(D,x.adler>>24&255),ft(D,255&x.total_in),ft(D,x.total_in>>8&255),ft(D,x.total_in>>16&255),ft(D,x.total_in>>24&255)):(lt(D,x.adler>>>16),lt(D,65535&x.adler)),z(x),0<D.wrap&&(D.wrap=-D.wrap),D.pending!==0?h:1)},i.deflateEnd=function(x){var ct;return x&&x.state?(ct=x.state.status)!==L&&ct!==69&&ct!==73&&ct!==91&&ct!==103&&ct!==O&&ct!==666?it(x,m):(x.state=null,ct===O?it(x,-3):h):m},i.deflateSetDictionary=function(x,ct){var nt,D,F,V,ht,pt,Z,_t,vt=ct.length;if(!x||!x.state||(V=(nt=x.state).wrap)===2||V===1&&nt.status!==L||nt.lookahead)return m;for(V===1&&(x.adler=c(x.adler,ct,vt,0)),nt.wrap=0,vt>=nt.w_size&&(V===0&&(rt(nt.head),nt.strstart=0,nt.block_start=0,nt.insert=0),_t=new o.Buf8(nt.w_size),o.arraySet(_t,ct,vt-nt.w_size,nt.w_size,0),ct=_t,vt=nt.w_size),ht=x.avail_in,pt=x.next_in,Z=x.input,x.avail_in=vt,x.next_in=0,x.input=ct,jt(nt);nt.lookahead>=N;){for(D=nt.strstart,F=nt.lookahead-(N-1);nt.ins_h=(nt.ins_h<<nt.hash_shift^nt.window[D+N-1])&nt.hash_mask,nt.prev[D&nt.w_mask]=nt.head[nt.ins_h],nt.head[nt.ins_h]=D,D++,--F;);nt.strstart=D,nt.lookahead=N-1,jt(nt)}return nt.strstart+=nt.lookahead,nt.block_start=nt.strstart,nt.insert=nt.lookahead,nt.lookahead=0,nt.match_length=nt.prev_length=N-1,nt.match_available=0,x.next_in=pt,x.input=Z,x.avail_in=ht,nt.wrap=V,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,i){r.exports=function(s,o){var a,c,l,u,f,d,h,m,p,b,y,v,T,A,U,S,C,j,N,W,q,L,O,w,I;a=s.state,c=s.next_in,w=s.input,l=c+(s.avail_in-5),u=s.next_out,I=s.output,f=u-(o-s.avail_out),d=u+(s.avail_out-257),h=a.dmax,m=a.wsize,p=a.whave,b=a.wnext,y=a.window,v=a.hold,T=a.bits,A=a.lencode,U=a.distcode,S=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;t:do{T<15&&(v+=w[c++]<<T,T+=8,v+=w[c++]<<T,T+=8),j=A[v&S];e:for(;;){if(v>>>=N=j>>>24,T-=N,(N=j>>>16&255)===0)I[u++]=65535&j;else{if(!(16&N)){if(!(64&N)){j=A[(65535&j)+(v&(1<<N)-1)];continue e}if(32&N){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}W=65535&j,(N&=15)&&(T<N&&(v+=w[c++]<<T,T+=8),W+=v&(1<<N)-1,v>>>=N,T-=N),T<15&&(v+=w[c++]<<T,T+=8,v+=w[c++]<<T,T+=8),j=U[v&C];n:for(;;){if(v>>>=N=j>>>24,T-=N,!(16&(N=j>>>16&255))){if(!(64&N)){j=U[(65535&j)+(v&(1<<N)-1)];continue n}s.msg="invalid distance code",a.mode=30;break t}if(q=65535&j,T<(N&=15)&&(v+=w[c++]<<T,(T+=8)<N&&(v+=w[c++]<<T,T+=8)),h<(q+=v&(1<<N)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(v>>>=N,T-=N,(N=u-f)<q){if(p<(N=q-N)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(O=y,(L=0)===b){if(L+=m-N,N<W){for(W-=N;I[u++]=y[L++],--N;);L=u-q,O=I}}else if(b<N){if(L+=m+b-N,(N-=b)<W){for(W-=N;I[u++]=y[L++],--N;);if(L=0,b<W){for(W-=N=b;I[u++]=y[L++],--N;);L=u-q,O=I}}}else if(L+=b-N,N<W){for(W-=N;I[u++]=y[L++],--N;);L=u-q,O=I}for(;2<W;)I[u++]=O[L++],I[u++]=O[L++],I[u++]=O[L++],W-=3;W&&(I[u++]=O[L++],1<W&&(I[u++]=O[L++]))}else{for(L=u-q;I[u++]=I[L++],I[u++]=I[L++],I[u++]=I[L++],2<(W-=3););W&&(I[u++]=I[L++],1<W&&(I[u++]=I[L++]))}break}}break}}while(c<l&&u<d);c-=W=T>>3,v&=(1<<(T-=W<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<d?d-u+257:257-(u-d),a.hold=v,a.bits=T}},{}],49:[function(n,r,i){var s=n("../utils/common"),o=n("./adler32"),a=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,f=2,d=0,h=-2,m=1,p=852,b=592;function y(L){return(L>>>24&255)+(L>>>8&65280)+((65280&L)<<8)+((255&L)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function T(L){var O;return L&&L.state?(O=L.state,L.total_in=L.total_out=O.total=0,L.msg="",O.wrap&&(L.adler=1&O.wrap),O.mode=m,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(p),O.distcode=O.distdyn=new s.Buf32(b),O.sane=1,O.back=-1,d):h}function A(L){var O;return L&&L.state?((O=L.state).wsize=0,O.whave=0,O.wnext=0,T(L)):h}function U(L,O){var w,I;return L&&L.state?(I=L.state,O<0?(w=0,O=-O):(w=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:(I.window!==null&&I.wbits!==O&&(I.window=null),I.wrap=w,I.wbits=O,A(L))):h}function S(L,O){var w,I;return L?(I=new v,(L.state=I).window=null,(w=U(L,O))!==d&&(L.state=null),w):h}var C,j,N=!0;function W(L){if(N){var O;for(C=new s.Buf32(512),j=new s.Buf32(32),O=0;O<144;)L.lens[O++]=8;for(;O<256;)L.lens[O++]=9;for(;O<280;)L.lens[O++]=7;for(;O<288;)L.lens[O++]=8;for(l(u,L.lens,0,288,C,0,L.work,{bits:9}),O=0;O<32;)L.lens[O++]=5;l(f,L.lens,0,32,j,0,L.work,{bits:5}),N=!1}L.lencode=C,L.lenbits=9,L.distcode=j,L.distbits=5}function q(L,O,w,I){var $,B=L.state;return B.window===null&&(B.wsize=1<<B.wbits,B.wnext=0,B.whave=0,B.window=new s.Buf8(B.wsize)),I>=B.wsize?(s.arraySet(B.window,O,w-B.wsize,B.wsize,0),B.wnext=0,B.whave=B.wsize):(I<($=B.wsize-B.wnext)&&($=I),s.arraySet(B.window,O,w-I,$,B.wnext),(I-=$)?(s.arraySet(B.window,O,w-I,I,0),B.wnext=I,B.whave=B.wsize):(B.wnext+=$,B.wnext===B.wsize&&(B.wnext=0),B.whave<B.wsize&&(B.whave+=$))),0}i.inflateReset=A,i.inflateReset2=U,i.inflateResetKeep=T,i.inflateInit=function(L){return S(L,15)},i.inflateInit2=S,i.inflate=function(L,O){var w,I,$,B,it,Q,rt,z,P,ft,lt,ut,jt,Qt,Dt,Pt,le,qt,Ne,$e,x,ct,nt,D,F=0,V=new s.Buf8(4),ht=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!L||!L.state||!L.output||!L.input&&L.avail_in!==0)return h;(w=L.state).mode===12&&(w.mode=13),it=L.next_out,$=L.output,rt=L.avail_out,B=L.next_in,I=L.input,Q=L.avail_in,z=w.hold,P=w.bits,ft=Q,lt=rt,ct=d;t:for(;;)switch(w.mode){case m:if(w.wrap===0){w.mode=13;break}for(;P<16;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(2&w.wrap&&z===35615){V[w.check=0]=255&z,V[1]=z>>>8&255,w.check=a(w.check,V,2,0),P=z=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&z)<<8)+(z>>8))%31){L.msg="incorrect header check",w.mode=30;break}if((15&z)!=8){L.msg="unknown compression method",w.mode=30;break}if(P-=4,x=8+(15&(z>>>=4)),w.wbits===0)w.wbits=x;else if(x>w.wbits){L.msg="invalid window size",w.mode=30;break}w.dmax=1<<x,L.adler=w.check=1,w.mode=512&z?10:12,P=z=0;break;case 2:for(;P<16;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(w.flags=z,(255&w.flags)!=8){L.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){L.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=z>>8&1),512&w.flags&&(V[0]=255&z,V[1]=z>>>8&255,w.check=a(w.check,V,2,0)),P=z=0,w.mode=3;case 3:for(;P<32;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}w.head&&(w.head.time=z),512&w.flags&&(V[0]=255&z,V[1]=z>>>8&255,V[2]=z>>>16&255,V[3]=z>>>24&255,w.check=a(w.check,V,4,0)),P=z=0,w.mode=4;case 4:for(;P<16;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}w.head&&(w.head.xflags=255&z,w.head.os=z>>8),512&w.flags&&(V[0]=255&z,V[1]=z>>>8&255,w.check=a(w.check,V,2,0)),P=z=0,w.mode=5;case 5:if(1024&w.flags){for(;P<16;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}w.length=z,w.head&&(w.head.extra_len=z),512&w.flags&&(V[0]=255&z,V[1]=z>>>8&255,w.check=a(w.check,V,2,0)),P=z=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(Q<(ut=w.length)&&(ut=Q),ut&&(w.head&&(x=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),s.arraySet(w.head.extra,I,B,ut,x)),512&w.flags&&(w.check=a(w.check,I,ut,B)),Q-=ut,B+=ut,w.length-=ut),w.length))break t;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(Q===0)break t;for(ut=0;x=I[B+ut++],w.head&&x&&w.length<65536&&(w.head.name+=String.fromCharCode(x)),x&&ut<Q;);if(512&w.flags&&(w.check=a(w.check,I,ut,B)),Q-=ut,B+=ut,x)break t}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(Q===0)break t;for(ut=0;x=I[B+ut++],w.head&&x&&w.length<65536&&(w.head.comment+=String.fromCharCode(x)),x&&ut<Q;);if(512&w.flags&&(w.check=a(w.check,I,ut,B)),Q-=ut,B+=ut,x)break t}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;P<16;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(z!==(65535&w.check)){L.msg="header crc mismatch",w.mode=30;break}P=z=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),L.adler=w.check=0,w.mode=12;break;case 10:for(;P<32;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}L.adler=w.check=y(z),P=z=0,w.mode=11;case 11:if(w.havedict===0)return L.next_out=it,L.avail_out=rt,L.next_in=B,L.avail_in=Q,w.hold=z,w.bits=P,2;L.adler=w.check=1,w.mode=12;case 12:if(O===5||O===6)break t;case 13:if(w.last){z>>>=7&P,P-=7&P,w.mode=27;break}for(;P<3;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}switch(w.last=1&z,P-=1,3&(z>>>=1)){case 0:w.mode=14;break;case 1:if(W(w),w.mode=20,O!==6)break;z>>>=2,P-=2;break t;case 2:w.mode=17;break;case 3:L.msg="invalid block type",w.mode=30}z>>>=2,P-=2;break;case 14:for(z>>>=7&P,P-=7&P;P<32;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if((65535&z)!=(z>>>16^65535)){L.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&z,P=z=0,w.mode=15,O===6)break t;case 15:w.mode=16;case 16:if(ut=w.length){if(Q<ut&&(ut=Q),rt<ut&&(ut=rt),ut===0)break t;s.arraySet($,I,B,ut,it),Q-=ut,B+=ut,rt-=ut,it+=ut,w.length-=ut;break}w.mode=12;break;case 17:for(;P<14;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(w.nlen=257+(31&z),z>>>=5,P-=5,w.ndist=1+(31&z),z>>>=5,P-=5,w.ncode=4+(15&z),z>>>=4,P-=4,286<w.nlen||30<w.ndist){L.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;P<3;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}w.lens[ht[w.have++]]=7&z,z>>>=3,P-=3}for(;w.have<19;)w.lens[ht[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,nt={bits:w.lenbits},ct=l(0,w.lens,0,19,w.lencode,0,w.work,nt),w.lenbits=nt.bits,ct){L.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;Pt=(F=w.lencode[z&(1<<w.lenbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(le<16)z>>>=Dt,P-=Dt,w.lens[w.have++]=le;else{if(le===16){for(D=Dt+2;P<D;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(z>>>=Dt,P-=Dt,w.have===0){L.msg="invalid bit length repeat",w.mode=30;break}x=w.lens[w.have-1],ut=3+(3&z),z>>>=2,P-=2}else if(le===17){for(D=Dt+3;P<D;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}P-=Dt,x=0,ut=3+(7&(z>>>=Dt)),z>>>=3,P-=3}else{for(D=Dt+7;P<D;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}P-=Dt,x=0,ut=11+(127&(z>>>=Dt)),z>>>=7,P-=7}if(w.have+ut>w.nlen+w.ndist){L.msg="invalid bit length repeat",w.mode=30;break}for(;ut--;)w.lens[w.have++]=x}}if(w.mode===30)break;if(w.lens[256]===0){L.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,nt={bits:w.lenbits},ct=l(u,w.lens,0,w.nlen,w.lencode,0,w.work,nt),w.lenbits=nt.bits,ct){L.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,nt={bits:w.distbits},ct=l(f,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,nt),w.distbits=nt.bits,ct){L.msg="invalid distances set",w.mode=30;break}if(w.mode=20,O===6)break t;case 20:w.mode=21;case 21:if(6<=Q&&258<=rt){L.next_out=it,L.avail_out=rt,L.next_in=B,L.avail_in=Q,w.hold=z,w.bits=P,c(L,lt),it=L.next_out,$=L.output,rt=L.avail_out,B=L.next_in,I=L.input,Q=L.avail_in,z=w.hold,P=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;Pt=(F=w.lencode[z&(1<<w.lenbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(Pt&&!(240&Pt)){for(qt=Dt,Ne=Pt,$e=le;Pt=(F=w.lencode[$e+((z&(1<<qt+Ne)-1)>>qt)])>>>16&255,le=65535&F,!(qt+(Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}z>>>=qt,P-=qt,w.back+=qt}if(z>>>=Dt,P-=Dt,w.back+=Dt,w.length=le,Pt===0){w.mode=26;break}if(32&Pt){w.back=-1,w.mode=12;break}if(64&Pt){L.msg="invalid literal/length code",w.mode=30;break}w.extra=15&Pt,w.mode=22;case 22:if(w.extra){for(D=w.extra;P<D;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}w.length+=z&(1<<w.extra)-1,z>>>=w.extra,P-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;Pt=(F=w.distcode[z&(1<<w.distbits)-1])>>>16&255,le=65535&F,!((Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(!(240&Pt)){for(qt=Dt,Ne=Pt,$e=le;Pt=(F=w.distcode[$e+((z&(1<<qt+Ne)-1)>>qt)])>>>16&255,le=65535&F,!(qt+(Dt=F>>>24)<=P);){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}z>>>=qt,P-=qt,w.back+=qt}if(z>>>=Dt,P-=Dt,w.back+=Dt,64&Pt){L.msg="invalid distance code",w.mode=30;break}w.offset=le,w.extra=15&Pt,w.mode=24;case 24:if(w.extra){for(D=w.extra;P<D;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}w.offset+=z&(1<<w.extra)-1,z>>>=w.extra,P-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){L.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(rt===0)break t;if(ut=lt-rt,w.offset>ut){if((ut=w.offset-ut)>w.whave&&w.sane){L.msg="invalid distance too far back",w.mode=30;break}jt=ut>w.wnext?(ut-=w.wnext,w.wsize-ut):w.wnext-ut,ut>w.length&&(ut=w.length),Qt=w.window}else Qt=$,jt=it-w.offset,ut=w.length;for(rt<ut&&(ut=rt),rt-=ut,w.length-=ut;$[it++]=Qt[jt++],--ut;);w.length===0&&(w.mode=21);break;case 26:if(rt===0)break t;$[it++]=w.length,rt--,w.mode=21;break;case 27:if(w.wrap){for(;P<32;){if(Q===0)break t;Q--,z|=I[B++]<<P,P+=8}if(lt-=rt,L.total_out+=lt,w.total+=lt,lt&&(L.adler=w.check=w.flags?a(w.check,$,lt,it-lt):o(w.check,$,lt,it-lt)),lt=rt,(w.flags?z:y(z))!==w.check){L.msg="incorrect data check",w.mode=30;break}P=z=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;P<32;){if(Q===0)break t;Q--,z+=I[B++]<<P,P+=8}if(z!==(4294967295&w.total)){L.msg="incorrect length check",w.mode=30;break}P=z=0}w.mode=29;case 29:ct=1;break t;case 30:ct=-3;break t;case 31:return-4;case 32:default:return h}return L.next_out=it,L.avail_out=rt,L.next_in=B,L.avail_in=Q,w.hold=z,w.bits=P,(w.wsize||lt!==L.avail_out&&w.mode<30&&(w.mode<27||O!==4))&&q(L,L.output,L.next_out,lt-L.avail_out)?(w.mode=31,-4):(ft-=L.avail_in,lt-=L.avail_out,L.total_in+=ft,L.total_out+=lt,w.total+=lt,w.wrap&&lt&&(L.adler=w.check=w.flags?a(w.check,$,lt,L.next_out-lt):o(w.check,$,lt,L.next_out-lt)),L.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(ft==0&&lt===0||O===4)&&ct===d&&(ct=-5),ct)},i.inflateEnd=function(L){if(!L||!L.state)return h;var O=L.state;return O.window&&(O.window=null),L.state=null,d},i.inflateGetHeader=function(L,O){var w;return L&&L.state&&2&(w=L.state).wrap?((w.head=O).done=!1,d):h},i.inflateSetDictionary=function(L,O){var w,I=O.length;return L&&L.state?(w=L.state).wrap!==0&&w.mode!==11?h:w.mode===11&&o(1,O,I,0)!==w.check?-3:q(L,O,I,I)?(w.mode=31,-4):(w.havedict=1,d):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,i){var s=n("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,f,d,h,m,p,b,y){var v,T,A,U,S,C,j,N,W,q=y.bits,L=0,O=0,w=0,I=0,$=0,B=0,it=0,Q=0,rt=0,z=0,P=null,ft=0,lt=new s.Buf16(16),ut=new s.Buf16(16),jt=null,Qt=0;for(L=0;L<=15;L++)lt[L]=0;for(O=0;O<h;O++)lt[f[d+O]]++;for($=q,I=15;1<=I&&lt[I]===0;I--);if(I<$&&($=I),I===0)return m[p++]=20971520,m[p++]=20971520,y.bits=1,0;for(w=1;w<I&&lt[w]===0;w++);for($<w&&($=w),L=Q=1;L<=15;L++)if(Q<<=1,(Q-=lt[L])<0)return-1;if(0<Q&&(u===0||I!==1))return-1;for(ut[1]=0,L=1;L<15;L++)ut[L+1]=ut[L]+lt[L];for(O=0;O<h;O++)f[d+O]!==0&&(b[ut[f[d+O]]++]=O);if(C=u===0?(P=jt=b,19):u===1?(P=o,ft-=257,jt=a,Qt-=257,256):(P=c,jt=l,-1),L=w,S=p,it=O=z=0,A=-1,U=(rt=1<<(B=$))-1,u===1&&852<rt||u===2&&592<rt)return 1;for(;;){for(j=L-it,W=b[O]<C?(N=0,b[O]):b[O]>C?(N=jt[Qt+b[O]],P[ft+b[O]]):(N=96,0),v=1<<L-it,w=T=1<<B;m[S+(z>>it)+(T-=v)]=j<<24|N<<16|W|0,T!==0;);for(v=1<<L-1;z&v;)v>>=1;if(v!==0?(z&=v-1,z+=v):z=0,O++,--lt[L]==0){if(L===I)break;L=f[d+b[O]]}if($<L&&(z&U)!==A){for(it===0&&(it=$),S+=w,Q=1<<(B=L-it);B+it<I&&!((Q-=lt[B+it])<=0);)B++,Q<<=1;if(rt+=1<<B,u===1&&852<rt||u===2&&592<rt)return 1;m[A=z&U]=$<<24|B<<16|S-p|0}}return z!==0&&(m[S+z]=L-it<<24|64<<16|0),y.bits=$,0}},{"../utils/common":41}],51:[function(n,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,i){var s=n("../utils/common"),o=0,a=1;function c(F){for(var V=F.length;0<=--V;)F[V]=0}var l=0,u=29,f=256,d=f+1+u,h=30,m=19,p=2*d+1,b=15,y=16,v=7,T=256,A=16,U=17,S=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=new Array(2*(d+2));c(q);var L=new Array(2*h);c(L);var O=new Array(512);c(O);var w=new Array(256);c(w);var I=new Array(u);c(I);var $,B,it,Q=new Array(h);function rt(F,V,ht,pt,Z){this.static_tree=F,this.extra_bits=V,this.extra_base=ht,this.elems=pt,this.max_length=Z,this.has_stree=F&&F.length}function z(F,V){this.dyn_tree=F,this.max_code=0,this.stat_desc=V}function P(F){return F<256?O[F]:O[256+(F>>>7)]}function ft(F,V){F.pending_buf[F.pending++]=255&V,F.pending_buf[F.pending++]=V>>>8&255}function lt(F,V,ht){F.bi_valid>y-ht?(F.bi_buf|=V<<F.bi_valid&65535,ft(F,F.bi_buf),F.bi_buf=V>>y-F.bi_valid,F.bi_valid+=ht-y):(F.bi_buf|=V<<F.bi_valid&65535,F.bi_valid+=ht)}function ut(F,V,ht){lt(F,ht[2*V],ht[2*V+1])}function jt(F,V){for(var ht=0;ht|=1&F,F>>>=1,ht<<=1,0<--V;);return ht>>>1}function Qt(F,V,ht){var pt,Z,_t=new Array(b+1),vt=0;for(pt=1;pt<=b;pt++)_t[pt]=vt=vt+ht[pt-1]<<1;for(Z=0;Z<=V;Z++){var gt=F[2*Z+1];gt!==0&&(F[2*Z]=jt(_t[gt]++,gt))}}function Dt(F){var V;for(V=0;V<d;V++)F.dyn_ltree[2*V]=0;for(V=0;V<h;V++)F.dyn_dtree[2*V]=0;for(V=0;V<m;V++)F.bl_tree[2*V]=0;F.dyn_ltree[2*T]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}function Pt(F){8<F.bi_valid?ft(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}function le(F,V,ht,pt){var Z=2*V,_t=2*ht;return F[Z]<F[_t]||F[Z]===F[_t]&&pt[V]<=pt[ht]}function qt(F,V,ht){for(var pt=F.heap[ht],Z=ht<<1;Z<=F.heap_len&&(Z<F.heap_len&&le(V,F.heap[Z+1],F.heap[Z],F.depth)&&Z++,!le(V,pt,F.heap[Z],F.depth));)F.heap[ht]=F.heap[Z],ht=Z,Z<<=1;F.heap[ht]=pt}function Ne(F,V,ht){var pt,Z,_t,vt,gt=0;if(F.last_lit!==0)for(;pt=F.pending_buf[F.d_buf+2*gt]<<8|F.pending_buf[F.d_buf+2*gt+1],Z=F.pending_buf[F.l_buf+gt],gt++,pt===0?ut(F,Z,V):(ut(F,(_t=w[Z])+f+1,V),(vt=C[_t])!==0&&lt(F,Z-=I[_t],vt),ut(F,_t=P(--pt),ht),(vt=j[_t])!==0&&lt(F,pt-=Q[_t],vt)),gt<F.last_lit;);ut(F,T,V)}function $e(F,V){var ht,pt,Z,_t=V.dyn_tree,vt=V.stat_desc.static_tree,gt=V.stat_desc.has_stree,Ct=V.stat_desc.elems,fe=-1;for(F.heap_len=0,F.heap_max=p,ht=0;ht<Ct;ht++)_t[2*ht]!==0?(F.heap[++F.heap_len]=fe=ht,F.depth[ht]=0):_t[2*ht+1]=0;for(;F.heap_len<2;)_t[2*(Z=F.heap[++F.heap_len]=fe<2?++fe:0)]=1,F.depth[Z]=0,F.opt_len--,gt&&(F.static_len-=vt[2*Z+1]);for(V.max_code=fe,ht=F.heap_len>>1;1<=ht;ht--)qt(F,_t,ht);for(Z=Ct;ht=F.heap[1],F.heap[1]=F.heap[F.heap_len--],qt(F,_t,1),pt=F.heap[1],F.heap[--F.heap_max]=ht,F.heap[--F.heap_max]=pt,_t[2*Z]=_t[2*ht]+_t[2*pt],F.depth[Z]=(F.depth[ht]>=F.depth[pt]?F.depth[ht]:F.depth[pt])+1,_t[2*ht+1]=_t[2*pt+1]=Z,F.heap[1]=Z++,qt(F,_t,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(zt,Vn){var R,g,_,M,G,tt,ot=Vn.dyn_tree,Ht=Vn.max_code,Ie=Vn.stat_desc.static_tree,we=Vn.stat_desc.has_stree,Ce=Vn.stat_desc.extra_bits,he=Vn.stat_desc.extra_base,ja=Vn.stat_desc.max_length,nu=0;for(M=0;M<=b;M++)zt.bl_count[M]=0;for(ot[2*zt.heap[zt.heap_max]+1]=0,R=zt.heap_max+1;R<p;R++)ja<(M=ot[2*ot[2*(g=zt.heap[R])+1]+1]+1)&&(M=ja,nu++),ot[2*g+1]=M,Ht<g||(zt.bl_count[M]++,G=0,he<=g&&(G=Ce[g-he]),tt=ot[2*g],zt.opt_len+=tt*(M+G),we&&(zt.static_len+=tt*(Ie[2*g+1]+G)));if(nu!==0){do{for(M=ja-1;zt.bl_count[M]===0;)M--;zt.bl_count[M]--,zt.bl_count[M+1]+=2,zt.bl_count[ja]--,nu-=2}while(0<nu);for(M=ja;M!==0;M--)for(g=zt.bl_count[M];g!==0;)Ht<(_=zt.heap[--R])||(ot[2*_+1]!==M&&(zt.opt_len+=(M-ot[2*_+1])*ot[2*_],ot[2*_+1]=M),g--)}}(F,V),Qt(_t,fe,F.bl_count)}function x(F,V,ht){var pt,Z,_t=-1,vt=V[1],gt=0,Ct=7,fe=4;for(vt===0&&(Ct=138,fe=3),V[2*(ht+1)+1]=65535,pt=0;pt<=ht;pt++)Z=vt,vt=V[2*(pt+1)+1],++gt<Ct&&Z===vt||(gt<fe?F.bl_tree[2*Z]+=gt:Z!==0?(Z!==_t&&F.bl_tree[2*Z]++,F.bl_tree[2*A]++):gt<=10?F.bl_tree[2*U]++:F.bl_tree[2*S]++,_t=Z,fe=(gt=0)===vt?(Ct=138,3):Z===vt?(Ct=6,3):(Ct=7,4))}function ct(F,V,ht){var pt,Z,_t=-1,vt=V[1],gt=0,Ct=7,fe=4;for(vt===0&&(Ct=138,fe=3),pt=0;pt<=ht;pt++)if(Z=vt,vt=V[2*(pt+1)+1],!(++gt<Ct&&Z===vt)){if(gt<fe)for(;ut(F,Z,F.bl_tree),--gt!=0;);else Z!==0?(Z!==_t&&(ut(F,Z,F.bl_tree),gt--),ut(F,A,F.bl_tree),lt(F,gt-3,2)):gt<=10?(ut(F,U,F.bl_tree),lt(F,gt-3,3)):(ut(F,S,F.bl_tree),lt(F,gt-11,7));_t=Z,fe=(gt=0)===vt?(Ct=138,3):Z===vt?(Ct=6,3):(Ct=7,4)}}c(Q);var nt=!1;function D(F,V,ht,pt){lt(F,(l<<1)+(pt?1:0),3),function(Z,_t,vt,gt){Pt(Z),ft(Z,vt),ft(Z,~vt),s.arraySet(Z.pending_buf,Z.window,_t,vt,Z.pending),Z.pending+=vt}(F,V,ht)}i._tr_init=function(F){nt||(function(){var V,ht,pt,Z,_t,vt=new Array(b+1);for(Z=pt=0;Z<u-1;Z++)for(I[Z]=pt,V=0;V<1<<C[Z];V++)w[pt++]=Z;for(w[pt-1]=Z,Z=_t=0;Z<16;Z++)for(Q[Z]=_t,V=0;V<1<<j[Z];V++)O[_t++]=Z;for(_t>>=7;Z<h;Z++)for(Q[Z]=_t<<7,V=0;V<1<<j[Z]-7;V++)O[256+_t++]=Z;for(ht=0;ht<=b;ht++)vt[ht]=0;for(V=0;V<=143;)q[2*V+1]=8,V++,vt[8]++;for(;V<=255;)q[2*V+1]=9,V++,vt[9]++;for(;V<=279;)q[2*V+1]=7,V++,vt[7]++;for(;V<=287;)q[2*V+1]=8,V++,vt[8]++;for(Qt(q,d+1,vt),V=0;V<h;V++)L[2*V+1]=5,L[2*V]=jt(V,5);$=new rt(q,C,f+1,d,b),B=new rt(L,j,0,h,b),it=new rt(new Array(0),N,0,m,v)}(),nt=!0),F.l_desc=new z(F.dyn_ltree,$),F.d_desc=new z(F.dyn_dtree,B),F.bl_desc=new z(F.bl_tree,it),F.bi_buf=0,F.bi_valid=0,Dt(F)},i._tr_stored_block=D,i._tr_flush_block=function(F,V,ht,pt){var Z,_t,vt=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(gt){var Ct,fe=4093624447;for(Ct=0;Ct<=31;Ct++,fe>>>=1)if(1&fe&&gt.dyn_ltree[2*Ct]!==0)return o;if(gt.dyn_ltree[18]!==0||gt.dyn_ltree[20]!==0||gt.dyn_ltree[26]!==0)return a;for(Ct=32;Ct<f;Ct++)if(gt.dyn_ltree[2*Ct]!==0)return a;return o}(F)),$e(F,F.l_desc),$e(F,F.d_desc),vt=function(gt){var Ct;for(x(gt,gt.dyn_ltree,gt.l_desc.max_code),x(gt,gt.dyn_dtree,gt.d_desc.max_code),$e(gt,gt.bl_desc),Ct=m-1;3<=Ct&&gt.bl_tree[2*W[Ct]+1]===0;Ct--);return gt.opt_len+=3*(Ct+1)+5+5+4,Ct}(F),Z=F.opt_len+3+7>>>3,(_t=F.static_len+3+7>>>3)<=Z&&(Z=_t)):Z=_t=ht+5,ht+4<=Z&&V!==-1?D(F,V,ht,pt):F.strategy===4||_t===Z?(lt(F,2+(pt?1:0),3),Ne(F,q,L)):(lt(F,4+(pt?1:0),3),function(gt,Ct,fe,zt){var Vn;for(lt(gt,Ct-257,5),lt(gt,fe-1,5),lt(gt,zt-4,4),Vn=0;Vn<zt;Vn++)lt(gt,gt.bl_tree[2*W[Vn]+1],3);ct(gt,gt.dyn_ltree,Ct-1),ct(gt,gt.dyn_dtree,fe-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,vt+1),Ne(F,F.dyn_ltree,F.dyn_dtree)),Dt(F),pt&&Pt(F)},i._tr_tally=function(F,V,ht){return F.pending_buf[F.d_buf+2*F.last_lit]=V>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&V,F.pending_buf[F.l_buf+F.last_lit]=255&ht,F.last_lit++,V===0?F.dyn_ltree[2*ht]++:(F.matches++,V--,F.dyn_ltree[2*(w[ht]+f+1)]++,F.dyn_dtree[2*P(V)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){lt(F,2,3),ut(F,T,q),function(V){V.bi_valid===16?(ft(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(n,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,f,d=1,h={},m=!1,p=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,c={}.toString.call(o.process)==="[object process]"?function(A){Er.nextTick(function(){v(A)})}:function(){if(o.postMessage&&!o.importScripts){var A=!0,U=o.onmessage;return o.onmessage=function(){A=!1},o.postMessage("","*"),o.onmessage=U,A}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",T,!1):o.attachEvent("onmessage",T),function(A){o.postMessage(f+A,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){u.port2.postMessage(A)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(A){var U=p.createElement("script");U.onreadystatechange=function(){v(A),U.onreadystatechange=null,l.removeChild(U),U=null},l.appendChild(U)}):function(A){setTimeout(v,0,A)},b.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var U=new Array(arguments.length-1),S=0;S<U.length;S++)U[S]=arguments[S+1];var C={callback:A,args:U};return h[d]=C,c(d),d++},b.clearImmediate=y}function y(A){delete h[A]}function v(A){if(m)setTimeout(v,0,A);else{var U=h[A];if(U){m=!0;try{(function(S){var C=S.callback,j=S.args;switch(j.length){case 0:C();break;case 1:C(j[0]);break;case 2:C(j[0],j[1]);break;case 3:C(j[0],j[1],j[2]);break;default:C.apply(a,j)}})(U)}finally{y(A),m=!1}}}}function T(A){A.source===o&&typeof A.data=="string"&&A.data.indexOf(f)===0&&v(+A.data.slice(f.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Ln<"u"?Ln:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Bw);var i$=Bw.exports,Od=Us(i$);const Pw={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(Pw);var kr=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},Io,Da,Ms;class s${constructor(...t){Io.set(this,new Map),Da.set(this,new Map),Ms.set(this,new Map);for(const n of t)this.define(n)}define(t,n=!1){for(let[r,i]of Object.entries(t)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),kr(this,Ms,"f").has(r)||kr(this,Ms,"f").set(r,new Set);const s=kr(this,Ms,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s==null||s.add(a),o&&kr(this,Da,"f").set(r,a),o=!1,c)continue;const l=kr(this,Io,"f").get(a);if(l&&l!=r&&!n)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);kr(this,Io,"f").set(a,r)}}return this}getType(t){if(typeof t!="string")return null;const n=t.replace(/^.*[/\\]/,"").toLowerCase(),r=n.replace(/^.*\./,"").toLowerCase(),i=n.length<t.length;return!(r.length<n.length-1)&&i?null:kr(this,Io,"f").get(r)??null}getExtension(t){var n;return typeof t!="string"?null:(t=(n=t==null?void 0:t.split)==null?void 0:n.call(t,";")[0],(t&&kr(this,Da,"f").get(t.trim().toLowerCase()))??null)}getAllExtensions(t){return typeof t!="string"?null:kr(this,Ms,"f").get(t.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const t of kr(this,Ms,"f").values())Object.freeze(t);return this}_getTestState(){return{types:kr(this,Io,"f"),extensions:kr(this,Da,"f")}}}Io=new WeakMap,Da=new WeakMap,Ms=new WeakMap;var o$=new s$(Pw)._freeze();function a$(e,t){console.info(t)}function c$(e,t){console.info(t)}const $w=60,l$=$w*25;function u$(e,t){let n=0;const r=new DataView(t.buffer);function i(){const I=r.getUint8(n);return n++,I}function s(){const I=r.getInt16(n,!0);return n+=2,I}function o(){const I=r.getInt32(n,!0);return n+=4,I}function a(I){let $="";const B=t.subarray(n,n+I);for(let it=0;it<B.length;++it)$+=String.fromCharCode(B[it]);return n+=I,$.replace("\r",`
`)}function c(I,$,B,it){const Q=$r(I,$,B);if(k(Q)&&k(it)){const rt=qn(it);for(let z=0;z<rt.length;++z){const P=rt[z];Q[P]=it[P]}}if(k($)){const[rt]=$;rt==="scroll"&&console.info("writefromkind",rt,"-",Q,"-")}}function l(I){let $="";for(let B=0;B<I.length;++B){const it=I.charCodeAt(B);it<32||it>127?$+=`$${it}`:$+=I[B]}return $}function u(I){return I.replaceAll(/\r?\n|\r/g,`
`).split(`
`).map($=>{if($.includes("$")){const[B,...it]=$.split("$");return`${B??""}"$CENTER ${l(it.join("$"))}"`}return l($)}).join(`
`)}function f(I,$,B,it,Q){const z=[Ot[it.color%16]],P={},ft=Q.find(lt=>lt.x===$&&lt.y===B);switch(k(ft)&&(xt(ft.cycle)&&ft.cycle>0&&(P.cycle=ft.cycle),k(ft.p1)&&(P.p1=ft.p1),k(ft.p2)&&(P.p2=ft.p2),k(ft.p3)&&(P.p3=ft.p3),k(ft.code)&&ft.code&&(P.code=u(ft.code))),it.element){case 0:case 1:case 2:case 3:case 4:break;case 5:c(I,["ammo",z],{x:$,y:B},P);break;case 6:c(I,["torch",z],{x:$,y:B},P);break;case 7:c(I,["gem",z],{x:$,y:B},P);break;case 8:c(I,["key",z],{x:$,y:B},P);break;case 9:c(I,["door",z],{x:$,y:B},P);break;case 10:c(I,["scroll",z],{x:$,y:B},P);break;case 11:c(I,["passage",z],{x:$,y:B},{...P,p3:d(ft==null?void 0:ft.p3)??""});break;case 12:c(I,["duplicator",z],{x:$,y:B},P);break;case 13:c(I,["bomb",z],{x:$,y:B},P);break;case 14:c(I,["energize",z],{x:$,y:B},P);break;case 15:c(I,["star",z],{x:$,y:B},P);break;case 16:c(I,["clockwise",z],{x:$,y:B},P);break;case 17:c(I,["counter",z],{x:$,y:B},P);break;case 18:c(I,["bullet",z],{x:$,y:B},P);break;case 19:c(I,["water",z],{x:$,y:B},P);break;case 20:c(I,["forest",z],{x:$,y:B},P);break;case 21:c(I,["solid",z],{x:$,y:B},P);break;case 22:c(I,["normal",z],{x:$,y:B},P);break;case 23:c(I,["breakable",z],{x:$,y:B},P);break;case 24:c(I,["boulder",z],{x:$,y:B},P);break;case 25:c(I,["sliderns",z],{x:$,y:B},P);break;case 26:c(I,["sliderew",z],{x:$,y:B},P);break;case 27:c(I,["fake",z],{x:$,y:B},P);break;case 28:c(I,["invisible",z],{x:$,y:B},P);break;case 29:c(I,["blinkwall",z],{x:$,y:B},P);break;case 30:c(I,["transporter",z],{x:$,y:B},P);break;case 31:c(I,["line",z],{x:$,y:B},P);break;case 32:c(I,["ricochet",z],{x:$,y:B},P);break;case 33:c(I,["blinkns",z],{x:$,y:B},P);break;case 34:c(I,["bear",z],{x:$,y:B},P);break;case 35:c(I,["ruffian",z],{x:$,y:B},P);break;case 36:c(I,["object",z],{x:$,y:B},{...P,char:(ft==null?void 0:ft.p1)??1});break;case 37:c(I,["slime",z],{x:$,y:B},P);break;case 38:c(I,["shark",z],{x:$,y:B},P);break;case 39:c(I,["spinninggun",z],{x:$,y:B},P);break;case 40:c(I,["pusher",z],{x:$,y:B},P);break;case 41:c(I,["lion",z],{x:$,y:B},P);break;case 42:c(I,["tiger",z],{x:$,y:B},P);break;case 43:c(I,["blinkns",z],{x:$,y:B},P);break;case 44:c(I,["head",z],{x:$,y:B},P);break;case 45:c(I,["segment",z],{x:$,y:B},P);break;case 46:break;case 47:c(I,["text",["WHITE","ONDKBLUE"]],{x:$,y:B},{...P,char:it.color});break;case 48:c(I,["text",["WHITE","ONDKGREEN"]],{x:$,y:B},{...P,char:it.color});break;case 49:c(I,["text",["WHITE","ONDKCYAN"]],{x:$,y:B},{...P,char:it.color});break;case 50:c(I,["text",["WHITE","ONDKRED"]],{x:$,y:B},{...P,char:it.color});break;case 51:c(I,["text",["WHITE","ONDKPURPLE"]],{x:$,y:B},{...P,char:it.color});break;case 52:c(I,["text",["WHITE","ONDKYELLOW"]],{x:$,y:B},{...P,char:it.color});break;case 53:c(I,["text",["WHITE","ONBLACK"]],{x:$,y:B},{...P,char:it.color});break}}function d(I){if(xt(I)&&I>0)return`zztboard${I}`}if(s()!=-1)return;const m=s(),p=s(),b=s(),y=a(7),v=s(),T=s(),A=s(),U=s(),S=s();s();const C=s(),j=i(),N=a(20).slice(0,j);for(let I=0;I<9;I++){const $=i();a(20).slice(0,$)}const W=s(),q=s(),L=i();console.info(p,b,y,v,T,A,U,S,C,W,q,L),n=512;const O=[];for(let I=0;I<m;++I){const $=s(),B=n,it=i(),rt={boardname:a(50).slice(0,it),elements:[],stats:[]};for(;rt.elements.length<l$;){let P=i();P===0&&(P=255);const ft=i(),lt=i();for(let ut=0;ut<P;++ut)rt.elements.push({element:ft,color:lt})}rt.maxplayershots=i(),rt.isdark=i(),rt.exitnorth=i(),rt.exitsouth=i(),rt.exitwest=i(),rt.exiteast=i(),rt.restartonzap=i(),rt.messagelength=i(),rt.message=a(58).slice(0,rt.messagelength),rt.playerenterx=i(),rt.playerentery=i(),rt.timelimit=s(),n+=16;const z=s()+1;for(;rt.stats.length<z;){const P={};P.x=i()-1,P.y=i()-1,P.stepx=s(),P.stepy=s(),P.cycle=s(),P.p1=i(),P.p2=i(),P.p3=i(),P.follower=s(),P.leader=s(),P.underelement=i(),P.undercolor=i(),P.pointer=o(),P.currentinstruction=s();const ft=s();n+=8,ft<0?P.bind=Math.abs(ft):P.code=a(ft),rt.stats.push(P)}O.push(rt),n=B+$}const w=qf([]);w.name=N;for(let I=0;I<O.length;++I){const $=O[I],B=[`@zztboard${I}`,""];I===T&&B.push("@title"),xt($.maxplayershots)&&B.push(`@maxplayershots ${$.maxplayershots}`),$.isdark&&B.push("@isdark"),$.restartonzap&&B.push("@restartonzap"),xt($.timelimit)&&B.push(`@timelimit ${$.timelimit}`);const it=d($.exitnorth);yt(it)&&B.push(`@exitnorth ${it}`);const Q=d($.exitsouth);yt(Q)&&B.push(`@exitsouth ${Q}`);const rt=d($.exitwest);yt(rt)&&B.push(`@exitwest ${rt}`);const z=d($.exiteast);yt(z)&&B.push(`@exiteast ${z}`);const P=`@board ${String(I).padStart(3,"0")}. ${$.boardname}
${B.join(`
`)}`,ft=fk(P,{});Qf(w,ft);const lt=Re(ft);if(!k(lt))continue;let ut=0,jt=0;for(let Qt=0;Qt<$.elements.length;++Qt){const Dt=$.elements[Qt];f(lt,ut,jt,Dt,$.stats),++ut,ut===$w&&(ut=0,++jt)}Ae(lt)}Yl(w),Xd(et,e,`imported zzt file into ${w.name} book`)}function Dw(e,t){switch([...t.slice(0,4)].map(i=>i.toString(16)).join("").toUpperCase()){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip"}return o$.getType(e)??"application/octet-stream"}async function h$(e,t,n){try{xe(et,e,"parsezipfile",t.name);const r=await t.arrayBuffer();(await new Od().loadAsync(r)).forEach((o,a)=>{a.async("uint8array").then(c=>{const l=Dw(o,c),u=new File([c],a.name,{type:l});n(u)}).catch(c=>{de(et,e,"crash",c.message)})})}catch(r){de(et,e,"crash",r.message)}}function jw(e,t,n){if(k(n))switch(t){case"text/plain":n.text().then(r=>gu(et,e,void 0,"text",`file:${n.name}`,r)).catch(r=>de(et,e,"crash",r.message));break;case"application/json":n.text().then(r=>gu(et,e,void 0,"json",`file:${n.name}`,r)).catch(r=>de(et,e,"crash",r.message));break;case"application/zip":h$(e,n,r=>zw(e,r)).catch(r=>de(et,e,"crash",r.message));break;case"application/octet-stream":/.zzt$/i.test(n.name)&&n.arrayBuffer().then(r=>{u$(e,new Uint8Array(r))}).catch(r=>de(et,e,"crash",r.message)),/.zzl$/i.test(n.name)&&n.text().then(r=>{a$(e,r)}).catch(r=>de(et,e,"crash",r.message)),/.zzm$/i.test(n.name)&&n.text().then(r=>{c$(e,r)}).catch(r=>de(et,e,"crash",r.message));break;default:n.arrayBuffer().then(r=>{const i=Dw(n.name,new Uint8Array(r));if(i)jw(e,i,n);else return de(et,e,"parsewebfile",`unsupported file ${n.name}`)}).catch(r=>de(et,e,"crash",r.message));return}}function zw(e,t){jw(e,(t==null?void 0:t.type)??"",t)}function hi(e,t,n){n().catch(r=>{console.error(r),de(e,t,"crash",r==null?void 0:r.message)})}function f$(e){const[t,n]=e.split(":"),r=k(n);return[r?t:"self",r?n:e]}function d$(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-t.length%4)%4);return t+n}function p$(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}const m$=new Date("1980/09/02");async function Nd(e){return console.info("saved",e),new Promise((t,n)=>{const r=new Od;for(let i=0;i<e.length;++i){const s=e[i],o=_U(s);if(o){const a=dS(o);k(a)&&r.file(s.id,a,{date:m$})}}r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}}).then(i=>{t(p$(i))}).catch(n)})}async function g$(e){return new Promise((t,n)=>{const r=new Od;r.loadAsync(d$(e),{base64:!0}).then(async()=>{const i=[],s=[];r.forEach((o,a)=>s.push(a));for(let o=0;o<s.length;++o){const c=await s[o].async("uint8array"),l=yU(pS(c));k(l)&&i.push(l)}t(i)}).catch(n)})}function _$(e,t,n,r){const i=hn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){xt(u)&&(s=u,Jp(t.x,t.y,n.x,n.y).forEach(f=>{const d=ie(i,f);k(d)&&(d[l]=u)}))}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,`batch:${ro(t,n)}`,"char",[r,"charedit"],o,a);const c=Ye(e);c.scroll=Tn(e)}function y$(e,t,n,r){const i=hn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){if(xt(u)){s=u;for(let f=t.y;f<=n.y;++f)for(let d=t.x;d<=n.x;++d){const h=ie(i,{x:d,y:f});k(h)&&(h[l]=u)}}}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,`batch:${ro(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scroll=Tn(e)}function b$(e,t,n,r){const i=hn(e);if(!k(i))return;let s=0;function o(){return s}function a(l,u){xt(u)&&(s=u,Jp(t.x,t.y,n.x,n.y).forEach(f=>{const d=ie(i,f);k(d)&&(d[l]=u)}))}Rt(e,`batch chars: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,`batch:${ro(t,n)}`,"color",[r,"coloredit"],o,a);const c=Ye(e);c.scroll=Tn(e)}function k$(e,t,n,r){const i=ln($t.MAIN);if(!k(i))return;const s=hn(e);if(!k(s))return;const o=ro(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","copy elements",[`copy:${o}`,"hk","1"," 1 ","next"]),Lt(e,"batch","cut elements",[`cut:${o}`,"hk","2"," 2 ","next"]),r&&Lt(e,"batch","paste elements",[`paste:${o}`,"hk","3"," 3 ","next"]),Lt(e,"batch","copy coords",[`copycoords:${o}`,"hk","5"," 5 "]),Lt(e,"remix","remix coords",[`remix:${o}`,"hk","r"," R ","next"]),Rt(e,Ke),Lt(e,"batch","set chars:",[`chars:${o}`,"hk","a"," A ","next"]),Lt(e,"batch","set colors:",[`colors:${o}`,"hk","c"," C ","next"]),Lt(e,"batch","set bgs:",[`bgs:${o}`,"hk","b"," B ","next"]),Rt(e,Ke),Lt(e,"batch","make empty",[`empty:${o}`,"hk","0"," 0 ","next"]),Rt(e,Ke),Rt(e,"codepages:"),Lt(e,"batch","edit @board codepage",[`pageopen:${s.id}`]);const a=Math.min(t.x,n.x),c=Math.min(t.y,n.y),l=Math.max(t.x,n.x),u=Math.max(t.y,n.y),f=new Set;for(let d=c;d<=u;++d)for(let h=a;h<=l;++h){const m=ie(s,{x:h,y:d}),p=_k(i,m);k(p)&&!f.has(p.id)&&(f.add(p.id),Lt(e,"batch",`edit @${Ue(p)}`,[`pageopen:${p.id}`]))}Lt(e,"batch",`board id ${s.id}`,["","copyit",s.id])}function Id(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function w$(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Id(n);return(i,s)=>r.then(o=>s(o.transaction(t,i).objectStore(t)))}let Cd;function Ww(){return Cd||(Cd=w$("keyval-store","keyval")),Cd}function Gw(e,t=Ww()){return t("readonly",n=>Id(n.get(e)))}function Kw(e,t,n=Ww()){return n("readwrite",r=>new Promise((i,s)=>{r.get(e).onsuccess=function(){try{r.put(t(this.result),e),i(Id(r.transaction))}catch(o){s(o)}}}))}function Ld(e,t){return`${e.x},${e.y},${t.x},${t.y}`}async function Hw(){return Gw("secretheap")}async function Yw(e){return Kw("secretheap",e)}async function E$(){return!!await Hw()}function Vw(e,t,n){const r=Math.min(t.x,n.x),i=Math.min(t.y,n.y),s=Math.max(t.x,n.x),o=Math.max(t.y,n.y),a=s-r+1,c=o-i+1,l=[],u=[];for(let f=i;f<=o;++f)for(let d=r;d<=s;++d){const h={x:d-r,y:f-i},m=ie(e,{x:d,y:f});(m==null?void 0:m.category)===Un.ISOBJECT?(l.push(wr(es(e,d,f))),Or(m)!=="player"&&u.push({...wr(m),...h,id:"blank"})):l.push({...wr(m),...h})}return{board:e.id,width:a,height:c,terrain:l,objects:u}}async function x$(e,t,n,r){const i=hn(e);if(!k(i))return;const s=Vw(i,t,n);switch(r){case"copyobjects":s.terrain=[];break;case"copyterrain":s.objects=[];break}await Yw(()=>s)}function v$(e,t,n){const r=Ld(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","copy terrain & objects",[`copyall:${r}`,"hk","1"]),Lt(e,"batch","copy objects",[`copyobjects:${r}`,"hk","2"]),Lt(e,"batch","copy terrain",[`copyterrain:${r}`,"hk","3"]);const i=Ye(e);i.scroll=Tn(e)}async function T$(e,t,n,r){const i=ln($t.MAIN);if(!k(i))return;const s=hn(e);if(!k(s))return;const o=Vw(s,t,n);switch(r){case"cutobjects":o.terrain=[];break;case"cutterrain":o.objects=[];break}switch(r){case"cutall":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ie(s,{x:c,y:a});(l==null?void 0:l.category)===Un.ISOBJECT&&xn(s,l,i.timestamp),Oe(s,{x:c,y:a})}break}case"cutobjects":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c){const l=ie(s,{x:c,y:a});(l==null?void 0:l.category)===Un.ISOBJECT&&xn(s,l,i.timestamp)}break}case"cutterrain":{for(let a=t.y;a<=n.y;++a)for(let c=t.x;c<=n.x;++c)Oe(s,{x:c,y:a});break}}await Yw(()=>o)}function A$(e,t,n){const r=Ld(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","cut terrain & objects",[`cutall:${r}`,"hk","1"]),Lt(e,"batch","cut objects",[`cutobjects:${r}`,"hk","2"]),Lt(e,"batch","cut terrain",[`cutterrain:${r}`,"hk","3"]);const i=Ye(e);i.scroll=Tn(e)}async function S$(e,t,n,r){const i=hn(e),s=await Hw();if(!k(i)||!k(s))return;const o=Math.min(t.x,n.x),a=Math.min(t.y,n.y),c=Math.max(t.x,n.x),l=Math.max(t.y,n.y),u=c-o+1,f=l-a+1,d=Math.min(s.width,u),h=Math.min(s.height,f);switch(r){case"pasteall":{for(let m=0;m<h;++m)for(let p=0;p<d;++p){const b=lr({x:p,y:m},s.width);Oe(i,{...s.terrain[b],x:o+p,y:a+m})}for(let m=0;m<s.objects.length;++m){const p=s.objects[m];k(p.x)&&k(p.y)&&dh(p.x,p.y,0,u-1,f-1,0)&&Td(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break}case"pasteobjects":for(let m=0;m<s.objects.length;++m){const p=s.objects[m];k(p.x)&&k(p.y)&&dh(p.x,p.y,0,u-1,f-1,0)&&Td(i,{...p,id:void 0,x:o+p.x,y:a+p.y})}break;case"pasteterrain":for(let m=0;m<h;++m)for(let p=0;p<d;++p){const b=lr({x:p,y:m},s.width);Oe(i,{...s.terrain[b],x:o+p,y:a+m})}break;case"pasteterraintiled":for(let m=a;m<=l;++m)for(let p=o;p<=c;++p){const b=(p-o)%s.width,y=(m-a)%s.height,v=lr({x:b,y},s.width);Oe(i,{...s.terrain[v],x:p,y:m})}break}}function R$(e,t,n){const r=Ld(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","paste terrain & objects",[`pasteall:${r}`,"hk","1"]),Lt(e,"batch","paste objects",[`pasteobjects:${r}`,"hk","2"]),Lt(e,"batch","paste terrain",[`pasteterrain:${r}`,"hk","3"]),Lt(e,"batch","paste terrain tiled",[`pasteterraintiled:${r}`,"hk","4"]);const i=Ye(e);i.scroll=Tn(e)}function Md(e,t){return`inspect:${t!=null&&t.id?t.id:Dr(e,t)}`}function O$(e,t,n){const r=ln($t.MAIN);if(!k(r))return;const i=hn(e);if(!k(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){k(t)&&(t[d]=h)}const a=t.category===Un.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Md(i,t);Rt(e,`${a}: ${c} ${l}`),Rt(e,Ke),Lt(e,u,"color",[n,"coloredit"],s,o);const f=Ye(e);f.scroll=Tn(e)}function N$(e,t,n){const r=ln($t.MAIN);if(!k(r))return;const i=hn(e);if(!k(i))return;function s(d){var m;return(t==null?void 0:t[d])??((m=t==null?void 0:t.kinddata)==null?void 0:m[d])??0}function o(d,h){k(t)&&(t[d]=h)}const a=t.category===Un.ISTERRAIN?"terrain":"object",c=t.name??t.kind??"ERR",l=`${t.x??-1}, ${t.y??-1}`,u=Md(i,t);Rt(e,`${a}: ${c} ${l}`),Rt(e,Ke),Lt(e,u,"char",[n,"charedit"],s,o);const f=Ye(e);f.scroll=Tn(e)}function I$(e,t,n,r,i,s){var h,m,p;const o=ln($t.MAIN);if(!k(o))return;function a(b){var v;const y=(r==null?void 0:r[b])??((v=r==null?void 0:r.kinddata)==null?void 0:v[b]);if(!k(y))switch(b){case"color":return 15;case"bg":return 0;case"cycle":return 3;case"collision":return Wt.ISWALK;case"pushable":return 0;case"breakable":return 0}return y}function c(b,y){k(r)&&(r[b]=y)}s?Rt(e,`object: ${r.name??r.kind??"ERR"} ${i.x}, ${i.y}`):Rt(e,`terrain: ${r.kind??"ERR"} ${i.x}, ${i.y}`);const l=Md(t,r);switch(s&&Rt(e,`cycle: ${Gt(r,"cycle")}`),Gt(r,"collision")){case Wt.ISWALK:Rt(e,"collision: iswalk");break;case Wt.ISSWIM:Rt(e,"collision: isswim");break;case Wt.ISSOLID:Rt(e,"collision: issolid");break;case Wt.ISBULLET:Rt(e,"collision: isbullet");break}s&&Rt(e,`ispushable: ${Gt(r,"pushable")?"yes":"no"}`),Rt(e,`isbreakable: ${Gt(r,"breakable")?"yes":"no"}`),Rt(e,Ke);const f=Na(n),d=qn(f);for(let b=0;b<d.length;++b){const y=d[b];switch(y){case"char":case"cycle":case"color":case"bg":case"collision":case"pushable":case"breakable":break;default:if(ue(f[y])){const[v,T,...A]=f[y];yt(T)&&Lt(e,l,T||y,[y,v,...A],a,c)}break}}Lt(e,l,"copy coords",["copycoords","hk","5"," 5 "]),Rt(e,Ke),Lt(e,l,`char: ${r.char??((h=r.kinddata)==null?void 0:h.char)??1}`,["char","hk","a"," A ","next"],a,c),Lt(e,l,`color: ${r.color??((m=r.kinddata)==null?void 0:m.color)??15}`,["color","hk","c"," C ","next"],a,c),Lt(e,l,`bg: ${r.bg??((p=r.kinddata)==null?void 0:p.bg)??0}`,["bg","hk","b"," B ","next"],a,c),Rt(e,Ke),Lt(e,l,"make empty",["empty","hk","0"],a,c),Rt(e,Ke),Lt(e,"batch","edit @board codepage",[`pageopen:${t.id}`]),Lt(e,"batch",`edit @${Ue(n)}`,[`pageopen:${n.id}`]),Lt(e,"batch",`board id ${t.id}`,["","copyit",t.id])}function C$(e,t,n,r){const i=ln($t.MAIN);if(!k(i))return;const s=hn(e);if(k(s))switch(r){case"emptyall":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ie(s,{x:a,y:o});(c==null?void 0:c.category)===Un.ISOBJECT&&xn(s,c,i.timestamp),Oe(s,{x:a,y:o})}break}case"emptyobjects":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a){const c=ie(s,{x:a,y:o});(c==null?void 0:c.category)===Un.ISOBJECT&&xn(s,c,i.timestamp)}break}case"emptyterrain":{for(let o=t.y;o<=n.y;++o)for(let a=t.x;a<=n.x;++a)Oe(s,{x:a,y:o});break}}}function L$(e,t,n){const r=ln($t.MAIN);if(!k(r))return;const i=hn(e);if(!k(i))return;const s=ro(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke),Lt(e,"batch","clear terrain & objects",[`emptyall:${s}`,"hk","1"]),Lt(e,"batch","clear objects",[`emptyobjects:${s}`,"hk","2"]),Lt(e,"batch","clear terrain",[`emptyterrain:${s}`,"hk","3"]);const o=Ye(e);o.scroll=Tn(e)}async function M$(e,t,n){const r=ln($t.MAIN),i=await E$();if(!k(r))return;const s=hn(e);if(!k(s))return;if(Ae(s),t.x===n.x&&t.y===n.y){const a=ie(s,t),c=_k(r,a);k(a)&&k(c)&&I$(e,s,c,a,t,Ge(a)),a!=null&&a.kind||(Rt(e,`empty: ${t.x}, ${t.y}`),Rt(e,Ke),Lt(e,"empty","copy coords",[`copycoords:${t.x},${t.y}`,"hk","5"," 5 "]),Lt(e,"batch","edit @board codepage",[`pageopen:${s.id}`]),Lt(e,"batch",`board id ${s.id}`,["","copyit",s.id]))}else k$(e,t,n,i);const o=Ye(e);o.scroll=Tn(e)}function U$(e,t){const n=ce($t.MAIN);if(!k(n))return;const r=hn(t);if(!k(r))return;const i=Fn(e),s=YP(r,i.target);if(k(s))switch(i.path){case"copycoords":pu(et,sr(),[s.x??0,s.y??0].join(" "));break;case"bg":case"color":O$(t,s,i.path);break;case"char":N$(t,s,i.path);break;case"empty":xn(r,s,n.timestamp);break;case"code":hi(et,t,async()=>{const o=Or(s),a="object";xe(et,t,`opened [${a}] ${o}`);const c=[r.id,s.id];fh(Ka(n.id,c),s.code??""),JE(et,t),await r0(800),t0(et,t,n.id,c,a,`${o} - ${n.name}`)});break;default:console.info("unknown inspect",i);break}}async function F$(e,t){const n=hn(t);if(!k(n))return;const r=Fn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"copy":v$(t,c,l);break;case"copyall":case"copyobjects":case"copyterrain":await x$(t,c,l,r.target);break;case"cut":A$(t,c,l);break;case"cutall":case"cutobjects":case"cutterrain":await T$(t,c,l,r.target);break;case"paste":R$(t,c,l);break;case"pasteall":case"pasteobjects":case"pasteterrain":case"pasteterraintiled":await S$(t,c,l,r.target);break;case"empty":L$(t,c,l);break;case"emptyall":case"emptyobjects":case"emptyterrain":C$(t,c,l,r.target);break;case"chars":_$(t,c,l,"char");break;case"colors":y$(t,c,l,"color");break;case"bgs":b$(t,c,l,"bg");break;case"copycoords":pu(et,t,[i,s,o,a].join(" "));break;case"pageopen":hi(et,t,async()=>{await r0(800),_x(et,t,`#pageopen ${r.path}`)});break;default:console.info("unknown batch",r);break}}async function B$(){return Gw("remixconfig")}async function P$(e){return Kw("remixconfig",e)}let ns={stat:"",patternsize:2,mirror:1};async function $$(e,t){const n=hn(t);if(!k(n))return;const r=Fn(e),[i,s,o,a]=r.path.split(",").map(u=>parseFloat(u)),c={x:Math.min(i,o),y:Math.min(s,a)},l={x:Math.max(i,o),y:Math.max(s,a)};switch(r.target){case"remix":{await D$(t,c,l);break}case"remixrun":{const u=un(ns.stat);k(u)&&Vk(n.id,u.id,ns.patternsize,ns.mirror,c,l,"all"),await P$(()=>ns);break}default:console.info("unknown remix",r);break}}async function D$(e,t,n){const r=await B$();ns={...ns,...r};const i=ro(t,n);Rt(e,`selected: ${t.x},${t.y} - ${n.x},${n.y}`),Rt(e,Ke);function s(c){const{target:l}=Fn(c);return ns[l]}function o(c,l){if(xt(l)||yt(l)){const{target:u}=Fn(c);ns[u]=l}}Lt(e,"remix","source board",[`stat:${i}`,"text"],s,o),Lt(e,"remix","patternsize",[`patternsize:${i}`,"number","1","5"],s,o),Lt(e,"remix","mirror",[`mirror:${i}`,"number","1","8"],s,o),Rt(e,Ke),Lt(e,"remix","run",[`remixrun:${i}`,"hk","r"," R "]);const a=Ye(e);a.scroll=Tn(e)}const j$=16,rs={},eu={},z$=60;let Xw=0;const Co={},Lo={};async function qw(e){const t=Fr(),n=ce($t.MAIN);if(t.length&&k(n)){const r=await Nd(t),i=`${e?"autosave ":""}${new Date().toISOString()} ${n.name} ${r.length} chars`;QE(Zt,sr(),i,r)}}async function W$(){const e=Fr(),t=ce($t.MAIN);if(e.length&&k(t)){const n=await Nd(e);tx(Zt,sr(),n)}}async function G$(){const e=Fr(),t=ce($t.MAIN);return e.length&&k(t)?Nd(e):""}const Zt=Bs("vm",["tick","second"],e=>{var n;if(!Zt.session(e))return;const t=sr();switch(e.target){case"operator":vP(e.player),xe(Zt,e.player,`operator set to ${e.player}`),Zt.replynext(e,"ackoperator",!0);break;case"zsswords":{const r=ce($t.MAIN);Zt.replynext(e,"ackzsswords",{cli:dd(Ji.CLI),loader:dd(Ji.LOADER),runtime:dd(Ji.RUNTIME),flags:[...qn(br(e.player)),"inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"],stats:["currenttick","boardid","isdark","notdark","startx","starty","over","under","camera","graphics","facing","exitnorth","exitsouth","exitwest","exiteast","timelimit","restartonzap","norestartonzap","maxplayershots","item","group","party","player","pushable","collision","breakable","ispushable","notpushable","iswalk","iswalking","iswalkable","isswim","isswimming","isswimable","issolid","isbullet","isbreakable","notbreakable","p1","p2","p3","p4","p5","p6","cycle","stepx","stepy","light","lightdir","sender","arg"],kinds:[...Ss(r,bt.OBJECT).map(i=>Ue(i)),...qn(hd)],altkinds:[...Ss(r,bt.TERRAIN),...Ss(r,bt.BOARD),...Ss(r,bt.PALETTE),...Ss(r,bt.CHARSET),...Ss(r,bt.LOADER)].map(i=>Ue(i)),colors:[...qn(Jo)],dirs:[...qn(bh).filter(i=>["cw","ccw","oop","rndp"].includes(i)===!1)],dirmods:["cw","ccw","oop","rndp",...qn(ld)],exprs:["aligned","alligned","contact","blocked","any","count","color","detect","rnd","abs","intceil","intfloor","intround","clamp","min","max","pick","pickwith","random","randomwith","run","runwith"]});break}case"books":e.player===t&&hi(Zt,e.player,async()=>{if(ue(e.data)){const[r,i]=e.data,s=await g$(r),o=s.map(a=>a.name);IP(s,i),xe(Zt,e.player,`loading ${o.join(", ")}`),du(Zt,e.player)}});break;case"search":MP(e.player)||du(Zt,e.player);break;case"logout":LP(e.player),delete rs[e.player],xe(Zt,t,`player ${e.player} logout`),du(Zt,e.player);break;case"login":Aw(e.player)?(rs[e.player]=0,xe(Zt,sr(),`login from ${e.player}`),Zt.replynext(e,"acklogin",!0)):qd(Zt,e.player);break;case"local":Aw(e.player)?(rs[e.player]=0,xe(Zt,sr(),`login from ${e.player}`)):qd(Zt,e.player);break;case"doot":rs[e.player]=0,eu[e.player]=eu[e.player]??0,eu[e.player]%32===0&&xe(Zt,e.player,`$whiteactive $blue${e.player}`),++eu[e.player];break;case"input":{if(e.player.includes("local")&&!vw(e.player)&&gx(Zt,e.player),!e.player.includes("local")||vw(e.player)){const r=br(e.player),[i=Sn.NONE,s=0]=e.data??[Sn.NONE,0];ue(r.inputqueue)||(r.inputqueue=[]),i!==Sn.NONE&&r.inputqueue.push([i,s])}break}case"codewatch":if(ue(e.data)){const[r,i]=e.data,s=Ka(r,i);k(Lo[s])||(Lo[s]=Xp(s,o=>{const[a,c]=i,l=Br(r),u=As(l,a);if(k(u))if(ai(u)===bt.BOARD&&k(c)){const f=Re(u),d=Cn(f,c);k(d)&&(d.code=o,Xf(dk(o),d))}else u.code=o,mU(u)})),Co[s]=Co[s]??new Set,Co[s].add(e.player)}break;case"coderelease":if(ue(e.data)){const[r,i]=e.data,[,s]=i,o=Ka(r,i);k(Co[o])&&(Co[o].delete(e.player),Co[o].size===0&&((n=Lo[o])==null||n.call(Lo),Lo[o]=void 0,yt(s)&&PP(s)))}break;case"halt":e.player===t&&ME(e.data)&&TP(e.data);break;case"tick":DP(AP());break;case"synthsend":if(yt(e.data)){const[r,i]=f$(e.data),s=ce($t.MAIN);Oo(r,i,void 0,ko(s))}break;case"second":{UP(rs);const r=Object.keys(rs);for(let i=0;i<r.length;++i)++rs[r[i]];for(let i=0;i<r.length;++i){const s=r[i];rs[s]>=j$&&e0(Zt,s)}++Xw>=z$&&(Xw=0,hi(Zt,e.player,async()=>{await qw(!0)}));break}case"copyjsonfile":if(e.player===t){const r=ce($t.MAIN);if(k(r)&&ue(e.data)){const[i]=e.data,s=As(r,i);k(s)&&nx(Zt,t,s,`${Ue(s)}.${Oi(s)}.json`)}}break;case"refscroll":{Rt(e.player,"stat refs"),Rt(e.player,Ke),Lt(e.player,"refscroll","char:",["charscroll","hk","a"," A ","next"]),Lt(e.player,"refscroll","color:",["colorscroll","hk","c"," C ","next"]),Lt(e.player,"refscroll","notes:",["notesscroll","hk","n"," N ","next"]);const r=Ye(e.player);r.scroll=Tn(e.player);break}case"fork":e.player===t&&hi(Zt,e.player,async()=>{await W$()});break;case"itchiopublish":hi(Zt,e.player,async()=>{if(e.player===t){const r=ce($t.MAIN);if(k(r)){const i=await G$();ex(Zt,e.player,r.name,i)}}});break;case"flush":e.player===t&&hi(Zt,e.player,async()=>{await qw()});break;case"cli":Ow(e.player,e.data);break;case"clirepeatlast":jP(e.player);break;case"restart":e.player===t&&($P(),n0(Zt,e.player));break;case"inspect":hi(Zt,e.player,async()=>{if(ue(e.data)){const[r,i]=e.data;await M$(e.player,r,i)}});break;case"loader":if(ue(e.data)){const[r,i,s,o]=e.data;switch(i){case"file":zw(e.player,o);break;case"json":if(/file:.*\.book.json/.test(s)){xe(Zt,e.player,`loading ${s}`);const a=JSON.parse(o.json);k(a.data)&&yt(a.exported)&&(Yl(a.data),xe(Zt,e.player,`loaded ${a.exported}`))}else if(/file:.*\..*\.codepage.json/.test(s)){xe(Zt,e.player,`loading ${s}`);const a=JSON.parse(o.json),c=ce($t.MAIN);k(c)&&k(a.data)&&yt(a.exported)&&(Qf(c,a.data),xe(Zt,e.player,`loaded ${a.exported}`))}else Pk(r,i,s,o,e.player);break;default:Pk(r,i,s,o,e.player);break}}break;default:{const{target:r,path:i}=Fn(e.target);switch(It(r)){case"refscroll":switch(i){case"charscroll":{Lt(e.player,"refscroll","char",["char","charedit"]);const s=Ye(e.player);s.scroll=Tn(e.player);break}case"colorscroll":{Lt(e.player,"refscroll","color",["color","coloredit"]);const s=Ye(e.player);s.scroll=Tn(e.player);break}case"notesscroll":{Rt(e.player,"duration             cdefgab - notes "),Rt(e.player,"y - 64th note        x - rest"),Rt(e.player,"t - 32nd note        "),Rt(e.player,"s - 16th note.       drums"),Rt(e.player,"i - eight note.      0 - tick"),Rt(e.player,"q - quarter note     1 - tweet"),Rt(e.player,"h - half note        2 - cowbell"),Rt(e.player,"w - whole note       p - clap"),Rt(e.player,"                     4 - high snare"),Rt(e.player,"mods                 5 - high woodblock"),Rt(e.player,"3 - triplet          6 - low snare"),Rt(e.player,". - time and a half  7 - low tom"),Rt(e.player,"# - sharp            8 - low woodblock"),Rt(e.player,"! - flat             9 - bass drum");const s=Ye(e.player);s.scroll=Tn(e.player);break}}break;case"batch":hi(Zt,e.player,async()=>{await F$(i,e.player)});break;case"remix":hi(Zt,e.player,async()=>{await $$(i,e.player)});break;case"empty":{const s=Fn(i);switch(s.target){case"copycoords":pu(Zt,sr(),s.path.split(",").join(" "));break}break}case"inspect":U$(i,e.player);break;case"touched":if(ue(e.data)){const[s,o,a]=e.data;Sw({...e,target:`${s}:${a}`,data:void 0,sender:o})}break;default:{const s=Fn(i);if(It(s.target)==="self"||!s.path)e.target=e.target.replace("self:",""),Sw(e);else{const o=ce($t.MAIN);Oo(s.target,s.path,void 0,ko(o))}break}}break}}},xP());function K$(){ZE(Zt)}const{forward:H$}=vx(e=>{Tx(e)&&postMessage(e)});onmessage=function(t){H$(t.data)},setTimeout(K$,100)})();

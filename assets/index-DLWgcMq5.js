var cte=Object.defineProperty;var lte=(t,e,n)=>e in t?cte(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Gn=(t,e,n)=>lte(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var xc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function J6(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Q6={exports:{}},_A={},Z6={exports:{}},di={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sT=Symbol.for("react.element"),ute=Symbol.for("react.portal"),dte=Symbol.for("react.fragment"),hte=Symbol.for("react.strict_mode"),fte=Symbol.for("react.profiler"),pte=Symbol.for("react.provider"),mte=Symbol.for("react.context"),gte=Symbol.for("react.forward_ref"),vte=Symbol.for("react.suspense"),_te=Symbol.for("react.memo"),yte=Symbol.for("react.lazy"),P4=Symbol.iterator;function bte(t){return t===null||typeof t!="object"?null:(t=P4&&t[P4]||t["@@iterator"],typeof t=="function"?t:null)}var e8={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},t8=Object.assign,n8={};function zE(t,e,n){this.props=t,this.context=e,this.refs=n8,this.updater=n||e8}zE.prototype.isReactComponent={};zE.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};zE.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function r8(){}r8.prototype=zE.prototype;function FU(t,e,n){this.props=t,this.context=e,this.refs=n8,this.updater=n||e8}var BU=FU.prototype=new r8;BU.constructor=FU;t8(BU,zE.prototype);BU.isPureReactComponent=!0;var D4=Array.isArray,i8=Object.prototype.hasOwnProperty,jU={current:null},s8={key:!0,ref:!0,__self:!0,__source:!0};function o8(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)i8.call(e,r)&&!s8.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:sT,type:t,key:s,ref:o,props:i,_owner:jU.current}}function Ete(t,e){return{$$typeof:sT,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function $U(t){return typeof t=="object"&&t!==null&&t.$$typeof===sT}function Ste(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var L4=/\/+/g;function Zk(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Ste(""+t.key):e.toString(36)}function YC(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case sT:case ute:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Zk(o,0):r,D4(i)?(n="",t!=null&&(n=t.replace(L4,"$&/")+"/"),YC(i,e,n,"",function(l){return l})):i!=null&&($U(i)&&(i=Ete(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(L4,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",D4(t))for(var a=0;a<t.length;a++){s=t[a];var c=r+Zk(s,a);o+=YC(s,e,n,c,i)}else if(c=bte(t),typeof c=="function")for(t=c.call(t),a=0;!(s=t.next()).done;)s=s.value,c=r+Zk(s,a++),o+=YC(s,e,n,c,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function kx(t,e,n){if(t==null)return t;var r=[],i=0;return YC(t,r,"","",function(s){return e.call(n,s,i++)}),r}function wte(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ol={current:null},XC={transition:null},Tte={ReactCurrentDispatcher:Ol,ReactCurrentBatchConfig:XC,ReactCurrentOwner:jU};function a8(){throw Error("act(...) is not supported in production builds of React.")}di.Children={map:kx,forEach:function(t,e,n){kx(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return kx(t,function(){e++}),e},toArray:function(t){return kx(t,function(e){return e})||[]},only:function(t){if(!$U(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};di.Component=zE;di.Fragment=dte;di.Profiler=fte;di.PureComponent=FU;di.StrictMode=hte;di.Suspense=vte;di.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tte;di.act=a8;di.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=t8({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=jU.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)i8.call(e,c)&&!s8.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:sT,type:t.type,key:i,ref:s,props:r,_owner:o}};di.createContext=function(t){return t={$$typeof:mte,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:pte,_context:t},t.Consumer=t};di.createElement=o8;di.createFactory=function(t){var e=o8.bind(null,t);return e.type=t,e};di.createRef=function(){return{current:null}};di.forwardRef=function(t){return{$$typeof:gte,render:t}};di.isValidElement=$U;di.lazy=function(t){return{$$typeof:yte,_payload:{_status:-1,_result:t},_init:wte}};di.memo=function(t,e){return{$$typeof:_te,type:t,compare:e===void 0?null:e}};di.startTransition=function(t){var e=XC.transition;XC.transition={};try{t()}finally{XC.transition=e}};di.unstable_act=a8;di.useCallback=function(t,e){return Ol.current.useCallback(t,e)};di.useContext=function(t){return Ol.current.useContext(t)};di.useDebugValue=function(){};di.useDeferredValue=function(t){return Ol.current.useDeferredValue(t)};di.useEffect=function(t,e){return Ol.current.useEffect(t,e)};di.useId=function(){return Ol.current.useId()};di.useImperativeHandle=function(t,e,n){return Ol.current.useImperativeHandle(t,e,n)};di.useInsertionEffect=function(t,e){return Ol.current.useInsertionEffect(t,e)};di.useLayoutEffect=function(t,e){return Ol.current.useLayoutEffect(t,e)};di.useMemo=function(t,e){return Ol.current.useMemo(t,e)};di.useReducer=function(t,e,n){return Ol.current.useReducer(t,e,n)};di.useRef=function(t){return Ol.current.useRef(t)};di.useState=function(t){return Ol.current.useState(t)};di.useSyncExternalStore=function(t,e,n){return Ol.current.useSyncExternalStore(t,e,n)};di.useTransition=function(){return Ol.current.useTransition()};di.version="18.3.1";Z6.exports=di;var ft=Z6.exports;const Ph=Yc(ft);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xte=ft,Cte=Symbol.for("react.element"),Rte=Symbol.for("react.fragment"),Ate=Object.prototype.hasOwnProperty,Mte=xte.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ite={key:!0,ref:!0,__self:!0,__source:!0};function c8(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)Ate.call(e,r)&&!Ite.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Cte,type:t,key:s,ref:o,props:i,_owner:Mte.current}}_A.Fragment=Rte;_A.jsx=c8;_A.jsxs=c8;Q6.exports=_A;var Ne=Q6.exports;function Ote(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var l8={exports:{}},jo=l8.exports={},qf,Wf;function bD(){throw new Error("setTimeout has not been defined")}function ED(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?qf=setTimeout:qf=bD}catch{qf=bD}try{typeof clearTimeout=="function"?Wf=clearTimeout:Wf=ED}catch{Wf=ED}})();function u8(t){if(qf===setTimeout)return setTimeout(t,0);if((qf===bD||!qf)&&setTimeout)return qf=setTimeout,setTimeout(t,0);try{return qf(t,0)}catch{try{return qf.call(null,t,0)}catch{return qf.call(this,t,0)}}}function kte(t){if(Wf===clearTimeout)return clearTimeout(t);if((Wf===ED||!Wf)&&clearTimeout)return Wf=clearTimeout,clearTimeout(t);try{return Wf(t)}catch{try{return Wf.call(null,t)}catch{return Wf.call(this,t)}}}var zm=[],Hb=!1,x0,JC=-1;function Nte(){!Hb||!x0||(Hb=!1,x0.length?zm=x0.concat(zm):JC=-1,zm.length&&d8())}function d8(){if(!Hb){var t=u8(Nte);Hb=!0;for(var e=zm.length;e;){for(x0=zm,zm=[];++JC<e;)x0&&x0[JC].run();JC=-1,e=zm.length}x0=null,Hb=!1,kte(t)}}jo.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];zm.push(new h8(t,e)),zm.length===1&&!Hb&&u8(d8)};function h8(t,e){this.fun=t,this.array=e}h8.prototype.run=function(){this.fun.apply(null,this.array)};jo.title="browser";jo.browser=!0;jo.env={};jo.argv=[];jo.version="";jo.versions={};function dg(){}jo.on=dg;jo.addListener=dg;jo.once=dg;jo.off=dg;jo.removeListener=dg;jo.removeAllListeners=dg;jo.emit=dg;jo.prependListener=dg;jo.prependOnceListener=dg;jo.listeners=function(t){return[]};jo.binding=function(t){throw new Error("process.binding is not supported")};jo.cwd=function(){return"/"};jo.chdir=function(t){throw new Error("process.chdir is not supported")};jo.umask=function(){return 0};var Pte=l8.exports;const Hn=Ote(Pte);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const yA="170",Dte=0,U4=1,Lte=2,Ute=0,HU=1,QC=2,zf=3,ng=0,ec=1,$u=2,Dh=0,Vb=1,F4=2,B4=3,j4=4,Fte=5,S0=100,Bte=101,jte=102,$te=103,Hte=104,Vte=200,zte=201,Gte=202,qte=203,SD=204,wD=205,Wte=206,Kte=207,Yte=208,Xte=209,Jte=210,Qte=211,Zte=212,ene=213,tne=214,TD=0,xD=1,CD=2,cE=3,RD=4,AD=5,MD=6,ID=7,f8=0,nne=1,rne=2,ap=0,ine=1,sne=2,one=3,p8=4,ane=5,cne=6,lne=7,m8=300,lE=301,uE=302,OD=303,kD=304,bA=306,ND=1e3,C0=1001,PD=1002,Bo=1003,une=1004,Nx=1005,Zl=1006,eN=1007,R0=1008,Gc=1009,g8=1010,v8=1011,fw=1012,VU=1013,s_=1014,sp=1015,GE=1016,zU=1017,GU=1018,H0=1020,_8=35902,y8=1021,b8=1022,Cd=1023,E8=1024,S8=1025,zb=1026,V0=1027,w8=1028,qU=1029,T8=1030,WU=1031,EA=1033,ZC=33776,e1=33777,t1=33778,n1=33779,DD=35840,LD=35841,UD=35842,FD=35843,BD=36196,jD=37492,$D=37496,HD=37808,VD=37809,zD=37810,GD=37811,qD=37812,WD=37813,KD=37814,YD=37815,XD=37816,JD=37817,QD=37818,ZD=37819,eL=37820,tL=37821,r1=36492,nL=36494,rL=36495,x8=36283,iL=36284,sL=36285,oL=36286,uy=3200,dne=3201,C8=0,hne=1,Zf="",Lo="srgb",S_="srgb-linear",SA="linear",es="srgb",Gy=7680,$4=519,fne=512,pne=513,mne=514,R8=515,gne=516,vne=517,_ne=518,yne=519,H4=35044,V4="300 es",Gm=2e3,W1=2001;class hg{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const Dc=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let z4=1234567;const JS=Math.PI/180,pw=180/Math.PI;function qE(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Dc[t&255]+Dc[t>>8&255]+Dc[t>>16&255]+Dc[t>>24&255]+"-"+Dc[e&255]+Dc[e>>8&255]+"-"+Dc[e>>16&15|64]+Dc[e>>24&255]+"-"+Dc[n&63|128]+Dc[n>>8&255]+"-"+Dc[n>>16&255]+Dc[n>>24&255]+Dc[r&255]+Dc[r>>8&255]+Dc[r>>16&255]+Dc[r>>24&255]).toLowerCase()}function xl(t,e,n){return Math.max(e,Math.min(n,t))}function KU(t,e){return(t%e+e)%e}function bne(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)}function Ene(t,e,n){return t!==e?(n-t)/(e-t):0}function QS(t,e,n){return(1-n)*t+n*e}function Sne(t,e,n,r){return QS(t,e,1-Math.exp(-n*r))}function wne(t,e=1){return e-Math.abs(KU(t,e*2)-e)}function Tne(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function xne(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function Cne(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Rne(t,e){return t+Math.random()*(e-t)}function Ane(t){return t*(.5-Math.random())}function Mne(t){t!==void 0&&(z4=t);let e=z4+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Ine(t){return t*JS}function One(t){return t*pw}function kne(t){return(t&t-1)===0&&t!==0}function Nne(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Pne(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Dne(t,e,n,r,i){const s=Math.cos,o=Math.sin,a=s(n/2),c=o(n/2),l=s((e+r)/2),u=o((e+r)/2),d=s((e-r)/2),h=o((e-r)/2),f=s((r-e)/2),p=o((r-e)/2);switch(i){case"XYX":t.set(a*u,c*d,c*h,a*l);break;case"YZY":t.set(c*h,a*u,c*d,a*l);break;case"ZXZ":t.set(c*d,c*h,a*u,a*l);break;case"XZX":t.set(a*u,c*p,c*f,a*l);break;case"YXY":t.set(c*f,a*u,c*p,a*l);break;case"ZYZ":t.set(c*p,c*f,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function yb(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function _l(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const Lne={DEG2RAD:JS,RAD2DEG:pw,generateUUID:qE,clamp:xl,euclideanModulo:KU,mapLinear:bne,inverseLerp:Ene,lerp:QS,damp:Sne,pingpong:wne,smoothstep:Tne,smootherstep:xne,randInt:Cne,randFloat:Rne,randFloatSpread:Ane,seededRandom:Mne,degToRad:Ine,radToDeg:One,isPowerOfTwo:kne,ceilPowerOfTwo:Nne,floorPowerOfTwo:Pne,setQuaternionFromProperEuler:Dne,normalize:_l,denormalize:yb};class Vn{constructor(e=0,n=0){Vn.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,i=e.elements;return this.x=i[0]*n+i[3]*r+i[6],this.y=i[1]*n+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(xl(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),i=Math.sin(n),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Kr{constructor(e,n,r,i,s,o,a,c,l){Kr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l)}set(e,n,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=n,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],d=r[7],h=r[2],f=r[5],p=r[8],g=i[0],v=i[3],E=i[6],T=i[1],C=i[4],A=i[7],k=i[2],I=i[5],N=i[8];return s[0]=o*g+a*T+c*k,s[3]=o*v+a*C+c*I,s[6]=o*E+a*A+c*N,s[1]=l*g+u*T+d*k,s[4]=l*v+u*C+d*I,s[7]=l*E+u*A+d*N,s[2]=h*g+f*T+p*k,s[5]=h*v+f*C+p*I,s[8]=h*E+f*A+p*N,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return n*o*u-n*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=u*o-a*l,h=a*c-u*s,f=l*s-o*c,p=n*d+r*h+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return e[0]=d*g,e[1]=(i*l-u*r)*g,e[2]=(a*r-i*o)*g,e[3]=h*g,e[4]=(u*n-i*c)*g,e[5]=(i*s-a*n)*g,e[6]=f*g,e[7]=(r*c-l*n)*g,e[8]=(o*n-r*s)*g,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+n,0,0,1),this}scale(e,n){return this.premultiply(tN.makeScale(e,n)),this}rotate(e){return this.premultiply(tN.makeRotation(-e)),this}translate(e,n){return this.premultiply(tN.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<9;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const tN=new Kr;function A8(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function mw(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Une(){const t=mw("canvas");return t.style.display="block",t}const G4={};function US(t){t in G4||(G4[t]=!0,console.warn(t))}function Fne(t,e,n){return new Promise(function(r,i){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:i();break;case t.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:r()}}setTimeout(s,n)})}function Bne(t){const e=t.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function jne(t){const e=t.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const ki={enabled:!0,workingColorSpace:S_,spaces:{},convert:function(t,e,n){return this.enabled===!1||e===n||!e||!n||(this.spaces[e].transfer===es&&(t.r=Ym(t.r),t.g=Ym(t.g),t.b=Ym(t.b)),this.spaces[e].primaries!==this.spaces[n].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===es&&(t.r=Gb(t.r),t.g=Gb(t.g),t.b=Gb(t.b))),t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return t===Zf?SA:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,n){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}};function Ym(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function Gb(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}const q4=[.64,.33,.3,.6,.15,.06],W4=[.2126,.7152,.0722],K4=[.3127,.329],Y4=new Kr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),X4=new Kr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ki.define({[S_]:{primaries:q4,whitePoint:K4,transfer:SA,toXYZ:Y4,fromXYZ:X4,luminanceCoefficients:W4,workingColorSpaceConfig:{unpackColorSpace:Lo},outputColorSpaceConfig:{drawingBufferColorSpace:Lo}},[Lo]:{primaries:q4,whitePoint:K4,transfer:es,toXYZ:Y4,fromXYZ:X4,luminanceCoefficients:W4,outputColorSpaceConfig:{drawingBufferColorSpace:Lo}}});let qy;class $ne{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{qy===void 0&&(qy=mw("canvas")),qy.width=e.width,qy.height=e.height;const r=qy.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=qy}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=mw("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=Ym(s[o]/255)*255;return r.putImageData(i,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(Ym(n[r]/255)*255):n[r]=Ym(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Hne=0,M8=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Hne++}),this.uuid=qE(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(nN(i[o].image)):s.push(nN(i[o]))}else s=nN(i);r.url=s}return n||(e.images[this.uuid]=r),r}};function nN(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?$ne.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Vne=0;class wo extends hg{constructor(e=wo.DEFAULT_IMAGE,n=wo.DEFAULT_MAPPING,r=C0,i=C0,s=Zl,o=R0,a=Cd,c=Gc,l=wo.DEFAULT_ANISOTROPY,u=Zf){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Vne++}),this.uuid=qE(),this.name="",this.source=new M8(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new Vn(0,0),this.repeat=new Vn(1,1),this.center=new Vn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Kr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==m8)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ND:e.x=e.x-Math.floor(e.x);break;case C0:e.x=e.x<0?0:1;break;case PD:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ND:e.y=e.y-Math.floor(e.y);break;case C0:e.y=e.y<0?0:1;break;case PD:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}wo.DEFAULT_IMAGE=null;wo.DEFAULT_MAPPING=m8;wo.DEFAULT_ANISOTROPY=1;class Fo{constructor(e=0,n=0,r=0,i=1){Fo.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,i){return this.x=e,this.y=n,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*n+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*n+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*n+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*n+o[7]*r+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,i,s;const c=e.elements,l=c[0],u=c[4],d=c[8],h=c[1],f=c[5],p=c[9],g=c[2],v=c[6],E=c[10];if(Math.abs(u-h)<.01&&Math.abs(d-g)<.01&&Math.abs(p-v)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+g)<.1&&Math.abs(p+v)<.1&&Math.abs(l+f+E-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const C=(l+1)/2,A=(f+1)/2,k=(E+1)/2,I=(u+h)/4,N=(d+g)/4,U=(p+v)/4;return C>A&&C>k?C<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(C),i=I/r,s=N/r):A>k?A<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(A),r=I/i,s=U/i):k<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(k),r=N/s,i=U/s),this.set(r,i,s,n),this}let T=Math.sqrt((v-p)*(v-p)+(d-g)*(d-g)+(h-u)*(h-u));return Math.abs(T)<.001&&(T=1),this.x=(v-p)/T,this.y=(d-g)/T,this.z=(h-u)/T,this.w=Math.acos((l+f+E-1)/2),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this.w=n[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class zne extends hg{constructor(e=1,n=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new Fo(0,0,e,n),this.scissorTest=!1,this.viewport=new Fo(0,0,e,n);const i={width:e,height:n,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Zl,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const s=new wo(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=n,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,i=e.textures.length;r<i;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new M8(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ku extends zne{constructor(e=1,n=1,r={}){super(e,n,r),this.isWebGLRenderTarget=!0}}class I8 extends wo{constructor(e=null,n=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=Bo,this.minFilter=Bo,this.wrapR=C0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Gne extends wo{constructor(e=null,n=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=Bo,this.minFilter=Bo,this.wrapR=C0,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class oT{constructor(e=0,n=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=i}static slerpFlat(e,n,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],d=r[i+3];const h=s[o+0],f=s[o+1],p=s[o+2],g=s[o+3];if(a===0){e[n+0]=c,e[n+1]=l,e[n+2]=u,e[n+3]=d;return}if(a===1){e[n+0]=h,e[n+1]=f,e[n+2]=p,e[n+3]=g;return}if(d!==g||c!==h||l!==f||u!==p){let v=1-a;const E=c*h+l*f+u*p+d*g,T=E>=0?1:-1,C=1-E*E;if(C>Number.EPSILON){const k=Math.sqrt(C),I=Math.atan2(k,E*T);v=Math.sin(v*I)/k,a=Math.sin(a*I)/k}const A=a*T;if(c=c*v+h*A,l=l*v+f*A,u=u*v+p*A,d=d*v+g*A,v===1-a){const k=1/Math.sqrt(c*c+l*l+u*u+d*d);c*=k,l*=k,u*=k,d*=k}}e[n]=c,e[n+1]=l,e[n+2]=u,e[n+3]=d}static multiplyQuaternionsFlat(e,n,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],d=s[o],h=s[o+1],f=s[o+2],p=s[o+3];return e[n]=a*p+u*d+c*f-l*h,e[n+1]=c*p+u*h+l*d-a*f,e[n+2]=l*p+u*f+a*h-c*d,e[n+3]=u*p-a*d-c*h-l*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,i){return this._x=e,this._y=n,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),d=a(s/2),h=c(r/2),f=c(i/2),p=c(s/2);switch(o){case"XYZ":this._x=h*u*d+l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d+h*f*p;break;case"YZX":this._x=h*u*d+l*f*p,this._y=l*f*d+h*u*p,this._z=l*u*p-h*f*d,this._w=l*u*d-h*f*p;break;case"XZY":this._x=h*u*d-l*f*p,this._y=l*f*d-h*u*p,this._z=l*u*p+h*f*d,this._w=l*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],i=n[4],s=n[8],o=n[1],a=n[5],c=n[9],l=n[2],u=n[6],d=n[10],h=r+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-c)*f,this._y=(s-l)*f,this._z=(o-i)*f}else if(r>a&&r>d){const f=2*Math.sqrt(1+r-a-d);this._w=(u-c)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(s+l)/f}else if(a>d){const f=2*Math.sqrt(1+a-r-d);this._w=(s-l)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(c+u)/f}else{const f=2*Math.sqrt(1+d-r-a);this._w=(o-i)/f,this._x=(s+l)/f,this._y=(c+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(xl(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,n/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,i=e._y,s=e._z,o=e._w,a=n._x,c=n._y,l=n._z,u=n._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const f=1-n;return this._w=f*o+n*this._w,this._x=f*r+n*this._x,this._y=f*i+n*this._y,this._z=f*s+n*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),d=Math.sin((1-n)*u)/l,h=Math.sin(n*u)/l;return this._w=o*d+this._w*h,this._x=r*d+this._x*h,this._y=i*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(n),s*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ht{constructor(e=0,n=0,r=0){ht.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(J4.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(J4.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[3]*r+s[6]*i,this.y=s[1]*n+s[4]*r+s[7]*i,this.z=s[2]*n+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*n+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*n+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*n+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*n+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const n=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*i-a*r),u=2*(a*n-s*i),d=2*(s*r-o*n);return this.x=n+c*l+o*d-a*u,this.y=r+c*u+a*l-s*d,this.z=i+c*d+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*n+s[4]*r+s[8]*i,this.y=s[1]*n+s[5]*r+s[9]*i,this.z=s[2]*n+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,i=e.y,s=e.z,o=n.x,a=n.y,c=n.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return rN.copy(this).projectOnVector(e),this.sub(rN)}reflect(e){return this.sub(rN.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(xl(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return n*n+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const i=Math.sin(n)*e;return this.x=i*Math.sin(r),this.y=Math.cos(n)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=i,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const rN=new ht,J4=new oT;class aT{constructor(e=new ht(1/0,1/0,1/0),n=new ht(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(mh.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(mh.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=mh.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(n===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,mh):mh.fromBufferAttribute(s,o),mh.applyMatrix4(e.matrixWorld),this.expandByPoint(mh);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Px.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Px.copy(r.boundingBox)),Px.applyMatrix4(e.matrixWorld),this.union(Px)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],n);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,mh),mh.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(fS),Dx.subVectors(this.max,fS),Wy.subVectors(e.a,fS),Ky.subVectors(e.b,fS),Yy.subVectors(e.c,fS),cv.subVectors(Ky,Wy),lv.subVectors(Yy,Ky),t0.subVectors(Wy,Yy);let n=[0,-cv.z,cv.y,0,-lv.z,lv.y,0,-t0.z,t0.y,cv.z,0,-cv.x,lv.z,0,-lv.x,t0.z,0,-t0.x,-cv.y,cv.x,0,-lv.y,lv.x,0,-t0.y,t0.x,0];return!iN(n,Wy,Ky,Yy,Dx)||(n=[1,0,0,0,1,0,0,0,1],!iN(n,Wy,Ky,Yy,Dx))?!1:(Lx.crossVectors(cv,lv),n=[Lx.x,Lx.y,Lx.z],iN(n,Wy,Ky,Yy,Dx))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,mh).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(mh).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Tm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Tm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Tm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Tm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Tm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Tm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Tm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Tm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Tm),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Tm=[new ht,new ht,new ht,new ht,new ht,new ht,new ht,new ht],mh=new ht,Px=new aT,Wy=new ht,Ky=new ht,Yy=new ht,cv=new ht,lv=new ht,t0=new ht,fS=new ht,Dx=new ht,Lx=new ht,n0=new ht;function iN(t,e,n,r,i){for(let s=0,o=t.length-3;s<=o;s+=3){n0.fromArray(t,s);const a=i.x*Math.abs(n0.x)+i.y*Math.abs(n0.y)+i.z*Math.abs(n0.z),c=e.dot(n0),l=n.dot(n0),u=r.dot(n0);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const qne=new aT,pS=new ht,sN=new ht;class wA{constructor(e=new ht,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):qne.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;pS.subVectors(e,this.center);const n=pS.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),i=(r-this.radius)*.5;this.center.addScaledVector(pS,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(sN.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(pS.copy(e.center).add(sN)),this.expandByPoint(pS.copy(e.center).sub(sN))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const xm=new ht,oN=new ht,Ux=new ht,uv=new ht,aN=new ht,Fx=new ht,cN=new ht;class YU{constructor(e=new ht,n=new ht(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,xm)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=xm.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(xm.copy(this.origin).addScaledVector(this.direction,n),xm.distanceToSquared(e))}distanceSqToSegment(e,n,r,i){oN.copy(e).add(n).multiplyScalar(.5),Ux.copy(n).sub(e).normalize(),uv.copy(this.origin).sub(oN);const s=e.distanceTo(n)*.5,o=-this.direction.dot(Ux),a=uv.dot(this.direction),c=-uv.dot(Ux),l=uv.lengthSq(),u=Math.abs(1-o*o);let d,h,f,p;if(u>0)if(d=o*c-a,h=o*a-c,p=s*u,d>=0)if(h>=-p)if(h<=p){const g=1/u;d*=g,h*=g,f=d*(d+o*h+2*a)+h*(o*d+h+2*c)+l}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;else h<=-p?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-c),s),f=-d*d+h*(h+2*c)+l):h<=p?(d=0,h=Math.min(Math.max(-s,-c),s),f=h*(h+2*c)+l):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-c),s),f=-d*d+h*(h+2*c)+l);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,d),i&&i.copy(oN).addScaledVector(Ux,h),f}intersectSphere(e,n){xm.subVectors(e.center,this.origin);const r=xm.dot(this.direction),i=xm.dot(xm)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:a<0?this.at(c,n):this.at(a,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return l>=0?(r=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(r=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),d>=0?(a=(e.min.z-h.z)*d,c=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,c=(e.min.z-h.z)*d),r>c||a>i)||((a>r||r!==r)&&(r=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,n)}intersectsBox(e){return this.intersectBox(e,xm)!==null}intersectTriangle(e,n,r,i,s){aN.subVectors(n,e),Fx.subVectors(r,e),cN.crossVectors(aN,Fx);let o=this.direction.dot(cN),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;uv.subVectors(this.origin,e);const c=a*this.direction.dot(Fx.crossVectors(uv,Fx));if(c<0)return null;const l=a*this.direction.dot(aN.cross(uv));if(l<0||c+l>o)return null;const u=-a*uv.dot(cN);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class To{constructor(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,v){To.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,v)}set(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,v){const E=this.elements;return E[0]=e,E[4]=n,E[8]=r,E[12]=i,E[1]=s,E[5]=o,E[9]=a,E[13]=c,E[2]=l,E[6]=u,E[10]=d,E[14]=h,E[3]=f,E[7]=p,E[11]=g,E[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new To().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,i=1/Xy.setFromMatrixColumn(e,0).length(),s=1/Xy.setFromMatrixColumn(e,1).length(),o=1/Xy.setFromMatrixColumn(e,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const h=o*u,f=o*d,p=a*u,g=a*d;n[0]=c*u,n[4]=-c*d,n[8]=l,n[1]=f+p*l,n[5]=h-g*l,n[9]=-a*c,n[2]=g-h*l,n[6]=p+f*l,n[10]=o*c}else if(e.order==="YXZ"){const h=c*u,f=c*d,p=l*u,g=l*d;n[0]=h+g*a,n[4]=p*a-f,n[8]=o*l,n[1]=o*d,n[5]=o*u,n[9]=-a,n[2]=f*a-p,n[6]=g+h*a,n[10]=o*c}else if(e.order==="ZXY"){const h=c*u,f=c*d,p=l*u,g=l*d;n[0]=h-g*a,n[4]=-o*d,n[8]=p+f*a,n[1]=f+p*a,n[5]=o*u,n[9]=g-h*a,n[2]=-o*l,n[6]=a,n[10]=o*c}else if(e.order==="ZYX"){const h=o*u,f=o*d,p=a*u,g=a*d;n[0]=c*u,n[4]=p*l-f,n[8]=h*l+g,n[1]=c*d,n[5]=g*l+h,n[9]=f*l-p,n[2]=-l,n[6]=a*c,n[10]=o*c}else if(e.order==="YZX"){const h=o*c,f=o*l,p=a*c,g=a*l;n[0]=c*u,n[4]=g-h*d,n[8]=p*d+f,n[1]=d,n[5]=o*u,n[9]=-a*u,n[2]=-l*u,n[6]=f*d+p,n[10]=h-g*d}else if(e.order==="XZY"){const h=o*c,f=o*l,p=a*c,g=a*l;n[0]=c*u,n[4]=-d,n[8]=l*u,n[1]=h*d+g,n[5]=o*u,n[9]=f*d-p,n[2]=p*d-f,n[6]=a*u,n[10]=g*d+h}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Wne,e,Kne)}lookAt(e,n,r){const i=this.elements;return ku.subVectors(e,n),ku.lengthSq()===0&&(ku.z=1),ku.normalize(),dv.crossVectors(r,ku),dv.lengthSq()===0&&(Math.abs(r.z)===1?ku.x+=1e-4:ku.z+=1e-4,ku.normalize(),dv.crossVectors(r,ku)),dv.normalize(),Bx.crossVectors(ku,dv),i[0]=dv.x,i[4]=Bx.x,i[8]=ku.x,i[1]=dv.y,i[5]=Bx.y,i[9]=ku.y,i[2]=dv.z,i[6]=Bx.z,i[10]=ku.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,i=n.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],d=r[5],h=r[9],f=r[13],p=r[2],g=r[6],v=r[10],E=r[14],T=r[3],C=r[7],A=r[11],k=r[15],I=i[0],N=i[4],U=i[8],F=i[12],$=i[1],X=i[5],q=i[9],W=i[13],K=i[2],ne=i[6],Q=i[10],ie=i[14],G=i[3],Z=i[7],se=i[11],ue=i[15];return s[0]=o*I+a*$+c*K+l*G,s[4]=o*N+a*X+c*ne+l*Z,s[8]=o*U+a*q+c*Q+l*se,s[12]=o*F+a*W+c*ie+l*ue,s[1]=u*I+d*$+h*K+f*G,s[5]=u*N+d*X+h*ne+f*Z,s[9]=u*U+d*q+h*Q+f*se,s[13]=u*F+d*W+h*ie+f*ue,s[2]=p*I+g*$+v*K+E*G,s[6]=p*N+g*X+v*ne+E*Z,s[10]=p*U+g*q+v*Q+E*se,s[14]=p*F+g*W+v*ie+E*ue,s[3]=T*I+C*$+A*K+k*G,s[7]=T*N+C*X+A*ne+k*Z,s[11]=T*U+C*q+A*Q+k*se,s[15]=T*F+C*W+A*ie+k*ue,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],d=e[6],h=e[10],f=e[14],p=e[3],g=e[7],v=e[11],E=e[15];return p*(+s*c*d-i*l*d-s*a*h+r*l*h+i*a*f-r*c*f)+g*(+n*c*f-n*l*h+s*o*h-i*o*f+i*l*u-s*c*u)+v*(+n*l*d-n*a*f-s*o*d+r*o*f+s*a*u-r*l*u)+E*(-i*a*u-n*c*d+n*a*h+i*o*d-r*o*h+r*c*u)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=n,i[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],g=e[13],v=e[14],E=e[15],T=d*v*l-g*h*l+g*c*f-a*v*f-d*c*E+a*h*E,C=p*h*l-u*v*l-p*c*f+o*v*f+u*c*E-o*h*E,A=u*g*l-p*d*l+p*a*f-o*g*f-u*a*E+o*d*E,k=p*d*c-u*g*c-p*a*h+o*g*h+u*a*v-o*d*v,I=n*T+r*C+i*A+s*k;if(I===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const N=1/I;return e[0]=T*N,e[1]=(g*h*s-d*v*s-g*i*f+r*v*f+d*i*E-r*h*E)*N,e[2]=(a*v*s-g*c*s+g*i*l-r*v*l-a*i*E+r*c*E)*N,e[3]=(d*c*s-a*h*s-d*i*l+r*h*l+a*i*f-r*c*f)*N,e[4]=C*N,e[5]=(u*v*s-p*h*s+p*i*f-n*v*f-u*i*E+n*h*E)*N,e[6]=(p*c*s-o*v*s-p*i*l+n*v*l+o*i*E-n*c*E)*N,e[7]=(o*h*s-u*c*s+u*i*l-n*h*l-o*i*f+n*c*f)*N,e[8]=A*N,e[9]=(p*d*s-u*g*s-p*r*f+n*g*f+u*r*E-n*d*E)*N,e[10]=(o*g*s-p*a*s+p*r*l-n*g*l-o*r*E+n*a*E)*N,e[11]=(u*a*s-o*d*s-u*r*l+n*d*l+o*r*f-n*a*f)*N,e[12]=k*N,e[13]=(u*g*i-p*d*i+p*r*h-n*g*h-u*r*v+n*d*v)*N,e[14]=(p*a*i-o*g*i-p*r*c+n*g*c+o*r*v-n*a*v)*N,e[15]=(o*d*i-u*a*i+u*r*c-n*d*c-o*r*h+n*a*h)*N,this}scale(e){const n=this.elements,r=e.x,i=e.y,s=e.z;return n[0]*=r,n[4]*=i,n[8]*=s,n[1]*=r,n[5]*=i,n[9]*=s,n[2]*=r,n[6]*=i,n[10]*=s,n[3]*=r,n[7]*=i,n[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,i))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),i=Math.sin(n),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,n,i,1,0,0,0,0,1),this}compose(e,n,r){const i=this.elements,s=n._x,o=n._y,a=n._z,c=n._w,l=s+s,u=o+o,d=a+a,h=s*l,f=s*u,p=s*d,g=o*u,v=o*d,E=a*d,T=c*l,C=c*u,A=c*d,k=r.x,I=r.y,N=r.z;return i[0]=(1-(g+E))*k,i[1]=(f+A)*k,i[2]=(p-C)*k,i[3]=0,i[4]=(f-A)*I,i[5]=(1-(h+E))*I,i[6]=(v+T)*I,i[7]=0,i[8]=(p+C)*N,i[9]=(v-T)*N,i[10]=(1-(h+g))*N,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,n,r){const i=this.elements;let s=Xy.set(i[0],i[1],i[2]).length();const o=Xy.set(i[4],i[5],i[6]).length(),a=Xy.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],gh.copy(this);const l=1/s,u=1/o,d=1/a;return gh.elements[0]*=l,gh.elements[1]*=l,gh.elements[2]*=l,gh.elements[4]*=u,gh.elements[5]*=u,gh.elements[6]*=u,gh.elements[8]*=d,gh.elements[9]*=d,gh.elements[10]*=d,n.setFromRotationMatrix(gh),r.x=s,r.y=o,r.z=a,this}makePerspective(e,n,r,i,s,o,a=Gm){const c=this.elements,l=2*s/(n-e),u=2*s/(r-i),d=(n+e)/(n-e),h=(r+i)/(r-i);let f,p;if(a===Gm)f=-(o+s)/(o-s),p=-2*o*s/(o-s);else if(a===W1)f=-o/(o-s),p=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=u,c[9]=h,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,n,r,i,s,o,a=Gm){const c=this.elements,l=1/(n-e),u=1/(r-i),d=1/(o-s),h=(n+e)*l,f=(r+i)*u;let p,g;if(a===Gm)p=(o+s)*d,g=-2*d;else if(a===W1)p=s*d,g=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-h,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=g,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let i=0;i<16;i++)if(n[i]!==r[i])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const Xy=new ht,gh=new To,Wne=new ht(0,0,0),Kne=new ht(1,1,1),dv=new ht,Bx=new ht,ku=new ht,Q4=new To,Z4=new oT;class rg{constructor(e=0,n=0,r=0,i=rg.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,i=this._order){return this._x=e,this._y=n,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],d=i[2],h=i[6],f=i[10];switch(n){case"XYZ":this._y=Math.asin(xl(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-xl(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(xl(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-xl(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(xl(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-xl(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return Q4.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Q4,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return Z4.setFromEuler(this),this.setFromQuaternion(Z4,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}rg.DEFAULT_ORDER="XYZ";class qb{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Yne=0;const ej=new ht,Jy=new oT,Cm=new To,jx=new ht,mS=new ht,Xne=new ht,Jne=new oT,tj=new ht(1,0,0),nj=new ht(0,1,0),rj=new ht(0,0,1),ij={type:"added"},Qne={type:"removed"},Qy={type:"childadded",child:null},lN={type:"childremoved",child:null};class iu extends hg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Yne++}),this.uuid=qE(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=iu.DEFAULT_UP.clone();const e=new ht,n=new rg,r=new oT,i=new ht(1,1,1);function s(){r.setFromEuler(n,!1)}function o(){n.setFromQuaternion(r,void 0,!1)}n._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new To},normalMatrix:{value:new Kr}}),this.matrix=new To,this.matrixWorld=new To,this.matrixAutoUpdate=iu.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=iu.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new qb,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return Jy.setFromAxisAngle(e,n),this.quaternion.multiply(Jy),this}rotateOnWorldAxis(e,n){return Jy.setFromAxisAngle(e,n),this.quaternion.premultiply(Jy),this}rotateX(e){return this.rotateOnAxis(tj,e)}rotateY(e){return this.rotateOnAxis(nj,e)}rotateZ(e){return this.rotateOnAxis(rj,e)}translateOnAxis(e,n){return ej.copy(e).applyQuaternion(this.quaternion),this.position.add(ej.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(tj,e)}translateY(e){return this.translateOnAxis(nj,e)}translateZ(e){return this.translateOnAxis(rj,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Cm.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?jx.copy(e):jx.set(e,n,r);const i=this.parent;this.updateWorldMatrix(!0,!1),mS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Cm.lookAt(mS,jx,this.up):Cm.lookAt(jx,mS,this.up),this.quaternion.setFromRotationMatrix(Cm),i&&(Cm.extractRotation(i.matrixWorld),Jy.setFromRotationMatrix(Cm),this.quaternion.premultiply(Jy.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(ij),Qy.child=e,this.dispatchEvent(Qy),Qy.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Qne),lN.child=e,this.dispatchEvent(lN),lN.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Cm.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Cm.multiply(e.parent.matrixWorld)),e.applyMatrix4(Cm),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(ij),Qy.child=e,this.dispatchEvent(Qy),Qy.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,n);if(o!==void 0)return o}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mS,e,Xne),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mS,Jne,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,i=n.length;r<i;r++)n[r].updateMatrixWorld(e)}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const d=c[l];s(e.shapes,d)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(e.materials,this.material[c]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(e.animations,c))}}if(n){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),d=o(e.shapes),h=o(e.skeletons),f=o(e.animations),p=o(e.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),d.length>0&&(r.shapes=d),h.length>0&&(r.skeletons=h),f.length>0&&(r.animations=f),p.length>0&&(r.nodes=p)}return r.object=i,r;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}iu.DEFAULT_UP=new ht(0,1,0);iu.DEFAULT_MATRIX_AUTO_UPDATE=!0;iu.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vh=new ht,Rm=new ht,uN=new ht,Am=new ht,Zy=new ht,eb=new ht,sj=new ht,dN=new ht,hN=new ht,fN=new ht,pN=new Fo,mN=new Fo,gN=new Fo;class Rh{constructor(e=new ht,n=new ht,r=new ht){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,i){i.subVectors(r,n),vh.subVectors(e,n),i.cross(vh);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,n,r,i,s){vh.subVectors(i,n),Rm.subVectors(r,n),uN.subVectors(e,n);const o=vh.dot(vh),a=vh.dot(Rm),c=vh.dot(uN),l=Rm.dot(Rm),u=Rm.dot(uN),d=o*l-a*a;if(d===0)return s.set(0,0,0),null;const h=1/d,f=(l*c-a*u)*h,p=(o*u-a*c)*h;return s.set(1-f-p,p,f)}static containsPoint(e,n,r,i){return this.getBarycoord(e,n,r,i,Am)===null?!1:Am.x>=0&&Am.y>=0&&Am.x+Am.y<=1}static getInterpolation(e,n,r,i,s,o,a,c){return this.getBarycoord(e,n,r,i,Am)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,Am.x),c.addScaledVector(o,Am.y),c.addScaledVector(a,Am.z),c)}static getInterpolatedAttribute(e,n,r,i,s,o){return pN.setScalar(0),mN.setScalar(0),gN.setScalar(0),pN.fromBufferAttribute(e,n),mN.fromBufferAttribute(e,r),gN.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(pN,s.x),o.addScaledVector(mN,s.y),o.addScaledVector(gN,s.z),o}static isFrontFacing(e,n,r,i){return vh.subVectors(r,n),Rm.subVectors(e,n),vh.cross(Rm).dot(i)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,i){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,n,r,i){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vh.subVectors(this.c,this.b),Rm.subVectors(this.a,this.b),vh.cross(Rm).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Rh.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Rh.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,i,s){return Rh.getInterpolation(e,this.a,this.b,this.c,n,r,i,s)}containsPoint(e){return Rh.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Rh.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,i=this.b,s=this.c;let o,a;Zy.subVectors(i,r),eb.subVectors(s,r),dN.subVectors(e,r);const c=Zy.dot(dN),l=eb.dot(dN);if(c<=0&&l<=0)return n.copy(r);hN.subVectors(e,i);const u=Zy.dot(hN),d=eb.dot(hN);if(u>=0&&d<=u)return n.copy(i);const h=c*d-u*l;if(h<=0&&c>=0&&u<=0)return o=c/(c-u),n.copy(r).addScaledVector(Zy,o);fN.subVectors(e,s);const f=Zy.dot(fN),p=eb.dot(fN);if(p>=0&&f<=p)return n.copy(s);const g=f*l-c*p;if(g<=0&&l>=0&&p<=0)return a=l/(l-p),n.copy(r).addScaledVector(eb,a);const v=u*p-f*d;if(v<=0&&d-u>=0&&f-p>=0)return sj.subVectors(s,i),a=(d-u)/(d-u+(f-p)),n.copy(i).addScaledVector(sj,a);const E=1/(v+g+h);return o=g*E,a=h*E,n.copy(r).addScaledVector(Zy,o).addScaledVector(eb,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const O8={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},hv={h:0,s:0,l:0},$x={h:0,s:0,l:0};function vN(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}class bi{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Lo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ki.toWorkingColorSpace(this,n),this}setRGB(e,n,r,i=ki.workingColorSpace){return this.r=e,this.g=n,this.b=r,ki.toWorkingColorSpace(this,i),this}setHSL(e,n,r,i=ki.workingColorSpace){if(e=KU(e,1),n=xl(n,0,1),r=xl(r,0,1),n===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s;this.r=vN(o,s,e+1/3),this.g=vN(o,s,e),this.b=vN(o,s,e-1/3)}return ki.toWorkingColorSpace(this,i),this}setStyle(e,n=Lo){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,n);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,n);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,n);if(o===6)return this.setHex(parseInt(s,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Lo){const r=O8[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ym(e.r),this.g=Ym(e.g),this.b=Ym(e.b),this}copyLinearToSRGB(e){return this.r=Gb(e.r),this.g=Gb(e.g),this.b=Gb(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Lo){return ki.fromWorkingColorSpace(Lc.copy(this),e),Math.round(xl(Lc.r*255,0,255))*65536+Math.round(xl(Lc.g*255,0,255))*256+Math.round(xl(Lc.b*255,0,255))}getHexString(e=Lo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=ki.workingColorSpace){ki.fromWorkingColorSpace(Lc.copy(this),n);const r=Lc.r,i=Lc.g,s=Lc.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const d=o-a;switch(l=u<=.5?d/(o+a):d/(2-o-a),o){case r:c=(i-s)/d+(i<s?6:0);break;case i:c=(s-r)/d+2;break;case s:c=(r-i)/d+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,n=ki.workingColorSpace){return ki.fromWorkingColorSpace(Lc.copy(this),n),e.r=Lc.r,e.g=Lc.g,e.b=Lc.b,e}getStyle(e=Lo){ki.fromWorkingColorSpace(Lc.copy(this),e);const n=Lc.r,r=Lc.g,i=Lc.b;return e!==Lo?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,n,r){return this.getHSL(hv),this.setHSL(hv.h+e,hv.s+n,hv.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(hv),e.getHSL($x);const r=QS(hv.h,$x.h,n),i=QS(hv.s,$x.s,n),s=QS(hv.l,$x.l,n);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*n+s[3]*r+s[6]*i,this.g=s[1]*n+s[4]*r+s[7]*i,this.b=s[2]*n+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Lc=new bi;bi.NAMES=O8;let Zne=0;class fg extends hg{static get type(){return"Material"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Zne++}),this.uuid=qE(),this.name="",this.blending=Vb,this.side=ng,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SD,this.blendDst=wD,this.blendEquation=S0,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new bi(0,0,0),this.blendAlpha=0,this.depthFunc=cE,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=$4,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Gy,this.stencilZFail=Gy,this.stencilZPass=Gy,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const i=this[n];if(i===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Vb&&(r.blending=this.blending),this.side!==ng&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==SD&&(r.blendSrc=this.blendSrc),this.blendDst!==wD&&(r.blendDst=this.blendDst),this.blendEquation!==S0&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==cE&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==$4&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Gy&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Gy&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Gy&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(n){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const i=n.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=n[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class XU extends fg{static get type(){return"MeshBasicMaterial"}constructor(e){super(),this.isMeshBasicMaterial=!0,this.color=new bi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new rg,this.combine=f8,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ta=new ht,Hx=new Vn;class oo{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=H4,this.updateRanges=[],this.gpuType=sp,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=n.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)Hx.fromBufferAttribute(this,n),Hx.applyMatrix3(e),this.setXY(n,Hx.x,Hx.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)ta.fromBufferAttribute(this,n),ta.applyMatrix3(e),this.setXYZ(n,ta.x,ta.y,ta.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)ta.fromBufferAttribute(this,n),ta.applyMatrix4(e),this.setXYZ(n,ta.x,ta.y,ta.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)ta.fromBufferAttribute(this,n),ta.applyNormalMatrix(e),this.setXYZ(n,ta.x,ta.y,ta.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)ta.fromBufferAttribute(this,n),ta.transformDirection(e),this.setXYZ(n,ta.x,ta.y,ta.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=yb(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=_l(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=yb(n,this.array)),n}setX(e,n){return this.normalized&&(n=_l(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=yb(n,this.array)),n}setY(e,n){return this.normalized&&(n=_l(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=yb(n,this.array)),n}setZ(e,n){return this.normalized&&(n=_l(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=yb(n,this.array)),n}setW(e,n){return this.normalized&&(n=_l(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=_l(n,this.array),r=_l(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,i){return e*=this.itemSize,this.normalized&&(n=_l(n,this.array),r=_l(r,this.array),i=_l(i,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,n,r,i,s){return e*=this.itemSize,this.normalized&&(n=_l(n,this.array),r=_l(r,this.array),i=_l(i,this.array),s=_l(s,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==H4&&(e.usage=this.usage),e}}class k8 extends oo{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class N8 extends oo{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class N0 extends oo{constructor(e,n,r){super(new Float32Array(e),n,r)}}let ere=0;const vd=new To,_N=new iu,tb=new ht,Nu=new aT,gS=new aT,Ka=new ht;class qh extends hg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ere++}),this.uuid=qE(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(A8(e)?N8:k8)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new Kr().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return vd.makeRotationFromQuaternion(e),this.applyMatrix4(vd),this}rotateX(e){return vd.makeRotationX(e),this.applyMatrix4(vd),this}rotateY(e){return vd.makeRotationY(e),this.applyMatrix4(vd),this}rotateZ(e){return vd.makeRotationZ(e),this.applyMatrix4(vd),this}translate(e,n,r){return vd.makeTranslation(e,n,r),this.applyMatrix4(vd),this}scale(e,n,r){return vd.makeScale(e,n,r),this.applyMatrix4(vd),this}lookAt(e){return _N.lookAt(e),_N.updateMatrix(),this.applyMatrix4(_N.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tb).negate(),this.translate(tb.x,tb.y,tb.z),this}setFromPoints(e){const n=this.getAttribute("position");if(n===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];r.push(o.x,o.y,o.z||0)}this.setAttribute("position",new N0(r,3))}else{for(let r=0,i=n.count;r<i;r++){const s=e[r];n.setXYZ(r,s.x,s.y,s.z||0)}e.length>n.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),n.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new aT);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ht(-1/0,-1/0,-1/0),new ht(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,i=n.length;r<i;r++){const s=n[r];Nu.setFromBufferAttribute(s),this.morphTargetsRelative?(Ka.addVectors(this.boundingBox.min,Nu.min),this.boundingBox.expandByPoint(Ka),Ka.addVectors(this.boundingBox.max,Nu.max),this.boundingBox.expandByPoint(Ka)):(this.boundingBox.expandByPoint(Nu.min),this.boundingBox.expandByPoint(Nu.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new wA);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ht,1/0);return}if(e){const r=this.boundingSphere.center;if(Nu.setFromBufferAttribute(e),n)for(let s=0,o=n.length;s<o;s++){const a=n[s];gS.setFromBufferAttribute(a),this.morphTargetsRelative?(Ka.addVectors(Nu.min,gS.min),Nu.expandByPoint(Ka),Ka.addVectors(Nu.max,gS.max),Nu.expandByPoint(Ka)):(Nu.expandByPoint(gS.min),Nu.expandByPoint(gS.max))}Nu.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)Ka.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Ka));if(n)for(let s=0,o=n.length;s<o;s++){const a=n[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Ka.fromBufferAttribute(a,l),c&&(tb.fromBufferAttribute(e,l),Ka.add(tb)),i=Math.max(i,r.distanceToSquared(Ka))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,i=n.normal,s=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new oo(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let U=0;U<r.count;U++)a[U]=new ht,c[U]=new ht;const l=new ht,u=new ht,d=new ht,h=new Vn,f=new Vn,p=new Vn,g=new ht,v=new ht;function E(U,F,$){l.fromBufferAttribute(r,U),u.fromBufferAttribute(r,F),d.fromBufferAttribute(r,$),h.fromBufferAttribute(s,U),f.fromBufferAttribute(s,F),p.fromBufferAttribute(s,$),u.sub(l),d.sub(l),f.sub(h),p.sub(h);const X=1/(f.x*p.y-p.x*f.y);isFinite(X)&&(g.copy(u).multiplyScalar(p.y).addScaledVector(d,-f.y).multiplyScalar(X),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-p.x).multiplyScalar(X),a[U].add(g),a[F].add(g),a[$].add(g),c[U].add(v),c[F].add(v),c[$].add(v))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let U=0,F=T.length;U<F;++U){const $=T[U],X=$.start,q=$.count;for(let W=X,K=X+q;W<K;W+=3)E(e.getX(W+0),e.getX(W+1),e.getX(W+2))}const C=new ht,A=new ht,k=new ht,I=new ht;function N(U){k.fromBufferAttribute(i,U),I.copy(k);const F=a[U];C.copy(F),C.sub(k.multiplyScalar(k.dot(F))).normalize(),A.crossVectors(I,F);const X=A.dot(c[U])<0?-1:1;o.setXYZW(U,C.x,C.y,C.z,X)}for(let U=0,F=T.length;U<F;++U){const $=T[U],X=$.start,q=$.count;for(let W=X,K=X+q;W<K;W+=3)N(e.getX(W+0)),N(e.getX(W+1)),N(e.getX(W+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new oo(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let h=0,f=r.count;h<f;h++)r.setXYZ(h,0,0,0);const i=new ht,s=new ht,o=new ht,a=new ht,c=new ht,l=new ht,u=new ht,d=new ht;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),g=e.getX(h+1),v=e.getX(h+2);i.fromBufferAttribute(n,p),s.fromBufferAttribute(n,g),o.fromBufferAttribute(n,v),u.subVectors(o,s),d.subVectors(i,s),u.cross(d),a.fromBufferAttribute(r,p),c.fromBufferAttribute(r,g),l.fromBufferAttribute(r,v),a.add(u),c.add(u),l.add(u),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(g,c.x,c.y,c.z),r.setXYZ(v,l.x,l.y,l.z)}else for(let h=0,f=n.count;h<f;h+=3)i.fromBufferAttribute(n,h+0),s.fromBufferAttribute(n,h+1),o.fromBufferAttribute(n,h+2),u.subVectors(o,s),d.subVectors(i,s),u.cross(d),r.setXYZ(h+0,u.x,u.y,u.z),r.setXYZ(h+1,u.x,u.y,u.z),r.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)Ka.fromBufferAttribute(e,n),Ka.normalize(),e.setXYZ(n,Ka.x,Ka.y,Ka.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,d=a.normalized,h=new l.constructor(c.length*u);let f=0,p=0;for(let g=0,v=c.length;g<v;g++){a.isInterleavedBufferAttribute?f=c[g]*a.data.stride+a.offset:f=c[g]*u;for(let E=0;E<u;E++)h[p++]=l[f++]}return new oo(h,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new qh,r=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=e(c,r);n.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,d=l.length;u<d;u++){const h=l[u],f=e(h,r);c.push(f)}n.morphAttributes[a]=c}n.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];n.addGroup(l.start,l.count,l.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const c in r){const l=r[c];e.data.attributes[c]=l.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let d=0,h=l.length;d<h;d++){const f=l[d];u.push(f.toJSON(e.data))}u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(n));const i=e.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(n))}const s=e.morphAttributes;for(const l in s){const u=[],d=s[l];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(n));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const d=o[l];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const oj=new To,r0=new YU,Vx=new wA,aj=new ht,zx=new ht,Gx=new ht,qx=new ht,yN=new ht,Wx=new ht,cj=new ht,Kx=new ht;class Ih extends iu{constructor(e=new qh,n=new XU){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,n){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,o=r.morphTargetsRelative;n.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){Wx.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c],d=s[c];u!==0&&(yN.fromBufferAttribute(d,e),o?Wx.addScaledVector(yN,u):Wx.addScaledVector(yN.sub(n),u))}n.add(Wx)}return n}raycast(e,n){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),Vx.copy(r.boundingSphere),Vx.applyMatrix4(s),r0.copy(e.ray).recast(e.near),!(Vx.containsPoint(r0.origin)===!1&&(r0.intersectSphere(Vx,aj)===null||r0.origin.distanceToSquared(aj)>(e.far-e.near)**2))&&(oj.copy(s).invert(),r0.copy(e.ray).applyMatrix4(oj),!(r.boundingBox!==null&&r0.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,r0)))}_computeIntersections(e,n,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,d=s.attributes.normal,h=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,g=h.length;p<g;p++){const v=h[p],E=o[v.materialIndex],T=Math.max(v.start,f.start),C=Math.min(a.count,Math.min(v.start+v.count,f.start+f.count));for(let A=T,k=C;A<k;A+=3){const I=a.getX(A),N=a.getX(A+1),U=a.getX(A+2);i=Yx(this,E,e,r,l,u,d,I,N,U),i&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=v.materialIndex,n.push(i))}}else{const p=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);for(let v=p,E=g;v<E;v+=3){const T=a.getX(v),C=a.getX(v+1),A=a.getX(v+2);i=Yx(this,o,e,r,l,u,d,T,C,A),i&&(i.faceIndex=Math.floor(v/3),n.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let p=0,g=h.length;p<g;p++){const v=h[p],E=o[v.materialIndex],T=Math.max(v.start,f.start),C=Math.min(c.count,Math.min(v.start+v.count,f.start+f.count));for(let A=T,k=C;A<k;A+=3){const I=A,N=A+1,U=A+2;i=Yx(this,E,e,r,l,u,d,I,N,U),i&&(i.faceIndex=Math.floor(A/3),i.face.materialIndex=v.materialIndex,n.push(i))}}else{const p=Math.max(0,f.start),g=Math.min(c.count,f.start+f.count);for(let v=p,E=g;v<E;v+=3){const T=v,C=v+1,A=v+2;i=Yx(this,o,e,r,l,u,d,T,C,A),i&&(i.faceIndex=Math.floor(v/3),n.push(i))}}}}function tre(t,e,n,r,i,s,o,a){let c;if(e.side===ec?c=r.intersectTriangle(o,s,i,!0,a):c=r.intersectTriangle(i,s,o,e.side===ng,a),c===null)return null;Kx.copy(a),Kx.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(Kx);return l<n.near||l>n.far?null:{distance:l,point:Kx.clone(),object:t}}function Yx(t,e,n,r,i,s,o,a,c,l){t.getVertexPosition(a,zx),t.getVertexPosition(c,Gx),t.getVertexPosition(l,qx);const u=tre(t,e,n,r,zx,Gx,qx,cj);if(u){const d=new ht;Rh.getBarycoord(cj,zx,Gx,qx,d),i&&(u.uv=Rh.getInterpolatedAttribute(i,a,c,l,d,new Vn)),s&&(u.uv1=Rh.getInterpolatedAttribute(s,a,c,l,d,new Vn)),o&&(u.normal=Rh.getInterpolatedAttribute(o,a,c,l,d,new ht),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:c,c:l,normal:new ht,materialIndex:0};Rh.getNormal(zx,Gx,qx,h.normal),u.face=h,u.barycoord=d}return u}class cT extends qh{constructor(e=1,n=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],d=[];let h=0,f=0;p("z","y","x",-1,-1,r,n,e,o,s,0),p("z","y","x",1,-1,r,n,-e,o,s,1),p("x","z","y",1,1,e,r,n,i,o,2),p("x","z","y",1,-1,e,r,-n,i,o,3),p("x","y","z",1,-1,e,n,r,i,s,4),p("x","y","z",-1,-1,e,n,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new N0(l,3)),this.setAttribute("normal",new N0(u,3)),this.setAttribute("uv",new N0(d,2));function p(g,v,E,T,C,A,k,I,N,U,F){const $=A/N,X=k/U,q=A/2,W=k/2,K=I/2,ne=N+1,Q=U+1;let ie=0,G=0;const Z=new ht;for(let se=0;se<Q;se++){const ue=se*X-W;for(let Ae=0;Ae<ne;Ae++){const Be=Ae*$-q;Z[g]=Be*T,Z[v]=ue*C,Z[E]=K,l.push(Z.x,Z.y,Z.z),Z[g]=0,Z[v]=0,Z[E]=I>0?1:-1,u.push(Z.x,Z.y,Z.z),d.push(Ae/N),d.push(1-se/U),ie+=1}}for(let se=0;se<U;se++)for(let ue=0;ue<N;ue++){const Ae=h+ue+ne*se,Be=h+ue+ne*(se+1),Se=h+(ue+1)+ne*(se+1),Pe=h+(ue+1)+ne*se;c.push(Ae,Be,Pe),c.push(Be,Se,Pe),G+=6}a.addGroup(f,G,F),f+=G,h+=ie}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cT(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function dE(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const i=t[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=i.clone():Array.isArray(i)?e[n][r]=i.slice():e[n][r]=i}}return e}function yl(t){const e={};for(let n=0;n<t.length;n++){const r=dE(t[n]);for(const i in r)e[i]=r[i]}return e}function nre(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function P8(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ki.workingColorSpace}const rre={clone:dE,merge:yl};var ire=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,sre=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Al extends fg{static get type(){return"ShaderMaterial"}constructor(e){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ire,this.fragmentShader=sre,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=dE(e.uniforms),this.uniformsGroups=nre(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?n.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?n.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?n.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?n.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?n.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?n.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?n.uniforms[i]={type:"m4",value:o.toArray()}:n.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}class TA extends iu{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new To,this.projectionMatrix=new To,this.projectionMatrixInverse=new To,this.coordinateSystem=Gm}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const fv=new ht,lj=new Vn,uj=new Vn;class Lu extends TA{constructor(e=50,n=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=pw*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(JS*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return pw*2*Math.atan(Math.tan(JS*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){fv.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(fv.x,fv.y).multiplyScalar(-e/fv.z),fv.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(fv.x,fv.y).multiplyScalar(-e/fv.z)}getViewSize(e,n){return this.getViewBounds(e,lj,uj),n.subVectors(uj,lj)}setViewOffset(e,n,r,i,s,o){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(JS*.5*this.fov)/this.zoom,r=2*n,i=this.aspect*r,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,n-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const nb=-90,rb=1;class ore extends iu{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Lu(nb,rb,e,n);i.layers=this.layers,this.add(i);const s=new Lu(nb,rb,e,n);s.layers=this.layers,this.add(s);const o=new Lu(nb,rb,e,n);o.layers=this.layers,this.add(o);const a=new Lu(nb,rb,e,n);a.layers=this.layers,this.add(a);const c=new Lu(nb,rb,e,n);c.layers=this.layers,this.add(c);const l=new Lu(nb,rb,e,n);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,i,s,o,a,c]=n;for(const l of n)this.remove(l);if(e===Gm)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===W1)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of n)this.add(l),l.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,d=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const g=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(n,s),e.setRenderTarget(r,1,i),e.render(n,o),e.setRenderTarget(r,2,i),e.render(n,a),e.setRenderTarget(r,3,i),e.render(n,c),e.setRenderTarget(r,4,i),e.render(n,l),r.texture.generateMipmaps=g,e.setRenderTarget(r,5,i),e.render(n,u),e.setRenderTarget(d,h,f),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class D8 extends wo{constructor(e,n,r,i,s,o,a,c,l,u){e=e!==void 0?e:[],n=n!==void 0?n:lE,super(e,n,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class are extends Ku{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new D8(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Zl}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new cT(5,5,5),s=new Al({name:"CubemapFromEquirect",uniforms:dE(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:ec,blending:Dh});s.uniforms.tEquirect.value=n;const o=new Ih(i,s),a=n.minFilter;return n.minFilter===R0&&(n.minFilter=Zl),new ore(1,10,this).update(e,o),n.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,n,r,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(n,r,i);e.setRenderTarget(s)}}const bN=new ht,cre=new ht,lre=new Kr;class Sh{constructor(e=new ht(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,i){return this.normal.set(e,n,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const i=bN.subVectors(r,n).cross(cre.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(bN),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:n.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||lre.getNormalMatrix(e),i=this.coplanarPoint(bN).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const i0=new wA,Xx=new ht;class L8{constructor(e=new Sh,n=new Sh,r=new Sh,i=new Sh,s=new Sh,o=new Sh){this.planes=[e,n,r,i,s,o]}set(e,n,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(n),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=Gm){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],d=i[6],h=i[7],f=i[8],p=i[9],g=i[10],v=i[11],E=i[12],T=i[13],C=i[14],A=i[15];if(r[0].setComponents(c-s,h-l,v-f,A-E).normalize(),r[1].setComponents(c+s,h+l,v+f,A+E).normalize(),r[2].setComponents(c+o,h+u,v+p,A+T).normalize(),r[3].setComponents(c-o,h-u,v-p,A-T).normalize(),r[4].setComponents(c-a,h-d,v-g,A-C).normalize(),n===Gm)r[5].setComponents(c+a,h+d,v+g,A+C).normalize();else if(n===W1)r[5].setComponents(a,d,g,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),i0.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),i0.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(i0)}intersectsSprite(e){return i0.center.set(0,0,0),i0.radius=.7071067811865476,i0.applyMatrix4(e.matrixWorld),this.intersectsSphere(i0)}intersectsSphere(e){const n=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(n[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const i=n[r];if(Xx.x=i.normal.x>0?e.max.x:e.min.x,Xx.y=i.normal.y>0?e.max.y:e.min.y,Xx.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Xx)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function U8(){let t=null,e=!1,n=null,r=null;function i(s,o){n(s,o),r=t.requestAnimationFrame(i)}return{start:function(){e!==!0&&n!==null&&(r=t.requestAnimationFrame(i),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function ure(t){const e=new WeakMap;function n(a,c){const l=a.array,u=a.usage,d=l.byteLength,h=t.createBuffer();t.bindBuffer(c,h),t.bufferData(c,l,u),a.onUploadCallback();let f;if(l instanceof Float32Array)f=t.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?f=t.HALF_FLOAT:f=t.UNSIGNED_SHORT;else if(l instanceof Int16Array)f=t.SHORT;else if(l instanceof Uint32Array)f=t.UNSIGNED_INT;else if(l instanceof Int32Array)f=t.INT;else if(l instanceof Int8Array)f=t.BYTE;else if(l instanceof Uint8Array)f=t.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)f=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:h,type:f,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:d}}function r(a,c,l){const u=c.array,d=c.updateRanges;if(t.bindBuffer(l,a),d.length===0)t.bufferSubData(l,0,u);else{d.sort((f,p)=>f.start-p.start);let h=0;for(let f=1;f<d.length;f++){const p=d[h],g=d[f];g.start<=p.start+p.count+1?p.count=Math.max(p.count,g.start+g.count-p.start):(++h,d[h]=g)}d.length=h+1;for(let f=0,p=d.length;f<p;f++){const g=d[f];t.bufferSubData(l,g.start*u.BYTES_PER_ELEMENT,u,g.start,g.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(t.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=e.get(a);if(l===void 0)e.set(a,n(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}class lT extends qh{constructor(e=1,n=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:i};const s=e/2,o=n/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,d=e/a,h=n/c,f=[],p=[],g=[],v=[];for(let E=0;E<u;E++){const T=E*h-o;for(let C=0;C<l;C++){const A=C*d-s;p.push(A,-T,0),g.push(0,0,1),v.push(C/a),v.push(1-E/c)}}for(let E=0;E<c;E++)for(let T=0;T<a;T++){const C=T+l*E,A=T+l*(E+1),k=T+1+l*(E+1),I=T+1+l*E;f.push(C,A,I),f.push(A,k,I)}this.setIndex(f),this.setAttribute("position",new N0(p,3)),this.setAttribute("normal",new N0(g,3)),this.setAttribute("uv",new N0(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lT(e.width,e.height,e.widthSegments,e.heightSegments)}}var dre=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,hre=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,fre=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,pre=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,mre=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,gre=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,vre=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,_re=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,yre=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,bre=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Ere=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Sre=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,wre=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Tre=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,xre=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Cre=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Rre=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Are=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Mre=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Ire=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Ore=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,kre=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Nre=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Pre=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Dre=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Lre=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Ure=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Fre=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Bre=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,jre=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,$re="gl_FragColor = linearToOutputTexel( gl_FragColor );",Hre=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Vre=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,zre=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Gre=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,qre=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Wre=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Kre=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Yre=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Xre=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Jre=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Qre=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Zre=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,eie=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,tie=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,nie=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,rie=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,iie=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,sie=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,oie=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,aie=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,cie=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lie=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,uie=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,die=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,hie=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,fie=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,pie=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,mie=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,gie=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,vie=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,_ie=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,yie=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,bie=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Eie=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Sie=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,wie=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Tie=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,xie=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Cie=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Rie=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Aie=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Mie=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Iie=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Oie=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,kie=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Nie=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Pie=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Die=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Lie=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Uie=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Fie=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Bie=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,jie=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,$ie=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Hie=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Vie=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,zie=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Gie=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,qie=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Wie=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Kie=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Yie=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Xie=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Jie=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Qie=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Zie=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,ese=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,tse=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,nse=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,rse=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,ise=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,sse=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,ose=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,ase=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,cse=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,lse=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const use=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,dse=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,hse=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fse=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,pse=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,mse=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,gse=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,vse=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,_se=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,yse=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,bse=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Ese=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Sse=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,wse=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Tse=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,xse=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cse=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Rse=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ase=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Mse=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ise=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Ose=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,kse=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Nse=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Pse=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Dse=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Lse=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Use=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Fse=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Bse=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,jse=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$se=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Hse=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Vse=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Yr={alphahash_fragment:dre,alphahash_pars_fragment:hre,alphamap_fragment:fre,alphamap_pars_fragment:pre,alphatest_fragment:mre,alphatest_pars_fragment:gre,aomap_fragment:vre,aomap_pars_fragment:_re,batching_pars_vertex:yre,batching_vertex:bre,begin_vertex:Ere,beginnormal_vertex:Sre,bsdfs:wre,iridescence_fragment:Tre,bumpmap_pars_fragment:xre,clipping_planes_fragment:Cre,clipping_planes_pars_fragment:Rre,clipping_planes_pars_vertex:Are,clipping_planes_vertex:Mre,color_fragment:Ire,color_pars_fragment:Ore,color_pars_vertex:kre,color_vertex:Nre,common:Pre,cube_uv_reflection_fragment:Dre,defaultnormal_vertex:Lre,displacementmap_pars_vertex:Ure,displacementmap_vertex:Fre,emissivemap_fragment:Bre,emissivemap_pars_fragment:jre,colorspace_fragment:$re,colorspace_pars_fragment:Hre,envmap_fragment:Vre,envmap_common_pars_fragment:zre,envmap_pars_fragment:Gre,envmap_pars_vertex:qre,envmap_physical_pars_fragment:rie,envmap_vertex:Wre,fog_vertex:Kre,fog_pars_vertex:Yre,fog_fragment:Xre,fog_pars_fragment:Jre,gradientmap_pars_fragment:Qre,lightmap_pars_fragment:Zre,lights_lambert_fragment:eie,lights_lambert_pars_fragment:tie,lights_pars_begin:nie,lights_toon_fragment:iie,lights_toon_pars_fragment:sie,lights_phong_fragment:oie,lights_phong_pars_fragment:aie,lights_physical_fragment:cie,lights_physical_pars_fragment:lie,lights_fragment_begin:uie,lights_fragment_maps:die,lights_fragment_end:hie,logdepthbuf_fragment:fie,logdepthbuf_pars_fragment:pie,logdepthbuf_pars_vertex:mie,logdepthbuf_vertex:gie,map_fragment:vie,map_pars_fragment:_ie,map_particle_fragment:yie,map_particle_pars_fragment:bie,metalnessmap_fragment:Eie,metalnessmap_pars_fragment:Sie,morphinstance_vertex:wie,morphcolor_vertex:Tie,morphnormal_vertex:xie,morphtarget_pars_vertex:Cie,morphtarget_vertex:Rie,normal_fragment_begin:Aie,normal_fragment_maps:Mie,normal_pars_fragment:Iie,normal_pars_vertex:Oie,normal_vertex:kie,normalmap_pars_fragment:Nie,clearcoat_normal_fragment_begin:Pie,clearcoat_normal_fragment_maps:Die,clearcoat_pars_fragment:Lie,iridescence_pars_fragment:Uie,opaque_fragment:Fie,packing:Bie,premultiplied_alpha_fragment:jie,project_vertex:$ie,dithering_fragment:Hie,dithering_pars_fragment:Vie,roughnessmap_fragment:zie,roughnessmap_pars_fragment:Gie,shadowmap_pars_fragment:qie,shadowmap_pars_vertex:Wie,shadowmap_vertex:Kie,shadowmask_pars_fragment:Yie,skinbase_vertex:Xie,skinning_pars_vertex:Jie,skinning_vertex:Qie,skinnormal_vertex:Zie,specularmap_fragment:ese,specularmap_pars_fragment:tse,tonemapping_fragment:nse,tonemapping_pars_fragment:rse,transmission_fragment:ise,transmission_pars_fragment:sse,uv_pars_fragment:ose,uv_pars_vertex:ase,uv_vertex:cse,worldpos_vertex:lse,background_vert:use,background_frag:dse,backgroundCube_vert:hse,backgroundCube_frag:fse,cube_vert:pse,cube_frag:mse,depth_vert:gse,depth_frag:vse,distanceRGBA_vert:_se,distanceRGBA_frag:yse,equirect_vert:bse,equirect_frag:Ese,linedashed_vert:Sse,linedashed_frag:wse,meshbasic_vert:Tse,meshbasic_frag:xse,meshlambert_vert:Cse,meshlambert_frag:Rse,meshmatcap_vert:Ase,meshmatcap_frag:Mse,meshnormal_vert:Ise,meshnormal_frag:Ose,meshphong_vert:kse,meshphong_frag:Nse,meshphysical_vert:Pse,meshphysical_frag:Dse,meshtoon_vert:Lse,meshtoon_frag:Use,points_vert:Fse,points_frag:Bse,shadow_vert:jse,shadow_frag:$se,sprite_vert:Hse,sprite_frag:Vse},un={common:{diffuse:{value:new bi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Kr},alphaMap:{value:null},alphaMapTransform:{value:new Kr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Kr}},envmap:{envMap:{value:null},envMapRotation:{value:new Kr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Kr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Kr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Kr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Kr},normalScale:{value:new Vn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Kr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Kr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Kr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Kr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Kr},alphaTest:{value:0},uvTransform:{value:new Kr}},sprite:{diffuse:{value:new bi(16777215)},opacity:{value:1},center:{value:new Vn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Kr},alphaMap:{value:null},alphaMapTransform:{value:new Kr},alphaTest:{value:0}}},Kf={basic:{uniforms:yl([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.fog]),vertexShader:Yr.meshbasic_vert,fragmentShader:Yr.meshbasic_frag},lambert:{uniforms:yl([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new bi(0)}}]),vertexShader:Yr.meshlambert_vert,fragmentShader:Yr.meshlambert_frag},phong:{uniforms:yl([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new bi(0)},specular:{value:new bi(1118481)},shininess:{value:30}}]),vertexShader:Yr.meshphong_vert,fragmentShader:Yr.meshphong_frag},standard:{uniforms:yl([un.common,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.roughnessmap,un.metalnessmap,un.fog,un.lights,{emissive:{value:new bi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Yr.meshphysical_vert,fragmentShader:Yr.meshphysical_frag},toon:{uniforms:yl([un.common,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.gradientmap,un.fog,un.lights,{emissive:{value:new bi(0)}}]),vertexShader:Yr.meshtoon_vert,fragmentShader:Yr.meshtoon_frag},matcap:{uniforms:yl([un.common,un.bumpmap,un.normalmap,un.displacementmap,un.fog,{matcap:{value:null}}]),vertexShader:Yr.meshmatcap_vert,fragmentShader:Yr.meshmatcap_frag},points:{uniforms:yl([un.points,un.fog]),vertexShader:Yr.points_vert,fragmentShader:Yr.points_frag},dashed:{uniforms:yl([un.common,un.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Yr.linedashed_vert,fragmentShader:Yr.linedashed_frag},depth:{uniforms:yl([un.common,un.displacementmap]),vertexShader:Yr.depth_vert,fragmentShader:Yr.depth_frag},normal:{uniforms:yl([un.common,un.bumpmap,un.normalmap,un.displacementmap,{opacity:{value:1}}]),vertexShader:Yr.meshnormal_vert,fragmentShader:Yr.meshnormal_frag},sprite:{uniforms:yl([un.sprite,un.fog]),vertexShader:Yr.sprite_vert,fragmentShader:Yr.sprite_frag},background:{uniforms:{uvTransform:{value:new Kr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Yr.background_vert,fragmentShader:Yr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Kr}},vertexShader:Yr.backgroundCube_vert,fragmentShader:Yr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Yr.cube_vert,fragmentShader:Yr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Yr.equirect_vert,fragmentShader:Yr.equirect_frag},distanceRGBA:{uniforms:yl([un.common,un.displacementmap,{referencePosition:{value:new ht},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Yr.distanceRGBA_vert,fragmentShader:Yr.distanceRGBA_frag},shadow:{uniforms:yl([un.lights,un.fog,{color:{value:new bi(0)},opacity:{value:1}}]),vertexShader:Yr.shadow_vert,fragmentShader:Yr.shadow_frag}};Kf.physical={uniforms:yl([Kf.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Kr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Kr},clearcoatNormalScale:{value:new Vn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Kr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Kr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Kr},sheen:{value:0},sheenColor:{value:new bi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Kr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Kr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Kr},transmissionSamplerSize:{value:new Vn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Kr},attenuationDistance:{value:0},attenuationColor:{value:new bi(0)},specularColor:{value:new bi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Kr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Kr},anisotropyVector:{value:new Vn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Kr}}]),vertexShader:Yr.meshphysical_vert,fragmentShader:Yr.meshphysical_frag};const Jx={r:0,b:0,g:0},s0=new rg,zse=new To;function Gse(t,e,n,r,i,s,o){const a=new bi(0);let c=s===!0?0:1,l,u,d=null,h=0,f=null;function p(T){let C=T.isScene===!0?T.background:null;return C&&C.isTexture&&(C=(T.backgroundBlurriness>0?n:e).get(C)),C}function g(T){let C=!1;const A=p(T);A===null?E(a,c):A&&A.isColor&&(E(A,1),C=!0);const k=t.xr.getEnvironmentBlendMode();k==="additive"?r.buffers.color.setClear(0,0,0,1,o):k==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,o),(t.autoClear||C)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function v(T,C){const A=p(C);A&&(A.isCubeTexture||A.mapping===bA)?(u===void 0&&(u=new Ih(new cT(1,1,1),new Al({name:"BackgroundCubeMaterial",uniforms:dE(Kf.backgroundCube.uniforms),vertexShader:Kf.backgroundCube.vertexShader,fragmentShader:Kf.backgroundCube.fragmentShader,side:ec,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(k,I,N){this.matrixWorld.copyPosition(N.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),s0.copy(C.backgroundRotation),s0.x*=-1,s0.y*=-1,s0.z*=-1,A.isCubeTexture&&A.isRenderTargetTexture===!1&&(s0.y*=-1,s0.z*=-1),u.material.uniforms.envMap.value=A,u.material.uniforms.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=C.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(zse.makeRotationFromEuler(s0)),u.material.toneMapped=ki.getTransfer(A.colorSpace)!==es,(d!==A||h!==A.version||f!==t.toneMapping)&&(u.material.needsUpdate=!0,d=A,h=A.version,f=t.toneMapping),u.layers.enableAll(),T.unshift(u,u.geometry,u.material,0,0,null)):A&&A.isTexture&&(l===void 0&&(l=new Ih(new lT(2,2),new Al({name:"BackgroundMaterial",uniforms:dE(Kf.background.uniforms),vertexShader:Kf.background.vertexShader,fragmentShader:Kf.background.fragmentShader,side:ng,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=A,l.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,l.material.toneMapped=ki.getTransfer(A.colorSpace)!==es,A.matrixAutoUpdate===!0&&A.updateMatrix(),l.material.uniforms.uvTransform.value.copy(A.matrix),(d!==A||h!==A.version||f!==t.toneMapping)&&(l.material.needsUpdate=!0,d=A,h=A.version,f=t.toneMapping),l.layers.enableAll(),T.unshift(l,l.geometry,l.material,0,0,null))}function E(T,C){T.getRGB(Jx,P8(t)),r.buffers.color.setClear(Jx.r,Jx.g,Jx.b,C,o)}return{getClearColor:function(){return a},setClearColor:function(T,C=1){a.set(T),c=C,E(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(T){c=T,E(a,c)},render:g,addToRenderList:v}}function qse(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},i=h(null);let s=i,o=!1;function a($,X,q,W,K){let ne=!1;const Q=d(W,q,X);s!==Q&&(s=Q,l(s.object)),ne=f($,W,q,K),ne&&p($,W,q,K),K!==null&&e.update(K,t.ELEMENT_ARRAY_BUFFER),(ne||o)&&(o=!1,A($,X,q,W),K!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(K).buffer))}function c(){return t.createVertexArray()}function l($){return t.bindVertexArray($)}function u($){return t.deleteVertexArray($)}function d($,X,q){const W=q.wireframe===!0;let K=r[$.id];K===void 0&&(K={},r[$.id]=K);let ne=K[X.id];ne===void 0&&(ne={},K[X.id]=ne);let Q=ne[W];return Q===void 0&&(Q=h(c()),ne[W]=Q),Q}function h($){const X=[],q=[],W=[];for(let K=0;K<n;K++)X[K]=0,q[K]=0,W[K]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:X,enabledAttributes:q,attributeDivisors:W,object:$,attributes:{},index:null}}function f($,X,q,W){const K=s.attributes,ne=X.attributes;let Q=0;const ie=q.getAttributes();for(const G in ie)if(ie[G].location>=0){const se=K[G];let ue=ne[G];if(ue===void 0&&(G==="instanceMatrix"&&$.instanceMatrix&&(ue=$.instanceMatrix),G==="instanceColor"&&$.instanceColor&&(ue=$.instanceColor)),se===void 0||se.attribute!==ue||ue&&se.data!==ue.data)return!0;Q++}return s.attributesNum!==Q||s.index!==W}function p($,X,q,W){const K={},ne=X.attributes;let Q=0;const ie=q.getAttributes();for(const G in ie)if(ie[G].location>=0){let se=ne[G];se===void 0&&(G==="instanceMatrix"&&$.instanceMatrix&&(se=$.instanceMatrix),G==="instanceColor"&&$.instanceColor&&(se=$.instanceColor));const ue={};ue.attribute=se,se&&se.data&&(ue.data=se.data),K[G]=ue,Q++}s.attributes=K,s.attributesNum=Q,s.index=W}function g(){const $=s.newAttributes;for(let X=0,q=$.length;X<q;X++)$[X]=0}function v($){E($,0)}function E($,X){const q=s.newAttributes,W=s.enabledAttributes,K=s.attributeDivisors;q[$]=1,W[$]===0&&(t.enableVertexAttribArray($),W[$]=1),K[$]!==X&&(t.vertexAttribDivisor($,X),K[$]=X)}function T(){const $=s.newAttributes,X=s.enabledAttributes;for(let q=0,W=X.length;q<W;q++)X[q]!==$[q]&&(t.disableVertexAttribArray(q),X[q]=0)}function C($,X,q,W,K,ne,Q){Q===!0?t.vertexAttribIPointer($,X,q,K,ne):t.vertexAttribPointer($,X,q,W,K,ne)}function A($,X,q,W){g();const K=W.attributes,ne=q.getAttributes(),Q=X.defaultAttributeValues;for(const ie in ne){const G=ne[ie];if(G.location>=0){let Z=K[ie];if(Z===void 0&&(ie==="instanceMatrix"&&$.instanceMatrix&&(Z=$.instanceMatrix),ie==="instanceColor"&&$.instanceColor&&(Z=$.instanceColor)),Z!==void 0){const se=Z.normalized,ue=Z.itemSize,Ae=e.get(Z);if(Ae===void 0)continue;const Be=Ae.buffer,Se=Ae.type,Pe=Ae.bytesPerElement,we=Se===t.INT||Se===t.UNSIGNED_INT||Z.gpuType===VU;if(Z.isInterleavedBufferAttribute){const Te=Z.data,Oe=Te.stride,_t=Z.offset;if(Te.isInstancedInterleavedBuffer){for(let Ct=0;Ct<G.locationSize;Ct++)E(G.location+Ct,Te.meshPerAttribute);$.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=Te.meshPerAttribute*Te.count)}else for(let Ct=0;Ct<G.locationSize;Ct++)v(G.location+Ct);t.bindBuffer(t.ARRAY_BUFFER,Be);for(let Ct=0;Ct<G.locationSize;Ct++)C(G.location+Ct,ue/G.locationSize,Se,se,Oe*Pe,(_t+ue/G.locationSize*Ct)*Pe,we)}else{if(Z.isInstancedBufferAttribute){for(let Te=0;Te<G.locationSize;Te++)E(G.location+Te,Z.meshPerAttribute);$.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=Z.meshPerAttribute*Z.count)}else for(let Te=0;Te<G.locationSize;Te++)v(G.location+Te);t.bindBuffer(t.ARRAY_BUFFER,Be);for(let Te=0;Te<G.locationSize;Te++)C(G.location+Te,ue/G.locationSize,Se,se,ue*Pe,ue/G.locationSize*Te*Pe,we)}}else if(Q!==void 0){const se=Q[ie];if(se!==void 0)switch(se.length){case 2:t.vertexAttrib2fv(G.location,se);break;case 3:t.vertexAttrib3fv(G.location,se);break;case 4:t.vertexAttrib4fv(G.location,se);break;default:t.vertexAttrib1fv(G.location,se)}}}}T()}function k(){U();for(const $ in r){const X=r[$];for(const q in X){const W=X[q];for(const K in W)u(W[K].object),delete W[K];delete X[q]}delete r[$]}}function I($){if(r[$.id]===void 0)return;const X=r[$.id];for(const q in X){const W=X[q];for(const K in W)u(W[K].object),delete W[K];delete X[q]}delete r[$.id]}function N($){for(const X in r){const q=r[X];if(q[$.id]===void 0)continue;const W=q[$.id];for(const K in W)u(W[K].object),delete W[K];delete q[$.id]}}function U(){F(),o=!0,s!==i&&(s=i,l(s.object))}function F(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:U,resetDefaultState:F,dispose:k,releaseStatesOfGeometry:I,releaseStatesOfProgram:N,initAttributes:g,enableAttribute:v,disableUnusedAttributes:T}}function Wse(t,e,n){let r;function i(l){r=l}function s(l,u){t.drawArrays(r,l,u),n.update(u,r,1)}function o(l,u,d){d!==0&&(t.drawArraysInstanced(r,l,u,d),n.update(u,r,d))}function a(l,u,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,u,0,d);let f=0;for(let p=0;p<d;p++)f+=u[p];n.update(f,r,1)}function c(l,u,d,h){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<l.length;p++)o(l[p],u[p],h[p]);else{f.multiDrawArraysInstancedWEBGL(r,l,0,u,0,h,0,d);let p=0;for(let g=0;g<d;g++)p+=u[g]*h[g];n.update(p,r,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function Kse(t,e,n,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const N=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(N.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(N){return!(N!==Cd&&r.convert(N)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(N){const U=N===GE&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(N!==Gc&&r.convert(N)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&N!==sp&&!U)}function c(N){if(N==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";N="mediump"}return N==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=n.precision!==void 0?n.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const d=n.logarithmicDepthBuffer===!0,h=n.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),f=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),p=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=t.getParameter(t.MAX_TEXTURE_SIZE),v=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),E=t.getParameter(t.MAX_VERTEX_ATTRIBS),T=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),C=t.getParameter(t.MAX_VARYING_VECTORS),A=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),k=p>0,I=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:d,reverseDepthBuffer:h,maxTextures:f,maxVertexTextures:p,maxTextureSize:g,maxCubemapSize:v,maxAttributes:E,maxVertexUniforms:T,maxVaryings:C,maxFragmentUniforms:A,vertexTextures:k,maxSamples:I}}function Yse(t){const e=this;let n=null,r=0,i=!1,s=!1;const o=new Sh,a=new Kr,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h){const f=d.length!==0||h||r!==0||i;return i=h,r=d.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,h){n=u(d,h,0)},this.setState=function(d,h,f){const p=d.clippingPlanes,g=d.clipIntersection,v=d.clipShadows,E=t.get(d);if(!i||p===null||p.length===0||s&&!v)s?u(null):l();else{const T=s?0:r,C=T*4;let A=E.clippingState||null;c.value=A,A=u(p,h,C,f);for(let k=0;k!==C;++k)A[k]=n[k];E.clippingState=A,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=T}};function l(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(d,h,f,p){const g=d!==null?d.length:0;let v=null;if(g!==0){if(v=c.value,p!==!0||v===null){const E=f+g*4,T=h.matrixWorldInverse;a.getNormalMatrix(T),(v===null||v.length<E)&&(v=new Float32Array(E));for(let C=0,A=f;C!==g;++C,A+=4)o.copy(d[C]).applyMatrix4(T,a),o.normal.toArray(v,A),v[A+3]=o.constant}c.value=v,c.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,v}}function Xse(t){let e=new WeakMap;function n(o,a){return a===OD?o.mapping=lE:a===kD&&(o.mapping=uE),o}function r(o){if(o&&o.isTexture){const a=o.mapping;if(a===OD||a===kD)if(e.has(o)){const c=e.get(o).texture;return n(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new are(c.height);return l.fromEquirectangularTexture(t,o),e.set(o,l),o.addEventListener("dispose",i),n(l.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}class JU extends TA{constructor(e=-1,n=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+n,c=i-n;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const Ib=4,dj=[.125,.215,.35,.446,.526,.582],w0=20,EN=new JU,hj=new bi;let SN=null,wN=0,TN=0,xN=!1;const m0=(1+Math.sqrt(5))/2,ib=1/m0,fj=[new ht(-m0,ib,0),new ht(m0,ib,0),new ht(-ib,0,m0),new ht(ib,0,m0),new ht(0,m0,-ib),new ht(0,m0,ib),new ht(-1,1,-1),new ht(1,1,-1),new ht(-1,1,1),new ht(1,1,1)];class pj{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,r=.1,i=100){SN=this._renderer.getRenderTarget(),wN=this._renderer.getActiveCubeFace(),TN=this._renderer.getActiveMipmapLevel(),xN=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,i,s),n>0&&this._blur(s,0,0,n),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=vj(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=gj(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(SN,wN,TN),this._renderer.xr.enabled=xN,e.scissorTest=!1,Qx(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===lE||e.mapping===uE?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),SN=this._renderer.getRenderTarget(),wN=this._renderer.getActiveCubeFace(),TN=this._renderer.getActiveMipmapLevel(),xN=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:Zl,minFilter:Zl,generateMipmaps:!1,type:GE,format:Cd,colorSpace:S_,depthBuffer:!1},i=mj(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=mj(e,n,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Jse(s)),this._blurMaterial=Qse(s,e,n)}return i}_compileMaterial(e){const n=new Ih(this._lodPlanes[0],e);this._renderer.compile(n,EN)}_sceneToCubeUV(e,n,r,i){const a=new Lu(90,1,n,r),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(hj),u.toneMapping=ap,u.autoClear=!1;const f=new XU({name:"PMREM.Background",side:ec,depthWrite:!1,depthTest:!1}),p=new Ih(new cT,f);let g=!1;const v=e.background;v?v.isColor&&(f.color.copy(v),e.background=null,g=!0):(f.color.copy(hj),g=!0);for(let E=0;E<6;E++){const T=E%3;T===0?(a.up.set(0,c[E],0),a.lookAt(l[E],0,0)):T===1?(a.up.set(0,0,c[E]),a.lookAt(0,l[E],0)):(a.up.set(0,c[E],0),a.lookAt(0,0,l[E]));const C=this._cubeSize;Qx(i,T*C,E>2?C:0,C,C),u.setRenderTarget(i),g&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=v}_textureToCubeUV(e,n){const r=this._renderer,i=e.mapping===lE||e.mapping===uE;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=vj()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=gj());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new Ih(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;Qx(n,0,0,3*c,2*c),r.setRenderTarget(n),r.render(o,EN)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=fj[(i-s-1)%fj.length];this._blur(e,s-1,s,o,a)}n.autoClear=r}_blur(e,n,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,n,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,n,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new Ih(this._lodPlanes[i],l),h=l.uniforms,f=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*w0-1),g=s/p,v=isFinite(s)?1+Math.floor(u*g):w0;v>w0&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${w0}`);const E=[];let T=0;for(let N=0;N<w0;++N){const U=N/g,F=Math.exp(-U*U/2);E.push(F),N===0?T+=F:N<v&&(T+=2*F)}for(let N=0;N<E.length;N++)E[N]=E[N]/T;h.envMap.value=e.texture,h.samples.value=v,h.weights.value=E,h.latitudinal.value=o==="latitudinal",a&&(h.poleAxis.value=a);const{_lodMax:C}=this;h.dTheta.value=p,h.mipInt.value=C-r;const A=this._sizeLods[i],k=3*A*(i>C-Ib?i-C+Ib:0),I=4*(this._cubeSize-A);Qx(n,k,I,3*A,2*A),c.setRenderTarget(n),c.render(d,EN)}}function Jse(t){const e=[],n=[],r=[];let i=t;const s=t-Ib+1+dj.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);n.push(a);let c=1/a;o>t-Ib?c=dj[o-t+Ib-1]:o===0&&(c=0),r.push(c);const l=1/(a-2),u=-l,d=1+l,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,g=3,v=2,E=1,T=new Float32Array(g*p*f),C=new Float32Array(v*p*f),A=new Float32Array(E*p*f);for(let I=0;I<f;I++){const N=I%3*2/3-1,U=I>2?0:-1,F=[N,U,0,N+2/3,U,0,N+2/3,U+1,0,N,U,0,N+2/3,U+1,0,N,U+1,0];T.set(F,g*p*I),C.set(h,v*p*I);const $=[I,I,I,I,I,I];A.set($,E*p*I)}const k=new qh;k.setAttribute("position",new oo(T,g)),k.setAttribute("uv",new oo(C,v)),k.setAttribute("faceIndex",new oo(A,E)),e.push(k),i>Ib&&i--}return{lodPlanes:e,sizeLods:n,sigmas:r}}function mj(t,e,n){const r=new Ku(t,e,n);return r.texture.mapping=bA,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Qx(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function Qse(t,e,n){const r=new Float32Array(w0),i=new ht(0,1,0);return new Al({name:"SphericalGaussianBlur",defines:{n:w0,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:QU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Dh,depthTest:!1,depthWrite:!1})}function gj(){return new Al({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:QU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Dh,depthTest:!1,depthWrite:!1})}function vj(){return new Al({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:QU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Dh,depthTest:!1,depthWrite:!1})}function QU(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Zse(t){let e=new WeakMap,n=null;function r(a){if(a&&a.isTexture){const c=a.mapping,l=c===OD||c===kD,u=c===lE||c===uE;if(l||u){let d=e.get(a);const h=d!==void 0?d.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==h)return n===null&&(n=new pj(t)),d=l?n.fromEquirectangular(a,d):n.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(d!==void 0)return d.texture;{const f=a.image;return l&&f&&f.height>0||u&&f&&i(f)?(n===null&&(n=new pj(t)),d=l?n.fromEquirectangular(a):n.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",s),d.texture):null}}}return a}function i(a){let c=0;const l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:o}}function eoe(t){const e={};function n(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(r)}return e[r]=i,i}return{has:function(r){return n(r)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(r){const i=n(r);return i===null&&US("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function toe(t,e,n,r){const i={},s=new WeakMap;function o(d){const h=d.target;h.index!==null&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);for(const p in h.morphAttributes){const g=h.morphAttributes[p];for(let v=0,E=g.length;v<E;v++)e.remove(g[v])}h.removeEventListener("dispose",o),delete i[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),r.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,n.memory.geometries--}function a(d,h){return i[h.id]===!0||(h.addEventListener("dispose",o),i[h.id]=!0,n.memory.geometries++),h}function c(d){const h=d.attributes;for(const p in h)e.update(h[p],t.ARRAY_BUFFER);const f=d.morphAttributes;for(const p in f){const g=f[p];for(let v=0,E=g.length;v<E;v++)e.update(g[v],t.ARRAY_BUFFER)}}function l(d){const h=[],f=d.index,p=d.attributes.position;let g=0;if(f!==null){const T=f.array;g=f.version;for(let C=0,A=T.length;C<A;C+=3){const k=T[C+0],I=T[C+1],N=T[C+2];h.push(k,I,I,N,N,k)}}else if(p!==void 0){const T=p.array;g=p.version;for(let C=0,A=T.length/3-1;C<A;C+=3){const k=C+0,I=C+1,N=C+2;h.push(k,I,I,N,N,k)}}else return;const v=new(A8(h)?N8:k8)(h,1);v.version=g;const E=s.get(d);E&&e.remove(E),s.set(d,v)}function u(d){const h=s.get(d);if(h){const f=d.index;f!==null&&h.version<f.version&&l(d)}else l(d);return s.get(d)}return{get:a,update:c,getWireframeAttribute:u}}function noe(t,e,n){let r;function i(h){r=h}let s,o;function a(h){s=h.type,o=h.bytesPerElement}function c(h,f){t.drawElements(r,f,s,h*o),n.update(f,r,1)}function l(h,f,p){p!==0&&(t.drawElementsInstanced(r,f,s,h*o,p),n.update(f,r,p))}function u(h,f,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,f,0,s,h,0,p);let v=0;for(let E=0;E<p;E++)v+=f[E];n.update(v,r,1)}function d(h,f,p,g){if(p===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let E=0;E<h.length;E++)l(h[E]/o,f[E],g[E]);else{v.multiDrawElementsInstancedWEBGL(r,f,0,s,h,0,g,0,p);let E=0;for(let T=0;T<p;T++)E+=f[T]*g[T];n.update(E,r,1)}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=d}function roe(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(n.calls++,o){case t.TRIANGLES:n.triangles+=a*(s/3);break;case t.LINES:n.lines+=a*(s/2);break;case t.LINE_STRIP:n.lines+=a*(s-1);break;case t.LINE_LOOP:n.lines+=a*s;break;case t.POINTS:n.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:i,update:r}}function ioe(t,e,n){const r=new WeakMap,i=new Fo;function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=u!==void 0?u.length:0;let h=r.get(a);if(h===void 0||h.count!==d){let F=function(){N.dispose(),r.delete(a),a.removeEventListener("dispose",F)};h!==void 0&&h.texture.dispose();const f=a.morphAttributes.position!==void 0,p=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,v=a.morphAttributes.position||[],E=a.morphAttributes.normal||[],T=a.morphAttributes.color||[];let C=0;f===!0&&(C=1),p===!0&&(C=2),g===!0&&(C=3);let A=a.attributes.position.count*C,k=1;A>e.maxTextureSize&&(k=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);const I=new Float32Array(A*k*4*d),N=new I8(I,A,k,d);N.type=sp,N.needsUpdate=!0;const U=C*4;for(let $=0;$<d;$++){const X=v[$],q=E[$],W=T[$],K=A*k*4*$;for(let ne=0;ne<X.count;ne++){const Q=ne*U;f===!0&&(i.fromBufferAttribute(X,ne),I[K+Q+0]=i.x,I[K+Q+1]=i.y,I[K+Q+2]=i.z,I[K+Q+3]=0),p===!0&&(i.fromBufferAttribute(q,ne),I[K+Q+4]=i.x,I[K+Q+5]=i.y,I[K+Q+6]=i.z,I[K+Q+7]=0),g===!0&&(i.fromBufferAttribute(W,ne),I[K+Q+8]=i.x,I[K+Q+9]=i.y,I[K+Q+10]=i.z,I[K+Q+11]=W.itemSize===4?i.w:1)}}h={count:d,texture:N,size:new Vn(A,k)},r.set(a,h),a.addEventListener("dispose",F)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(t,"morphTexture",o.morphTexture,n);else{let f=0;for(let g=0;g<l.length;g++)f+=l[g];const p=a.morphTargetsRelative?1:1-f;c.getUniforms().setValue(t,"morphTargetBaseInfluence",p),c.getUniforms().setValue(t,"morphTargetInfluences",l)}c.getUniforms().setValue(t,"morphTargetsTexture",h.texture,n),c.getUniforms().setValue(t,"morphTargetsTextureSize",h.size)}return{update:s}}function soe(t,e,n,r){let i=new WeakMap;function s(c){const l=r.render.frame,u=c.geometry,d=e.get(c,u);if(i.get(d)!==l&&(e.update(d),i.set(d,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(n.update(c.instanceMatrix,t.ARRAY_BUFFER),c.instanceColor!==null&&n.update(c.instanceColor,t.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const h=c.skeleton;i.get(h)!==l&&(h.update(),i.set(h,l))}return d}function o(){i=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),n.remove(l.instanceMatrix),l.instanceColor!==null&&n.remove(l.instanceColor)}return{update:s,dispose:o}}class ZU extends wo{constructor(e,n,r,i,s,o,a,c,l,u=zb){if(u!==zb&&u!==V0)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===zb&&(r=s_),r===void 0&&u===V0&&(r=H0),super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=a!==void 0?a:Bo,this.minFilter=c!==void 0?c:Bo,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}const F8=new wo,_j=new ZU(1,1),B8=new I8,j8=new Gne,$8=new D8,yj=[],bj=[],Ej=new Float32Array(16),Sj=new Float32Array(9),wj=new Float32Array(4);function WE(t,e,n){const r=t[0];if(r<=0||r>0)return t;const i=e*n;let s=yj[i];if(s===void 0&&(s=new Float32Array(i),yj[i]=s),e!==0){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=n,t[o].toArray(s,a)}return s}function Da(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function La(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function xA(t,e){let n=bj[e];n===void 0&&(n=new Int32Array(e),bj[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function ooe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function aoe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Da(n,e))return;t.uniform2fv(this.addr,e),La(n,e)}}function coe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Da(n,e))return;t.uniform3fv(this.addr,e),La(n,e)}}function loe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Da(n,e))return;t.uniform4fv(this.addr,e),La(n,e)}}function uoe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Da(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),La(n,e)}else{if(Da(n,r))return;wj.set(r),t.uniformMatrix2fv(this.addr,!1,wj),La(n,r)}}function doe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Da(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),La(n,e)}else{if(Da(n,r))return;Sj.set(r),t.uniformMatrix3fv(this.addr,!1,Sj),La(n,r)}}function hoe(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(Da(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),La(n,e)}else{if(Da(n,r))return;Ej.set(r),t.uniformMatrix4fv(this.addr,!1,Ej),La(n,r)}}function foe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function poe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Da(n,e))return;t.uniform2iv(this.addr,e),La(n,e)}}function moe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Da(n,e))return;t.uniform3iv(this.addr,e),La(n,e)}}function goe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Da(n,e))return;t.uniform4iv(this.addr,e),La(n,e)}}function voe(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function _oe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Da(n,e))return;t.uniform2uiv(this.addr,e),La(n,e)}}function yoe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Da(n,e))return;t.uniform3uiv(this.addr,e),La(n,e)}}function boe(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Da(n,e))return;t.uniform4uiv(this.addr,e),La(n,e)}}function Eoe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i);let s;this.type===t.SAMPLER_2D_SHADOW?(_j.compareFunction=R8,s=_j):s=F8,n.setTexture2D(e||s,i)}function Soe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(e||j8,i)}function woe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(e||$8,i)}function Toe(t,e,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(e||B8,i)}function xoe(t){switch(t){case 5126:return ooe;case 35664:return aoe;case 35665:return coe;case 35666:return loe;case 35674:return uoe;case 35675:return doe;case 35676:return hoe;case 5124:case 35670:return foe;case 35667:case 35671:return poe;case 35668:case 35672:return moe;case 35669:case 35673:return goe;case 5125:return voe;case 36294:return _oe;case 36295:return yoe;case 36296:return boe;case 35678:case 36198:case 36298:case 36306:case 35682:return Eoe;case 35679:case 36299:case 36307:return Soe;case 35680:case 36300:case 36308:case 36293:return woe;case 36289:case 36303:case 36311:case 36292:return Toe}}function Coe(t,e){t.uniform1fv(this.addr,e)}function Roe(t,e){const n=WE(e,this.size,2);t.uniform2fv(this.addr,n)}function Aoe(t,e){const n=WE(e,this.size,3);t.uniform3fv(this.addr,n)}function Moe(t,e){const n=WE(e,this.size,4);t.uniform4fv(this.addr,n)}function Ioe(t,e){const n=WE(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function Ooe(t,e){const n=WE(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function koe(t,e){const n=WE(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Noe(t,e){t.uniform1iv(this.addr,e)}function Poe(t,e){t.uniform2iv(this.addr,e)}function Doe(t,e){t.uniform3iv(this.addr,e)}function Loe(t,e){t.uniform4iv(this.addr,e)}function Uoe(t,e){t.uniform1uiv(this.addr,e)}function Foe(t,e){t.uniform2uiv(this.addr,e)}function Boe(t,e){t.uniform3uiv(this.addr,e)}function joe(t,e){t.uniform4uiv(this.addr,e)}function $oe(t,e,n){const r=this.cache,i=e.length,s=xA(n,i);Da(r,s)||(t.uniform1iv(this.addr,s),La(r,s));for(let o=0;o!==i;++o)n.setTexture2D(e[o]||F8,s[o])}function Hoe(t,e,n){const r=this.cache,i=e.length,s=xA(n,i);Da(r,s)||(t.uniform1iv(this.addr,s),La(r,s));for(let o=0;o!==i;++o)n.setTexture3D(e[o]||j8,s[o])}function Voe(t,e,n){const r=this.cache,i=e.length,s=xA(n,i);Da(r,s)||(t.uniform1iv(this.addr,s),La(r,s));for(let o=0;o!==i;++o)n.setTextureCube(e[o]||$8,s[o])}function zoe(t,e,n){const r=this.cache,i=e.length,s=xA(n,i);Da(r,s)||(t.uniform1iv(this.addr,s),La(r,s));for(let o=0;o!==i;++o)n.setTexture2DArray(e[o]||B8,s[o])}function Goe(t){switch(t){case 5126:return Coe;case 35664:return Roe;case 35665:return Aoe;case 35666:return Moe;case 35674:return Ioe;case 35675:return Ooe;case 35676:return koe;case 5124:case 35670:return Noe;case 35667:case 35671:return Poe;case 35668:case 35672:return Doe;case 35669:case 35673:return Loe;case 5125:return Uoe;case 36294:return Foe;case 36295:return Boe;case 36296:return joe;case 35678:case 36198:case 36298:case 36306:case 35682:return $oe;case 35679:case 36299:case 36307:return Hoe;case 35680:case 36300:case 36308:case 36293:return Voe;case 36289:case 36303:case 36311:case 36292:return zoe}}class qoe{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.setValue=xoe(n.type)}}class Woe{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=Goe(n.type)}}class Koe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,n[a.id],r)}}}const CN=/(\w+)(\])?(\[|\.)?/g;function Tj(t,e){t.seq.push(e),t.map[e.id]=e}function Yoe(t,e,n){const r=t.name,i=r.length;for(CN.lastIndex=0;;){const s=CN.exec(r),o=CN.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){Tj(n,l===void 0?new qoe(a,t,e):new Woe(a,t,e));break}else{let d=n.map[a];d===void 0&&(d=new Koe(a),Tj(n,d)),n=d}}}class i1{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(n,i),o=e.getUniformLocation(n,s.name);Yoe(s,o,this)}}setValue(e,n,r,i){const s=this.map[n];s!==void 0&&s.setValue(e,r,i)}setOptional(e,n,r){const i=n[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,n,r,i){for(let s=0,o=n.length;s!==o;++s){const a=n[s],c=r[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,i)}}static seqWithValue(e,n){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in n&&r.push(o)}return r}}function xj(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}const Xoe=37297;let Joe=0;function Qoe(t,e){const n=t.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,n.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${n[o]}`)}return r.join(`
`)}const Cj=new Kr;function Zoe(t){ki._getMatrix(Cj,ki.workingColorSpace,t);const e=`mat3( ${Cj.elements.map(n=>n.toFixed(4))} )`;switch(ki.getTransfer(t)){case SA:return[e,"LinearTransferOETF"];case es:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function Rj(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),i=t.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+i+`

`+Qoe(t.getShaderSource(e),o)}else return i}function eae(t,e){const n=Zoe(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join(`
`)}function tae(t,e){let n;switch(e){case ine:n="Linear";break;case sne:n="Reinhard";break;case one:n="Cineon";break;case p8:n="ACESFilmic";break;case cne:n="AgX";break;case lne:n="Neutral";break;case ane:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Zx=new ht;function nae(){ki.getLuminanceCoefficients(Zx);const t=Zx.x.toFixed(4),e=Zx.y.toFixed(4),n=Zx.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${n} );`,"	return dot( weights, rgb );","}"].join(`
`)}function rae(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(FS).join(`
`)}function iae(t){const e=[];for(const n in t){const r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function sae(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i),o=s.name;let a=1;s.type===t.FLOAT_MAT2&&(a=2),s.type===t.FLOAT_MAT3&&(a=3),s.type===t.FLOAT_MAT4&&(a=4),n[o]={type:s.type,location:t.getAttribLocation(e,o),locationSize:a}}return n}function FS(t){return t!==""}function Aj(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Mj(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const oae=/^[ \t]*#include +<([\w\d./]+)>/gm;function aL(t){return t.replace(oae,cae)}const aae=new Map;function cae(t,e){let n=Yr[e];if(n===void 0){const r=aae.get(e);if(r!==void 0)n=Yr[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return aL(n)}const lae=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ij(t){return t.replace(lae,uae)}function uae(t,e,n,r){let i="";for(let s=parseInt(e);s<parseInt(n);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function Oj(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function dae(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===HU?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===QC?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===zf&&(e="SHADOWMAP_TYPE_VSM"),e}function hae(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case lE:case uE:e="ENVMAP_TYPE_CUBE";break;case bA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function fae(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case uE:e="ENVMAP_MODE_REFRACTION";break}return e}function pae(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case f8:e="ENVMAP_BLENDING_MULTIPLY";break;case nne:e="ENVMAP_BLENDING_MIX";break;case rne:e="ENVMAP_BLENDING_ADD";break}return e}function mae(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:r,maxMip:n}}function gae(t,e,n,r){const i=t.getContext(),s=n.defines;let o=n.vertexShader,a=n.fragmentShader;const c=dae(n),l=hae(n),u=fae(n),d=pae(n),h=mae(n),f=rae(n),p=iae(s),g=i.createProgram();let v,E,T=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(FS).join(`
`),v.length>0&&(v+=`
`),E=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p].filter(FS).join(`
`),E.length>0&&(E+=`
`)):(v=[Oj(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(FS).join(`
`),E=[Oj(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+u:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==ap?"#define TONE_MAPPING":"",n.toneMapping!==ap?Yr.tonemapping_pars_fragment:"",n.toneMapping!==ap?tae("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Yr.colorspace_pars_fragment,eae("linearToOutputTexel",n.outputColorSpace),nae(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(FS).join(`
`)),o=aL(o),o=Aj(o,n),o=Mj(o,n),a=aL(a),a=Aj(a,n),a=Mj(a,n),o=Ij(o),a=Ij(a),n.isRawShaderMaterial!==!0&&(T=`#version 300 es
`,v=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,E=["#define varying in",n.glslVersion===V4?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===V4?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+E);const C=T+v+o,A=T+E+a,k=xj(i,i.VERTEX_SHADER,C),I=xj(i,i.FRAGMENT_SHADER,A);i.attachShader(g,k),i.attachShader(g,I),n.index0AttributeName!==void 0?i.bindAttribLocation(g,0,n.index0AttributeName):n.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g);function N(X){if(t.debug.checkShaderErrors){const q=i.getProgramInfoLog(g).trim(),W=i.getShaderInfoLog(k).trim(),K=i.getShaderInfoLog(I).trim();let ne=!0,Q=!0;if(i.getProgramParameter(g,i.LINK_STATUS)===!1)if(ne=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(i,g,k,I);else{const ie=Rj(i,k,"vertex"),G=Rj(i,I,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+`

Material Name: `+X.name+`
Material Type: `+X.type+`

Program Info Log: `+q+`
`+ie+`
`+G)}else q!==""?console.warn("THREE.WebGLProgram: Program Info Log:",q):(W===""||K==="")&&(Q=!1);Q&&(X.diagnostics={runnable:ne,programLog:q,vertexShader:{log:W,prefix:v},fragmentShader:{log:K,prefix:E}})}i.deleteShader(k),i.deleteShader(I),U=new i1(i,g),F=sae(i,g)}let U;this.getUniforms=function(){return U===void 0&&N(this),U};let F;this.getAttributes=function(){return F===void 0&&N(this),F};let $=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return $===!1&&($=i.getProgramParameter(g,Xoe)),$},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=Joe++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=k,this.fragmentShader=I,this}let vae=0;class _ae{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(n),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new yae(e),n.set(e,r)),r}}class yae{constructor(e){this.id=vae++,this.code=e,this.usedTimes=0}}function bae(t,e,n,r,i,s,o){const a=new qb,c=new _ae,l=new Set,u=[],d=i.logarithmicDepthBuffer,h=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(F){return l.add(F),F===0?"uv":`uv${F}`}function v(F,$,X,q,W){const K=q.fog,ne=W.geometry,Q=F.isMeshStandardMaterial?q.environment:null,ie=(F.isMeshStandardMaterial?n:e).get(F.envMap||Q),G=ie&&ie.mapping===bA?ie.image.height:null,Z=p[F.type];F.precision!==null&&(f=i.getMaxPrecision(F.precision),f!==F.precision&&console.warn("THREE.WebGLProgram.getParameters:",F.precision,"not supported, using",f,"instead."));const se=ne.morphAttributes.position||ne.morphAttributes.normal||ne.morphAttributes.color,ue=se!==void 0?se.length:0;let Ae=0;ne.morphAttributes.position!==void 0&&(Ae=1),ne.morphAttributes.normal!==void 0&&(Ae=2),ne.morphAttributes.color!==void 0&&(Ae=3);let Be,Se,Pe,we;if(Z){const wt=Kf[Z];Be=wt.vertexShader,Se=wt.fragmentShader}else Be=F.vertexShader,Se=F.fragmentShader,c.update(F),Pe=c.getVertexShaderID(F),we=c.getFragmentShaderID(F);const Te=t.getRenderTarget(),Oe=t.state.buffers.depth.getReversed(),_t=W.isInstancedMesh===!0,Ct=W.isBatchedMesh===!0,me=!!F.map,ge=!!F.matcap,nt=!!ie,Ce=!!F.aoMap,ut=!!F.lightMap,He=!!F.bumpMap,Rt=!!F.normalMap,$t=!!F.displacementMap,Tt=!!F.emissiveMap,Ft=!!F.metalnessMap,Ee=!!F.roughnessMap,le=F.anisotropy>0,We=F.clearcoat>0,it=F.dispersion>0,je=F.iridescence>0,Fe=F.sheen>0,Ht=F.transmission>0,St=le&&!!F.anisotropyMap,Dt=We&&!!F.clearcoatMap,oe=We&&!!F.clearcoatNormalMap,j=We&&!!F.clearcoatRoughnessMap,V=je&&!!F.iridescenceMap,fe=je&&!!F.iridescenceThicknessMap,Ie=Fe&&!!F.sheenColorMap,Ue=Fe&&!!F.sheenRoughnessMap,dt=!!F.specularMap,yt=!!F.specularColorMap,Dn=!!F.specularIntensityMap,Le=Ht&&!!F.transmissionMap,Lt=Ht&&!!F.thicknessMap,rt=!!F.gradientMap,xt=!!F.alphaMap,sn=F.alphaTest>0,Jt=!!F.alphaHash,De=!!F.extensions;let tt=ap;F.toneMapped&&(Te===null||Te.isXRRenderTarget===!0)&&(tt=t.toneMapping);const Et={shaderID:Z,shaderType:F.type,shaderName:F.name,vertexShader:Be,fragmentShader:Se,defines:F.defines,customVertexShaderID:Pe,customFragmentShaderID:we,isRawShaderMaterial:F.isRawShaderMaterial===!0,glslVersion:F.glslVersion,precision:f,batching:Ct,batchingColor:Ct&&W._colorsTexture!==null,instancing:_t,instancingColor:_t&&W.instanceColor!==null,instancingMorph:_t&&W.morphTexture!==null,supportsVertexTextures:h,outputColorSpace:Te===null?t.outputColorSpace:Te.isXRRenderTarget===!0?Te.texture.colorSpace:S_,alphaToCoverage:!!F.alphaToCoverage,map:me,matcap:ge,envMap:nt,envMapMode:nt&&ie.mapping,envMapCubeUVHeight:G,aoMap:Ce,lightMap:ut,bumpMap:He,normalMap:Rt,displacementMap:h&&$t,emissiveMap:Tt,normalMapObjectSpace:Rt&&F.normalMapType===hne,normalMapTangentSpace:Rt&&F.normalMapType===C8,metalnessMap:Ft,roughnessMap:Ee,anisotropy:le,anisotropyMap:St,clearcoat:We,clearcoatMap:Dt,clearcoatNormalMap:oe,clearcoatRoughnessMap:j,dispersion:it,iridescence:je,iridescenceMap:V,iridescenceThicknessMap:fe,sheen:Fe,sheenColorMap:Ie,sheenRoughnessMap:Ue,specularMap:dt,specularColorMap:yt,specularIntensityMap:Dn,transmission:Ht,transmissionMap:Le,thicknessMap:Lt,gradientMap:rt,opaque:F.transparent===!1&&F.blending===Vb&&F.alphaToCoverage===!1,alphaMap:xt,alphaTest:sn,alphaHash:Jt,combine:F.combine,mapUv:me&&g(F.map.channel),aoMapUv:Ce&&g(F.aoMap.channel),lightMapUv:ut&&g(F.lightMap.channel),bumpMapUv:He&&g(F.bumpMap.channel),normalMapUv:Rt&&g(F.normalMap.channel),displacementMapUv:$t&&g(F.displacementMap.channel),emissiveMapUv:Tt&&g(F.emissiveMap.channel),metalnessMapUv:Ft&&g(F.metalnessMap.channel),roughnessMapUv:Ee&&g(F.roughnessMap.channel),anisotropyMapUv:St&&g(F.anisotropyMap.channel),clearcoatMapUv:Dt&&g(F.clearcoatMap.channel),clearcoatNormalMapUv:oe&&g(F.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:j&&g(F.clearcoatRoughnessMap.channel),iridescenceMapUv:V&&g(F.iridescenceMap.channel),iridescenceThicknessMapUv:fe&&g(F.iridescenceThicknessMap.channel),sheenColorMapUv:Ie&&g(F.sheenColorMap.channel),sheenRoughnessMapUv:Ue&&g(F.sheenRoughnessMap.channel),specularMapUv:dt&&g(F.specularMap.channel),specularColorMapUv:yt&&g(F.specularColorMap.channel),specularIntensityMapUv:Dn&&g(F.specularIntensityMap.channel),transmissionMapUv:Le&&g(F.transmissionMap.channel),thicknessMapUv:Lt&&g(F.thicknessMap.channel),alphaMapUv:xt&&g(F.alphaMap.channel),vertexTangents:!!ne.attributes.tangent&&(Rt||le),vertexColors:F.vertexColors,vertexAlphas:F.vertexColors===!0&&!!ne.attributes.color&&ne.attributes.color.itemSize===4,pointsUvs:W.isPoints===!0&&!!ne.attributes.uv&&(me||xt),fog:!!K,useFog:F.fog===!0,fogExp2:!!K&&K.isFogExp2,flatShading:F.flatShading===!0,sizeAttenuation:F.sizeAttenuation===!0,logarithmicDepthBuffer:d,reverseDepthBuffer:Oe,skinning:W.isSkinnedMesh===!0,morphTargets:ne.morphAttributes.position!==void 0,morphNormals:ne.morphAttributes.normal!==void 0,morphColors:ne.morphAttributes.color!==void 0,morphTargetsCount:ue,morphTextureStride:Ae,numDirLights:$.directional.length,numPointLights:$.point.length,numSpotLights:$.spot.length,numSpotLightMaps:$.spotLightMap.length,numRectAreaLights:$.rectArea.length,numHemiLights:$.hemi.length,numDirLightShadows:$.directionalShadowMap.length,numPointLightShadows:$.pointShadowMap.length,numSpotLightShadows:$.spotShadowMap.length,numSpotLightShadowsWithMaps:$.numSpotLightShadowsWithMaps,numLightProbes:$.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:F.dithering,shadowMapEnabled:t.shadowMap.enabled&&X.length>0,shadowMapType:t.shadowMap.type,toneMapping:tt,decodeVideoTexture:me&&F.map.isVideoTexture===!0&&ki.getTransfer(F.map.colorSpace)===es,decodeVideoTextureEmissive:Tt&&F.emissiveMap.isVideoTexture===!0&&ki.getTransfer(F.emissiveMap.colorSpace)===es,premultipliedAlpha:F.premultipliedAlpha,doubleSided:F.side===$u,flipSided:F.side===ec,useDepthPacking:F.depthPacking>=0,depthPacking:F.depthPacking||0,index0AttributeName:F.index0AttributeName,extensionClipCullDistance:De&&F.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(De&&F.extensions.multiDraw===!0||Ct)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:F.customProgramCacheKey()};return Et.vertexUv1s=l.has(1),Et.vertexUv2s=l.has(2),Et.vertexUv3s=l.has(3),l.clear(),Et}function E(F){const $=[];if(F.shaderID?$.push(F.shaderID):($.push(F.customVertexShaderID),$.push(F.customFragmentShaderID)),F.defines!==void 0)for(const X in F.defines)$.push(X),$.push(F.defines[X]);return F.isRawShaderMaterial===!1&&(T($,F),C($,F),$.push(t.outputColorSpace)),$.push(F.customProgramCacheKey),$.join()}function T(F,$){F.push($.precision),F.push($.outputColorSpace),F.push($.envMapMode),F.push($.envMapCubeUVHeight),F.push($.mapUv),F.push($.alphaMapUv),F.push($.lightMapUv),F.push($.aoMapUv),F.push($.bumpMapUv),F.push($.normalMapUv),F.push($.displacementMapUv),F.push($.emissiveMapUv),F.push($.metalnessMapUv),F.push($.roughnessMapUv),F.push($.anisotropyMapUv),F.push($.clearcoatMapUv),F.push($.clearcoatNormalMapUv),F.push($.clearcoatRoughnessMapUv),F.push($.iridescenceMapUv),F.push($.iridescenceThicknessMapUv),F.push($.sheenColorMapUv),F.push($.sheenRoughnessMapUv),F.push($.specularMapUv),F.push($.specularColorMapUv),F.push($.specularIntensityMapUv),F.push($.transmissionMapUv),F.push($.thicknessMapUv),F.push($.combine),F.push($.fogExp2),F.push($.sizeAttenuation),F.push($.morphTargetsCount),F.push($.morphAttributeCount),F.push($.numDirLights),F.push($.numPointLights),F.push($.numSpotLights),F.push($.numSpotLightMaps),F.push($.numHemiLights),F.push($.numRectAreaLights),F.push($.numDirLightShadows),F.push($.numPointLightShadows),F.push($.numSpotLightShadows),F.push($.numSpotLightShadowsWithMaps),F.push($.numLightProbes),F.push($.shadowMapType),F.push($.toneMapping),F.push($.numClippingPlanes),F.push($.numClipIntersection),F.push($.depthPacking)}function C(F,$){a.disableAll(),$.supportsVertexTextures&&a.enable(0),$.instancing&&a.enable(1),$.instancingColor&&a.enable(2),$.instancingMorph&&a.enable(3),$.matcap&&a.enable(4),$.envMap&&a.enable(5),$.normalMapObjectSpace&&a.enable(6),$.normalMapTangentSpace&&a.enable(7),$.clearcoat&&a.enable(8),$.iridescence&&a.enable(9),$.alphaTest&&a.enable(10),$.vertexColors&&a.enable(11),$.vertexAlphas&&a.enable(12),$.vertexUv1s&&a.enable(13),$.vertexUv2s&&a.enable(14),$.vertexUv3s&&a.enable(15),$.vertexTangents&&a.enable(16),$.anisotropy&&a.enable(17),$.alphaHash&&a.enable(18),$.batching&&a.enable(19),$.dispersion&&a.enable(20),$.batchingColor&&a.enable(21),F.push(a.mask),a.disableAll(),$.fog&&a.enable(0),$.useFog&&a.enable(1),$.flatShading&&a.enable(2),$.logarithmicDepthBuffer&&a.enable(3),$.reverseDepthBuffer&&a.enable(4),$.skinning&&a.enable(5),$.morphTargets&&a.enable(6),$.morphNormals&&a.enable(7),$.morphColors&&a.enable(8),$.premultipliedAlpha&&a.enable(9),$.shadowMapEnabled&&a.enable(10),$.doubleSided&&a.enable(11),$.flipSided&&a.enable(12),$.useDepthPacking&&a.enable(13),$.dithering&&a.enable(14),$.transmission&&a.enable(15),$.sheen&&a.enable(16),$.opaque&&a.enable(17),$.pointsUvs&&a.enable(18),$.decodeVideoTexture&&a.enable(19),$.decodeVideoTextureEmissive&&a.enable(20),$.alphaToCoverage&&a.enable(21),F.push(a.mask)}function A(F){const $=p[F.type];let X;if($){const q=Kf[$];X=rre.clone(q.uniforms)}else X=F.uniforms;return X}function k(F,$){let X;for(let q=0,W=u.length;q<W;q++){const K=u[q];if(K.cacheKey===$){X=K,++X.usedTimes;break}}return X===void 0&&(X=new gae(t,$,F,s),u.push(X)),X}function I(F){if(--F.usedTimes===0){const $=u.indexOf(F);u[$]=u[u.length-1],u.pop(),F.destroy()}}function N(F){c.remove(F)}function U(){c.dispose()}return{getParameters:v,getProgramCacheKey:E,getUniforms:A,acquireProgram:k,releaseProgram:I,releaseShaderCache:N,programs:u,dispose:U}}function Eae(){let t=new WeakMap;function e(o){return t.has(o)}function n(o){let a=t.get(o);return a===void 0&&(a={},t.set(o,a)),a}function r(o){t.delete(o)}function i(o,a,c){t.get(o)[a]=c}function s(){t=new WeakMap}return{has:e,get:n,remove:r,update:i,dispose:s}}function Sae(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function kj(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Nj(){const t=[];let e=0;const n=[],r=[],i=[];function s(){e=0,n.length=0,r.length=0,i.length=0}function o(d,h,f,p,g,v){let E=t[e];return E===void 0?(E={id:d.id,object:d,geometry:h,material:f,groupOrder:p,renderOrder:d.renderOrder,z:g,group:v},t[e]=E):(E.id=d.id,E.object=d,E.geometry=h,E.material=f,E.groupOrder=p,E.renderOrder=d.renderOrder,E.z=g,E.group=v),e++,E}function a(d,h,f,p,g,v){const E=o(d,h,f,p,g,v);f.transmission>0?r.push(E):f.transparent===!0?i.push(E):n.push(E)}function c(d,h,f,p,g,v){const E=o(d,h,f,p,g,v);f.transmission>0?r.unshift(E):f.transparent===!0?i.unshift(E):n.unshift(E)}function l(d,h){n.length>1&&n.sort(d||Sae),r.length>1&&r.sort(h||kj),i.length>1&&i.sort(h||kj)}function u(){for(let d=e,h=t.length;d<h;d++){const f=t[d];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:n,transmissive:r,transparent:i,init:s,push:a,unshift:c,finish:u,sort:l}}function wae(){let t=new WeakMap;function e(r,i){const s=t.get(r);let o;return s===void 0?(o=new Nj,t.set(r,[o])):i>=s.length?(o=new Nj,s.push(o)):o=s[i],o}function n(){t=new WeakMap}return{get:e,dispose:n}}function Tae(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new ht,color:new bi};break;case"SpotLight":n={position:new ht,direction:new ht,color:new bi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ht,color:new bi,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ht,skyColor:new bi,groundColor:new bi};break;case"RectAreaLight":n={color:new bi,position:new ht,halfWidth:new ht,halfHeight:new ht};break}return t[e.id]=n,n}}}function xae(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn};break;case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vn,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let Cae=0;function Rae(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Aae(t){const e=new Tae,n=xae(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new ht);const i=new ht,s=new To,o=new To;function a(l){let u=0,d=0,h=0;for(let F=0;F<9;F++)r.probe[F].set(0,0,0);let f=0,p=0,g=0,v=0,E=0,T=0,C=0,A=0,k=0,I=0,N=0;l.sort(Rae);for(let F=0,$=l.length;F<$;F++){const X=l[F],q=X.color,W=X.intensity,K=X.distance,ne=X.shadow&&X.shadow.map?X.shadow.map.texture:null;if(X.isAmbientLight)u+=q.r*W,d+=q.g*W,h+=q.b*W;else if(X.isLightProbe){for(let Q=0;Q<9;Q++)r.probe[Q].addScaledVector(X.sh.coefficients[Q],W);N++}else if(X.isDirectionalLight){const Q=e.get(X);if(Q.color.copy(X.color).multiplyScalar(X.intensity),X.castShadow){const ie=X.shadow,G=n.get(X);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,r.directionalShadow[f]=G,r.directionalShadowMap[f]=ne,r.directionalShadowMatrix[f]=X.shadow.matrix,T++}r.directional[f]=Q,f++}else if(X.isSpotLight){const Q=e.get(X);Q.position.setFromMatrixPosition(X.matrixWorld),Q.color.copy(q).multiplyScalar(W),Q.distance=K,Q.coneCos=Math.cos(X.angle),Q.penumbraCos=Math.cos(X.angle*(1-X.penumbra)),Q.decay=X.decay,r.spot[g]=Q;const ie=X.shadow;if(X.map&&(r.spotLightMap[k]=X.map,k++,ie.updateMatrices(X),X.castShadow&&I++),r.spotLightMatrix[g]=ie.matrix,X.castShadow){const G=n.get(X);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,r.spotShadow[g]=G,r.spotShadowMap[g]=ne,A++}g++}else if(X.isRectAreaLight){const Q=e.get(X);Q.color.copy(q).multiplyScalar(W),Q.halfWidth.set(X.width*.5,0,0),Q.halfHeight.set(0,X.height*.5,0),r.rectArea[v]=Q,v++}else if(X.isPointLight){const Q=e.get(X);if(Q.color.copy(X.color).multiplyScalar(X.intensity),Q.distance=X.distance,Q.decay=X.decay,X.castShadow){const ie=X.shadow,G=n.get(X);G.shadowIntensity=ie.intensity,G.shadowBias=ie.bias,G.shadowNormalBias=ie.normalBias,G.shadowRadius=ie.radius,G.shadowMapSize=ie.mapSize,G.shadowCameraNear=ie.camera.near,G.shadowCameraFar=ie.camera.far,r.pointShadow[p]=G,r.pointShadowMap[p]=ne,r.pointShadowMatrix[p]=X.shadow.matrix,C++}r.point[p]=Q,p++}else if(X.isHemisphereLight){const Q=e.get(X);Q.skyColor.copy(X.color).multiplyScalar(W),Q.groundColor.copy(X.groundColor).multiplyScalar(W),r.hemi[E]=Q,E++}}v>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=un.LTC_FLOAT_1,r.rectAreaLTC2=un.LTC_FLOAT_2):(r.rectAreaLTC1=un.LTC_HALF_1,r.rectAreaLTC2=un.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=d,r.ambient[2]=h;const U=r.hash;(U.directionalLength!==f||U.pointLength!==p||U.spotLength!==g||U.rectAreaLength!==v||U.hemiLength!==E||U.numDirectionalShadows!==T||U.numPointShadows!==C||U.numSpotShadows!==A||U.numSpotMaps!==k||U.numLightProbes!==N)&&(r.directional.length=f,r.spot.length=g,r.rectArea.length=v,r.point.length=p,r.hemi.length=E,r.directionalShadow.length=T,r.directionalShadowMap.length=T,r.pointShadow.length=C,r.pointShadowMap.length=C,r.spotShadow.length=A,r.spotShadowMap.length=A,r.directionalShadowMatrix.length=T,r.pointShadowMatrix.length=C,r.spotLightMatrix.length=A+k-I,r.spotLightMap.length=k,r.numSpotLightShadowsWithMaps=I,r.numLightProbes=N,U.directionalLength=f,U.pointLength=p,U.spotLength=g,U.rectAreaLength=v,U.hemiLength=E,U.numDirectionalShadows=T,U.numPointShadows=C,U.numSpotShadows=A,U.numSpotMaps=k,U.numLightProbes=N,r.version=Cae++)}function c(l,u){let d=0,h=0,f=0,p=0,g=0;const v=u.matrixWorldInverse;for(let E=0,T=l.length;E<T;E++){const C=l[E];if(C.isDirectionalLight){const A=r.directional[d];A.direction.setFromMatrixPosition(C.matrixWorld),i.setFromMatrixPosition(C.target.matrixWorld),A.direction.sub(i),A.direction.transformDirection(v),d++}else if(C.isSpotLight){const A=r.spot[f];A.position.setFromMatrixPosition(C.matrixWorld),A.position.applyMatrix4(v),A.direction.setFromMatrixPosition(C.matrixWorld),i.setFromMatrixPosition(C.target.matrixWorld),A.direction.sub(i),A.direction.transformDirection(v),f++}else if(C.isRectAreaLight){const A=r.rectArea[p];A.position.setFromMatrixPosition(C.matrixWorld),A.position.applyMatrix4(v),o.identity(),s.copy(C.matrixWorld),s.premultiply(v),o.extractRotation(s),A.halfWidth.set(C.width*.5,0,0),A.halfHeight.set(0,C.height*.5,0),A.halfWidth.applyMatrix4(o),A.halfHeight.applyMatrix4(o),p++}else if(C.isPointLight){const A=r.point[h];A.position.setFromMatrixPosition(C.matrixWorld),A.position.applyMatrix4(v),h++}else if(C.isHemisphereLight){const A=r.hemi[g];A.direction.setFromMatrixPosition(C.matrixWorld),A.direction.transformDirection(v),g++}}}return{setup:a,setupView:c,state:r}}function Pj(t){const e=new Aae(t),n=[],r=[];function i(u){l.camera=u,n.length=0,r.length=0}function s(u){n.push(u)}function o(u){r.push(u)}function a(){e.setup(n)}function c(u){e.setupView(n,u)}const l={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function Mae(t){let e=new WeakMap;function n(i,s=0){const o=e.get(i);let a;return o===void 0?(a=new Pj(t),e.set(i,[a])):s>=o.length?(a=new Pj(t),o.push(a)):a=o[s],a}function r(){e=new WeakMap}return{get:n,dispose:r}}class Iae extends fg{static get type(){return"MeshDepthMaterial"}constructor(e){super(),this.isMeshDepthMaterial=!0,this.depthPacking=uy,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Oae extends fg{static get type(){return"MeshDistanceMaterial"}constructor(e){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const kae=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Nae=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Pae(t,e,n){let r=new L8;const i=new Vn,s=new Vn,o=new Fo,a=new Iae({depthPacking:dne}),c=new Oae,l={},u=n.maxTextureSize,d={[ng]:ec,[ec]:ng,[$u]:$u},h=new Al({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vn},radius:{value:4}},vertexShader:kae,fragmentShader:Nae}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new qh;p.setAttribute("position",new oo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Ih(p,h),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=HU;let E=this.type;this.render=function(I,N,U){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||I.length===0)return;const F=t.getRenderTarget(),$=t.getActiveCubeFace(),X=t.getActiveMipmapLevel(),q=t.state;q.setBlending(Dh),q.buffers.color.setClear(1,1,1,1),q.buffers.depth.setTest(!0),q.setScissorTest(!1);const W=E!==zf&&this.type===zf,K=E===zf&&this.type!==zf;for(let ne=0,Q=I.length;ne<Q;ne++){const ie=I[ne],G=ie.shadow;if(G===void 0){console.warn("THREE.WebGLShadowMap:",ie,"has no shadow.");continue}if(G.autoUpdate===!1&&G.needsUpdate===!1)continue;i.copy(G.mapSize);const Z=G.getFrameExtents();if(i.multiply(Z),s.copy(G.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/Z.x),i.x=s.x*Z.x,G.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/Z.y),i.y=s.y*Z.y,G.mapSize.y=s.y)),G.map===null||W===!0||K===!0){const ue=this.type!==zf?{minFilter:Bo,magFilter:Bo}:{};G.map!==null&&G.map.dispose(),G.map=new Ku(i.x,i.y,ue),G.map.texture.name=ie.name+".shadowMap",G.camera.updateProjectionMatrix()}t.setRenderTarget(G.map),t.clear();const se=G.getViewportCount();for(let ue=0;ue<se;ue++){const Ae=G.getViewport(ue);o.set(s.x*Ae.x,s.y*Ae.y,s.x*Ae.z,s.y*Ae.w),q.viewport(o),G.updateMatrices(ie,ue),r=G.getFrustum(),A(N,U,G.camera,ie,this.type)}G.isPointLightShadow!==!0&&this.type===zf&&T(G,U),G.needsUpdate=!1}E=this.type,v.needsUpdate=!1,t.setRenderTarget(F,$,X)};function T(I,N){const U=e.update(g);h.defines.VSM_SAMPLES!==I.blurSamples&&(h.defines.VSM_SAMPLES=I.blurSamples,f.defines.VSM_SAMPLES=I.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),I.mapPass===null&&(I.mapPass=new Ku(i.x,i.y)),h.uniforms.shadow_pass.value=I.map.texture,h.uniforms.resolution.value=I.mapSize,h.uniforms.radius.value=I.radius,t.setRenderTarget(I.mapPass),t.clear(),t.renderBufferDirect(N,null,U,h,g,null),f.uniforms.shadow_pass.value=I.mapPass.texture,f.uniforms.resolution.value=I.mapSize,f.uniforms.radius.value=I.radius,t.setRenderTarget(I.map),t.clear(),t.renderBufferDirect(N,null,U,f,g,null)}function C(I,N,U,F){let $=null;const X=U.isPointLight===!0?I.customDistanceMaterial:I.customDepthMaterial;if(X!==void 0)$=X;else if($=U.isPointLight===!0?c:a,t.localClippingEnabled&&N.clipShadows===!0&&Array.isArray(N.clippingPlanes)&&N.clippingPlanes.length!==0||N.displacementMap&&N.displacementScale!==0||N.alphaMap&&N.alphaTest>0||N.map&&N.alphaTest>0){const q=$.uuid,W=N.uuid;let K=l[q];K===void 0&&(K={},l[q]=K);let ne=K[W];ne===void 0&&(ne=$.clone(),K[W]=ne,N.addEventListener("dispose",k)),$=ne}if($.visible=N.visible,$.wireframe=N.wireframe,F===zf?$.side=N.shadowSide!==null?N.shadowSide:N.side:$.side=N.shadowSide!==null?N.shadowSide:d[N.side],$.alphaMap=N.alphaMap,$.alphaTest=N.alphaTest,$.map=N.map,$.clipShadows=N.clipShadows,$.clippingPlanes=N.clippingPlanes,$.clipIntersection=N.clipIntersection,$.displacementMap=N.displacementMap,$.displacementScale=N.displacementScale,$.displacementBias=N.displacementBias,$.wireframeLinewidth=N.wireframeLinewidth,$.linewidth=N.linewidth,U.isPointLight===!0&&$.isMeshDistanceMaterial===!0){const q=t.properties.get($);q.light=U}return $}function A(I,N,U,F,$){if(I.visible===!1)return;if(I.layers.test(N.layers)&&(I.isMesh||I.isLine||I.isPoints)&&(I.castShadow||I.receiveShadow&&$===zf)&&(!I.frustumCulled||r.intersectsObject(I))){I.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,I.matrixWorld);const W=e.update(I),K=I.material;if(Array.isArray(K)){const ne=W.groups;for(let Q=0,ie=ne.length;Q<ie;Q++){const G=ne[Q],Z=K[G.materialIndex];if(Z&&Z.visible){const se=C(I,Z,F,$);I.onBeforeShadow(t,I,N,U,W,se,G),t.renderBufferDirect(U,null,W,se,I,G),I.onAfterShadow(t,I,N,U,W,se,G)}}}else if(K.visible){const ne=C(I,K,F,$);I.onBeforeShadow(t,I,N,U,W,ne,null),t.renderBufferDirect(U,null,W,ne,I,null),I.onAfterShadow(t,I,N,U,W,ne,null)}}const q=I.children;for(let W=0,K=q.length;W<K;W++)A(q[W],N,U,F,$)}function k(I){I.target.removeEventListener("dispose",k);for(const U in l){const F=l[U],$=I.target.uuid;$ in F&&(F[$].dispose(),delete F[$])}}}const Dae={[TD]:xD,[CD]:MD,[RD]:ID,[cE]:AD,[xD]:TD,[MD]:CD,[ID]:RD,[AD]:cE};function Lae(t,e){function n(){let Le=!1;const Lt=new Fo;let rt=null;const xt=new Fo(0,0,0,0);return{setMask:function(sn){rt!==sn&&!Le&&(t.colorMask(sn,sn,sn,sn),rt=sn)},setLocked:function(sn){Le=sn},setClear:function(sn,Jt,De,tt,Et){Et===!0&&(sn*=tt,Jt*=tt,De*=tt),Lt.set(sn,Jt,De,tt),xt.equals(Lt)===!1&&(t.clearColor(sn,Jt,De,tt),xt.copy(Lt))},reset:function(){Le=!1,rt=null,xt.set(-1,0,0,0)}}}function r(){let Le=!1,Lt=!1,rt=null,xt=null,sn=null;return{setReversed:function(Jt){if(Lt!==Jt){const De=e.get("EXT_clip_control");Lt?De.clipControlEXT(De.LOWER_LEFT_EXT,De.ZERO_TO_ONE_EXT):De.clipControlEXT(De.LOWER_LEFT_EXT,De.NEGATIVE_ONE_TO_ONE_EXT);const tt=sn;sn=null,this.setClear(tt)}Lt=Jt},getReversed:function(){return Lt},setTest:function(Jt){Jt?Te(t.DEPTH_TEST):Oe(t.DEPTH_TEST)},setMask:function(Jt){rt!==Jt&&!Le&&(t.depthMask(Jt),rt=Jt)},setFunc:function(Jt){if(Lt&&(Jt=Dae[Jt]),xt!==Jt){switch(Jt){case TD:t.depthFunc(t.NEVER);break;case xD:t.depthFunc(t.ALWAYS);break;case CD:t.depthFunc(t.LESS);break;case cE:t.depthFunc(t.LEQUAL);break;case RD:t.depthFunc(t.EQUAL);break;case AD:t.depthFunc(t.GEQUAL);break;case MD:t.depthFunc(t.GREATER);break;case ID:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}xt=Jt}},setLocked:function(Jt){Le=Jt},setClear:function(Jt){sn!==Jt&&(Lt&&(Jt=1-Jt),t.clearDepth(Jt),sn=Jt)},reset:function(){Le=!1,rt=null,xt=null,sn=null,Lt=!1}}}function i(){let Le=!1,Lt=null,rt=null,xt=null,sn=null,Jt=null,De=null,tt=null,Et=null;return{setTest:function(wt){Le||(wt?Te(t.STENCIL_TEST):Oe(t.STENCIL_TEST))},setMask:function(wt){Lt!==wt&&!Le&&(t.stencilMask(wt),Lt=wt)},setFunc:function(wt,Pn,Xr){(rt!==wt||xt!==Pn||sn!==Xr)&&(t.stencilFunc(wt,Pn,Xr),rt=wt,xt=Pn,sn=Xr)},setOp:function(wt,Pn,Xr){(Jt!==wt||De!==Pn||tt!==Xr)&&(t.stencilOp(wt,Pn,Xr),Jt=wt,De=Pn,tt=Xr)},setLocked:function(wt){Le=wt},setClear:function(wt){Et!==wt&&(t.clearStencil(wt),Et=wt)},reset:function(){Le=!1,Lt=null,rt=null,xt=null,sn=null,Jt=null,De=null,tt=null,Et=null}}}const s=new n,o=new r,a=new i,c=new WeakMap,l=new WeakMap;let u={},d={},h=new WeakMap,f=[],p=null,g=!1,v=null,E=null,T=null,C=null,A=null,k=null,I=null,N=new bi(0,0,0),U=0,F=!1,$=null,X=null,q=null,W=null,K=null;const ne=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Q=!1,ie=0;const G=t.getParameter(t.VERSION);G.indexOf("WebGL")!==-1?(ie=parseFloat(/^WebGL (\d)/.exec(G)[1]),Q=ie>=1):G.indexOf("OpenGL ES")!==-1&&(ie=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),Q=ie>=2);let Z=null,se={};const ue=t.getParameter(t.SCISSOR_BOX),Ae=t.getParameter(t.VIEWPORT),Be=new Fo().fromArray(ue),Se=new Fo().fromArray(Ae);function Pe(Le,Lt,rt,xt){const sn=new Uint8Array(4),Jt=t.createTexture();t.bindTexture(Le,Jt),t.texParameteri(Le,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(Le,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let De=0;De<rt;De++)Le===t.TEXTURE_3D||Le===t.TEXTURE_2D_ARRAY?t.texImage3D(Lt,0,t.RGBA,1,1,xt,0,t.RGBA,t.UNSIGNED_BYTE,sn):t.texImage2D(Lt+De,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,sn);return Jt}const we={};we[t.TEXTURE_2D]=Pe(t.TEXTURE_2D,t.TEXTURE_2D,1),we[t.TEXTURE_CUBE_MAP]=Pe(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),we[t.TEXTURE_2D_ARRAY]=Pe(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),we[t.TEXTURE_3D]=Pe(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Te(t.DEPTH_TEST),o.setFunc(cE),He(!1),Rt(U4),Te(t.CULL_FACE),Ce(Dh);function Te(Le){u[Le]!==!0&&(t.enable(Le),u[Le]=!0)}function Oe(Le){u[Le]!==!1&&(t.disable(Le),u[Le]=!1)}function _t(Le,Lt){return d[Le]!==Lt?(t.bindFramebuffer(Le,Lt),d[Le]=Lt,Le===t.DRAW_FRAMEBUFFER&&(d[t.FRAMEBUFFER]=Lt),Le===t.FRAMEBUFFER&&(d[t.DRAW_FRAMEBUFFER]=Lt),!0):!1}function Ct(Le,Lt){let rt=f,xt=!1;if(Le){rt=h.get(Lt),rt===void 0&&(rt=[],h.set(Lt,rt));const sn=Le.textures;if(rt.length!==sn.length||rt[0]!==t.COLOR_ATTACHMENT0){for(let Jt=0,De=sn.length;Jt<De;Jt++)rt[Jt]=t.COLOR_ATTACHMENT0+Jt;rt.length=sn.length,xt=!0}}else rt[0]!==t.BACK&&(rt[0]=t.BACK,xt=!0);xt&&t.drawBuffers(rt)}function me(Le){return p!==Le?(t.useProgram(Le),p=Le,!0):!1}const ge={[S0]:t.FUNC_ADD,[Bte]:t.FUNC_SUBTRACT,[jte]:t.FUNC_REVERSE_SUBTRACT};ge[$te]=t.MIN,ge[Hte]=t.MAX;const nt={[Vte]:t.ZERO,[zte]:t.ONE,[Gte]:t.SRC_COLOR,[SD]:t.SRC_ALPHA,[Jte]:t.SRC_ALPHA_SATURATE,[Yte]:t.DST_COLOR,[Wte]:t.DST_ALPHA,[qte]:t.ONE_MINUS_SRC_COLOR,[wD]:t.ONE_MINUS_SRC_ALPHA,[Xte]:t.ONE_MINUS_DST_COLOR,[Kte]:t.ONE_MINUS_DST_ALPHA,[Qte]:t.CONSTANT_COLOR,[Zte]:t.ONE_MINUS_CONSTANT_COLOR,[ene]:t.CONSTANT_ALPHA,[tne]:t.ONE_MINUS_CONSTANT_ALPHA};function Ce(Le,Lt,rt,xt,sn,Jt,De,tt,Et,wt){if(Le===Dh){g===!0&&(Oe(t.BLEND),g=!1);return}if(g===!1&&(Te(t.BLEND),g=!0),Le!==Fte){if(Le!==v||wt!==F){if((E!==S0||A!==S0)&&(t.blendEquation(t.FUNC_ADD),E=S0,A=S0),wt)switch(Le){case Vb:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case F4:t.blendFunc(t.ONE,t.ONE);break;case B4:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case j4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Le);break}else switch(Le){case Vb:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case F4:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case B4:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case j4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Le);break}T=null,C=null,k=null,I=null,N.set(0,0,0),U=0,v=Le,F=wt}return}sn=sn||Lt,Jt=Jt||rt,De=De||xt,(Lt!==E||sn!==A)&&(t.blendEquationSeparate(ge[Lt],ge[sn]),E=Lt,A=sn),(rt!==T||xt!==C||Jt!==k||De!==I)&&(t.blendFuncSeparate(nt[rt],nt[xt],nt[Jt],nt[De]),T=rt,C=xt,k=Jt,I=De),(tt.equals(N)===!1||Et!==U)&&(t.blendColor(tt.r,tt.g,tt.b,Et),N.copy(tt),U=Et),v=Le,F=!1}function ut(Le,Lt){Le.side===$u?Oe(t.CULL_FACE):Te(t.CULL_FACE);let rt=Le.side===ec;Lt&&(rt=!rt),He(rt),Le.blending===Vb&&Le.transparent===!1?Ce(Dh):Ce(Le.blending,Le.blendEquation,Le.blendSrc,Le.blendDst,Le.blendEquationAlpha,Le.blendSrcAlpha,Le.blendDstAlpha,Le.blendColor,Le.blendAlpha,Le.premultipliedAlpha),o.setFunc(Le.depthFunc),o.setTest(Le.depthTest),o.setMask(Le.depthWrite),s.setMask(Le.colorWrite);const xt=Le.stencilWrite;a.setTest(xt),xt&&(a.setMask(Le.stencilWriteMask),a.setFunc(Le.stencilFunc,Le.stencilRef,Le.stencilFuncMask),a.setOp(Le.stencilFail,Le.stencilZFail,Le.stencilZPass)),Tt(Le.polygonOffset,Le.polygonOffsetFactor,Le.polygonOffsetUnits),Le.alphaToCoverage===!0?Te(t.SAMPLE_ALPHA_TO_COVERAGE):Oe(t.SAMPLE_ALPHA_TO_COVERAGE)}function He(Le){$!==Le&&(Le?t.frontFace(t.CW):t.frontFace(t.CCW),$=Le)}function Rt(Le){Le!==Dte?(Te(t.CULL_FACE),Le!==X&&(Le===U4?t.cullFace(t.BACK):Le===Lte?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):Oe(t.CULL_FACE),X=Le}function $t(Le){Le!==q&&(Q&&t.lineWidth(Le),q=Le)}function Tt(Le,Lt,rt){Le?(Te(t.POLYGON_OFFSET_FILL),(W!==Lt||K!==rt)&&(t.polygonOffset(Lt,rt),W=Lt,K=rt)):Oe(t.POLYGON_OFFSET_FILL)}function Ft(Le){Le?Te(t.SCISSOR_TEST):Oe(t.SCISSOR_TEST)}function Ee(Le){Le===void 0&&(Le=t.TEXTURE0+ne-1),Z!==Le&&(t.activeTexture(Le),Z=Le)}function le(Le,Lt,rt){rt===void 0&&(Z===null?rt=t.TEXTURE0+ne-1:rt=Z);let xt=se[rt];xt===void 0&&(xt={type:void 0,texture:void 0},se[rt]=xt),(xt.type!==Le||xt.texture!==Lt)&&(Z!==rt&&(t.activeTexture(rt),Z=rt),t.bindTexture(Le,Lt||we[Le]),xt.type=Le,xt.texture=Lt)}function We(){const Le=se[Z];Le!==void 0&&Le.type!==void 0&&(t.bindTexture(Le.type,null),Le.type=void 0,Le.texture=void 0)}function it(){try{t.compressedTexImage2D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function je(){try{t.compressedTexImage3D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function Fe(){try{t.texSubImage2D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function Ht(){try{t.texSubImage3D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function St(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function Dt(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function oe(){try{t.texStorage2D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function j(){try{t.texStorage3D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function V(){try{t.texImage2D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function fe(){try{t.texImage3D.apply(t,arguments)}catch(Le){console.error("THREE.WebGLState:",Le)}}function Ie(Le){Be.equals(Le)===!1&&(t.scissor(Le.x,Le.y,Le.z,Le.w),Be.copy(Le))}function Ue(Le){Se.equals(Le)===!1&&(t.viewport(Le.x,Le.y,Le.z,Le.w),Se.copy(Le))}function dt(Le,Lt){let rt=l.get(Lt);rt===void 0&&(rt=new WeakMap,l.set(Lt,rt));let xt=rt.get(Le);xt===void 0&&(xt=t.getUniformBlockIndex(Lt,Le.name),rt.set(Le,xt))}function yt(Le,Lt){const xt=l.get(Lt).get(Le);c.get(Lt)!==xt&&(t.uniformBlockBinding(Lt,xt,Le.__bindingPointIndex),c.set(Lt,xt))}function Dn(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),o.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},Z=null,se={},d={},h=new WeakMap,f=[],p=null,g=!1,v=null,E=null,T=null,C=null,A=null,k=null,I=null,N=new bi(0,0,0),U=0,F=!1,$=null,X=null,q=null,W=null,K=null,Be.set(0,0,t.canvas.width,t.canvas.height),Se.set(0,0,t.canvas.width,t.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Te,disable:Oe,bindFramebuffer:_t,drawBuffers:Ct,useProgram:me,setBlending:Ce,setMaterial:ut,setFlipSided:He,setCullFace:Rt,setLineWidth:$t,setPolygonOffset:Tt,setScissorTest:Ft,activeTexture:Ee,bindTexture:le,unbindTexture:We,compressedTexImage2D:it,compressedTexImage3D:je,texImage2D:V,texImage3D:fe,updateUBOMapping:dt,uniformBlockBinding:yt,texStorage2D:oe,texStorage3D:j,texSubImage2D:Fe,texSubImage3D:Ht,compressedTexSubImage2D:St,compressedTexSubImage3D:Dt,scissor:Ie,viewport:Ue,reset:Dn}}function Dj(t,e,n,r){const i=Uae(r);switch(n){case y8:return t*e;case E8:return t*e;case S8:return t*e*2;case w8:return t*e/i.components*i.byteLength;case qU:return t*e/i.components*i.byteLength;case T8:return t*e*2/i.components*i.byteLength;case WU:return t*e*2/i.components*i.byteLength;case b8:return t*e*3/i.components*i.byteLength;case Cd:return t*e*4/i.components*i.byteLength;case EA:return t*e*4/i.components*i.byteLength;case ZC:case e1:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case t1:case n1:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case LD:case FD:return Math.max(t,16)*Math.max(e,8)/4;case DD:case UD:return Math.max(t,8)*Math.max(e,8)/2;case BD:case jD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case $D:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case HD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case VD:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case zD:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case GD:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case qD:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case WD:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case KD:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case YD:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case XD:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case JD:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case QD:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case ZD:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case eL:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case tL:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case r1:case nL:case rL:return Math.ceil(t/4)*Math.ceil(e/4)*16;case x8:case iL:return Math.ceil(t/4)*Math.ceil(e/4)*8;case sL:case oL:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function Uae(t){switch(t){case Gc:case g8:return{byteLength:1,components:1};case fw:case v8:case GE:return{byteLength:2,components:1};case zU:case GU:return{byteLength:2,components:4};case s_:case VU:case sp:return{byteLength:4,components:1};case _8:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}function Fae(t,e,n,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Vn,u=new WeakMap;let d;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(Ee,le){return f?new OffscreenCanvas(Ee,le):mw("canvas")}function g(Ee,le,We){let it=1;const je=Ft(Ee);if((je.width>We||je.height>We)&&(it=We/Math.max(je.width,je.height)),it<1)if(typeof HTMLImageElement<"u"&&Ee instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ee instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ee instanceof ImageBitmap||typeof VideoFrame<"u"&&Ee instanceof VideoFrame){const Fe=Math.floor(it*je.width),Ht=Math.floor(it*je.height);d===void 0&&(d=p(Fe,Ht));const St=le?p(Fe,Ht):d;return St.width=Fe,St.height=Ht,St.getContext("2d").drawImage(Ee,0,0,Fe,Ht),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+je.width+"x"+je.height+") to ("+Fe+"x"+Ht+")."),St}else return"data"in Ee&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+je.width+"x"+je.height+")."),Ee;return Ee}function v(Ee){return Ee.generateMipmaps}function E(Ee){t.generateMipmap(Ee)}function T(Ee){return Ee.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:Ee.isWebGL3DRenderTarget?t.TEXTURE_3D:Ee.isWebGLArrayRenderTarget||Ee.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function C(Ee,le,We,it,je=!1){if(Ee!==null){if(t[Ee]!==void 0)return t[Ee];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ee+"'")}let Fe=le;if(le===t.RED&&(We===t.FLOAT&&(Fe=t.R32F),We===t.HALF_FLOAT&&(Fe=t.R16F),We===t.UNSIGNED_BYTE&&(Fe=t.R8)),le===t.RED_INTEGER&&(We===t.UNSIGNED_BYTE&&(Fe=t.R8UI),We===t.UNSIGNED_SHORT&&(Fe=t.R16UI),We===t.UNSIGNED_INT&&(Fe=t.R32UI),We===t.BYTE&&(Fe=t.R8I),We===t.SHORT&&(Fe=t.R16I),We===t.INT&&(Fe=t.R32I)),le===t.RG&&(We===t.FLOAT&&(Fe=t.RG32F),We===t.HALF_FLOAT&&(Fe=t.RG16F),We===t.UNSIGNED_BYTE&&(Fe=t.RG8)),le===t.RG_INTEGER&&(We===t.UNSIGNED_BYTE&&(Fe=t.RG8UI),We===t.UNSIGNED_SHORT&&(Fe=t.RG16UI),We===t.UNSIGNED_INT&&(Fe=t.RG32UI),We===t.BYTE&&(Fe=t.RG8I),We===t.SHORT&&(Fe=t.RG16I),We===t.INT&&(Fe=t.RG32I)),le===t.RGB_INTEGER&&(We===t.UNSIGNED_BYTE&&(Fe=t.RGB8UI),We===t.UNSIGNED_SHORT&&(Fe=t.RGB16UI),We===t.UNSIGNED_INT&&(Fe=t.RGB32UI),We===t.BYTE&&(Fe=t.RGB8I),We===t.SHORT&&(Fe=t.RGB16I),We===t.INT&&(Fe=t.RGB32I)),le===t.RGBA_INTEGER&&(We===t.UNSIGNED_BYTE&&(Fe=t.RGBA8UI),We===t.UNSIGNED_SHORT&&(Fe=t.RGBA16UI),We===t.UNSIGNED_INT&&(Fe=t.RGBA32UI),We===t.BYTE&&(Fe=t.RGBA8I),We===t.SHORT&&(Fe=t.RGBA16I),We===t.INT&&(Fe=t.RGBA32I)),le===t.RGB&&We===t.UNSIGNED_INT_5_9_9_9_REV&&(Fe=t.RGB9_E5),le===t.RGBA){const Ht=je?SA:ki.getTransfer(it);We===t.FLOAT&&(Fe=t.RGBA32F),We===t.HALF_FLOAT&&(Fe=t.RGBA16F),We===t.UNSIGNED_BYTE&&(Fe=Ht===es?t.SRGB8_ALPHA8:t.RGBA8),We===t.UNSIGNED_SHORT_4_4_4_4&&(Fe=t.RGBA4),We===t.UNSIGNED_SHORT_5_5_5_1&&(Fe=t.RGB5_A1)}return(Fe===t.R16F||Fe===t.R32F||Fe===t.RG16F||Fe===t.RG32F||Fe===t.RGBA16F||Fe===t.RGBA32F)&&e.get("EXT_color_buffer_float"),Fe}function A(Ee,le){let We;return Ee?le===null||le===s_||le===H0?We=t.DEPTH24_STENCIL8:le===sp?We=t.DEPTH32F_STENCIL8:le===fw&&(We=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):le===null||le===s_||le===H0?We=t.DEPTH_COMPONENT24:le===sp?We=t.DEPTH_COMPONENT32F:le===fw&&(We=t.DEPTH_COMPONENT16),We}function k(Ee,le){return v(Ee)===!0||Ee.isFramebufferTexture&&Ee.minFilter!==Bo&&Ee.minFilter!==Zl?Math.log2(Math.max(le.width,le.height))+1:Ee.mipmaps!==void 0&&Ee.mipmaps.length>0?Ee.mipmaps.length:Ee.isCompressedTexture&&Array.isArray(Ee.image)?le.mipmaps.length:1}function I(Ee){const le=Ee.target;le.removeEventListener("dispose",I),U(le),le.isVideoTexture&&u.delete(le)}function N(Ee){const le=Ee.target;le.removeEventListener("dispose",N),$(le)}function U(Ee){const le=r.get(Ee);if(le.__webglInit===void 0)return;const We=Ee.source,it=h.get(We);if(it){const je=it[le.__cacheKey];je.usedTimes--,je.usedTimes===0&&F(Ee),Object.keys(it).length===0&&h.delete(We)}r.remove(Ee)}function F(Ee){const le=r.get(Ee);t.deleteTexture(le.__webglTexture);const We=Ee.source,it=h.get(We);delete it[le.__cacheKey],o.memory.textures--}function $(Ee){const le=r.get(Ee);if(Ee.depthTexture&&(Ee.depthTexture.dispose(),r.remove(Ee.depthTexture)),Ee.isWebGLCubeRenderTarget)for(let it=0;it<6;it++){if(Array.isArray(le.__webglFramebuffer[it]))for(let je=0;je<le.__webglFramebuffer[it].length;je++)t.deleteFramebuffer(le.__webglFramebuffer[it][je]);else t.deleteFramebuffer(le.__webglFramebuffer[it]);le.__webglDepthbuffer&&t.deleteRenderbuffer(le.__webglDepthbuffer[it])}else{if(Array.isArray(le.__webglFramebuffer))for(let it=0;it<le.__webglFramebuffer.length;it++)t.deleteFramebuffer(le.__webglFramebuffer[it]);else t.deleteFramebuffer(le.__webglFramebuffer);if(le.__webglDepthbuffer&&t.deleteRenderbuffer(le.__webglDepthbuffer),le.__webglMultisampledFramebuffer&&t.deleteFramebuffer(le.__webglMultisampledFramebuffer),le.__webglColorRenderbuffer)for(let it=0;it<le.__webglColorRenderbuffer.length;it++)le.__webglColorRenderbuffer[it]&&t.deleteRenderbuffer(le.__webglColorRenderbuffer[it]);le.__webglDepthRenderbuffer&&t.deleteRenderbuffer(le.__webglDepthRenderbuffer)}const We=Ee.textures;for(let it=0,je=We.length;it<je;it++){const Fe=r.get(We[it]);Fe.__webglTexture&&(t.deleteTexture(Fe.__webglTexture),o.memory.textures--),r.remove(We[it])}r.remove(Ee)}let X=0;function q(){X=0}function W(){const Ee=X;return Ee>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Ee+" texture units while this GPU supports only "+i.maxTextures),X+=1,Ee}function K(Ee){const le=[];return le.push(Ee.wrapS),le.push(Ee.wrapT),le.push(Ee.wrapR||0),le.push(Ee.magFilter),le.push(Ee.minFilter),le.push(Ee.anisotropy),le.push(Ee.internalFormat),le.push(Ee.format),le.push(Ee.type),le.push(Ee.generateMipmaps),le.push(Ee.premultiplyAlpha),le.push(Ee.flipY),le.push(Ee.unpackAlignment),le.push(Ee.colorSpace),le.join()}function ne(Ee,le){const We=r.get(Ee);if(Ee.isVideoTexture&&$t(Ee),Ee.isRenderTargetTexture===!1&&Ee.version>0&&We.__version!==Ee.version){const it=Ee.image;if(it===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(it.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Se(We,Ee,le);return}}n.bindTexture(t.TEXTURE_2D,We.__webglTexture,t.TEXTURE0+le)}function Q(Ee,le){const We=r.get(Ee);if(Ee.version>0&&We.__version!==Ee.version){Se(We,Ee,le);return}n.bindTexture(t.TEXTURE_2D_ARRAY,We.__webglTexture,t.TEXTURE0+le)}function ie(Ee,le){const We=r.get(Ee);if(Ee.version>0&&We.__version!==Ee.version){Se(We,Ee,le);return}n.bindTexture(t.TEXTURE_3D,We.__webglTexture,t.TEXTURE0+le)}function G(Ee,le){const We=r.get(Ee);if(Ee.version>0&&We.__version!==Ee.version){Pe(We,Ee,le);return}n.bindTexture(t.TEXTURE_CUBE_MAP,We.__webglTexture,t.TEXTURE0+le)}const Z={[ND]:t.REPEAT,[C0]:t.CLAMP_TO_EDGE,[PD]:t.MIRRORED_REPEAT},se={[Bo]:t.NEAREST,[une]:t.NEAREST_MIPMAP_NEAREST,[Nx]:t.NEAREST_MIPMAP_LINEAR,[Zl]:t.LINEAR,[eN]:t.LINEAR_MIPMAP_NEAREST,[R0]:t.LINEAR_MIPMAP_LINEAR},ue={[fne]:t.NEVER,[yne]:t.ALWAYS,[pne]:t.LESS,[R8]:t.LEQUAL,[mne]:t.EQUAL,[_ne]:t.GEQUAL,[gne]:t.GREATER,[vne]:t.NOTEQUAL};function Ae(Ee,le){if(le.type===sp&&e.has("OES_texture_float_linear")===!1&&(le.magFilter===Zl||le.magFilter===eN||le.magFilter===Nx||le.magFilter===R0||le.minFilter===Zl||le.minFilter===eN||le.minFilter===Nx||le.minFilter===R0)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(Ee,t.TEXTURE_WRAP_S,Z[le.wrapS]),t.texParameteri(Ee,t.TEXTURE_WRAP_T,Z[le.wrapT]),(Ee===t.TEXTURE_3D||Ee===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Ee,t.TEXTURE_WRAP_R,Z[le.wrapR]),t.texParameteri(Ee,t.TEXTURE_MAG_FILTER,se[le.magFilter]),t.texParameteri(Ee,t.TEXTURE_MIN_FILTER,se[le.minFilter]),le.compareFunction&&(t.texParameteri(Ee,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(Ee,t.TEXTURE_COMPARE_FUNC,ue[le.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(le.magFilter===Bo||le.minFilter!==Nx&&le.minFilter!==R0||le.type===sp&&e.has("OES_texture_float_linear")===!1)return;if(le.anisotropy>1||r.get(le).__currentAnisotropy){const We=e.get("EXT_texture_filter_anisotropic");t.texParameterf(Ee,We.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(le.anisotropy,i.getMaxAnisotropy())),r.get(le).__currentAnisotropy=le.anisotropy}}}function Be(Ee,le){let We=!1;Ee.__webglInit===void 0&&(Ee.__webglInit=!0,le.addEventListener("dispose",I));const it=le.source;let je=h.get(it);je===void 0&&(je={},h.set(it,je));const Fe=K(le);if(Fe!==Ee.__cacheKey){je[Fe]===void 0&&(je[Fe]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,We=!0),je[Fe].usedTimes++;const Ht=je[Ee.__cacheKey];Ht!==void 0&&(je[Ee.__cacheKey].usedTimes--,Ht.usedTimes===0&&F(le)),Ee.__cacheKey=Fe,Ee.__webglTexture=je[Fe].texture}return We}function Se(Ee,le,We){let it=t.TEXTURE_2D;(le.isDataArrayTexture||le.isCompressedArrayTexture)&&(it=t.TEXTURE_2D_ARRAY),le.isData3DTexture&&(it=t.TEXTURE_3D);const je=Be(Ee,le),Fe=le.source;n.bindTexture(it,Ee.__webglTexture,t.TEXTURE0+We);const Ht=r.get(Fe);if(Fe.version!==Ht.__version||je===!0){n.activeTexture(t.TEXTURE0+We);const St=ki.getPrimaries(ki.workingColorSpace),Dt=le.colorSpace===Zf?null:ki.getPrimaries(le.colorSpace),oe=le.colorSpace===Zf||St===Dt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,le.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,le.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,oe);let j=g(le.image,!1,i.maxTextureSize);j=Tt(le,j);const V=s.convert(le.format,le.colorSpace),fe=s.convert(le.type);let Ie=C(le.internalFormat,V,fe,le.colorSpace,le.isVideoTexture);Ae(it,le);let Ue;const dt=le.mipmaps,yt=le.isVideoTexture!==!0,Dn=Ht.__version===void 0||je===!0,Le=Fe.dataReady,Lt=k(le,j);if(le.isDepthTexture)Ie=A(le.format===V0,le.type),Dn&&(yt?n.texStorage2D(t.TEXTURE_2D,1,Ie,j.width,j.height):n.texImage2D(t.TEXTURE_2D,0,Ie,j.width,j.height,0,V,fe,null));else if(le.isDataTexture)if(dt.length>0){yt&&Dn&&n.texStorage2D(t.TEXTURE_2D,Lt,Ie,dt[0].width,dt[0].height);for(let rt=0,xt=dt.length;rt<xt;rt++)Ue=dt[rt],yt?Le&&n.texSubImage2D(t.TEXTURE_2D,rt,0,0,Ue.width,Ue.height,V,fe,Ue.data):n.texImage2D(t.TEXTURE_2D,rt,Ie,Ue.width,Ue.height,0,V,fe,Ue.data);le.generateMipmaps=!1}else yt?(Dn&&n.texStorage2D(t.TEXTURE_2D,Lt,Ie,j.width,j.height),Le&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,j.width,j.height,V,fe,j.data)):n.texImage2D(t.TEXTURE_2D,0,Ie,j.width,j.height,0,V,fe,j.data);else if(le.isCompressedTexture)if(le.isCompressedArrayTexture){yt&&Dn&&n.texStorage3D(t.TEXTURE_2D_ARRAY,Lt,Ie,dt[0].width,dt[0].height,j.depth);for(let rt=0,xt=dt.length;rt<xt;rt++)if(Ue=dt[rt],le.format!==Cd)if(V!==null)if(yt){if(Le)if(le.layerUpdates.size>0){const sn=Dj(Ue.width,Ue.height,le.format,le.type);for(const Jt of le.layerUpdates){const De=Ue.data.subarray(Jt*sn/Ue.data.BYTES_PER_ELEMENT,(Jt+1)*sn/Ue.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,rt,0,0,Jt,Ue.width,Ue.height,1,V,De)}le.clearLayerUpdates()}else n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,rt,0,0,0,Ue.width,Ue.height,j.depth,V,Ue.data)}else n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,rt,Ie,Ue.width,Ue.height,j.depth,0,Ue.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else yt?Le&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,rt,0,0,0,Ue.width,Ue.height,j.depth,V,fe,Ue.data):n.texImage3D(t.TEXTURE_2D_ARRAY,rt,Ie,Ue.width,Ue.height,j.depth,0,V,fe,Ue.data)}else{yt&&Dn&&n.texStorage2D(t.TEXTURE_2D,Lt,Ie,dt[0].width,dt[0].height);for(let rt=0,xt=dt.length;rt<xt;rt++)Ue=dt[rt],le.format!==Cd?V!==null?yt?Le&&n.compressedTexSubImage2D(t.TEXTURE_2D,rt,0,0,Ue.width,Ue.height,V,Ue.data):n.compressedTexImage2D(t.TEXTURE_2D,rt,Ie,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):yt?Le&&n.texSubImage2D(t.TEXTURE_2D,rt,0,0,Ue.width,Ue.height,V,fe,Ue.data):n.texImage2D(t.TEXTURE_2D,rt,Ie,Ue.width,Ue.height,0,V,fe,Ue.data)}else if(le.isDataArrayTexture)if(yt){if(Dn&&n.texStorage3D(t.TEXTURE_2D_ARRAY,Lt,Ie,j.width,j.height,j.depth),Le)if(le.layerUpdates.size>0){const rt=Dj(j.width,j.height,le.format,le.type);for(const xt of le.layerUpdates){const sn=j.data.subarray(xt*rt/j.data.BYTES_PER_ELEMENT,(xt+1)*rt/j.data.BYTES_PER_ELEMENT);n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,xt,j.width,j.height,1,V,fe,sn)}le.clearLayerUpdates()}else n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,j.width,j.height,j.depth,V,fe,j.data)}else n.texImage3D(t.TEXTURE_2D_ARRAY,0,Ie,j.width,j.height,j.depth,0,V,fe,j.data);else if(le.isData3DTexture)yt?(Dn&&n.texStorage3D(t.TEXTURE_3D,Lt,Ie,j.width,j.height,j.depth),Le&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,j.width,j.height,j.depth,V,fe,j.data)):n.texImage3D(t.TEXTURE_3D,0,Ie,j.width,j.height,j.depth,0,V,fe,j.data);else if(le.isFramebufferTexture){if(Dn)if(yt)n.texStorage2D(t.TEXTURE_2D,Lt,Ie,j.width,j.height);else{let rt=j.width,xt=j.height;for(let sn=0;sn<Lt;sn++)n.texImage2D(t.TEXTURE_2D,sn,Ie,rt,xt,0,V,fe,null),rt>>=1,xt>>=1}}else if(dt.length>0){if(yt&&Dn){const rt=Ft(dt[0]);n.texStorage2D(t.TEXTURE_2D,Lt,Ie,rt.width,rt.height)}for(let rt=0,xt=dt.length;rt<xt;rt++)Ue=dt[rt],yt?Le&&n.texSubImage2D(t.TEXTURE_2D,rt,0,0,V,fe,Ue):n.texImage2D(t.TEXTURE_2D,rt,Ie,V,fe,Ue);le.generateMipmaps=!1}else if(yt){if(Dn){const rt=Ft(j);n.texStorage2D(t.TEXTURE_2D,Lt,Ie,rt.width,rt.height)}Le&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,V,fe,j)}else n.texImage2D(t.TEXTURE_2D,0,Ie,V,fe,j);v(le)&&E(it),Ht.__version=Fe.version,le.onUpdate&&le.onUpdate(le)}Ee.__version=le.version}function Pe(Ee,le,We){if(le.image.length!==6)return;const it=Be(Ee,le),je=le.source;n.bindTexture(t.TEXTURE_CUBE_MAP,Ee.__webglTexture,t.TEXTURE0+We);const Fe=r.get(je);if(je.version!==Fe.__version||it===!0){n.activeTexture(t.TEXTURE0+We);const Ht=ki.getPrimaries(ki.workingColorSpace),St=le.colorSpace===Zf?null:ki.getPrimaries(le.colorSpace),Dt=le.colorSpace===Zf||Ht===St?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,le.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,le.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Dt);const oe=le.isCompressedTexture||le.image[0].isCompressedTexture,j=le.image[0]&&le.image[0].isDataTexture,V=[];for(let xt=0;xt<6;xt++)!oe&&!j?V[xt]=g(le.image[xt],!0,i.maxCubemapSize):V[xt]=j?le.image[xt].image:le.image[xt],V[xt]=Tt(le,V[xt]);const fe=V[0],Ie=s.convert(le.format,le.colorSpace),Ue=s.convert(le.type),dt=C(le.internalFormat,Ie,Ue,le.colorSpace),yt=le.isVideoTexture!==!0,Dn=Fe.__version===void 0||it===!0,Le=je.dataReady;let Lt=k(le,fe);Ae(t.TEXTURE_CUBE_MAP,le);let rt;if(oe){yt&&Dn&&n.texStorage2D(t.TEXTURE_CUBE_MAP,Lt,dt,fe.width,fe.height);for(let xt=0;xt<6;xt++){rt=V[xt].mipmaps;for(let sn=0;sn<rt.length;sn++){const Jt=rt[sn];le.format!==Cd?Ie!==null?yt?Le&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,sn,0,0,Jt.width,Jt.height,Ie,Jt.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,sn,dt,Jt.width,Jt.height,0,Jt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):yt?Le&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,sn,0,0,Jt.width,Jt.height,Ie,Ue,Jt.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,sn,dt,Jt.width,Jt.height,0,Ie,Ue,Jt.data)}}}else{if(rt=le.mipmaps,yt&&Dn){rt.length>0&&Lt++;const xt=Ft(V[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,Lt,dt,xt.width,xt.height)}for(let xt=0;xt<6;xt++)if(j){yt?Le&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,0,0,0,V[xt].width,V[xt].height,Ie,Ue,V[xt].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,0,dt,V[xt].width,V[xt].height,0,Ie,Ue,V[xt].data);for(let sn=0;sn<rt.length;sn++){const De=rt[sn].image[xt].image;yt?Le&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,sn+1,0,0,De.width,De.height,Ie,Ue,De.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,sn+1,dt,De.width,De.height,0,Ie,Ue,De.data)}}else{yt?Le&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,0,0,0,Ie,Ue,V[xt]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,0,dt,Ie,Ue,V[xt]);for(let sn=0;sn<rt.length;sn++){const Jt=rt[sn];yt?Le&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,sn+1,0,0,Ie,Ue,Jt.image[xt]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+xt,sn+1,dt,Ie,Ue,Jt.image[xt])}}}v(le)&&E(t.TEXTURE_CUBE_MAP),Fe.__version=je.version,le.onUpdate&&le.onUpdate(le)}Ee.__version=le.version}function we(Ee,le,We,it,je,Fe){const Ht=s.convert(We.format,We.colorSpace),St=s.convert(We.type),Dt=C(We.internalFormat,Ht,St,We.colorSpace),oe=r.get(le),j=r.get(We);if(j.__renderTarget=le,!oe.__hasExternalTextures){const V=Math.max(1,le.width>>Fe),fe=Math.max(1,le.height>>Fe);je===t.TEXTURE_3D||je===t.TEXTURE_2D_ARRAY?n.texImage3D(je,Fe,Dt,V,fe,le.depth,0,Ht,St,null):n.texImage2D(je,Fe,Dt,V,fe,0,Ht,St,null)}n.bindFramebuffer(t.FRAMEBUFFER,Ee),Rt(le)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,it,je,j.__webglTexture,0,He(le)):(je===t.TEXTURE_2D||je>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&je<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,it,je,j.__webglTexture,Fe),n.bindFramebuffer(t.FRAMEBUFFER,null)}function Te(Ee,le,We){if(t.bindRenderbuffer(t.RENDERBUFFER,Ee),le.depthBuffer){const it=le.depthTexture,je=it&&it.isDepthTexture?it.type:null,Fe=A(le.stencilBuffer,je),Ht=le.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,St=He(le);Rt(le)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,St,Fe,le.width,le.height):We?t.renderbufferStorageMultisample(t.RENDERBUFFER,St,Fe,le.width,le.height):t.renderbufferStorage(t.RENDERBUFFER,Fe,le.width,le.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,Ht,t.RENDERBUFFER,Ee)}else{const it=le.textures;for(let je=0;je<it.length;je++){const Fe=it[je],Ht=s.convert(Fe.format,Fe.colorSpace),St=s.convert(Fe.type),Dt=C(Fe.internalFormat,Ht,St,Fe.colorSpace),oe=He(le);We&&Rt(le)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,oe,Dt,le.width,le.height):Rt(le)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,oe,Dt,le.width,le.height):t.renderbufferStorage(t.RENDERBUFFER,Dt,le.width,le.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function Oe(Ee,le){if(le&&le.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,Ee),!(le.depthTexture&&le.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const it=r.get(le.depthTexture);it.__renderTarget=le,(!it.__webglTexture||le.depthTexture.image.width!==le.width||le.depthTexture.image.height!==le.height)&&(le.depthTexture.image.width=le.width,le.depthTexture.image.height=le.height,le.depthTexture.needsUpdate=!0),ne(le.depthTexture,0);const je=it.__webglTexture,Fe=He(le);if(le.depthTexture.format===zb)Rt(le)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,je,0,Fe):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,je,0);else if(le.depthTexture.format===V0)Rt(le)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,je,0,Fe):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,je,0);else throw new Error("Unknown depthTexture format")}function _t(Ee){const le=r.get(Ee),We=Ee.isWebGLCubeRenderTarget===!0;if(le.__boundDepthTexture!==Ee.depthTexture){const it=Ee.depthTexture;if(le.__depthDisposeCallback&&le.__depthDisposeCallback(),it){const je=()=>{delete le.__boundDepthTexture,delete le.__depthDisposeCallback,it.removeEventListener("dispose",je)};it.addEventListener("dispose",je),le.__depthDisposeCallback=je}le.__boundDepthTexture=it}if(Ee.depthTexture&&!le.__autoAllocateDepthBuffer){if(We)throw new Error("target.depthTexture not supported in Cube render targets");Oe(le.__webglFramebuffer,Ee)}else if(We){le.__webglDepthbuffer=[];for(let it=0;it<6;it++)if(n.bindFramebuffer(t.FRAMEBUFFER,le.__webglFramebuffer[it]),le.__webglDepthbuffer[it]===void 0)le.__webglDepthbuffer[it]=t.createRenderbuffer(),Te(le.__webglDepthbuffer[it],Ee,!1);else{const je=Ee.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Fe=le.__webglDepthbuffer[it];t.bindRenderbuffer(t.RENDERBUFFER,Fe),t.framebufferRenderbuffer(t.FRAMEBUFFER,je,t.RENDERBUFFER,Fe)}}else if(n.bindFramebuffer(t.FRAMEBUFFER,le.__webglFramebuffer),le.__webglDepthbuffer===void 0)le.__webglDepthbuffer=t.createRenderbuffer(),Te(le.__webglDepthbuffer,Ee,!1);else{const it=Ee.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,je=le.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,je),t.framebufferRenderbuffer(t.FRAMEBUFFER,it,t.RENDERBUFFER,je)}n.bindFramebuffer(t.FRAMEBUFFER,null)}function Ct(Ee,le,We){const it=r.get(Ee);le!==void 0&&we(it.__webglFramebuffer,Ee,Ee.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),We!==void 0&&_t(Ee)}function me(Ee){const le=Ee.texture,We=r.get(Ee),it=r.get(le);Ee.addEventListener("dispose",N);const je=Ee.textures,Fe=Ee.isWebGLCubeRenderTarget===!0,Ht=je.length>1;if(Ht||(it.__webglTexture===void 0&&(it.__webglTexture=t.createTexture()),it.__version=le.version,o.memory.textures++),Fe){We.__webglFramebuffer=[];for(let St=0;St<6;St++)if(le.mipmaps&&le.mipmaps.length>0){We.__webglFramebuffer[St]=[];for(let Dt=0;Dt<le.mipmaps.length;Dt++)We.__webglFramebuffer[St][Dt]=t.createFramebuffer()}else We.__webglFramebuffer[St]=t.createFramebuffer()}else{if(le.mipmaps&&le.mipmaps.length>0){We.__webglFramebuffer=[];for(let St=0;St<le.mipmaps.length;St++)We.__webglFramebuffer[St]=t.createFramebuffer()}else We.__webglFramebuffer=t.createFramebuffer();if(Ht)for(let St=0,Dt=je.length;St<Dt;St++){const oe=r.get(je[St]);oe.__webglTexture===void 0&&(oe.__webglTexture=t.createTexture(),o.memory.textures++)}if(Ee.samples>0&&Rt(Ee)===!1){We.__webglMultisampledFramebuffer=t.createFramebuffer(),We.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,We.__webglMultisampledFramebuffer);for(let St=0;St<je.length;St++){const Dt=je[St];We.__webglColorRenderbuffer[St]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,We.__webglColorRenderbuffer[St]);const oe=s.convert(Dt.format,Dt.colorSpace),j=s.convert(Dt.type),V=C(Dt.internalFormat,oe,j,Dt.colorSpace,Ee.isXRRenderTarget===!0),fe=He(Ee);t.renderbufferStorageMultisample(t.RENDERBUFFER,fe,V,Ee.width,Ee.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+St,t.RENDERBUFFER,We.__webglColorRenderbuffer[St])}t.bindRenderbuffer(t.RENDERBUFFER,null),Ee.depthBuffer&&(We.__webglDepthRenderbuffer=t.createRenderbuffer(),Te(We.__webglDepthRenderbuffer,Ee,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(Fe){n.bindTexture(t.TEXTURE_CUBE_MAP,it.__webglTexture),Ae(t.TEXTURE_CUBE_MAP,le);for(let St=0;St<6;St++)if(le.mipmaps&&le.mipmaps.length>0)for(let Dt=0;Dt<le.mipmaps.length;Dt++)we(We.__webglFramebuffer[St][Dt],Ee,le,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+St,Dt);else we(We.__webglFramebuffer[St],Ee,le,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+St,0);v(le)&&E(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(Ht){for(let St=0,Dt=je.length;St<Dt;St++){const oe=je[St],j=r.get(oe);n.bindTexture(t.TEXTURE_2D,j.__webglTexture),Ae(t.TEXTURE_2D,oe),we(We.__webglFramebuffer,Ee,oe,t.COLOR_ATTACHMENT0+St,t.TEXTURE_2D,0),v(oe)&&E(t.TEXTURE_2D)}n.unbindTexture()}else{let St=t.TEXTURE_2D;if((Ee.isWebGL3DRenderTarget||Ee.isWebGLArrayRenderTarget)&&(St=Ee.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(St,it.__webglTexture),Ae(St,le),le.mipmaps&&le.mipmaps.length>0)for(let Dt=0;Dt<le.mipmaps.length;Dt++)we(We.__webglFramebuffer[Dt],Ee,le,t.COLOR_ATTACHMENT0,St,Dt);else we(We.__webglFramebuffer,Ee,le,t.COLOR_ATTACHMENT0,St,0);v(le)&&E(St),n.unbindTexture()}Ee.depthBuffer&&_t(Ee)}function ge(Ee){const le=Ee.textures;for(let We=0,it=le.length;We<it;We++){const je=le[We];if(v(je)){const Fe=T(Ee),Ht=r.get(je).__webglTexture;n.bindTexture(Fe,Ht),E(Fe),n.unbindTexture()}}}const nt=[],Ce=[];function ut(Ee){if(Ee.samples>0){if(Rt(Ee)===!1){const le=Ee.textures,We=Ee.width,it=Ee.height;let je=t.COLOR_BUFFER_BIT;const Fe=Ee.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Ht=r.get(Ee),St=le.length>1;if(St)for(let Dt=0;Dt<le.length;Dt++)n.bindFramebuffer(t.FRAMEBUFFER,Ht.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Dt,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,Ht.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Dt,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,Ht.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ht.__webglFramebuffer);for(let Dt=0;Dt<le.length;Dt++){if(Ee.resolveDepthBuffer&&(Ee.depthBuffer&&(je|=t.DEPTH_BUFFER_BIT),Ee.stencilBuffer&&Ee.resolveStencilBuffer&&(je|=t.STENCIL_BUFFER_BIT)),St){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,Ht.__webglColorRenderbuffer[Dt]);const oe=r.get(le[Dt]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,oe,0)}t.blitFramebuffer(0,0,We,it,0,0,We,it,je,t.NEAREST),c===!0&&(nt.length=0,Ce.length=0,nt.push(t.COLOR_ATTACHMENT0+Dt),Ee.depthBuffer&&Ee.resolveDepthBuffer===!1&&(nt.push(Fe),Ce.push(Fe),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,Ce)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,nt))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),St)for(let Dt=0;Dt<le.length;Dt++){n.bindFramebuffer(t.FRAMEBUFFER,Ht.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Dt,t.RENDERBUFFER,Ht.__webglColorRenderbuffer[Dt]);const oe=r.get(le[Dt]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,Ht.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Dt,t.TEXTURE_2D,oe,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,Ht.__webglMultisampledFramebuffer)}else if(Ee.depthBuffer&&Ee.resolveDepthBuffer===!1&&c){const le=Ee.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[le])}}}function He(Ee){return Math.min(i.maxSamples,Ee.samples)}function Rt(Ee){const le=r.get(Ee);return Ee.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&le.__useRenderToTexture!==!1}function $t(Ee){const le=o.render.frame;u.get(Ee)!==le&&(u.set(Ee,le),Ee.update())}function Tt(Ee,le){const We=Ee.colorSpace,it=Ee.format,je=Ee.type;return Ee.isCompressedTexture===!0||Ee.isVideoTexture===!0||We!==S_&&We!==Zf&&(ki.getTransfer(We)===es?(it!==Cd||je!==Gc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",We)),le}function Ft(Ee){return typeof HTMLImageElement<"u"&&Ee instanceof HTMLImageElement?(l.width=Ee.naturalWidth||Ee.width,l.height=Ee.naturalHeight||Ee.height):typeof VideoFrame<"u"&&Ee instanceof VideoFrame?(l.width=Ee.displayWidth,l.height=Ee.displayHeight):(l.width=Ee.width,l.height=Ee.height),l}this.allocateTextureUnit=W,this.resetTextureUnits=q,this.setTexture2D=ne,this.setTexture2DArray=Q,this.setTexture3D=ie,this.setTextureCube=G,this.rebindTextures=Ct,this.setupRenderTarget=me,this.updateRenderTargetMipmap=ge,this.updateMultisampleRenderTarget=ut,this.setupDepthRenderbuffer=_t,this.setupFrameBufferTexture=we,this.useMultisampledRTT=Rt}function Bae(t,e){function n(r,i=Zf){let s;const o=ki.getTransfer(i);if(r===Gc)return t.UNSIGNED_BYTE;if(r===zU)return t.UNSIGNED_SHORT_4_4_4_4;if(r===GU)return t.UNSIGNED_SHORT_5_5_5_1;if(r===_8)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===g8)return t.BYTE;if(r===v8)return t.SHORT;if(r===fw)return t.UNSIGNED_SHORT;if(r===VU)return t.INT;if(r===s_)return t.UNSIGNED_INT;if(r===sp)return t.FLOAT;if(r===GE)return t.HALF_FLOAT;if(r===y8)return t.ALPHA;if(r===b8)return t.RGB;if(r===Cd)return t.RGBA;if(r===E8)return t.LUMINANCE;if(r===S8)return t.LUMINANCE_ALPHA;if(r===zb)return t.DEPTH_COMPONENT;if(r===V0)return t.DEPTH_STENCIL;if(r===w8)return t.RED;if(r===qU)return t.RED_INTEGER;if(r===T8)return t.RG;if(r===WU)return t.RG_INTEGER;if(r===EA)return t.RGBA_INTEGER;if(r===ZC||r===e1||r===t1||r===n1)if(o===es)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===ZC)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===e1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===t1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===n1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===ZC)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===e1)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===t1)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===n1)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===DD||r===LD||r===UD||r===FD)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===DD)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===LD)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===UD)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===FD)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===BD||r===jD||r===$D)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===BD||r===jD)return o===es?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===$D)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===HD||r===VD||r===zD||r===GD||r===qD||r===WD||r===KD||r===YD||r===XD||r===JD||r===QD||r===ZD||r===eL||r===tL)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===HD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===VD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===zD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===GD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===qD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===WD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===KD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===YD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===XD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===JD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===QD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===ZD)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===eL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===tL)return o===es?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===r1||r===nL||r===rL)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===r1)return o===es?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===nL)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===rL)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===x8||r===iL||r===sL||r===oL)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===r1)return s.COMPRESSED_RED_RGTC1_EXT;if(r===iL)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===sL)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===oL)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===H0?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:n}}class jae extends Lu{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class BS extends iu{constructor(){super(),this.isGroup=!0,this.type="Group"}}const $ae={type:"move"};class RN{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new BS,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new BS,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ht,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ht),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new BS,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ht,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ht),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const g of e.hand.values()){const v=n.getJointPose(g,r),E=this._getHandJoint(l,g);v!==null&&(E.matrix.fromArray(v.transform.matrix),E.matrix.decompose(E.position,E.rotation,E.scale),E.matrixWorldNeedsUpdate=!0,E.jointRadius=v.radius),E.visible=v!==null}const u=l.joints["index-finger-tip"],d=l.joints["thumb-tip"],h=u.position.distanceTo(d.position),f=.02,p=.005;l.inputState.pinching&&h>f+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=f-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=n.getPose(e.gripSpace,r),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=n.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent($ae)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new BS;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}const Hae=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Vae=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class zae{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,r){if(this.texture===null){const i=new wo,s=e.properties.get(i);s.__webglTexture=n.texture,(n.depthNear!=r.depthNear||n.depthFar!=r.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const n=e.cameras[0].viewport,r=new Al({vertexShader:Hae,fragmentShader:Vae,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Ih(new lT(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Gae extends hg{constructor(e,n){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,d=null,h=null,f=null,p=null;const g=new zae,v=n.getContextAttributes();let E=null,T=null;const C=[],A=[],k=new Vn;let I=null;const N=new Lu;N.viewport=new Fo;const U=new Lu;U.viewport=new Fo;const F=[N,U],$=new jae;let X=null,q=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Se){let Pe=C[Se];return Pe===void 0&&(Pe=new RN,C[Se]=Pe),Pe.getTargetRaySpace()},this.getControllerGrip=function(Se){let Pe=C[Se];return Pe===void 0&&(Pe=new RN,C[Se]=Pe),Pe.getGripSpace()},this.getHand=function(Se){let Pe=C[Se];return Pe===void 0&&(Pe=new RN,C[Se]=Pe),Pe.getHandSpace()};function W(Se){const Pe=A.indexOf(Se.inputSource);if(Pe===-1)return;const we=C[Pe];we!==void 0&&(we.update(Se.inputSource,Se.frame,l||o),we.dispatchEvent({type:Se.type,data:Se.inputSource}))}function K(){i.removeEventListener("select",W),i.removeEventListener("selectstart",W),i.removeEventListener("selectend",W),i.removeEventListener("squeeze",W),i.removeEventListener("squeezestart",W),i.removeEventListener("squeezeend",W),i.removeEventListener("end",K),i.removeEventListener("inputsourceschange",ne);for(let Se=0;Se<C.length;Se++){const Pe=A[Se];Pe!==null&&(A[Se]=null,C[Se].disconnect(Pe))}X=null,q=null,g.reset(),e.setRenderTarget(E),f=null,h=null,d=null,i=null,T=null,Be.stop(),r.isPresenting=!1,e.setPixelRatio(I),e.setSize(k.width,k.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Se){s=Se,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Se){a=Se,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(Se){l=Se},this.getBaseLayer=function(){return h!==null?h:f},this.getBinding=function(){return d},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(Se){if(i=Se,i!==null){if(E=e.getRenderTarget(),i.addEventListener("select",W),i.addEventListener("selectstart",W),i.addEventListener("selectend",W),i.addEventListener("squeeze",W),i.addEventListener("squeezestart",W),i.addEventListener("squeezeend",W),i.addEventListener("end",K),i.addEventListener("inputsourceschange",ne),v.xrCompatible!==!0&&await n.makeXRCompatible(),I=e.getPixelRatio(),e.getSize(k),i.renderState.layers===void 0){const Pe={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(i,n,Pe),i.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),T=new Ku(f.framebufferWidth,f.framebufferHeight,{format:Cd,type:Gc,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let Pe=null,we=null,Te=null;v.depth&&(Te=v.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,Pe=v.stencil?V0:zb,we=v.stencil?H0:s_);const Oe={colorFormat:n.RGBA8,depthFormat:Te,scaleFactor:s};d=new XRWebGLBinding(i,n),h=d.createProjectionLayer(Oe),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),T=new Ku(h.textureWidth,h.textureHeight,{format:Cd,type:Gc,depthTexture:new ZU(h.textureWidth,h.textureHeight,we,void 0,void 0,void 0,void 0,void 0,void 0,Pe),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1})}T.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await i.requestReferenceSpace(a),Be.setContext(i),Be.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return g.getDepthTexture()};function ne(Se){for(let Pe=0;Pe<Se.removed.length;Pe++){const we=Se.removed[Pe],Te=A.indexOf(we);Te>=0&&(A[Te]=null,C[Te].disconnect(we))}for(let Pe=0;Pe<Se.added.length;Pe++){const we=Se.added[Pe];let Te=A.indexOf(we);if(Te===-1){for(let _t=0;_t<C.length;_t++)if(_t>=A.length){A.push(we),Te=_t;break}else if(A[_t]===null){A[_t]=we,Te=_t;break}if(Te===-1)break}const Oe=C[Te];Oe&&Oe.connect(we)}}const Q=new ht,ie=new ht;function G(Se,Pe,we){Q.setFromMatrixPosition(Pe.matrixWorld),ie.setFromMatrixPosition(we.matrixWorld);const Te=Q.distanceTo(ie),Oe=Pe.projectionMatrix.elements,_t=we.projectionMatrix.elements,Ct=Oe[14]/(Oe[10]-1),me=Oe[14]/(Oe[10]+1),ge=(Oe[9]+1)/Oe[5],nt=(Oe[9]-1)/Oe[5],Ce=(Oe[8]-1)/Oe[0],ut=(_t[8]+1)/_t[0],He=Ct*Ce,Rt=Ct*ut,$t=Te/(-Ce+ut),Tt=$t*-Ce;if(Pe.matrixWorld.decompose(Se.position,Se.quaternion,Se.scale),Se.translateX(Tt),Se.translateZ($t),Se.matrixWorld.compose(Se.position,Se.quaternion,Se.scale),Se.matrixWorldInverse.copy(Se.matrixWorld).invert(),Oe[10]===-1)Se.projectionMatrix.copy(Pe.projectionMatrix),Se.projectionMatrixInverse.copy(Pe.projectionMatrixInverse);else{const Ft=Ct+$t,Ee=me+$t,le=He-Tt,We=Rt+(Te-Tt),it=ge*me/Ee*Ft,je=nt*me/Ee*Ft;Se.projectionMatrix.makePerspective(le,We,it,je,Ft,Ee),Se.projectionMatrixInverse.copy(Se.projectionMatrix).invert()}}function Z(Se,Pe){Pe===null?Se.matrixWorld.copy(Se.matrix):Se.matrixWorld.multiplyMatrices(Pe.matrixWorld,Se.matrix),Se.matrixWorldInverse.copy(Se.matrixWorld).invert()}this.updateCamera=function(Se){if(i===null)return;let Pe=Se.near,we=Se.far;g.texture!==null&&(g.depthNear>0&&(Pe=g.depthNear),g.depthFar>0&&(we=g.depthFar)),$.near=U.near=N.near=Pe,$.far=U.far=N.far=we,(X!==$.near||q!==$.far)&&(i.updateRenderState({depthNear:$.near,depthFar:$.far}),X=$.near,q=$.far),N.layers.mask=Se.layers.mask|2,U.layers.mask=Se.layers.mask|4,$.layers.mask=N.layers.mask|U.layers.mask;const Te=Se.parent,Oe=$.cameras;Z($,Te);for(let _t=0;_t<Oe.length;_t++)Z(Oe[_t],Te);Oe.length===2?G($,N,U):$.projectionMatrix.copy(N.projectionMatrix),se(Se,$,Te)};function se(Se,Pe,we){we===null?Se.matrix.copy(Pe.matrixWorld):(Se.matrix.copy(we.matrixWorld),Se.matrix.invert(),Se.matrix.multiply(Pe.matrixWorld)),Se.matrix.decompose(Se.position,Se.quaternion,Se.scale),Se.updateMatrixWorld(!0),Se.projectionMatrix.copy(Pe.projectionMatrix),Se.projectionMatrixInverse.copy(Pe.projectionMatrixInverse),Se.isPerspectiveCamera&&(Se.fov=pw*2*Math.atan(1/Se.projectionMatrix.elements[5]),Se.zoom=1)}this.getCamera=function(){return $},this.getFoveation=function(){if(!(h===null&&f===null))return c},this.setFoveation=function(Se){c=Se,h!==null&&(h.fixedFoveation=Se),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=Se)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh($)};let ue=null;function Ae(Se,Pe){if(u=Pe.getViewerPose(l||o),p=Pe,u!==null){const we=u.views;f!==null&&(e.setRenderTargetFramebuffer(T,f.framebuffer),e.setRenderTarget(T));let Te=!1;we.length!==$.cameras.length&&($.cameras.length=0,Te=!0);for(let _t=0;_t<we.length;_t++){const Ct=we[_t];let me=null;if(f!==null)me=f.getViewport(Ct);else{const nt=d.getViewSubImage(h,Ct);me=nt.viewport,_t===0&&(e.setRenderTargetTextures(T,nt.colorTexture,h.ignoreDepthValues?void 0:nt.depthStencilTexture),e.setRenderTarget(T))}let ge=F[_t];ge===void 0&&(ge=new Lu,ge.layers.enable(_t),ge.viewport=new Fo,F[_t]=ge),ge.matrix.fromArray(Ct.transform.matrix),ge.matrix.decompose(ge.position,ge.quaternion,ge.scale),ge.projectionMatrix.fromArray(Ct.projectionMatrix),ge.projectionMatrixInverse.copy(ge.projectionMatrix).invert(),ge.viewport.set(me.x,me.y,me.width,me.height),_t===0&&($.matrix.copy(ge.matrix),$.matrix.decompose($.position,$.quaternion,$.scale)),Te===!0&&$.cameras.push(ge)}const Oe=i.enabledFeatures;if(Oe&&Oe.includes("depth-sensing")){const _t=d.getDepthInformation(we[0]);_t&&_t.isValid&&_t.texture&&g.init(e,_t,i.renderState)}}for(let we=0;we<C.length;we++){const Te=A[we],Oe=C[we];Te!==null&&Oe!==void 0&&Oe.update(Te,Pe,l||o)}ue&&ue(Se,Pe),Pe.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Pe}),p=null}const Be=new U8;Be.setAnimationLoop(Ae),this.setAnimationLoop=function(Se){ue=Se},this.dispose=function(){}}}const o0=new rg,qae=new To;function Wae(t,e){function n(v,E){v.matrixAutoUpdate===!0&&v.updateMatrix(),E.value.copy(v.matrix)}function r(v,E){E.color.getRGB(v.fogColor.value,P8(t)),E.isFog?(v.fogNear.value=E.near,v.fogFar.value=E.far):E.isFogExp2&&(v.fogDensity.value=E.density)}function i(v,E,T,C,A){E.isMeshBasicMaterial||E.isMeshLambertMaterial?s(v,E):E.isMeshToonMaterial?(s(v,E),d(v,E)):E.isMeshPhongMaterial?(s(v,E),u(v,E)):E.isMeshStandardMaterial?(s(v,E),h(v,E),E.isMeshPhysicalMaterial&&f(v,E,A)):E.isMeshMatcapMaterial?(s(v,E),p(v,E)):E.isMeshDepthMaterial?s(v,E):E.isMeshDistanceMaterial?(s(v,E),g(v,E)):E.isMeshNormalMaterial?s(v,E):E.isLineBasicMaterial?(o(v,E),E.isLineDashedMaterial&&a(v,E)):E.isPointsMaterial?c(v,E,T,C):E.isSpriteMaterial?l(v,E):E.isShadowMaterial?(v.color.value.copy(E.color),v.opacity.value=E.opacity):E.isShaderMaterial&&(E.uniformsNeedUpdate=!1)}function s(v,E){v.opacity.value=E.opacity,E.color&&v.diffuse.value.copy(E.color),E.emissive&&v.emissive.value.copy(E.emissive).multiplyScalar(E.emissiveIntensity),E.map&&(v.map.value=E.map,n(E.map,v.mapTransform)),E.alphaMap&&(v.alphaMap.value=E.alphaMap,n(E.alphaMap,v.alphaMapTransform)),E.bumpMap&&(v.bumpMap.value=E.bumpMap,n(E.bumpMap,v.bumpMapTransform),v.bumpScale.value=E.bumpScale,E.side===ec&&(v.bumpScale.value*=-1)),E.normalMap&&(v.normalMap.value=E.normalMap,n(E.normalMap,v.normalMapTransform),v.normalScale.value.copy(E.normalScale),E.side===ec&&v.normalScale.value.negate()),E.displacementMap&&(v.displacementMap.value=E.displacementMap,n(E.displacementMap,v.displacementMapTransform),v.displacementScale.value=E.displacementScale,v.displacementBias.value=E.displacementBias),E.emissiveMap&&(v.emissiveMap.value=E.emissiveMap,n(E.emissiveMap,v.emissiveMapTransform)),E.specularMap&&(v.specularMap.value=E.specularMap,n(E.specularMap,v.specularMapTransform)),E.alphaTest>0&&(v.alphaTest.value=E.alphaTest);const T=e.get(E),C=T.envMap,A=T.envMapRotation;C&&(v.envMap.value=C,o0.copy(A),o0.x*=-1,o0.y*=-1,o0.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(o0.y*=-1,o0.z*=-1),v.envMapRotation.value.setFromMatrix4(qae.makeRotationFromEuler(o0)),v.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=E.reflectivity,v.ior.value=E.ior,v.refractionRatio.value=E.refractionRatio),E.lightMap&&(v.lightMap.value=E.lightMap,v.lightMapIntensity.value=E.lightMapIntensity,n(E.lightMap,v.lightMapTransform)),E.aoMap&&(v.aoMap.value=E.aoMap,v.aoMapIntensity.value=E.aoMapIntensity,n(E.aoMap,v.aoMapTransform))}function o(v,E){v.diffuse.value.copy(E.color),v.opacity.value=E.opacity,E.map&&(v.map.value=E.map,n(E.map,v.mapTransform))}function a(v,E){v.dashSize.value=E.dashSize,v.totalSize.value=E.dashSize+E.gapSize,v.scale.value=E.scale}function c(v,E,T,C){v.diffuse.value.copy(E.color),v.opacity.value=E.opacity,v.size.value=E.size*T,v.scale.value=C*.5,E.map&&(v.map.value=E.map,n(E.map,v.uvTransform)),E.alphaMap&&(v.alphaMap.value=E.alphaMap,n(E.alphaMap,v.alphaMapTransform)),E.alphaTest>0&&(v.alphaTest.value=E.alphaTest)}function l(v,E){v.diffuse.value.copy(E.color),v.opacity.value=E.opacity,v.rotation.value=E.rotation,E.map&&(v.map.value=E.map,n(E.map,v.mapTransform)),E.alphaMap&&(v.alphaMap.value=E.alphaMap,n(E.alphaMap,v.alphaMapTransform)),E.alphaTest>0&&(v.alphaTest.value=E.alphaTest)}function u(v,E){v.specular.value.copy(E.specular),v.shininess.value=Math.max(E.shininess,1e-4)}function d(v,E){E.gradientMap&&(v.gradientMap.value=E.gradientMap)}function h(v,E){v.metalness.value=E.metalness,E.metalnessMap&&(v.metalnessMap.value=E.metalnessMap,n(E.metalnessMap,v.metalnessMapTransform)),v.roughness.value=E.roughness,E.roughnessMap&&(v.roughnessMap.value=E.roughnessMap,n(E.roughnessMap,v.roughnessMapTransform)),E.envMap&&(v.envMapIntensity.value=E.envMapIntensity)}function f(v,E,T){v.ior.value=E.ior,E.sheen>0&&(v.sheenColor.value.copy(E.sheenColor).multiplyScalar(E.sheen),v.sheenRoughness.value=E.sheenRoughness,E.sheenColorMap&&(v.sheenColorMap.value=E.sheenColorMap,n(E.sheenColorMap,v.sheenColorMapTransform)),E.sheenRoughnessMap&&(v.sheenRoughnessMap.value=E.sheenRoughnessMap,n(E.sheenRoughnessMap,v.sheenRoughnessMapTransform))),E.clearcoat>0&&(v.clearcoat.value=E.clearcoat,v.clearcoatRoughness.value=E.clearcoatRoughness,E.clearcoatMap&&(v.clearcoatMap.value=E.clearcoatMap,n(E.clearcoatMap,v.clearcoatMapTransform)),E.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=E.clearcoatRoughnessMap,n(E.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),E.clearcoatNormalMap&&(v.clearcoatNormalMap.value=E.clearcoatNormalMap,n(E.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(E.clearcoatNormalScale),E.side===ec&&v.clearcoatNormalScale.value.negate())),E.dispersion>0&&(v.dispersion.value=E.dispersion),E.iridescence>0&&(v.iridescence.value=E.iridescence,v.iridescenceIOR.value=E.iridescenceIOR,v.iridescenceThicknessMinimum.value=E.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=E.iridescenceThicknessRange[1],E.iridescenceMap&&(v.iridescenceMap.value=E.iridescenceMap,n(E.iridescenceMap,v.iridescenceMapTransform)),E.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=E.iridescenceThicknessMap,n(E.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),E.transmission>0&&(v.transmission.value=E.transmission,v.transmissionSamplerMap.value=T.texture,v.transmissionSamplerSize.value.set(T.width,T.height),E.transmissionMap&&(v.transmissionMap.value=E.transmissionMap,n(E.transmissionMap,v.transmissionMapTransform)),v.thickness.value=E.thickness,E.thicknessMap&&(v.thicknessMap.value=E.thicknessMap,n(E.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=E.attenuationDistance,v.attenuationColor.value.copy(E.attenuationColor)),E.anisotropy>0&&(v.anisotropyVector.value.set(E.anisotropy*Math.cos(E.anisotropyRotation),E.anisotropy*Math.sin(E.anisotropyRotation)),E.anisotropyMap&&(v.anisotropyMap.value=E.anisotropyMap,n(E.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=E.specularIntensity,v.specularColor.value.copy(E.specularColor),E.specularColorMap&&(v.specularColorMap.value=E.specularColorMap,n(E.specularColorMap,v.specularColorMapTransform)),E.specularIntensityMap&&(v.specularIntensityMap.value=E.specularIntensityMap,n(E.specularIntensityMap,v.specularIntensityMapTransform))}function p(v,E){E.matcap&&(v.matcap.value=E.matcap)}function g(v,E){const T=e.get(E).light;v.referencePosition.value.setFromMatrixPosition(T.matrixWorld),v.nearDistance.value=T.shadow.camera.near,v.farDistance.value=T.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function Kae(t,e,n,r){let i={},s={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function c(T,C){const A=C.program;r.uniformBlockBinding(T,A)}function l(T,C){let A=i[T.id];A===void 0&&(p(T),A=u(T),i[T.id]=A,T.addEventListener("dispose",v));const k=C.program;r.updateUBOMapping(T,k);const I=e.render.frame;s[T.id]!==I&&(h(T),s[T.id]=I)}function u(T){const C=d();T.__bindingPointIndex=C;const A=t.createBuffer(),k=T.__size,I=T.usage;return t.bindBuffer(t.UNIFORM_BUFFER,A),t.bufferData(t.UNIFORM_BUFFER,k,I),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,C,A),A}function d(){for(let T=0;T<a;T++)if(o.indexOf(T)===-1)return o.push(T),T;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(T){const C=i[T.id],A=T.uniforms,k=T.__cache;t.bindBuffer(t.UNIFORM_BUFFER,C);for(let I=0,N=A.length;I<N;I++){const U=Array.isArray(A[I])?A[I]:[A[I]];for(let F=0,$=U.length;F<$;F++){const X=U[F];if(f(X,I,F,k)===!0){const q=X.__offset,W=Array.isArray(X.value)?X.value:[X.value];let K=0;for(let ne=0;ne<W.length;ne++){const Q=W[ne],ie=g(Q);typeof Q=="number"||typeof Q=="boolean"?(X.__data[0]=Q,t.bufferSubData(t.UNIFORM_BUFFER,q+K,X.__data)):Q.isMatrix3?(X.__data[0]=Q.elements[0],X.__data[1]=Q.elements[1],X.__data[2]=Q.elements[2],X.__data[3]=0,X.__data[4]=Q.elements[3],X.__data[5]=Q.elements[4],X.__data[6]=Q.elements[5],X.__data[7]=0,X.__data[8]=Q.elements[6],X.__data[9]=Q.elements[7],X.__data[10]=Q.elements[8],X.__data[11]=0):(Q.toArray(X.__data,K),K+=ie.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,q,X.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function f(T,C,A,k){const I=T.value,N=C+"_"+A;if(k[N]===void 0)return typeof I=="number"||typeof I=="boolean"?k[N]=I:k[N]=I.clone(),!0;{const U=k[N];if(typeof I=="number"||typeof I=="boolean"){if(U!==I)return k[N]=I,!0}else if(U.equals(I)===!1)return U.copy(I),!0}return!1}function p(T){const C=T.uniforms;let A=0;const k=16;for(let N=0,U=C.length;N<U;N++){const F=Array.isArray(C[N])?C[N]:[C[N]];for(let $=0,X=F.length;$<X;$++){const q=F[$],W=Array.isArray(q.value)?q.value:[q.value];for(let K=0,ne=W.length;K<ne;K++){const Q=W[K],ie=g(Q),G=A%k,Z=G%ie.boundary,se=G+Z;A+=Z,se!==0&&k-se<ie.storage&&(A+=k-se),q.__data=new Float32Array(ie.storage/Float32Array.BYTES_PER_ELEMENT),q.__offset=A,A+=ie.storage}}}const I=A%k;return I>0&&(A+=k-I),T.__size=A,T.__cache={},this}function g(T){const C={boundary:0,storage:0};return typeof T=="number"||typeof T=="boolean"?(C.boundary=4,C.storage=4):T.isVector2?(C.boundary=8,C.storage=8):T.isVector3||T.isColor?(C.boundary=16,C.storage=12):T.isVector4?(C.boundary=16,C.storage=16):T.isMatrix3?(C.boundary=48,C.storage=48):T.isMatrix4?(C.boundary=64,C.storage=64):T.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",T),C}function v(T){const C=T.target;C.removeEventListener("dispose",v);const A=o.indexOf(C.__bindingPointIndex);o.splice(A,1),t.deleteBuffer(i[C.id]),delete i[C.id],delete s[C.id]}function E(){for(const T in i)t.deleteBuffer(i[T]);o=[],i={},s={}}return{bind:c,update:l,dispose:E}}class Yae{constructor(e={}){const{canvas:n=Une(),context:r=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1,reverseDepthBuffer:h=!1}=e;this.isWebGLRenderer=!0;let f;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=r.getContextAttributes().alpha}else f=o;const p=new Uint32Array(4),g=new Int32Array(4);let v=null,E=null;const T=[],C=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Lo,this.toneMapping=ap,this.toneMappingExposure=1;const A=this;let k=!1,I=0,N=0,U=null,F=-1,$=null;const X=new Fo,q=new Fo;let W=null;const K=new bi(0);let ne=0,Q=n.width,ie=n.height,G=1,Z=null,se=null;const ue=new Fo(0,0,Q,ie),Ae=new Fo(0,0,Q,ie);let Be=!1;const Se=new L8;let Pe=!1,we=!1;const Te=new To,Oe=new To,_t=new ht,Ct=new Fo,me={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ge=!1;function nt(){return U===null?G:1}let Ce=r;function ut(ve,Ke){return n.getContext(ve,Ke)}try{const ve={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${yA}`),n.addEventListener("webglcontextlost",xt,!1),n.addEventListener("webglcontextrestored",sn,!1),n.addEventListener("webglcontextcreationerror",Jt,!1),Ce===null){const Ke="webgl2";if(Ce=ut(Ke,ve),Ce===null)throw ut(Ke)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ve){throw console.error("THREE.WebGLRenderer: "+ve.message),ve}let He,Rt,$t,Tt,Ft,Ee,le,We,it,je,Fe,Ht,St,Dt,oe,j,V,fe,Ie,Ue,dt,yt,Dn,Le;function Lt(){He=new eoe(Ce),He.init(),yt=new Bae(Ce,He),Rt=new Kse(Ce,He,e,yt),$t=new Lae(Ce,He),Rt.reverseDepthBuffer&&h&&$t.buffers.depth.setReversed(!0),Tt=new roe(Ce),Ft=new Eae,Ee=new Fae(Ce,He,$t,Ft,Rt,yt,Tt),le=new Xse(A),We=new Zse(A),it=new ure(Ce),Dn=new qse(Ce,it),je=new toe(Ce,it,Tt,Dn),Fe=new soe(Ce,je,it,Tt),Ie=new ioe(Ce,Rt,Ee),j=new Yse(Ft),Ht=new bae(A,le,We,He,Rt,Dn,j),St=new Wae(A,Ft),Dt=new wae,oe=new Mae(He),fe=new Gse(A,le,We,$t,Fe,f,c),V=new Pae(A,Fe,Rt),Le=new Kae(Ce,Tt,Rt,$t),Ue=new Wse(Ce,He,Tt),dt=new noe(Ce,He,Tt),Tt.programs=Ht.programs,A.capabilities=Rt,A.extensions=He,A.properties=Ft,A.renderLists=Dt,A.shadowMap=V,A.state=$t,A.info=Tt}Lt();const rt=new Gae(A,Ce);this.xr=rt,this.getContext=function(){return Ce},this.getContextAttributes=function(){return Ce.getContextAttributes()},this.forceContextLoss=function(){const ve=He.get("WEBGL_lose_context");ve&&ve.loseContext()},this.forceContextRestore=function(){const ve=He.get("WEBGL_lose_context");ve&&ve.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(ve){ve!==void 0&&(G=ve,this.setSize(Q,ie,!1))},this.getSize=function(ve){return ve.set(Q,ie)},this.setSize=function(ve,Ke,pt=!0){if(rt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Q=ve,ie=Ke,n.width=Math.floor(ve*G),n.height=Math.floor(Ke*G),pt===!0&&(n.style.width=ve+"px",n.style.height=Ke+"px"),this.setViewport(0,0,ve,Ke)},this.getDrawingBufferSize=function(ve){return ve.set(Q*G,ie*G).floor()},this.setDrawingBufferSize=function(ve,Ke,pt){Q=ve,ie=Ke,G=pt,n.width=Math.floor(ve*pt),n.height=Math.floor(Ke*pt),this.setViewport(0,0,ve,Ke)},this.getCurrentViewport=function(ve){return ve.copy(X)},this.getViewport=function(ve){return ve.copy(ue)},this.setViewport=function(ve,Ke,pt,vt){ve.isVector4?ue.set(ve.x,ve.y,ve.z,ve.w):ue.set(ve,Ke,pt,vt),$t.viewport(X.copy(ue).multiplyScalar(G).round())},this.getScissor=function(ve){return ve.copy(Ae)},this.setScissor=function(ve,Ke,pt,vt){ve.isVector4?Ae.set(ve.x,ve.y,ve.z,ve.w):Ae.set(ve,Ke,pt,vt),$t.scissor(q.copy(Ae).multiplyScalar(G).round())},this.getScissorTest=function(){return Be},this.setScissorTest=function(ve){$t.setScissorTest(Be=ve)},this.setOpaqueSort=function(ve){Z=ve},this.setTransparentSort=function(ve){se=ve},this.getClearColor=function(ve){return ve.copy(fe.getClearColor())},this.setClearColor=function(){fe.setClearColor.apply(fe,arguments)},this.getClearAlpha=function(){return fe.getClearAlpha()},this.setClearAlpha=function(){fe.setClearAlpha.apply(fe,arguments)},this.clear=function(ve=!0,Ke=!0,pt=!0){let vt=0;if(ve){let Xe=!1;if(U!==null){const zt=U.texture.format;Xe=zt===EA||zt===WU||zt===qU}if(Xe){const zt=U.texture.type,Qt=zt===Gc||zt===s_||zt===fw||zt===H0||zt===zU||zt===GU,hn=fe.getClearColor(),mn=fe.getClearAlpha(),Un=hn.r,Jn=hn.g,_n=hn.b;Qt?(p[0]=Un,p[1]=Jn,p[2]=_n,p[3]=mn,Ce.clearBufferuiv(Ce.COLOR,0,p)):(g[0]=Un,g[1]=Jn,g[2]=_n,g[3]=mn,Ce.clearBufferiv(Ce.COLOR,0,g))}else vt|=Ce.COLOR_BUFFER_BIT}Ke&&(vt|=Ce.DEPTH_BUFFER_BIT),pt&&(vt|=Ce.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ce.clear(vt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",xt,!1),n.removeEventListener("webglcontextrestored",sn,!1),n.removeEventListener("webglcontextcreationerror",Jt,!1),Dt.dispose(),oe.dispose(),Ft.dispose(),le.dispose(),We.dispose(),Fe.dispose(),Dn.dispose(),Le.dispose(),Ht.dispose(),rt.dispose(),rt.removeEventListener("sessionstart",lr),rt.removeEventListener("sessionend",zn),dn.stop()};function xt(ve){ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),k=!0}function sn(){console.log("THREE.WebGLRenderer: Context Restored."),k=!1;const ve=Tt.autoReset,Ke=V.enabled,pt=V.autoUpdate,vt=V.needsUpdate,Xe=V.type;Lt(),Tt.autoReset=ve,V.enabled=Ke,V.autoUpdate=pt,V.needsUpdate=vt,V.type=Xe}function Jt(ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ve.statusMessage)}function De(ve){const Ke=ve.target;Ke.removeEventListener("dispose",De),tt(Ke)}function tt(ve){Et(ve),Ft.remove(ve)}function Et(ve){const Ke=Ft.get(ve).programs;Ke!==void 0&&(Ke.forEach(function(pt){Ht.releaseProgram(pt)}),ve.isShaderMaterial&&Ht.releaseShaderCache(ve))}this.renderBufferDirect=function(ve,Ke,pt,vt,Xe,zt){Ke===null&&(Ke=me);const Qt=Xe.isMesh&&Xe.matrixWorld.determinant()<0,hn=Vd(ve,Ke,pt,vt,Xe);$t.setMaterial(vt,Qt);let mn=pt.index,Un=1;if(vt.wireframe===!0){if(mn=je.getWireframeAttribute(pt),mn===void 0)return;Un=2}const Jn=pt.drawRange,_n=pt.attributes.position;let br=Jn.start*Un,Gr=(Jn.start+Jn.count)*Un;zt!==null&&(br=Math.max(br,zt.start*Un),Gr=Math.min(Gr,(zt.start+zt.count)*Un)),mn!==null?(br=Math.max(br,0),Gr=Math.min(Gr,mn.count)):_n!=null&&(br=Math.max(br,0),Gr=Math.min(Gr,_n.count));const En=Gr-br;if(En<0||En===1/0)return;Dn.setup(Xe,vt,hn,pt,mn);let Bn,Er=Ue;if(mn!==null&&(Bn=it.get(mn),Er=dt,Er.setIndex(Bn)),Xe.isMesh)vt.wireframe===!0?($t.setLineWidth(vt.wireframeLinewidth*nt()),Er.setMode(Ce.LINES)):Er.setMode(Ce.TRIANGLES);else if(Xe.isLine){let on=vt.linewidth;on===void 0&&(on=1),$t.setLineWidth(on*nt()),Xe.isLineSegments?Er.setMode(Ce.LINES):Xe.isLineLoop?Er.setMode(Ce.LINE_LOOP):Er.setMode(Ce.LINE_STRIP)}else Xe.isPoints?Er.setMode(Ce.POINTS):Xe.isSprite&&Er.setMode(Ce.TRIANGLES);if(Xe.isBatchedMesh)if(Xe._multiDrawInstances!==null)Er.renderMultiDrawInstances(Xe._multiDrawStarts,Xe._multiDrawCounts,Xe._multiDrawCount,Xe._multiDrawInstances);else if(He.get("WEBGL_multi_draw"))Er.renderMultiDraw(Xe._multiDrawStarts,Xe._multiDrawCounts,Xe._multiDrawCount);else{const on=Xe._multiDrawStarts,Wi=Xe._multiDrawCounts,Sr=Xe._multiDrawCount,Fs=mn?it.get(mn).bytesPerElement:1,Qn=Ft.get(vt).currentProgram.getUniforms();for(let ur=0;ur<Sr;ur++)Qn.setValue(Ce,"_gl_DrawID",ur),Er.render(on[ur]/Fs,Wi[ur])}else if(Xe.isInstancedMesh)Er.renderInstances(br,En,Xe.count);else if(pt.isInstancedBufferGeometry){const on=pt._maxInstanceCount!==void 0?pt._maxInstanceCount:1/0,Wi=Math.min(pt.instanceCount,on);Er.renderInstances(br,En,Wi)}else Er.render(br,En)};function wt(ve,Ke,pt){ve.transparent===!0&&ve.side===$u&&ve.forceSinglePass===!1?(ve.side=ec,ve.needsUpdate=!0,si(ve,Ke,pt),ve.side=ng,ve.needsUpdate=!0,si(ve,Ke,pt),ve.side=$u):si(ve,Ke,pt)}this.compile=function(ve,Ke,pt=null){pt===null&&(pt=ve),E=oe.get(pt),E.init(Ke),C.push(E),pt.traverseVisible(function(Xe){Xe.isLight&&Xe.layers.test(Ke.layers)&&(E.pushLight(Xe),Xe.castShadow&&E.pushShadow(Xe))}),ve!==pt&&ve.traverseVisible(function(Xe){Xe.isLight&&Xe.layers.test(Ke.layers)&&(E.pushLight(Xe),Xe.castShadow&&E.pushShadow(Xe))}),E.setupLights();const vt=new Set;return ve.traverse(function(Xe){if(!(Xe.isMesh||Xe.isPoints||Xe.isLine||Xe.isSprite))return;const zt=Xe.material;if(zt)if(Array.isArray(zt))for(let Qt=0;Qt<zt.length;Qt++){const hn=zt[Qt];wt(hn,pt,Xe),vt.add(hn)}else wt(zt,pt,Xe),vt.add(zt)}),C.pop(),E=null,vt},this.compileAsync=function(ve,Ke,pt=null){const vt=this.compile(ve,Ke,pt);return new Promise(Xe=>{function zt(){if(vt.forEach(function(Qt){Ft.get(Qt).currentProgram.isReady()&&vt.delete(Qt)}),vt.size===0){Xe(ve);return}setTimeout(zt,10)}He.get("KHR_parallel_shader_compile")!==null?zt():setTimeout(zt,10)})};let Pn=null;function Xr(ve){Pn&&Pn(ve)}function lr(){dn.stop()}function zn(){dn.start()}const dn=new U8;dn.setAnimationLoop(Xr),typeof self<"u"&&dn.setContext(self),this.setAnimationLoop=function(ve){Pn=ve,rt.setAnimationLoop(ve),ve===null?dn.stop():dn.start()},rt.addEventListener("sessionstart",lr),rt.addEventListener("sessionend",zn),this.render=function(ve,Ke){if(Ke!==void 0&&Ke.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(k===!0)return;if(ve.matrixWorldAutoUpdate===!0&&ve.updateMatrixWorld(),Ke.parent===null&&Ke.matrixWorldAutoUpdate===!0&&Ke.updateMatrixWorld(),rt.enabled===!0&&rt.isPresenting===!0&&(rt.cameraAutoUpdate===!0&&rt.updateCamera(Ke),Ke=rt.getCamera()),ve.isScene===!0&&ve.onBeforeRender(A,ve,Ke,U),E=oe.get(ve,C.length),E.init(Ke),C.push(E),Oe.multiplyMatrices(Ke.projectionMatrix,Ke.matrixWorldInverse),Se.setFromProjectionMatrix(Oe),we=this.localClippingEnabled,Pe=j.init(this.clippingPlanes,we),v=Dt.get(ve,T.length),v.init(),T.push(v),rt.enabled===!0&&rt.isPresenting===!0){const zt=A.xr.getDepthSensingMesh();zt!==null&&tn(zt,Ke,-1/0,A.sortObjects)}tn(ve,Ke,0,A.sortObjects),v.finish(),A.sortObjects===!0&&v.sort(Z,se),ge=rt.enabled===!1||rt.isPresenting===!1||rt.hasDepthSensing()===!1,ge&&fe.addToRenderList(v,ve),this.info.render.frame++,Pe===!0&&j.beginShadows();const pt=E.state.shadowsArray;V.render(pt,ve,Ke),Pe===!0&&j.endShadows(),this.info.autoReset===!0&&this.info.reset();const vt=v.opaque,Xe=v.transmissive;if(E.setupLights(),Ke.isArrayCamera){const zt=Ke.cameras;if(Xe.length>0)for(let Qt=0,hn=zt.length;Qt<hn;Qt++){const mn=zt[Qt];Rn(vt,Xe,ve,mn)}ge&&fe.render(ve);for(let Qt=0,hn=zt.length;Qt<hn;Qt++){const mn=zt[Qt];Cn(v,ve,mn,mn.viewport)}}else Xe.length>0&&Rn(vt,Xe,ve,Ke),ge&&fe.render(ve),Cn(v,ve,Ke);U!==null&&(Ee.updateMultisampleRenderTarget(U),Ee.updateRenderTargetMipmap(U)),ve.isScene===!0&&ve.onAfterRender(A,ve,Ke),Dn.resetDefaultState(),F=-1,$=null,C.pop(),C.length>0?(E=C[C.length-1],Pe===!0&&j.setGlobalState(A.clippingPlanes,E.state.camera)):E=null,T.pop(),T.length>0?v=T[T.length-1]:v=null};function tn(ve,Ke,pt,vt){if(ve.visible===!1)return;if(ve.layers.test(Ke.layers)){if(ve.isGroup)pt=ve.renderOrder;else if(ve.isLOD)ve.autoUpdate===!0&&ve.update(Ke);else if(ve.isLight)E.pushLight(ve),ve.castShadow&&E.pushShadow(ve);else if(ve.isSprite){if(!ve.frustumCulled||Se.intersectsSprite(ve)){vt&&Ct.setFromMatrixPosition(ve.matrixWorld).applyMatrix4(Oe);const Qt=Fe.update(ve),hn=ve.material;hn.visible&&v.push(ve,Qt,hn,pt,Ct.z,null)}}else if((ve.isMesh||ve.isLine||ve.isPoints)&&(!ve.frustumCulled||Se.intersectsObject(ve))){const Qt=Fe.update(ve),hn=ve.material;if(vt&&(ve.boundingSphere!==void 0?(ve.boundingSphere===null&&ve.computeBoundingSphere(),Ct.copy(ve.boundingSphere.center)):(Qt.boundingSphere===null&&Qt.computeBoundingSphere(),Ct.copy(Qt.boundingSphere.center)),Ct.applyMatrix4(ve.matrixWorld).applyMatrix4(Oe)),Array.isArray(hn)){const mn=Qt.groups;for(let Un=0,Jn=mn.length;Un<Jn;Un++){const _n=mn[Un],br=hn[_n.materialIndex];br&&br.visible&&v.push(ve,Qt,br,pt,Ct.z,_n)}}else hn.visible&&v.push(ve,Qt,hn,pt,Ct.z,null)}}const zt=ve.children;for(let Qt=0,hn=zt.length;Qt<hn;Qt++)tn(zt[Qt],Ke,pt,vt)}function Cn(ve,Ke,pt,vt){const Xe=ve.opaque,zt=ve.transmissive,Qt=ve.transparent;E.setupLightsView(pt),Pe===!0&&j.setGlobalState(A.clippingPlanes,pt),vt&&$t.viewport(X.copy(vt)),Xe.length>0&&yr(Xe,Ke,pt),zt.length>0&&yr(zt,Ke,pt),Qt.length>0&&yr(Qt,Ke,pt),$t.buffers.depth.setTest(!0),$t.buffers.depth.setMask(!0),$t.buffers.color.setMask(!0),$t.setPolygonOffset(!1)}function Rn(ve,Ke,pt,vt){if((pt.isScene===!0?pt.overrideMaterial:null)!==null)return;E.state.transmissionRenderTarget[vt.id]===void 0&&(E.state.transmissionRenderTarget[vt.id]=new Ku(1,1,{generateMipmaps:!0,type:He.has("EXT_color_buffer_half_float")||He.has("EXT_color_buffer_float")?GE:Gc,minFilter:R0,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ki.workingColorSpace}));const zt=E.state.transmissionRenderTarget[vt.id],Qt=vt.viewport||X;zt.setSize(Qt.z,Qt.w);const hn=A.getRenderTarget();A.setRenderTarget(zt),A.getClearColor(K),ne=A.getClearAlpha(),ne<1&&A.setClearColor(16777215,.5),A.clear(),ge&&fe.render(pt);const mn=A.toneMapping;A.toneMapping=ap;const Un=vt.viewport;if(vt.viewport!==void 0&&(vt.viewport=void 0),E.setupLightsView(vt),Pe===!0&&j.setGlobalState(A.clippingPlanes,vt),yr(ve,pt,vt),Ee.updateMultisampleRenderTarget(zt),Ee.updateRenderTargetMipmap(zt),He.has("WEBGL_multisampled_render_to_texture")===!1){let Jn=!1;for(let _n=0,br=Ke.length;_n<br;_n++){const Gr=Ke[_n],En=Gr.object,Bn=Gr.geometry,Er=Gr.material,on=Gr.group;if(Er.side===$u&&En.layers.test(vt.layers)){const Wi=Er.side;Er.side=ec,Er.needsUpdate=!0,hi(En,pt,vt,Bn,Er,on),Er.side=Wi,Er.needsUpdate=!0,Jn=!0}}Jn===!0&&(Ee.updateMultisampleRenderTarget(zt),Ee.updateRenderTargetMipmap(zt))}A.setRenderTarget(hn),A.setClearColor(K,ne),Un!==void 0&&(vt.viewport=Un),A.toneMapping=mn}function yr(ve,Ke,pt){const vt=Ke.isScene===!0?Ke.overrideMaterial:null;for(let Xe=0,zt=ve.length;Xe<zt;Xe++){const Qt=ve[Xe],hn=Qt.object,mn=Qt.geometry,Un=vt===null?Qt.material:vt,Jn=Qt.group;hn.layers.test(pt.layers)&&hi(hn,Ke,pt,mn,Un,Jn)}}function hi(ve,Ke,pt,vt,Xe,zt){ve.onBeforeRender(A,Ke,pt,vt,Xe,zt),ve.modelViewMatrix.multiplyMatrices(pt.matrixWorldInverse,ve.matrixWorld),ve.normalMatrix.getNormalMatrix(ve.modelViewMatrix),Xe.onBeforeRender(A,Ke,pt,vt,ve,zt),Xe.transparent===!0&&Xe.side===$u&&Xe.forceSinglePass===!1?(Xe.side=ec,Xe.needsUpdate=!0,A.renderBufferDirect(pt,Ke,vt,Xe,ve,zt),Xe.side=ng,Xe.needsUpdate=!0,A.renderBufferDirect(pt,Ke,vt,Xe,ve,zt),Xe.side=$u):A.renderBufferDirect(pt,Ke,vt,Xe,ve,zt),ve.onAfterRender(A,Ke,pt,vt,Xe,zt)}function si(ve,Ke,pt){Ke.isScene!==!0&&(Ke=me);const vt=Ft.get(ve),Xe=E.state.lights,zt=E.state.shadowsArray,Qt=Xe.state.version,hn=Ht.getParameters(ve,Xe.state,zt,Ke,pt),mn=Ht.getProgramCacheKey(hn);let Un=vt.programs;vt.environment=ve.isMeshStandardMaterial?Ke.environment:null,vt.fog=Ke.fog,vt.envMap=(ve.isMeshStandardMaterial?We:le).get(ve.envMap||vt.environment),vt.envMapRotation=vt.environment!==null&&ve.envMap===null?Ke.environmentRotation:ve.envMapRotation,Un===void 0&&(ve.addEventListener("dispose",De),Un=new Map,vt.programs=Un);let Jn=Un.get(mn);if(Jn!==void 0){if(vt.currentProgram===Jn&&vt.lightsStateVersion===Qt)return mu(ve,hn),Jn}else hn.uniforms=Ht.getUniforms(ve),ve.onBeforeCompile(hn,A),Jn=Ht.acquireProgram(hn,mn),Un.set(mn,Jn),vt.uniforms=hn.uniforms;const _n=vt.uniforms;return(!ve.isShaderMaterial&&!ve.isRawShaderMaterial||ve.clipping===!0)&&(_n.clippingPlanes=j.uniform),mu(ve,hn),vt.needsLights=sf(ve),vt.lightsStateVersion=Qt,vt.needsLights&&(_n.ambientLightColor.value=Xe.state.ambient,_n.lightProbe.value=Xe.state.probe,_n.directionalLights.value=Xe.state.directional,_n.directionalLightShadows.value=Xe.state.directionalShadow,_n.spotLights.value=Xe.state.spot,_n.spotLightShadows.value=Xe.state.spotShadow,_n.rectAreaLights.value=Xe.state.rectArea,_n.ltc_1.value=Xe.state.rectAreaLTC1,_n.ltc_2.value=Xe.state.rectAreaLTC2,_n.pointLights.value=Xe.state.point,_n.pointLightShadows.value=Xe.state.pointShadow,_n.hemisphereLights.value=Xe.state.hemi,_n.directionalShadowMap.value=Xe.state.directionalShadowMap,_n.directionalShadowMatrix.value=Xe.state.directionalShadowMatrix,_n.spotShadowMap.value=Xe.state.spotShadowMap,_n.spotLightMatrix.value=Xe.state.spotLightMatrix,_n.spotLightMap.value=Xe.state.spotLightMap,_n.pointShadowMap.value=Xe.state.pointShadowMap,_n.pointShadowMatrix.value=Xe.state.pointShadowMatrix),vt.currentProgram=Jn,vt.uniformsList=null,Jn}function Co(ve){if(ve.uniformsList===null){const Ke=ve.currentProgram.getUniforms();ve.uniformsList=i1.seqWithValue(Ke.seq,ve.uniforms)}return ve.uniformsList}function mu(ve,Ke){const pt=Ft.get(ve);pt.outputColorSpace=Ke.outputColorSpace,pt.batching=Ke.batching,pt.batchingColor=Ke.batchingColor,pt.instancing=Ke.instancing,pt.instancingColor=Ke.instancingColor,pt.instancingMorph=Ke.instancingMorph,pt.skinning=Ke.skinning,pt.morphTargets=Ke.morphTargets,pt.morphNormals=Ke.morphNormals,pt.morphColors=Ke.morphColors,pt.morphTargetsCount=Ke.morphTargetsCount,pt.numClippingPlanes=Ke.numClippingPlanes,pt.numIntersection=Ke.numClipIntersection,pt.vertexAlphas=Ke.vertexAlphas,pt.vertexTangents=Ke.vertexTangents,pt.toneMapping=Ke.toneMapping}function Vd(ve,Ke,pt,vt,Xe){Ke.isScene!==!0&&(Ke=me),Ee.resetTextureUnits();const zt=Ke.fog,Qt=vt.isMeshStandardMaterial?Ke.environment:null,hn=U===null?A.outputColorSpace:U.isXRRenderTarget===!0?U.texture.colorSpace:S_,mn=(vt.isMeshStandardMaterial?We:le).get(vt.envMap||Qt),Un=vt.vertexColors===!0&&!!pt.attributes.color&&pt.attributes.color.itemSize===4,Jn=!!pt.attributes.tangent&&(!!vt.normalMap||vt.anisotropy>0),_n=!!pt.morphAttributes.position,br=!!pt.morphAttributes.normal,Gr=!!pt.morphAttributes.color;let En=ap;vt.toneMapped&&(U===null||U.isXRRenderTarget===!0)&&(En=A.toneMapping);const Bn=pt.morphAttributes.position||pt.morphAttributes.normal||pt.morphAttributes.color,Er=Bn!==void 0?Bn.length:0,on=Ft.get(vt),Wi=E.state.lights;if(Pe===!0&&(we===!0||ve!==$)){const Ki=ve===$&&vt.id===F;j.setState(vt,ve,Ki)}let Sr=!1;vt.version===on.__version?(on.needsLights&&on.lightsStateVersion!==Wi.state.version||on.outputColorSpace!==hn||Xe.isBatchedMesh&&on.batching===!1||!Xe.isBatchedMesh&&on.batching===!0||Xe.isBatchedMesh&&on.batchingColor===!0&&Xe.colorTexture===null||Xe.isBatchedMesh&&on.batchingColor===!1&&Xe.colorTexture!==null||Xe.isInstancedMesh&&on.instancing===!1||!Xe.isInstancedMesh&&on.instancing===!0||Xe.isSkinnedMesh&&on.skinning===!1||!Xe.isSkinnedMesh&&on.skinning===!0||Xe.isInstancedMesh&&on.instancingColor===!0&&Xe.instanceColor===null||Xe.isInstancedMesh&&on.instancingColor===!1&&Xe.instanceColor!==null||Xe.isInstancedMesh&&on.instancingMorph===!0&&Xe.morphTexture===null||Xe.isInstancedMesh&&on.instancingMorph===!1&&Xe.morphTexture!==null||on.envMap!==mn||vt.fog===!0&&on.fog!==zt||on.numClippingPlanes!==void 0&&(on.numClippingPlanes!==j.numPlanes||on.numIntersection!==j.numIntersection)||on.vertexAlphas!==Un||on.vertexTangents!==Jn||on.morphTargets!==_n||on.morphNormals!==br||on.morphColors!==Gr||on.toneMapping!==En||on.morphTargetsCount!==Er)&&(Sr=!0):(Sr=!0,on.__version=vt.version);let Fs=on.currentProgram;Sr===!0&&(Fs=si(vt,Ke,Xe));let Qn=!1,ur=!1,Pl=!1;const Si=Fs.getUniforms(),Ro=on.uniforms;if($t.useProgram(Fs.program)&&(Qn=!0,ur=!0,Pl=!0),vt.id!==F&&(F=vt.id,ur=!0),Qn||$!==ve){$t.buffers.depth.getReversed()?(Te.copy(ve.projectionMatrix),Bne(Te),jne(Te),Si.setValue(Ce,"projectionMatrix",Te)):Si.setValue(Ce,"projectionMatrix",ve.projectionMatrix),Si.setValue(Ce,"viewMatrix",ve.matrixWorldInverse);const vn=Si.map.cameraPosition;vn!==void 0&&vn.setValue(Ce,_t.setFromMatrixPosition(ve.matrixWorld)),Rt.logarithmicDepthBuffer&&Si.setValue(Ce,"logDepthBufFC",2/(Math.log(ve.far+1)/Math.LN2)),(vt.isMeshPhongMaterial||vt.isMeshToonMaterial||vt.isMeshLambertMaterial||vt.isMeshBasicMaterial||vt.isMeshStandardMaterial||vt.isShaderMaterial)&&Si.setValue(Ce,"isOrthographic",ve.isOrthographicCamera===!0),$!==ve&&($=ve,ur=!0,Pl=!0)}if(Xe.isSkinnedMesh){Si.setOptional(Ce,Xe,"bindMatrix"),Si.setOptional(Ce,Xe,"bindMatrixInverse");const Ki=Xe.skeleton;Ki&&(Ki.boneTexture===null&&Ki.computeBoneTexture(),Si.setValue(Ce,"boneTexture",Ki.boneTexture,Ee))}Xe.isBatchedMesh&&(Si.setOptional(Ce,Xe,"batchingTexture"),Si.setValue(Ce,"batchingTexture",Xe._matricesTexture,Ee),Si.setOptional(Ce,Xe,"batchingIdTexture"),Si.setValue(Ce,"batchingIdTexture",Xe._indirectTexture,Ee),Si.setOptional(Ce,Xe,"batchingColorTexture"),Xe._colorsTexture!==null&&Si.setValue(Ce,"batchingColorTexture",Xe._colorsTexture,Ee));const Dl=pt.morphAttributes;if((Dl.position!==void 0||Dl.normal!==void 0||Dl.color!==void 0)&&Ie.update(Xe,pt,Fs),(ur||on.receiveShadow!==Xe.receiveShadow)&&(on.receiveShadow=Xe.receiveShadow,Si.setValue(Ce,"receiveShadow",Xe.receiveShadow)),vt.isMeshGouraudMaterial&&vt.envMap!==null&&(Ro.envMap.value=mn,Ro.flipEnvMap.value=mn.isCubeTexture&&mn.isRenderTargetTexture===!1?-1:1),vt.isMeshStandardMaterial&&vt.envMap===null&&Ke.environment!==null&&(Ro.envMapIntensity.value=Ke.environmentIntensity),ur&&(Si.setValue(Ce,"toneMappingExposure",A.toneMappingExposure),on.needsLights&&rf(Ro,Pl),zt&&vt.fog===!0&&St.refreshFogUniforms(Ro,zt),St.refreshMaterialUniforms(Ro,vt,G,ie,E.state.transmissionRenderTarget[ve.id]),i1.upload(Ce,Co(on),Ro,Ee)),vt.isShaderMaterial&&vt.uniformsNeedUpdate===!0&&(i1.upload(Ce,Co(on),Ro,Ee),vt.uniformsNeedUpdate=!1),vt.isSpriteMaterial&&Si.setValue(Ce,"center",Xe.center),Si.setValue(Ce,"modelViewMatrix",Xe.modelViewMatrix),Si.setValue(Ce,"normalMatrix",Xe.normalMatrix),Si.setValue(Ce,"modelMatrix",Xe.matrixWorld),vt.isShaderMaterial||vt.isRawShaderMaterial){const Ki=vt.uniformsGroups;for(let vn=0,sc=Ki.length;vn<sc;vn++){const Ll=Ki[vn];Le.update(Ll,Fs),Le.bind(Ll,Fs)}}return Fs}function rf(ve,Ke){ve.ambientLightColor.needsUpdate=Ke,ve.lightProbe.needsUpdate=Ke,ve.directionalLights.needsUpdate=Ke,ve.directionalLightShadows.needsUpdate=Ke,ve.pointLights.needsUpdate=Ke,ve.pointLightShadows.needsUpdate=Ke,ve.spotLights.needsUpdate=Ke,ve.spotLightShadows.needsUpdate=Ke,ve.rectAreaLights.needsUpdate=Ke,ve.hemisphereLights.needsUpdate=Ke}function sf(ve){return ve.isMeshLambertMaterial||ve.isMeshToonMaterial||ve.isMeshPhongMaterial||ve.isMeshStandardMaterial||ve.isShadowMaterial||ve.isShaderMaterial&&ve.lights===!0}this.getActiveCubeFace=function(){return I},this.getActiveMipmapLevel=function(){return N},this.getRenderTarget=function(){return U},this.setRenderTargetTextures=function(ve,Ke,pt){Ft.get(ve.texture).__webglTexture=Ke,Ft.get(ve.depthTexture).__webglTexture=pt;const vt=Ft.get(ve);vt.__hasExternalTextures=!0,vt.__autoAllocateDepthBuffer=pt===void 0,vt.__autoAllocateDepthBuffer||He.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),vt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(ve,Ke){const pt=Ft.get(ve);pt.__webglFramebuffer=Ke,pt.__useDefaultFramebuffer=Ke===void 0},this.setRenderTarget=function(ve,Ke=0,pt=0){U=ve,I=Ke,N=pt;let vt=!0,Xe=null,zt=!1,Qt=!1;if(ve){const mn=Ft.get(ve);if(mn.__useDefaultFramebuffer!==void 0)$t.bindFramebuffer(Ce.FRAMEBUFFER,null),vt=!1;else if(mn.__webglFramebuffer===void 0)Ee.setupRenderTarget(ve);else if(mn.__hasExternalTextures)Ee.rebindTextures(ve,Ft.get(ve.texture).__webglTexture,Ft.get(ve.depthTexture).__webglTexture);else if(ve.depthBuffer){const _n=ve.depthTexture;if(mn.__boundDepthTexture!==_n){if(_n!==null&&Ft.has(_n)&&(ve.width!==_n.image.width||ve.height!==_n.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ee.setupDepthRenderbuffer(ve)}}const Un=ve.texture;(Un.isData3DTexture||Un.isDataArrayTexture||Un.isCompressedArrayTexture)&&(Qt=!0);const Jn=Ft.get(ve).__webglFramebuffer;ve.isWebGLCubeRenderTarget?(Array.isArray(Jn[Ke])?Xe=Jn[Ke][pt]:Xe=Jn[Ke],zt=!0):ve.samples>0&&Ee.useMultisampledRTT(ve)===!1?Xe=Ft.get(ve).__webglMultisampledFramebuffer:Array.isArray(Jn)?Xe=Jn[pt]:Xe=Jn,X.copy(ve.viewport),q.copy(ve.scissor),W=ve.scissorTest}else X.copy(ue).multiplyScalar(G).floor(),q.copy(Ae).multiplyScalar(G).floor(),W=Be;if($t.bindFramebuffer(Ce.FRAMEBUFFER,Xe)&&vt&&$t.drawBuffers(ve,Xe),$t.viewport(X),$t.scissor(q),$t.setScissorTest(W),zt){const mn=Ft.get(ve.texture);Ce.framebufferTexture2D(Ce.FRAMEBUFFER,Ce.COLOR_ATTACHMENT0,Ce.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,mn.__webglTexture,pt)}else if(Qt){const mn=Ft.get(ve.texture),Un=Ke||0;Ce.framebufferTextureLayer(Ce.FRAMEBUFFER,Ce.COLOR_ATTACHMENT0,mn.__webglTexture,pt||0,Un)}F=-1},this.readRenderTargetPixels=function(ve,Ke,pt,vt,Xe,zt,Qt){if(!(ve&&ve.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let hn=Ft.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&Qt!==void 0&&(hn=hn[Qt]),hn){$t.bindFramebuffer(Ce.FRAMEBUFFER,hn);try{const mn=ve.texture,Un=mn.format,Jn=mn.type;if(!Rt.textureFormatReadable(Un)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Rt.textureTypeReadable(Jn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ke>=0&&Ke<=ve.width-vt&&pt>=0&&pt<=ve.height-Xe&&Ce.readPixels(Ke,pt,vt,Xe,yt.convert(Un),yt.convert(Jn),zt)}finally{const mn=U!==null?Ft.get(U).__webglFramebuffer:null;$t.bindFramebuffer(Ce.FRAMEBUFFER,mn)}}},this.readRenderTargetPixelsAsync=async function(ve,Ke,pt,vt,Xe,zt,Qt){if(!(ve&&ve.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let hn=Ft.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&Qt!==void 0&&(hn=hn[Qt]),hn){const mn=ve.texture,Un=mn.format,Jn=mn.type;if(!Rt.textureFormatReadable(Un))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Rt.textureTypeReadable(Jn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Ke>=0&&Ke<=ve.width-vt&&pt>=0&&pt<=ve.height-Xe){$t.bindFramebuffer(Ce.FRAMEBUFFER,hn);const _n=Ce.createBuffer();Ce.bindBuffer(Ce.PIXEL_PACK_BUFFER,_n),Ce.bufferData(Ce.PIXEL_PACK_BUFFER,zt.byteLength,Ce.STREAM_READ),Ce.readPixels(Ke,pt,vt,Xe,yt.convert(Un),yt.convert(Jn),0);const br=U!==null?Ft.get(U).__webglFramebuffer:null;$t.bindFramebuffer(Ce.FRAMEBUFFER,br);const Gr=Ce.fenceSync(Ce.SYNC_GPU_COMMANDS_COMPLETE,0);return Ce.flush(),await Fne(Ce,Gr,4),Ce.bindBuffer(Ce.PIXEL_PACK_BUFFER,_n),Ce.getBufferSubData(Ce.PIXEL_PACK_BUFFER,0,zt),Ce.deleteBuffer(_n),Ce.deleteSync(Gr),zt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ve,Ke=null,pt=0){ve.isTexture!==!0&&(US("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Ke=arguments[0]||null,ve=arguments[1]);const vt=Math.pow(2,-pt),Xe=Math.floor(ve.image.width*vt),zt=Math.floor(ve.image.height*vt),Qt=Ke!==null?Ke.x:0,hn=Ke!==null?Ke.y:0;Ee.setTexture2D(ve,0),Ce.copyTexSubImage2D(Ce.TEXTURE_2D,pt,0,0,Qt,hn,Xe,zt),$t.unbindTexture()},this.copyTextureToTexture=function(ve,Ke,pt=null,vt=null,Xe=0){ve.isTexture!==!0&&(US("WebGLRenderer: copyTextureToTexture function signature has changed."),vt=arguments[0]||null,ve=arguments[1],Ke=arguments[2],Xe=arguments[3]||0,pt=null);let zt,Qt,hn,mn,Un,Jn,_n,br,Gr;const En=ve.isCompressedTexture?ve.mipmaps[Xe]:ve.image;pt!==null?(zt=pt.max.x-pt.min.x,Qt=pt.max.y-pt.min.y,hn=pt.isBox3?pt.max.z-pt.min.z:1,mn=pt.min.x,Un=pt.min.y,Jn=pt.isBox3?pt.min.z:0):(zt=En.width,Qt=En.height,hn=En.depth||1,mn=0,Un=0,Jn=0),vt!==null?(_n=vt.x,br=vt.y,Gr=vt.z):(_n=0,br=0,Gr=0);const Bn=yt.convert(Ke.format),Er=yt.convert(Ke.type);let on;Ke.isData3DTexture?(Ee.setTexture3D(Ke,0),on=Ce.TEXTURE_3D):Ke.isDataArrayTexture||Ke.isCompressedArrayTexture?(Ee.setTexture2DArray(Ke,0),on=Ce.TEXTURE_2D_ARRAY):(Ee.setTexture2D(Ke,0),on=Ce.TEXTURE_2D),Ce.pixelStorei(Ce.UNPACK_FLIP_Y_WEBGL,Ke.flipY),Ce.pixelStorei(Ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ke.premultiplyAlpha),Ce.pixelStorei(Ce.UNPACK_ALIGNMENT,Ke.unpackAlignment);const Wi=Ce.getParameter(Ce.UNPACK_ROW_LENGTH),Sr=Ce.getParameter(Ce.UNPACK_IMAGE_HEIGHT),Fs=Ce.getParameter(Ce.UNPACK_SKIP_PIXELS),Qn=Ce.getParameter(Ce.UNPACK_SKIP_ROWS),ur=Ce.getParameter(Ce.UNPACK_SKIP_IMAGES);Ce.pixelStorei(Ce.UNPACK_ROW_LENGTH,En.width),Ce.pixelStorei(Ce.UNPACK_IMAGE_HEIGHT,En.height),Ce.pixelStorei(Ce.UNPACK_SKIP_PIXELS,mn),Ce.pixelStorei(Ce.UNPACK_SKIP_ROWS,Un),Ce.pixelStorei(Ce.UNPACK_SKIP_IMAGES,Jn);const Pl=ve.isDataArrayTexture||ve.isData3DTexture,Si=Ke.isDataArrayTexture||Ke.isData3DTexture;if(ve.isRenderTargetTexture||ve.isDepthTexture){const Ro=Ft.get(ve),Dl=Ft.get(Ke),Ki=Ft.get(Ro.__renderTarget),vn=Ft.get(Dl.__renderTarget);$t.bindFramebuffer(Ce.READ_FRAMEBUFFER,Ki.__webglFramebuffer),$t.bindFramebuffer(Ce.DRAW_FRAMEBUFFER,vn.__webglFramebuffer);for(let sc=0;sc<hn;sc++)Pl&&Ce.framebufferTextureLayer(Ce.READ_FRAMEBUFFER,Ce.COLOR_ATTACHMENT0,Ft.get(ve).__webglTexture,Xe,Jn+sc),ve.isDepthTexture?(Si&&Ce.framebufferTextureLayer(Ce.DRAW_FRAMEBUFFER,Ce.COLOR_ATTACHMENT0,Ft.get(Ke).__webglTexture,Xe,Gr+sc),Ce.blitFramebuffer(mn,Un,zt,Qt,_n,br,zt,Qt,Ce.DEPTH_BUFFER_BIT,Ce.NEAREST)):Si?Ce.copyTexSubImage3D(on,Xe,_n,br,Gr+sc,mn,Un,zt,Qt):Ce.copyTexSubImage2D(on,Xe,_n,br,Gr+sc,mn,Un,zt,Qt);$t.bindFramebuffer(Ce.READ_FRAMEBUFFER,null),$t.bindFramebuffer(Ce.DRAW_FRAMEBUFFER,null)}else Si?ve.isDataTexture||ve.isData3DTexture?Ce.texSubImage3D(on,Xe,_n,br,Gr,zt,Qt,hn,Bn,Er,En.data):Ke.isCompressedArrayTexture?Ce.compressedTexSubImage3D(on,Xe,_n,br,Gr,zt,Qt,hn,Bn,En.data):Ce.texSubImage3D(on,Xe,_n,br,Gr,zt,Qt,hn,Bn,Er,En):ve.isDataTexture?Ce.texSubImage2D(Ce.TEXTURE_2D,Xe,_n,br,zt,Qt,Bn,Er,En.data):ve.isCompressedTexture?Ce.compressedTexSubImage2D(Ce.TEXTURE_2D,Xe,_n,br,En.width,En.height,Bn,En.data):Ce.texSubImage2D(Ce.TEXTURE_2D,Xe,_n,br,zt,Qt,Bn,Er,En);Ce.pixelStorei(Ce.UNPACK_ROW_LENGTH,Wi),Ce.pixelStorei(Ce.UNPACK_IMAGE_HEIGHT,Sr),Ce.pixelStorei(Ce.UNPACK_SKIP_PIXELS,Fs),Ce.pixelStorei(Ce.UNPACK_SKIP_ROWS,Qn),Ce.pixelStorei(Ce.UNPACK_SKIP_IMAGES,ur),Xe===0&&Ke.generateMipmaps&&Ce.generateMipmap(on),$t.unbindTexture()},this.copyTextureToTexture3D=function(ve,Ke,pt=null,vt=null,Xe=0){return ve.isTexture!==!0&&(US("WebGLRenderer: copyTextureToTexture3D function signature has changed."),pt=arguments[0]||null,vt=arguments[1]||null,ve=arguments[2],Ke=arguments[3],Xe=arguments[4]||0),US('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(ve,Ke,pt,vt,Xe)},this.initRenderTarget=function(ve){Ft.get(ve).__webglFramebuffer===void 0&&Ee.setupRenderTarget(ve)},this.initTexture=function(ve){ve.isCubeTexture?Ee.setTextureCube(ve,0):ve.isData3DTexture?Ee.setTexture3D(ve,0):ve.isDataArrayTexture||ve.isCompressedArrayTexture?Ee.setTexture2DArray(ve,0):Ee.setTexture2D(ve,0),$t.unbindTexture()},this.resetState=function(){I=0,N=0,U=null,$t.reset(),Dn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Gm}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorspace=ki._getDrawingBufferColorSpace(e),n.unpackColorSpace=ki._getUnpackColorSpace()}}class K1 extends iu{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new rg,this.environmentIntensity=1,this.environmentRotation=new rg,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class H8 extends wo{constructor(e=null,n=1,r=1,i,s,o,a,c,l=Bo,u=Bo,d,h){super(null,o,a,c,l,u,i,s,d,h),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Xae extends fg{static get type(){return"PointsMaterial"}constructor(e){super(),this.isPointsMaterial=!0,this.color=new bi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Lj=new To,cL=new YU,eC=new wA,tC=new ht;class Jae extends iu{constructor(e=new qh,n=new Xae){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),eC.copy(r.boundingSphere),eC.applyMatrix4(i),eC.radius+=s,e.ray.intersectsSphere(eC)===!1)return;Lj.copy(i).invert(),cL.copy(e.ray).applyMatrix4(Lj);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,d=r.attributes.position;if(l!==null){const h=Math.max(0,o.start),f=Math.min(l.count,o.start+o.count);for(let p=h,g=f;p<g;p++){const v=l.getX(p);tC.fromBufferAttribute(d,v),Uj(tC,v,c,i,e,n,this)}}else{const h=Math.max(0,o.start),f=Math.min(d.count,o.start+o.count);for(let p=h,g=f;p<g;p++)tC.fromBufferAttribute(d,p),Uj(tC,p,c,i,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const i=n[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Uj(t,e,n,r,i,s,o){const a=cL.distanceSqToPoint(t);if(a<n){const c=new ht;cL.closestPointToPoint(t,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class Qae extends wo{constructor(e,n,r,i,s,o,a,c,l){super(e,n,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Zae extends fg{static get type(){return"MeshNormalMaterial"}constructor(e){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=C8,this.normalScale=new Vn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}const Fj={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class ece{constructor(e,n,r){const i=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(u){a++,s===!1&&i.onStart!==void 0&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,d){return l.push(u,d),this},this.removeHandler=function(u){const d=l.indexOf(u);return d!==-1&&l.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=l.length;d<h;d+=2){const f=l[d],p=l[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}}const tce=new ece;class eF{constructor(e){this.manager=e!==void 0?e:tce,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(i,s){r.load(e,i,n,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}eF.DEFAULT_MATERIAL_NAME="__DEFAULT";class nce extends eF{constructor(e){super(e)}load(e,n,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Fj.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){n&&n(o),s.manager.itemEnd(e)},0),o;const a=mw("img");function c(){u(),Fj.add(e,this),n&&n(this),s.manager.itemEnd(e)}function l(d){u(),i&&i(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class tF extends eF{constructor(e){super(e)}load(e,n,r,i){const s=new wo,o=new nce(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,n!==void 0&&n(s)},r,i),s}}let rce=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Bj(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=Bj();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}};function Bj(){return performance.now()}class qi{constructor(e){this.value=e}clone(){return new qi(this.value.clone===void 0?this.value:this.value.clone())}}const jj=new To;class ice{constructor(e,n,r=0,i=1/0){this.ray=new YU(e,n),this.near=r,this.far=i,this.camera=null,this.layers=new qb,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}setFromXRController(e){return jj.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(jj),this}intersectObject(e,n=!0,r=[]){return lL(e,this,r,n),r.sort($j),r}intersectObjects(e,n=!0,r=[]){for(let i=0,s=e.length;i<s;i++)lL(e[i],this,r,n);return r.sort($j),r}}function $j(t,e){return t.distance-e.distance}function lL(t,e,n,r){let i=!0;if(t.layers.test(e.layers)&&t.raycast(e,n)===!1&&(i=!1),i===!0&&r===!0){const s=t.children;for(let o=0,a=s.length;o<a;o++)lL(s[o],e,n,!0)}}const Hj=new Vn;class sce{constructor(e=new Vn(1/0,1/0),n=new Vn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=Hj.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Hj).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:yA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=yA);var V8={exports:{}},dy={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */dy.ConcurrentRoot=1;dy.ContinuousEventPriority=4;dy.DefaultEventPriority=16;dy.DiscreteEventPriority=1;dy.IdleEventPriority=536870912;dy.LegacyRoot=0;V8.exports=dy;var Ob=V8.exports;function oce(t){let e;const n=new Set,r=(l,u)=>{const d=typeof l=="function"?l(e):l;if(d!==e){const h=e;e=u?d:Object.assign({},e,d),n.forEach(f=>f(e,h))}},i=()=>e,s=(l,u=i,d=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let h=u(e);function f(){const p=u(e);if(!d(h,p)){const g=h;l(h=p,g)}}return n.add(f),()=>n.delete(f)},c={setState:r,getState:i,subscribe:(l,u,d)=>u||d?s(l,u,d):(n.add(l),()=>n.delete(l)),destroy:()=>n.clear()};return e=t(r,i,c),c}const ace=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Vj=ace?ft.useEffect:ft.useLayoutEffect;function cce(t){const e=typeof t=="function"?oce(t):t,n=(r=e.getState,i=Object.is)=>{const[,s]=ft.useReducer(v=>v+1,0),o=e.getState(),a=ft.useRef(o),c=ft.useRef(r),l=ft.useRef(i),u=ft.useRef(!1),d=ft.useRef();d.current===void 0&&(d.current=r(o));let h,f=!1;(a.current!==o||c.current!==r||l.current!==i||u.current)&&(h=r(o),f=!i(d.current,h)),Vj(()=>{f&&(d.current=h),a.current=o,c.current=r,l.current=i,u.current=!1});const p=ft.useRef(o);Vj(()=>{const v=()=>{try{const T=e.getState(),C=c.current(T);l.current(d.current,C)||(a.current=T,d.current=C,s())}catch{u.current=!0,s()}},E=e.subscribe(v);return e.getState()!==p.current&&v(),E},[]);const g=f?h:d.current;return ft.useDebugValue(g),g};return Object.assign(n,e),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[n,e];return{next(){const i=r.length<=0;return{value:r.shift(),done:i}}}},n}const lce=t=>typeof t=="object"&&typeof t.then=="function",A0=[];function z8(t,e,n=(r,i)=>r===i){if(t===e)return!0;if(!t||!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!n(t[i],e[i]))return!1;return!0}function G8(t,e=null,n=!1,r={}){e===null&&(e=[t]);for(const s of A0)if(z8(e,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!n)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=A0.indexOf(i);s!==-1&&A0.splice(s,1)},promise:(lce(t)?t:t(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(A0.push(i),!n)throw i.promise}const uce=(t,e,n)=>G8(t,e,!1,n),dce=(t,e,n)=>void G8(t,e,!0,n),hce=t=>{if(t===void 0||t.length===0)A0.splice(0,A0.length);else{const e=A0.find(n=>z8(t,n.keys,n.equal));e&&e.remove()}};var q8={exports:{}},W8={exports:{}},K8={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(G,Z){var se=G.length;G.push(Z);e:for(;0<se;){var ue=se-1>>>1,Ae=G[ue];if(0<i(Ae,Z))G[ue]=Z,G[se]=Ae,se=ue;else break e}}function n(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var Z=G[0],se=G.pop();if(se!==Z){G[0]=se;e:for(var ue=0,Ae=G.length,Be=Ae>>>1;ue<Be;){var Se=2*(ue+1)-1,Pe=G[Se],we=Se+1,Te=G[we];if(0>i(Pe,se))we<Ae&&0>i(Te,Pe)?(G[ue]=Te,G[we]=se,ue=we):(G[ue]=Pe,G[Se]=se,ue=Se);else if(we<Ae&&0>i(Te,se))G[ue]=Te,G[we]=se,ue=we;else break e}}return Z}function i(G,Z){var se=G.sortIndex-Z.sortIndex;return se!==0?se:G.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,d=null,h=3,f=!1,p=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(G){for(var Z=n(l);Z!==null;){if(Z.callback===null)r(l);else if(Z.startTime<=G)r(l),Z.sortIndex=Z.expirationTime,e(c,Z);else break;Z=n(l)}}function A(G){if(g=!1,C(G),!p)if(n(c)!==null)p=!0,Q(k);else{var Z=n(l);Z!==null&&ie(A,Z.startTime-G)}}function k(G,Z){p=!1,g&&(g=!1,E(U),U=-1),f=!0;var se=h;try{for(C(Z),d=n(c);d!==null&&(!(d.expirationTime>Z)||G&&!X());){var ue=d.callback;if(typeof ue=="function"){d.callback=null,h=d.priorityLevel;var Ae=ue(d.expirationTime<=Z);Z=t.unstable_now(),typeof Ae=="function"?d.callback=Ae:d===n(c)&&r(c),C(Z)}else r(c);d=n(c)}if(d!==null)var Be=!0;else{var Se=n(l);Se!==null&&ie(A,Se.startTime-Z),Be=!1}return Be}finally{d=null,h=se,f=!1}}var I=!1,N=null,U=-1,F=5,$=-1;function X(){return!(t.unstable_now()-$<F)}function q(){if(N!==null){var G=t.unstable_now();$=G;var Z=!0;try{Z=N(!0,G)}finally{Z?W():(I=!1,N=null)}}else I=!1}var W;if(typeof T=="function")W=function(){T(q)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,ne=K.port2;K.port1.onmessage=q,W=function(){ne.postMessage(null)}}else W=function(){v(q,0)};function Q(G){N=G,I||(I=!0,W())}function ie(G,Z){U=v(function(){G(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,Q(k))},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(G){switch(h){case 1:case 2:case 3:var Z=3;break;default:Z=h}var se=h;h=Z;try{return G()}finally{h=se}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(G,Z){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var se=h;h=G;try{return Z()}finally{h=se}},t.unstable_scheduleCallback=function(G,Z,se){var ue=t.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?ue+se:ue):se=ue,G){case 1:var Ae=-1;break;case 2:Ae=250;break;case 5:Ae=1073741823;break;case 4:Ae=1e4;break;default:Ae=5e3}return Ae=se+Ae,G={id:u++,callback:Z,priorityLevel:G,startTime:se,expirationTime:Ae,sortIndex:-1},se>ue?(G.sortIndex=se,e(l,G),n(c)===null&&G===n(l)&&(g?(E(U),U=-1):g=!0,ie(A,se-ue))):(G.sortIndex=Ae,e(c,G),p||f||(p=!0,Q(k))),G},t.unstable_shouldYield=X,t.unstable_wrapCallback=function(G){var Z=h;return function(){var se=h;h=Z;try{return G.apply(this,arguments)}finally{h=se}}}})(K8);W8.exports=K8;var uL=W8.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fce=function(e){var n={},r=ft,i=uL,s=Object.assign;function o(m){for(var y="https://reactjs.org/docs/error-decoder.html?invariant="+m,M=1;M<arguments.length;M++)y+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+m+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,c=Symbol.for("react.element"),l=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),p=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),E=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),A=Symbol.for("react.offscreen"),k=Symbol.iterator;function I(m){return m===null||typeof m!="object"?null:(m=k&&m[k]||m["@@iterator"],typeof m=="function"?m:null)}function N(m){if(m==null)return null;if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case u:return"Fragment";case l:return"Portal";case h:return"Profiler";case d:return"StrictMode";case v:return"Suspense";case E:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case p:return(m.displayName||"Context")+".Consumer";case f:return(m._context.displayName||"Context")+".Provider";case g:var y=m.render;return m=m.displayName,m||(m=y.displayName||y.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case T:return y=m.displayName||null,y!==null?y:N(m.type)||"Memo";case C:y=m._payload,m=m._init;try{return N(m(y))}catch{}}return null}function U(m){var y=m.type;switch(m.tag){case 24:return"Cache";case 9:return(y.displayName||"Context")+".Consumer";case 10:return(y._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return m=y.render,m=m.displayName||m.name||"",y.displayName||(m!==""?"ForwardRef("+m+")":"ForwardRef");case 7:return"Fragment";case 5:return y;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return N(y);case 8:return y===d?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y}return null}function F(m){var y=m,M=m;if(m.alternate)for(;y.return;)y=y.return;else{m=y;do y=m,y.flags&4098&&(M=y.return),m=y.return;while(m)}return y.tag===3?M:null}function $(m){if(F(m)!==m)throw Error(o(188))}function X(m){var y=m.alternate;if(!y){if(y=F(m),y===null)throw Error(o(188));return y!==m?null:m}for(var M=m,L=y;;){var H=M.return;if(H===null)break;var ee=H.alternate;if(ee===null){if(L=H.return,L!==null){M=L;continue}break}if(H.child===ee.child){for(ee=H.child;ee;){if(ee===M)return $(H),m;if(ee===L)return $(H),y;ee=ee.sibling}throw Error(o(188))}if(M.return!==L.return)M=H,L=ee;else{for(var xe=!1,Ve=H.child;Ve;){if(Ve===M){xe=!0,M=H,L=ee;break}if(Ve===L){xe=!0,L=H,M=ee;break}Ve=Ve.sibling}if(!xe){for(Ve=ee.child;Ve;){if(Ve===M){xe=!0,M=ee,L=H;break}if(Ve===L){xe=!0,L=ee,M=H;break}Ve=Ve.sibling}if(!xe)throw Error(o(189))}}if(M.alternate!==L)throw Error(o(190))}if(M.tag!==3)throw Error(o(188));return M.stateNode.current===M?m:y}function q(m){return m=X(m),m!==null?W(m):null}function W(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){var y=W(m);if(y!==null)return y;m=m.sibling}return null}function K(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){if(m.tag!==4){var y=K(m);if(y!==null)return y}m=m.sibling}return null}var ne=Array.isArray,Q=e.getPublicInstance,ie=e.getRootHostContext,G=e.getChildHostContext,Z=e.prepareForCommit,se=e.resetAfterCommit,ue=e.createInstance,Ae=e.appendInitialChild,Be=e.finalizeInitialChildren,Se=e.prepareUpdate,Pe=e.shouldSetTextContent,we=e.createTextInstance,Te=e.scheduleTimeout,Oe=e.cancelTimeout,_t=e.noTimeout,Ct=e.isPrimaryRenderer,me=e.supportsMutation,ge=e.supportsPersistence,nt=e.supportsHydration,Ce=e.getInstanceFromNode,ut=e.preparePortalMount,He=e.getCurrentEventPriority,Rt=e.detachDeletedInstance,$t=e.supportsMicrotasks,Tt=e.scheduleMicrotask,Ft=e.supportsTestSelectors,Ee=e.findFiberRoot,le=e.getBoundingRect,We=e.getTextContent,it=e.isHiddenSubtree,je=e.matchAccessibilityRole,Fe=e.setFocusIfFocusable,Ht=e.setupIntersectionObserver,St=e.appendChild,Dt=e.appendChildToContainer,oe=e.commitTextUpdate,j=e.commitMount,V=e.commitUpdate,fe=e.insertBefore,Ie=e.insertInContainerBefore,Ue=e.removeChild,dt=e.removeChildFromContainer,yt=e.resetTextContent,Dn=e.hideInstance,Le=e.hideTextInstance,Lt=e.unhideInstance,rt=e.unhideTextInstance,xt=e.clearContainer,sn=e.cloneInstance,Jt=e.createContainerChildSet,De=e.appendChildToContainerChildSet,tt=e.finalizeContainerChildren,Et=e.replaceContainerChildren,wt=e.cloneHiddenInstance,Pn=e.cloneHiddenTextInstance,Xr=e.canHydrateInstance,lr=e.canHydrateTextInstance,zn=e.canHydrateSuspenseInstance,dn=e.isSuspenseInstancePending,tn=e.isSuspenseInstanceFallback,Cn=e.registerSuspenseInstanceRetry,Rn=e.getNextHydratableSibling,yr=e.getFirstHydratableChild,hi=e.getFirstHydratableChildWithinContainer,si=e.getFirstHydratableChildWithinSuspenseInstance,Co=e.hydrateInstance,mu=e.hydrateTextInstance,Vd=e.hydrateSuspenseInstance,rf=e.getNextHydratableInstanceAfterSuspenseInstance,sf=e.commitHydratedContainer,ve=e.commitHydratedSuspenseInstance,Ke=e.clearSuspenseBoundary,pt=e.clearSuspenseBoundaryFromContainer,vt=e.shouldDeleteUnhydratedTailInstances,Xe=e.didNotMatchHydratedContainerTextInstance,zt=e.didNotMatchHydratedTextInstance,Qt;function hn(m){if(Qt===void 0)try{throw Error()}catch(M){var y=M.stack.trim().match(/\n( *(at )?)/);Qt=y&&y[1]||""}return`
`+Qt+m}var mn=!1;function Un(m,y){if(!m||mn)return"";mn=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(y)if(y=function(){throw Error()},Object.defineProperty(y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(y,[])}catch(Wt){var L=Wt}Reflect.construct(m,[],y)}else{try{y.call()}catch(Wt){L=Wt}m.call(y.prototype)}else{try{throw Error()}catch(Wt){L=Wt}m()}}catch(Wt){if(Wt&&L&&typeof Wt.stack=="string"){for(var H=Wt.stack.split(`
`),ee=L.stack.split(`
`),xe=H.length-1,Ve=ee.length-1;1<=xe&&0<=Ve&&H[xe]!==ee[Ve];)Ve--;for(;1<=xe&&0<=Ve;xe--,Ve--)if(H[xe]!==ee[Ve]){if(xe!==1||Ve!==1)do if(xe--,Ve--,0>Ve||H[xe]!==ee[Ve]){var bt=`
`+H[xe].replace(" at new "," at ");return m.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",m.displayName)),bt}while(1<=xe&&0<=Ve);break}}}finally{mn=!1,Error.prepareStackTrace=M}return(m=m?m.displayName||m.name:"")?hn(m):""}var Jn=Object.prototype.hasOwnProperty,_n=[],br=-1;function Gr(m){return{current:m}}function En(m){0>br||(m.current=_n[br],_n[br]=null,br--)}function Bn(m,y){br++,_n[br]=m.current,m.current=y}var Er={},on=Gr(Er),Wi=Gr(!1),Sr=Er;function Fs(m,y){var M=m.type.contextTypes;if(!M)return Er;var L=m.stateNode;if(L&&L.__reactInternalMemoizedUnmaskedChildContext===y)return L.__reactInternalMemoizedMaskedChildContext;var H={},ee;for(ee in M)H[ee]=y[ee];return L&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=y,m.__reactInternalMemoizedMaskedChildContext=H),H}function Qn(m){return m=m.childContextTypes,m!=null}function ur(){En(Wi),En(on)}function Pl(m,y,M){if(on.current!==Er)throw Error(o(168));Bn(on,y),Bn(Wi,M)}function Si(m,y,M){var L=m.stateNode;if(y=y.childContextTypes,typeof L.getChildContext!="function")return M;L=L.getChildContext();for(var H in L)if(!(H in y))throw Error(o(108,U(m)||"Unknown",H));return s({},M,L)}function Ro(m){return m=(m=m.stateNode)&&m.__reactInternalMemoizedMergedChildContext||Er,Sr=on.current,Bn(on,m),Bn(Wi,Wi.current),!0}function Dl(m,y,M){var L=m.stateNode;if(!L)throw Error(o(169));M?(m=Si(m,y,Sr),L.__reactInternalMemoizedMergedChildContext=m,En(Wi),En(on),Bn(on,m)):En(Wi),Bn(Wi,M)}var Ki=Math.clz32?Math.clz32:Ll,vn=Math.log,sc=Math.LN2;function Ll(m){return m>>>=0,m===0?32:31-(vn(m)/sc|0)|0}var vr=64,zd=4194304;function Ho(m){switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return m&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return m}}function Gd(m,y){var M=m.pendingLanes;if(M===0)return 0;var L=0,H=m.suspendedLanes,ee=m.pingedLanes,xe=M&268435455;if(xe!==0){var Ve=xe&~H;Ve!==0?L=Ho(Ve):(ee&=xe,ee!==0&&(L=Ho(ee)))}else xe=M&~H,xe!==0?L=Ho(xe):ee!==0&&(L=Ho(ee));if(L===0)return 0;if(y!==0&&y!==L&&!(y&H)&&(H=L&-L,ee=y&-y,H>=ee||H===16&&(ee&4194240)!==0))return y;if(L&4&&(L|=M&16),y=m.entangledLanes,y!==0)for(m=m.entanglements,y&=L;0<y;)M=31-Ki(y),H=1<<M,L|=m[M],y&=~H;return L}function of(m,y){switch(m){case 1:case 2:case 4:return y+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gu(m,y){for(var M=m.suspendedLanes,L=m.pingedLanes,H=m.expirationTimes,ee=m.pendingLanes;0<ee;){var xe=31-Ki(ee),Ve=1<<xe,bt=H[xe];bt===-1?(!(Ve&M)||Ve&L)&&(H[xe]=of(Ve,y)):bt<=y&&(m.expiredLanes|=Ve),ee&=~Ve}}function Up(m){return m=m.pendingLanes&-1073741825,m!==0?m:m&1073741824?1073741824:0}function Fp(m){for(var y=[],M=0;31>M;M++)y.push(m);return y}function Ju(m,y,M){m.pendingLanes|=y,y!==536870912&&(m.suspendedLanes=0,m.pingedLanes=0),m=m.eventTimes,y=31-Ki(y),m[y]=M}function ha(m,y){var M=m.pendingLanes&~y;m.pendingLanes=y,m.suspendedLanes=0,m.pingedLanes=0,m.expiredLanes&=y,m.mutableReadLanes&=y,m.entangledLanes&=y,y=m.entanglements;var L=m.eventTimes;for(m=m.expirationTimes;0<M;){var H=31-Ki(M),ee=1<<H;y[H]=0,L[H]=-1,m[H]=-1,M&=~ee}}function af(m,y){var M=m.entangledLanes|=y;for(m=m.entanglements;M;){var L=31-Ki(M),H=1<<L;H&y|m[L]&y&&(m[L]|=y),M&=~H}}var dr=0;function Iy(m){return m&=-m,1<m?4<m?m&268435455?16:536870912:4:1}var Mg=i.unstable_scheduleCallback,Ul=i.unstable_cancelCallback,Bp=i.unstable_shouldYield,Qu=i.unstable_requestPaint,Tr=i.unstable_now,Fl=i.unstable_ImmediatePriority,N_=i.unstable_UserBlockingPriority,Ig=i.unstable_NormalPriority,Og=i.unstable_IdlePriority,jp=null,Qc=null;function kg(m){if(Qc&&typeof Qc.onCommitFiberRoot=="function")try{Qc.onCommitFiberRoot(jp,m,void 0,(m.current.flags&128)===128)}catch{}}function cf(m,y){return m===y&&(m!==0||1/m===1/y)||m!==m&&y!==y}var Bl=typeof Object.is=="function"?Object.is:cf,jl=null,$p=!1,Hp=!1;function Ng(m){jl===null?jl=[m]:jl.push(m)}function Oy(m){$p=!0,Ng(m)}function oc(){if(!Hp&&jl!==null){Hp=!0;var m=0,y=dr;try{var M=jl;for(dr=1;m<M.length;m++){var L=M[m];do L=L(!0);while(L!==null)}jl=null,$p=!1}catch(H){throw jl!==null&&(jl=jl.slice(m+1)),Mg(Fl,oc),H}finally{dr=y,Hp=!1}}return null}var P_=a.ReactCurrentBatchConfig;function Vp(m,y){if(Bl(m,y))return!0;if(typeof m!="object"||m===null||typeof y!="object"||y===null)return!1;var M=Object.keys(m),L=Object.keys(y);if(M.length!==L.length)return!1;for(L=0;L<M.length;L++){var H=M[L];if(!Jn.call(y,H)||!Bl(m[H],y[H]))return!1}return!0}function ac(m){switch(m.tag){case 5:return hn(m.type);case 16:return hn("Lazy");case 13:return hn("Suspense");case 19:return hn("SuspenseList");case 0:case 2:case 15:return m=Un(m.type,!1),m;case 11:return m=Un(m.type.render,!1),m;case 1:return m=Un(m.type,!0),m;default:return""}}function oi(m,y){if(m&&m.defaultProps){y=s({},y),m=m.defaultProps;for(var M in m)y[M]===void 0&&(y[M]=m[M]);return y}return y}var Zc=Gr(null),zp=null,$l=null,D_=null;function lf(){D_=$l=zp=null}function ky(m,y,M){Ct?(Bn(Zc,y._currentValue),y._currentValue=M):(Bn(Zc,y._currentValue2),y._currentValue2=M)}function vu(m){var y=Zc.current;En(Zc),Ct?m._currentValue=y:m._currentValue2=y}function qd(m,y,M){for(;m!==null;){var L=m.alternate;if((m.childLanes&y)!==y?(m.childLanes|=y,L!==null&&(L.childLanes|=y)):L!==null&&(L.childLanes&y)!==y&&(L.childLanes|=y),m===M)break;m=m.return}}function Ks(m,y){zp=m,D_=$l=null,m=m.dependencies,m!==null&&m.firstContext!==null&&(m.lanes&y&&(Va=!0),m.firstContext=null)}function Yi(m){var y=Ct?m._currentValue:m._currentValue2;if(D_!==m)if(m={context:m,memoizedValue:y,next:null},$l===null){if(zp===null)throw Error(o(308));$l=m,zp.dependencies={lanes:0,firstContext:m}}else $l=$l.next=m;return y}var ja=null,Zu=!1;function As(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ms(m,y){m=m.updateQueue,y.updateQueue===m&&(y.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,effects:m.effects})}function el(m,y){return{eventTime:m,lane:y,tag:0,payload:null,callback:null,next:null}}function fa(m,y){var M=m.updateQueue;M!==null&&(M=M.shared,fs!==null&&m.mode&1&&!(Cr&2)?(m=M.interleaved,m===null?(y.next=y,ja===null?ja=[M]:ja.push(M)):(y.next=m.next,m.next=y),M.interleaved=y):(m=M.pending,m===null?y.next=y:(y.next=m.next,m.next=y),M.pending=y))}function ed(m,y,M){if(y=y.updateQueue,y!==null&&(y=y.shared,(M&4194240)!==0)){var L=y.lanes;L&=m.pendingLanes,M|=L,y.lanes=M,af(m,M)}}function st(m,y){var M=m.updateQueue,L=m.alternate;if(L!==null&&(L=L.updateQueue,M===L)){var H=null,ee=null;if(M=M.firstBaseUpdate,M!==null){do{var xe={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};ee===null?H=ee=xe:ee=ee.next=xe,M=M.next}while(M!==null);ee===null?H=ee=y:ee=ee.next=y}else H=ee=y;M={baseState:L.baseState,firstBaseUpdate:H,lastBaseUpdate:ee,shared:L.shared,effects:L.effects},m.updateQueue=M;return}m=M.lastBaseUpdate,m===null?M.firstBaseUpdate=y:m.next=y,M.lastBaseUpdate=y}function et(m,y,M,L){var H=m.updateQueue;Zu=!1;var ee=H.firstBaseUpdate,xe=H.lastBaseUpdate,Ve=H.shared.pending;if(Ve!==null){H.shared.pending=null;var bt=Ve,Wt=bt.next;bt.next=null,xe===null?ee=Wt:xe.next=Wt,xe=bt;var fn=m.alternate;fn!==null&&(fn=fn.updateQueue,Ve=fn.lastBaseUpdate,Ve!==xe&&(Ve===null?fn.firstBaseUpdate=Wt:Ve.next=Wt,fn.lastBaseUpdate=bt))}if(ee!==null){var mr=H.baseState;xe=0,fn=Wt=bt=null,Ve=ee;do{var gn=Ve.lane,er=Ve.eventTime;if((L&gn)===gn){fn!==null&&(fn=fn.next={eventTime:er,lane:0,tag:Ve.tag,payload:Ve.payload,callback:Ve.callback,next:null});e:{var bn=m,Zo=Ve;switch(gn=y,er=M,Zo.tag){case 1:if(bn=Zo.payload,typeof bn=="function"){mr=bn.call(er,mr,gn);break e}mr=bn;break e;case 3:bn.flags=bn.flags&-65537|128;case 0:if(bn=Zo.payload,gn=typeof bn=="function"?bn.call(er,mr,gn):bn,gn==null)break e;mr=s({},mr,gn);break e;case 2:Zu=!0}}Ve.callback!==null&&Ve.lane!==0&&(m.flags|=64,gn=H.effects,gn===null?H.effects=[Ve]:gn.push(Ve))}else er={eventTime:er,lane:gn,tag:Ve.tag,payload:Ve.payload,callback:Ve.callback,next:null},fn===null?(Wt=fn=er,bt=mr):fn=fn.next=er,xe|=gn;if(Ve=Ve.next,Ve===null){if(Ve=H.shared.pending,Ve===null)break;gn=Ve,Ve=gn.next,gn.next=null,H.lastBaseUpdate=gn,H.shared.pending=null}}while(!0);if(fn===null&&(bt=mr),H.baseState=bt,H.firstBaseUpdate=Wt,H.lastBaseUpdate=fn,y=H.shared.interleaved,y!==null){H=y;do xe|=H.lane,H=H.next;while(H!==y)}else ee===null&&(H.shared.lanes=0);za|=xe,m.lanes=xe,m.memoizedState=mr}}function It(m,y,M){if(m=y.effects,y.effects=null,m!==null)for(y=0;y<m.length;y++){var L=m[y],H=L.callback;if(H!==null){if(L.callback=null,L=M,typeof H!="function")throw Error(o(191,H));H.call(L)}}}var nn=new r.Component().refs;function Gt(m,y,M,L){y=m.memoizedState,M=M(L,y),M=M==null?y:s({},y,M),m.memoizedState=M,m.lanes===0&&(m.updateQueue.baseState=M)}var qr={isMounted:function(m){return(m=m._reactInternals)?F(m)===m:!1},enqueueSetState:function(m,y,M){m=m._reactInternals;var L=Pi(),H=gc(m),ee=el(L,H);ee.payload=y,M!=null&&(ee.callback=M),fa(m,ee),y=va(m,H,L),y!==null&&ed(y,m,H)},enqueueReplaceState:function(m,y,M){m=m._reactInternals;var L=Pi(),H=gc(m),ee=el(L,H);ee.tag=1,ee.payload=y,M!=null&&(ee.callback=M),fa(m,ee),y=va(m,H,L),y!==null&&ed(y,m,H)},enqueueForceUpdate:function(m,y){m=m._reactInternals;var M=Pi(),L=gc(m),H=el(M,L);H.tag=2,y!=null&&(H.callback=y),fa(m,H),y=va(m,L,M),y!==null&&ed(y,m,L)}};function Bs(m,y,M,L,H,ee,xe){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(L,ee,xe):y.prototype&&y.prototype.isPureReactComponent?!Vp(M,L)||!Vp(H,ee):!0}function tl(m,y,M){var L=!1,H=Er,ee=y.contextType;return typeof ee=="object"&&ee!==null?ee=Yi(ee):(H=Qn(y)?Sr:on.current,L=y.contextTypes,ee=(L=L!=null)?Fs(m,H):Er),y=new y(M,ee),m.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=qr,m.stateNode=y,y._reactInternals=m,L&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=H,m.__reactInternalMemoizedMaskedChildContext=ee),y}function Fr(m,y,M,L){m=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(M,L),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(M,L),y.state!==m&&qr.enqueueReplaceState(y,y.state,null)}function Wd(m,y,M,L){var H=m.stateNode;H.props=M,H.state=m.memoizedState,H.refs=nn,As(m);var ee=y.contextType;typeof ee=="object"&&ee!==null?H.context=Yi(ee):(ee=Qn(y)?Sr:on.current,H.context=Fs(m,ee)),H.state=m.memoizedState,ee=y.getDerivedStateFromProps,typeof ee=="function"&&(Gt(m,y,ee,M),H.state=m.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof H.getSnapshotBeforeUpdate=="function"||typeof H.UNSAFE_componentWillMount!="function"&&typeof H.componentWillMount!="function"||(y=H.state,typeof H.componentWillMount=="function"&&H.componentWillMount(),typeof H.UNSAFE_componentWillMount=="function"&&H.UNSAFE_componentWillMount(),y!==H.state&&qr.enqueueReplaceState(H,H.state,null),et(m,M,H,L),H.state=m.memoizedState),typeof H.componentDidMount=="function"&&(m.flags|=4194308)}var Kd=[],Ao=0,Yd=null,Pg=0,Ys=[],Xs=0,Hl=null,Wr=1,Ac="";function td(m,y){Kd[Ao++]=Pg,Kd[Ao++]=Yd,Yd=m,Pg=y}function Gp(m,y,M){Ys[Xs++]=Wr,Ys[Xs++]=Ac,Ys[Xs++]=Hl,Hl=m;var L=Wr;m=Ac;var H=32-Ki(L)-1;L&=~(1<<H),M+=1;var ee=32-Ki(y)+H;if(30<ee){var xe=H-H%5;ee=(L&(1<<xe)-1).toString(32),L>>=xe,H-=xe,Wr=1<<32-Ki(y)+H|M<<H|L,Ac=ee+m}else Wr=1<<ee|M<<H|L,Ac=m}function nd(m){m.return!==null&&(td(m,1),Gp(m,1,0))}function L_(m){for(;m===Yd;)Yd=Kd[--Ao],Kd[Ao]=null,Pg=Kd[--Ao],Kd[Ao]=null;for(;m===Hl;)Hl=Ys[--Xs],Ys[Xs]=null,Ac=Ys[--Xs],Ys[Xs]=null,Wr=Ys[--Xs],Ys[Xs]=null}var cc=null,Vo=null,mi=!1,Mc=!1,Ic=null;function uf(m,y){var M=vs(5,null,null,0);M.elementType="DELETED",M.stateNode=y,M.return=m,y=m.deletions,y===null?(m.deletions=[M],m.flags|=16):y.push(M)}function qp(m,y){switch(m.tag){case 5:return y=Xr(y,m.type,m.pendingProps),y!==null?(m.stateNode=y,cc=m,Vo=yr(y),!0):!1;case 6:return y=lr(y,m.pendingProps),y!==null?(m.stateNode=y,cc=m,Vo=null,!0):!1;case 13:if(y=zn(y),y!==null){var M=Hl!==null?{id:Wr,overflow:Ac}:null;return m.memoizedState={dehydrated:y,treeContext:M,retryLane:1073741824},M=vs(18,null,null,0),M.stateNode=y,M.return=m,m.child=M,cc=m,Vo=null,!0}return!1;default:return!1}}function Wp(m){return(m.mode&1)!==0&&(m.flags&128)===0}function _u(m){if(mi){var y=Vo;if(y){var M=y;if(!qp(m,y)){if(Wp(m))throw Error(o(418));y=Rn(M);var L=cc;y&&qp(m,y)?uf(L,M):(m.flags=m.flags&-4097|2,mi=!1,cc=m)}}else{if(Wp(m))throw Error(o(418));m.flags=m.flags&-4097|2,mi=!1,cc=m}}}function U_(m){for(m=m.return;m!==null&&m.tag!==5&&m.tag!==3&&m.tag!==13;)m=m.return;cc=m}function nl(m){if(!nt||m!==cc)return!1;if(!mi)return U_(m),mi=!0,!1;if(m.tag!==3&&(m.tag!==5||vt(m.type)&&!Pe(m.type,m.memoizedProps))){var y=Vo;if(y){if(Wp(m)){for(m=Vo;m;)m=Rn(m);throw Error(o(418))}for(;y;)uf(m,y),y=Rn(y)}}if(U_(m),m.tag===13){if(!nt)throw Error(o(316));if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(o(317));Vo=rf(m)}else Vo=cc?Rn(m.stateNode):null;return!0}function lc(){nt&&(Vo=cc=null,Mc=mi=!1)}function Xd(m){Ic===null?Ic=[m]:Ic.push(m)}function Yt(m,y,M){if(m=M.ref,m!==null&&typeof m!="function"&&typeof m!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(o(309));var L=M.stateNode}if(!L)throw Error(o(147,m));var H=L,ee=""+m;return y!==null&&y.ref!==null&&typeof y.ref=="function"&&y.ref._stringRef===ee?y.ref:(y=function(xe){var Ve=H.refs;Ve===nn&&(Ve=H.refs={}),xe===null?delete Ve[ee]:Ve[ee]=xe},y._stringRef=ee,y)}if(typeof m!="string")throw Error(o(284));if(!M._owner)throw Error(o(290,m))}return m}function is(m,y){throw m=Object.prototype.toString.call(y),Error(o(31,m==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":m))}function Ny(m){var y=m._init;return y(m._payload)}function Kp(m){function y(Ge,Je){if(m){var ct=Ge.deletions;ct===null?(Ge.deletions=[Je],Ge.flags|=16):ct.push(Je)}}function M(Ge,Je){if(!m)return null;for(;Je!==null;)y(Ge,Je),Je=Je.sibling;return null}function L(Ge,Je){for(Ge=new Map;Je!==null;)Je.key!==null?Ge.set(Je.key,Je):Ge.set(Je.index,Je),Je=Je.sibling;return Ge}function H(Ge,Je){return Ge=Qo(Ge,Je),Ge.index=0,Ge.sibling=null,Ge}function ee(Ge,Je,ct){return Ge.index=ct,m?(ct=Ge.alternate,ct!==null?(ct=ct.index,ct<Je?(Ge.flags|=2,Je):ct):(Ge.flags|=2,Je)):(Ge.flags|=1048576,Je)}function xe(Ge){return m&&Ge.alternate===null&&(Ge.flags|=2),Ge}function Ve(Ge,Je,ct,Vt){return Je===null||Je.tag!==6?(Je=Oo(ct,Ge.mode,Vt),Je.return=Ge,Je):(Je=H(Je,ct),Je.return=Ge,Je)}function bt(Ge,Je,ct,Vt){var yn=ct.type;return yn===u?fn(Ge,Je,ct.props.children,Vt,ct.key):Je!==null&&(Je.elementType===yn||typeof yn=="object"&&yn!==null&&yn.$$typeof===C&&Ny(yn)===Je.type)?(Vt=H(Je,ct.props),Vt.ref=Yt(Ge,Je,ct),Vt.return=Ge,Vt):(Vt=Kl(ct.type,ct.key,ct.props,null,Ge.mode,Vt),Vt.ref=Yt(Ge,Je,ct),Vt.return=Ge,Vt)}function Wt(Ge,Je,ct,Vt){return Je===null||Je.tag!==4||Je.stateNode.containerInfo!==ct.containerInfo||Je.stateNode.implementation!==ct.implementation?(Je=_m(ct,Ge.mode,Vt),Je.return=Ge,Je):(Je=H(Je,ct.children||[]),Je.return=Ge,Je)}function fn(Ge,Je,ct,Vt,yn){return Je===null||Je.tag!==7?(Je=ya(ct,Ge.mode,Vt,yn),Je.return=Ge,Je):(Je=H(Je,ct),Je.return=Ge,Je)}function mr(Ge,Je,ct){if(typeof Je=="string"&&Je!==""||typeof Je=="number")return Je=Oo(""+Je,Ge.mode,ct),Je.return=Ge,Je;if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case c:return ct=Kl(Je.type,Je.key,Je.props,null,Ge.mode,ct),ct.ref=Yt(Ge,null,Je),ct.return=Ge,ct;case l:return Je=_m(Je,Ge.mode,ct),Je.return=Ge,Je;case C:var Vt=Je._init;return mr(Ge,Vt(Je._payload),ct)}if(ne(Je)||I(Je))return Je=ya(Je,Ge.mode,ct,null),Je.return=Ge,Je;is(Ge,Je)}return null}function gn(Ge,Je,ct,Vt){var yn=Je!==null?Je.key:null;if(typeof ct=="string"&&ct!==""||typeof ct=="number")return yn!==null?null:Ve(Ge,Je,""+ct,Vt);if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case c:return ct.key===yn?bt(Ge,Je,ct,Vt):null;case l:return ct.key===yn?Wt(Ge,Je,ct,Vt):null;case C:return yn=ct._init,gn(Ge,Je,yn(ct._payload),Vt)}if(ne(ct)||I(ct))return yn!==null?null:fn(Ge,Je,ct,Vt,null);is(Ge,ct)}return null}function er(Ge,Je,ct,Vt,yn){if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return Ge=Ge.get(ct)||null,Ve(Je,Ge,""+Vt,yn);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case c:return Ge=Ge.get(Vt.key===null?ct:Vt.key)||null,bt(Je,Ge,Vt,yn);case l:return Ge=Ge.get(Vt.key===null?ct:Vt.key)||null,Wt(Je,Ge,Vt,yn);case C:var hr=Vt._init;return er(Ge,Je,ct,hr(Vt._payload),yn)}if(ne(Vt)||I(Vt))return Ge=Ge.get(ct)||null,fn(Je,Ge,Vt,yn,null);is(Je,Vt)}return null}function bn(Ge,Je,ct,Vt){for(var yn=null,hr=null,fr=Je,x=Je=0,b=null;fr!==null&&x<ct.length;x++){fr.index>x?(b=fr,fr=null):b=fr.sibling;var S=gn(Ge,fr,ct[x],Vt);if(S===null){fr===null&&(fr=b);break}m&&fr&&S.alternate===null&&y(Ge,fr),Je=ee(S,Je,x),hr===null?yn=S:hr.sibling=S,hr=S,fr=b}if(x===ct.length)return M(Ge,fr),mi&&td(Ge,x),yn;if(fr===null){for(;x<ct.length;x++)fr=mr(Ge,ct[x],Vt),fr!==null&&(Je=ee(fr,Je,x),hr===null?yn=fr:hr.sibling=fr,hr=fr);return mi&&td(Ge,x),yn}for(fr=L(Ge,fr);x<ct.length;x++)b=er(fr,Ge,x,ct[x],Vt),b!==null&&(m&&b.alternate!==null&&fr.delete(b.key===null?x:b.key),Je=ee(b,Je,x),hr===null?yn=b:hr.sibling=b,hr=b);return m&&fr.forEach(function(R){return y(Ge,R)}),mi&&td(Ge,x),yn}function Zo(Ge,Je,ct,Vt){var yn=I(ct);if(typeof yn!="function")throw Error(o(150));if(ct=yn.call(ct),ct==null)throw Error(o(151));for(var hr=yn=null,fr=Je,x=Je=0,b=null,S=ct.next();fr!==null&&!S.done;x++,S=ct.next()){fr.index>x?(b=fr,fr=null):b=fr.sibling;var R=gn(Ge,fr,S.value,Vt);if(R===null){fr===null&&(fr=b);break}m&&fr&&R.alternate===null&&y(Ge,fr),Je=ee(R,Je,x),hr===null?yn=R:hr.sibling=R,hr=R,fr=b}if(S.done)return M(Ge,fr),mi&&td(Ge,x),yn;if(fr===null){for(;!S.done;x++,S=ct.next())S=mr(Ge,S.value,Vt),S!==null&&(Je=ee(S,Je,x),hr===null?yn=S:hr.sibling=S,hr=S);return mi&&td(Ge,x),yn}for(fr=L(Ge,fr);!S.done;x++,S=ct.next())S=er(fr,Ge,x,S.value,Vt),S!==null&&(m&&S.alternate!==null&&fr.delete(S.key===null?x:S.key),Je=ee(S,Je,x),hr===null?yn=S:hr.sibling=S,hr=S);return m&&fr.forEach(function(O){return y(Ge,O)}),mi&&td(Ge,x),yn}function Rr(Ge,Je,ct,Vt){if(typeof ct=="object"&&ct!==null&&ct.type===u&&ct.key===null&&(ct=ct.props.children),typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case c:e:{for(var yn=ct.key,hr=Je;hr!==null;){if(hr.key===yn){if(yn=ct.type,yn===u){if(hr.tag===7){M(Ge,hr.sibling),Je=H(hr,ct.props.children),Je.return=Ge,Ge=Je;break e}}else if(hr.elementType===yn||typeof yn=="object"&&yn!==null&&yn.$$typeof===C&&Ny(yn)===hr.type){M(Ge,hr.sibling),Je=H(hr,ct.props),Je.ref=Yt(Ge,hr,ct),Je.return=Ge,Ge=Je;break e}M(Ge,hr);break}else y(Ge,hr);hr=hr.sibling}ct.type===u?(Je=ya(ct.props.children,Ge.mode,Vt,ct.key),Je.return=Ge,Ge=Je):(Vt=Kl(ct.type,ct.key,ct.props,null,Ge.mode,Vt),Vt.ref=Yt(Ge,Je,ct),Vt.return=Ge,Ge=Vt)}return xe(Ge);case l:e:{for(hr=ct.key;Je!==null;){if(Je.key===hr)if(Je.tag===4&&Je.stateNode.containerInfo===ct.containerInfo&&Je.stateNode.implementation===ct.implementation){M(Ge,Je.sibling),Je=H(Je,ct.children||[]),Je.return=Ge,Ge=Je;break e}else{M(Ge,Je);break}else y(Ge,Je);Je=Je.sibling}Je=_m(ct,Ge.mode,Vt),Je.return=Ge,Ge=Je}return xe(Ge);case C:return hr=ct._init,Rr(Ge,Je,hr(ct._payload),Vt)}if(ne(ct))return bn(Ge,Je,ct,Vt);if(I(ct))return Zo(Ge,Je,ct,Vt);is(Ge,ct)}return typeof ct=="string"&&ct!==""||typeof ct=="number"?(ct=""+ct,Je!==null&&Je.tag===6?(M(Ge,Je.sibling),Je=H(Je,ct),Je.return=Ge,Ge=Je):(M(Ge,Je),Je=Oo(ct,Ge.mode,Vt),Je.return=Ge,Ge=Je),xe(Ge)):M(Ge,Je)}return Rr}var uo=Kp(!0),Yp=Kp(!1),Xp={},Js=Gr(Xp),df=Gr(Xp),Qs=Gr(Xp);function ai(m){if(m===Xp)throw Error(o(174));return m}function ds(m,y){Bn(Qs,y),Bn(df,m),Bn(Js,Xp),m=ie(y),En(Js),Bn(Js,m)}function Zn(){En(Js),En(df),En(Qs)}function uc(m){var y=ai(Qs.current),M=ai(Js.current);y=G(M,m.type,y),M!==y&&(Bn(df,m),Bn(Js,y))}function ho(m){df.current===m&&(En(Js),En(df))}var Ai=Gr(0);function Jd(m){for(var y=m;y!==null;){if(y.tag===13){var M=y.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||dn(M)||tn(M)))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if(y.flags&128)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===m)break;for(;y.sibling===null;){if(y.return===null||y.return===m)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}var fo=[];function Ut(){for(var m=0;m<fo.length;m++){var y=fo[m];Ct?y._workInProgressVersionPrimary=null:y._workInProgressVersionSecondary=null}fo.length=0}var Is=a.ReactCurrentDispatcher,zo=a.ReactCurrentBatchConfig,dc=0,Ni=null,ss=null,Os=null,hf=!1,Jp=!1,yu=0,Py=0;function js(){throw Error(o(321))}function rd(m,y){if(y===null)return!1;for(var M=0;M<y.length&&M<m.length;M++)if(!Bl(m[M],y[M]))return!1;return!0}function ff(m,y,M,L,H,ee){if(dc=ee,Ni=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,Is.current=m===null||m.memoizedState===null?F_:Vl,m=M(L,H),Jp){ee=0;do{if(Jp=!1,yu=0,25<=ee)throw Error(o(301));ee+=1,Os=ss=null,y.updateQueue=null,Is.current=hs,m=M(L,H)}while(Jp)}if(Is.current=Ha,y=ss!==null&&ss.next!==null,dc=0,Os=ss=Ni=null,hf=!1,y)throw Error(o(300));return m}function pe(){var m=yu!==0;return yu=0,m}function Go(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Os===null?Ni.memoizedState=Os=m:Os=Os.next=m,Os}function $a(){if(ss===null){var m=Ni.alternate;m=m!==null?m.memoizedState:null}else m=ss.next;var y=Os===null?Ni.memoizedState:Os.next;if(y!==null)Os=y,ss=m;else{if(m===null)throw Error(o(310));ss=m,m={memoizedState:ss.memoizedState,baseState:ss.baseState,baseQueue:ss.baseQueue,queue:ss.queue,next:null},Os===null?Ni.memoizedState=Os=m:Os=Os.next=m}return Os}function $s(m,y){return typeof y=="function"?y(m):y}function Mr(m){var y=$a(),M=y.queue;if(M===null)throw Error(o(311));M.lastRenderedReducer=m;var L=ss,H=L.baseQueue,ee=M.pending;if(ee!==null){if(H!==null){var xe=H.next;H.next=ee.next,ee.next=xe}L.baseQueue=H=ee,M.pending=null}if(H!==null){ee=H.next,L=L.baseState;var Ve=xe=null,bt=null,Wt=ee;do{var fn=Wt.lane;if((dc&fn)===fn)bt!==null&&(bt=bt.next={lane:0,action:Wt.action,hasEagerState:Wt.hasEagerState,eagerState:Wt.eagerState,next:null}),L=Wt.hasEagerState?Wt.eagerState:m(L,Wt.action);else{var mr={lane:fn,action:Wt.action,hasEagerState:Wt.hasEagerState,eagerState:Wt.eagerState,next:null};bt===null?(Ve=bt=mr,xe=L):bt=bt.next=mr,Ni.lanes|=fn,za|=fn}Wt=Wt.next}while(Wt!==null&&Wt!==ee);bt===null?xe=L:bt.next=Ve,Bl(L,y.memoizedState)||(Va=!0),y.memoizedState=L,y.baseState=xe,y.baseQueue=bt,M.lastRenderedState=L}if(m=M.interleaved,m!==null){H=m;do ee=H.lane,Ni.lanes|=ee,za|=ee,H=H.next;while(H!==m)}else H===null&&(M.lanes=0);return[y.memoizedState,M.dispatch]}function rl(m){var y=$a(),M=y.queue;if(M===null)throw Error(o(311));M.lastRenderedReducer=m;var L=M.dispatch,H=M.pending,ee=y.memoizedState;if(H!==null){M.pending=null;var xe=H=H.next;do ee=m(ee,xe.action),xe=xe.next;while(xe!==H);Bl(ee,y.memoizedState)||(Va=!0),y.memoizedState=ee,y.baseQueue===null&&(y.baseState=ee),M.lastRenderedState=ee}return[ee,L]}function il(){}function sl(m,y){var M=Ni,L=$a(),H=y(),ee=!Bl(L.memoizedState,H);if(ee&&(L.memoizedState=H,Va=!0),L=L.queue,pf(Dg.bind(null,M,L,m),[m]),L.getSnapshot!==y||ee||Os!==null&&Os.memoizedState.tag&1){if(M.flags|=2048,Qd(9,hc.bind(null,M,L,H,y),void 0,null),fs===null)throw Error(o(349));dc&30||ol(M,y,H)}return H}function ol(m,y,M){m.flags|=16384,m={getSnapshot:y,value:M},y=Ni.updateQueue,y===null?(y={lastEffect:null,stores:null},Ni.updateQueue=y,y.stores=[m]):(M=y.stores,M===null?y.stores=[m]:M.push(m))}function hc(m,y,M,L){y.value=M,y.getSnapshot=L,al(y)&&va(m,1,-1)}function Dg(m,y,M){return M(function(){al(y)&&va(m,1,-1)})}function al(m){var y=m.getSnapshot;m=m.value;try{var M=y();return!Bl(m,M)}catch{return!0}}function Lg(m){var y=Go();return typeof m=="function"&&(m=m()),y.memoizedState=y.baseState=m,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$s,lastRenderedState:m},y.queue=m,m=m.dispatch=em.bind(null,Ni,m),[y.memoizedState,m]}function Qd(m,y,M,L){return m={tag:m,create:y,destroy:M,deps:L,next:null},y=Ni.updateQueue,y===null?(y={lastEffect:null,stores:null},Ni.updateQueue=y,y.lastEffect=m.next=m):(M=y.lastEffect,M===null?y.lastEffect=m.next=m:(L=M.next,M.next=m,m.next=L,y.lastEffect=m)),m}function Qp(){return $a().memoizedState}function bu(m,y,M,L){var H=Go();Ni.flags|=m,H.memoizedState=Qd(1|y,M,void 0,L===void 0?null:L)}function id(m,y,M,L){var H=$a();L=L===void 0?null:L;var ee=void 0;if(ss!==null){var xe=ss.memoizedState;if(ee=xe.destroy,L!==null&&rd(L,xe.deps)){H.memoizedState=Qd(y,M,ee,L);return}}Ni.flags|=m,H.memoizedState=Qd(1|y,M,ee,L)}function Ug(m,y){return bu(8390656,8,m,y)}function pf(m,y){return id(2048,8,m,y)}function cl(m,y){return id(4,2,m,y)}function Fg(m,y){return id(4,4,m,y)}function Eu(m,y){if(typeof y=="function")return m=m(),y(m),function(){y(null)};if(y!=null)return m=m(),y.current=m,function(){y.current=null}}function qo(m,y,M){return M=M!=null?M.concat([m]):null,id(4,4,Eu.bind(null,y,m),M)}function ks(){}function Bg(m,y){var M=$a();y=y===void 0?null:y;var L=M.memoizedState;return L!==null&&y!==null&&rd(y,L[1])?L[0]:(M.memoizedState=[m,y],m)}function Zd(m,y){var M=$a();y=y===void 0?null:y;var L=M.memoizedState;return L!==null&&y!==null&&rd(y,L[1])?L[0]:(m=m(),M.memoizedState=[m,y],m)}function sd(m,y){var M=dr;dr=M!==0&&4>M?M:4,m(!0);var L=zo.transition;zo.transition={};try{m(!1),y()}finally{dr=M,zo.transition=L}}function Zp(){return $a().memoizedState}function Dy(m,y,M){var L=gc(m);M={lane:L,action:M,hasEagerState:!1,eagerState:null,next:null},mf(m)?po(y,M):(jg(m,y,M),M=Pi(),m=va(m,L,M),m!==null&&$g(m,y,L))}function em(m,y,M){var L=gc(m),H={lane:L,action:M,hasEagerState:!1,eagerState:null,next:null};if(mf(m))po(y,H);else{jg(m,y,H);var ee=m.alternate;if(m.lanes===0&&(ee===null||ee.lanes===0)&&(ee=y.lastRenderedReducer,ee!==null))try{var xe=y.lastRenderedState,Ve=ee(xe,M);if(H.hasEagerState=!0,H.eagerState=Ve,Bl(Ve,xe))return}catch{}finally{}M=Pi(),m=va(m,L,M),m!==null&&$g(m,y,L)}}function mf(m){var y=m.alternate;return m===Ni||y!==null&&y===Ni}function po(m,y){Jp=hf=!0;var M=m.pending;M===null?y.next=y:(y.next=M.next,M.next=y),m.pending=y}function jg(m,y,M){fs!==null&&m.mode&1&&!(Cr&2)?(m=y.interleaved,m===null?(M.next=M,ja===null?ja=[y]:ja.push(y)):(M.next=m.next,m.next=M),y.interleaved=M):(m=y.pending,m===null?M.next=M:(M.next=m.next,m.next=M),y.pending=M)}function $g(m,y,M){if(M&4194240){var L=y.lanes;L&=m.pendingLanes,M|=L,y.lanes=M,af(m,M)}}var Ha={readContext:Yi,useCallback:js,useContext:js,useEffect:js,useImperativeHandle:js,useInsertionEffect:js,useLayoutEffect:js,useMemo:js,useReducer:js,useRef:js,useState:js,useDebugValue:js,useDeferredValue:js,useTransition:js,useMutableSource:js,useSyncExternalStore:js,useId:js,unstable_isNewReconciler:!1},F_={readContext:Yi,useCallback:function(m,y){return Go().memoizedState=[m,y===void 0?null:y],m},useContext:Yi,useEffect:Ug,useImperativeHandle:function(m,y,M){return M=M!=null?M.concat([m]):null,bu(4194308,4,Eu.bind(null,y,m),M)},useLayoutEffect:function(m,y){return bu(4194308,4,m,y)},useInsertionEffect:function(m,y){return bu(4,2,m,y)},useMemo:function(m,y){var M=Go();return y=y===void 0?null:y,m=m(),M.memoizedState=[m,y],m},useReducer:function(m,y,M){var L=Go();return y=M!==void 0?M(y):y,L.memoizedState=L.baseState=y,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:y},L.queue=m,m=m.dispatch=Dy.bind(null,Ni,m),[L.memoizedState,m]},useRef:function(m){var y=Go();return m={current:m},y.memoizedState=m},useState:Lg,useDebugValue:ks,useDeferredValue:function(m){var y=Lg(m),M=y[0],L=y[1];return Ug(function(){var H=zo.transition;zo.transition={};try{L(m)}finally{zo.transition=H}},[m]),M},useTransition:function(){var m=Lg(!1),y=m[0];return m=sd.bind(null,m[1]),Go().memoizedState=m,[y,m]},useMutableSource:function(){},useSyncExternalStore:function(m,y,M){var L=Ni,H=Go();if(mi){if(M===void 0)throw Error(o(407));M=M()}else{if(M=y(),fs===null)throw Error(o(349));dc&30||ol(L,y,M)}H.memoizedState=M;var ee={value:M,getSnapshot:y};return H.queue=ee,Ug(Dg.bind(null,L,ee,m),[m]),L.flags|=2048,Qd(9,hc.bind(null,L,ee,M,y),void 0,null),M},useId:function(){var m=Go(),y=fs.identifierPrefix;if(mi){var M=Ac,L=Wr;M=(L&~(1<<32-Ki(L)-1)).toString(32)+M,y=":"+y+"R"+M,M=yu++,0<M&&(y+="H"+M.toString(32)),y+=":"}else M=Py++,y=":"+y+"r"+M.toString(32)+":";return m.memoizedState=y},unstable_isNewReconciler:!1},Vl={readContext:Yi,useCallback:Bg,useContext:Yi,useEffect:pf,useImperativeHandle:qo,useInsertionEffect:cl,useLayoutEffect:Fg,useMemo:Zd,useReducer:Mr,useRef:Qp,useState:function(){return Mr($s)},useDebugValue:ks,useDeferredValue:function(m){var y=Mr($s),M=y[0],L=y[1];return pf(function(){var H=zo.transition;zo.transition={};try{L(m)}finally{zo.transition=H}},[m]),M},useTransition:function(){var m=Mr($s)[0],y=$a().memoizedState;return[m,y]},useMutableSource:il,useSyncExternalStore:sl,useId:Zp,unstable_isNewReconciler:!1},hs={readContext:Yi,useCallback:Bg,useContext:Yi,useEffect:pf,useImperativeHandle:qo,useInsertionEffect:cl,useLayoutEffect:Fg,useMemo:Zd,useReducer:rl,useRef:Qp,useState:function(){return rl($s)},useDebugValue:ks,useDeferredValue:function(m){var y=rl($s),M=y[0],L=y[1];return pf(function(){var H=zo.transition;zo.transition={};try{L(m)}finally{zo.transition=H}},[m]),M},useTransition:function(){var m=rl($s)[0],y=$a().memoizedState;return[m,y]},useMutableSource:il,useSyncExternalStore:sl,useId:Zp,unstable_isNewReconciler:!1};function Su(m,y){try{var M="",L=y;do M+=ac(L),L=L.return;while(L);var H=M}catch(ee){H=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:m,source:y,stack:H}}function Hs(m,y){try{console.error(y.value)}catch(M){setTimeout(function(){throw M})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function gf(m,y,M){M=el(-1,M),M.tag=3,M.payload={element:null};var L=y.value;return M.callback=function(){eo||(eo=!0,Mf=L),Hs(m,y)},M}function eh(m,y,M){M=el(-1,M),M.tag=3;var L=m.type.getDerivedStateFromError;if(typeof L=="function"){var H=y.value;M.payload=function(){return L(H)},M.callback=function(){Hs(m,y)}}var ee=m.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(M.callback=function(){Hs(m,y),typeof L!="function"&&(Wl===null?Wl=new Set([this]):Wl.add(this));var xe=y.stack;this.componentDidCatch(y.value,{componentStack:xe!==null?xe:""})}),M}function Hg(m,y,M){var L=m.pingCache;if(L===null){L=m.pingCache=new Mi;var H=new Set;L.set(y,H)}else H=L.get(y),H===void 0&&(H=new Set,L.set(y,H));H.has(M)||(H.add(M),m=uS.bind(null,m,y,M),y.then(m,m))}function zl(m){do{var y;if((y=m.tag===13)&&(y=m.memoizedState,y=y!==null?y.dehydrated!==null:!0),y)return m;m=m.return}while(m!==null);return null}function tm(m,y,M,L,H){return m.mode&1?(m.flags|=65536,m.lanes=H,m):(m===y?m.flags|=65536:(m.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(y=el(-1,1),y.tag=2,fa(M,y))),M.lanes|=1),m)}function Mo(m){m.flags|=4}function Vg(m,y){if(m!==null&&m.child===y.child)return!0;if(y.flags&16)return!1;for(m=y.child;m!==null;){if(m.flags&12854||m.subtreeFlags&12854)return!1;m=m.sibling}return!0}var vf,_f,yf,nm;if(me)vf=function(m,y){for(var M=y.child;M!==null;){if(M.tag===5||M.tag===6)Ae(m,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===y)break;for(;M.sibling===null;){if(M.return===null||M.return===y)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},_f=function(){},yf=function(m,y,M,L,H){if(m=m.memoizedProps,m!==L){var ee=y.stateNode,xe=ai(Js.current);M=Se(ee,M,m,L,H,xe),(y.updateQueue=M)&&Mo(y)}},nm=function(m,y,M,L){M!==L&&Mo(y)};else if(ge){vf=function(m,y,M,L){for(var H=y.child;H!==null;){if(H.tag===5){var ee=H.stateNode;M&&L&&(ee=wt(ee,H.type,H.memoizedProps,H)),Ae(m,ee)}else if(H.tag===6)ee=H.stateNode,M&&L&&(ee=Pn(ee,H.memoizedProps,H)),Ae(m,ee);else if(H.tag!==4){if(H.tag===22&&H.memoizedState!==null)ee=H.child,ee!==null&&(ee.return=H),vf(m,H,!0,!0);else if(H.child!==null){H.child.return=H,H=H.child;continue}}if(H===y)break;for(;H.sibling===null;){if(H.return===null||H.return===y)return;H=H.return}H.sibling.return=H.return,H=H.sibling}};var rm=function(m,y,M,L){for(var H=y.child;H!==null;){if(H.tag===5){var ee=H.stateNode;M&&L&&(ee=wt(ee,H.type,H.memoizedProps,H)),De(m,ee)}else if(H.tag===6)ee=H.stateNode,M&&L&&(ee=Pn(ee,H.memoizedProps,H)),De(m,ee);else if(H.tag!==4){if(H.tag===22&&H.memoizedState!==null)ee=H.child,ee!==null&&(ee.return=H),rm(m,H,!0,!0);else if(H.child!==null){H.child.return=H,H=H.child;continue}}if(H===y)break;for(;H.sibling===null;){if(H.return===null||H.return===y)return;H=H.return}H.sibling.return=H.return,H=H.sibling}};_f=function(m,y){var M=y.stateNode;if(!Vg(m,y)){m=M.containerInfo;var L=Jt(m);rm(L,y,!1,!1),M.pendingChildren=L,Mo(y),tt(m,L)}},yf=function(m,y,M,L,H){var ee=m.stateNode,xe=m.memoizedProps;if((m=Vg(m,y))&&xe===L)y.stateNode=ee;else{var Ve=y.stateNode,bt=ai(Js.current),Wt=null;xe!==L&&(Wt=Se(Ve,M,xe,L,H,bt)),m&&Wt===null?y.stateNode=ee:(ee=sn(ee,Wt,M,xe,L,y,m,Ve),Be(ee,M,L,H,bt)&&Mo(y),y.stateNode=ee,m?Mo(y):vf(ee,y,!1,!1))}},nm=function(m,y,M,L){M!==L?(m=ai(Qs.current),M=ai(Js.current),y.stateNode=we(L,m,M,y),Mo(y)):y.stateNode=m.stateNode}}else _f=function(){},yf=function(){},nm=function(){};function pa(m,y){if(!mi)switch(m.tailMode){case"hidden":y=m.tail;for(var M=null;y!==null;)y.alternate!==null&&(M=y),y=y.sibling;M===null?m.tail=null:M.sibling=null;break;case"collapsed":M=m.tail;for(var L=null;M!==null;)M.alternate!==null&&(L=M),M=M.sibling;L===null?y||m.tail===null?m.tail=null:m.tail.sibling=null:L.sibling=null}}function mo(m){var y=m.alternate!==null&&m.alternate.child===m.child,M=0,L=0;if(y)for(var H=m.child;H!==null;)M|=H.lanes|H.childLanes,L|=H.subtreeFlags&14680064,L|=H.flags&14680064,H.return=m,H=H.sibling;else for(H=m.child;H!==null;)M|=H.lanes|H.childLanes,L|=H.subtreeFlags,L|=H.flags,H.return=m,H=H.sibling;return m.subtreeFlags|=L,m.childLanes=M,y}function B_(m,y,M){var L=y.pendingProps;switch(L_(y),y.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mo(y),null;case 1:return Qn(y.type)&&ur(),mo(y),null;case 3:return L=y.stateNode,Zn(),En(Wi),En(on),Ut(),L.pendingContext&&(L.context=L.pendingContext,L.pendingContext=null),(m===null||m.child===null)&&(nl(y)?Mo(y):m===null||m.memoizedState.isDehydrated&&!(y.flags&256)||(y.flags|=1024,Ic!==null&&(kc(Ic),Ic=null))),_f(m,y),mo(y),null;case 5:ho(y),M=ai(Qs.current);var H=y.type;if(m!==null&&y.stateNode!=null)yf(m,y,H,L,M),m.ref!==y.ref&&(y.flags|=512,y.flags|=2097152);else{if(!L){if(y.stateNode===null)throw Error(o(166));return mo(y),null}if(m=ai(Js.current),nl(y)){if(!nt)throw Error(o(175));m=Co(y.stateNode,y.type,y.memoizedProps,M,m,y,!Mc),y.updateQueue=m,m!==null&&Mo(y)}else{var ee=ue(H,L,M,m,y);vf(ee,y,!1,!1),y.stateNode=ee,Be(ee,H,L,M,m)&&Mo(y)}y.ref!==null&&(y.flags|=512,y.flags|=2097152)}return mo(y),null;case 6:if(m&&y.stateNode!=null)nm(m,y,m.memoizedProps,L);else{if(typeof L!="string"&&y.stateNode===null)throw Error(o(166));if(m=ai(Qs.current),M=ai(Js.current),nl(y)){if(!nt)throw Error(o(176));if(m=y.stateNode,L=y.memoizedProps,(M=mu(m,L,y,!Mc))&&(H=cc,H!==null))switch(ee=(H.mode&1)!==0,H.tag){case 3:Xe(H.stateNode.containerInfo,m,L,ee);break;case 5:zt(H.type,H.memoizedProps,H.stateNode,m,L,ee)}M&&Mo(y)}else y.stateNode=we(L,m,M,y)}return mo(y),null;case 13:if(En(Ai),L=y.memoizedState,mi&&Vo!==null&&y.mode&1&&!(y.flags&128)){for(m=Vo;m;)m=Rn(m);return lc(),y.flags|=98560,y}if(L!==null&&L.dehydrated!==null){if(L=nl(y),m===null){if(!L)throw Error(o(318));if(!nt)throw Error(o(344));if(m=y.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(o(317));Vd(m,y)}else lc(),!(y.flags&128)&&(y.memoizedState=null),y.flags|=4;return mo(y),null}return Ic!==null&&(kc(Ic),Ic=null),y.flags&128?(y.lanes=M,y):(L=L!==null,M=!1,m===null?nl(y):M=m.memoizedState!==null,L&&!M&&(y.child.flags|=8192,y.mode&1&&(m===null||Ai.current&1?ms===0&&(ms=3):dd())),y.updateQueue!==null&&(y.flags|=4),mo(y),null);case 4:return Zn(),_f(m,y),m===null&&ut(y.stateNode.containerInfo),mo(y),null;case 10:return vu(y.type._context),mo(y),null;case 17:return Qn(y.type)&&ur(),mo(y),null;case 19:if(En(Ai),H=y.memoizedState,H===null)return mo(y),null;if(L=(y.flags&128)!==0,ee=H.rendering,ee===null)if(L)pa(H,!1);else{if(ms!==0||m!==null&&m.flags&128)for(m=y.child;m!==null;){if(ee=Jd(m),ee!==null){for(y.flags|=128,pa(H,!1),m=ee.updateQueue,m!==null&&(y.updateQueue=m,y.flags|=4),y.subtreeFlags=0,m=M,L=y.child;L!==null;)M=L,H=m,M.flags&=14680066,ee=M.alternate,ee===null?(M.childLanes=0,M.lanes=H,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=ee.childLanes,M.lanes=ee.lanes,M.child=ee.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=ee.memoizedProps,M.memoizedState=ee.memoizedState,M.updateQueue=ee.updateQueue,M.type=ee.type,H=ee.dependencies,M.dependencies=H===null?null:{lanes:H.lanes,firstContext:H.firstContext}),L=L.sibling;return Bn(Ai,Ai.current&1|2),y.child}m=m.sibling}H.tail!==null&&Tr()>pm&&(y.flags|=128,L=!0,pa(H,!1),y.lanes=4194304)}else{if(!L)if(m=Jd(ee),m!==null){if(y.flags|=128,L=!0,m=m.updateQueue,m!==null&&(y.updateQueue=m,y.flags|=4),pa(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ee.alternate&&!mi)return mo(y),null}else 2*Tr()-H.renderingStartTime>pm&&M!==1073741824&&(y.flags|=128,L=!0,pa(H,!1),y.lanes=4194304);H.isBackwards?(ee.sibling=y.child,y.child=ee):(m=H.last,m!==null?m.sibling=ee:y.child=ee,H.last=ee)}return H.tail!==null?(y=H.tail,H.rendering=y,H.tail=y.sibling,H.renderingStartTime=Tr(),y.sibling=null,m=Ai.current,Bn(Ai,L?m&1|2:m&1),y):(mo(y),null);case 22:case 23:return Pf(),L=y.memoizedState!==null,m!==null&&m.memoizedState!==null!==L&&(y.flags|=8192),L&&y.mode&1?Zs&1073741824&&(mo(y),me&&y.subtreeFlags&6&&(y.flags|=8192)):mo(y),null;case 24:return null;case 25:return null}throw Error(o(156,y.tag))}var zg=a.ReactCurrentOwner,Va=!1;function Wo(m,y,M,L){y.child=m===null?Yp(y,null,M,L):uo(y,m.child,M,L)}function j_(m,y,M,L,H){M=M.render;var ee=y.ref;return Ks(y,H),L=ff(m,y,M,L,ee,H),M=pe(),m!==null&&!Va?(y.updateQueue=m.updateQueue,y.flags&=-2053,m.lanes&=~H,ga(m,y,H)):(mi&&M&&nd(y),y.flags|=1,Wo(m,y,L,H),y.child)}function Gg(m,y,M,L,H){if(m===null){var ee=M.type;return typeof ee=="function"&&!vc(ee)&&ee.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(y.tag=15,y.type=ee,$_(m,y,ee,L,H)):(m=Kl(M.type,null,L,y,y.mode,H),m.ref=y.ref,m.return=y,y.child=m)}if(ee=m.child,!(m.lanes&H)){var xe=ee.memoizedProps;if(M=M.compare,M=M!==null?M:Vp,M(xe,L)&&m.ref===y.ref)return ga(m,y,H)}return y.flags|=1,m=Qo(ee,L),m.ref=y.ref,m.return=y,y.child=m}function $_(m,y,M,L,H){if(m!==null&&Vp(m.memoizedProps,L)&&m.ref===y.ref)if(Va=!1,(m.lanes&H)!==0)m.flags&131072&&(Va=!0);else return y.lanes=m.lanes,ga(m,y,H);return xr(m,y,M,L,H)}function qg(m,y,M){var L=y.pendingProps,H=L.children,ee=m!==null?m.memoizedState:null;if(L.mode==="hidden")if(!(y.mode&1))y.memoizedState={baseLanes:0,cachePool:null},Bn(kn,Zs),Zs|=M;else if(M&1073741824)y.memoizedState={baseLanes:0,cachePool:null},L=ee!==null?ee.baseLanes:M,Bn(kn,Zs),Zs|=L;else return m=ee!==null?ee.baseLanes|M:M,y.lanes=y.childLanes=1073741824,y.memoizedState={baseLanes:m,cachePool:null},y.updateQueue=null,Bn(kn,Zs),Zs|=m,null;else ee!==null?(L=ee.baseLanes|M,y.memoizedState=null):L=M,Bn(kn,Zs),Zs|=L;return Wo(m,y,H,M),y.child}function Wg(m,y){var M=y.ref;(m===null&&M!==null||m!==null&&m.ref!==M)&&(y.flags|=512,y.flags|=2097152)}function xr(m,y,M,L,H){var ee=Qn(M)?Sr:on.current;return ee=Fs(y,ee),Ks(y,H),M=ff(m,y,M,L,ee,H),L=pe(),m!==null&&!Va?(y.updateQueue=m.updateQueue,y.flags&=-2053,m.lanes&=~H,ga(m,y,H)):(mi&&L&&nd(y),y.flags|=1,Wo(m,y,M,H),y.child)}function im(m,y,M,L,H){if(Qn(M)){var ee=!0;Ro(y)}else ee=!1;if(Ks(y,H),y.stateNode===null)m!==null&&(m.alternate=null,y.alternate=null,y.flags|=2),tl(y,M,L),Wd(y,M,L,H),L=!0;else if(m===null){var xe=y.stateNode,Ve=y.memoizedProps;xe.props=Ve;var bt=xe.context,Wt=M.contextType;typeof Wt=="object"&&Wt!==null?Wt=Yi(Wt):(Wt=Qn(M)?Sr:on.current,Wt=Fs(y,Wt));var fn=M.getDerivedStateFromProps,mr=typeof fn=="function"||typeof xe.getSnapshotBeforeUpdate=="function";mr||typeof xe.UNSAFE_componentWillReceiveProps!="function"&&typeof xe.componentWillReceiveProps!="function"||(Ve!==L||bt!==Wt)&&Fr(y,xe,L,Wt),Zu=!1;var gn=y.memoizedState;xe.state=gn,et(y,L,xe,H),bt=y.memoizedState,Ve!==L||gn!==bt||Wi.current||Zu?(typeof fn=="function"&&(Gt(y,M,fn,L),bt=y.memoizedState),(Ve=Zu||Bs(y,M,Ve,L,gn,bt,Wt))?(mr||typeof xe.UNSAFE_componentWillMount!="function"&&typeof xe.componentWillMount!="function"||(typeof xe.componentWillMount=="function"&&xe.componentWillMount(),typeof xe.UNSAFE_componentWillMount=="function"&&xe.UNSAFE_componentWillMount()),typeof xe.componentDidMount=="function"&&(y.flags|=4194308)):(typeof xe.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=L,y.memoizedState=bt),xe.props=L,xe.state=bt,xe.context=Wt,L=Ve):(typeof xe.componentDidMount=="function"&&(y.flags|=4194308),L=!1)}else{xe=y.stateNode,Ms(m,y),Ve=y.memoizedProps,Wt=y.type===y.elementType?Ve:oi(y.type,Ve),xe.props=Wt,mr=y.pendingProps,gn=xe.context,bt=M.contextType,typeof bt=="object"&&bt!==null?bt=Yi(bt):(bt=Qn(M)?Sr:on.current,bt=Fs(y,bt));var er=M.getDerivedStateFromProps;(fn=typeof er=="function"||typeof xe.getSnapshotBeforeUpdate=="function")||typeof xe.UNSAFE_componentWillReceiveProps!="function"&&typeof xe.componentWillReceiveProps!="function"||(Ve!==mr||gn!==bt)&&Fr(y,xe,L,bt),Zu=!1,gn=y.memoizedState,xe.state=gn,et(y,L,xe,H);var bn=y.memoizedState;Ve!==mr||gn!==bn||Wi.current||Zu?(typeof er=="function"&&(Gt(y,M,er,L),bn=y.memoizedState),(Wt=Zu||Bs(y,M,Wt,L,gn,bn,bt)||!1)?(fn||typeof xe.UNSAFE_componentWillUpdate!="function"&&typeof xe.componentWillUpdate!="function"||(typeof xe.componentWillUpdate=="function"&&xe.componentWillUpdate(L,bn,bt),typeof xe.UNSAFE_componentWillUpdate=="function"&&xe.UNSAFE_componentWillUpdate(L,bn,bt)),typeof xe.componentDidUpdate=="function"&&(y.flags|=4),typeof xe.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof xe.componentDidUpdate!="function"||Ve===m.memoizedProps&&gn===m.memoizedState||(y.flags|=4),typeof xe.getSnapshotBeforeUpdate!="function"||Ve===m.memoizedProps&&gn===m.memoizedState||(y.flags|=1024),y.memoizedProps=L,y.memoizedState=bn),xe.props=L,xe.state=bn,xe.context=bt,L=Wt):(typeof xe.componentDidUpdate!="function"||Ve===m.memoizedProps&&gn===m.memoizedState||(y.flags|=4),typeof xe.getSnapshotBeforeUpdate!="function"||Ve===m.memoizedProps&&gn===m.memoizedState||(y.flags|=1024),L=!1)}return H_(m,y,M,L,ee,H)}function H_(m,y,M,L,H,ee){Wg(m,y);var xe=(y.flags&128)!==0;if(!L&&!xe)return H&&Dl(y,M,!1),ga(m,y,ee);L=y.stateNode,zg.current=y;var Ve=xe&&typeof M.getDerivedStateFromError!="function"?null:L.render();return y.flags|=1,m!==null&&xe?(y.child=uo(y,m.child,null,ee),y.child=uo(y,null,Ve,ee)):Wo(m,y,Ve,ee),y.memoizedState=L.state,H&&Dl(y,M,!0),y.child}function bf(m){var y=m.stateNode;y.pendingContext?Pl(m,y.pendingContext,y.pendingContext!==y.context):y.context&&Pl(m,y.context,!1),ds(m,y.containerInfo)}function od(m,y,M,L,H){return lc(),Xd(H),y.flags|=256,Wo(m,y,M,L),y.child}var wu={dehydrated:null,treeContext:null,retryLane:0};function Gl(m){return{baseLanes:m,cachePool:null}}function Ko(m,y,M){var L=y.pendingProps,H=Ai.current,ee=!1,xe=(y.flags&128)!==0,Ve;if((Ve=xe)||(Ve=m!==null&&m.memoizedState===null?!1:(H&2)!==0),Ve?(ee=!0,y.flags&=-129):(m===null||m.memoizedState!==null)&&(H|=1),Bn(Ai,H&1),m===null)return _u(y),m=y.memoizedState,m!==null&&(m=m.dehydrated,m!==null)?(y.mode&1?tn(m)?y.lanes=8:y.lanes=1073741824:y.lanes=1,null):(H=L.children,m=L.fallback,ee?(L=y.mode,ee=y.child,H={mode:"hidden",children:H},!(L&1)&&ee!==null?(ee.childLanes=0,ee.pendingProps=H):ee=Vi(H,L,0,null),m=ya(m,L,M,null),ee.return=y,m.return=y,ee.sibling=m,y.child=ee,y.child.memoizedState=Gl(M),y.memoizedState=wu,m):ql(y,H));if(H=m.memoizedState,H!==null){if(Ve=H.dehydrated,Ve!==null){if(xe)return y.flags&256?(y.flags&=-257,sm(m,y,M,Error(o(422)))):y.memoizedState!==null?(y.child=m.child,y.flags|=128,null):(ee=L.fallback,H=y.mode,L=Vi({mode:"visible",children:L.children},H,0,null),ee=ya(ee,H,M,null),ee.flags|=2,L.return=y,ee.return=y,L.sibling=ee,y.child=L,y.mode&1&&uo(y,m.child,null,M),y.child.memoizedState=Gl(M),y.memoizedState=wu,ee);if(!(y.mode&1))y=sm(m,y,M,null);else if(tn(Ve))y=sm(m,y,M,Error(o(419)));else if(L=(M&m.childLanes)!==0,Va||L){if(L=fs,L!==null){switch(M&-M){case 4:ee=2;break;case 16:ee=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ee=32;break;case 536870912:ee=268435456;break;default:ee=0}L=ee&(L.suspendedLanes|M)?0:ee,L!==0&&L!==H.retryLane&&(H.retryLane=L,va(m,L,-1))}dd(),y=sm(m,y,M,Error(o(421)))}else dn(Ve)?(y.flags|=128,y.child=m.child,y=Df.bind(null,m),Cn(Ve,y),y=null):(M=H.treeContext,nt&&(Vo=si(Ve),cc=y,mi=!0,Ic=null,Mc=!1,M!==null&&(Ys[Xs++]=Wr,Ys[Xs++]=Ac,Ys[Xs++]=Hl,Wr=M.id,Ac=M.overflow,Hl=y)),y=ql(y,y.pendingProps.children),y.flags|=4096);return y}return ee?(L=Kg(m,y,L.children,L.fallback,M),ee=y.child,H=m.child.memoizedState,ee.memoizedState=H===null?Gl(M):{baseLanes:H.baseLanes|M,cachePool:null},ee.childLanes=m.childLanes&~M,y.memoizedState=wu,L):(M=ad(m,y,L.children,M),y.memoizedState=null,M)}return ee?(L=Kg(m,y,L.children,L.fallback,M),ee=y.child,H=m.child.memoizedState,ee.memoizedState=H===null?Gl(M):{baseLanes:H.baseLanes|M,cachePool:null},ee.childLanes=m.childLanes&~M,y.memoizedState=wu,L):(M=ad(m,y,L.children,M),y.memoizedState=null,M)}function ql(m,y){return y=Vi({mode:"visible",children:y},m.mode,0,null),y.return=m,m.child=y}function ad(m,y,M,L){var H=m.child;return m=H.sibling,M=Qo(H,{mode:"visible",children:M}),!(y.mode&1)&&(M.lanes=L),M.return=y,M.sibling=null,m!==null&&(L=y.deletions,L===null?(y.deletions=[m],y.flags|=16):L.push(m)),y.child=M}function Kg(m,y,M,L,H){var ee=y.mode;m=m.child;var xe=m.sibling,Ve={mode:"hidden",children:M};return!(ee&1)&&y.child!==m?(M=y.child,M.childLanes=0,M.pendingProps=Ve,y.deletions=null):(M=Qo(m,Ve),M.subtreeFlags=m.subtreeFlags&14680064),xe!==null?L=Qo(xe,L):(L=ya(L,ee,H,null),L.flags|=2),L.return=y,M.return=y,M.sibling=L,y.child=M,L}function sm(m,y,M,L){return L!==null&&Xd(L),uo(y,m.child,null,M),m=ql(y,y.pendingProps.children),m.flags|=2,y.memoizedState=null,m}function Ef(m,y,M){m.lanes|=y;var L=m.alternate;L!==null&&(L.lanes|=y),qd(m.return,y,M)}function ma(m,y,M,L,H){var ee=m.memoizedState;ee===null?m.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:L,tail:M,tailMode:H}:(ee.isBackwards=y,ee.rendering=null,ee.renderingStartTime=0,ee.last=L,ee.tail=M,ee.tailMode=H)}function Tu(m,y,M){var L=y.pendingProps,H=L.revealOrder,ee=L.tail;if(Wo(m,y,L.children,M),L=Ai.current,L&2)L=L&1|2,y.flags|=128;else{if(m!==null&&m.flags&128)e:for(m=y.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&Ef(m,M,y);else if(m.tag===19)Ef(m,M,y);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===y)break e;for(;m.sibling===null;){if(m.return===null||m.return===y)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}L&=1}if(Bn(Ai,L),!(y.mode&1))y.memoizedState=null;else switch(H){case"forwards":for(M=y.child,H=null;M!==null;)m=M.alternate,m!==null&&Jd(m)===null&&(H=M),M=M.sibling;M=H,M===null?(H=y.child,y.child=null):(H=M.sibling,M.sibling=null),ma(y,!1,H,M,ee);break;case"backwards":for(M=null,H=y.child,y.child=null;H!==null;){if(m=H.alternate,m!==null&&Jd(m)===null){y.child=H;break}m=H.sibling,H.sibling=M,M=H,H=m}ma(y,!0,M,null,ee);break;case"together":ma(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function ga(m,y,M){if(m!==null&&(y.dependencies=m.dependencies),za|=y.lanes,!(M&y.childLanes))return null;if(m!==null&&y.child!==m.child)throw Error(o(153));if(y.child!==null){for(m=y.child,M=Qo(m,m.pendingProps),y.child=M,M.return=y;m.sibling!==null;)m=m.sibling,M=M.sibling=Qo(m,m.pendingProps),M.return=y;M.sibling=null}return y.child}function Ly(m,y,M){switch(y.tag){case 3:bf(y),lc();break;case 5:uc(y);break;case 1:Qn(y.type)&&Ro(y);break;case 4:ds(y,y.stateNode.containerInfo);break;case 10:ky(y,y.type._context,y.memoizedProps.value);break;case 13:var L=y.memoizedState;if(L!==null)return L.dehydrated!==null?(Bn(Ai,Ai.current&1),y.flags|=128,null):M&y.child.childLanes?Ko(m,y,M):(Bn(Ai,Ai.current&1),m=ga(m,y,M),m!==null?m.sibling:null);Bn(Ai,Ai.current&1);break;case 19:if(L=(M&y.childLanes)!==0,m.flags&128){if(L)return Tu(m,y,M);y.flags|=128}var H=y.memoizedState;if(H!==null&&(H.rendering=null,H.tail=null,H.lastEffect=null),Bn(Ai,Ai.current),L)break;return null;case 22:case 23:return y.lanes=0,qg(m,y,M)}return ga(m,y,M)}function Yg(m,y){switch(L_(y),y.tag){case 1:return Qn(y.type)&&ur(),m=y.flags,m&65536?(y.flags=m&-65537|128,y):null;case 3:return Zn(),En(Wi),En(on),Ut(),m=y.flags,m&65536&&!(m&128)?(y.flags=m&-65537|128,y):null;case 5:return ho(y),null;case 13:if(En(Ai),m=y.memoizedState,m!==null&&m.dehydrated!==null){if(y.alternate===null)throw Error(o(340));lc()}return m=y.flags,m&65536?(y.flags=m&-65537|128,y):null;case 19:return En(Ai),null;case 4:return Zn(),null;case 10:return vu(y.type._context),null;case 22:case 23:return Pf(),null;case 24:return null;default:return null}}var th=!1,xu=!1,om=typeof WeakSet=="function"?WeakSet:Set,rn=null;function nh(m,y){var M=m.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(L){Ga(m,y,L)}else M.current=null}function ll(m,y,M){try{M()}catch(L){Ga(m,y,L)}}var Uy=!1;function Io(m,y){for(Z(m.containerInfo),rn=y;rn!==null;)if(m=rn,y=m.child,(m.subtreeFlags&1028)!==0&&y!==null)y.return=m,rn=y;else for(;rn!==null;){m=rn;try{var M=m.alternate;if(m.flags&1024)switch(m.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var L=M.memoizedProps,H=M.memoizedState,ee=m.stateNode,xe=ee.getSnapshotBeforeUpdate(m.elementType===m.type?L:oi(m.type,L),H);ee.__reactInternalSnapshotBeforeUpdate=xe}break;case 3:me&&xt(m.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Ve){Ga(m,m.return,Ve)}if(y=m.sibling,y!==null){y.return=m.return,rn=y;break}rn=m.return}return M=Uy,Uy=!1,M}function Cu(m,y,M){var L=y.updateQueue;if(L=L!==null?L.lastEffect:null,L!==null){var H=L=L.next;do{if((H.tag&m)===m){var ee=H.destroy;H.destroy=void 0,ee!==void 0&&ll(y,M,ee)}H=H.next}while(H!==L)}}function rh(m,y){if(y=y.updateQueue,y=y!==null?y.lastEffect:null,y!==null){var M=y=y.next;do{if((M.tag&m)===m){var L=M.create;M.destroy=L()}M=M.next}while(M!==y)}}function Sf(m){var y=m.ref;if(y!==null){var M=m.stateNode;switch(m.tag){case 5:m=Q(M);break;default:m=M}typeof y=="function"?y(m):y.current=m}}function Xg(m,y,M){if(Qc&&typeof Qc.onCommitFiberUnmount=="function")try{Qc.onCommitFiberUnmount(jp,y)}catch{}switch(y.tag){case 0:case 11:case 14:case 15:if(m=y.updateQueue,m!==null&&(m=m.lastEffect,m!==null)){var L=m=m.next;do{var H=L,ee=H.destroy;H=H.tag,ee!==void 0&&(H&2||H&4)&&ll(y,M,ee),L=L.next}while(L!==m)}break;case 1:if(nh(y,M),m=y.stateNode,typeof m.componentWillUnmount=="function")try{m.props=y.memoizedProps,m.state=y.memoizedState,m.componentWillUnmount()}catch(xe){Ga(y,M,xe)}break;case 5:nh(y,M);break;case 4:me?V_(m,y,M):ge&&ge&&(y=y.stateNode.containerInfo,M=Jt(y),Et(y,M))}}function wf(m,y,M){for(var L=y;;)if(Xg(m,L,M),L.child===null||me&&L.tag===4){if(L===y)break;for(;L.sibling===null;){if(L.return===null||L.return===y)return;L=L.return}L.sibling.return=L.return,L=L.sibling}else L.child.return=L,L=L.child}function ih(m){var y=m.alternate;y!==null&&(m.alternate=null,ih(y)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(y=m.stateNode,y!==null&&Rt(y)),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function Tf(m){return m.tag===5||m.tag===3||m.tag===4}function Yo(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||Tf(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function ul(m){if(me){e:{for(var y=m.return;y!==null;){if(Tf(y))break e;y=y.return}throw Error(o(160))}var M=y;switch(M.tag){case 5:y=M.stateNode,M.flags&32&&(yt(y),M.flags&=-33),M=Yo(m),cd(m,M,y);break;case 3:case 4:y=M.stateNode.containerInfo,M=Yo(m),xf(m,M,y);break;default:throw Error(o(161))}}}function xf(m,y,M){var L=m.tag;if(L===5||L===6)m=m.stateNode,y?Ie(M,m,y):Dt(M,m);else if(L!==4&&(m=m.child,m!==null))for(xf(m,y,M),m=m.sibling;m!==null;)xf(m,y,M),m=m.sibling}function cd(m,y,M){var L=m.tag;if(L===5||L===6)m=m.stateNode,y?fe(M,m,y):St(M,m);else if(L!==4&&(m=m.child,m!==null))for(cd(m,y,M),m=m.sibling;m!==null;)cd(m,y,M),m=m.sibling}function V_(m,y,M){for(var L=y,H=!1,ee,xe;;){if(!H){H=L.return;e:for(;;){if(H===null)throw Error(o(160));switch(ee=H.stateNode,H.tag){case 5:xe=!1;break e;case 3:ee=ee.containerInfo,xe=!0;break e;case 4:ee=ee.containerInfo,xe=!0;break e}H=H.return}H=!0}if(L.tag===5||L.tag===6)wf(m,L,M),xe?dt(ee,L.stateNode):Ue(ee,L.stateNode);else if(L.tag===18)xe?pt(ee,L.stateNode):Ke(ee,L.stateNode);else if(L.tag===4){if(L.child!==null){ee=L.stateNode.containerInfo,xe=!0,L.child.return=L,L=L.child;continue}}else if(Xg(m,L,M),L.child!==null){L.child.return=L,L=L.child;continue}if(L===y)break;for(;L.sibling===null;){if(L.return===null||L.return===y)return;L=L.return,L.tag===4&&(H=!1)}L.sibling.return=L.return,L=L.sibling}}function Jg(m,y){if(me){switch(y.tag){case 0:case 11:case 14:case 15:Cu(3,y,y.return),rh(3,y),Cu(5,y,y.return);return;case 1:return;case 5:var M=y.stateNode;if(M!=null){var L=y.memoizedProps;m=m!==null?m.memoizedProps:L;var H=y.type,ee=y.updateQueue;y.updateQueue=null,ee!==null&&V(M,ee,H,m,L,y)}return;case 6:if(y.stateNode===null)throw Error(o(162));M=y.memoizedProps,oe(y.stateNode,m!==null?m.memoizedProps:M,M);return;case 3:nt&&m!==null&&m.memoizedState.isDehydrated&&sf(y.stateNode.containerInfo);return;case 12:return;case 13:am(y);return;case 19:am(y);return;case 17:return}throw Error(o(163))}switch(y.tag){case 0:case 11:case 14:case 15:Cu(3,y,y.return),rh(3,y),Cu(5,y,y.return);return;case 12:return;case 13:am(y);return;case 19:am(y);return;case 3:nt&&m!==null&&m.memoizedState.isDehydrated&&sf(y.stateNode.containerInfo);break;case 22:case 23:return}e:if(ge){switch(y.tag){case 1:case 5:case 6:break e;case 3:case 4:y=y.stateNode,Et(y.containerInfo,y.pendingChildren);break e}throw Error(o(163))}}function am(m){var y=m.updateQueue;if(y!==null){m.updateQueue=null;var M=m.stateNode;M===null&&(M=m.stateNode=new om),y.forEach(function(L){var H=vm.bind(null,m,L);M.has(L)||(M.add(L),L.then(H,H))})}}function sh(m,y){for(rn=y;rn!==null;){y=rn;var M=y.deletions;if(M!==null)for(var L=0;L<M.length;L++){var H=M[L];try{var ee=m;me?V_(ee,H,y):wf(ee,H,y);var xe=H.alternate;xe!==null&&(xe.return=null),H.return=null}catch(yn){Ga(H,y,yn)}}if(M=y.child,y.subtreeFlags&12854&&M!==null)M.return=y,rn=M;else for(;rn!==null;){y=rn;try{var Ve=y.flags;if(Ve&32&&me&&yt(y.stateNode),Ve&512){var bt=y.alternate;if(bt!==null){var Wt=bt.ref;Wt!==null&&(typeof Wt=="function"?Wt(null):Wt.current=null)}}if(Ve&8192)switch(y.tag){case 13:if(y.memoizedState!==null){var fn=y.alternate;(fn===null||fn.memoizedState===null)&&(Zg=Tr())}break;case 22:var mr=y.memoizedState!==null,gn=y.alternate,er=gn!==null&&gn.memoizedState!==null;if(M=y,me){e:if(L=M,H=mr,ee=null,me)for(var bn=L;;){if(bn.tag===5){if(ee===null){ee=bn;var Zo=bn.stateNode;H?Dn(Zo):Lt(bn.stateNode,bn.memoizedProps)}}else if(bn.tag===6){if(ee===null){var Rr=bn.stateNode;H?Le(Rr):rt(Rr,bn.memoizedProps)}}else if((bn.tag!==22&&bn.tag!==23||bn.memoizedState===null||bn===L)&&bn.child!==null){bn.child.return=bn,bn=bn.child;continue}if(bn===L)break;for(;bn.sibling===null;){if(bn.return===null||bn.return===L)break e;ee===bn&&(ee=null),bn=bn.return}ee===bn&&(ee=null),bn.sibling.return=bn.return,bn=bn.sibling}}if(mr&&!er&&M.mode&1){rn=M;for(var Ge=M.child;Ge!==null;){for(M=rn=Ge;rn!==null;){L=rn;var Je=L.child;switch(L.tag){case 0:case 11:case 14:case 15:Cu(4,L,L.return);break;case 1:nh(L,L.return);var ct=L.stateNode;if(typeof ct.componentWillUnmount=="function"){var Vt=L.return;try{ct.props=L.memoizedProps,ct.state=L.memoizedState,ct.componentWillUnmount()}catch(yn){Ga(L,Vt,yn)}}break;case 5:nh(L,L.return);break;case 22:if(L.memoizedState!==null){lm(M);continue}}Je!==null?(Je.return=L,rn=Je):lm(M)}Ge=Ge.sibling}}}switch(Ve&4102){case 2:ul(y),y.flags&=-3;break;case 6:ul(y),y.flags&=-3,Jg(y.alternate,y);break;case 4096:y.flags&=-4097;break;case 4100:y.flags&=-4097,Jg(y.alternate,y);break;case 4:Jg(y.alternate,y)}}catch(yn){Ga(y,y.return,yn)}if(M=y.sibling,M!==null){M.return=y.return,rn=M;break}rn=y.return}}}function cm(m,y,M){rn=m,z_(m)}function z_(m,y,M){for(var L=(m.mode&1)!==0;rn!==null;){var H=rn,ee=H.child;if(H.tag===22&&L){var xe=H.memoizedState!==null||th;if(!xe){var Ve=H.alternate,bt=Ve!==null&&Ve.memoizedState!==null||xu;Ve=th;var Wt=xu;if(th=xe,(xu=bt)&&!Wt)for(rn=H;rn!==null;)xe=rn,bt=xe.child,xe.tag===22&&xe.memoizedState!==null?G_(H):bt!==null?(bt.return=xe,rn=bt):G_(H);for(;ee!==null;)rn=ee,z_(ee),ee=ee.sibling;rn=H,th=Ve,xu=Wt}Qg(m)}else H.subtreeFlags&8772&&ee!==null?(ee.return=H,rn=ee):Qg(m)}}function Qg(m){for(;rn!==null;){var y=rn;if(y.flags&8772){var M=y.alternate;try{if(y.flags&8772)switch(y.tag){case 0:case 11:case 15:xu||rh(5,y);break;case 1:var L=y.stateNode;if(y.flags&4&&!xu)if(M===null)L.componentDidMount();else{var H=y.elementType===y.type?M.memoizedProps:oi(y.type,M.memoizedProps);L.componentDidUpdate(H,M.memoizedState,L.__reactInternalSnapshotBeforeUpdate)}var ee=y.updateQueue;ee!==null&&It(y,ee,L);break;case 3:var xe=y.updateQueue;if(xe!==null){if(M=null,y.child!==null)switch(y.child.tag){case 5:M=Q(y.child.stateNode);break;case 1:M=y.child.stateNode}It(y,xe,M)}break;case 5:var Ve=y.stateNode;M===null&&y.flags&4&&j(Ve,y.type,y.memoizedProps,y);break;case 6:break;case 4:break;case 12:break;case 13:if(nt&&y.memoizedState===null){var bt=y.alternate;if(bt!==null){var Wt=bt.memoizedState;if(Wt!==null){var fn=Wt.dehydrated;fn!==null&&ve(fn)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}xu||y.flags&512&&Sf(y)}catch(mr){Ga(y,y.return,mr)}}if(y===m){rn=null;break}if(M=y.sibling,M!==null){M.return=y.return,rn=M;break}rn=y.return}}function lm(m){for(;rn!==null;){var y=rn;if(y===m){rn=null;break}var M=y.sibling;if(M!==null){M.return=y.return,rn=M;break}rn=y.return}}function G_(m){for(;rn!==null;){var y=rn;try{switch(y.tag){case 0:case 11:case 15:var M=y.return;try{rh(4,y)}catch(bt){Ga(y,M,bt)}break;case 1:var L=y.stateNode;if(typeof L.componentDidMount=="function"){var H=y.return;try{L.componentDidMount()}catch(bt){Ga(y,H,bt)}}var ee=y.return;try{Sf(y)}catch(bt){Ga(y,ee,bt)}break;case 5:var xe=y.return;try{Sf(y)}catch(bt){Ga(y,xe,bt)}}}catch(bt){Ga(y,y.return,bt)}if(y===m){rn=null;break}var Ve=y.sibling;if(Ve!==null){Ve.return=y.return,rn=Ve;break}rn=y.return}}var oh=0,Cf=1,ah=2,um=3,ch=4;if(typeof Symbol=="function"&&Symbol.for){var Rf=Symbol.for;oh=Rf("selector.component"),Cf=Rf("selector.has_pseudo_class"),ah=Rf("selector.role"),um=Rf("selector.test_id"),ch=Rf("selector.text")}function Af(m){var y=Ce(m);if(y!=null){if(typeof y.memoizedProps["data-testname"]!="string")throw Error(o(364));return y}if(m=Ee(m),m===null)throw Error(o(362));return m.stateNode.current}function q_(m,y){switch(y.$$typeof){case oh:if(m.type===y.value)return!0;break;case Cf:e:{y=y.value,m=[m,0];for(var M=0;M<m.length;){var L=m[M++],H=m[M++],ee=y[H];if(L.tag!==5||!it(L)){for(;ee!=null&&q_(L,ee);)H++,ee=y[H];if(H===y.length){y=!0;break e}else for(L=L.child;L!==null;)m.push(L,H),L=L.sibling}}y=!1}return y;case ah:if(m.tag===5&&je(m.stateNode,y.value))return!0;break;case ch:if((m.tag===5||m.tag===6)&&(m=We(m),m!==null&&0<=m.indexOf(y.value)))return!0;break;case um:if(m.tag===5&&(m=m.memoizedProps["data-testname"],typeof m=="string"&&m.toLowerCase()===y.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function dm(m){switch(m.$$typeof){case oh:return"<"+(N(m.value)||"Unknown")+">";case Cf:return":has("+(dm(m)||"")+")";case ah:return'[role="'+m.value+'"]';case ch:return'"'+m.value+'"';case um:return'[data-testname="'+m.value+'"]';default:throw Error(o(365))}}function fc(m,y){var M=[];m=[m,0];for(var L=0;L<m.length;){var H=m[L++],ee=m[L++],xe=y[ee];if(H.tag!==5||!it(H)){for(;xe!=null&&q_(H,xe);)ee++,xe=y[ee];if(ee===y.length)M.push(H);else for(H=H.child;H!==null;)m.push(H,ee),H=H.sibling}}return M}function pc(m,y){if(!Ft)throw Error(o(363));m=Af(m),m=fc(m,y),y=[],m=Array.from(m);for(var M=0;M<m.length;){var L=m[M++];if(L.tag===5)it(L)||y.push(L.stateNode);else for(L=L.child;L!==null;)m.push(L),L=L.sibling}return y}var mc=Math.ceil,wi=a.ReactCurrentDispatcher,hm=a.ReactCurrentOwner,Ti=a.ReactCurrentBatchConfig,Cr=0,fs=null,ps=null,Vs=0,Zs=0,kn=Gr(0),ms=0,In=null,za=0,ld=0,fm=0,os=null,Xo=null,Zg=0,pm=1/0;function Ii(){pm=Tr()+500}var eo=!1,Mf=null,Wl=null,ev=!1,Oc=null,mm=0,If=0,ud=null,Of=-1,lh=0;function Pi(){return Cr&6?Tr():Of!==-1?Of:Of=Tr()}function gc(m){return m.mode&1?Cr&2&&Vs!==0?Vs&-Vs:P_.transition!==null?(lh===0&&(m=vr,vr<<=1,!(vr&4194240)&&(vr=64),lh=m),lh):(m=dr,m!==0?m:He()):1}function va(m,y,M){if(50<If)throw If=0,ud=null,Error(o(185));var L=gs(m,y);return L===null?null:(Ju(L,y,M),(!(Cr&2)||L!==fs)&&(L===fs&&(!(Cr&2)&&(ld|=y),ms===4&&Ru(L,Vs)),to(L,M),y===1&&Cr===0&&!(m.mode&1)&&(Ii(),$p&&oc())),L)}function gs(m,y){m.lanes|=y;var M=m.alternate;for(M!==null&&(M.lanes|=y),M=m,m=m.return;m!==null;)m.childLanes|=y,M=m.alternate,M!==null&&(M.childLanes|=y),M=m,m=m.return;return M.tag===3?M.stateNode:null}function to(m,y){var M=m.callbackNode;gu(m,y);var L=Gd(m,m===fs?Vs:0);if(L===0)M!==null&&Ul(M),m.callbackNode=null,m.callbackPriority=0;else if(y=L&-L,m.callbackPriority!==y){if(M!=null&&Ul(M),y===1)m.tag===0?Oy(Nf.bind(null,m)):Ng(Nf.bind(null,m)),$t?Tt(function(){Cr===0&&oc()}):Mg(Fl,oc),M=null;else{switch(Iy(L)){case 1:M=Fl;break;case 4:M=N_;break;case 16:M=Ig;break;case 536870912:M=Og;break;default:M=Ig}M=jy(M,kf.bind(null,m))}m.callbackPriority=y,m.callbackNode=M}}function kf(m,y){if(Of=-1,lh=0,Cr&6)throw Error(o(327));var M=m.callbackNode;if(Ir()&&m.callbackNode!==M)return null;var L=Gd(m,m===fs?Vs:0);if(L===0)return null;if(L&30||L&m.expiredLanes||y)y=dh(m,L);else{y=L;var H=Cr;Cr|=2;var ee=W_();(fs!==m||Vs!==y)&&(Ii(),Hi(m,y));do try{Jo();break}catch(Ve){dl(m,Ve)}while(!0);lf(),wi.current=ee,Cr=H,ps!==null?y=0:(fs=null,Vs=0,y=ms)}if(y!==0){if(y===2&&(H=Up(m),H!==0&&(L=H,y=gm(m,H))),y===1)throw M=In,Hi(m,0),Ru(m,L),to(m,Tr()),M;if(y===6)Ru(m,L);else{if(H=m.current.alternate,!(L&30)&&!uh(H)&&(y=dh(m,L),y===2&&(ee=Up(m),ee!==0&&(L=ee,y=gm(m,ee))),y===1))throw M=In,Hi(m,0),Ru(m,L),to(m,Tr()),M;switch(m.finishedWork=H,m.finishedLanes=L,y){case 0:case 1:throw Error(o(345));case 2:hd(m,Xo);break;case 3:if(Ru(m,L),(L&130023424)===L&&(y=Zg+500-Tr(),10<y)){if(Gd(m,0)!==0)break;if(H=m.suspendedLanes,(H&L)!==L){Pi(),m.pingedLanes|=m.suspendedLanes&H;break}m.timeoutHandle=Te(hd.bind(null,m,Xo),y);break}hd(m,Xo);break;case 4:if(Ru(m,L),(L&4194240)===L)break;for(y=m.eventTimes,H=-1;0<L;){var xe=31-Ki(L);ee=1<<xe,xe=y[xe],xe>H&&(H=xe),L&=~ee}if(L=H,L=Tr()-L,L=(120>L?120:480>L?480:1080>L?1080:1920>L?1920:3e3>L?3e3:4320>L?4320:1960*mc(L/1960))-L,10<L){m.timeoutHandle=Te(hd.bind(null,m,Xo),L);break}hd(m,Xo);break;case 5:hd(m,Xo);break;default:throw Error(o(329))}}}return to(m,Tr()),m.callbackNode===M?kf.bind(null,m):null}function gm(m,y){var M=os;return m.current.memoizedState.isDehydrated&&(Hi(m,y).flags|=256),m=dh(m,y),m!==2&&(y=Xo,Xo=M,y!==null&&kc(y)),m}function kc(m){Xo===null?Xo=m:Xo.push.apply(Xo,m)}function uh(m){for(var y=m;;){if(y.flags&16384){var M=y.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var L=0;L<M.length;L++){var H=M[L],ee=H.getSnapshot;H=H.value;try{if(!Bl(ee(),H))return!1}catch{return!1}}}if(M=y.child,y.subtreeFlags&16384&&M!==null)M.return=y,y=M;else{if(y===m)break;for(;y.sibling===null;){if(y.return===null||y.return===m)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function Ru(m,y){for(y&=~fm,y&=~ld,m.suspendedLanes|=y,m.pingedLanes&=~y,m=m.expirationTimes;0<y;){var M=31-Ki(y),L=1<<M;m[M]=-1,y&=~L}}function Nf(m){if(Cr&6)throw Error(o(327));Ir();var y=Gd(m,0);if(!(y&1))return to(m,Tr()),null;var M=dh(m,y);if(m.tag!==0&&M===2){var L=Up(m);L!==0&&(y=L,M=gm(m,L))}if(M===1)throw M=In,Hi(m,0),Ru(m,y),to(m,Tr()),M;if(M===6)throw Error(o(345));return m.finishedWork=m.current.alternate,m.finishedLanes=y,hd(m,Xo),to(m,Tr()),null}function no(m){Oc!==null&&Oc.tag===0&&!(Cr&6)&&Ir();var y=Cr;Cr|=1;var M=Ti.transition,L=dr;try{if(Ti.transition=null,dr=1,m)return m()}finally{dr=L,Ti.transition=M,Cr=y,!(Cr&6)&&oc()}}function Pf(){Zs=kn.current,En(kn)}function Hi(m,y){m.finishedWork=null,m.finishedLanes=0;var M=m.timeoutHandle;if(M!==_t&&(m.timeoutHandle=_t,Oe(M)),ps!==null)for(M=ps.return;M!==null;){var L=M;switch(L_(L),L.tag){case 1:L=L.type.childContextTypes,L!=null&&ur();break;case 3:Zn(),En(Wi),En(on),Ut();break;case 5:ho(L);break;case 4:Zn();break;case 13:En(Ai);break;case 19:En(Ai);break;case 10:vu(L.type._context);break;case 22:case 23:Pf()}M=M.return}if(fs=m,ps=m=Qo(m.current,null),Vs=Zs=y,ms=0,In=null,fm=ld=za=0,Xo=os=null,ja!==null){for(y=0;y<ja.length;y++)if(M=ja[y],L=M.interleaved,L!==null){M.interleaved=null;var H=L.next,ee=M.pending;if(ee!==null){var xe=ee.next;ee.next=H,L.next=xe}M.pending=L}ja=null}return m}function dl(m,y){do{var M=ps;try{if(lf(),Is.current=Ha,hf){for(var L=Ni.memoizedState;L!==null;){var H=L.queue;H!==null&&(H.pending=null),L=L.next}hf=!1}if(dc=0,Os=ss=Ni=null,Jp=!1,yu=0,hm.current=null,M===null||M.return===null){ms=1,In=y,ps=null;break}e:{var ee=m,xe=M.return,Ve=M,bt=y;if(y=Vs,Ve.flags|=32768,bt!==null&&typeof bt=="object"&&typeof bt.then=="function"){var Wt=bt,fn=Ve,mr=fn.tag;if(!(fn.mode&1)&&(mr===0||mr===11||mr===15)){var gn=fn.alternate;gn?(fn.updateQueue=gn.updateQueue,fn.memoizedState=gn.memoizedState,fn.lanes=gn.lanes):(fn.updateQueue=null,fn.memoizedState=null)}var er=zl(xe);if(er!==null){er.flags&=-257,tm(er,xe,Ve,ee,y),er.mode&1&&Hg(ee,Wt,y),y=er,bt=Wt;var bn=y.updateQueue;if(bn===null){var Zo=new Set;Zo.add(bt),y.updateQueue=Zo}else bn.add(bt);break e}else{if(!(y&1)){Hg(ee,Wt,y),dd();break e}bt=Error(o(426))}}else if(mi&&Ve.mode&1){var Rr=zl(xe);if(Rr!==null){!(Rr.flags&65536)&&(Rr.flags|=256),tm(Rr,xe,Ve,ee,y),Xd(bt);break e}}ee=bt,ms!==4&&(ms=2),os===null?os=[ee]:os.push(ee),bt=Su(bt,Ve),Ve=xe;do{switch(Ve.tag){case 3:Ve.flags|=65536,y&=-y,Ve.lanes|=y;var Ge=gf(Ve,bt,y);st(Ve,Ge);break e;case 1:ee=bt;var Je=Ve.type,ct=Ve.stateNode;if(!(Ve.flags&128)&&(typeof Je.getDerivedStateFromError=="function"||ct!==null&&typeof ct.componentDidCatch=="function"&&(Wl===null||!Wl.has(ct)))){Ve.flags|=65536,y&=-y,Ve.lanes|=y;var Vt=eh(Ve,ee,y);st(Ve,Vt);break e}}Ve=Ve.return}while(Ve!==null)}tv(M)}catch(yn){y=yn,ps===M&&M!==null&&(ps=M=M.return);continue}break}while(!0)}function W_(){var m=wi.current;return wi.current=Ha,m===null?Ha:m}function dd(){(ms===0||ms===3||ms===2)&&(ms=4),fs===null||!(za&268435455)&&!(ld&268435455)||Ru(fs,Vs)}function dh(m,y){var M=Cr;Cr|=2;var L=W_();fs===m&&Vs===y||Hi(m,y);do try{_a();break}catch(H){dl(m,H)}while(!0);if(lf(),Cr=M,wi.current=L,ps!==null)throw Error(o(261));return fs=null,Vs=0,ms}function _a(){for(;ps!==null;)go(ps)}function Jo(){for(;ps!==null&&!Bp();)go(ps)}function go(m){var y=By(m.alternate,m,Zs);m.memoizedProps=m.pendingProps,y===null?tv(m):ps=y,hm.current=null}function tv(m){var y=m;do{var M=y.alternate;if(m=y.return,y.flags&32768){if(M=Yg(M,y),M!==null){M.flags&=32767,ps=M;return}if(m!==null)m.flags|=32768,m.subtreeFlags=0,m.deletions=null;else{ms=6,ps=null;return}}else if(M=B_(M,y,Zs),M!==null){ps=M;return}if(y=y.sibling,y!==null){ps=y;return}ps=y=m}while(y!==null);ms===0&&(ms=5)}function hd(m,y){var M=dr,L=Ti.transition;try{Ti.transition=null,dr=1,Au(m,y,M)}finally{Ti.transition=L,dr=M}return null}function Au(m,y,M){do Ir();while(Oc!==null);if(Cr&6)throw Error(o(327));var L=m.finishedWork,H=m.finishedLanes;if(L===null)return null;if(m.finishedWork=null,m.finishedLanes=0,L===m.current)throw Error(o(177));m.callbackNode=null,m.callbackPriority=0;var ee=L.lanes|L.childLanes;if(ha(m,ee),m===fs&&(ps=fs=null,Vs=0),!(L.subtreeFlags&2064)&&!(L.flags&2064)||ev||(ev=!0,jy(Ig,function(){return Ir(),null})),ee=(L.flags&15990)!==0,L.subtreeFlags&15990||ee){ee=Ti.transition,Ti.transition=null;var xe=dr;dr=1;var Ve=Cr;Cr|=4,hm.current=null,Io(m,L),sh(m,L),se(m.containerInfo),m.current=L,cm(L),Qu(),Cr=Ve,dr=xe,Ti.transition=ee}else m.current=L;if(ev&&(ev=!1,Oc=m,mm=H),ee=m.pendingLanes,ee===0&&(Wl=null),kg(L.stateNode),to(m,Tr()),y!==null)for(M=m.onRecoverableError,L=0;L<y.length;L++)M(y[L]);if(eo)throw eo=!1,m=Mf,Mf=null,m;return mm&1&&m.tag!==0&&Ir(),ee=m.pendingLanes,ee&1?m===ud?If++:(If=0,ud=m):If=0,oc(),null}function Ir(){if(Oc!==null){var m=Iy(mm),y=Ti.transition,M=dr;try{if(Ti.transition=null,dr=16>m?16:m,Oc===null)var L=!1;else{if(m=Oc,Oc=null,mm=0,Cr&6)throw Error(o(331));var H=Cr;for(Cr|=4,rn=m.current;rn!==null;){var ee=rn,xe=ee.child;if(rn.flags&16){var Ve=ee.deletions;if(Ve!==null){for(var bt=0;bt<Ve.length;bt++){var Wt=Ve[bt];for(rn=Wt;rn!==null;){var fn=rn;switch(fn.tag){case 0:case 11:case 15:Cu(8,fn,ee)}var mr=fn.child;if(mr!==null)mr.return=fn,rn=mr;else for(;rn!==null;){fn=rn;var gn=fn.sibling,er=fn.return;if(ih(fn),fn===Wt){rn=null;break}if(gn!==null){gn.return=er,rn=gn;break}rn=er}}}var bn=ee.alternate;if(bn!==null){var Zo=bn.child;if(Zo!==null){bn.child=null;do{var Rr=Zo.sibling;Zo.sibling=null,Zo=Rr}while(Zo!==null)}}rn=ee}}if(ee.subtreeFlags&2064&&xe!==null)xe.return=ee,rn=xe;else e:for(;rn!==null;){if(ee=rn,ee.flags&2048)switch(ee.tag){case 0:case 11:case 15:Cu(9,ee,ee.return)}var Ge=ee.sibling;if(Ge!==null){Ge.return=ee.return,rn=Ge;break e}rn=ee.return}}var Je=m.current;for(rn=Je;rn!==null;){xe=rn;var ct=xe.child;if(xe.subtreeFlags&2064&&ct!==null)ct.return=xe,rn=ct;else e:for(xe=Je;rn!==null;){if(Ve=rn,Ve.flags&2048)try{switch(Ve.tag){case 0:case 11:case 15:rh(9,Ve)}}catch(yn){Ga(Ve,Ve.return,yn)}if(Ve===xe){rn=null;break e}var Vt=Ve.sibling;if(Vt!==null){Vt.return=Ve.return,rn=Vt;break e}rn=Ve.return}}if(Cr=H,oc(),Qc&&typeof Qc.onPostCommitFiberRoot=="function")try{Qc.onPostCommitFiberRoot(jp,m)}catch{}L=!0}return L}finally{dr=M,Ti.transition=y}}return!1}function Fy(m,y,M){y=Su(M,y),y=gf(m,y,1),fa(m,y),y=Pi(),m=gs(m,1),m!==null&&(Ju(m,1,y),to(m,y))}function Ga(m,y,M){if(m.tag===3)Fy(m,m,M);else for(;y!==null;){if(y.tag===3){Fy(y,m,M);break}else if(y.tag===1){var L=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof L.componentDidCatch=="function"&&(Wl===null||!Wl.has(L))){m=Su(M,m),m=eh(y,m,1),fa(y,m),m=Pi(),y=gs(y,1),y!==null&&(Ju(y,1,m),to(y,m));break}}y=y.return}}function uS(m,y,M){var L=m.pingCache;L!==null&&L.delete(y),y=Pi(),m.pingedLanes|=m.suspendedLanes&M,fs===m&&(Vs&M)===M&&(ms===4||ms===3&&(Vs&130023424)===Vs&&500>Tr()-Zg?Hi(m,0):fm|=M),to(m,y)}function hh(m,y){y===0&&(m.mode&1?(y=zd,zd<<=1,!(zd&130023424)&&(zd=4194304)):y=1);var M=Pi();m=gs(m,y),m!==null&&(Ju(m,y,M),to(m,M))}function Df(m){var y=m.memoizedState,M=0;y!==null&&(M=y.retryLane),hh(m,M)}function vm(m,y){var M=0;switch(m.tag){case 13:var L=m.stateNode,H=m.memoizedState;H!==null&&(M=H.retryLane);break;case 19:L=m.stateNode;break;default:throw Error(o(314))}L!==null&&L.delete(y),hh(m,M)}var By;By=function(m,y,M){if(m!==null)if(m.memoizedProps!==y.pendingProps||Wi.current)Va=!0;else{if(!(m.lanes&M)&&!(y.flags&128))return Va=!1,Ly(m,y,M);Va=!!(m.flags&131072)}else Va=!1,mi&&y.flags&1048576&&Gp(y,Pg,y.index);switch(y.lanes=0,y.tag){case 2:var L=y.type;m!==null&&(m.alternate=null,y.alternate=null,y.flags|=2),m=y.pendingProps;var H=Fs(y,on.current);Ks(y,M),H=ff(null,y,L,m,H,M);var ee=pe();return y.flags|=1,typeof H=="object"&&H!==null&&typeof H.render=="function"&&H.$$typeof===void 0?(y.tag=1,y.memoizedState=null,y.updateQueue=null,Qn(L)?(ee=!0,Ro(y)):ee=!1,y.memoizedState=H.state!==null&&H.state!==void 0?H.state:null,As(y),H.updater=qr,y.stateNode=H,H._reactInternals=y,Wd(y,L,m,M),y=H_(null,y,L,!0,ee,M)):(y.tag=0,mi&&ee&&nd(y),Wo(null,y,H,M),y=y.child),y;case 16:L=y.elementType;e:{switch(m!==null&&(m.alternate=null,y.alternate=null,y.flags|=2),m=y.pendingProps,H=L._init,L=H(L._payload),y.type=L,H=y.tag=fh(L),m=oi(L,m),H){case 0:y=xr(null,y,L,m,M);break e;case 1:y=im(null,y,L,m,M);break e;case 11:y=j_(null,y,L,m,M);break e;case 14:y=Gg(null,y,L,oi(L.type,m),M);break e}throw Error(o(306,L,""))}return y;case 0:return L=y.type,H=y.pendingProps,H=y.elementType===L?H:oi(L,H),xr(m,y,L,H,M);case 1:return L=y.type,H=y.pendingProps,H=y.elementType===L?H:oi(L,H),im(m,y,L,H,M);case 3:e:{if(bf(y),m===null)throw Error(o(387));L=y.pendingProps,ee=y.memoizedState,H=ee.element,Ms(m,y),et(y,L,null,M);var xe=y.memoizedState;if(L=xe.element,nt&&ee.isDehydrated)if(ee={element:L,isDehydrated:!1,cache:xe.cache,transitions:xe.transitions},y.updateQueue.baseState=ee,y.memoizedState=ee,y.flags&256){H=Error(o(423)),y=od(m,y,L,M,H);break e}else if(L!==H){H=Error(o(424)),y=od(m,y,L,M,H);break e}else for(nt&&(Vo=hi(y.stateNode.containerInfo),cc=y,mi=!0,Ic=null,Mc=!1),M=Yp(y,null,L,M),y.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(lc(),L===H){y=ga(m,y,M);break e}Wo(m,y,L,M)}y=y.child}return y;case 5:return uc(y),m===null&&_u(y),L=y.type,H=y.pendingProps,ee=m!==null?m.memoizedProps:null,xe=H.children,Pe(L,H)?xe=null:ee!==null&&Pe(L,ee)&&(y.flags|=32),Wg(m,y),Wo(m,y,xe,M),y.child;case 6:return m===null&&_u(y),null;case 13:return Ko(m,y,M);case 4:return ds(y,y.stateNode.containerInfo),L=y.pendingProps,m===null?y.child=uo(y,null,L,M):Wo(m,y,L,M),y.child;case 11:return L=y.type,H=y.pendingProps,H=y.elementType===L?H:oi(L,H),j_(m,y,L,H,M);case 7:return Wo(m,y,y.pendingProps,M),y.child;case 8:return Wo(m,y,y.pendingProps.children,M),y.child;case 12:return Wo(m,y,y.pendingProps.children,M),y.child;case 10:e:{if(L=y.type._context,H=y.pendingProps,ee=y.memoizedProps,xe=H.value,ky(y,L,xe),ee!==null)if(Bl(ee.value,xe)){if(ee.children===H.children&&!Wi.current){y=ga(m,y,M);break e}}else for(ee=y.child,ee!==null&&(ee.return=y);ee!==null;){var Ve=ee.dependencies;if(Ve!==null){xe=ee.child;for(var bt=Ve.firstContext;bt!==null;){if(bt.context===L){if(ee.tag===1){bt=el(-1,M&-M),bt.tag=2;var Wt=ee.updateQueue;if(Wt!==null){Wt=Wt.shared;var fn=Wt.pending;fn===null?bt.next=bt:(bt.next=fn.next,fn.next=bt),Wt.pending=bt}}ee.lanes|=M,bt=ee.alternate,bt!==null&&(bt.lanes|=M),qd(ee.return,M,y),Ve.lanes|=M;break}bt=bt.next}}else if(ee.tag===10)xe=ee.type===y.type?null:ee.child;else if(ee.tag===18){if(xe=ee.return,xe===null)throw Error(o(341));xe.lanes|=M,Ve=xe.alternate,Ve!==null&&(Ve.lanes|=M),qd(xe,M,y),xe=ee.sibling}else xe=ee.child;if(xe!==null)xe.return=ee;else for(xe=ee;xe!==null;){if(xe===y){xe=null;break}if(ee=xe.sibling,ee!==null){ee.return=xe.return,xe=ee;break}xe=xe.return}ee=xe}Wo(m,y,H.children,M),y=y.child}return y;case 9:return H=y.type,L=y.pendingProps.children,Ks(y,M),H=Yi(H),L=L(H),y.flags|=1,Wo(m,y,L,M),y.child;case 14:return L=y.type,H=oi(L,y.pendingProps),H=oi(L.type,H),Gg(m,y,L,H,M);case 15:return $_(m,y,y.type,y.pendingProps,M);case 17:return L=y.type,H=y.pendingProps,H=y.elementType===L?H:oi(L,H),m!==null&&(m.alternate=null,y.alternate=null,y.flags|=2),y.tag=1,Qn(L)?(m=!0,Ro(y)):m=!1,Ks(y,M),tl(y,L,H),Wd(y,L,H,M),H_(null,y,L,!0,m,M);case 19:return Tu(m,y,M);case 22:return qg(m,y,M)}throw Error(o(156,y.tag))};function jy(m,y){return Mg(m,y)}function dS(m,y,M,L){this.tag=m,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=L,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(m,y,M,L){return new dS(m,y,M,L)}function vc(m){return m=m.prototype,!(!m||!m.isReactComponent)}function fh(m){if(typeof m=="function")return vc(m)?1:0;if(m!=null){if(m=m.$$typeof,m===g)return 11;if(m===T)return 14}return 2}function Qo(m,y){var M=m.alternate;return M===null?(M=vs(m.tag,y,m.key,m.mode),M.elementType=m.elementType,M.type=m.type,M.stateNode=m.stateNode,M.alternate=m,m.alternate=M):(M.pendingProps=y,M.type=m.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=m.flags&14680064,M.childLanes=m.childLanes,M.lanes=m.lanes,M.child=m.child,M.memoizedProps=m.memoizedProps,M.memoizedState=m.memoizedState,M.updateQueue=m.updateQueue,y=m.dependencies,M.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},M.sibling=m.sibling,M.index=m.index,M.ref=m.ref,M}function Kl(m,y,M,L,H,ee){var xe=2;if(L=m,typeof m=="function")vc(m)&&(xe=1);else if(typeof m=="string")xe=5;else e:switch(m){case u:return ya(M.children,H,ee,y);case d:xe=8,H|=8;break;case h:return m=vs(12,M,y,H|2),m.elementType=h,m.lanes=ee,m;case v:return m=vs(13,M,y,H),m.elementType=v,m.lanes=ee,m;case E:return m=vs(19,M,y,H),m.elementType=E,m.lanes=ee,m;case A:return Vi(M,H,ee,y);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case f:xe=10;break e;case p:xe=9;break e;case g:xe=11;break e;case T:xe=14;break e;case C:xe=16,L=null;break e}throw Error(o(130,m==null?m:typeof m,""))}return y=vs(xe,M,y,H),y.elementType=m,y.type=L,y.lanes=ee,y}function ya(m,y,M,L){return m=vs(7,m,L,y),m.lanes=M,m}function Vi(m,y,M,L){return m=vs(22,m,L,y),m.elementType=A,m.lanes=M,m.stateNode={},m}function Oo(m,y,M){return m=vs(6,m,null,y),m.lanes=M,m}function _m(m,y,M){return y=vs(4,m.children!==null?m.children:[],m.key,y),y.lanes=M,y.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},y}function nv(m,y,M,L,H){this.tag=y,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=_t,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fp(0),this.expirationTimes=Fp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fp(0),this.identifierPrefix=L,this.onRecoverableError=H,nt&&(this.mutableSourceEagerHydrationData=null)}function K_(m,y,M,L,H,ee,xe,Ve,bt){return m=new nv(m,y,M,Ve,bt),y===1?(y=1,ee===!0&&(y|=8)):y=0,ee=vs(3,null,null,y),m.current=ee,ee.stateNode=m,ee.memoizedState={element:L,isDehydrated:M,cache:null,transitions:null},As(ee),m}function $y(m){if(!m)return Er;m=m._reactInternals;e:{if(F(m)!==m||m.tag!==1)throw Error(o(170));var y=m;do{switch(y.tag){case 3:y=y.stateNode.context;break e;case 1:if(Qn(y.type)){y=y.stateNode.__reactInternalMemoizedMergedChildContext;break e}}y=y.return}while(y!==null);throw Error(o(171))}if(m.tag===1){var M=m.type;if(Qn(M))return Si(m,M,y)}return y}function Y_(m){var y=m._reactInternals;if(y===void 0)throw typeof m.render=="function"?Error(o(188)):(m=Object.keys(m).join(","),Error(o(268,m)));return m=q(y),m===null?null:m.stateNode}function ym(m,y){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var M=m.retryLane;m.retryLane=M!==0&&M<y?M:y}}function rv(m,y){ym(m,y),(m=m.alternate)&&ym(m,y)}function hS(m){return m=q(m),m===null?null:m.stateNode}function bm(){return null}return n.attemptContinuousHydration=function(m){if(m.tag===13){var y=Pi();va(m,134217728,y),rv(m,134217728)}},n.attemptHydrationAtCurrentPriority=function(m){if(m.tag===13){var y=Pi(),M=gc(m);va(m,M,y),rv(m,M)}},n.attemptSynchronousHydration=function(m){switch(m.tag){case 3:var y=m.stateNode;if(y.current.memoizedState.isDehydrated){var M=Ho(y.pendingLanes);M!==0&&(af(y,M|1),to(y,Tr()),!(Cr&6)&&(Ii(),oc()))}break;case 13:var L=Pi();no(function(){return va(m,1,L)}),rv(m,1)}},n.batchedUpdates=function(m,y){var M=Cr;Cr|=1;try{return m(y)}finally{Cr=M,Cr===0&&(Ii(),$p&&oc())}},n.createComponentSelector=function(m){return{$$typeof:oh,value:m}},n.createContainer=function(m,y,M,L,H,ee,xe){return K_(m,y,!1,null,M,L,H,ee,xe)},n.createHasPseudoClassSelector=function(m){return{$$typeof:Cf,value:m}},n.createHydrationContainer=function(m,y,M,L,H,ee,xe,Ve,bt){return m=K_(M,L,!0,m,H,ee,xe,Ve,bt),m.context=$y(null),M=m.current,L=Pi(),H=gc(M),ee=el(L,H),ee.callback=y??null,fa(M,ee),m.current.lanes=H,Ju(m,H,L),to(m,L),m},n.createPortal=function(m,y,M){var L=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:L==null?null:""+L,children:m,containerInfo:y,implementation:M}},n.createRoleSelector=function(m){return{$$typeof:ah,value:m}},n.createTestNameSelector=function(m){return{$$typeof:um,value:m}},n.createTextSelector=function(m){return{$$typeof:ch,value:m}},n.deferredUpdates=function(m){var y=dr,M=Ti.transition;try{return Ti.transition=null,dr=16,m()}finally{dr=y,Ti.transition=M}},n.discreteUpdates=function(m,y,M,L,H){var ee=dr,xe=Ti.transition;try{return Ti.transition=null,dr=1,m(y,M,L,H)}finally{dr=ee,Ti.transition=xe,Cr===0&&Ii()}},n.findAllNodes=pc,n.findBoundingRects=function(m,y){if(!Ft)throw Error(o(363));y=pc(m,y),m=[];for(var M=0;M<y.length;M++)m.push(le(y[M]));for(y=m.length-1;0<y;y--){M=m[y];for(var L=M.x,H=L+M.width,ee=M.y,xe=ee+M.height,Ve=y-1;0<=Ve;Ve--)if(y!==Ve){var bt=m[Ve],Wt=bt.x,fn=Wt+bt.width,mr=bt.y,gn=mr+bt.height;if(L>=Wt&&ee>=mr&&H<=fn&&xe<=gn){m.splice(y,1);break}else if(L!==Wt||M.width!==bt.width||gn<ee||mr>xe){if(!(ee!==mr||M.height!==bt.height||fn<L||Wt>H)){Wt>L&&(bt.width+=Wt-L,bt.x=L),fn<H&&(bt.width=H-Wt),m.splice(y,1);break}}else{mr>ee&&(bt.height+=mr-ee,bt.y=ee),gn<xe&&(bt.height=xe-mr),m.splice(y,1);break}}}return m},n.findHostInstance=Y_,n.findHostInstanceWithNoPortals=function(m){return m=X(m),m=m!==null?K(m):null,m===null?null:m.stateNode},n.findHostInstanceWithWarning=function(m){return Y_(m)},n.flushControlled=function(m){var y=Cr;Cr|=1;var M=Ti.transition,L=dr;try{Ti.transition=null,dr=1,m()}finally{dr=L,Ti.transition=M,Cr=y,Cr===0&&(Ii(),oc())}},n.flushPassiveEffects=Ir,n.flushSync=no,n.focusWithin=function(m,y){if(!Ft)throw Error(o(363));for(m=Af(m),y=fc(m,y),y=Array.from(y),m=0;m<y.length;){var M=y[m++];if(!it(M)){if(M.tag===5&&Fe(M.stateNode))return!0;for(M=M.child;M!==null;)y.push(M),M=M.sibling}}return!1},n.getCurrentUpdatePriority=function(){return dr},n.getFindAllNodesFailureDescription=function(m,y){if(!Ft)throw Error(o(363));var M=0,L=[];m=[Af(m),0];for(var H=0;H<m.length;){var ee=m[H++],xe=m[H++],Ve=y[xe];if((ee.tag!==5||!it(ee))&&(q_(ee,Ve)&&(L.push(dm(Ve)),xe++,xe>M&&(M=xe)),xe<y.length))for(ee=ee.child;ee!==null;)m.push(ee,xe),ee=ee.sibling}if(M<y.length){for(m=[];M<y.length;M++)m.push(dm(y[M]));return`findAllNodes was able to match part of the selector:
  `+(L.join(" > ")+`

No matching component was found for:
  `)+m.join(" > ")}return null},n.getPublicRootInstance=function(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 5:return Q(m.child.stateNode);default:return m.child.stateNode}},n.injectIntoDevTools=function(m){if(m={bundleType:m.bundleType,version:m.version,rendererPackageName:m.rendererPackageName,rendererConfig:m.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:hS,findFiberByHostInstance:m.findFiberByHostInstance||bm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")m=!1;else{var y=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(y.isDisabled||!y.supportsFiber)m=!0;else{try{jp=y.inject(m),Qc=y}catch{}m=!!y.checkDCE}}return m},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(m,y,M,L){if(!Ft)throw Error(o(363));m=pc(m,y);var H=Ht(m,M,L).disconnect;return{disconnect:function(){H()}}},n.registerMutableSourceForHydration=function(m,y){var M=y._getVersion;M=M(y._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[y,M]:m.mutableSourceEagerHydrationData.push(y,M)},n.runWithPriority=function(m,y){var M=dr;try{return dr=m,y()}finally{dr=M}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(m,y,M,L){var H=y.current,ee=Pi(),xe=gc(H);return M=$y(M),y.context===null?y.context=M:y.pendingContext=M,y=el(ee,xe),y.payload={element:m},L=L===void 0?null:L,L!==null&&(y.callback=L),fa(H,y),m=va(H,xe,ee),m!==null&&ed(m,H,xe),xe},n};q8.exports=fce;var pce=q8.exports;const mce=Yc(pce),nF={},Y8=t=>void Object.assign(nF,t);function gce(t,e){function n(u,{args:d=[],attach:h,...f},p){let g=`${u[0].toUpperCase()}${u.slice(1)}`,v;if(u==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const E=f.object;v=bb(E,{type:u,root:p,attach:h,primitive:!0})}else{const E=nF[g];if(!E)throw new Error(`R3F: ${g} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(d))throw new Error("R3F: The args prop must be an array!");v=bb(new E(...d),{type:u,root:p,attach:h,memoizedProps:{args:d}})}return v.__r3f.attach===void 0&&(v instanceof qh?v.__r3f.attach="geometry":v instanceof fg&&(v.__r3f.attach="material")),g!=="inject"&&IN(v,f),v}function r(u,d){let h=!1;if(d){var f,p;(f=d.__r3f)!=null&&f.attach?MN(u,d,d.__r3f.attach):d.isObject3D&&u.isObject3D&&(u.add(d),h=!0),h||(p=u.__r3f)==null||p.objects.push(d),d.__r3f||bb(d,{}),d.__r3f.parent=u,hL(d),Eb(d)}}function i(u,d,h){let f=!1;if(d){var p,g;if((p=d.__r3f)!=null&&p.attach)MN(u,d,d.__r3f.attach);else if(d.isObject3D&&u.isObject3D){d.parent=u,d.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:d});const v=u.children.filter(T=>T!==d),E=v.indexOf(h);u.children=[...v.slice(0,E),d,...v.slice(E)],f=!0}f||(g=u.__r3f)==null||g.objects.push(d),d.__r3f||bb(d,{}),d.__r3f.parent=u,hL(d),Eb(d)}}function s(u,d,h=!1){u&&[...u].forEach(f=>o(d,f,h))}function o(u,d,h){if(d){var f,p,g;if(d.__r3f&&(d.__r3f.parent=null),(f=u.__r3f)!=null&&f.objects&&(u.__r3f.objects=u.__r3f.objects.filter(A=>A!==d)),(p=d.__r3f)!=null&&p.attach)Kj(u,d,d.__r3f.attach);else if(d.isObject3D&&u.isObject3D){var v;u.remove(d),(v=d.__r3f)!=null&&v.root&&xce(s1(d),d)}const T=(g=d.__r3f)==null?void 0:g.primitive,C=!T&&(h===void 0?d.dispose!==null:h);if(!T){var E;s((E=d.__r3f)==null?void 0:E.objects,d,C),s(d.children,d,C)}if(delete d.__r3f,C&&d.dispose&&d.type!=="Scene"){const A=()=>{try{d.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?uL.unstable_scheduleCallback(uL.unstable_IdlePriority,A):A()}Eb(u)}}function a(u,d,h,f){var p;const g=(p=u.__r3f)==null?void 0:p.parent;if(!g)return;const v=n(d,h,u.__r3f.root);if(u.children){for(const E of u.children)E.__r3f&&r(v,E);u.children=u.children.filter(E=>!E.__r3f)}u.__r3f.objects.forEach(E=>r(v,E)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||o(g,u),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),r(g,v),v.raycast&&v.__r3f.eventCount&&s1(v).getState().internal.interaction.push(v),[f,f.alternate].forEach(E=>{E!==null&&(E.stateNode=v,E.ref&&(typeof E.ref=="function"?E.ref(v):E.ref.current=v))})}const c=()=>{};return{reconciler:mce({createInstance:n,removeChild:o,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,d)=>{if(!d)return;const h=u.getState().scene;h.__r3f&&(h.__r3f.root=u,r(h,d))},removeChildFromContainer:(u,d)=>{d&&o(u.getState().scene,d)},insertInContainerBefore:(u,d,h)=>{if(!d||!h)return;const f=u.getState().scene;f.__r3f&&i(f,d,h)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var d;return!!((d=u==null?void 0:u.__r3f)!=null?d:{}).handlers},prepareUpdate(u,d,h,f){var p;if(((p=u==null?void 0:u.__r3f)!=null?p:{}).primitive&&f.object&&f.object!==u)return[!0];{const{args:v=[],children:E,...T}=f,{args:C=[],children:A,...k}=h;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((N,U)=>N!==C[U]))return[!0];const I=eG(u,T,k,!0);return I.changes.length?[!1,I]:null}},commitUpdate(u,[d,h],f,p,g,v){d?a(u,f,g,v):IN(u,h)},commitMount(u,d,h,f){var p;const g=(p=u.__r3f)!=null?p:{};u.raycast&&g.handlers&&g.eventCount&&s1(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>bb(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var d;const{attach:h,parent:f}=(d=u.__r3f)!=null?d:{};h&&f&&Kj(f,u,h),u.isObject3D&&(u.visible=!1),Eb(u)},unhideInstance(u,d){var h;const{attach:f,parent:p}=(h=u.__r3f)!=null?h:{};f&&p&&MN(p,u,f),(u.isObject3D&&d.visible==null||d.visible)&&(u.visible=!0),Eb(u)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>e?e():Ob.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Ss.fun(performance.now)?performance.now:Ss.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Ss.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Ss.fun(clearTimeout)?clearTimeout:void 0}),applyProps:IN}}var zj,Gj;const AN=t=>"colorSpace"in t||"outputColorSpace"in t,X8=()=>{var t;return(t=nF.ColorManagement)!=null?t:null},J8=t=>t&&t.isOrthographicCamera,CA=typeof window<"u"&&((zj=window.document)!=null&&zj.createElement||((Gj=window.navigator)==null?void 0:Gj.product)==="ReactNative")?ft.useLayoutEffect:ft.useEffect;function vce(t){const e=ft.useRef(t);return CA(()=>void(e.current=t),[t]),e}class _ce extends ft.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}_ce.getDerivedStateFromError=()=>({error:!0});const Q8="__default",qj=new Map,yce=t=>t&&!!t.memoized&&!!t.changes;function Z8(t){var e;const n=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],n),t[1]):t}const vS=t=>{var e;return(e=t.__r3f)==null?void 0:e.root.getState()};function s1(t){let e=t.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const Ss={obj:t=>t===Object(t)&&!Ss.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,arr:t=>Array.isArray(t),equ(t,e,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(Ss.str(t)||Ss.num(t)||Ss.boo(t))return t===e;const s=Ss.obj(t);if(s&&r==="reference")return t===e;const o=Ss.arr(t);if(o&&n==="reference")return t===e;if((o||s)&&t===e)return!0;let a;for(a in t)if(!(a in e))return!1;if(s&&n==="shallow"&&r==="shallow"){for(a in i?e:t)if(!Ss.equ(t[a],e[a],{strict:i,objects:"reference"}))return!1}else for(a in i?e:t)if(t[a]!==e[a])return!1;if(Ss.und(a)){if(o&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function bce(t){const e={nodes:{},materials:{}};return t&&t.traverse(n=>{n.name&&(e.nodes[n.name]=n),n.material&&!e.materials[n.material.name]&&(e.materials[n.material.name]=n.material)}),e}function Ece(t){t.dispose&&t.type!=="Scene"&&t.dispose();for(const e in t)e.dispose==null||e.dispose(),delete t[e]}function bb(t,e){const n=t;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},t}function dL(t,e){let n=t;if(e.includes("-")){const r=e.split("-"),i=r.pop();return n=r.reduce((s,o)=>s[o],t),{target:n,key:i}}else return{target:n,key:e}}const Wj=/-\d+$/;function MN(t,e,n){if(Ss.str(n)){if(Wj.test(n)){const s=n.replace(Wj,""),{target:o,key:a}=dL(t,s);Array.isArray(o[a])||(o[a]=[])}const{target:r,key:i}=dL(t,n);e.__r3f.previousAttach=r[i],r[i]=e}else e.__r3f.previousAttach=n(t,e)}function Kj(t,e,n){var r,i;if(Ss.str(n)){const{target:s,key:o}=dL(t,n),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(t,e);(i=e.__r3f)==null||delete i.previousAttach}function eG(t,{children:e,key:n,ref:r,...i},{children:s,key:o,ref:a,...c}={},l=!1){const u=t.__r3f,d=Object.entries(i),h=[];if(l){const p=Object.keys(c);for(let g=0;g<p.length;g++)i.hasOwnProperty(p[g])||d.unshift([p[g],Q8+"remove"])}d.forEach(([p,g])=>{var v;if((v=t.__r3f)!=null&&v.primitive&&p==="object"||Ss.equ(g,c[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return h.push([p,g,!0,[]]);let E=[];p.includes("-")&&(E=p.split("-")),h.push([p,g,!1,E]);for(const T in i){const C=i[T];T.startsWith(`${p}-`)&&h.push([T,C,!1,T.split("-")])}});const f={...i};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(f.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(f.attach=u.memoizedProps.attach),{memoized:f,changes:h}}const Sce=typeof Hn<"u"&&!1;function IN(t,e){var n;const r=t.__r3f,i=r==null?void 0:r.root,s=i==null||i.getState==null?void 0:i.getState(),{memoized:o,changes:a}=yce(e)?e:eG(t,e),c=r==null?void 0:r.eventCount;t.__r3f&&(t.__r3f.memoizedProps=o);for(let u=0;u<a.length;u++){let[d,h,f,p]=a[u];if(AN(t)){const T="srgb",C="srgb-linear";d==="encoding"?(d="colorSpace",h=h===3001?T:C):d==="outputEncoding"&&(d="outputColorSpace",h=h===3001?T:C)}let g=t,v=g[d];if(p.length&&(v=p.reduce((E,T)=>E[T],t),!(v&&v.set))){const[E,...T]=p.reverse();g=T.reverse().reduce((C,A)=>C[A],t),d=E}if(h===Q8+"remove")if(g.constructor){let E=qj.get(g.constructor);E||(E=new g.constructor,qj.set(g.constructor,E)),h=E[d]}else h=0;if(f&&r)h?r.handlers[d]=h:delete r.handlers[d],r.eventCount=Object.keys(r.handlers).length;else if(v&&v.set&&(v.copy||v instanceof qb)){if(Array.isArray(h))v.fromArray?v.fromArray(h):v.set(...h);else if(v.copy&&h&&h.constructor&&(Sce?v.constructor.name===h.constructor.name:v.constructor===h.constructor))v.copy(h);else if(h!==void 0){const E=v instanceof bi;!E&&v.setScalar?v.setScalar(h):v instanceof qb&&h instanceof qb?v.mask=h.mask:v.set(h),!X8()&&s&&!s.linear&&E&&v.convertSRGBToLinear()}}else if(g[d]=h,g[d]instanceof wo&&g[d].format===Cd&&g[d].type===Gc&&s){const E=g[d];AN(E)&&AN(s.gl)?E.colorSpace=s.gl.outputColorSpace:E.encoding=s.gl.outputEncoding}Eb(t)}if(r&&r.parent&&t.raycast&&c!==r.eventCount){const u=s1(t).getState().internal,d=u.interaction.indexOf(t);d>-1&&u.interaction.splice(d,1),r.eventCount&&u.interaction.push(t)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(n=t.__r3f)!=null&&n.parent&&hL(t),t}function Eb(t){var e,n;const r=(e=t.__r3f)==null||(n=e.root)==null||n.getState==null?void 0:n.getState();r&&r.internal.frames===0&&r.invalidate()}function hL(t){t.onUpdate==null||t.onUpdate(t)}function wce(t,e){t.manual||(J8(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function nC(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function Tce(){var t;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return Ob.DefaultEventPriority;switch((t=e.event)==null?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Ob.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Ob.ContinuousEventPriority;default:return Ob.DefaultEventPriority}}function tG(t,e,n,r){const i=n.get(e);i&&(n.delete(e),n.size===0&&(t.delete(r),i.target.releasePointerCapture(r)))}function xce(t,e){const{internal:n}=t.getState();n.interaction=n.interaction.filter(r=>r!==e),n.initialHits=n.initialHits.filter(r=>r!==e),n.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&n.hovered.delete(i)}),n.capturedMap.forEach((r,i)=>{tG(n.capturedMap,e,r,i)})}function Cce(t){function e(c){const{internal:l}=t.getState(),u=c.offsetX-l.initialClick[0],d=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+d*d))}function n(c){return c.filter(l=>["Move","Over","Enter","Out","Leave"].some(u=>{var d;return(d=l.__r3f)==null?void 0:d.handlers["onPointer"+u]}))}function r(c,l){const u=t.getState(),d=new Set,h=[],f=l?l(u.internal.interaction):u.internal.interaction;for(let E=0;E<f.length;E++){const T=vS(f[E]);T&&(T.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(c,u);function p(E){const T=vS(E);if(!T||!T.events.enabled||T.raycaster.camera===null)return[];if(T.raycaster.camera===void 0){var C;T.events.compute==null||T.events.compute(c,T,(C=T.previousRoot)==null?void 0:C.getState()),T.raycaster.camera===void 0&&(T.raycaster.camera=null)}return T.raycaster.camera?T.raycaster.intersectObject(E,!0):[]}let g=f.flatMap(p).sort((E,T)=>{const C=vS(E.object),A=vS(T.object);return!C||!A?E.distance-T.distance:A.events.priority-C.events.priority||E.distance-T.distance}).filter(E=>{const T=nC(E);return d.has(T)?!1:(d.add(T),!0)});u.events.filter&&(g=u.events.filter(g,u));for(const E of g){let T=E.object;for(;T;){var v;(v=T.__r3f)!=null&&v.eventCount&&h.push({...E,eventObject:T}),T=T.parent}}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(let E of u.internal.capturedMap.get(c.pointerId).values())d.has(nC(E.intersection))||h.push(E.intersection);return h}function i(c,l,u,d){const h=t.getState();if(c.length){const f={stopped:!1};for(const p of c){const g=vS(p.object)||h,{raycaster:v,pointer:E,camera:T,internal:C}=g,A=new ht(E.x,E.y,0).unproject(T),k=$=>{var X,q;return(X=(q=C.capturedMap.get($))==null?void 0:q.has(p.eventObject))!=null?X:!1},I=$=>{const X={intersection:p,target:l.target};C.capturedMap.has($)?C.capturedMap.get($).set(p.eventObject,X):C.capturedMap.set($,new Map([[p.eventObject,X]])),l.target.setPointerCapture($)},N=$=>{const X=C.capturedMap.get($);X&&tG(C.capturedMap,p.eventObject,X,$)};let U={};for(let $ in l){let X=l[$];typeof X!="function"&&(U[$]=X)}let F={...p,...U,pointer:E,intersections:c,stopped:f.stopped,delta:u,unprojectedPoint:A,ray:v.ray,camera:T,stopPropagation(){const $="pointerId"in l&&C.capturedMap.get(l.pointerId);if((!$||$.has(p.eventObject))&&(F.stopped=f.stopped=!0,C.hovered.size&&Array.from(C.hovered.values()).find(X=>X.eventObject===p.eventObject))){const X=c.slice(0,c.indexOf(p));s([...X,p])}},target:{hasPointerCapture:k,setPointerCapture:I,releasePointerCapture:N},currentTarget:{hasPointerCapture:k,setPointerCapture:I,releasePointerCapture:N},nativeEvent:l};if(d(F),f.stopped===!0)break}}return c}function s(c){const{internal:l}=t.getState();for(const u of l.hovered.values())if(!c.length||!c.find(d=>d.object===u.object&&d.index===u.index&&d.instanceId===u.instanceId)){const h=u.eventObject.__r3f,f=h==null?void 0:h.handlers;if(l.hovered.delete(nC(u)),h!=null&&h.eventCount){const p={...u,intersections:c};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function o(c,l){for(let u=0;u<l.length;u++){const d=l[u].__r3f;d==null||d.handlers.onPointerMissed==null||d.handlers.onPointerMissed(c)}}function a(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return l=>{const{internal:u}=t.getState();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))})}}return function(u){const{onPointerMissed:d,internal:h}=t.getState();h.lastEvent.current=u;const f=c==="onPointerMove",p=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",v=r(u,f?n:void 0),E=p?e(u):0;c==="onPointerDown"&&(h.initialClick=[u.offsetX,u.offsetY],h.initialHits=v.map(C=>C.eventObject)),p&&!v.length&&E<=2&&(o(u,h.interaction),d&&d(u)),f&&s(v);function T(C){const A=C.eventObject,k=A.__r3f,I=k==null?void 0:k.handlers;if(k!=null&&k.eventCount)if(f){if(I.onPointerOver||I.onPointerEnter||I.onPointerOut||I.onPointerLeave){const N=nC(C),U=h.hovered.get(N);U?U.stopped&&C.stopPropagation():(h.hovered.set(N,C),I.onPointerOver==null||I.onPointerOver(C),I.onPointerEnter==null||I.onPointerEnter(C))}I.onPointerMove==null||I.onPointerMove(C)}else{const N=I[c];N?(!p||h.initialHits.includes(A))&&(o(u,h.interaction.filter(U=>!h.initialHits.includes(U))),N(C)):p&&h.initialHits.includes(A)&&o(u,h.interaction.filter(U=>!h.initialHits.includes(U)))}}i(v,u,E,T)}}return{handlePointer:a}}const nG=t=>!!(t!=null&&t.render),rG=ft.createContext(null),Rce=(t,e)=>{const n=cce((a,c)=>{const l=new ht,u=new ht,d=new ht;function h(E=c().camera,T=u,C=c().size){const{width:A,height:k,top:I,left:N}=C,U=A/k;T instanceof ht?d.copy(T):d.set(...T);const F=E.getWorldPosition(l).distanceTo(d);if(J8(E))return{width:A/E.zoom,height:k/E.zoom,top:I,left:N,factor:1,distance:F,aspect:U};{const $=E.fov*Math.PI/180,X=2*Math.tan($/2)*F,q=X*(A/k);return{width:q,height:X,top:I,left:N,factor:A/q,distance:F,aspect:U}}}let f;const p=E=>a(T=>({performance:{...T.performance,current:E}})),g=new Vn;return{set:a,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(E=1)=>t(c(),E),advance:(E,T)=>e(E,T,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new rce,pointer:g,mouse:g,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const E=c();f&&clearTimeout(f),E.performance.current!==E.performance.min&&p(E.performance.min),f=setTimeout(()=>p(c().performance.max),E.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:h},setEvents:E=>a(T=>({...T,events:{...T.events,...E}})),setSize:(E,T,C,A,k)=>{const I=c().camera,N={width:E,height:T,top:A||0,left:k||0,updateStyle:C};a(U=>({size:N,viewport:{...U.viewport,...h(I,u,N)}}))},setDpr:E=>a(T=>{const C=Z8(E);return{viewport:{...T.viewport,dpr:C,initialDpr:T.viewport.initialDpr||C}}}),setFrameloop:(E="always")=>{const T=c().clock;T.stop(),T.elapsedTime=0,E!=="never"&&(T.start(),T.elapsedTime=0),a(()=>({frameloop:E}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:ft.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(E,T,C)=>{const A=c().internal;return A.priority=A.priority+(T>0?1:0),A.subscribers.push({ref:E,priority:T,store:C}),A.subscribers=A.subscribers.sort((k,I)=>k.priority-I.priority),()=>{const k=c().internal;k!=null&&k.subscribers&&(k.priority=k.priority-(T>0?1:0),k.subscribers=k.subscribers.filter(I=>I.ref!==E))}}}}}),r=n.getState();let i=r.size,s=r.viewport.dpr,o=r.camera;return n.subscribe(()=>{const{camera:a,size:c,viewport:l,gl:u,set:d}=n.getState();if(c.width!==i.width||c.height!==i.height||l.dpr!==s){var h;i=c,s=l.dpr,wce(a,c),u.setPixelRatio(l.dpr);const f=(h=c.updateStyle)!=null?h:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(c.width,c.height,f)}a!==o&&(o=a,d(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(a)}})))}),n.subscribe(a=>t(a)),n};function iG(t,e){const n={callback:t};return e.add(n),()=>void e.delete(n)}let rC,sG=new Set,oG=new Set,Ace=new Set;const Mce=t=>iG(t,sG),Ice=t=>iG(t,oG);function ON(t,e){if(t.size)for(const{callback:n}of t.values())n(e)}function _S(t,e){switch(t){case"before":return ON(sG,e);case"after":return ON(oG,e);case"tail":return ON(Ace,e)}}let kN,NN;function PN(t,e,n){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),kN=e.internal.subscribers,rC=0;rC<kN.length;rC++)NN=kN[rC],NN.ref.current(NN.store.getState(),r,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function Oce(t){let e=!1,n=!1,r,i,s;function o(l){i=requestAnimationFrame(o),e=!0,r=0,_S("before",l),n=!0;for(const d of t.values()){var u;s=d.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(r+=PN(l,s))}if(n=!1,_S("after",l),r===0)return _S("tail",l),e=!1,cancelAnimationFrame(i)}function a(l,u=1){var d;if(!l)return t.forEach(h=>a(h.store.getState(),u));(d=l.gl.xr)!=null&&d.isPresenting||!l.internal.active||l.frameloop==="never"||(u>1?l.internal.frames=Math.min(60,l.internal.frames+u):n?l.internal.frames=2:l.internal.frames=1,e||(e=!0,requestAnimationFrame(o)))}function c(l,u=!0,d,h){if(u&&_S("before",l),d)PN(l,d,h);else for(const f of t.values())PN(l,f.store.getState());u&&_S("after",l)}return{loop:o,invalidate:a,advance:c}}function kce(t){const e=ft.useRef(null);return CA(()=>void(e.current=t.current.__r3f),[t]),e}function aG(){const t=ft.useContext(rG);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function KE(t=n=>n,e){return aG()(t,e)}function uT(t,e=0){const n=aG(),r=n.getState().internal.subscribe,i=vce(t);return CA(()=>r(i,e,n),[e,r,n]),null}const Yj=new WeakMap;function cG(t,e){return function(n,...r){let i=Yj.get(n);return i||(i=new n,Yj.set(n,i)),t&&t(i),Promise.all(r.map(s=>new Promise((o,a)=>i.load(s,c=>{c.scene&&Object.assign(c,bce(c.scene)),o(c)},e,c=>a(new Error(`Could not load ${s}: ${c==null?void 0:c.message}`))))))}}function dT(t,e,n,r){const i=Array.isArray(e)?e:[e],s=uce(cG(n,r),[t,...i],{equal:Ss.equ});return Array.isArray(e)?s:s[0]}dT.preload=function(t,e,n){const r=Array.isArray(e)?e:[e];return dce(cG(n),[t,...r])};dT.clear=function(t,e){const n=Array.isArray(e)?e:[e];return hce([t,...n])};const hE=new Map,{invalidate:Xj,advance:Jj}=Oce(hE),{reconciler:Y1,applyProps:sb}=gce(hE,Tce),ob={objects:"shallow",strict:!1},Nce=(t,e)=>{const n=typeof t=="function"?t(e):t;return nG(n)?n:new Yae({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...t})};function Pce(t,e){const n=typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement;if(e){const{width:r,height:i,top:s,left:o,updateStyle:a=n}=e;return{width:r,height:i,top:s,left:o,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:r,height:i,top:s,left:o}=t.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:o,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Dce(t){const e=hE.get(t),n=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||Rce(Xj,Jj),o=n||Y1.createContainer(s,Ob.ConcurrentRoot,null,!1,null,"",i,null);e||hE.set(t,{fiber:o,store:s});let a,c=!1,l;return{configure(u={}){let{gl:d,size:h,scene:f,events:p,onCreated:g,shadows:v=!1,linear:E=!1,flat:T=!1,legacy:C=!1,orthographic:A=!1,frameloop:k="always",dpr:I=[1,2],performance:N,raycaster:U,camera:F,onPointerMissed:$}=u,X=s.getState(),q=X.gl;X.gl||X.set({gl:q=Nce(d,t)});let W=X.raycaster;W||X.set({raycaster:W=new ice});const{params:K,...ne}=U||{};if(Ss.equ(ne,W,ob)||sb(W,{...ne}),Ss.equ(K,W.params,ob)||sb(W,{params:{...W.params,...K}}),!X.camera||X.camera===l&&!Ss.equ(l,F,ob)){l=F;const se=F instanceof TA,ue=se?F:A?new JU(0,0,0,0,.1,1e3):new Lu(75,0,.1,1e3);se||(ue.position.z=5,F&&(sb(ue,F),("aspect"in F||"left"in F||"right"in F||"bottom"in F||"top"in F)&&(ue.manual=!0,ue.updateProjectionMatrix())),!X.camera&&!(F!=null&&F.rotation)&&ue.lookAt(0,0,0)),X.set({camera:ue}),W.camera=ue}if(!X.scene){let se;f instanceof K1?se=f:(se=new K1,f&&sb(se,f)),X.set({scene:bb(se)})}if(!X.xr){var Q;const se=(Be,Se)=>{const Pe=s.getState();Pe.frameloop!=="never"&&Jj(Be,!0,Pe,Se)},ue=()=>{const Be=s.getState();Be.gl.xr.enabled=Be.gl.xr.isPresenting,Be.gl.xr.setAnimationLoop(Be.gl.xr.isPresenting?se:null),Be.gl.xr.isPresenting||Xj(Be)},Ae={connect(){const Be=s.getState().gl;Be.xr.addEventListener("sessionstart",ue),Be.xr.addEventListener("sessionend",ue)},disconnect(){const Be=s.getState().gl;Be.xr.removeEventListener("sessionstart",ue),Be.xr.removeEventListener("sessionend",ue)}};typeof((Q=q.xr)==null?void 0:Q.addEventListener)=="function"&&Ae.connect(),X.set({xr:Ae})}if(q.shadowMap){const se=q.shadowMap.enabled,ue=q.shadowMap.type;if(q.shadowMap.enabled=!!v,Ss.boo(v))q.shadowMap.type=QC;else if(Ss.str(v)){var ie;const Ae={basic:Ute,percentage:HU,soft:QC,variance:zf};q.shadowMap.type=(ie=Ae[v])!=null?ie:QC}else Ss.obj(v)&&Object.assign(q.shadowMap,v);(se!==q.shadowMap.enabled||ue!==q.shadowMap.type)&&(q.shadowMap.needsUpdate=!0)}const G=X8();G&&("enabled"in G?G.enabled=!C:"legacyMode"in G&&(G.legacyMode=C)),c||sb(q,{outputEncoding:E?3e3:3001,toneMapping:T?ap:p8}),X.legacy!==C&&X.set(()=>({legacy:C})),X.linear!==E&&X.set(()=>({linear:E})),X.flat!==T&&X.set(()=>({flat:T})),d&&!Ss.fun(d)&&!nG(d)&&!Ss.equ(d,q,ob)&&sb(q,d),p&&!X.events.handlers&&X.set({events:p(s)});const Z=Pce(t,h);return Ss.equ(Z,X.size,ob)||X.setSize(Z.width,Z.height,Z.updateStyle,Z.top,Z.left),I&&X.viewport.dpr!==Z8(I)&&X.setDpr(I),X.frameloop!==k&&X.setFrameloop(k),X.onPointerMissed||X.set({onPointerMissed:$}),N&&!Ss.equ(N,X.performance,ob)&&X.set(se=>({performance:{...se.performance,...N}})),a=g,c=!0,this},render(u){return c||this.configure(),Y1.updateContainer(Ne.jsx(Lce,{store:s,children:u,onCreated:a,rootElement:t}),o,null,()=>{}),s},unmount(){Uce(t)}}}function Lce({store:t,children:e,onCreated:n,rootElement:r}){return CA(()=>{const i=t.getState();i.set(s=>({internal:{...s.internal,active:!0}})),n&&n(i),t.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),Ne.jsx(rG.Provider,{value:t,children:e})}function Uce(t,e){const n=hE.get(t),r=n==null?void 0:n.fiber;if(r){const i=n==null?void 0:n.store.getState();i&&(i.internal.active=!1),Y1.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,o,a,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),Ece(i),hE.delete(t)}catch{}},500)})}}Y1.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:ft.version});const DN={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Fce(t){const{handlePointer:e}=Cce(t);return{priority:1,enabled:!0,compute(n,r,i){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(DN).reduce((n,r)=>({...n,[r]:e(r)}),{}),update:()=>{var n;const{events:r,internal:i}=t.getState();(n=i.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:n=>{var r;const{set:i,events:s}=t.getState();s.disconnect==null||s.disconnect(),i(o=>({events:{...o.events,connected:n}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([o,a])=>{const[c,l]=DN[o];n.addEventListener(c,a,{passive:l})})},disconnect:()=>{const{set:n,events:r}=t.getState();if(r.connected){var i;Object.entries((i=r.handlers)!=null?i:[]).forEach(([s,o])=>{if(r&&r.connected instanceof HTMLElement){const[a]=DN[s];r.connected.removeEventListener(a,o)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}var rF={exports:{}};function lG(t,e=100,n={}){if(typeof t!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof t}\`.`);if(e<0)throw new RangeError("`wait` must not be negative.");const{immediate:r}=typeof n=="boolean"?{immediate:n}:n;let i,s,o,a,c;function l(){const h=i,f=s;return i=void 0,s=void 0,c=t.apply(h,f),c}function u(){const h=Date.now()-a;h<e&&h>=0?o=setTimeout(u,e-h):(o=void 0,r||(c=l()))}const d=function(...h){if(i&&this!==i&&Object.getPrototypeOf(this)===Object.getPrototypeOf(i))throw new Error("Debounced method called with different contexts of the same prototype.");i=this,s=h,a=Date.now();const f=r&&!o;return o||(o=setTimeout(u,e)),f&&(c=l()),c};return Object.defineProperty(d,"isPending",{get(){return o!==void 0}}),d.clear=()=>{o&&(clearTimeout(o),o=void 0)},d.flush=()=>{o&&d.trigger()},d.trigger=()=>{c=l(),d.clear()},d}rF.exports.debounce=lG;rF.exports=lG;var Bce=rF.exports;const jce=Yc(Bce);/*! unmute-ios-audio. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var $ce=Hce;const Qj=["auxclick","click","contextmenu","dblclick","keydown","keyup","mousedown","mouseup","touchend"];function Hce(){const t=window.webkitAudioContext;if(!(navigator.maxTouchPoints>0&&t!=null))return;let n="blocked",r="blocked",i,s,o;const a=new t().sampleRate,c=l(a);Qj.forEach(p=>{window.addEventListener(p,u,{capture:!0,passive:!0})});function l(p){const g=new ArrayBuffer(10),v=new DataView(g);return v.setUint32(0,p,!0),v.setUint32(4,p,!0),v.setUint16(8,1,!0),`data:audio/wav;base64,UklGRisAAABXQVZFZm10IBAAAAABAAEA${window.btoa(String.fromCharCode(...new Uint8Array(g))).slice(0,13)}AgAZGF0YQcAAACAgICAgICAAAA=`}function u(p){n==="blocked"&&(n="pending",d()),r==="blocked"&&(r="pending",h())}function d(){i=document.createElement("audio"),i.setAttribute("x-webkit-airplay","deny"),i.preload="auto",i.loop=!0,i.src=c,i.load(),i.play().then(()=>{n="allowed",f()},()=>{n="blocked",i.pause(),i.removeAttribute("src"),i.load(),i=null})}function h(){s=new t,o=s.createBufferSource(),o.buffer=s.createBuffer(1,1,22050),o.connect(s.destination),o.start(),s.state==="running"?(r="allowed",f()):(r="blocked",o.disconnect(s.destination),o=null,s.close(),s=null)}function f(){n!=="allowed"||r!=="allowed"||Qj.forEach(p=>{window.removeEventListener(p,u,{capture:!0,passive:!0})})}}const Vce=Yc($ce);var uG={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(xc,function(){return n.importState=function(i){var s=new n;return s.importState(i),s},n;function n(){return function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var d=function(){var h=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=h-(c=h|0)};return d.next=d,d.uint32=function(){return d()*4294967296},d.fract53=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.version="Alea 0.9",d.args=i,d.exportState=function(){return[s,o,a,c]},d.importState=function(h){s=+h[0]||0,o=+h[1]||0,a=+h[2]||0,c=+h[3]||0},d}(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(uG);var zce=uG.exports;const dG=Yc(zce);new Vn;new Vn;function xi(t,e,n){return Math.max(e,Math.min(n,t))}function Gce(t){return t/180*Math.PI}function hG(t){return t*180/Math.PI}const qce=dG("089fad0j9awfem09wavefc09uwaef");function Zj(t){return 2*Math.floor(t/2)}function RA(t,e){return Math.round(t/e)*e}function Wce(){return qce()}function Kce(t){return dG(t)()}function Fv(t,e){const n=Math.min(t,e),i=Math.max(t,e)-n+1;return n+Math.floor(Wce()*i)}function fG(t,e,n){const r=Math.min(e,n),s=Math.max(e,n)-r+1;return r+Math.floor(Kce(t)*s)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var Yce=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},t(e,n)};return function(e,n){t(e,n);function r(){this.constructor=e}e.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xce=Object.prototype.hasOwnProperty;function fL(t,e){return Xce.call(t,e)}function pL(t){if(Array.isArray(t)){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=""+n;return e}if(Object.keys)return Object.keys(t);var r=[];for(var i in t)fL(t,i)&&r.push(i);return r}function eu(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function mL(t){for(var e=0,n=t.length,r;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function g0(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function pG(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function gL(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++)if(gL(t[e]))return!0}else if(typeof t=="object"){for(var r=pL(t),i=r.length,s=0;s<i;s++)if(gL(t[r[s]]))return!0}}return!1}function e$(t,e){var n=[t];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var mG=function(t){Yce(e,t);function e(n,r,i,s,o){var a=this.constructor,c=t.call(this,e$(n,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=e$(n,{name:r,index:i,operation:s,tree:o}),c}return e}(Error),_o=mG,Jce=eu,kb={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){var r=X1(n,this.path);r&&(r=eu(r));var i=P0(n,{op:"remove",path:this.from}).removed;return P0(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(t,e,n){var r=X1(n,this.from);return P0(n,{op:"add",path:this.path,value:eu(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:gw(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}},Qce={add:function(t,e,n){return mL(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:kb.move,copy:kb.copy,test:kb.test,_get:kb._get};function X1(t,e){if(e=="")return t;var n={op:"_get",path:e};return P0(t,n),n.value}function P0(t,e,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(e,0,t,e.path):J1(e,0)),e.path===""){var o={newDocument:t};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=t,o;if(e.op==="move"||e.op==="copy")return o.newDocument=X1(t,e.from),e.op==="move"&&(o.removed=t),o;if(e.op==="test"){if(o.test=gw(t,e.value),o.test===!1)throw new _o("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o.newDocument=t,o}else{if(e.op==="remove")return o.removed=t,o.newDocument=null,o;if(e.op==="_get")return e.value=t,o;if(n)throw new _o("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return o}}else{r||(t=eu(t));var a=e.path||"",c=a.split("/"),l=t,u=1,d=c.length,h=void 0,f=void 0,p=void 0;for(typeof n=="function"?p=n:p=J1;;){if(f=c[u],f&&f.indexOf("~")!=-1&&(f=pG(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&h===void 0&&(l[f]===void 0?h=c.slice(0,u).join("/"):u==d-1&&(h=e.path),h!==void 0&&p(e,0,t,h)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!mL(f))throw new _o("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);mL(f)&&(f=~~f)}if(u>=d){if(n&&e.op==="add"&&f>l.length)throw new _o("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);var o=Qce[e.op].call(e,l,f,t);if(o.test===!1)throw new _o("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}}else if(u>=d){var o=kb[e.op].call(e,l,f,t);if(o.test===!1)throw new _o("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return o}if(l=l[f],n&&u<d&&(!l||typeof l!="object"))throw new _o("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function AA(t,e,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(e))throw new _o("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=eu(t));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=P0(t,e[o],n,!0,i,o),t=s[o].newDocument;return s.newDocument=t,s}function Zce(t,e,n){var r=P0(t,e);if(r.test===!1)throw new _o("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function J1(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new _o("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(kb[t.op]){if(typeof t.path!="string")throw new _o("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new _o('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new _o("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new _o("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&gL(t.value))throw new _o("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var i=t.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new _o("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new _o("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:void 0},a=iF([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new _o("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new _o("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function iF(t,e,n){try{if(!Array.isArray(t))throw new _o("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)AA(eu(e),eu(t),n||!0);else{n=n||J1;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(i){if(i instanceof _o)return i;throw i}}function gw(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),i,s,o;if(n&&r){if(s=t.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!gw(t[i],e[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(t);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!gw(t[o],e[o]))return!1;return!0}return t!==t&&e!==e}const ele=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:_o,_areEquals:gw,applyOperation:P0,applyPatch:AA,applyReducer:Zce,deepClone:Jce,getValueByPointer:X1,validate:iF,validator:J1},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var sF=new WeakMap,tle=function(){function t(e){this.observers=new Map,this.obj=e}return t}(),nle=function(){function t(e,n){this.callback=e,this.observer=n}return t}();function rle(t){return sF.get(t)}function ile(t,e){return t.observers.get(e)}function sle(t,e){t.observers.delete(e.callback)}function ole(t,e){e.unobserve()}function ale(t,e){var n=[],r,i=rle(t);if(!i)i=new tle(t),sF.set(t,i);else{var s=ile(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=eu(t),e){r.callback=e,r.next=null;var o=function(){vL(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=t,r.unobserve=function(){vL(r),clearTimeout(r.next),sle(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new nle(e,r)),r}function vL(t,e){e===void 0&&(e=!1);var n=sF.get(t.object);oF(n.value,t.object,t.patches,"",e),t.patches.length&&AA(n.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function oF(t,e,n,r,i){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=pL(e),o=pL(t),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=t[l];if(fL(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var d=e[l];typeof u=="object"&&u!=null&&typeof d=="object"&&d!=null&&Array.isArray(u)===Array.isArray(d)?oF(u,d,n,r+"/"+g0(l),i):u!==d&&(i&&n.push({op:"test",path:r+"/"+g0(l),value:eu(u)}),n.push({op:"replace",path:r+"/"+g0(l),value:eu(d)}))}else Array.isArray(t)===Array.isArray(e)?(i&&n.push({op:"test",path:r+"/"+g0(l),value:eu(u)}),n.push({op:"remove",path:r+"/"+g0(l)}),a=!0):(i&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!fL(t,l)&&e[l]!==void 0&&n.push({op:"add",path:r+"/"+g0(l),value:eu(e[l])})}}}function cle(t,e,n){n===void 0&&(n=!1);var r=[];return oF(t,e,r,"",n),r}const lle=Object.freeze(Object.defineProperty({__proto__:null,compare:cle,generate:vL,observe:ale,unobserve:ole},Symbol.toStringTag,{value:"Module"}));Object.assign({},ele,lle,{JsonPatchError:mG,deepClone:eu,escapePathComponent:g0,unescapePathComponent:pG});var ule=typeof Element<"u",dle=typeof Map=="function",hle=typeof Set=="function",fle=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function o1(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!o1(t[r],e[r]))return!1;return!0}var s;if(dle&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;for(s=t.entries();!(r=s.next()).done;)if(!o1(r.value[1],e.get(r.value[0])))return!1;return!0}if(hle&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(r=s.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(fle&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(ule&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&t.$$typeof)&&!o1(t[i[r]],e[i[r]]))return!1;return!0}return t!==t&&e!==e}var ple=function(e,n){try{return o1(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const ZS=Yc(ple);function he(t){return t!=null}const mle=Object.fromEntries,gG=Object.keys;function $c(t){return eu(t)}function gle(t){return typeof t=="boolean"}function Mn(t){return typeof t=="number"&&isNaN(t)===!1}function Yn(t){return typeof t=="string"}function Lr(t){return Array.isArray(t)}function Sl(t){return t}function vle(t){return he(t)&&typeof t=="object"&&Yn(t.id)&&Yn(t.target)&&Yn(t.sender)}function ci(t,e,n,r){const i=r??"";return t.emit(`error:${e}`,n,i),Fle(t,n,i)}function _le(t,e,n){t.emit("broadcast:startstream",e,n)}function yle(t,e){t.emit("broadcast:stopstream",void 0,e)}function ble(t,e,n){t.emit("chat:connect",e,n)}function Ele(t,e){t.emit("chat:disconnect",void 0,e)}function Sle(t,e){t.emit("gadgetserver:desync",void 0,e)}function wle(t,e){t.emit("gadgetserver:clearscroll",void 0,e)}function Tle(t,e,n,r,i,s,o){t.emit("network:fetch",[e,n,r,i,s],o)}function xle(t,e,n){t.emit("network:join",e,n)}function Cle(t,e,n){t.emit("network:start",e,n)}function Rle(t,e,n,r){t.emit("network:showjoincode",[e,n],r)}function Ale(t,e){t.emit("register:dev",void 0,e)}function Mle(t,e){t.emit("register:share",void 0,e)}function Ile(t,e){t.emit("register:nuke",void 0,e)}function Ole(t,e){t.emit("synth:audioenabled",void 0,e)}function kle(t,e,n){t.emit("synth:tts",[e,n])}function Nle(t,e){t.emit("synth:tta",[e])}function Tv(t,e,n){t.emit("synth:play",[e,n])}function Ple(t,e){t.emit("synth:bpm",e)}function t$(t,e){t.emit("synth:mainvolume",e)}function n$(t,e){t.emit("synth:drumvolume",e)}function r$(t,e){t.emit("synth:ttsvolume",e)}function LN(t,e,n,r){t.emit("synth:voice",[e,n,r])}function Dle(t,e,n,r,i){t.emit("synth:voicefx",[e,n,r,i])}function Fh(t,...e){return t.emit("tape:info",e),!0}function Lle(t,...e){return t.emit("tape:debug",e),!0}function Ule(t,e,n){t.emit("tape:inspector",e,n)}function Fle(t,...e){return t.emit("tape:error",e),!1}function Ble(t,e){t.emit("tape:terminal:open",void 0,e)}function jle(t,e){t.emit("tape:terminal:quickopen",void 0,e)}function Q1(t,e){t.emit("tape:terminal:close",void 0,e)}function $le(t,e){t.emit("tape:terminal:toggle",void 0,e)}function vG(t,e,n){t.emit("tape:terminal:inclayout",e,n)}function _G(t,e){t.emit("tape:crash",void 0,e)}function Hle(t,e,n,r,i,s){t.emit("tape:editor:open",[e,n,r,i],s)}function Vle(t,e){t.emit("tape:editor:close",void 0,e)}function zle(t,e){t.emit("vm:operator",void 0,e)}function Gle(t,e,n){t.emit("vm:halt",e,n)}function qle(t,e,n,r){t.emit("vm:books",[e,n],r)}function Wle(t,e){t.emit("vm:login",void 0,e)}function Kle(t,e){t.emit("vm:logout",void 0,e)}function Yle(t,e){t.emit("vm:doot",void 0,e)}function Xle(t,e,n,r){t.emit("vm:input",[e,n],r)}function Jle(t,e,n,r){t.emit("vm:inspect",[e,n],r)}function yG(t,e){return`${t}:${e.join(":")}`}function Qle(t,e,n,r){t.emit("vm:codewatch",[e,n],r)}function Zle(t,e,n,r){t.emit("vm:coderelease",[e,n],r)}function fE(t,e,n){t.emit("vm:cli",e,n)}function eue(t,e){t.emit("vm:restart",void 0,e)}function tue(t,e){t.emit("vm:synthsend",e)}function nue(t,e){t.emit("vm:flush",void 0,e)}function rue(t,e){t.emit("vm:fork",void 0,e)}function iue(t,e){return{filename:t,cursor:0,lines:e.split(`
`)}}function sue(t,e){return{filename:t,json:e}}function oue(t,e){return{filename:t,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function Xm(t,e,n,r,i,s){let o;switch(n){case"file":o=i;break;case"text":o=iue(r,i);break;case"json":o=sue(r,i);break;case"binary":o=oue(r,i);break}setTimeout(()=>{t.emit("vm:loader",[e,n,r,o],s)},1)}function aF(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function aue(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=aF(n);return(i,s)=>r.then(o=>s(o.transaction(e,i).objectStore(e)))}let UN;function bG(){return UN||(UN=aue("keyval-store","keyval")),UN}function cue(t,e=bG()){return e("readonly",n=>aF(n.get(t)))}function lue(t,e,n=bG()){return n("readwrite",r=>new Promise((i,s)=>{r.get(t).onsuccess=function(){try{r.put(e(this.result),t),i(aF(r.transaction))}catch(o){s(o)}}}))}const FN=new Set,vw={emit(t,e,n,r,i){vw.invoke(RG(t,e,n,r,i))},invoke(t){switch(t.target){}FN.forEach(e=>e.handle(t))},connect(t){FN.add(t)},disconnect(t){FN.delete(t)}};var EG={};(function(t){var e=xc&&xc.__spreadArray||function(l,u,d){if(d||arguments.length===2)for(var h=0,f=u.length,p;h<f;h++)(p||!(h in u))&&(p||(p=Array.prototype.slice.call(u,0,h)),p[h]=u[h]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(t,"__esModule",{value:!0}),t.minLength=t.maxLength=t.poolSize=t.humanId=t.adverbs=t.verbs=t.nouns=t.adjectives=void 0,t.adjectives=["afraid","all","angry","beige","big","better","bitter","blue","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","crazy","cruel","cuddly","curly","curvy","cute","common","cold","cool","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","evil","fair","famous","fast","fancy","few","fine","fifty","five","flat","fluffy","floppy","forty","four","free","fresh","fruity","full","funny","fuzzy","gentle","giant","gold","good","great","green","grumpy","happy","heavy","hip","honest","hot","huge","hungry","icy","itchy","khaki","kind","large","late","lazy","lemon","legal","light","little","long","loose","loud","lovely","lucky","major","many","mean","metal","mighty","modern","moody","nasty","neat","new","nice","nine","ninety","odd","old","olive","open","orange","pink","plain","plenty","polite","poor","pretty","proud","public","puny","petite","purple","quick","quiet","rare","real","ready","red","rich","ripe","rotten","rude","sad","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","spicy","spotty","stale","strong","stupid","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","warm","weak","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],t.nouns=["apes","animals","areas","bars","banks","baths","breads","bushes","cloths","clowns","clubs","hoops","loops","memes","papers","parks","paths","showers","sides","signs","sites","streets","teeth","tires","webs","actors","ads","adults","aliens","ants","apples","baboons","badgers","bags","bananas","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","brooms","buckets","bugs","buses","buttons","camels","cases","cameras","candies","candles","carpets","carrots","carrots","cars","cats","chairs","chefs","chicken","clocks","clouds","coats","cobras","coins","corners","colts","comics","cooks","cougars","regions","results","cows","crabs","crabs","crews","cups","cities","cycles","dancers","days","deer","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","ducks","eagles","ears","eels","eggs","ends","mammals","emus","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lines","lions","lizards","llamas","mails","mangos","maps","masks","meals","melons","mice","mirrors","moments","moles","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","parents","parts","parrots","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","rice","rings","rivers","rockets","rocks","rooms","roses","rules","schools","bats","seals","seas","sheep","shirts","shoes","shrimps","singers","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stars","states","steaks","wings","suits","suns","swans","symbols","tables","taxes","taxis","teams","terms","things","ties","tigers","times","tips","toes","towns","tools","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","walls","wasps","waves","ways","weeks","windows","wolves","women","wombats","words","worlds","worms","yaks","years","zebras","zoos"],t.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enter","enjoy","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","like","lie","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","play","poke","post","press","prove","pull","pump","pick","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","see","search","sell","send","serve","shake","share","shave","shine","show","shop","shout","sin","sink","sing","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","start","stay","stick","stop","stare","study","strive","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],t.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowlingly","lazily","oddly","mysteriously","noisily","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function n(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,d){return u.length>d.length?u:d})}function i(l){return l.reduce(function(u,d){return u.length<d.length?u:d})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,d=u===void 0?"":u,h=l.capitalize,f=h===void 0?!0:h,p=l.adjectiveCount,g=p===void 0?1:p,v=l.addAdverb,E=v===void 0?!1:v,T=e(e(e([],e([],Array(g),!0).map(function(C){return n(t.adjectives)}),!0),[n(t.nouns),n(t.verbs)],!1),E?[n(t.adverbs)]:[],!0);return f&&(T=T.map(function(C){return C.charAt(0).toUpperCase()+C.substr(1)})),T.join(d)}t.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,h=l.addAdverb,f=h===void 0?!1:h;return t.adjectives.length*d*t.nouns.length*t.verbs.length*(f?t.adverbs.length:1)}t.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,h=l.addAdverb,f=h===void 0?!1:h,p=l.separator,g=p===void 0?"":p;return r(t.adjectives).length*d+d*g.length+r(t.nouns).length+g.length+r(t.verbs).length+(f?r(t.adverbs).length+g.length:0)}t.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,d=u===void 0?1:u,h=l.addAdverb,f=h===void 0?!1:h,p=l.separator,g=p===void 0?"":p;return i(t.adjectives).length*d+d*g.length+i(t.nouns).length+g.length+i(t.verbs).length+(f?i(t.adverbs).length+g.length:0)}t.minLength=c,t.default=s})(EG);const uue=Yc(EG),due="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let hue=t=>crypto.getRandomValues(new Uint8Array(t)),fue=(t,e,n)=>{let r=(2<<Math.log2(t.length-1))-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let a=n(i),c=i;for(;c--;)if(o+=t[a[c]&r]||"",o.length===s)return o}}},SG=(t,e=21)=>fue(t,e,hue),pue=(t=21)=>{let e="",n=crypto.getRandomValues(new Uint8Array(t));for(;t--;)e+=due[n[t]&63];return e};var wG="abcdefghijklmnopqrstuvwxyz",TG="ABCDEFGHIJKLMNOPQRSTUVWXYZ",xG="0123456789",mue="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz",gue="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz";const vue=xG,_ue=wG,yue=TG;var bue=vue+_ue+yue,_L={lowercase:wG,uppercase:TG,numbers:xG,nolookalikes:mue,nolookalikesSafe:gue,alphanumeric:bue};function Po(){return`sid_${pue(12).replaceAll("-",".")}`}const Eue=SG(_L.numbers,4),Sue=SG(`${_L.numbers}${_L.lowercase}`,16);function wue(){return`pid_${Eue()}_${Sue()}`}function CG(t){return(t==null?void 0:t.startsWith("pid_"))??!1}function Tue(){return uue({capitalize:!1,adjectiveCount:1})}var cr=(t=>(t[t.BLACK=0]="BLACK",t[t.DKBLUE=1]="DKBLUE",t[t.DKGREEN=2]="DKGREEN",t[t.DKCYAN=3]="DKCYAN",t[t.DKRED=4]="DKRED",t[t.DKPURPLE=5]="DKPURPLE",t[t.DKYELLOW=6]="DKYELLOW",t[t.LTGRAY=7]="LTGRAY",t[t.DKGRAY=8]="DKGRAY",t[t.BLUE=9]="BLUE",t[t.GREEN=10]="GREEN",t[t.CYAN=11]="CYAN",t[t.RED=12]="RED",t[t.PURPLE=13]="PURPLE",t[t.YELLOW=14]="YELLOW",t[t.WHITE=15]="WHITE",t[t.ONBLACK=16]="ONBLACK",t[t.ONDKBLUE=17]="ONDKBLUE",t[t.ONDKGREEN=18]="ONDKGREEN",t[t.ONDKCYAN=19]="ONDKCYAN",t[t.ONDKRED=20]="ONDKRED",t[t.ONDKPURPLE=21]="ONDKPURPLE",t[t.ONDKYELLOW=22]="ONDKYELLOW",t[t.ONLTGRAY=23]="ONLTGRAY",t[t.ONDKGRAY=24]="ONDKGRAY",t[t.ONBLUE=25]="ONBLUE",t[t.ONGREEN=26]="ONGREEN",t[t.ONCYAN=27]="ONCYAN",t[t.ONRED=28]="ONRED",t[t.ONPURPLE=29]="ONPURPLE",t[t.ONYELLOW=30]="ONYELLOW",t[t.ONWHITE=31]="ONWHITE",t[t.ONCLEAR=32]="ONCLEAR",t))(cr||{}),Gi=(t=>(t[t.ISWALK=0]="ISWALK",t[t.ISSOLID=1]="ISSOLID",t[t.ISSWIM=2]="ISSWIM",t[t.ISBULLET=3]="ISBULLET",t))(Gi||{}),z0=(t=>(t[t.ISTERRAIN=0]="ISTERRAIN",t[t.ISOBJECT=1]="ISOBJECT",t))(z0||{}),pn=(t=>(t[t.IDLE=0]="IDLE",t[t.NORTH=1]="NORTH",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST",t[t.EAST=4]="EAST",t[t.BY=5]="BY",t[t.AT=6]="AT",t[t.FLOW=7]="FLOW",t[t.SEEK=8]="SEEK",t[t.RNDNS=9]="RNDNS",t[t.RNDNE=10]="RNDNE",t[t.RND=11]="RND",t[t.CW=12]="CW",t[t.CCW=13]="CCW",t[t.OPP=14]="OPP",t[t.RNDP=15]="RNDP",t))(pn||{}),wn=(t=>(t[t.LOADER=0]="LOADER",t[t.BOARD=1]="BOARD",t[t.OBJECT=2]="OBJECT",t[t.TERRAIN=3]="TERRAIN",t[t.CHARSET=4]="CHARSET",t[t.PALETTE=5]="PALETTE",t[t.CONST=6]="CONST",t[t.RANGE=7]="RANGE",t[t.SELECT=8]="SELECT",t[t.NUMBER=9]="NUMBER",t[t.TEXT=10]="TEXT",t[t.LINK=11]="LINK",t[t.HOTKEY=12]="HOTKEY",t[t.COPYIT=13]="COPYIT",t[t.OPENIT=14]="OPENIT",t[t.ZSSEDIT=15]="ZSSEDIT",t[t.CHAREDIT=16]="CHAREDIT",t[t.COLOREDIT=17]="COLOREDIT",t))(wn||{});function rr(t){return t.toLowerCase().trim()}function RG(t,e,n,r,i){return{session:t,id:Po(),target:e,sender:n,data:r,player:i}}function MA(t){const[e,...n]=t.split(":");return{target:e,path:n.join(":")}}function Wh(t,e=[],n=Sl,r=""){const i=Po(),s=rr(t),o=e.map(rr);let a=r;const c={id(){return i},name(){return t},session(l){return he(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,d){vw.emit(a,l,i,u,d)},reply(l,u,d,h){c.emit(`${l.sender}:${u}`,d,h)},replynext(l,u,d,h){setTimeout(()=>c.emit(`${l.sender}:${u}`,d,h),64)},handle(l){const{target:u,path:d}=MA(l.target),h=rr(u);!a&&h==="ready"&&(a=l.session),h==="bridge"&&he(l.session)&&(a=l.session),o.findIndex(f=>f==="all"||f===h)!==-1&&n(l),(i===u||h==="all"||s===h)&&n({...l,target:d})}};return vw.connect(c),c}const IA=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,129,165,129,129,189,153,129,126,0,0,0,0,0,126,255,219,255,255,195,231,255,126,0,0,0,0,0,0,108,254,254,254,254,124,56,16,0,0,0,0,0,0,16,56,124,254,124,56,16,0,0,0,0,0,0,24,60,60,231,231,231,24,24,60,0,0,0,0,0,24,60,126,255,255,126,24,24,60,0,0,0,0,0,0,0,0,24,60,60,24,0,0,0,0,0,255,255,255,255,255,231,195,195,231,255,255,255,255,255,0,0,0,0,60,102,66,66,102,60,0,0,0,0,255,255,255,255,195,153,189,189,153,195,255,255,255,255,0,0,30,14,26,50,120,204,204,204,120,0,0,0,0,0,60,102,102,102,60,24,126,24,24,0,0,0,0,0,63,51,63,48,48,48,112,240,224,0,0,0,0,0,127,99,127,99,99,99,103,231,230,192,0,0,0,0,24,24,219,60,231,60,219,24,24,0,0,0,0,0,128,192,224,248,254,248,224,192,128,0,0,0,0,0,2,6,14,62,254,62,14,6,2,0,0,0,0,0,24,60,126,24,24,24,126,60,24,0,0,0,0,0,102,102,102,102,102,102,0,102,102,0,0,0,0,0,127,219,219,219,123,27,27,27,27,0,0,0,0,124,198,96,56,108,198,198,108,56,12,198,124,0,0,0,0,0,0,0,0,0,254,254,254,0,0,0,0,0,24,60,126,24,24,24,126,60,24,126,0,0,0,0,24,60,126,24,24,24,24,24,24,0,0,0,0,0,24,24,24,24,24,24,126,60,24,0,0,0,0,0,0,0,24,12,254,12,24,0,0,0,0,0,0,0,0,0,48,96,254,96,48,0,0,0,0,0,0,0,0,0,0,192,192,192,254,0,0,0,0,0,0,0,0,0,40,108,254,108,40,0,0,0,0,0,0,0,0,16,56,56,124,124,254,254,0,0,0,0,0,0,0,254,254,124,124,56,56,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,24,0,0,0,0,102,102,102,36,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,108,108,254,108,108,0,0,0,24,24,124,198,194,192,124,6,134,198,124,24,24,0,0,0,0,0,194,198,12,24,48,102,198,0,0,0,0,0,56,108,108,56,118,220,204,204,118,0,0,0,0,48,48,48,96,0,0,0,0,0,0,0,0,0,0,0,12,24,48,48,48,48,48,24,12,0,0,0,0,0,48,24,12,12,12,12,12,24,48,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,24,24,126,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,48,0,0,0,0,0,0,0,0,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,2,6,12,24,48,96,192,128,0,0,0,0,0,0,124,198,206,222,246,230,198,198,124,0,0,0,0,0,24,56,120,24,24,24,24,24,126,0,0,0,0,0,124,198,6,12,24,48,96,198,254,0,0,0,0,0,124,198,6,6,60,6,6,198,124,0,0,0,0,0,12,28,60,108,204,254,12,12,30,0,0,0,0,0,254,192,192,192,252,6,6,198,124,0,0,0,0,0,56,96,192,192,252,198,198,198,124,0,0,0,0,0,254,198,6,12,24,48,48,48,48,0,0,0,0,0,124,198,198,198,124,198,198,198,124,0,0,0,0,0,124,198,198,198,126,6,6,12,120,0,0,0,0,0,0,24,24,0,0,0,24,24,0,0,0,0,0,0,0,24,24,0,0,0,24,24,48,0,0,0,0,0,6,12,24,48,96,48,24,12,6,0,0,0,0,0,0,0,0,126,0,0,126,0,0,0,0,0,0,0,96,48,24,12,6,12,24,48,96,0,0,0,0,0,124,198,198,12,24,24,0,24,24,0,0,0,0,0,124,198,198,222,222,222,220,192,124,0,0,0,0,0,16,56,108,198,198,254,198,198,198,0,0,0,0,0,252,102,102,102,124,102,102,102,252,0,0,0,0,0,60,102,194,192,192,192,194,102,60,0,0,0,0,0,248,108,102,102,102,102,102,108,248,0,0,0,0,0,254,102,98,104,120,104,98,102,254,0,0,0,0,0,254,102,98,104,120,104,96,96,240,0,0,0,0,0,60,102,194,192,192,222,198,102,58,0,0,0,0,0,198,198,198,198,254,198,198,198,198,0,0,0,0,0,60,24,24,24,24,24,24,24,60,0,0,0,0,0,30,12,12,12,12,12,204,204,120,0,0,0,0,0,230,102,108,108,120,108,108,102,230,0,0,0,0,0,240,96,96,96,96,96,98,102,254,0,0,0,0,0,198,238,254,254,214,198,198,198,198,0,0,0,0,0,198,230,246,254,222,206,198,198,198,0,0,0,0,0,56,108,198,198,198,198,198,108,56,0,0,0,0,0,252,102,102,102,124,96,96,96,240,0,0,0,0,0,124,198,198,198,198,214,222,124,12,14,0,0,0,0,252,102,102,102,124,108,102,102,230,0,0,0,0,0,124,198,198,96,56,12,198,198,124,0,0,0,0,0,126,126,90,24,24,24,24,24,60,0,0,0,0,0,198,198,198,198,198,198,198,198,124,0,0,0,0,0,198,198,198,198,198,198,108,56,16,0,0,0,0,0,198,198,198,198,214,214,254,124,108,0,0,0,0,0,198,198,108,56,56,56,108,198,198,0,0,0,0,0,102,102,102,102,60,24,24,24,60,0,0,0,0,0,254,198,140,24,48,96,194,198,254,0,0,0,0,0,60,48,48,48,48,48,48,48,60,0,0,0,0,0,128,192,224,112,56,28,14,6,2,0,0,0,0,0,60,12,12,12,12,12,12,12,60,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,12,124,204,204,118,0,0,0,0,0,224,96,96,120,108,102,102,102,124,0,0,0,0,0,0,0,0,124,198,192,192,198,124,0,0,0,0,0,28,12,12,60,108,204,204,204,118,0,0,0,0,0,0,0,0,124,198,254,192,198,124,0,0,0,0,0,56,108,100,96,240,96,96,96,240,0,0,0,0,0,0,0,0,118,204,204,204,124,12,204,120,0,0,0,224,96,96,108,118,102,102,102,230,0,0,0,0,0,24,24,0,56,24,24,24,24,60,0,0,0,0,0,6,6,0,14,6,6,6,6,102,102,60,0,0,0,224,96,96,102,108,120,108,102,230,0,0,0,0,0,56,24,24,24,24,24,24,24,60,0,0,0,0,0,0,0,0,236,254,214,214,214,198,0,0,0,0,0,0,0,0,220,102,102,102,102,102,0,0,0,0,0,0,0,0,124,198,198,198,198,124,0,0,0,0,0,0,0,0,220,102,102,102,124,96,96,240,0,0,0,0,0,0,118,204,204,204,124,12,12,30,0,0,0,0,0,0,220,118,102,96,96,240,0,0,0,0,0,0,0,0,124,198,112,28,198,124,0,0,0,0,0,16,48,48,252,48,48,48,54,28,0,0,0,0,0,0,0,0,204,204,204,204,204,118,0,0,0,0,0,0,0,0,102,102,102,102,60,24,0,0,0,0,0,0,0,0,198,198,214,214,254,108,0,0,0,0,0,0,0,0,198,108,56,56,108,198,0,0,0,0,0,0,0,0,198,198,198,198,126,6,12,248,0,0,0,0,0,0,254,204,24,48,102,254,0,0,0,0,0,14,24,24,24,112,24,24,24,14,0,0,0,0,0,24,24,24,24,0,24,24,24,24,0,0,0,0,0,112,24,24,24,14,24,24,24,112,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,60,102,194,192,192,194,102,60,12,6,124,0,0,0,204,204,0,204,204,204,204,204,118,0,0,0,0,12,24,48,0,124,198,254,192,198,124,0,0,0,0,16,56,108,0,120,12,124,204,204,118,0,0,0,0,0,204,204,0,120,12,124,204,204,118,0,0,0,0,96,48,24,0,120,12,124,204,204,118,0,0,0,0,56,108,56,0,120,12,124,204,204,118,0,0,0,0,0,0,0,60,102,96,102,60,12,6,60,0,0,0,16,56,108,0,124,198,254,192,198,124,0,0,0,0,0,204,204,0,124,198,254,192,198,124,0,0,0,0,96,48,24,0,124,198,254,192,198,124,0,0,0,0,0,102,102,0,56,24,24,24,24,60,0,0,0,0,24,60,102,0,56,24,24,24,24,60,0,0,0,0,96,48,24,0,56,24,24,24,24,60,0,0,0,0,198,198,16,56,108,198,198,254,198,198,0,0,0,56,108,56,0,56,108,198,198,254,198,198,0,0,0,24,48,96,0,254,102,96,124,96,102,254,0,0,0,0,0,0,0,204,118,54,126,216,216,110,0,0,0,0,0,62,108,204,204,254,204,204,204,206,0,0,0,0,16,56,108,0,124,198,198,198,198,124,0,0,0,0,0,198,198,0,124,198,198,198,198,124,0,0,0,0,96,48,24,0,124,198,198,198,198,124,0,0,0,0,48,120,204,0,204,204,204,204,204,118,0,0,0,0,96,48,24,0,204,204,204,204,204,118,0,0,0,0,0,198,198,0,198,198,198,198,126,6,12,120,0,0,198,198,56,108,198,198,198,198,108,56,0,0,0,0,198,198,0,198,198,198,198,198,198,124,0,0,0,0,24,24,60,102,96,96,102,60,24,24,0,0,0,0,56,108,100,96,240,96,96,96,230,252,0,0,0,0,0,102,102,60,24,126,24,126,24,24,0,0,0,0,248,204,204,248,196,204,222,204,204,198,0,0,0,0,14,27,24,24,24,126,24,24,24,24,216,112,0,0,24,48,96,0,120,12,124,204,204,118,0,0,0,0,12,24,48,0,56,24,24,24,24,60,0,0,0,0,24,48,96,0,124,198,198,198,198,124,0,0,0,0,24,48,96,0,204,204,204,204,204,118,0,0,0,0,0,118,220,0,220,102,102,102,102,102,0,0,0,118,220,0,198,230,246,254,222,206,198,198,0,0,0,0,60,108,108,62,0,126,0,0,0,0,0,0,0,0,56,108,108,56,0,124,0,0,0,0,0,0,0,0,0,48,48,0,48,48,96,198,198,124,0,0,0,0,0,0,0,0,0,254,192,192,192,0,0,0,0,0,0,0,0,0,0,254,6,6,6,0,0,0,0,0,192,192,198,204,216,48,96,220,134,12,24,62,0,0,192,192,198,204,216,48,102,206,158,62,6,6,0,0,0,24,24,0,24,24,60,60,60,24,0,0,0,0,0,0,0,54,108,216,108,54,0,0,0,0,0,0,0,0,0,216,108,54,108,216,0,0,0,0,0,17,68,17,68,17,68,17,68,17,68,17,68,17,68,85,170,85,170,85,170,85,170,85,170,85,170,85,170,221,119,221,119,221,119,221,119,221,119,221,119,221,119,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,248,24,24,24,24,24,24,24,24,24,24,24,248,24,248,24,24,24,24,24,24,54,54,54,54,54,54,54,246,54,54,54,54,54,54,0,0,0,0,0,0,0,254,54,54,54,54,54,54,0,0,0,0,0,248,24,248,24,24,24,24,24,24,54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54,54,54,54,246,6,254,0,0,0,0,0,0,54,54,54,54,54,54,54,254,0,0,0,0,0,0,24,24,24,24,24,248,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,248,24,24,24,24,24,24,24,24,24,24,24,24,24,31,0,0,0,0,0,0,24,24,24,24,24,24,24,255,0,0,0,0,0,0,0,0,0,0,0,0,0,255,24,24,24,24,24,24,24,24,24,24,24,24,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,255,0,0,0,0,0,0,24,24,24,24,24,24,24,255,24,24,24,24,24,24,24,24,24,24,24,31,24,31,24,24,24,24,24,24,54,54,54,54,54,54,54,55,54,54,54,54,54,54,54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54,54,54,54,55,48,55,54,54,54,54,54,54,0,0,0,0,0,255,0,255,0,0,0,0,0,0,54,54,54,54,54,247,0,247,54,54,54,54,54,54,24,24,24,24,24,255,0,255,0,0,0,0,0,0,54,54,54,54,54,54,54,255,0,0,0,0,0,0,0,0,0,0,0,255,0,255,24,24,24,24,24,24,0,0,0,0,0,0,0,255,54,54,54,54,54,54,54,54,54,54,54,54,54,63,0,0,0,0,0,0,24,24,24,24,24,31,24,31,0,0,0,0,0,0,0,0,0,0,0,31,24,31,24,24,24,24,24,24,0,0,0,0,0,0,0,63,54,54,54,54,54,54,54,54,54,54,54,54,54,255,54,54,54,54,54,54,24,24,24,24,24,255,24,255,24,24,24,24,24,24,24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0,0,0,0,0,0,31,24,24,24,24,24,24,255,255,255,255,255,255,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,255,255,255,255,255,255,255,240,240,240,240,240,240,240,240,240,240,240,240,240,240,15,15,15,15,15,15,15,15,15,15,15,15,15,15,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,118,220,216,216,220,118,0,0,0,0,0,0,0,124,198,252,198,198,252,192,192,64,0,0,0,254,198,198,192,192,192,192,192,192,0,0,0,0,0,0,0,254,108,108,108,108,108,108,0,0,0,0,0,254,198,96,48,24,48,96,198,254,0,0,0,0,0,0,0,0,126,216,216,216,216,112,0,0,0,0,0,0,0,102,102,102,102,124,96,96,192,0,0,0,0,0,0,118,220,24,24,24,24,24,0,0,0,0,0,126,24,60,102,102,102,60,24,126,0,0,0,0,0,56,108,198,198,254,198,198,108,56,0,0,0,0,0,56,108,198,198,198,108,108,108,238,0,0,0,0,0,30,48,24,12,62,102,102,102,60,0,0,0,0,0,0,0,0,126,219,219,126,0,0,0,0,0,0,0,3,6,126,219,219,243,126,96,192,0,0,0,0,0,28,48,96,96,124,96,96,48,28,0,0,0,0,0,0,124,198,198,198,198,198,198,198,0,0,0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,216,216,112,0,0,0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0,56,108,108,56,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,15,12,12,12,12,12,236,108,60,28,0,0,0,0,216,108,108,108,108,108,0,0,0,0,0,0,0,0,112,216,48,96,200,248,0,0,0,0,0,0,0,0,0,0,0,124,124,124,124,124,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),OA=new Uint8Array([0,0,0,0,0,42,0,42,0,0,42,42,42,0,0,42,0,42,42,21,0,42,42,42,21,21,21,21,21,63,21,63,21,21,63,63,63,21,21,63,21,63,63,63,21,63,63,63]),Oh=globalThis||void 0||self;var AG=typeof Oh=="object"&&Oh&&Oh.Object===Object&&Oh,xue=typeof self=="object"&&self&&self.Object===Object&&self,Tp=AG||xue||Function("return this")(),Od=Tp.Symbol,MG=Object.prototype,Cue=MG.hasOwnProperty,Rue=MG.toString,yS=Od?Od.toStringTag:void 0;function Aue(t){var e=Cue.call(t,yS),n=t[yS];try{t[yS]=void 0;var r=!0}catch{}var i=Rue.call(t);return r&&(e?t[yS]=n:delete t[yS]),i}var Mue=Object.prototype,Iue=Mue.toString;function Oue(t){return Iue.call(t)}var kue="[object Null]",Nue="[object Undefined]",i$=Od?Od.toStringTag:void 0;function w_(t){return t==null?t===void 0?Nue:kue:i$&&i$ in Object(t)?Aue(t):Oue(t)}function Bh(t){return t!=null&&typeof t=="object"}var Pue="[object Symbol]";function kA(t){return typeof t=="symbol"||Bh(t)&&w_(t)==Pue}function NA(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var Ri=Array.isArray,Due=1/0,s$=Od?Od.prototype:void 0,o$=s$?s$.toString:void 0;function IG(t){if(typeof t=="string")return t;if(Ri(t))return NA(t,IG)+"";if(kA(t))return o$?o$.call(t):"";var e=t+"";return e=="0"&&1/t==-Due?"-0":e}var Lue=/\s/;function Uue(t){for(var e=t.length;e--&&Lue.test(t.charAt(e)););return e}var Fue=/^\s+/;function Bue(t){return t&&t.slice(0,Uue(t)+1).replace(Fue,"")}function kd(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var a$=NaN,jue=/^[-+]0x[0-9a-f]+$/i,$ue=/^0b[01]+$/i,Hue=/^0o[0-7]+$/i,Vue=parseInt;function zue(t){if(typeof t=="number")return t;if(kA(t))return a$;if(kd(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=kd(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Bue(t);var n=$ue.test(t);return n||Hue.test(t)?Vue(t.slice(2),n?2:8):jue.test(t)?a$:+t}var c$=1/0,Gue=17976931348623157e292;function que(t){if(!t)return t===0?t:0;if(t=zue(t),t===c$||t===-c$){var e=t<0?-1:1;return e*Gue}return t===t?t:0}function PA(t){var e=que(t),n=e%1;return e===e?n?e-n:e:0}function pE(t){return t}var Wue="[object AsyncFunction]",Kue="[object Function]",Yue="[object GeneratorFunction]",Xue="[object Proxy]";function pg(t){if(!kd(t))return!1;var e=w_(t);return e==Kue||e==Yue||e==Wue||e==Xue}var BN=Tp["__core-js_shared__"],l$=function(){var t=/[^.]+$/.exec(BN&&BN.keys&&BN.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Jue(t){return!!l$&&l$ in t}var Que=Function.prototype,Zue=Que.toString;function hy(t){if(t!=null){try{return Zue.call(t)}catch{}try{return t+""}catch{}}return""}var ede=/[\\^$.*+?()[\]{}|]/g,tde=/^\[object .+?Constructor\]$/,nde=Function.prototype,rde=Object.prototype,ide=nde.toString,sde=rde.hasOwnProperty,ode=RegExp("^"+ide.call(sde).replace(ede,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ade(t){if(!kd(t)||Jue(t))return!1;var e=pg(t)?ode:tde;return e.test(hy(t))}function cde(t,e){return t==null?void 0:t[e]}function fy(t,e){var n=cde(t,e);return ade(n)?n:void 0}var yL=fy(Tp,"WeakMap"),u$=Object.create,lde=function(){function t(){}return function(e){if(!kd(e))return{};if(u$)return u$(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function ude(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Ra(){}function dde(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var hde=800,fde=16,pde=Date.now;function mde(t){var e=0,n=0;return function(){var r=pde(),i=fde-(r-n);if(n=r,i>0){if(++e>=hde)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function gde(t){return function(){return t}}var Z1=function(){try{var t=fy(Object,"defineProperty");return t({},"",{}),t}catch{}}(),vde=Z1?function(t,e){return Z1(t,"toString",{configurable:!0,enumerable:!1,value:gde(e),writable:!0})}:pE,_de=mde(vde);function OG(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function kG(t,e,n,r){for(var i=t.length,s=n+-1;++s<i;)if(e(t[s],s,t))return s;return-1}function yde(t){return t!==t}function bde(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function cF(t,e,n){return e===e?bde(t,e,n):kG(t,yde,n)}function NG(t,e){var n=t==null?0:t.length;return!!n&&cF(t,e,0)>-1}var Ede=9007199254740991,Sde=/^(?:0|[1-9]\d*)$/;function DA(t,e){var n=typeof t;return e=e??Ede,!!e&&(n=="number"||n!="symbol"&&Sde.test(t))&&t>-1&&t%1==0&&t<e}function lF(t,e,n){e=="__proto__"&&Z1?Z1(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function hT(t,e){return t===e||t!==t&&e!==e}var wde=Object.prototype,Tde=wde.hasOwnProperty;function LA(t,e,n){var r=t[e];(!(Tde.call(t,e)&&hT(r,n))||n===void 0&&!(e in t))&&lF(t,e,n)}function uF(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?lF(n,a,c):LA(n,a,c)}return n}var d$=Math.max;function xde(t,e,n){return e=d$(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=d$(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),ude(t,this,a)}}function dF(t,e){return _de(xde(t,e,pE),t+"")}var Cde=9007199254740991;function hF(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Cde}function xp(t){return t!=null&&hF(t.length)&&!pg(t)}function PG(t,e,n){if(!kd(n))return!1;var r=typeof e;return(r=="number"?xp(n)&&DA(e,n.length):r=="string"&&e in n)?hT(n[e],t):!1}function Rde(t){return dF(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&PG(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var Ade=Object.prototype;function fT(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||Ade;return t===n}function Mde(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var Ide="[object Arguments]";function h$(t){return Bh(t)&&w_(t)==Ide}var DG=Object.prototype,Ode=DG.hasOwnProperty,kde=DG.propertyIsEnumerable,UA=h$(function(){return arguments}())?h$:function(t){return Bh(t)&&Ode.call(t,"callee")&&!kde.call(t,"callee")};function Nde(){return!1}var LG=typeof exports=="object"&&exports&&!exports.nodeType&&exports,f$=LG&&typeof module=="object"&&module&&!module.nodeType&&module,Pde=f$&&f$.exports===LG,p$=Pde?Tp.Buffer:void 0,Dde=p$?p$.isBuffer:void 0,_w=Dde||Nde,Lde="[object Arguments]",Ude="[object Array]",Fde="[object Boolean]",Bde="[object Date]",jde="[object Error]",$de="[object Function]",Hde="[object Map]",Vde="[object Number]",zde="[object Object]",Gde="[object RegExp]",qde="[object Set]",Wde="[object String]",Kde="[object WeakMap]",Yde="[object ArrayBuffer]",Xde="[object DataView]",Jde="[object Float32Array]",Qde="[object Float64Array]",Zde="[object Int8Array]",ehe="[object Int16Array]",the="[object Int32Array]",nhe="[object Uint8Array]",rhe="[object Uint8ClampedArray]",ihe="[object Uint16Array]",she="[object Uint32Array]",Ds={};Ds[Jde]=Ds[Qde]=Ds[Zde]=Ds[ehe]=Ds[the]=Ds[nhe]=Ds[rhe]=Ds[ihe]=Ds[she]=!0;Ds[Lde]=Ds[Ude]=Ds[Yde]=Ds[Fde]=Ds[Xde]=Ds[Bde]=Ds[jde]=Ds[$de]=Ds[Hde]=Ds[Vde]=Ds[zde]=Ds[Gde]=Ds[qde]=Ds[Wde]=Ds[Kde]=!1;function ohe(t){return Bh(t)&&hF(t.length)&&!!Ds[w_(t)]}function FA(t){return function(e){return t(e)}}var UG=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ew=UG&&typeof module=="object"&&module&&!module.nodeType&&module,ahe=ew&&ew.exports===UG,jN=ahe&&AG.process,o_=function(){try{var t=ew&&ew.require&&ew.require("util").types;return t||jN&&jN.binding&&jN.binding("util")}catch{}}(),m$=o_&&o_.isTypedArray,fF=m$?FA(m$):ohe,che=Object.prototype,lhe=che.hasOwnProperty;function FG(t,e){var n=Ri(t),r=!n&&UA(t),i=!n&&!r&&_w(t),s=!n&&!r&&!i&&fF(t),o=n||r||i||s,a=o?Mde(t.length,String):[],c=a.length;for(var l in t)(e||lhe.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||DA(l,c)))&&a.push(l);return a}function BG(t,e){return function(n){return t(e(n))}}var uhe=BG(Object.keys,Object),dhe=Object.prototype,hhe=dhe.hasOwnProperty;function jG(t){if(!fT(t))return uhe(t);var e=[];for(var n in Object(t))hhe.call(t,n)&&n!="constructor"&&e.push(n);return e}function Nd(t){return xp(t)?FG(t):jG(t)}var fhe=Object.prototype,phe=fhe.hasOwnProperty,cu=Rde(function(t,e){if(fT(e)||xp(e)){uF(e,Nd(e),t);return}for(var n in e)phe.call(e,n)&&LA(t,n,e[n])});function mhe(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var ghe=Object.prototype,vhe=ghe.hasOwnProperty;function _he(t){if(!kd(t))return mhe(t);var e=fT(t),n=[];for(var r in t)r=="constructor"&&(e||!vhe.call(t,r))||n.push(r);return n}function $G(t){return xp(t)?FG(t,!0):_he(t)}var yhe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bhe=/^\w*$/;function pF(t,e){if(Ri(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||kA(t)?!0:bhe.test(t)||!yhe.test(t)||e!=null&&t in Object(e)}var yw=fy(Object,"create");function Ehe(){this.__data__=yw?yw(null):{},this.size=0}function She(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var whe="__lodash_hash_undefined__",The=Object.prototype,xhe=The.hasOwnProperty;function Che(t){var e=this.__data__;if(yw){var n=e[t];return n===whe?void 0:n}return xhe.call(e,t)?e[t]:void 0}var Rhe=Object.prototype,Ahe=Rhe.hasOwnProperty;function Mhe(t){var e=this.__data__;return yw?e[t]!==void 0:Ahe.call(e,t)}var Ihe="__lodash_hash_undefined__";function Ohe(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=yw&&e===void 0?Ihe:e,this}function G0(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}G0.prototype.clear=Ehe;G0.prototype.delete=She;G0.prototype.get=Che;G0.prototype.has=Mhe;G0.prototype.set=Ohe;function khe(){this.__data__=[],this.size=0}function BA(t,e){for(var n=t.length;n--;)if(hT(t[n][0],e))return n;return-1}var Nhe=Array.prototype,Phe=Nhe.splice;function Dhe(t){var e=this.__data__,n=BA(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Phe.call(e,n,1),--this.size,!0}function Lhe(t){var e=this.__data__,n=BA(e,t);return n<0?void 0:e[n][1]}function Uhe(t){return BA(this.__data__,t)>-1}function Fhe(t,e){var n=this.__data__,r=BA(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function mg(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}mg.prototype.clear=khe;mg.prototype.delete=Dhe;mg.prototype.get=Lhe;mg.prototype.has=Uhe;mg.prototype.set=Fhe;var bw=fy(Tp,"Map");function Bhe(){this.size=0,this.__data__={hash:new G0,map:new(bw||mg),string:new G0}}function jhe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function jA(t,e){var n=t.__data__;return jhe(e)?n[typeof e=="string"?"string":"hash"]:n.map}function $he(t){var e=jA(this,t).delete(t);return this.size-=e?1:0,e}function Hhe(t){return jA(this,t).get(t)}function Vhe(t){return jA(this,t).has(t)}function zhe(t,e){var n=jA(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function gg(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}gg.prototype.clear=Bhe;gg.prototype.delete=$he;gg.prototype.get=Hhe;gg.prototype.has=Vhe;gg.prototype.set=zhe;var Ghe="Expected a function";function mF(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ghe);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(mF.Cache||gg),n}mF.Cache=gg;var qhe=500;function Whe(t){var e=mF(t,function(r){return n.size===qhe&&n.clear(),r}),n=e.cache;return e}var Khe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yhe=/\\(\\)?/g,Xhe=Whe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Khe,function(n,r,i,s){e.push(i?s.replace(Yhe,"$1"):r||n)}),e});function HG(t){return t==null?"":IG(t)}function $A(t,e){return Ri(t)?t:pF(t,e)?[t]:Xhe(HG(t))}var Jhe=1/0;function pT(t){if(typeof t=="string"||kA(t))return t;var e=t+"";return e=="0"&&1/t==-Jhe?"-0":e}function gF(t,e){e=$A(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[pT(e[n++])];return n&&n==r?t:void 0}function Qhe(t,e,n){var r=t==null?void 0:gF(t,e);return r===void 0?n:r}function vF(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var g$=Od?Od.isConcatSpreadable:void 0;function Zhe(t){return Ri(t)||UA(t)||!!(g$&&t&&t[g$])}function _F(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=Zhe),i||(i=[]);++s<o;){var a=t[s];n(a)?vF(i,a):r||(i[i.length]=a)}return i}function su(t){var e=t==null?0:t.length;return e?_F(t):[]}var VG=BG(Object.getPrototypeOf,Object);function yF(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function efe(t,e,n){var r=t.length;return n=n===void 0?r:n,!e&&n>=r?t:yF(t,e,n)}var tfe="\\ud800-\\udfff",nfe="\\u0300-\\u036f",rfe="\\ufe20-\\ufe2f",ife="\\u20d0-\\u20ff",sfe=nfe+rfe+ife,ofe="\\ufe0e\\ufe0f",afe="\\u200d",cfe=RegExp("["+afe+tfe+sfe+ofe+"]");function zG(t){return cfe.test(t)}function lfe(t){return t.split("")}var GG="\\ud800-\\udfff",ufe="\\u0300-\\u036f",dfe="\\ufe20-\\ufe2f",hfe="\\u20d0-\\u20ff",ffe=ufe+dfe+hfe,pfe="\\ufe0e\\ufe0f",mfe="["+GG+"]",bL="["+ffe+"]",EL="\\ud83c[\\udffb-\\udfff]",gfe="(?:"+bL+"|"+EL+")",qG="[^"+GG+"]",WG="(?:\\ud83c[\\udde6-\\uddff]){2}",KG="[\\ud800-\\udbff][\\udc00-\\udfff]",vfe="\\u200d",YG=gfe+"?",XG="["+pfe+"]?",_fe="(?:"+vfe+"(?:"+[qG,WG,KG].join("|")+")"+XG+YG+")*",yfe=XG+YG+_fe,bfe="(?:"+[qG+bL+"?",bL,WG,KG,mfe].join("|")+")",Efe=RegExp(EL+"(?="+EL+")|"+bfe+yfe,"g");function Sfe(t){return t.match(Efe)||[]}function wfe(t){return zG(t)?Sfe(t):lfe(t)}function Tfe(t){return function(e){e=HG(e);var n=zG(e)?wfe(e):void 0,r=n?n[0]:e.charAt(0),i=n?efe(n,1).join(""):e.slice(1);return r[t]()+i}}var JG=Tfe("toUpperCase");function xfe(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Cfe(){this.__data__=new mg,this.size=0}function Rfe(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Afe(t){return this.__data__.get(t)}function Mfe(t){return this.__data__.has(t)}var Ife=200;function Ofe(t,e){var n=this.__data__;if(n instanceof mg){var r=n.__data__;if(!bw||r.length<Ife-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new gg(r)}return n.set(t,e),this.size=n.size,this}function cp(t){var e=this.__data__=new mg(t);this.size=e.size}cp.prototype.clear=Cfe;cp.prototype.delete=Rfe;cp.prototype.get=Afe;cp.prototype.has=Mfe;cp.prototype.set=Ofe;function kfe(t,e){return t&&uF(e,Nd(e),t)}var QG=typeof exports=="object"&&exports&&!exports.nodeType&&exports,v$=QG&&typeof module=="object"&&module&&!module.nodeType&&module,Nfe=v$&&v$.exports===QG,_$=Nfe?Tp.Buffer:void 0,y$=_$?_$.allocUnsafe:void 0;function Pfe(t,e){var n=t.length,r=y$?y$(n):new t.constructor(n);return t.copy(r),r}function bF(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function ZG(){return[]}var Dfe=Object.prototype,Lfe=Dfe.propertyIsEnumerable,b$=Object.getOwnPropertySymbols,EF=b$?function(t){return t==null?[]:(t=Object(t),bF(b$(t),function(e){return Lfe.call(t,e)}))}:ZG;function Ufe(t,e){return uF(t,EF(t),e)}var Ffe=Object.getOwnPropertySymbols,Bfe=Ffe?function(t){for(var e=[];t;)vF(e,EF(t)),t=VG(t);return e}:ZG;function eq(t,e,n){var r=e(t);return Ri(t)?r:vF(r,n(t))}function SL(t){return eq(t,Nd,EF)}function jfe(t){return eq(t,$G,Bfe)}var wL=fy(Tp,"DataView"),TL=fy(Tp,"Promise"),Wb=fy(Tp,"Set"),E$="[object Map]",$fe="[object Object]",S$="[object Promise]",w$="[object Set]",T$="[object WeakMap]",x$="[object DataView]",Hfe=hy(wL),Vfe=hy(bw),zfe=hy(TL),Gfe=hy(Wb),qfe=hy(yL),Ed=w_;(wL&&Ed(new wL(new ArrayBuffer(1)))!=x$||bw&&Ed(new bw)!=E$||TL&&Ed(TL.resolve())!=S$||Wb&&Ed(new Wb)!=w$||yL&&Ed(new yL)!=T$)&&(Ed=function(t){var e=w_(t),n=e==$fe?t.constructor:void 0,r=n?hy(n):"";if(r)switch(r){case Hfe:return x$;case Vfe:return E$;case zfe:return S$;case Gfe:return w$;case qfe:return T$}return e});var Wfe=Object.prototype,Kfe=Wfe.hasOwnProperty;function Yfe(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&Kfe.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var eR=Tp.Uint8Array;function Xfe(t){var e=new t.constructor(t.byteLength);return new eR(e).set(new eR(t)),e}function Jfe(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Qfe=/\w*$/;function Zfe(t){var e=new t.constructor(t.source,Qfe.exec(t));return e.lastIndex=t.lastIndex,e}var C$=Od?Od.prototype:void 0,R$=C$?C$.valueOf:void 0;function epe(t){return R$?Object(R$.call(t)):{}}function tpe(t,e){var n=t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var npe="[object Boolean]",rpe="[object Date]",ipe="[object Map]",spe="[object Number]",ope="[object RegExp]",ape="[object Set]",cpe="[object String]",lpe="[object Symbol]",upe="[object ArrayBuffer]",dpe="[object DataView]",hpe="[object Float32Array]",fpe="[object Float64Array]",ppe="[object Int8Array]",mpe="[object Int16Array]",gpe="[object Int32Array]",vpe="[object Uint8Array]",_pe="[object Uint8ClampedArray]",ype="[object Uint16Array]",bpe="[object Uint32Array]";function Epe(t,e,n){var r=t.constructor;switch(e){case upe:return Xfe(t);case npe:case rpe:return new r(+t);case dpe:return Jfe(t);case hpe:case fpe:case ppe:case mpe:case gpe:case vpe:case _pe:case ype:case bpe:return tpe(t);case ipe:return new r;case spe:case cpe:return new r(t);case ope:return Zfe(t);case ape:return new r;case lpe:return epe(t)}}function Spe(t){return typeof t.constructor=="function"&&!fT(t)?lde(VG(t)):{}}var wpe="[object Map]";function Tpe(t){return Bh(t)&&Ed(t)==wpe}var A$=o_&&o_.isMap,xpe=A$?FA(A$):Tpe,Cpe="[object Set]";function Rpe(t){return Bh(t)&&Ed(t)==Cpe}var M$=o_&&o_.isSet,Ape=M$?FA(M$):Rpe,tq="[object Arguments]",Mpe="[object Array]",Ipe="[object Boolean]",Ope="[object Date]",kpe="[object Error]",nq="[object Function]",Npe="[object GeneratorFunction]",Ppe="[object Map]",Dpe="[object Number]",rq="[object Object]",Lpe="[object RegExp]",Upe="[object Set]",Fpe="[object String]",Bpe="[object Symbol]",jpe="[object WeakMap]",$pe="[object ArrayBuffer]",Hpe="[object DataView]",Vpe="[object Float32Array]",zpe="[object Float64Array]",Gpe="[object Int8Array]",qpe="[object Int16Array]",Wpe="[object Int32Array]",Kpe="[object Uint8Array]",Ype="[object Uint8ClampedArray]",Xpe="[object Uint16Array]",Jpe="[object Uint32Array]",Es={};Es[tq]=Es[Mpe]=Es[$pe]=Es[Hpe]=Es[Ipe]=Es[Ope]=Es[Vpe]=Es[zpe]=Es[Gpe]=Es[qpe]=Es[Wpe]=Es[Ppe]=Es[Dpe]=Es[rq]=Es[Lpe]=Es[Upe]=Es[Fpe]=Es[Bpe]=Es[Kpe]=Es[Ype]=Es[Xpe]=Es[Jpe]=!0;Es[kpe]=Es[nq]=Es[jpe]=!1;function a1(t,e,n,r,i,s){var o;if(o!==void 0)return o;if(!kd(t))return t;var a=Ri(t);if(a)return o=Yfe(t),dde(t,o);var c=Ed(t),l=c==nq||c==Npe;if(_w(t))return Pfe(t);if(c==rq||c==tq||l&&!i)return o=l?{}:Spe(t),Ufe(t,kfe(o,t));if(!Es[c])return i?t:{};o=Epe(t,c),s||(s=new cp);var u=s.get(t);if(u)return u;s.set(t,o),Ape(t)?t.forEach(function(f){o.add(a1(f,e,n,f,t,s))}):xpe(t)&&t.forEach(function(f,p){o.set(p,a1(f,e,n,p,t,s))});var d=SL,h=a?void 0:d(t);return OG(h||t,function(f,p){h&&(p=f,f=t[p]),LA(o,p,a1(f,e,n,p,t,s))}),o}var Qpe=4;function Cc(t){return a1(t,Qpe)}function mT(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var Zpe="__lodash_hash_undefined__";function eme(t){return this.__data__.set(t,Zpe),this}function tme(t){return this.__data__.has(t)}function mE(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new gg;++e<n;)this.add(t[e])}mE.prototype.add=mE.prototype.push=eme;mE.prototype.has=tme;function iq(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function SF(t,e){return t.has(e)}var nme=1,rme=2;function sq(t,e,n,r,i,s){var o=n&nme,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),u=s.get(e);if(l&&u)return l==e&&u==t;var d=-1,h=!0,f=n&rme?new mE:void 0;for(s.set(t,e),s.set(e,t);++d<a;){var p=t[d],g=e[d];if(r)var v=o?r(g,p,d,e,t,s):r(p,g,d,t,e,s);if(v!==void 0){if(v)continue;h=!1;break}if(f){if(!iq(e,function(E,T){if(!SF(f,T)&&(p===E||i(p,E,n,r,s)))return f.push(T)})){h=!1;break}}else if(!(p===g||i(p,g,n,r,s))){h=!1;break}}return s.delete(t),s.delete(e),h}function ime(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function wF(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var sme=1,ome=2,ame="[object Boolean]",cme="[object Date]",lme="[object Error]",ume="[object Map]",dme="[object Number]",hme="[object RegExp]",fme="[object Set]",pme="[object String]",mme="[object Symbol]",gme="[object ArrayBuffer]",vme="[object DataView]",I$=Od?Od.prototype:void 0,$N=I$?I$.valueOf:void 0;function _me(t,e,n,r,i,s,o){switch(n){case vme:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case gme:return!(t.byteLength!=e.byteLength||!s(new eR(t),new eR(e)));case ame:case cme:case dme:return hT(+t,+e);case lme:return t.name==e.name&&t.message==e.message;case hme:case pme:return t==e+"";case ume:var a=ime;case fme:var c=r&sme;if(a||(a=wF),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=ome,o.set(t,e);var u=sq(a(t),a(e),r,i,s,o);return o.delete(t),u;case mme:if($N)return $N.call(t)==$N.call(e)}return!1}var yme=1,bme=Object.prototype,Eme=bme.hasOwnProperty;function Sme(t,e,n,r,i,s){var o=n&yme,a=SL(t),c=a.length,l=SL(e),u=l.length;if(c!=u&&!o)return!1;for(var d=c;d--;){var h=a[d];if(!(o?h in e:Eme.call(e,h)))return!1}var f=s.get(t),p=s.get(e);if(f&&p)return f==e&&p==t;var g=!0;s.set(t,e),s.set(e,t);for(var v=o;++d<c;){h=a[d];var E=t[h],T=e[h];if(r)var C=o?r(T,E,h,e,t,s):r(E,T,h,t,e,s);if(!(C===void 0?E===T||i(E,T,n,r,s):C)){g=!1;break}v||(v=h=="constructor")}if(g&&!v){var A=t.constructor,k=e.constructor;A!=k&&"constructor"in t&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof k=="function"&&k instanceof k)&&(g=!1)}return s.delete(t),s.delete(e),g}var wme=1,O$="[object Arguments]",k$="[object Array]",iC="[object Object]",Tme=Object.prototype,N$=Tme.hasOwnProperty;function xme(t,e,n,r,i,s){var o=Ri(t),a=Ri(e),c=o?k$:Ed(t),l=a?k$:Ed(e);c=c==O$?iC:c,l=l==O$?iC:l;var u=c==iC,d=l==iC,h=c==l;if(h&&_w(t)){if(!_w(e))return!1;o=!0,u=!1}if(h&&!u)return s||(s=new cp),o||fF(t)?sq(t,e,n,r,i,s):_me(t,e,c,n,r,i,s);if(!(n&wme)){var f=u&&N$.call(t,"__wrapped__"),p=d&&N$.call(e,"__wrapped__");if(f||p){var g=f?t.value():t,v=p?e.value():e;return s||(s=new cp),i(g,v,n,r,s)}}return h?(s||(s=new cp),Sme(t,e,n,r,i,s)):!1}function TF(t,e,n,r,i){return t===e?!0:t==null||e==null||!Bh(t)&&!Bh(e)?t!==t&&e!==e:xme(t,e,n,r,TF,i)}var Cme=1,Rme=2;function Ame(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var u=new cp,d;if(!(d===void 0?TF(l,c,Cme|Rme,r,u):d))return!1}}return!0}function oq(t){return t===t&&!kd(t)}function Mme(t){for(var e=Nd(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,oq(i)]}return e}function aq(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function Ime(t){var e=Mme(t);return e.length==1&&e[0][2]?aq(e[0][0],e[0][1]):function(n){return n===t||Ame(n,t,e)}}function Ome(t,e){return t!=null&&e in Object(t)}function cq(t,e,n){e=$A(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=pT(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&hF(i)&&DA(o,i)&&(Ri(t)||UA(t)))}function kme(t,e){return t!=null&&cq(t,e,Ome)}var Nme=1,Pme=2;function Dme(t,e){return pF(t)&&oq(e)?aq(pT(t),e):function(n){var r=Qhe(n,t);return r===void 0&&r===e?kme(n,t):TF(e,r,Nme|Pme)}}function Lme(t){return function(e){return e==null?void 0:e[t]}}function Ume(t){return function(e){return gF(e,t)}}function Fme(t){return pF(t)?Lme(pT(t)):Ume(t)}function Cp(t){return typeof t=="function"?t:t==null?pE:typeof t=="object"?Ri(t)?Dme(t[0],t[1]):Ime(t):Fme(t)}function Bme(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function jme(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var $me=jme();function Hme(t,e){return t&&$me(t,e,Nd)}function Vme(t,e){return function(n,r){if(n==null)return n;if(!xp(n))return t(n,r);for(var i=n.length,s=-1,o=Object(n);++s<i&&r(o[s],s,o)!==!1;);return n}}var py=Vme(Hme);function zme(t,e,n,r){return py(t,function(i,s,o){e(r,i,n(i),o)}),r}function Gme(t,e){return function(n,r){var i=Ri(n)?Bme:zme,s=e?e():{};return i(n,t,Cp(r),s)}}var lq=Object.prototype,qme=lq.hasOwnProperty,xF=dF(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&PG(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=$G(s),a=-1,c=o.length;++a<c;){var l=o[a],u=t[l];(u===void 0||hT(u,lq[l])&&!qme.call(t,l))&&(t[l]=s[l])}return t});function P$(t){return Bh(t)&&xp(t)}var Wme=200;function Kme(t,e,n,r){var i=-1,s=NG,o=!0,a=t.length,c=[],l=e.length;if(!a)return c;e.length>=Wme&&(s=SF,o=!1,e=new mE(e));e:for(;++i<a;){var u=t[i],d=u;if(u=u!==0?u:0,o&&d===d){for(var h=l;h--;)if(e[h]===d)continue e;c.push(u)}else s(e,d,r)||c.push(u)}return c}var HA=dF(function(t,e){return P$(t)?Kme(t,_F(e,1,P$,!0)):[]});function gE(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Sc(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:PA(e),yF(t,e<0?0:e,r)):[]}function Ew(t,e,n){var r=t==null?0:t.length;return r?(e=e===void 0?1:PA(e),e=r-e,yF(t,0,e<0?0:e)):[]}function Yme(t){return typeof t=="function"?t:pE}function pr(t,e){var n=Ri(t)?OG:py;return n(t,Yme(e))}function Xme(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Jme(t,e){var n=!0;return py(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function Lh(t,e,n){var r=Ri(t)?Xme:Jme;return r(t,Cp(e))}function uq(t,e){var n=[];return py(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Ud(t,e){var n=Ri(t)?bF:uq;return n(t,Cp(e))}function Qme(t){return function(e,n,r){var i=Object(e);if(!xp(e)){var s=Cp(n);e=Nd(e),n=function(a){return s(i[a],a,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:void 0}}var Zme=Math.max;function ege(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:PA(n);return i<0&&(i=Zme(r+i,0)),kG(t,Cp(e),i)}var vE=Qme(ege);function jh(t){return t&&t.length?t[0]:void 0}function tge(t,e){var n=-1,r=xp(t)?Array(t.length):[];return py(t,function(i,s,o){r[++n]=e(i,s,o)}),r}function Tn(t,e){var n=Ri(t)?NA:tge;return n(t,Cp(e))}function Md(t,e){return _F(Tn(t,e))}var nge=Object.prototype,rge=nge.hasOwnProperty,dq=Gme(function(t,e,n){rge.call(t,n)?t[n].push(e):lF(t,n,[e])}),ige=Object.prototype,sge=ige.hasOwnProperty;function oge(t,e){return t!=null&&sge.call(t,e)}function nr(t,e){return t!=null&&cq(t,e,oge)}var age="[object String]";function lu(t){return typeof t=="string"||!Ri(t)&&Bh(t)&&w_(t)==age}function cge(t,e){return NA(e,function(n){return t[n]})}function la(t){return t==null?[]:cge(t,Nd(t))}var lge=Math.max;function kl(t,e,n,r){t=xp(t)?t:la(t),n=n&&!r?PA(n):0;var i=t.length;return n<0&&(n=lge(i+n,0)),lu(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&cF(t,e,n)>-1}function D$(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=0;return cF(t,e,i)}var uge="[object Map]",dge="[object Set]",hge=Object.prototype,fge=hge.hasOwnProperty;function xs(t){if(t==null)return!0;if(xp(t)&&(Ri(t)||typeof t=="string"||typeof t.splice=="function"||_w(t)||fF(t)||UA(t)))return!t.length;var e=Ed(t);if(e==uge||e==dge)return!t.size;if(fT(t))return!jG(t).length;for(var n in t)if(fge.call(t,n))return!1;return!0}var pge="[object RegExp]";function mge(t){return Bh(t)&&w_(t)==pge}var L$=o_&&o_.isRegExp,ig=L$?FA(L$):mge;function sg(t){return t===void 0}var gge="Expected a function";function vge(t){if(typeof t!="function")throw new TypeError(gge);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function _ge(t,e,n,r){if(!kd(t))return t;e=$A(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=pT(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=kd(u)?u:DA(e[i+1])?[]:{})}LA(a,c,l),a=a[c]}return t}function yge(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=gF(t,o);n(a,o)&&_ge(s,$A(o,t),a)}return s}function Kh(t,e){if(t==null)return{};var n=NA(jfe(t),function(r){return[r]});return e=Cp(e),yge(t,n,function(r,i){return e(r,i[0])})}function bge(t,e,n,r,i){return i(t,function(s,o,a){n=r?(r=!1,s):e(n,s,o,a)}),n}function uu(t,e,n){var r=Ri(t)?xfe:bge,i=arguments.length<3;return r(t,Cp(e),n,i,py)}function VA(t,e){var n=Ri(t)?bF:uq;return n(t,vge(Cp(e)))}function Ege(t,e){var n;return py(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function CF(t,e,n){var r=Ri(t)?iq:Ege;return r(t,Cp(e))}var Sge=1/0,wge=Wb&&1/wF(new Wb([,-0]))[1]==Sge?function(t){return new Wb(t)}:Ra,Tge=200;function xge(t,e,n){var r=-1,i=NG,s=t.length,o=!0,a=[],c=a;if(s>=Tge){var l=wge(t);if(l)return wF(l);o=!1,i=SF,c=new mE}else c=a;e:for(;++r<s;){var u=t[r],d=u;if(u=u!==0?u:0,o&&d===d){for(var h=c.length;h--;)if(c[h]===d)continue e;a.push(u)}else i(c,d,n)||(c!==a&&c.push(d),a.push(u))}return a}function zA(t){return t&&t.length?xge(t):[]}function xL(t){console&&console.error&&console.error(`Error: ${t}`)}function hq(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function fq(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function pq(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function Cge(t){return Rge(t)?t.LABEL:t.name}function Rge(t){return lu(t.LABEL)&&t.LABEL!==""}class Rp{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),pr(this.definition,n=>{n.accept(e)})}}class du extends Rp{constructor(e){super([]),this.idx=1,cu(this,Kh(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class YE extends Rp{constructor(e){super(e.definition),this.orgText="",cu(this,Kh(e,n=>n!==void 0))}}class hu extends Rp{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,cu(this,Kh(e,n=>n!==void 0))}}class ou extends Rp{constructor(e){super(e.definition),this.idx=1,cu(this,Kh(e,n=>n!==void 0))}}class Ap extends Rp{constructor(e){super(e.definition),this.idx=1,cu(this,Kh(e,n=>n!==void 0))}}class Mp extends Rp{constructor(e){super(e.definition),this.idx=1,cu(this,Kh(e,n=>n!==void 0))}}class Oa extends Rp{constructor(e){super(e.definition),this.idx=1,cu(this,Kh(e,n=>n!==void 0))}}class Yh extends Rp{constructor(e){super(e.definition),this.idx=1,cu(this,Kh(e,n=>n!==void 0))}}class Xh extends Rp{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,cu(this,Kh(e,n=>n!==void 0))}}class lo{constructor(e){this.idx=1,cu(this,Kh(e,n=>n!==void 0))}accept(e){e.visit(this)}}function Age(t){return Tn(t,c1)}function c1(t){function e(n){return Tn(n,c1)}if(t instanceof du){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return lu(t.label)&&(n.label=t.label),n}else{if(t instanceof hu)return{type:"Alternative",definition:e(t.definition)};if(t instanceof ou)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof Ap)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof Mp)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:c1(new lo({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Yh)return{type:"RepetitionWithSeparator",idx:t.idx,separator:c1(new lo({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof Oa)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof Xh)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof lo){const n={type:"Terminal",name:t.terminalType.name,label:Cge(t.terminalType),idx:t.idx};lu(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=ig(r)?r.source:r),n}else{if(t instanceof YE)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class my{visit(e){const n=e;switch(n.constructor){case du:return this.visitNonTerminal(n);case hu:return this.visitAlternative(n);case ou:return this.visitOption(n);case Ap:return this.visitRepetitionMandatory(n);case Mp:return this.visitRepetitionMandatoryWithSeparator(n);case Yh:return this.visitRepetitionWithSeparator(n);case Oa:return this.visitRepetition(n);case Xh:return this.visitAlternation(n);case lo:return this.visitTerminal(n);case YE:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function Mge(t){return t instanceof hu||t instanceof ou||t instanceof Oa||t instanceof Ap||t instanceof Mp||t instanceof Yh||t instanceof lo||t instanceof YE}function tR(t,e=[]){return t instanceof ou||t instanceof Oa||t instanceof Yh?!0:t instanceof Xh?CF(t.definition,r=>tR(r,e)):t instanceof du&&kl(e,t)?!1:t instanceof Rp?(t instanceof du&&e.push(t),Lh(t.definition,r=>tR(r,e))):!1}function Ige(t){return t instanceof Xh}function Yf(t){if(t instanceof du)return"SUBRULE";if(t instanceof ou)return"OPTION";if(t instanceof Xh)return"OR";if(t instanceof Ap)return"AT_LEAST_ONE";if(t instanceof Mp)return"AT_LEAST_ONE_SEP";if(t instanceof Yh)return"MANY_SEP";if(t instanceof Oa)return"MANY";if(t instanceof lo)return"CONSUME";throw Error("non exhaustive match")}class GA{walk(e,n=[]){pr(e.definition,(r,i)=>{const s=Sc(e.definition,i+1);if(r instanceof du)this.walkProdRef(r,s,n);else if(r instanceof lo)this.walkTerminal(r,s,n);else if(r instanceof hu)this.walkFlat(r,s,n);else if(r instanceof ou)this.walkOption(r,s,n);else if(r instanceof Ap)this.walkAtLeastOne(r,s,n);else if(r instanceof Mp)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Yh)this.walkManySep(r,s,n);else if(r instanceof Oa)this.walkMany(r,s,n);else if(r instanceof Xh)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new ou({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=U$(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new ou({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=U$(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);pr(e.definition,s=>{const o=new hu({definition:[s]});this.walk(o,i)})}}function U$(t,e,n){return[new ou({definition:[new lo({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function gT(t){if(t instanceof du)return gT(t.referencedRule);if(t instanceof lo)return Nge(t);if(Mge(t))return Oge(t);if(Ige(t))return kge(t);throw Error("non exhaustive match")}function Oge(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,o=!0;for(;i&&o;)s=n[r],o=tR(s),e=e.concat(gT(s)),r=r+1,i=n.length>r;return zA(e)}function kge(t){const e=Tn(t.definition,n=>gT(n));return zA(su(e))}function Nge(t){return[t.terminalType]}const mq="_~IN~_";class Pge extends GA{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=Lge(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),o=new hu({definition:s}),a=gT(o);this.follows[i]=a}}function Dge(t){const e={};return pr(t,n=>{const r=new Pge(n).startWalking();cu(e,r)}),e}function Lge(t,e){return t.name+e+mq}function gr(t){return t.charCodeAt(0)}function HN(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function bS(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function ab(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function Uge(){throw Error("Internal Error - Should never get here!")}function F$(t){return t.type==="Character"}const nR=[];for(let t=gr("0");t<=gr("9");t++)nR.push(t);const rR=[gr("_")].concat(nR);for(let t=gr("a");t<=gr("z");t++)rR.push(t);for(let t=gr("A");t<=gr("Z");t++)rR.push(t);const B$=[gr(" "),gr("\f"),gr(`
`),gr("\r"),gr("	"),gr("\v"),gr("	"),gr(""),gr(""),gr(""),gr(""),gr(""),gr(""),gr(""),gr(""),gr(""),gr(""),gr(""),gr(""),gr(""),gr("\u2028"),gr("\u2029"),gr(""),gr(""),gr(""),gr("\uFEFF")],Fge=/[0-9a-fA-F]/,sC=/[0-9]/,Bge=/[1-9]/;class jge{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":bS(r,"global");break;case"i":bS(r,"ignoreCase");break;case"m":bS(r,"multiLine");break;case"u":bS(r,"unicode");break;case"y":bS(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}ab(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return Uge()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;ab(n);break}if(!(e===!0&&n===void 0)&&ab(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),ab(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[gr(`
`),gr("\r"),gr("\u2028"),gr("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=nR;break;case"D":e=nR,n=!0;break;case"s":e=B$;break;case"S":e=B$,n=!0;break;case"w":e=rR;break;case"W":e=rR,n=!0;break}if(ab(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=gr("\f");break;case"n":e=gr(`
`);break;case"r":e=gr("\r");break;case"t":e=gr("	");break;case"v":e=gr("\v");break}if(ab(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:gr("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:gr(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:gr(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,F$(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,F$(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else HN(r.value,e),e.push(gr("-")),HN(i.value,e)}else HN(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:gr("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(Bge.test(e)===!1)throw Error("Expecting a positive integer");for(;sC.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(sC.test(e)===!1)throw Error("Expecting an integer");for(;sC.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:gr(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return sC.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(Fge.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class RF{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let l1={};const $ge=new jge;function qA(t){const e=t.toString();if(l1.hasOwnProperty(e))return l1[e];{const n=$ge.pattern(e);return l1[e]=n,n}}function Hge(){l1={}}const gq="Complement Sets are not supported for first char optimization",iR=`Unable to use "first char" lexer optimizations:
`;function Vge(t,e=!1){try{const n=qA(t);return CL(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===gq)e&&hq(`${iR}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),xL(`${iR}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function CL(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)CL(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":oC(o.value,e,n);break;case"Set":if(o.complement===!0)throw Error(gq);pr(o.value,c=>{if(typeof c=="number")oC(c,e,n);else{const l=c;if(n===!0)for(let u=l.from;u<=l.to;u++)oC(u,e,n);else{for(let u=l.from;u<=l.to&&u<$S;u++)oC(u,e,n);if(l.to>=$S){const u=l.from>=$S?l.from:$S,d=l.to,h=a_(u),f=a_(d);for(let p=h;p<=f;p++)e[p]=p}}}});break;case"Group":CL(o.value,e,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&RL(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return la(e)}function oC(t,e,n){const r=a_(t);e[r]=r,n===!0&&zge(t,e)}function zge(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=a_(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=a_(i.charCodeAt(0));e[s]=s}}}function j$(t,e){return vE(t.value,n=>{if(typeof n=="number")return kl(e,n);{const r=n;return vE(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function RL(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?Ri(t.value)?Lh(t.value,RL):RL(t.value):!1}class Gge extends RF{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){kl(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?j$(e,this.targetCharCodes)===void 0&&(this.found=!0):j$(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function AF(t,e){if(e instanceof RegExp){const n=qA(e),r=new Gge(t);return r.visit(n),r.found}else return vE(e,n=>kl(t,n.charCodeAt(0)))!==void 0}const q0="PATTERN",jS="defaultMode",aC="modes";let vq=typeof new RegExp("(?:)").sticky=="boolean";function qge(t,e){e=xF(e,{useSticky:vq,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(T,C)=>C()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{mve()});let r;n("Reject Lexer.NA",()=>{r=VA(t,T=>T[q0]===Na.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=Tn(r,T=>{const C=T[q0];if(ig(C)){const A=C.source;return A.length===1&&A!=="^"&&A!=="$"&&A!=="."&&!C.ignoreCase?A:A.length===2&&A[0]==="\\"&&!kl(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],A[1])?A[1]:e.useSticky?H$(C):$$(C)}else{if(pg(C))return i=!0,{exec:C};if(typeof C=="object")return i=!0,C;if(typeof C=="string"){if(C.length===1)return C;{const A=C.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),k=new RegExp(A);return e.useSticky?H$(k):$$(k)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;n("misc mapping",()=>{o=Tn(r,T=>T.tokenTypeIdx),a=Tn(r,T=>{const C=T.GROUP;if(C!==Na.SKIPPED){if(lu(C))return C;if(sg(C))return!1;throw Error("non exhaustive match")}}),c=Tn(r,T=>{const C=T.LONGER_ALT;if(C)return Ri(C)?Tn(C,k=>D$(r,k)):[D$(r,C)]}),l=Tn(r,T=>T.PUSH_MODE),u=Tn(r,T=>nr(T,"POP_MODE"))});let d;n("Line Terminator Handling",()=>{const T=bq(e.lineTerminatorCharacters);d=Tn(r,C=>!1),e.positionTracking!=="onlyOffset"&&(d=Tn(r,C=>nr(C,"LINE_BREAKS")?!!C.LINE_BREAKS:yq(C,T)===!1&&AF(T,C.PATTERN)))});let h,f,p,g;n("Misc Mapping #2",()=>{h=Tn(r,_q),f=Tn(s,hve),p=uu(r,(T,C)=>{const A=C.GROUP;return lu(A)&&A!==Na.SKIPPED&&(T[A]=[]),T},{}),g=Tn(s,(T,C)=>({pattern:s[C],longerAlt:c[C],canLineTerminator:d[C],isCustom:h[C],short:f[C],group:a[C],push:l[C],pop:u[C],tokenTypeIdx:o[C],tokenType:r[C]}))});let v=!0,E=[];return e.safeMode||n("First Char Optimization",()=>{E=uu(r,(T,C,A)=>{if(typeof C.PATTERN=="string"){const k=C.PATTERN.charCodeAt(0),I=a_(k);VN(T,I,g[A])}else if(Ri(C.START_CHARS_HINT)){let k;pr(C.START_CHARS_HINT,I=>{const N=typeof I=="string"?I.charCodeAt(0):I,U=a_(N);k!==U&&(k=U,VN(T,U,g[A]))})}else if(ig(C.PATTERN))if(C.PATTERN.unicode)v=!1,e.ensureOptimizations&&xL(`${iR}	Unable to analyze < ${C.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const k=Vge(C.PATTERN,e.ensureOptimizations);xs(k)&&(v=!1),pr(k,I=>{VN(T,I,g[A])})}else e.ensureOptimizations&&xL(`${iR}	TokenType: <${C.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),v=!1;return T},[])}),{emptyGroups:p,patternIdxToConfig:g,charCodeToPatternIdxToConfig:E,hasCustom:i,canBeOptimized:v}}function Wge(t,e){let n=[];const r=Yge(t);n=n.concat(r.errors);const i=Xge(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(Kge(s)),n=n.concat(ive(s)),n=n.concat(sve(s,e)),n=n.concat(ove(s)),n}function Kge(t){let e=[];const n=Ud(t,r=>ig(r[q0]));return e=e.concat(Qge(n)),e=e.concat(tve(n)),e=e.concat(nve(n)),e=e.concat(rve(n)),e=e.concat(Zge(n)),e}function Yge(t){const e=Ud(t,i=>!nr(i,q0)),n=Tn(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:So.MISSING_PATTERN,tokenTypes:[i]})),r=HA(t,e);return{errors:n,valid:r}}function Xge(t){const e=Ud(t,i=>{const s=i[q0];return!ig(s)&&!pg(s)&&!nr(s,"exec")&&!lu(s)}),n=Tn(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:So.INVALID_PATTERN,tokenTypes:[i]})),r=HA(t,e);return{errors:n,valid:r}}const Jge=/[^\\][$]/;function Qge(t){class e extends RF{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Ud(t,i=>{const s=i.PATTERN;try{const o=qA(s),a=new e;return a.visit(o),a.found}catch{return Jge.test(s.source)}});return Tn(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:So.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Zge(t){const e=Ud(t,r=>r.PATTERN.test(""));return Tn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:So.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const eve=/[^\\[][\^]|^\^/;function tve(t){class e extends RF{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Ud(t,i=>{const s=i.PATTERN;try{const o=qA(s),a=new e;return a.visit(o),a.found}catch{return eve.test(s.source)}});return Tn(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:So.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function nve(t){const e=Ud(t,r=>{const i=r[q0];return i instanceof RegExp&&(i.multiline||i.global)});return Tn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:So.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function rve(t){const e=[];let n=Tn(t,s=>uu(t,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!kl(e,a)&&a.PATTERN!==Na.NA&&(e.push(a),o.push(a)),o),[]));n=mT(n);const r=Ud(n,s=>s.length>1);return Tn(r,s=>{const o=Tn(s,c=>c.name);return{message:`The same RegExp pattern ->${jh(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:So.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function ive(t){const e=Ud(t,r=>{if(!nr(r,"GROUP"))return!1;const i=r.GROUP;return i!==Na.SKIPPED&&i!==Na.NA&&!lu(i)});return Tn(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:So.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function sve(t,e){const n=Ud(t,i=>i.PUSH_MODE!==void 0&&!kl(e,i.PUSH_MODE));return Tn(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:So.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function ove(t){const e=[],n=uu(t,(r,i,s)=>{const o=i.PATTERN;return o===Na.NA||(lu(o)?r.push({str:o,idx:s,tokenType:i}):ig(o)&&cve(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return pr(t,(r,i)=>{pr(n,({str:s,idx:o,tokenType:a})=>{if(i<o&&ave(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:So.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function ave(t,e){if(ig(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(pg(e))return e(t,0,[],{});if(nr(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function cve(t){return vE([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function $$(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function H$(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function lve(t,e,n){const r=[];return nr(t,jS)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+jS+`> property in its definition
`,type:So.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),nr(t,aC)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+aC+`> property in its definition
`,type:So.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),nr(t,aC)&&nr(t,jS)&&!nr(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${jS}: <${t.defaultMode}>which does not exist
`,type:So.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),nr(t,aC)&&pr(t.modes,(i,s)=>{pr(i,(o,a)=>{if(sg(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:So.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(nr(o,"LONGER_ALT")){const c=Ri(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];pr(c,l=>{!sg(l)&&!kl(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:So.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function uve(t,e,n){const r=[];let i=!1;const s=mT(su(la(t.modes))),o=VA(s,c=>c[q0]===Na.NA),a=bq(n);return e&&pr(o,c=>{const l=yq(c,a);if(l!==!1){const d={message:pve(c,l),type:l.issue,tokenType:c};r.push(d)}else nr(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):AF(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:So.NO_LINE_BREAKS_FLAGS}),r}function dve(t){const e={},n=Nd(t);return pr(n,r=>{const i=t[r];if(Ri(i))e[r]=[];else throw Error("non exhaustive match")}),e}function _q(t){const e=t.PATTERN;if(ig(e))return!1;if(pg(e))return!0;if(nr(e,"exec"))return!0;if(lu(e))return!1;throw Error("non exhaustive match")}function hve(t){return lu(t)&&t.length===1?t.charCodeAt(0):!1}const fve={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function yq(t,e){if(nr(t,"LINE_BREAKS"))return!1;if(ig(t.PATTERN)){try{AF(e,t.PATTERN)}catch(n){return{issue:So.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(lu(t.PATTERN))return!1;if(_q(t))return{issue:So.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function pve(t,e){if(e.issue===So.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===So.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function bq(t){return Tn(t,n=>lu(n)?n.charCodeAt(0):n)}function VN(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const $S=256;let u1=[];function a_(t){return t<$S?t:u1[t]}function mve(){if(xs(u1)){u1=new Array(65536);for(let t=0;t<65536;t++)u1[t]=t>255?255+~~(t/255):t}}function vT(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function sR(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let V$=1;const Eq={};function _T(t){const e=gve(t);vve(e),yve(e),_ve(e),pr(e,n=>{n.isParent=n.categoryMatches.length>0})}function gve(t){let e=Cc(t),n=t,r=!0;for(;r;){n=mT(su(Tn(n,s=>s.CATEGORIES)));const i=HA(n,e);e=e.concat(i),xs(i)?r=!1:n=i}return e}function vve(t){pr(t,e=>{wq(e)||(Eq[V$]=e,e.tokenTypeIdx=V$++),z$(e)&&!Ri(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),z$(e)||(e.CATEGORIES=[]),bve(e)||(e.categoryMatches=[]),Eve(e)||(e.categoryMatchesMap={})})}function _ve(t){pr(t,e=>{e.categoryMatches=[],pr(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(Eq[r].tokenTypeIdx)})})}function yve(t){pr(t,e=>{Sq([],e)})}function Sq(t,e){pr(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),pr(e.CATEGORIES,n=>{const r=t.concat(e);kl(r,n)||Sq(r,n)})}function wq(t){return nr(t,"tokenTypeIdx")}function z$(t){return nr(t,"CATEGORIES")}function bve(t){return nr(t,"categoryMatches")}function Eve(t){return nr(t,"categoryMatchesMap")}function Sve(t){return nr(t,"tokenTypeIdx")}const wve={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var So;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(So||(So={}));const HS={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:wve,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(HS);let Na=class{constructor(e,n=HS){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=fq(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=cu({},HS,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===HS.lineTerminatorsPattern)this.config.lineTerminatorsPattern=fve;else if(this.config.lineTerminatorCharacters===HS.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),Ri(e)?i={modes:{defaultMode:Cc(e)},defaultMode:jS}:(s=!1,i=Cc(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(lve(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(uve(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},pr(i.modes,(a,c)=>{i.modes[c]=VA(a,l=>sg(l))});const o=Nd(i.modes);if(pr(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Wge(a,o))}),xs(this.lexerDefinitionErrors)){_T(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=qge(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=cu({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!xs(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=Tn(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}pr(this.lexerDefinitionWarning,a=>{hq(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(vq?(this.chopInput=pE,this.match=this.matchWithTest):(this.updateLastIndex=Ra,this.match=this.matchWithExec),s&&(this.handleModes=Ra),this.trackStartLines===!1&&(this.computeNewColumn=pE),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=Ra),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=uu(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(n.ensureOptimizations&&!xs(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{Hge()}),this.TRACE_INIT("toFastProperties",()=>{pq(this)})})}tokenize(e,n=this.defaultMode){if(!xs(this.lexerDefinitionErrors)){const i=Tn(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,o,a,c,l,u,d,h,f,p,g,v,E;const T=e,C=T.length;let A=0,k=0;const I=this.hasCustom?0:Math.floor(e.length/10),N=new Array(I),U=[];let F=this.trackStartLines?1:void 0,$=this.trackStartLines?1:void 0;const X=dve(this.emptyGroups),q=this.trackStartLines,W=this.config.lineTerminatorsPattern;let K=0,ne=[],Q=[];const ie=[],G=[];Object.freeze(G);let Z;function se(){return ne}function ue(we){const Te=a_(we),Oe=Q[Te];return Oe===void 0?G:Oe}const Ae=we=>{if(ie.length===1&&we.tokenType.PUSH_MODE===void 0){const Te=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(we);U.push({offset:we.startOffset,line:we.startLine,column:we.startColumn,length:we.image.length,message:Te})}else{ie.pop();const Te=gE(ie);ne=this.patternIdxToConfig[Te],Q=this.charCodeToPatternIdxToConfig[Te],K=ne.length;const Oe=this.canModeBeOptimized[Te]&&this.config.safeMode===!1;Q&&Oe?Z=ue:Z=se}};function Be(we){ie.push(we),Q=this.charCodeToPatternIdxToConfig[we],ne=this.patternIdxToConfig[we],K=ne.length,K=ne.length;const Te=this.canModeBeOptimized[we]&&this.config.safeMode===!1;Q&&Te?Z=ue:Z=se}Be.call(this,n);let Se;const Pe=this.config.recoveryEnabled;for(;A<C;){c=null;const we=T.charCodeAt(A),Te=Z(we),Oe=Te.length;for(r=0;r<Oe;r++){Se=Te[r];const _t=Se.pattern;l=null;const Ct=Se.short;if(Ct!==!1?we===Ct&&(c=_t):Se.isCustom===!0?(E=_t.exec(T,A,N,X),E!==null?(c=E[0],E.payload!==void 0&&(l=E.payload)):c=null):(this.updateLastIndex(_t,A),c=this.match(_t,e,A)),c!==null){if(a=Se.longerAlt,a!==void 0){const me=a.length;for(s=0;s<me;s++){const ge=ne[a[s]],nt=ge.pattern;if(u=null,ge.isCustom===!0?(E=nt.exec(T,A,N,X),E!==null?(o=E[0],E.payload!==void 0&&(u=E.payload)):o=null):(this.updateLastIndex(nt,A),o=this.match(nt,e,A)),o&&o.length>c.length){c=o,l=u,Se=ge;break}}}break}}if(c!==null){if(d=c.length,h=Se.group,h!==void 0&&(f=Se.tokenTypeIdx,p=this.createTokenInstance(c,A,f,Se.tokenType,F,$,d),this.handlePayload(p,l),h===!1?k=this.addToken(N,k,p):X[h].push(p)),e=this.chopInput(e,d),A=A+d,$=this.computeNewColumn($,d),q===!0&&Se.canLineTerminator===!0){let _t=0,Ct,me;W.lastIndex=0;do Ct=W.test(c),Ct===!0&&(me=W.lastIndex-1,_t++);while(Ct===!0);_t!==0&&(F=F+_t,$=d-me,this.updateTokenEndLineColumnLocation(p,h,me,_t,F,$,d))}this.handleModes(Se,Ae,Be,p)}else{const _t=A,Ct=F,me=$;let ge=Pe===!1;for(;ge===!1&&A<C;)for(e=this.chopInput(e,1),A++,i=0;i<K;i++){const nt=ne[i],Ce=nt.pattern,ut=nt.short;if(ut!==!1?T.charCodeAt(A)===ut&&(ge=!0):nt.isCustom===!0?ge=Ce.exec(T,A,N,X)!==null:(this.updateLastIndex(Ce,A),ge=Ce.exec(e)!==null),ge===!0)break}if(g=A-_t,$=this.computeNewColumn($,g),v=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(T,_t,g,Ct,me),U.push({offset:_t,line:Ct,column:me,length:g,message:v}),Pe===!1)break}}return this.hasCustom||(N.length=k),{tokens:N,groups:X,errors:U}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,o,a){let c,l;n!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,o){return{image:e,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}};Na.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";Na.NA=/NOT_APPLICABLE/;function tw(t){return Tq(t)?t.LABEL:t.name}function Tq(t){return lu(t.LABEL)&&t.LABEL!==""}const Tve="parent",G$="categories",q$="label",W$="group",K$="push_mode",Y$="pop_mode",X$="longer_alt",J$="line_breaks",Q$="start_chars_hint";function Yu(t){return xve(t)}function xve(t){const e=t.pattern,n={};if(n.name=t.name,sg(e)||(n.PATTERN=e),nr(t,Tve))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return nr(t,G$)&&(n.CATEGORIES=t[G$]),_T([n]),nr(t,q$)&&(n.LABEL=t[q$]),nr(t,W$)&&(n.GROUP=t[W$]),nr(t,Y$)&&(n.POP_MODE=t[Y$]),nr(t,K$)&&(n.PUSH_MODE=t[K$]),nr(t,X$)&&(n.LONGER_ALT=t[X$]),nr(t,J$)&&(n.LINE_BREAKS=t[J$]),nr(t,Q$)&&(n.START_CHARS_HINT=t[Q$]),n}const W0=Yu({name:"EOF",pattern:Na.NA});_T([W0]);function yT(t,e,n,r,i,s,o,a){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function Cve(t,e){return vT(t,e)}const xq={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Tq(t)?`--> ${tw(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+jh(e).image+"'";if(r)return s+r+a;{const c=uu(t,(h,f)=>h.concat(f),[]),l=Tn(c,h=>`[${Tn(h,f=>tw(f)).join(", ")}]`),d=`one of these possible Token sequences:
${Tn(l,(h,f)=>`  ${f+1}. ${h}`).join(`
`)}`;return s+d+a}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",o=`
but found: '`+jh(e).image+"'";if(n)return i+n+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${Tn(t,l=>`[${Tn(l,u=>tw(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(xq);const Rve={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},M0={buildDuplicateFoundError(t,e){function n(u){return u instanceof lo?u.terminalType.name:u instanceof du?u.nonTerminalName:""}const r=t.name,i=jh(e),s=i.idx,o=Yf(i),a=n(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=Tn(t.prefixPath,i=>tw(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=Tn(t.prefixPath,i=>tw(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=Yf(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=Tn(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof YE?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function Ave(t,e){const n=new Mve(t,e);return n.resolveRefs(),n.errors}class Mve extends my{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){pr(la(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Ml.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class Ive extends GA{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Cc(this.path.ruleStack).reverse(),this.occurrenceStack=Cc(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){xs(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class Ove extends Ive{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new hu({definition:i});this.possibleTokTypes=gT(s),this.found=!0}}}class WA extends GA{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class kve extends WA{walkMany(e,n,r){if(e.idx===this.occurrence){const i=jh(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof lo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class Z$ extends WA{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=jh(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof lo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class Nve extends WA{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=jh(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof lo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class eH extends WA{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=jh(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof lo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function AL(t,e,n=[]){n=Cc(n);let r=[],i=0;function s(a){return a.concat(Sc(t,i+1))}function o(a){const c=AL(s(a),e,n);return r.concat(c)}for(;n.length<e&&i<t.length;){const a=t[i];if(a instanceof hu)return o(a.definition);if(a instanceof du)return o(a.definition);if(a instanceof ou)r=o(a.definition);else if(a instanceof Ap){const c=a.definition.concat([new Oa({definition:a.definition})]);return o(c)}else if(a instanceof Mp){const c=[new hu({definition:a.definition}),new Oa({definition:[new lo({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Yh){const c=a.definition.concat([new Oa({definition:[new lo({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof Oa){const c=a.definition.concat([new Oa({definition:a.definition})]);r=o(c)}else{if(a instanceof Xh)return pr(a.definition,c=>{xs(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof lo)n.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Sc(t,i)}),r}function Cq(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],d=[];for(d.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!xs(d);){const h=d.pop();if(h===o){a&&gE(d).idx<=l&&d.pop();continue}const f=h.def,p=h.idx,g=h.ruleStack,v=h.occurrenceStack;if(xs(f))continue;const E=f[0];if(E===i){const T={idx:p,def:Sc(f),ruleStack:Ew(g),occurrenceStack:Ew(v)};d.push(T)}else if(E instanceof lo)if(p<c-1){const T=p+1,C=e[T];if(n(C,E.terminalType)){const A={idx:T,def:Sc(f),ruleStack:g,occurrenceStack:v};d.push(A)}}else if(p===c-1)u.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:g,occurrenceStack:v}),a=!0;else throw Error("non exhaustive match");else if(E instanceof du){const T=Cc(g);T.push(E.nonTerminalName);const C=Cc(v);C.push(E.idx);const A={idx:p,def:E.definition.concat(s,Sc(f)),ruleStack:T,occurrenceStack:C};d.push(A)}else if(E instanceof ou){const T={idx:p,def:Sc(f),ruleStack:g,occurrenceStack:v};d.push(T),d.push(o);const C={idx:p,def:E.definition.concat(Sc(f)),ruleStack:g,occurrenceStack:v};d.push(C)}else if(E instanceof Ap){const T=new Oa({definition:E.definition,idx:E.idx}),C=E.definition.concat([T],Sc(f)),A={idx:p,def:C,ruleStack:g,occurrenceStack:v};d.push(A)}else if(E instanceof Mp){const T=new lo({terminalType:E.separator}),C=new Oa({definition:[T].concat(E.definition),idx:E.idx}),A=E.definition.concat([C],Sc(f)),k={idx:p,def:A,ruleStack:g,occurrenceStack:v};d.push(k)}else if(E instanceof Yh){const T={idx:p,def:Sc(f),ruleStack:g,occurrenceStack:v};d.push(T),d.push(o);const C=new lo({terminalType:E.separator}),A=new Oa({definition:[C].concat(E.definition),idx:E.idx}),k=E.definition.concat([A],Sc(f)),I={idx:p,def:k,ruleStack:g,occurrenceStack:v};d.push(I)}else if(E instanceof Oa){const T={idx:p,def:Sc(f),ruleStack:g,occurrenceStack:v};d.push(T),d.push(o);const C=new Oa({definition:E.definition,idx:E.idx}),A=E.definition.concat([C],Sc(f)),k={idx:p,def:A,ruleStack:g,occurrenceStack:v};d.push(k)}else if(E instanceof Xh)for(let T=E.definition.length-1;T>=0;T--){const C=E.definition[T],A={idx:p,def:C.definition.concat(Sc(f)),ruleStack:g,occurrenceStack:v};d.push(A),d.push(o)}else if(E instanceof hu)d.push({idx:p,def:E.definition.concat(Sc(f)),ruleStack:g,occurrenceStack:v});else if(E instanceof YE)d.push(Pve(E,p,g,v));else throw Error("non exhaustive match")}return u}function Pve(t,e,n,r){const i=Cc(n);i.push(t.name);const s=Cc(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var yo;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(yo||(yo={}));function Rq(t){if(t instanceof ou||t==="Option")return yo.OPTION;if(t instanceof Oa||t==="Repetition")return yo.REPETITION;if(t instanceof Ap||t==="RepetitionMandatory")return yo.REPETITION_MANDATORY;if(t instanceof Mp||t==="RepetitionMandatoryWithSeparator")return yo.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof Yh||t==="RepetitionWithSeparator")return yo.REPETITION_WITH_SEPARATOR;if(t instanceof Xh||t==="Alternation")return yo.ALTERNATION;throw Error("non exhaustive match")}function Dve(t,e,n,r,i,s){const o=MF(t,e,n),a=Iq(o)?sR:vT;return s(o,r,a,i)}function Lve(t,e,n,r,i,s){const o=IF(t,e,i,n),a=Iq(o)?sR:vT;return s(o[0],a,r)}function Uve(t,e,n,r){const i=t.length,s=Lh(t,o=>Lh(o,a=>a.length===1));if(e)return function(o){const a=Tn(o,c=>c.GATE);for(let c=0;c<i;c++){const l=t[c],u=l.length,d=a[c];if(!(d!==void 0&&d.call(this)===!1))e:for(let h=0;h<u;h++){const f=l[h],p=f.length;for(let g=0;g<p;g++){const v=this.LA(g+1);if(n(v,f[g])===!1)continue e}return c}}};if(s&&!r){const o=Tn(t,c=>su(c)),a=uu(o,(c,l,u)=>(pr(l,d=>{nr(c,d.tokenTypeIdx)||(c[d.tokenTypeIdx]=u),pr(d.categoryMatches,h=>{nr(c,h)||(c[h]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=t[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],d=u.length;for(let h=0;h<d;h++){const f=this.LA(h+1);if(n(f,u[h])===!1)continue e}return o}}}}function Fve(t,e,n){const r=Lh(t,s=>s.length===1),i=t.length;if(r&&!n){const s=su(t);if(s.length===1&&xs(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=uu(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,pr(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=t[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class Bve extends GA{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,yo.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,yo.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,yo.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,yo.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,yo.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class Aq extends my{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,yo.OPTION)}visitRepetition(e){this.checkIsTarget(e,yo.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,yo.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,yo.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,yo.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,yo.ALTERNATION)}}function tH(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function zN(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function jve(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function Mq(t,e){const n=Tn(t,o=>AL([o],1)),r=tH(n.length),i=Tn(n,o=>{const a={};return pr(o,c=>{const l=zN(c.partialPath);pr(l,u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=e;o++){const a=s;s=tH(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const d=l[u].partialPath,h=l[u].suffixDef,f=zN(d);if(jve(i,f,c)||xs(h)||d.length===e){const g=r[c];if(ML(g,d)===!1){g.push(d);for(let v=0;v<f.length;v++){const E=f[v];i[c][E]=!0}}}else{const g=AL(h,o+1,d);s[c]=s[c].concat(g),pr(g,v=>{const E=zN(v.partialPath);pr(E,T=>{i[c][T]=!0})})}}}}return r}function MF(t,e,n,r){const i=new Aq(t,yo.ALTERNATION,r);return e.accept(i),Mq(i.result,n)}function IF(t,e,n,r){const i=new Aq(t,n);e.accept(i);const s=i.result,a=new Bve(e,t,n).startWalking(),c=new hu({definition:s}),l=new hu({definition:a});return Mq([c,l],r)}function ML(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function $ve(t,e){return t.length<e.length&&Lh(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Iq(t){return Lh(t,e=>Lh(e,n=>Lh(n,r=>xs(r.categoryMatches))))}function Hve(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return Tn(e,n=>Object.assign({type:Ml.CUSTOM_LOOKAHEAD_VALIDATION},n))}function Vve(t,e,n,r){const i=Md(t,c=>zve(c,n)),s=n_e(t,e,n),o=Md(t,c=>Qve(c,n)),a=Md(t,c=>Wve(c,t,r,n));return i.concat(s,o,a)}function zve(t,e){const n=new qve;t.accept(n);const r=n.allProductions,i=dq(r,Gve),s=Kh(i,a=>a.length>1);return Tn(la(s),a=>{const c=jh(a),l=e.buildDuplicateFoundError(t,a),u=Yf(c),d={message:l,type:Ml.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:c.idx},h=Oq(c);return h&&(d.parameter=h),d})}function Gve(t){return`${Yf(t)}_#_${t.idx}_#_${Oq(t)}`}function Oq(t){return t instanceof lo?t.terminalType.name:t instanceof du?t.nonTerminalName:""}class qve extends my{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function Wve(t,e,n,r){const i=[];if(uu(e,(o,a)=>a.name===t.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:o,type:Ml.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function Kve(t,e,n){const r=[];let i;return kl(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Ml.INVALID_RULE_OVERRIDE,ruleName:t})),r}function kq(t,e,n,r=[]){const i=[],s=d1(e.definition);if(xs(s))return[];{const o=t.name;kl(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:Ml.LEFT_RECURSION,ruleName:o});const c=HA(s,r.concat([t])),l=Md(c,u=>{const d=Cc(r);return d.push(u),kq(t,u,n,d)});return i.concat(l)}}function d1(t){let e=[];if(xs(t))return e;const n=jh(t);if(n instanceof du)e.push(n.referencedRule);else if(n instanceof hu||n instanceof ou||n instanceof Ap||n instanceof Mp||n instanceof Yh||n instanceof Oa)e=e.concat(d1(n.definition));else if(n instanceof Xh)e=su(Tn(n.definition,s=>d1(s.definition)));else if(!(n instanceof lo))throw Error("non exhaustive match");const r=tR(n),i=t.length>1;if(r&&i){const s=Sc(t);return e.concat(d1(s))}else return e}class OF extends my{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function Yve(t,e){const n=new OF;t.accept(n);const r=n.alternations;return Md(r,s=>{const o=Ew(s.definition);return Md(o,(a,c)=>{const l=Cq([a],[],vT,1);return xs(l)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:c}),type:Ml.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:c+1}]:[]})})}function Xve(t,e,n){const r=new OF;t.accept(r);let i=r.alternations;return i=VA(i,o=>o.ignoreAmbiguities===!0),Md(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=MF(a,t,c,o),u=e_e(l,o,t,n),d=t_e(l,o,t,n);return u.concat(d)})}class Jve extends my{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function Qve(t,e){const n=new OF;t.accept(n);const r=n.alternations;return Md(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:Ml.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function Zve(t,e,n){const r=[];return pr(t,i=>{const s=new Jve;i.accept(s);const o=s.allProductions;pr(o,a=>{const c=Rq(a),l=a.maxLookahead||e,u=a.idx,h=IF(u,i,c,l)[0];if(xs(su(h))){const f=n.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:f,type:Ml.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function e_e(t,e,n,r){const i=[],s=uu(t,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||pr(c,u=>{const d=[l];pr(t,(h,f)=>{l!==f&&ML(h,u)&&e.definition[f].ignoreAmbiguities!==!0&&d.push(f)}),d.length>1&&!ML(i,u)&&(i.push(u),a.push({alts:d,path:u}))}),a),[]);return Tn(s,a=>{const c=Tn(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Ml.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:a.alts}})}function t_e(t,e,n,r){const i=uu(t,(o,a,c)=>{const l=Tn(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return mT(Md(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Ud(i,h=>e.definition[h.idx].ignoreAmbiguities!==!0&&h.idx<c&&$ve(h.path,l));return Tn(u,h=>{const f=[h.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:f,prefixPath:h.path}),type:Ml.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:p,alternatives:f}})}))}function n_e(t,e,n){const r=[],i=Tn(e,s=>s.name);return pr(t,s=>{const o=s.name;if(kl(i,o)){const a=n.buildNamespaceConflictError(s);r.push({message:a,type:Ml.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function r_e(t){const e=xF(t,{errMsgProvider:Rve}),n={};return pr(t.rules,r=>{n[r.name]=r}),Ave(n,e.errMsgProvider)}function i_e(t){return t=xF(t,{errMsgProvider:M0}),Vve(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const Nq="MismatchedTokenException",Pq="NoViableAltException",Dq="EarlyExitException",Lq="NotAllInputParsedException",Uq=[Nq,Pq,Dq,Lq];Object.freeze(Uq);function oR(t){return kl(Uq,t.name)}class KA extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Fq extends KA{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Nq}}class s_e extends KA{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Pq}}class o_e extends KA{constructor(e,n){super(e,n),this.name=Lq}}class a_e extends KA{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Dq}}const GN={},Bq="InRuleRecoveryException";class c_e extends Error{constructor(e){super(e),this.name=Bq}}class l_e{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=nr(e,"recoveryEnabled")?e.recoveryEnabled:og.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=u_e)}getTokenToInsert(e){const n=yT(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const d=()=>{const h=this.LA(0),f=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:h,ruleName:this.getCurrRuleFullName()}),p=new Fq(f,l,this.LA(0));p.resyncedTokens=Ew(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){d();return}else if(r.call(this)){d(),e.apply(this,n);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new c_e("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||xs(n))return!1;const r=this.LA(1);return vE(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return kl(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=vE(e,s=>Cve(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return GN;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Tn(e,(r,i)=>i===0?GN:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=Tn(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return su(e)}getFollowSetFromFollowKey(e){if(e===GN)return[W0];const n=e.ruleName+e.idxInCallingRule+mq+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,W0)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return Ew(n)}attemptInRepetitionRecovery(e,n,r,i,s,o,a){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Cc(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return Tn(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function u_e(t,e,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const h=this.getCurrRuleFullName(),f=this.getGAstProductions()[h];c=new s(f,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const d=c.isEndOfRule;this.RULE_STACK.length===1&&d&&l===void 0&&(l=W0,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(t,e,n,l)}const d_e=4,T_=8,jq=1<<T_,$q=2<<T_,IL=3<<T_,OL=4<<T_,kL=5<<T_,h1=6<<T_;function qN(t,e,n){return n|e|t}class h_e{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:og.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(xs(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Md(e,n=>kq(n,n,M0))}validateEmptyOrAlternatives(e){return Md(e,n=>Yve(n,M0))}validateAmbiguousAlternationAlternatives(e,n){return Md(e,r=>Xve(r,n,M0))}validateSomeNonEmptyLookaheadPath(e,n){return Zve(e,n,M0)}buildLookaheadForAlternation(e){return Dve(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,Uve)}buildLookaheadForOptional(e){return Lve(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Rq(e.prodType),Fve)}}class f_e{initLooksAhead(e){this.dynamicTokensEnabled=nr(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:og.dynamicTokensEnabled,this.maxLookahead=nr(e,"maxLookahead")?e.maxLookahead:og.maxLookahead,this.lookaheadStrategy=nr(e,"lookaheadStrategy")?e.lookaheadStrategy:new h_e({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){pr(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=m_e(n);pr(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${Yf(l)}${u}`,()=>{const d=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:n,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),h=qN(this.fullRuleNameToShort[n.name],jq,l.idx);this.setLaFuncCache(h,d)})}),pr(i,l=>{this.computeLookaheadFunc(n,l.idx,IL,"Repetition",l.maxLookahead,Yf(l))}),pr(s,l=>{this.computeLookaheadFunc(n,l.idx,$q,"Option",l.maxLookahead,Yf(l))}),pr(o,l=>{this.computeLookaheadFunc(n,l.idx,OL,"RepetitionMandatory",l.maxLookahead,Yf(l))}),pr(a,l=>{this.computeLookaheadFunc(n,l.idx,h1,"RepetitionMandatoryWithSeparator",l.maxLookahead,Yf(l))}),pr(c,l=>{this.computeLookaheadFunc(n,l.idx,kL,"RepetitionWithSeparator",l.maxLookahead,Yf(l))})})})}computeLookaheadFunc(e,n,r,i,s,o){this.TRACE_INIT(`${o}${n===0?"":n}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=qN(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return qN(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class p_e extends my{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const cC=new p_e;function m_e(t){cC.reset(),t.accept(cC);const e=cC.dslMethods;return cC.reset(),e}function nH(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function rH(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function g_e(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function v_e(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const __e="name";function Hq(t,e){Object.defineProperty(t,__e,{enumerable:!1,configurable:!0,writable:!1,value:e})}function y_e(t,e){const n=Nd(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],o=t[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function b_e(t,e){const n=function(){};Hq(n,t+"BaseSemantics");const r={visit:function(i,s){if(Ri(i)&&(i=i[0]),!sg(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=S_e(this,e);if(!xs(i)){const s=Tn(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function E_e(t,e,n){const r=function(){};Hq(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return pr(e,s=>{i[s]=y_e}),r.prototype=i,r.prototype.constructor=r,r}var NL;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(NL||(NL={}));function S_e(t,e){return w_e(t,e)}function w_e(t,e){const n=Ud(e,i=>pg(t[i])===!1),r=Tn(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:NL.MISSING_METHOD,methodName:i}));return mT(r)}class T_e{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=nr(e,"nodeLocationTracking")?e.nodeLocationTracking:og.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=Ra,this.cstFinallyStateUpdate=Ra,this.cstPostTerminal=Ra,this.cstPostNonTerminal=Ra,this.cstPostRule=Ra;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=rH,this.setNodeLocationFromNode=rH,this.cstPostRule=Ra,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=Ra,this.setNodeLocationFromNode=Ra,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=nH,this.setNodeLocationFromNode=nH,this.cstPostRule=Ra,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=Ra,this.setNodeLocationFromNode=Ra,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=Ra,this.setNodeLocationFromNode=Ra,this.cstPostRule=Ra,this.setInitialNodeLocation=Ra;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];g_e(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];v_e(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(sg(this.baseCstVisitorConstructor)){const e=b_e(this.className,Nd(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(sg(this.baseCstVisitorWithDefaultsConstructor)){const e=E_e(this.className,Nd(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class x_e{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):cR}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?cR:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class C_e{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=lR){if(kl(this.definedRulesNames,e)){const o={message:M0.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Ml.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=lR){const i=Kve(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(oR(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return Age(la(this.gastProductionsCache))}}class R_e{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=sR,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},nr(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(Ri(e)){if(xs(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(Ri(e))this.tokensMap=uu(e,(s,o)=>(s[o.name]=o,s),{});else if(nr(e,"modes")&&Lh(su(la(e.modes)),Sve)){const s=su(la(e.modes)),o=zA(s);this.tokensMap=uu(o,(a,c)=>(a[c.name]=c,a),{})}else if(kd(e))this.tokensMap=Cc(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=W0;const r=nr(e,"modes")?su(la(e.modes)):la(e),i=Lh(r,s=>xs(s.categoryMatches));this.tokenMatcher=i?sR:vT,_T(la(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=nr(r,"resyncEnabled")?r.resyncEnabled:lR.resyncEnabled,s=nr(r,"recoveryValueFunc")?r.recoveryValueFunc:lR.recoveryValueFunc,o=this.ruleShortNameIdx<<d_e+T_;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u);const d=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(d),d}catch(d){return this.invokeRuleCatch(d,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),n.apply(this,u)}catch(d){return this.invokeRuleCatch(d,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(oR(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead($q,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(OL,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=n;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,yo.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,OL,e,Nve)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(h1,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,eH],a,h1,e,eH)}else throw this.raiseEarlyExitException(e,yo.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(IL,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=n;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,IL,e,kve,o)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(kL,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,Z$],a,kL,e,Z$)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,h1,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(jq,n),i=Ri(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new o_e(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw oR(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Fq(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===Bq?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Cc(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),W0)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class A_e{initErrorHandler(e){this._errors=[],this.errorMessageProvider=nr(e,"errorMessageProvider")?e.errorMessageProvider:og.errorMessageProvider}SAVE_ERROR(e){if(oR(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Cc(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Cc(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=IF(e,s,n,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new a_e(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=MF(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new s_e(c,this.LA(1),a))}}class M_e{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(sg(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Cq([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=jh(e.ruleStack),i=this.getGAstProductions()[n];return new Ove(i,e).startWalking()}}const YA={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(YA);const iH=!0,sH=Math.pow(2,T_)-1,Vq=Yu({name:"RECORDING_PHASE_TOKEN",pattern:Na.NA});_T([Vq]);const zq=yT(Vq,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(zq);const I_e={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class O_e{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return cR}topLevelRuleRecord(e,n){try{const r=new YE({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return ES.call(this,ou,e,n)}atLeastOneInternalRecord(e,n){ES.call(this,Ap,n,e)}atLeastOneSepFirstInternalRecord(e,n){ES.call(this,Mp,n,e,iH)}manyInternalRecord(e,n){ES.call(this,Oa,n,e)}manySepFirstInternalRecord(e,n){ES.call(this,Yh,n,e,iH)}orInternalRecord(e,n){return k_e.call(this,e,n)}subruleInternalRecord(e,n,r){if(aR(n),!e||nr(e,"ruleName")===!1){const a=new Error(`<SUBRULE${oH(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=gE(this.recordingProdStack),s=e.ruleName,o=new du({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?I_e:YA}consumeInternalRecord(e,n,r){if(aR(n),!wq(e)){const o=new Error(`<CONSUME${oH(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=gE(this.recordingProdStack),s=new lo({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),zq}}function ES(t,e,n,r=!1){aR(n);const i=gE(this.recordingProdStack),s=pg(e)?e:e.DEF,o=new t({definition:[],idx:n});return r&&(o.separator=e.SEP),nr(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),YA}function k_e(t,e){aR(e);const n=gE(this.recordingProdStack),r=Ri(t)===!1,i=r===!1?t:t.DEF,s=new Xh({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});nr(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const o=CF(i,a=>pg(a.GATE));return s.hasPredicates=o,n.definition.push(s),pr(i,a=>{const c=new hu({definition:[]});s.definition.push(c),nr(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:nr(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),YA}function oH(t){return t===0?"":`${t}`}function aR(t){if(t<0||t>sH){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${sH+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class N_e{initPerformanceTracer(e){if(nr(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=og.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=fq(n),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function P_e(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const cR=yT(W0,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(cR);const og=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:xq,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),lR=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Ml;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Ml||(Ml={}));let kF=class Gq{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{pq(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),pr(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=r_e({rules:la(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(xs(r)&&this.skipValidations===!1){const i=i_e({rules:la(this.gastProductionsCache),tokenTypes:la(this.tokensMap),errMsgProvider:M0,grammarName:n}),s=Hve({lookaheadStrategy:this.lookaheadStrategy,rules:la(this.gastProductionsCache),tokenTypes:la(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),xs(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=Dge(la(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:la(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(la(this.gastProductionsCache))})),!Gq.DEFER_DEFINITION_ERRORS_HANDLING&&!xs(this.definitionErrors))throw e=Tn(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),nr(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=nr(n,"skipValidations")?n.skipValidations:og.skipValidations}};kF.DEFER_DEFINITION_ERRORS_HANDLING=!1;P_e(kF,[l_e,f_e,T_e,x_e,R_e,C_e,A_e,M_e,O_e,N_e]);class D_e extends kF{constructor(e,n=og){const r=Cc(n);r.outputCst=!0,super(e,r)}}function L_e(t){const e=new U_e,n=la(t);return Tn(n,r=>e.visitRule(r))}class U_e extends my{visitRule(e){const n=this.visitEach(e.definition),r=dq(n,s=>s.propertyName),i=Tn(r,(s,o)=>{const a=!CF(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=Tn(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:lC(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:lC(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:lC(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:lC(e)}]}visitEachAndOverrideWith(e,n){return Tn(this.visitEach(e),r=>cu({},r,n))}visitEach(e){return su(Tn(e,n=>this.visit(n)))}}function lC(t){return t instanceof du?{kind:"rule",name:t.referencedRule.name}:{kind:"token"}}function F_e(t,e){let n=[];return n=n.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),n=n.concat(su(Tn(t,r=>B_e(r)))),e.includeVisitorInterface&&(n=n.concat(V_e(e.visitorInterfaceName,t))),n.join(`

`)+`
`}function B_e(t){const e=j_e(t),n=$_e(t);return[e,n]}function j_e(t){const e=qq(t.name),n=NF(t.name);return`export interface ${e} extends CstNode {
  name: "${t.name}";
  children: ${n};
}`}function $_e(t){return`export type ${NF(t.name)} = {
  ${Tn(t.properties,n=>H_e(n)).join(`
  `)}
};`}function H_e(t){const e=G_e(t.type);return`${t.name}${t.optional?"?":""}: ${e}[];`}function V_e(t,e){return`export interface ${t}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${Tn(e,n=>z_e(n)).join(`
  `)}
}`}function z_e(t){const e=NF(t.name);return`${t.name}(children: ${e}, param?: IN): OUT;`}function G_e(t){if(Ri(t)){const e=zA(Tn(t,r=>aH(r)));return"("+uu(e,(r,i)=>r+" | "+i)+")"}else return aH(t)}function aH(t){return t.kind==="token"?"IToken":qq(t.name)}function qq(t){return JG(t)+"CstNode"}function NF(t){return JG(t)+"CstChildren"}const q_e={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function W_e(t,e){const n=Object.assign(Object.assign({},q_e),e),r=L_e(t);return F_e(r,n)}const PL=14,_E=3,Gv=8,qv=14,Rd=16,DL=16,Wq=16;var v0=(t=>(t[t.BLANK=0]="BLANK",t[t.TILES=1]="TILES",t[t.SPRITES=2]="SPRITES",t[t.DITHER=3]="DITHER",t[t.MEDIA=4]="MEDIA",t[t.CONTROL=5]="CONTROL",t))(v0||{});function K_e(t){let e=0,n=0,r=0,i=0,s=1;return t.forEach(o=>{switch(o.type){case 1:e=Math.max(e,o.width),n=Math.max(n,o.height);break;case 3:e=Math.max(e,o.width),n=Math.max(n,o.height);break;case 5:r=o.focusx,i=o.focusy,s=o.viewscale;break}}),{width:e,height:n,focusx:r,focusy:i,viewscale:s}}function x_(t,e){return`${t}:${e}`}const Kq=1,Yq=16,Xq=256;var Kt=(t=>(t[t.NONE=0]="NONE",t[t.ALT=1]="ALT",t[t.CTRL=2]="CTRL",t[t.SHIFT=3]="SHIFT",t[t.MOVE_UP=4]="MOVE_UP",t[t.MOVE_DOWN=5]="MOVE_DOWN",t[t.MOVE_LEFT=6]="MOVE_LEFT",t[t.MOVE_RIGHT=7]="MOVE_RIGHT",t[t.OK_BUTTON=8]="OK_BUTTON",t[t.CANCEL_BUTTON=9]="CANCEL_BUTTON",t[t.MENU_BUTTON=10]="MENU_BUTTON",t))(Kt||{});const fp=!!JSON.parse("false"),Y_e=!!JSON.parse("false"),X_e=!!JSON.parse("false"),J_e=!!JSON.parse("false");JSON.parse("false");const Q_e=!!JSON.parse("false"),Z_e=!!JSON.parse("false"),e0e=!!JSON.parse("false"),ar={HALT_AT_COUNT:256,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Gv*ar.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return qv*ar.DRAW_CHAR_SCALE}};function PF(t,e,n){typeof t!="number"&&(t=0,e=0,n=1),typeof e!="number"&&(e=t,t=0,n=1),typeof n!="number"&&(n=1);const r=[],i=Math.min(t,e),s=Math.max(t,e);for(let o=i;o<=s;o+=n)r.push(o);return r}function t0e(t){return t[Fv(0,t.length-1)]}function n0e(t,e){return e[fG(t,0,e.length-1)]}function Hu(...t){return t0e(t.flat())}function Jq(t,...e){return n0e(t,e.flat())}function r0e(t){return[...new Set(t)].filter(he)}var Qq={exports:{}},WN={exports:{}},cH;function i0e(){return cH||(cH=1,function(t,e){(function(n,r){t.exports=r()})(xc,function(){function n(g){return!isNaN(parseFloat(g))&&isFinite(g)}function r(g){return g.charAt(0).toUpperCase()+g.substring(1)}function i(g){return function(){return this[g]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function d(g){if(g)for(var v=0;v<u.length;v++)g[u[v]]!==void 0&&this["set"+r(u[v])](g[u[v]])}d.prototype={getArgs:function(){return this.args},setArgs:function(g){if(Object.prototype.toString.call(g)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=g},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(g){if(g instanceof d)this.evalOrigin=g;else if(g instanceof Object)this.evalOrigin=new d(g);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var g=this.getFileName()||"",v=this.getLineNumber()||"",E=this.getColumnNumber()||"",T=this.getFunctionName()||"";return this.getIsEval()?g?"[eval] ("+g+":"+v+":"+E+")":"[eval]:"+v+":"+E:T?T+" ("+g+":"+v+":"+E+")":g+":"+v+":"+E}},d.fromString=function(v){var E=v.indexOf("("),T=v.lastIndexOf(")"),C=v.substring(0,E),A=v.substring(E+1,T).split(","),k=v.substring(T+1);if(k.indexOf("@")===0)var I=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(k,""),N=I[1],U=I[2],F=I[3];return new d({functionName:C,args:A||void 0,fileName:N,lineNumber:U||void 0,columnNumber:F||void 0})};for(var h=0;h<s.length;h++)d.prototype["get"+r(s[h])]=i(s[h]),d.prototype["set"+r(s[h])]=function(g){return function(v){this[g]=!!v}}(s[h]);for(var f=0;f<o.length;f++)d.prototype["get"+r(o[f])]=i(o[f]),d.prototype["set"+r(o[f])]=function(g){return function(v){if(!n(v))throw new TypeError(g+" must be a Number");this[g]=Number(v)}}(o[f]);for(var p=0;p<a.length;p++)d.prototype["get"+r(a[p])]=i(a[p]),d.prototype["set"+r(a[p])]=function(g){return function(v){this[g]=String(v)}}(a[p]);return d})}(WN)),WN.exports}(function(t,e){(function(n,r){t.exports=r(i0e())})(xc,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var d=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),h=d.match(/ (\(.+\)$)/);d=h?d.replace(h[0],""):d;var f=this.extractLocation(h?h[1]:d),p=h&&d||void 0,g=["eval","<anonymous>"].indexOf(f[0])>-1?void 0:f[0];return new r({functionName:p,fileName:g,lineNumber:f[1],columnNumber:f[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var d=/((.*".+"[^@]*)?[^@]*)(?:@)/,h=u.match(d),f=h&&h[1]?h[1]:void 0,p=this.extractLocation(u.replace(d,""));return new r({functionName:f,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),d=[],h=2,f=u.length;h<f;h+=2){var p=l.exec(u[h]);p&&d.push(new r({fileName:p[2],lineNumber:p[1],source:u[h]}))}return d},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),d=[],h=0,f=u.length;h<f;h+=2){var p=l.exec(u[h]);p&&d.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[h]}))}return d},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var d=u.split("@"),h=this.extractLocation(d.pop()),f=d.shift()||"",p=f.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,g;f.match(/\(([^)]*)\)/)&&(g=f.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var v=g===void 0||g==="[arguments not available]"?void 0:g.split(",");return new r({functionName:p,args:v,fileName:h[0],lineNumber:h[1],columnNumber:h[2],source:u})},this)}}})})(Qq);var s0e=Qq.exports;const o0e=Yc(s0e),qe=Wh("SOFTWARE");function vg(t){const e={},n={get(){return[!1,void 0]},set(){return[!1,void 0]},tick(){},everytick(){},...t,getcommand(r){return e[r]},command(r,i){return e[r]=i,n}};return n}function ao(t){return`${t??""}`}function VS(t,e){const n=parseFloat(ao(t));return isNaN(n)?e:n}function tc(t,e){return typeof t==typeof e?t:e}function a0e(t,e){return t%e}function c0e(t,e){return Math.floor(t/e)}function lH(t,e){return{x:a0e(t,e),y:c0e(t,e)}}function Sw(t,e){return t.x+t.y*e}function a0(t,e,n,r,i,s){return t>=s&&t<=r&&e>=n&&e<=i}function XE(t){return he(t)&&he(t.x)&&he(t.y)}function wa(t,e){switch(e){case pn.NORTH:--t.y;break;case pn.SOUTH:++t.y;break;case pn.WEST:--t.x;break;case pn.EAST:++t.x;break}return t}function Mv(t,e){const n=e.x-t.x,r=e.y-t.y;if(n<0)return pn.WEST;if(n>0)return pn.EAST;if(r<0)return pn.NORTH;if(r>0)return pn.SOUTH}const Zq={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",edit:"EDIT"};function kh(t){return Lr(t)&&eW(t[0])}function eW(t){return he(pn[t])&&Yn(t)}function l0e(t){const e=pn[t];return he(e)?e:pn.IDLE}function tW(t){if(Yn(t))return Zq[rr(t)]}function uH(t){if(kh(t))return t;if(eW(t))return[t];const e=tW(t);if(he(e))return[e]}function dH(t){const e=_e.words[t],n=uH(e);if(kh(n))return[n,t+1];const[r,i]=Qa(t),s=uH(r);return kh(s)?[s,i]:[void 0,t]}function LL(t){const e=[];let[n,r]=dH(t);for(;kh(n);){if(e.push(...n),(n[0]==="AT"||n[0]==="BY")&&n.length<2){const[o,a,c]=Mt(_e.words,r,[lt.NUMBER,lt.NUMBER]);e.push(o,a),r=c}const[i,s]=dH(r);n=i,r=s}return e.length?[e,r]:[void 0,t]}function yE(t){return Lr(t)&&typeof t[0]=="string"}function hH(t){const e=_e.words[t];if(yE(e))return[e,t+1];const[n,r]=xR(t),[i,s]=Qa(r);return Yn(i)?[[i,n],s]:[void 0,t]}function uR(t){if(!yE(t))return;const[e]=t;return e}function nW(t){if(!yE(t))return;const[,e]=t,n=he(e)?sK(e):void 0;return he(n)?n:void 0}function rW(t){if(!yE(t))return;const[,e]=t,n=he(e)?sxe(e):void 0;return he(n)?n:void 0}const ts=60,Il=25;var Ur=(t=>(t[t.ERROR=0]="ERROR",t[t.LOADER=1]="LOADER",t[t.BOARD=2]="BOARD",t[t.OBJECT=3]="OBJECT",t[t.TERRAIN=4]="TERRAIN",t[t.CHARSET=5]="CHARSET",t[t.PALETTE=6]="PALETTE",t))(Ur||{});function iW(t,e){const n=t??Gi.ISWALK,r=e??Gi.ISWALK;switch(n){case Gi.ISWALK:return r!==Gi.ISWALK;case Gi.ISSWIM:return r!==Gi.ISSWIM;case Gi.ISSOLID:return!0;case Gi.ISBULLET:return r!==Gi.ISWALK&&r!==Gi.ISSWIM}}function dR(t,e,n){const r=t==null?void 0:t.objects[n];if(he(r))return r;if(he(e)){const i=bT(t,"player"),s={x:e.x??0,y:e.y??0};aW(s,i)}}function bT(t,e){var r,i;return[...((i=(r=t==null?void 0:t.named)==null?void 0:r[e])==null?void 0:i.values())??[]].map(s=>typeof s=="string"?t==null?void 0:t.objects[s]:t==null?void 0:t.terrain[s]).filter(he)}function sW(t,e){const n=uR(e),r=nW(e),i=rW(e);return t.filter(s=>{var o,a,c;return!(he(n)&&rr((s==null?void 0:s.name)??((o=s==null?void 0:s.kinddata)==null?void 0:o.name)??"")!==n||he(r)&&((s==null?void 0:s.color)??((a=s==null?void 0:s.kinddata)==null?void 0:a.color)??cr.WHITE)!==r||he(i)&&((s==null?void 0:s.bg)??((c=s==null?void 0:s.kinddata)==null?void 0:c.bg)??cr.BLACK)!==i)}).filter(he)}function oW(t,e){return he(t)?e.map(n=>{var r;if(typeof n=="string"){const i=t.objects[n];if(he(i))return i;const s=bT(t,rr(n));if(s.length)return s}else if(XE(n)&&n.x>=0&&n.x<ts&&n.y>=0&&n.y<Il){const i=n.x+n.y*ts,s=(r=t.lookup)==null?void 0:r[i];return he(s)?t.objects[s]:t.terrain[i]}}).flat().filter(he):[]}function aW(t,e){let n=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=t.x-(s.x??0),a=t.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<n)&&(n=c,r=s)}}return r}var Ba={},XA={};XA.byteLength=h0e;XA.toByteArray=p0e;XA.fromByteArray=v0e;var ep=[],yd=[],u0e=typeof Uint8Array<"u"?Uint8Array:Array,KN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var cb=0,d0e=KN.length;cb<d0e;++cb)ep[cb]=KN[cb],yd[KN.charCodeAt(cb)]=cb;yd[45]=62;yd[95]=63;function cW(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function h0e(t){var e=cW(t),n=e[0],r=e[1];return(n+r)*3/4-r}function f0e(t,e,n){return(e+n)*3/4-n}function p0e(t){var e,n=cW(t),r=n[0],i=n[1],s=new u0e(f0e(t,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=yd[t.charCodeAt(c)]<<18|yd[t.charCodeAt(c+1)]<<12|yd[t.charCodeAt(c+2)]<<6|yd[t.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=yd[t.charCodeAt(c)]<<2|yd[t.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=yd[t.charCodeAt(c)]<<10|yd[t.charCodeAt(c+1)]<<4|yd[t.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function m0e(t){return ep[t>>18&63]+ep[t>>12&63]+ep[t>>6&63]+ep[t&63]}function g0e(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(m0e(r));return i.join("")}function v0e(t){for(var e,n=t.length,r=n%3,i=[],s=16383,o=0,a=n-r;o<a;o+=s)i.push(g0e(t,o,o+s>a?a:o+s));return r===1?(e=t[n-1],i.push(ep[e>>2]+ep[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(ep[e>>10]+ep[e>>4&63]+ep[e<<2&63]+"=")),i.join("")}var DF={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */DF.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,d=n?i-1:0,h=n?-1:1,f=t[e+d];for(d+=h,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=s*256+t[e+d],d+=h,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+t[e+d],d+=h,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(f?-1:1)*o*Math.pow(2,s-r)};DF.write=function(t,e,n,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,d=u>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+d>=1?e+=h/c:e+=h*Math.pow(2,1-d),e*c>=2&&(o++,c/=2),o+d>=u?(a=0,o=u):o+d>=1?(a=(e*c-1)*Math.pow(2,i),o=o+d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=a&255,f+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+f]=o&255,f+=p,o/=256,l-=8);t[n+f-p]|=g*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=XA,n=DF,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=u,t.SlowBuffer=k,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const oe=new s(1),j={foo:function(){return 42}};return Object.setPrototypeOf(j,s.prototype),Object.setPrototypeOf(oe,j),oe.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(oe){if(oe>i)throw new RangeError('The value "'+oe+'" is invalid for option "size"');const j=new s(oe);return Object.setPrototypeOf(j,u.prototype),j}function u(oe,j,V){if(typeof oe=="number"){if(typeof j=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(oe)}return d(oe,j,V)}u.poolSize=8192;function d(oe,j,V){if(typeof oe=="string")return g(oe,j);if(o.isView(oe))return E(oe);if(oe==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof oe);if(je(oe,o)||oe&&je(oe.buffer,o)||typeof a<"u"&&(je(oe,a)||oe&&je(oe.buffer,a)))return T(oe,j,V);if(typeof oe=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const fe=oe.valueOf&&oe.valueOf();if(fe!=null&&fe!==oe)return u.from(fe,j,V);const Ie=C(oe);if(Ie)return Ie;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof oe[Symbol.toPrimitive]=="function")return u.from(oe[Symbol.toPrimitive]("string"),j,V);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof oe)}u.from=function(oe,j,V){return d(oe,j,V)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function h(oe){if(typeof oe!="number")throw new TypeError('"size" argument must be of type number');if(oe<0)throw new RangeError('The value "'+oe+'" is invalid for option "size"')}function f(oe,j,V){return h(oe),oe<=0?l(oe):j!==void 0?typeof V=="string"?l(oe).fill(j,V):l(oe).fill(j):l(oe)}u.alloc=function(oe,j,V){return f(oe,j,V)};function p(oe){return h(oe),l(oe<0?0:A(oe)|0)}u.allocUnsafe=function(oe){return p(oe)},u.allocUnsafeSlow=function(oe){return p(oe)};function g(oe,j){if((typeof j!="string"||j==="")&&(j="utf8"),!u.isEncoding(j))throw new TypeError("Unknown encoding: "+j);const V=I(oe,j)|0;let fe=l(V);const Ie=fe.write(oe,j);return Ie!==V&&(fe=fe.slice(0,Ie)),fe}function v(oe){const j=oe.length<0?0:A(oe.length)|0,V=l(j);for(let fe=0;fe<j;fe+=1)V[fe]=oe[fe]&255;return V}function E(oe){if(je(oe,s)){const j=new s(oe);return T(j.buffer,j.byteOffset,j.byteLength)}return v(oe)}function T(oe,j,V){if(j<0||oe.byteLength<j)throw new RangeError('"offset" is outside of buffer bounds');if(oe.byteLength<j+(V||0))throw new RangeError('"length" is outside of buffer bounds');let fe;return j===void 0&&V===void 0?fe=new s(oe):V===void 0?fe=new s(oe,j):fe=new s(oe,j,V),Object.setPrototypeOf(fe,u.prototype),fe}function C(oe){if(u.isBuffer(oe)){const j=A(oe.length)|0,V=l(j);return V.length===0||oe.copy(V,0,0,j),V}if(oe.length!==void 0)return typeof oe.length!="number"||Fe(oe.length)?l(0):v(oe);if(oe.type==="Buffer"&&Array.isArray(oe.data))return v(oe.data)}function A(oe){if(oe>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return oe|0}function k(oe){return+oe!=oe&&(oe=0),u.alloc(+oe)}u.isBuffer=function(j){return j!=null&&j._isBuffer===!0&&j!==u.prototype},u.compare=function(j,V){if(je(j,s)&&(j=u.from(j,j.offset,j.byteLength)),je(V,s)&&(V=u.from(V,V.offset,V.byteLength)),!u.isBuffer(j)||!u.isBuffer(V))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(j===V)return 0;let fe=j.length,Ie=V.length;for(let Ue=0,dt=Math.min(fe,Ie);Ue<dt;++Ue)if(j[Ue]!==V[Ue]){fe=j[Ue],Ie=V[Ue];break}return fe<Ie?-1:Ie<fe?1:0},u.isEncoding=function(j){switch(String(j).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(j,V){if(!Array.isArray(j))throw new TypeError('"list" argument must be an Array of Buffers');if(j.length===0)return u.alloc(0);let fe;if(V===void 0)for(V=0,fe=0;fe<j.length;++fe)V+=j[fe].length;const Ie=u.allocUnsafe(V);let Ue=0;for(fe=0;fe<j.length;++fe){let dt=j[fe];if(je(dt,s))Ue+dt.length>Ie.length?(u.isBuffer(dt)||(dt=u.from(dt)),dt.copy(Ie,Ue)):s.prototype.set.call(Ie,dt,Ue);else if(u.isBuffer(dt))dt.copy(Ie,Ue);else throw new TypeError('"list" argument must be an Array of Buffers');Ue+=dt.length}return Ie};function I(oe,j){if(u.isBuffer(oe))return oe.length;if(o.isView(oe)||je(oe,o))return oe.byteLength;if(typeof oe!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof oe);const V=oe.length,fe=arguments.length>2&&arguments[2]===!0;if(!fe&&V===0)return 0;let Ie=!1;for(;;)switch(j){case"ascii":case"latin1":case"binary":return V;case"utf8":case"utf-8":return Ft(oe).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V*2;case"hex":return V>>>1;case"base64":return We(oe).length;default:if(Ie)return fe?-1:Ft(oe).length;j=(""+j).toLowerCase(),Ie=!0}}u.byteLength=I;function N(oe,j,V){let fe=!1;if((j===void 0||j<0)&&(j=0),j>this.length||((V===void 0||V>this.length)&&(V=this.length),V<=0)||(V>>>=0,j>>>=0,V<=j))return"";for(oe||(oe="utf8");;)switch(oe){case"hex":return Ae(this,j,V);case"utf8":case"utf-8":return ie(this,j,V);case"ascii":return se(this,j,V);case"latin1":case"binary":return ue(this,j,V);case"base64":return Q(this,j,V);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Be(this,j,V);default:if(fe)throw new TypeError("Unknown encoding: "+oe);oe=(oe+"").toLowerCase(),fe=!0}}u.prototype._isBuffer=!0;function U(oe,j,V){const fe=oe[j];oe[j]=oe[V],oe[V]=fe}u.prototype.swap16=function(){const j=this.length;if(j%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let V=0;V<j;V+=2)U(this,V,V+1);return this},u.prototype.swap32=function(){const j=this.length;if(j%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let V=0;V<j;V+=4)U(this,V,V+3),U(this,V+1,V+2);return this},u.prototype.swap64=function(){const j=this.length;if(j%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let V=0;V<j;V+=8)U(this,V,V+7),U(this,V+1,V+6),U(this,V+2,V+5),U(this,V+3,V+4);return this},u.prototype.toString=function(){const j=this.length;return j===0?"":arguments.length===0?ie(this,0,j):N.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(j){if(!u.isBuffer(j))throw new TypeError("Argument must be a Buffer");return this===j?!0:u.compare(this,j)===0},u.prototype.inspect=function(){let j="";const V=t.INSPECT_MAX_BYTES;return j=this.toString("hex",0,V).replace(/(.{2})/g,"$1 ").trim(),this.length>V&&(j+=" ... "),"<Buffer "+j+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(j,V,fe,Ie,Ue){if(je(j,s)&&(j=u.from(j,j.offset,j.byteLength)),!u.isBuffer(j))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof j);if(V===void 0&&(V=0),fe===void 0&&(fe=j?j.length:0),Ie===void 0&&(Ie=0),Ue===void 0&&(Ue=this.length),V<0||fe>j.length||Ie<0||Ue>this.length)throw new RangeError("out of range index");if(Ie>=Ue&&V>=fe)return 0;if(Ie>=Ue)return-1;if(V>=fe)return 1;if(V>>>=0,fe>>>=0,Ie>>>=0,Ue>>>=0,this===j)return 0;let dt=Ue-Ie,yt=fe-V;const Dn=Math.min(dt,yt),Le=this.slice(Ie,Ue),Lt=j.slice(V,fe);for(let rt=0;rt<Dn;++rt)if(Le[rt]!==Lt[rt]){dt=Le[rt],yt=Lt[rt];break}return dt<yt?-1:yt<dt?1:0};function F(oe,j,V,fe,Ie){if(oe.length===0)return-1;if(typeof V=="string"?(fe=V,V=0):V>2147483647?V=2147483647:V<-2147483648&&(V=-2147483648),V=+V,Fe(V)&&(V=Ie?0:oe.length-1),V<0&&(V=oe.length+V),V>=oe.length){if(Ie)return-1;V=oe.length-1}else if(V<0)if(Ie)V=0;else return-1;if(typeof j=="string"&&(j=u.from(j,fe)),u.isBuffer(j))return j.length===0?-1:$(oe,j,V,fe,Ie);if(typeof j=="number")return j=j&255,typeof s.prototype.indexOf=="function"?Ie?s.prototype.indexOf.call(oe,j,V):s.prototype.lastIndexOf.call(oe,j,V):$(oe,[j],V,fe,Ie);throw new TypeError("val must be string, number or Buffer")}function $(oe,j,V,fe,Ie){let Ue=1,dt=oe.length,yt=j.length;if(fe!==void 0&&(fe=String(fe).toLowerCase(),fe==="ucs2"||fe==="ucs-2"||fe==="utf16le"||fe==="utf-16le")){if(oe.length<2||j.length<2)return-1;Ue=2,dt/=2,yt/=2,V/=2}function Dn(Lt,rt){return Ue===1?Lt[rt]:Lt.readUInt16BE(rt*Ue)}let Le;if(Ie){let Lt=-1;for(Le=V;Le<dt;Le++)if(Dn(oe,Le)===Dn(j,Lt===-1?0:Le-Lt)){if(Lt===-1&&(Lt=Le),Le-Lt+1===yt)return Lt*Ue}else Lt!==-1&&(Le-=Le-Lt),Lt=-1}else for(V+yt>dt&&(V=dt-yt),Le=V;Le>=0;Le--){let Lt=!0;for(let rt=0;rt<yt;rt++)if(Dn(oe,Le+rt)!==Dn(j,rt)){Lt=!1;break}if(Lt)return Le}return-1}u.prototype.includes=function(j,V,fe){return this.indexOf(j,V,fe)!==-1},u.prototype.indexOf=function(j,V,fe){return F(this,j,V,fe,!0)},u.prototype.lastIndexOf=function(j,V,fe){return F(this,j,V,fe,!1)};function X(oe,j,V,fe){V=Number(V)||0;const Ie=oe.length-V;fe?(fe=Number(fe),fe>Ie&&(fe=Ie)):fe=Ie;const Ue=j.length;fe>Ue/2&&(fe=Ue/2);let dt;for(dt=0;dt<fe;++dt){const yt=parseInt(j.substr(dt*2,2),16);if(Fe(yt))return dt;oe[V+dt]=yt}return dt}function q(oe,j,V,fe){return it(Ft(j,oe.length-V),oe,V,fe)}function W(oe,j,V,fe){return it(Ee(j),oe,V,fe)}function K(oe,j,V,fe){return it(We(j),oe,V,fe)}function ne(oe,j,V,fe){return it(le(j,oe.length-V),oe,V,fe)}u.prototype.write=function(j,V,fe,Ie){if(V===void 0)Ie="utf8",fe=this.length,V=0;else if(fe===void 0&&typeof V=="string")Ie=V,fe=this.length,V=0;else if(isFinite(V))V=V>>>0,isFinite(fe)?(fe=fe>>>0,Ie===void 0&&(Ie="utf8")):(Ie=fe,fe=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Ue=this.length-V;if((fe===void 0||fe>Ue)&&(fe=Ue),j.length>0&&(fe<0||V<0)||V>this.length)throw new RangeError("Attempt to write outside buffer bounds");Ie||(Ie="utf8");let dt=!1;for(;;)switch(Ie){case"hex":return X(this,j,V,fe);case"utf8":case"utf-8":return q(this,j,V,fe);case"ascii":case"latin1":case"binary":return W(this,j,V,fe);case"base64":return K(this,j,V,fe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ne(this,j,V,fe);default:if(dt)throw new TypeError("Unknown encoding: "+Ie);Ie=(""+Ie).toLowerCase(),dt=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Q(oe,j,V){return j===0&&V===oe.length?e.fromByteArray(oe):e.fromByteArray(oe.slice(j,V))}function ie(oe,j,V){V=Math.min(oe.length,V);const fe=[];let Ie=j;for(;Ie<V;){const Ue=oe[Ie];let dt=null,yt=Ue>239?4:Ue>223?3:Ue>191?2:1;if(Ie+yt<=V){let Dn,Le,Lt,rt;switch(yt){case 1:Ue<128&&(dt=Ue);break;case 2:Dn=oe[Ie+1],(Dn&192)===128&&(rt=(Ue&31)<<6|Dn&63,rt>127&&(dt=rt));break;case 3:Dn=oe[Ie+1],Le=oe[Ie+2],(Dn&192)===128&&(Le&192)===128&&(rt=(Ue&15)<<12|(Dn&63)<<6|Le&63,rt>2047&&(rt<55296||rt>57343)&&(dt=rt));break;case 4:Dn=oe[Ie+1],Le=oe[Ie+2],Lt=oe[Ie+3],(Dn&192)===128&&(Le&192)===128&&(Lt&192)===128&&(rt=(Ue&15)<<18|(Dn&63)<<12|(Le&63)<<6|Lt&63,rt>65535&&rt<1114112&&(dt=rt))}}dt===null?(dt=65533,yt=1):dt>65535&&(dt-=65536,fe.push(dt>>>10&1023|55296),dt=56320|dt&1023),fe.push(dt),Ie+=yt}return Z(fe)}const G=4096;function Z(oe){const j=oe.length;if(j<=G)return String.fromCharCode.apply(String,oe);let V="",fe=0;for(;fe<j;)V+=String.fromCharCode.apply(String,oe.slice(fe,fe+=G));return V}function se(oe,j,V){let fe="";V=Math.min(oe.length,V);for(let Ie=j;Ie<V;++Ie)fe+=String.fromCharCode(oe[Ie]&127);return fe}function ue(oe,j,V){let fe="";V=Math.min(oe.length,V);for(let Ie=j;Ie<V;++Ie)fe+=String.fromCharCode(oe[Ie]);return fe}function Ae(oe,j,V){const fe=oe.length;(!j||j<0)&&(j=0),(!V||V<0||V>fe)&&(V=fe);let Ie="";for(let Ue=j;Ue<V;++Ue)Ie+=Ht[oe[Ue]];return Ie}function Be(oe,j,V){const fe=oe.slice(j,V);let Ie="";for(let Ue=0;Ue<fe.length-1;Ue+=2)Ie+=String.fromCharCode(fe[Ue]+fe[Ue+1]*256);return Ie}u.prototype.slice=function(j,V){const fe=this.length;j=~~j,V=V===void 0?fe:~~V,j<0?(j+=fe,j<0&&(j=0)):j>fe&&(j=fe),V<0?(V+=fe,V<0&&(V=0)):V>fe&&(V=fe),V<j&&(V=j);const Ie=this.subarray(j,V);return Object.setPrototypeOf(Ie,u.prototype),Ie};function Se(oe,j,V){if(oe%1!==0||oe<0)throw new RangeError("offset is not uint");if(oe+j>V)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(j,V,fe){j=j>>>0,V=V>>>0,fe||Se(j,V,this.length);let Ie=this[j],Ue=1,dt=0;for(;++dt<V&&(Ue*=256);)Ie+=this[j+dt]*Ue;return Ie},u.prototype.readUintBE=u.prototype.readUIntBE=function(j,V,fe){j=j>>>0,V=V>>>0,fe||Se(j,V,this.length);let Ie=this[j+--V],Ue=1;for(;V>0&&(Ue*=256);)Ie+=this[j+--V]*Ue;return Ie},u.prototype.readUint8=u.prototype.readUInt8=function(j,V){return j=j>>>0,V||Se(j,1,this.length),this[j]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(j,V){return j=j>>>0,V||Se(j,2,this.length),this[j]|this[j+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(j,V){return j=j>>>0,V||Se(j,2,this.length),this[j]<<8|this[j+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(j,V){return j=j>>>0,V||Se(j,4,this.length),(this[j]|this[j+1]<<8|this[j+2]<<16)+this[j+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(j,V){return j=j>>>0,V||Se(j,4,this.length),this[j]*16777216+(this[j+1]<<16|this[j+2]<<8|this[j+3])},u.prototype.readBigUInt64LE=St(function(j){j=j>>>0,He(j,"offset");const V=this[j],fe=this[j+7];(V===void 0||fe===void 0)&&Rt(j,this.length-8);const Ie=V+this[++j]*2**8+this[++j]*2**16+this[++j]*2**24,Ue=this[++j]+this[++j]*2**8+this[++j]*2**16+fe*2**24;return BigInt(Ie)+(BigInt(Ue)<<BigInt(32))}),u.prototype.readBigUInt64BE=St(function(j){j=j>>>0,He(j,"offset");const V=this[j],fe=this[j+7];(V===void 0||fe===void 0)&&Rt(j,this.length-8);const Ie=V*2**24+this[++j]*2**16+this[++j]*2**8+this[++j],Ue=this[++j]*2**24+this[++j]*2**16+this[++j]*2**8+fe;return(BigInt(Ie)<<BigInt(32))+BigInt(Ue)}),u.prototype.readIntLE=function(j,V,fe){j=j>>>0,V=V>>>0,fe||Se(j,V,this.length);let Ie=this[j],Ue=1,dt=0;for(;++dt<V&&(Ue*=256);)Ie+=this[j+dt]*Ue;return Ue*=128,Ie>=Ue&&(Ie-=Math.pow(2,8*V)),Ie},u.prototype.readIntBE=function(j,V,fe){j=j>>>0,V=V>>>0,fe||Se(j,V,this.length);let Ie=V,Ue=1,dt=this[j+--Ie];for(;Ie>0&&(Ue*=256);)dt+=this[j+--Ie]*Ue;return Ue*=128,dt>=Ue&&(dt-=Math.pow(2,8*V)),dt},u.prototype.readInt8=function(j,V){return j=j>>>0,V||Se(j,1,this.length),this[j]&128?(255-this[j]+1)*-1:this[j]},u.prototype.readInt16LE=function(j,V){j=j>>>0,V||Se(j,2,this.length);const fe=this[j]|this[j+1]<<8;return fe&32768?fe|4294901760:fe},u.prototype.readInt16BE=function(j,V){j=j>>>0,V||Se(j,2,this.length);const fe=this[j+1]|this[j]<<8;return fe&32768?fe|4294901760:fe},u.prototype.readInt32LE=function(j,V){return j=j>>>0,V||Se(j,4,this.length),this[j]|this[j+1]<<8|this[j+2]<<16|this[j+3]<<24},u.prototype.readInt32BE=function(j,V){return j=j>>>0,V||Se(j,4,this.length),this[j]<<24|this[j+1]<<16|this[j+2]<<8|this[j+3]},u.prototype.readBigInt64LE=St(function(j){j=j>>>0,He(j,"offset");const V=this[j],fe=this[j+7];(V===void 0||fe===void 0)&&Rt(j,this.length-8);const Ie=this[j+4]+this[j+5]*2**8+this[j+6]*2**16+(fe<<24);return(BigInt(Ie)<<BigInt(32))+BigInt(V+this[++j]*2**8+this[++j]*2**16+this[++j]*2**24)}),u.prototype.readBigInt64BE=St(function(j){j=j>>>0,He(j,"offset");const V=this[j],fe=this[j+7];(V===void 0||fe===void 0)&&Rt(j,this.length-8);const Ie=(V<<24)+this[++j]*2**16+this[++j]*2**8+this[++j];return(BigInt(Ie)<<BigInt(32))+BigInt(this[++j]*2**24+this[++j]*2**16+this[++j]*2**8+fe)}),u.prototype.readFloatLE=function(j,V){return j=j>>>0,V||Se(j,4,this.length),n.read(this,j,!0,23,4)},u.prototype.readFloatBE=function(j,V){return j=j>>>0,V||Se(j,4,this.length),n.read(this,j,!1,23,4)},u.prototype.readDoubleLE=function(j,V){return j=j>>>0,V||Se(j,8,this.length),n.read(this,j,!0,52,8)},u.prototype.readDoubleBE=function(j,V){return j=j>>>0,V||Se(j,8,this.length),n.read(this,j,!1,52,8)};function Pe(oe,j,V,fe,Ie,Ue){if(!u.isBuffer(oe))throw new TypeError('"buffer" argument must be a Buffer instance');if(j>Ie||j<Ue)throw new RangeError('"value" argument is out of bounds');if(V+fe>oe.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(j,V,fe,Ie){if(j=+j,V=V>>>0,fe=fe>>>0,!Ie){const yt=Math.pow(2,8*fe)-1;Pe(this,j,V,fe,yt,0)}let Ue=1,dt=0;for(this[V]=j&255;++dt<fe&&(Ue*=256);)this[V+dt]=j/Ue&255;return V+fe},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(j,V,fe,Ie){if(j=+j,V=V>>>0,fe=fe>>>0,!Ie){const yt=Math.pow(2,8*fe)-1;Pe(this,j,V,fe,yt,0)}let Ue=fe-1,dt=1;for(this[V+Ue]=j&255;--Ue>=0&&(dt*=256);)this[V+Ue]=j/dt&255;return V+fe},u.prototype.writeUint8=u.prototype.writeUInt8=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,1,255,0),this[V]=j&255,V+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,2,65535,0),this[V]=j&255,this[V+1]=j>>>8,V+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,2,65535,0),this[V]=j>>>8,this[V+1]=j&255,V+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,4,4294967295,0),this[V+3]=j>>>24,this[V+2]=j>>>16,this[V+1]=j>>>8,this[V]=j&255,V+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,4,4294967295,0),this[V]=j>>>24,this[V+1]=j>>>16,this[V+2]=j>>>8,this[V+3]=j&255,V+4};function we(oe,j,V,fe,Ie){ut(j,fe,Ie,oe,V,7);let Ue=Number(j&BigInt(4294967295));oe[V++]=Ue,Ue=Ue>>8,oe[V++]=Ue,Ue=Ue>>8,oe[V++]=Ue,Ue=Ue>>8,oe[V++]=Ue;let dt=Number(j>>BigInt(32)&BigInt(4294967295));return oe[V++]=dt,dt=dt>>8,oe[V++]=dt,dt=dt>>8,oe[V++]=dt,dt=dt>>8,oe[V++]=dt,V}function Te(oe,j,V,fe,Ie){ut(j,fe,Ie,oe,V,7);let Ue=Number(j&BigInt(4294967295));oe[V+7]=Ue,Ue=Ue>>8,oe[V+6]=Ue,Ue=Ue>>8,oe[V+5]=Ue,Ue=Ue>>8,oe[V+4]=Ue;let dt=Number(j>>BigInt(32)&BigInt(4294967295));return oe[V+3]=dt,dt=dt>>8,oe[V+2]=dt,dt=dt>>8,oe[V+1]=dt,dt=dt>>8,oe[V]=dt,V+8}u.prototype.writeBigUInt64LE=St(function(j,V=0){return we(this,j,V,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=St(function(j,V=0){return Te(this,j,V,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(j,V,fe,Ie){if(j=+j,V=V>>>0,!Ie){const Dn=Math.pow(2,8*fe-1);Pe(this,j,V,fe,Dn-1,-Dn)}let Ue=0,dt=1,yt=0;for(this[V]=j&255;++Ue<fe&&(dt*=256);)j<0&&yt===0&&this[V+Ue-1]!==0&&(yt=1),this[V+Ue]=(j/dt>>0)-yt&255;return V+fe},u.prototype.writeIntBE=function(j,V,fe,Ie){if(j=+j,V=V>>>0,!Ie){const Dn=Math.pow(2,8*fe-1);Pe(this,j,V,fe,Dn-1,-Dn)}let Ue=fe-1,dt=1,yt=0;for(this[V+Ue]=j&255;--Ue>=0&&(dt*=256);)j<0&&yt===0&&this[V+Ue+1]!==0&&(yt=1),this[V+Ue]=(j/dt>>0)-yt&255;return V+fe},u.prototype.writeInt8=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,1,127,-128),j<0&&(j=255+j+1),this[V]=j&255,V+1},u.prototype.writeInt16LE=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,2,32767,-32768),this[V]=j&255,this[V+1]=j>>>8,V+2},u.prototype.writeInt16BE=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,2,32767,-32768),this[V]=j>>>8,this[V+1]=j&255,V+2},u.prototype.writeInt32LE=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,4,2147483647,-2147483648),this[V]=j&255,this[V+1]=j>>>8,this[V+2]=j>>>16,this[V+3]=j>>>24,V+4},u.prototype.writeInt32BE=function(j,V,fe){return j=+j,V=V>>>0,fe||Pe(this,j,V,4,2147483647,-2147483648),j<0&&(j=4294967295+j+1),this[V]=j>>>24,this[V+1]=j>>>16,this[V+2]=j>>>8,this[V+3]=j&255,V+4},u.prototype.writeBigInt64LE=St(function(j,V=0){return we(this,j,V,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=St(function(j,V=0){return Te(this,j,V,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Oe(oe,j,V,fe,Ie,Ue){if(V+fe>oe.length)throw new RangeError("Index out of range");if(V<0)throw new RangeError("Index out of range")}function _t(oe,j,V,fe,Ie){return j=+j,V=V>>>0,Ie||Oe(oe,j,V,4),n.write(oe,j,V,fe,23,4),V+4}u.prototype.writeFloatLE=function(j,V,fe){return _t(this,j,V,!0,fe)},u.prototype.writeFloatBE=function(j,V,fe){return _t(this,j,V,!1,fe)};function Ct(oe,j,V,fe,Ie){return j=+j,V=V>>>0,Ie||Oe(oe,j,V,8),n.write(oe,j,V,fe,52,8),V+8}u.prototype.writeDoubleLE=function(j,V,fe){return Ct(this,j,V,!0,fe)},u.prototype.writeDoubleBE=function(j,V,fe){return Ct(this,j,V,!1,fe)},u.prototype.copy=function(j,V,fe,Ie){if(!u.isBuffer(j))throw new TypeError("argument should be a Buffer");if(fe||(fe=0),!Ie&&Ie!==0&&(Ie=this.length),V>=j.length&&(V=j.length),V||(V=0),Ie>0&&Ie<fe&&(Ie=fe),Ie===fe||j.length===0||this.length===0)return 0;if(V<0)throw new RangeError("targetStart out of bounds");if(fe<0||fe>=this.length)throw new RangeError("Index out of range");if(Ie<0)throw new RangeError("sourceEnd out of bounds");Ie>this.length&&(Ie=this.length),j.length-V<Ie-fe&&(Ie=j.length-V+fe);const Ue=Ie-fe;return this===j&&typeof s.prototype.copyWithin=="function"?this.copyWithin(V,fe,Ie):s.prototype.set.call(j,this.subarray(fe,Ie),V),Ue},u.prototype.fill=function(j,V,fe,Ie){if(typeof j=="string"){if(typeof V=="string"?(Ie=V,V=0,fe=this.length):typeof fe=="string"&&(Ie=fe,fe=this.length),Ie!==void 0&&typeof Ie!="string")throw new TypeError("encoding must be a string");if(typeof Ie=="string"&&!u.isEncoding(Ie))throw new TypeError("Unknown encoding: "+Ie);if(j.length===1){const dt=j.charCodeAt(0);(Ie==="utf8"&&dt<128||Ie==="latin1")&&(j=dt)}}else typeof j=="number"?j=j&255:typeof j=="boolean"&&(j=Number(j));if(V<0||this.length<V||this.length<fe)throw new RangeError("Out of range index");if(fe<=V)return this;V=V>>>0,fe=fe===void 0?this.length:fe>>>0,j||(j=0);let Ue;if(typeof j=="number")for(Ue=V;Ue<fe;++Ue)this[Ue]=j;else{const dt=u.isBuffer(j)?j:u.from(j,Ie),yt=dt.length;if(yt===0)throw new TypeError('The value "'+j+'" is invalid for argument "value"');for(Ue=0;Ue<fe-V;++Ue)this[Ue+V]=dt[Ue%yt]}return this};const me={};function ge(oe,j,V){me[oe]=class extends V{constructor(){super(),Object.defineProperty(this,"message",{value:j.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${oe}]`,this.stack,delete this.name}get code(){return oe}set code(Ie){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Ie,writable:!0})}toString(){return`${this.name} [${oe}]: ${this.message}`}}}ge("ERR_BUFFER_OUT_OF_BOUNDS",function(oe){return oe?`${oe} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ge("ERR_INVALID_ARG_TYPE",function(oe,j){return`The "${oe}" argument must be of type number. Received type ${typeof j}`},TypeError),ge("ERR_OUT_OF_RANGE",function(oe,j,V){let fe=`The value of "${oe}" is out of range.`,Ie=V;return Number.isInteger(V)&&Math.abs(V)>2**32?Ie=nt(String(V)):typeof V=="bigint"&&(Ie=String(V),(V>BigInt(2)**BigInt(32)||V<-(BigInt(2)**BigInt(32)))&&(Ie=nt(Ie)),Ie+="n"),fe+=` It must be ${j}. Received ${Ie}`,fe},RangeError);function nt(oe){let j="",V=oe.length;const fe=oe[0]==="-"?1:0;for(;V>=fe+4;V-=3)j=`_${oe.slice(V-3,V)}${j}`;return`${oe.slice(0,V)}${j}`}function Ce(oe,j,V){He(j,"offset"),(oe[j]===void 0||oe[j+V]===void 0)&&Rt(j,oe.length-(V+1))}function ut(oe,j,V,fe,Ie,Ue){if(oe>V||oe<j){const dt=typeof j=="bigint"?"n":"";let yt;throw j===0||j===BigInt(0)?yt=`>= 0${dt} and < 2${dt} ** ${(Ue+1)*8}${dt}`:yt=`>= -(2${dt} ** ${(Ue+1)*8-1}${dt}) and < 2 ** ${(Ue+1)*8-1}${dt}`,new me.ERR_OUT_OF_RANGE("value",yt,oe)}Ce(fe,Ie,Ue)}function He(oe,j){if(typeof oe!="number")throw new me.ERR_INVALID_ARG_TYPE(j,"number",oe)}function Rt(oe,j,V){throw Math.floor(oe)!==oe?(He(oe,V),new me.ERR_OUT_OF_RANGE("offset","an integer",oe)):j<0?new me.ERR_BUFFER_OUT_OF_BOUNDS:new me.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${j}`,oe)}const $t=/[^+/0-9A-Za-z-_]/g;function Tt(oe){if(oe=oe.split("=")[0],oe=oe.trim().replace($t,""),oe.length<2)return"";for(;oe.length%4!==0;)oe=oe+"=";return oe}function Ft(oe,j){j=j||1/0;let V;const fe=oe.length;let Ie=null;const Ue=[];for(let dt=0;dt<fe;++dt){if(V=oe.charCodeAt(dt),V>55295&&V<57344){if(!Ie){if(V>56319){(j-=3)>-1&&Ue.push(239,191,189);continue}else if(dt+1===fe){(j-=3)>-1&&Ue.push(239,191,189);continue}Ie=V;continue}if(V<56320){(j-=3)>-1&&Ue.push(239,191,189),Ie=V;continue}V=(Ie-55296<<10|V-56320)+65536}else Ie&&(j-=3)>-1&&Ue.push(239,191,189);if(Ie=null,V<128){if((j-=1)<0)break;Ue.push(V)}else if(V<2048){if((j-=2)<0)break;Ue.push(V>>6|192,V&63|128)}else if(V<65536){if((j-=3)<0)break;Ue.push(V>>12|224,V>>6&63|128,V&63|128)}else if(V<1114112){if((j-=4)<0)break;Ue.push(V>>18|240,V>>12&63|128,V>>6&63|128,V&63|128)}else throw new Error("Invalid code point")}return Ue}function Ee(oe){const j=[];for(let V=0;V<oe.length;++V)j.push(oe.charCodeAt(V)&255);return j}function le(oe,j){let V,fe,Ie;const Ue=[];for(let dt=0;dt<oe.length&&!((j-=2)<0);++dt)V=oe.charCodeAt(dt),fe=V>>8,Ie=V%256,Ue.push(Ie),Ue.push(fe);return Ue}function We(oe){return e.toByteArray(Tt(oe))}function it(oe,j,V,fe){let Ie;for(Ie=0;Ie<fe&&!(Ie+V>=j.length||Ie>=oe.length);++Ie)j[Ie+V]=oe[Ie];return Ie}function je(oe,j){return oe instanceof j||oe!=null&&oe.constructor!=null&&oe.constructor.name!=null&&oe.constructor.name===j.name}function Fe(oe){return oe!==oe}const Ht=function(){const oe="0123456789abcdef",j=new Array(256);for(let V=0;V<16;++V){const fe=V*16;for(let Ie=0;Ie<16;++Ie)j[fe+Ie]=oe[V]+oe[Ie]}return j}();function St(oe){return typeof BigInt>"u"?Dt:oe}function Dt(){throw new Error("BigInt not supported")}})(Ba);const Tc=Ba.Buffer,_0e=Ba.Blob,y0e=Ba.BlobOptions,b0e=Ba.Buffer,E0e=Ba.File,S0e=Ba.FileOptions,w0e=Ba.INSPECT_MAX_BYTES,T0e=Ba.SlowBuffer,x0e=Ba.TranscodeEncoding,C0e=Ba.atob,R0e=Ba.btoa,A0e=Ba.constants,M0e=Ba.isAscii,I0e=Ba.isUtf8,O0e=Ba.kMaxLength,k0e=Ba.kStringMaxLength,N0e=Ba.resolveObjectURL,P0e=Ba.transcode,D0e=Object.freeze(Object.defineProperty({__proto__:null,Blob:_0e,BlobOptions:y0e,Buffer:b0e,File:E0e,FileOptions:S0e,INSPECT_MAX_BYTES:w0e,SlowBuffer:T0e,TranscodeEncoding:x0e,atob:C0e,btoa:R0e,constants:A0e,default:Tc,isAscii:M0e,isUtf8:I0e,kMaxLength:O0e,kStringMaxLength:k0e,resolveObjectURL:N0e,transcode:P0e},Symbol.toStringTag,{value:"Module"}));var UL;try{UL=new TextDecoder}catch{}var cn,Td,Ye=0,ws={},yi,$v,bd=0,tp=0,Ja,Jm,fu=[],pi,fH={useRecords:!1,mapsAsObjects:!0};class lW{}const uW=new lW;uW.name="MessagePack 0xC1";var Wv=!1,dW=2,pH;try{new Function("")}catch{dW=1/0}class ww{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,n){if(cn)return vW(()=>(BL(),this?this.unpack(e,n):ww.prototype.unpack.call(fH,e,n)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof Tc<"u"?Tc.from(e):new Uint8Array(e)),typeof n=="object"?(Td=n.end||e.length,Ye=n.start||0):(Ye=0,Td=n>-1?n:e.length),tp=0,$v=null,Ja=null,cn=e;try{pi=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw cn=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof ww){if(ws=this,this.structures)return yi=this.structures,uC(n);(!yi||yi.length>0)&&(yi=[])}else ws=fH,(!yi||yi.length>0)&&(yi=[]);return uC(n)}unpackMultiple(e,n){let r,i=0;try{Wv=!0;let s=e.length,o=this?this.unpack(e,s):JA.unpack(e,s);if(n){if(n(o,i,Ye)===!1)return;for(;Ye<s;)if(i=Ye,n(uC(),i,Ye)===!1)return}else{for(r=[o];Ye<s;)i=Ye,r.push(uC());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Wv=!1,BL()}}_mergeStructures(e,n){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in n||[])if(r>=0){let i=e[r],s=n[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,n){return this.unpack(e,n)}}function uC(t){try{if(!ws.trusted&&!Wv){let n=yi.sharedLength||0;n<yi.length&&(yi.length=n)}let e;if(ws.randomAccessStructure&&cn[Ye]<64&&cn[Ye]>=32&&pH?(e=pH(cn,Ye,Td,ws),cn=null,!(t&&t.lazy)&&e&&(e=e.toJSON()),Ye=Td):e=Uo(),Ja&&(Ye=Ja.postBundlePosition,Ja=null),Wv&&(yi.restoreStructures=null),Ye==Td)yi&&yi.restoreStructures&&mH(),yi=null,cn=null,Jm&&(Jm=null);else{if(Ye>Td)throw new Error("Unexpected end of MessagePack data");if(!Wv){let n;try{n=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){n="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+n)}}return e}catch(e){throw yi&&yi.restoreStructures&&mH(),BL(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||Ye>Td)&&(e.incomplete=!0),e}}function mH(){for(let t in yi.restoreStructures)yi[t]=yi.restoreStructures[t];yi.restoreStructures=null}function Uo(){let t=cn[Ye++];if(t<160)if(t<128){if(t<64)return t;{let e=yi[t&63]||ws.getStructures&&hW()[t&63];return e?(e.read||(e.read=LF(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,ws.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=pW();r==="__proto__"&&(r="__proto_"),e[r]=Uo()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(Uo(),Uo());return e}else{t-=144;let e=new Array(t);for(let n=0;n<t;n++)e[n]=Uo();return ws.freezeData?Object.freeze(e):e}else if(t<192){let e=t-160;if(tp>=Ye)return $v.slice(Ye-bd,(Ye+=e)-bd);if(tp==0&&Td<140){let n=e<16?UF(e):fW(e);if(n!=null)return n}return FL(e)}else{let e;switch(t){case 192:return null;case 193:return Ja?(e=Uo(),e>0?Ja[1].slice(Ja.position1,Ja.position1+=e):Ja[0].slice(Ja.position0,Ja.position0-=e)):uW;case 194:return!1;case 195:return!0;case 196:if(e=cn[Ye++],e===void 0)throw new Error("Unexpected end of buffer");return YN(e);case 197:return e=pi.getUint16(Ye),Ye+=2,YN(e);case 198:return e=pi.getUint32(Ye),Ye+=4,YN(e);case 199:return c0(cn[Ye++]);case 200:return e=pi.getUint16(Ye),Ye+=2,c0(e);case 201:return e=pi.getUint32(Ye),Ye+=4,c0(e);case 202:if(e=pi.getFloat32(Ye),ws.useFloat32>2){let n=FF[(cn[Ye]&127)<<1|cn[Ye+1]>>7];return Ye+=4,(n*e+(e>0?.5:-.5)>>0)/n}return Ye+=4,e;case 203:return e=pi.getFloat64(Ye),Ye+=8,e;case 204:return cn[Ye++];case 205:return e=pi.getUint16(Ye),Ye+=2,e;case 206:return e=pi.getUint32(Ye),Ye+=4,e;case 207:return ws.int64AsType==="number"?(e=pi.getUint32(Ye)*4294967296,e+=pi.getUint32(Ye+4)):ws.int64AsType==="string"?e=pi.getBigUint64(Ye).toString():ws.int64AsType==="auto"?(e=pi.getBigUint64(Ye),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=pi.getBigUint64(Ye),Ye+=8,e;case 208:return pi.getInt8(Ye++);case 209:return e=pi.getInt16(Ye),Ye+=2,e;case 210:return e=pi.getInt32(Ye),Ye+=4,e;case 211:return ws.int64AsType==="number"?(e=pi.getInt32(Ye)*4294967296,e+=pi.getUint32(Ye+4)):ws.int64AsType==="string"?e=pi.getBigInt64(Ye).toString():ws.int64AsType==="auto"?(e=pi.getBigInt64(Ye),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=pi.getBigInt64(Ye),Ye+=8,e;case 212:if(e=cn[Ye++],e==114)return EH(cn[Ye++]&63);{let n=fu[e];if(n)return n.read?(Ye++,n.read(Uo())):n.noBuffer?(Ye++,n()):n(cn.subarray(Ye,++Ye));throw new Error("Unknown extension "+e)}case 213:return e=cn[Ye],e==114?(Ye++,EH(cn[Ye++]&63,cn[Ye++])):c0(2);case 214:return c0(4);case 215:return c0(8);case 216:return c0(16);case 217:return e=cn[Ye++],tp>=Ye?$v.slice(Ye-bd,(Ye+=e)-bd):U0e(e);case 218:return e=pi.getUint16(Ye),Ye+=2,tp>=Ye?$v.slice(Ye-bd,(Ye+=e)-bd):F0e(e);case 219:return e=pi.getUint32(Ye),Ye+=4,tp>=Ye?$v.slice(Ye-bd,(Ye+=e)-bd):B0e(e);case 220:return e=pi.getUint16(Ye),Ye+=2,vH(e);case 221:return e=pi.getUint32(Ye),Ye+=4,vH(e);case 222:return e=pi.getUint16(Ye),Ye+=2,_H(e);case 223:return e=pi.getUint32(Ye),Ye+=4,_H(e);default:if(t>=224)return t-256;if(t===void 0){let n=new Error("Unexpected end of MessagePack data");throw n.incomplete=!0,n}throw new Error("Unknown MessagePack token "+t)}}}const L0e=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function LF(t,e){function n(){if(n.count++>dW){let i=t.read=new Function("r","return function(){return "+(ws.freezeData?"Object.freeze":"")+"({"+t.map(s=>s==="__proto__"?"__proto_:r()":L0e.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(Uo);return t.highByte===0&&(t.read=gH(e,t.read)),i()}let r={};for(let i=0,s=t.length;i<s;i++){let o=t[i];o==="__proto__"&&(o="__proto_"),r[o]=Uo()}return ws.freezeData?Object.freeze(r):r}return n.count=0,t.highByte===0?gH(e,n):n}const gH=(t,e)=>function(){let n=cn[Ye++];if(n===0)return e();let r=t<32?-(t+(n<<5)):t+(n<<5),i=yi[r]||hW()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=LF(i,t)),i.read()};function hW(){let t=vW(()=>(cn=null,ws.getStructures()));return yi=ws._mergeStructures(t,yi)}var FL=ET,U0e=ET,F0e=ET,B0e=ET;function ET(t){let e;if(t<16&&(e=UF(t)))return e;if(t>64&&UL)return UL.decode(cn.subarray(Ye,Ye+=t));const n=Ye+t,r=[];for(e="";Ye<n;){const i=cn[Ye++];if(!(i&128))r.push(i);else if((i&224)===192){const s=cn[Ye++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=cn[Ye++]&63,o=cn[Ye++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=cn[Ye++]&63,o=cn[Ye++]&63,a=cn[Ye++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Ya.apply(String,r),r.length=0)}return r.length>0&&(e+=Ya.apply(String,r)),e}function vH(t){let e=new Array(t);for(let n=0;n<t;n++)e[n]=Uo();return ws.freezeData?Object.freeze(e):e}function _H(t){if(ws.mapsAsObjects){let e={};for(let n=0;n<t;n++){let r=pW();r==="__proto__"&&(r="__proto_"),e[r]=Uo()}return e}else{let e=new Map;for(let n=0;n<t;n++)e.set(Uo(),Uo());return e}}var Ya=String.fromCharCode;function fW(t){let e=Ye,n=new Array(t);for(let r=0;r<t;r++){const i=cn[Ye++];if((i&128)>0){Ye=e;return}n[r]=i}return Ya.apply(String,n)}function UF(t){if(t<4)if(t<2){if(t===0)return"";{let e=cn[Ye++];if((e&128)>1){Ye-=1;return}return Ya(e)}}else{let e=cn[Ye++],n=cn[Ye++];if((e&128)>0||(n&128)>0){Ye-=2;return}if(t<3)return Ya(e,n);let r=cn[Ye++];if((r&128)>0){Ye-=3;return}return Ya(e,n,r)}else{let e=cn[Ye++],n=cn[Ye++],r=cn[Ye++],i=cn[Ye++];if((e&128)>0||(n&128)>0||(r&128)>0||(i&128)>0){Ye-=4;return}if(t<6){if(t===4)return Ya(e,n,r,i);{let s=cn[Ye++];if((s&128)>0){Ye-=5;return}return Ya(e,n,r,i,s)}}else if(t<8){let s=cn[Ye++],o=cn[Ye++];if((s&128)>0||(o&128)>0){Ye-=6;return}if(t<7)return Ya(e,n,r,i,s,o);let a=cn[Ye++];if((a&128)>0){Ye-=7;return}return Ya(e,n,r,i,s,o,a)}else{let s=cn[Ye++],o=cn[Ye++],a=cn[Ye++],c=cn[Ye++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){Ye-=8;return}if(t<10){if(t===8)return Ya(e,n,r,i,s,o,a,c);{let l=cn[Ye++];if((l&128)>0){Ye-=9;return}return Ya(e,n,r,i,s,o,a,c,l)}}else if(t<12){let l=cn[Ye++],u=cn[Ye++];if((l&128)>0||(u&128)>0){Ye-=10;return}if(t<11)return Ya(e,n,r,i,s,o,a,c,l,u);let d=cn[Ye++];if((d&128)>0){Ye-=11;return}return Ya(e,n,r,i,s,o,a,c,l,u,d)}else{let l=cn[Ye++],u=cn[Ye++],d=cn[Ye++],h=cn[Ye++];if((l&128)>0||(u&128)>0||(d&128)>0||(h&128)>0){Ye-=12;return}if(t<14){if(t===12)return Ya(e,n,r,i,s,o,a,c,l,u,d,h);{let f=cn[Ye++];if((f&128)>0){Ye-=13;return}return Ya(e,n,r,i,s,o,a,c,l,u,d,h,f)}}else{let f=cn[Ye++],p=cn[Ye++];if((f&128)>0||(p&128)>0){Ye-=14;return}if(t<15)return Ya(e,n,r,i,s,o,a,c,l,u,d,h,f,p);let g=cn[Ye++];if((g&128)>0){Ye-=15;return}return Ya(e,n,r,i,s,o,a,c,l,u,d,h,f,p,g)}}}}}function yH(){let t=cn[Ye++],e;if(t<192)e=t-160;else switch(t){case 217:e=cn[Ye++];break;case 218:e=pi.getUint16(Ye),Ye+=2;break;case 219:e=pi.getUint32(Ye),Ye+=4;break;default:throw new Error("Expected string")}return ET(e)}function YN(t){return ws.copyBuffers?Uint8Array.prototype.slice.call(cn,Ye,Ye+=t):cn.subarray(Ye,Ye+=t)}function c0(t){let e=cn[Ye++];if(fu[e]){let n;return fu[e](cn.subarray(Ye,n=Ye+=t),r=>{Ye=r;try{return Uo()}finally{Ye=n}})}else throw new Error("Unknown extension type "+e)}var bH=new Array(4096);function pW(){let t=cn[Ye++];if(t>=160&&t<192){if(t=t-160,tp>=Ye)return $v.slice(Ye-bd,(Ye+=t)-bd);if(!(tp==0&&Td<180))return FL(t)}else return Ye--,mW(Uo());let e=(t<<5^(t>1?pi.getUint16(Ye):t>0?cn[Ye]:0))&4095,n=bH[e],r=Ye,i=Ye+t-3,s,o=0;if(n&&n.bytes==t){for(;r<i;){if(s=pi.getUint32(r),s!=n[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=cn[r++],s!=n[o++]){r=1879048192;break}if(r===i)return Ye=r,n.string;i-=3,r=Ye}for(n=[],bH[e]=n,n.bytes=t;r<i;)s=pi.getUint32(r),n.push(s),r+=4;for(i+=3;r<i;)s=cn[r++],n.push(s);let a=t<16?UF(t):fW(t);return a!=null?n.string=a:n.string=FL(t)}function mW(t){if(typeof t=="string")return t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property type for record",typeof t)}const EH=(t,e)=>{let n=Uo().map(mW),r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,n.highByte=e);let i=yi[t];return i&&(i.isShared||Wv)&&((yi.restoreStructures||(yi.restoreStructures=[]))[t]=i),yi[t]=n,n.read=LF(n,r),n.read()};fu[0]=()=>{};fu[0].noBuffer=!0;fu[66]=t=>{let e=t.length,n=BigInt(t[0]&128?t[0]-256:t[0]);for(let r=1;r<e;r++)n<<=BigInt(8),n+=BigInt(t[r]);return n};let j0e={Error,TypeError,ReferenceError};fu[101]=()=>{let t=Uo();return(j0e[t[0]]||Error)(t[1],{cause:t[2]})};fu[105]=t=>{if(ws.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=pi.getUint32(Ye-4);Jm||(Jm=new Map);let n=cn[Ye],r;n>=144&&n<160||n==220||n==221?r=[]:r={};let i={target:r};Jm.set(e,i);let s=Uo();return i.used?Object.assign(r,s):(i.target=s,s)};fu[112]=t=>{if(ws.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=pi.getUint32(Ye-4),n=Jm.get(e);return n.used=!0,n.target};fu[115]=()=>new Set(Uo());const gW=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");let $0e=typeof globalThis=="object"?globalThis:window;fu[116]=t=>{let e=t[0],n=gW[e];if(!n){if(e===16){let r=new ArrayBuffer(t.length-1);return new Uint8Array(r).set(t.subarray(1)),r}throw new Error("Could not find typed array for code "+e)}return new $0e[n](Uint8Array.prototype.slice.call(t,1).buffer)};fu[120]=()=>{let t=Uo();return new RegExp(t[0],t[1])};const H0e=[];fu[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],n=Ye;return Ye+=e-t.length,Ja=H0e,Ja=[yH(),yH()],Ja.position0=0,Ja.position1=0,Ja.postBundlePosition=Ye,Ye=n,Uo()};fu[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function vW(t){let e=Td,n=Ye,r=bd,i=tp,s=$v,o=Jm,a=Ja,c=new Uint8Array(cn.slice(0,Td)),l=yi,u=yi.slice(0,yi.length),d=ws,h=Wv,f=t();return Td=e,Ye=n,bd=r,tp=i,$v=s,Jm=o,Ja=a,cn=c,Wv=h,yi=l,yi.splice(0,yi.length,...u),ws=d,pi=new DataView(cn.buffer,cn.byteOffset,cn.byteLength),f}function BL(){cn=null,Jm=null,yi=null}const FF=new Array(147);for(let t=0;t<256;t++)FF[t]=+("1e"+Math.floor(45.15-t*.30103));var JA=new ww({useRecords:!1});JA.unpack;JA.unpackMultiple;JA.unpack;let V0e=new Float32Array(1);new Uint8Array(V0e.buffer,0,4);let f1;try{f1=new TextEncoder}catch{}let jL,_W;const QA=typeof Tc<"u",dC=QA?function(t){return Tc.allocUnsafeSlow(t)}:Uint8Array,yW=QA?Tc:Uint8Array,SH=QA?4294967296:2144337920;let mt,SS,bs,Ze=0,ml,so=null,z0e;const G0e=21760,q0e=/[\u0080-\uFFFF]/,lb=Symbol("record-id");class W0e extends ww{constructor(e){super(e),this.offset=0;let n,r,i,s,o=yW.prototype.utf8Write?function(W,K){return mt.utf8Write(W,K,mt.byteLength-K)}:f1&&f1.encodeInto?function(W,K){return f1.encodeInto(W,mt.subarray(K)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let d=e.maxOwnStructures;d==null&&(d=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let h=u>32||d+u>64,f=u+64,p=u+d+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,E=0;this.pack=this.encode=function(W,K){if(mt||(mt=new dC(8192),bs=mt.dataView||(mt.dataView=new DataView(mt.buffer,0,8192)),Ze=0),ml=mt.length-10,ml-Ze<2048?(mt=new dC(mt.length),bs=mt.dataView||(mt.dataView=new DataView(mt.buffer,0,mt.length)),ml=mt.length-10,Ze=0):Ze=Ze+7&2147483640,n=Ze,K&Z0e&&(Ze+=K&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof W!="string"?(so=[],so.size=1/0):so=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let Q=i.sharedLength||0;if(Q>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let ie=0;ie<Q;ie++){let G=i[ie];if(!G)continue;let Z,se=i.transitions;for(let ue=0,Ae=G.length;ue<Ae;ue++){let Be=G[ue];Z=se[Be],Z||(Z=se[Be]=Object.create(null)),se=Z}se[lb]=ie+64}this.lastNamedStructuresLength=Q}c||(i.nextId=Q+64)}r&&(r=!1);let ne;try{a.randomAccessStructure&&W&&W.constructor&&W.constructor===Object?q(W):A(W);let Q=so;if(so&&xH(n,A,0),s&&s.idsToInsert){let ie=s.idsToInsert.sort((ue,Ae)=>ue.offset>Ae.offset?1:-1),G=ie.length,Z=-1;for(;Q&&G>0;){let ue=ie[--G].offset+n;ue<Q.stringsPosition+n&&Z===-1&&(Z=0),ue>Q.position+n?Z>=0&&(Z+=6):(Z>=0&&(bs.setUint32(Q.position+n,bs.getUint32(Q.position+n)+Z),Z=-1),Q=Q.previous,G++)}Z>=0&&Q&&bs.setUint32(Q.position+n,bs.getUint32(Q.position+n)+Z),Ze+=ie.length*6,Ze>ml&&F(Ze),a.offset=Ze;let se=Y0e(mt.subarray(n,Ze),ie);return s=null,se}return a.offset=Ze,K&J0e?(mt.start=n,mt.end=Ze,mt):mt.subarray(n,Ze)}catch(Q){throw ne=Q,Q}finally{if(i&&(T(),r&&a.saveStructures)){let Q=i.sharedLength||0,ie=mt.subarray(n,Ze),G=X0e(i,a);if(!ne)return a.saveStructures(G,G.isCompatible)===!1?a.pack(W,K):(a.lastNamedStructuresLength=Q,mt.length>1073741824&&(mt=null),ie)}mt.length>1073741824&&(mt=null),K&Q0e&&(Ze=n)}};const T=()=>{E<10&&E++;let W=i.sharedLength||0;if(i.length>W&&!c&&(i.length=W),v>1e4)i.transitions=null,E=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let K=0,ne=g.length;K<ne;K++)g[K][lb]=0;g=[]}},C=W=>{var K=W.length;K<16?mt[Ze++]=144|K:K<65536?(mt[Ze++]=220,mt[Ze++]=K>>8,mt[Ze++]=K&255):(mt[Ze++]=221,bs.setUint32(Ze,K),Ze+=4);for(let ne=0;ne<K;ne++)A(W[ne])},A=W=>{Ze>ml&&(mt=F(Ze));var K=typeof W,ne;if(K==="string"){let Q=W.length;if(so&&Q>=4&&Q<4096){if((so.size+=Q)>G0e){let se,ue=(so[0]?so[0].length*3+so[1].length:0)+10;Ze+ue>ml&&(mt=F(Ze+ue));let Ae;so.position?(Ae=so,mt[Ze]=200,Ze+=3,mt[Ze++]=98,se=Ze-n,Ze+=4,xH(n,A,0),bs.setUint16(se+n-3,Ze-n-se)):(mt[Ze++]=214,mt[Ze++]=98,se=Ze-n,Ze+=4),so=["",""],so.previous=Ae,so.size=0,so.position=se}let Z=q0e.test(W);so[Z?0:1]+=W,mt[Ze++]=193,A(Z?-Q:Q);return}let ie;Q<32?ie=1:Q<256?ie=2:Q<65536?ie=3:ie=5;let G=Q*3;if(Ze+G>ml&&(mt=F(Ze+G)),Q<64||!o){let Z,se,ue,Ae=Ze+ie;for(Z=0;Z<Q;Z++)se=W.charCodeAt(Z),se<128?mt[Ae++]=se:se<2048?(mt[Ae++]=se>>6|192,mt[Ae++]=se&63|128):(se&64512)===55296&&((ue=W.charCodeAt(Z+1))&64512)===56320?(se=65536+((se&1023)<<10)+(ue&1023),Z++,mt[Ae++]=se>>18|240,mt[Ae++]=se>>12&63|128,mt[Ae++]=se>>6&63|128,mt[Ae++]=se&63|128):(mt[Ae++]=se>>12|224,mt[Ae++]=se>>6&63|128,mt[Ae++]=se&63|128);ne=Ae-Ze-ie}else ne=o(W,Ze+ie);ne<32?mt[Ze++]=160|ne:ne<256?(ie<2&&mt.copyWithin(Ze+2,Ze+1,Ze+1+ne),mt[Ze++]=217,mt[Ze++]=ne):ne<65536?(ie<3&&mt.copyWithin(Ze+3,Ze+2,Ze+2+ne),mt[Ze++]=218,mt[Ze++]=ne>>8,mt[Ze++]=ne&255):(ie<5&&mt.copyWithin(Ze+5,Ze+3,Ze+3+ne),mt[Ze++]=219,bs.setUint32(Ze,ne),Ze+=4),Ze+=ne}else if(K==="number")if(W>>>0===W)W<32||W<128&&this.useRecords===!1||W<64&&!this.randomAccessStructure?mt[Ze++]=W:W<256?(mt[Ze++]=204,mt[Ze++]=W):W<65536?(mt[Ze++]=205,mt[Ze++]=W>>8,mt[Ze++]=W&255):(mt[Ze++]=206,bs.setUint32(Ze,W),Ze+=4);else if(W>>0===W)W>=-32?mt[Ze++]=256+W:W>=-128?(mt[Ze++]=208,mt[Ze++]=W+256):W>=-32768?(mt[Ze++]=209,bs.setInt16(Ze,W),Ze+=2):(mt[Ze++]=210,bs.setInt32(Ze,W),Ze+=4);else{let Q;if((Q=this.useFloat32)>0&&W<4294967296&&W>=-2147483648){mt[Ze++]=202,bs.setFloat32(Ze,W);let ie;if(Q<4||(ie=W*FF[(mt[Ze]&127)<<1|mt[Ze+1]>>7])>>0===ie){Ze+=4;return}else Ze--}mt[Ze++]=203,bs.setFloat64(Ze,W),Ze+=8}else if(K==="object"||K==="function")if(!W)mt[Ze++]=192;else{if(s){let ie=s.get(W);if(ie){if(!ie.id){let G=s.idsToInsert||(s.idsToInsert=[]);ie.id=G.push(ie)}mt[Ze++]=214,mt[Ze++]=112,bs.setUint32(Ze,ie.id),Ze+=4;return}else s.set(W,{offset:Ze-n})}let Q=W.constructor;if(Q===Object)U(W);else if(Q===Array)C(W);else if(Q===Map)if(this.mapAsEmptyObject)mt[Ze++]=128;else{ne=W.size,ne<16?mt[Ze++]=128|ne:ne<65536?(mt[Ze++]=222,mt[Ze++]=ne>>8,mt[Ze++]=ne&255):(mt[Ze++]=223,bs.setUint32(Ze,ne),Ze+=4);for(let[ie,G]of W)A(ie),A(G)}else{for(let ie=0,G=jL.length;ie<G;ie++){let Z=_W[ie];if(W instanceof Z){let se=jL[ie];if(se.write){se.type&&(mt[Ze++]=212,mt[Ze++]=se.type,mt[Ze++]=0);let Pe=se.write.call(this,W);Pe===W?Array.isArray(W)?C(W):U(W):A(Pe);return}let ue=mt,Ae=bs,Be=Ze;mt=null;let Se;try{Se=se.pack.call(this,W,Pe=>(mt=ue,ue=null,Ze+=Pe,Ze>ml&&F(Ze),{target:mt,targetView:bs,position:Ze-Pe}),A)}finally{ue&&(mt=ue,bs=Ae,Ze=Be,ml=mt.length-10)}Se&&(Se.length+Ze>ml&&F(Se.length+Ze),Ze=K0e(Se,mt,Ze,se.type));return}}if(Array.isArray(W))C(W);else{if(W.toJSON){const ie=W.toJSON();if(ie!==W)return A(ie)}if(K==="function")return A(this.writeFunction&&this.writeFunction(W));U(W)}}}else if(K==="boolean")mt[Ze++]=W?195:194;else if(K==="bigint"){if(W<BigInt(1)<<BigInt(63)&&W>=-(BigInt(1)<<BigInt(63)))mt[Ze++]=211,bs.setBigInt64(Ze,W);else if(W<BigInt(1)<<BigInt(64)&&W>0)mt[Ze++]=207,bs.setBigUint64(Ze,W);else if(this.largeBigIntToFloat)mt[Ze++]=203,bs.setFloat64(Ze,Number(W));else{if(this.largeBigIntToString)return A(W.toString());if(this.useBigIntExtension&&W<BigInt(2)**BigInt(1023)&&W>-(BigInt(2)**BigInt(1023))){mt[Ze++]=199,Ze++,mt[Ze++]=66;let Q=[],ie;do{let G=W&BigInt(255);ie=(G&BigInt(128))===(W<BigInt(0)?BigInt(128):BigInt(0)),Q.push(G),W>>=BigInt(8)}while(!((W===BigInt(0)||W===BigInt(-1))&&ie));mt[Ze-2]=Q.length;for(let G=Q.length;G>0;)mt[Ze++]=Number(Q[--G]);return}else throw new RangeError(W+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}Ze+=8}else if(K==="undefined")this.encodeUndefinedAsNil?mt[Ze++]=192:(mt[Ze++]=212,mt[Ze++]=0,mt[Ze++]=0);else throw new Error("Unknown type: "+K)},k=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?W=>{let K;if(this.skipValues){K=[];for(let ie in W)(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(ie))&&!this.skipValues.includes(W[ie])&&K.push(ie)}else K=Object.keys(W);let ne=K.length;ne<16?mt[Ze++]=128|ne:ne<65536?(mt[Ze++]=222,mt[Ze++]=ne>>8,mt[Ze++]=ne&255):(mt[Ze++]=223,bs.setUint32(Ze,ne),Ze+=4);let Q;if(this.coercibleKeyAsNumber)for(let ie=0;ie<ne;ie++){Q=K[ie];let G=Number(Q);A(isNaN(G)?Q:G),A(W[Q])}else for(let ie=0;ie<ne;ie++)A(Q=K[ie]),A(W[Q])}:W=>{mt[Ze++]=222;let K=Ze-n;Ze+=2;let ne=0;for(let Q in W)(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(Q))&&(A(Q),A(W[Q]),ne++);if(ne>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');mt[K+++n]=ne>>8,mt[K+n]=ne&255},I=this.useRecords===!1?k:e.progressiveRecords&&!h?W=>{let K,ne=i.transitions||(i.transitions=Object.create(null)),Q=Ze++-n,ie;for(let G in W)if(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(G)){if(K=ne[G],K)ne=K;else{let Z=Object.keys(W),se=ne;ne=i.transitions;let ue=0;for(let Ae=0,Be=Z.length;Ae<Be;Ae++){let Se=Z[Ae];K=ne[Se],K||(K=ne[Se]=Object.create(null),ue++),ne=K}Q+n+1==Ze?(Ze--,$(ne,Z,ue)):X(ne,Z,Q,ue),ie=!0,ne=se[G]}A(W[G])}if(!ie){let G=ne[lb];G?mt[Q+n]=G:X(ne,Object.keys(W),Q,0)}}:W=>{let K,ne=i.transitions||(i.transitions=Object.create(null)),Q=0;for(let G in W)(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(G))&&(K=ne[G],K||(K=ne[G]=Object.create(null),Q++),ne=K);let ie=ne[lb];ie?ie>=96&&h?(mt[Ze++]=((ie-=96)&31)+96,mt[Ze++]=ie>>5):mt[Ze++]=ie:$(ne,ne.__keys__||Object.keys(W),Q);for(let G in W)(typeof W.hasOwnProperty!="function"||W.hasOwnProperty(G))&&A(W[G])},N=typeof this.useRecords=="function"&&this.useRecords,U=N?W=>{N(W)?I(W):k(W)}:I,F=W=>{let K;if(W>16777216){if(W-n>SH)throw new Error("Packed buffer would be larger than maximum buffer size");K=Math.min(SH,Math.round(Math.max((W-n)*(W>67108864?1.25:2),4194304)/4096)*4096)}else K=(Math.max(W-n<<2,mt.length-1)>>12)+1<<12;let ne=new dC(K);return bs=ne.dataView||(ne.dataView=new DataView(ne.buffer,0,K)),W=Math.min(W,mt.length),mt.copy?mt.copy(ne,0,n,W):ne.set(mt.slice(n,W)),Ze-=n,n=0,ml=ne.length-10,mt=ne},$=(W,K,ne)=>{let Q=i.nextId;Q||(Q=64),Q<f&&this.shouldShareStructure&&!this.shouldShareStructure(K)?(Q=i.nextOwnId,Q<p||(Q=f),i.nextOwnId=Q+1):(Q>=p&&(Q=f),i.nextId=Q+1);let ie=K.highByte=Q>=96&&h?Q-96>>5:-1;W[lb]=Q,W.__keys__=K,i[Q-64]=K,Q<f?(K.isShared=!0,i.sharedLength=Q-63,r=!0,ie>=0?(mt[Ze++]=(Q&31)+96,mt[Ze++]=ie):mt[Ze++]=Q):(ie>=0?(mt[Ze++]=213,mt[Ze++]=114,mt[Ze++]=(Q&31)+96,mt[Ze++]=ie):(mt[Ze++]=212,mt[Ze++]=114,mt[Ze++]=Q),ne&&(v+=E*ne),g.length>=d&&(g.shift()[lb]=0),g.push(W),A(K))},X=(W,K,ne,Q)=>{let ie=mt,G=Ze,Z=ml,se=n;mt=SS,Ze=0,n=0,mt||(SS=mt=new dC(8192)),ml=mt.length-10,$(W,K,Q),SS=mt;let ue=Ze;if(mt=ie,Ze=G,ml=Z,n=se,ue>1){let Ae=Ze+ue-1;Ae>ml&&F(Ae);let Be=ne+n;mt.copyWithin(Be+ue,Be+1,Ze),mt.set(SS.slice(0,ue),Be),Ze=Ae}else mt[ne+n]=SS[0]},q=W=>{let K=z0e(W,mt,n,Ze,i,F,(ne,Q,ie)=>{if(ie)return r=!0;Ze=Q;let G=mt;return A(ne),T(),G!==mt?{position:Ze,targetView:bs,target:mt}:Ze},this);if(K===0)return U(W);Ze=K}}useBuffer(e){mt=e,mt.dataView||(mt.dataView=new DataView(mt.buffer,mt.byteOffset,mt.byteLength)),Ze=0}set position(e){Ze=e}get position(){return Ze}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}_W=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,lW];jL=[{pack(t,e,n){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),n(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,t.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(t,e,n){if(this.setAsEmptyObject)return e(0),n({});let r=Array.from(t),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),n(r)}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),n([t.name,t.message,t.cause])}},{pack(t,e,n){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),n([t.source,t.flags])}},{pack(t,e){this.moreTypes?wH(t,16,e):TH(QA?Tc.from(t):new Uint8Array(t),e)}},{pack(t,e){let n=t.constructor;n!==yW&&this.moreTypes?wH(t,gW.indexOf(n.name),e):TH(t,e)}},{pack(t,e){let{target:n,position:r}=e(1);n[r]=193}}];function wH(t,e,n,r){let i=t.byteLength;if(i+1<256){var{target:s,position:o}=n(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=n(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=n(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,t.buffer||(t=new Uint8Array(t)),s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),o)}function TH(t,e){let n=t.byteLength;var r,i;if(n<256){var{target:r,position:i}=e(n+2);r[i++]=196,r[i++]=n}else if(n<65536){var{target:r,position:i}=e(n+3);r[i++]=197,r[i++]=n>>8,r[i++]=n&255}else{var{target:r,position:i,targetView:s}=e(n+5);r[i++]=198,s.setUint32(i,n),i+=4}r.set(t,i)}function K0e(t,e,n,r){let i=t.length;switch(i){case 1:e[n++]=212;break;case 2:e[n++]=213;break;case 4:e[n++]=214;break;case 8:e[n++]=215;break;case 16:e[n++]=216;break;default:i<256?(e[n++]=199,e[n++]=i):i<65536?(e[n++]=200,e[n++]=i>>8,e[n++]=i&255):(e[n++]=201,e[n++]=i>>24,e[n++]=i>>16&255,e[n++]=i>>8&255,e[n++]=i&255)}return e[n++]=r,e.set(t,n),n+=i,n}function Y0e(t,e){let n,r=e.length*6,i=t.length-r;for(;n=e.pop();){let s=n.offset,o=n.id;t.copyWithin(s+r,s,i),r-=6;let a=s+r;t[a++]=214,t[a++]=105,t[a++]=o>>24,t[a++]=o>>16&255,t[a++]=o>>8&255,t[a++]=o&255,i=s}return t}function xH(t,e,n){if(so.length>0){bs.setUint32(so.position+t,Ze+n-so.position-t),so.stringsPosition=Ze-t;let r=so;so=null,e(r[0]),e(r[1])}}function X0e(t,e){return t.isCompatible=n=>{let r=!n||(e.lastNamedStructuresLength||0)===n.length;return r||e._mergeStructures(n),r},t}let bW=new W0e({useRecords:!1});bW.pack;bW.pack;const J0e=512,Q0e=1024,Z0e=2048;function CH(){return{id:Po()}}function $L(t){var e;return((e=t==null?void 0:t.id)==null?void 0:e.length)??!1}function hR(t,e){if(!he(t)||!tu(e))return;const{color:n,bg:r}=oK(e);he(n)&&(t.color=n),he(r)&&(t.bg=r)}function ST(t){var e;return rr((t==null?void 0:t.name)??((e=t==null?void 0:t.kinddata)==null?void 0:e.name)??"")}function eye(){return new Array(ts*Il).map(()=>{})}function tye(t=Sl){const e={terrain:eye(),objects:{},id:""};return t(e)}function Tw(t,e){return!he(t)||!he(e==null?void 0:e.x)||!he(e==null?void 0:e.y)||e.x<0||e.x>=ts||e.y<0||e.y>=Il?-1:e.x+e.y*ts}function HL(t,e){const n=Tw(t,e);if(n<0||!he(t==null?void 0:t.lookup))return;const r=c_(t,t.lookup[n]??"");return he(r)?r:t.terrain[n]}function ZA(t,e){if(!he(t)||!he(e)||!he(e.x)||!he(e.y)||e.x<0||e.x>=ts||e.y<0||e.y>=Il)return;const n=$c(e),r=e.x+e.y*ts;return t.terrain[r]=n,t.terrain[r]}function nye(t,e){if(!he(t)||!he(e))return;const n=$c(e);return n.id=n.id??Po(),t.objects[n.id]=n,t.objects[n.id]}function rye(t,e,n){return ZA(t,{...e,kind:n})}function EW(t,e,n,r){return nye(t,{...e,kind:n,id:r})}function c_(t,e){if(t)return t.objects[e]}function VL(t,e,n,r,i){if(!he(t)||!he(e))return{x:0,y:0};const s={x:e.x??0,y:e.y??0},o={x:e.lx??s.x,y:e.ly??s.y},a=Mv(o,s),c=ts-1,l=Il-1;for(let u=0;u<r.length;++u){const d=l0e(r[u]);switch(d){case pn.IDLE:break;case pn.NORTH:case pn.SOUTH:case pn.WEST:case pn.EAST:wa(s,d);break;case pn.BY:{const[h,f]=r.slice(u+1);Mn(h)&&Mn(f)&&(s.x=xi(s.x+h,0,c),s.y=xi(s.y+f,0,l)),u+=2;break}case pn.AT:{const[h,f]=r.slice(u+1);Mn(h)&&Mn(f)&&(s.x=xi(h,0,c),s.y=xi(f,0,l)),u+=2;break}case pn.FLOW:wa(s,a);break;case pn.SEEK:{const h=iye(t,e,n);XE(h)&&wa(s,Mv(i,h));break}case pn.RNDNS:wa(s,Hu(pn.NORTH,pn.SOUTH));break;case pn.RNDNE:wa(s,Hu(pn.NORTH,pn.EAST));break;case pn.RND:wa(s,Hu(pn.NORTH,pn.SOUTH,pn.WEST,pn.EAST));break;case pn.CW:case pn.CCW:case pn.OPP:case pn.RNDP:{const h=VL(t,e,n,r.slice(u+1),i);switch(s.x=i.x,s.y=i.y,d){case pn.CW:switch(Mv(i,h)){case pn.NORTH:wa(s,pn.EAST);break;case pn.SOUTH:wa(s,pn.WEST);break;case pn.EAST:wa(s,pn.SOUTH);break;case pn.WEST:wa(s,pn.NORTH);break}break;case pn.CCW:switch(Mv(i,h)){case pn.NORTH:wa(s,pn.WEST);break;case pn.SOUTH:wa(s,pn.EAST);break;case pn.EAST:wa(s,pn.NORTH);break;case pn.WEST:wa(s,pn.SOUTH);break}break;case pn.OPP:switch(Mv(i,h)){case pn.NORTH:wa(s,pn.SOUTH);break;case pn.SOUTH:wa(s,pn.NORTH);break;case pn.EAST:wa(s,pn.WEST);break;case pn.WEST:wa(s,pn.EAST);break}break;case pn.RNDP:switch(Mv(i,h)){case pn.NORTH:case pn.SOUTH:s.x+=Hu(-1,1);break;case pn.WEST:case pn.EAST:s.y+=Hu(-1,1);break}break}break}}}return s}function iye(t,e,n){if(!he(t)||!he(e))return;const r=t.objects[n];if(he(r))return r;if(XE(e))return aW(e,bT(t,"player"))}const SW={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function op(t){return Lr(t)&&wW(t[0])}function wW(t){return he(z0[t])&&Yn(t)}function TW(t){if(Yn(t))return SW[rr(t)]}function RH(t){if(op(t))return t;if(wW(t))return[t];const e=TW(t);if(he(e))return[e]}function p1(t){const e=_e.words[t],n=RH(e);if(op(n))return[n,t+1];const[r,i]=Qa(t),s=RH(r);return op(s)?[s,i]:[void 0,t]}const xW={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",iswalkable:"ISWALKABLE",isswimmable:"ISSWIMABLE"};Gi.ISSOLID,Gi.ISWALK,Gi.ISSWIM,Gi.ISBULLET,Gi.ISWALK,Gi.ISSWIM;function qm(t){return Lr(t)&&zL(t[0])}function zL(t){return he(Gi[t])&&Yn(t)}function sye(t){if(Yn(t))return xW[rr(t)]}function CW(t){const e=_e.words[t];if(qm(e))return[e,t+1];if(zL(e))return[[e],t+1];const[n,r]=Qa(t);return qm(n)?[n,r]:zL(n)?[[n],r]:[void 0,t]}const _e={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var lt=(t=>(t[t.CATEGORY=0]="CATEGORY",t[t.COLLISION=1]="COLLISION",t[t.COLOR=2]="COLOR",t[t.KIND=3]="KIND",t[t.DIR=4]="DIR",t[t.NAME=5]="NAME",t[t.NUMBER=6]="NUMBER",t[t.STRING=7]="STRING",t[t.NUMBER_OR_STRING=8]="NUMBER_OR_STRING",t[t.MAYBE_CATEGORY=9]="MAYBE_CATEGORY",t[t.MAYBE_COLLISION=10]="MAYBE_COLLISION",t[t.MAYBE_COLOR=11]="MAYBE_COLOR",t[t.MAYBE_KIND=12]="MAYBE_KIND",t[t.MAYBE_DIR=13]="MAYBE_DIR",t[t.MAYBE_NAME=14]="MAYBE_NAME",t[t.MAYBE_NUMBER=15]="MAYBE_NUMBER",t[t.MAYBE_STRING=16]="MAYBE_STRING",t[t.MAYBE_NUMBER_OR_STRING=17]="MAYBE_NUMBER_OR_STRING",t[t.ANY=18]="ANY",t))(lt||{});function na(t,e,n){throw console.info(n,_e.element,_e.elementid,_e.elementfocus),new Error(`Invalid arg, expected: ${t} but got ${JSON.stringify(e)}`)}function Mt(t,e,n){var o,a,c,l;const r=_e.words;_e.words=t;const i=[];let s=e;for(let u=0;u<n.length;++u)switch(n[u]){case 0:{const[d,h]=p1(s);op(d)||na("terrain or object",d,t),s=h,i.push(d);break}case 1:{const[d,h]=CW(s);qm(d)||na("solid, walk, swim, bullet, walkable or swimmable",d,t),s=h,i.push(d);break}case 2:{const[d,h]=xR(s);tu(d)||na("color",d,t),s=h,i.push(d);break}case 3:{const[d,h]=hH(s);yE(d)?(s=h,i.push(d)):na("kind",d,t);break}case 4:{const[d,h]=LL(s);if(kh(d)){const f={x:((o=_e.element)==null?void 0:o.x)??0,y:((a=_e.element)==null?void 0:a.y)??0},p=he(_e.board)&&he(_e.element)?VL(_e.board,_e.element,_e.elementfocus,d,f):f;s=h,i.push(p)}else na("direction",d,t);break}case 5:{const d=_e.words[s];Yn(d)||na("string",d,t),++s,i.push(d);break}case 6:{const[d,h]=Qa(s);if(Yn(d)){const f=parseFloat(d);Mn(f)?i.push(f):na("number",d,t)}else Mn(d)?i.push(d):na("number",d,t);s=h;break}case 7:{const[d,h]=Qa(s);Yn(d)||na("string",d,t),s=h,i.push(d);break}case 8:{const[d,h]=Qa(s);let f=d;if(Yn(f)){const p=parseFloat(f);Mn(p)&&(f=p)}else Mn(f)||na("number or string",f,t);s=h,i.push(f);break}case 9:{const[d,h]=p1(s);d!==void 0&&!op(d)&&na("optional terrain or object",d,t),s=h,i.push(d);break}case 10:{const[d,h]=p1(s);d!==void 0&&!qm(d)&&na("optional solid, walk, swim, bullet, walkable or swimmable",d,t),s=h,i.push(d);break}case 11:{const[d,h]=xR(s);d!==void 0&&!tu(d)&&na("optional color",d,t),s=h,i.push(d);break}case 12:{const[d,h]=hH(s);d!==void 0&&!yE(d)&&na("optional kind",d,t),s=h,i.push(d);break}case 13:{const[d,h]=LL(s);if(kh(d)){const f=((c=_e.element)==null?void 0:c.x)??0,p=((l=_e.element)==null?void 0:l.y)??0,g={x:f,y:p},v=_e.board?VL(_e.board,_e.element,_e.elementfocus,d,g):g;s=h,i.push(v)}else d===void 0?(s=h,i.push(void 0)):na("optional direction",d,t);break}case 14:{const d=_e.words[s];d!==void 0&&!Yn(d)&&na("optional string",d,t),++s,i.push(d);break}case 15:{const[d,h]=Qa(s);if(Yn(d)){const f=parseFloat(d);Mn(f)?i.push(f):na("optional number",d,t)}else Mn(d)||d===void 0?i.push(d):na("optional number",d,t);s=h;break}case 16:{const[d,h]=Qa(s);d!==void 0&&!Yn(d)&&na("optional string",d,t),s=h,i.push(d);break}case 17:{const[d,h]=Qa(s);let f=d;if(Yn(f)){const p=parseFloat(f);Mn(p)&&(f=p)}else f!==void 0&&!Mn(f)&&na("number or string",f,t);s=h,i.push(f);break}case 18:{const[d,h]=Qa(s);s=h,i.push(d);break}}return _e.words=r,[...i,s]}const oye=["echo","reverb","chorus","phaser","distortion","vibrato"];function AH(t,e){const[n]=Mt(t,0,[lt.NAME]);Tv(qe,n,e)}function Mm(t,e){const[n,r]=Mt(e,0,[lt.NUMBER_OR_STRING]);if(Mn(n))LN(qe,t,"volume",n);else if(oye.includes(rr(n))){const[i,s]=Mt(e,r,[lt.NUMBER_OR_STRING,lt.MAYBE_NUMBER_OR_STRING]);Dle(qe,t,n,i,s)}else{const[i]=Mt(e,r,[lt.MAYBE_NUMBER_OR_STRING]);if(Mn(i)){const s=e.length-r,o=new Array(s).fill(lt.NUMBER),a=Mt(e,r,o).slice(0,s),c=a.length===1?a[0]:a;LN(qe,t,n,c)}else{const[s]=Mt(e,r,[lt.MAYBE_NUMBER_OR_STRING]);LN(qe,t,n,s)}}}const aye=vg().command("tts",(t,e)=>{const[n,r]=Mt(e,0,[lt.STRING]),i=e.slice(r).map(ao).join("");return kle(qe,n,i),0}).command("tta",(t,e)=>{const n=e.map(ao).join("");return Nle(qe,n),0}).command("bpm",(t,e)=>{const[n]=Mt(e,0,[lt.NUMBER]);return Ple(qe,n),0}).command("mainvol",(t,e)=>{const[n]=Mt(e,0,[lt.NUMBER]);return t$(qe,n),0}).command("mainvolume",(t,e)=>{const[n]=Mt(e,0,[lt.NUMBER]);return t$(qe,n),0}).command("drumvol",(t,e)=>{const[n]=Mt(e,0,[lt.NUMBER]);return n$(qe,n),0}).command("drumvolume",(t,e)=>{const[n]=Mt(e,0,[lt.NUMBER]);return n$(qe,n),0}).command("ttsvol",(t,e)=>{const[n]=Mt(e,0,[lt.NUMBER]);return r$(qe,n),0}).command("ttsvolume",(t,e)=>{const[n]=Mt(e,0,[lt.NUMBER]);return r$(qe,n),0}).command("play",(t,e)=>(AH(e,!1),0)).command("bgplay",(t,e)=>(AH(e,!0),0)).command("synth",(t,e)=>{for(let n=0;n<8;++n)Mm(n,e);return 0}).command("synth1",(t,e)=>(Mm(0,e),0)).command("synth2",(t,e)=>(Mm(1,e),0)).command("synth3",(t,e)=>(Mm(2,e),0)).command("synth4",(t,e)=>(Mm(3,e),0)).command("synth5",(t,e)=>(Mm(4,e),0)).command("synth6",(t,e)=>(Mm(5,e),0)).command("synth7",(t,e)=>(Mm(6,e),0)).command("synth8",(t,e)=>(Mm(7,e),0)),cye=66.666,RW=Math.round(1e3/cye),lye=3;function Xf(t){return new Promise(e=>setTimeout(e,t))}function uye(t){const e=document.createElement("canvas");if(e.width=(t==null?void 0:t.width)||1,e.height=(t==null?void 0:t.height)||1,t){const n=e.getContext("2d"),r=n==null?void 0:n.getImageData(0,0,t.width,t.height);if(r&&n){let i=0;const{data:s}=r;for(let o=0;o<s.length;o+=4){const a=t.bits[i];s[o]=a,s[o+1]=a,s[o+2]=a,s[o+3]=255,i+=1}n.putImageData(r,0,0)}}return e}function AW(t,e){return{width:t,height:e,size:t*e,bits:new Uint8Array(t*e).fill(0)}}function XN(t,e,n){return{width:t,height:e,size:t*e,bits:new Uint8Array(n)}}function wT(t){const e=Math.floor(t.length/_E);if(e*_E!==t.length){ci(qe,"size","wrong number of bytes for a palette");return}const n=AW(3,e);for(let r=0;r<n.bits.length;++r)n.bits[r]=t[r];return n}function dye(t,e){return t&1<<e?255:0}function TT(t){const e=Math.floor(t.length/PL);if(e*PL!==t.length){ci(qe,"size","wrong number of bytes for a charset");return}const n=Math.ceil(e/Rd),r=Gv*Rd,i=AW(r,qv*n);let s=0,o=0,a=0;for(let c=0;c<t.length;++c){const l=o*qv+a,u=t[c];for(let d=0;d<Gv;++d){const h=s*Gv+d;i.bits[h+l*r]=dye(u,7-d)}++a,a===qv&&(a=0,++s,s===Rd&&(s=0,++o))}return i}const BF=PF(32,126).map(t=>String.fromCharCode(t));function li(t){return Yu({...t,name:`token_${t.name}`})}function Ip(t,e=!1){return li(e?{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:qc,group:Na.SKIPPED}:{name:t,pattern:new RegExp(t.toLowerCase(),"i"),longer_alt:qc})}const xw=li({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),hye=li({name:"whitespace",pattern:/ +/,group:Na.SKIPPED}),fye=li({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:Na.SKIPPED}),jF=li({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),Sb=li({name:"command",pattern:/#/,start_chars_hint:["#"]});let MW=!1;function pye(t,e,n){if(!MW)return null;const[r]=n.slice(-1);if(r&&r.tokenType!==xw)return null;let i=e;for(;t[i]===" ";)i++;if("@#/?':!".includes(t[i]))return null;let s=e+1;for(;s<t.length&&t[s]!==`
`;)s++;const o=t.substring(e,s);return o.trim().length===0?null:[o]}const IW=li({name:"text",pattern:pye,line_breaks:!1,start_chars_hint:BF.filter(t=>"@#/?':!".includes(t)===!1)}),OW=li({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),kW=li({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),NW=li({name:"hyperlink",pattern:/!/,start_chars_hint:["!"]}),PW=li({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),qc=li({name:"stringliteral",pattern:/[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:BF}),DW=li({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),LW=li({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),UW=li({name:"iseq",pattern:/=|is|eq|equal/,longer_alt:qc}),FW=li({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/,longer_alt:qc}),BW=li({name:"islessthan",pattern:/<|below/,longer_alt:qc}),jW=li({name:"isgreaterthan",pattern:/>|above/,longer_alt:qc}),$W=li({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/,longer_alt:qc}),HW=li({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/,longer_alt:qc}),GL=li({name:"or",pattern:/or/i,longer_alt:qc}),qL=li({name:"not",pattern:/not/i,longer_alt:qc}),WL=li({name:"and",pattern:/and/i,longer_alt:qc}),KL=li({name:"plus",pattern:/\+/}),YL=li({name:"minus",pattern:/-/}),VW=li({name:"power",pattern:/\*\*/}),zW=li({name:"multiply",pattern:/\*/}),XL=li({name:"divide",pattern:/\//}),GW=li({name:"moddivide",pattern:/%/}),qW=li({name:"floordivide",pattern:/%%/}),WW=li({name:"query",pattern:/\?/}),KW=li({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),YW=li({name:"rparen",pattern:/\)/,pop_mode:!0}),XW=li({name:"command_play",pattern:/(play|bgplay) .*/,start_chars_hint:BF,longer_alt:qc}),JL=li({name:"if",pattern:/if|try|take|give/,longer_alt:qc}),m1=Ip("do"),mye=Ip("to",!0),QL=Ip("done"),gye=Ip("then",!0),ZL=Ip("else"),JW=Ip("while"),QW=Ip("repeat"),ZW=Ip("waitfor"),e9=li({name:"foreach",pattern:/foreach|for/,longer_alt:qc}),t9=Ip("break"),n9=Ip("continue");function r9(t){return[...t,LW,UW,FW,$W,BW,HW,jW,GL,qL,WL,KL,YL,VW,zW,XL,qW,GW,WW,KW,YW,DW,qc]}const i9=r9([IW,jF,XW,Sb,OW,kW,NW,PW,xw,hye,t9,n9,QL,m1,ZL,e9,JL,QW,gye,mye,ZW,JW]),vye=new Na({defaultMode:"use_newlines",modes:{use_newlines:i9,ignore_newlines:r9([fye])}},{skipValidations:!fp,ensureOptimizations:fp});function s9(t){MW=!0;const e=vye.tokenize(t||` 
`),[n]=(Lr(e.tokens)?e.tokens:[]).slice(-1);return n&&n.tokenType.name!=="Newline"&&e.tokens.push(yT(xw,`
`,n.startOffset,n.endOffset??NaN,n.startLine??NaN,n.endLine??NaN,n.startColumn??NaN,n.endColumn??NaN)),e}function _ye(t,e,n=!0){if(n){const[r,...i]=e;switch(rr(r??"")){default:return{type:wn.OBJECT,values:e};case"loader":return{type:wn.LOADER,values:i};case"board":return{type:wn.BOARD,values:i};case"object":return{type:wn.OBJECT,values:i};case"terrain":return{type:wn.TERRAIN,values:i};case"charset":return{type:wn.CHARSET,values:i};case"palette":return{type:wn.PALETTE,values:i}}}else{const[r,i,...s]=e,o=rr(i??""),a=[r,t,...s];switch(o){default:return{type:wn.CONST,values:e};case"rn":case"range":return{type:wn.RANGE,values:a};case"sl":case"select":return{type:wn.SELECT,values:a};case"nm":case"number":return{type:wn.NUMBER,values:a};case"tx":case"text":return{type:wn.TEXT,values:a};case"ln":case"link":return{type:wn.LINK,values:a};case"hk":case"hotkey":return{type:wn.HOTKEY,values:a};case"copyit":return{type:wn.COPYIT,values:a};case"openit":return{type:wn.OPENIT,values:a};case"zssedit":return{type:wn.ZSSEDIT,values:a};case"charedit":return{type:wn.CHAREDIT,values:a};case"coloredit":return{type:wn.COLOREDIT,values:a}}}}function Uu(t){switch(t){case wn.LOADER:return"loader";case wn.BOARD:return"board";case wn.OBJECT:return"object";case wn.TERRAIN:return"terrain";case wn.CHARSET:return"charset";case wn.PALETTE:return"palette";case wn.CONST:return"const";case wn.RANGE:return"range";case wn.SELECT:return"select";case wn.NUMBER:return"number";case wn.TEXT:return"text";case wn.LINK:return"link";case wn.HOTKEY:return"hotkey";case wn.COPYIT:return"copyit";case wn.OPENIT:return"openit";case wn.ZSSEDIT:return"zssedit";case wn.CHAREDIT:return"charedit";case wn.COLOREDIT:return"coloredit"}}function yye(t,e){return{id:Po(),code:t,...e}}function JN(t){const e={...eM(t)};return Object.keys(e).forEach(n=>{switch(n){case"type":case"name":delete e[n];break}}),e}function bye(t){const e=s9(t),n={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===jF){const o=s.image.slice(1),[a,c]=o.split(";").map(h=>h.trim()),l=a.split(" "),u=_ye(Yn(c)?c:"",l,r),d=rr(u.values.join(" "));switch(r=!1,u.type){case wn.LOADER:n.type=Ur.LOADER,n.name=d;break;case wn.BOARD:n.type=Ur.BOARD,n.name=d;break;case wn.OBJECT:n.type=Ur.OBJECT,n.name=d||"object";break;case wn.TERRAIN:n.type=Ur.TERRAIN,n.name=d;break;case wn.CHARSET:n.type=Ur.CHARSET,n.name=d;break;case wn.PALETTE:n.type=Ur.PALETTE,n.name=d;break;case wn.CONST:{const[h,f]=u.values;if(Yn(h)){const p=rr(h);if(Yn(f)){const g=parseFloat(f);n[p]=Mn(g)?g:f}else Mn(f)?n[p]=f:n[p]=1}break}case wn.RANGE:case wn.SELECT:case wn.NUMBER:case wn.TEXT:case wn.LINK:case wn.HOTKEY:case wn.ZSSEDIT:case wn.CHAREDIT:case wn.COLOREDIT:{const[h,...f]=u.values;if(Yn(h)){const p=rr(h);n[p]=[Uu(u.type),...f]}break}}}}return n}function eM(t){var e;return he(t)?(he((e=t.stats)==null?void 0:e.type)||(t.stats=bye(t.code),he(t.stats.type)||(t.stats.type=Ur.OBJECT)),t.stats):{}}function o9(t){switch(t){default:case Ur.ERROR:return"error";case Ur.LOADER:return Uu(wn.LOADER);case Ur.BOARD:return Uu(wn.BOARD);case Ur.OBJECT:return Uu(wn.OBJECT);case Ur.TERRAIN:return Uu(wn.TERRAIN);case Ur.CHARSET:return Uu(wn.CHARSET);case Ur.PALETTE:return Uu(wn.PALETTE)}}function bE(t){return eM(t).type??Ur.ERROR}function hC(t){return o9(bE(t))}function wh(t){return eM(t).name??""}function MH(t,e){const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r],s=t[i];if(!Lr(s))switch(i){case"name":case"char":case"color":case"bg":case"light":case"p1":case"p2":case"p3":case"cycle":case"stepx":case"stepy":e[i]=t[i];break;case"ispushable":e.pushable=1;break;case"iswalk":case"iswalkable":e.collision=Gi.ISWALK;break;case"isswim":case"isswimable":e.collision=Gi.ISSWIM;break;case"issolid":e.collision=Gi.ISSOLID;break;case"isbullet":e.collision=Gi.ISBULLET;break;case"isdestructible":e.destructible=1;break}}}function K0(t){if(he(t))switch(bE(t)){default:return;case Ur.ERROR:return t.code??"";case Ur.LOADER:return t.code??"";case Ur.BOARD:{he(t.board)||(t.board=tye()),t.board.id=t.id;const e=JN(t);return t.board.isdark=e.isdark??t.board.isdark?1:0,t.board.startx=e.startx??t.board.startx,t.board.starty=e.starty??t.board.starty,t.board.over=e.over??t.board.over,t.board.under=e.under??t.board.under,t.board.exitnorth=e.exitnorth??t.board.exitnorth,t.board.exitsouth=e.exitsouth??t.board.exitsouth,t.board.exitwest=e.exitwest??t.board.exitwest,t.board.exiteast=e.exiteast??t.board.exiteast,t.board.timelimit=e.timelimit??t.board.timelimit,t.board.restartonzap=e.restartonzap??t.board.restartonzap,t.board.maxplayershots=e.maxplayershots??t.board.maxplayershots,t.board}case Ur.OBJECT:return he(t.object)||(t.object=CH()),t.object.name=wh(t),t.object.category=z0.ISOBJECT,MH(JN(t),t.object),t.object;case Ur.TERRAIN:return he(t.terrain)||(t.terrain=CH()),t.terrain.name=wh(t),t.terrain.category=z0.ISTERRAIN,MH(JN(t),t.terrain),t.terrain;case Ur.PALETTE:return he(t.palette)||(t.palette=wT(OA)),t.palette;case Ur.CHARSET:return he(t.charset)||(t.charset=TT(IA)),t.charset}}function a9(t){return{id:Po(),name:Tue(),timestamp:0,activelist:[],pages:t,flags:{}}}function xT(t,e){if(!he(t))return;const n=rr(e);return t.pages.find(i=>i.id===e||n===wh(i))}function Cw(t,e,n){if(!he(t))return;const r=rr(n);return t.pages.find(s=>bE(s)===e&&(s.id===n||r===wh(s)))}function e2(t,e,n){let r=Cw(t,e,n);if(!he(r)){const i=o9(e);r=yye(i==="object"?`@${n||"object"}
`:`@${i} ${n}
`,{}),Eye(t,r)}return r}function I0(t,e,n){return he(t)?t.pages.filter(r=>bE(r)===e).filter(r=>{const i=eM(r);return he(i[n])}):[]}function Eye(t,e){if(!he(t)||!he(e))return!1;const n=xT(t,e.id);return he(n)?!1:(t.pages.push(e),!0)}function Sye(t,e){const n=xT(t,e);if(he(t)&&he(n)){const r=rr(e);return t.pages=t.pages.filter(i=>i.id!==e&&r!==wh(i)),n}}function CT(t,e){if(he(e)&&he(e.kind))return he(e.kinddata)||(e.kinddata=he(e.id)?$F(t,e.kind):l9(t,e.kind)),e.kinddata}function c9(t,e,n){const r=CT(t,e);return(e==null?void 0:e[n])??(r==null?void 0:r[n])}function $F(t,e){const n=e??"",r=Cw(t,Ur.OBJECT,n);if(he(r)){const i=K0(r);return{...$c(i),name:n,code:r.code}}}function l9(t,e){const n=e??"",r=Cw(t,Ur.TERRAIN,n);if(he(r)){const i=K0(r);return{...$c(i),name:n,code:r.code}}}function tM(t,e){const n=xT(t,e);return K0(n)}function nM(t,e){return t?(t.flags[e]=t.flags[e]??{},t.flags[e]):{}}function wye(t,e){t&&delete t.flags[e]}function u9(t,e,n){const r=nM(t,e);return r==null?void 0:r[n]}function Tye(t,e,n,r){const i=nM(t,e);return i&&(i[n]=r),r}function xye(t,e){const n=u9(t,e,"board");return tM(t,Yn(n)?n:"")}function Cye(t,e,n){if(!he(t))return;Tye(t,e,"board",n);const r=tM(t,n);he(r)?t.activelist.includes(e)||t.activelist.push(e):t.activelist=t.activelist.filter(i=>i!==e)}function zS(t,e,n,r){if(!he(t))return;const i=xye(t,e);if(!he(i))return;const s=c_(i,e);if(!$L(s)||!(s!=null&&s.id))return;const o=tM(t,n);if(!he(o)||(Bv(t,o),HF(t,o,Gi.ISWALK,r)))return;delete i.objects[s.id];const a=Tw(i,s);i.lookup&&(i.lookup[a]=void 0),s.x=r.x,s.y=r.y,o.objects[s.id]=s;const c=Tw(o,s);o.lookup&&(o.lookup[c]=s.id),Cye(t,e,o.id)}function Rye(t){const n=((t==null?void 0:t.activelist)??[]).map(r=>{const i=u9(t,r,"board");return Yn(i)?i:""});return r0e(n)}function Aye(t){return Rye(t).map(n=>tM(t,n)).filter(he)}function HF(t,e,n,r){if(!he(t)||!he(e)||!he(e.lookup)||r.x<0||r.x>=ts||r.y<0||r.y>=Il)return!0;const i=r.x+r.y*ts,s=c_(e,e.lookup[i]??"404");if(he(s))return!0;const o=e.terrain[i];if(he(o)){const a=CT(t,o),c=o.collision??(a==null?void 0:a.collision);return iW(n,c)}return!1}function Mye(t,e,n,r){const i=c_(e,(n==null?void 0:n.id)??""),s=(i==null?void 0:i.x)??-1,o=(i==null?void 0:i.y)??-1;if(s-r.x===0&&o-r.y===0)return!0;const a=c9(t,i,"collision");return HF(t,e,a,r)}function d9(t,e,n,r){var u,d;const i=c_(e,(n==null?void 0:n.id)??"");if(!he(t)||!he(e)||!he(i)||!he(i.x)||!he(i.y)||!he(e.lookup)||r.x<0||r.x>=ts||r.y<0||r.y>=Il)return{name:"edge",kind:"edge",collision:Gi.ISSOLID,x:r.x,y:r.y};if(i.x-r.x===0&&i.y-r.y===0)return;const s=Tw(e,i),o=Tw(e,r),a=i.collision??((u=i==null?void 0:i.kinddata)==null?void 0:u.collision)??Gi.ISWALK,c=c_(e,e.lookup[o]??"");if(he(c))return{...c};const l=e.terrain[o];if(he(l)){const h=l.collision??((d=l==null?void 0:l.kinddata)==null?void 0:d.collision)??Gi.ISWALK;if(iW(a,h))return{...l,x:r.x,y:r.y}}i.x=r.x,i.y=r.y,he(i.removed)||(e.lookup[s]=void 0,e.lookup[o]=i.id??"")}function t2(t,e,n,r){var s;if(!he(t)||!he(e)||!he(e.named)||!he(n))return;const i=rr(n.name??((s=n.kinddata)==null?void 0:s.name)??"");e.named[i]||(e.named[i]=new Set),e.named[i].add((n==null?void 0:n.id)??r??"")}function Iye(t,e,n){if(!(!he(t)||!he(e)||!he(e.lookup)||!he(n==null?void 0:n.id))&&!he(n.removed)){const r=n.x??0,i=n.y??0;e.lookup[r+i*ts]=n.id}}function Bv(t,e){var a;if(!he(t)||!he(e)||he(e.lookup)&&he(e.named))return;const n=new Array(ts*Il).fill(void 0),r={},i=Object.values(e.objects);for(let c=0;c<i.length;++c){const l=i[c];if(he(l.x)&&he(l.y)&&he(l.id)&&!he(l.removed)){l.category=z0.ISOBJECT,n[l.x+l.y*ts]=l.id;const u=rr(l.name??((a=l.kinddata)==null?void 0:a.name)??"");r[u]||(r[u]=new Set),r[u].add(l.id)}}let s=0,o=0;for(let c=0;c<e.terrain.length;++c){const l=e.terrain[c];if(he(l)){l.x=s,l.y=o,l.category=z0.ISTERRAIN;const u=ST(l);r[u]||(r[u]=new Set),r[u].add(c)}++s,s>=ts&&(s=0,++o)}e.lookup=n,e.named=r}function EE(t,e,n,r){if(!he(n)||ST(n)==="player")return!1;const i=n.id??"",s=n.x??0,o=n.y??0;return i?(n.removed=r,h9(t,e,n)):ZA(e,{x:s,y:o}),!0}function h9(t,e,n){var r;if(he(t)&&he(e)&&he(n==null?void 0:n.id)){if(he(e.lookup)&&he(n.x)&&he(n.y)){const s=n.x+n.y*ts;e.lookup[s]===n.id&&(e.lookup[s]=void 0)}const i=ST(n);he((r=e.named)==null?void 0:r[i])&&he(n.id)&&e.named[i].delete(n.id)}}function Oye(t,e,n,r){if(he(t)&&he(e)&&he(n)){const[i,s]=n,o=$F(t,i);if(he(o)&&he(o.name)){const a=EW(e,r,i);return hR(a,s),a}}}function fR(t,e,n,r,i){if(he(t)&&he(e)&&he(n)){const[s,o]=n,a=l9(t,s);if(he(a)){const l=rye(e,r,s);if(he(l)){hR(l,o);const u=Sw(r,ts);return t2(t,e,l,u),l}}const c=$F(t,s);if(he(c)&&he(c.name)){const l=EW(e,r,s,i);if(he(l))return hR(l,o),Iye(t,e,l),t2(t,e,l),l}}}function IH(t,e,n){if(!XE(_e.element))return 0;const[r,i]=Mt(e,0,[lt.DIR,lt.MAYBE_KIND]),s=i??["bullet"],o=Oye(_e.book,_e.board,s,{x:_e.element.x,y:_e.element.y});if(he(o)){o.arg=n,o.collision=Gi.ISBULLET,o.destructible=1,o.stepx=r.x-_e.element.x,o.stepy=r.y-_e.element.y,o.bg=cr.ONCLEAR;const a=CT(_e.book,o),c=o.code??(a==null?void 0:a.code)??"";nxe(_e.book,_e.board,o,c,1)}return t.yield(),0}function fC(t,e,n,r){var c,l;if(!XE(_e.element)||!he(_e.book)||!he(_e.board)||!he(_e.element))return 0;Bv(_e.book,_e.board);const[i,s]=Mt(e,0,[lt.DIR,lt.KIND]),o=HL(_e.board,i);if((o==null?void 0:o.category)===z0.ISOBJECT&&(o!=null&&o.pushable)){const u={x:((c=_e.element)==null?void 0:c.x)??0,y:((l=_e.element)==null?void 0:l.y)??0},d=wa(i,Mv(u,i));d9(_e.book,_e.board,o,d)}if(!HF(_e.book,_e.board,Gi.ISWALK,i)){const u=fR(_e.book,_e.board,s,i,n);he(u)&&he(r)&&(u.arg=r)}return 0}const kye=vg().command("board",(t,e)=>{if(!he(_e.book))return 0;const[n,r,i]=Mt(e,0,[lt.NAME,lt.MAYBE_NUMBER,lt.MAYBE_NUMBER]),s=I0(_e.book,Ur.BOARD,n);if(s.length){const o=Hu(...s);he(o)&&zS(_e.book,_e.elementfocus,o.id,{x:r??Math.round(ts*.5),y:i??Math.round(Il*.5)})}return 0}).command("edge",(t,e)=>{var s,o;if(!he(_e.book)||!he(_e.board)||!he(_e.element))return 0;const[n,r]=Mt(e,0,[lt.DIR,lt.NAME]),i=I0(_e.book,Ur.BOARD,r);if(i.length){const a={x:((s=_e.element)==null?void 0:s.x)??0,y:((o=_e.element)==null?void 0:o.y)??0},c=Mv(a,n),l=Hu(...i);switch(c){case pn.NORTH:_e.board.exitnorth=l.id;break;case pn.SOUTH:_e.board.exitsouth=l.id;break;case pn.WEST:_e.board.exitwest=l.id;break;case pn.EAST:_e.board.exiteast=l.id;break}}return 0}).command("shove",(t,e)=>{if(!he(_e.book)||!he(_e.board))return 0;Bv(_e.book,_e.board);const[n,r]=Mt(e,0,[lt.DIR,lt.DIR]),i=HL(_e.board,n);return $L(i)&&C2(_e.book,_e.board,i,r),0}).command("duplicate",()=>(!he(_e.book)||!he(_e.board),0)).command("replace",(t,e)=>{if(!he(_e.book)||!he(_e.board))return 0;Bv(_e.book,_e.board);const[n,r]=Mt(e,0,[lt.DIR,lt.KIND]),i=HL(_e.board,n);return $L(i)&&EE(_e.book,_e.board,i,_e.timestamp),fR(_e.book,_e.board,r,n),0}).command("write",(t,e)=>{var l;if(!he(_e.book)||!he(_e.board))return 0;Bv(_e.book,_e.board);const[n,r,i]=Mt(e,0,[lt.DIR,lt.COLOR,lt.STRING]),{color:s,bg:o}=oK(r),a=((l=_M(i,256,1))==null?void 0:l.measuredwidth)??1,c=yy(256,1,s??cr.WHITE,o??cr.BLACK);qn(i,c,!1);for(let u=0;u<a;++u){const d=ZA(_e.board,{x:n.x+u,y:n.y,char:c.char[u],color:c.color[u],bg:c.bg[u]});if(he(d)){const h=(d.x??0)+(d.y??0)*ts;t2(_e.book,_e.board,d,h)}}return 0}).command("change",(t,e)=>{if(!he(_e.book)||!he(_e.board))return 0;Bv(_e.book,_e.board);const[n,r]=Mt(e,0,[lt.KIND,lt.KIND]);Bv(_e.book,_e.board);const i=uR(n)??"",s=bT(_e.board,i),o=sW(s,n),a=uR(r),c=nW(r),l=rW(r);return o.forEach(u=>{if(ST(u)===a)he(c)&&(u.color=c),he(l)&&(u.bg=l);else{if(he(u.id)&&EE(_e.book,_e.board,u,_e.timestamp))return 0;XE(u)&&fR(_e.book,_e.board,r,u)}}),0}).command("putwith",(t,e)=>{const[n,r]=Mt(e,0,[lt.ANY]);return fC(t,e.slice(r),n)}).command("put",(t,e)=>fC(t,e)).command("oneof",(t,e)=>{const[n,r]=Mt(e,0,[lt.ANY]);return he(_e.board)&&c_(_e.board,n)?0:fC(t,e.slice(r),n)}).command("oneofwith",(t,e)=>{const[n,r,i]=Mt(e,0,[lt.ANY,lt.ANY]);return he(_e.board)&&c_(_e.board,r)?0:fC(t,e.slice(i),r,n)}).command("shootwith",(t,e)=>{const[n,r]=Mt(e,0,[lt.ANY]);return IH(t,e.slice(r),n)}).command("shoot",IH);function Rw(){return Rw=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Rw.apply(this,arguments)}function Nye(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n2(t,e)}function n2(t,e){return n2=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},n2(t,e)}function Pye(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var VF=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(i,s){i.iterate&&s[Pa].connections.iterate.delete(r),i.byKey.forEach(function(o){s[Pa].connections.byKey.get(o).delete(r)})}),this.observing.clear()},t}(),D0=[],rM=function(t){Nye(e,t);function e(r,i,s){var o;if(o=t.call(this,function(){return o._trigger()})||this,o.func=r,o.options=i,o.effect=s,o.isInitial=!0,o.reaction=function(){D0.push(Pye(o));try{o.func()}finally{D0.pop()}o.effect&&(!o.isInitial||o.options.fireImmediately)&&o.effect(),o.isInitial=!1},!s&&!o.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return o.reaction(),o}var n=e.prototype;return n._trigger=function(){if(D0.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(VF);function f9(){return!!D0.length}function p9(){return D0.length?D0[D0.length-1]:void 0}function Dye(t,e,n){var r=Rw({name:"unnamed",fireImmediately:!0},n),i=new rM(t,r,e);return i}var g1=0;function m9(){return g1>0}function r2(t){g1++;try{return t()}finally{g1--,g1===0&&Uye()}}var i2=!1;function g9(){return i2}function v9(t){i2=!0;try{t()}finally{i2=!1}}function Lye(t){return function(){return v9(t)}}var s2=[];function Uye(){var t=[].concat(s2);s2=[],_9(t)}function _9(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[Pa].connections.iterate.forEach(function(i){e.add(i)}),(r=n.observable[Pa].connections.byKey.get(n.key))==null||r.forEach(function(i){e.add(i)})}),e.forEach(function(n){n.trigger()})}function pC(t){if(m9()){s2.push(t);return}_9([t])}function OH(t,e){if(t.type==="iterate")t.observable[Pa].connections.iterate.add(e);else{var n=t.observable[Pa].connections.byKey.get(t.key);n||(n=new Set,t.observable[Pa].connections.byKey.set(t.key,n)),n.add(e)}}function mC(t,e){if(!g9()){var n=p9();n&&(OH(t,n),n.registerConnection(t)),e&&(OH(t,e),e.registerConnection(t))}}var zF=Symbol("$skipreactive"),Pa=Symbol("$reactive"),Pd=Symbol("$reactiveproxy");function RT(t,e){return!!(t&&t[Pd]&&t[Pd].implicitObserver===e)}function GF(t){return t[zF]=!0,t}function y9(t){return!!(t&&!RT(t)&&t[Pa])}function o2(t,e,n){if(n===void 0&&(n=!1),t[zF]||RT(t,e))return t;var r=Fye(t,n);if(!e)return r;var i=r[Pa].proxiesWithImplicitObserver.get(e);if(!i){var s={implicitObserver:e};Object.setPrototypeOf(s,b9),i=new Proxy(r[Pa].raw,s),r[Pa].proxiesWithImplicitObserver.set(e,i)}return i}var SE=o2;function Fye(t,e){if(e===void 0&&(e=!1),RT(t))return t;if(y9(t))return t[Pa].proxy;if(t[Pa]||t[Pd])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,Pa,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,b9);return n.proxy=r,r}var b9={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||mC({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===Pd)return{implicitObserver:this.implicitObserver};var i=Reflect.get(e,n,r);if(typeof n=="symbol")return n.toString()==="Symbol($reactiveproxy)"&&console.error("warning, Symbol($reactiveproxy) passed, but does not match $reactiveproxy. Multiple Reactive libraries loaded?"),i;if(n==="length"&&Array.isArray(e)?mC({observable:e,type:"iterate"},this.implicitObserver):mC({observable:e,key:n,type:"get"},this.implicitObserver),y9(i))return o2(i,this.implicitObserver);if(e[Pa].shallow)return i;if(typeof i=="object"&&i!==null&&!RT(i,this.implicitObserver)&&!Object.isFrozen(i)){var s=Reflect.getOwnPropertyDescriptor(e,n);if((!s||!(s.writable===!1&&s.configurable===!1))&&(f9()||this.implicitObserver))return o2(i,this.implicitObserver)}return i},ownKeys:function(e){return mC({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,i){return r2(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,i);var s=Object.hasOwnProperty.call(e,n),o=Reflect.get(e,n,i),a=Reflect.set(e,n,r,i);if(!s)pC({observable:e,key:n,value:r,type:"add"});else if(r!==o)if(n==="length"&&Array.isArray(e)){if(!(o<r))for(var c=r+1;c<=o;c++)pC({observable:e,key:""+(c-1),oldValue:void 0,type:"delete"})}else pC({observable:e,key:n,value:r,oldValue:o,type:"update"});return a})},deleteProperty:function(e,n){return r2(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),i=Reflect.get(e,n),s=Reflect.deleteProperty(e,n);return r&&pC({observable:e,key:n,oldValue:i,type:"delete"}),s})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function Bye(t,e){var n=Rw({name:"unnamed",fireImmediately:!0},e),r=new rM(t,n);return r}function jye(t,e,n){var r=Rw({name:"unnamed",fireImmediately:!0},n),i=new rM(function(){t(e)},r);return e=SE(e,i),r.fireImmediately&&i.trigger(),i}var E9=function(){function t(){this._observable=SE({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return SE(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function $ye(t,e,n){return new E9}const Hye=Object.freeze(Object.defineProperty({__proto__:null,$reactive:Pa,$reactiveproxy:Pd,$skipreactive:zF,Atom:E9,Observer:VF,Reaction:rM,autorun:Bye,autorunAsync:jye,createAtom:$ye,hasRunningReaction:f9,isActionRunning:m9,isReactive:RT,isTrackingDisabled:g9,markRaw:GF,reaction:Dye,reactive:SE,runInAction:r2,runningReaction:p9,untracked:v9,untrackedCB:Lye},Symbol.toStringTag,{value:"Module"})),Uh=()=>new Map,a2=t=>{const e=Uh();return t.forEach((n,r)=>{e.set(r,n)}),e},C_=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Vye=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},zye=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},wE=()=>new Set,QN=t=>t[t.length-1],Gye=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},l_=Array.from,qye=Array.isArray;class Wye{constructor(){this._observers=Uh()}on(e,n){return C_(this._observers,e,wE).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return l_((this._observers.get(e)||Uh()).values()).forEach(r=>r(...n))}destroy(){this._observers=Uh()}}const u_=Math.floor,v1=Math.abs,S9=(t,e)=>t<e?t:e,gy=(t,e)=>t>e?t:e,w9=t=>t!==0?t<0:1/t<0,kH=1,NH=2,ZN=4,eP=8,Aw=32,Qm=64,Gu=128,iM=31,c2=63,L0=127,Kye=2147483647,T9=Number.MAX_SAFE_INTEGER,Yye=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&u_(t)===t),Xye=t=>t.toLowerCase(),Jye=/^\s*/g,Qye=t=>t.replace(Jye,""),Zye=/([A-Z])/g,PH=(t,e)=>Qye(t.replace(Zye,n=>`${e}${Xye(n)}`)),ebe=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},Mw=typeof TextEncoder<"u"?new TextEncoder:null,tbe=t=>Mw.encode(t),nbe=Mw?tbe:ebe;let nw=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});nw&&nw.decode(new Uint8Array).length===1&&(nw=null);class AT{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Kv=()=>new AT,rbe=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Nh=t=>{const e=new Uint8Array(rbe(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},ibe=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(gy(n,e)*2),t.cpos=0)},Xa=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},l2=Xa,Jr=(t,e)=>{for(;e>L0;)Xa(t,Gu|L0&e),e=u_(e/128);Xa(t,L0&e)},qF=(t,e)=>{const n=w9(e);for(n&&(e=-e),Xa(t,(e>c2?Gu:0)|(n?Qm:0)|c2&e),e=u_(e/64);e>0;)Xa(t,(e>L0?Gu:0)|L0&e),e=u_(e/128)},u2=new Uint8Array(3e4),sbe=u2.length/3,obe=(t,e)=>{if(e.length<sbe){const n=Mw.encodeInto(e,u2).written||0;Jr(t,n);for(let r=0;r<n;r++)Xa(t,u2[r])}else jc(t,nbe(e))},abe=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;Jr(t,r);for(let i=0;i<r;i++)Xa(t,n.codePointAt(i))},Kb=Mw&&Mw.encodeInto?obe:abe,sM=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=S9(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(gy(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},jc=(t,e)=>{Jr(t,e.byteLength),sM(t,e)},WF=(t,e)=>{ibe(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},cbe=(t,e)=>WF(t,4).setFloat32(0,e,!1),lbe=(t,e)=>WF(t,8).setFloat64(0,e,!1),ube=(t,e)=>WF(t,8).setBigInt64(0,e,!1),DH=new DataView(new ArrayBuffer(4)),dbe=t=>(DH.setFloat32(0,t),DH.getFloat32(0)===t),Iw=(t,e)=>{switch(typeof e){case"string":Xa(t,119),Kb(t,e);break;case"number":Yye(e)&&v1(e)<=Kye?(Xa(t,125),qF(t,e)):dbe(e)?(Xa(t,124),cbe(t,e)):(Xa(t,123),lbe(t,e));break;case"bigint":Xa(t,122),ube(t,e);break;case"object":if(e===null)Xa(t,126);else if(qye(e)){Xa(t,117),Jr(t,e.length);for(let n=0;n<e.length;n++)Iw(t,e[n])}else if(e instanceof Uint8Array)Xa(t,116),jc(t,e);else{Xa(t,118);const n=Object.keys(e);Jr(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Kb(t,i),Iw(t,e[i])}}break;case"boolean":Xa(t,e?120:121);break;default:Xa(t,127)}};class LH extends AT{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Jr(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const UH=t=>{t.count>0&&(qF(t.encoder,t.count===1?t.s:-t.s),t.count>1&&Jr(t.encoder,t.count-2))};class _1{constructor(){this.encoder=new AT,this.s=0,this.count=0}write(e){this.s===e?this.count++:(UH(this),this.count=1,this.s=e)}toUint8Array(){return UH(this),Nh(this.encoder)}}const FH=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);qF(t.encoder,e),t.count>1&&Jr(t.encoder,t.count-2)}};class tP{constructor(){this.encoder=new AT,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(FH(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return FH(this),Nh(this.encoder)}}class hbe{constructor(){this.sarr=[],this.s="",this.lensE=new _1}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new AT;return this.sarr.push(this.s),this.s="",Kb(e,this.sarr.join("")),sM(e,this.lensE.toUint8Array()),Nh(e)}}const d_=t=>new Error(t),lp=()=>{throw d_("Method unimplemented")},pp=()=>{throw d_("Unexpected case")},x9=d_("Unexpected end of array"),C9=d_("Integer out of Range");class oM{constructor(e){this.arr=e,this.pos=0}}const vy=t=>new oM(t),fbe=t=>t.pos!==t.arr.length,pbe=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},bl=t=>pbe(t,Qr(t)),TE=t=>t.arr[t.pos++],Qr=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&L0)*n,n*=128,i<Gu)return e;if(e>T9)throw C9}throw x9},KF=t=>{let e=t.arr[t.pos++],n=e&c2,r=64;const i=(e&Qm)>0?-1:1;if(!(e&Gu))return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&L0)*r,r*=128,e<Gu)return i*n;if(n>T9)throw C9}throw x9},mbe=t=>{let e=Qr(t);if(e===0)return"";{let n=String.fromCodePoint(TE(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(TE(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},gbe=t=>nw.decode(bl(t)),Yb=nw?gbe:mbe,YF=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},vbe=t=>YF(t,4).getFloat32(0,!1),_be=t=>YF(t,8).getFloat64(0,!1),ybe=t=>YF(t,8).getBigInt64(0,!1),bbe=[t=>{},t=>null,KF,vbe,_be,ybe,t=>!1,t=>!0,Yb,t=>{const e=Qr(t),n={};for(let r=0;r<e;r++){const i=Yb(t);n[i]=Ow(t)}return n},t=>{const e=Qr(t),n=[];for(let r=0;r<e;r++)n.push(Ow(t));return n},bl],Ow=t=>bbe[127-TE(t)](t);class BH extends oM{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),fbe(this)?this.count=Qr(this)+1:this.count=-1),this.count--,this.s}}class y1 extends oM{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=KF(this);const e=w9(this.s);this.count=1,e&&(this.s=-this.s,this.count=Qr(this)+2)}return this.count--,this.s}}class nP extends oM{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=KF(this),n=e&1;this.diff=u_(e/2),this.count=1,n&&(this.count=Qr(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Ebe{constructor(e){this.decoder=new y1(e),this.str=Yb(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const Sbe=crypto.getRandomValues.bind(crypto),R9=()=>Sbe(new Uint32Array(1))[0],wbe="10000000-1000-4000-8000"+-1e11,Tbe=()=>wbe.replace(/[018]/g,t=>(t^R9()&15>>t/4).toString(16)),jH=t=>new Promise(t);Promise.all.bind(Promise);const $H=t=>t===void 0?null:t;class xbe{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let A9=new xbe,Cbe=!0;try{typeof localStorage<"u"&&localStorage&&(A9=localStorage,Cbe=!1)}catch{}const Rbe=A9,Abe=Object.assign,Mbe=Object.keys,Ibe=(t,e)=>{for(const n in t)e(t[n],n)},HH=t=>Mbe(t).length,Obe=t=>{for(const e in t)return!1;return!0},kbe=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Nbe=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Pbe=(t,e)=>t===e||HH(t)===HH(e)&&kbe(t,(n,r)=>(n!==void 0||Nbe(e,r))&&e[r]===n),Dbe=Object.freeze,M9=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&M9(t[e])}return Dbe(t)},XF=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&XF(t,e,n+1)}},Lbe=t=>t,Ube=(t,e)=>e.includes(t);var I9={};const kw=typeof Hn<"u"&&Hn.release&&/node|io\.js/.test(Hn.release.name)&&Object.prototype.toString.call(typeof Hn<"u"?Hn:0)==="[object process]";let Ff;const Fbe=()=>{if(Ff===void 0)if(kw){Ff=Uh();const t=Hn.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Ff.set(e,""),e=r):e!==null&&(Ff.set(e,r),e=null)}e!==null&&Ff.set(e,"")}else typeof location=="object"?(Ff=Uh(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Ff.set(`--${PH(e,"-")}`,n),Ff.set(`-${PH(e,"-")}`,n)}})):Ff=Uh();return Ff},d2=t=>Fbe().has(t),pR=t=>$H(kw?I9[t.toUpperCase().replaceAll("-","_")]:Rbe.getItem(t)),O9=t=>d2("--"+t)||pR(t)!==null;O9("production");const Bbe=kw&&Ube(I9.FORCE_COLOR,["true","1","2"]),jbe=Bbe||!d2("--no-colors")&&!O9("no-color")&&(!kw||Hn.stdout.isTTY)&&(!kw||d2("--color")||pR("COLORTERM")!==null||(pR("TERM")||"").includes("color")),$be=t=>new Uint8Array(t),Hbe=t=>{const e=$be(t.byteLength);return e.set(t),e};class Vbe{constructor(e,n){this.left=e,this.right=n}}const Im=(t,e)=>new Vbe(t,e);typeof DOMParser<"u"&&new DOMParser;const zbe=t=>Vye(t,(e,n)=>`${n}:${e};`).join(""),_g=Symbol,k9=_g(),N9=_g(),Gbe=_g(),qbe=_g(),Wbe=_g(),P9=_g(),Kbe=_g(),JF=_g(),Ybe=_g(),Xbe=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},Jbe={[k9]:Im("font-weight","bold"),[N9]:Im("font-weight","normal"),[Gbe]:Im("color","blue"),[Wbe]:Im("color","green"),[qbe]:Im("color","grey"),[P9]:Im("color","red"),[Kbe]:Im("color","purple"),[JF]:Im("color","orange"),[Ybe]:Im("color","black")},Qbe=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Uh();let i=[],s=0;for(;s<t.length;s++){const a=t[s],c=Jbe[a];if(c!==void 0)r.set(c.left,c.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const l=zbe(r);s>0||l.length>0?(e.push("%c"+a),n.push(l)):e.push(a)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const a=t[s];a instanceof Symbol||i.push(a)}return i},D9=jbe?Qbe:Xbe,Zbe=(...t)=>{console.log(...D9(t)),L9.forEach(e=>e.print(t))},eEe=(...t)=>{console.warn(...D9(t)),t.unshift(JF),L9.forEach(e=>e.print(t))},L9=wE(),U9=t=>({[Symbol.iterator](){return this},next:t}),tEe=(t,e)=>U9(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),rP=(t,e)=>U9(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class QF{constructor(e,n){this.clock=e,this.len=n}}class MT{constructor(){this.clients=new Map}}const F9=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);for(let o=0;o<r.length;o++){const a=r[o];J9(t,s,a.clock,a.len,n)}}),nEe=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=u_((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},B9=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&nEe(n,e.clock)!==null},ZF=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=gy(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},rEe=t=>{const e=new MT;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=n+1;o<t.length;o++)Gye(s,t[o].clients.get(i)||[]);e.clients.set(i,s)}});return ZF(e),e},mR=(t,e,n,r)=>{C_(t.clients,e,()=>[]).push(new QF(n,r))},iEe=()=>new MT,sEe=t=>{const e=iEe();return t.clients.forEach((n,r)=>{const i=[];for(let s=0;s<n.length;s++){const o=n[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<n.length)for(let l=n[s+1];s+1<n.length&&l.deleted;l=n[++s+1])c+=l.length;i.push(new QF(a,c))}}i.length>0&&e.clients.set(r,i)}),e},JE=(t,e)=>{Jr(t.restEncoder,e.clients.size),l_(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),Jr(t.restEncoder,n);const i=r.length;Jr(t.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},eB=t=>{const e=new MT,n=Qr(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Qr(t.restDecoder),s=Qr(t.restDecoder);if(s>0){const o=C_(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new QF(t.readDsClock(),t.readDsLen()))}}return e},VH=(t,e,n)=>{const r=new MT,i=Qr(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const o=Qr(t.restDecoder),a=Qr(t.restDecoder),c=n.clients.get(o)||[],l=nc(n,o);for(let u=0;u<a;u++){const d=t.readDsClock(),h=d+t.readDsLen();if(d<l){l<h&&mR(r,o,l,h-l);let f=$h(c,d),p=c[f];for(!p.deleted&&p.id.clock<d&&(c.splice(f+1,0,bR(e,p,d-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<h);)p.deleted||(h<p.id.clock+p.length&&c.splice(f,0,bR(e,p,h-p.id.clock)),p.delete(e))}else mR(r,o,d,h-d)}}if(r.clients.size>0){const s=new Y0;return Jr(s.restEncoder,0),JE(s,r),s.toUint8Array()}return null},j9=R9;class yg extends Wye{constructor({guid:e=Tbe(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=j9(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new Y9,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=jH(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>jH(l=>{const u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ts(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(l_(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Ts(this,e,n)}get(e,n=xo){const r=C_(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==xo&&i!==n)if(i===xo){const s=new n;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,up)}getText(e=""){return this.get(e,Hh)}getMap(e=""){return this.get(e,mp)}getXmlElement(e=""){return this.get(e,ag)}getXmlFragment(e=""){return this.get(e,gp)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,l_(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new yg({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Ts(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class $9{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Qr(this.restDecoder)}readDsLen(){return Qr(this.restDecoder)}}class H9 extends $9{readLeftID(){return Ei(Qr(this.restDecoder),Qr(this.restDecoder))}readRightID(){return Ei(Qr(this.restDecoder),Qr(this.restDecoder))}readClient(){return Qr(this.restDecoder)}readInfo(){return TE(this.restDecoder)}readString(){return Yb(this.restDecoder)}readParentInfo(){return Qr(this.restDecoder)===1}readTypeRef(){return Qr(this.restDecoder)}readLen(){return Qr(this.restDecoder)}readAny(){return Ow(this.restDecoder)}readBuf(){return Hbe(bl(this.restDecoder))}readJSON(){return JSON.parse(Yb(this.restDecoder))}readKey(){return Yb(this.restDecoder)}}class oEe{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Qr(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Qr(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class xE extends oEe{constructor(e){super(e),this.keys=[],Qr(e),this.keyClockDecoder=new nP(bl(e)),this.clientDecoder=new y1(bl(e)),this.leftClockDecoder=new nP(bl(e)),this.rightClockDecoder=new nP(bl(e)),this.infoDecoder=new BH(bl(e),TE),this.stringDecoder=new Ebe(bl(e)),this.parentInfoDecoder=new BH(bl(e),TE),this.typeRefDecoder=new y1(bl(e)),this.lenDecoder=new y1(bl(e))}readLeftID(){return new Xb(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Xb(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ow(this.restDecoder)}readBuf(){return bl(this.restDecoder)}readJSON(){return Ow(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class V9{constructor(){this.restEncoder=Kv()}toUint8Array(){return Nh(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Jr(this.restEncoder,e)}writeDsLen(e){Jr(this.restEncoder,e)}}class IT extends V9{writeLeftID(e){Jr(this.restEncoder,e.client),Jr(this.restEncoder,e.clock)}writeRightID(e){Jr(this.restEncoder,e.client),Jr(this.restEncoder,e.clock)}writeClient(e){Jr(this.restEncoder,e)}writeInfo(e){l2(this.restEncoder,e)}writeString(e){Kb(this.restEncoder,e)}writeParentInfo(e){Jr(this.restEncoder,e?1:0)}writeTypeRef(e){Jr(this.restEncoder,e)}writeLen(e){Jr(this.restEncoder,e)}writeAny(e){Iw(this.restEncoder,e)}writeBuf(e){jc(this.restEncoder,e)}writeJSON(e){Kb(this.restEncoder,JSON.stringify(e))}writeKey(e){Kb(this.restEncoder,e)}}class z9{constructor(){this.restEncoder=Kv(),this.dsCurrVal=0}toUint8Array(){return Nh(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,Jr(this.restEncoder,n)}writeDsLen(e){e===0&&pp(),Jr(this.restEncoder,e-1),this.dsCurrVal+=e}}class Y0 extends z9{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new tP,this.clientEncoder=new _1,this.leftClockEncoder=new tP,this.rightClockEncoder=new tP,this.infoEncoder=new LH(l2),this.stringEncoder=new hbe,this.parentInfoEncoder=new LH(l2),this.typeRefEncoder=new _1,this.lenEncoder=new _1}toUint8Array(){const e=Kv();return Jr(e,0),jc(e,this.keyClockEncoder.toUint8Array()),jc(e,this.clientEncoder.toUint8Array()),jc(e,this.leftClockEncoder.toUint8Array()),jc(e,this.rightClockEncoder.toUint8Array()),jc(e,Nh(this.infoEncoder)),jc(e,this.stringEncoder.toUint8Array()),jc(e,Nh(this.parentInfoEncoder)),jc(e,this.typeRefEncoder.toUint8Array()),jc(e,this.lenEncoder.toUint8Array()),sM(e,Nh(this.restEncoder)),Nh(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Iw(this.restEncoder,e)}writeBuf(e){jc(this.restEncoder,e)}writeJSON(e){Iw(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const aEe=(t,e,n,r)=>{r=gy(r,e[0].id.clock);const i=$h(e,r);Jr(t.restEncoder,e.length-i),t.writeClient(n),Jr(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},tB=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{nc(e,s)>i&&r.set(s,i)}),aM(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),Jr(t.restEncoder,r.size),l_(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{aEe(t,e.clients.get(i),i,s)})},cEe=(t,e)=>{const n=Uh(),r=Qr(t.restDecoder);for(let i=0;i<r;i++){const s=Qr(t.restDecoder),o=new Array(s),a=t.readClient();let c=Qr(t.restDecoder);n.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=t.readInfo();switch(iM&u){case 0:{const d=t.readLen();o[l]=new Vu(Ei(a,c),d),c+=d;break}case 10:{const d=Qr(t.restDecoder);o[l]=new xd(Ei(a,c),d),c+=d;break}default:{const d=(u&(Qm|Gu))===0,h=new ka(Ei(a,c),null,(u&Gu)===Gu?t.readLeftID():null,null,(u&Qm)===Qm?t.readRightID():null,d?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,d&&(u&Aw)===Aw?t.readString():null,g7(t,u));o[l]=h,c+=h.length}}}}return n},lEe=(t,e,n)=>{const r=[];let i=l_(n.keys()).sort((f,p)=>f-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let f=n.get(i[i.length-1]);for(;f.refs.length===f.i;)if(i.pop(),i.length>0)f=n.get(i[i.length-1]);else return null;return f};let o=s();if(o===null)return null;const a=new Y9,c=new Map,l=(f,p)=>{const g=c.get(f);(g==null||g>p)&&c.set(f,p)};let u=o.refs[o.i++];const d=new Map,h=()=>{for(const f of r){const p=f.id.client,g=n.get(p);g?(g.i--,a.clients.set(p,g.refs.slice(g.i)),n.delete(p),g.i=0,g.refs=[]):a.clients.set(p,[f]),i=i.filter(v=>v!==p)}r.length=0};for(;;){if(u.constructor!==xd){const p=C_(d,u.id.client,()=>nc(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),h();else{const g=u.getMissing(t,e);if(g!==null){r.push(u);const v=n.get(g)||{refs:[],i:0};if(v.refs.length===v.i)l(g,nc(e,g)),h();else{u=v.refs[v.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new Y0;return tB(f,a,new Map),Jr(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},uEe=(t,e)=>tB(t,e.doc.store,e.beforeState),dEe=(t,e,n,r=new xE(t))=>Ts(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=cEe(r,o),l=lEe(i,a,c),u=a.pendingStructs;if(u){for(const[h,f]of u.missing)if(f<nc(a,h)){s=!0;break}if(l){for(const[h,f]of l.missing){const p=u.missing.get(h);(p==null||p>f)&&u.missing.set(h,f)}u.update=gR([u.update,l.update])}}else a.pendingStructs=l;const d=VH(r,i,a);if(a.pendingDs){const h=new xE(vy(a.pendingDs));Qr(h.restDecoder);const f=VH(h,i,a);d&&f?a.pendingDs=gR([d,f]):a.pendingDs=d||f}else a.pendingDs=d;if(s){const h=a.pendingStructs.update;a.pendingStructs=null,G9(i.doc,h)}},n,!1),G9=(t,e,n,r=xE)=>{const i=vy(e);dEe(i,t,n,new r(i))},hEe=(t,e,n)=>G9(t,e,n,H9),fEe=(t,e,n=new Map)=>{tB(t,e.store,n),JE(t,sEe(e.store))},pEe=(t,e=new Uint8Array([0]),n=new Y0)=>{const r=q9(e);fEe(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(IEe(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===IT)return AEe(i.map((s,o)=>o===0?s:kEe(s)));if(n.constructor===Y0)return gR(i)}return i[0]},mEe=(t,e)=>pEe(t,e,new IT),gEe=t=>{const e=new Map,n=Qr(t.restDecoder);for(let r=0;r<n;r++){const i=Qr(t.restDecoder),s=Qr(t.restDecoder);e.set(i,s)}return e},q9=t=>gEe(new $9(vy(t))),W9=(t,e)=>(Jr(t.restEncoder,e.size),l_(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{Jr(t.restEncoder,n),Jr(t.restEncoder,r)}),t),vEe=(t,e)=>W9(t,aM(e.store)),_Ee=(t,e=new z9)=>(t instanceof Map?W9(e,t):vEe(e,t),e.toUint8Array()),yEe=t=>_Ee(t,new V9);class bEe{constructor(){this.l=[]}}const zH=()=>new bEe,GH=(t,e)=>t.l.push(e),qH=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},K9=(t,e,n)=>XF(t.l,[e,n]);class Xb{constructor(e,n){this.client=e,this.clock=n}}const gC=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ei=(t,e)=>new Xb(t,e),EEe=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw pp()},wb=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!B9(e.ds,t.id),h2=(t,e)=>{const n=C_(t.meta,h2,wE),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<nc(r,s)&&h_(t,Ei(s,i))}),F9(t,e.ds,i=>{}),n.add(e))};class Y9{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const aM=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},nc=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},X9=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw pp()}n.push(e)},$h=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=u_(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=u_((n+r)/2)}throw pp()},SEe=(t,e)=>{const n=t.clients.get(e.client);return n[$h(n,e.clock)]},iP=SEe,f2=(t,e,n)=>{const r=$h(e,n),i=e[r];return i.id.clock<n&&i instanceof ka?(e.splice(r+1,0,bR(t,i,n-i.id.clock)),r+1):r},h_=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[f2(t,n,e.clock)]},WH=(t,e,n)=>{const r=e.clients.get(n.client),i=$h(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Vu&&r.splice(i+1,0,bR(t,s,n.clock-s.id.clock+1)),s},wEe=(t,e,n)=>{const r=t.clients.get(e.id.client);r[$h(r,e.id.clock)]=n},J9=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let o=f2(t,e,n),a;do a=e[o++],s<a.id.clock+a.length&&f2(t,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class TEe{constructor(e,n,r){this.doc=e,this.deleteSet=new MT,this.beforeState=aM(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const KH=(t,e)=>e.deleteSet.clients.size===0&&!zye(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(ZF(e.deleteSet),uEe(t,e),JE(t,e.deleteSet),!0),YH=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&C_(t.changed,e,wE).add(n)},b1=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ka&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},xEe=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=$h(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const d=s[l];if(a.clock+a.len<=d.id.clock)break;d instanceof ka&&d.deleted&&!d.keep&&n(d)&&d.gc(e,!1)}}}},CEe=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const o=n[s],a=S9(i.length-1,1+$h(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+b1(i,c)}})},Q9=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{ZF(s),n.afterState=aM(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,d)=>u.path.length-d.path.length),K9(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),XF(a,[]),n._needFormattingCleanup&&qEe(n)}finally{r.gc&&xEe(s,i,r.gcFilter),CEe(s,i),n.afterState.forEach((u,d)=>{const h=n.beforeState.get(d)||0;if(h!==u){const f=i.clients.get(d),p=gy($h(f,h),1);for(let g=f.length-1;g>=p;)g-=1+b1(f,g)}});for(let u=o.length-1;u>=0;u--){const{client:d,clock:h}=o[u].id,f=i.clients.get(d),p=$h(f,h);p+1<f.length&&b1(f,p+1)>1||p>0&&b1(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Zbe(JF,k9,"[yjs] ",N9,P9,"Changed the client-id because another client seems to be using it."),r.clientID=j9()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new IT;KH(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new Y0;KH(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Q9(t,e+1)}}},Ts=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;t._transaction===null&&(s=!0,t._transaction=new TEe(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const a=t._transaction===i[0];t._transaction=null,a&&Q9(i,0)}}return o};function*REe(t){const e=Qr(t.restDecoder);for(let n=0;n<e;n++){const r=Qr(t.restDecoder),i=t.readClient();let s=Qr(t.restDecoder);for(let o=0;o<r;o++){const a=t.readInfo();if(a===10){const c=Qr(t.restDecoder);yield new xd(Ei(i,s),c),s+=c}else if(iM&a){const c=(a&(Qm|Gu))===0,l=new ka(Ei(i,s),null,(a&Gu)===Gu?t.readLeftID():null,null,(a&Qm)===Qm?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&Aw)===Aw?t.readString():null,g7(t,a));yield l,s+=l.length}else{const c=t.readLen();yield new Vu(Ei(i,s),c),s+=c}}}}class nB{constructor(e,n){this.gen=REe(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===xd);return this.curr}}class rB{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const AEe=t=>gR(t,H9,IT),MEe=(t,e)=>{if(t.constructor===Vu){const{client:n,clock:r}=t.id;return new Vu(Ei(n,r+e),t.length-e)}else if(t.constructor===xd){const{client:n,clock:r}=t.id;return new xd(Ei(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new ka(Ei(r,i+e),null,Ei(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},gR=(t,e=xE,n=Y0)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(vy(u)));let i=r.map(u=>new nB(u,!0)),s=null;const o=new n,a=new rB(o);for(;i=i.filter(h=>h.curr!==null),i.sort((h,f)=>{if(h.curr.id.client===f.curr.id.client){const p=h.curr.id.clock-f.curr.id.clock;return p===0?h.curr.constructor===f.curr.constructor?0:h.curr.constructor===xd?1:-1:p}else return f.curr.id.client-h.curr.id.client}),i.length!==0;){const u=i[0],d=u.curr.id.client;if(s!==null){let h=u.curr,f=!1;for(;h!==null&&h.id.clock+h.length<=s.struct.id.clock+s.struct.length&&h.id.client>=s.struct.id.client;)h=u.next(),f=!0;if(h===null||h.id.client!==d||f&&h.id.clock>s.struct.id.clock+s.struct.length)continue;if(d!==s.struct.id.client)jv(a,s.struct,s.offset),s={struct:h,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<h.id.clock)if(s.struct.constructor===xd)s.struct.length=h.id.clock+h.length-s.struct.id.clock;else{jv(a,s.struct,s.offset);const p=h.id.clock-s.struct.id.clock-s.struct.length;s={struct:new xd(Ei(d,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-h.id.clock;p>0&&(s.struct.constructor===xd?s.struct.length-=p:h=MEe(h,p)),s.struct.mergeWith(h)||(jv(a,s.struct,s.offset),s={struct:h,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let h=u.curr;h!==null&&h.id.client===d&&h.id.clock===s.struct.id.clock+s.struct.length&&h.constructor!==xd;h=u.next())jv(a,s.struct,s.offset),s={struct:h,offset:0}}s!==null&&(jv(a,s.struct,s.offset),s=null),iB(a);const c=r.map(u=>eB(u)),l=rEe(c);return JE(o,l),o.toUint8Array()},IEe=(t,e,n=xE,r=Y0)=>{const i=q9(e),s=new r,o=new rB(s),a=new n(vy(t)),c=new nB(a,!1);for(;c.curr;){const u=c.curr,d=u.id.client,h=i.get(d)||0;if(c.curr.constructor===xd){c.next();continue}if(u.id.clock+u.length>h)for(jv(o,u,gy(h-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===d;)jv(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===d&&c.curr.id.clock+c.curr.length<=h;)c.next()}iB(o);const l=eB(a);return JE(s,l),s.toUint8Array()},Z9=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Nh(t.encoder.restEncoder)}),t.encoder.restEncoder=Kv(),t.written=0)},jv=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Z9(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),Jr(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},iB=t=>{Z9(t);const e=t.encoder.restEncoder;Jr(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];Jr(e,r.written),sM(e,r.restEncoder)}},OEe=(t,e,n,r)=>{const i=new n(vy(t)),s=new nB(i,!1),o=new r,a=new rB(o);for(let l=s.curr;l!==null;l=s.next())jv(a,e(l),0);iB(a);const c=eB(i);return JE(o,c),o.toUint8Array()},kEe=t=>OEe(t,Lbe,xE,IT),XH="You must not compute changes after the event-handler fired.";class cM{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=NEe(this.currentTarget,this.target))}deletes(e){return B9(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw d_(XH);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=QN(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=QN(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=QN(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw d_(XH);const n=this.target,r=wE(),i=wE(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const NEe=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},Vc=()=>{eEe("Invalid access: Add Yjs type to a document before reading data.")},e7=80;let sB=0;class PEe{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=sB++}}const DEe=t=>{t.timestamp=sB++},t7=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=sB++},LEe=(t,e,n)=>{if(t.length>=e7){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return t7(r,e,n),r}else{const r=new PEe(e,n);return t.push(r),r}},lM=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,o)=>v1(e-s.index)<v1(e-o.index)?s:o);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,DEe(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&v1(n.index-i)<r.parent.length/e7?(t7(n,r,i),n):LEe(t._searchMarker,r,i)},Nw=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=gy(e,i.index+n))}},uM=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;C_(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;K9(r._eH,n,e)};class xo{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=zH(),this._dEH=zH(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw lp()}clone(){throw lp()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){GH(this._eH,e)}observeDeep(e){GH(this._dEH,e)}unobserve(e){qH(this._eH,e)}unobserveDeep(e){qH(this._dEH,e)}toJSON(){}}const n7=(t,e,n)=>{t.doc??Vc(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},r7=t=>{t.doc??Vc();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},Pw=(t,e)=>{let n=0,r=t._start;for(t.doc??Vc();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},i7=(t,e)=>{const n=[];return Pw(t,(r,i)=>{n.push(e(r,i,t))}),n},UEe=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},s7=(t,e)=>{t.doc??Vc();const n=lM(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},vR=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new ka(Ei(o,nc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new J0(l)),i.integrate(t,0),l=[])};r.forEach(d=>{if(d===null)l.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:i=new ka(Ei(o,nc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new OT(new Uint8Array(d))),i.integrate(t,0);break;case yg:i=new ka(Ei(o,nc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new kT(d)),i.integrate(t,0);break;default:if(d instanceof xo)i=new ka(Ei(o,nc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new bg(d)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},o7=()=>d_("Length exceeded!"),a7=(t,e,n,r)=>{if(n>e._length)throw o7();if(n===0)return e._searchMarker&&Nw(e._searchMarker,n,r.length),vR(t,e,null,r);const i=n,s=lM(e,n);let o=e._start;for(s!==null&&(o=s.p,n-=s.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&h_(t,Ei(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&Nw(e._searchMarker,i,r.length),vR(t,e,o,r)},FEe=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return vR(t,e,i,n)},c7=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,o=lM(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&h_(t,Ei(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&h_(t,Ei(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw o7();e._searchMarker&&Nw(e._searchMarker,i,-s+r)},_R=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},oB=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(r==null)a=new J0([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new J0([r]);break;case Uint8Array:a=new OT(r);break;case yg:a=new kT(r);break;default:if(r instanceof xo)a=new bg(r);else throw new Error("Unexpected content type")}new ka(Ei(o,nc(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},aB=(t,e)=>{t.doc??Vc();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},l7=t=>{const e={};return t.doc??Vc(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},u7=(t,e)=>{t.doc??Vc();const n=t._map.get(e);return n!==void 0&&!n.deleted},BEe=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&wb(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},vC=t=>(t.doc??Vc(),tEe(t._map.entries(),e=>!e[1].deleted));class jEe extends cM{}class up extends xo{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new up;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new up}clone(){const e=new up;return e.insert(0,this.toArray().map(n=>n instanceof xo?n.clone():n)),e}get length(){return this.doc??Vc(),this._length}_callObserver(e,n){super._callObserver(e,n),uM(this,e,new jEe(this,e))}insert(e,n){this.doc!==null?Ts(this.doc,r=>{a7(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Ts(this.doc,n=>{FEe(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Ts(this.doc,r=>{c7(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return s7(this,e)}toArray(){return r7(this)}slice(e=0,n=this.length){return n7(this,e,n)}toJSON(){return this.map(e=>e instanceof xo?e.toJSON():e)}map(e){return i7(this,e)}forEach(e){Pw(this,e)}[Symbol.iterator](){return UEe(this)}_write(e){e.writeTypeRef(dSe)}}const $Ee=t=>new up;class HEe extends cM{constructor(e,n,r){super(e,n),this.keysChanged=r}}class mp extends xo{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new mp}clone(){const e=new mp;return this.forEach((n,r)=>{e.set(r,n instanceof xo?n.clone():n)}),e}_callObserver(e,n){uM(this,e,new HEe(this,e,n))}toJSON(){this.doc??Vc();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof xo?i.toJSON():i}}),e}get size(){return[...vC(this)].length}keys(){return rP(vC(this),e=>e[0])}values(){return rP(vC(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return rP(vC(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Vc(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ts(this.doc,n=>{_R(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Ts(this.doc,r=>{oB(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return aB(this,e)}has(e){return u7(this,e)}clear(){this.doc!==null?Ts(this.doc,e=>{this.forEach(function(n,r,i){_R(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(hSe)}}const VEe=t=>new mp,Hv=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Pbe(t,e);class p2{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&pp(),this.right.content.constructor){case Ua:this.right.deleted||QE(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const JH=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Ua:e.right.deleted||QE(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&h_(t,Ei(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},_C=(t,e,n,r)=>{const i=new Map,s=r?lM(e,n):null;if(s){const o=new p2(s.p.left,s.p,s.index,i);return JH(t,o,n-s.index)}else{const o=new p2(null,e._start,0,i);return JH(t,o,n)}},d7=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ua&&Hv(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((o,a)=>{const c=n.left,l=n.right,u=new ka(Ei(s,nc(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new Ua(a,o));u.integrate(t,0),n.right=u,n.forward()})},QE=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},h7=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ua&&Hv(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},f7=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)??null;if(!Hv(l,c)){o.set(a,l);const{left:u,right:d}=n;n.right=new ka(Ei(s,nc(i.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new Ua(a,c)),n.right.integrate(t,0),n.forward()}}return o},sP=(t,e,n,r,i)=>{n.currentAttributes.forEach((h,f)=>{i[f]===void 0&&(i[f]=null)});const s=t.doc,o=s.clientID;h7(n,i);const a=f7(t,e,n,i),c=r.constructor===String?new vp(r):r instanceof xo?new bg(r):new _y(r);let{left:l,right:u,index:d}=n;e._searchMarker&&Nw(e._searchMarker,n.index,c.getLength()),u=new ka(Ei(o,nc(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=d,n.forward(),d7(t,e,n,a)},QH=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;h7(n,i);const a=f7(t,e,n,i);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Ua));){if(!n.right.deleted)switch(n.right.content.constructor){case Ua:{const{key:c,value:l}=n.right.content,u=i[c];if(u!==void 0){if(Hv(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&h_(t,Ei(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ka(Ei(o,nc(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new vp(c)),n.right.integrate(t,0),n.forward()}d7(t,e,n,a)},p7=(t,e,n,r,i)=>{let s=e;const o=Uh();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Ua){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case Ua:{const{key:u,value:d}=l,h=r.get(u)??null;(o.get(u)!==l||h===d)&&(e.delete(t),a++,!c&&(i.get(u)??null)===d&&h!==d&&(h===null?i.delete(u):i.set(u,h))),!c&&!e.deleted&&QE(i,l);break}}}e=e.right}return a},zEe=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ua){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},GEe=t=>{let e=0;return Ts(t.doc,n=>{let r=t._start,i=t._start,s=Uh();const o=a2(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ua:QE(o,i.content);break;default:e+=p7(n,r,i,s,o),s=a2(o),r=i;break}i=i.right}}),e},qEe=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&J9(t,n.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Ua&&o.constructor!==Vu&&e.add(o.parent)})}Ts(n,r=>{F9(t,t.deleteSet,i=>{if(i instanceof Vu||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Ua?e.add(s):zEe(r,i)});for(const i of e)GEe(i)})},ZH=(t,e,n)=>{const r=n,i=a2(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case bg:case _y:case vp:n<e.right.length&&h_(t,Ei(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&p7(t,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Nw(o._searchMarker,e.index,-r+n),e};class WEe extends cM{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Ts(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,d=0;const h=()=>{if(a!==null){let f=null;switch(a){case"delete":d>0&&(f={delete:d}),d=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},i.size>0&&(f.attributes={},i.forEach((p,g)=>{p!==null&&(f.attributes[g]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},Obe(c)||(f.attributes=Abe({},c))),u=0;break}f&&n.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case bg:case _y:this.adds(o)?this.deletes(o)||(h(),a="insert",l=o.content.getContent()[0],h()):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),d+=1):o.deleted||(a!=="retain"&&(h(),a="retain"),u+=1);break;case vp:this.adds(o)?this.deletes(o)||(a!=="insert"&&(h(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),d+=o.length):o.deleted||(a!=="retain"&&(h(),a="retain"),u+=o.length);break;case Ua:{const{key:f,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const g=i.get(f)??null;Hv(g,p)?p!==null&&o.delete(r):(a==="retain"&&h(),Hv(p,s.get(f)??null)?delete c[f]:c[f]=p)}}else if(this.deletes(o)){s.set(f,p);const g=i.get(f)??null;Hv(g,p)||(a==="retain"&&h(),c[f]=g)}else if(!o.deleted){s.set(f,p);const g=c[f];g!==void 0&&(Hv(g,p)?g!==null&&o.delete(r):(a==="retain"&&h(),p===null?delete c[f]:c[f]=p))}o.deleted||(a==="insert"&&h(),QE(i,o.content));break}}o=o.right}for(h();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Hh extends xo{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Vc(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Hh}clone(){const e=new Hh;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new WEe(this,e,n);uM(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Vc();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===vp&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Ts(this.doc,r=>{const i=new p2(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&sP(r,this,i,a,o.attributes||{})}else o.retain!==void 0?QH(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&ZH(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Vc();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const d={};let h=!1;s.forEach((p,g)=>{h=!0,d[g]=p});const f={insert:a};h&&(f.attributes=d),i.push(f),a=""}}const u=()=>{for(;c!==null;){if(wb(c,e)||n!==void 0&&wb(c,n))switch(c.content.constructor){case vp:{const d=s.get("ychange");e!==void 0&&!wb(c,e)?(d===void 0||d.user!==c.id.client||d.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!wb(c,n)?(d===void 0||d.user!==c.id.client||d.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):d!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case bg:case _y:{l();const d={insert:c.content.getContent()[0]};if(s.size>0){const h={};d.attributes=h,s.forEach((f,p)=>{h[p]=f})}i.push(d);break}case Ua:wb(c,e)&&(l(),QE(s,c.content));break}c=c.right}l()};return e||n?Ts(o,d=>{e&&h2(d,e),n&&h2(d,n),u()},"cleanup"):u(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Ts(i,s=>{const o=_C(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),sP(s,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?Ts(i,s=>{const o=_C(s,this,e,!r);sP(s,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Ts(r,i=>{ZH(i,_C(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Ts(i,s=>{const o=_C(s,this,e,!1);o.right!==null&&QH(s,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Ts(this.doc,n=>{_R(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Ts(this.doc,r=>{oB(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return aB(this,e)}getAttributes(){return l7(this)}_write(e){e.writeTypeRef(fSe)}}const KEe=t=>new Hh;class oP{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Vc()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===ag||n.constructor===gp)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class gp extends xo{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new gp}clone(){const e=new gp;return e.insert(0,this.toArray().map(n=>n instanceof xo?n.clone():n)),e}get length(){return this.doc??Vc(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new oP(this,e)}querySelector(e){e=e.toUpperCase();const r=new oP(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),l_(new oP(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){uM(this,e,new JEe(this,n,e))}toString(){return i7(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Pw(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Ts(this.doc,r=>{a7(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Ts(this.doc,r=>{const i=e&&e instanceof xo?e._item:e;vR(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw d_("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Ts(this.doc,r=>{c7(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return r7(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return s7(this,e)}slice(e=0,n=this.length){return n7(this,e,n)}forEach(e){Pw(this,e)}_write(e){e.writeTypeRef(mSe)}}const YEe=t=>new gp;class ag extends gp{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new ag(this.nodeName)}clone(){const e=new ag(this.nodeName),n=this.getAttributes();return Ibe(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof xo?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ts(this.doc,n=>{_R(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Ts(this.doc,r=>{oB(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return aB(this,e)}hasAttribute(e){return u7(this,e)}getAttributes(e){return e?BEe(this,e):l7(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Pw(this,o=>{i.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(pSe),e.writeKey(this.nodeName)}}const XEe=t=>new ag(t.readKey());class JEe extends cM{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class CE extends mp{constructor(e){super(),this.hookName=e}_copy(){return new CE(this.hookName)}clone(){const e=new CE(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(gSe),e.writeKey(this.hookName)}}const QEe=t=>new CE(t.readKey());class X0 extends Hh{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new X0}clone(){const e=new X0;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(vSe)}}const ZEe=t=>new X0;class cB{constructor(e,n){this.id=e,this.length=n}get deleted(){throw lp()}mergeWith(e){return!1}write(e,n,r){throw lp()}integrate(e,n){throw lp()}}const eSe=0;class Vu extends cB{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),X9(e.doc.store,this)}write(e,n){e.writeInfo(eSe),e.writeLen(this.length-n)}getMissing(e,n){return null}}class OT{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new OT(this.content)}splice(e){throw lp()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const tSe=t=>new OT(t.readBuf());class Dw{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Dw(this.len)}splice(e){const n=new Dw(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){mR(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const nSe=t=>new Dw(t.readLen()),m7=(t,e)=>new yg({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class kT{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new kT(m7(this.doc.guid,this.opts))}splice(e){throw lp()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const rSe=t=>new kT(m7(t.readString(),t.readAny()));class _y{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new _y(this.embed)}splice(e){throw lp()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const iSe=t=>new _y(t.readJSON());class Ua{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ua(this.key,this.value)}splice(e){throw lp()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const sSe=t=>new Ua(t.readKey(),t.readJSON());class yR{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new yR(this.arr)}splice(e){const n=new yR(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const oSe=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new yR(n)},aSe=pR("node_env")==="development";class J0{constructor(e){this.arr=e,aSe&&M9(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new J0(this.arr)}splice(e){const n=new J0(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const cSe=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new J0(n)};class vp{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new vp(this.str)}splice(e){const n=new vp(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const lSe=t=>new vp(t.readString()),uSe=[$Ee,VEe,KEe,XEe,YEe,QEe,ZEe],dSe=0,hSe=1,fSe=2,pSe=3,mSe=4,gSe=5,vSe=6;class bg{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new bg(this.type._copy())}splice(e){throw lp()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const _Se=t=>new bg(uSe[t.readTypeRef()](t)),bR=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new ka(Ei(r,i+n),e,Ei(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ei(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class ka extends cB{constructor(e,n,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?NH:0}set marker(e){(this.info&eP)>0!==e&&(this.info^=eP)}get marker(){return(this.info&eP)>0}get keep(){return(this.info&kH)>0}set keep(e){this.keep!==e&&(this.info^=kH)}get countable(){return(this.info&NH)>0}get deleted(){return(this.info&ZN)>0}set deleted(e){this.deleted!==e&&(this.info^=ZN)}markDeleted(){this.info|=ZN}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=nc(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=nc(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Xb&&this.id.client!==this.parent.client&&this.parent.clock>=nc(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=WH(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=h_(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Vu||this.right&&this.right.constructor===Vu)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ka&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ka&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Xb){const r=iP(n,this.parent);r.constructor===Vu?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=WH(e,e.doc.store,Ei(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),gC(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(gC(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(iP(e.doc.store,i.origin)))s.has(iP(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),X9(e.doc.store,this),this.content.integrate(e,this),YH(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Vu(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ei(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&gC(e.origin,this.lastId)&&this.right===e&&gC(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),mR(e.deleteSet,this.id.client,this.id.clock,this.length),YH(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw pp();this.content.gc(e),n?wEe(e,this,new Vu(this.id,this.length)):this.content=new Dw(this.length)}write(e,n){const r=n>0?Ei(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&iM|(r===null?0:Gu)|(i===null?0:Qm)|(s===null?0:Aw);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=EEe(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Xb?(e.writeParentInfo(!1),e.writeLeftID(a)):pp();s!==null&&e.writeString(s)}this.content.write(e,n)}}const g7=(t,e)=>ySe[e&iM](t),ySe=[()=>{pp()},nSe,oSe,tSe,lSe,iSe,sSe,_Se,cSe,rSe,()=>{pp()}],bSe=10;class xd extends cB{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){pp()}write(e,n){e.writeInfo(bSe),Jr(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const v7=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Oh<"u"?Oh:{},_7="__ $YJS$ __";v7[_7]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");v7[_7]=!0;let m2,g2,ESe=t=>t();function SSe(t,e){if(g2)return g2(t,e);ESe(t)}function Q0(t,e,n){if(m2)return m2.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function wSe(t){m2=function(e,n,r){const i=t.createAtom(e);return n&&n(),i},g2=(e,n)=>t.reaction(e,n,{fireImmediately:!1})}const e5=new WeakSet;function TSe(t){if(e5.has(t))return t;e5.add(t);let e;const n=new Map;function r(){if(!e){const d=h=>{(h.changes.added.size||h.changes.deleted.size||h.changes.keys.size||h.changes.delta.length)&&e.reportChanged()};e=Q0("map",()=>{t.observe(d)},()=>{t.unobserve(d)})}e.reportObserved(t._implicitObserver)}function i(d){let h=n.get(d);if(!h){const f=p=>{h.reportChanged()};h=Q0(d+"",()=>{t.observe(f)},()=>{t.unobserve(f)}),n.set(d,h)}h.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(d){if(typeof d!="number")throw new Error("unexpected");return i(d),Reflect.apply(s,this,arguments)};function o(d){const h=t[d];t[d]=function(){return r(),Reflect.apply(h,this,arguments)}}function a(d){let h=t,f=Object.getOwnPropertyDescriptor(h,d);if(f||(h=Object.getPrototypeOf(h),f=Object.getOwnPropertyDescriptor(h,d)),f||(h=Object.getPrototypeOf(h),f=Object.getOwnPropertyDescriptor(h,d)),!f)throw new Error("property not found");const p=f.get;f.get=function(){return this._disableTracking||r(),Reflect.apply(p,this,arguments)},Object.defineProperty(t,d,f)}function c(d,h){let f=t,p=Object.getOwnPropertyDescriptor(f,d);if(p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,d)),p||(f=Object.getPrototypeOf(f),p=Object.getOwnPropertyDescriptor(f,d)),!p)throw new Error("property not found");Object.defineProperty(t,h,p)}o("forEach"),o("toJSON"),o("toArray"),o("slice"),o("map"),c("length","lengthUntracked"),a("length");const l=t.push;t.push=function(d){this._disableTracking=!0;const h=l.call(this,d);return this._disableTracking=!1,h};const u=t.slice;return t.slice=function(d,h){this._disableTracking=!0;const f=u.call(this,d,h);return this._disableTracking=!1,f},t}const t5=new WeakSet;function xSe(t){if(t5.has(t))return t;t5.add(t);let e;function n(){if(!e){let s=Array.from(t.share.keys());const o=a=>{const c=Array.from(t.share.keys());JSON.stringify(s)!==JSON.stringify(c)&&(s=c,e.reportChanged())};e=Q0("map",()=>{t.on("beforeObserverCalls",o)},()=>{t.off("beforeObserverCalls",o)})}e.reportObserved(t._implicitObserver)}const r=t.get;t.get=function(s){if(typeof s!="string")throw new Error("unexpected");const o=Reflect.apply(r,this,arguments);return dM(o),o};function i(s){const o=t[s];let a;t[s]=function(){let c,l=arguments;return n(),a&&a.removeObservers(),a=SSe(()=>(c=Reflect.apply(o,t,l),c),()=>e.reportChanged()),c}}return i("toJSON"),Object.defineProperty(t,"keys",{get:()=>(n(),Object.keys(t.share))}),t}const n5=new WeakSet;function CSe(t){if(n5.has(t))return t;n5.add(t);let e;const n=new Map;function r(){if(!e){const a=c=>{(c.changes.added.size||c.changes.deleted.size||c.changes.keys.size||c.changes.delta.length)&&e.reportChanged()};e=Q0("map",()=>{t.observe(a)},()=>{t.unobserve(a)})}e.reportObserved(t._implicitObserver)}function i(a){let c=n.get(a);if(!c){const l=u=>{u.keysChanged.has(a)&&(u.changes.added.size||u.changes.deleted.size||u.changes.keys.size||u.changes.delta.length)&&c.reportChanged()};c=Q0(a,()=>{t.observe(l)},()=>{t.unobserve(l)}),n.set(a,c)}c.reportObserved(t._implicitObserver)}const s=t.get;t.get=function(a){if(typeof a!="string")throw new Error("unexpected");return i(a),Reflect.apply(s,this,arguments)};function o(a){const c=t[a];t[a]=function(){return r(),Reflect.apply(c,this,arguments)}}return o("values"),o("entries"),o("keys"),o("forEach"),o("toJSON"),t}const r5=new WeakSet;function i5(t){if(r5.has(t))return t;r5.add(t);let e;const n=i=>{e.reportChanged()};e=Q0("text",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(i){const s=t[i];t[i]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(s,this,arguments)}}return r("toString"),r("toJSON"),t}const s5=new WeakSet;function o5(t){if(s5.has(t))return t;s5.add(t);let e;const n=s=>{(s.changes.added.size||s.changes.deleted.size||s.changes.keys.size||s.changes.delta.length)&&e.reportChanged()};e=Q0("xml",()=>{t.observe(n)},()=>{t.unobserve(n)});function r(s){const o=t[s];t[s]=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(o,this,arguments)}}function i(s){let o=t,a=Object.getOwnPropertyDescriptor(o,s);if(a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),a||(o=Object.getPrototypeOf(o),a=Object.getOwnPropertyDescriptor(o,s)),!a)throw new Error("property not found");const c=a.get;a.get=function(){return e.reportObserved(this._implicitObserver),Reflect.apply(c,this,arguments)},Object.defineProperty(t,s,a)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),t}function dM(t){return t instanceof X0||t instanceof Hh?i5(t):t instanceof up?TSe(t):t instanceof mp?CSe(t):t instanceof yg||Object.prototype.hasOwnProperty.call(t,"autoLoad")?xSe(t):t instanceof gp||t instanceof ag?o5(t):t}function a5(t){t.share.forEach(e=>{e.constructor!==xo&&dM(e)})}function c5(t,e){for(let r=t.length-1;r>=e;r--){let i=t[r];if(!i.deleted){var n;if(i instanceof Vu)continue;(n=i.content)==null||n.getContent().forEach(s=>{s instanceof xo&&dM(s)})}}}const l5=new WeakSet;function RSe(t){l5.has(t)||(l5.add(t),dM(t),t.store.clients.forEach(e=>{e&&c5(e,0)}),a5(t),t.on("beforeObserverCalls",e=>{a5(t),e.afterState.forEach((n,r)=>{const i=e.beforeState.get(r)||0;if(i!==n){const s=e.doc.store.clients.get(r);if(!s)return;const o=$h(s,i);c5(s,o)}})}))}class Lw{constructor(e){this.value=void 0,this.value=e}}function ASe(t){return ArrayBuffer.isView(t)?new Lw(t):new Lw(Object.freeze(t))}function MSe(t){const e=function(){var a;let c=(a=this[Pd])==null?void 0:a.implicitObserver;return t._implicitObserver=c,t.slice.bind(t).apply(t,arguments).map(u=>{const d=hM(u,c);return c&&typeof d=="object"?SE(d,c):d})},n=function(a){return a.map(c=>{const l=lB(c);let u=f_(l)||l;if(u instanceof Lw&&(u=u.value),u instanceof xo&&u.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return u})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},i={slice:e,unshift:(...o)=>(t.unshift(n(o)),t.lengthUntracked),push:(...o)=>(t.push(n(o)),t.lengthUntracked),insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){const o=arguments[0];return r.call(this,a=>PSe(a,o))},splice:function(){let o=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],a=arguments[1],c=Array.from(Array.from(arguments).slice(2)),l=e.apply(this,[o,Number.isInteger(a)?o+a:void 0]);return t.doc?t.doc.transact(()=>{t.delete(o,a),t.insert(o,n(c))}):(t.delete(o,a),t.insert(o,n(c))),l}},s=[];for(let o in i)s[o]=i[o];return s}function wS(t){if(typeof t=="string"&&t.trim().length){const e=Number(t);if(Number.isInteger(e))return e}return t}function u5(t,e=new up){if(e[Pa])throw new Error("unexpected");const n=MSe(e),r=new Proxy(n,{set:(i,s,o)=>{throw typeof wS(s)!="number"?new Error:new Error("array assignment is not implemented / supported")},get:(i,s,o)=>{const a=wS(s);if(a===fM)return e;if(typeof a=="number"){let u;if(o&&o[Pd]){var c;u=(c=o[Pd])==null?void 0:c.implicitObserver,e._implicitObserver=u}let d=e.get(a);return d=hM(d,u),d}if(a===Symbol.toStringTag)return"Array";if(a===Symbol.iterator){const u=e.slice();return Reflect.get(u,a)}return a==="length"?e.length:Reflect.get(i,a,o)},deleteProperty:(i,s)=>{const o=wS(s);if(typeof o!="number")throw new Error;return o<e.lengthUntracked&&o>=0?(e.delete(o),!0):!1},has:(i,s)=>{const o=wS(s);return typeof o!="number"?Reflect.has(i,o):o<e.lengthUntracked&&o>=0},getOwnPropertyDescriptor(i,s){const o=wS(s);if(o==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof o=="number"&&o>=0&&o<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:i=>{const s=[];for(let o=0;o<e.length;o++)s.push(o+"");return s.push("length"),s}});return n.push.apply(r,t),r}function d5(t,e=new mp){if(e[Pa])throw new Error("unexpected");const n=new Proxy({},{set:(r,i,s)=>{if(typeof i!="string")throw new Error;const o=lB(s);let a=f_(o)||o;if(a instanceof Lw&&(a=a.value),a instanceof xo&&a.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(i,a),!0},get:(r,i,s)=>{if(i===fM)return e;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[Pd]){var a;o=(a=s[Pd])==null?void 0:a.implicitObserver,e._implicitObserver=o}let c=e.get(i);return c=hM(c,o),c},deleteProperty:(r,i)=>{if(typeof i!="string")throw new Error;return e.has(i)?(e.delete(i),!0):!1},has:(r,i)=>!!(typeof i=="string"&&e.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&e.has(i))return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(e.keys())});rw.set(e,n);for(let r in t)n[r]=t[r];return n}function ISe(t){return t instanceof xo}const rw=new WeakMap;function hM(t,e){if(ISe(t)){if(t._implicitObserver=e,t instanceof up||t instanceof mp){if(!rw.has(t)){const n=lB(t);rw.set(t,n)}t=rw.get(t)}else if(t instanceof ag||t instanceof gp||t instanceof X0||t instanceof CE||t instanceof Hh)GF(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return ASe(t)}return t}function lB(t){if(t==null)return t;if(t=f_(t)||t,t instanceof up)return u5([],t);if(t instanceof mp)return d5({},t);if(typeof t=="string")return t;if(Array.isArray(t))return u5(t);if(t instanceof ag||t instanceof gp||t instanceof X0||t instanceof CE)return t;if(t instanceof Hh)return t;if(typeof t=="object")return t instanceof Lw?t:d5(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function OSe(t){for(let[e,n]of Object.entries(t))if(Array.isArray(n)){if(n.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(n&&typeof n=="object"){if(Object.keys(n).length!==0||Object.getPrototypeOf(n)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(n!=="xml"&&n!=="text")throw new Error("unknown Root initializer")}function h5(t,e,n){let r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function kSe(t,e){if(t[Pa])throw new Error("unexpected");OSe(e);const n=new Proxy({},{set:(r,i,s)=>{throw typeof i!="string"?new Error:new Error("cannot set new elements on root doc")},get:(r,i,s)=>{if(i===fM)return t;if(typeof i!="string")return Reflect.get(r,i);let o;if(s&&s[Pd]){var a;o=(a=s[Pd])==null?void 0:a.implicitObserver,t._implicitObserver=o}if(i==="toJSON"){for(let u of Object.keys(e))h5(t,e,u);return Reflect.get(t,i)}let c=h5(t,e,i);return c=hM(c,o),c},deleteProperty:(r,i)=>{throw new Error("deleteProperty not available for doc")},has:(r,i)=>!!(typeof i=="string"&&t.share.has(i)),getOwnPropertyDescriptor(r,i){if(typeof i=="string"&&t.share.has(i)||i==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:r=>Array.from(t.share.keys())});return rw.set(t,n),n}wSe(Hye);const fM=Symbol("INTERNAL_SYMBOL");function f5(t,e){const n=f_(t)||t;if(!n)throw new Error("not a valid synced object");return n instanceof yg?(n.on("update",e),()=>{n.off("update",e)}):(n.observeDeep(e),()=>{n.unobserveDeep(e)})}function NSe(t){const e=f_(t);if(!(e instanceof yg))throw new Error("store is not a valid syncedStore that maps to a Y.Doc");return e}function f_(t){if(typeof t!="object"||t===null)return;const e=t[fM];return e&&(GF(e),e.__v_skip=!0),e}function PSe(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){const n=f_(t),r=f_(e);return!n||!r?!1:n===r}return!1}function DSe(t,e=new yg){return RSe(e),kSe(e,t)}function LSe(t,e){var n=ft.useReducer(function(a){return a+1},0),r=n[1],i=ft.useRef(),s=ft.useRef(!1);i.current||(i.current=new VF(function(){s.current&&r()}));var o=ft.useMemo(function(){var a;return(a=i.current)==null||a.removeObservers(),SE(t,i.current)},[]);return ft.useEffect(function(){return s.current=!0,i.current||r(),function(){var a;s.current=!1,(a=i.current)==null||a.removeObservers(),i.current=null}},[]),o}function USe(t,e){if(!f_(t))throw new Error("syncedObject passed to useSyncedStore is not a SyncedStore Store or internal data type.");return LSe(t)}const uB=0,y7=1,b7=2,FSe=(t,e)=>{Jr(t,uB);const n=yEe(e);jc(t,n)},E7=(t,e,n)=>{Jr(t,y7),jc(t,mEe(e,n))},BSe=(t,e,n)=>E7(e,n,bl(t)),S7=(t,e,n)=>{try{hEe(e,bl(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},jSe=(t,e)=>{Jr(t,b7),jc(t,e)},$Se=S7,HSe=(t,e,n,r)=>{const i=Qr(t);switch(i){case uB:BSe(t,e,n);break;case y7:S7(t,n,r);break;case b7:$Se(t,n,r);break;default:throw new Error("Unknown message type")}return i},_p=DSe({shared:[]});function NT(t,e,n){return t.find(r=>r.key===e&&r.type===n)}function VSe(){return USe(_p)}function w7(t,e){const n=VSe(),r=NT(n.shared,t,e);return he(r)?r:void 0}function PT(t){return w7(t,0)}function T7(t){return w7(t,1)}function x7(t,e,n){const r=NT(_p.shared,t,e);he(r)||_p.shared.push({key:t,type:e,value:n})}function zSe(t,e){x7(t,0,e)}function C7(t,e){const n=new Hh(e);x7(t,1,n)}function Za(t,e){const n=NT(_p.shared,t,0);if(he(n)){n.value=e;return}_p.shared.push({key:t,type:0,value:e})}function GSe(t,e){const n=new Hh(e),r=NT(_p.shared,t,1);if(he(r)){r.value=n;return}_p.shared.push({key:t,type:1,value:n})}function R7(t,e,n){let r;function i(){const o=NT(_p.shared,t,e);he(o)&&(s(),r=f5(o,()=>n(o.value)))}const s=f5(_p.shared,i);return i(),()=>r==null?void 0:r()}function qSe(t,e){return R7(t,0,e)}function WSe(t,e){return R7(t,1,n=>e(n.toJSON()))}function E1(t){return Nh(t)}let p5=!1;const Vv=NSe(_p),_d=Wh("modem",["second"],t=>{if(_d.session(t))switch(t.target){case"second":!p5&&t.data%2===0&&_d.emit("modem:join");break;case"join":if(t.sender!==_d.id()){_d.reply(t,"joinack");const e=Kv();FSe(e,Vv),_d.reply(t,"sync",E1(e));const n=Kv();E7(n,Vv),_d.reply(t,"sync",E1(n))}break;case"joinack":t.sender!==_d.id()&&(p5=!0);break;case"sync":{if(t.sender!==_d.id()&&he(t.data))try{const e=vy(t.data),n=Kv();HSe(e,n,Vv,_d)===uB&&_d.emit("modem:sync",E1(n))}catch(e){ci(_d,"sync",e.message)}break}}});function A7(t){const e=Kv();jSe(e,t),_d.emit("modem:sync",E1(e))}Vv.on("update",A7);Vv.on("destroy",()=>{Vv==null||Vv.off("update",A7)});const DT=navigator.userAgent.includes("Mac"),KSe=DT?"cmd":"ctrl";var T0=(t=>(t[t.Border=-1]="Border",t[t.Data=0]="Data",t[t.Function=1]="Function",t[t.Position=2]="Position",t[t.Timing=3]="Timing",t[t.Alignment=4]="Alignment",t))(T0||{}),YSe=Object.defineProperty,XSe=(t,e,n)=>e in t?YSe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,yC=(t,e,n)=>(XSe(t,typeof e!="symbol"?e+"":e,n),n);const JSe=[0,1],M7=[1,0],I7=[2,3],O7=[3,2],QSe={L:JSe,M:M7,Q:I7,H:O7},ZSe=/^[0-9]*$/,ewe=/^[A-Z0-9 $%*+.\/:-]*$/,aP="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",dB=1,hB=40,m5=3,twe=3,bC=40,nwe=10,k7=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],N7=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class rwe{constructor(e,n,r,i){if(this.version=e,this.ecc=n,yC(this,"size"),yC(this,"mask"),yC(this,"modules",[]),yC(this,"types",[]),e<dB||e>hB)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,n){return e>=0&&e<this.size&&n>=0&&n<this.size&&this.modules[n][e]}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2===0,T0.Timing),this.setFunctionModule(r,6,r%2===0,T0.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),n=e.length;for(let r=0;r<n;r++)for(let i=0;i<n;i++)r===0&&i===0||r===0&&i===n-1||r===n-1&&i===0||this.drawAlignmentPattern(e[r],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const n=this.ecc[1]<<3|e;let r=n;for(let s=0;s<10;s++)r=r<<1^(r>>>9)*1335;const i=(n<<10|r)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,Om(i,s));this.setFunctionModule(8,7,Om(i,6)),this.setFunctionModule(8,8,Om(i,7)),this.setFunctionModule(7,8,Om(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,Om(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,Om(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,Om(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let r=0;r<12;r++)e=e<<1^(e>>>11)*7973;const n=this.version<<12|e;for(let r=0;r<18;r++){const i=Om(n,r),s=this.size-11+r%3,o=Math.floor(r/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,n){for(let r=-4;r<=4;r++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(r)),o=e+i,a=n+r;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,T0.Position)}}drawAlignmentPattern(e,n){for(let r=-2;r<=2;r++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,n+r,Math.max(Math.abs(i),Math.abs(r))!==1,T0.Alignment)}setFunctionModule(e,n,r,i=T0.Function){this.modules[n][e]=r,this.types[n][e]=i}addEccAndInterleave(e){const n=this.version,r=this.ecc;if(e.length!==S1(n,r))throw new RangeError("Invalid argument");const i=N7[r[0]][n],s=k7[r[0]][n],o=Math.floor(v2(n)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=hwe(s);for(let h=0,f=0;h<i;h++){const p=e.slice(f,f+c-s+(h<a?0:1));f+=p.length;const g=fwe(p,u);h<a&&p.push(0),l.push(p.concat(g))}const d=[];for(let h=0;h<l[0].length;h++)l.forEach((f,p)=>{(h!==c-s||p>=a)&&d.push(f[h])});return d}drawCodewords(e){if(e.length!==Math.floor(v2(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let r=this.size-1;r>=1;r-=2){r===6&&(r=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=r-s,c=(r+1&2)===0?this.size-1-i:i;!this.types[c][o]&&n<e.length*8&&(this.modules[c][o]=Om(e[n>>>3],7-(n&7)),n++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let n=0;n<this.size;n++)for(let r=0;r<this.size;r++){let i;switch(e){case 0:i=(r+n)%2===0;break;case 1:i=n%2===0;break;case 2:i=r%3===0;break;case 3:i=(r+n)%3===0;break;case 4:i=(Math.floor(r/3)+Math.floor(n/2))%2===0;break;case 5:i=r*n%2+r*n%3===0;break;case 6:i=(r*n%2+r*n%3)%2===0;break;case 7:i=((r+n)%2+r*n%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[n][r]&&i&&(this.modules[n][r]=!this.modules[n][r])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=m5:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*bC),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*bC}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=m5:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*bC),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*bC}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=twe)}let n=0;for(const s of this.modules)n=s.reduce((o,a)=>o+(a?1:0),n);const r=this.size*this.size,i=Math.ceil(Math.abs(n*20-r*10)/r)-1;return e+=i*nwe,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,n=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,r=[6];for(let i=this.size-7;r.length<e;i-=n)r.splice(1,0,i);return r}}finderPenaltyCountPatterns(e){const n=e[1],r=n>0&&e[2]===n&&e[3]===n*3&&e[4]===n&&e[5]===n;return(r&&e[0]>=n*4&&e[6]>=n?1:0)+(r&&e[6]>=n*4&&e[0]>=n?1:0)}finderPenaltyTerminateAndCount(e,n,r){return e&&(this.finderPenaltyAddHistory(n,r),n=0),n+=this.size,this.finderPenaltyAddHistory(n,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(e,n){n[0]===0&&(e+=this.size),n.pop(),n.unshift(e)}}function Vm(t,e,n){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let r=e-1;r>=0;r--)n.push(t>>>r&1)}function Om(t,e){return(t>>>e&1)!==0}class fB{constructor(e,n,r){if(this.mode=e,this.numChars=n,this.bitData=r,n<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}getData(){return this.bitData.slice()}}const iwe=[1,10,12,14],swe=[2,9,11,13],owe=[4,8,16,16];function P7(t,e){return t[Math.floor((e+7)/17)+1]}function D7(t){const e=[];for(const n of t)Vm(n,8,e);return new fB(owe,t.length,e)}function awe(t){if(!L7(t))throw new RangeError("String contains non-numeric characters");const e=[];for(let n=0;n<t.length;){const r=Math.min(t.length-n,3);Vm(Number.parseInt(t.substring(n,n+r),10),r*3+1,e),n+=r}return new fB(iwe,t.length,e)}function cwe(t){if(!U7(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let n;for(n=0;n+2<=t.length;n+=2){let r=aP.indexOf(t.charAt(n))*45;r+=aP.indexOf(t.charAt(n+1)),Vm(r,11,e)}return n<t.length&&Vm(aP.indexOf(t.charAt(n)),6,e),new fB(swe,t.length,e)}function lwe(t){return t===""?[]:L7(t)?[awe(t)]:U7(t)?[cwe(t)]:[D7(dwe(t))]}function L7(t){return ZSe.test(t)}function U7(t){return ewe.test(t)}function uwe(t,e){let n=0;for(const r of t){const i=P7(r.mode,e);if(r.numChars>=1<<i)return Number.POSITIVE_INFINITY;n+=4+i+r.bitData.length}return n}function dwe(t){t=encodeURI(t);const e=[];for(let n=0;n<t.length;n++)t.charAt(n)!=="%"?e.push(t.charCodeAt(n)):(e.push(Number.parseInt(t.substring(n+1,n+3),16)),n+=2);return e}function v2(t){if(t<dB||t>hB)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const n=Math.floor(t/7)+2;e-=(25*n-10)*n-55,t>=7&&(e-=36)}return e}function S1(t,e){return Math.floor(v2(t)/8)-k7[e[0]][t]*N7[e[0]][t]}function hwe(t){if(t<1||t>255)throw new RangeError("Degree out of range");const e=[];for(let r=0;r<t-1;r++)e.push(0);e.push(1);let n=1;for(let r=0;r<t;r++){for(let i=0;i<e.length;i++)e[i]=_2(e[i],n),i+1<e.length&&(e[i]^=e[i+1]);n=_2(n,2)}return e}function fwe(t,e){const n=e.map(r=>0);for(const r of t){const i=r^n.shift();n.push(0),e.forEach((s,o)=>n[o]^=_2(s,i))}return n}function _2(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let n=0;for(let r=7;r>=0;r--)n=n<<1^(n>>>7)*285,n^=(e>>>r&1)*t;return n}function pwe(t,e,n=1,r=40,i=-1,s=!0){if(!(dB<=n&&n<=r&&r<=hB)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=n;;o++){const d=S1(o,e)*8,h=uwe(t,o);if(h<=d){a=h;break}if(o>=r)throw new RangeError("Data too long")}for(const d of[M7,I7,O7])s&&a<=S1(o,d)*8&&(e=d);const c=[];for(const d of t){Vm(d.mode[0],4,c),Vm(d.numChars,P7(d.mode,o),c);for(const h of d.getData())c.push(h)}const l=S1(o,e)*8;Vm(0,Math.min(4,l-c.length),c),Vm(0,(8-c.length%8)%8,c);for(let d=236;c.length<l;d^=253)Vm(d,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((d,h)=>u[h>>>3]|=d<<7-(h&7)),new rwe(o,e,u,i)}function mwe(t,e){var d;const{ecc:n="L",boostEcc:r=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof t=="string"?lwe(t):Array.isArray(t)?[D7(t)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof t}`);const l=pwe(c,QSe[n],i,s,o,r),u=gwe({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e!=null&&e.invert&&(u.data=u.data.map(h=>h.map(f=>!f))),(d=e==null?void 0:e.onEncoded)==null||d.call(e,u),u}function gwe(t,e=1){if(!e)return t;const{size:n}=t,r=n+e*2;t.size=r,t.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)t.data.unshift(Array.from({length:r},o=>!1)),t.data.push(Array.from({length:r},o=>!1));const i=T0.Border;t.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)t.types.unshift(Array.from({length:r},o=>i)),t.types.push(Array.from({length:r},o=>i));return t}function vwe(t,e,n,r=!1){return e<0||n<0||e>=t.length||n>=t.length?r:t[n][e]}function _we(t,e={}){const n={WHITE_ALL:"",WHITE_BLACK:"",BLACK_WHITE:"",BLACK_ALL:" "},r=mwe(t,e),i=!1,s=!0,o=(l,u)=>vwe(r.data,l,u,!0),a=[];let c="";for(let l=0;l<r.size;l+=2){for(let u=0;u<r.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=n.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=n.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=n.BLACK_WHITE:c+=n.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}const p_="$dkpurple",ywe="$196",bwe="$205";function gl(t,e){return`$${t}${e}$blue`}function g5(t,e){return`$${t}${e}$ondkblue`}function Ar(t,e){Fh(t,e)}function Ewe(t,e){const n=ywe.repeat(e);Ar(t,`${p_}${n}`)}function pB(t,e){const n=bwe.repeat(e);Ar(t,`${p_}${n}`)}function np(t,e){Ar(t,`${p_} ${" ".repeat(e.length)} `),Ewe(t,e.length+2),Ar(t,`${p_} $white${e} `),pB(t,e.length+2)}function km(t,e){Ar(t,`${p_} ${" ".repeat(e.length)} `),Ar(t,`${p_} $gray${e} `),pB(t,e.length+2)}function ni(t,e,n){Ar(t,`${p_} $white${e} $blue${n}`)}function Oi(t,e){Ar(t,`${p_}$blue${e}`)}function ER(t,e,n,r=!0){if(r){const i=_we(e).split(`
`),s={32:32,9600:223,9604:220,9608:219};for(let o=0;o<i.length;o++){const a=[...i[o]].map(c=>`$${s[c.charCodeAt(0)]}`).join("");Ar(t,a)}}Ar(t,`!copyit ${e};${n}`)}function Swe(t,e,n){Ar(t,`!openit ${e};${n}`)}function TS(){nue(qe,JTe())}const wwe=vg().command("send",(t,e)=>{const[n,r]=Mt(e,0,[lt.NAME,lt.ANY]);switch(rr(n)){case"helpmenu":np(qe,"H E L P"),Swe(qe,"https://github.com/goldbuick/zed-software-system/wiki","open help wiki"),Ar(qe,""),ni(qe,"#help controls","zss controls and inputs"),Ar(qe,"!helpcontrols;read help controls"),Ar(qe,""),ni(qe,"#help text","text formatting"),Ar(qe,"!helptext;read help text"),Ar(qe,""),ni(qe,"#help developer","developer commands"),Ar(qe,"!helpdeveloper;read help developer"),Ar(qe,""),ni(qe,"#help player","player settings"),Ar(qe,"!helpplayer;read help player"),km(qe,"keyboard input"),ni(qe,"?","open console"),ni(qe,"esc","close console"),ni(qe,"tab","move console"),ni(qe,"up / down arrow keys","navigate console items"),ni(qe,"left / right arrow keys","change console items"),ni(qe,"enter","interact with console items"),ni(qe,"alt + arrow keys","skip words and console lines"),ni(qe,`${KSe} + up / down arrow keys`,"input history");break;case"helpcontrols":np(qe,"zss controls and inputs"),km(qe,"keyboard input"),ni(qe,"arrow keys","move"),ni(qe,"shift + arrow keys","shoot"),ni(qe,"enter","ok / accept"),ni(qe,"escape","cancel / close"),ni(qe,"tab","menu / action"),km(qe,"mouse input"),Oi(qe,"todo ???"),km(qe,"controller input"),ni(qe,"left stick","move"),ni(qe,"right stick","aim"),ni(qe,"a","ok / accept"),ni(qe,"b","cancel / close"),ni(qe,"y","menu / action"),ni(qe,"x","shoot"),ni(qe,"triggers","shoot");break;case"helptext":np(qe,"text formatting"),km(qe,"typography"),Oi(qe,"plain text"),Oi(qe,"$centering text"),Oi(qe,'"\\"@quoted strings for special chars\\""'),Oi(qe,"$$0-255 for ascii chars $159$176$240"),Oi(qe,`use color names like ${gl("red","$$red")} to change foreground color`),Oi(qe,`use color names like ${g5("ongreen","$$ongreen")} to change background color`),Oi(qe,`use clear ${g5("onclear","to change background to")} transparent`),km(qe,"hyperlinks"),Oi(qe,`${gl("white",'"!hotkey"')} message shortcut;${gl("gray","Label")}`),Oi(qe,`${gl("white",'"!range"')} flag [labelmin] [labelmax];${gl("gray","Input Label")}`),Oi(qe,`${gl("white",'"!select"')} flag ...list of values;${gl("gray","Input Label")}`),Oi(qe,`${gl("white",'"!number"')} flag [minvalue] [maxvalue];${gl("gray","Input Label")}`),Oi(qe,`${gl("white",'"!text"')} flag;${gl("gray","Input Label")}`),Oi(qe,`${gl("white",'"!copyit"')} flag;${gl("gray","Input Label")}`),Oi(qe,`${gl("white",'"!openit"')} flag;${gl("gray","Input Label")}`);break;case"helpdeveloper":np(qe,"developer commands"),ni(qe,"#books","list books in memory"),ni(qe,"#pages","list pages in opened book"),ni(qe,"@[pagetype:]page name","create & edit a new codepage in the currently opened book"),ni(qe,"#trash","list books and pages from open book you can delete"),ni(qe,"#save","flush state to register");break;case"helpplayer":np(qe,"player settings"),Oi(qe,"todo");break;default:{rK(n,r);break}}return 0}).command("stat",(t,e)=>{let n;const[r,...i]=e.map(ao),s=i.join(" ");switch(rr(r)){case Uu(wn.LOADER):n=xv(xa.CONTENT,s,Ur.LOADER);break;default:n=xv(xa.CONTENT,[r,...i].join(" "),Ur.OBJECT);break;case Uu(wn.BOARD):n=xv(xa.CONTENT,s,Ur.BOARD);break;case Uu(wn.OBJECT):n=xv(xa.CONTENT,s,Ur.OBJECT);break;case Uu(wn.TERRAIN):n=xv(xa.CONTENT,s,Ur.TERRAIN);break;case Uu(wn.CHARSET):n=xv(xa.CONTENT,s,Ur.CHARSET);break;case Uu(wn.PALETTE):n=xv(xa.CONTENT,s,Ur.PALETTE);break}return he(n)&&t.command("pageopen",n.id),0}).command("text",(t,e)=>{const n=e.map(ao).join(" ");return Fh(qe,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ao(n),s=r.map(ao).join(" ");return Fh(qe,`!${s};${i}`),0}).command("bookcreate",(t,e)=>{const[n]=Mt(e,0,[lt.MAYBE_NAME]),r=tK(n);return he(r)&&t.command("bookopen",r.id),0}).command("bookopen",(t,e)=>{const[n]=Mt(e,0,[lt.NAME]),r=AE(n);return he(r)?(Oi(qe,`opened [book] ${r.name}`),x2(xa.MAIN,r.id),t.command("pages")):ci(qe,"bookopen",`book ${n} not found`,_e.elementfocus),0}).command("booktrash",(t,e)=>{const[n]=Mt(e,0,[lt.NAME]),r=Pb(xa.MAIN),i=AE(n);return he(i)&&(r===i&&x2(xa.MAIN,""),txe(n),Oi(qe,`trashed [book] ${i.name}`),TS(),t.command("pages")),0}).command("pageopen",(t,e)=>{const[n]=Mt(e,0,[lt.NAME]),r=Yv(xa.MAIN);if(!he(r))return 0;const i=xT(r,n);if(he(i)){const s=wh(i),o=hC(i);Oi(qe,`opened [${o}] ${s}`),C7(yG(r.id,[i.id]),i.code);const a=hC(i);Hle(qe,r.id,[i.id],a,`${s} - ${r.name}`,_e.elementfocus)}else ci(qe,"pageopen",`page ${n} not found`,_e.elementfocus);return 0}).command("pagetrash",(t,e)=>{const[n]=Mt(e,0,[lt.NAME]),r=Yv(xa.MAIN),i=Sye(r,n);if(he(n)){const s=wh(i),o=hC(i);Oi(qe,`trashed [${o}] ${s}`),TS(),t.command("pages")}return 0}).command("help",(t,e)=>{const n=e.map(ao).join(" ")||"menu";return t.command(`help${n}`),0}).command("books",()=>{km(qe,"books");const t=Pb(xa.MAIN);ni(qe,"main",`${(t==null?void 0:t.name)??"empty"} $GREEN${(t==null?void 0:t.id)??""}`);const e=Pb(xa.CONTENT);ni(qe,"content",`${(e==null?void 0:e.name)??"empty"} ${(e==null?void 0:e.id)??""}`),pB(qe,7);const n=T2();return n.length?n.forEach(r=>{Ar(qe,`!bookopen ${r.id};${r.name}`)}):Oi(qe,"no books found"),Ar(qe,"!bookcreate;create a new book"),0}).command("pages",()=>{km(qe,"pages");const t=Yv(xa.MAIN);return he(t)&&(ni(qe,"main",`${t.name} $GREEN${t.id}`),t.pages.length?[...t.pages].sort((n,r)=>{const i=bE(n),s=bE(r);return i===s?wh(n).localeCompare(wh(r)):s-i}).forEach(n=>{const r=wh(n),i=hC(n);Ar(qe,`!pageopen ${n.id};$blue[${i}]$white ${r}`)}):(Ar(qe,""),Oi(qe,"no pages found"),Oi(qe,"use @ to create a page"),Oi(qe,"@board name of board"),Oi(qe,"@object name of object"),Oi(qe,"@terrain name of terrain"),Oi(qe,"You can omit the type and it will default to object"),Oi(qe,"@object name of object"),Oi(qe,"@name of object"))),0}).command("trash",()=>{km(qe,"$REDTRASH"),Oi(qe,"books");const t=T2();t.length&&(t.forEach(n=>{Ar(qe,`!booktrash ${n.id};$REDTRASH ${n.name}`)}),Ar(qe,""));const e=Pb(xa.MAIN);return he(e)&&(Oi(qe,`pages in open ${e.name} book`),e.pages.forEach(n=>{const r=wh(n);Ar(qe,`!pagetrash ${n.id};$REDTRASH ${r}`)}),Ar(qe,"")),0}).command("dev",()=>(TS(),Ale(qe,_e.elementfocus),0)).command("share",()=>(TS(),Mle(qe,_e.elementfocus),0)).command("save",()=>(TS(),0)).command("fork",()=>(rue(qe,_e.elementfocus),0)).command("nuke",()=>(Ile(qe,_e.elementfocus),0)).command("restart",()=>(eue(qe,_e.elementfocus),0)).command("gadget",()=>(Ule(qe,void 0,_e.elementfocus),0)).command("joincode",(t,e)=>{const[n]=Mt(e,0,[lt.MAYBE_NAME]);return Cle(qe,!!n,_e.elementfocus),0}).command("twitchbroadcast",(t,e)=>{const[n]=Mt(e,0,[lt.NAME]);switch(rr(n)){default:_le(qe,n,_e.elementfocus);break;case"stop":yle(qe,_e.elementfocus);break}return 0}),Twe=vg().command("palette",(t,e)=>{const[n,r]=Mt(e,0,[lt.NAME]),i=I5(),s=yB(rr(n));if(he(s)){const o=sK([s]);if(!he(o))return 0;const[a,c,l]=Mt(e,r,[lt.NUMBER,lt.NUMBER,lt.NUMBER]),u=xv(xa.MAIN,Yn(i.palette)?i.palette:xa.MAIN,Ur.PALETTE),d=K0(u);if(he(d)&&o>=0&&o<=16){const h=o*_E;d.bits[h+0]=xi(a,0,63),d.bits[h+1]=xi(c,0,63),d.bits[h+2]=xi(l,0,63)}he(u)&&(i.palette=u.id)}else{const o=Cw(_e.book,Ur.PALETTE,n);he(o)?(i.palette=o.id,Ar(qe,`loaded palette ${n}`)):ci(qe,"not-found",`unabled to find palette ${n}`)}return 0}).command("charset",(t,e)=>{const[n]=Mt(e,0,[lt.NAME]),r=I5(),i=Cw(_e.book,Ur.CHARSET,n);return he(i)?(r.charset=i.id,Ar(qe,`loaded charset ${n}`)):ci(qe,"not-found",`unabled to find charset ${n}`),0}),xwe=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),v5=new Set(["player","pushable","collision","destructible","p1","p2","p3","cycle","stepx","stepy","light","sender","arg"]),Cwe=["NORTH","SOUTH","WEST","EAST"];function Rwe(t){const e=Uw(t);if(Mn(e.inputcurrent)||(e.inputcurrent=0),Lr(e.inputqueue)||(e.inputqueue=[]),e.inputcurrent>0)return e;const[n]=e.inputqueue,[r=Kt.NONE,i=0]=n??[Kt.NONE,0];switch(e.inputmove=[],e.inputok=0,e.inputcancel=0,e.inputmenu=0,e.inputalt=i&Kq?1:0,e.inputctrl=i&Yq?1:0,e.inputshift=i&Xq?1:0,r){case Kt.MOVE_UP:case Kt.MOVE_DOWN:case Kt.MOVE_LEFT:case Kt.MOVE_RIGHT:e.inputmove=[Cwe[r-Kt.MOVE_UP]];break;case Kt.OK_BUTTON:e.inputok=1;break;case Kt.CANCEL_BUTTON:e.inputcancel=1;break;case Kt.MENU_BUTTON:e.inputmenu=1;break}return e.inputcurrent=r,e.inputqueue=e.inputqueue.filter(s=>{const[o]=s;return o!==Kt.NONE&&o!==r}),e}function Awe(t){const e=SW[t];if(he(e))return e;const n=xW[t];if(he(n))return n;const r=mM[t];if(he(r))return r;const i=Zq[t];if(he(i))return i}const Mwe=vg({get(t,e){var o,a,c,l,u,d,h,f,p,g,v,E,T,C,A,k,I;const n=Awe(e);if(he(n))return[!0,n];if(_e.elementisplayer&&xwe.has(e)){const N=Rwe(_e.elementid)[e];return[he(N),N]}const r=dR(_e.board,_e.element,_e.elementfocus),i=(r==null?void 0:r.id)??_e.elementfocus;switch(e){case"isdark":return[!0,(o=_e.board)!=null&&o.isdark?1:0];case"startx":return[!0,((a=_e.board)==null?void 0:a.startx)??0];case"starty":return[!0,((c=_e.board)==null?void 0:c.starty)??0];case"over":return[!0,((l=_e.board)==null?void 0:l.over)??""];case"under":return[!0,((u=_e.board)==null?void 0:u.under)??""];case"exitnorth":return[!0,((d=_e.board)==null?void 0:d.exitnorth)??""];case"exitsouth":return[!0,((h=_e.board)==null?void 0:h.exitsouth)??""];case"exitwest":return[!0,((f=_e.board)==null?void 0:f.exitwest)??""];case"exiteast":return[!0,((p=_e.board)==null?void 0:p.exiteast)??""];case"timelimit":return[!0,((g=_e.board)==null?void 0:g.timelimit)??0];case"restartonzap":return[!0,((v=_e.board)==null?void 0:v.restartonzap)??0];case"maxplayershots":return[!0,((E=_e.board)==null?void 0:E.maxplayershots)??0];case"boardid":return[!0,((T=_e.board)==null?void 0:T.id)??"ERR"];case"playerx":return[!0,(r==null?void 0:r.x)??-1];case"playery":return[!0,(r==null?void 0:r.y)??-1];case"thisid":return[!0,((C=_e.element)==null?void 0:C.id)??""];case"thisx":return[!0,((A=_e.element)==null?void 0:A.x)??-1];case"thisy":return[!0,((k=_e.element)==null?void 0:k.y)??-1];default:{const N=(I=_e.element)==null?void 0:I[e];if(he(N)||v5.has(e))return[!0,N];break}}const s=Uw(i)[e];return[he(s),s]},set(t,e,n){var o;const r=dR(_e.board,_e.element,_e.elementfocus),i=(r==null?void 0:r.id)??_e.elementfocus;switch(e){case"isdark":he(_e.board)&&(_e.board.isdark=n?1:0);break;case"startx":he(_e.board)&&(_e.board.startx=VS(n,0));break;case"starty":he(_e.board)&&(_e.board.starty=VS(n,0));break;case"over":he(_e.board)&&(_e.board.over=ao(n));break;case"under":he(_e.board)&&(_e.board.under=ao(n));break;case"exitnorth":he(_e.board)&&(_e.board.exitnorth=ao(n));break;case"exitsouth":he(_e.board)&&(_e.board.exitsouth=ao(n));break;case"exitwest":he(_e.board)&&(_e.board.exitwest=ao(n));break;case"exiteast":he(_e.board)&&(_e.board.exiteast=ao(n));break;case"timelimit":he(_e.board)&&(_e.board.timelimit=VS(n,0));break;case"restartonzap":he(_e.board)&&(_e.board.restartonzap=n?1:0);break;case"maxplayershots":he(_e.board)&&(_e.board.maxplayershots=VS(n,0));break;case"boardid":return[!1,n];case"playerx":return[!1,n];case"playery":return[!1,n];case"thisid":return[!1,n];case"thisx":return[!1,n];case"thisy":return[!1,n];default:{const a=(o=_e.element)==null?void 0:o[e];if(he(a)||v5.has(e))return he(_e.element)&&(_e.element[e]=n),[!0,n];break}}const s=Uw(i);return he(s)?(s[e]=n,[!0,n]):[!1,n]},everytick(){var t,e,n;if(he((t=_e.element)==null?void 0:t.stepx)&&he(_e.element.stepy)){const r={x:((e=_e.element)==null?void 0:e.x)??0,y:((n=_e.element)==null?void 0:n.y)??0};C2(_e.book,_e.board,_e.element,{x:r.x+_e.element.stepx,y:r.y+_e.element.stepy})===!1&&(_e.element.stepx=0,_e.element.stepy=0,c9(_e.book,_e.element,"destructible")&&EE(_e.book,_e.board,_e.element,_e.timestamp))}}}).command("clear",(t,e)=>(e.forEach(n=>t.set(ao(n),0)),0)).command("set",(t,e)=>{const[n,r]=Mt(e,0,[lt.NAME,lt.ANY]);return t.set(n,r),0}).command("become",(t,e)=>{var r,i;const[n]=Mt(e,0,[lt.KIND]);if(Bv(_e.book,_e.board),h9(_e.book,_e.board,_e.element),EE(_e.book,_e.board,_e.element,_e.timestamp)){const s={x:((r=_e.element)==null?void 0:r.x)??0,y:((i=_e.element)==null?void 0:i.y)??0};fR(_e.book,_e.board,n,s)}return t.endofprogram(),0}).command("bind",()=>0).command("char",(t,e)=>{const[n]=Mt(e,0,[lt.NUMBER]);return he(_e.element)&&(_e.element.char=n),0}).command("color",(t,e)=>{const[n]=Mt(e,0,[lt.COLOR]);return he(_e.element)&&he(n)&&hR(_e.element,n),0}).command("go",(t,e)=>{if(he(_e.element)){const[n]=Mt(e,0,[lt.DIR]);if(C2(_e.book,_e.board,_e.element,n),t.yield(),_e.element.x===n.x&&_e.element.y===n.y)return 0}return 1}).command("walk",(t,e)=>{if(!he(_e.element))return 0;const[n]=Mt(e,0,[lt.DIR]),r=_e.element.x??0,i=_e.element.y??0;return _e.element.stepx=n.x-r,_e.element.stepy=n.y-i,0}),Iwe=vg().command("idle",t=>(t.yield(),0)).command("end",t=>(t.endofprogram(),0)).command("endwith",(t,e)=>{const[n]=Mt(e,0,[lt.ANY]);return t.set("arg",n),t.command("end")}).command("lock",t=>(t.lock(t.id()),0)).command("restore",(t,e)=>(t.restore(ao(e[0])),0)).command("unlock",t=>(t.unlock(),0)).command("zap",(t,e)=>(t.zap(ao(e[0])),0)).command("cycle",(t,e)=>{if(he(_e.element)){const[n]=Mt(e,0,[lt.NUMBER]);_e.element.cycle=xi(Math.round(n),1,255)}return 0}).command("die",t=>(EE(_e.book,_e.board,_e.element,_e.timestamp),t.endofprogram(),0)).command("endgame",()=>(_e.elementisplayer&&Kle(qe,_e.elementid),0)).command("run",(t,e)=>{const[n]=Mt(e,0,[lt.NAME]);return TR(n),0}).command("runwith",(t,e)=>{const[n,r]=Mt(e,0,[lt.ANY,lt.NAME]);return t.set("arg",n),TR(r),0}),F7={};function Owe(t){var e;return(e=F7[t])==null?void 0:e.format}function Jb(t){var e;return(e=F7[t])==null?void 0:e.content}function _5(t,e){if(!he(t))return;const n=rr(e),r=n.endsWith("le");switch(n){case"float32":case"float32le":{const i=t.dataview.getFloat32(t.cursor,r);return t.cursor+=4,i}case"float64":case"float64le":{const i=t.dataview.getFloat64(t.cursor,r);return t.cursor+=8,i}case"int8":case"int8le":{const i=t.dataview.getInt8(t.cursor);return t.cursor+=1,i}case"int16":case"int16le":{const i=t.dataview.getInt16(t.cursor,r);return t.cursor+=2,i}case"int32":case"int32le":{const i=t.dataview.getInt32(t.cursor,r);return t.cursor+=4,i}case"int64":case"int64le":{const i=t.dataview.getBigInt64(t.cursor,r);return t.cursor+=8,i}case"uint8":case"uint8le":{const i=t.dataview.getUint8(t.cursor);return t.cursor+=1,i}case"uint16":case"uint16le":{const i=t.dataview.getUint16(t.cursor,r);return t.cursor+=2,i}case"uint32":case"uint32le":{const i=t.dataview.getUint32(t.cursor,r);return t.cursor+=4,i}case"uint64":case"uint64le":{const i=t.dataview.getBigUint64(t.cursor,r);return t.cursor+=8,i}}}const kwe=(t,e)=>{const n=Jb(t.id());if(!he(n))return 0;const[r,i]=Mt(e,0,[lt.NAME]),s=rr(r);switch(s){case"seek":{const[o]=Mt(e,i,[lt.NUMBER]);n.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=Mt(e,i,[lt.NAME]);t.set(o,_5(n,s));break}case"text":{const[o,a]=Mt(e,i,[lt.NAME,lt.NAME]),c=_5(n,o);if(Mn(c)&&Yn(a)){const l=new Uint8Array(n.bytes.buffer,n.cursor,c),d=new TextDecoder("utf-8").decode(l);t.set(a,d),n.cursor+=c}break}case"palette":{const[o]=Mt(e,i,[lt.NAME]),a=e2(_e.book,Ur.PALETTE,o),c=K0(a);if(he(c)){const l=Wq*_E,u=wT(new Uint8Array(n.bytes.buffer,n.cursor,l));he(u)&&(c.bits=u.bits),n.cursor+=l}break}case"charset":{const[o]=Mt(e,i,[lt.NAME]),a=e2(_e.book,Ur.CHARSET,o),c=K0(a);if(he(c)){const l=Rd*DL*PL,u=TT(new Uint8Array(n.bytes.buffer,n.cursor,l));he(u)&&(c.bits=u.bits),n.cursor+=l}break}}return 0},RE=t=>t!==null&&Object.prototype.toString.call(t)==="[object Object]",SR=(t,e)=>{if(t===e)return!0;if(typeof t!=typeof e)return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n+=1)if(!SR(t[n],e[n]))return!1;return!0}if(RE(t)&&RE(e)){const n=Object.entries(t),r=new Set(Object.keys(e));if(n.length!==r.size)return!1;for(const[i,s]of n){if(!SR(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},EC=t=>{if(t===""||t===!1||t===null||t===void 0||Array.isArray(t)&&t.length===0)return!0;if(RE(t)){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}return!1},Nwe=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t==="_",y5=t=>t>="0"&&t<="9"||t==="-",Pwe=t=>t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"||t==="_";var at;(function(t){t.TOK_EOF="EOF",t.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",t.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",t.TOK_RBRACKET="Rbracket",t.TOK_RPAREN="Rparen",t.TOK_COMMA="Comma",t.TOK_COLON="Colon",t.TOK_RBRACE="Rbrace",t.TOK_NUMBER="Number",t.TOK_CURRENT="Current",t.TOK_ROOT="Root",t.TOK_EXPREF="Expref",t.TOK_PIPE="Pipe",t.TOK_OR="Or",t.TOK_AND="And",t.TOK_EQ="EQ",t.TOK_GT="GT",t.TOK_LT="LT",t.TOK_GTE="GTE",t.TOK_LTE="LTE",t.TOK_NE="NE",t.TOK_FLATTEN="Flatten",t.TOK_STAR="Star",t.TOK_FILTER="Filter",t.TOK_DOT="Dot",t.TOK_NOT="Not",t.TOK_LBRACE="Lbrace",t.TOK_LBRACKET="Lbracket",t.TOK_LPAREN="Lparen",t.TOK_LITERAL="Literal"})(at||(at={}));const b5={"(":at.TOK_LPAREN,")":at.TOK_RPAREN,"*":at.TOK_STAR,",":at.TOK_COMMA,".":at.TOK_DOT,":":at.TOK_COLON,"@":at.TOK_CURRENT,$:at.TOK_ROOT,"]":at.TOK_RBRACKET,"{":at.TOK_LBRACE,"}":at.TOK_RBRACE},Dwe={"!":!0,"<":!0,"=":!0,">":!0},Lwe={"	":!0,"\n":!0,"\r":!0," ":!0};class Uwe{constructor(){this._current=0}tokenize(e){const n=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(Nwe(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),n.push({start:r,type:at.TOK_UNQUOTEDIDENTIFIER,value:i});else if(b5[e[this._current]]!==void 0)n.push({start:this._current,type:b5[e[this._current]],value:e[this._current]}),this._current+=1;else if(y5(e[this._current]))s=this.consumeNumber(e),n.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),n.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),n.push({start:r,type:at.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),n.push({start:r,type:at.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);n.push({start:r,type:at.TOK_LITERAL,value:o})}else if(Dwe[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&n.push(s);else if(Lwe[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,n.push({start:r,type:at.TOK_AND,value:"&&"})):n.push({start:r,type:at.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,n.push({start:r,type:at.TOK_OR,value:"||"})):n.push({start:r,type:at.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return n}consumeUnquotedIdentifier(e){const n=this._current;for(this._current+=1;this._current<e.length&&Pwe(e[this._current]);)this._current+=1;return e.slice(n,this._current)}consumeQuotedIdentifier(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(n,this._current))}consumeRawStringLiteral(e){const n=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(n+1,this._current-1).replace("\\'","'")}consumeNumber(e){const n=this._current;this._current+=1;const r=e.length;for(;y5(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(n,this._current),10);return{start:n,value:i,type:at.TOK_NUMBER}}consumeLBracket(e){const n=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:n,type:at.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:n,type:at.TOK_FLATTEN,value:"[]"}):{start:n,type:at.TOK_LBRACKET,value:"["}}consumeOperator(e){const n=this._current,r=e[n];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:n,type:at.TOK_NE,value:"!="}):{start:n,type:at.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:n,type:at.TOK_LTE,value:"<="}):{start:n,type:at.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:n,type:at.TOK_GTE,value:">="}):{start:n,type:at.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:n,type:at.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const n=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(n,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const n='[{"',r=["true","false","null"],i="-0123456789";if(e==="")return!1;if(n.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const Fwe=new Uwe,Uc={[at.TOK_EOF]:0,[at.TOK_UNQUOTEDIDENTIFIER]:0,[at.TOK_QUOTEDIDENTIFIER]:0,[at.TOK_RBRACKET]:0,[at.TOK_RPAREN]:0,[at.TOK_COMMA]:0,[at.TOK_RBRACE]:0,[at.TOK_NUMBER]:0,[at.TOK_CURRENT]:0,[at.TOK_EXPREF]:0,[at.TOK_ROOT]:0,[at.TOK_PIPE]:1,[at.TOK_OR]:2,[at.TOK_AND]:3,[at.TOK_EQ]:5,[at.TOK_GT]:5,[at.TOK_LT]:5,[at.TOK_GTE]:5,[at.TOK_LTE]:5,[at.TOK_NE]:5,[at.TOK_FLATTEN]:9,[at.TOK_STAR]:20,[at.TOK_FILTER]:21,[at.TOK_DOT]:40,[at.TOK_NOT]:45,[at.TOK_LBRACE]:50,[at.TOK_LBRACKET]:55,[at.TOK_LPAREN]:60};class Bwe{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const n=this.expression(0);if(this.lookahead(0)!==at.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return n}loadTokens(e){this.tokens=[...Fwe.tokenize(e),{type:at.TOK_EOF,value:"",start:e.length}]}expression(e){const n=this.lookaheadToken(0);this.advance();let r=this.nud(n),i=this.lookahead(0);for(;e<Uc[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let n,r,i;switch(e.type){case at.TOK_LITERAL:return{type:"Literal",value:e.value};case at.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case at.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===at.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case at.TOK_NOT:return r=this.expression(Uc.Not),{type:"NotExpression",children:[r]};case at.TOK_STAR:return n={type:"Identity"},r=this.lookahead(0)===at.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Uc.Star),{type:"ValueProjection",children:[n,r]};case at.TOK_FILTER:return this.led(e.type,{type:"Identity"});case at.TOK_LBRACE:return this.parseMultiselectHash();case at.TOK_FLATTEN:return n={type:at.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(Uc.Flatten),{type:"Projection",children:[n,r]};case at.TOK_LBRACKET:return this.lookahead(0)===at.TOK_NUMBER||this.lookahead(0)===at.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===at.TOK_STAR&&this.lookahead(1)===at.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(Uc.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case at.TOK_CURRENT:return{type:at.TOK_CURRENT};case at.TOK_ROOT:return{type:at.TOK_ROOT};case at.TOK_EXPREF:return i=this.expression(Uc.Expref),{type:"ExpressionReference",children:[i]};case at.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==at.TOK_RPAREN;)this.lookahead(0)===at.TOK_CURRENT?(i={type:at.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(at.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,n){let r;switch(e){case at.TOK_DOT:const i=Uc.Dot;return this.lookahead(0)!==at.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[n,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[n,r]});case at.TOK_PIPE:return r=this.expression(Uc.Pipe),{type:at.TOK_PIPE,children:[n,r]};case at.TOK_OR:return r=this.expression(Uc.Or),{type:"OrExpression",children:[n,r]};case at.TOK_AND:return r=this.expression(Uc.And),{type:"AndExpression",children:[n,r]};case at.TOK_LPAREN:const s=n.name,o=[];let a;for(;this.lookahead(0)!==at.TOK_RPAREN;)this.lookahead(0)===at.TOK_CURRENT?(a={type:at.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===at.TOK_COMMA&&this.match(at.TOK_COMMA),o.push(a);return this.match(at.TOK_RPAREN),{name:s,type:"Function",children:o};case at.TOK_FILTER:const l=this.expression(0);return this.match(at.TOK_RBRACKET),r=this.lookahead(0)===at.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Uc.Filter),{type:"FilterProjection",children:[n,r,l]};case at.TOK_FLATTEN:const u={type:at.TOK_FLATTEN,children:[n]},d=this.parseProjectionRHS(Uc.Flatten);return{type:"Projection",children:[u,d]};case at.TOK_EQ:case at.TOK_NE:case at.TOK_GT:case at.TOK_GTE:case at.TOK_LT:case at.TOK_LTE:return this.parseComparator(n,e);case at.TOK_LBRACKET:const h=this.lookaheadToken(0);return h.type===at.TOK_NUMBER||h.type===at.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(n,r)):(this.match(at.TOK_STAR),this.match(at.TOK_RBRACKET),r=this.parseProjectionRHS(Uc.Star),{type:"Projection",children:[n,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const n=this.lookaheadToken(0);this.errorToken(n,`Expected ${e}, got: ${n.type}`)}}errorToken(e,n=""){const r=new Error(n||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===at.TOK_COLON||this.lookahead(1)===at.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(at.TOK_RBRACKET),e}projectIfSlice(e,n){const r={type:"IndexExpression",children:[e,n]};return n.type==="Slice"?{children:[r,this.parseProjectionRHS(Uc.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let n=0,r=this.lookahead(0);for(;r!==at.TOK_RBRACKET&&n<3;){if(r===at.TOK_COLON)n+=1,this.advance();else if(r===at.TOK_NUMBER)e[n]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(at.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,n){const r=this.expression(Uc[n]);return{type:"Comparator",name:n,children:[e,r]}}parseDotRHS(e){const n=this.lookahead(0);if([at.TOK_UNQUOTEDIDENTIFIER,at.TOK_QUOTEDIDENTIFIER,at.TOK_STAR].includes(n))return this.expression(e);if(n===at.TOK_LBRACKET)return this.match(at.TOK_LBRACKET),this.parseMultiselectList();if(n===at.TOK_LBRACE)return this.match(at.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(Uc[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===at.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===at.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===at.TOK_DOT)return this.match(at.TOK_DOT),this.parseDotRHS(e);const n=this.lookaheadToken(0);this.errorToken(n,`Syntax error, unexpected token: ${n.value}(${n.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==at.TOK_RBRACKET;){const n=this.expression(0);if(e.push(n),this.lookahead(0)===at.TOK_COMMA&&(this.match(at.TOK_COMMA),this.lookahead(0)===at.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(at.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],n=[at.TOK_UNQUOTEDIDENTIFIER,at.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!n.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(at.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===at.TOK_COMMA)this.match(at.TOK_COMMA);else if(this.lookahead(0)===at.TOK_RBRACE){this.match(at.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const jwe=new Bwe;var jt;(function(t){t[t.TYPE_NUMBER=0]="TYPE_NUMBER",t[t.TYPE_ANY=1]="TYPE_ANY",t[t.TYPE_STRING=2]="TYPE_STRING",t[t.TYPE_ARRAY=3]="TYPE_ARRAY",t[t.TYPE_OBJECT=4]="TYPE_OBJECT",t[t.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",t[t.TYPE_EXPREF=6]="TYPE_EXPREF",t[t.TYPE_NULL=7]="TYPE_NULL",t[t.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",t[t.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(jt||(jt={}));class $we{constructor(e){this.TYPE_NAME_TABLE={[jt.TYPE_NUMBER]:"number",[jt.TYPE_ANY]:"any",[jt.TYPE_STRING]:"string",[jt.TYPE_ARRAY]:"array",[jt.TYPE_OBJECT]:"object",[jt.TYPE_BOOLEAN]:"boolean",[jt.TYPE_EXPREF]:"expression",[jt.TYPE_NULL]:"null",[jt.TYPE_ARRAY_NUMBER]:"Array<number>",[jt.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([n])=>Math.abs(n),this.functionAvg=([n])=>{let r=0;for(let i=0;i<n.length;i+=1)r+=n[i];return r/n.length},this.functionCeil=([n])=>Math.ceil(n),this.functionContains=n=>{const[r,i]=n;return r.includes(i)},this.functionEndsWith=n=>{const[r,i]=n;return r.includes(i,r.length-i.length)},this.functionFloor=([n])=>Math.floor(n),this.functionJoin=n=>{const[r,i]=n;return i.join(r)},this.functionKeys=([n])=>Object.keys(n),this.functionLength=([n])=>RE(n)?Object.keys(n).length:n.length,this.functionMap=n=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=n[0],o=n[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===jt.TYPE_NUMBER)return Math.max(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[jt.TYPE_NUMBER,jt.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=n=>{let r={};for(let i=0;i<n.length;i+=1){const s=n[i];r=Object.assign(r,s)}return r},this.functionMin=([n])=>{if(!n.length)return null;if(this.getTypeName(n[0])===jt.TYPE_NUMBER)return Math.min(...n);const i=n;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=n=>{const r=n[1],i=n[0],s=this.createKeyFunction(r,[jt.TYPE_NUMBER,jt.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=n=>{for(let r=0;r<n.length;r+=1)if(this.getTypeName(n[r])!==jt.TYPE_NULL)return n[r];return null},this.functionReverse=([n])=>{if(this.getTypeName(n)===jt.TYPE_STRING){const s=n;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=n.slice(0);return i.reverse(),i},this.functionSort=([n])=>[...n].sort(),this.functionSortBy=n=>{if(!this._interpreter)return[];const r=n[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=n[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![jt.TYPE_NUMBER,jt.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),d=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(d)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(d)]}`);return u>d?1:u<d?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([n,r])=>n.startsWith(r),this.functionSum=([n])=>n.reduce((r,i)=>r+i,0),this.functionToArray=([n])=>this.getTypeName(n)===jt.TYPE_ARRAY?n:[n],this.functionToNumber=([n])=>{const r=this.getTypeName(n);let i;return r===jt.TYPE_NUMBER?n:r===jt.TYPE_STRING&&(i=+n,!isNaN(i))?i:null},this.functionToString=([n])=>this.getTypeName(n)===jt.TYPE_STRING?n:JSON.stringify(n),this.functionType=([n])=>{switch(this.getTypeName(n)){case jt.TYPE_NUMBER:return"number";case jt.TYPE_STRING:return"string";case jt.TYPE_ARRAY:return"array";case jt.TYPE_OBJECT:return"object";case jt.TYPE_BOOLEAN:return"boolean";case jt.TYPE_EXPREF:return"expref";case jt.TYPE_NULL:return"null";default:return}},this.functionValues=([n])=>Object.values(n),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[jt.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[jt.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[jt.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[jt.TYPE_STRING,jt.TYPE_ARRAY]},{types:[jt.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[jt.TYPE_STRING]},{types:[jt.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[jt.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[jt.TYPE_STRING]},{types:[jt.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[jt.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[jt.TYPE_STRING,jt.TYPE_ARRAY,jt.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[jt.TYPE_EXPREF]},{types:[jt.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[jt.TYPE_ARRAY_NUMBER,jt.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[jt.TYPE_ARRAY]},{types:[jt.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[jt.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[jt.TYPE_ARRAY_NUMBER,jt.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[jt.TYPE_ARRAY]},{types:[jt.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[jt.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[jt.TYPE_STRING,jt.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[jt.TYPE_ARRAY_STRING,jt.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[jt.TYPE_ARRAY]},{types:[jt.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[jt.TYPE_STRING]},{types:[jt.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[jt.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[jt.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[jt.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[jt.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[jt.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[jt.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,n,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:n.bind(this),_signature:r}}callFunction(e,n){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,n,r._signature),r._func.call(this,n)}validateInputSignatures(e,n){for(let r=0;r<n.length;r+=1)if("variadic"in n[r]&&r!==n.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,n,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(g=>{var v;return(v=!g.optional)!==null&&v!==void 0?v:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=n.length<a,u=n.length>r.length,d=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${d}${a} argument${o&&"s"||""} but received ${n.length}`);let h,f,p;for(let g=0;g<r.length;g+=1){p=!1,h=r[g].types,f=this.getTypeName(n[g]);let v;for(v=0;v<h.length;v+=1)if(f!==void 0&&this.typeMatches(f,h[v],n[g])){p=!0;break}if(!p&&f!==void 0){const E=h.map(T=>this.TYPE_NAME_TABLE[T]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${g+1} to be type (${E}) but received type ${this.TYPE_NAME_TABLE[f]} instead.`)}}}typeMatches(e,n,r){if(n===jt.TYPE_ANY)return!0;if(n===jt.TYPE_ARRAY_STRING||n===jt.TYPE_ARRAY_NUMBER||n===jt.TYPE_ARRAY){if(n===jt.TYPE_ARRAY)return e===jt.TYPE_ARRAY;if(e===jt.TYPE_ARRAY){let i;n===jt.TYPE_ARRAY_NUMBER?i=jt.TYPE_NUMBER:n===jt.TYPE_ARRAY_STRING&&(i=jt.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===n;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return jt.TYPE_STRING;case"[object Number]":return jt.TYPE_NUMBER;case"[object Array]":return jt.TYPE_ARRAY;case"[object Boolean]":return jt.TYPE_BOOLEAN;case"[object Null]":return jt.TYPE_NULL;case"[object Object]":return e.jmespathType===at.TOK_EXPREF?jt.TYPE_EXPREF:jt.TYPE_OBJECT;default:return}}createKeyFunction(e,n){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!n.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${n.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class Hwe{constructor(){this._rootValue=null,this.runtime=new $we(this)}search(e,n){return this._rootValue=n,this.visit(e,n)}visit(e,n){let r,i,s,o,a,c,l,u,d,h,f;switch(e.type){case"Field":return n===null?null:RE(n)?(c=n[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],n),h=1;h<e.children.length;h+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],n),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(n))return null;let p=e.value;return p<0&&(p=n.length+p),s=n[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(n))return null;const g=[...e.children],v=this.computeSliceParams(n.length,g),[E,T,C]=v;if(s=[],C>0)for(h=E;h<T;h+=C)s.push(n[h]);else for(h=E;h>T;h+=C)s.push(n[h]);return s;case"Projection":if(f=this.visit(e.children[0],n),!Array.isArray(f))return null;for(d=[],h=0;h<f.length;h+=1)i=this.visit(e.children[1],f[h]),i!==null&&d.push(i);return d;case"ValueProjection":if(f=this.visit(e.children[0],n),!RE(f))return null;d=[];const A=Object.values(f);for(h=0;h<A.length;h+=1)i=this.visit(e.children[1],A[h]),i!==null&&d.push(i);return d;case"FilterProjection":if(f=this.visit(e.children[0],n),!Array.isArray(f))return null;const k=[],I=[];for(h=0;h<f.length;h+=1)r=this.visit(e.children[2],f[h]),EC(r)||k.push(f[h]);for(let q=0;q<k.length;q+=1)i=this.visit(e.children[1],k[q]),i!==null&&I.push(i);return I;case"Comparator":switch(o=this.visit(e.children[0],n),a=this.visit(e.children[1],n),e.name){case at.TOK_EQ:s=SR(o,a);break;case at.TOK_NE:s=!SR(o,a);break;case at.TOK_GT:s=o>a;break;case at.TOK_GTE:s=o>=a;break;case at.TOK_LT:s=o<a;break;case at.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case at.TOK_FLATTEN:const N=this.visit(e.children[0],n);if(!Array.isArray(N))return null;let U=[];for(h=0;h<N.length;h+=1)i=N[h],Array.isArray(i)?U=[...U,...i]:U.push(i);return U;case"Identity":return n;case"MultiSelectList":if(n===null)return null;for(d=[],h=0;h<e.children.length;h+=1)d.push(this.visit(e.children[h],n));return d;case"MultiSelectHash":if(n===null)return null;d={};let F;for(h=0;h<e.children.length;h+=1)F=e.children[h],d[F.name]=this.visit(F.value,n);return d;case"OrExpression":return r=this.visit(e.children[0],n),EC(r)&&(r=this.visit(e.children[1],n)),r;case"AndExpression":return o=this.visit(e.children[0],n),EC(o)?o:this.visit(e.children[1],n);case"NotExpression":return o=this.visit(e.children[0],n),EC(o);case"Literal":return e.value;case at.TOK_PIPE:return l=this.visit(e.children[0],n),this.visit(e.children[1],l);case at.TOK_CURRENT:return n;case at.TOK_ROOT:return this._rootValue;case"Function":const $=[];for(let q=0;q<e.children.length;q+=1)$.push(this.visit(e.children[q],n));return this.runtime.callFunction(e.name,$);case"ExpressionReference":const X=e.children[0];return X.jmespathType=at.TOK_EXPREF,X;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,n){let[r,i,s]=n;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,n,r){let i=n;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const Vwe=new Hwe;jt.TYPE_ANY;jt.TYPE_ARRAY;jt.TYPE_ARRAY_NUMBER;jt.TYPE_ARRAY_STRING;jt.TYPE_BOOLEAN;jt.TYPE_EXPREF;jt.TYPE_NULL;jt.TYPE_NUMBER;jt.TYPE_OBJECT;jt.TYPE_STRING;function zwe(t,e){const n=jwe.parse(e);return Vwe.search(n,t)}const Gwe=(t,e)=>{const n=Jb(t.id());if(!he(n))return 0;const[r,i]=Mt(e,0,[lt.NAME,lt.NAME]),s=zwe(n.json,r);return t.set(i,s),0},qwe=(t,e)=>{const n=Jb(t.id());if(!he(n))return 0;const[r,i]=Mt(e,0,[lt.NAME]);switch(rr(r)){case"seek":{const[o]=Mt(e,i,[lt.NUMBER]);n.cursor=xi(o,0,n.lines.length-1);break}case"line":n.cursor=xi(n.cursor+1,0,n.lines.length-1);break;default:{const o=n.lines[n.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[d,h]=Mt(e,u,[lt.NAME]);t.set(d,c[l]??0),++l,u=h}break}}return 0},Wwe=vg({get(t,e){const n=Owe(t.id());if(e==="format")return[!0,n];switch(n){case"text":{const r=Jb(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=Jb(t.id());switch(e){case"filename":return[!0,r.filename]}break}case"binary":{const r=Jb(t.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("send",(t,e)=>{const[n,r]=Mt(e,0,[lt.NAME,lt.ANY]);return rK(n,r),0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(ao).join(" ");return Fh(qe,"$175",n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ao(n),s=r.map(ao).join(" ");return Fh(qe,"$175",`!${s};${i}`),0}).command("txt",qwe).command("json",Gwe).command("bin",kwe).command("with",(t,e)=>{const[n]=Mt(e,0,[lt.NAME]),r=I0(_e.book,Ur.BOARD,n);if(r.length){const i=Hu(...r);he(i)&&(_e.board=K0(i),_e.element={x:Fv(0,ts-1),y:Fv(0,Il-1)})}return 0});function E5(t,e,n,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=Mt(i,a,[lt.ANY]);Lr(c)&&!kh(c)&&!op(c)&&!qm(c)&&!tu(c)?o.push(...c):o.push(c),a=l}switch(rr(r)){case"get":case"post:json":Tle(qe,t,e,n,r,o,_e.elementfocus);break}return 0}const Kwe=vg().command("fetch",(t,e)=>{const[n,r,i="get",s]=Mt(e,0,[lt.NAME,lt.NAME,lt.MAYBE_STRING]);return E5(void 0,n,r,i,e,s),0}).command("fetchwith",(t,e)=>{const[n,r,i,s="get",o]=Mt(e,0,[lt.ANY,lt.NAME,lt.NAME,lt.MAYBE_STRING]);return E5(n,r,i,s,e,o),0}).command("twitchchat",(t,e)=>{const[n]=Mt(e,0,[lt.ANY]);switch(rr(n)){default:ble(qe,n,_e.elementfocus);break;case"close":Ele(qe,_e.elementfocus);break}return 0}),w1={},Tb={};function Ywe(){return{id:Po(),layers:[],scroll:[],sidebar:[]}}const Xwe=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit"]),Jwe=new Set(["tx","text"]),Qwe={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},S5={};let Zwe=t=>{let e=S5[t];return he(e)||(S5[t]=e=Ywe()),e};function cP(t){return Zwe(t)}function mB(t){return he(w1[t])||(w1[t]=[]),w1[t]}function eTe(t,e,n){Object.values(Tb).forEach(r=>{if(r[e]!==void 0){const i=x_(t.id(),e);Mn(n)&&Za(i,n),Yn(n)&&GSe(i,n)}})}function tTe(t){const e=mB(t);return w1[t]=[],e}function nTe(t,e){mB(t).push(e)}function rTe(t,e,n,r,i=()=>0,s=Sl){const o=[e,n,...r],a=rr(`${o[3]}`),c={..._e};function l(u,d){he(d)&&d!==i(u)&&(_e.board=c.board,_e.element=c.element,_e.elementfocus=c.elementfocus,s(u,d))}if(Xwe.has(a)){const u=`${o[2]}`;Tb[e]=Tb[e]??{};const d=i(u)??Qwe[a];if(Tb[e][u]===void 0){const h=x_(e,u);Mn(d)&&zSe(h,d),Yn(d)&&C7(h,d),Jwe.has(a)?Tb[e][u]=WSe(h,f=>{l(u,f)}):Tb[e][u]=qSe(h,f=>{l(u,f)})}}mB(t).push(o)}const iTe=vg({set(t,e,n){return eTe(t,e,n),[!1,void 0]},everytick(){const t=tTe(_e.elementid),[e]=t;if(t.length===1&&Yn(e)){if(he(_e.element))if(e.trim().length===0){const n=cP(_e.elementid);n.sidebar=[]}else _e.element.tickertext=e,_e.element.tickertime=_e.timestamp}else if(t.length>1)if(_e.elementisplayer){const n=cP(_e.elementid);n.sidebar=t}else{const n=cP(_e.elementfocus);n.scroll=t}}}).command("send",(t,e)=>{var u,d;const[n,r]=Mt(e,0,[lt.NAME,lt.ANY]),[i,s]=n.split(":"),o=he(s)?i:"self",a=s??i;function c(h){for(let f=0;f<h.length;++f){const p=h[f];he(p.id)&&t.send(p.id,a,r)}}switch(rr(o)){case"all":for(const h of Object.keys(((u=_e.board)==null?void 0:u.objects)??{}))t.send(h,a,r);break;case"self":t.message({session:qe.session(),id:Po(),sender:t.id(),target:a,data:r});break;case"others":for(const h of Object.keys(((d=_e.board)==null?void 0:d.objects)??{}))h!==t.id()&&t.send(h,a,r);break;default:{c(oW(_e.board,[o]));break}}return 0}).command("stat",()=>0).command("text",(t,e)=>{const n=e.map(ao).join("");return nTe(_e.elementid,n),0}).command("hyperlink",(t,e)=>{const[n,...r]=e,i=ao(n);return rTe(_e.elementid,t.id(),i,r,t.get,t.set),0});var gB=(t=>(t[t.ERROR=0]="ERROR",t[t.CLI=1]="CLI",t[t.LOADER=2]="LOADER",t[t.RUNTIME=3]="RUNTIME",t))(gB||{});const sTe={audio:aye,board:kye,cli:wwe,display:Twe,element:Mwe,runtime:iTe,lifecycle:Iwe,loader:Wwe,network:Kwe},lP=["audio","board","display","network","lifecycle","element"],oTe={0:[],1:["cli",...lP],2:["loader",...lP],3:["runtime",...lP]},aTe={0:new Map,1:new Map,2:new Map,3:new Map};function LT(t){return(oTe[t]??[]).map(n=>sTe[n]).filter(he)}function cTe(t,e){const n=aTe[t];if(!n.has(e)){let r;const i=LT(t);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!he(r));++s);n.set(e,r)}return n.get(e)}function lTe(t,e,n){const r=LT(t);for(let i=0;i<r.length;++i){const[s,o]=r[i].get(e,n);if(s)return[s,o]}return[!1,void 0]}function uTe(t,e,n,r){const i=LT(t);for(let s=0;s<i.length;++s){const[o]=i[s].set(e,n,r);if(o)return[o,r]}return[!1,void 0]}function dTe(t,e){const n=LT(t);for(let r=0;r<n.length;++r)n[r].tick(e)}function w5(t,e){const n=LT(t);for(let r=0;r<n.length;++r)n[r].everytick(e)}var B7={},j7={},$7={};const T5="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");$7.encode=function(t){if(0<=t&&t<T5.length)return T5[t];throw new TypeError("Must be between 0 and 63: "+t)};const hTe=$7,H7=5,V7=1<<H7,fTe=V7-1,pTe=V7;function mTe(t){return t<0?(-t<<1)+1:(t<<1)+0}j7.encode=function(e){let n="",r,i=mTe(e);do r=i&fTe,i>>>=H7,i>0&&(r|=pTe),n+=hTe.encode(r);while(i>0);return n};var UT={};(function(t){function e(I,N,U){if(N in I)return I[N];if(arguments.length===3)return U;throw new Error('"'+N+'" is a required argument.')}t.getArg=e;const n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(I){const N=I.match(n);return N?{scheme:N[1],auth:N[2],host:N[3],port:N[4],path:N[5]}:null}t.urlParse=i;function s(I){let N="";return I.scheme&&(N+=I.scheme+":"),N+="//",I.auth&&(N+=I.auth+"@"),I.host&&(N+=I.host),I.port&&(N+=":"+I.port),I.path&&(N+=I.path),N}t.urlGenerate=s;const o=32;function a(I){const N=[];return function(U){for(let $=0;$<N.length;$++)if(N[$].input===U){const X=N[0];return N[0]=N[$],N[$]=X,N[0].result}const F=I(U);return N.unshift({input:U,result:F}),N.length>o&&N.pop(),F}}const c=a(function(N){let U=N;const F=i(N);if(F){if(!F.path)return N;U=F.path}const $=t.isAbsolute(U),X=[];let q=0,W=0;for(;;)if(q=W,W=U.indexOf("/",q),W===-1){X.push(U.slice(q));break}else for(X.push(U.slice(q,W));W<U.length&&U[W]==="/";)W++;let K=0;for(W=X.length-1;W>=0;W--){const ne=X[W];ne==="."?X.splice(W,1):ne===".."?K++:K>0&&(ne===""?(X.splice(W+1,K),K=0):(X.splice(W,2),K--))}return U=X.join("/"),U===""&&(U=$?"/":"."),F?(F.path=U,s(F)):U});t.normalize=c;function l(I,N){I===""&&(I="."),N===""&&(N=".");const U=i(N),F=i(I);if(F&&(I=F.path||"/"),U&&!U.scheme)return F&&(U.scheme=F.scheme),s(U);if(U||N.match(r))return N;if(F&&!F.host&&!F.path)return F.host=N,s(F);const $=N.charAt(0)==="/"?N:c(I.replace(/\/+$/,"")+"/"+N);return F?(F.path=$,s(F)):$}t.join=l,t.isAbsolute=function(I){return I.charAt(0)==="/"||n.test(I)};function u(I,N){I===""&&(I="."),I=I.replace(/\/$/,"");let U=0;for(;N.indexOf(I+"/")!==0;){const F=I.lastIndexOf("/");if(F<0||(I=I.slice(0,F),I.match(/^([^\/]+:\/)?\/*$/)))return N;++U}return Array(U+1).join("../")+N.substr(I.length+1)}t.relative=u;const d=function(){return!("__proto__"in Object.create(null))}();function h(I){return I}function f(I){return g(I)?"$"+I:I}t.toSetString=d?h:f;function p(I){return g(I)?I.slice(1):I}t.fromSetString=d?h:p;function g(I){if(!I)return!1;const N=I.length;if(N<9||I.charCodeAt(N-1)!==95||I.charCodeAt(N-2)!==95||I.charCodeAt(N-3)!==111||I.charCodeAt(N-4)!==116||I.charCodeAt(N-5)!==111||I.charCodeAt(N-6)!==114||I.charCodeAt(N-7)!==112||I.charCodeAt(N-8)!==95||I.charCodeAt(N-9)!==95)return!1;for(let U=N-10;U>=0;U--)if(I.charCodeAt(U)!==36)return!1;return!0}function v(I,N,U){let F=T(I.source,N.source);return F!==0||(F=I.originalLine-N.originalLine,F!==0)||(F=I.originalColumn-N.originalColumn,F!==0||U)||(F=I.generatedColumn-N.generatedColumn,F!==0)||(F=I.generatedLine-N.generatedLine,F!==0)?F:T(I.name,N.name)}t.compareByOriginalPositions=v;function E(I,N,U){let F=I.generatedLine-N.generatedLine;return F!==0||(F=I.generatedColumn-N.generatedColumn,F!==0||U)||(F=T(I.source,N.source),F!==0)||(F=I.originalLine-N.originalLine,F!==0)||(F=I.originalColumn-N.originalColumn,F!==0)?F:T(I.name,N.name)}t.compareByGeneratedPositionsDeflated=E;function T(I,N){return I===N?0:I===null?1:N===null?-1:I>N?1:-1}function C(I,N){let U=I.generatedLine-N.generatedLine;return U!==0||(U=I.generatedColumn-N.generatedColumn,U!==0)||(U=T(I.source,N.source),U!==0)||(U=I.originalLine-N.originalLine,U!==0)||(U=I.originalColumn-N.originalColumn,U!==0)?U:T(I.name,N.name)}t.compareByGeneratedPositionsInflated=C;function A(I){return JSON.parse(I.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=A;function k(I,N,U){if(N=N||"",I&&(I[I.length-1]!=="/"&&N[0]!=="/"&&(I+="/"),N=I+N),U){const F=i(U);if(!F)throw new Error("sourceMapURL could not be parsed");if(F.path){const $=F.path.lastIndexOf("/");$>=0&&(F.path=F.path.substring(0,$+1))}N=l(s(F),N)}return c(N)}t.computeSourceURL=k})(UT);var vB={};let gTe=class z7{constructor(){this._array=[],this._set=new Map}static fromArray(e,n){const r=new z7;for(let i=0,s=e.length;i<s;i++)r.add(e[i],n);return r}size(){return this._set.size}add(e,n){const r=this.has(e),i=this._array.length;(!r||n)&&this._array.push(e),r||this._set.set(e,i)}has(e){return this._set.has(e)}indexOf(e){const n=this._set.get(e);if(n>=0)return n;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}};vB.ArraySet=gTe;var G7={};const q7=UT;function vTe(t,e){const n=t.generatedLine,r=e.generatedLine,i=t.generatedColumn,s=e.generatedColumn;return r>n||r==n&&s>=i||q7.compareByGeneratedPositionsInflated(t,e)<=0}let _Te=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,n){this._array.forEach(e,n)}add(e){vTe(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(q7.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}};G7.MappingList=_Te;const xS=j7,ra=UT,SC=vB.ArraySet,yTe=G7.MappingList;let W7=class K7{constructor(e){e||(e={}),this._file=ra.getArg(e,"file",null),this._sourceRoot=ra.getArg(e,"sourceRoot",null),this._skipValidation=ra.getArg(e,"skipValidation",!1),this._sources=new SC,this._names=new SC,this._mappings=new yTe,this._sourcesContents=null}static fromSourceMap(e){const n=e.sourceRoot,r=new K7({file:e.file,sourceRoot:n});return e.eachMapping(function(i){const s={generated:{line:i.generatedLine,column:i.generatedColumn}};i.source!=null&&(s.source=i.source,n!=null&&(s.source=ra.relative(n,s.source)),s.original={line:i.originalLine,column:i.originalColumn},i.name!=null&&(s.name=i.name)),r.addMapping(s)}),e.sources.forEach(function(i){let s=i;n!==null&&(s=ra.relative(n,i)),r._sources.has(s)||r._sources.add(s);const o=e.sourceContentFor(i);o!=null&&r.setSourceContent(i,o)}),r}addMapping(e){const n=ra.getArg(e,"generated"),r=ra.getArg(e,"original",null);let i=ra.getArg(e,"source",null),s=ra.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,r,i,s),i!=null&&(i=String(i),this._sources.has(i)||this._sources.add(i)),s!=null&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:r!=null&&r.line,originalColumn:r!=null&&r.column,source:i,name:s})}setSourceContent(e,n){let r=e;this._sourceRoot!=null&&(r=ra.relative(this._sourceRoot,r)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ra.toSetString(r)]=n):this._sourcesContents&&(delete this._sourcesContents[ra.toSetString(r)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(e,n,r){let i=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);i=e.file}const s=this._sourceRoot;s!=null&&(i=ra.relative(s,i));const o=this._mappings.toArray().length>0?new SC:this._sources,a=new SC;this._mappings.unsortedForEach(function(c){if(c.source===i&&c.originalLine!=null){const d=e.originalPositionFor({line:c.originalLine,column:c.originalColumn});d.source!=null&&(c.source=d.source,r!=null&&(c.source=ra.join(r,c.source)),s!=null&&(c.source=ra.relative(s,c.source)),c.originalLine=d.line,c.originalColumn=d.column,d.name!=null&&(c.name=d.name))}const l=c.source;l!=null&&!o.has(l)&&o.add(l);const u=c.name;u!=null&&!a.has(u)&&a.add(u)},this),this._sources=o,this._names=a,e.sources.forEach(function(c){const l=e.sourceContentFor(c);l!=null&&(r!=null&&(c=ra.join(r,c)),s!=null&&(c=ra.relative(s,c)),this.setSourceContent(c,l))},this)}_validateMapping(e,n,r,i){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!r&&!i)){if(!(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:n,name:i}))}}_serializeMappings(){let e=0,n=1,r=0,i=0,s=0,o=0,a="",c,l,u,d;const h=this._mappings.toArray();for(let f=0,p=h.length;f<p;f++){if(l=h[f],c="",l.generatedLine!==n)for(e=0;l.generatedLine!==n;)c+=";",n++;else if(f>0){if(!ra.compareByGeneratedPositionsInflated(l,h[f-1]))continue;c+=","}c+=xS.encode(l.generatedColumn-e),e=l.generatedColumn,l.source!=null&&(d=this._sources.indexOf(l.source),c+=xS.encode(d-o),o=d,c+=xS.encode(l.originalLine-1-i),i=l.originalLine-1,c+=xS.encode(l.originalColumn-r),r=l.originalColumn,l.name!=null&&(u=this._names.indexOf(l.name),c+=xS.encode(u-s),s=u)),a+=c}return a}_generateSourcesContent(e,n){return e.map(function(r){if(!this._sourcesContents)return null;n!=null&&(r=ra.relative(n,r));const i=ra.toSetString(r);return Object.prototype.hasOwnProperty.call(this._sourcesContents,i)?this._sourcesContents[i]:null},this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}};W7.prototype._version=3;B7.SourceMapGenerator=W7;var Y7={};(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(n,r,i,s,o,a){const c=Math.floor((r-n)/2)+n,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a==t.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-n>1?e(n,c,i,s,o,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}t.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||t.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(Y7);var GS={exports:{}};const bTe={},y2=Object.freeze(Object.defineProperty({__proto__:null,default:bTe},Symbol.toStringTag,{value:"Module"})),Z0=J6(y2),ETe=(function(){return typeof window<"u"&&this===window}).call();if(ETe){let t=null;GS.exports=function(){if(typeof t=="string")return fetch(t).then(n=>n.arrayBuffer());if(t instanceof ArrayBuffer)return Promise.resolve(t);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},GS.exports.initialize=e=>t=e}else{const t=Z0,e=Z0;GS.exports=function(){return new Promise((r,i)=>{const s=e.join(__dirname,"mappings.wasm");t.readFile(s,null,(o,a)=>{if(o){i(o);return}r(a.buffer)})})},GS.exports.initialize=n=>{console.debug("SourceMapConsumer.initialize is a no-op when running in node.js")}}var X7=GS.exports;const STe=X7;function wTe(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let CS=null;var TTe=function(){if(CS)return CS;const e=[];return CS=STe().then(n=>WebAssembly.instantiate(n,{env:{mapping_callback(r,i,s,o,a,c,l,u,d,h){const f=new wTe;f.generatedLine=r+1,f.generatedColumn=i,s&&(f.lastGeneratedColumn=o-1),a&&(f.source=c,f.originalLine=l+1,f.originalColumn=u,d&&(f.name=h)),e[e.length-1](f)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(n=>({exports:n.instance.exports,withMappingCallback:(r,i)=>{e.push(r);try{i()}finally{e.pop()}}})).then(null,n=>{throw CS=null,n}),CS};const Fn=UT,uP=Y7,wR=vB.ArraySet,xTe=X7,CTe=TTe,_B=Symbol("smcInternal");class Do{constructor(e,n){return e==_B?Promise.resolve(this):ATe(e,n)}static initialize(e){xTe.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,n){return MTe(e,n)}static async with(e,n,r){const i=await new Do(e,n);try{return await r(i)}finally{i.destroy()}}_parseMappings(e,n){throw new Error("Subclasses must implement _parseMappings")}eachMapping(e,n,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}Do.prototype._version=3;Do.GENERATED_ORDER=1;Do.ORIGINAL_ORDER=2;Do.GREATEST_LOWER_BOUND=1;Do.LEAST_UPPER_BOUND=2;class FT extends Do{constructor(e,n){return super(_B).then(r=>{let i=e;typeof e=="string"&&(i=Fn.parseSourceMapInput(e));const s=Fn.getArg(i,"version");let o=Fn.getArg(i,"sources");const a=Fn.getArg(i,"names",[]);let c=Fn.getArg(i,"sourceRoot",null);const l=Fn.getArg(i,"sourcesContent",null),u=Fn.getArg(i,"mappings"),d=Fn.getArg(i,"file",null);if(s!=r._version)throw new Error("Unsupported version: "+s);return c&&(c=Fn.normalize(c)),o=o.map(String).map(Fn.normalize).map(function(h){return c&&Fn.isAbsolute(c)&&Fn.isAbsolute(h)?Fn.relative(c,h):h}),r._names=wR.fromArray(a.map(String),!0),r._sources=wR.fromArray(o,!0),r._absoluteSources=r._sources.toArray().map(function(h){return Fn.computeSourceURL(c,h,n)}),r.sourceRoot=c,r.sourcesContent=l,r._mappings=u,r._sourceMapURL=n,r.file=d,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,CTe().then(h=>(r._wasm=h,r))})}_findSourceIndex(e){let n=e;if(this.sourceRoot!=null&&(n=Fn.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(let r=0;r<this._absoluteSources.length;++r)if(this._absoluteSources[r]==e)return r;return-1}static fromSourceMap(e,n){return new FT(e.toString())}get sources(){return this._absoluteSources.slice()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(this._mappings,this.sourceRoot),this._mappingsPtr}_parseMappings(e,n){const r=e.length,i=this._wasm.exports.allocate_mappings(r),s=new Uint8Array(this._wasm.exports.memory.buffer,i,r);for(let a=0;a<r;a++)s[a]=e.charCodeAt(a);const o=this._wasm.exports.parse_mappings(i);if(!o){const a=this._wasm.exports.get_last_error();let c=`Error parsing mappings (code ${a}): `;switch(a){case 1:c+="the mappings contained a negative line, column, source index, or name index";break;case 2:c+="the mappings contained a number larger than 2**32";break;case 3:c+="reached EOF while in the middle of parsing a VLQ";break;case 4:c+="invalid base 64 character while parsing a VLQ";break;default:c+="unknown error code";break}throw new Error(c)}this._mappingsPtr=o}eachMapping(e,n,r){const i=n||null,s=r||Do.GENERATED_ORDER,o=this.sourceRoot;this._wasm.withMappingCallback(a=>{a.source!==null&&(a.source=this._sources.at(a.source),a.source=Fn.computeSourceURL(o,a.source,this._sourceMapURL),a.name!==null&&(a.name=this._names.at(a.name))),e.call(i,a)},()=>{switch(s){case Do.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case Do.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(e){let n=Fn.getArg(e,"source");const r=Fn.getArg(e,"line"),i=e.column||0;if(n=this._findSourceIndex(n),n<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(i<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback(o=>{let a=o.lastGeneratedColumn;this._computedColumnSpans&&a===null&&(a=1/0),s.push({line:o.generatedLine,column:o.generatedColumn,lastColumn:a})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),n,r-1,"column"in e,i)}),s}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const n={generatedLine:Fn.getArg(e,"line"),generatedColumn:Fn.getArg(e,"column")};if(n.generatedLine<1)throw new Error("Line numbers must be >= 1");if(n.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r=Fn.getArg(e,"bias",Do.GREATEST_LOWER_BOUND);r==null&&(r=Do.GREATEST_LOWER_BOUND);let i;if(this._wasm.withMappingCallback(s=>i=s,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),n.generatedLine-1,n.generatedColumn,r)}),i&&i.generatedLine===n.generatedLine){let s=Fn.getArg(i,"source",null);s!==null&&(s=this._sources.at(s),s=Fn.computeSourceURL(this.sourceRoot,s,this._sourceMapURL));let o=Fn.getArg(i,"name",null);return o!==null&&(o=this._names.at(o)),{source:s,line:Fn.getArg(i,"originalLine",null),column:Fn.getArg(i,"originalColumn",null),name:o}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1}sourceContentFor(e,n){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];let i=e;this.sourceRoot!=null&&(i=Fn.relative(this.sourceRoot,i));let s;if(this.sourceRoot!=null&&(s=Fn.urlParse(this.sourceRoot))){const o=i.replace(/^file:\/\//,"");if(s.scheme=="file"&&this._sources.has(o))return this.sourcesContent[this._sources.indexOf(o)];if((!s.path||s.path=="/")&&this._sources.has("/"+i))return this.sourcesContent[this._sources.indexOf("/"+i)]}if(n)return null;throw new Error('"'+i+'" is not in the SourceMap.')}generatedPositionFor(e){let n=Fn.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};const r={source:n,originalLine:Fn.getArg(e,"line"),originalColumn:Fn.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let i=Fn.getArg(e,"bias",Do.GREATEST_LOWER_BOUND);i==null&&(i=Do.GREATEST_LOWER_BOUND);let s;if(this._wasm.withMappingCallback(o=>s=o,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,i)}),s&&s.source===r.source){let o=s.lastGeneratedColumn;return this._computedColumnSpans&&o===null&&(o=1/0),{line:Fn.getArg(s,"generatedLine",null),column:Fn.getArg(s,"generatedColumn",null),lastColumn:o}}return{line:null,column:null,lastColumn:null}}}FT.prototype.consumer=Do;class RTe extends Do{constructor(e,n){return super(_B).then(r=>{let i=e;typeof e=="string"&&(i=Fn.parseSourceMapInput(e));const s=Fn.getArg(i,"version"),o=Fn.getArg(i,"sections");if(s!=r._version)throw new Error("Unsupported version: "+s);r._sources=new wR,r._names=new wR,r.__generatedMappings=null,r.__originalMappings=null,r.__generatedMappingsUnsorted=null,r.__originalMappingsUnsorted=null;let a={line:-1,column:0};return Promise.all(o.map(c=>{if(c.url)throw new Error("Support for url field in sections not implemented.");const l=Fn.getArg(c,"offset"),u=Fn.getArg(l,"line"),d=Fn.getArg(l,"column");if(u<a.line||u===a.line&&d<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=l,new Do(Fn.getArg(c,"map"),n).then(f=>({generatedOffset:{generatedLine:u+1,generatedColumn:d+1},consumer:f}))})).then(c=>(r._sections=c,r))})}get _generatedMappings(){return this.__generatedMappings||this._sortGeneratedMappings(),this.__generatedMappings}get _originalMappings(){return this.__originalMappings||this._sortOriginalMappings(),this.__originalMappings}get _generatedMappingsUnsorted(){return this.__generatedMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappingsUnsorted}get _originalMappingsUnsorted(){return this.__originalMappingsUnsorted||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappingsUnsorted}_sortGeneratedMappings(){const e=this._generatedMappingsUnsorted;e.sort(Fn.compareByGeneratedPositionsDeflated),this.__generatedMappings=e}_sortOriginalMappings(){const e=this._originalMappingsUnsorted;e.sort(Fn.compareByOriginalPositions),this.__originalMappings=e}get sources(){const e=[];for(let n=0;n<this._sections.length;n++)for(let r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}originalPositionFor(e){const n={generatedLine:Fn.getArg(e,"line"),generatedColumn:Fn.getArg(e,"column")},r=uP.search(n,this._sections,function(s,o){const a=s.generatedLine-o.generatedOffset.generatedLine;return a||s.generatedColumn-o.generatedOffset.generatedColumn}),i=this._sections[r];return i?i.consumer.originalPositionFor({line:n.generatedLine-(i.generatedOffset.generatedLine-1),column:n.generatedColumn-(i.generatedOffset.generatedLine===n.generatedLine?i.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})}sourceContentFor(e,n){for(let r=0;r<this._sections.length;r++){const s=this._sections[r].consumer.sourceContentFor(e,!0);if(s)return s}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){for(let n=0;n<this._sections.length;n++){const r=this._sections[n];if(r.consumer._findSourceIndex(Fn.getArg(e,"source"))===-1)continue;const i=r.consumer.generatedPositionFor(e);if(i)return{line:i.line+(r.generatedOffset.generatedLine-1),column:i.column+(r.generatedOffset.generatedLine===i.line?r.generatedOffset.generatedColumn-1:0)}}return{line:null,column:null}}_parseMappings(e,n){const r=this.__generatedMappingsUnsorted=[],i=this.__originalMappingsUnsorted=[];for(let s=0;s<this._sections.length;s++){const o=this._sections[s],a=[];o.consumer.eachMapping(c=>a.push(c));for(let c=0;c<a.length;c++){const l=a[c];let u=Fn.computeSourceURL(o.consumer.sourceRoot,null,this._sourceMapURL);this._sources.add(u),u=this._sources.indexOf(u);let d=null;l.name&&(this._names.add(l.name),d=this._names.indexOf(l.name));const h={source:u,generatedLine:l.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:l.generatedColumn+(o.generatedOffset.generatedLine===l.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:l.originalLine,originalColumn:l.originalColumn,name:d};r.push(h),typeof h.originalLine=="number"&&i.push(h)}}}eachMapping(e,n,r){const i=n||null,s=r||Do.GENERATED_ORDER;let o;switch(s){case Do.GENERATED_ORDER:o=this._generatedMappings;break;case Do.ORIGINAL_ORDER:o=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}const a=this.sourceRoot;o.map(function(c){let l=null;return c.source!==null&&(l=this._sources.at(c.source),l=Fn.computeSourceURL(a,l,this._sourceMapURL)),{source:l,generatedLine:c.generatedLine,generatedColumn:c.generatedColumn,originalLine:c.originalLine,originalColumn:c.originalColumn,name:c.name===null?null:this._names.at(c.name)}},this).forEach(e,i)}_findMapping(e,n,r,i,s,o){if(e[r]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[r]);if(e[i]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[i]);return uP.search(e,n,s,o)}allGeneratedPositionsFor(e){const n=Fn.getArg(e,"line"),r={source:Fn.getArg(e,"source"),originalLine:n,originalColumn:Fn.getArg(e,"column",0)};if(r.source=this._findSourceIndex(r.source),r.source<0)return[];if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");const i=[];let s=this._findMapping(r,this._originalMappings,"originalLine","originalColumn",Fn.compareByOriginalPositions,uP.LEAST_UPPER_BOUND);if(s>=0){let o=this._originalMappings[s];if(e.column===void 0){const a=o.originalLine;for(;o&&o.originalLine===a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Fn.getArg(o,"generatedLine",null),column:Fn.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}else{const a=o.originalColumn;for(;o&&o.originalLine===n&&o.originalColumn==a;){let c=o.lastGeneratedColumn;this._computedColumnSpans&&c===null&&(c=1/0),i.push({line:Fn.getArg(o,"generatedLine",null),column:Fn.getArg(o,"generatedColumn",null),lastColumn:c}),o=this._originalMappings[++s]}}}return i}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function ATe(t,e){let n=t;typeof t=="string"&&(n=Fn.parseSourceMapInput(t));const r=n.sections!=null?new RTe(n,e):new FT(n,e);return Promise.resolve(r)}function MTe(t,e){return FT.fromSourceMap(t,e)}var J7={};const ITe=B7.SourceMapGenerator,wC=UT,OTe=/(\r?\n)/,kTe=10,ub="$$$isSourceNode$$$";let NTe=class b2{constructor(e,n,r,i,s){this.children=[],this.sourceContents={},this.line=e??null,this.column=n??null,this.source=r??null,this.name=s??null,this[ub]=!0,i!=null&&this.add(i)}static fromStringWithSourceMap(e,n,r){const i=new b2,s=e.split(OTe);let o=0;const a=function(){const f=g(),p=g()||"";return f+p;function g(){return o<s.length?s[o++]:void 0}};let c=1,l=0,u=null,d;return n.eachMapping(function(f){if(u!==null)if(c<f.generatedLine)h(u,a()),c++,l=0;else{d=s[o]||"";const p=d.substr(0,f.generatedColumn-l);s[o]=d.substr(f.generatedColumn-l),l=f.generatedColumn,h(u,p),u=f;return}for(;c<f.generatedLine;)i.add(a()),c++;l<f.generatedColumn&&(d=s[o]||"",i.add(d.substr(0,f.generatedColumn)),s[o]=d.substr(f.generatedColumn),l=f.generatedColumn),u=f},this),o<s.length&&(u&&h(u,a()),i.add(s.splice(o).join(""))),n.sources.forEach(function(f){const p=n.sourceContentFor(f);p!=null&&(r!=null&&(f=wC.join(r,f)),i.setSourceContent(f,p))}),i;function h(f,p){if(f===null||f.source===void 0)i.add(p);else{const g=r?wC.join(r,f.source):f.source;i.add(new b2(f.originalLine,f.originalColumn,g,p,f.name))}}}add(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[ub]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}prepend(e){if(Array.isArray(e))for(let n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[ub]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this}walk(e){let n;for(let r=0,i=this.children.length;r<i;r++)n=this.children[r],n[ub]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let n,r;const i=this.children.length;if(i>0){for(n=[],r=0;r<i-1;r++)n.push(this.children[r]),n.push(e);n.push(this.children[r]),this.children=n}return this}replaceRight(e,n){const r=this.children[this.children.length-1];return r[ub]?r.replaceRight(e,n):typeof r=="string"?this.children[this.children.length-1]=r.replace(e,n):this.children.push("".replace(e,n)),this}setSourceContent(e,n){this.sourceContents[wC.toSetString(e)]=n}walkSourceContents(e){for(let r=0,i=this.children.length;r<i;r++)this.children[r][ub]&&this.children[r].walkSourceContents(e);const n=Object.keys(this.sourceContents);for(let r=0,i=n.length;r<i;r++)e(wC.fromSetString(n[r]),this.sourceContents[n[r]])}toString(){let e="";return this.walk(function(n){e+=n}),e}toStringWithSourceMap(e){const n={code:"",line:1,column:0},r=new ITe(e);let i=!1,s=null,o=null,a=null,c=null;return this.walk(function(l,u){n.code+=l,u.source!==null&&u.line!==null&&u.column!==null?((s!==u.source||o!==u.line||a!==u.column||c!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name}),s=u.source,o=u.line,a=u.column,c=u.name,i=!0):i&&(r.addMapping({generated:{line:n.line,column:n.column}}),s=null,i=!1);for(let d=0,h=l.length;d<h;d++)l.charCodeAt(d)===kTe?(n.line++,n.column=0,d+1===h?(s=null,i=!1):i&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:n.line,column:n.column},name:u.name})):n.column++}),this.walkSourceContents(function(l,u){r.setSourceContent(l,u)}),{code:n.code,map:r}}};J7.SourceNode=NTe;var PTe=J7.SourceNode;let x5=0;const C5=fp,DTe=["Command","lines"];class LTe extends D_e{constructor(){super(i9,{traceInitPerf:fp,skipValidations:!fp,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"});Gn(this,"program",this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))}));Gn(this,"line",this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(xw)}])}));Gn(this,"stmt",this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.short_commands)),this.MANY(()=>this.SUBRULE(this.commands))}}])}));Gn(this,"inline",this.RULED("inline",()=>{this.SUBRULE(this.instmt)}));Gn(this,"instmt",this.RULED("instmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}])}));Gn(this,"stmt_label",this.RULED("stmt_label",()=>{this.CONSUME(kW)}));Gn(this,"stmt_stat",this.RULED("stmt_stat",()=>{this.CONSUME(jF)}));Gn(this,"stmt_text",this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(IW)}])}));Gn(this,"stmt_comment",this.RULED("stmt_comment",()=>{this.CONSUME(OW)}));Gn(this,"stmt_hyperlink",this.RULED("stmt_hyperlink",()=>{this.CONSUME(NW),this.SUBRULE(this.words),this.CONSUME(PW)}));Gn(this,"stmt_command",this.RULED("stmt_command",()=>{this.CONSUME(Sb),this.AT_LEAST_ONE(()=>this.SUBRULE(this.commands))}));Gn(this,"short_commands",this.RULED("short_commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])}));Gn(this,"commands",this.RULED("commands",()=>{this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])}));Gn(this,"structured_cmd",this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])}));Gn(this,"short_go",this.RULED("short_go",()=>{this.CONSUME(XL),this.SUBRULE(this.words)}));Gn(this,"short_try",this.RULED("short_try",()=>{this.CONSUME(WW),this.SUBRULE(this.words)}));Gn(this,"command_if",this.RULED("command_if",()=>{this.CONSUME(JL),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))}));Gn(this,"command_if_block",this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(m1),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(xw)),this.CONSUME4(Sb),this.CONSUME4(QL)}}])}));Gn(this,"command_block",this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(m1),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(Sb),this.CONSUME(QL)}}])}));Gn(this,"command_fork",this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(m1),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])}));Gn(this,"command_else_if",this.RULED("command_else_if",()=>{this.CONSUME(Sb),this.CONSUME(ZL),this.CONSUME(JL),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Gn(this,"command_else",this.RULED("command_else",()=>{this.CONSUME(Sb),this.CONSUME(ZL),this.OPTION(()=>this.SUBRULE(this.command_fork))}));Gn(this,"command_while",this.RULED("command_while",()=>{this.CONSUME(JW),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Gn(this,"command_repeat",this.RULED("command_repeat",()=>{this.CONSUME(QW),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Gn(this,"command_waitfor",this.RULED("command_waitfor",()=>{this.CONSUME(ZW),this.SUBRULE(this.words)}));Gn(this,"command_foreach",this.RULED("command_foreach",()=>{this.CONSUME(e9),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))}));Gn(this,"command_break",this.RULED("command_break",()=>{this.CONSUME(t9)}));Gn(this,"command_continue",this.RULED("command_continue",()=>{this.CONSUME(n9)}));Gn(this,"command_play",this.RULED("command_play",()=>{this.CONSUME(XW)}));Gn(this,"expr",this.RULED("expr",()=>{this.SUBRULE1(this.and_test),this.MANY(()=>{this.CONSUME(GL),this.SUBRULE2(this.and_test)})}));Gn(this,"and_test",this.RULED("and_test",()=>{this.SUBRULE1(this.not_test),this.MANY(()=>{this.CONSUME(WL),this.SUBRULE2(this.not_test)})}));Gn(this,"not_test",this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(qL),this.SUBRULE1(this.not_test)}},{ALT:()=>this.SUBRULE2(this.comparison)}])}));Gn(this,"comparison",this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr)})}));Gn(this,"comp_op",this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(UW)},{ALT:()=>this.CONSUME(FW)},{ALT:()=>this.CONSUME(BW)},{ALT:()=>this.CONSUME(jW)},{ALT:()=>this.CONSUME($W)},{ALT:()=>this.CONSUME(HW)}])}));Gn(this,"expr_value",this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value),this.MANY(()=>{this.CONSUME(GL),this.SUBRULE2(this.and_test_value)})}));Gn(this,"and_test_value",this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value),this.MANY(()=>{this.CONSUME(WL),this.SUBRULE2(this.not_test_value)})}));Gn(this,"not_test_value",this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(qL),this.SUBRULE1(this.not_test_value)}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])}));Gn(this,"arith_expr",this.RULED("arith_expr",()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item))}));Gn(this,"arith_expr_item",this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(KL)},{ALT:()=>this.CONSUME(YL)}]),this.SUBRULE(this.term)}));Gn(this,"term",this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))}));Gn(this,"term_item",this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(zW)},{ALT:()=>this.CONSUME(XL)},{ALT:()=>this.CONSUME(GW)},{ALT:()=>this.CONSUME(qW)}]),this.SUBRULE(this.factor)}));Gn(this,"factor",this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(KL)},{ALT:()=>this.CONSUME(YL)}]),this.SUBRULE(this.factor)}},{ALT:()=>this.SUBRULE(this.power)}])}));Gn(this,"power",this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(VW),this.SUBRULE(this.factor)})}));Gn(this,"words",this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))}));Gn(this,"token",this.RULED("token",()=>{this.OR([{ALT:()=>this.CONSUME(DW)},{ALT:()=>this.CONSUME(qc)},{ALT:()=>this.CONSUME(LW)},{ALT:()=>{this.CONSUME(KW),this.SUBRULE(this.expr),this.CONSUME(YW)}}])}));this.performSelfAnalysis()}PEEK(n,r,...i){console.info(n,i.map(s=>[s.image,s.tokenType]),r)}RULED(n,r,i){const s=DTe.some(o=>n.includes(o));return this.RULE(n,()=>{const a=(x5++).toString().padStart(3),c=s?"font-weight: bold;":"";if(C5&&!this.RECORDING_PHASE){const l=[this.LA(1),this.LA(2),this.LA(3)].map(u=>`[${u.tokenType.name} ${u.image.replaceAll(`
`,"\\n")}]`);console.info(`${a}%c> ${n} ${l.join(" ")}`,c)}r(),C5&&!this.RECORDING_PHASE&&console.info(`${a}%c< ${n} `,c),x5--},i)}}const Nb=new LTe;if(Y_e){const t=Nb.getGAstProductions(),e=W_e(t);console.info(e)}const UTe=Nb.getBaseCstVisitorConstructor();var ln=(t=>(t[t.PROGRAM=0]="PROGRAM",t[t.API=1]="API",t[t.LINE=2]="LINE",t[t.MARK=3]="MARK",t[t.GOTO=4]="GOTO",t[t.COUNT=5]="COUNT",t[t.TEXT=6]="TEXT",t[t.LABEL=7]="LABEL",t[t.HYPERLINK=8]="HYPERLINK",t[t.STAT=9]="STAT",t[t.MOVE=10]="MOVE",t[t.COMMAND=11]="COMMAND",t[t.LITERAL=12]="LITERAL",t[t.IF=13]="IF",t[t.IF_CHECK=14]="IF_CHECK",t[t.IF_BLOCK=15]="IF_BLOCK",t[t.ELSE_IF=16]="ELSE_IF",t[t.ELSE=17]="ELSE",t[t.WHILE=18]="WHILE",t[t.BREAK=19]="BREAK",t[t.CONTINUE=20]="CONTINUE",t[t.REPEAT=21]="REPEAT",t[t.WAITFOR=22]="WAITFOR",t[t.FOREACH=23]="FOREACH",t[t.OR=24]="OR",t[t.AND=25]="AND",t[t.NOT=26]="NOT",t[t.COMPARE=27]="COMPARE",t[t.COMPARE_ITEM=28]="COMPARE_ITEM",t[t.OPERATOR=29]="OPERATOR",t[t.OPERATOR_ITEM=30]="OPERATOR_ITEM",t[t.EXPR=31]="EXPR",t))(ln||{}),_0=(t=>(t[t.IS_EQ=0]="IS_EQ",t[t.IS_NOT_EQ=1]="IS_NOT_EQ",t[t.IS_LESS_THAN=2]="IS_LESS_THAN",t[t.IS_GREATER_THAN=3]="IS_GREATER_THAN",t[t.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",t[t.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",t))(_0||{}),Hf=(t=>(t[t.EMPTY=0]="EMPTY",t[t.PLUS=1]="PLUS",t[t.MINUS=2]="MINUS",t[t.POWER=3]="POWER",t[t.MULTIPLY=4]="MULTIPLY",t[t.DIVIDE=5]="DIVIDE",t[t.MOD_DIVIDE=6]="MOD_DIVIDE",t[t.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",t[t.UNI_PLUS=8]="UNI_PLUS",t[t.UNI_MINUS=9]="UNI_MINUS",t))(Hf||{}),T1=(t=>(t[t.NUMBER=0]="NUMBER",t[t.STRING=1]="STRING",t[t.TEMPLATE=2]="TEMPLATE",t))(T1||{});function FTe(t){return!!(t!=null&&t.tokenType)}function _h(t,e){const[n]=t??[];return((n==null?void 0:n.image)??e).trimStart().replaceAll(/^"|"$/g,"")}class BTe extends UTe{constructor(){super();Gn(this,"unique",0);fp&&this.validateVisitor()}getnodelocation(n){const r=Object.values(n).flat().filter(i=>!!i).map(i=>i&&FTe(i)?{startLine:i.startLine,startColumn:i.startColumn,startOffset:i.startOffset,endLine:i.endLine,endColumn:i.endColumn,endOffset:i.endOffset}:i!=null&&i.location?{...i.location}:{startLine:0,startColumn:0,startOffset:0,endLine:0,endColumn:0,endOffset:0}).filter(i=>i.startLine!==0&&i.endLine!==0);return{startLine:Math.min(...r.map(i=>i.startLine??1)),startColumn:Math.min(...r.map(i=>i.startColumn??1)),startOffset:Math.min(...r.map(i=>i.startOffset??1)),endLine:Math.max(...r.map(i=>i.endLine??1)),endColumn:Math.max(...r.map(i=>i.endColumn??1)),endOffset:Math.max(...r.map(i=>i.endOffset??1))}}createcodenode(n,r){return[{...r,...this.getnodelocation(n),lineindex:0}]}createstringnode(n,r){return this.createcodenode(n,{type:12,literal:1,value:r})}createmarknode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:3,id:r,comment:i}))}creategotonode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:4,id:r,comment:i}))}createlinenode(n,r){return this.createcodenode(n,{type:2,stmts:r})}createapinode(n,r,i){return this.createlinenode(n,this.createcodenode(n,{type:1,words:i,method:r}))}createlogicnode(n,r,i,s){return this.createlinenode(n,this.createcodenode(n,{type:14,skip:i,words:s,method:r}))}createcountnode(n){return this.createcodenode(n,{type:5,index:this.unique++})}go(n){return Array.isArray(n)?n.map(r=>this.visit(r)).flat():he(n)?[this.visit(n)].flat():[]}program(n){return this.unique=0,this.createcodenode(n,{type:0,lines:[this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:"restart"})),this.go(n.line)].flat()})}line(n){return n.stmt?this.go(n.stmt):[]}stmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.short_commands?[this.go(n.short_commands),this.go(n.commands)].flat():[]}inline(n){return this.go(n.instmt)}instmt(n){return n.stmt_label?this.go(n.stmt_label):n.stmt_stat?this.go(n.stmt_stat):n.stmt_text?this.go(n.stmt_text):n.stmt_comment?this.go(n.stmt_comment):n.stmt_command?this.go(n.stmt_command):n.stmt_hyperlink?this.go(n.stmt_hyperlink):n.commands?this.go(n.commands):[]}stmt_label(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!0,name:_h(n.token_label,":").slice(1).trim()}))}stmt_stat(n){return this.createlinenode(n,this.createcodenode(n,{type:9,value:_h(n.token_stat,"@").slice(1)}))}stmt_text(n){return this.createlinenode(n,this.createcodenode(n,{type:6,value:_h(n.token_text,"")}))}stmt_comment(n){return this.createlinenode(n,this.createcodenode(n,{type:7,active:!1,name:_h(n.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(n){return this.createlinenode(n,this.createcodenode(n,{type:8,link:this.go(n.words),text:_h(n.token_hyperlinktext,";").slice(1)}))}stmt_command(n){return n.commands?this.go(n.commands):[]}short_commands(n){return n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):[]}commands(n){return n.words?this.createlinenode(n,this.createcodenode(n,{type:11,words:this.go(n.words)})):n.short_go?this.go(n.short_go):n.short_try?this.go(n.short_try):n.command_play?this.go(n.command_play):n.structured_cmd?this.go(n.structured_cmd):[]}structured_cmd(n){return n.command_if?this.go(n.command_if):n.command_while?this.go(n.command_while):n.command_repeat?this.go(n.command_repeat):n.command_waitfor?this.go(n.command_waitfor):n.command_foreach?this.go(n.command_foreach):n.command_break?this.go(n.command_break):n.command_continue?this.go(n.command_continue):[]}short_go(n){return n.token_divide?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!0,words:this.go(n.words)})):[]}short_try(n){return n.token_query?this.createlinenode(n,this.createcodenode(n,{type:10,wait:!1,words:this.go(n.words)})):[]}command_if(n){const[r]=this.createlogicnode(n,_h(n.token_if,"if"),"",this.go(n.words)),[i]=this.go(n.command_if_block)??[];return this.createcodenode(n,{type:13,check:r,block:i})}command_if_block(n){const r=Po(),i=Po();return this.createcodenode(n,{type:15,skip:r,done:i,lines:[this.go(n.inline),this.go(n.line),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"alt logic")].flat(),altlines:[this.go(n.command_else_if),this.go(n.command_else),this.createmarknode(n,i,"end of if")].flat()})}command_block(n){return[this.go(n.inline),this.go(n.line)].flat()}command_fork(n){return[this.go(n.inline),this.go(n.line)].flat()}command_else_if(n){const r=Po(),i=Po();return this.createcodenode(n,{type:16,done:i,lines:[this.createlogicnode(n,_h(n.token_if,"if"),r,this.go(n.words)),this.go(n.command_fork),this.creategotonode(n,i,"end of if"),this.createmarknode(n,r,"skip")].flat()})}command_else(n){return this.createcodenode(n,{type:17,lines:this.go(n.command_fork)})}command_while(n){const r=Po(),i=Po();return this.createcodenode(n,{type:18,loop:r,done:i,lines:[this.createmarknode(n,r,"start of while"),this.createlogicnode(n,"if",i,this.go(n.words)),this.go(n.command_block),this.creategotonode(n,r,"loop of while"),this.createmarknode(n,i,"end of while")].flat()})}command_repeat(n){const r=Po(),i=Po(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:21,loop:r,done:i,lines:[this.createapinode(n,"repeatstart",o),this.createmarknode(n,r,"start of repeat"),this.createlogicnode(n,"repeat",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of repeat"),this.createmarknode(n,i,"end of repeat")].flat()})}command_foreach(n){const r=Po(),i=Po(),o=[this.createcountnode(n),this.go(n.words)].flat();return this.createcodenode(n,{type:23,loop:r,done:i,lines:[this.createapinode(n,"foreachstart",o),this.createmarknode(n,r,"start of foreach"),this.createlogicnode(n,"foreach",i,o),this.go(n.command_block),this.creategotonode(n,r,"loop of foreach"),this.createmarknode(n,i,"end of foreach")].flat()})}command_waitfor(n){const r=Po();return this.createcodenode(n,{type:22,loop:r,lines:[this.createmarknode(n,r,"start of waitfor"),this.createlogicnode(n,"waitfor",r,this.go(n.words))].flat()})}command_break(n){return this.createcodenode(n,{type:19,goto:0})}command_continue(n){return this.createcodenode(n,{type:20,goto:0})}command_play(n){const r=_h(n.token_command_play,""),i=r.replace("bgplay","").replace("play","").trim(),s=r.includes("bgplay");return this.createlinenode(n,this.createcodenode(n,{type:11,words:[this.createstringnode(n,s?"bgplay":"play"),this.createstringnode(n,i)].flat()}))}expr(n){return n.and_test.length===1?this.go(n.and_test):this.createcodenode(n,{type:24,items:this.go(n.and_test)})}and_test(n){return n.not_test.length===1?this.go(n.not_test):this.createcodenode(n,{type:25,items:this.go(n.not_test)})}not_test(n){return n.comparison?this.go(n.comparison):n.not_test?this.createcodenode(n,{type:26,items:this.go(n.not_test)}):[]}comparison(n){if(n.arith_expr.length===1)return this.go(n.arith_expr);const[r,i]=this.go(n.arith_expr),[s]=this.go(n.comp_op);return this.createcodenode(n,{type:27,lhs:r,compare:s,rhs:i})}comp_op(n){return n.token_iseq?this.createcodenode(n,{type:28,method:0}):n.token_isnoteq?this.createcodenode(n,{type:28,method:1}):n.token_islessthan?this.createcodenode(n,{type:28,method:2}):n.token_isgreaterthan?this.createcodenode(n,{type:28,method:3}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:4}):n.token_isgreaterthanorequal?this.createcodenode(n,{type:28,method:5}):[]}expr_value(n){return n.and_test_value.length===1?this.go(n.and_test_value):this.createcodenode(n,{type:24,items:this.go(n.and_test_value)})}and_test_value(n){return n.not_test_value.length===1?this.go(n.not_test_value):this.createcodenode(n,{type:25,items:this.go(n.not_test_value)})}not_test_value(n){return n.arith_expr?this.go(n.arith_expr):n.not_test_value?this.createcodenode(n,{type:26,items:this.go(n.not_test_value)}):[]}arith_expr(n){const r=this.go(n.term);return n.arith_expr_item?this.createcodenode(n,{type:29,lhs:r[0],items:this.go(n.arith_expr_item)}):r}arith_expr_item(n){return this.createcodenode(n,{type:30,operator:n.token_plus?1:2,rhs:this.go(n.term)[0]})}term(n){return n.term_item?this.createcodenode(n,{type:29,lhs:this.go(n.factor)[0],items:this.go(n.term_item)}):this.go(n.factor)}term_item(n){let r=0;return n.token_multiply&&(r=4),n.token_divide&&(r=5),n.token_moddivide&&(r=6),n.token_floordivide&&(r=7),this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})}factor(n){if(n.power)return this.go(n.power);let r=0;return n.token_plus&&(r=8),n.token_minus&&(r=9),this.createcodenode(n,{type:29,lhs:void 0,items:this.createcodenode(n,{type:30,operator:r,rhs:this.go(n.factor)[0]})})}power(n){const r=this.go(n.token);return n.factor?this.createcodenode(n,{type:29,lhs:r[0],items:this.createcodenode(n,{type:30,operator:3,rhs:this.go(n.factor)[0]})}):r}words(n){return this.go(n.expr)}token(n){if(n.token_stringliteraldouble){const r=_h(n.token_stringliteraldouble,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:2,value:r})}if(n.token_stringliteral){const r=_h(n.token_stringliteral,"").replaceAll(/(^"|"$)/g,"");return this.createcodenode(n,{type:12,literal:1,value:r})}if(n.token_numberliteral){const r=parseFloat(_h(n.token_numberliteral,"0"));return this.createcodenode(n,{type:12,literal:0,value:r})}return n.token_lparen?this.createcodenode(n,{type:31,words:this.go(n.expr)}):[]}}const jTe=new BTe,Ql={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},pM="zss.js";function _i(t,e){return new PTe(t.startLine??1,t.startColumn??1,pM,e)}function E2(t){return t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function dP(t){return`'${E2(t)}'`}function x1(t){if(t.startsWith('"'))return x1(t.replaceAll(/(^"|"$)/g,""));const e=gM(t);return e.errors.length?t:`['${e.tokens.map(r=>r.tokenType===TB?`', api.get('${E2(r.image.substring(1))}'), '`:E2(r.image)).join("")}'].join('')`}function db(t){return t.filter(e=>e!==void 0).map(Ui)}function R5(t){return _i(t,"")}function $Te(t,e){const n=[];return t.forEach(r=>{n.push(r,e)}),n.pop(),n}function Ma(t,e,n){return _i(t,[`api.${e}(`,...$Te(n,", "),")"])}function HTe(t){if(t.type===ln.COMPARE&&t.compare.type===ln.COMPARE_ITEM)switch(t.compare.method){case _0.IS_EQ:return Ma(t,"isEq",[Ui(t.lhs),Ui(t.rhs)]);case _0.IS_NOT_EQ:return Ma(t,"isNotEq",[Ui(t.lhs),Ui(t.rhs)]);case _0.IS_LESS_THAN:return Ma(t,"isLessThan",[Ui(t.lhs),Ui(t.rhs)]);case _0.IS_GREATER_THAN:return Ma(t,"isGreaterThan",[Ui(t.lhs),Ui(t.rhs)]);case _0.IS_LESS_THAN_OR_EQ:return Ma(t,"isLessThanOrEq",[Ui(t.lhs),Ui(t.rhs)]);case _0.IS_GREATER_THAN_OR_EQ:return Ma(t,"isGreaterThanOrEq",[Ui(t.lhs),Ui(t.rhs)])}return _i(t,"")}function l0(t,e,n){return t.prepend(`api.${e}(`),t.add([", ",Ui(n),")"])}function A5(t,e,n){return t.prepend(`api.${e}(`),t.add([Ui(n),")"])}function VTe(t,e){if(t.type===ln.OPERATOR_ITEM)switch(t.operator){case Hf.PLUS:return l0(e,"opPlus",t.rhs);case Hf.MINUS:return l0(e,"opMinus",t.rhs);case Hf.POWER:return l0(e,"opPower",t.rhs);case Hf.MULTIPLY:return l0(e,"opMultiply",t.rhs);case Hf.DIVIDE:return l0(e,"opDivide",t.rhs);case Hf.MOD_DIVIDE:return l0(e,"opModDivide",t.rhs);case Hf.FLOOR_DIVIDE:return l0(e,"opFloorDivide",t.rhs);case Hf.UNI_PLUS:return A5(e,"opUniPlus",t.rhs);case Hf.UNI_MINUS:return A5(e,"opUniMinus",t.rhs)}return _i(t,"")}function zTe(t){if(t.type===ln.OPERATOR){const e=t.lhs?Ui(t.lhs):_i(t,"");return t.items.forEach(n=>VTe(n,e)),e}return _i(t,"")}function TC(t,e){return _i(t,[Ma(t,"jump",[`${e}`]),"; continue;"])}function Nm(t){return Ql.linelookup[t??""]??-1}function S2(t,e){Ql.linelookup[t]=e}function xb(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case ln.WHILE:case ln.REPEAT:case ln.FOREACH:case ln.ELSE_IF:i.type===e&&(i.done=n);break;case ln.IF_BLOCK:case ln.IF_CHECK:i.type===e&&(i.skip=n);break;case ln.LINE:xb(i.stmts,e,n);break}}}function Q7(t,e,n){for(let r=0;r<t.length;++r){const i=t[r];switch(i.type){case ln.WHILE:case ln.REPEAT:case ln.FOREACH:case ln.ELSE_IF:i.type===e&&S2(i.done,n);break;case ln.IF_BLOCK:case ln.IF_CHECK:i.type===e&&S2(i.skip,n);break;case ln.LINE:Q7(i.stmts,e,n);break}}}function Ui(t){var e;switch(t.type){case ln.PROGRAM:return _i(t,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { yield 1; }
`,`switch (api.getcase()) {
`,...t.lines.map(Ui).flat(),`default:
`,`  api.endofprogram();
`,`  while (api.hm() === 0) { yield 1; };
`,`  continue;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${pM}`]);case ln.API:return _i(t,["  ",Ma(t,t.method,db(t.words)),`;
`]);case ln.LINE:return _i(t,[`case ${t.lineindex}:
`,...t.stmts.map(Ui).flat(),`  break;
`]);case ln.MARK:return _i(t,`  // ${t.comment}
`);case ln.GOTO:{const n=Nm(t.id);return _i(t,["  ",TC(t,n),`
`])}case ln.COUNT:return _i(t,`${t.index}`);case ln.LITERAL:switch(t.literal){case T1.NUMBER:return _i(t,`${t.value}`);case T1.STRING:return _i(t,dP(t.value));case T1.TEMPLATE:return _i(t,x1(t.value))}return R5(t);case ln.TEXT:return _i(t,["  ",Ma(t,"text",[x1(t.value)]),`;
`]);case ln.STAT:if(Ql.isfirststat){Ql.isfirststat=!1;const n=t.value.trim().split(" ").map(dP);return _i(t,["  ",Ma(t,"stat",n),`;
`])}return _i(t,`  // skipped ${t.value}
`);case ln.LABEL:{const n=rr(t.name),r=t.active?"label":"comment";Ql.labels[n]||(Ql.labels[n]=[]);const i=(t.active?1:-1)*t.lineindex;return Ql.labels[n].push(i),_i(t,`  // ${i} '${n}' ${r}
`)}case ln.HYPERLINK:return _i(t,["  ",Ma(t,"hyperlink",[x1(t.text),...db(t.link)]),`;
`]);case ln.MOVE:{const n=Ma(t,"command",[dP("go"),db(t.words)].flat());return t.wait?_i(t,["  if (",n,`) { continue; };
`]):_i(t,["  ",n,`;
`])}case ln.COMMAND:return _i(t,["  if (",Ma(t,"command",db(t.words)),`) { continue; };
`]);case ln.IF:{const n=((e=t.block)==null?void 0:e.type)===ln.IF_BLOCK?t.block:void 0;if(he(n)){xb([t.check],ln.IF_CHECK,n.skip);const r=_i(t,Ui(t.check));return n.lines.forEach(i=>r.add(Ui(i))),Q7(n.altlines,ln.ELSE_IF,Nm(n.done)),n.altlines.forEach(i=>r.add(Ui(i))),r}return _i(t,Ui(t.check))}case ln.IF_CHECK:{const n=Nm(t.skip);return n===-1?_i(t,["  ",Ma(t,t.method,db(t.words)),`;
`]):_i(t,["  if (!",Ma(t,t.method,db(t.words)),") { ",TC(t,n),` }
`])}case ln.ELSE_IF:case ln.ELSE:{const n=_i(t,"");return t.lines.forEach(r=>n.add(Ui(r))),n}case ln.WHILE:{const n=Nm(t.loop),r=Nm(t.done),i=_i(t,"");return xb(t.lines,ln.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case ln.BREAK:s.goto=r;break;case ln.CONTINUE:s.goto=n;break}i.add(Ui(s))}),i}case ln.REPEAT:{const n=Nm(t.loop),r=Nm(t.done),i=_i(t,"");return xb(t.lines,ln.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case ln.BREAK:s.goto=r;break;case ln.CONTINUE:s.goto=n;break}i.add(Ui(s))}),i}case ln.WAITFOR:{const n=_i(t,"");return xb(t.lines,ln.IF_CHECK,t.loop),t.lines.forEach(r=>{n.add(Ui(r))}),n}case ln.FOREACH:{const n=Nm(t.loop),r=Nm(t.done),i=_i(t,"");return xb(t.lines,ln.IF_CHECK,t.done),t.lines.forEach(s=>{switch(s.type){case ln.BREAK:s.goto=r;break;case ln.CONTINUE:s.goto=n;break}i.add(Ui(s))}),i}case ln.BREAK:return _i(t,["  ",TC(t,t.goto),`
`]);case ln.CONTINUE:return _i(t,["  ",TC(t,t.goto),`
`]);case ln.OR:return Ma(t,"or",t.items.map(Ui));case ln.AND:return Ma(t,"and",t.items.map(Ui));case ln.NOT:return Ma(t,"not",t.items.map(Ui));case ln.COMPARE:return HTe(t);case ln.OPERATOR:return zTe(t);case ln.EXPR:return Ma(t,"expr",t.words.map(Ui));default:return console.error("<unsupported node>",t.type,t),R5(t)}}function Vf(t){if(he(t))switch(t.type===ln.LINE&&++Ql.lineindex,t.lineindex=Ql.lineindex,t.type){case ln.PROGRAM:t.lines.forEach(Vf);break;case ln.LINE:t.stmts.forEach(Vf);break;case ln.MARK:S2(t.id,t.lineindex);break;case ln.IF:Vf(t.check),Vf(t.block);break;case ln.IF_BLOCK:t.lines.forEach(Vf),t.altlines.forEach(Vf);break;case ln.ELSE_IF:t.lines.forEach(Vf);break;case ln.ELSE:case ln.WHILE:case ln.REPEAT:case ln.FOREACH:case ln.WAITFOR:t.lines.forEach(Vf);break;case ln.MOVE:case ln.COMMAND:case ln.IF_CHECK:t.words.forEach(Vf);break}}function GTe(t){return Ql.labels={},Ql.internal=1,Ql.lineindex=0,Ql.isfirststat=!0,Vf(t),{...Ui(t).toStringWithSourceMap({file:`${pM}.map`}),...Ql}}function M5(t){return Lr(t)?t.length>0?1:0:t??0}function qTe(t){return`${t}_chip`}function Z7(t=""){return`vm:${t??""}`}function WTe(t,e,n){var l,u;const r=qTe(t),i=Uw(r);let s;const o=$c(Object.entries(n.labels??{}));(!Lr(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(((l=n.errors)==null?void 0:l.length)??0)!==0?1:0);function a(d,h){_e.words=h;const f=cTe(e,d);return he(f)?f(c,h):d!=="send"?a("send",[d,...h]):0}const c={halt(){exe(r)},id(){return t},set(d,h){const[f,p]=uTe(e,c,d,h);if(f)return p},get(d){const[h,f]=lTe(e,c,d);if(h)return f},tick(d){const h=Mn(i.ps)?i.ps:0,f=h%d===0;if(i.ps=h+1,f===!1)return!1;if(c.shouldtick()===!1)return w5(e,c),!1;i.lc=0,i.ys=0,_e.get=c.get,dTe(e,c);try{const p=s==null?void 0:s.next();p!=null&&p.done&&(i.es=1)}catch(p){ci(qe,"crash",p.message),i.es=1}return w5(e,c),!0},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return i.es===0||c.hm()!==0},shouldhalt(){return Mn(i.lc)?++i.lc>ar.HALT_AT_COUNT:!0},hm(){if(Lr(i.mg)&&Lr(i.lb)){const[d]=i.mg;if(he(d))for(let h=0;h<i.lb.length;++h){const[f,p]=i.lb[h];if(f===d)return p.find(g=>Mn(g)&&g>0)??0}}return 0},yield(){i.ys=1},jump(d){i.ec=d},sy(){return!!i.ys||c.shouldhalt()},send(d,h,f,p){qe.emit(`${Z7(d)}:${h}`,f,p)},lock(d){i.lk=d},unlock(){i.lk=""},message(d){i.lk&&d.sender!==i.lk||(i.mg=[d.target,d.data,d.sender,d.player])},zap(d){if(Lr(i.lb))for(let h=0;h<i.lb.length;++h){const[f,p]=i.lb[h];if(f===d){const g=p.findIndex(v=>v>0);g>=0&&(p[g]*=-1)}}},restore(d){if(Lr(i.lb))for(let h=0;h<i.lb.length;++h){const[f,p]=i.lb[h];if(f===d)for(let g=0;g<p.length;g++)p[h]=Math.abs(p[h])}},getcase(){i.ec=Mn(i.ec)?i.ec:1;const d=c.hm();if(d&&Lr(i.mg)){const[,h,f,p]=i.mg;c.set("sender",f),he(h)&&c.set("arg",h),Yn(p)&&(c.set("player",p),_e.elementfocus=p),i.mg=void 0,i.ys=0,i.es=0,i.ec=d}return i.ec},nextcase(){const d=Mn(i.ec)?i.ec:1;return i.ec=d+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(d){const h=o0e.parse(d),[f]=h.filter(p=>p.fileName===pM);return{line:(f==null?void 0:f.lineNumber)??0,column:(f==null?void 0:f.columnNumber)??0}},text(d){return a("text",[d])},stat(...d){return a("stat",d)},hyperlink(...d){return a("hyperlink",d)},command(...d){if(d.length===0)return 0;const[h,...f]=d;return a(rr(ao(h)),f)},if(...d){const[h,f]=Mt(d,0,[lt.ANY]),p=M5(h);return p&&f<d.length&&c.command(...d.slice(f)),p?1:0},try(...d){const[,h]=Mt(d,0,[lt.DIR]),f=c.command("go",...d);return f&&h<d.length&&c.command(...d.slice(h)),f?1:0},take(...d){const[h,f,p]=Mt(d,0,[lt.NAME,lt.ANY]),g=Mn(f),v=g?p:1,E=c.get(h),T=g?f:1;if(!Mn(E))return v<d.length&&c.command(...d.slice(v)),1;const C=E-T;return C<0?(v<d.length&&c.command(...d.slice(v)),1):(c.set(h,C),0)},give(...d){const[h,f,p]=Mt(d,0,[lt.NAME,lt.ANY]),g=Mn(f),v=g?p:1,E=c.get(h),T=g?f:1,C=E===void 0?1:0;return C&&v<d.length&&c.command(...d.slice(v)),c.set(h,VS(E,0)+T),C},repeatstart(d,...h){const[f,p]=Mt(h,0,[lt.NUMBER]),g=`repeatcount${d}`,v=`repeatwords${d}`;i[g]=f,i[v]=p<h.length?h.slice(p):void 0},repeat(d){const h=`repeatcount${d}`,f=`repeatwords${d}`;if(!Mn(i[h]))return 0;const p=i[h];i[h]=p-1;const g=p>0,v=i[f];return g&&Lr(v)&&c.command(...v),g?1:0},foreachstart(d,...h){const[f,p,g,v]=Mt(h,0,[lt.NAME,lt.NUMBER,lt.NUMBER,lt.MAYBE_NUMBER]);let E=Math.min(p,g),T=Math.max(p,g);const C=(v??0)||1;if(C<0){const A=E;E=T,T=A}return c.set(f,E-C),0},foreach(d,...h){const[f,p,g,v,E]=Mt(h,0,[lt.NAME,lt.NUMBER,lt.NUMBER,lt.MAYBE_NUMBER]);let T=Math.min(p,g),C=Math.max(p,g);const A=(v??0)||1;if(A<0){const N=T;T=C,C=N}let k=c.get(f);!Mn(k)||k<T||k>C?k=T:k+=A;const I=k<=C?1:0;return I&&(c.set(f,k),E<h.length&&c.command(...h.slice(E))),I},waitfor(...d){const[h]=Mt(d,0,[lt.ANY]),f=M5(h);return f||c.yield(),f?1:0},or(...d){let h=0;for(let f=0;f<d.length;){const[p,g]=Mt(d,f,[lt.ANY]);if(h=p,h)break;f=g}return h},and(...d){let h=0;for(let f=0;f<d.length;){const[p,g]=Mt(d,f,[lt.ANY]);if(h=p,!h)break;f=g}return h},not(...d){const[h]=Mt(d,0,[lt.ANY]);return h?0:1},expr(...d){const[h]=Mt(d,0,[lt.ANY]);return h},isEq(d,h){const[f]=Mt([d],0,[lt.ANY]),[p]=Mt([h],0,[lt.ANY]);return typeof f=="object"||typeof p=="object"?ZS(f,p)?1:0:f===p?1:0},isNotEq(d,h){return this.isEq(d,h)?0:1},isLessThan(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return f<p?1:0},isGreaterThan(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return f>p?1:0},isLessThanOrEq(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return f<=p?1:0},isGreaterThanOrEq(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return f>=p?1:0},opPlus(d,h){const[f]=Mt([d],0,[lt.ANY]),[p]=Mt([h],0,[lt.ANY]);return f+p},opMinus(d,h){const[f]=Mt([d],0,[lt.ANY]),[p]=Mt([h],0,[lt.ANY]);return f-p},opPower(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return Math.pow(f,p)},opMultiply(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return f*p},opDivide(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return f/p},opModDivide(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return f%p},opFloorDivide(d,h){const[f]=Mt([d],0,[lt.NUMBER]),[p]=Mt([h],0,[lt.NUMBER]);return Math.floor(f/p)},opUniPlus(d){const[h]=Mt([d],0,[lt.NUMBER]);return+h},opUniMinus(d){const[h]=Mt([d],0,[lt.NUMBER]);return-h}};return s=(u=n.code)==null?void 0:u.call(n,c),c}function w2(t){if(!t||t.type===void 0)return;const e=[{start:t.startOffset,end:t.endOffset??0}];return Object.keys(t).forEach(n=>{if(n!=="parent"){const r=t[n];Lr(r)?r.forEach(i=>{e.push(w2(i))}):e.push(w2(r))}}),t.range={start:Math.min(...e.filter(n=>n).map(n=>(n==null?void 0:n.start)??0)),end:Math.max(...e.filter(n=>n).map(n=>(n==null?void 0:n.end)??0))},t.range}function KTe(t){const e=s9(`${t}
`);if(e.errors.length>0)return e;Nb.input=e.tokens;const n=Nb.program();if(Nb.errors.length>0)return{tokens:e.tokens,errors:Nb.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=jTe.go(n);return r?(w2(r),{tokens:e.tokens,cst:n,ast:r}):{tokens:e.tokens,cst:n,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}const hP=Object.getPrototypeOf(function*(){}).constructor;function YTe(t,e){const n=`compile-${t}`;console.time(n);const r=KTe(e);if(console.timeEnd(n),r.errors&&r.errors.length>0)return r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=GTe(r.ast);if(i.code){J_e&&console.info(i.code);try{return{...r,...i,source:i.code,code:new hP("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new hP("api"," ")}}}return{...r,...i,source:"",code:new hP("api"," ")}}function XTe(){const t={},e={};function n(i,s){const o=t[s];if(o)return o;const a=YTe(i,s);return t[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return he(s)?s.isended():!0},halt(i){const s=e[i];return he(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];he(o)&&o.set("arg",s)},tick(i,s,o,a,c){var u;let l=e[i];if(!he(e[i])){const d=n(a,c);if(l=e[i]=WTe(i,s,d),(u=d.errors)!=null&&u.length){const[h]=d.errors,f=((h==null?void 0:h.line)??2)-1,p=c.replaceAll(`\r
`,"").split(`
`).map((E,T)=>[E,T]);p.slice(f-5,f).forEach(([E,T])=>{ci(qe,"build",`$grey${T+1} $grey${E}`)});const[g,v]=p[f]??[];if(Yn(g)&&he(v)){const E=(h.column??1)-1,T=E+h.length,C=E<g.length?g:`${g}*`,A=C.substring(0,E),k=C.substring(E,T),I=C.substring(T);ci(qe,"build",`$red${v+1} $grey${A}$red${k}$grey${I}`)}return h.message.split(`
`).forEach(E=>{ci(qe,"build",E)}),!1}}return!!(l!=null&&l.tick(o))},once(i,s,o,a){const c=r.tick(i,s,1,o,a);return r.halt(i)&&c},message(i){const{target:s,path:o}=MA(i.target),a=e[s];if(he(a)){const c={...i,target:o};a.message(c)}}};return r}new Vn;const eK=XTe();var xa=(t=>(t.MAIN="main",t.TITLE="title",t.PLAYER="player",t.CONTENT="content",t.GADGETSTORE="gadgetstore",t.GADGETSYNC="gadgetsync",t))(xa||{});const Eg={halt:!1,session:Po(),operator:"",software:{main:"",content:""},books:new Map,chips:new Map,loaders:new Map};function JTe(){return Eg.operator}function T2(){return[...Eg.books.values()]}function QTe(){const[t]=Eg.books.values();return t}function AE(t){const e=rr(t);return Eg.books.get(t)??T2().find(n=>n.name===e)}function x2(t,e){he(AE(e))&&(Eg.software[t]=e)}function Pb(t){return AE(Eg.software[t])}function tK(t){const e=a9([]);return Yn(t)&&(e.name=t),nK(e),Fh(qe,`created [book] ${e.name}`),e}function ZTe(t){let e=AE(t);return he(e)||(e=a9([]),e.name=t),nK(e),Fh(qe,`created [book] ${e.name}`),e}function Yv(t,e){let n=he(e)?ZTe(e):Pb(t);return he(n)||(he(n)||(n=QTe()),he(n)||(n=tK(e)),he(n)&&Fh(qe,`opened [book] ${n.name} for ${t}`)),x2(t,n.id),n}function xv(t,e,n){return e2(Yv(t),n,e)}function Uw(t){const e=Yv("main");return nM(e,t)}function I5(){const t=Yv("main");return nM(t,"main")}function exe(t){const e=Yv("main");return wye(e,t)}function nK(t){return Eg.books.set(t.id,t),t.id}function txe(t){const e=AE(t);e&&Eg.books.delete(e.id)}function xC(t,e,n,r){const i=ST(t);Yn(e.id)&&qe.emit("vm:touched",[e.id,i,n],r)}function C2(t,e,n,r){if(!he(n))return!1;const i=d9(t,e,n,r);if(he(i)){if(n.kind==="player"&&i.kind==="edge"){if(r.x<0){const o=I0(t,Ur.BOARD,(e==null?void 0:e.exitwest)??"");if(o.length){const a=Hu(o);zS(t,n.id??"",a.id,{x:ts-1,y:r.y})}}else if(r.x>=ts){const o=I0(t,Ur.BOARD,(e==null?void 0:e.exiteast)??"");if(o.length){const a=Hu(o);zS(t,n.id??"",a.id,{x:0,y:r.y})}}else if(r.y<0){const o=I0(t,Ur.BOARD,(e==null?void 0:e.exitnorth)??"");if(o.length){const a=Hu(o);zS(t,n.id??"",a.id,{x:r.x,y:Il-1})}}else if(r.y>=Il){const o=I0(t,Ur.BOARD,(e==null?void 0:e.exitsouth)??"");if(o.length){const a=Hu(o);zS(t,n.id??"",a.id,{x:r.x,y:0})}}}else xC(i,n,"thud",void 0);n.kind==="player"?xC(n,i,"touch",n.id):n.collision===Gi.ISBULLET?xC(n,i,"shot",void 0):xC(n,i,"bump",void 0);const s=CT(t,i);return i.destructible??(s==null?void 0:s.destructible)?(he(i==null?void 0:i.id)?EE(_e.book,_e.board,i,_e.timestamp):ZA(e,{x:r.x,y:r.y}),!0):!1}return!0}function nxe(t,e,n,r,i=lye){var d;if(!he(t)||!he(e)||!he(n))return;const s={..._e};_e.book=t,_e.board=e,_e.element=n,_e.elementid=n.id??"",_e.elementisplayer=CG(_e.elementid);const o=_e.element.player??Eg.operator;_e.elementfocus=_e.elementisplayer?_e.elementid:o;const a=CT(t,n),c=n.cycle??(a==null?void 0:a.cycle)??i,l=n.id??"",u=rr(n.name??((d=n.kinddata)==null?void 0:d.name)??"");if(eK.tick(l,gB.RUNTIME,Mn(c)?c:i,u,r),Mn(n==null?void 0:n.tickertime)&&_e.timestamp-n.tickertime>RW*5&&(n.tickertime=0,n.tickertext=""),_e.elementisplayer){const h=Uw(_e.elementid);Mn(h.inputcurrent)&&(h.inputcurrent=0)}gG(s).forEach(h=>{_e[h]=s[h]})}function rK(t,e){const n=Pb("main");if(!he(n))return;function r(a,c){for(let l=0;l<a.length;++l){const u=a[l];if(he(u.id)){const d=`${Z7(u.id)}:${c}`;qe.emit(d,e)}}}const{target:i,path:s}=MA(t),o=Aye(n);for(let a=0;a<o.length;++a){const c=o[a];switch(rr(i)){case"all":case"self":case"others":{r(Object.values(c.objects),s);break}default:{r(oW(c,[i]),s);break}}}}function TR(t){var o;const e=Yv("main"),n=xT(e,t);if(!he(e)||!he(n)||!he(_e.element))return;const r=`${t}_run`,i=rr(_e.element.name??((o=_e.element.kinddata)==null?void 0:o.name)??""),s=(n==null?void 0:n.code)??"";eK.once(r,gB.RUNTIME,i,s)}function Qa(t){var r,i,s,o,a;const e=_e.words[t],n=t+1;if(TW(e)){const[c,l]=p1(t);if(he(c))return[c,l]}if(sye(e)){const[c,l]=CW(t);if(he(c))return[c,l]}if(yB(e)){const[c,l]=xR(t);if(he(c))return[c,l]}if(Yn(e)&&rr(e)==="rnd"){const[c,l]=Qa(n),[u,d]=Qa(l);return Mn(c)&&Mn(u)?[Fv(c,u),d]:Mn(c)?[Fv(0,c),l]:[Fv(0,1),n]}if(tW(e)){const[c,l]=LL(t);if(he(c))return[c,l]}if(!he(e))return[void 0,t];if(Mn(e)||Lr(e))return[e,n];if(Yn(e)){const c=rr(e),l=(r=_e.get)==null?void 0:r.call(_e,e);if(he(l))return[l,n];switch(c){case"aligned":case"alligned":{const u=dR(_e.board,_e.element,_e.elementfocus);return!he(_e.element)||!he(u)?[0,n]:[_e.element.x===u.x||_e.element.y===u.y?1:0,n]}case"contact":{const u=dR(_e.board,_e.element,_e.elementfocus);if(!he(_e.element)||!he(u))return[0,n];const d=(u.x??0)-(((i=_e.element)==null?void 0:i.x)??0),h=(u.y??0)-(((s=_e.element)==null?void 0:s.y)??0);return[d===0&&Math.abs(h)<2||h===0&&Math.abs(d)<2?1:0,n]}case"blocked":{const[u,d]=Mt(_e.words,n,[lt.DIR]);return[Mye(_e.book,_e.board,_e.element,u)?1:0,d]}case"any":{const[u,d]=Mt(_e.words,n,[lt.KIND]),h=uR(u)??"",f=bT(_e.board,h);return[sW(f,u).length?1:0,d]}case"rnd":return[Fv(0,1),n];case"abs":{const[u,d]=Mt(_e.words,n,[lt.NUMBER]);return[Math.abs(u),d]}case"ceil":{const[u,d]=Mt(_e.words,n,[lt.NUMBER]);return[Math.ceil(u),d]}case"floor":{const[u,d]=Mt(_e.words,n,[lt.NUMBER]);return[Math.floor(u),d]}case"round":{const[u,d]=Mt(_e.words,n,[lt.NUMBER]);return[Math.round(u),d]}case"clamp":{const[u,d,h,f]=Mt(_e.words,n,[lt.NUMBER,lt.NUMBER,lt.NUMBER]);return[xi(u,d,h),f]}case"min":{const u=[];for(let d=n;d<_e.words.length;){const[h,f]=Qa(d);Lr(h)&&!kh(h)&&!op(h)&&!qm(h)&&!tu(h)&&u.push(...h),d=f,u.push(h)}return[Math.min(...u),_e.words.length]}case"max":{const u=[];for(let d=n;d<_e.words.length;){const[h,f]=Qa(d);Lr(h)&&!kh(h)&&!op(h)&&!qm(h)&&!tu(h)&&u.push(...h),d=f,u.push(h)}return[Math.max(...u),_e.words.length]}case"pick":{const u=[];for(let d=n;d<_e.words.length;){const[h,f]=Qa(d);Lr(h)&&!kh(h)&&!op(h)&&!qm(h)&&!tu(h)&&u.push(...h),d=f,u.push(h)}return[Hu(u),_e.words.length]}case"pickwith":{const u=[],[d,h]=Mt(_e.words,n,[lt.NUMBER_OR_STRING]);for(let f=h;f<_e.words.length;){const[p,g]=Qa(f);Lr(p)&&!kh(p)&&!op(p)&&!qm(p)&&!tu(p)&&u.push(...p),f=g,u.push(p)}return[Jq(`${d}`,u),_e.words.length]}case"random":{const[u,d,h]=Mt(_e.words,n,[lt.NUMBER,lt.MAYBE_NUMBER]);return[Fv(u,d??0),h]}case"randomwith":{const[u,d,h,f]=Mt(_e.words,n,[lt.NUMBER_OR_STRING,lt.NUMBER,lt.MAYBE_NUMBER]);return[fG(`${u}`,d,h??0),f]}case"run":{const[u,d]=Mt(_e.words,n,[lt.NAME]);return TR(u),[(o=_e.get)==null?void 0:o.call(_e,"arg"),d]}case"runwith":{const[u,d,h]=Mt(_e.words,n,[lt.ANY,lt.NAME]);return he(_e.element)&&(_e.element.arg=u),TR(d),[(a=_e.get)==null?void 0:a.call(_e,"arg"),h]}}}return[e,n]}function rxe(t){return he(t)&&t<cr.ONBLACK?t:void 0}function ixe(t){return he(t)&&t>cr.WHITE&&t<cr.ONCLEAR?t-cr.ONBLACK:void 0}const mM={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR"};function tu(t){return Lr(t)&&iK(t[0])}function O5(t){return tu(t)&&t[0].startsWith("ON")}function iK(t){return he(cr[t])&&Yn(t)}function yB(t){if(Yn(t))return mM[rr(t)]}function sK(t){return t.map(e=>cr[e]).find(e=>he(e)&&e<cr.ONBLACK)}function sxe(t){return t.map(e=>cr[e]).find(e=>he(e)&&e>=cr.ONBLACK)}function k5(t){if(tu(t))return t;if(iK(t))return[t];const e=yB(t);if(he(e))return[e]}function N5(t){const e=_e.words[t],n=k5(e);if(tu(n))return[n,t+1];const[r,i]=Qa(t),s=k5(r);return tu(s)?[s,i]:[void 0,t]}function xR(t){const e=[];let n=t;const[r,i]=N5(t);if(tu(r)&&(e.push(...r),n=i),tu(e)&&!O5(e)){const[s,o]=N5(i);O5(s)&&(n=o)}return e.length?[e,n]:[void 0,t]}function oK(t){const e={};return t.every(n=>{const r=cr[n];he(r)&&(r<cr.ONBLACK?e.color=r:e.bg=r-cr.ONBLACK)}),e}const oxe=PF(32,126).map(t=>String.fromCharCode(t)),axe=Yu({name:"Whitespace",pattern:/ +/}),cxe=Yu({name:"WhitespaceSkipped",pattern:/ +/,group:Na.SKIPPED}),bB=Yu({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),EB=Yu({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:oxe}),SB=Yu({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),wB=Yu({name:"EscapedDollar",pattern:"$$"}),TB=Yu({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/}),xB=Yu({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),CB=Yu({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function lxe(t,e=""){return Yu({name:e||t,pattern:new RegExp(t.toLowerCase(),"i")})}const uxe=Object.keys(mM),aK=uxe.map(t=>lxe(`\\$(${t})`,t)),dxe=[axe,bB,...aK,SB,EB,xB,wB,CB,TB],hxe=new Na(dxe,{skipValidations:!fp,ensureOptimizations:fp}),fxe=new Na([cxe,bB,...aK,SB,EB,xB,wB,CB,TB],{skipValidations:!fp,ensureOptimizations:fp});function gM(t,e=!1){return e?fxe.tokenize(t):hxe.tokenize(t)}function yy(t,e,n,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:n,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:t,height:e,char:[],color:[],bg:[],changed(){}}}function vM(t){t.active={...t.reset}}function RB(t,e){const n=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<t.length;++a){const c=t[a];switch(c.tokenType){case wB:s("$");break;case xB:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case SB:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case bB:{e.x=e.active.leftedge??0,++e.y;break}default:{const l=c.tokenType.name,u=mM[l],d=rxe(cr[u]),h=ixe(cr[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):he(d)?e.active.color=d:he(h)?e.active.bg=h:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(he(e.writefullwidth)&&(e.x>o||e.y===n)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){vM(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;Fw(u,u+l.length,e.active.color,e.active.bg,e),yM(u,l,e)}}}function qn(t,e,n){const r=gM(t);r.tokens&&(RB(r.tokens,e),n&&vM(e),e.changed())}function _M(t,e,n){const r=gM(t);if(!r.tokens)return;const i=yy(e,n,cr.WHITE,cr.BLACK);return i.measureonly=!0,RB(r.tokens,i),i.x>0&&++i.y,i}function yM(t,e,n){let r=0;const i=t+e.length;for(let s=t;s<i;++s)n.char[s]=e.charCodeAt(r++);n.changed()}function Fw(t,e,n,r,i){const s=Math.min(t,e),o=Math.max(t,e);for(let a=s;a<=o;++a)i.color[a]=n,i.bg[a]=r;i.changed()}function cK(t,e,n){const r=yT(EB,t,0,0,0,0,0,0);RB([r],e),n&&vM(e),e.changed()}function pxe(t,e,n,r,i){i.active.topedge=t,i.active.leftedge=e,i.active.rightedge=n,i.active.bottomedge=r}function Jh(t){const e=t.reset.leftedge??0,n=t.reset.rightedge??t.width-1,r=t.reset.topedge??0,i=t.reset.bottomedge??t.height-1,s=n-e+1,o=i-r+1;return{left:e,right:n,top:r,bottom:i,width:s,height:o}}const P5=t=>{let e;const n=new Set,r=(l,u)=>{const d=typeof l=="function"?l(e):l;if(!Object.is(d,e)){const h=e;e=u??(typeof d!="object"||d===null)?d:Object.assign({},e,d),n.forEach(f=>f(e,h))}},i=()=>e,a={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(n.add(l),()=>n.delete(l))},c=e=t(r,i,a);return a},AB=t=>t?P5(t):P5,mxe=t=>t;function MB(t,e=mxe){const n=Ph.useSyncExternalStore(t.subscribe,()=>e(t.getState()),()=>e(t.getInitialState()));return Ph.useDebugValue(n),n}const D5=t=>{const e=AB(t),n=r=>MB(e,r);return Object.assign(n,e),n},R_=t=>t?D5(t):D5;function CR(t,e=16){return t?PF(e-1).map(n=>{const r=n*_E;return new bi(t.bits[r]/63,t.bits[r+1]/63,t.bits[r+2]/63)}):[]}function gxe(t){return t.generateMipmaps=!1,t.minFilter=Bo,t.magFilter=Bo,t.needsUpdate=!0,t}function iw(t){if(he(t))return gxe(new Qae(uye(t)))}const Iv=ft.createContext(yy(1,1,15,1));function Qh(){return ft.useContext(Iv)}const lK=R_(()=>({blink:!1}));setInterval(()=>{lK.setState(t=>({blink:!t.blink}))},333);function Fd(){return lK(t=>t.blink)}function uK(){return AB(t=>{function e(){t(n=>({render:n.render+1}))}return{dither:[],render:0,changed(){queueMicrotask(e)}}})}function vxe(t){t.fill(0)}function fP(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return-1;t[r+i*e]=s}const dK=ft.createContext(uK());function _xe(t,e,n){const[r]=ft.useState(()=>uK()),i=t*e,s=r.getState();return s.dither.length!==i&&(s.dither=new Array(i).fill(n),s.render=0),r}function hK(){return AB(t=>{function e(){t(n=>({render:n.render+1}))}return{width:0,height:0,char:[],color:[],bg:[],render:0,changed(){queueMicrotask(e)}}})}function fK(t,e,n,r){t.char.fill(e),t.color.fill(n),t.bg.fill(r)}function ca(t,e,n,r,i,s){if(r<0||r>=e||i<0||i>=n)return;const o=r+i*e;gG(s).forEach(a=>{const c=s[a];he(c)&&(t[a][o]=c)})}const IB=ft.createContext(hK());function bM(t,e,n,r,i){const[s]=ft.useState(()=>hK()),o=t*e,a=s.getState();return a.char.length!==o&&(a.width=t,a.height=e,a.char=new Array(o).fill(n),a.color=new Array(o).fill(r),a.bg=new Array(o).fill(i),a.render=0),s}function pK(){return ft.useContext(IB).getState()}const L5=wT(OA),U5=TT(IA),U0=R_(t=>({palette:L5,charset:U5,palettedata:CR(L5),charsetdata:iw(U5),setpalette(e){t(n=>ZS(n.palette,e)?n:{...n,palette:e,palettedata:CR(e)})},setcharset(e){t(n=>ZS(n.charset,e)?n:{...n,charset:e,charsetdata:iw(e)})},setaltcharset(e){t(n=>ZS(n.altcharset,e)?n:{...n,altcharset:e,altcharsetdata:iw(e)})}})),nu=R_(()=>({insetcols:20,insetrows:20,islowrez:!1,islandscape:!0,sidebaropen:!0,showkeyboard:!1,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!1,showtouchcontrols:!1}));function Tl(t,e){function n(r){ci(t,"crash",r.message)}e().catch(n)}function Zr(t,e,n){return t.namespaceURI&&t.namespaceURI!=="http://www.w3.org/1999/xhtml"||(e=Array.isArray(e)?e:[e],!e.includes(t.tagName.toLowerCase()))?!1:n?Object.entries(n).every(([r,i])=>t[r]===i):!0}function Bd(t){var e;if(yxe(t)&&t.defaultView)return t.defaultView;if(!((e=t.ownerDocument)===null||e===void 0)&&e.defaultView)return t.ownerDocument.defaultView;throw new Error(`Could not determine window of node. Node was ${bxe(t)}`)}function yxe(t){return t.nodeType===9}function bxe(t){return typeof t=="function"?`function ${t.name}`:t===null?"null":String(t)}function mK(t,e){return new Promise((n,r)=>{const i=new e;i.onerror=r,i.onabort=r,i.onload=()=>{n(String(i.result))},i.readAsText(t)})}function OB(t,e){const n={...e,length:e.length,item:r=>n[r],[Symbol.iterator]:function*(){for(let i=0;i<n.length;i++)yield n[i]}};return n.constructor=t.FileList,t.FileList&&Object.setPrototypeOf(n,t.FileList.prototype),Object.freeze(n),n}function zv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class gK{getAsFile(){return this.file}getAsString(e){typeof this.data=="string"&&e(this.data)}webkitGetAsEntry(){throw new Error("not implemented")}constructor(e,n){zv(this,"kind",void 0),zv(this,"type",void 0),zv(this,"file",null),zv(this,"data",void 0),typeof e=="string"?(this.kind="string",this.type=String(n),this.data=e):(this.kind="file",this.type=e.type,this.file=e)}}class Exe extends Array{add(...e){const n=new gK(e[0],e[1]);return this.push(n),n}clear(){this.splice(0,this.length)}remove(e){this.splice(e,1)}}function CC(t,e){const[n,r]=t.split("/"),i=!r||r==="*";return s=>e?s.type===(i?n:t):i?s.type.startsWith(`${n}/`):s.type===n}function Sxe(t){return new class{getData(n){var r;const i=(r=this.items.find(CC(n,!0)))!==null&&r!==void 0?r:this.items.find(CC(n,!1));let s="";return i==null||i.getAsString(o=>{s=o}),s}setData(n,r){const i=this.items.findIndex(CC(n,!0)),s=new gK(r,n);i>=0?this.items.splice(i,1,s):this.items.push(s)}clearData(n){if(n){const r=this.items.findIndex(CC(n,!0));r>=0&&this.items.remove(r)}else this.items.clear()}get types(){const n=[];return this.files.length&&n.push("Files"),this.items.forEach(r=>n.push(r.type)),Object.freeze(n),n}setDragImage(){}constructor(){zv(this,"dropEffect","none"),zv(this,"effectAllowed","uninitialized"),zv(this,"items",new Exe),zv(this,"files",OB(t,[]))}}}function kB(t,e=[]){const n=typeof t.DataTransfer>"u"?Sxe(t):new t.DataTransfer;return Object.defineProperty(n,"files",{get:()=>OB(t,e)}),n}async function wxe(t,e){return e.kind==="file"?e.getAsFile():new t.Blob([await new Promise(n=>e.getAsString(n))],{type:e.type})}function vK(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _K(t,...e){const n=Object.fromEntries(e.map(r=>[typeof r=="string"?"text/plain":r.type,Promise.resolve(r)]));return typeof t.ClipboardItem<"u"?new t.ClipboardItem(n):new class{get types(){return Array.from(Object.keys(this.data))}async getType(i){const s=await this.data[i];if(!s)throw new Error(`${i} is not one of the available MIME types on this item.`);return s instanceof t.Blob?s:new t.Blob([s],{type:i})}constructor(i){vK(this,"data",void 0),this.data=i}}(n)}const ME=Symbol("Manage ClipboardSub");function F5(t,e){return Object.assign(new class extends t.EventTarget{async read(){return Array.from(this.items)}async readText(){let r="";for(const i of this.items){const s=i.types.includes("text/plain")?"text/plain":i.types.find(o=>o.startsWith("text/"));s&&(r+=await i.getType(s).then(o=>mK(o,t.FileReader)))}return r}async write(r){this.items=r}async writeText(r){this.items=[_K(t,r)]}constructor(...r){super(...r),vK(this,"items",[])}},{[ME]:e})}function NB(t){return!!(t!=null&&t[ME])}function Txe(t){if(NB(t.navigator.clipboard))return t.navigator.clipboard[ME];const e=Object.getOwnPropertyDescriptor(t.navigator,"clipboard");let n;const r={resetClipboardStub:()=>{n=F5(t,r)},detachClipboardStub:()=>{e?Object.defineProperty(t.navigator,"clipboard",e):Object.defineProperty(t.navigator,"clipboard",{value:void 0,configurable:!0})}};return n=F5(t,r),Object.defineProperty(t.navigator,"clipboard",{get:()=>n,configurable:!0}),n[ME]}function xxe(t){NB(t.navigator.clipboard)&&t.navigator.clipboard[ME].resetClipboardStub()}function Cxe(t){NB(t.navigator.clipboard)&&t.navigator.clipboard[ME].detachClipboardStub()}async function Rxe(t){const e=t.defaultView,n=e==null?void 0:e.navigator.clipboard,r=n&&await n.read();if(!r)throw new Error("The Clipboard API is unavailable.");const i=kB(e);for(const s of r)for(const o of s.types)i.setData(o,await s.getType(o).then(a=>mK(a,e.FileReader)));return i}async function yK(t,e){const n=Bd(t),r=n.navigator.clipboard,i=[];for(let o=0;o<e.items.length;o++){const a=e.items[o],c=await wxe(n,a);i.push(_K(n,c))}if(!(r&&await r.write(i).then(()=>!0,()=>!1)))throw new Error("The Clipboard API is unavailable.")}const RR=globalThis;typeof RR.afterEach=="function"&&RR.afterEach(()=>xxe(globalThis.window));typeof RR.afterAll=="function"&&RR.afterAll(()=>Cxe(globalThis.window));const bK=["input:not([type=hidden]):not([disabled])","button:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[contenteditable=""]','[contenteditable="true"]',"a[href]","[tabindex]:not([disabled])"].join(", ");function PB(t){return t.matches(bK)}function Axe(t){return new t.constructor(t.type,t)}function cg(t){for(let n=t;n;n=n.parentElement)if(Zr(n,["button","input","select","textarea","optgroup","option"])){if(n.hasAttribute("disabled"))return!0}else if(Zr(n,"fieldset")){var e;if(n.hasAttribute("disabled")&&!(!((e=n.querySelector(":scope > legend"))===null||e===void 0)&&e.contains(t)))return!0}else if(n.tagName.includes("-")&&n.constructor.formAssociated&&n.hasAttribute("disabled"))return!0;return!1}function BT(t){const e=t.activeElement;return e!=null&&e.shadowRoot?BT(e.shadowRoot):cg(e)?t.ownerDocument?t.ownerDocument.body:t.body:e}function pP(t){var e;return(e=BT(t))!==null&&e!==void 0?e:t.body}function Mxe(t,e){let n=t;do{if(e(n))return n;n=n.parentElement}while(n&&n!==t.ownerDocument.body)}function ey(t){return t.hasAttribute("contenteditable")&&(t.getAttribute("contenteditable")=="true"||t.getAttribute("contenteditable")=="")}function Bw(t){const e=Ixe(t);return e&&(e.closest('[contenteditable=""]')||e.closest('[contenteditable="true"]'))}function Ixe(t){return t.nodeType===1?t:t.parentElement}var EK=function(t){return t.button="button",t.color="color",t.file="file",t.image="image",t.reset="reset",t.submit="submit",t.checkbox="checkbox",t.radio="radio",t}(EK||{});function SK(t){return Zr(t,"button")||Zr(t,"input")&&t.type in EK}function IE(t){return TK(t)&&!t.readOnly||ey(t)}var wK=function(t){return t.text="text",t.date="date",t["datetime-local"]="datetime-local",t.email="email",t.month="month",t.number="number",t.password="password",t.search="search",t.tel="tel",t.time="time",t.url="url",t.week="week",t}(wK||{});function TK(t){return Zr(t,"textarea")||Zr(t,"input")&&t.type in wK}function Op(t){return xK(t)&&TK(t)}function Oxe(t){return xK(t)&&SK(t)}function xK(t){return t.nodeType===1}function kxe(t){const e=t.ownerDocument.getSelection();if(e!=null&&e.focusNode&&Op(t)){const r=Bw(e.focusNode);if(r){if(!e.isCollapsed){var n;const i=((n=r.firstChild)===null||n===void 0?void 0:n.nodeType)===3?r.firstChild:r;e.setBaseAndExtent(i,0,i,0)}}else e.setBaseAndExtent(t,0,t,0)}}var m_={},DB={exports:{}};DB.exports;(function(t){const n=(s=0)=>o=>`\x1B[${38+s};5;${o}m`,r=(s=0)=>(o,a,c)=>`\x1B[${38+s};2;${o};${a};${c}m`;function i(){const s=new Map,o={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};o.color.gray=o.color.blackBright,o.bgColor.bgGray=o.bgColor.bgBlackBright,o.color.grey=o.color.blackBright,o.bgColor.bgGrey=o.bgColor.bgBlackBright;for(const[a,c]of Object.entries(o)){for(const[l,u]of Object.entries(c))o[l]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},c[l]=o[l],s.set(u[0],u[1]);Object.defineProperty(o,a,{value:c,enumerable:!1})}return Object.defineProperty(o,"codes",{value:s,enumerable:!1}),o.color.close="\x1B[39m",o.bgColor.close="\x1B[49m",o.color.ansi256=n(),o.color.ansi16m=r(),o.bgColor.ansi256=n(10),o.bgColor.ansi16m=r(10),Object.defineProperties(o,{rgbToAnsi256:{value:(a,c,l)=>a===c&&c===l?a<8?16:a>248?231:Math.round((a-8)/247*24)+232:16+36*Math.round(a/255*5)+6*Math.round(c/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:a=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(a.toString(16));if(!c)return[0,0,0];let{colorString:l}=c.groups;l.length===3&&(l=l.split("").map(d=>d+d).join(""));const u=Number.parseInt(l,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:a=>o.rgbToAnsi256(...o.hexToRgb(a)),enumerable:!1}}),o}Object.defineProperty(t,"exports",{enumerable:!0,get:i})})(DB);var CK=DB.exports,Sg={};Object.defineProperty(Sg,"__esModule",{value:!0});Sg.printIteratorEntries=Pxe;Sg.printIteratorValues=Dxe;Sg.printListItems=Lxe;Sg.printObjectProperties=Uxe;const Nxe=(t,e)=>{const n=Object.keys(t).sort(e);return Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r=>{Object.getOwnPropertyDescriptor(t,r).enumerable&&n.push(r)}),n};function Pxe(t,e,n,r,i,s,o=": "){let a="",c=t.next();if(!c.done){a+=e.spacingOuter;const l=n+e.indent;for(;!c.done;){const u=s(c.value[0],e,l,r,i),d=s(c.value[1],e,l,r,i);a+=l+u+o+d,c=t.next(),c.done?e.min||(a+=","):a+=","+e.spacingInner}a+=e.spacingOuter+n}return a}function Dxe(t,e,n,r,i,s){let o="",a=t.next();if(!a.done){o+=e.spacingOuter;const c=n+e.indent;for(;!a.done;)o+=c+s(a.value,e,c,r,i),a=t.next(),a.done?e.min||(o+=","):o+=","+e.spacingInner;o+=e.spacingOuter+n}return o}function Lxe(t,e,n,r,i,s){let o="";if(t.length){o+=e.spacingOuter;const a=n+e.indent;for(let c=0;c<t.length;c++)o+=a,c in t&&(o+=s(t[c],e,a,r,i)),c<t.length-1?o+=","+e.spacingInner:e.min||(o+=",");o+=e.spacingOuter+n}return o}function Uxe(t,e,n,r,i,s){let o="";const a=Nxe(t,e.compareKeys);if(a.length){o+=e.spacingOuter;const c=n+e.indent;for(let l=0;l<a.length;l++){const u=a[l],d=s(u,e,c,r,i),h=s(t[u],e,c,r,i);o+=c+d+": "+h,l<a.length-1?o+=","+e.spacingInner:e.min||(o+=",")}o+=e.spacingOuter+n}return o}var Xv={};Object.defineProperty(Xv,"__esModule",{value:!0});Xv.test=Xv.serialize=Xv.default=void 0;var B5=Sg,AR=function(){return typeof globalThis<"u"?globalThis:typeof AR<"u"?AR:typeof self<"u"?self:typeof window<"u"?window:Function("return this")()}(),mP=AR["jest-symbol-do-not-touch"]||AR.Symbol;const Fxe=typeof mP=="function"&&mP.for?mP.for("jest.asymmetricMatcher"):1267621,RC=" ",RK=(t,e,n,r,i,s)=>{const o=t.toString();return o==="ArrayContaining"||o==="ArrayNotContaining"?++r>e.maxDepth?"["+o+"]":o+RC+"["+(0,B5.printListItems)(t.sample,e,n,r,i,s)+"]":o==="ObjectContaining"||o==="ObjectNotContaining"?++r>e.maxDepth?"["+o+"]":o+RC+"{"+(0,B5.printObjectProperties)(t.sample,e,n,r,i,s)+"}":o==="StringMatching"||o==="StringNotMatching"||o==="StringContaining"||o==="StringNotContaining"?o+RC+s(t.sample,e,n,r,i):t.toAsymmetricMatcher()};Xv.serialize=RK;const AK=t=>t&&t.$$typeof===Fxe;Xv.test=AK;const Bxe={serialize:RK,test:AK};var jxe=Bxe;Xv.default=jxe;var Jv={},$xe=({onlyFirst:t=!1}={})=>{const e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,t?void 0:"g")};Object.defineProperty(Jv,"__esModule",{value:!0});Jv.test=Jv.serialize=Jv.default=void 0;var MK=IK($xe),ys=IK(CK);function IK(t){return t&&t.__esModule?t:{default:t}}const Hxe=t=>t.replace((0,MK.default)(),e=>{switch(e){case ys.default.red.close:case ys.default.green.close:case ys.default.cyan.close:case ys.default.gray.close:case ys.default.white.close:case ys.default.yellow.close:case ys.default.bgRed.close:case ys.default.bgGreen.close:case ys.default.bgYellow.close:case ys.default.inverse.close:case ys.default.dim.close:case ys.default.bold.close:case ys.default.reset.open:case ys.default.reset.close:return"</>";case ys.default.red.open:return"<red>";case ys.default.green.open:return"<green>";case ys.default.cyan.open:return"<cyan>";case ys.default.gray.open:return"<gray>";case ys.default.white.open:return"<white>";case ys.default.yellow.open:return"<yellow>";case ys.default.bgRed.open:return"<bgRed>";case ys.default.bgGreen.open:return"<bgGreen>";case ys.default.bgYellow.open:return"<bgYellow>";case ys.default.inverse.open:return"<inverse>";case ys.default.dim.open:return"<dim>";case ys.default.bold.open:return"<bold>";default:return""}}),OK=t=>typeof t=="string"&&!!t.match((0,MK.default)());Jv.test=OK;const kK=(t,e,n,r,i,s)=>s(Hxe(t),e,n,r,i);Jv.serialize=kK;const Vxe={serialize:kK,test:OK};var zxe=Vxe;Jv.default=zxe;var Qv={};Object.defineProperty(Qv,"__esModule",{value:!0});Qv.test=Qv.serialize=Qv.default=void 0;var j5=Sg;const Gxe=" ",NK=["DOMStringMap","NamedNodeMap"],qxe=/^(HTML\w*Collection|NodeList)$/,Wxe=t=>NK.indexOf(t)!==-1||qxe.test(t),PK=t=>t&&t.constructor&&!!t.constructor.name&&Wxe(t.constructor.name);Qv.test=PK;const Kxe=t=>t.constructor.name==="NamedNodeMap",DK=(t,e,n,r,i,s)=>{const o=t.constructor.name;return++r>e.maxDepth?"["+o+"]":(e.min?"":o+Gxe)+(NK.indexOf(o)!==-1?"{"+(0,j5.printObjectProperties)(Kxe(t)?Array.from(t).reduce((a,c)=>(a[c.name]=c.value,a),{}):{...t},e,n,r,i,s)+"}":"["+(0,j5.printListItems)(Array.from(t),e,n,r,i,s)+"]")};Qv.serialize=DK;const Yxe={serialize:DK,test:PK};var Xxe=Yxe;Qv.default=Xxe;var Zv={},Hc={},LB={};Object.defineProperty(LB,"__esModule",{value:!0});LB.default=Jxe;function Jxe(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}Object.defineProperty(Hc,"__esModule",{value:!0});Hc.printText=Hc.printProps=Hc.printElementAsLeaf=Hc.printElement=Hc.printComment=Hc.printChildren=void 0;var LK=Qxe(LB);function Qxe(t){return t&&t.__esModule?t:{default:t}}const Zxe=(t,e,n,r,i,s,o)=>{const a=r+n.indent,c=n.colors;return t.map(l=>{const u=e[l];let d=o(u,n,a,i,s);return typeof u!="string"&&(d.indexOf(`
`)!==-1&&(d=n.spacingOuter+a+d+n.spacingOuter+r),d="{"+d+"}"),n.spacingInner+r+c.prop.open+l+c.prop.close+"="+c.value.open+d+c.value.close}).join("")};Hc.printProps=Zxe;const eCe=(t,e,n,r,i,s)=>t.map(o=>e.spacingOuter+n+(typeof o=="string"?UK(o,e):s(o,e,n,r,i))).join("");Hc.printChildren=eCe;const UK=(t,e)=>{const n=e.colors.content;return n.open+(0,LK.default)(t)+n.close};Hc.printText=UK;const tCe=(t,e)=>{const n=e.colors.comment;return n.open+"<!--"+(0,LK.default)(t)+"-->"+n.close};Hc.printComment=tCe;const nCe=(t,e,n,r,i)=>{const s=r.colors.tag;return s.open+"<"+t+(e&&s.close+e+r.spacingOuter+i+s.open)+(n?">"+s.close+n+r.spacingOuter+i+s.open+"</"+t:(e&&!r.min?"":" ")+"/")+">"+s.close};Hc.printElement=nCe;const rCe=(t,e)=>{const n=e.colors.tag;return n.open+"<"+t+n.close+" "+n.open+" />"+n.close};Hc.printElementAsLeaf=rCe;Object.defineProperty(Zv,"__esModule",{value:!0});Zv.test=Zv.serialize=Zv.default=void 0;var hb=Hc;const iCe=1,FK=3,BK=8,jK=11,sCe=/^((HTML|SVG)\w*)?Element$/,oCe=t=>{try{return typeof t.hasAttribute=="function"&&t.hasAttribute("is")}catch{return!1}},aCe=t=>{const e=t.constructor.name,{nodeType:n,tagName:r}=t,i=typeof r=="string"&&r.includes("-")||oCe(t);return n===iCe&&(sCe.test(e)||i)||n===FK&&e==="Text"||n===BK&&e==="Comment"||n===jK&&e==="DocumentFragment"},$K=t=>{var e;return(t==null||(e=t.constructor)===null||e===void 0?void 0:e.name)&&aCe(t)};Zv.test=$K;function cCe(t){return t.nodeType===FK}function lCe(t){return t.nodeType===BK}function gP(t){return t.nodeType===jK}const HK=(t,e,n,r,i,s)=>{if(cCe(t))return(0,hb.printText)(t.data,e);if(lCe(t))return(0,hb.printComment)(t.data,e);const o=gP(t)?"DocumentFragment":t.tagName.toLowerCase();return++r>e.maxDepth?(0,hb.printElementAsLeaf)(o,e):(0,hb.printElement)(o,(0,hb.printProps)(gP(t)?[]:Array.from(t.attributes).map(a=>a.name).sort(),gP(t)?{}:Array.from(t.attributes).reduce((a,c)=>(a[c.name]=c.value,a),{}),e,n+e.indent,r,i,s),(0,hb.printChildren)(Array.prototype.slice.call(t.childNodes||t.children),e,n+e.indent,r,i,s),e,n)};Zv.serialize=HK;const uCe={serialize:HK,test:$K};var dCe=uCe;Zv.default=dCe;var e_={};Object.defineProperty(e_,"__esModule",{value:!0});e_.test=e_.serialize=e_.default=void 0;var jw=Sg;const hCe="@@__IMMUTABLE_ITERABLE__@@",fCe="@@__IMMUTABLE_LIST__@@",pCe="@@__IMMUTABLE_KEYED__@@",mCe="@@__IMMUTABLE_MAP__@@",$5="@@__IMMUTABLE_ORDERED__@@",gCe="@@__IMMUTABLE_RECORD__@@",vCe="@@__IMMUTABLE_SEQ__@@",_Ce="@@__IMMUTABLE_SET__@@",yCe="@@__IMMUTABLE_STACK__@@",OE=t=>"Immutable."+t,EM=t=>"["+t+"]",$w=" ",H5="",bCe=(t,e,n,r,i,s,o)=>++r>e.maxDepth?EM(OE(o)):OE(o)+$w+"{"+(0,jw.printIteratorEntries)(t.entries(),e,n,r,i,s)+"}";function ECe(t){let e=0;return{next(){if(e<t._keys.length){const n=t._keys[e++];return{done:!1,value:[n,t.get(n)]}}return{done:!0,value:void 0}}}}const SCe=(t,e,n,r,i,s)=>{const o=OE(t._name||"Record");return++r>e.maxDepth?EM(o):o+$w+"{"+(0,jw.printIteratorEntries)(ECe(t),e,n,r,i,s)+"}"},wCe=(t,e,n,r,i,s)=>{const o=OE("Seq");return++r>e.maxDepth?EM(o):t[pCe]?o+$w+"{"+(t._iter||t._object?(0,jw.printIteratorEntries)(t.entries(),e,n,r,i,s):H5)+"}":o+$w+"["+(t._iter||t._array||t._collection||t._iterable?(0,jw.printIteratorValues)(t.values(),e,n,r,i,s):H5)+"]"},vP=(t,e,n,r,i,s,o)=>++r>e.maxDepth?EM(OE(o)):OE(o)+$w+"["+(0,jw.printIteratorValues)(t.values(),e,n,r,i,s)+"]",VK=(t,e,n,r,i,s)=>t[mCe]?bCe(t,e,n,r,i,s,t[$5]?"OrderedMap":"Map"):t[fCe]?vP(t,e,n,r,i,s,"List"):t[_Ce]?vP(t,e,n,r,i,s,t[$5]?"OrderedSet":"Set"):t[yCe]?vP(t,e,n,r,i,s,"Stack"):t[vCe]?wCe(t,e,n,r,i,s):SCe(t,e,n,r,i,s);e_.serialize=VK;const zK=t=>t&&(t[hCe]===!0||t[gCe]===!0);e_.test=zK;const TCe={serialize:VK,test:zK};var xCe=TCe;e_.default=xCe;var t_={},GK={exports:{}},us={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SM=60103,wM=60106,jT=60107,$T=60108,HT=60114,VT=60109,zT=60110,GT=60112,qT=60113,UB=60120,WT=60115,KT=60116,qK=60121,WK=60122,KK=60117,YK=60129,XK=60131;if(typeof Symbol=="function"&&Symbol.for){var bc=Symbol.for;SM=bc("react.element"),wM=bc("react.portal"),jT=bc("react.fragment"),$T=bc("react.strict_mode"),HT=bc("react.profiler"),VT=bc("react.provider"),zT=bc("react.context"),GT=bc("react.forward_ref"),qT=bc("react.suspense"),UB=bc("react.suspense_list"),WT=bc("react.memo"),KT=bc("react.lazy"),qK=bc("react.block"),WK=bc("react.server.block"),KK=bc("react.fundamental"),YK=bc("react.debug_trace_mode"),XK=bc("react.legacy_hidden")}function Zh(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case SM:switch(t=t.type,t){case jT:case HT:case $T:case qT:case UB:return t;default:switch(t=t&&t.$$typeof,t){case zT:case GT:case KT:case WT:case VT:return t;default:return e}}case wM:return e}}}var CCe=VT,RCe=SM,ACe=GT,MCe=jT,ICe=KT,OCe=WT,kCe=wM,NCe=HT,PCe=$T,DCe=qT;us.ContextConsumer=zT;us.ContextProvider=CCe;us.Element=RCe;us.ForwardRef=ACe;us.Fragment=MCe;us.Lazy=ICe;us.Memo=OCe;us.Portal=kCe;us.Profiler=NCe;us.StrictMode=PCe;us.Suspense=DCe;us.isAsyncMode=function(){return!1};us.isConcurrentMode=function(){return!1};us.isContextConsumer=function(t){return Zh(t)===zT};us.isContextProvider=function(t){return Zh(t)===VT};us.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===SM};us.isForwardRef=function(t){return Zh(t)===GT};us.isFragment=function(t){return Zh(t)===jT};us.isLazy=function(t){return Zh(t)===KT};us.isMemo=function(t){return Zh(t)===WT};us.isPortal=function(t){return Zh(t)===wM};us.isProfiler=function(t){return Zh(t)===HT};us.isStrictMode=function(t){return Zh(t)===$T};us.isSuspense=function(t){return Zh(t)===qT};us.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===jT||t===HT||t===YK||t===$T||t===qT||t===UB||t===XK||typeof t=="object"&&t!==null&&(t.$$typeof===KT||t.$$typeof===WT||t.$$typeof===VT||t.$$typeof===zT||t.$$typeof===GT||t.$$typeof===KK||t.$$typeof===qK||t[0]===WK)};us.typeOf=Zh;GK.exports=us;var LCe=GK.exports;Object.defineProperty(t_,"__esModule",{value:!0});t_.test=t_.serialize=t_.default=void 0;var y0=UCe(LCe),AC=Hc;function JK(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(JK=function(r){return r?n:e})(t)}function UCe(t,e){if(t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var n=JK(e);if(n&&n.has(t))return n.get(t);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var o=i?Object.getOwnPropertyDescriptor(t,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=t[s]}return r.default=t,n&&n.set(t,r),r}const QK=(t,e=[])=>(Array.isArray(t)?t.forEach(n=>{QK(n,e)}):t!=null&&t!==!1&&e.push(t),e),V5=t=>{const e=t.type;if(typeof e=="string")return e;if(typeof e=="function")return e.displayName||e.name||"Unknown";if(y0.isFragment(t))return"React.Fragment";if(y0.isSuspense(t))return"React.Suspense";if(typeof e=="object"&&e!==null){if(y0.isContextProvider(t))return"Context.Provider";if(y0.isContextConsumer(t))return"Context.Consumer";if(y0.isForwardRef(t)){if(e.displayName)return e.displayName;const n=e.render.displayName||e.render.name||"";return n!==""?"ForwardRef("+n+")":"ForwardRef"}if(y0.isMemo(t)){const n=e.displayName||e.type.displayName||e.type.name||"";return n!==""?"Memo("+n+")":"Memo"}}return"UNDEFINED"},FCe=t=>{const{props:e}=t;return Object.keys(e).filter(n=>n!=="children"&&e[n]!==void 0).sort()},ZK=(t,e,n,r,i,s)=>++r>e.maxDepth?(0,AC.printElementAsLeaf)(V5(t),e):(0,AC.printElement)(V5(t),(0,AC.printProps)(FCe(t),t.props,e,n+e.indent,r,i,s),(0,AC.printChildren)(QK(t.props.children),e,n+e.indent,r,i,s),e,n);t_.serialize=ZK;const eY=t=>t!=null&&y0.isElement(t);t_.test=eY;const BCe={serialize:ZK,test:eY};var jCe=BCe;t_.default=jCe;var n_={};Object.defineProperty(n_,"__esModule",{value:!0});n_.test=n_.serialize=n_.default=void 0;var MC=Hc,MR=function(){return typeof globalThis<"u"?globalThis:typeof MR<"u"?MR:typeof self<"u"?self:typeof window<"u"?window:Function("return this")()}(),_P=MR["jest-symbol-do-not-touch"]||MR.Symbol;const $Ce=typeof _P=="function"&&_P.for?_P.for("react.test.json"):245830487,HCe=t=>{const{props:e}=t;return e?Object.keys(e).filter(n=>e[n]!==void 0).sort():[]},tY=(t,e,n,r,i,s)=>++r>e.maxDepth?(0,MC.printElementAsLeaf)(t.type,e):(0,MC.printElement)(t.type,t.props?(0,MC.printProps)(HCe(t),t.props,e,n+e.indent,r,i,s):"",t.children?(0,MC.printChildren)(t.children,e,n+e.indent,r,i,s):"",e,n);n_.serialize=tY;const nY=t=>t&&t.$$typeof===$Ce;n_.test=nY;const VCe={serialize:tY,test:nY};var zCe=VCe;n_.default=zCe;Object.defineProperty(m_,"__esModule",{value:!0});m_.default=m_.DEFAULT_OPTIONS=void 0;var GCe=m_.format=pY,rY=m_.plugins=void 0,qCe=A_(CK),RS=Sg,WCe=A_(Xv),KCe=A_(Jv),YCe=A_(Qv),XCe=A_(Zv),JCe=A_(e_),QCe=A_(t_),ZCe=A_(n_);function A_(t){return t&&t.__esModule?t:{default:t}}const iY=Object.prototype.toString,e1e=Date.prototype.toISOString,t1e=Error.prototype.toString,z5=RegExp.prototype.toString,yP=t=>typeof t.constructor=="function"&&t.constructor.name||"Object",n1e=t=>typeof window<"u"&&t===window,r1e=/^Symbol\((.*)\)(.*)$/,i1e=/\n/gi;class sY extends Error{constructor(e,n){super(e),this.stack=n,this.name=this.constructor.name}}function s1e(t){return t==="[object Array]"||t==="[object ArrayBuffer]"||t==="[object DataView]"||t==="[object Float32Array]"||t==="[object Float64Array]"||t==="[object Int8Array]"||t==="[object Int16Array]"||t==="[object Int32Array]"||t==="[object Uint8Array]"||t==="[object Uint8ClampedArray]"||t==="[object Uint16Array]"||t==="[object Uint32Array]"}function o1e(t){return Object.is(t,-0)?"-0":String(t)}function a1e(t){return`${t}n`}function G5(t,e){return e?"[Function "+(t.name||"anonymous")+"]":"[Function]"}function q5(t){return String(t).replace(r1e,"Symbol($1)")}function W5(t){return"["+t1e.call(t)+"]"}function oY(t,e,n,r){if(t===!0||t===!1)return""+t;if(t===void 0)return"undefined";if(t===null)return"null";const i=typeof t;if(i==="number")return o1e(t);if(i==="bigint")return a1e(t);if(i==="string")return r?'"'+t.replace(/"|\\/g,"\\$&")+'"':'"'+t+'"';if(i==="function")return G5(t,e);if(i==="symbol")return q5(t);const s=iY.call(t);return s==="[object WeakMap]"?"WeakMap {}":s==="[object WeakSet]"?"WeakSet {}":s==="[object Function]"||s==="[object GeneratorFunction]"?G5(t,e):s==="[object Symbol]"?q5(t):s==="[object Date]"?isNaN(+t)?"Date { NaN }":e1e.call(t):s==="[object Error]"?W5(t):s==="[object RegExp]"?n?z5.call(t).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"):z5.call(t):t instanceof Error?W5(t):null}function aY(t,e,n,r,i,s){if(i.indexOf(t)!==-1)return"[Circular]";i=i.slice(),i.push(t);const o=++r>e.maxDepth,a=e.min;if(e.callToJSON&&!o&&t.toJSON&&typeof t.toJSON=="function"&&!s)return Ov(t.toJSON(),e,n,r,i,!0);const c=iY.call(t);return c==="[object Arguments]"?o?"[Arguments]":(a?"":"Arguments ")+"["+(0,RS.printListItems)(t,e,n,r,i,Ov)+"]":s1e(c)?o?"["+t.constructor.name+"]":(a||!e.printBasicPrototype&&t.constructor.name==="Array"?"":t.constructor.name+" ")+"["+(0,RS.printListItems)(t,e,n,r,i,Ov)+"]":c==="[object Map]"?o?"[Map]":"Map {"+(0,RS.printIteratorEntries)(t.entries(),e,n,r,i,Ov," => ")+"}":c==="[object Set]"?o?"[Set]":"Set {"+(0,RS.printIteratorValues)(t.values(),e,n,r,i,Ov)+"}":o||n1e(t)?"["+yP(t)+"]":(a||!e.printBasicPrototype&&yP(t)==="Object"?"":yP(t)+" ")+"{"+(0,RS.printObjectProperties)(t,e,n,r,i,Ov)+"}"}function c1e(t){return t.serialize!=null}function cY(t,e,n,r,i,s){let o;try{o=c1e(t)?t.serialize(e,n,r,i,s,Ov):t.print(e,a=>Ov(a,n,r,i,s),a=>{const c=r+n.indent;return c+a.replace(i1e,`
`+c)},{edgeSpacing:n.spacingOuter,min:n.min,spacing:n.spacingInner},n.colors)}catch(a){throw new sY(a.message,a.stack)}if(typeof o!="string")throw new Error(`pretty-format: Plugin must return type "string" but instead returned "${typeof o}".`);return o}function lY(t,e){for(let n=0;n<t.length;n++)try{if(t[n].test(e))return t[n]}catch(r){throw new sY(r.message,r.stack)}return null}function Ov(t,e,n,r,i,s){const o=lY(e.plugins,t);if(o!==null)return cY(o,t,e,n,r,i);const a=oY(t,e.printFunctionName,e.escapeRegex,e.escapeString);return a!==null?a:aY(t,e,n,r,i,s)}const FB={comment:"gray",content:"reset",prop:"yellow",tag:"cyan",value:"green"},uY=Object.keys(FB),Th={callToJSON:!0,compareKeys:void 0,escapeRegex:!1,escapeString:!0,highlight:!1,indent:2,maxDepth:1/0,min:!1,plugins:[],printBasicPrototype:!0,printFunctionName:!0,theme:FB};m_.DEFAULT_OPTIONS=Th;function l1e(t){if(Object.keys(t).forEach(e=>{if(!Th.hasOwnProperty(e))throw new Error(`pretty-format: Unknown option "${e}".`)}),t.min&&t.indent!==void 0&&t.indent!==0)throw new Error('pretty-format: Options "min" and "indent" cannot be used together.');if(t.theme!==void 0){if(t.theme===null)throw new Error('pretty-format: Option "theme" must not be null.');if(typeof t.theme!="object")throw new Error(`pretty-format: Option "theme" must be of type "object" but instead received "${typeof t.theme}".`)}}const u1e=t=>uY.reduce((e,n)=>{const r=t.theme&&t.theme[n]!==void 0?t.theme[n]:FB[n],i=r&&qCe.default[r];if(i&&typeof i.close=="string"&&typeof i.open=="string")e[n]=i;else throw new Error(`pretty-format: Option "theme" has a key "${n}" whose value "${r}" is undefined in ansi-styles.`);return e},Object.create(null)),d1e=()=>uY.reduce((t,e)=>(t[e]={close:"",open:""},t),Object.create(null)),dY=t=>t&&t.printFunctionName!==void 0?t.printFunctionName:Th.printFunctionName,hY=t=>t&&t.escapeRegex!==void 0?t.escapeRegex:Th.escapeRegex,fY=t=>t&&t.escapeString!==void 0?t.escapeString:Th.escapeString,K5=t=>{var e;return{callToJSON:t&&t.callToJSON!==void 0?t.callToJSON:Th.callToJSON,colors:t&&t.highlight?u1e(t):d1e(),compareKeys:t&&typeof t.compareKeys=="function"?t.compareKeys:Th.compareKeys,escapeRegex:hY(t),escapeString:fY(t),indent:t&&t.min?"":h1e(t&&t.indent!==void 0?t.indent:Th.indent),maxDepth:t&&t.maxDepth!==void 0?t.maxDepth:Th.maxDepth,min:t&&t.min!==void 0?t.min:Th.min,plugins:t&&t.plugins!==void 0?t.plugins:Th.plugins,printBasicPrototype:(e=t==null?void 0:t.printBasicPrototype)!==null&&e!==void 0?e:!0,printFunctionName:dY(t),spacingInner:t&&t.min?" ":`
`,spacingOuter:t&&t.min?"":`
`}};function h1e(t){return new Array(t+1).join(" ")}function pY(t,e){if(e&&(l1e(e),e.plugins)){const r=lY(e.plugins,t);if(r!==null)return cY(r,t,K5(e),"",0,[])}const n=oY(t,dY(e),hY(e),fY(e));return n!==null?n:aY(t,K5(e),"",0,[])}const f1e={AsymmetricMatcher:WCe.default,ConvertAnsi:KCe.default,DOMCollection:YCe.default,DOMElement:XCe.default,Immutable:JCe.default,ReactElement:QCe.default,ReactTestComponent:ZCe.default};rY=m_.plugins=f1e;var p1e=pY;m_.default=p1e;var m1e=Object.prototype.toString;function g1e(t){return typeof t=="function"||m1e.call(t)==="[object Function]"}function v1e(t){var e=Number(t);return isNaN(e)?0:e===0||!isFinite(e)?e:(e>0?1:-1)*Math.floor(Math.abs(e))}var _1e=Math.pow(2,53)-1;function y1e(t){var e=v1e(t);return Math.min(Math.max(e,0),_1e)}function xh(t,e){var n=Array,r=Object(t);if(t==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");for(var i=y1e(r.length),s=g1e(n)?Object(new n(i)):new Array(i),o=0,a;o<i;)a=r[o],s[o]=a,o+=1;return s.length=i,s}function Hw(t){"@babel/helpers - typeof";return Hw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hw(t)}function b1e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E1e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mY(r.key),r)}}function S1e(t,e,n){return e&&E1e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function w1e(t,e,n){return e=mY(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mY(t){var e=T1e(t,"string");return Hw(e)==="symbol"?e:String(e)}function T1e(t,e){if(Hw(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Hw(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var x1e=function(){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];b1e(this,t),w1e(this,"items",void 0),this.items=e}return S1e(t,[{key:"add",value:function(n){return this.has(n)===!1&&this.items.push(n),this}},{key:"clear",value:function(){this.items=[]}},{key:"delete",value:function(n){var r=this.items.length;return this.items=this.items.filter(function(i){return i!==n}),r!==this.items.length}},{key:"forEach",value:function(n){var r=this;this.items.forEach(function(i){n(i,i,r)})}},{key:"has",value:function(n){return this.items.indexOf(n)!==-1}},{key:"size",get:function(){return this.items.length}}]),t}();const C1e=typeof Set>"u"?Set:x1e;function Wc(t){var e;return(e=t.localName)!==null&&e!==void 0?e:t.tagName.toLowerCase()}var R1e={article:"article",aside:"complementary",button:"button",datalist:"listbox",dd:"definition",details:"group",dialog:"dialog",dt:"term",fieldset:"group",figure:"figure",form:"form",footer:"contentinfo",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading",header:"banner",hr:"separator",html:"document",legend:"legend",li:"listitem",math:"math",main:"main",menu:"list",nav:"navigation",ol:"list",optgroup:"group",option:"option",output:"status",progress:"progressbar",section:"region",summary:"button",table:"table",tbody:"rowgroup",textarea:"textbox",tfoot:"rowgroup",td:"cell",th:"columnheader",thead:"rowgroup",tr:"row",ul:"list"},A1e={caption:new Set(["aria-label","aria-labelledby"]),code:new Set(["aria-label","aria-labelledby"]),deletion:new Set(["aria-label","aria-labelledby"]),emphasis:new Set(["aria-label","aria-labelledby"]),generic:new Set(["aria-label","aria-labelledby","aria-roledescription"]),insertion:new Set(["aria-label","aria-labelledby"]),paragraph:new Set(["aria-label","aria-labelledby"]),presentation:new Set(["aria-label","aria-labelledby"]),strong:new Set(["aria-label","aria-labelledby"]),subscript:new Set(["aria-label","aria-labelledby"]),superscript:new Set(["aria-label","aria-labelledby"])};function M1e(t,e){return["aria-atomic","aria-busy","aria-controls","aria-current","aria-describedby","aria-details","aria-dropeffect","aria-flowto","aria-grabbed","aria-hidden","aria-keyshortcuts","aria-label","aria-labelledby","aria-live","aria-owns","aria-relevant","aria-roledescription"].some(function(n){var r;return t.hasAttribute(n)&&!((r=A1e[e])!==null&&r!==void 0&&r.has(n))})}function gY(t,e){return M1e(t,e)}function I1e(t){var e=k1e(t);if(e===null||e==="presentation"){var n=O1e(t);if(e!=="presentation"||gY(t,n||""))return n}return e}function O1e(t){var e=R1e[Wc(t)];if(e!==void 0)return e;switch(Wc(t)){case"a":case"area":case"link":if(t.hasAttribute("href"))return"link";break;case"img":return t.getAttribute("alt")===""&&!gY(t,"img")?"presentation":"img";case"input":{var n=t,r=n.type;switch(r){case"button":case"image":case"reset":case"submit":return"button";case"checkbox":case"radio":return r;case"range":return"slider";case"email":case"tel":case"text":case"url":return t.hasAttribute("list")?"combobox":"textbox";case"search":return t.hasAttribute("list")?"combobox":"searchbox";case"number":return"spinbutton";default:return null}}case"select":return t.hasAttribute("multiple")||t.size>1?"listbox":"combobox"}return null}function k1e(t){var e=t.getAttribute("role");if(e!==null){var n=e.trim().split(" ")[0];if(n.length>0)return n}return null}function qs(t){return t!==null&&t.nodeType===t.ELEMENT_NODE}function vY(t){return qs(t)&&Wc(t)==="caption"}function C1(t){return qs(t)&&Wc(t)==="input"}function N1e(t){return qs(t)&&Wc(t)==="optgroup"}function P1e(t){return qs(t)&&Wc(t)==="select"}function D1e(t){return qs(t)&&Wc(t)==="table"}function L1e(t){return qs(t)&&Wc(t)==="textarea"}function U1e(t){var e=t.ownerDocument===null?t:t.ownerDocument,n=e.defaultView;if(n===null)throw new TypeError("no window available");return n}function F1e(t){return qs(t)&&Wc(t)==="fieldset"}function B1e(t){return qs(t)&&Wc(t)==="legend"}function j1e(t){return qs(t)&&Wc(t)==="slot"}function $1e(t){return qs(t)&&t.ownerSVGElement!==void 0}function H1e(t){return qs(t)&&Wc(t)==="svg"}function V1e(t){return $1e(t)&&Wc(t)==="title"}function IR(t,e){if(qs(t)&&t.hasAttribute(e)){var n=t.getAttribute(e).split(" "),r=t.getRootNode?t.getRootNode():t.ownerDocument;return n.map(function(i){return r.getElementById(i)}).filter(function(i){return i!==null})}return[]}function Wm(t,e){return qs(t)?e.indexOf(I1e(t))!==-1:!1}function z1e(t){return t.trim().replace(/\s\s+/g," ")}function G1e(t,e){if(!qs(t))return!1;if(t.hasAttribute("hidden")||t.getAttribute("aria-hidden")==="true")return!0;var n=e(t);return n.getPropertyValue("display")==="none"||n.getPropertyValue("visibility")==="hidden"}function q1e(t){return Wm(t,["button","combobox","listbox","textbox"])||_Y(t,"range")}function _Y(t,e){if(!qs(t))return!1;switch(e){case"range":return Wm(t,["meter","progressbar","scrollbar","slider","spinbutton"]);default:throw new TypeError("No knowledge about abstract role '".concat(e,"'. This is likely a bug :("))}}function Y5(t,e){var n=xh(t.querySelectorAll(e));return IR(t,"aria-owns").forEach(function(r){n.push.apply(n,xh(r.querySelectorAll(e)))}),n}function W1e(t){return P1e(t)?t.selectedOptions||Y5(t,"[selected]"):Y5(t,'[aria-selected="true"]')}function K1e(t){return Wm(t,["none","presentation"])}function Y1e(t){return vY(t)}function X1e(t){return Wm(t,["button","cell","checkbox","columnheader","gridcell","heading","label","legend","link","menuitem","menuitemcheckbox","menuitemradio","option","radio","row","rowheader","switch","tab","tooltip","treeitem"])}function J1e(t){return!1}function Q1e(t){return C1(t)||L1e(t)?t.value:t.textContent||""}function X5(t){var e=t.getPropertyValue("content");return/^["'].*["']$/.test(e)?e.slice(1,-1):""}function yY(t){var e=Wc(t);return e==="button"||e==="input"&&t.getAttribute("type")!=="hidden"||e==="meter"||e==="output"||e==="progress"||e==="select"||e==="textarea"}function bY(t){if(yY(t))return t;var e=null;return t.childNodes.forEach(function(n){if(e===null&&qs(n)){var r=bY(n);r!==null&&(e=r)}}),e}function Z1e(t){if(t.control!==void 0)return t.control;var e=t.getAttribute("for");return e!==null?t.ownerDocument.getElementById(e):bY(t)}function eRe(t){var e=t.labels;if(e===null)return e;if(e!==void 0)return xh(e);if(!yY(t))return null;var n=t.ownerDocument;return xh(n.querySelectorAll("label")).filter(function(r){return Z1e(r)===t})}function tRe(t){var e=t.assignedNodes();return e.length===0?xh(t.childNodes):e}function EY(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new C1e,r=U1e(t),i=e.compute,s=i===void 0?"name":i,o=e.computedStyleSupportsPseudoElements,a=o===void 0?e.getComputedStyle!==void 0:o,c=e.getComputedStyle,l=c===void 0?r.getComputedStyle.bind(r):c,u=e.hidden,d=u===void 0?!1:u;function h(E,T){var C="";if(qs(E)&&a){var A=l(E,"::before"),k=X5(A);C="".concat(k," ").concat(C)}var I=j1e(E)?tRe(E):xh(E.childNodes).concat(IR(E,"aria-owns"));if(I.forEach(function(F){var $=v(F,{isEmbeddedInLabel:T.isEmbeddedInLabel,isReferenced:!1,recursion:!0}),X=qs(F)?l(F).getPropertyValue("display"):"inline",q=X!=="inline"?" ":"";C+="".concat(q).concat($).concat(q)}),qs(E)&&a){var N=l(E,"::after"),U=X5(N);C="".concat(C," ").concat(U)}return C.trim()}function f(E,T){var C=E.getAttributeNode(T);return C!==null&&!n.has(C)&&C.value.trim()!==""?(n.add(C),C.value):null}function p(E){return qs(E)?f(E,"title"):null}function g(E){if(!qs(E))return null;if(F1e(E)){n.add(E);for(var T=xh(E.childNodes),C=0;C<T.length;C+=1){var A=T[C];if(B1e(A))return v(A,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(D1e(E)){n.add(E);for(var k=xh(E.childNodes),I=0;I<k.length;I+=1){var N=k[I];if(vY(N))return v(N,{isEmbeddedInLabel:!1,isReferenced:!1,recursion:!1})}}else if(H1e(E)){n.add(E);for(var U=xh(E.childNodes),F=0;F<U.length;F+=1){var $=U[F];if(V1e($))return $.textContent}return null}else if(Wc(E)==="img"||Wc(E)==="area"){var X=f(E,"alt");if(X!==null)return X}else if(N1e(E)){var q=f(E,"label");if(q!==null)return q}if(C1(E)&&(E.type==="button"||E.type==="submit"||E.type==="reset")){var W=f(E,"value");if(W!==null)return W;if(E.type==="submit")return"Submit";if(E.type==="reset")return"Reset"}var K=eRe(E);if(K!==null&&K.length!==0)return n.add(E),xh(K).map(function(G){return v(G,{isEmbeddedInLabel:!0,isReferenced:!1,recursion:!0})}).filter(function(G){return G.length>0}).join(" ");if(C1(E)&&E.type==="image"){var ne=f(E,"alt");if(ne!==null)return ne;var Q=f(E,"title");return Q!==null?Q:"Submit Query"}if(Wm(E,["button"])){var ie=h(E,{isEmbeddedInLabel:!1,isReferenced:!1});if(ie!=="")return ie}return null}function v(E,T){if(n.has(E))return"";if(!d&&G1e(E,l)&&!T.isReferenced)return n.add(E),"";var C=qs(E)?E.getAttributeNode("aria-labelledby"):null,A=C!==null&&!n.has(C)?IR(E,"aria-labelledby"):[];if(s==="name"&&!T.isReferenced&&A.length>0)return n.add(C),A.map(function(X){return v(X,{isEmbeddedInLabel:T.isEmbeddedInLabel,isReferenced:!0,recursion:!1})}).join(" ");var k=T.recursion&&q1e(E)&&s==="name";if(!k){var I=(qs(E)&&E.getAttribute("aria-label")||"").trim();if(I!==""&&s==="name")return n.add(E),I;if(!K1e(E)){var N=g(E);if(N!==null)return n.add(E),N}}if(Wm(E,["menu"]))return n.add(E),"";if(k||T.isEmbeddedInLabel||T.isReferenced){if(Wm(E,["combobox","listbox"])){n.add(E);var U=W1e(E);return U.length===0?C1(E)?E.value:"":xh(U).map(function(X){return v(X,{isEmbeddedInLabel:T.isEmbeddedInLabel,isReferenced:!1,recursion:!0})}).join(" ")}if(_Y(E,"range"))return n.add(E),E.hasAttribute("aria-valuetext")?E.getAttribute("aria-valuetext"):E.hasAttribute("aria-valuenow")?E.getAttribute("aria-valuenow"):E.getAttribute("value")||"";if(Wm(E,["textbox"]))return n.add(E),Q1e(E)}if(X1e(E)||qs(E)&&T.isReferenced||Y1e(E)||J1e()){var F=h(E,{isEmbeddedInLabel:T.isEmbeddedInLabel,isReferenced:!1});if(F!=="")return n.add(E),F}if(E.nodeType===E.TEXT_NODE)return n.add(E),E.textContent||"";if(T.recursion)return n.add(E),h(E,{isEmbeddedInLabel:T.isEmbeddedInLabel,isReferenced:!1});var $=p(E);return $!==null?(n.add(E),$):(n.add(E),"")}return z1e(v(t,{isEmbeddedInLabel:!1,isReferenced:s==="description",recursion:!1}))}function Vw(t){"@babel/helpers - typeof";return Vw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vw(t)}function J5(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Q5(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J5(Object(n),!0).forEach(function(r){nRe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J5(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function nRe(t,e,n){return e=rRe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function rRe(t){var e=iRe(t,"string");return Vw(e)==="symbol"?e:String(e)}function iRe(t,e){if(Vw(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Vw(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function SY(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=IR(t,"aria-describedby").map(function(i){return EY(i,Q5(Q5({},e),{},{compute:"description"}))}).join(" ");if(n===""){var r=t.getAttribute("title");n=r===null?"":r}return n}function sRe(t){return Wm(t,["caption","code","deletion","emphasis","generic","insertion","paragraph","presentation","strong","subscript","superscript"])}function BB(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return sRe(t)?"":EY(t,e)}var Ah={},TM={},by={},xM={};Object.defineProperty(xM,"__esModule",{value:!0});xM.default=void 0;function oRe(){var t=this,e=0,n={"@@iterator":function(){return n},next:function(){if(e<t.length){var i=t[e];return e=e+1,{done:!1,value:i}}else return{done:!0}}};return n}var aRe=oRe;xM.default=aRe;Object.defineProperty(by,"__esModule",{value:!0});by.default=uRe;var cRe=lRe(xM);function lRe(t){return t&&t.__esModule?t:{default:t}}function R2(t){"@babel/helpers - typeof";return R2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R2(t)}function uRe(t,e){return typeof Symbol=="function"&&R2(Symbol.iterator)==="symbol"&&Object.defineProperty(t,Symbol.iterator,{value:cRe.default.bind(e)}),t}Object.defineProperty(TM,"__esModule",{value:!0});TM.default=void 0;var dRe=hRe(by);function hRe(t){return t&&t.__esModule?t:{default:t}}function bP(t,e){return mRe(t)||pRe(t,e)||wY(t,e)||fRe()}function fRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pRe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function mRe(t){if(Array.isArray(t))return t}function gRe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=wY(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function wY(t,e){if(t){if(typeof t=="string")return Z5(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z5(t,e)}}function Z5(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var fb=[["aria-activedescendant",{type:"id"}],["aria-atomic",{type:"boolean"}],["aria-autocomplete",{type:"token",values:["inline","list","both","none"]}],["aria-braillelabel",{type:"string"}],["aria-brailleroledescription",{type:"string"}],["aria-busy",{type:"boolean"}],["aria-checked",{type:"tristate"}],["aria-colcount",{type:"integer"}],["aria-colindex",{type:"integer"}],["aria-colspan",{type:"integer"}],["aria-controls",{type:"idlist"}],["aria-current",{type:"token",values:["page","step","location","date","time",!0,!1]}],["aria-describedby",{type:"idlist"}],["aria-description",{type:"string"}],["aria-details",{type:"id"}],["aria-disabled",{type:"boolean"}],["aria-dropeffect",{type:"tokenlist",values:["copy","execute","link","move","none","popup"]}],["aria-errormessage",{type:"id"}],["aria-expanded",{type:"boolean",allowundefined:!0}],["aria-flowto",{type:"idlist"}],["aria-grabbed",{type:"boolean",allowundefined:!0}],["aria-haspopup",{type:"token",values:[!1,!0,"menu","listbox","tree","grid","dialog"]}],["aria-hidden",{type:"boolean",allowundefined:!0}],["aria-invalid",{type:"token",values:["grammar",!1,"spelling",!0]}],["aria-keyshortcuts",{type:"string"}],["aria-label",{type:"string"}],["aria-labelledby",{type:"idlist"}],["aria-level",{type:"integer"}],["aria-live",{type:"token",values:["assertive","off","polite"]}],["aria-modal",{type:"boolean"}],["aria-multiline",{type:"boolean"}],["aria-multiselectable",{type:"boolean"}],["aria-orientation",{type:"token",values:["vertical","undefined","horizontal"]}],["aria-owns",{type:"idlist"}],["aria-placeholder",{type:"string"}],["aria-posinset",{type:"integer"}],["aria-pressed",{type:"tristate"}],["aria-readonly",{type:"boolean"}],["aria-relevant",{type:"tokenlist",values:["additions","all","removals","text"]}],["aria-required",{type:"boolean"}],["aria-roledescription",{type:"string"}],["aria-rowcount",{type:"integer"}],["aria-rowindex",{type:"integer"}],["aria-rowspan",{type:"integer"}],["aria-selected",{type:"boolean",allowundefined:!0}],["aria-setsize",{type:"integer"}],["aria-sort",{type:"token",values:["ascending","descending","none","other"]}],["aria-valuemax",{type:"number"}],["aria-valuemin",{type:"number"}],["aria-valuenow",{type:"number"}],["aria-valuetext",{type:"string"}]],A2={entries:function(){return fb},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=gRe(fb),i;try{for(r.s();!(i=r.n()).done;){var s=bP(i.value,2),o=s[0],a=s[1];e.call(n,a,o,fb)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=fb.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!A2.get(e)},keys:function(){return fb.map(function(e){var n=bP(e,1),r=n[0];return r})},values:function(){return fb.map(function(e){var n=bP(e,2),r=n[1];return r})}},vRe=(0,dRe.default)(A2,A2.entries());TM.default=vRe;var CM={};Object.defineProperty(CM,"__esModule",{value:!0});CM.default=void 0;var _Re=yRe(by);function yRe(t){return t&&t.__esModule?t:{default:t}}function EP(t,e){return SRe(t)||ERe(t,e)||TY(t,e)||bRe()}function bRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ERe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function SRe(t){if(Array.isArray(t))return t}function wRe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=TY(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function TY(t,e){if(t){if(typeof t=="string")return eV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eV(t,e)}}function eV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var pb=[["a",{reserved:!1}],["abbr",{reserved:!1}],["acronym",{reserved:!1}],["address",{reserved:!1}],["applet",{reserved:!1}],["area",{reserved:!1}],["article",{reserved:!1}],["aside",{reserved:!1}],["audio",{reserved:!1}],["b",{reserved:!1}],["base",{reserved:!0}],["bdi",{reserved:!1}],["bdo",{reserved:!1}],["big",{reserved:!1}],["blink",{reserved:!1}],["blockquote",{reserved:!1}],["body",{reserved:!1}],["br",{reserved:!1}],["button",{reserved:!1}],["canvas",{reserved:!1}],["caption",{reserved:!1}],["center",{reserved:!1}],["cite",{reserved:!1}],["code",{reserved:!1}],["col",{reserved:!0}],["colgroup",{reserved:!0}],["content",{reserved:!1}],["data",{reserved:!1}],["datalist",{reserved:!1}],["dd",{reserved:!1}],["del",{reserved:!1}],["details",{reserved:!1}],["dfn",{reserved:!1}],["dialog",{reserved:!1}],["dir",{reserved:!1}],["div",{reserved:!1}],["dl",{reserved:!1}],["dt",{reserved:!1}],["em",{reserved:!1}],["embed",{reserved:!1}],["fieldset",{reserved:!1}],["figcaption",{reserved:!1}],["figure",{reserved:!1}],["font",{reserved:!1}],["footer",{reserved:!1}],["form",{reserved:!1}],["frame",{reserved:!1}],["frameset",{reserved:!1}],["h1",{reserved:!1}],["h2",{reserved:!1}],["h3",{reserved:!1}],["h4",{reserved:!1}],["h5",{reserved:!1}],["h6",{reserved:!1}],["head",{reserved:!0}],["header",{reserved:!1}],["hgroup",{reserved:!1}],["hr",{reserved:!1}],["html",{reserved:!0}],["i",{reserved:!1}],["iframe",{reserved:!1}],["img",{reserved:!1}],["input",{reserved:!1}],["ins",{reserved:!1}],["kbd",{reserved:!1}],["keygen",{reserved:!1}],["label",{reserved:!1}],["legend",{reserved:!1}],["li",{reserved:!1}],["link",{reserved:!0}],["main",{reserved:!1}],["map",{reserved:!1}],["mark",{reserved:!1}],["marquee",{reserved:!1}],["menu",{reserved:!1}],["menuitem",{reserved:!1}],["meta",{reserved:!0}],["meter",{reserved:!1}],["nav",{reserved:!1}],["noembed",{reserved:!0}],["noscript",{reserved:!0}],["object",{reserved:!1}],["ol",{reserved:!1}],["optgroup",{reserved:!1}],["option",{reserved:!1}],["output",{reserved:!1}],["p",{reserved:!1}],["param",{reserved:!0}],["picture",{reserved:!0}],["pre",{reserved:!1}],["progress",{reserved:!1}],["q",{reserved:!1}],["rp",{reserved:!1}],["rt",{reserved:!1}],["rtc",{reserved:!1}],["ruby",{reserved:!1}],["s",{reserved:!1}],["samp",{reserved:!1}],["script",{reserved:!0}],["section",{reserved:!1}],["select",{reserved:!1}],["small",{reserved:!1}],["source",{reserved:!0}],["spacer",{reserved:!1}],["span",{reserved:!1}],["strike",{reserved:!1}],["strong",{reserved:!1}],["style",{reserved:!0}],["sub",{reserved:!1}],["summary",{reserved:!1}],["sup",{reserved:!1}],["table",{reserved:!1}],["tbody",{reserved:!1}],["td",{reserved:!1}],["textarea",{reserved:!1}],["tfoot",{reserved:!1}],["th",{reserved:!1}],["thead",{reserved:!1}],["time",{reserved:!1}],["title",{reserved:!0}],["tr",{reserved:!1}],["track",{reserved:!0}],["tt",{reserved:!1}],["u",{reserved:!1}],["ul",{reserved:!1}],["var",{reserved:!1}],["video",{reserved:!1}],["wbr",{reserved:!1}],["xmp",{reserved:!1}]],M2={entries:function(){return pb},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=wRe(pb),i;try{for(r.s();!(i=r.n()).done;){var s=EP(i.value,2),o=s[0],a=s[1];e.call(n,a,o,pb)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=pb.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!M2.get(e)},keys:function(){return pb.map(function(e){var n=EP(e,1),r=n[0];return r})},values:function(){return pb.map(function(e){var n=EP(e,2),r=n[1];return r})}},TRe=(0,_Re.default)(M2,M2.entries());CM.default=TRe;var ZE={},RM={},AM={};Object.defineProperty(AM,"__esModule",{value:!0});AM.default=void 0;var xRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},CRe=xRe;AM.default=CRe;var MM={};Object.defineProperty(MM,"__esModule",{value:!0});MM.default=void 0;var RRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},ARe=RRe;MM.default=ARe;var IM={};Object.defineProperty(IM,"__esModule",{value:!0});IM.default=void 0;var MRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null},relatedConcepts:[{concept:{name:"input"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget"]]},IRe=MRe;IM.default=IRe;var OM={};Object.defineProperty(OM,"__esModule",{value:!0});OM.default=void 0;var ORe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},kRe=ORe;OM.default=kRe;var kM={};Object.defineProperty(kM,"__esModule",{value:!0});kM.default=void 0;var NRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuemax":null,"aria-valuemin":null,"aria-valuenow":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},PRe=NRe;kM.default=PRe;var NM={};Object.defineProperty(NM,"__esModule",{value:!0});NM.default=void 0;var DRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{"aria-atomic":null,"aria-busy":null,"aria-controls":null,"aria-current":null,"aria-describedby":null,"aria-details":null,"aria-dropeffect":null,"aria-flowto":null,"aria-grabbed":null,"aria-hidden":null,"aria-keyshortcuts":null,"aria-label":null,"aria-labelledby":null,"aria-live":null,"aria-owns":null,"aria-relevant":null,"aria-roledescription":null},relatedConcepts:[{concept:{name:"role"},module:"XHTML"},{concept:{name:"type"},module:"Dublin Core"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]},LRe=DRe;NM.default=LRe;var PM={};Object.defineProperty(PM,"__esModule",{value:!0});PM.default=void 0;var URe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"frontmatter"},module:"DTB"},{concept:{name:"level"},module:"DTB"},{concept:{name:"level"},module:"SMIL"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},FRe=URe;PM.default=FRe;var DM={};Object.defineProperty(DM,"__esModule",{value:!0});DM.default=void 0;var BRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},jRe=BRe;DM.default=jRe;var LM={};Object.defineProperty(LM,"__esModule",{value:!0});LM.default=void 0;var $Re={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","group"]]},HRe=$Re;LM.default=HRe;var UM={};Object.defineProperty(UM,"__esModule",{value:!0});UM.default=void 0;var VRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},zRe=VRe;UM.default=zRe;var FM={};Object.defineProperty(FM,"__esModule",{value:!0});FM.default=void 0;var GRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},qRe=GRe;FM.default=qRe;var BM={};Object.defineProperty(BM,"__esModule",{value:!0});BM.default=void 0;var WRe={abstract:!0,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-modal":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype"]]},KRe=WRe;BM.default=KRe;Object.defineProperty(RM,"__esModule",{value:!0});RM.default=void 0;var YRe=jd(AM),XRe=jd(MM),JRe=jd(IM),QRe=jd(OM),ZRe=jd(kM),eAe=jd(NM),tAe=jd(PM),nAe=jd(DM),rAe=jd(LM),iAe=jd(UM),sAe=jd(FM),oAe=jd(BM);function jd(t){return t&&t.__esModule?t:{default:t}}var aAe=[["command",YRe.default],["composite",XRe.default],["input",JRe.default],["landmark",QRe.default],["range",ZRe.default],["roletype",eAe.default],["section",tAe.default],["sectionhead",nAe.default],["select",rAe.default],["structure",iAe.default],["widget",sAe.default],["window",oAe.default]],cAe=aAe;RM.default=cAe;var jM={},$M={};Object.defineProperty($M,"__esModule",{value:!0});$M.default=void 0;var lAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"assertive"},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},uAe=lAe;$M.default=uAe;var HM={};Object.defineProperty(HM,"__esModule",{value:!0});HM.default=void 0;var dAe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"alert"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","alert"],["roletype","window","dialog"]]},hAe=dAe;HM.default=hAe;var VM={};Object.defineProperty(VM,"__esModule",{value:!0});VM.default=void 0;var fAe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},pAe=fAe;VM.default=pAe;var zM={};Object.defineProperty(zM,"__esModule",{value:!0});zM.default=void 0;var mAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"article"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]},gAe=mAe;zM.default=gAe;var GM={};Object.defineProperty(GM,"__esModule",{value:!0});GM.default=void 0;var vAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"header"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},_Ae=vAe;GM.default=_Ae;var qM={};Object.defineProperty(qM,"__esModule",{value:!0});qM.default=void 0;var yAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"blockquote"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},bAe=yAe;qM.default=bAe;var WM={};Object.defineProperty(WM,"__esModule",{value:!0});WM.default=void 0;var EAe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-pressed":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"button"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"image"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"reset"}],name:"input"},module:"HTML"},{concept:{attributes:[{name:"type",value:"submit"}],name:"input"},module:"HTML"},{concept:{name:"button"},module:"HTML"},{concept:{name:"trigger"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},SAe=EAe;WM.default=SAe;var KM={};Object.defineProperty(KM,"__esModule",{value:!0});KM.default=void 0;var wAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"caption"},module:"HTML"}],requireContextRole:["figure","grid","table"],requiredContextRole:["figure","grid","table"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},TAe=wAe;KM.default=TAe;var YM={};Object.defineProperty(YM,"__esModule",{value:!0});YM.default=void 0;var xAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-colspan":null,"aria-rowindex":null,"aria-rowspan":null},relatedConcepts:[{concept:{constraints:["ancestor table element has table role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},CAe=xAe;YM.default=CAe;var XM={};Object.defineProperty(XM,"__esModule",{value:!0});XM.default=void 0;var RAe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"checkbox"}],name:"input"},module:"HTML"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]},AAe=RAe;XM.default=AAe;var JM={};Object.defineProperty(JM,"__esModule",{value:!0});JM.default=void 0;var MAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"code"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},IAe=MAe;JM.default=IAe;var QM={};Object.defineProperty(QM,"__esModule",{value:!0});QM.default=void 0;var OAe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"col"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"colgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]},kAe=OAe;QM.default=kAe;var ZM={};Object.defineProperty(ZM,"__esModule",{value:!0});ZM.default=void 0;var NAe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-expanded":"false","aria-haspopup":"listbox"},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"email"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"search"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"tel"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"text"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"list"},{name:"type",value:"url"}],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"multiple"},{constraints:["undefined"],name:"size"}],constraints:["the multiple attribute is not set and the size attribute does not have a value greater than 1"],name:"select"},module:"HTML"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-expanded":"false"},superClass:[["roletype","widget","input"]]},PAe=NAe;ZM.default=PAe;var eI={};Object.defineProperty(eI,"__esModule",{value:!0});eI.default=void 0;var DAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-label"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],constraints:["scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"aside"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},LAe=DAe;eI.default=LAe;var tI={};Object.defineProperty(tI,"__esModule",{value:!0});tI.default=void 0;var UAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{constraints:["scoped to the body element"],name:"footer"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},FAe=UAe;tI.default=FAe;var nI={};Object.defineProperty(nI,"__esModule",{value:!0});nI.default=void 0;var BAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dd"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},jAe=BAe;nI.default=jAe;var rI={};Object.defineProperty(rI,"__esModule",{value:!0});rI.default=void 0;var $Ae={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"del"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},HAe=$Ae;rI.default=HAe;var iI={};Object.defineProperty(iI,"__esModule",{value:!0});iI.default=void 0;var VAe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dialog"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","window"]]},zAe=VAe;iI.default=zAe;var sI={};Object.defineProperty(sI,"__esModule",{value:!0});sI.default=void 0;var GAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{module:"DAISY Guide"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","list"]]},qAe=GAe;sI.default=qAe;var oI={};Object.defineProperty(oI,"__esModule",{value:!0});oI.default=void 0;var WAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"Device Independence Delivery Unit"}},{concept:{name:"html"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},KAe=WAe;oI.default=KAe;var aI={};Object.defineProperty(aI,"__esModule",{value:!0});aI.default=void 0;var YAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"em"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},XAe=YAe;aI.default=XAe;var cI={};Object.defineProperty(cI,"__esModule",{value:!0});cI.default=void 0;var JAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["article"]],requiredProps:{},superClass:[["roletype","structure","section","list"]]},QAe=JAe;cI.default=QAe;var lI={};Object.defineProperty(lI,"__esModule",{value:!0});lI.default=void 0;var ZAe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"figure"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},eMe=ZAe;lI.default=eMe;var uI={};Object.defineProperty(uI,"__esModule",{value:!0});uI.default=void 0;var tMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"form"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"name"}],name:"form"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},nMe=tMe;uI.default=nMe;var dI={};Object.defineProperty(dI,"__esModule",{value:!0});dI.default=void 0;var rMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"a"},module:"HTML"},{concept:{name:"area"},module:"HTML"},{concept:{name:"aside"},module:"HTML"},{concept:{name:"b"},module:"HTML"},{concept:{name:"bdo"},module:"HTML"},{concept:{name:"body"},module:"HTML"},{concept:{name:"data"},module:"HTML"},{concept:{name:"div"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"footer"},module:"HTML"},{concept:{constraints:["scoped to the main element","scoped to a sectioning content element","scoped to a sectioning root element other than body"],name:"header"},module:"HTML"},{concept:{name:"hgroup"},module:"HTML"},{concept:{name:"i"},module:"HTML"},{concept:{name:"pre"},module:"HTML"},{concept:{name:"q"},module:"HTML"},{concept:{name:"samp"},module:"HTML"},{concept:{name:"section"},module:"HTML"},{concept:{name:"small"},module:"HTML"},{concept:{name:"span"},module:"HTML"},{concept:{name:"u"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},iMe=rMe;dI.default=iMe;var hI={};Object.defineProperty(hI,"__esModule",{value:!0});hI.default=void 0;var sMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-multiselectable":null,"aria-readonly":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","structure","section","table"]]},oMe=sMe;hI.default=oMe;var fI={};Object.defineProperty(fI,"__esModule",{value:!0});fI.default=void 0;var aMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-selected":null},relatedConcepts:[{concept:{constraints:["ancestor table element has grid role","ancestor table element has treegrid role"],name:"td"},module:"HTML"}],requireContextRole:["row"],requiredContextRole:["row"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","widget"]]},cMe=aMe;fI.default=cMe;var pI={};Object.defineProperty(pI,"__esModule",{value:!0});pI.default=void 0;var lMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-disabled":null},relatedConcepts:[{concept:{name:"details"},module:"HTML"},{concept:{name:"fieldset"},module:"HTML"},{concept:{name:"optgroup"},module:"HTML"},{concept:{name:"address"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},uMe=lMe;pI.default=uMe;var mI={};Object.defineProperty(mI,"__esModule",{value:!0});mI.default=void 0;var dMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-level":"2"},relatedConcepts:[{concept:{name:"h1"},module:"HTML"},{concept:{name:"h2"},module:"HTML"},{concept:{name:"h3"},module:"HTML"},{concept:{name:"h4"},module:"HTML"},{concept:{name:"h5"},module:"HTML"},{concept:{name:"h6"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-level":"2"},superClass:[["roletype","structure","sectionhead"]]},hMe=dMe;mI.default=hMe;var gI={};Object.defineProperty(gI,"__esModule",{value:!0});gI.default=void 0;var fMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"alt"}],name:"img"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"alt"}],name:"img"},module:"HTML"},{concept:{name:"imggroup"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},pMe=fMe;gI.default=pMe;var vI={};Object.defineProperty(vI,"__esModule",{value:!0});vI.default=void 0;var mMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"ins"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},gMe=mMe;vI.default=gMe;var _I={};Object.defineProperty(_I,"__esModule",{value:!0});_I.default=void 0;var vMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"href"}],name:"a"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"href"}],name:"area"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},_Me=vMe;_I.default=_Me;var yI={};Object.defineProperty(yI,"__esModule",{value:!0});yI.default=void 0;var yMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menu"},module:"HTML"},{concept:{name:"ol"},module:"HTML"},{concept:{name:"ul"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["listitem"]],requiredProps:{},superClass:[["roletype","structure","section"]]},bMe=yMe;yI.default=bMe;var bI={};Object.defineProperty(bI,"__esModule",{value:!0});bI.default=void 0;var EMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-invalid":null,"aria-multiselectable":null,"aria-readonly":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[{concept:{attributes:[{constraints:[">1"],name:"size"}],constraints:["the size attribute value is greater than 1"],name:"select"},module:"HTML"},{concept:{attributes:[{name:"multiple"}],name:"select"},module:"HTML"},{concept:{name:"datalist"},module:"HTML"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["option","group"],["option"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},SMe=EMe;bI.default=SMe;var EI={};Object.defineProperty(EI,"__esModule",{value:!0});EI.default=void 0;var wMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{constraints:["direct descendant of ol","direct descendant of ul","direct descendant of menu"],name:"li"},module:"HTML"},{concept:{name:"item"},module:"XForms"}],requireContextRole:["directory","list"],requiredContextRole:["directory","list"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},TMe=wMe;EI.default=TMe;var SI={};Object.defineProperty(SI,"__esModule",{value:!0});SI.default=void 0;var xMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-live":"polite"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},CMe=xMe;SI.default=CMe;var wI={};Object.defineProperty(wI,"__esModule",{value:!0});wI.default=void 0;var RMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"main"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},AMe=RMe;wI.default=AMe;var TI={};Object.defineProperty(TI,"__esModule",{value:!0});TI.default=void 0;var MMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:[],props:{"aria-braillelabel":null,"aria-brailleroledescription":null,"aria-description":null},relatedConcepts:[{concept:{name:"mark"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},IMe=MMe;TI.default=IMe;var xI={};Object.defineProperty(xI,"__esModule",{value:!0});xI.default=void 0;var OMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},kMe=OMe;xI.default=kMe;var CI={};Object.defineProperty(CI,"__esModule",{value:!0});CI.default=void 0;var NMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"math"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},PMe=NMe;CI.default=PMe;var RI={};Object.defineProperty(RI,"__esModule",{value:!0});RI.default=void 0;var DMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"vertical"},relatedConcepts:[{concept:{name:"MENU"},module:"JAPI"},{concept:{name:"list"},module:"ARIA"},{concept:{name:"select"},module:"XForms"},{concept:{name:"sidebar"},module:"DTB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},LMe=DMe;RI.default=LMe;var AI={};Object.defineProperty(AI,"__esModule",{value:!0});AI.default=void 0;var UMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"toolbar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["menuitem","group"],["menuitemradio","group"],["menuitemcheckbox","group"],["menuitem"],["menuitemcheckbox"],["menuitemradio"]],requiredProps:{},superClass:[["roletype","widget","composite","select","menu"],["roletype","structure","section","group","select","menu"]]},FMe=UMe;AI.default=FMe;var MI={};Object.defineProperty(MI,"__esModule",{value:!0});MI.default=void 0;var BMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"MENU_ITEM"},module:"JAPI"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command"]]},jMe=BMe;MI.default=jMe;var II={};Object.defineProperty(II,"__esModule",{value:!0});II.default=void 0;var $Me={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"],["roletype","widget","command","menuitem"]]},HMe=$Me;II.default=HMe;var OI={};Object.defineProperty(OI,"__esModule",{value:!0});OI.default=void 0;var VMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"menuitem"},module:"ARIA"}],requireContextRole:["group","menu","menubar"],requiredContextRole:["group","menu","menubar"],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox","menuitemcheckbox"],["roletype","widget","command","menuitem","menuitemcheckbox"],["roletype","widget","input","radio"]]},zMe=VMe;OI.default=zMe;var kI={};Object.defineProperty(kI,"__esModule",{value:!0});kI.default=void 0;var GMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null,"aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{name:"meter"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","structure","range"]]},qMe=GMe;kI.default=qMe;var NI={};Object.defineProperty(NI,"__esModule",{value:!0});NI.default=void 0;var WMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"nav"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},KMe=WMe;NI.default=KMe;var PI={};Object.defineProperty(PI,"__esModule",{value:!0});PI.default=void 0;var YMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:[],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[]},XMe=YMe;PI.default=XMe;var DI={};Object.defineProperty(DI,"__esModule",{value:!0});DI.default=void 0;var JMe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},QMe=JMe;DI.default=QMe;var LI={};Object.defineProperty(LI,"__esModule",{value:!0});LI.default=void 0;var ZMe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[{concept:{name:"item"},module:"XForms"},{concept:{name:"listitem"},module:"ARIA"},{concept:{name:"option"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-selected":"false"},superClass:[["roletype","widget","input"]]},eIe=ZMe;LI.default=eIe;var UI={};Object.defineProperty(UI,"__esModule",{value:!0});UI.default=void 0;var tIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"p"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},nIe=tIe;UI.default=nIe;var FI={};Object.defineProperty(FI,"__esModule",{value:!0});FI.default=void 0;var rIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{attributes:[{name:"alt",value:""}],name:"img"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},iIe=rIe;FI.default=iIe;var BI={};Object.defineProperty(BI,"__esModule",{value:!0});BI.default=void 0;var sIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-valuetext":null},relatedConcepts:[{concept:{name:"progress"},module:"HTML"},{concept:{name:"status"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","range"],["roletype","widget"]]},oIe=sIe;BI.default=oIe;var jI={};Object.defineProperty(jI,"__esModule",{value:!0});jI.default=void 0;var aIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-checked":null,"aria-posinset":null,"aria-setsize":null},relatedConcepts:[{concept:{attributes:[{name:"type",value:"radio"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input"]]},cIe=aIe;jI.default=cIe;var $I={};Object.defineProperty($I,"__esModule",{value:!0});$I.default=void 0;var lIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{name:"list"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["radio"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},uIe=lIe;$I.default=uIe;var HI={};Object.defineProperty(HI,"__esModule",{value:!0});HI.default=void 0;var dIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["set"],name:"aria-label"}],name:"section"},module:"HTML"},{concept:{attributes:[{constraints:["set"],name:"aria-labelledby"}],name:"section"},module:"HTML"},{concept:{name:"Device Independence Glossart perceivable unit"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},hIe=dIe;HI.default=hIe;var VI={};Object.defineProperty(VI,"__esModule",{value:!0});VI.default=void 0;var fIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-colindex":null,"aria-expanded":null,"aria-level":null,"aria-posinset":null,"aria-rowindex":null,"aria-selected":null,"aria-setsize":null},relatedConcepts:[{concept:{name:"tr"},module:"HTML"}],requireContextRole:["grid","rowgroup","table","treegrid"],requiredContextRole:["grid","rowgroup","table","treegrid"],requiredOwnedElements:[["cell"],["columnheader"],["gridcell"],["rowheader"]],requiredProps:{},superClass:[["roletype","structure","section","group"],["roletype","widget"]]},pIe=fIe;VI.default=pIe;var zI={};Object.defineProperty(zI,"__esModule",{value:!0});zI.default=void 0;var mIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"tbody"},module:"HTML"},{concept:{name:"tfoot"},module:"HTML"},{concept:{name:"thead"},module:"HTML"}],requireContextRole:["grid","table","treegrid"],requiredContextRole:["grid","table","treegrid"],requiredOwnedElements:[["row"]],requiredProps:{},superClass:[["roletype","structure"]]},gIe=mIe;zI.default=gIe;var GI={};Object.defineProperty(GI,"__esModule",{value:!0});GI.default=void 0;var vIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-sort":null},relatedConcepts:[{concept:{attributes:[{name:"scope",value:"row"}],name:"th"},module:"HTML"},{concept:{attributes:[{name:"scope",value:"rowgroup"}],name:"th"},module:"HTML"}],requireContextRole:["row","rowgroup"],requiredContextRole:["row","rowgroup"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","cell"],["roletype","structure","section","cell","gridcell"],["roletype","widget","gridcell"],["roletype","structure","sectionhead"]]},_Ie=vIe;GI.default=_Ie;var qI={};Object.defineProperty(qI,"__esModule",{value:!0});qI.default=void 0;var yIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-valuetext":null,"aria-orientation":"vertical","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-controls":null,"aria-valuenow":null},superClass:[["roletype","structure","range"],["roletype","widget"]]},bIe=yIe;qI.default=bIe;var WI={};Object.defineProperty(WI,"__esModule",{value:!0});WI.default=void 0;var EIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},SIe=EIe;WI.default=SIe;var KI={};Object.defineProperty(KI,"__esModule",{value:!0});KI.default=void 0;var wIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"search"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input","textbox"]]},TIe=wIe;KI.default=TIe;var YI={};Object.defineProperty(YI,"__esModule",{value:!0});YI.default=void 0;var xIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":null,"aria-valuetext":null},relatedConcepts:[{concept:{name:"hr"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure"]]},CIe=xIe;YI.default=CIe;var XI={};Object.defineProperty(XI,"__esModule",{value:!0});XI.default=void 0;var RIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-readonly":null,"aria-valuetext":null,"aria-orientation":"horizontal","aria-valuemax":"100","aria-valuemin":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"range"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-valuenow":null},superClass:[["roletype","widget","input"],["roletype","structure","range"]]},AIe=RIe;XI.default=AIe;var JI={};Object.defineProperty(JI,"__esModule",{value:!0});JI.default=void 0;var MIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-readonly":null,"aria-required":null,"aria-valuetext":null,"aria-valuenow":"0"},relatedConcepts:[{concept:{attributes:[{name:"type",value:"number"}],name:"input"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","composite"],["roletype","widget","input"],["roletype","structure","range"]]},IIe=MIe;JI.default=IIe;var QI={};Object.defineProperty(QI,"__esModule",{value:!0});QI.default=void 0;var OIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-atomic":"true","aria-live":"polite"},relatedConcepts:[{concept:{name:"output"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},kIe=OIe;QI.default=kIe;var ZI={};Object.defineProperty(ZI,"__esModule",{value:!0});ZI.default=void 0;var NIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"strong"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},PIe=NIe;ZI.default=PIe;var eO={};Object.defineProperty(eO,"__esModule",{value:!0});eO.default=void 0;var DIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sub"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},LIe=DIe;eO.default=LIe;var tO={};Object.defineProperty(tO,"__esModule",{value:!0});tO.default=void 0;var UIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["prohibited"],prohibitedProps:["aria-label","aria-labelledby"],props:{},relatedConcepts:[{concept:{name:"sup"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},FIe=UIe;tO.default=FIe;var nO={};Object.defineProperty(nO,"__esModule",{value:!0});nO.default=void 0;var BIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"button"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{"aria-checked":null},superClass:[["roletype","widget","input","checkbox"]]},jIe=BIe;nO.default=jIe;var rO={};Object.defineProperty(rO,"__esModule",{value:!0});rO.default=void 0;var $Ie={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!0,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-disabled":null,"aria-expanded":null,"aria-haspopup":null,"aria-posinset":null,"aria-setsize":null,"aria-selected":"false"},relatedConcepts:[],requireContextRole:["tablist"],requiredContextRole:["tablist"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"],["roletype","widget"]]},HIe=$Ie;rO.default=HIe;var iO={};Object.defineProperty(iO,"__esModule",{value:!0});iO.default=void 0;var VIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-colcount":null,"aria-rowcount":null},relatedConcepts:[{concept:{name:"table"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","structure","section"]]},zIe=VIe;iO.default=zIe;var sO={};Object.defineProperty(sO,"__esModule",{value:!0});sO.default=void 0;var GIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-level":null,"aria-multiselectable":null,"aria-orientation":"horizontal"},relatedConcepts:[{module:"DAISY",concept:{name:"guide"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["tab"]],requiredProps:{},superClass:[["roletype","widget","composite"]]},qIe=GIe;sO.default=qIe;var oO={};Object.defineProperty(oO,"__esModule",{value:!0});oO.default=void 0;var WIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},KIe=WIe;oO.default=KIe;var aO={};Object.defineProperty(aO,"__esModule",{value:!0});aO.default=void 0;var YIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"dfn"},module:"HTML"},{concept:{name:"dt"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},XIe=YIe;aO.default=XIe;var cO={};Object.defineProperty(cO,"__esModule",{value:!0});cO.default=void 0;var JIe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-activedescendant":null,"aria-autocomplete":null,"aria-errormessage":null,"aria-haspopup":null,"aria-invalid":null,"aria-multiline":null,"aria-placeholder":null,"aria-readonly":null,"aria-required":null},relatedConcepts:[{concept:{attributes:[{constraints:["undefined"],name:"type"},{constraints:["undefined"],name:"list"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"email"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"tel"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"text"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{attributes:[{constraints:["undefined"],name:"list"},{name:"type",value:"url"}],constraints:["the list attribute is not set"],name:"input"},module:"HTML"},{concept:{name:"input"},module:"XForms"},{concept:{name:"textarea"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","input"]]},QIe=JIe;cO.default=QIe;var lO={};Object.defineProperty(lO,"__esModule",{value:!0});lO.default=void 0;var ZIe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"time"},module:"HTML"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},eOe=ZIe;lO.default=eOe;var uO={};Object.defineProperty(uO,"__esModule",{value:!0});uO.default=void 0;var tOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","status"]]},nOe=tOe;uO.default=nOe;var dO={};Object.defineProperty(dO,"__esModule",{value:!0});dO.default=void 0;var rOe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-orientation":"horizontal"},relatedConcepts:[{concept:{name:"menubar"},module:"ARIA"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]},iOe=rOe;dO.default=iOe;var hO={};Object.defineProperty(hO,"__esModule",{value:!0});hO.default=void 0;var sOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},oOe=sOe;hO.default=oOe;var fO={};Object.defineProperty(fO,"__esModule",{value:!0});fO.default=void 0;var aOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null,"aria-multiselectable":null,"aria-required":null,"aria-orientation":"vertical"},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["treeitem","group"],["treeitem"]],requiredProps:{},superClass:[["roletype","widget","composite","select"],["roletype","structure","section","group","select"]]},cOe=aOe;fO.default=cOe;var pO={};Object.defineProperty(pO,"__esModule",{value:!0});pO.default=void 0;var lOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["row"],["row","rowgroup"]],requiredProps:{},superClass:[["roletype","widget","composite","grid"],["roletype","structure","section","table","grid"],["roletype","widget","composite","select","tree"],["roletype","structure","section","group","select","tree"]]},uOe=lOe;pO.default=uOe;var mO={};Object.defineProperty(mO,"__esModule",{value:!0});mO.default=void 0;var dOe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-expanded":null,"aria-haspopup":null},relatedConcepts:[],requireContextRole:["group","tree"],requiredContextRole:["group","tree"],requiredOwnedElements:[],requiredProps:{"aria-selected":null},superClass:[["roletype","structure","section","listitem"],["roletype","widget","input","option"]]},hOe=dOe;mO.default=hOe;Object.defineProperty(jM,"__esModule",{value:!0});jM.default=void 0;var fOe=Zt($M),pOe=Zt(HM),mOe=Zt(VM),gOe=Zt(zM),vOe=Zt(GM),_Oe=Zt(qM),yOe=Zt(WM),bOe=Zt(KM),EOe=Zt(YM),SOe=Zt(XM),wOe=Zt(JM),TOe=Zt(QM),xOe=Zt(ZM),COe=Zt(eI),ROe=Zt(tI),AOe=Zt(nI),MOe=Zt(rI),IOe=Zt(iI),OOe=Zt(sI),kOe=Zt(oI),NOe=Zt(aI),POe=Zt(cI),DOe=Zt(lI),LOe=Zt(uI),UOe=Zt(dI),FOe=Zt(hI),BOe=Zt(fI),jOe=Zt(pI),$Oe=Zt(mI),HOe=Zt(gI),VOe=Zt(vI),zOe=Zt(_I),GOe=Zt(yI),qOe=Zt(bI),WOe=Zt(EI),KOe=Zt(SI),YOe=Zt(wI),XOe=Zt(TI),JOe=Zt(xI),QOe=Zt(CI),ZOe=Zt(RI),eke=Zt(AI),tke=Zt(MI),nke=Zt(II),rke=Zt(OI),ike=Zt(kI),ske=Zt(NI),oke=Zt(PI),ake=Zt(DI),cke=Zt(LI),lke=Zt(UI),uke=Zt(FI),dke=Zt(BI),hke=Zt(jI),fke=Zt($I),pke=Zt(HI),mke=Zt(VI),gke=Zt(zI),vke=Zt(GI),_ke=Zt(qI),yke=Zt(WI),bke=Zt(KI),Eke=Zt(YI),Ske=Zt(XI),wke=Zt(JI),Tke=Zt(QI),xke=Zt(ZI),Cke=Zt(eO),Rke=Zt(tO),Ake=Zt(nO),Mke=Zt(rO),Ike=Zt(iO),Oke=Zt(sO),kke=Zt(oO),Nke=Zt(aO),Pke=Zt(cO),Dke=Zt(lO),Lke=Zt(uO),Uke=Zt(dO),Fke=Zt(hO),Bke=Zt(fO),jke=Zt(pO),$ke=Zt(mO);function Zt(t){return t&&t.__esModule?t:{default:t}}var Hke=[["alert",fOe.default],["alertdialog",pOe.default],["application",mOe.default],["article",gOe.default],["banner",vOe.default],["blockquote",_Oe.default],["button",yOe.default],["caption",bOe.default],["cell",EOe.default],["checkbox",SOe.default],["code",wOe.default],["columnheader",TOe.default],["combobox",xOe.default],["complementary",COe.default],["contentinfo",ROe.default],["definition",AOe.default],["deletion",MOe.default],["dialog",IOe.default],["directory",OOe.default],["document",kOe.default],["emphasis",NOe.default],["feed",POe.default],["figure",DOe.default],["form",LOe.default],["generic",UOe.default],["grid",FOe.default],["gridcell",BOe.default],["group",jOe.default],["heading",$Oe.default],["img",HOe.default],["insertion",VOe.default],["link",zOe.default],["list",GOe.default],["listbox",qOe.default],["listitem",WOe.default],["log",KOe.default],["main",YOe.default],["mark",XOe.default],["marquee",JOe.default],["math",QOe.default],["menu",ZOe.default],["menubar",eke.default],["menuitem",tke.default],["menuitemcheckbox",nke.default],["menuitemradio",rke.default],["meter",ike.default],["navigation",ske.default],["none",oke.default],["note",ake.default],["option",cke.default],["paragraph",lke.default],["presentation",uke.default],["progressbar",dke.default],["radio",hke.default],["radiogroup",fke.default],["region",pke.default],["row",mke.default],["rowgroup",gke.default],["rowheader",vke.default],["scrollbar",_ke.default],["search",yke.default],["searchbox",bke.default],["separator",Eke.default],["slider",Ske.default],["spinbutton",wke.default],["status",Tke.default],["strong",xke.default],["subscript",Cke.default],["superscript",Rke.default],["switch",Ake.default],["tab",Mke.default],["table",Ike.default],["tablist",Oke.default],["tabpanel",kke.default],["term",Nke.default],["textbox",Pke.default],["time",Dke.default],["timer",Lke.default],["toolbar",Uke.default],["tooltip",Fke.default],["tree",Bke.default],["treegrid",jke.default],["treeitem",$ke.default]],Vke=Hke;jM.default=Vke;var gO={},vO={};Object.defineProperty(vO,"__esModule",{value:!0});vO.default=void 0;var zke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"abstract [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},Gke=zke;vO.default=Gke;var _O={};Object.defineProperty(_O,"__esModule",{value:!0});_O.default=void 0;var qke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"acknowledgments [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},Wke=qke;_O.default=Wke;var yO={};Object.defineProperty(yO,"__esModule",{value:!0});yO.default=void 0;var Kke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"afterword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},Yke=Kke;yO.default=Yke;var bO={};Object.defineProperty(bO,"__esModule",{value:!0});bO.default=void 0;var Xke={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"appendix [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},Jke=Xke;bO.default=Jke;var EO={};Object.defineProperty(EO,"__esModule",{value:!0});EO.default=void 0;var Qke={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"referrer [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},Zke=Qke;EO.default=Zke;var SO={};Object.defineProperty(SO,"__esModule",{value:!0});SO.default=void 0;var eNe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"EPUB biblioentry [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-bibliography"],requiredContextRole:["doc-bibliography"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]},tNe=eNe;SO.default=tNe;var wO={};Object.defineProperty(wO,"__esModule",{value:!0});wO.default=void 0;var nNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"bibliography [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-biblioentry"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},rNe=nNe;wO.default=rNe;var TO={};Object.defineProperty(TO,"__esModule",{value:!0});TO.default=void 0;var iNe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"biblioref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},sNe=iNe;TO.default=sNe;var xO={};Object.defineProperty(xO,"__esModule",{value:!0});xO.default=void 0;var oNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"chapter [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},aNe=oNe;xO.default=aNe;var CO={};Object.defineProperty(CO,"__esModule",{value:!0});CO.default=void 0;var cNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"colophon [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},lNe=cNe;CO.default=lNe;var RO={};Object.defineProperty(RO,"__esModule",{value:!0});RO.default=void 0;var uNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"conclusion [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},dNe=uNe;RO.default=dNe;var AO={};Object.defineProperty(AO,"__esModule",{value:!0});AO.default=void 0;var hNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"cover [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]},fNe=hNe;AO.default=fNe;var MO={};Object.defineProperty(MO,"__esModule",{value:!0});MO.default=void 0;var pNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credit [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},mNe=pNe;MO.default=mNe;var IO={};Object.defineProperty(IO,"__esModule",{value:!0});IO.default=void 0;var gNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"credits [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},vNe=gNe;IO.default=vNe;var OO={};Object.defineProperty(OO,"__esModule",{value:!0});OO.default=void 0;var _Ne={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"dedication [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},yNe=_Ne;OO.default=yNe;var kO={};Object.defineProperty(kO,"__esModule",{value:!0});kO.default=void 0;var bNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:["doc-endnotes"],requiredContextRole:["doc-endnotes"],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","listitem"]]},ENe=bNe;kO.default=ENe;var NO={};Object.defineProperty(NO,"__esModule",{value:!0});NO.default=void 0;var SNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"rearnotes [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["doc-endnote"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},wNe=SNe;NO.default=wNe;var PO={};Object.defineProperty(PO,"__esModule",{value:!0});PO.default=void 0;var TNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epigraph [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},xNe=TNe;PO.default=xNe;var DO={};Object.defineProperty(DO,"__esModule",{value:!0});DO.default=void 0;var CNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"epilogue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},RNe=CNe;DO.default=RNe;var LO={};Object.defineProperty(LO,"__esModule",{value:!0});LO.default=void 0;var ANe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"errata [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},MNe=ANe;LO.default=MNe;var UO={};Object.defineProperty(UO,"__esModule",{value:!0});UO.default=void 0;var INe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},ONe=INe;UO.default=ONe;var FO={};Object.defineProperty(FO,"__esModule",{value:!0});FO.default=void 0;var kNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"footnote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},NNe=kNe;FO.default=NNe;var BO={};Object.defineProperty(BO,"__esModule",{value:!0});BO.default=void 0;var PNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"foreword [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},DNe=PNe;BO.default=DNe;var jO={};Object.defineProperty(jO,"__esModule",{value:!0});jO.default=void 0;var LNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossary [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[["definition"],["term"]],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},UNe=LNe;jO.default=UNe;var $O={};Object.defineProperty($O,"__esModule",{value:!0});$O.default=void 0;var FNe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"glossref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},BNe=FNe;$O.default=BNe;var HO={};Object.defineProperty(HO,"__esModule",{value:!0});HO.default=void 0;var jNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"index [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},$Ne=jNe;HO.default=$Ne;var VO={};Object.defineProperty(VO,"__esModule",{value:!0});VO.default=void 0;var HNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"introduction [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},VNe=HNe;VO.default=VNe;var zO={};Object.defineProperty(zO,"__esModule",{value:!0});zO.default=void 0;var zNe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"noteref [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","widget","command","link"]]},GNe=zNe;zO.default=GNe;var GO={};Object.defineProperty(GO,"__esModule",{value:!0});GO.default=void 0;var qNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"notice [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]},WNe=qNe;GO.default=WNe;var qO={};Object.defineProperty(qO,"__esModule",{value:!0});qO.default=void 0;var KNe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"pagebreak [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","separator"]]},YNe=KNe;qO.default=YNe;var WO={};Object.defineProperty(WO,"__esModule",{value:!0});WO.default=void 0;var XNe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"page-list [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},JNe=XNe;WO.default=JNe;var KO={};Object.defineProperty(KO,"__esModule",{value:!0});KO.default=void 0;var QNe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"part [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},ZNe=QNe;KO.default=ZNe;var YO={};Object.defineProperty(YO,"__esModule",{value:!0});YO.default=void 0;var ePe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"preface [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},tPe=ePe;YO.default=tPe;var XO={};Object.defineProperty(XO,"__esModule",{value:!0});XO.default=void 0;var nPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"prologue [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark"]]},rPe=nPe;XO.default=rPe;var JO={};Object.defineProperty(JO,"__esModule",{value:!0});JO.default=void 0;var iPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{},relatedConcepts:[{concept:{name:"pullquote [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["none"]]},sPe=iPe;JO.default=sPe;var QO={};Object.defineProperty(QO,"__esModule",{value:!0});QO.default=void 0;var oPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"qna [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section"]]},aPe=oPe;QO.default=aPe;var ZO={};Object.defineProperty(ZO,"__esModule",{value:!0});ZO.default=void 0;var cPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"subtitle [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","sectionhead"]]},lPe=cPe;ZO.default=lPe;var ek={};Object.defineProperty(ek,"__esModule",{value:!0});ek.default=void 0;var uPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"help [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","note"]]},dPe=uPe;ek.default=dPe;var tk={};Object.defineProperty(tk,"__esModule",{value:!0});tk.default=void 0;var hPe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{concept:{name:"toc [EPUB-SSV]"},module:"EPUB"}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","landmark","navigation"]]},fPe=hPe;tk.default=fPe;Object.defineProperty(gO,"__esModule",{value:!0});gO.default=void 0;var pPe=ti(vO),mPe=ti(_O),gPe=ti(yO),vPe=ti(bO),_Pe=ti(EO),yPe=ti(SO),bPe=ti(wO),EPe=ti(TO),SPe=ti(xO),wPe=ti(CO),TPe=ti(RO),xPe=ti(AO),CPe=ti(MO),RPe=ti(IO),APe=ti(OO),MPe=ti(kO),IPe=ti(NO),OPe=ti(PO),kPe=ti(DO),NPe=ti(LO),PPe=ti(UO),DPe=ti(FO),LPe=ti(BO),UPe=ti(jO),FPe=ti($O),BPe=ti(HO),jPe=ti(VO),$Pe=ti(zO),HPe=ti(GO),VPe=ti(qO),zPe=ti(WO),GPe=ti(KO),qPe=ti(YO),WPe=ti(XO),KPe=ti(JO),YPe=ti(QO),XPe=ti(ZO),JPe=ti(ek),QPe=ti(tk);function ti(t){return t&&t.__esModule?t:{default:t}}var ZPe=[["doc-abstract",pPe.default],["doc-acknowledgments",mPe.default],["doc-afterword",gPe.default],["doc-appendix",vPe.default],["doc-backlink",_Pe.default],["doc-biblioentry",yPe.default],["doc-bibliography",bPe.default],["doc-biblioref",EPe.default],["doc-chapter",SPe.default],["doc-colophon",wPe.default],["doc-conclusion",TPe.default],["doc-cover",xPe.default],["doc-credit",CPe.default],["doc-credits",RPe.default],["doc-dedication",APe.default],["doc-endnote",MPe.default],["doc-endnotes",IPe.default],["doc-epigraph",OPe.default],["doc-epilogue",kPe.default],["doc-errata",NPe.default],["doc-example",PPe.default],["doc-footnote",DPe.default],["doc-foreword",LPe.default],["doc-glossary",UPe.default],["doc-glossref",FPe.default],["doc-index",BPe.default],["doc-introduction",jPe.default],["doc-noteref",$Pe.default],["doc-notice",HPe.default],["doc-pagebreak",VPe.default],["doc-pagelist",zPe.default],["doc-part",GPe.default],["doc-preface",qPe.default],["doc-prologue",WPe.default],["doc-pullquote",KPe.default],["doc-qna",YPe.default],["doc-subtitle",XPe.default],["doc-tip",JPe.default],["doc-toc",QPe.default]],eDe=ZPe;gO.default=eDe;var nk={},rk={};Object.defineProperty(rk,"__esModule",{value:!0});rk.default=void 0;var tDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!1,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-object"}},{module:"ARIA",concept:{name:"img"}},{module:"ARIA",concept:{name:"article"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","document"]]},nDe=tDe;rk.default=nDe;var ik={};Object.defineProperty(ik,"__esModule",{value:!0});ik.default=void 0;var rDe={abstract:!1,accessibleNameRequired:!1,baseConcepts:[],childrenPresentational:!1,nameFrom:["author","contents"],prohibitedProps:[],props:{"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[{module:"GRAPHICS",concept:{name:"graphics-document"}},{module:"ARIA",concept:{name:"group"}},{module:"ARIA",concept:{name:"img"}},{module:"GRAPHICS",concept:{name:"graphics-symbol"}}],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","group"]]},iDe=rDe;ik.default=iDe;var sk={};Object.defineProperty(sk,"__esModule",{value:!0});sk.default=void 0;var sDe={abstract:!1,accessibleNameRequired:!0,baseConcepts:[],childrenPresentational:!0,nameFrom:["author"],prohibitedProps:[],props:{"aria-disabled":null,"aria-errormessage":null,"aria-expanded":null,"aria-haspopup":null,"aria-invalid":null},relatedConcepts:[],requireContextRole:[],requiredContextRole:[],requiredOwnedElements:[],requiredProps:{},superClass:[["roletype","structure","section","img"]]},oDe=sDe;sk.default=oDe;Object.defineProperty(nk,"__esModule",{value:!0});nk.default=void 0;var aDe=jB(rk),cDe=jB(ik),lDe=jB(sk);function jB(t){return t&&t.__esModule?t:{default:t}}var uDe=[["graphics-document",aDe.default],["graphics-object",cDe.default],["graphics-symbol",lDe.default]],dDe=uDe;nk.default=dDe;Object.defineProperty(ZE,"__esModule",{value:!0});ZE.default=void 0;var hDe=YT(RM),fDe=YT(jM),pDe=YT(gO),mDe=YT(nk),gDe=YT(by);function YT(t){return t&&t.__esModule?t:{default:t}}function vDe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I2(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=xY(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function sw(t,e){return bDe(t)||yDe(t,e)||xY(t,e)||_De()}function _De(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xY(t,e){if(t){if(typeof t=="string")return tV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tV(t,e)}}function tV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function yDe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function bDe(t){if(Array.isArray(t))return t}var kv=[].concat(hDe.default,fDe.default,pDe.default,mDe.default);kv.forEach(function(t){var e=sw(t,2),n=e[1],r=I2(n.superClass),i;try{for(r.s();!(i=r.n()).done;){var s=i.value,o=I2(s),a;try{var c=function(){var u=a.value,d=kv.find(function(v){var E=sw(v,1),T=E[0];return T===u});if(d)for(var h=d[1],f=0,p=Object.keys(h.props);f<p.length;f++){var g=p[f];Object.prototype.hasOwnProperty.call(n.props,g)||Object.assign(n.props,vDe({},g,h.props[g]))}};for(o.s();!(a=o.n()).done;)c()}catch(l){o.e(l)}finally{o.f()}}}catch(l){r.e(l)}finally{r.f()}});var O2={entries:function(){return kv},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=I2(kv),i;try{for(r.s();!(i=r.n()).done;){var s=sw(i.value,2),o=s[0],a=s[1];e.call(n,a,o,kv)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=kv.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!O2.get(e)},keys:function(){return kv.map(function(e){var n=sw(e,1),r=n[0];return r})},values:function(){return kv.map(function(e){var n=sw(e,2),r=n[1];return r})}},EDe=(0,gDe.default)(O2,O2.entries());ZE.default=EDe;var ok={},CY={},nV=Object.prototype.hasOwnProperty;function k2(t,e){var n,r;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&k2(t[r],e[r]););return r===-1}if(!n||typeof t=="object"){r=0;for(n in t)if(nV.call(t,n)&&++r&&!nV.call(e,n)||!(n in e)||!k2(t[n],e[n]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}CY.dequal=k2;Object.defineProperty(ok,"__esModule",{value:!0});ok.default=void 0;var RY=CY,SDe=MY(by),AY=MY(ZE);function MY(t){return t&&t.__esModule?t:{default:t}}function SP(t,e){return xDe(t)||TDe(t,e)||IY(t,e)||wDe()}function wDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TDe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function xDe(t){if(Array.isArray(t))return t}function CDe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=IY(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function IY(t,e){if(t){if(typeof t=="string")return rV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rV(t,e)}}function rV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Nv=[],iV=AY.default.keys();for(var wP=0;wP<iV.length;wP++){var TP=iV[wP],xP=AY.default.get(TP);if(xP)for(var sV=[].concat(xP.baseConcepts,xP.relatedConcepts),CP=0;CP<sV.length;CP++){var oV=sV[CP];oV.module==="HTML"&&function(){var t=oV.concept;if(t){var e=Nv.find(function(s){return(0,RY.dequal)(s,t)}),n;e?n=e[1]:n=[];for(var r=!0,i=0;i<n.length;i++)if(n[i]===TP){r=!1;break}r&&n.push(TP),Nv.push([t,n])}}()}}var N2={entries:function(){return Nv},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=CDe(Nv),i;try{for(r.s();!(i=r.n()).done;){var s=SP(i.value,2),o=s[0],a=s[1];e.call(n,a,o,Nv)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=Nv.find(function(r){return e.name===r[0].name&&(0,RY.dequal)(e.attributes,r[0].attributes)});return n&&n[1]},has:function(e){return!!N2.get(e)},keys:function(){return Nv.map(function(e){var n=SP(e,1),r=n[0];return r})},values:function(){return Nv.map(function(e){var n=SP(e,2),r=n[1];return r})}},RDe=(0,SDe.default)(N2,N2.entries());ok.default=RDe;var ak={};Object.defineProperty(ak,"__esModule",{value:!0});ak.default=void 0;var ADe=kY(by),OY=kY(ZE);function kY(t){return t&&t.__esModule?t:{default:t}}function RP(t,e){return ODe(t)||IDe(t,e)||NY(t,e)||MDe()}function MDe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IDe(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r=[],i=!0,s=!1,o,a;try{for(n=n.call(t);!(i=(o=n.next()).done)&&(r.push(o.value),!(e&&r.length===e));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(s)throw a}}return r}}function ODe(t){if(Array.isArray(t))return t}function kDe(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=NY(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,a;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(o)throw a}}}}function NY(t,e){if(t){if(typeof t=="string")return aV(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return aV(t,e)}}function aV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var b0=[],cV=OY.default.keys();for(var AP=0;AP<cV.length;AP++){var lV=cV[AP],MP=OY.default.get(lV),IP=[];if(MP){for(var uV=[].concat(MP.baseConcepts,MP.relatedConcepts),OP=0;OP<uV.length;OP++){var dV=uV[OP];if(dV.module==="HTML"){var hV=dV.concept;hV!=null&&IP.push(hV)}}IP.length>0&&b0.push([lV,IP])}}var P2={entries:function(){return b0},forEach:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=kDe(b0),i;try{for(r.s();!(i=r.n()).done;){var s=RP(i.value,2),o=s[0],a=s[1];e.call(n,a,o,b0)}}catch(c){r.e(c)}finally{r.f()}},get:function(e){var n=b0.find(function(r){return r[0]===e});return n&&n[1]},has:function(e){return!!P2.get(e)},keys:function(){return b0.map(function(e){var n=RP(e,1),r=n[0];return r})},values:function(){return b0.map(function(e){var n=RP(e,2),r=n[1];return r})}},NDe=(0,ADe.default)(P2,P2.entries());ak.default=NDe;Object.defineProperty(Ah,"__esModule",{value:!0});var bh=Ah.roles=DY=Ah.roleElements=PY=Ah.elementRoles=Ah.dom=Ah.aria=void 0,PDe=XT(TM),DDe=XT(CM),LDe=XT(ZE),UDe=XT(ok),FDe=XT(ak);function XT(t){return t&&t.__esModule?t:{default:t}}var BDe=PDe.default;Ah.aria=BDe;var jDe=DDe.default;Ah.dom=jDe;var $De=LDe.default;bh=Ah.roles=$De;var HDe=UDe.default,PY=Ah.elementRoles=HDe,VDe=FDe.default,DY=Ah.roleElements=VDe,$B={exports:{}};$B.exports;(function(t){var e=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(c,l){if(!s[c]){s[c]={};for(var u=0;u<c.length;u++)s[c][c.charAt(u)]=u}return s[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(u){return r.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return o(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),u=new Uint8Array(l.length*2),d=0,h=l.length;d<h;d++){var f=l.charCodeAt(d);u[d*2]=f>>>8,u[d*2+1]=f%256}return u},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),u=0,d=l.length;u<d;u++)l[u]=c[u*2]*256+c[u*2+1];var h=[];return l.forEach(function(f){h.push(n(f))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return i.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return o(i,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return n(l)})},_compress:function(c,l,u){if(c==null)return"";var d,h,f={},p={},g="",v="",E="",T=2,C=3,A=2,k=[],I=0,N=0,U;for(U=0;U<c.length;U+=1)if(g=c.charAt(U),Object.prototype.hasOwnProperty.call(f,g)||(f[g]=C++,p[g]=!0),v=E+g,Object.prototype.hasOwnProperty.call(f,v))E=v;else{if(Object.prototype.hasOwnProperty.call(p,E)){if(E.charCodeAt(0)<256){for(d=0;d<A;d++)I=I<<1,N==l-1?(N=0,k.push(u(I)),I=0):N++;for(h=E.charCodeAt(0),d=0;d<8;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1}else{for(h=1,d=0;d<A;d++)I=I<<1|h,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=0;for(h=E.charCodeAt(0),d=0;d<16;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1}T--,T==0&&(T=Math.pow(2,A),A++),delete p[E]}else for(h=f[E],d=0;d<A;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1;T--,T==0&&(T=Math.pow(2,A),A++),f[v]=C++,E=String(g)}if(E!==""){if(Object.prototype.hasOwnProperty.call(p,E)){if(E.charCodeAt(0)<256){for(d=0;d<A;d++)I=I<<1,N==l-1?(N=0,k.push(u(I)),I=0):N++;for(h=E.charCodeAt(0),d=0;d<8;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1}else{for(h=1,d=0;d<A;d++)I=I<<1|h,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=0;for(h=E.charCodeAt(0),d=0;d<16;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1}T--,T==0&&(T=Math.pow(2,A),A++),delete p[E]}else for(h=f[E],d=0;d<A;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1;T--,T==0&&(T=Math.pow(2,A),A++)}for(h=2,d=0;d<A;d++)I=I<<1|h&1,N==l-1?(N=0,k.push(u(I)),I=0):N++,h=h>>1;for(;;)if(I=I<<1,N==l-1){k.push(u(I));break}else N++;return k.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var d=[],h=4,f=4,p=3,g="",v=[],E,T,C,A,k,I,N,U={val:u(0),position:l,index:1};for(E=0;E<3;E+=1)d[E]=E;for(C=0,k=Math.pow(2,2),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),C|=(A>0?1:0)*I,I<<=1;switch(C){case 0:for(C=0,k=Math.pow(2,8),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),C|=(A>0?1:0)*I,I<<=1;N=n(C);break;case 1:for(C=0,k=Math.pow(2,16),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),C|=(A>0?1:0)*I,I<<=1;N=n(C);break;case 2:return""}for(d[3]=N,T=N,v.push(N);;){if(U.index>c)return"";for(C=0,k=Math.pow(2,p),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),C|=(A>0?1:0)*I,I<<=1;switch(N=C){case 0:for(C=0,k=Math.pow(2,8),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),C|=(A>0?1:0)*I,I<<=1;d[f++]=n(C),N=f-1,h--;break;case 1:for(C=0,k=Math.pow(2,16),I=1;I!=k;)A=U.val&U.position,U.position>>=1,U.position==0&&(U.position=l,U.val=u(U.index++)),C|=(A>0?1:0)*I,I<<=1;d[f++]=n(C),N=f-1,h--;break;case 2:return v.join("")}if(h==0&&(h=Math.pow(2,p),p++),d[N])g=d[N];else if(N===f)g=T+T.charAt(0);else return null;v.push(g),d[f++]=T+g.charAt(0),h--,T=g,h==0&&(h=Math.pow(2,p),p++)}}};return a}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})($B);var zDe=$B.exports;const GDe=Yc(zDe);var D2={};function LY(t){return t.replace(/</g,"&lt;").replace(/>/g,"&gt;")}const qDe=(t,e,n,r,i,s,o)=>{const a=r+n.indent,c=n.colors;return t.map(l=>{const u=e[l];let d=o(u,n,a,i,s);return typeof u!="string"&&(d.indexOf(`
`)!==-1&&(d=n.spacingOuter+a+d+n.spacingOuter+r),d="{"+d+"}"),n.spacingInner+r+c.prop.open+l+c.prop.close+"="+c.value.open+d+c.value.close}).join("")},WDe=3,KDe=(t,e,n,r,i,s)=>t.map(o=>{const a=typeof o=="string"?UY(o,e):s(o,e,n,r,i);return a===""&&typeof o=="object"&&o!==null&&o.nodeType!==WDe?"":e.spacingOuter+n+a}).join(""),UY=(t,e)=>{const n=e.colors.content;return n.open+LY(t)+n.close},YDe=(t,e)=>{const n=e.colors.comment;return n.open+"<!--"+LY(t)+"-->"+n.close},XDe=(t,e,n,r,i)=>{const s=r.colors.tag;return s.open+"<"+t+(e&&s.close+e+r.spacingOuter+i+s.open)+(n?">"+s.close+n+r.spacingOuter+i+s.open+"</"+t:(e&&!r.min?"":" ")+"/")+">"+s.close},JDe=(t,e)=>{const n=e.colors.tag;return n.open+"<"+t+n.close+" "+n.open+" />"+n.close},QDe=1,FY=3,BY=8,jY=11,ZDe=/^((HTML|SVG)\w*)?Element$/,$Y=t=>{const{tagName:e}=t;return!!(typeof e=="string"&&e.includes("-")||typeof t.hasAttribute=="function"&&t.hasAttribute("is"))},eLe=t=>{const e=t.constructor.name,{nodeType:n}=t;return n===QDe&&(ZDe.test(e)||$Y(t))||n===FY&&e==="Text"||n===BY&&e==="Comment"||n===jY&&e==="DocumentFragment"};function tLe(t){return t.nodeType===FY}function nLe(t){return t.nodeType===BY}function kP(t){return t.nodeType===jY}function rLe(t){return{test:e=>{var n;return((e==null||(n=e.constructor)==null?void 0:n.name)||$Y(e))&&eLe(e)},serialize:(e,n,r,i,s,o)=>{if(tLe(e))return UY(e.data,n);if(nLe(e))return YDe(e.data,n);const a=kP(e)?"DocumentFragment":e.tagName.toLowerCase();return++i>n.maxDepth?JDe(a,n):XDe(a,qDe(kP(e)?[]:Array.from(e.attributes).map(c=>c.name).sort(),kP(e)?{}:Array.from(e.attributes).reduce((c,l)=>(c[l.name]=l.value,c),{}),n,r+n.indent,i,s,o),KDe(Array.prototype.slice.call(e.childNodes||e.children).filter(t),n,r+n.indent,i,s,o),n,r)}}}let HY=null,HB=null,VB=null;try{const t=module&&module.require;HB=t.call(module,"fs").readFileSync,VB=t.call(module,"@babel/code-frame").codeFrameColumns,HY=t.call(module,"chalk")}catch{}function iLe(t){const e=t.indexOf("(")+1,n=t.indexOf(")"),r=t.slice(e,n),i=r.split(":"),[s,o,a]=[i[0],parseInt(i[1],10),parseInt(i[2],10)];let c="";try{c=HB(s,"utf-8")}catch{return""}const l=VB(c,{start:{line:o,column:a}},{highlightCode:!0,linesBelow:0});return HY.dim(r)+`
`+l+`
`}function sLe(){if(!HB||!VB)return"";const e=new Error().stack.split(`
`).slice(1).find(n=>!n.includes("node_modules/"));return iLe(e)}const VY=3;function NP(){return typeof jest<"u"&&jest!==null?setTimeout._isMockFunction===!0||Object.prototype.hasOwnProperty.call(setTimeout,"clock"):!1}function zB(){if(typeof window>"u")throw new Error("Could not find default container");return window.document}function oLe(t){if(t.defaultView)return t.defaultView;if(t.ownerDocument&&t.ownerDocument.defaultView)return t.ownerDocument.defaultView;if(t.window)return t.window;throw t.ownerDocument&&t.ownerDocument.defaultView===null?new Error("It looks like the window object is not available for the provided node."):t.then instanceof Function?new Error("It looks like you passed a Promise object instead of a DOM node. Did you do something like `fireEvent.click(screen.findBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`, or await the findBy query `fireEvent.click(await screen.findBy...`?"):Array.isArray(t)?new Error("It looks like you passed an Array instead of a DOM node. Did you do something like `fireEvent.click(screen.getAllBy...` when you meant to use a `getBy` query `fireEvent.click(screen.getBy...`?"):typeof t.debug=="function"&&typeof t.logTestingPlaygroundURL=="function"?new Error("It looks like you passed a `screen` object. Did you do something like `fireEvent.click(screen, ...` when you meant to use a query, e.g. `fireEvent.click(screen.getBy..., `?"):new Error("The given node is not an Element, the node type is: "+typeof t+".")}function wg(t){if(!t||typeof t.querySelector!="function"||typeof t.querySelectorAll!="function")throw new TypeError("Expected container to be an Element, a Document or a DocumentFragment but got "+e(t)+".");function e(n){return typeof n=="object"?n===null?"null":n.constructor.name:typeof n}}const aLe=()=>{if(typeof Hn>"u")return!1;let t;try{var e;const n=(e=D2)==null?void 0:e.COLORS;n&&(t=JSON.parse(n))}catch{}return typeof t=="boolean"?t:Hn.versions!==void 0&&Hn.versions.node!==void 0},{DOMCollection:cLe}=rY,lLe=1,uLe=8;function dLe(t){return t.nodeType!==uLe&&(t.nodeType!==lLe||!t.matches(Bi().defaultIgnore))}function OR(t,e,n){if(n===void 0&&(n={}),t||(t=zB().body),typeof e!="number"&&(e=typeof Hn<"u"&&typeof D2<"u"&&D2.DEBUG_PRINT_LIMIT||7e3),e===0)return"";t.documentElement&&(t=t.documentElement);let r=typeof t;if(r==="object"?r=t.constructor.name:t={},!("outerHTML"in t))throw new TypeError("Expected an element or document but got "+r);const{filterNode:i=dLe,...s}=n,o=GCe(t,{plugins:[rLe(i),cLe],printFunctionName:!1,highlight:aLe(),...s});return e!==void 0&&t.outerHTML.length>e?o.slice(0,e)+"...":o}const fV=function(){const t=sLe();console.log(t?OR(...arguments)+`

`+t:OR(...arguments))};let kR={testIdAttribute:"data-testid",asyncUtilTimeout:1e3,asyncWrapper:t=>t(),unstable_advanceTimersWrapper:t=>t(),eventWrapper:t=>t(),defaultHidden:!1,defaultIgnore:"script, style",showOriginalStackTrace:!1,throwSuggestions:!1,getElementError(t,e){const n=OR(e),r=new Error([t,"Ignored nodes: comments, "+kR.defaultIgnore+`
`+n].filter(Boolean).join(`

`));return r.name="TestingLibraryElementError",r},_disableExpensiveErrorDiagnostics:!1,computedStyleSupportsPseudoElements:!1};function hLe(t){try{return kR._disableExpensiveErrorDiagnostics=!0,t()}finally{kR._disableExpensiveErrorDiagnostics=!1}}function Bi(){return kR}const fLe=["button","meter","output","progress","select","textarea","input"];function zY(t){return fLe.includes(t.nodeName.toLowerCase())?"":t.nodeType===VY?t.textContent:Array.from(t.childNodes).map(e=>zY(e)).join("")}function L2(t){let e;return t.tagName.toLowerCase()==="label"?e=zY(t):e=t.value||t.textContent,e}function GY(t){if(t.labels!==void 0){var e;return(e=t.labels)!=null?e:[]}if(!pLe(t))return[];const n=t.ownerDocument.querySelectorAll("label");return Array.from(n).filter(r=>r.control===t)}function pLe(t){return/BUTTON|METER|OUTPUT|PROGRESS|SELECT|TEXTAREA/.test(t.tagName)||t.tagName==="INPUT"&&t.getAttribute("type")!=="hidden"}function qY(t,e,n){let{selector:r="*"}=n===void 0?{}:n;const i=e.getAttribute("aria-labelledby"),s=i?i.split(" "):[];return s.length?s.map(o=>{const a=t.querySelector('[id="'+o+'"]');return a?{content:L2(a),formControl:null}:{content:"",formControl:null}}):Array.from(GY(e)).map(o=>{const a=L2(o),l=Array.from(o.querySelectorAll("button, input, meter, output, progress, select, textarea")).filter(u=>u.matches(r))[0];return{content:a,formControl:l}})}function WY(t){if(t==null)throw new Error("It looks like "+t+" was passed instead of a matcher. Did you do something like getByText("+t+")?")}function eS(t,e,n,r){if(typeof t!="string")return!1;WY(n);const i=r(t);return typeof n=="string"||typeof n=="number"?i.toLowerCase().includes(n.toString().toLowerCase()):typeof n=="function"?n(i,e):YY(n,i)}function Zm(t,e,n,r){if(typeof t!="string")return!1;WY(n);const i=r(t);return n instanceof Function?n(i,e):n instanceof RegExp?YY(n,i):i===String(n)}function KY(t){let{trim:e=!0,collapseWhitespace:n=!0}=t===void 0?{}:t;return r=>{let i=r;return i=e?i.trim():i,i=n?i.replace(/\s+/g," "):i,i}}function Ey(t){let{trim:e,collapseWhitespace:n,normalizer:r}=t;if(!r)return KY({trim:e,collapseWhitespace:n});if(typeof e<"u"||typeof n<"u")throw new Error('trim and collapseWhitespace are not supported with a normalizer. If you want to use the default trim and collapseWhitespace logic in your normalizer, use "getDefaultNormalizer({trim, collapseWhitespace})" and compose that into your normalizer');return r}function YY(t,e){const n=t.test(e);return t.global&&t.lastIndex!==0&&(console.warn("To match all elements we had to reset the lastIndex of the RegExp because the global flag is enabled. We encourage to remove the global flag from the RegExp."),t.lastIndex=0),n}function ck(t){return t.matches("input[type=submit], input[type=button], input[type=reset]")?t.value:Array.from(t.childNodes).filter(e=>e.nodeType===VY&&!!e.textContent).map(e=>e.textContent).join("")}const mLe=gLe(PY);function XY(t){return t.hidden===!0||t.getAttribute("aria-hidden")==="true"||t.ownerDocument.defaultView.getComputedStyle(t).display==="none"}function GB(t,e){e===void 0&&(e={});const{isSubtreeInaccessible:n=XY}=e;if(t.ownerDocument.defaultView.getComputedStyle(t).visibility==="hidden")return!0;let i=t;for(;i;){if(n(i))return!0;i=i.parentElement}return!1}function qB(t){for(const{match:e,roles:n}of mLe)if(e(t))return[...n];return[]}function gLe(t){function e(o){let{name:a,attributes:c}=o;return""+a+c.map(l=>{let{name:u,value:d,constraints:h=[]}=l;const f=h.indexOf("undefined")!==-1,p=h.indexOf("set")!==-1;return typeof d<"u"?"["+u+'="'+d+'"]':f?":not(["+u+"])":p?"["+u+"]:not(["+u+'=""])':"["+u+"]"}).join("")}function n(o){let{attributes:a=[]}=o;return a.length}function r(o,a){let{specificity:c}=o,{specificity:l}=a;return l-c}function i(o){let{attributes:a=[]}=o;const c=a.findIndex(u=>u.value&&u.name==="type"&&u.value==="text");c>=0&&(a=[...a.slice(0,c),...a.slice(c+1)]);const l=e({...o,attributes:a});return u=>c>=0&&u.type!=="text"?!1:u.matches(l)}let s=[];for(const[o,a]of t.entries())s=[...s,{match:i(o),roles:Array.from(a),specificity:n(o)}];return s.sort(r)}function vLe(t,e){let{hidden:n=!1}=e===void 0?{}:e;function r(i){return[i,...Array.from(i.children).reduce((s,o)=>[...s,...r(o)],[])]}return r(t).filter(i=>n===!1?GB(i)===!1:!0).reduce((i,s)=>{let o=[];return s.hasAttribute("role")?o=s.getAttribute("role").split(" ").slice(0,1):o=qB(s),o.reduce((a,c)=>Array.isArray(a[c])?{...a,[c]:[...a[c],s]}:{...a,[c]:[s]},i)},{})}function _Le(t,e){let{hidden:n,includeDescription:r}=e;const i=vLe(t,{hidden:n});return Object.entries(i).filter(s=>{let[o]=s;return o!=="generic"}).map(s=>{let[o,a]=s;const c="-".repeat(50),l=a.map(u=>{const d='Name "'+BB(u,{computedStyleSupportsPseudoElements:Bi().computedStyleSupportsPseudoElements})+`":
`,h=OR(u.cloneNode(!1));if(r){const f='Description "'+SY(u,{computedStyleSupportsPseudoElements:Bi().computedStyleSupportsPseudoElements})+`":
`;return""+d+f+h}return""+d+h}).join(`

`);return o+`:

`+l+`

`+c}).join(`
`)}function yLe(t){return t.tagName==="OPTION"?t.selected:JT(t,"aria-selected")}function bLe(t){return t.getAttribute("aria-busy")==="true"}function ELe(t){if(!("indeterminate"in t&&t.indeterminate))return"checked"in t?t.checked:JT(t,"aria-checked")}function SLe(t){return JT(t,"aria-pressed")}function wLe(t){var e,n;return(e=(n=JT(t,"aria-current"))!=null?n:t.getAttribute("aria-current"))!=null?e:!1}function TLe(t){return JT(t,"aria-expanded")}function JT(t,e){const n=t.getAttribute(e);if(n==="true")return!0;if(n==="false")return!1}function xLe(t){const e={H1:1,H2:2,H3:3,H4:4,H5:5,H6:6};return t.getAttribute("aria-level")&&Number(t.getAttribute("aria-level"))||e[t.tagName]}function CLe(t){const e=t.getAttribute("aria-valuenow");return e===null?void 0:+e}function RLe(t){const e=t.getAttribute("aria-valuemax");return e===null?void 0:+e}function ALe(t){const e=t.getAttribute("aria-valuemin");return e===null?void 0:+e}function MLe(t){const e=t.getAttribute("aria-valuetext");return e===null?void 0:e}const pV=KY();function ILe(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function mV(t){return new RegExp(ILe(t.toLowerCase()),"i")}function pv(t,e,n,r){let{variant:i,name:s}=r,o="";const a={},c=[["Role","TestId"].includes(t)?n:mV(n)];s&&(a.name=mV(s)),t==="Role"&&GB(e)&&(a.hidden=!0,o=`Element is inaccessible. This means that the element and all its children are invisible to screen readers.
    If you are using the aria-hidden prop, make sure this is the right choice for your case.
    `),Object.keys(a).length>0&&c.push(a);const l=i+"By"+t;return{queryName:t,queryMethod:l,queryArgs:c,variant:i,warning:o,toString(){o&&console.warn(o);let[u,d]=c;return u=typeof u=="string"?"'"+u+"'":u,d=d?", { "+Object.entries(d).map(h=>{let[f,p]=h;return f+": "+p}).join(", ")+" }":"",l+"("+u+d+")"}}}function mv(t,e,n){return n&&!e}function U2(t,e,n){var r,i;if(e===void 0&&(e="get"),t.matches(Bi().defaultIgnore))return;const s=(r=t.getAttribute("role"))!=null?r:(i=qB(t))==null?void 0:i[0];if(s!=="generic"&&mv("Role",n,s))return pv("Role",t,s,{variant:e,name:BB(t,{computedStyleSupportsPseudoElements:Bi().computedStyleSupportsPseudoElements})});const o=qY(document,t).map(h=>h.content).join(" ");if(mv("LabelText",n,o))return pv("LabelText",t,o,{variant:e});const a=t.getAttribute("placeholder");if(mv("PlaceholderText",n,a))return pv("PlaceholderText",t,a,{variant:e});const c=pV(ck(t));if(mv("Text",n,c))return pv("Text",t,c,{variant:e});if(mv("DisplayValue",n,t.value))return pv("DisplayValue",t,pV(t.value),{variant:e});const l=t.getAttribute("alt");if(mv("AltText",n,l))return pv("AltText",t,l,{variant:e});const u=t.getAttribute("title");if(mv("Title",n,u))return pv("Title",t,u,{variant:e});const d=t.getAttribute(Bi().testIdAttribute);if(mv("TestId",n,d))return pv("TestId",t,d,{variant:e})}function IC(t,e){t.stack=e.stack.replace(e.message,t.message)}function OLe(t,e){let{container:n=zB(),timeout:r=Bi().asyncUtilTimeout,showOriginalStackTrace:i=Bi().showOriginalStackTrace,stackTraceError:s,interval:o=50,onTimeout:a=l=>(Object.defineProperty(l,"message",{value:Bi().getElementError(l.message,n).message}),l),mutationObserverOptions:c={subtree:!0,childList:!0,attributes:!0,characterData:!0}}=e;if(typeof t!="function")throw new TypeError("Received `callback` arg must be a function");return new Promise(async(l,u)=>{let d,h,f,p=!1,g="idle";const v=setTimeout(k,r),E=NP();if(E){const{unstable_advanceTimersWrapper:I}=Bi();for(A();!p;){if(!NP()){const N=new Error("Changed from using fake timers to real timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to real timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");i||IC(N,s),u(N);return}if(await I(async()=>{jest.advanceTimersByTime(o)}),p)break;A()}}else{try{wg(n)}catch(N){u(N);return}h=setInterval(C,o);const{MutationObserver:I}=oLe(n);f=new I(C),f.observe(n,c),A()}function T(I,N){p=!0,clearTimeout(v),E||(clearInterval(h),f.disconnect()),I?u(I):l(N)}function C(){if(NP()){const I=new Error("Changed from using real timers to fake timers while using waitFor. This is not allowed and will result in very strange behavior. Please ensure you're awaiting all async things your test is doing before changing to fake timers. For more info, please go to https://github.com/testing-library/dom-testing-library/issues/830");return i||IC(I,s),u(I)}else return A()}function A(){if(g!=="pending")try{const I=hLe(t);typeof(I==null?void 0:I.then)=="function"?(g="pending",I.then(N=>{g="resolved",T(null,N)},N=>{g="rejected",d=N})):T(null,I)}catch(I){d=I}}function k(){let I;d?(I=d,!i&&I.name==="TestingLibraryElementError"&&IC(I,s)):(I=new Error("Timed out in waitFor."),i||IC(I,s)),T(a(I),null)}})}function kLe(t,e){const n=new Error("STACK_TRACE_MESSAGE");return Bi().asyncWrapper(()=>OLe(t,{stackTraceError:n,...e}))}function JY(t,e){return Bi().getElementError(t,e)}function NLe(t,e){return JY(t+"\n\n(If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).",e)}function lk(t,e,n,r){let{exact:i=!0,collapseWhitespace:s,trim:o,normalizer:a}=r===void 0?{}:r;const c=i?Zm:eS,l=Ey({collapseWhitespace:s,trim:o,normalizer:a});return Array.from(e.querySelectorAll("["+t+"]")).filter(u=>c(u.getAttribute(t),u,n,l))}function NR(t,e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];const o=t(n,...i);if(o.length>1){const a=o.map(c=>JY(null,c).message).join(`

`);throw NLe(e(n,...i)+`

Here are the matching elements:

`+a,n)}return o[0]||null}}function QY(t,e){return Bi().getElementError(`A better query is available, try this:
`+t.toString()+`
`,e)}function PLe(t,e){return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];const o=t(n,...i);if(!o.length)throw Bi().getElementError(e(n,...i),n);return o}}function PR(t){return(e,n,r,i)=>kLe(()=>t(e,n,r),{container:e,...i})}const Qb=(t,e,n)=>function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];const a=t(r,...s),[{suggest:c=Bi().throwSuggestions}={}]=s.slice(-1);if(a&&c){const l=U2(a,n);if(l&&!e.endsWith(l.queryName))throw QY(l.toString(),r)}return a},Dd=(t,e,n)=>function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];const a=t(r,...s),[{suggest:c=Bi().throwSuggestions}={}]=s.slice(-1);if(a.length&&c){const l=[...new Set(a.map(u=>{var d;return(d=U2(u,n))==null?void 0:d.toString()}))];if(l.length===1&&!e.endsWith(U2(a[0],n).queryName))throw QY(l[0],r)}return a};function Sy(t,e,n){const r=Qb(NR(t,e),t.name,"query"),i=PLe(t,n),s=NR(i,e),o=Qb(s,t.name,"get"),a=Dd(i,t.name.replace("query","get"),"getAll"),c=PR(Dd(i,t.name,"findAll")),l=PR(Qb(s,t.name,"find"));return[r,a,o,c,l]}function DLe(t){return Array.from(t.querySelectorAll("label,input")).map(e=>({node:e,textToMatch:L2(e)})).filter(e=>{let{textToMatch:n}=e;return n!==null})}const LLe=function(t,e,n){let{exact:r=!0,trim:i,collapseWhitespace:s,normalizer:o}=n===void 0?{}:n;const a=r?Zm:eS,c=Ey({collapseWhitespace:s,trim:i,normalizer:o});return DLe(t).filter(u=>{let{node:d,textToMatch:h}=u;return a(h,d,e,c)}).map(u=>{let{node:d}=u;return d})},zw=function(t,e,n){let{selector:r="*",exact:i=!0,collapseWhitespace:s,trim:o,normalizer:a}=n===void 0?{}:n;wg(t);const c=i?Zm:eS,l=Ey({collapseWhitespace:s,trim:o,normalizer:a}),u=Array.from(t.querySelectorAll("*")).filter(d=>GY(d).length||d.hasAttribute("aria-labelledby")).reduce((d,h)=>{const f=qY(t,h,{selector:r});f.filter(g=>!!g.formControl).forEach(g=>{c(g.content,g.formControl,e,l)&&g.formControl&&d.push(g.formControl)});const p=f.filter(g=>!!g.content).map(g=>g.content);return c(p.join(" "),h,e,l)&&d.push(h),p.length>1&&p.forEach((g,v)=>{c(g,h,e,l)&&d.push(h);const E=[...p];E.splice(v,1),E.length>1&&c(E.join(" "),h,e,l)&&d.push(h)}),d},[]).concat(lk("aria-label",t,e,{exact:i,normalizer:l}));return Array.from(new Set(u)).filter(d=>d.matches(r))},ty=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const s=zw(t,e,...r);if(!s.length){const o=LLe(t,e,...r);if(o.length){const a=o.map(c=>ULe(t,c)).filter(c=>!!c);throw a.length?Bi().getElementError(a.map(c=>"Found a label with the text of: "+e+", however the element associated with this label (<"+c+" />) is non-labellable [https://html.spec.whatwg.org/multipage/forms.html#category-label]. If you really need to label a <"+c+" />, you can use aria-label or aria-labelledby instead.").join(`

`),t):Bi().getElementError("Found a label with the text of: "+e+`, however no form control was found associated to that label. Make sure you're using the "for" attribute or "aria-labelledby" attribute correctly.`,t)}else throw Bi().getElementError("Unable to find a label with the text of: "+e,t)}return s};function ULe(t,e){const n=e.getAttribute("for");if(!n)return null;const r=t.querySelector('[id="'+n+'"]');return r?r.tagName.toLowerCase():null}const ZY=(t,e)=>"Found multiple elements with the text of: "+e,FLe=Qb(NR(zw,ZY),zw.name,"query"),eX=NR(ty,ZY),BLe=PR(Dd(ty,ty.name,"findAll")),jLe=PR(Qb(eX,ty.name,"find")),$Le=Dd(ty,ty.name,"getAll"),HLe=Qb(eX,ty.name,"get"),VLe=Dd(zw,zw.name,"queryAll"),F2=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return wg(e[0]),lk("placeholder",...e)},zLe=(t,e)=>"Found multiple elements with the placeholder text of: "+e,GLe=(t,e)=>"Unable to find an element with the placeholder text of: "+e,qLe=Dd(F2,F2.name,"queryAll"),[WLe,KLe,YLe,XLe,JLe]=Sy(F2,zLe,GLe),B2=function(t,e,n){let{selector:r="*",exact:i=!0,collapseWhitespace:s,trim:o,ignore:a=Bi().defaultIgnore,normalizer:c}=n===void 0?{}:n;wg(t);const l=i?Zm:eS,u=Ey({collapseWhitespace:s,trim:o,normalizer:c});let d=[];return typeof t.matches=="function"&&t.matches(r)&&(d=[t]),[...d,...Array.from(t.querySelectorAll(r))].filter(h=>!a||!h.matches(a)).filter(h=>l(ck(h),h,e,u))},QLe=(t,e)=>"Found multiple elements with the text: "+e,ZLe=function(t,e,n){n===void 0&&(n={});const{collapseWhitespace:r,trim:i,normalizer:s,selector:o}=n,c=Ey({collapseWhitespace:r,trim:i,normalizer:s})(e.toString()),l=c!==e.toString(),u=(o??"*")!=="*";return"Unable to find an element with the text: "+(l?c+" (normalized from '"+e+"')":e)+(u?", which matches selector '"+o+"'":"")+". This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible."},e2e=Dd(B2,B2.name,"queryAll"),[t2e,n2e,r2e,i2e,s2e]=Sy(B2,QLe,ZLe),j2=function(t,e,n){let{exact:r=!0,collapseWhitespace:i,trim:s,normalizer:o}=n===void 0?{}:n;wg(t);const a=r?Zm:eS,c=Ey({collapseWhitespace:i,trim:s,normalizer:o});return Array.from(t.querySelectorAll("input,textarea,select")).filter(l=>l.tagName==="SELECT"?Array.from(l.options).filter(d=>d.selected).some(d=>a(ck(d),d,e,c)):a(l.value,l,e,c))},o2e=(t,e)=>"Found multiple elements with the display value: "+e+".",a2e=(t,e)=>"Unable to find an element with the display value: "+e+".",c2e=Dd(j2,j2.name,"queryAll"),[l2e,u2e,d2e,h2e,f2e]=Sy(j2,o2e,a2e),p2e=/^(img|input|area|.+-.+)$/i,$2=function(t,e,n){return n===void 0&&(n={}),wg(t),lk("alt",t,e,n).filter(r=>p2e.test(r.tagName))},m2e=(t,e)=>"Found multiple elements with the alt text: "+e,g2e=(t,e)=>"Unable to find an element with the alt text: "+e,v2e=Dd($2,$2.name,"queryAll"),[_2e,y2e,b2e,E2e,S2e]=Sy($2,m2e,g2e),w2e=t=>{var e;return t.tagName.toLowerCase()==="title"&&((e=t.parentElement)==null?void 0:e.tagName.toLowerCase())==="svg"},H2=function(t,e,n){let{exact:r=!0,collapseWhitespace:i,trim:s,normalizer:o}=n===void 0?{}:n;wg(t);const a=r?Zm:eS,c=Ey({collapseWhitespace:i,trim:s,normalizer:o});return Array.from(t.querySelectorAll("[title], svg > title")).filter(l=>a(l.getAttribute("title"),l,e,c)||w2e(l)&&a(ck(l),l,e,c))},T2e=(t,e)=>"Found multiple elements with the title: "+e+".",x2e=(t,e)=>"Unable to find an element with the title: "+e+".",C2e=Dd(H2,H2.name,"queryAll"),[R2e,A2e,M2e,I2e,O2e]=Sy(H2,T2e,x2e),V2=function(t,e,n){let{hidden:r=Bi().defaultHidden,name:i,description:s,queryFallbacks:o=!1,selected:a,busy:c,checked:l,pressed:u,current:d,level:h,expanded:f,value:{now:p,min:g,max:v,text:E}={}}=n===void 0?{}:n;if(wg(t),a!==void 0){var T;if(((T=bh.get(e))==null?void 0:T.props["aria-selected"])===void 0)throw new Error('"aria-selected" is not supported on role "'+e+'".')}if(c!==void 0){var C;if(((C=bh.get(e))==null?void 0:C.props["aria-busy"])===void 0)throw new Error('"aria-busy" is not supported on role "'+e+'".')}if(l!==void 0){var A;if(((A=bh.get(e))==null?void 0:A.props["aria-checked"])===void 0)throw new Error('"aria-checked" is not supported on role "'+e+'".')}if(u!==void 0){var k;if(((k=bh.get(e))==null?void 0:k.props["aria-pressed"])===void 0)throw new Error('"aria-pressed" is not supported on role "'+e+'".')}if(d!==void 0){var I;if(((I=bh.get(e))==null?void 0:I.props["aria-current"])===void 0)throw new Error('"aria-current" is not supported on role "'+e+'".')}if(h!==void 0&&e!=="heading")throw new Error('Role "'+e+'" cannot have "level" property.');if(p!==void 0){var N;if(((N=bh.get(e))==null?void 0:N.props["aria-valuenow"])===void 0)throw new Error('"aria-valuenow" is not supported on role "'+e+'".')}if(v!==void 0){var U;if(((U=bh.get(e))==null?void 0:U.props["aria-valuemax"])===void 0)throw new Error('"aria-valuemax" is not supported on role "'+e+'".')}if(g!==void 0){var F;if(((F=bh.get(e))==null?void 0:F.props["aria-valuemin"])===void 0)throw new Error('"aria-valuemin" is not supported on role "'+e+'".')}if(E!==void 0){var $;if((($=bh.get(e))==null?void 0:$.props["aria-valuetext"])===void 0)throw new Error('"aria-valuetext" is not supported on role "'+e+'".')}if(f!==void 0){var X;if(((X=bh.get(e))==null?void 0:X.props["aria-expanded"])===void 0)throw new Error('"aria-expanded" is not supported on role "'+e+'".')}const q=new WeakMap;function W(K){return q.has(K)||q.set(K,XY(K)),q.get(K)}return Array.from(t.querySelectorAll(k2e(e))).filter(K=>{if(K.hasAttribute("role")){const ie=K.getAttribute("role");if(o)return ie.split(" ").filter(Boolean).some(Z=>Z===e);const[G]=ie.split(" ");return G===e}return qB(K).some(ie=>ie===e)}).filter(K=>{if(a!==void 0)return a===yLe(K);if(c!==void 0)return c===bLe(K);if(l!==void 0)return l===ELe(K);if(u!==void 0)return u===SLe(K);if(d!==void 0)return d===wLe(K);if(f!==void 0)return f===TLe(K);if(h!==void 0)return h===xLe(K);if(p!==void 0||v!==void 0||g!==void 0||E!==void 0){let Q=!0;if(p!==void 0&&Q&&(Q=p===CLe(K)),v!==void 0&&Q&&(Q=v===RLe(K)),g!==void 0&&Q&&(Q=g===ALe(K)),E!==void 0){var ne;Q&&(Q=Zm((ne=MLe(K))!=null?ne:null,K,E,ie=>ie))}return Q}return!0}).filter(K=>i===void 0?!0:Zm(BB(K,{computedStyleSupportsPseudoElements:Bi().computedStyleSupportsPseudoElements}),K,i,ne=>ne)).filter(K=>s===void 0?!0:Zm(SY(K,{computedStyleSupportsPseudoElements:Bi().computedStyleSupportsPseudoElements}),K,s,ne=>ne)).filter(K=>r===!1?GB(K,{isSubtreeInaccessible:W})===!1:!0)};function k2e(t){var e;const n='*[role~="'+t+'"]',r=(e=DY.get(t))!=null?e:new Set,i=new Set(Array.from(r).map(s=>{let{name:o}=s;return o}));return[n].concat(Array.from(i)).join(",")}const tX=t=>{let e="";return t===void 0?e="":typeof t=="string"?e=' and name "'+t+'"':e=" and name `"+t+"`",e},N2e=function(t,e,n){let{name:r}=n===void 0?{}:n;return'Found multiple elements with the role "'+e+'"'+tX(r)},P2e=function(t,e,n){let{hidden:r=Bi().defaultHidden,name:i,description:s}=n===void 0?{}:n;if(Bi()._disableExpensiveErrorDiagnostics)return'Unable to find role="'+e+'"'+tX(i);let o="";Array.from(t.children).forEach(u=>{o+=_Le(u,{hidden:r,includeDescription:s!==void 0})});let a;o.length===0?r===!1?a="There are no accessible roles. But there might be some inaccessible roles. If you wish to access them, then set the `hidden` option to `true`. Learn more about this here: https://testing-library.com/docs/dom-testing-library/api-queries#byrole":a="There are no available roles.":a=(`
Here are the `+(r===!1?"accessible":"available")+` roles:

  `+o.replace(/\n/g,`
  `).replace(/\n\s\s\n/g,`

`)+`
`).trim();let c="";i===void 0?c="":typeof i=="string"?c=' and name "'+i+'"':c=" and name `"+i+"`";let l="";return s===void 0?l="":typeof s=="string"?l=' and description "'+s+'"':l=" and description `"+s+"`",(`
Unable to find an `+(r===!1?"accessible ":"")+'element with the role "'+e+'"'+c+l+`

`+a).trim()},D2e=Dd(V2,V2.name,"queryAll"),[L2e,U2e,F2e,B2e,j2e]=Sy(V2,N2e,P2e),WB=()=>Bi().testIdAttribute,z2=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return wg(e[0]),lk(WB(),...e)},$2e=(t,e)=>"Found multiple elements by: ["+WB()+'="'+e+'"]',H2e=(t,e)=>"Unable to find an element by: ["+WB()+'="'+e+'"]',V2e=Dd(z2,z2.name,"queryAll"),[z2e,G2e,q2e,W2e,K2e]=Sy(z2,$2e,H2e);var G2=Object.freeze({__proto__:null,queryAllByLabelText:VLe,queryByLabelText:FLe,getAllByLabelText:$Le,getByLabelText:HLe,findAllByLabelText:BLe,findByLabelText:jLe,queryByPlaceholderText:WLe,queryAllByPlaceholderText:qLe,getByPlaceholderText:YLe,getAllByPlaceholderText:KLe,findAllByPlaceholderText:XLe,findByPlaceholderText:JLe,queryByText:t2e,queryAllByText:e2e,getByText:r2e,getAllByText:n2e,findAllByText:i2e,findByText:s2e,queryByDisplayValue:l2e,queryAllByDisplayValue:c2e,getByDisplayValue:d2e,getAllByDisplayValue:u2e,findAllByDisplayValue:h2e,findByDisplayValue:f2e,queryByAltText:_2e,queryAllByAltText:v2e,getByAltText:b2e,getAllByAltText:y2e,findAllByAltText:E2e,findByAltText:S2e,queryByTitle:R2e,queryAllByTitle:C2e,getByTitle:M2e,getAllByTitle:A2e,findAllByTitle:I2e,findByTitle:O2e,queryByRole:L2e,queryAllByRole:D2e,getAllByRole:U2e,getByRole:F2e,findAllByRole:B2e,findByRole:j2e,queryByTestId:z2e,queryAllByTestId:V2e,getByTestId:q2e,getAllByTestId:G2e,findAllByTestId:W2e,findByTestId:K2e});function Y2e(t,e,n){return e===void 0&&(e=G2),n===void 0&&(n={}),Object.keys(e).reduce((r,i)=>{const s=e[i];return r[i]=s.bind(null,t),r},n)}const X2e={copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionEnd:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionStart:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},compositionUpdate:{EventType:"CompositionEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyDown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyPress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},keyUp:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,charCode:0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusIn:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusOut:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},invalid:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!0}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},reset:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}},click:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,button:0,composed:!0}},contextMenu:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblClick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drag:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragEnd:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragEnter:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragExit:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragLeave:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},dragOver:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dragStart:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},drop:{EventType:"DragEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseDown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseEnter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseLeave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseMove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOut:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseOver:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseUp:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},select:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},touchCancel:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},touchEnd:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchMove:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},touchStart:{EventType:"TouchEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},resize:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},scroll:{EventType:"UIEvent",defaultInit:{bubbles:!1,cancelable:!1}},wheel:{EventType:"WheelEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},abort:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlay:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},canPlayThrough:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},durationChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},emptied:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},encrypted:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},ended:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedData:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadedMetadata:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},loadStart:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},pause:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},play:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},playing:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},progress:{EventType:"ProgressEvent",defaultInit:{bubbles:!1,cancelable:!1}},rateChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeked:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},seeking:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},stalled:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},suspend:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},timeUpdate:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},volumeChange:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},waiting:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},load:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},error:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},animationStart:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationEnd:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},animationIteration:{EventType:"AnimationEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionCancel:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionEnd:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},transitionRun:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},transitionStart:{EventType:"TransitionEvent",defaultInit:{bubbles:!0,cancelable:!1}},pointerOver:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerEnter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerDown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerMove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerUp:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerCancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerOut:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerLeave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},gotPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},lostPointerCapture:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},popState:{EventType:"PopStateEvent",defaultInit:{bubbles:!0,cancelable:!1}},offline:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},online:{EventType:"Event",defaultInit:{bubbles:!1,cancelable:!1}},pageHide:{EventType:"PageTransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}},pageShow:{EventType:"PageTransitionEvent",defaultInit:{bubbles:!0,cancelable:!0}}},J2e={doubleClick:"dblClick"};Object.keys(X2e).forEach(t=>{t.toLowerCase()});Object.keys(J2e).forEach(t=>{});function Q2e(t){return t.replace(/[ \t]*[\n][ \t]*/g,`
`)}function Z2e(t){return GDe.compressToEncodedURIComponent(Q2e(t))}function eUe(t){return"https://testing-playground.com/#markup="+Z2e(t)}const tUe=(t,e,n)=>Array.isArray(t)?t.forEach(r=>fV(r,e,n)):fV(t,e,n),nUe=function(t){if(t===void 0&&(t=zB().body),!t||!("innerHTML"in t)){console.log("The element you're providing isn't a valid DOM element.");return}if(!t.innerHTML){console.log("The provided element doesn't have any children.");return}const e=eUe(t.innerHTML);return console.log(`Open this URL in your browser

`+e),e},gV={debug:tUe,logTestingPlaygroundURL:nUe};typeof document<"u"&&document.body?Y2e(document.body,G2,gV):Object.keys(G2).reduce((t,e)=>(t[e]=()=>{throw new TypeError("For queries bound to document.body a global document has to be available... Learn more: https://testing-library.com/s/screen-global-error")},t),gV);function kE(t,e){return Bi().eventWrapper(t)}function g_(t){const e=Mxe(t,PB),n=BT(t.ownerDocument);(e??t.ownerDocument.body)!==n&&(kE(e?()=>e.focus():()=>n==null?void 0:n.blur()),kxe(e??t.ownerDocument.body))}function rUe(t){!PB(t)||!(BT(t.ownerDocument)===t)||kE(()=>t.blur())}const v_={};v_.click=(t,e,n)=>{const r=e.closest("button,input,label,select,textarea"),i=r&&Zr(r,"label")&&r.control;if(i&&i!==e)return()=>{PB(i)&&(g_(i),n.dispatchEvent(i,Axe(t)))};if(Zr(e,"input",{type:"file"}))return()=>{rUe(e),e.dispatchEvent(new(Bd(e)).Event("fileDialog")),g_(e)}};const NE=Symbol("Displayed value in UI"),Km=Symbol("Displayed selection in UI"),DR=Symbol("Initial value to compare on blur");function iUe(t){return typeof t=="object"&&NE in t}function sUe(t){return!!t&&typeof t=="object"&&Km in t}function oUe(t,e){t[DR]===void 0&&(t[DR]=t.value),t[NE]=e,t.value=Object.assign(new String(e),{[NE]:!0})}function kp(t){return t[NE]===void 0?t.value:String(t[NE])}function KB(t){t[NE]=void 0}function nX(t){t[DR]=void 0}function aUe(t){return t[DR]}function cUe(t,e){t[Km]=e}function tS(t,{focusOffset:e,anchorOffset:n=e},r="replace"){const i=kp(t).length,s=d=>Math.max(0,Math.min(i,d)),o=r==="replace"||t[Km]===void 0?s(n):t[Km].anchorOffset,a=s(e),c=Math.min(o,a),l=Math.max(o,a);if(t[Km]={anchorOffset:o,focusOffset:a},t.selectionStart===c&&t.selectionEnd===l)return;const u=Object.assign(new Number(c),{[Km]:!0});try{t.setSelectionRange(u,l)}catch{}}function Gw(t){var e,n,r;const i=(r=t[Km])!==null&&r!==void 0?r:{anchorOffset:(e=t.selectionStart)!==null&&e!==void 0?e:0,focusOffset:(n=t.selectionEnd)!==null&&n!==void 0?n:0};return{...i,startOffset:Math.min(i.anchorOffset,i.focusOffset),endOffset:Math.max(i.anchorOffset,i.focusOffset)}}function lUe(t){return!!t[Km]}function R1(t){t[Km]=void 0}const LR=globalThis.parseInt;function uUe(t){const e=t.replace(/\D/g,"");if(e.length<2)return t;const n=LR(e[0],10),r=LR(e[1],10);if(n>=3||n===2&&r>=4){let i;return n>=3?i=1:i=2,vV(e,i)}return t.length===2?t:vV(e,2)}function vV(t,e){const n=t.slice(0,e),r=Math.min(LR(n,10),23),i=t.slice(e),s=LR(i,10),o=Math.min(s,59);return`${r.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function rX(t,e){const n=t.cloneNode();return n.value=e,n.value===e}var iX=function(t){return t.email="email",t.password="password",t.search="search",t.telephone="telephone",t.text="text",t.url="url",t}(iX||{});function dUe(t){var e;const n=(e=t.getAttribute("maxlength"))!==null&&e!==void 0?e:"";return/^\d+$/.test(n)&&Number(n)>=0?Number(n):void 0}function hUe(t){return Zr(t,"textarea")||Zr(t,"input")&&t.type in iX}function sX(t,e,n,r){if(A1(t)&&e+n>=0&&e+n<=t.nodeValue.length)return{node:t,offset:e+n};const i=_V(t,e,n);if(i){if(A1(i))return{node:i,offset:n>0?Math.min(1,i.nodeValue.length):Math.max(i.nodeValue.length-1,0)};if(Zr(i,"br")){const s=_V(i,void 0,n);return s?A1(s)?{node:s,offset:n>0?0:s.nodeValue.length}:n<0&&Zr(s,"br")?{node:i.parentNode,offset:OC(i)}:{node:s.parentNode,offset:OC(s)+(n>0?0:1)}:n<0&&r==="deleteContentBackward"?{node:i.parentNode,offset:OC(i)}:void 0}else return{node:i.parentNode,offset:OC(i)+(n>0?1:0)}}}function _V(t,e,n){const r=Number(e)+(n<0?-1:0);return e!==void 0&&YB(t)&&r>=0&&r<t.children.length&&(t=t.children[r]),pUe(t,n===1?"next":"previous",fUe)}function fUe(t){if(A1(t))return!0;if(YB(t)){if(Zr(t,["input","textarea"]))return t.type!=="hidden";if(Zr(t,"br"))return!0}return!1}function OC(t){let e=0;for(;t.previousSibling;)e++,t=t.previousSibling;return e}function YB(t){return t.nodeType===1}function A1(t){return t.nodeType===3}function pUe(t,e,n){for(;;){var r;const i=t[`${e}Sibling`];if(i){if(t=mUe(i,e==="next"?"first":"last"),n(t))return t}else if(t.parentNode&&(!YB(t.parentNode)||!ey(t.parentNode)&&t.parentNode!==((r=t.ownerDocument)===null||r===void 0?void 0:r.body)))t=t.parentNode;else break}}function mUe(t,e){for(;t.hasChildNodes();)t=t[`${e}Child`];return t}const qw=Symbol("Track programmatic changes for React workaround");function gUe(t){return Object.getOwnPropertyNames(t).some(e=>e.startsWith("__react"))&&Bd(t).REACT_VERSION===17}function vUe(t){gUe(t)&&(t[qw]={previousValue:String(t.value),tracked:[]})}function _Ue(t,e){var n,r;(r=t[qw])===null||r===void 0||(n=r.tracked)===null||n===void 0||n.push(e),t[qw]||(KB(t),tS(t,{focusOffset:e.length}))}function yUe(t,e){var n;const r=t[qw];if(t[qw]=void 0,!(!(r==null||(n=r.tracked)===null||n===void 0)&&n.length))return;const i=r.tracked.length===2&&r.tracked[0]===r.previousValue&&r.tracked[1]===t.value;i||KB(t),lUe(t)&&tS(t,{focusOffset:i?e:t.value.length})}function oX(t){const e=bUe(t);if(e&&Op(e))return{type:"input",selection:Gw(e)};const n=e==null?void 0:e.ownerDocument.getSelection();return{type:Bw(t)&&(n==null?void 0:n.anchorNode)&&Bw(n.anchorNode)?"contenteditable":"default",selection:n}}function bUe(t){return t.nodeType===1?t:t.parentElement}function EUe(t){const e=oX(t);if(e.type==="input")return e.selection;if(e.type==="contenteditable"){var n;return(n=e.selection)===null||n===void 0?void 0:n.getRangeAt(0)}}function ny({focusNode:t,focusOffset:e,anchorNode:n=t,anchorOffset:r=e}){var i,s;if(oX(t).type==="input")return tS(t,{anchorOffset:r,focusOffset:e});(s=n.ownerDocument)===null||s===void 0||(i=s.getSelection())===null||i===void 0||i.setBaseAndExtent(n,r,t,e)}function aX(t){return Zr(t,"input")&&["date","time"].includes(t.type)}function PE(t,e,n,r="insertText"){const i=EUe(e);i&&(!aX(e)&&!t.dispatchUIEvent(e,"beforeinput",{inputType:r,data:n})||("startContainer"in i?SUe(t,e,i,n,r):wUe(t,e,i,n,r)))}function SUe(t,e,n,r,i){let s=!1;if(!n.collapsed)s=!0,n.deleteContents();else if(["deleteContentBackward","deleteContentForward"].includes(i)){const o=sX(n.startContainer,n.startOffset,i==="deleteContentBackward"?-1:1,i);if(o){s=!0;const a=n.cloneRange();a.comparePoint(o.node,o.offset)<0?a.setStart(o.node,o.offset):a.setEnd(o.node,o.offset),a.deleteContents()}}if(r)if(n.endContainer.nodeType===3){const o=n.endOffset;n.endContainer.insertData(o,r),n.setStart(n.endContainer,o+r.length),n.setEnd(n.endContainer,o+r.length)}else{const o=e.ownerDocument.createTextNode(r);n.insertNode(o),n.setStart(o,r.length),n.setEnd(o,r.length)}(s||r)&&t.dispatchUIEvent(e,"input",{inputType:i})}function wUe(t,e,n,r,i){let s=r;if(hUe(e)){const l=dUe(e);if(l!==void 0&&r.length>0){const u=l-e.value.length;if(u>0)s=r.substring(0,u);else return}}const{newValue:o,newOffset:a,oldValue:c}=TUe(s,e,n,i);o===c&&a===n.startOffset&&a===n.endOffset||Zr(e,"input",{type:"number"})&&!xUe(o)||(oUe(e,o),ny({focusNode:e,anchorOffset:a,focusOffset:a}),aX(e)?rX(e,o)&&(yV(t,e,a,{}),t.dispatchUIEvent(e,"change"),nX(e)):yV(t,e,a,{data:r,inputType:i}))}function TUe(t,e,{startOffset:n,endOffset:r},i){const s=kp(e),o=Math.max(0,n===r&&i==="deleteContentBackward"?n-1:n),a=s.substring(0,o),c=Math.min(s.length,n===r&&i==="deleteContentForward"?n+1:r),l=s.substring(c,s.length);let u=`${a}${t}${l}`,d=o+t.length;if(Zr(e,"input",{type:"time"})){const h=uUe(u);h!==""&&rX(e,h)&&(u=h,d=h.length)}return{oldValue:s,newValue:u,newOffset:d}}function yV(t,e,n,r){t.dispatchUIEvent(e,"input",r),yUe(e,n)}function xUe(t){var e,n;const r=t.split("e",2);return!(/[^\d.\-e]/.test(t)||Number((e=t.match(/-/g))===null||e===void 0?void 0:e.length)>2||Number((n=t.match(/\./g))===null||n===void 0?void 0:n.length)>1||r[1]&&!/^-?\d*$/.test(r[1]))}v_.cut=(t,e,n)=>()=>{IE(e)&&PE(n,e,"","deleteByCut")};function CUe(t){return t?ey(t)?t.textContent:kp(t):null}function RUe(t){const e=Bd(t);for(let n=t;n!=null&&n.ownerDocument;n=n.parentElement){const{display:r,visibility:i}=e.getComputedStyle(n);if(r==="none"||i==="hidden")return!1}return!0}function AUe(t,e){const n=t.ownerDocument,r=n.querySelectorAll(bK),i=Array.from(r).filter(c=>c===t||!(Number(c.getAttribute("tabindex"))<0||cg(c)));Number(t.getAttribute("tabindex"))>=0&&i.sort((c,l)=>{const u=Number(c.getAttribute("tabindex")),d=Number(l.getAttribute("tabindex"));return u===d?0:u===0?1:d===0?-1:u-d});const s={};let o=[n.body];const a=Zr(t,"input",{type:"radio"})?t.name:void 0;i.forEach(c=>{const l=c;if(Zr(l,"input",{type:"radio"})&&l.name){if(l===t){o.push(l);return}else if(l.name===a)return;if(l.checked){o=o.filter(u=>!Zr(u,"input",{type:"radio",name:l.name})),o.push(l),s[l.name]=l;return}if(typeof s[l.name]<"u")return}o.push(l)});for(let c=o.findIndex(l=>l===t);;)if(c+=e?-1:1,c===o.length?c=0:c===-1&&(c=o.length-1),o[c]===t||o[c]===n.body||RUe(o[c]))return o[c]}function bV(t,e){if(Op(t)){const n=Gw(t);ny({focusNode:t,focusOffset:n.startOffset===n.endOffset?n.focusOffset+e:e<0?n.startOffset:n.endOffset})}else{const n=t.ownerDocument.getSelection();if(!(n!=null&&n.focusNode))return;if(n.isCollapsed){const r=sX(n.focusNode,n.focusOffset,e);r&&ny({focusNode:r.node,focusOffset:r.offset})}else n[e<0?"collapseToStart":"collapseToEnd"]()}}function cX(t){if(Op(t))return ny({focusNode:t,anchorOffset:0,focusOffset:kp(t).length});var e;const n=(e=Bw(t))!==null&&e!==void 0?e:t.ownerDocument.body;ny({focusNode:n,anchorOffset:0,focusOffset:n.childNodes.length})}function MUe(t){if(Op(t))return Gw(t).startOffset===0&&Gw(t).endOffset===kp(t).length;var e;const n=(e=Bw(t))!==null&&e!==void 0?e:t.ownerDocument.body,r=t.ownerDocument.getSelection();return(r==null?void 0:r.anchorNode)===n&&r.focusNode===n&&r.anchorOffset===0&&r.focusOffset===n.childNodes.length}function qS(t,e,n){var r;if(Op(t))return ny({focusNode:t,anchorOffset:e,focusOffset:n});if(ey(t)&&((r=t.firstChild)===null||r===void 0?void 0:r.nodeType)===3)return ny({focusNode:t.firstChild,anchorOffset:e,focusOffset:n});throw new Error("Not implemented. The result of this interaction is unreliable.")}function kC(t,e,n){const r=Bd(e),i=Array.from(e.ownerDocument.querySelectorAll(e.name?`input[type="radio"][name="${r.CSS.escape(e.name)}"]`:'input[type="radio"][name=""], input[type="radio"]:not([name])'));for(let s=i.findIndex(o=>o===e)+n;;s+=n){if(i[s]||(s=n>0?0:i.length-1),i[s]===e)return;if(!cg(i[s])){g_(i[s]),t.dispatchUIEvent(i[s],"click");return}}}v_.keydown=(t,e,n)=>{var r,i;return(i=(r=EV[t.key])===null||r===void 0?void 0:r.call(EV,t,e,n))!==null&&i!==void 0?i:IUe(t,e,n)};const EV={ArrowDown:(t,e,n)=>{if(Zr(e,"input",{type:"radio"}))return()=>kC(n,e,1)},ArrowLeft:(t,e,n)=>Zr(e,"input",{type:"radio"})?()=>kC(n,e,-1):()=>bV(e,-1),ArrowRight:(t,e,n)=>Zr(e,"input",{type:"radio"})?()=>kC(n,e,1):()=>bV(e,1),ArrowUp:(t,e,n)=>{if(Zr(e,"input",{type:"radio"}))return()=>kC(n,e,-1)},Backspace:(t,e,n)=>{if(IE(e))return()=>{PE(n,e,"","deleteContentBackward")}},Delete:(t,e,n)=>{if(IE(e))return()=>{PE(n,e,"","deleteContentForward")}},End:(t,e)=>{if(Zr(e,["input","textarea"])||ey(e))return()=>{var n,r;const i=(r=(n=CUe(e))===null||n===void 0?void 0:n.length)!==null&&r!==void 0?r:0;qS(e,i,i)}},Home:(t,e)=>{if(Zr(e,["input","textarea"])||ey(e))return()=>{qS(e,0,0)}},PageDown:(t,e)=>{if(Zr(e,["input"]))return()=>{const n=kp(e).length;qS(e,n,n)}},PageUp:(t,e)=>{if(Zr(e,["input"]))return()=>{qS(e,0,0)}},Tab:(t,e,n)=>()=>{const r=AUe(e,n.system.keyboard.modifiers.Shift);g_(r),Op(r)&&tS(r,{anchorOffset:0,focusOffset:r.value.length})}},IUe=(t,e,n)=>{if(t.code==="KeyA"&&n.system.keyboard.modifiers.Control)return()=>cX(e)};v_.keypress=(t,e,n)=>{if(t.key==="Enter"){if(Zr(e,"button")||Zr(e,"input")&&OUe.includes(e.type)||Zr(e,"a")&&e.href)return()=>{n.dispatchUIEvent(e,"click")};if(Zr(e,"input")){const r=e.form,i=r==null?void 0:r.querySelector('input[type="submit"], button:not([type]), button[type="submit"]');return i?()=>n.dispatchUIEvent(i,"click"):r&&kUe.includes(e.type)&&r.querySelectorAll("input").length===1?()=>n.dispatchUIEvent(r,"submit"):void 0}}if(IE(e)){const r=t.key==="Enter"?ey(e)&&!n.system.keyboard.modifiers.Shift?"insertParagraph":"insertLineBreak":"insertText",i=t.key==="Enter"?`
`:t.key;return()=>PE(n,e,i,r)}};const OUe=["button","color","file","image","reset","submit"],kUe=["email","month","password","search","tel","text","url","week"];v_.keyup=(t,e,n)=>{var r;return(r=SV[t.key])===null||r===void 0?void 0:r.call(SV,t,e,n)};const SV={" ":(t,e,n)=>{if(SK(e))return()=>n.dispatchUIEvent(e,"click")}};v_.paste=(t,e,n)=>{if(IE(e))return()=>{var r;const i=(r=t.clipboardData)===null||r===void 0?void 0:r.getData("text");i&&PE(n,e,i,"insertFromPaste")}};const lX={auxclick:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},beforeinput:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},blur:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},click:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},contextmenu:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},copy:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},change:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!1}},cut:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},dblclick:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},focus:{EventType:"FocusEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},focusin:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},focusout:{EventType:"FocusEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},keydown:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keypress:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},keyup:{EventType:"KeyboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},paste:{EventType:"ClipboardEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},input:{EventType:"InputEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},mousedown:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseenter:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mouseleave:{EventType:"MouseEvent",defaultInit:{bubbles:!1,cancelable:!1,composed:!0}},mousemove:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseout:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseover:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},mouseup:{EventType:"MouseEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerover:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerenter:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},pointerdown:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointermove:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerup:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointercancel:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!1,composed:!0}},pointerout:{EventType:"PointerEvent",defaultInit:{bubbles:!0,cancelable:!0,composed:!0}},pointerleave:{EventType:"PointerEvent",defaultInit:{bubbles:!1,cancelable:!1}},submit:{EventType:"Event",defaultInit:{bubbles:!0,cancelable:!0}}};function uX(t){return lX[t].EventType}const NUe=["MouseEvent","PointerEvent"];function PUe(t){return NUe.includes(uX(t))}function DUe(t){return uX(t)==="KeyboardEvent"}const LUe={ClipboardEvent:[FUe],Event:[],FocusEvent:[AS,BUe],InputEvent:[AS,jUe],MouseEvent:[AS,PP,wV],PointerEvent:[AS,PP,wV,HUe],KeyboardEvent:[AS,PP,$Ue]};function dX(t,e,n){const r=Bd(e),{EventType:i,defaultInit:s}=lX[t],o=new(UUe(r))[i](t,s);return LUe[i].forEach(a=>a(o,n??{})),o}function UUe(t){var e;const n=(e=t.Event)!==null&&e!==void 0?e:class{};var r;const i=(r=t.AnimationEvent)!==null&&r!==void 0?r:class extends n{};var s;const o=(s=t.ClipboardEvent)!==null&&s!==void 0?s:class extends n{};var a;const c=(a=t.PopStateEvent)!==null&&a!==void 0?a:class extends n{};var l;const u=(l=t.ProgressEvent)!==null&&l!==void 0?l:class extends n{};var d;const h=(d=t.TransitionEvent)!==null&&d!==void 0?d:class extends n{};var f;const p=(f=t.UIEvent)!==null&&f!==void 0?f:class extends n{};var g;const v=(g=t.CompositionEvent)!==null&&g!==void 0?g:class extends p{};var E;const T=(E=t.FocusEvent)!==null&&E!==void 0?E:class extends p{};var C;const A=(C=t.InputEvent)!==null&&C!==void 0?C:class extends p{};var k;const I=(k=t.KeyboardEvent)!==null&&k!==void 0?k:class extends p{};var N;const U=(N=t.MouseEvent)!==null&&N!==void 0?N:class extends p{};var F;const $=(F=t.DragEvent)!==null&&F!==void 0?F:class extends U{};var X;const q=(X=t.PointerEvent)!==null&&X!==void 0?X:class extends U{};var W;const K=(W=t.TouchEvent)!==null&&W!==void 0?W:class extends p{};return{Event:n,AnimationEvent:i,ClipboardEvent:o,PopStateEvent:c,ProgressEvent:u,TransitionEvent:h,UIEvent:p,CompositionEvent:v,FocusEvent:T,InputEvent:A,KeyboardEvent:I,MouseEvent:U,DragEvent:$,PointerEvent:q,TouchEvent:K}}function M_(t,e){for(const[n,r]of Object.entries(e))Object.defineProperty(t,n,{get:()=>r??null})}function vo(t){return Number(t??0)}function FUe(t,{clipboardData:e}){M_(t,{clipboardData:e})}function BUe(t,{relatedTarget:e}){M_(t,{relatedTarget:e})}function jUe(t,{data:e,inputType:n,isComposing:r}){M_(t,{data:e,isComposing:!!r,inputType:String(n)})}function AS(t,{view:e,detail:n}){M_(t,{view:e,detail:vo(n??0)})}function PP(t,{altKey:e,ctrlKey:n,metaKey:r,shiftKey:i,modifierAltGraph:s,modifierCapsLock:o,modifierFn:a,modifierFnLock:c,modifierNumLock:l,modifierScrollLock:u,modifierSymbol:d,modifierSymbolLock:h}){M_(t,{altKey:!!e,ctrlKey:!!n,metaKey:!!r,shiftKey:!!i,getModifierState(f){return!!{Alt:e,AltGraph:s,CapsLock:o,Control:n,Fn:a,FnLock:c,Meta:r,NumLock:l,ScrollLock:u,Shift:i,Symbol:d,SymbolLock:h}[f]}})}function $Ue(t,{key:e,code:n,location:r,repeat:i,isComposing:s,charCode:o}){M_(t,{key:String(e),code:String(n),location:vo(r),repeat:!!i,isComposing:!!s,charCode:o})}function wV(t,{x:e,y:n,screenX:r,screenY:i,clientX:s=e,clientY:o=n,button:a,buttons:c,relatedTarget:l,offsetX:u,offsetY:d,pageX:h,pageY:f}){M_(t,{screenX:vo(r),screenY:vo(i),clientX:vo(s),x:vo(s),clientY:vo(o),y:vo(o),button:vo(a),buttons:vo(c),relatedTarget:l,offsetX:vo(u),offsetY:vo(d),pageX:vo(h),pageY:vo(f)})}function HUe(t,{pointerId:e,width:n,height:r,pressure:i,tangentialPressure:s,tiltX:o,tiltY:a,twist:c,pointerType:l,isPrimary:u}){M_(t,{pointerId:vo(e),width:vo(n??1),height:vo(r??1),pressure:vo(i),tangentialPressure:vo(s),tiltX:vo(o),tiltY:vo(a),twist:vo(c),pointerType:String(l),isPrimary:!!u})}function VUe(t,e,n,r=!1){(PUe(e)||DUe(e))&&(n={...n,...this.system.getUIEventModifiers()});const i=dX(e,t,n);return hX.call(this,t,i,r)}function hX(t,e,n=!1){var r;const i=e.type,s=n?()=>{}:(r=v_[i])===null||r===void 0?void 0:r.call(v_,e,t,this);if(s){e.preventDefault();let o=!1;return Object.defineProperty(e,"defaultPrevented",{get:()=>o}),Object.defineProperty(e,"preventDefault",{value:()=>{o=e.cancelable}}),kE(()=>t.dispatchEvent(e)),o||s(),!o}return kE(()=>t.dispatchEvent(e))}function E0(t,e,n){const r=dX(e,t,n);kE(()=>t.dispatchEvent(r))}const TV=Symbol("patched focus/blur methods");function fX(t){if(t.prototype[TV])return;const{focus:e,blur:n}=t.prototype;Object.defineProperties(t.prototype,{focus:{configurable:!0,get:()=>i},blur:{configurable:!0,get:()=>s},[TV]:{configurable:!0,get:()=>({focus:e,blur:n})}});let r;function i(o){if(this.ownerDocument.visibilityState!=="hidden")return e.call(this,o);const a=xV(this.ownerDocument);if(a===this)return;const c=Symbol("focus call");r=c,a&&(n.call(a),E0(a,"blur",{relatedTarget:this}),E0(a,"focusout",{relatedTarget:r===c?this:null})),r===c&&(e.call(this,o),E0(this,"focus",{relatedTarget:a})),r===c&&E0(this,"focusin",{relatedTarget:a})}function s(){if(this.ownerDocument.visibilityState!=="hidden")return n.call(this);const o=xV(this.ownerDocument);if(o!==this)return;r=Symbol("blur call"),n.call(this),E0(o,"blur",{relatedTarget:null}),E0(o,"focusout",{relatedTarget:null})}}function xV(t){const e=BT(t);return(e==null?void 0:e.tagName)==="BODY"?null:e}const DP=Symbol("Interceptor for programmatical calls");function Db(t,e,n){const r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=Object.getOwnPropertyDescriptor(t,e),s=r!=null&&r.set?"set":"value";if(typeof(r==null?void 0:r[s])!="function"||r[s][DP])throw new Error(`Element ${t.tagName} does not implement "${String(e)}".`);function o(...a){const{applyNative:c=!1,realArgs:l,then:u}=n.call(this,...a),d=(!c&&i||r)[s];s==="set"?d.call(this,l):d.call(this,...l),u==null||u()}o[DP]=DP,Object.defineProperty(t,e,{...i??r,[s]:o})}function zUe(t){Db(t,"value",function(n){const r=iUe(n);return r&&vUe(this),{applyNative:!!r,realArgs:GUe(this,n),then:r?void 0:()=>_Ue(this,String(n))}})}function GUe(t,e){return Zr(t,"input",{type:"number"})&&String(e)!==""&&!Number.isNaN(Number(e))?String(Number(e)):String(e)}function qUe(t){Db(t,"setSelectionRange",function(n,...r){const i=sUe(n);return{applyNative:!!i,realArgs:[Number(n),...r],then:()=>i?void 0:R1(t)}}),Db(t,"selectionStart",function(n){return{realArgs:n,then:()=>R1(t)}}),Db(t,"selectionEnd",function(n){return{realArgs:n,then:()=>R1(t)}}),Db(t,"select",function(){return{realArgs:[],then:()=>cUe(t,{anchorOffset:0,focusOffset:kp(t).length})}})}function WUe(t){Db(t,"setRangeText",function(...n){return{realArgs:n,then:()=>{KB(t),R1(t)}}})}const Zb=Symbol("Node prepared with document state workarounds");function pX(t){t[Zb]||(t.addEventListener("focus",e=>{const n=e.target;CV(n)},{capture:!0,passive:!0}),t.activeElement&&CV(t.activeElement),t.addEventListener("blur",e=>{const n=e.target,r=aUe(n);r!==void 0&&(n.value!==r&&E0(n,"change"),nX(n))},{capture:!0,passive:!0}),t[Zb]=Zb)}function CV(t){t[Zb]||(Zr(t,["input","textarea"])&&(zUe(t),qUe(t),WUe(t)),t[Zb]=Zb)}function KUe(t){return YUe(t)?t:t.ownerDocument}function YUe(t){return t.nodeType===9}var Du=function(t){return t[t.Trigger=2]="Trigger",t[t.Call=1]="Call",t}({});function WS(t,e){t.levelRefs[e]={}}function NC(t,e){return t.levelRefs[e]}function DE(t){const e=t.delay;if(typeof e=="number")return Promise.all([new Promise(n=>globalThis.setTimeout(()=>n(),e)),t.advanceTimers(e)])}var M1=function(t){return t[t.EachTrigger=4]="EachTrigger",t[t.EachApiCall=2]="EachApiCall",t[t.EachTarget=1]="EachTarget",t[t.Never=0]="Never",t}({});function u0(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Bf=function(t){return t[t.STANDARD=0]="STANDARD",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.NUMPAD=3]="NUMPAD",t}({});const XUe=["Alt","AltGraph","Control","Fn","Meta","Shift","Symbol"];function RV(t){return XUe.includes(t)}const JUe=["CapsLock","FnLock","NumLock","ScrollLock","SymbolLock"];function AV(t){return JUe.includes(t)}class QUe{isKeyPressed(e){return this.pressed.has(String(e.code))}getPressedKeys(){return this.pressed.values().map(e=>e.keyDef)}async keydown(e,n){const r=String(n.key),i=String(n.code),s=pP(e.config.document);this.setKeydownTarget(s),this.pressed.add(i,n),RV(r)&&(this.modifiers[r]=!0);const o=e.dispatchUIEvent(s,"keydown",{key:r,code:i});AV(r)&&!this.modifiers[r]&&(this.modifiers[r]=!0,this.modifierLockStart[r]=!0),o&&this.pressed.setUnprevented(i),o&&this.hasKeyPress(r)&&e.dispatchUIEvent(pP(e.config.document),"keypress",{key:r,code:i,charCode:n.key==="Enter"?13:String(n.key).charCodeAt(0)})}async keyup(e,n){const r=String(n.key),i=String(n.code),s=this.pressed.isUnprevented(i);this.pressed.delete(i),RV(r)&&!this.pressed.values().find(o=>o.keyDef.key===r)&&(this.modifiers[r]=!1),e.dispatchUIEvent(pP(e.config.document),"keyup",{key:r,code:i},!s),AV(r)&&this.modifiers[r]&&(this.modifierLockStart[r]?this.modifierLockStart[r]=!1:this.modifiers[r]=!1)}setKeydownTarget(e){e!==this.lastKeydownTarget&&(this.carryChar=""),this.lastKeydownTarget=e}hasKeyPress(e){return(e.length===1||e==="Enter")&&!this.modifiers.Control&&!this.modifiers.Alt}constructor(e){u0(this,"system",void 0),u0(this,"modifiers",{Alt:!1,AltGraph:!1,CapsLock:!1,Control:!1,Fn:!1,FnLock:!1,Meta:!1,NumLock:!1,ScrollLock:!1,Shift:!1,Symbol:!1,SymbolLock:!1}),u0(this,"pressed",new class{add(n,r){var i,s,o;(o=(i=this.registry)[s=n])!==null&&o!==void 0||(i[s]={keyDef:r,unpreventedDefault:!1})}has(n){return!!this.registry[n]}setUnprevented(n){const r=this.registry[n];r&&(r.unpreventedDefault=!0)}isUnprevented(n){var r;return!!(!((r=this.registry[n])===null||r===void 0)&&r.unpreventedDefault)}delete(n){delete this.registry[n]}values(){return Object.values(this.registry)}constructor(){u0(this,"registry",{})}}),u0(this,"carryChar",""),u0(this,"lastKeydownTarget",void 0),u0(this,"modifierLockStart",{}),this.system=e}}const ZUe=[..."0123456789".split("").map(t=>({code:`Digit${t}`,key:t})),...")!@#$%^&*(".split("").map((t,e)=>({code:`Digit${e}`,key:t,shiftKey:!0})),..."abcdefghijklmnopqrstuvwxyz".split("").map(t=>({code:`Key${t.toUpperCase()}`,key:t})),..."ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map(t=>({code:`Key${t}`,key:t,shiftKey:!0})),{code:"BracketLeft",key:"["},{code:"BracketLeft",key:"{",shiftKey:!0},{code:"BracketRight",key:"]"},{code:"BracketRight",key:"}",shiftKey:!0},{code:"Space",key:" "},{code:"AltLeft",key:"Alt",location:Bf.LEFT},{code:"AltRight",key:"Alt",location:Bf.RIGHT},{code:"ShiftLeft",key:"Shift",location:Bf.LEFT},{code:"ShiftRight",key:"Shift",location:Bf.RIGHT},{code:"ControlLeft",key:"Control",location:Bf.LEFT},{code:"ControlRight",key:"Control",location:Bf.RIGHT},{code:"MetaLeft",key:"Meta",location:Bf.LEFT},{code:"MetaRight",key:"Meta",location:Bf.RIGHT},{code:"OSLeft",key:"OS",location:Bf.LEFT},{code:"OSRight",key:"OS",location:Bf.RIGHT},{code:"ContextMenu",key:"ContextMenu"},{code:"Tab",key:"Tab"},{code:"CapsLock",key:"CapsLock"},{code:"Backspace",key:"Backspace"},{code:"Enter",key:"Enter"},{code:"Escape",key:"Escape"},{code:"ArrowUp",key:"ArrowUp"},{code:"ArrowDown",key:"ArrowDown"},{code:"ArrowLeft",key:"ArrowLeft"},{code:"ArrowRight",key:"ArrowRight"},{code:"Home",key:"Home"},{code:"End",key:"End"},{code:"Delete",key:"Delete"},{code:"PageUp",key:"PageUp"},{code:"PageDown",key:"PageDown"},{code:"Fn",key:"Fn"},{code:"Symbol",key:"Symbol"},{code:"AltRight",key:"AltGraph"}],eFe=[{name:"MouseLeft",pointerType:"mouse",button:"primary"},{name:"MouseRight",pointerType:"mouse",button:"secondary"},{name:"MouseMiddle",pointerType:"mouse",button:"auxiliary"},{name:"TouchA",pointerType:"touch"},{name:"TouchB",pointerType:"touch"},{name:"TouchC",pointerType:"touch"}];function tFe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class mX{getButtons(){let e=0;for(const n of Object.keys(this.pressed))e|=2**Number(n);return e}down(e){const n=q2(e.button);if(n in this.pressed){this.pressed[n].push(e);return}return this.pressed[n]=[e],n}up(e){const n=q2(e.button);if(n in this.pressed&&(this.pressed[n]=this.pressed[n].filter(r=>r.name!==e.name),this.pressed[n].length===0))return delete this.pressed[n],n}constructor(){tFe(this,"pressed",{})}}const MV={primary:0,secondary:1,auxiliary:2,back:3,X1:3,forward:4,X2:4};function q2(t=0){return t in MV?MV[t]:Number(t)}const IV={1:2,2:1};function W2(t){return t=q2(t),t in IV?IV[t]:t}function nFe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class rFe{get countPressed(){return this.pressedKeys.size}isPressed(e){return this.pressedKeys.has(e.name)}addPressed(e){return this.pressedKeys.add(e.name)}removePressed(e){return this.pressedKeys.delete(e.name)}constructor(){nFe(this,"pressedKeys",new Set)}}function ow(t,e){const n=[];for(let s=t;s;s=s.parentElement)n.push(s);const r=[];for(let s=e;s;s=s.parentElement)r.push(s);let i=0;for(;!(i>=n.length||i>=r.length||n[n.length-1-i]!==r[r.length-1-i]);i++);return[n.slice(0,n.length-i),r.slice(0,r.length-i),r.slice(r.length-i)]}function K2({target:t,node:e,offset:n}){return Op(t)?{node:t,offset:n??kp(t).length}:e?{node:e,offset:n??(e.nodeType===3?e.nodeValue.length:e.childNodes.length)}:gX(t,n)}function gX(t,e,n=!0){let r=e===void 0?t.childNodes.length-1:0;const i=e===void 0?-1:1;for(;e===void 0?r>=(n?Math.max(t.childNodes.length-1,0):0):r<=t.childNodes.length;){if(e&&r===t.childNodes.length)throw new Error("The given offset is out of bounds.");const s=t.childNodes.item(r),o=String(s.textContent);if(o.length)if(e!==void 0&&o.length<e)e-=o.length;else{if(s.nodeType===1)return gX(s,e,!1);if(s.nodeType===3)return{node:s,offset:e??s.nodeValue.length}}r+=i}return{node:t,offset:t.childNodes.length}}function iFe({document:t,target:e,clickCount:n,node:r,offset:i}){if(Oxe(e))return;const s=Op(e),o=String(s?kp(e):e.textContent),[a,c]=r?[i,i]:sFe(o,i,n);if(s)return tS(e,{anchorOffset:a??o.length,focusOffset:c??o.length}),{node:e,start:a??0,end:c??o.length};{const{node:l,offset:u}=K2({target:e,node:r,offset:a}),{node:d,offset:h}=K2({target:e,node:r,offset:c}),f=e.ownerDocument.createRange();try{f.setStart(l,u),f.setEnd(d,h)}catch{throw new Error("The given offset is out of bounds.")}const p=t.getSelection();return p==null||p.removeAllRanges(),p==null||p.addRange(f.cloneRange()),f}}function sFe(t,e,n){if(n%3===1||t.length===0)return[e,e];const r=e??t.length;return n%3===2?[r-t.substr(0,e).match(/(\w+|\s+|\W)?$/)[0].length,e===void 0?e:e+t.substr(e).match(/^(\w+|\s+|\W)?/)[0].length]:[r-t.substr(0,e).match(/[^\r\n]*$/)[0].length,e===void 0?e:e+t.substr(e).match(/^[^\r\n]*/)[0].length]}function oFe(t,{document:e,target:n,node:r,offset:i}){const s=K2({target:n,node:r,offset:i});if("node"in t){if(s.node===t.node){const o=s.offset<t.start?t.end:t.start,a=s.offset>t.end||s.offset<t.start?s.offset:t.end;tS(t.node,{anchorOffset:o,focusOffset:a})}}else{const o=t.cloneRange(),a=o.comparePoint(s.node,s.offset);a<0?o.setStart(s.node,s.offset):a>0&&o.setEnd(s.node,s.offset);const c=e.getSelection();c==null||c.removeAllRanges(),c==null||c.addRange(o.cloneRange())}}function vX(t,e){var n,r,i,s,o,a,c,l,u,d,h,f,p,g,v,E,T,C,A,k,I,N,U,F;return t.target!==e.target||((n=t.coords)===null||n===void 0?void 0:n.x)!==((r=e.coords)===null||r===void 0?void 0:r.x)||((i=t.coords)===null||i===void 0?void 0:i.y)!==((s=e.coords)===null||s===void 0?void 0:s.y)||((o=t.coords)===null||o===void 0?void 0:o.clientX)!==((a=e.coords)===null||a===void 0?void 0:a.clientX)||((c=t.coords)===null||c===void 0?void 0:c.clientY)!==((l=e.coords)===null||l===void 0?void 0:l.clientY)||((u=t.coords)===null||u===void 0?void 0:u.offsetX)!==((d=e.coords)===null||d===void 0?void 0:d.offsetX)||((h=t.coords)===null||h===void 0?void 0:h.offsetY)!==((f=e.coords)===null||f===void 0?void 0:f.offsetY)||((p=t.coords)===null||p===void 0?void 0:p.pageX)!==((g=e.coords)===null||g===void 0?void 0:g.pageX)||((v=t.coords)===null||v===void 0?void 0:v.pageY)!==((E=e.coords)===null||E===void 0?void 0:E.pageY)||((T=t.coords)===null||T===void 0?void 0:T.screenX)!==((C=e.coords)===null||C===void 0?void 0:C.screenX)||((A=t.coords)===null||A===void 0?void 0:A.screenY)!==((k=e.coords)===null||k===void 0?void 0:k.screenY)||((I=t.caret)===null||I===void 0?void 0:I.node)!==((N=e.caret)===null||N===void 0?void 0:N.node)||((U=t.caret)===null||U===void 0?void 0:U.offset)!==((F=e.caret)===null||F===void 0?void 0:F.offset)}function d0(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class aFe{move(e,n,r){const i=this.position,s=this.getTarget(e);if(this.position=n,!vX(i,n))return;const o=this.getTarget(e),a=this.getEventInit("mousemove"),[c,l]=ow(s,o);return{leave:()=>{s!==o&&(e.dispatchUIEvent(s,"mouseout",a),c.forEach(u=>e.dispatchUIEvent(u,"mouseleave",a)))},enter:()=>{s!==o&&(e.dispatchUIEvent(o,"mouseover",a),l.forEach(u=>e.dispatchUIEvent(u,"mouseenter",a)))},move:()=>{r||(e.dispatchUIEvent(o,"mousemove",a),this.modifySelecting(e))}}}down(e,n,r){const i=this.buttons.down(n);if(i===void 0)return;const s=this.getTarget(e);this.buttonDownTarget[i]=s;const o=this.getEventInit("mousedown",n.button),a=cg(s);!r&&(a||e.dispatchUIEvent(s,"mousedown",o))&&(this.startSelecting(e,o.detail),g_(s)),!a&&W2(n.button)===2&&e.dispatchUIEvent(s,"contextmenu",this.getEventInit("contextmenu",n.button))}up(e,n,r){const i=this.buttons.up(n);if(i===void 0)return;const s=this.getTarget(e);if(!cg(s)){if(!r){const a=this.getEventInit("mouseup",n.button);e.dispatchUIEvent(s,"mouseup",a),this.endSelecting()}const o=ow(this.buttonDownTarget[i],s)[2][0];if(o){const a=this.getEventInit("click",n.button);a.detail&&(e.dispatchUIEvent(o,a.button===0?"click":"auxclick",a),a.button===0&&a.detail===2&&e.dispatchUIEvent(o,"dblclick",{...this.getEventInit("dblclick",n.button),detail:a.detail}))}}}resetClickCount(){this.clickCount.reset()}getEventInit(e,n){const r={...this.position.coords};return r.button=W2(n),r.buttons=this.buttons.getButtons(),e==="mousedown"?r.detail=this.clickCount.getOnDown(r.button):e==="mouseup"?r.detail=this.clickCount.getOnUp(r.button):(e==="click"||e==="auxclick")&&(r.detail=this.clickCount.incOnClick(r.button)),r}getTarget(e){var n;return(n=this.position.target)!==null&&n!==void 0?n:e.config.document.body}startSelecting(e,n){var r,i;this.selecting=iFe({document:e.config.document,target:this.getTarget(e),node:(r=this.position.caret)===null||r===void 0?void 0:r.node,offset:(i=this.position.caret)===null||i===void 0?void 0:i.offset,clickCount:n})}modifySelecting(e){var n,r;this.selecting&&oFe(this.selecting,{document:e.config.document,target:this.getTarget(e),node:(n=this.position.caret)===null||n===void 0?void 0:n.node,offset:(r=this.position.caret)===null||r===void 0?void 0:r.offset})}endSelecting(){this.selecting=void 0}constructor(){d0(this,"position",{}),d0(this,"buttons",new mX),d0(this,"selecting",void 0),d0(this,"buttonDownTarget",{}),d0(this,"clickCount",new class{incOnClick(e){const n=this.down[e]===void 0?void 0:Number(this.down[e])+1;return this.count=this.count[e]===void 0?{}:{[e]:Number(this.count[e])+1},n}getOnDown(e){var n;this.down={[e]:(n=this.count[e])!==null&&n!==void 0?n:0};var r;return this.count={[e]:(r=this.count[e])!==null&&r!==void 0?r:0},Number(this.count[e])+1}getOnUp(e){return this.down[e]===void 0?void 0:Number(this.down[e])+1}reset(){this.count={}}constructor(){d0(this,"down",{}),d0(this,"count",{})}})}}function UR(t,e){var n;return((n=_X(t,e))===null||n===void 0?void 0:n.pointerEvents)!=="none"}function cFe(t){const e=Bd(t);for(let n=t,r=[];n!=null&&n.ownerDocument;n=n.parentElement){r.push(n);const i=e.getComputedStyle(n).pointerEvents;if(i&&!["inherit","unset"].includes(i))return{pointerEvents:i,tree:r}}}const OV=Symbol("Last check for pointer-events");function _X(t,e){const n=e[OV];if(!(t.config.pointerEventsCheck!==M1.Never&&(!n||kV(t.config.pointerEventsCheck,M1.EachApiCall)&&n[Du.Call]!==NC(t,Du.Call)||kV(t.config.pointerEventsCheck,M1.EachTrigger)&&n[Du.Trigger]!==NC(t,Du.Trigger))))return n==null?void 0:n.result;const i=cFe(e);return e[OV]={[Du.Call]:NC(t,Du.Call),[Du.Trigger]:NC(t,Du.Trigger),result:i},i}function KS(t,e){const n=_X(t,e);if((n==null?void 0:n.pointerEvents)==="none")throw new Error([`Unable to perform pointer interaction as the element ${n.tree.length>1?"inherits":"has"} \`pointer-events: none\`:`,"",lFe(n.tree)].join(`
`))}function lFe(t){return t.reverse().map((e,n)=>["".padEnd(n),e.tagName,e.id&&`#${e.id}`,e.hasAttribute("data-testid")&&`(testId=${e.getAttribute("data-testid")})`,uFe(e),t.length>1&&n===0&&"  <-- This element declared `pointer-events: none`",t.length>1&&n===t.length-1&&"  <-- Asserted pointer events here"].filter(Boolean).join("")).join(`
`)}function uFe(t){var e;let n;if(t.hasAttribute("aria-label"))n=t.getAttribute("aria-label");else if(t.hasAttribute("aria-labelledby")){var r,i;n=(i=t.ownerDocument.getElementById(t.getAttribute("aria-labelledby")))===null||i===void 0||(r=i.textContent)===null||r===void 0?void 0:r.trim()}else if(Zr(t,["button","input","meter","output","progress","select","textarea"])&&(!((e=t.labels)===null||e===void 0)&&e.length))n=Array.from(t.labels).map(o=>{var a;return(a=o.textContent)===null||a===void 0?void 0:a.trim()}).join("|");else if(Zr(t,"button")){var s;n=(s=t.textContent)===null||s===void 0?void 0:s.trim()}return n=n==null?void 0:n.replace(/\n/g,"  "),Number(n==null?void 0:n.length)>30&&(n=`${n==null?void 0:n.substring(0,29)}`),n?`(label=${n})`:""}function kV(t,e){return(t&e)>0}function Pm(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class dFe{init(e){const n=this.getTarget(e),[,r]=ow(null,n),i=this.getEventInit();return KS(e,n),e.dispatchUIEvent(n,"pointerover",i),r.forEach(s=>e.dispatchUIEvent(s,"pointerenter",i)),this}move(e,n){const r=this.position,i=this.getTarget(e);if(this.position=n,!vX(r,n))return;const s=this.getTarget(e),o=this.getEventInit(-1),[a,c]=ow(i,s);return{leave:()=>{UR(e,i)&&i!==s&&(e.dispatchUIEvent(i,"pointerout",o),a.forEach(l=>e.dispatchUIEvent(l,"pointerleave",o)))},enter:()=>{KS(e,s),i!==s&&(e.dispatchUIEvent(s,"pointerover",o),c.forEach(l=>e.dispatchUIEvent(l,"pointerenter",o)))},move:()=>{e.dispatchUIEvent(s,"pointermove",o)}}}down(e,n=0){if(this.isDown)return;const r=this.getTarget(e);KS(e,r),this.isDown=!0,this.isPrevented=!e.dispatchUIEvent(r,"pointerdown",this.getEventInit(n))}up(e,n=0){if(!this.isDown)return;const r=this.getTarget(e);KS(e,r),this.isPrevented=!1,this.isDown=!1,e.dispatchUIEvent(r,"pointerup",this.getEventInit(n))}release(e){const n=this.getTarget(e),[r]=ow(n,null),i=this.getEventInit();UR(e,n)&&(e.dispatchUIEvent(n,"pointerout",i),r.forEach(s=>e.dispatchUIEvent(s,"pointerleave",i))),this.isCancelled=!0}getTarget(e){var n;return(n=this.position.target)!==null&&n!==void 0?n:e.config.document.body}getEventInit(e){return{...this.position.coords,pointerId:this.pointerId,pointerType:this.pointerType,isPrimary:this.isPrimary,button:W2(e),buttons:this.buttons.getButtons()}}constructor({pointerId:e,pointerType:n,isPrimary:r},i){Pm(this,"pointerId",void 0),Pm(this,"pointerType",void 0),Pm(this,"isPrimary",void 0),Pm(this,"buttons",void 0),Pm(this,"isMultitouch",!1),Pm(this,"isCancelled",!1),Pm(this,"isDown",!1),Pm(this,"isPrevented",!1),Pm(this,"position",{}),this.pointerId=e,this.pointerType=n,this.isPrimary=r,this.isMultitouch=!r,this.buttons=i}}function gv(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class hFe{isKeyPressed(e){return this.devices.get(e.pointerType).isPressed(e)}async press(e,n,r){this.devices.get(n.pointerType).addPressed(n),this.buttons.down(n);const i=this.getPointerName(n),s=n.pointerType==="touch"?this.pointers.new(i,n.pointerType,this.buttons):this.pointers.get(i);s.position=r,s.pointerType!=="touch"&&(this.mouse.position=r),s.pointerType==="touch"&&s.init(e),s.down(e,n.button),s.pointerType!=="touch"&&this.mouse.down(e,n,s.isPrevented)}async move(e,n,r){const i=this.pointers.get(n),s=i.move(e,r),o=i.pointerType==="touch"?void 0:this.mouse.move(e,r,i.isPrevented);s==null||s.leave(),o==null||o.leave(),s==null||s.enter(),o==null||o.enter(),s==null||s.move(),o==null||o.move()}async release(e,n,r){const i=this.devices.get(n.pointerType);i.removePressed(n),this.buttons.up(n);const s=this.pointers.get(this.getPointerName(n)),o=s.isPrevented;if(s.position=r,s.pointerType!=="touch"&&(this.mouse.position=r),i.countPressed===0&&s.up(e,n.button),s.pointerType==="touch"&&s.release(e),s.pointerType==="touch"&&!s.isMultitouch){const a=this.mouse.move(e,r,o);a==null||a.leave(),a==null||a.enter(),a==null||a.move(),this.mouse.down(e,n,o)}if(!s.isMultitouch){const a=this.mouse.move(e,r,o);a==null||a.leave(),a==null||a.enter(),a==null||a.move(),this.mouse.up(e,n,o)}}getPointerName(e){return e.pointerType==="touch"?e.name:e.pointerType}getPreviousPosition(e){return this.pointers.has(e)?this.pointers.get(e).position:void 0}resetClickCount(){this.mouse.resetClickCount()}getMouseTarget(e){var n;return(n=this.mouse.position.target)!==null&&n!==void 0?n:e.config.document.body}setMousePosition(e){this.mouse.position=e,this.pointers.get("mouse").position=e}constructor(e){gv(this,"system",void 0),gv(this,"mouse",void 0),gv(this,"buttons",void 0),gv(this,"devices",new class{get(n){var r,i,s;return(s=(r=this.registry)[i=n])!==null&&s!==void 0?s:r[i]=new rFe}constructor(){gv(this,"registry",{})}}),gv(this,"pointers",new class{new(n,r,i){const s=r!=="touch"||!Object.values(this.registry).some(o=>o.pointerType==="touch"&&!o.isCancelled);return s||Object.values(this.registry).forEach(o=>{o.pointerType===r&&!o.isCancelled&&(o.isMultitouch=!0)}),this.registry[n]=new dFe({pointerId:this.nextId++,pointerType:r,isPrimary:s},i),this.registry[n]}get(n){if(!this.has(n))throw new Error(`Trying to access pointer "${n}" which does not exist.`);return this.registry[n]}has(n){return n in this.registry}constructor(){gv(this,"registry",{}),gv(this,"nextId",1)}}),this.system=e,this.buttons=new mX,this.mouse=new aFe,this.pointers.new("mouse","mouse",this.buttons)}}function NV(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class yX{getUIEventModifiers(){return{altKey:this.keyboard.modifiers.Alt,ctrlKey:this.keyboard.modifiers.Control,metaKey:this.keyboard.modifiers.Meta,shiftKey:this.keyboard.modifiers.Shift,modifierAltGraph:this.keyboard.modifiers.AltGraph,modifierCapsLock:this.keyboard.modifiers.CapsLock,modifierFn:this.keyboard.modifiers.Fn,modifierFnLock:this.keyboard.modifiers.FnLock,modifierNumLock:this.keyboard.modifiers.NumLock,modifierScrollLock:this.keyboard.modifiers.ScrollLock,modifierSymbol:this.keyboard.modifiers.Symbol,modifierSymbolLock:this.keyboard.modifiers.SymbolLock}}constructor(){NV(this,"keyboard",new QUe(this)),NV(this,"pointer",new hFe(this))}}async function fFe(t){const e=[];return this.config.skipHover||e.push({target:t}),e.push({keys:"[MouseLeft]",target:t}),this.pointer(e)}async function pFe(t){return this.pointer([{target:t},"[MouseLeft][MouseLeft]"])}async function mFe(t){return this.pointer([{target:t},"[MouseLeft][MouseLeft][MouseLeft]"])}async function gFe(t){return this.pointer({target:t})}async function vFe(t){return KS(this,this.system.pointer.getMouseTarget(this)),this.pointer({target:t.ownerDocument.body})}async function _Fe({shift:t}={}){return this.keyboard(t===!0?"{Shift>}{Tab}{/Shift}":t===!1?"[/ShiftLeft][/ShiftRight]{Tab}":"{Tab}")}var XB=function(t){return t["{"]="}",t["["]="]",t}(XB||{});function bX(t,e){let n=0;const r=t[n]in XB?t[n]:"";n+=r.length;const s=new RegExp(`^\\${r}{2}`).test(t)?"":r;return{type:s,...s===""?yFe(t,n,e):bFe(t,n,s,e)}}function yFe(t,e,n){const r=t[e];return EX(r,t,e,n),e+=r.length,{consumedLength:e,descriptor:r,releasePrevious:!1,releaseSelf:!0,repeat:1}}function bFe(t,e,n,r){var i,s;const o=t[e]==="/"?"/":"";e+=o.length;const a=n==="{"&&t[e]==="\\";e+=Number(a);const c=a?t[e]:(i=t.slice(e).match(n==="{"?/^\w+|^[^}>/]/:/^\w+/))===null||i===void 0?void 0:i[0];EX(c,t,e,r),e+=c.length;var l;const u=(l=(s=t.slice(e).match(/^>\d+/))===null||s===void 0?void 0:s[0])!==null&&l!==void 0?l:"";e+=u.length;const d=t[e]==="/"||!u&&t[e]===">"?t[e]:"";e+=d.length;const h=XB[n],f=t[e]===h?h:"";if(!f)throw new Error(SX([!u&&"repeat modifier",!d&&"release modifier",`"${h}"`].filter(Boolean).join(" or "),t[e],t,r));return e+=f.length,{consumedLength:e,descriptor:c,releasePrevious:!!o,repeat:u?Math.max(Number(u.substr(1)),1):1,releaseSelf:EFe(d,u)}}function EX(t,e,n,r){if(!t)throw new Error(SX("key descriptor",e[n],e,r))}function EFe(t,e){if(t)return t==="/";if(e)return!1}function SX(t,e,n,r){return`Expected ${t} but found "${e??""}" in "${n}"
    See ${r==="pointer"?"https://testing-library.com/docs/user-event/pointer#pressing-a-button-or-touching-the-screen":"https://testing-library.com/docs/user-event/keyboard"}
    for more information about how userEvent parses your input.`}function SFe(t,e){const n=[];do{const{type:i,descriptor:s,consumedLength:o,releasePrevious:a,releaseSelf:c=!0,repeat:l}=bX(e,"keyboard");var r;const u=(r=t.find(d=>{if(i==="["){var h;return((h=d.code)===null||h===void 0?void 0:h.toLowerCase())===s.toLowerCase()}else if(i==="{"){var f;return((f=d.key)===null||f===void 0?void 0:f.toLowerCase())===s.toLowerCase()}return d.key===s}))!==null&&r!==void 0?r:{key:"Unknown",code:"Unknown",[i==="["?"code":"key"]:s};n.push({keyDef:u,releasePrevious:a,releaseSelf:c,repeat:l}),e=e.slice(o)}while(e);return n}async function wFe(t){const e=SFe(this.config.keyboardMap,t);for(let n=0;n<e.length;n++)await DE(this.config),await TFe(this,e[n])}async function TFe(t,{keyDef:e,releasePrevious:n,releaseSelf:r,repeat:i}){const{system:s}=t;if(s.keyboard.isKeyPressed(e)&&await s.keyboard.keyup(t,e),!n){for(let o=1;o<=i;o++)await s.keyboard.keydown(t,e),o<i&&await DE(t.config);r&&await s.keyboard.keyup(t,e)}}async function xFe(t){for(const e of t.system.keyboard.getPressedKeys())await t.system.keyboard.keyup(t,e)}function wX(t){const e=Op(t)?{"text/plain":CFe(t)}:{"text/plain":String(t.ownerDocument.getSelection())},n=kB(Bd(t));for(const r in e)e[r]&&n.setData(r,e[r]);return n}function CFe(t){const e=Gw(t);return kp(t).substring(e.startOffset,e.endOffset)}async function RFe(){const t=this.config.document;var e;const n=(e=t.activeElement)!==null&&e!==void 0?e:t.body,r=wX(n);if(r.items.length!==0)return this.dispatchUIEvent(n,"copy",{clipboardData:r})&&this.config.writeToClipboard&&await yK(t,r),r}async function AFe(){const t=this.config.document;var e;const n=(e=t.activeElement)!==null&&e!==void 0?e:t.body,r=wX(n);if(r.items.length!==0)return this.dispatchUIEvent(n,"cut",{clipboardData:r})&&this.config.writeToClipboard&&await yK(n.ownerDocument,r),r}async function MFe(t){const e=this.config.document;var n;const r=(n=e.activeElement)!==null&&n!==void 0?n:e.body;var i;const s=(i=typeof t=="string"?IFe(e,t):t)!==null&&i!==void 0?i:await Rxe(e).catch(()=>{throw new Error("`userEvent.paste()` without `clipboardData` requires the `ClipboardAPI` to be available.")});this.dispatchUIEvent(r,"paste",{clipboardData:s})}function IFe(t,e){const n=kB(Bd(t));return n.setData("text",e),n}function PV(t,e){const n=[];do{const{descriptor:r,consumedLength:i,releasePrevious:s,releaseSelf:o=!0}=bX(e,"pointer"),a=t.find(c=>c.name===r);a&&n.push({keyDef:a,releasePrevious:s,releaseSelf:o}),e=e.slice(i)}while(e);return n}async function OFe(t){const{pointerMap:e}=this.config,n=[];(Array.isArray(t)?t:[t]).forEach(r=>{typeof r=="string"?n.push(...PV(e,r)):"keys"in r?n.push(...PV(e,r.keys).map(i=>({...r,...i}))):n.push(r)});for(let r=0;r<n.length;r++)await DE(this.config),await kFe(this,n[r]);this.system.pointer.resetClickCount()}async function kFe(t,e){var n,r;const i="pointerName"in e&&e.pointerName?e.pointerName:"keyDef"in e?t.system.pointer.getPointerName(e.keyDef):"mouse",s=t.system.pointer.getPreviousPosition(i);var o,a,c,l;const u={target:(o=e.target)!==null&&o!==void 0?o:NFe(t,s),coords:(a=e.coords)!==null&&a!==void 0?a:s==null?void 0:s.coords,caret:{node:(c=e.node)!==null&&c!==void 0?c:DV(e)||s==null||(n=s.caret)===null||n===void 0?void 0:n.node,offset:(l=e.offset)!==null&&l!==void 0?l:DV(e)||s==null||(r=s.caret)===null||r===void 0?void 0:r.offset}};"keyDef"in e?(t.system.pointer.isKeyPressed(e.keyDef)&&(WS(t,Du.Trigger),await t.system.pointer.release(t,e.keyDef,u)),e.releasePrevious||(WS(t,Du.Trigger),await t.system.pointer.press(t,e.keyDef,u),e.releaseSelf&&(WS(t,Du.Trigger),await t.system.pointer.release(t,e.keyDef,u)))):(WS(t,Du.Trigger),await t.system.pointer.move(t,i,u))}function DV(t){var e,n;return!!((n=(e=t.target)!==null&&e!==void 0?e:t.node)!==null&&n!==void 0?n:t.offset!==void 0)}function NFe(t,e){if(!e)throw new Error("This pointer has no previous position. Provide a target property!");var n;return(n=e.target)!==null&&n!==void 0?n:t.config.document.body}async function PFe(t){if(!IE(t)||cg(t))throw new Error("clear()` is only supported on editable elements.");if(g_(t),t.ownerDocument.activeElement!==t)throw new Error("The element to be cleared could not be focused.");if(cX(t),!MUe(t))throw new Error("The element content to be cleared could not be selected.");PE(this,t,"","deleteContentBackward")}async function DFe(t,e){return TX.call(this,!0,t,e)}async function LFe(t,e){return TX.call(this,!1,t,e)}async function TX(t,e,n){if(!t&&!e.multiple)throw Bi().getElementError("Unable to deselect an option in a non-multiple select. Use selectOptions to change the selection instead.",e);const r=Array.isArray(n)?n:[n],i=Array.from(e.querySelectorAll('option, [role="option"]')),s=r.map(a=>{if(typeof a!="string"&&i.includes(a))return a;{const c=i.find(l=>l.value===a||l.innerHTML===a);if(c)return c;throw Bi().getElementError(`Value "${String(a)}" not found in options`,e)}}).filter(a=>!cg(a));if(cg(e)||!s.length)return;const o=a=>{a.selected=t,this.dispatchUIEvent(e,"input",{bubbles:!0,cancelable:!1,composed:!0}),this.dispatchUIEvent(e,"change")};if(Zr(e,"select"))if(e.multiple)for(const a of s){const c=this.config.pointerEventsCheck===0?!0:UR(this,a);c&&(this.dispatchUIEvent(a,"pointerover"),this.dispatchUIEvent(e,"pointerenter"),this.dispatchUIEvent(a,"mouseover"),this.dispatchUIEvent(e,"mouseenter"),this.dispatchUIEvent(a,"pointermove"),this.dispatchUIEvent(a,"mousemove"),this.dispatchUIEvent(a,"pointerdown"),this.dispatchUIEvent(a,"mousedown")),g_(e),c&&(this.dispatchUIEvent(a,"pointerup"),this.dispatchUIEvent(a,"mouseup")),o(a),c&&this.dispatchUIEvent(a,"click"),await DE(this.config)}else if(s.length===1){const a=this.config.pointerEventsCheck===0?!0:UR(this,e);a?await this.click(e):g_(e),o(s[0]),a&&(this.dispatchUIEvent(e,"pointerover"),this.dispatchUIEvent(e,"pointerenter"),this.dispatchUIEvent(e,"mouseover"),this.dispatchUIEvent(e,"mouseenter"),this.dispatchUIEvent(e,"pointerup"),this.dispatchUIEvent(e,"mouseup"),this.dispatchUIEvent(e,"click")),await DE(this.config)}else throw Bi().getElementError("Cannot select multiple options on a non-multiple select",e);else if(e.getAttribute("role")==="listbox")for(const a of s)await this.click(a),await this.unhover(a);else throw Bi().getElementError("Cannot select options on elements that are neither select nor listbox elements",e)}async function UFe(t,e,{skipClick:n=this.config.skipClick,skipAutoClose:r=this.config.skipAutoClose,initialSelectionStart:i,initialSelectionEnd:s}={}){t.disabled||(n||await this.click(t),i!==void 0&&qS(t,i,s??i),await this.keyboard(e),r||await xFe(this))}const LV=Symbol("files and value properties are mocked");function LP(t,e,n){n?Object.defineProperty(t,e,n):delete t[e]}function FFe(t,e){var n;(n=t[LV])===null||n===void 0||n.restore();const r=Object.getOwnPropertyDescriptor(t,"type"),i=Object.getOwnPropertyDescriptor(t,"value"),s=Object.getOwnPropertyDescriptor(t,"files");function o(){LP(t,"type",r),LP(t,"value",i),LP(t,"files",s)}t[LV]={restore:o},Object.defineProperties(t,{files:{configurable:!0,get:()=>e},value:{configurable:!0,get:()=>e.length?`C:\\fakepath\\${e[0].name}`:"",set(a){if(a==="")o();else{var c;i==null||(c=i.set)===null||c===void 0||c.call(t,a)}}},type:{configurable:!0,get:()=>"file",set(a){a!=="file"&&(o(),t.type=a)}}})}async function BFe(t,e){const n=Zr(t,"label")?t.control:t;if(!n||!Zr(n,"input",{type:"file"}))throw new TypeError(`The ${n===t?"given":"associated"} ${n==null?void 0:n.tagName} element does not accept file uploads`);if(cg(t))return;const r=(Array.isArray(e)?e:[e]).filter(s=>!this.config.applyAccept||jFe(s,n.accept)).slice(0,n.multiple?void 0:1),i=()=>{var s;r.length===((s=n.files)===null||s===void 0?void 0:s.length)&&r.every((o,a)=>{var c;return o===((c=n.files)===null||c===void 0?void 0:c.item(a))})||(FFe(n,OB(Bd(t),r)),this.dispatchUIEvent(n,"input"),this.dispatchUIEvent(n,"change"))};n.addEventListener("fileDialog",i),await this.click(t),n.removeEventListener("fileDialog",i)}function PC(t){return t.toLowerCase().replace(/(\.|\/)jpg\b/g,"$1jpeg")}function jFe(t,e){if(!e)return!0;const n=["audio/*","image/*","video/*"];return PC(e).trim().split(/\s*,\s*/).some(r=>r.startsWith(".")?PC(t.name).endsWith(r):n.includes(r)?PC(t.type).startsWith(r.replace("*","")):PC(t.type)===r)}const UV={click:fFe,dblClick:pFe,tripleClick:mFe,hover:gFe,unhover:vFe,tab:_Fe,keyboard:wFe,copy:RFe,cut:AFe,paste:MFe,pointer:OFe,clear:PFe,deselectOptions:LFe,selectOptions:DFe,type:UFe,upload:BFe};function $Fe(t){return Bi().asyncWrapper(t)}const xX={applyAccept:!0,autoModify:!0,delay:0,document:globalThis.document,keyboardMap:ZUe,pointerMap:eFe,pointerEventsCheck:M1.EachApiCall,skipAutoClose:!1,skipClick:!1,skipHover:!1,writeToClipboard:!1,advanceTimers:()=>Promise.resolve()},HFe={...xX,writeToClipboard:!0};function CX(t={},e=HFe,n){const r=qFe(t,n,e);return{...e,...t,document:r}}function VFe(t={}){const e=CX(t);pX(e.document),fX(Bd(e.document).HTMLElement);var n;const r=(n=e.document.defaultView)!==null&&n!==void 0?n:globalThis.window;return Txe(r),JB(e).api}function Xc({keyboardState:t,pointerState:e,...n}={},r){const i=CX(n,xX,r);pX(i.document),fX(Bd(i.document).HTMLElement);var s;const o=(s=e??t)!==null&&s!==void 0?s:new yX;return{api:JB(i,o).api,system:o}}function zFe(t){return JB({...this.config,...t},this.system).api}function GFe(t,e){function n(...r){return WS(t,Du.Call),$Fe(()=>e.apply(t,r).then(async i=>(await DE(t.config),i)))}return Object.defineProperty(n,"name",{get:()=>e.name}),n}function JB(t,e=new yX){const n={};return Object.assign(n,{config:t,dispatchEvent:hX.bind(n),dispatchUIEvent:VUe.bind(n),system:e,levelRefs:{},...UV}),{instance:n,api:{...Object.fromEntries(Object.entries(UV).map(([r,i])=>[r,GFe(n,i)])),setup:zFe.bind(n)}}}function qFe(t,e,n){var r,i;return(i=(r=t.document)!==null&&r!==void 0?r:e&&KUe(e))!==null&&i!==void 0?i:n.document}function WFe(t){return Xc().api.clear(t)}function KFe(t,e={}){return Xc(e,t).api.click(t)}function YFe(t={}){return Xc(t).api.copy()}function XFe(t={}){return Xc(t).api.cut()}function JFe(t,e={}){return Xc(e).api.dblClick(t)}function QFe(t,e,n={}){return Xc(n).api.deselectOptions(t,e)}function ZFe(t,e={}){return Xc(e).api.hover(t)}async function eBe(t,e={}){const{api:n,system:r}=Xc(e);return n.keyboard(t).then(()=>r)}async function tBe(t,e={}){const{api:n,system:r}=Xc(e);return n.pointer(t).then(()=>r)}function nBe(t,e){return Xc(e).api.paste(t)}function rBe(t,e,n={}){return Xc(n).api.selectOptions(t,e)}function iBe(t,e={}){return Xc(e).api.tripleClick(t)}function sBe(t,e,n={}){return Xc(n,t).api.type(t,e,n)}function oBe(t,e={}){const{api:n,system:r}=Xc(e);return r.pointer.setMousePosition({target:t}),n.unhover(t)}function aBe(t,e,n={}){return Xc(n).api.upload(t,e)}function cBe(t={}){return Xc().api.tab(t)}const lBe=Object.freeze(Object.defineProperty({__proto__:null,clear:WFe,click:KFe,copy:YFe,cut:XFe,dblClick:JFe,deselectOptions:QFe,hover:ZFe,keyboard:eBe,paste:nBe,pointer:tBe,selectOptions:rBe,tab:cBe,tripleClick:iBe,type:sBe,unhover:oBe,upload:aBe},Symbol.toStringTag,{value:"Module"})),uBe={...lBe,setup:VFe},Pu=uBe.setup({delay:null});function ua(){return window.sysclipboard}async function Y2(t){const e=new FormData;e.append("url",t);const n=new Request("https://bytes.zed.cafe",{method:"POST",body:e});return await(await fetch(n)).text()}function RX(){return window.location.href.includes("/join/")}function X2(){return window.location.href.includes("/locked/")}function QB(t){const e=new Set;function n(s){vle(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),vw.invoke(s))}const r=Wh("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),t(s))});function i(){vw.disconnect(r)}return{forward:n,disconnect:i}}function dBe(t){return new Worker("/assets/simspace-BNBKMC6N.js",{name:t==null?void 0:t.name})}function hBe(t){return new Worker("/assets/stubspace-C7v-KsMS.js",{name:t==null?void 0:t.name})}let DC;function fBe(t=!1){if(!he(DC)){DC=t?new hBe:new dBe;const{forward:e}=QB(n=>DC.postMessage(n));DC.addEventListener("message",n=>e(n.data))}}async function pBe(t){return cue(t)}async function mBe(t,e){return lue(t,e)}function gBe(t){try{return sessionStorage.getItem(t)??void 0}catch(e){ci(zr,`readsession ${t}`,e.message)}}function vBe(t,e){try{he(e)?sessionStorage.setItem(t,e):sessionStorage.removeItem(t)}catch(n){ci(zr,`writesession ${t} <- ${e}`,n.message)}}function J2(){try{const t=location.hash.slice(1);if(t.length)return t}catch(t){ci(zr,"crash",t.message)}return""}async function Q2(t){if(t.length===0){ci(zr,"content","no content found"),_G(zr,Gs);return}const e=await yBe()??"";qle(zr,t,e,Gs)}let FR="";window.addEventListener("hashchange",()=>{Tl(zr,async()=>{const t=J2();FR!==t&&(FR=t,await Q2(t))})});function _Be(t,e){const n=`#${t}`;if(location.hash!==n){FR=t,location.hash=n;const r=`wrote ${(t==null?void 0:t.length)??0} chars [${t.slice(0,8)}...${t.slice(-8)}]`;e.includes("autosave")?Lle(zr,r):(e.length&&(document.title=e),Fh(zr,r))}}async function yBe(){return pBe("SELECTED")}async function bBe(t){return mBe("SELECTED",()=>t)}let UP=0;const FV=1,Gs=gBe("PLAYER")??wue();vBe("PLAYER",Gs);function Ci(){return Gs}const zr=Wh("register",["ready","second","error"],function(t){if(zr.session(t))switch(t.target){case"ready":{Tl(zr,async()=>{await Xf(256),Ar(zr,`myplayerid ${Gs}`),zle(zr,Gs)});break}case"error:login:main":case"error:login:title":case"error:login:player":t.player===Gs&&(_G(zr,Gs),fE(zr,"#pages",Gs));break;case"ackoperator":{t.player===Gs&&Tl(zr,async()=>{const e=J2();RX()?xle(zr,e,Gs):(Gle(zr,X2(),Gs),await Q2(e))});break}case"loginready":t.player===Gs&&Wle(zr,Gs);break;case"acklogin":t.player===Gs&&(Q1(zr,Gs),Sle(zr,Gs));break;case"dev":t.player===Gs&&Tl(zr,async function(){if(X2()){const e=await Y2(location.href);ER(zr,e,e)}else np(zr,"creating locked terminal"),await Xf(100),location.href=location.href.replace("/#","/locked/#")});break;case"share":t.player===Gs&&Tl(zr,async function(){const e=await Y2(location.href.replace(/cafe.*locked/,"cafe"));ER(zr,e,e)});break;case"nuke":t.player===Gs&&Tl(zr,async function(){np(zr,"nuke in"),ni(zr,"3","..."),await Xf(1e3),ni(zr,"2","..."),await Xf(1e3),ni(zr,"1","..."),await Xf(1e3),np(zr,"BYE"),await Xf(100),location.hash="",FR=location.hash,location.reload()});break;case"savemem":if(t.player===Gs&&Lr(t.data)){const[e,n]=t.data;Yn(e)&&Yn(n)&&_Be(n,e)}break;case"forkmem":if(t.player===Gs&&Lr(t.data)){const[e]=t.data;Yn(e)&&window.open(location.href.replace(/#.*/,`#${e}`),"_blank")}break;case"select":t.player===Gs&&Tl(zr,async()=>{Yn(t.player)&&Yn(t.data)&&(await bBe(t.data),await Q2(J2()))});break;case"second":++UP,UP>=FV&&(UP-=FV,Yle(zr,Ci()));break;default:if(t.player===Gs){const{target:e,path:n}=MA(t.target);switch(e){case"touchkey":Tl(zr,async()=>{switch(n){case"[Alt]":Tv(zr,"-c",!0),nu.setState(r=>({...r,keyboardalt:!r.keyboardalt,keyboardctrl:!1,keyboardshift:!1}));break;case"[Ctrl]":Tv(zr,"-e",!0),nu.setState(r=>({...r,keyboardalt:!1,keyboardctrl:!r.keyboardctrl,keyboardshift:!1}));break;case"[Shift]":Tv(zr,"-g",!0),nu.setState(r=>({...r,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!r.keyboardshift}));break;default:{const r=!isNaN(parseInt(n,10)),i=nu.getState(),s=[],o=DT?"Meta":"Ctrl";i.keyboardshift?(Tv(zr,r?"+c":"+f",!0),s.push("{Shift>}")):i.keyboardalt?(Tv(zr,r?"+c!":"+f!",!0),s.push("{Alt>}")):i.keyboardctrl?(Tv(zr,r?"+c#":"+f#",!0),s.push(`{${o}>}`)):Tv(zr,r?"-c":"-f",!0),s.push(n),i.keyboardshift?s.push("{/Shift}"):i.keyboardalt?s.push("{/Alt}"):i.keyboardctrl&&s.push(`{/${o}}`);const a=s.join("");await Pu.keyboard(a);break}}});break}}break}});setTimeout(function(){fBe(RX())},100);const EBe="modulepreload",SBe=function(t){return"/"+t},BV={},Z2=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(c=>{if(c=SBe(c),c in BV)return;BV[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":EBe,l||(d.as="script"),d.crossOrigin="",d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((h,f)=>{d.addEventListener("load",h),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var wBe=Object.defineProperty,TBe=(t,e,n)=>e in t?wBe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Dr=(t,e,n)=>(TBe(t,typeof e!="symbol"?e+"":e,n),n),AX=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},MS=(t,e,n)=>(AX(t,e,"read from private field"),n?n.call(t):e.get(t)),xBe=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},CBe=(t,e,n,r)=>(AX(t,e,"write to private field"),e.set(t,n),n),Cv,FP=new Intl.Collator(0,{numeric:1}).compare;function MX(t,e,n){return t=t.split("."),e=e.split("."),FP(t[0],e[0])||FP(t[1],e[1])||(e[2]=e.slice(2).join("."),n=/[.-]/.test(t[2]=t.slice(2).join(".")),n==/[.-]/.test(e[2])?FP(t[2],e[2]):n?-1:1)}const RBe="host",IX="queue/data",ABe="queue/join",jV="upload",MBe="login",IBe="config",OBe="info",kBe="runtime",NBe="sleeptime",PBe="heartbeat",DBe="component_server",LBe="reset",UBe="cancel",FBe="https://gradio-space-api-fetcher-v2.hf.space/api",OX="This application is currently busy. Please try again. ",F0="Connection errored out. ",Pv="Could not resolve app config. ",BBe="Could not get space status. ",jBe="Could not get API info. ",ZB="Space metadata could not be loaded. ",$Be="Invalid URL. A full URL path is required.",HBe="Not authorized to access this space. ",kX="Invalid credentials. Could not login. ",VBe="Login credentials are required to access this space.",zBe="File system access is only available in Node.js environments",NX="Root URL not found in client config",GBe="Error uploading file";function PX(t,e,n){return e.startsWith("http://")||e.startsWith("https://")?n?t:e:t+e}async function $V(t,e,n){try{return(await(await fetch(`https://huggingface.co/api/spaces/${t}/jwt`,{headers:{Authorization:`Bearer ${e}`,...n?{Cookie:n}:{}}})).json()).token||!1}catch{return!1}}function qBe(t){let e={};return t.forEach(({api_name:n,id:r})=>{n&&(e[n]=r)}),e}async function WBe(t){var e;const n=this.options.hf_token?{Authorization:`Bearer ${this.options.hf_token}`}:{};if(n["Content-Type"]="application/json",typeof window<"u"&&window.gradio_config&&location.origin!=="http://localhost:9876"&&!window.gradio_config.dev_mode){const r=window.gradio_config.root,i=window.gradio_config;let s=PX(t,i.root,!1);return i.root=s,{...i,path:r}}else if(t){const r=UX(t,IBe),i=await this.fetch(r,{headers:n,credentials:"include"});if((i==null?void 0:i.status)===401&&!this.options.auth)throw new Error(VBe);if((i==null?void 0:i.status)===401&&this.options.auth)throw new Error(kX);if((i==null?void 0:i.status)===200){let s=await i.json();return s.path=s.path??"",s.root=t,(e=s.dependencies)==null||e.forEach((o,a)=>{o.id===void 0&&(o.id=a)}),s}else if((i==null?void 0:i.status)===401)throw new Error(HBe);throw new Error(Pv)}throw new Error(Pv)}async function KBe(){const{http_protocol:t,host:e}=await uk(this.app_reference,this.options.hf_token);try{if(this.options.auth){const n=await DX(t,e,this.options.auth,this.fetch,this.options.hf_token);n&&this.set_cookies(n)}}catch(n){throw Error(n.message)}}async function DX(t,e,n,r,i){const s=new FormData;s.append("username",n==null?void 0:n[0]),s.append("password",n==null?void 0:n[1]);let o={};i&&(o.Authorization=`Bearer ${i}`);const a=await r(`${t}//${e}/${MBe}`,{headers:o,method:"POST",body:s,credentials:"include"});if(a.status===200)return a.headers.get("set-cookie");throw a.status===401?new Error(kX):new Error(ZB)}function BP(t){if(t.startsWith("http")){const{protocol:e,host:n,pathname:r}=new URL(t);return{ws_protocol:e==="https:"?"wss":"ws",http_protocol:e,host:n+(r!=="/"?r:"")}}else if(t.startsWith("file:"))return{ws_protocol:"ws",http_protocol:"http:",host:"lite.local"};return{ws_protocol:"wss",http_protocol:"https:",host:new URL(t).host}}const LX=t=>{let e=[];return t.split(/,(?=\s*[^\s=;]+=[^\s=;]+)/).forEach(r=>{const[i,s]=r.split(";")[0].split("=");i&&s&&e.push(`${i.trim()}=${s.trim()}`)}),e},e3=/^[a-zA-Z0-9_\-\.]+\/[a-zA-Z0-9_\-\.]+$/,YBe=/.*hf\.space\/{0,1}.*$/;async function uk(t,e){const n={};e&&(n.Authorization=`Bearer ${e}`);const r=t.trim().replace(/\/$/,"");if(e3.test(r))try{const s=(await(await fetch(`https://huggingface.co/api/spaces/${r}/${RBe}`,{headers:n})).json()).host;return{space_id:t,...BP(s)}}catch{throw new Error(ZB)}if(YBe.test(r)){const{ws_protocol:i,http_protocol:s,host:o}=BP(r);return{space_id:o.split("/")[0].replace(".hf.space",""),ws_protocol:i,http_protocol:s,host:o}}return{space_id:!1,...BP(r)}}const UX=(...t)=>{try{return t.reduce((e,n)=>(e=e.replace(/\/+$/,""),n=n.replace(/^\/+/,""),new URL(n,e+"/").toString()))}catch{throw new Error($Be)}};function XBe(t,e,n){const r={named_endpoints:{},unnamed_endpoints:{}};return Object.keys(t).forEach(i=>{(i==="named_endpoints"||i==="unnamed_endpoints")&&(r[i]={},Object.entries(t[i]).forEach(([s,{parameters:o,returns:a}])=>{var c,l,u,d;const h=((c=e.dependencies.find(g=>g.api_name===s||g.api_name===s.replace("/","")))==null?void 0:c.id)||n[s.replace("/","")]||-1,f=h!==-1?(l=e.dependencies.find(g=>g.id==h))==null?void 0:l.types:{generator:!1,cancel:!1};if(h!==-1&&((d=(u=e.dependencies.find(g=>g.id==h))==null?void 0:u.inputs)==null?void 0:d.length)!==o.length){const g=e.dependencies.find(v=>v.id==h).inputs.map(v=>{var E;return(E=e.components.find(T=>T.id===v))==null?void 0:E.type});try{g.forEach((v,E)=>{if(v==="state"){const T={component:"state",example:null,parameter_default:null,parameter_has_default:!0,parameter_name:null,hidden:!0};o.splice(E,0,T)}})}catch(v){console.error(v)}}const p=(g,v,E,T)=>({...g,description:QBe(g==null?void 0:g.type,E),type:JBe(g==null?void 0:g.type,v,E,T)||""});r[i][s]={parameters:o.map(g=>p(g,g==null?void 0:g.component,g==null?void 0:g.serializer,"parameter")),returns:a.map(g=>p(g,g==null?void 0:g.component,g==null?void 0:g.serializer,"return")),type:f}}))}),r}function JBe(t,e,n,r){if(e==="Api")return t.type;switch(t==null?void 0:t.type){case"string":return"string";case"boolean":return"boolean";case"number":return"number"}if(n==="JSONSerializable"||n==="StringSerializable")return"any";if(n==="ListStringSerializable")return"string[]";if(e==="Image")return r==="parameter"?"Blob | File | Buffer":"string";if(n==="FileSerializable")return(t==null?void 0:t.type)==="array"?r==="parameter"?"(Blob | File | Buffer)[]":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}[]":r==="parameter"?"Blob | File | Buffer":"{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}";if(n==="GallerySerializable")return r==="parameter"?"[(Blob | File | Buffer), (string | null)][]":"[{ name: string; data: string; size?: number; is_file?: boolean; orig_name?: string}, (string | null))][]"}function QBe(t,e){return e==="GallerySerializable"?"array of [file, label] tuples":e==="ListStringSerializable"?"array of strings":e==="FileSerializable"?"array of files or single file":t==null?void 0:t.description}function jP(t,e){switch(t.msg){case"send_data":return{type:"data"};case"send_hash":return{type:"hash"};case"queue_full":return{type:"update",status:{queue:!0,message:OX,stage:"error",code:t.code,success:t.success}};case"heartbeat":return{type:"heartbeat"};case"unexpected_error":return{type:"unexpected_error",status:{queue:!0,message:t.message,stage:"error",success:!1}};case"estimation":return{type:"update",status:{queue:!0,stage:e||"pending",code:t.code,size:t.queue_size,position:t.rank,eta:t.rank_eta,success:t.success}};case"progress":return{type:"update",status:{queue:!0,stage:"pending",code:t.code,progress_data:t.progress_data,success:t.success}};case"log":return{type:"log",data:t};case"process_generating":return{type:"generating",status:{queue:!0,message:t.success?null:t.output.error,stage:t.success?"generating":"error",code:t.code,progress_data:t.progress_data,eta:t.average_duration,changed_state_ids:t.success?t.output.changed_state_ids:void 0},data:t.success?t.output:null};case"process_streaming":return{type:"streaming",status:{queue:!0,message:t.output.error,stage:"streaming",time_limit:t.time_limit,code:t.code,progress_data:t.progress_data,eta:t.eta},data:t.output};case"process_completed":return"error"in t.output?{type:"update",status:{queue:!0,title:t.output.title,message:t.output.error,visible:t.output.visible,duration:t.output.duration,stage:"error",code:t.code,success:t.success}}:{type:"complete",status:{queue:!0,message:t.success?void 0:t.output.error,stage:t.success?"complete":"error",code:t.code,progress_data:t.progress_data,changed_state_ids:t.success?t.output.changed_state_ids:void 0},data:t.success?t.output:null};case"process_starts":return{type:"update",status:{queue:!0,stage:"pending",code:t.code,size:t.rank,position:0,success:t.success,eta:t.eta},original_msg:"process_starts"}}return{type:"none",status:{stage:"error",queue:!0}}}const ZBe=(t=[],e)=>{const n=e?e.parameters:[];if(Array.isArray(t))return t.length>n.length&&console.warn("Too many arguments provided for the endpoint."),t;const r=[],i=Object.keys(t);return n.forEach((s,o)=>{if(t.hasOwnProperty(s.parameter_name))r[o]=t[s.parameter_name];else if(s.parameter_has_default)r[o]=s.parameter_default;else throw new Error(`No value provided for required parameter: ${s.parameter_name}`)}),i.forEach(s=>{if(!n.some(o=>o.parameter_name===s))throw new Error(`Parameter \`${s}\` is not a valid keyword argument. Please refer to the API for usage.`)}),r.forEach((s,o)=>{if(s===void 0&&!n[o].parameter_has_default)throw new Error(`No value provided for required parameter: ${n[o].parameter_name}`)}),r};async function e3e(){if(this.api_info)return this.api_info;const{hf_token:t}=this.options,{config:e}=this,n={"Content-Type":"application/json"};if(t&&(n.Authorization=`Bearer ${t}`),!!e)try{let r,i;if(typeof window<"u"&&window.gradio_api_info)i=window.gradio_api_info;else{if(MX((e==null?void 0:e.version)||"2.0.0","3.30")<0)r=await this.fetch(FBe,{method:"POST",body:JSON.stringify({serialize:!1,config:JSON.stringify(e)}),headers:n,credentials:"include"});else{const s=UX(e.root,this.api_prefix,OBe);r=await this.fetch(s,{headers:n,credentials:"include"})}if(!r.ok)throw new Error(F0);i=await r.json()}return"api"in i&&(i=i.api),i.named_endpoints["/predict"]&&!i.unnamed_endpoints[0]&&(i.unnamed_endpoints[0]=i.named_endpoints["/predict"]),XBe(i,e,this.api_map)}catch(r){""+r.message}}async function t3e(t,e,n){var r;const i={};(r=this==null?void 0:this.options)!=null&&r.hf_token&&(i.Authorization=`Bearer ${this.options.hf_token}`);const s=1e3,o=[];let a;for(let c=0;c<e.length;c+=s){const l=e.slice(c,c+s),u=new FormData;l.forEach(h=>{u.append("files",h)});try{const h=n?`${t}${this.api_prefix}/${jV}?upload_id=${n}`:`${t}${this.api_prefix}/${jV}`;a=await this.fetch(h,{method:"POST",body:u,headers:i,credentials:"include"})}catch(h){throw new Error(F0+h.message)}if(!a.ok){const h=await a.text();return{error:`HTTP ${a.status}: ${h}`}}const d=await a.json();d&&o.push(...d)}return{files:o}}async function n3e(t,e,n,r){let i=(Array.isArray(t)?t:[t]).map(o=>o.blob);const s=i.filter(o=>o.size>(r??1/0));if(s.length)throw new Error(`File size exceeds the maximum allowed size of ${r} bytes: ${s.map(o=>o.name).join(", ")}`);return await Promise.all(await this.upload_files(e,i,n).then(async o=>{if(o.error)throw new Error(o.error);return o.files?o.files.map((a,c)=>new t3({...t[c],path:a,url:`${e}${this.api_prefix}/file=${a}`})):[]}))}class t3{constructor({path:e,url:n,orig_name:r,size:i,blob:s,is_stream:o,mime_type:a,alt_text:c,b64:l}){Dr(this,"path"),Dr(this,"url"),Dr(this,"orig_name"),Dr(this,"size"),Dr(this,"blob"),Dr(this,"is_stream"),Dr(this,"mime_type"),Dr(this,"alt_text"),Dr(this,"b64"),Dr(this,"meta",{_type:"gradio.FileData"}),this.path=e,this.url=n,this.orig_name=r,this.size=i,this.blob=n?void 0:s,this.is_stream=o,this.mime_type=a,this.alt_text=c,this.b64=l}}class r3e{constructor(e,n){Dr(this,"type"),Dr(this,"command"),Dr(this,"meta"),Dr(this,"fileData"),this.type="command",this.command=e,this.meta=n}}typeof Hn<"u"&&Hn.versions&&Hn.versions.node;function HV(t,e,n){for(;n.length>1;){const i=n.shift();if(typeof i=="string"||typeof i=="number")t=t[i];else throw new Error("Invalid key type")}const r=n.shift();if(typeof r=="string"||typeof r=="number")t[r]=e;else throw new Error("Invalid key type")}async function eU(t,e=void 0,n=[],r=!1,i=void 0){if(Array.isArray(t)){let s=[];return await Promise.all(t.map(async(o,a)=>{var c;let l=n.slice();l.push(String(a));const u=await eU(t[a],r?((c=i==null?void 0:i.parameters[a])==null?void 0:c.component)||void 0:e,l,!1,i);s=s.concat(u)})),s}else{if(globalThis.Buffer&&t instanceof globalThis.Buffer||t instanceof Blob)return[{path:n,blob:new Blob([t]),type:e}];if(typeof t=="object"&&t!==null){let s=[];for(const o of Object.keys(t)){const a=[...n,o],c=t[o];s=s.concat(await eU(c,void 0,a,!1,i))}return s}}return[]}function i3e(t,e){var n,r;let i=(r=(n=e==null?void 0:e.dependencies)==null?void 0:n.find(s=>s.id==t))==null?void 0:r.queue;return i!=null?!i:!e.enable_queue}function s3e(t,e){return new Promise((n,r)=>{const i=new MessageChannel;i.port1.onmessage=({data:s})=>{i.port1.close(),n(s)},window.parent.postMessage(t,e,[i.port2])})}function IS(t,e,n,r,i=!1){if(r==="input"&&!i)throw new Error("Invalid code path. Cannot skip state inputs for input.");if(r==="output"&&i)return t;let s=[],o=0;const a=r==="input"?e.inputs:e.outputs;for(let c=0;c<a.length;c++){const l=a[c],u=n.find(d=>d.id===l);if((u==null?void 0:u.type)==="state"){if(i)if(t.length===a.length){const d=t[o];s.push(d),o++}else s.push(null);else{o++;continue}continue}else{const d=t[o];s.push(d),o++}}return s}async function o3e(t,e,n){const r=this;await a3e(r,e);const i=await eU(e,void 0,[],!0,n);return(await Promise.all(i.map(async({path:o,blob:a,type:c})=>{if(!a)return{path:o,type:c};const l=await r.upload_files(t,[a]),u=l.files&&l.files[0];return{path:o,file_url:u,type:c,name:typeof File<"u"&&a instanceof File?a==null?void 0:a.name:void 0}}))).forEach(({path:o,file_url:a,type:c,name:l})=>{if(c==="Gallery")HV(e,a,o);else if(a){const u=new t3({path:a,orig_name:l});HV(e,u,o)}}),e}async function a3e(t,e){var n,r;if(!(((n=t.config)==null?void 0:n.root)||((r=t.config)==null?void 0:r.root_url)))throw new Error(NX);await FX(t,e)}async function FX(t,e,n=[]){for(const r in e)e[r]instanceof r3e?await c3e(t,e,r):typeof e[r]=="object"&&e[r]!==null&&await FX(t,e[r],[...n,r])}async function c3e(t,e,n){var r,i;let s=e[n];const o=((r=t.config)==null?void 0:r.root)||((i=t.config)==null?void 0:i.root_url);if(!o)throw new Error(NX);try{let a,c;if(typeof Hn<"u"&&Hn.versions&&Hn.versions.node){const h=await Z2(()=>Promise.resolve().then(()=>y2),void 0);c=(await Z2(()=>Promise.resolve().then(()=>y2),void 0)).resolve(Hn.cwd(),s.meta.path),a=await h.readFile(c)}else throw new Error(zBe);const l=new Blob([a],{type:"application/octet-stream"}),u=await t.upload_files(o,[l]),d=u.files&&u.files[0];if(d){const h=new t3({path:d,orig_name:s.meta.name||""});e[n]=h}}catch(a){console.error(GBe,a)}}async function l3e(t,e,n){const r={"Content-Type":"application/json"};this.options.hf_token&&(r.Authorization=`Bearer ${this.options.hf_token}`);try{var i=await this.fetch(t,{method:"POST",body:JSON.stringify(e),headers:{...r,...n},credentials:"include"})}catch{return[{error:F0},500]}let s,o;try{s=await i.json(),o=i.status}catch(a){s={error:`Could not parse server response: ${a}`},o=500}return[s,o]}async function u3e(t,e={}){let n=!1,r=!1;if(!this.config)throw new Error("Could not resolve app config");if(typeof t=="number")this.config.dependencies.find(i=>i.id==t);else{const i=t.replace(/^\//,"");this.config.dependencies.find(s=>s.id==this.api_map[i])}return new Promise(async(i,s)=>{const o=this.submit(t,e,null,null,!0);let a;for await(const c of o)c.type==="data"&&(r&&i(a),n=!0,a=c),c.type==="status"&&(c.stage==="error"&&s(c),c.stage==="complete"&&(r=!0,n&&i(a)))})}async function aw(t,e,n){let r=e==="subdomain"?`https://huggingface.co/api/spaces/by-subdomain/${t}`:`https://huggingface.co/api/spaces/${t}`,i,s;try{if(i=await fetch(r),s=i.status,s!==200)throw new Error;i=await i.json()}catch{n({status:"error",load_status:"error",message:BBe,detail:"NOT_FOUND"});return}if(!i||s!==200)return;const{runtime:{stage:o},id:a}=i;switch(o){case"STOPPED":case"SLEEPING":n({status:"sleeping",load_status:"pending",message:"Space is asleep. Waking it up...",detail:o}),setTimeout(()=>{aw(t,e,n)},1e3);break;case"PAUSED":n({status:"paused",load_status:"error",message:"This space has been paused by the author. If you would like to try this demo, consider duplicating the space.",detail:o,discussions_enabled:await VV(a)});break;case"RUNNING":case"RUNNING_BUILDING":n({status:"running",load_status:"complete",message:"Space is running.",detail:o});break;case"BUILDING":n({status:"building",load_status:"pending",message:"Space is building...",detail:o}),setTimeout(()=>{aw(t,e,n)},1e3);break;case"APP_STARTING":n({status:"starting",load_status:"pending",message:"Space is starting...",detail:o}),setTimeout(()=>{aw(t,e,n)},1e3);break;default:n({status:"space_error",load_status:"error",message:"This space is experiencing an issue.",detail:o,discussions_enabled:await VV(a)});break}}const BX=async(t,e)=>{let n=0;const r=12,i=5e3;return new Promise(s=>{aw(t,e3.test(t)?"space_name":"subdomain",o=>{e(o),o.status==="running"||o.status==="error"||o.status==="paused"||o.status==="space_error"?s():(o.status==="sleeping"||o.status==="building")&&(n<r?(n++,setTimeout(()=>{BX(t,e).then(s)},i)):s())})})},d3e=/^(?=[^]*\b[dD]iscussions{0,1}\b)(?=[^]*\b[dD]isabled\b)[^]*$/;async function VV(t){try{const e=await fetch(`https://huggingface.co/api/spaces/${t}/discussions`,{method:"HEAD"}),n=e.headers.get("x-error-message");return!(!e.ok||n&&d3e.test(n))}catch{return!1}}async function h3e(t,e){const n={};e&&(n.Authorization=`Bearer ${e}`);try{const r=await fetch(`https://huggingface.co/api/spaces/${t}/${kBe}`,{headers:n});if(r.status!==200)throw new Error("Space hardware could not be obtained.");const{hardware:i}=await r.json();return i.current}catch(r){throw new Error(r.message)}}async function f3e(t,e,n){const r={};n&&(r.Authorization=`Bearer ${n}`);const i={seconds:e};try{const s=await fetch(`https://huggingface.co/api/spaces/${t}/${NBe}`,{method:"POST",headers:{"Content-Type":"application/json",...r},body:JSON.stringify(i)});if(s.status!==200)throw new Error("Could not set sleep timeout on duplicated Space. Please visit *ADD HF LINK TO SETTINGS* to set a timeout manually to reduce billing charges.");return await s.json()}catch(s){throw new Error(s.message)}}const zV=["cpu-basic","cpu-upgrade","cpu-xl","t4-small","t4-medium","a10g-small","a10g-large","a10g-largex2","a10g-largex4","a100-large","zero-a10g","h100","h100x8"];async function p3e(t,e){const{hf_token:n,private:r,hardware:i,timeout:s,auth:o}=e;if(i&&!zV.includes(i))throw new Error(`Invalid hardware type provided. Valid types are: ${zV.map(v=>`"${v}"`).join(",")}.`);const{http_protocol:a,host:c}=await uk(t,n);let l=null;if(o){const v=await DX(a,c,o,fetch);v&&(l=LX(v))}const u={Authorization:`Bearer ${n}`,"Content-Type":"application/json",...l?{Cookie:l.join("; ")}:{}},d=(await(await fetch("https://huggingface.co/api/whoami-v2",{headers:u})).json()).name,h=t.split("/")[1],f={repository:`${d}/${h}`};r&&(f.private=!0);let p;try{i||(p=await h3e(t,n))}catch(v){throw Error(ZB+v.message)}const g=i||p||"cpu-basic";f.hardware=g;try{const v=await fetch(`https://huggingface.co/api/spaces/${t}/duplicate`,{method:"POST",headers:u,body:JSON.stringify(f)});if(v.status===409)try{return await tU.connect(`${d}/${h}`,e)}catch(T){throw console.error("Failed to connect Client instance:",T),T}else if(v.status!==200)throw new Error(v.statusText);const E=await v.json();return await f3e(`${d}/${h}`,s||300,n),await tU.connect(m3e(E.url),e)}catch(v){throw new Error(v)}}function m3e(t){const e=/https:\/\/huggingface.co\/spaces\/([^/]+\/[^/]+)/,n=t.match(e);if(n)return n[1]}class g3e extends TransformStream{constructor(e={allowCR:!1}){super({transform:(n,r)=>{for(n=MS(this,Cv)+n;;){const i=n.indexOf(`
`),s=e.allowCR?n.indexOf("\r"):-1;if(s!==-1&&s!==n.length-1&&(i===-1||i-1>s)){r.enqueue(n.slice(0,s)),n=n.slice(s+1);continue}if(i===-1)break;const o=n[i-1]==="\r"?i-1:i;r.enqueue(n.slice(0,o)),n=n.slice(i+1)}CBe(this,Cv,n)},flush:n=>{if(MS(this,Cv)==="")return;const r=e.allowCR&&MS(this,Cv).endsWith("\r")?MS(this,Cv).slice(0,-1):MS(this,Cv);n.enqueue(r)}}),xBe(this,Cv,"")}}Cv=new WeakMap;function v3e(t){let e=new TextDecoderStream,n=new g3e({allowCR:!0});return t.pipeThrough(e).pipeThrough(n)}function _3e(t){let n=/[:]\s*/.exec(t),r=n&&n.index;if(r)return[t.substring(0,r),t.substring(r+n[0].length)]}function GV(t,e,n){t.get(e)||t.set(e,n)}async function*y3e(t,e){if(!t.body)return;let n=v3e(t.body),r,i=n.getReader(),s;for(;;){if(e&&e.aborted)return i.cancel();if(r=await i.read(),r.done)return;if(!r.value){s&&(yield s),s=void 0;continue}let[o,a]=_3e(r.value)||[];o&&(o==="data"?(s||(s={}),s[o]=s[o]?s[o]+`
`+a:a):o==="event"?(s||(s={}),s[o]=a):o==="id"?(s||(s={}),s[o]=+a||a):o==="retry"&&(s||(s={}),s[o]=+a||void 0))}}async function b3e(t,e){let n=new Request(t,e);GV(n.headers,"Accept","text/event-stream"),GV(n.headers,"Content-Type","application/json");let r=await fetch(n);if(!r.ok)throw r;return y3e(r,n.signal)}async function E3e(){let{event_callbacks:t,unclosed_events:e,pending_stream_messages:n,stream_status:r,config:i,jwt:s}=this;const o=this;if(!i)throw new Error("Could not resolve app config");r.open=!0;let a=null,c=new URLSearchParams({session_hash:this.session_hash}).toString(),l=new URL(`${i.root}${this.api_prefix}/${IX}?${c}`);if(s&&l.searchParams.set("__sign",s),a=this.stream(l),!a){console.warn("Cannot connect to SSE endpoint: "+l.toString());return}a.onmessage=async function(u){let d=JSON.parse(u.data);if(d.msg==="close_stream"){BR(r,o.abort_controller);return}const h=d.event_id;if(!h)await Promise.all(Object.keys(t).map(f=>t[f](d)));else if(t[h]&&i){d.msg==="process_completed"&&["sse","sse_v1","sse_v2","sse_v2.1","sse_v3"].includes(i.protocol)&&e.delete(h);let f=t[h];typeof window<"u"&&typeof document<"u"?setTimeout(f,0,d):f(d)}else n[h]||(n[h]=[]),n[h].push(d)},a.onerror=async function(){await Promise.all(Object.keys(t).map(u=>t[u]({msg:"unexpected_error",message:F0})))}}function BR(t,e){t&&(t.open=!1,e==null||e.abort())}function S3e(t,e,n){!t[e]?(t[e]=[],n.data.forEach((i,s)=>{t[e][s]=i})):n.data.forEach((i,s)=>{let o=w3e(t[e][s],i);t[e][s]=o,n.data[s]=o})}function w3e(t,e){return e.forEach(([n,r,i])=>{t=T3e(t,r,n,i)}),t}function T3e(t,e,n,r){if(e.length===0){if(n==="replace")return r;if(n==="append")return t+r;throw new Error(`Unsupported action: ${n}`)}let i=t;for(let o=0;o<e.length-1;o++)i=i[e[o]];const s=e[e.length-1];switch(n){case"replace":i[s]=r;break;case"append":i[s]+=r;break;case"add":Array.isArray(i)?i.splice(Number(s),0,r):i[s]=r;break;case"delete":Array.isArray(i)?i.splice(Number(s),1):delete i[s];break;default:throw new Error(`Unknown action: ${n}`)}return t}function x3e(t,e={}){const n={close:()=>{console.warn("Method not implemented.")},onerror:null,onmessage:null,onopen:null,readyState:0,url:t.toString(),withCredentials:!1,CONNECTING:0,OPEN:1,CLOSED:2,addEventListener:()=>{throw new Error("Method not implemented.")},dispatchEvent:()=>{throw new Error("Method not implemented.")},removeEventListener:()=>{throw new Error("Method not implemented.")}};return b3e(t,e).then(async r=>{n.readyState=n.OPEN;try{for await(const i of r)n.onmessage&&n.onmessage(i);n.readyState=n.CLOSED}catch(i){n.onerror&&n.onerror(i),n.readyState=n.CLOSED}}).catch(r=>{console.error(r),n.onerror&&n.onerror(r),n.readyState=n.CLOSED}),n}function C3e(t,e={},n,r,i){var s;try{let o=function(ut){(i||Te[ut.type])&&u(ut)},a=function(){for(me=!0;nt.length>0;)nt.shift()({value:void 0,done:!0})},c=function(ut){me||(nt.length>0?nt.shift()(ut):ge.push(ut))},l=function(ut){c(R3e(ut)),a()},u=function(ut){c({value:ut,done:!1})},d=function(){return ge.length>0?Promise.resolve(ge.shift()):me?Promise.resolve({value:void 0,done:!0}):new Promise(ut=>nt.push(ut))};const{hf_token:h}=this.options,{fetch:f,app_reference:p,config:g,session_hash:v,api_info:E,api_map:T,stream_status:C,pending_stream_messages:A,pending_diff_streams:k,event_callbacks:I,unclosed_events:N,post_data:U,options:F,api_prefix:$}=this,X=this;if(!E)throw new Error("No API found");if(!g)throw new Error("Could not resolve app config");let{fn_index:q,endpoint_info:W,dependency:K}=A3e(E,t,T,g),ne=ZBe(e,W),Q,ie,G=g.protocol??"ws",Z="",se=()=>Z;const ue=typeof t=="number"?"/predict":t;let Ae,Be=null,Se=!1,Pe={},we=typeof window<"u"&&typeof document<"u"?new URLSearchParams(window.location.search).toString():"";const Te=((s=F==null?void 0:F.events)==null?void 0:s.reduce((ut,He)=>(ut[He]=!0,ut),{}))||{};async function Oe(){const ut={stage:"complete",queue:!1,time:new Date};Se=ut,o({...ut,type:"status",endpoint:ue,fn_index:q});let He={},Rt={};G==="ws"?(Q&&Q.readyState===0?Q.addEventListener("open",()=>{Q.close()}):Q.close(),He={fn_index:q,session_hash:v}):(BR(C,X.abort_controller),a(),He={event_id:Be},Rt={event_id:Be,session_hash:v,fn_index:q});try{if(!g)throw new Error("Could not resolve app config");"event_id"in Rt&&await f(`${g.root}${$}/${UBe}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(Rt)}),await f(`${g.root}${$}/${LBe}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(He)})}catch{console.warn("The `/reset` endpoint could not be called. Subsequent endpoint results may be unreliable.")}}const _t=async ut=>{await this._resolve_hearbeat(ut)};async function Ct(ut){if(!g)return;let He=ut.render_id;g.components=[...g.components.filter(Tt=>Tt.props.rendered_in!==He),...ut.components],g.dependencies=[...g.dependencies.filter(Tt=>Tt.rendered_in!==He),...ut.dependencies];const Rt=g.components.some(Tt=>Tt.type==="state"),$t=g.dependencies.some(Tt=>Tt.targets.some(Ft=>Ft[1]==="unload"));g.connect_heartbeat=Rt||$t,await _t(g),o({type:"render",data:ut,endpoint:ue,fn_index:q})}this.handle_blob(g.root,ne,W).then(async ut=>{var He;if(Ae={data:IS(ut,K,g.components,"input",!0)||[],event_data:n,fn_index:q,trigger_id:r},i3e(q,g))o({type:"status",endpoint:ue,stage:"pending",queue:!1,fn_index:q,time:new Date}),U(`${g.root}${$}/run${ue.startsWith("/")?ue:`/${ue}`}${we?"?"+we:""}`,{...Ae,session_hash:v}).then(([Tt,Ft])=>{const Ee=Tt.data;Ft==200?(o({type:"data",endpoint:ue,fn_index:q,data:IS(Ee,K,g.components,"output",F.with_null_state),time:new Date,event_data:n,trigger_id:r}),Tt.render_config&&Ct(Tt.render_config),o({type:"status",endpoint:ue,fn_index:q,stage:"complete",eta:Tt.average_duration,queue:!1,time:new Date})):o({type:"status",stage:"error",endpoint:ue,fn_index:q,message:Tt.error,queue:!1,time:new Date})}).catch(Tt=>{o({type:"status",stage:"error",message:Tt.message,endpoint:ue,fn_index:q,queue:!1,time:new Date})});else if(G=="ws"){const{ws_protocol:Tt,host:Ft}=await uk(p,h);o({type:"status",stage:"pending",queue:!0,endpoint:ue,fn_index:q,time:new Date});let Ee=new URL(`${Tt}://${PX(Ft,g.path,!0)}/queue/join${we?"?"+we:""}`);this.jwt&&Ee.searchParams.set("__sign",this.jwt),Q=new WebSocket(Ee),Q.onclose=le=>{le.wasClean||o({type:"status",stage:"error",broken:!0,message:F0,queue:!0,endpoint:ue,fn_index:q,time:new Date})},Q.onmessage=function(le){const We=JSON.parse(le.data),{type:it,status:je,data:Fe}=jP(We,Pe[q]);if(it==="update"&&je&&!Se)o({type:"status",endpoint:ue,fn_index:q,time:new Date,...je}),je.stage==="error"&&Q.close();else if(it==="hash"){Q.send(JSON.stringify({fn_index:q,session_hash:v}));return}else it==="data"?Q.send(JSON.stringify({...Ae,session_hash:v})):it==="complete"?Se=je:it==="log"?o({type:"log",title:Fe.title,log:Fe.log,level:Fe.level,endpoint:ue,duration:Fe.duration,visible:Fe.visible,fn_index:q}):it==="generating"&&o({type:"status",time:new Date,...je,stage:je==null?void 0:je.stage,queue:!0,endpoint:ue,fn_index:q});Fe&&(o({type:"data",time:new Date,data:IS(Fe.data,K,g.components,"output",F.with_null_state),endpoint:ue,fn_index:q,event_data:n,trigger_id:r}),Se&&(o({type:"status",time:new Date,...Se,stage:je==null?void 0:je.stage,queue:!0,endpoint:ue,fn_index:q}),Q.close()))},MX(g.version||"2.0.0","3.6")<0&&addEventListener("open",()=>Q.send(JSON.stringify({hash:v})))}else if(G=="sse"){o({type:"status",stage:"pending",queue:!0,endpoint:ue,fn_index:q,time:new Date});var $t=new URLSearchParams({fn_index:q.toString(),session_hash:v}).toString();let Tt=new URL(`${g.root}${$}/${IX}?${we?we+"&":""}${$t}`);if(this.jwt&&Tt.searchParams.set("__sign",this.jwt),ie=this.stream(Tt),!ie)return Promise.reject(new Error("Cannot connect to SSE endpoint: "+Tt.toString()));ie.onmessage=async function(Ft){const Ee=JSON.parse(Ft.data),{type:le,status:We,data:it}=jP(Ee,Pe[q]);if(le==="update"&&We&&!Se)o({type:"status",endpoint:ue,fn_index:q,time:new Date,...We}),We.stage==="error"&&(ie==null||ie.close(),a());else if(le==="data"){let[je,Fe]=await U(`${g.root}${$}/queue/data`,{...Ae,session_hash:v,event_id:Be});Fe!==200&&(o({type:"status",stage:"error",message:F0,queue:!0,endpoint:ue,fn_index:q,time:new Date}),ie==null||ie.close(),a())}else le==="complete"?Se=We:le==="log"?o({type:"log",title:it.title,log:it.log,level:it.level,endpoint:ue,duration:it.duration,visible:it.visible,fn_index:q}):(le==="generating"||le==="streaming")&&o({type:"status",time:new Date,...We,stage:We==null?void 0:We.stage,queue:!0,endpoint:ue,fn_index:q});it&&(o({type:"data",time:new Date,data:IS(it.data,K,g.components,"output",F.with_null_state),endpoint:ue,fn_index:q,event_data:n,trigger_id:r}),Se&&(o({type:"status",time:new Date,...Se,stage:We==null?void 0:We.stage,queue:!0,endpoint:ue,fn_index:q}),ie==null||ie.close(),a()))}}else if(G=="sse_v1"||G=="sse_v2"||G=="sse_v2.1"||G=="sse_v3"){o({type:"status",stage:"pending",queue:!0,endpoint:ue,fn_index:q,time:new Date});let Tt="";typeof window<"u"&&typeof document<"u"&&(Tt=(He=window==null?void 0:window.location)==null?void 0:He.hostname);const Ee=Tt.includes(".dev.")?`https://moon-${Tt.split(".")[1]}.dev.spaces.huggingface.tech`:"https://huggingface.co";(typeof window<"u"&&typeof document<"u"&&window.parent!=window&&window.supports_zerogpu_headers?s3e("zerogpu-headers",Ee):Promise.resolve(null)).then(je=>U(`${g.root}${$}/${ABe}?${we}`,{...Ae,session_hash:v},je)).then(async([je,Fe])=>{if(Fe===503)o({type:"status",stage:"error",message:OX,queue:!0,endpoint:ue,fn_index:q,time:new Date});else if(Fe!==200)o({type:"status",stage:"error",message:F0,queue:!0,endpoint:ue,fn_index:q,time:new Date});else{Be=je.event_id,Z=Be;let Ht=async function(St){try{const{type:Dt,status:oe,data:j,original_msg:V}=jP(St,Pe[q]);if(Dt=="heartbeat")return;if(Dt==="update"&&oe&&!Se)o({type:"status",endpoint:ue,fn_index:q,time:new Date,original_msg:V,...oe});else if(Dt==="complete")Se=oe;else if(Dt=="unexpected_error")console.error("Unexpected error",oe==null?void 0:oe.message),o({type:"status",stage:"error",message:(oe==null?void 0:oe.message)||"An Unexpected Error Occurred!",queue:!0,endpoint:ue,fn_index:q,time:new Date});else if(Dt==="log"){o({type:"log",title:j.title,log:j.log,level:j.level,endpoint:ue,duration:j.duration,visible:j.visible,fn_index:q});return}else(Dt==="generating"||Dt==="streaming")&&(o({type:"status",time:new Date,...oe,stage:oe==null?void 0:oe.stage,queue:!0,endpoint:ue,fn_index:q}),j&&K.connection!=="stream"&&["sse_v2","sse_v2.1","sse_v3"].includes(G)&&S3e(k,Be,j));j&&(o({type:"data",time:new Date,data:IS(j.data,K,g.components,"output",F.with_null_state),endpoint:ue,fn_index:q}),j.render_config&&await Ct(j.render_config),Se&&(o({type:"status",time:new Date,...Se,stage:oe==null?void 0:oe.stage,queue:!0,endpoint:ue,fn_index:q}),a())),((oe==null?void 0:oe.stage)==="complete"||(oe==null?void 0:oe.stage)==="error")&&(I[Be]&&delete I[Be],Be in k&&delete k[Be])}catch(Dt){console.error("Unexpected client exception",Dt),o({type:"status",stage:"error",message:"An Unexpected Error Occurred!",queue:!0,endpoint:ue,fn_index:q,time:new Date}),["sse_v2","sse_v2.1","sse_v3"].includes(G)&&(BR(C,X.abort_controller),C.open=!1,a())}};Be in A&&(A[Be].forEach(St=>Ht(St)),delete A[Be]),I[Be]=Ht,N.add(Be),C.open||await this.open_stream()}})}});let me=!1;const ge=[],nt=[],Ce={[Symbol.asyncIterator]:()=>Ce,next:d,throw:async ut=>(l(ut),d()),return:async()=>(a(),d()),cancel:Oe,event_id:se};return Ce}catch(o){throw console.error("Submit function encountered an error:",o),o}}function R3e(t){return{then:(e,n)=>n(t)}}function A3e(t,e,n,r){let i,s,o;if(typeof e=="number")i=e,s=t.unnamed_endpoints[i],o=r.dependencies.find(a=>a.id==e);else{const a=e.replace(/^\//,"");i=n[a],s=t.named_endpoints[e.trim()],o=r.dependencies.find(c=>c.id==n[a])}if(typeof i!="number")throw new Error("There is no endpoint matching that name of fn_index matching that number.");return{fn_index:i,endpoint_info:s,dependency:o}}class tU{constructor(e,n={events:["data"]}){Dr(this,"app_reference"),Dr(this,"options"),Dr(this,"config"),Dr(this,"api_prefix",""),Dr(this,"api_info"),Dr(this,"api_map",{}),Dr(this,"session_hash",Math.random().toString(36).substring(2)),Dr(this,"jwt",!1),Dr(this,"last_status",{}),Dr(this,"cookies",null),Dr(this,"stream_status",{open:!1}),Dr(this,"pending_stream_messages",{}),Dr(this,"pending_diff_streams",{}),Dr(this,"event_callbacks",{}),Dr(this,"unclosed_events",new Set),Dr(this,"heartbeat_event",null),Dr(this,"abort_controller",null),Dr(this,"stream_instance",null),Dr(this,"current_payload"),Dr(this,"ws_map",{}),Dr(this,"view_api"),Dr(this,"upload_files"),Dr(this,"upload"),Dr(this,"handle_blob"),Dr(this,"post_data"),Dr(this,"submit"),Dr(this,"predict"),Dr(this,"open_stream"),Dr(this,"resolve_config"),Dr(this,"resolve_cookies"),this.app_reference=e,n.events||(n.events=["data"]),this.options=n,this.current_payload={},this.view_api=e3e.bind(this),this.upload_files=t3e.bind(this),this.handle_blob=o3e.bind(this),this.post_data=l3e.bind(this),this.submit=C3e.bind(this),this.predict=u3e.bind(this),this.open_stream=E3e.bind(this),this.resolve_config=WBe.bind(this),this.resolve_cookies=KBe.bind(this),this.upload=n3e.bind(this),this.fetch=this.fetch.bind(this),this.handle_space_success=this.handle_space_success.bind(this),this.stream=this.stream.bind(this)}get_url_config(e=null){if(!this.config)throw new Error(Pv);e===null&&(e=window.location.href);const n=o=>o.replace(/^\/+|\/+$/g,"");let r=n(new URL(this.config.root).pathname),i=n(new URL(e).pathname),s;return i.startsWith(r)?s=n(i.substring(r.length)):s="",this.get_page_config(s)}get_page_config(e){if(!this.config)throw new Error(Pv);let n=this.config;return e in n.page||(e=""),{...n,current_page:e,layout:n.page[e].layout,components:n.components.filter(r=>n.page[e].components.includes(r.id)),dependencies:this.config.dependencies.filter(r=>n.page[e].dependencies.includes(r.id))}}fetch(e,n){const r=new Headers((n==null?void 0:n.headers)||{});if(this&&this.cookies&&r.append("Cookie",this.cookies),this&&this.options.headers)for(const i in this.options.headers)r.append(i,this.options.headers[i]);return fetch(e,{...n,headers:r})}stream(e){const n=new Headers;if(this&&this.cookies&&n.append("Cookie",this.cookies),this&&this.options.headers)for(const r in this.options.headers)n.append(r,this.options.headers[r]);return this.abort_controller=new AbortController,this.stream_instance=x3e(e.toString(),{credentials:"include",headers:n,signal:this.abort_controller.signal}),this.stream_instance}async init(){var e;if((typeof window>"u"||!("WebSocket"in window))&&!Oh.WebSocket){const n=await Z2(()=>import("./wrapper-CviSselG-DnJ3Out8.js"),[]);Oh.WebSocket=n.WebSocket}this.options.auth&&await this.resolve_cookies(),await this._resolve_config().then(({config:n})=>this._resolve_hearbeat(n)),this.api_info=await this.view_api(),this.api_map=qBe(((e=this.config)==null?void 0:e.dependencies)||[])}async _resolve_hearbeat(e){if(e&&(this.config=e,this.api_prefix=e.api_prefix||"",this.config&&this.config.connect_heartbeat&&this.config.space_id&&this.options.hf_token&&(this.jwt=await $V(this.config.space_id,this.options.hf_token,this.cookies))),e.space_id&&this.options.hf_token&&(this.jwt=await $V(e.space_id,this.options.hf_token)),this.config&&this.config.connect_heartbeat){const n=new URL(`${this.config.root}${this.api_prefix}/${PBe}/${this.session_hash}`);this.jwt&&n.searchParams.set("__sign",this.jwt),this.heartbeat_event||(this.heartbeat_event=this.stream(n))}}static async connect(e,n={events:["data"]}){const r=new this(e,n);return await r.init(),r}close(){BR(this.stream_status,this.abort_controller)}set_current_payload(e){this.current_payload=e}static async duplicate(e,n={events:["data"]}){return p3e(e,n)}async _resolve_config(){const{http_protocol:e,host:n,space_id:r}=await uk(this.app_reference,this.options.hf_token),{status_callback:i}=this.options;r&&i&&await BX(r,i);let s;try{if(s=await this.resolve_config(`${e}//${n}`),!s)throw new Error(Pv);return this.config_success(s)}catch(o){if(r&&i)aw(r,e3.test(r)?"space_name":"subdomain",this.handle_space_success);else throw i&&i({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),Error(o)}}async config_success(e){if(this.config=e,this.api_prefix=e.api_prefix||"",typeof window<"u"&&typeof document<"u"&&window.location.protocol==="https:"&&(this.config.root=this.config.root.replace("http://","https://")),this.config.auth_required)return this.prepare_return_obj();try{this.api_info=await this.view_api()}catch(n){console.error(jBe+n.message)}return this.prepare_return_obj()}async handle_space_success(e){var n;if(!this)throw new Error(Pv);const{status_callback:r}=this.options;if(r&&r(e),e.status==="running")try{if(this.config=await this._resolve_config(),this.api_prefix=((n=this==null?void 0:this.config)==null?void 0:n.api_prefix)||"",!this.config)throw new Error(Pv);return await this.config_success(this.config)}catch(i){throw r&&r({status:"error",message:"Could not load this space.",load_status:"error",detail:"NOT_FOUND"}),i}}async component_server(e,n,r){var i;if(!this.config)throw new Error(Pv);const s={},{hf_token:o}=this.options,{session_hash:a}=this;o&&(s.Authorization=`Bearer ${this.options.hf_token}`);let c,l=this.config.components.find(d=>d.id===e);(i=l==null?void 0:l.props)!=null&&i.root_url?c=l.props.root_url:c=this.config.root;let u;if("binary"in r){u=new FormData;for(const d in r.data)d!=="binary"&&u.append(d,r.data[d]);u.set("component_id",e.toString()),u.set("fn_name",n),u.set("session_hash",a)}else u=JSON.stringify({data:r,component_id:e,fn_name:n,session_hash:a}),s["Content-Type"]="application/json";o&&(s.Authorization=`Bearer ${o}`);try{const d=await this.fetch(`${c}${this.api_prefix}/${DBe}/`,{method:"POST",body:u,headers:s,credentials:"include"});if(!d.ok)throw new Error("Could not connect to component server: "+d.statusText);return await d.json()}catch(d){console.warn(d)}}set_cookies(e){this.cookies=LX(e).join("; ")}prepare_return_obj(){return{config:this.config,predict:this.predict,submit:this.submit,view_api:this.view_api,component_server:this.component_server}}async connect_ws(e){return new Promise((n,r)=>{let i;try{i=new WebSocket(e)}catch{this.ws_map[e]="failed";return}i.onopen=()=>{n()},i.onerror=s=>{console.error("WebSocket error:",s),this.close_ws(e),this.ws_map[e]="failed",n()},i.onclose=()=>{delete this.ws_map[e],this.ws_map[e]="failed"},i.onmessage=s=>{},this.ws_map[e]=i})}async send_ws_message(e,n){e in this.ws_map||await this.connect_ws(e);const r=this.ws_map[e];r instanceof WebSocket?r.send(JSON.stringify(n)):this.post_data(e,n)}async close_ws(e){if(e in this.ws_map){const n=this.ws_map[e];n instanceof WebSocket&&(n.close(),delete this.ws_map[e])}}}function ry(t){"@babel/helpers - typeof";return ry=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ry(t)}function Fu(){Fu=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(Q,ie,G){Q[ie]=G.value},s=typeof Symbol=="function"?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function l(Q,ie,G){return Object.defineProperty(Q,ie,{value:G,enumerable:!0,configurable:!0,writable:!0}),Q[ie]}try{l({},"")}catch{l=function(G,Z,se){return G[Z]=se}}function u(Q,ie,G,Z){var se=ie&&ie.prototype instanceof E?ie:E,ue=Object.create(se.prototype),Ae=new K(Z||[]);return i(ue,"_invoke",{value:$(Q,G,Ae)}),ue}function d(Q,ie,G){try{return{type:"normal",arg:Q.call(ie,G)}}catch(Z){return{type:"throw",arg:Z}}}e.wrap=u;var h="suspendedStart",f="suspendedYield",p="executing",g="completed",v={};function E(){}function T(){}function C(){}var A={};l(A,o,function(){return this});var k=Object.getPrototypeOf,I=k&&k(k(ne([])));I&&I!==n&&r.call(I,o)&&(A=I);var N=C.prototype=E.prototype=Object.create(A);function U(Q){["next","throw","return"].forEach(function(ie){l(Q,ie,function(G){return this._invoke(ie,G)})})}function F(Q,ie){function G(se,ue,Ae,Be){var Se=d(Q[se],Q,ue);if(Se.type!=="throw"){var Pe=Se.arg,we=Pe.value;return we&&ry(we)=="object"&&r.call(we,"__await")?ie.resolve(we.__await).then(function(Te){G("next",Te,Ae,Be)},function(Te){G("throw",Te,Ae,Be)}):ie.resolve(we).then(function(Te){Pe.value=Te,Ae(Pe)},function(Te){return G("throw",Te,Ae,Be)})}Be(Se.arg)}var Z;i(this,"_invoke",{value:function(ue,Ae){function Be(){return new ie(function(Se,Pe){G(ue,Ae,Se,Pe)})}return Z=Z?Z.then(Be,Be):Be()}})}function $(Q,ie,G){var Z=h;return function(se,ue){if(Z===p)throw Error("Generator is already running");if(Z===g){if(se==="throw")throw ue;return{value:t,done:!0}}for(G.method=se,G.arg=ue;;){var Ae=G.delegate;if(Ae){var Be=X(Ae,G);if(Be){if(Be===v)continue;return Be}}if(G.method==="next")G.sent=G._sent=G.arg;else if(G.method==="throw"){if(Z===h)throw Z=g,G.arg;G.dispatchException(G.arg)}else G.method==="return"&&G.abrupt("return",G.arg);Z=p;var Se=d(Q,ie,G);if(Se.type==="normal"){if(Z=G.done?g:f,Se.arg===v)continue;return{value:Se.arg,done:G.done}}Se.type==="throw"&&(Z=g,G.method="throw",G.arg=Se.arg)}}}function X(Q,ie){var G=ie.method,Z=Q.iterator[G];if(Z===t)return ie.delegate=null,G==="throw"&&Q.iterator.return&&(ie.method="return",ie.arg=t,X(Q,ie),ie.method==="throw")||G!=="return"&&(ie.method="throw",ie.arg=new TypeError("The iterator does not provide a '"+G+"' method")),v;var se=d(Z,Q.iterator,ie.arg);if(se.type==="throw")return ie.method="throw",ie.arg=se.arg,ie.delegate=null,v;var ue=se.arg;return ue?ue.done?(ie[Q.resultName]=ue.value,ie.next=Q.nextLoc,ie.method!=="return"&&(ie.method="next",ie.arg=t),ie.delegate=null,v):ue:(ie.method="throw",ie.arg=new TypeError("iterator result is not an object"),ie.delegate=null,v)}function q(Q){var ie={tryLoc:Q[0]};1 in Q&&(ie.catchLoc=Q[1]),2 in Q&&(ie.finallyLoc=Q[2],ie.afterLoc=Q[3]),this.tryEntries.push(ie)}function W(Q){var ie=Q.completion||{};ie.type="normal",delete ie.arg,Q.completion=ie}function K(Q){this.tryEntries=[{tryLoc:"root"}],Q.forEach(q,this),this.reset(!0)}function ne(Q){if(Q||Q===""){var ie=Q[o];if(ie)return ie.call(Q);if(typeof Q.next=="function")return Q;if(!isNaN(Q.length)){var G=-1,Z=function se(){for(;++G<Q.length;)if(r.call(Q,G))return se.value=Q[G],se.done=!1,se;return se.value=t,se.done=!0,se};return Z.next=Z}}throw new TypeError(ry(Q)+" is not iterable")}return T.prototype=C,i(N,"constructor",{value:C,configurable:!0}),i(C,"constructor",{value:T,configurable:!0}),T.displayName=l(C,c,"GeneratorFunction"),e.isGeneratorFunction=function(Q){var ie=typeof Q=="function"&&Q.constructor;return!!ie&&(ie===T||(ie.displayName||ie.name)==="GeneratorFunction")},e.mark=function(Q){return Object.setPrototypeOf?Object.setPrototypeOf(Q,C):(Q.__proto__=C,l(Q,c,"GeneratorFunction")),Q.prototype=Object.create(N),Q},e.awrap=function(Q){return{__await:Q}},U(F.prototype),l(F.prototype,a,function(){return this}),e.AsyncIterator=F,e.async=function(Q,ie,G,Z,se){se===void 0&&(se=Promise);var ue=new F(u(Q,ie,G,Z),se);return e.isGeneratorFunction(ie)?ue:ue.next().then(function(Ae){return Ae.done?Ae.value:ue.next()})},U(N),l(N,c,"Generator"),l(N,o,function(){return this}),l(N,"toString",function(){return"[object Generator]"}),e.keys=function(Q){var ie=Object(Q),G=[];for(var Z in ie)G.push(Z);return G.reverse(),function se(){for(;G.length;){var ue=G.pop();if(ue in ie)return se.value=ue,se.done=!1,se}return se.done=!0,se}},e.values=ne,K.prototype={constructor:K,reset:function(ie){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(W),!ie)for(var G in this)G.charAt(0)==="t"&&r.call(this,G)&&!isNaN(+G.slice(1))&&(this[G]=t)},stop:function(){this.done=!0;var ie=this.tryEntries[0].completion;if(ie.type==="throw")throw ie.arg;return this.rval},dispatchException:function(ie){if(this.done)throw ie;var G=this;function Z(Pe,we){return Ae.type="throw",Ae.arg=ie,G.next=Pe,we&&(G.method="next",G.arg=t),!!we}for(var se=this.tryEntries.length-1;se>=0;--se){var ue=this.tryEntries[se],Ae=ue.completion;if(ue.tryLoc==="root")return Z("end");if(ue.tryLoc<=this.prev){var Be=r.call(ue,"catchLoc"),Se=r.call(ue,"finallyLoc");if(Be&&Se){if(this.prev<ue.catchLoc)return Z(ue.catchLoc,!0);if(this.prev<ue.finallyLoc)return Z(ue.finallyLoc)}else if(Be){if(this.prev<ue.catchLoc)return Z(ue.catchLoc,!0)}else{if(!Se)throw Error("try statement without catch or finally");if(this.prev<ue.finallyLoc)return Z(ue.finallyLoc)}}}},abrupt:function(ie,G){for(var Z=this.tryEntries.length-1;Z>=0;--Z){var se=this.tryEntries[Z];if(se.tryLoc<=this.prev&&r.call(se,"finallyLoc")&&this.prev<se.finallyLoc){var ue=se;break}}ue&&(ie==="break"||ie==="continue")&&ue.tryLoc<=G&&G<=ue.finallyLoc&&(ue=null);var Ae=ue?ue.completion:{};return Ae.type=ie,Ae.arg=G,ue?(this.method="next",this.next=ue.finallyLoc,v):this.complete(Ae)},complete:function(ie,G){if(ie.type==="throw")throw ie.arg;return ie.type==="break"||ie.type==="continue"?this.next=ie.arg:ie.type==="return"?(this.rval=this.arg=ie.arg,this.method="return",this.next="end"):ie.type==="normal"&&G&&(this.next=G),v},finish:function(ie){for(var G=this.tryEntries.length-1;G>=0;--G){var Z=this.tryEntries[G];if(Z.finallyLoc===ie)return this.complete(Z.completion,Z.afterLoc),W(Z),v}},catch:function(ie){for(var G=this.tryEntries.length-1;G>=0;--G){var Z=this.tryEntries[G];if(Z.tryLoc===ie){var se=Z.completion;if(se.type==="throw"){var ue=se.arg;W(Z)}return ue}}throw Error("illegal catch attempt")},delegateYield:function(ie,G,Z){return this.delegate={iterator:ne(ie),resultName:G,nextLoc:Z},this.method==="next"&&(this.arg=t),v}},e}function qV(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(l){return void n(l)}a.done?e(c):Promise.resolve(c).then(r,i)}function eE(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(c){qV(s,r,i,o,a,"next",c)}function a(c){qV(s,r,i,o,a,"throw",c)}o(void 0)})}}function M3e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I3e(t,e){if(ry(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ry(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function jX(t){var e=I3e(t,"string");return ry(e)=="symbol"?e:e+""}function O3e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,jX(r.key),r)}}function k3e(t,e,n){return e&&O3e(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Jf(t,e,n){return(e=jX(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const I1={"ar-SA":["ar-SA-HamedNeural","ar-SA-ZariyahNeural"],"de-DE":["de-DE-AmalaNeural","de-DE-ConradNeural","de-DE-KatjaNeural","de-DE-KillianNeural"],"en-US":["en-US-AriaNeural","en-US-AnaNeural","en-US-ChristopherNeural","en-US-EricNeural","en-US-GuyNeural","en-US-JennyNeural","en-US-MichelleNeural","en-US-RogerNeural","en-US-SteffanNeural"],"es-ES":["es-ES-AlvaroNeural","es-ES-ElviraNeural"],"fr-FR":["fr-FR-DeniseNeural","fr-FR-EloiseNeural","fr-FR-HenriNeural"],"ja-JP":["ja-JP-KeitaNeural","ja-JP-NanamiNeural"],"ko-KR":["ko-KR-InJoonNeural","ko-KR-SunHiNeural"],"pt-BR":["pt-BR-AntonioNeural","pt-BR-FranciscaNeural"],"ru-RU":["ru-RU-DmitryNeural","ru-RU-SvetlanaNeural"],"zh-CN":["zh-CN-XiaoxiaoNeural","zh-CN-XiaoyiNeural","zh-CN-YunjianNeural","zh-CN-liaoning-XiaobeiNeural","zh-CN-shaanxi-XiaoniNeural","zh-CN-YunxiNeural","zh-CN-YunxiaNeural","zh-CN-YunyangNeural"],"zh-TW":["zh-TW-HsiaoChenNeural","zh-TW-YunJheNeural","zh-TW-HsiaoYuNeural"]},O1={"ar-SA-HamedNeural":"","ar-SA-ZariyahNeural":"","de-DE-AmalaNeural":"Amala","de-DE-BerndNeural":"Bernd","de-DE-ChristophNeural":"Christoph","de-DE-ConradNeural":"Conrad","de-DE-ElkeNeural":"Elke","de-DE-GiselaNeural":"Gisela","de-DE-KasperNeural":"Kasper","de-DE-KatjaNeural":"Katja","de-DE-KillianNeural":"Killian","de-DE-KlarissaNeural":"Klarissa","de-DE-KlausNeural":"Klaus","de-DE-LouisaNeural":"Louisa","de-DE-MajaNeural":"Maja","de-DE-RalfNeural":"Ralf","de-DE-TanjaNeural":"Tanja","en-US-AIGenerate1Neural":"AIGenerate1","en-US-AIGenerate2Neural":"AIGenerate2","en-US-AmberNeural":"Amber","en-US-AnaNeural":"Ana","en-US-AndrewNeural":"Andrew","en-US-AriaNeural":"Aria","en-US-AshleyNeural":"Ashley","en-US-BlueNeural":"Blue","en-US-BrandonNeural":"Brandon","en-US-BrianNeural":"Brian","en-US-ChristopherNeural":"Christopher","en-US-CoraNeural":"Cora","en-US-DavisNeural":"Davis","en-US-ElizabethNeural":"Elizabeth","en-US-EmmaNeural":"Emma","en-US-EricNeural":"Eric","en-US-GuyNeural":"Guy","en-US-JacobNeural":"Jacob","en-US-JaneNeural":"Jane","en-US-JasonNeural":"Jason","en-US-JennyMultilingualNeural":"Jenny Multilingual","en-US-JennyMultilingualV2Neural":"Jenny Multilingual V2","en-US-JennyNeural":"Jenny","en-US-MichelleNeural":"Michelle","en-US-MonicaNeural":"Monica","en-US-NancyNeural":"Nancy","en-US-RogerNeural":"Roger","en-US-RyanMultilingualNeural":"Ryan Multilingual","en-US-SaraNeural":"Sara","en-US-SteffanNeural":"Steffan","en-US-TonyNeural":"Tony","es-ES-AbrilNeural":"Abril","es-ES-AlvaroNeural":"lvaro","es-ES-ArnauNeural":"Arnau","es-ES-DarioNeural":"Dario","es-ES-EliasNeural":"Elias","es-ES-ElviraNeural":"Elvira","es-ES-EstrellaNeural":"Estrella","es-ES-IreneNeural":"Irene","es-ES-LaiaNeural":"Laia","es-ES-LiaNeural":"Lia","es-ES-NilNeural":"Nil","es-ES-SaulNeural":"Saul","es-ES-TeoNeural":"Teo","es-ES-TrianaNeural":"Triana","es-ES-VeraNeural":"Vera","fr-FR-AlainNeural":"Alain","fr-FR-BrigitteNeural":"Brigitte","fr-FR-CelesteNeural":"Celeste","fr-FR-ClaudeNeural":"Claude","fr-FR-CoralieNeural":"Coralie","fr-FR-DeniseNeural":"Denise","fr-FR-EloiseNeural":"Eloise","fr-FR-HenriNeural":"Henri","fr-FR-JacquelineNeural":"Jacqueline","fr-FR-JeromeNeural":"Jerome","fr-FR-JosephineNeural":"Josephine","fr-FR-MauriceNeural":"Maurice","fr-FR-YvesNeural":"Yves","fr-FR-YvetteNeural":"Yvette","ja-JP-AoiNeural":"","ja-JP-DaichiNeural":"","ja-JP-KeitaNeural":"","ja-JP-MayuNeural":"","ja-JP-NanamiNeural":"","ja-JP-NaokiNeural":"","ja-JP-ShioriNeural":"","ko-KR-BongJinNeural":"","ko-KR-GookMinNeural":"","ko-KR-InJoonNeural":"","ko-KR-JiMinNeural":"","ko-KR-SeoHyeonNeural":"","ko-KR-SoonBokNeural":"","ko-KR-SunHiNeural":"","ko-KR-YuJinNeural":"","pt-BR-AntonioNeural":"Antnio","pt-BR-BrendaNeural":"Brenda","pt-BR-DonatoNeural":"Donato","pt-BR-ElzaNeural":"Elza","pt-BR-FabioNeural":"Fabio","pt-BR-FranciscaNeural":"Francisca","pt-BR-GiovannaNeural":"Giovanna","pt-BR-HumbertoNeural":"Humberto","pt-BR-JulioNeural":"Julio","pt-BR-LeilaNeural":"Leila","pt-BR-LeticiaNeural":"Leticia","pt-BR-ManuelaNeural":"Manuela","pt-BR-NicolauNeural":"Nicolau","pt-BR-ValerioNeural":"Valerio","pt-BR-YaraNeural":"Yara","ru-RU-DariyaNeural":"","ru-RU-DmitryNeural":"","ru-RU-SvetlanaNeural":"","wuu-CN-XiaotongNeural":"","wuu-CN-YunzheNeural":"","yue-CN-XiaoMinNeural":"","yue-CN-YunSongNeural":"","zh-CN-XiaochenNeural":"","zh-CN-XiaohanNeural":"","zh-CN-XiaomengNeural":"","zh-CN-XiaomoNeural":"","zh-CN-XiaoqiuNeural":"","zh-CN-XiaorouNeural":"","zh-CN-XiaoruiNeural":"","zh-CN-XiaoshuangNeural":"","zh-CN-XiaoxiaoNeural":"","zh-CN-XiaoxuanNeural":"","zh-CN-XiaoyanNeural":"","zh-CN-XiaoyiNeural":"","zh-CN-XiaoyouNeural":"","zh-CN-XiaozhenNeural":"","zh-CN-YunfengNeural":"","zh-CN-YunhaoNeural":"","zh-CN-YunjianNeural":"","zh-CN-YunjieNeural":"","zh-CN-YunxiNeural":"","zh-CN-YunxiaNeural":"","zh-CN-YunyangNeural":"","zh-CN-YunyeNeural":"","zh-CN-YunzeNeural":"","zh-CN-guangxi-YunqiNeural":"","zh-CN-henan-YundengNeural":"","zh-CN-liaoning-XiaobeiNeural":"","zh-CN-liaoning-YunbiaoNeural":"","zh-CN-shaanxi-XiaoniNeural":"","zh-CN-shandong-YunxiangNeural":"","zh-CN-sichuan-YunxiNeural":"","zh-TW-HsiaoChenNeural":"","zh-TW-HsiaoYuNeural":"","zh-TW-YunJheNeural":""};var N3e=function(){var t=eE(Fu().mark(function e(n){var r;return Fu().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=new AudioContext,s.next=3,r.decodeAudioData(n);case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}},e)}));return function(n){return t.apply(this,arguments)}}();function P3e(t){if(Array.isArray(t))return t}function D3e(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,i,s,o,a=[],c=!0,l=!1;try{if(s=(n=n.call(t)).next,e!==0)for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,i=u}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw i}}return a}}function WV(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function $X(t,e){if(t){if(typeof t=="string")return WV(t,e);var n={}.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?WV(t,e):void 0}}function L3e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n3(t,e){return P3e(t)||D3e(t,e)||$X(t,e)||L3e()}const U3e={"ar-SA":"","de-DE":"Deutsch","en-US":"English","es-ES":"Espaol","fr-FR":"Franais","ja-JP":"","ko-KR":"","pt-BR":"Portugus","ru-RU":"","zh-CN":"","zh-TW":""};var F3e=function(){return Object.entries(U3e).map(function(e){var n=n3(e,2),r=n[0],i=n[1];return{label:i,value:r}})};const HX="%[a-f0-9]{2}",KV=new RegExp("("+HX+")|([^%]+?)","gi"),YV=new RegExp("("+HX+")+","gi");function nU(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;const n=t.slice(0,e),r=t.slice(e);return Array.prototype.concat.call([],nU(n),nU(r))}function B3e(t){try{return decodeURIComponent(t)}catch{let e=t.match(KV)||[];for(let n=1;n<e.length;n++)t=nU(e,n).join(""),e=t.match(KV)||[];return t}}function j3e(t){const e={"%FE%FF":"","%FF%FE":""};let n=YV.exec(t);for(;n;){try{e[n[0]]=decodeURIComponent(n[0])}catch{const i=B3e(n[0]);i!==n[0]&&(e[n[0]]=i)}n=YV.exec(t)}e["%C2"]="";const r=Object.keys(e);for(const i of r)t=t.replace(new RegExp(i,"g"),e[i]);return t}function $3e(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return decodeURIComponent(t)}catch{return j3e(t)}}function H3e(t,e){const n={};if(Array.isArray(e))for(const r of e){const i=Object.getOwnPropertyDescriptor(t,r);i!=null&&i.enumerable&&Object.defineProperty(n,r,i)}else for(const r of Reflect.ownKeys(t)){const i=Object.getOwnPropertyDescriptor(t,r);if(i.enumerable){const s=t[r];e(r,s,t)&&Object.defineProperty(n,r,i)}}return n}function VX(t,e){if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t===""||e==="")return[];const n=t.indexOf(e);return n===-1?[]:[t.slice(0,n),t.slice(n+e.length)]}const V3e=t=>t==null,z3e=t=>encodeURIComponent(t).replaceAll(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),rU=Symbol("encodeFragmentIdentifier");function G3e(t){switch(t.arrayFormat){case"index":return e=>(n,r)=>{const i=n.length;return r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[sa(e,t),"[",i,"]"].join("")]:[...n,[sa(e,t),"[",sa(i,t),"]=",sa(r,t)].join("")]};case"bracket":return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[sa(e,t),"[]"].join("")]:[...n,[sa(e,t),"[]=",sa(r,t)].join("")];case"colon-list-separator":return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,[sa(e,t),":list="].join("")]:[...n,[sa(e,t),":list=",sa(r,t)].join("")];case"comma":case"separator":case"bracket-separator":{const e=t.arrayFormat==="bracket-separator"?"[]=":"=";return n=>(r,i)=>i===void 0||t.skipNull&&i===null||t.skipEmptyString&&i===""?r:(i=i===null?"":i,r.length===0?[[sa(n,t),e,sa(i,t)].join("")]:[[r,sa(i,t)].join(t.arrayFormatSeparator)])}default:return e=>(n,r)=>r===void 0||t.skipNull&&r===null||t.skipEmptyString&&r===""?n:r===null?[...n,sa(e,t)]:[...n,[sa(e,t),"=",sa(r,t)].join("")]}}function q3e(t){let e;switch(t.arrayFormat){case"index":return(n,r,i)=>{if(e=/\[(\d*)]$/.exec(n),n=n.replace(/\[\d*]$/,""),!e){i[n]=r;return}i[n]===void 0&&(i[n]={}),i[n][e[1]]=r};case"bracket":return(n,r,i)=>{if(e=/(\[])$/.exec(n),n=n.replace(/\[]$/,""),!e){i[n]=r;return}if(i[n]===void 0){i[n]=[r];return}i[n]=[...i[n],r]};case"colon-list-separator":return(n,r,i)=>{if(e=/(:list)$/.exec(n),n=n.replace(/:list$/,""),!e){i[n]=r;return}if(i[n]===void 0){i[n]=[r];return}i[n]=[...i[n],r]};case"comma":case"separator":return(n,r,i)=>{const s=typeof r=="string"&&r.includes(t.arrayFormatSeparator),o=typeof r=="string"&&!s&&Hm(r,t).includes(t.arrayFormatSeparator);r=o?Hm(r,t):r;const a=s||o?r.split(t.arrayFormatSeparator).map(c=>Hm(c,t)):r===null?r:Hm(r,t);i[n]=a};case"bracket-separator":return(n,r,i)=>{const s=/(\[])$/.test(n);if(n=n.replace(/\[]$/,""),!s){i[n]=r&&Hm(r,t);return}const o=r===null?[]:Hm(r,t).split(t.arrayFormatSeparator);if(i[n]===void 0){i[n]=o;return}i[n]=[...i[n],...o]};default:return(n,r,i)=>{if(i[n]===void 0){i[n]=r;return}i[n]=[...[i[n]].flat(),r]}}}function zX(t){if(typeof t!="string"||t.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function sa(t,e){return e.encode?e.strict?z3e(t):encodeURIComponent(t):t}function Hm(t,e){return e.decode?$3e(t):t}function GX(t){return Array.isArray(t)?t.sort():typeof t=="object"?GX(Object.keys(t)).sort((e,n)=>Number(e)-Number(n)).map(e=>t[e]):t}function qX(t){const e=t.indexOf("#");return e!==-1&&(t=t.slice(0,e)),t}function W3e(t){let e="";const n=t.indexOf("#");return n!==-1&&(e=t.slice(n)),e}function XV(t,e,n){return n==="string"&&typeof t=="string"?t:typeof n=="function"&&typeof t=="string"?n(t):e.parseBooleans&&t!==null&&(t.toLowerCase()==="true"||t.toLowerCase()==="false")?t.toLowerCase()==="true":n==="number"&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""||e.parseNumbers&&!Number.isNaN(Number(t))&&typeof t=="string"&&t.trim()!==""?Number(t):t}function r3(t){t=qX(t);const e=t.indexOf("?");return e===-1?"":t.slice(e+1)}function i3(t,e){e={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,types:Object.create(null),...e},zX(e.arrayFormatSeparator);const n=q3e(e),r=Object.create(null);if(typeof t!="string"||(t=t.trim().replace(/^[?#&]/,""),!t))return r;for(const i of t.split("&")){if(i==="")continue;const s=e.decode?i.replaceAll("+"," "):i;let[o,a]=VX(s,"=");o===void 0&&(o=s),a=a===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?a:Hm(a,e),n(Hm(o,e),a,r)}for(const[i,s]of Object.entries(r))if(typeof s=="object"&&s!==null&&e.types[i]!=="string")for(const[o,a]of Object.entries(s)){const c=e.types[i]?e.types[i].replace("[]",""):void 0;s[o]=XV(a,e,c)}else typeof s=="object"&&s!==null&&e.types[i]==="string"?r[i]=Object.values(s).join(e.arrayFormatSeparator):r[i]=XV(s,e,e.types[i]);return e.sort===!1?r:(e.sort===!0?Object.keys(r).sort():Object.keys(r).sort(e.sort)).reduce((i,s)=>{const o=r[s];return i[s]=o&&typeof o=="object"&&!Array.isArray(o)?GX(o):o,i},Object.create(null))}function WX(t,e){if(!t)return"";e={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...e},zX(e.arrayFormatSeparator);const n=o=>e.skipNull&&V3e(t[o])||e.skipEmptyString&&t[o]==="",r=G3e(e),i={};for(const[o,a]of Object.entries(t))n(o)||(i[o]=a);const s=Object.keys(i);return e.sort!==!1&&s.sort(e.sort),s.map(o=>{const a=t[o];return a===void 0?"":a===null?sa(o,e):Array.isArray(a)?a.length===0&&e.arrayFormat==="bracket-separator"?sa(o,e)+"[]":a.reduce(r(o),[]).join("&"):sa(o,e)+"="+sa(a,e)}).filter(o=>o.length>0).join("&")}function KX(t,e){var i;e={decode:!0,...e};let[n,r]=VX(t,"#");return n===void 0&&(n=t),{url:((i=n==null?void 0:n.split("?"))==null?void 0:i[0])??"",query:i3(r3(t),e),...e&&e.parseFragmentIdentifier&&r?{fragmentIdentifier:Hm(r,e)}:{}}}function YX(t,e){e={encode:!0,strict:!0,[rU]:!0,...e};const n=qX(t.url).split("?")[0]||"",r=r3(t.url),i={...i3(r,{sort:!1}),...t.query};let s=WX(i,e);s&&(s=`?${s}`);let o=W3e(t.url);if(typeof t.fragmentIdentifier=="string"){const a=new URL(n);a.hash=t.fragmentIdentifier,o=e[rU]?a.hash:`#${t.fragmentIdentifier}`}return`${n}${s}${o}`}function XX(t,e,n){n={parseFragmentIdentifier:!0,[rU]:!1,...n};const{url:r,query:i,fragmentIdentifier:s}=KX(t,n);return YX({url:r,query:H3e(i,e),fragmentIdentifier:s},n)}function K3e(t,e,n){const r=Array.isArray(e)?i=>!e.includes(i):(i,s)=>!e(i,s);return XX(t,r,n)}const Y3e=Object.freeze(Object.defineProperty({__proto__:null,exclude:K3e,extract:r3,parse:i3,parseUrl:KX,pick:XX,stringify:WX,stringifyUrl:YX},Symbol.toStringTag,{value:"Module"}));var Ec=[];for(var $P=0;$P<256;++$P)Ec.push(($P+256).toString(16).slice(1));function X3e(t,e=0){return(Ec[t[e+0]]+Ec[t[e+1]]+Ec[t[e+2]]+Ec[t[e+3]]+"-"+Ec[t[e+4]]+Ec[t[e+5]]+"-"+Ec[t[e+6]]+Ec[t[e+7]]+"-"+Ec[t[e+8]]+Ec[t[e+9]]+"-"+Ec[t[e+10]]+Ec[t[e+11]]+Ec[t[e+12]]+Ec[t[e+13]]+Ec[t[e+14]]+Ec[t[e+15]]).toLowerCase()}var LC,J3e=new Uint8Array(16);function Q3e(){if(!LC&&(LC=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!LC))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return LC(J3e)}var Z3e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const JV={randomUUID:Z3e};function e4e(t,e,n){if(JV.randomUUID&&!e&&!t)return JV.randomUUID();t=t||{};var r=t.random||(t.rng||Q3e)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,X3e(r)}var t4e=function(e,n){var r=n.voice;return'<voice name="'.concat(r,'">').concat(e,"</voice>")},n4e=function(e,n){var r=n.style;return r?'<mstts:express-as style="'.concat(r,'">').concat(e,"</mstts:express-as>"):e},r4e=function(e,n){var r=n.pitch,i=n.rate;return!r&&!i?e:'<prosody pitch="'.concat(Math.floor((r||1)*100),'%" rate="').concat(Math.floor((i||1)*100),'%">').concat(e,"</prosody>")},i4e=function(e){return'<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xmlns:mstts="https://www.w3.org/2001/mstts" xml:lang="en-US">'.concat(e,"</speak>")},s4e=function(e,n){var r=r4e(e,n);return r=n4e(r,n),r=t4e(r,n),r=i4e(r),r},QV=function(e,n){for(var r=[],i=0,s=Object.entries(e);i<s.length;i++){var o=n3(s[i],2),a=o[0],c=o[1];r.push("".concat(a,":").concat(c))}return r.push("",n),r.join(`\r
`)};function o4e(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=$X(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var l=n.next();return o=l.done,l},e:function(l){a=!0,s=l},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}var a4e=function(e){var n={},r=o4e(e.slice(0,e.indexOf(`\r
\r
`)).split(`\r
`)),i;try{for(r.s();!(i=r.n()).done;){var s=i.value,o=s.split(":",2),a=n3(o,2),c=a[0],l=a[1];n[c]=l}}catch(u){r.e(u)}finally{r.f()}return{data:e.slice(e.indexOf(`\r
\r
`)+4),headers:n}},c4e="wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1",l4e="6A5AA1D4EAFF4E9FB37E23D68491D6F4",u4e=JSON.stringify({context:{synthesis:{audio:{metadataoptions:{sentenceBoundaryEnabled:!1,wordBoundaryEnabled:!0},outputFormat:"audio-24khz-48kbitrate-mono-mp3"}}}}),d4e=function(e){var n=new Date().toString(),r={"Content-Type":"application/json; charset=utf-8",Path:"speech.config","X-Timestamp":n},i={"Content-Type":"application/ssml+xml",Path:"ssml","X-RequestId":e,"X-Timestamp":n};return{configHeader:r,contentHeader:i}},JX=function(){var t=eE(Fu().mark(function e(n){var r,i,s,o,a,c,l,u,d,h,f,p,g,v=arguments;return Fu().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return r=n.payload,i=v.length>1&&v[1]!==void 0?v[1]:{},s=i.proxyUrl,o=i.token,a=r.input,c=r.options,l=e4e().replaceAll("-",""),u=Y3e.stringifyUrl({query:{ConnectionId:l,TrustedClientToken:o||l4e},url:s||c4e}),d=d4e(l),h=d.configHeader,f=d.contentHeader,p=QV(h,u4e),g=QV(f,s4e(a,c)),T.abrupt("return",new Promise(function(C,A){var k=new WebSocket(u);k.binaryType="arraybuffer";var I=function(){k.send(p),k.send(g)},N=new ArrayBuffer(0),U=function(){var $=eE(Fu().mark(function X(q){var W,K,ne,Q,ie,G,Z,se;return Fu().wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:if(typeof q.data!="string"){Ae.next=13;break}W=a4e(q.data),K=W.headers,Ae.t0=K.Path,Ae.next=Ae.t0==="turn.end"?5:11;break;case 5:if(k.close(),N.byteLength){Ae.next=8;break}return Ae.abrupt("return");case 8:return ne=new Response(N),C(ne),Ae.abrupt("break",11);case 11:Ae.next=14;break;case 13:q.data instanceof ArrayBuffer&&(Q=new DataView(q.data),ie=Q.getInt16(0),q.data.byteLength>ie+2&&(G=q.data.slice(2+ie),Z=new ArrayBuffer(N.byteLength+G.byteLength),se=new Uint8Array(Z),se.set(new Uint8Array(N),0),se.set(new Uint8Array(G),N.byteLength),N=Z));case 14:case"end":return Ae.stop()}},X)}));return function(q){return $.apply(this,arguments)}}(),F=function(){A(new Error("WebSocket error occurred.")),k.close()};k.addEventListener("open",I),k.addEventListener("message",U),k.addEventListener("error",F)}));case 9:case"end":return T.stop()}},e)}));return function(n){return t.apply(this,arguments)}}(),h4e=function(e){var n=e&&I1[e]?I1[e]||[]:su(Object.values(I1));return n.map(function(r){return{label:(O1==null?void 0:O1[r])||r,value:r}})},QT=function(){function t(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.serviceUrl,i=n.locale,s=n.headers;M3e(this,t),Jf(this,"locale",void 0),Jf(this,"serviceUrl",void 0),Jf(this,"headers",void 0),Jf(this,"fetch",function(){var o=eE(Fu().mark(function a(c){var l;return Fu().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,e.serviceUrl?fetch(e.serviceUrl,{body:JSON.stringify(c),headers:e.headers,method:"POST"}):JX({payload:c});case 2:return l=d.sent,d.abrupt("return",l);case 4:case"end":return d.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),Jf(this,"create",function(){var o=eE(Fu().mark(function a(c){return Fu().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",e.fetch(c));case 1:case"end":return u.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),Jf(this,"createAudio",function(){var o=eE(Fu().mark(function a(c){var l,u;return Fu().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,e.create(c);case 2:return l=h.sent,h.next=5,l.arrayBuffer();case 5:return u=h.sent,h.abrupt("return",N3e(u));case 7:case"end":return h.stop()}},a)}));return function(a){return o.apply(this,arguments)}}()),this.locale=i,this.serviceUrl=r,this.headers=s}return k3e(t,[{key:"voiceOptions",get:function(){return h4e(this.locale)}}]),t}();Jf(QT,"localeOptions",F3e());Jf(QT,"voiceList",I1);Jf(QT,"voiceName",O1);Jf(QT,"createRequest",JX);const QX="15.0.4",ZV=(t,e,n)=>({endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}),ez=(t,e,n)=>({endTime:e,insertTime:n,type:"linearRampToValue",value:t}),iU=(t,e)=>({startTime:e,type:"setValue",value:t}),ZX=(t,e,n)=>({duration:n,startTime:e,type:"setValueCurve",values:t}),eJ=(t,e,{startTime:n,target:r,timeConstant:i})=>r+(e-r)*Math.exp((n-t)/i),Lb=t=>t.type==="exponentialRampToValue",jR=t=>t.type==="linearRampToValue",Dv=t=>Lb(t)||jR(t),s3=t=>t.type==="setValue",$m=t=>t.type==="setValueCurve",$R=(t,e,n,r)=>{const i=t[e];return i===void 0?r:Dv(i)||s3(i)?i.value:$m(i)?i.values[i.values.length-1]:eJ(n,$R(t,e-1,i.startTime,r),i)},tz=(t,e,n,r,i)=>n===void 0?[r.insertTime,i]:Dv(n)?[n.endTime,n.value]:s3(n)?[n.startTime,n.value]:$m(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,$R(t,e-1,n.startTime,i)],sU=t=>t.type==="cancelAndHold",oU=t=>t.type==="cancelScheduledValues",vv=t=>sU(t)||oU(t)?t.cancelTime:Lb(t)||jR(t)?t.endTime:t.startTime,nz=(t,e,n,{endTime:r,value:i})=>n===i?i:0<n&&0<i||n<0&&i<0?n*(i/n)**((t-e)/(r-e)):0,rz=(t,e,n,{endTime:r,value:i})=>n+(t-e)/(r-e)*(i-n),f4e=(t,e)=>{const n=Math.floor(e),r=Math.ceil(e);return n===r?t[n]:(1-(e-n))*t[n]+(1-(r-e))*t[r]},p4e=(t,{duration:e,startTime:n,values:r})=>{const i=(t-n)/e*(r.length-1);return f4e(r,i)},UC=t=>t.type==="setTarget";class m4e{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const n=vv(e);if(sU(e)||oU(e)){const r=this._automationEvents.findIndex(s=>oU(e)&&$m(s)?s.startTime+s.duration>=n:vv(s)>=n),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),sU(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Dv(i)){if(s!==void 0&&UC(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:$m(s)?s.startTime+s.duration:vv(s),a=s===void 0?this._defaultValue:$m(s)?s.values[s.values.length-1]:s.value,c=Lb(i)?nz(n,o,a,i):rz(n,o,a,i),l=Lb(i)?ZV(c,n,this._currenTime):ez(c,n,this._currenTime);this._automationEvents.push(l)}if(s!==void 0&&UC(s)&&this._automationEvents.push(iU(this.getValue(n),n)),s!==void 0&&$m(s)&&s.startTime+s.duration>n){const o=n-s.startTime,a=(s.values.length-1)/s.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=s.values.slice(0,c);if(l<1)for(let d=1;d<c;d+=1){const h=l*d%1;u[d]=s.values[d-1]*(1-h)+s.values[d]*h}this._automationEvents[this._automationEvents.length-1]=ZX(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>vv(o)>n),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&$m(i)&&vv(i)+i.duration>n)return!1;const s=Lb(e)?ZV(e.value,e.endTime,this._currenTime):jR(e)?ez(e.value,n,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if($m(e)&&n+e.duration>vv(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const n=this._automationEvents.findIndex(r=>vv(r)>e);if(n>1){const r=this._automationEvents.slice(n-1),i=r[0];UC(i)&&r.unshift(iU($R(this._automationEvents,n-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const n=this._automationEvents.findIndex(o=>vv(o)>e),r=this._automationEvents[n],i=(n===-1?this._automationEvents.length:n)-1,s=this._automationEvents[i];if(s!==void 0&&UC(s)&&(r===void 0||!Dv(r)||r.insertTime>e))return eJ(e,$R(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&s3(s)&&(r===void 0||!Dv(r)))return s.value;if(s!==void 0&&$m(s)&&(r===void 0||!Dv(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?p4e(e,s):s.values[s.values.length-1];if(s!==void 0&&Dv(s)&&(r===void 0||!Dv(r)))return s.value;if(r!==void 0&&Lb(r)){const[o,a]=tz(this._automationEvents,i,s,r,this._defaultValue);return nz(e,o,a,r)}if(r!==void 0&&jR(r)){const[o,a]=tz(this._automationEvents,i,s,r,this._defaultValue);return rz(e,o,a,r)}return this._defaultValue}}const g4e=t=>({cancelTime:t,type:"cancelAndHold"}),v4e=t=>({cancelTime:t,type:"cancelScheduledValues"}),_4e=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),y4e=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),b4e=(t,e,n)=>({startTime:e,target:t,timeConstant:n,type:"setTarget"}),E4e=()=>new DOMException("","AbortError"),S4e=t=>(e,n,[r,i,s],o)=>{t(e[i],[n,r,s],a=>a[0]===n&&a[1]===r,o)},w4e=t=>(e,n,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:n})},T4e=t=>(e,n)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})},LE=new WeakSet,tJ=new WeakMap,o3=new WeakMap,nJ=new WeakMap,a3=new WeakMap,dk=new WeakMap,rJ=new WeakMap,aU=new WeakMap,cU=new WeakMap,lU=new WeakMap,iJ={construct(){return iJ}},x4e=t=>{try{const e=new Proxy(t,iJ);new e}catch{return!1}return!0},iz=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,sz=(t,e)=>{const n=[];let r=t.replace(/^[\s]+/,""),i=r.match(iz);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());n.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(iz)}return[n.join(";"),r]},oz=t=>{if(t!==void 0&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},az=t=>{if(!x4e(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(t.prototype===null||typeof t.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},C4e=(t,e,n,r,i,s,o,a,c,l,u,d,h)=>{let f=0;return(p,g,v={credentials:"omit"})=>{const E=u.get(p);if(E!==void 0&&E.has(g))return Promise.resolve();const T=l.get(p);if(T!==void 0){const k=T.get(g);if(k!==void 0)return k}const C=s(p),A=C.audioWorklet===void 0?i(g).then(([k,I])=>{const[N,U]=sz(k,I),F=`${N};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${U}
})})(window,'_AWGS')`;return n(F)}).then(()=>{const k=h._AWGS.pop();if(k===void 0)throw new SyntaxError;r(C.currentTime,C.sampleRate,()=>k(class{},void 0,(I,N)=>{if(I.trim()==="")throw e();const U=cU.get(C);if(U!==void 0){if(U.has(I))throw e();az(N),oz(N.parameterDescriptors),U.set(I,N)}else az(N),oz(N.parameterDescriptors),cU.set(C,new Map([[I,N]]))},C.sampleRate,void 0,void 0))}):Promise.all([i(g),Promise.resolve(t(d,d))]).then(([[k,I],N])=>{const U=f+1;f=U;const[F,$]=sz(k,I),K=`${F};((AudioWorkletProcessor,registerProcessor)=>{${$}
})(${N?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${N?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${N?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${U}',class extends AudioWorkletProcessor{process(){return !1}})`,ne=new Blob([K],{type:"application/javascript; charset=utf-8"}),Q=URL.createObjectURL(ne);return C.audioWorklet.addModule(Q,v).then(()=>{if(a(C))return C;const ie=o(C);return ie.audioWorklet.addModule(Q,v).then(()=>ie)}).then(ie=>{if(c===null)throw new SyntaxError;try{new c(ie,`__sac${U}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(Q))});return T===void 0?l.set(p,new Map([[g,A]])):T.set(g,A),A.then(()=>{const k=u.get(p);k===void 0?u.set(p,new Set([g])):k.add(g)}).finally(()=>{const k=l.get(p);k!==void 0&&k.delete(g)}),A}},Vh=(t,e)=>{const n=t.get(e);if(n===void 0)throw new Error("A value with the given key could not be found.");return n},hk=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(n.length===0)throw Error("No element was found.");const[r]=n;return t.delete(r),r},sJ=(t,e,n,r)=>{const i=Vh(t,e),s=hk(i,o=>o[0]===n&&o[1]===r);return i.size===0&&t.delete(e),s},ZT=t=>Vh(rJ,t),UE=t=>{if(LE.has(t))throw new Error("The AudioNode is already stored.");LE.add(t),ZT(t).forEach(e=>e(!0))},oJ=t=>"port"in t,ex=t=>{if(!LE.has(t))throw new Error("The AudioNode is not stored.");LE.delete(t),ZT(t).forEach(e=>e(!1))},uU=(t,e)=>{!oJ(t)&&e.every(n=>n.size===0)&&ex(t)},R4e=(t,e,n,r,i,s,o,a,c,l,u,d,h)=>{const f=new WeakMap;return(p,g,v,E,T)=>{const{activeInputs:C,passiveInputs:A}=s(g),{outputs:k}=s(p),I=a(p),N=U=>{const F=c(g),$=c(p);if(U){const X=sJ(A,p,v,E);t(C,p,X,!1),!T&&!d(p)&&n($,F,v,E),h(g)&&UE(g)}else{const X=r(C,p,v,E);e(A,E,X,!1),!T&&!d(p)&&i($,F,v,E);const q=o(g);if(q===0)u(g)&&uU(g,C);else{const W=f.get(g);W!==void 0&&clearTimeout(W),f.set(g,setTimeout(()=>{u(g)&&uU(g,C)},q*1e3))}}};return l(k,[g,v,E],U=>U[0]===g&&U[1]===v&&U[2]===E,!0)?(I.add(N),u(p)?t(C,p,[v,E,N],!0):e(A,E,[p,v,N],!0),!0):!1}},A4e=t=>(e,n,[r,i,s],o)=>{const a=e.get(r);a===void 0?e.set(r,new Set([[i,n,s]])):t(a,[i,n,s],c=>c[0]===i&&c[1]===n,o)},M4e=t=>(e,n)=>{const r=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(r).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(r),r.disconnect()};n.addEventListener("ended",i)},I4e=t=>(e,n)=>{t(e).add(n)},O4e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},k4e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...O4e,...c},d=r(l,u),h=s(l)?e():null;super(a,!1,d,h),this._nativeAnalyserNode=d}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},Jc=(t,e)=>t.context===e,N4e=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Jc(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},HR=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},Np=()=>new DOMException("","IndexSizeError"),c3=t=>{t.getChannelData=(e=>n=>{try{return e.call(t,n)}catch(r){throw r.code===12?Np():r}})(t.getChannelData)},P4e={numberOfChannels:1},D4e=(t,e,n,r,i,s,o,a)=>{let c=null;return class aJ{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:d,numberOfChannels:h,sampleRate:f}={...P4e,...u};c===null&&(c=new i(1,1,44100));const p=r!==null&&e(s,s)?new r({length:d,numberOfChannels:h,sampleRate:f}):c.createBuffer(h,d,f);if(p.numberOfChannels===0)throw n();return typeof p.copyFromChannel!="function"?(o(p),c3(p)):e(HR,()=>HR(p))||a(p),t.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===aJ.prototype||t.has(u)}}},Jl=-34028234663852886e22,Cl=-Jl,eg=t=>LE.has(t),L4e={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},U4e=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const d=s(l),h={...L4e,...u},f=i(d,h),p=o(d),g=p?e():null;super(l,!1,f,g),this._audioBufferSourceNodeRenderer=g,this._isBufferNullified=!1,this._isBufferSet=h.buffer!==null,this._nativeAudioBufferSourceNode=f,this._onended=null,this._playbackRate=n(this,p,f.playbackRate,Cl,Jl)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const d=this._nativeAudioBufferSourceNode.onended;this._onended=d!==null&&d===u?l:d}get playbackRate(){return this._playbackRate}start(l=0,u=0,d){if(this._nativeAudioBufferSourceNode.start(l,u,d),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=d===void 0?[l,u]:[l,u,d]),this.context.state!=="closed"){UE(this);const h=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",h),eg(this)&&ex(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",h)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},F4e=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let d=n(l);const h=Jc(d,u);if(!h){const f={buffer:d.buffer,channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,loop:d.loop,loopEnd:d.loopEnd,loopStart:d.loopStart,playbackRate:d.playbackRate.value};d=e(u,f),o!==null&&d.start(...o),a!==null&&d.stop(a)}return s.set(u,d),h?await t(u,l.playbackRate,d.playbackRate):await r(u,l.playbackRate,d.playbackRate),await i(l,u,d),d};return{set start(l){o=l},set stop(l){a=l},render(l,u){const d=s.get(u);return d!==void 0?Promise.resolve(d):c(l,u)}}},B4e=t=>"playbackRate"in t,j4e=t=>"frequency"in t&&"gain"in t,$4e=t=>"offset"in t,H4e=t=>!("frequency"in t)&&"gain"in t,V4e=t=>"detune"in t&&"frequency"in t&&!("gain"in t),z4e=t=>"pan"in t,Rl=t=>Vh(tJ,t),tx=t=>Vh(nJ,t),dU=(t,e)=>{const{activeInputs:n}=Rl(t);n.forEach(i=>i.forEach(([s])=>{e.includes(t)||dU(s,[...e,t])}));const r=B4e(t)?[t.playbackRate]:oJ(t)?Array.from(t.parameters.values()):j4e(t)?[t.Q,t.detune,t.frequency,t.gain]:$4e(t)?[t.offset]:H4e(t)?[t.gain]:V4e(t)?[t.detune,t.frequency]:z4e(t)?[t.pan]:[];for(const i of r){const s=tx(i);s!==void 0&&s.activeInputs.forEach(([o])=>dU(o,e))}eg(t)&&ex(t)},cJ=t=>{dU(t.destination,[])},G4e=t=>t===void 0||typeof t=="number"||typeof t=="string"&&(t==="balanced"||t==="interactive"||t==="playback"),q4e=(t,e,n,r,i,s,o,a,c)=>class extends t{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let d;try{d=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?n():p}if(d===null)throw r();if(!G4e(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&d.sampleRate!==u.sampleRate)throw n();super(d,2);const{latencyHint:h}=u,{sampleRate:f}=d;if(this._baseLatency=typeof d.baseLatency=="number"?d.baseLatency:h==="balanced"?512/f:h==="interactive"||h===void 0?256/f:h==="playback"?1024/f:Math.max(2,Math.min(128,Math.round(h*f/128)))*128/f,this._nativeAudioContext=d,c.name==="webkitAudioContext"?(this._nativeGainNode=d.createGain(),this._nativeOscillatorNode=d.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(d.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,d.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),d.removeEventListener("statechange",p)};d.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),cJ(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,d)=>{const h=()=>{this._nativeAudioContext.removeEventListener("statechange",h),this._nativeAudioContext.state==="running"?u():this.resume().then(u,d)};this._nativeAudioContext.addEventListener("statechange",h)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},W4e=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const d=s(l),h=o(d),f=i(d,u,h),p=h?e(a):null;super(l,!1,f,p),this._isNodeOfNativeOfflineAudioContext=h,this._nativeAudioDestinationNode=f}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},K4e=t=>{const e=new WeakMap,n=async(r,i)=>{const s=i.destination;return e.set(i,s),await t(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):n(r,i)}}},Y4e=(t,e,n,r,i,s,o,a)=>(c,l)=>{const u=l.listener,d=()=>{const k=new Float32Array(1),I=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),N=o(l);let U=!1,F=[0,0,-1,0,1,0],$=[0,0,0];const X=()=>{if(U)return;U=!0;const ne=r(l,256,9,0);ne.onaudioprocess=({inputBuffer:Q})=>{const ie=[s(Q,k,0),s(Q,k,1),s(Q,k,2),s(Q,k,3),s(Q,k,4),s(Q,k,5)];ie.some((Z,se)=>Z!==F[se])&&(u.setOrientation(...ie),F=ie);const G=[s(Q,k,6),s(Q,k,7),s(Q,k,8)];G.some((Z,se)=>Z!==$[se])&&(u.setPosition(...G),$=G)},I.connect(ne)},q=ne=>Q=>{Q!==F[ne]&&(F[ne]=Q,u.setOrientation(...F))},W=ne=>Q=>{Q!==$[ne]&&($[ne]=Q,u.setPosition(...$))},K=(ne,Q,ie)=>{const G=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Q});G.connect(I,0,ne),G.start(),Object.defineProperty(G.offset,"defaultValue",{get(){return Q}});const Z=t({context:c},N,G.offset,Cl,Jl);return a(Z,"value",se=>()=>se.call(Z),se=>ue=>{try{se.call(Z,ue)}catch(Ae){if(Ae.code!==9)throw Ae}X(),N&&ie(ue)}),Z.cancelAndHoldAtTime=(se=>N?()=>{throw i()}:(...ue)=>{const Ae=se.apply(Z,ue);return X(),Ae})(Z.cancelAndHoldAtTime),Z.cancelScheduledValues=(se=>N?()=>{throw i()}:(...ue)=>{const Ae=se.apply(Z,ue);return X(),Ae})(Z.cancelScheduledValues),Z.exponentialRampToValueAtTime=(se=>N?()=>{throw i()}:(...ue)=>{const Ae=se.apply(Z,ue);return X(),Ae})(Z.exponentialRampToValueAtTime),Z.linearRampToValueAtTime=(se=>N?()=>{throw i()}:(...ue)=>{const Ae=se.apply(Z,ue);return X(),Ae})(Z.linearRampToValueAtTime),Z.setTargetAtTime=(se=>N?()=>{throw i()}:(...ue)=>{const Ae=se.apply(Z,ue);return X(),Ae})(Z.setTargetAtTime),Z.setValueAtTime=(se=>N?()=>{throw i()}:(...ue)=>{const Ae=se.apply(Z,ue);return X(),Ae})(Z.setValueAtTime),Z.setValueCurveAtTime=(se=>N?()=>{throw i()}:(...ue)=>{const Ae=se.apply(Z,ue);return X(),Ae})(Z.setValueCurveAtTime),Z};return{forwardX:K(0,0,q(0)),forwardY:K(1,0,q(1)),forwardZ:K(2,-1,q(2)),positionX:K(6,0,W(0)),positionY:K(7,0,W(1)),positionZ:K(8,0,W(2)),upX:K(3,0,q(3)),upY:K(4,1,q(4)),upZ:K(5,0,q(5))}},{forwardX:h,forwardY:f,forwardZ:p,positionX:g,positionY:v,positionZ:E,upX:T,upY:C,upZ:A}=u.forwardX===void 0?d():u;return{get forwardX(){return h},get forwardY(){return f},get forwardZ(){return p},get positionX(){return g},get positionY(){return v},get positionZ(){return E},get upX(){return T},get upY(){return C},get upZ(){return A}}},VR=t=>"context"in t,nx=t=>VR(t[0]),wy=(t,e,n,r)=>{for(const i of t)if(n(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},cz=(t,e,[n,r],i)=>{wy(t,[e,n,r],s=>s[0]===e&&s[1]===n,i)},lz=(t,[e,n,r],i)=>{const s=t.get(e);s===void 0?t.set(e,new Set([[n,r]])):wy(s,[n,r],o=>o[0]===n,i)},nS=t=>"inputs"in t,zR=(t,e,n,r)=>{if(nS(e)){const i=e.inputs[r];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,r),[e,n,r]},lJ=(t,e,n)=>{for(const r of t)if(r[0]===e&&r[1]===n)return t.delete(r),r;return null},X4e=(t,e,n)=>hk(t,r=>r[0]===e&&r[1]===n),uJ=(t,e)=>{if(!ZT(t).delete(e))throw new Error("Missing the expected event listener.")},dJ=(t,e,n)=>{const r=Vh(t,e),i=hk(r,s=>s[0]===n);return r.size===0&&t.delete(e),i},GR=(t,e,n,r)=>{nS(e)?t.disconnect(e.inputs[r],n,0):t.disconnect(e,n,r)},Us=t=>Vh(o3,t),Ww=t=>Vh(a3,t),iy=t=>aU.has(t),k1=t=>!LE.has(t),uz=(t,e)=>new Promise(n=>{if(e!==null)n(!0);else{const r=t.createScriptProcessor(256,1,1),i=t.createGain(),s=t.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=t.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(t.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?n(!0):n(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(t.destination)},a.start()}}),HP=(t,e)=>{const n=new Map;for(const r of t)for(const i of r){const s=n.get(i);n.set(i,s===void 0?1:s+1)}n.forEach((r,i)=>e(i,r))},qR=t=>"context"in t,J4e=t=>{const e=new Map;t.connect=(n=>(r,i=0,s=0)=>{const o=qR(r)?n(r,i,s):n(r,i),a=e.get(r);return a===void 0?e.set(r,[{input:s,output:i}]):a.every(c=>c.input!==s||c.output!==i)&&a.push({input:s,output:i}),o})(t.connect.bind(t)),t.disconnect=(n=>(r,i,s)=>{if(n.apply(t),r===void 0)e.clear();else if(typeof r=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==r);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(r))if(i===void 0)e.delete(r);else{const o=e.get(r);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==s||s===void 0));a.length===0?e.delete(r):e.set(r,a)}}for(const[o,a]of e)a.forEach(c=>{qR(o)?t.connect(o,c.output,c.input):t.connect(o,c.output)})})(t.disconnect)},Q4e=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=tx(e),{outputs:o}=Rl(t),a=ZT(t),c=l=>{const u=Us(t),d=Ww(e);if(l){const h=dJ(s,t,n);cz(i,t,h,!1),!r&&!iy(t)&&u.connect(d,n)}else{const h=X4e(i,t,n);lz(s,h,!1),!r&&!iy(t)&&u.disconnect(d,n)}};return wy(o,[e,n],l=>l[0]===e&&l[1]===n,!0)?(a.add(c),eg(t)?cz(i,t,[n,c],!0):lz(s,[t,n,c],!0),!0):!1},Z4e=(t,e,n,r)=>{const{activeInputs:i,passiveInputs:s}=Rl(e),o=lJ(i[r],t,n);return o===null?[sJ(s,t,n,r)[2],!1]:[o[2],!0]},eje=(t,e,n)=>{const{activeInputs:r,passiveInputs:i}=tx(e),s=lJ(r,t,n);return s===null?[dJ(i,t,n)[1],!1]:[s[2],!0]},l3=(t,e,n,r,i)=>{const[s,o]=Z4e(t,n,r,i);if(s!==null&&(uJ(t,s),o&&!e&&!iy(t)&&GR(Us(t),Us(n),r,i)),eg(n)){const{activeInputs:a}=Rl(n);uU(n,a)}},u3=(t,e,n,r)=>{const[i,s]=eje(t,n,r);i!==null&&(uJ(t,i),s&&!e&&!iy(t)&&Us(t).disconnect(Ww(n),r))},tje=(t,e)=>{const n=Rl(t),r=[];for(const i of n.outputs)nx(i)?l3(t,e,...i):u3(t,e,...i),r.push(i[0]);return n.outputs.clear(),r},nje=(t,e,n)=>{const r=Rl(t),i=[];for(const s of r.outputs)s[1]===n&&(nx(s)?l3(t,e,...s):u3(t,e,...s),i.push(s[0]),r.outputs.delete(s));return i},rje=(t,e,n,r,i)=>{const s=Rl(t);return Array.from(s.outputs).filter(o=>o[0]===n&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(nx(o)?l3(t,e,...o):u3(t,e,...o),s.outputs.delete(o),o[0]))},ije=(t,e,n,r,i,s,o,a,c,l,u,d,h,f,p,g)=>class extends l{constructor(E,T,C,A){super(C),this._context=E,this._nativeAudioNode=C;const k=u(E);d(k)&&n(uz,()=>uz(k,g))!==!0&&J4e(C),o3.set(this,C),rJ.set(this,new Set),E.state!=="closed"&&T&&UE(this),t(this,A,C)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(E){this._nativeAudioNode.channelCount=E}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(E){this._nativeAudioNode.channelCountMode=E}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(E){this._nativeAudioNode.channelInterpretation=E}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(E,T=0,C=0){if(T<0||T>=this._nativeAudioNode.numberOfOutputs)throw i();const A=u(this._context),k=p(A);if(h(E)||f(E))throw s();if(VR(E)){const U=Us(E);try{const $=zR(this._nativeAudioNode,U,T,C),X=k1(this);(k||X)&&this._nativeAudioNode.disconnect(...$),this.context.state!=="closed"&&!X&&k1(E)&&UE(E)}catch($){throw $.code===12?s():$}if(e(this,E,T,C,k)){const $=c([this],E);HP($,r(k))}return E}const I=Ww(E);if(I.name==="playbackRate"&&I.maxValue===1024)throw o();try{this._nativeAudioNode.connect(I,T),(k||k1(this))&&this._nativeAudioNode.disconnect(I,T)}catch(U){throw U.code===12?s():U}if(Q4e(this,E,T,k)){const U=c([this],E);HP(U,r(k))}}disconnect(E,T,C){let A;const k=u(this._context),I=p(k);if(E===void 0)A=tje(this,I);else if(typeof E=="number"){if(E<0||E>=this.numberOfOutputs)throw i();A=nje(this,I,E)}else{if(T!==void 0&&(T<0||T>=this.numberOfOutputs)||VR(E)&&C!==void 0&&(C<0||C>=E.numberOfInputs))throw i();if(A=rje(this,I,E,T,C),A.length===0)throw s()}for(const N of A){const U=c([this],N);HP(U,a)}}},sje=(t,e,n,r,i,s,o,a,c,l,u,d,h)=>(f,p,g,v=null,E=null)=>{const T=g.value,C=new m4e(T),A=p?r(C):null,k={get defaultValue(){return T},get maxValue(){return v===null?g.maxValue:v},get minValue(){return E===null?g.minValue:E},get value(){return g.value},set value(I){g.value=I,k.setValueAtTime(I,f.context.currentTime)},cancelAndHoldAtTime(I){if(typeof g.cancelAndHoldAtTime=="function")A===null&&C.flush(f.context.currentTime),C.add(i(I)),g.cancelAndHoldAtTime(I);else{const N=Array.from(C).pop();A===null&&C.flush(f.context.currentTime),C.add(i(I));const U=Array.from(C).pop();g.cancelScheduledValues(I),N!==U&&U!==void 0&&(U.type==="exponentialRampToValue"?g.exponentialRampToValueAtTime(U.value,U.endTime):U.type==="linearRampToValue"?g.linearRampToValueAtTime(U.value,U.endTime):U.type==="setValue"?g.setValueAtTime(U.value,U.startTime):U.type==="setValueCurve"&&g.setValueCurveAtTime(U.values,U.startTime,U.duration))}return k},cancelScheduledValues(I){return A===null&&C.flush(f.context.currentTime),C.add(s(I)),g.cancelScheduledValues(I),k},exponentialRampToValueAtTime(I,N){if(I===0)throw new RangeError;if(!Number.isFinite(N)||N<0)throw new RangeError;const U=f.context.currentTime;return A===null&&C.flush(U),Array.from(C).length===0&&(C.add(l(T,U)),g.setValueAtTime(T,U)),C.add(o(I,N)),g.exponentialRampToValueAtTime(I,N),k},linearRampToValueAtTime(I,N){const U=f.context.currentTime;return A===null&&C.flush(U),Array.from(C).length===0&&(C.add(l(T,U)),g.setValueAtTime(T,U)),C.add(a(I,N)),g.linearRampToValueAtTime(I,N),k},setTargetAtTime(I,N,U){return A===null&&C.flush(f.context.currentTime),C.add(c(I,N,U)),g.setTargetAtTime(I,N,U),k},setValueAtTime(I,N){return A===null&&C.flush(f.context.currentTime),C.add(l(I,N)),g.setValueAtTime(I,N),k},setValueCurveAtTime(I,N,U){const F=I instanceof Float32Array?I:new Float32Array(I);if(d!==null&&d.name==="webkitAudioContext"){const $=N+U,X=f.context.sampleRate,q=Math.ceil(N*X),W=Math.floor($*X),K=W-q,ne=new Float32Array(K);for(let ie=0;ie<K;ie+=1){const G=(F.length-1)/U*((q+ie)/X-N),Z=Math.floor(G),se=Math.ceil(G);ne[ie]=Z===se?F[Z]:(1-(G-Z))*F[Z]+(1-(se-G))*F[se]}A===null&&C.flush(f.context.currentTime),C.add(u(ne,N,U)),g.setValueCurveAtTime(ne,N,U);const Q=W/X;Q<$&&h(k,ne[ne.length-1],Q),h(k,F[F.length-1],$)}else A===null&&C.flush(f.context.currentTime),C.add(u(F,N,U)),g.setValueCurveAtTime(F,N,U);return k}};return n.set(k,g),e.set(k,f),t(k,A),k},oje=t=>({replay(e){for(const n of t)if(n.type==="exponentialRampToValue"){const{endTime:r,value:i}=n;e.exponentialRampToValueAtTime(i,r)}else if(n.type==="linearRampToValue"){const{endTime:r,value:i}=n;e.linearRampToValueAtTime(i,r)}else if(n.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=n;e.setTargetAtTime(i,r,s)}else if(n.type==="setValue"){const{startTime:r,value:i}=n;e.setValueAtTime(i,r)}else if(n.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=n;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class hJ{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,n=null){return this._map.forEach((r,i)=>e.call(n,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const aje={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},cje=(t,e,n,r,i,s,o,a,c,l,u,d,h,f)=>class extends e{constructor(g,v,E){var T;const C=a(g),A=c(C),k=u({...aje,...E});h(k);const I=cU.get(C),N=I==null?void 0:I.get(v),U=A||C.state!=="closed"?C:(T=o(C))!==null&&T!==void 0?T:C,F=i(U,A?null:g.baseLatency,l,v,N,k),$=A?r(v,k,N):null;super(g,!0,F,$);const X=[];F.parameters.forEach((W,K)=>{const ne=n(this,A,W);X.push([K,ne])}),this._nativeAudioWorkletNode=F,this._onprocessorerror=null,this._parameters=new hJ(X),A&&t(C,this);const{activeInputs:q}=s(this);d(F,q)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(g){const v=typeof g=="function"?f(this,g):null;this._nativeAudioWorkletNode.onprocessorerror=v;const E=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=E!==null&&E===v?g:E}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function WR(t,e,n,r,i){if(typeof t.copyFromChannel=="function")e[n].byteLength===0&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],r,i);else{const s=t.getChannelData(r);if(e[n].byteLength===0)e[n]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(o)}}}const fJ=(t,e,n,r,i)=>{typeof t.copyToChannel=="function"?e[n].byteLength!==0&&t.copyToChannel(e[n],r,i):e[n].byteLength!==0&&t.getChannelData(r).set(e[n],i)},KR=(t,e)=>{const n=[];for(let r=0;r<t;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));n.push(i)}return n},lje=(t,e)=>{const n=Vh(lU,t),r=Us(e);return Vh(n,r)},uje=async(t,e,n,r,i,s,o)=>{const a=e===null?Math.ceil(t.context.length/128)*128:e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce((v,E)=>v+E,0),u=l===0?null:n.createBuffer(l,a,n.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const d=Rl(t),h=await lje(n,t),f=KR(r.numberOfInputs,r.channelCount),p=KR(r.numberOfOutputs,i),g=Array.from(t.parameters.keys()).reduce((v,E)=>({...v,[E]:new Float32Array(128)}),{});for(let v=0;v<a;v+=128){if(r.numberOfInputs>0&&e!==null)for(let E=0;E<r.numberOfInputs;E+=1)for(let T=0;T<r.channelCount;T+=1)WR(e,f[E],T,T,v);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:E},T)=>{WR(e,g,E,c+T,v)});for(let E=0;E<r.numberOfInputs;E+=1)for(let T=0;T<i[E];T+=1)p[E][T].byteLength===0&&(p[E][T]=new Float32Array(128));try{const E=f.map((C,A)=>d.activeInputs[A].size===0?[]:C),T=o(v/n.sampleRate,n.sampleRate,()=>h.process(E,p,g));if(u!==null)for(let C=0,A=0;C<r.numberOfOutputs;C+=1){for(let k=0;k<i[C];k+=1)fJ(u,p[C],k,A+k,v);A+=i[C]}if(!T)break}catch(E){t.dispatchEvent(new ErrorEvent("processorerror",{colno:E.colno,filename:E.filename,lineno:E.lineno,message:E.message}));break}}return u},dje=(t,e,n,r,i,s,o,a,c,l,u,d,h,f,p,g)=>(v,E,T)=>{const C=new WeakMap;let A=null;const k=async(I,N)=>{let U=u(I),F=null;const $=Jc(U,N),X=Array.isArray(E.outputChannelCount)?E.outputChannelCount:Array.from(E.outputChannelCount);if(d===null){const q=X.reduce((Q,ie)=>Q+ie,0),W=i(N,{channelCount:Math.max(1,q),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,q)}),K=[];for(let Q=0;Q<I.numberOfOutputs;Q+=1)K.push(r(N,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:X[Q]}));const ne=o(N,{channelCount:E.channelCount,channelCountMode:E.channelCountMode,channelInterpretation:E.channelInterpretation,gain:1});ne.connect=e.bind(null,K),ne.disconnect=c.bind(null,K),F=[W,K,ne]}else $||(U=new d(N,v));if(C.set(N,F===null?U:F[2]),F!==null){if(A===null){if(T===void 0)throw new Error("Missing the processor constructor.");if(h===null)throw new Error("Missing the native OfflineAudioContext constructor.");const ie=I.channelCount*I.numberOfInputs,G=T.parameterDescriptors===void 0?0:T.parameterDescriptors.length,Z=ie+G;A=uje(I,Z===0?null:await(async()=>{const ue=new h(Z,Math.ceil(I.context.length/128)*128,N.sampleRate),Ae=[],Be=[];for(let we=0;we<E.numberOfInputs;we+=1)Ae.push(o(ue,{channelCount:E.channelCount,channelCountMode:E.channelCountMode,channelInterpretation:E.channelInterpretation,gain:1})),Be.push(i(ue,{channelCount:E.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:E.channelCount}));const Se=await Promise.all(Array.from(I.parameters.values()).map(async we=>{const Te=s(ue,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:we.value});return await f(ue,we,Te.offset),Te})),Pe=r(ue,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,ie+G)});for(let we=0;we<E.numberOfInputs;we+=1){Ae[we].connect(Be[we]);for(let Te=0;Te<E.channelCount;Te+=1)Be[we].connect(Pe,Te,we*E.channelCount+Te)}for(const[we,Te]of Se.entries())Te.connect(Pe,0,ie+we),Te.start(0);return Pe.connect(ue.destination),await Promise.all(Ae.map(we=>p(I,ue,we))),g(ue)})(),N,E,X,T,l)}const q=await A,W=n(N,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[K,ne,Q]=F;q!==null&&(W.buffer=q,W.start(0)),W.connect(K);for(let ie=0,G=0;ie<I.numberOfOutputs;ie+=1){const Z=ne[ie];for(let se=0;se<X[ie];se+=1)K.connect(Z,G+se,se);G+=X[ie]}return Q}if($)for(const[q,W]of I.parameters.entries())await t(N,W,U.parameters.get(q));else for(const[q,W]of I.parameters.entries())await f(N,W,U.parameters.get(q));return await p(I,N,U),U};return{render(I,N){a(N,I);const U=C.get(N);return U!==void 0?Promise.resolve(U):k(I,N)}}},hje=(t,e,n,r,i,s,o,a,c,l,u,d,h,f,p,g,v,E,T,C)=>class extends p{constructor(k,I){super(k,I),this._nativeContext=k,this._audioWorklet=t===void 0?void 0:{addModule:(N,U)=>t(this,N,U)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(k,I,N){return new n({length:I,numberOfChannels:k,sampleRate:N})}createBufferSource(){return new r(this)}createChannelMerger(k=6){return new s(this,{numberOfInputs:k})}createChannelSplitter(k=6){return new o(this,{numberOfOutputs:k})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(k=1){return new u(this,{maxDelayTime:k})}createDynamicsCompressor(){return new d(this)}createGain(){return new h(this)}createIIRFilter(k,I){return new f(this,{feedback:I,feedforward:k})}createOscillator(){return new g(this)}createPanner(){return new v(this)}createPeriodicWave(k,I,N={disableNormalization:!1}){return new E(this,{...N,imag:I,real:k})}createStereoPanner(){return new T(this)}createWaveShaper(){return new C(this)}decodeAudioData(k,I,N){return l(this._nativeContext,k).then(U=>(typeof I=="function"&&I(U),U),U=>{throw typeof N=="function"&&N(U),U})}},fje={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},pje=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const d=s(l),h={...fje,...u},f=i(d,h),p=o(d),g=p?n():null;super(l,!1,f,g),this._Q=e(this,p,f.Q,Cl,Jl),this._detune=e(this,p,f.detune,1200*Math.log2(Cl),-1200*Math.log2(Cl)),this._frequency=e(this,p,f.frequency,l.sampleRate/2,0),this._gain=e(this,p,f.gain,40*Math.log10(Cl),Jl),this._nativeBiquadFilterNode=f,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,d){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,d)}catch(h){throw h.code===11?r():h}if(l.length!==u.length||u.length!==d.length)throw r()}},mje=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=Jc(l,c);if(!u){const d={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,d)}return s.set(c,l),u?(await t(c,a.Q,l.Q),await t(c,a.detune,l.detune),await t(c,a.frequency,l.frequency),await t(c,a.gain,l.gain)):(await r(c,a.Q,l.Q),await r(c,a.detune,l.detune),await r(c,a.frequency,l.frequency),await r(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},gje=(t,e)=>(n,r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t.get(n);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(t.set(n,o),o.catch(()=>!1).then(a=>(t.delete(n),e.set(n,a),a))):(e.set(n,o),o)}catch{return e.set(n,!1),!1}},vje={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},_je=(t,e,n,r,i)=>class extends t{constructor(o,a){const c=r(o),l={...vje,...a},u=n(c,l),d=i(c)?e():null;super(o,!1,u,d)}},yje=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Jc(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},bje={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Eje=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u=s({...bje,...c}),d=n(l,u),h=i(l)?e():null;super(a,!1,d,h)}},Sje=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Jc(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(o,l)}return r.set(o,a),await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},wje=t=>(e,n,r)=>t(n,e,r),Tje=t=>(e,n,r=0,i=0)=>{const s=e[r];if(s===void 0)throw t();return qR(n)?s.connect(n,0,i):s.connect(n,0)},xje=t=>(e,n)=>{const r=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return r.buffer=i,r.loop=!0,r.connect(n),r.start(),()=>{r.stop(),r.disconnect(n)}},Cje={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Rje=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={...Cje,...l},h=r(u,d),f=s(u),p=f?n():null;super(c,!1,h,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=h,this._offset=e(this,f,h.offset,Cl,Jl),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){UE(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),eg(this)&&ex(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},Aje=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let d=n(l);const h=Jc(d,u);if(!h){const f={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,offset:d.offset.value};d=e(u,f),o!==null&&d.start(o),a!==null&&d.stop(a)}return s.set(u,d),h?await t(u,l.offset,d.offset):await r(u,l.offset,d.offset),await i(l,u,d),d};return{set start(l){o=l},set stop(l){a=l},render(l,u){const d=s.get(u);return d!==void 0?Promise.resolve(d):c(l,u)}}},Mje=t=>e=>(t[0]=e,t[0]),Ije={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Oje=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u={...Ije,...c},d=n(l,u),f=i(l)?e():null;super(a,!1,d,f),this._isBufferNullified=!1,this._nativeConvolverNode=d,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},kje=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Jc(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(o,l)}return r.set(o,a),nS(a)?await n(s,o,a.inputs[0]):await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},Nje=(t,e)=>(n,r,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,r,i)}catch(s){throw s.name==="SyntaxError"?t():s}},Pje=()=>new DOMException("","DataCloneError"),dz=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise(r=>{const i=()=>{n.onmessage=null,e.close(),n.close(),r()};n.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}})},Dje=(t,e,n,r,i,s,o,a,c,l,u)=>(d,h)=>{const f=o(d)?d:s(d);if(i.has(h)){const p=n();return Promise.reject(p)}try{i.add(h)}catch{}return e(c,()=>c(f))?f.decodeAudioData(h).then(p=>(dz(h).catch(()=>{}),e(a,()=>a(p))||u(p),t.add(p),p)):new Promise((p,g)=>{const v=async()=>{try{await dz(h)}catch{}},E=T=>{g(T),v()};try{f.decodeAudioData(h,T=>{typeof T.copyFromChannel!="function"&&(l(T),c3(T)),t.add(T),v().then(()=>p(T))},T=>{E(T===null?r():T)})}catch(T){E(T)}})},Lje=(t,e,n,r,i,s,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const d=s(c.context),h=a(d);if(u===l){if(e.delete(c),!h&&o(c)){const f=r(c),{outputs:p}=n(c);for(const g of p)if(nx(g)){const v=r(g[0]);t(f,v,g[1],g[2])}else{const v=i(g[0]);f.connect(v,g[1])}}}else e.set(c,u-l)},Uje={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Fje=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={...Uje,...l},h=r(u,d),f=s(u),p=f?n(d.maxDelayTime):null;super(c,!1,h,p),this._delayTime=e(this,f,h.delayTime),o(this,d.maxDelayTime)}get delayTime(){return this._delayTime}},Bje=(t,e,n,r,i)=>s=>{const o=new WeakMap,a=async(c,l)=>{let u=n(c);const d=Jc(u,l);if(!d){const h={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,h)}return o.set(l,u),d?await t(l,c.delayTime,u.delayTime):await r(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},jje=t=>(e,n,r,i)=>t(e[i],s=>s[0]===n&&s[1]===r),$je=t=>(e,n)=>{t(e).delete(n)},Hje=t=>"delayTime"in t,Vje=(t,e,n)=>function r(i,s){const o=VR(s)?s:n(t,s);if(Hje(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>r([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},FC=(t,e,n)=>{const r=e[n];if(r===void 0)throw t();return r},zje=t=>(e,n=void 0,r=void 0,i=0)=>n===void 0?e.forEach(s=>s.disconnect()):typeof n=="number"?FC(t,e,n).disconnect():qR(n)?r===void 0?e.forEach(s=>s.disconnect(n)):i===void 0?FC(t,e,r).disconnect(n,0):FC(t,e,r).disconnect(n,0,i):r===void 0?e.forEach(s=>s.disconnect(n)):FC(t,e,r).disconnect(n,0),Gje={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},qje=(t,e,n,r,i,s,o,a)=>class extends t{constructor(l,u){const d=s(l),h={...Gje,...u},f=r(d,h),p=o(d),g=p?n():null;super(l,!1,f,g),this._attack=e(this,p,f.attack),this._knee=e(this,p,f.knee),this._nativeDynamicsCompressorNode=f,this._ratio=e(this,p,f.ratio),this._release=e(this,p,f.release),this._threshold=e(this,p,f.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},Wje=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=Jc(l,c);if(!u){const d={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,d)}return s.set(c,l),u?(await t(c,a.attack,l.attack),await t(c,a.knee,l.knee),await t(c,a.ratio,l.ratio),await t(c,a.release,l.release),await t(c,a.threshold,l.threshold)):(await r(c,a.attack,l.attack),await r(c,a.knee,l.knee),await r(c,a.ratio,l.ratio),await r(c,a.release,l.release),await r(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},Kje=()=>new DOMException("","EncodingError"),Yje=t=>e=>new Promise((n,r)=>{if(t===null){r(new SyntaxError);return}const i=t.document.head;if(i===null)r(new SyntaxError);else{const s=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,l=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(u,d,h,f,p)=>{if(d===a||d===t.location.href&&h===1&&f===1)return l(),r(p),!1;if(c!==null)return c(u,d,h,f,p)},s.onerror=()=>{l(),r(new SyntaxError)},s.onload=()=>{l(),n()},s.src=a,s.type="module",i.appendChild(s)}}),Xje=t=>class{constructor(n){this._nativeEventTarget=n,this._listeners=new WeakMap}addEventListener(n,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=t(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(n,s,i)}}dispatchEvent(n){return this._nativeEventTarget.dispatchEvent(n)}removeEventListener(n,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(n,s===void 0?null:s,i)}},Jje=t=>(e,n,r)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*n)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{t!==null&&(delete t.currentFrame,delete t.currentTime)}},Qje=t=>async e=>{try{const n=await fetch(e);if(n.ok)return[await n.text(),n.url]}catch{}throw t()},Zje={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},e$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...Zje,...c},d=r(l,u),h=s(l),f=h?n():null;super(a,!1,d,f),this._gain=e(this,h,d.gain,Cl,Jl)}get gain(){return this._gain}},t$e=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=Jc(l,c);if(!u){const d={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,d)}return s.set(c,l),u?await t(c,a.gain,l.gain):await r(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},n$e=(t,e)=>n=>e(t,n),r$e=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer},i$e=t=>e=>{var n;return(n=t.get(e))!==null&&n!==void 0?n:0},s$e=t=>e=>{const n=t(e);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer},o$e=t=>e=>t.get(e),ic=()=>new DOMException("","InvalidStateError"),a$e=t=>e=>{const n=t.get(e);if(n===void 0)throw ic();return n},c$e=(t,e)=>n=>{let r=t.get(n);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),t.set(n,r),r},l$e=t=>e=>{const n=t.get(e);if(n===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return n},fk=()=>new DOMException("","InvalidAccessError"),u$e=t=>{t.getFrequencyResponse=(e=>(n,r,i)=>{if(n.length!==r.length||r.length!==i.length)throw fk();return e.call(t,n,r,i)})(t.getFrequencyResponse)},d$e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},h$e=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=r(a),u=i(l),d={...d$e,...c},h=e(l,u?null:a.baseLatency,d),f=u?n(d.feedback,d.feedforward):null;super(a,!1,h,f),u$e(h),this._nativeIIRFilterNode=h,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},pJ=(t,e,n,r,i,s,o,a,c,l,u)=>{const d=l.length;let h=a;for(let f=0;f<d;f+=1){let p=n[0]*l[f];for(let g=1;g<i;g+=1){const v=h-g&c-1;p+=n[g]*s[v],p-=t[g]*o[v]}for(let g=i;g<r;g+=1)p+=n[g]*s[h-g&c-1];for(let g=i;g<e;g+=1)p-=t[g]*o[h-g&c-1];s[h]=l[f],o[h]=p,h=h+1&c-1,u[f]=p}return h},f$e=(t,e,n,r)=>{const i=n instanceof Float64Array?n:new Float64Array(n),s=r instanceof Float64Array?r:new Float64Array(r),o=i.length,a=s.length,c=Math.min(o,a);if(i[0]!==1){for(let p=0;p<o;p+=1)s[p]/=i[0];for(let p=1;p<a;p+=1)i[p]/=i[0]}const l=32,u=new Float32Array(l),d=new Float32Array(l),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),f=t.numberOfChannels;for(let p=0;p<f;p+=1){const g=t.getChannelData(p),v=h.getChannelData(p);u.fill(0),d.fill(0),pJ(i,o,s,a,c,u,d,0,l,g,v)}return h},p$e=(t,e,n,r,i)=>(s,o)=>{const a=new WeakMap;let c=null;const l=async(u,d)=>{let h=null,f=e(u);const p=Jc(f,d);if(d.createIIRFilter===void 0?h=t(d,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(f=d.createIIRFilter(o,s)),a.set(d,h===null?f:h),h!==null){if(c===null){if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");const v=new n(u.context.destination.channelCount,u.context.length,d.sampleRate);c=(async()=>{await r(u,v,v.destination);const E=await i(v);return f$e(E,d,s,o)})()}const g=await c;return h.buffer=g,h.start(0),h}return await r(u,d,f),f};return{render(u,d){const h=a.get(d);return h!==void 0?Promise.resolve(h):l(u,d)}}},m$e=(t,e,n,r,i,s)=>o=>(a,c)=>{const l=t.get(a);if(l===void 0){if(!o&&s(a)){const u=r(a),{outputs:d}=n(a);for(const h of d)if(nx(h)){const f=r(h[0]);e(u,f,h[1],h[2])}else{const f=i(h[0]);u.disconnect(f,h[1])}}t.set(a,c)}else t.set(a,l+c)},g$e=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},v$e=(t,e)=>n=>t.has(n)||e(n),_$e=(t,e)=>n=>t.has(n)||e(n),y$e=(t,e)=>n=>{const r=t.get(n);return e(r)||e(n)},b$e=t=>e=>t!==null&&e instanceof t,E$e=t=>e=>t!==null&&typeof t.AudioNode=="function"&&e instanceof t.AudioNode,S$e=t=>e=>t!==null&&typeof t.AudioParam=="function"&&e instanceof t.AudioParam,w$e=(t,e)=>n=>t(n)||e(n),T$e=t=>e=>t!==null&&e instanceof t,x$e=t=>t!==null&&t.isSecureContext,C$e=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),c=e(a,o);if(r(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},R$e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},A$e=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s);if(r(a))throw new TypeError;const c={...R$e,...o},l=e(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},M$e=(t,e,n,r)=>class extends t{constructor(s,o){const a=n(s),c=e(a,o);if(r(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},I$e=(t,e,n)=>class extends t{constructor(i,s){const o=n(i),a=e(o,s);super(i,!0,a,null)}},O$e=(t,e,n,r,i,s)=>class extends n{constructor(a,c){super(a),this._nativeContext=a,dk.set(this,a),r(a)&&i.set(a,new Set),this._destination=new t(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},Kw=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return n===void 0?!1:(n.catch(()=>{}),!0)}catch{}return!1},k$e=(t,e)=>(n,r,i)=>{const s=new Set;return n.connect=(o=>(a,c=0,l=0)=>{const u=s.size===0;if(e(a))return o.call(n,a,c,l),t(s,[a,c,l],d=>d[0]===a&&d[1]===c&&d[2]===l,!0),u&&r(),a;o.call(n,a,c),t(s,[a,c],d=>d[0]===a&&d[1]===c,!0),u&&r()})(n.connect),n.disconnect=(o=>(a,c,l)=>{const u=s.size>0;if(a===void 0)o.apply(n),s.clear();else if(typeof a=="number"){o.call(n,a);for(const h of s)h[1]===a&&s.delete(h)}else{e(a)?o.call(n,a,c,l):o.call(n,a,c);for(const h of s)h[0]===a&&(c===void 0||h[1]===c)&&(l===void 0||h[2]===l)&&s.delete(h)}const d=s.size===0;u&&d&&i()})(n.disconnect),n},Ws=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n]&&(t[n]=r)},Fa=(t,e)=>{Ws(t,e,"channelCount"),Ws(t,e,"channelCountMode"),Ws(t,e,"channelInterpretation")},hz=t=>typeof t.getFloatTimeDomainData=="function",N$e=t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const r=Math.max(n.length,t.fftSize);for(let i=0;i<r;i+=1)e[i]=(n[i]-128)*.0078125;return e}},P$e=(t,e)=>(n,r)=>{const i=n.createAnalyser();if(Fa(i,r),!(r.maxDecibels>r.minDecibels))throw e();return Ws(i,r,"fftSize"),Ws(i,r,"maxDecibels"),Ws(i,r,"minDecibels"),Ws(i,r,"smoothingTimeConstant"),t(hz,()=>hz(i))||N$e(i),i},D$e=t=>t===null?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,bo=(t,e,n)=>{const r=e[n];r!==void 0&&r!==t[n].value&&(t[n].value=r)},L$e=t=>{t.start=(e=>{let n=!1;return(r=0,i=0,s)=>{if(n)throw ic();e.call(t,r,i,s),n=!0}})(t.start)},d3=t=>{t.start=(e=>(n=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,r,i)})(t.start)},h3=t=>{t.stop=(e=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})(t.stop)},U$e=(t,e,n,r,i,s,o,a,c,l,u)=>(d,h)=>{const f=d.createBufferSource();return Fa(f,h),bo(f,h,"playbackRate"),Ws(f,h,"buffer"),Ws(f,h,"loop"),Ws(f,h,"loopEnd"),Ws(f,h,"loopStart"),e(n,()=>n(d))||L$e(f),e(r,()=>r(d))||c(f),e(i,()=>i(d))||l(f,d),e(s,()=>s(d))||d3(f),e(o,()=>o(d))||u(f,d),e(a,()=>a(d))||h3(f),t(d,f),f},F$e=t=>t===null?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,B$e=(t,e)=>(n,r,i)=>{const s=n.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=t(n,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},j$e=t=>t===null?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,$$e=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},H$e=(t,e,n,r,i)=>(s,o,a,c,l,u)=>{if(a!==null)try{const d=new a(s,c,u),h=new Map;let f=null;if(Object.defineProperties(d,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>f,set:p=>{typeof f=="function"&&d.removeEventListener("processorerror",f),f=typeof p=="function"?p:null,typeof f=="function"&&d.addEventListener("processorerror",f)}}}),d.addEventListener=(p=>(...g)=>{if(g[0]==="processorerror"){const v=typeof g[1]=="function"?g[1]:typeof g[1]=="object"&&g[1]!==null&&typeof g[1].handleEvent=="function"?g[1].handleEvent:null;if(v!==null){const E=h.get(g[1]);E!==void 0?g[1]=E:(g[1]=T=>{T.type==="error"?(Object.defineProperties(T,{type:{value:"processorerror"}}),v(T)):v(new ErrorEvent(g[0],{...T}))},h.set(v,g[1]))}}return p.call(d,"error",g[1],g[2]),p.call(d,...g)})(d.addEventListener),d.removeEventListener=(p=>(...g)=>{if(g[0]==="processorerror"){const v=h.get(g[1]);v!==void 0&&(h.delete(g[1]),g[1]=v)}return p.call(d,"error",g[1],g[2]),p.call(d,g[0],g[1],g[2])})(d.removeEventListener),u.numberOfOutputs!==0){const p=n(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return d.connect(p).connect(s.destination),i(d,()=>p.disconnect(),()=>p.connect(s.destination))}return d}catch(d){throw d.code===11?r():d}if(l===void 0)throw r();return $$e(u),e(s,o,l,u)},mJ=(t,e)=>t===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),V$e=t=>new Promise((e,n)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),n(s)},i.postMessage(t)}),z$e=async(t,e)=>{const n=await V$e(e);return new t(n)},G$e=(t,e,n,r)=>{let i=lU.get(t);i===void 0&&(i=new WeakMap,lU.set(t,i));const s=z$e(n,r);return i.set(e,s),s},q$e=(t,e,n,r,i,s,o,a,c,l,u,d,h)=>(f,p,g,v)=>{if(v.numberOfInputs===0&&v.numberOfOutputs===0)throw c();const E=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(E.some(ut=>ut<1))throw c();if(E.length!==v.numberOfOutputs)throw e();if(v.channelCountMode!=="explicit")throw c();const T=v.channelCount*v.numberOfInputs,C=E.reduce((ut,He)=>ut+He,0),A=g.parameterDescriptors===void 0?0:g.parameterDescriptors.length;if(T+A>6||C>6)throw c();const k=new MessageChannel,I=[],N=[];for(let ut=0;ut<v.numberOfInputs;ut+=1)I.push(o(f,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),N.push(i(f,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const U=[];if(g.parameterDescriptors!==void 0)for(const{defaultValue:ut,maxValue:He,minValue:Rt,name:$t}of g.parameterDescriptors){const Tt=s(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:v.parameterData[$t]!==void 0?v.parameterData[$t]:ut===void 0?0:ut});Object.defineProperties(Tt.offset,{defaultValue:{get:()=>ut===void 0?0:ut},maxValue:{get:()=>He===void 0?Cl:He},minValue:{get:()=>Rt===void 0?Jl:Rt}}),U.push(Tt)}const F=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,T+A)}),$=mJ(p,f.sampleRate),X=a(f,$,T+A,Math.max(1,C)),q=i(f,{channelCount:Math.max(1,C),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,C)}),W=[];for(let ut=0;ut<v.numberOfOutputs;ut+=1)W.push(r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:E[ut]}));for(let ut=0;ut<v.numberOfInputs;ut+=1){I[ut].connect(N[ut]);for(let He=0;He<v.channelCount;He+=1)N[ut].connect(F,He,ut*v.channelCount+He)}const K=new hJ(g.parameterDescriptors===void 0?[]:g.parameterDescriptors.map(({name:ut},He)=>{const Rt=U[He];return Rt.connect(F,0,T+He),Rt.start(0),[ut,Rt.offset]}));F.connect(X);let ne=v.channelInterpretation,Q=null;const ie=v.numberOfOutputs===0?[X]:W,G={get bufferSize(){return $},get channelCount(){return v.channelCount},set channelCount(ut){throw n()},get channelCountMode(){return v.channelCountMode},set channelCountMode(ut){throw n()},get channelInterpretation(){return ne},set channelInterpretation(ut){for(const He of I)He.channelInterpretation=ut;ne=ut},get context(){return X.context},get inputs(){return I},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get onprocessorerror(){return Q},set onprocessorerror(ut){typeof Q=="function"&&G.removeEventListener("processorerror",Q),Q=typeof ut=="function"?ut:null,typeof Q=="function"&&G.addEventListener("processorerror",Q)},get parameters(){return K},get port(){return k.port2},addEventListener(...ut){return X.addEventListener(ut[0],ut[1],ut[2])},connect:t.bind(null,ie),disconnect:l.bind(null,ie),dispatchEvent(...ut){return X.dispatchEvent(ut[0])},removeEventListener(...ut){return X.removeEventListener(ut[0],ut[1],ut[2])}},Z=new Map;k.port1.addEventListener=(ut=>(...He)=>{if(He[0]==="message"){const Rt=typeof He[1]=="function"?He[1]:typeof He[1]=="object"&&He[1]!==null&&typeof He[1].handleEvent=="function"?He[1].handleEvent:null;if(Rt!==null){const $t=Z.get(He[1]);$t!==void 0?He[1]=$t:(He[1]=Tt=>{u(f.currentTime,f.sampleRate,()=>Rt(Tt))},Z.set(Rt,He[1]))}}return ut.call(k.port1,He[0],He[1],He[2])})(k.port1.addEventListener),k.port1.removeEventListener=(ut=>(...He)=>{if(He[0]==="message"){const Rt=Z.get(He[1]);Rt!==void 0&&(Z.delete(He[1]),He[1]=Rt)}return ut.call(k.port1,He[0],He[1],He[2])})(k.port1.removeEventListener);let se=null;Object.defineProperty(k.port1,"onmessage",{get:()=>se,set:ut=>{typeof se=="function"&&k.port1.removeEventListener("message",se),se=typeof ut=="function"?ut:null,typeof se=="function"&&(k.port1.addEventListener("message",se),k.port1.start())}}),g.prototype.port=k.port1;let ue=null;G$e(f,G,g,v).then(ut=>ue=ut);const Be=KR(v.numberOfInputs,v.channelCount),Se=KR(v.numberOfOutputs,E),Pe=g.parameterDescriptors===void 0?[]:g.parameterDescriptors.reduce((ut,{name:He})=>({...ut,[He]:new Float32Array(128)}),{});let we=!0;const Te=()=>{v.numberOfOutputs>0&&X.disconnect(q);for(let ut=0,He=0;ut<v.numberOfOutputs;ut+=1){const Rt=W[ut];for(let $t=0;$t<E[ut];$t+=1)q.disconnect(Rt,He+$t,$t);He+=E[ut]}},Oe=new Map;X.onaudioprocess=({inputBuffer:ut,outputBuffer:He})=>{if(ue!==null){const Rt=d(G);for(let $t=0;$t<$;$t+=128){for(let Tt=0;Tt<v.numberOfInputs;Tt+=1)for(let Ft=0;Ft<v.channelCount;Ft+=1)WR(ut,Be[Tt],Ft,Ft,$t);g.parameterDescriptors!==void 0&&g.parameterDescriptors.forEach(({name:Tt},Ft)=>{WR(ut,Pe,Tt,T+Ft,$t)});for(let Tt=0;Tt<v.numberOfInputs;Tt+=1)for(let Ft=0;Ft<E[Tt];Ft+=1)Se[Tt][Ft].byteLength===0&&(Se[Tt][Ft]=new Float32Array(128));try{const Tt=Be.map((Ee,le)=>{if(Rt[le].size>0)return Oe.set(le,$/128),Ee;const it=Oe.get(le);return it===void 0?[]:(Ee.every(je=>je.every(Fe=>Fe===0))&&(it===1?Oe.delete(le):Oe.set(le,it-1)),Ee)});we=u(f.currentTime+$t/f.sampleRate,f.sampleRate,()=>ue.process(Tt,Se,Pe));for(let Ee=0,le=0;Ee<v.numberOfOutputs;Ee+=1){for(let We=0;We<E[Ee];We+=1)fJ(He,Se[Ee],We,le+We,$t);le+=E[Ee]}}catch(Tt){we=!1,G.dispatchEvent(new ErrorEvent("processorerror",{colno:Tt.colno,filename:Tt.filename,lineno:Tt.lineno,message:Tt.message}))}if(!we){for(let Tt=0;Tt<v.numberOfInputs;Tt+=1){I[Tt].disconnect(N[Tt]);for(let Ft=0;Ft<v.channelCount;Ft+=1)N[$t].disconnect(F,Ft,Tt*v.channelCount+Ft)}if(g.parameterDescriptors!==void 0){const Tt=g.parameterDescriptors.length;for(let Ft=0;Ft<Tt;Ft+=1){const Ee=U[Ft];Ee.disconnect(F,0,T+Ft),Ee.stop()}}F.disconnect(X),X.onaudioprocess=null,_t?Te():ge();break}}}};let _t=!1;const Ct=o(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),me=()=>X.connect(Ct).connect(f.destination),ge=()=>{X.disconnect(Ct),Ct.disconnect()},nt=()=>{if(we){ge(),v.numberOfOutputs>0&&X.connect(q);for(let ut=0,He=0;ut<v.numberOfOutputs;ut+=1){const Rt=W[ut];for(let $t=0;$t<E[ut];$t+=1)q.connect(Rt,He+$t,$t);He+=E[ut]}}_t=!0},Ce=()=>{we&&(me(),Te()),_t=!1};return me(),h(G,nt,Ce)},gJ=(t,e)=>{const n=t.createBiquadFilter();return Fa(n,e),bo(n,e,"Q"),bo(n,e,"detune"),bo(n,e,"frequency"),bo(n,e,"gain"),Ws(n,e,"type"),n},W$e=(t,e)=>(n,r)=>{const i=n.createChannelMerger(r.numberOfInputs);return t!==null&&t.name==="webkitAudioContext"&&e(n,i),Fa(i,r),i},K$e=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:n=>{if(n!==e)throw ic()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:n=>{if(n!=="explicit")throw ic()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:n=>{if(n!=="discrete")throw ic()}})},rx=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return Fa(n,e),K$e(n),n},Y$e=(t,e,n,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return n(s,o);const a=s.createConstantSource();return Fa(a,o),bo(a,o,"offset"),e(r,()=>r(s))||d3(a),e(i,()=>i(s))||h3(a),t(s,a),a},rS=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),X$e=(t,e,n,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=n(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const d={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},h=()=>c.connect(l),f=()=>c.disconnect(l);return t(i,c),r(rS(d,l),h,f)},J$e=(t,e)=>(n,r)=>{const i=n.createConvolver();if(Fa(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),Ws(i,r,"buffer"),r.channelCount>2||(e(i,"channelCount",s=>()=>s.call(i),s=>o=>{if(o>2)throw t();return s.call(i,o)}),r.channelCountMode==="max"))throw t();return e(i,"channelCountMode",s=>()=>s.call(i),s=>o=>{if(o==="max")throw t();return s.call(i,o)}),i},vJ=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return Fa(n,e),bo(n,e,"delayTime"),n},Q$e=t=>(e,n)=>{const r=e.createDynamicsCompressor();if(Fa(r,n),n.channelCount>2||n.channelCountMode==="max")throw t();return bo(r,n,"attack"),bo(r,n,"knee"),bo(r,n,"ratio"),bo(r,n,"release"),bo(r,n,"threshold"),r},pu=(t,e)=>{const n=t.createGain();return Fa(n,e),bo(n,e,"gain"),n},Z$e=t=>(e,n,r)=>{if(e.createIIRFilter===void 0)return t(e,n,r);const i=e.createIIRFilter(r.feedforward,r.feedback);return Fa(i,r),i};function eHe(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function tHe(t,e){return[t[0]*e[0]-t[1]*e[1],t[0]*e[1]+t[1]*e[0]]}function fz(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)n=tHe(n,e),n[0]+=t[r];return n}const nHe=(t,e,n,r)=>(i,s,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const d=mJ(s,i.sampleRate),h=l instanceof Float64Array?l:new Float64Array(l),f=u instanceof Float64Array?u:new Float64Array(u),p=h.length,g=f.length,v=Math.min(p,g);if(p===0||p>20)throw r();if(h[0]===0)throw e();if(g===0||g>20)throw r();if(f[0]===0)throw e();if(h[0]!==1){for(let U=0;U<g;U+=1)f[U]/=h[0];for(let U=1;U<p;U+=1)h[U]/=h[0]}const E=n(i,d,o,o);E.channelCount=o,E.channelCountMode=a,E.channelInterpretation=c;const T=32,C=[],A=[],k=[];for(let U=0;U<o;U+=1){C.push(0);const F=new Float32Array(T),$=new Float32Array(T);F.fill(0),$.fill(0),A.push(F),k.push($)}E.onaudioprocess=U=>{const F=U.inputBuffer,$=U.outputBuffer,X=F.numberOfChannels;for(let q=0;q<X;q+=1){const W=F.getChannelData(q),K=$.getChannelData(q);C[q]=pJ(h,p,f,g,v,A[q],k[q],C[q],T,W,K)}};const I=i.sampleRate/2;return rS({get bufferSize(){return d},get channelCount(){return E.channelCount},set channelCount(U){E.channelCount=U},get channelCountMode(){return E.channelCountMode},set channelCountMode(U){E.channelCountMode=U},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(U){E.channelInterpretation=U},get context(){return E.context},get inputs(){return[E]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},addEventListener(...U){return E.addEventListener(U[0],U[1],U[2])},dispatchEvent(...U){return E.dispatchEvent(U[0])},getFrequencyResponse(U,F,$){if(U.length!==F.length||F.length!==$.length)throw t();const X=U.length;for(let q=0;q<X;q+=1){const W=-Math.PI*(U[q]/I),K=[Math.cos(W),Math.sin(W)],ne=fz(f,K),Q=fz(h,K),ie=eHe(ne,Q);F[q]=Math.sqrt(ie[0]*ie[0]+ie[1]*ie[1]),$[q]=Math.atan2(ie[1],ie[0])}},removeEventListener(...U){return E.removeEventListener(U[0],U[1],U[2])}},E)},rHe=(t,e)=>t.createMediaElementSource(e.mediaElement),iHe=(t,e)=>{const n=t.createMediaStreamDestination();return Fa(n,e),n.numberOfOutputs===1&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},sHe=(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},oHe=(t,e)=>(n,{mediaStreamTrack:r})=>{if(typeof n.createMediaStreamTrackSource=="function")return n.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=n.createMediaStreamSource(i);if(r.kind!=="audio")throw t();if(e(n))throw new TypeError;return s},aHe=t=>t===null?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,cHe=(t,e,n,r,i,s)=>(o,a)=>{const c=o.createOscillator();return Fa(c,a),bo(c,a,"detune"),bo(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Ws(c,a,"type"),e(n,()=>n(o))||d3(c),e(r,()=>r(o))||s(c,o),e(i,()=>i(o))||h3(c),t(o,c),c},lHe=t=>(e,n)=>{const r=e.createPanner();return r.orientationX===void 0?t(e,n):(Fa(r,n),bo(r,n,"orientationX"),bo(r,n,"orientationY"),bo(r,n,"orientationZ"),bo(r,n,"positionX"),bo(r,n,"positionY"),bo(r,n,"positionZ"),Ws(r,n,"coneInnerAngle"),Ws(r,n,"coneOuterAngle"),Ws(r,n,"coneOuterGain"),Ws(r,n,"distanceModel"),Ws(r,n,"maxDistance"),Ws(r,n,"panningModel"),Ws(r,n,"refDistance"),Ws(r,n,"rolloffFactor"),r)},uHe=(t,e,n,r,i,s,o,a,c,l)=>(u,{coneInnerAngle:d,coneOuterAngle:h,coneOuterGain:f,distanceModel:p,maxDistance:g,orientationX:v,orientationY:E,orientationZ:T,panningModel:C,positionX:A,positionY:k,positionZ:I,refDistance:N,rolloffFactor:U,...F})=>{const $=u.createPanner();if(F.channelCount>2||F.channelCountMode==="max")throw o();Fa($,F);const X={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},q=n(u,{...X,channelInterpretation:"speakers",numberOfInputs:6}),W=r(u,{...F,gain:1}),K=r(u,{...X,gain:1}),ne=r(u,{...X,gain:0}),Q=r(u,{...X,gain:0}),ie=r(u,{...X,gain:0}),G=r(u,{...X,gain:0}),Z=r(u,{...X,gain:0}),se=i(u,256,6,1),ue=s(u,{...X,curve:new Float32Array([1,1]),oversample:"none"});let Ae=[v,E,T],Be=[A,k,I];const Se=new Float32Array(1);se.onaudioprocess=({inputBuffer:Oe})=>{const _t=[c(Oe,Se,0),c(Oe,Se,1),c(Oe,Se,2)];_t.some((me,ge)=>me!==Ae[ge])&&($.setOrientation(..._t),Ae=_t);const Ct=[c(Oe,Se,3),c(Oe,Se,4),c(Oe,Se,5)];Ct.some((me,ge)=>me!==Be[ge])&&($.setPosition(...Ct),Be=Ct)},Object.defineProperty(ne.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ie.gain,"defaultValue",{get:()=>0}),Object.defineProperty(G.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Z.gain,"defaultValue",{get:()=>0});const Pe={get bufferSize(){},get channelCount(){return $.channelCount},set channelCount(Oe){if(Oe>2)throw o();W.channelCount=Oe,$.channelCount=Oe},get channelCountMode(){return $.channelCountMode},set channelCountMode(Oe){if(Oe==="max")throw o();W.channelCountMode=Oe,$.channelCountMode=Oe},get channelInterpretation(){return $.channelInterpretation},set channelInterpretation(Oe){W.channelInterpretation=Oe,$.channelInterpretation=Oe},get coneInnerAngle(){return $.coneInnerAngle},set coneInnerAngle(Oe){$.coneInnerAngle=Oe},get coneOuterAngle(){return $.coneOuterAngle},set coneOuterAngle(Oe){$.coneOuterAngle=Oe},get coneOuterGain(){return $.coneOuterGain},set coneOuterGain(Oe){if(Oe<0||Oe>1)throw e();$.coneOuterGain=Oe},get context(){return $.context},get distanceModel(){return $.distanceModel},set distanceModel(Oe){$.distanceModel=Oe},get inputs(){return[W]},get maxDistance(){return $.maxDistance},set maxDistance(Oe){if(Oe<0)throw new RangeError;$.maxDistance=Oe},get numberOfInputs(){return $.numberOfInputs},get numberOfOutputs(){return $.numberOfOutputs},get orientationX(){return K.gain},get orientationY(){return ne.gain},get orientationZ(){return Q.gain},get panningModel(){return $.panningModel},set panningModel(Oe){$.panningModel=Oe},get positionX(){return ie.gain},get positionY(){return G.gain},get positionZ(){return Z.gain},get refDistance(){return $.refDistance},set refDistance(Oe){if(Oe<0)throw new RangeError;$.refDistance=Oe},get rolloffFactor(){return $.rolloffFactor},set rolloffFactor(Oe){if(Oe<0)throw new RangeError;$.rolloffFactor=Oe},addEventListener(...Oe){return W.addEventListener(Oe[0],Oe[1],Oe[2])},dispatchEvent(...Oe){return W.dispatchEvent(Oe[0])},removeEventListener(...Oe){return W.removeEventListener(Oe[0],Oe[1],Oe[2])}};d!==Pe.coneInnerAngle&&(Pe.coneInnerAngle=d),h!==Pe.coneOuterAngle&&(Pe.coneOuterAngle=h),f!==Pe.coneOuterGain&&(Pe.coneOuterGain=f),p!==Pe.distanceModel&&(Pe.distanceModel=p),g!==Pe.maxDistance&&(Pe.maxDistance=g),v!==Pe.orientationX.value&&(Pe.orientationX.value=v),E!==Pe.orientationY.value&&(Pe.orientationY.value=E),T!==Pe.orientationZ.value&&(Pe.orientationZ.value=T),C!==Pe.panningModel&&(Pe.panningModel=C),A!==Pe.positionX.value&&(Pe.positionX.value=A),k!==Pe.positionY.value&&(Pe.positionY.value=k),I!==Pe.positionZ.value&&(Pe.positionZ.value=I),N!==Pe.refDistance&&(Pe.refDistance=N),U!==Pe.rolloffFactor&&(Pe.rolloffFactor=U),(Ae[0]!==1||Ae[1]!==0||Ae[2]!==0)&&$.setOrientation(...Ae),(Be[0]!==0||Be[1]!==0||Be[2]!==0)&&$.setPosition(...Be);const we=()=>{W.connect($),t(W,ue,0,0),ue.connect(K).connect(q,0,0),ue.connect(ne).connect(q,0,1),ue.connect(Q).connect(q,0,2),ue.connect(ie).connect(q,0,3),ue.connect(G).connect(q,0,4),ue.connect(Z).connect(q,0,5),q.connect(se).connect(u.destination)},Te=()=>{W.disconnect($),a(W,ue,0,0),ue.disconnect(K),K.disconnect(q),ue.disconnect(ne),ne.disconnect(q),ue.disconnect(Q),Q.disconnect(q),ue.disconnect(ie),ie.disconnect(q),ue.disconnect(G),G.disconnect(q),ue.disconnect(Z),Z.disconnect(q),q.disconnect(se),se.disconnect(u.destination)};return l(rS(Pe,$),we,Te)},dHe=t=>(e,{disableNormalization:n,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,s,{disableNormalization:n});if(Array.from(r).length<2)throw t();return a},ix=(t,e,n,r)=>t.createScriptProcessor(e,n,r),hHe=(t,e)=>(n,r)=>{const i=r.channelCountMode;if(i==="clamped-max")throw e();if(n.createStereoPanner===void 0)return t(n,r);const s=n.createStereoPanner();return Fa(s,r),bo(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),s},fHe=(t,e,n,r,i,s)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},d=(p,g,v,E)=>{const T=new Float32Array(16385),C=new Float32Array(16385);for(let F=0;F<16385;F+=1){const $=F/16384*c;T[F]=Math.cos($),C[F]=Math.sin($)}const A=n(p,{...l,gain:0}),k=r(p,{...u,curve:T}),I=r(p,{...u,curve:a}),N=n(p,{...l,gain:0}),U=r(p,{...u,curve:C});return{connectGraph(){g.connect(A),g.connect(I.inputs===void 0?I:I.inputs[0]),g.connect(N),I.connect(v),v.connect(k.inputs===void 0?k:k.inputs[0]),v.connect(U.inputs===void 0?U:U.inputs[0]),k.connect(A.gain),U.connect(N.gain),A.connect(E,0,0),N.connect(E,0,1)},disconnectGraph(){g.disconnect(A),g.disconnect(I.inputs===void 0?I:I.inputs[0]),g.disconnect(N),I.disconnect(v),v.disconnect(k.inputs===void 0?k:k.inputs[0]),v.disconnect(U.inputs===void 0?U:U.inputs[0]),k.disconnect(A.gain),U.disconnect(N.gain),A.disconnect(E,0,0),N.disconnect(E,0,1)}}},h=(p,g,v,E)=>{const T=new Float32Array(16385),C=new Float32Array(16385),A=new Float32Array(16385),k=new Float32Array(16385),I=Math.floor(16385/2);for(let ie=0;ie<16385;ie+=1)if(ie>I){const G=(ie-I)/(16384-I)*c;T[ie]=Math.cos(G),C[ie]=Math.sin(G),A[ie]=0,k[ie]=1}else{const G=ie/(16384-I)*c;T[ie]=1,C[ie]=0,A[ie]=Math.cos(G),k[ie]=Math.sin(G)}const N=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),U=n(p,{...l,gain:0}),F=r(p,{...u,curve:T}),$=n(p,{...l,gain:0}),X=r(p,{...u,curve:C}),q=r(p,{...u,curve:a}),W=n(p,{...l,gain:0}),K=r(p,{...u,curve:A}),ne=n(p,{...l,gain:0}),Q=r(p,{...u,curve:k});return{connectGraph(){g.connect(N),g.connect(q.inputs===void 0?q:q.inputs[0]),N.connect(U,0),N.connect($,0),N.connect(W,1),N.connect(ne,1),q.connect(v),v.connect(F.inputs===void 0?F:F.inputs[0]),v.connect(X.inputs===void 0?X:X.inputs[0]),v.connect(K.inputs===void 0?K:K.inputs[0]),v.connect(Q.inputs===void 0?Q:Q.inputs[0]),F.connect(U.gain),X.connect($.gain),K.connect(W.gain),Q.connect(ne.gain),U.connect(E,0,0),W.connect(E,0,0),$.connect(E,0,1),ne.connect(E,0,1)},disconnectGraph(){g.disconnect(N),g.disconnect(q.inputs===void 0?q:q.inputs[0]),N.disconnect(U,0),N.disconnect($,0),N.disconnect(W,1),N.disconnect(ne,1),q.disconnect(v),v.disconnect(F.inputs===void 0?F:F.inputs[0]),v.disconnect(X.inputs===void 0?X:X.inputs[0]),v.disconnect(K.inputs===void 0?K:K.inputs[0]),v.disconnect(Q.inputs===void 0?Q:Q.inputs[0]),F.disconnect(U.gain),X.disconnect($.gain),K.disconnect(W.gain),Q.disconnect(ne.gain),U.disconnect(E,0,0),W.disconnect(E,0,0),$.disconnect(E,0,1),ne.disconnect(E,0,1)}}},f=(p,g,v,E,T)=>{if(g===1)return d(p,v,E,T);if(g===2)return h(p,v,E,T);throw i()};return(p,{channelCount:g,channelCountMode:v,pan:E,...T})=>{if(v==="max")throw i();const C=t(p,{...T,channelCount:1,channelCountMode:v,numberOfInputs:2}),A=n(p,{...T,channelCount:g,channelCountMode:v,gain:1}),k=n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:E});let{connectGraph:I,disconnectGraph:N}=f(p,g,A,k,C);Object.defineProperty(k.gain,"defaultValue",{get:()=>0}),Object.defineProperty(k.gain,"maxValue",{get:()=>1}),Object.defineProperty(k.gain,"minValue",{get:()=>-1});const U={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(q){A.channelCount!==q&&(F&&N(),{connectGraph:I,disconnectGraph:N}=f(p,q,A,k,C),F&&I()),A.channelCount=q},get channelCountMode(){return A.channelCountMode},set channelCountMode(q){if(q==="clamped-max"||q==="max")throw i();A.channelCountMode=q},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(q){A.channelInterpretation=q},get context(){return A.context},get inputs(){return[A]},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get pan(){return k.gain},addEventListener(...q){return A.addEventListener(q[0],q[1],q[2])},dispatchEvent(...q){return A.dispatchEvent(q[0])},removeEventListener(...q){return A.removeEventListener(q[0],q[1],q[2])}};let F=!1;const $=()=>{I(),F=!0},X=()=>{N(),F=!1};return s(rS(U,C),$,X)}},pHe=(t,e,n,r,i,s,o)=>(a,c)=>{const l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return n(a,c);Fa(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Ws(l,{curve:u},"curve"),Ws(l,c,"oversample");let d=null,h=!1;return o(l,"curve",g=>()=>g.call(l),g=>v=>(g.call(l,v),h&&(r(v)&&d===null?d=t(a,l):!r(v)&&d!==null&&(d(),d=null)),v)),i(l,()=>{h=!0,r(l.curve)&&(d=t(a,l))},()=>{h=!1,d!==null&&(d(),d=null)})},mHe=(t,e,n,r,i)=>(s,{curve:o,oversample:a,...c})=>{const l=s.createWaveShaper(),u=s.createWaveShaper();Fa(l,c),Fa(u,c);const d=n(s,{...c,gain:1}),h=n(s,{...c,gain:-1}),f=n(s,{...c,gain:1}),p=n(s,{...c,gain:-1});let g=null,v=!1,E=null;const T={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(k){d.channelCount=k,h.channelCount=k,l.channelCount=k,f.channelCount=k,u.channelCount=k,p.channelCount=k},get channelCountMode(){return l.channelCountMode},set channelCountMode(k){d.channelCountMode=k,h.channelCountMode=k,l.channelCountMode=k,f.channelCountMode=k,u.channelCountMode=k,p.channelCountMode=k},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(k){d.channelInterpretation=k,h.channelInterpretation=k,l.channelInterpretation=k,f.channelInterpretation=k,u.channelInterpretation=k,p.channelInterpretation=k},get context(){return l.context},get curve(){return E},set curve(k){if(k!==null&&k.length<2)throw e();if(k===null)l.curve=k,u.curve=k;else{const I=k.length,N=new Float32Array(I+2-I%2),U=new Float32Array(I+2-I%2);N[0]=k[0],U[0]=-k[I-1];const F=Math.ceil((I+1)/2),$=(I+1)/2-1;for(let X=1;X<F;X+=1){const q=X/F*$,W=Math.floor(q),K=Math.ceil(q);N[X]=W===K?k[W]:(1-(q-W))*k[W]+(1-(K-q))*k[K],U[X]=W===K?-k[I-1-W]:-((1-(q-W))*k[I-1-W])-(1-(K-q))*k[I-1-K]}N[F]=I%2===1?k[F-1]:(k[F-2]+k[F-1])/2,l.curve=N,u.curve=U}E=k,v&&(r(E)&&g===null?g=t(s,d):g!==null&&(g(),g=null))},get inputs(){return[d]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(k){l.oversample=k,u.oversample=k},addEventListener(...k){return d.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return d.dispatchEvent(k[0])},removeEventListener(...k){return d.removeEventListener(k[0],k[1],k[2])}};o!==null&&(T.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==T.oversample&&(T.oversample=a);const C=()=>{d.connect(l).connect(f),d.connect(h).connect(u).connect(p).connect(f),v=!0,r(E)&&(g=t(s,d))},A=()=>{d.disconnect(l),l.disconnect(f),d.disconnect(h),h.disconnect(u),u.disconnect(p),p.disconnect(f),v=!1,g!==null&&(g(),g=null)};return i(rS(T,f),C,A)},Nl=()=>new DOMException("","NotSupportedError"),gHe={numberOfChannels:1},vHe=(t,e,n,r,i)=>class extends t{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:d,sampleRate:h}={...gHe,...l},f=r(d,u,h);e(Kw,()=>Kw(f))||f.addEventListener("statechange",(()=>{let p=0;const g=v=>{this._state==="running"&&(p>0?(f.removeEventListener("statechange",g),v.stopImmediatePropagation(),this._waitForThePromiseToSettle(v)):p+=1)};return g})()),super(f,d),this._length=u,this._nativeOfflineAudioContext=f,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,cJ(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},_He={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},yHe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={..._He,...l},h=n(u,d),f=s(u),p=f?r():null,g=c.sampleRate/2;super(c,!1,h,p),this._detune=e(this,f,h.detune,153600,-153600),this._frequency=e(this,f,h.frequency,g,-g),this._nativeOscillatorNode=h,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&d.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=d.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){UE(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),eg(this)&&ex(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},bHe=(t,e,n,r,i)=>()=>{const s=new WeakMap;let o=null,a=null,c=null;const l=async(u,d)=>{let h=n(u);const f=Jc(h,d);if(!f){const p={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:o===null?void 0:o,type:h.type};h=e(d,p),a!==null&&h.start(a),c!==null&&h.stop(c)}return s.set(d,h),f?(await t(d,u.detune,h.detune),await t(d,u.frequency,h.frequency)):(await r(d,u.detune,h.detune),await r(d,u.frequency,h.frequency)),await i(u,d,h),h};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,d){const h=s.get(d);return h!==void 0?Promise.resolve(h):l(u,d)}}},EHe={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},SHe=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={...EHe,...l},h=n(u,d),f=s(u),p=f?r():null;super(c,!1,h,p),this._nativePannerNode=h,this._orientationX=e(this,f,h.orientationX,Cl,Jl),this._orientationY=e(this,f,h.orientationY,Cl,Jl),this._orientationZ=e(this,f,h.orientationZ,Cl,Jl),this._positionX=e(this,f,h.positionX,Cl,Jl),this._positionY=e(this,f,h.positionY,Cl,Jl),this._positionZ=e(this,f,h.positionZ,Cl,Jl),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},wHe=(t,e,n,r,i,s,o,a,c,l)=>()=>{const u=new WeakMap;let d=null;const h=async(f,p)=>{let g=null,v=s(f);const E={channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation},T={...E,coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,panningModel:v.panningModel,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor},C=Jc(v,p);if("bufferSize"in v)g=r(p,{...E,gain:1});else if(!C){const A={...T,orientationX:v.orientationX.value,orientationY:v.orientationY.value,orientationZ:v.orientationZ.value,positionX:v.positionX.value,positionY:v.positionY.value,positionZ:v.positionZ.value};v=i(p,A)}if(u.set(p,g===null?v:g),g!==null){if(d===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const X=new o(6,f.context.length,p.sampleRate),q=e(X,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});q.connect(X.destination),d=(async()=>{const W=await Promise.all([f.orientationX,f.orientationY,f.orientationZ,f.positionX,f.positionY,f.positionZ].map(async(K,ne)=>{const Q=n(X,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ne===0?1:0});return await a(X,K,Q.offset),Q}));for(let K=0;K<6;K+=1)W[K].connect(q,0,K),W[K].start(0);return l(X)})()}const A=await d,k=r(p,{...E,gain:1});await c(f,p,k);const I=[];for(let X=0;X<A.numberOfChannels;X+=1)I.push(A.getChannelData(X));let N=[I[0][0],I[1][0],I[2][0]],U=[I[3][0],I[4][0],I[5][0]],F=r(p,{...E,gain:1}),$=i(p,{...T,orientationX:N[0],orientationY:N[1],orientationZ:N[2],positionX:U[0],positionY:U[1],positionZ:U[2]});k.connect(F).connect($.inputs[0]),$.connect(g);for(let X=128;X<A.length;X+=128){const q=[I[0][X],I[1][X],I[2][X]],W=[I[3][X],I[4][X],I[5][X]];if(q.some((K,ne)=>K!==N[ne])||W.some((K,ne)=>K!==U[ne])){N=q,U=W;const K=X/p.sampleRate;F.gain.setValueAtTime(0,K),F=r(p,{...E,gain:0}),$=i(p,{...T,orientationX:N[0],orientationY:N[1],orientationZ:N[2],positionX:U[0],positionY:U[1],positionZ:U[2]}),F.gain.setValueAtTime(1,K),k.connect(F).connect($.inputs[0]),$.connect(g)}}return g}return C?(await t(p,f.orientationX,v.orientationX),await t(p,f.orientationY,v.orientationY),await t(p,f.orientationZ,v.orientationZ),await t(p,f.positionX,v.positionX),await t(p,f.positionY,v.positionY),await t(p,f.positionZ,v.positionZ)):(await a(p,f.orientationX,v.orientationX),await a(p,f.orientationY,v.orientationY),await a(p,f.orientationZ,v.orientationZ),await a(p,f.positionX,v.positionX),await a(p,f.positionY,v.positionY),await a(p,f.positionZ,v.positionZ)),nS(v)?await c(f,p,v.inputs[0]):await c(f,p,v),v};return{render(f,p){const g=u.get(p);return g!==void 0?Promise.resolve(g):h(f,p)}}},THe={disableNormalization:!1},xHe=(t,e,n,r)=>class _J{constructor(s,o){const a=e(s),c=r({...THe,...o}),l=t(a,c);return n.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===_J.prototype||n.has(s)}},CHe=(t,e)=>(n,r,i)=>(t(r).replay(i),e(r,n,i)),RHe=(t,e,n)=>async(r,i,s)=>{const o=t(r);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const h=await e(l).render(l,i),f=r.context.destination;!n(l)&&(r!==f||!n(r))&&h.connect(s,u,c)})).reduce((a,c)=>[...a,...c],[]))},AHe=(t,e,n)=>async(r,i,s)=>{const o=e(r);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await t(a).render(a,i);n(a)||u.connect(s,c)}))},MHe=(t,e,n,r)=>i=>t(Kw,()=>Kw(i))?Promise.resolve(t(r,r)).then(s=>{if(!s){const o=n(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),IHe=t=>(e,n)=>{t.set(e,n)},OHe=t=>(e,n)=>t.set(e,n),kHe=(t,e,n,r,i,s,o,a)=>(c,l)=>n(c).render(c,l).then(()=>Promise.all(Array.from(r(l)).map(u=>n(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),c3(u)):e(s,()=>s(u))||a(u),t.add(u),u)),NHe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},PHe=(t,e,n,r,i,s)=>class extends t{constructor(a,c){const l=i(a),u={...NHe,...c},d=n(l,u),h=s(l),f=h?r():null;super(a,!1,d,f),this._pan=e(this,h,d.pan)}get pan(){return this._pan}},DHe=(t,e,n,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=n(a);const u=Jc(l,c);if(!u){const d={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,d)}return s.set(c,l),u?await t(c,a.pan,l.pan):await r(c,a.pan,l.pan),nS(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},LHe=t=>()=>{if(t===null)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},UHe=(t,e)=>async()=>{if(t===null)return!0;if(e===null)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(n);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new t(r,"a",{numberOfOutputs:0}),c=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await r.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},FHe=(t,e)=>()=>{if(e===null)return Promise.resolve(!1);const n=new e(1,1,44100),r=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{n.oncomplete=()=>{r.disconnect(),i(n.currentTime!==0)},n.startRendering()})},BHe=()=>new DOMException("","UnknownError"),jHe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},$He=(t,e,n,r,i,s,o)=>class extends t{constructor(c,l){const u=i(c),d={...jHe,...l},h=n(u,d),p=s(u)?r():null;super(c,!0,h,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=h,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},HHe=(t,e,n)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!Jc(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(o,l)}return r.set(o,a),nS(a)?await n(s,o,a.inputs[0]):await n(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},VHe=()=>typeof window>"u"?null:window,zHe=(t,e)=>n=>{n.copyFromChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(a),u=r.length;for(let d=o<0?-o:0;d+o<c&&d<u;d+=1)r[d]=l[d+o]},n.copyToChannel=(r,i,s=0)=>{const o=t(s),a=t(i);if(a>=n.numberOfChannels)throw e();const c=n.length,l=n.getChannelData(a),u=r.length;for(let d=o<0?-o:0;d+o<c&&d<u;d+=1)l[d+o]=r[d]}},GHe=t=>e=>{e.copyFromChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(r,i,s=0)=>{const o=t(s),a=t(i);if(o<e.length)return n.call(e,r,a,o)})(e.copyToChannel)},qHe=t=>(e,n)=>{const r=n.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),t(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},WHe=(t,e)=>(n,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource();e(r,()=>{const a=r.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(r,0,c)},()=>i.disconnect(r))},yJ=(t,e,n)=>t.copyFromChannel===void 0?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),bJ=t=>{if(t===null)return!1;const e=t.length;return e%2!==0?t[Math.floor(e/2)]!==0:t[e/2-1]+t[e/2]!==0},sx=(t,e,n,r)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(s),set:r(o)})},KHe=t=>({...t,outputChannelCount:t.outputChannelCount!==void 0?t.outputChannelCount:t.numberOfInputs===1&&t.numberOfOutputs===1?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),YHe=t=>({...t,channelCount:t.numberOfOutputs}),XHe=t=>{const{imag:e,real:n}=t;return e===void 0?n===void 0?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,()=>0),real:n}:n===void 0?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:n}},EJ=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(r){if(r.code!==9)throw r;EJ(t,e,n+1e-7)}},JHe=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},QHe=t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},ZHe=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},f3=t=>{const e=t.createOscillator();try{e.start(-1)}catch(n){return n instanceof RangeError}return!1},SJ=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},p3=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(n){return n instanceof RangeError}return!1},e5e=t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}},t5e=t=>{t.start=(e=>(n=0,r=0,i)=>{const s=t.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})(t.start)},wJ=(t,e)=>{const n=e.createGain();t.connect(n);const r=(i=>()=>{i.call(t,n),t.removeEventListener("ended",r)})(t.disconnect);t.addEventListener("ended",r),rS(t,n),t.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(t,o)}catch{n.gain.setValueAtTime(0,o)}else i.call(t,o),s=!0}})(t.stop)},iS=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),typeof e=="function"?e.call(t,n):e.handleEvent.call(t,n)},n5e=S4e(wy),r5e=A4e(wy),i5e=jje(hk),TJ=new WeakMap,s5e=i$e(TJ),ef=gje(new Map,new WeakMap),yp=VHe(),xJ=P$e(ef,Np),m3=r$e(Rl),Rc=RHe(Rl,m3,iy),o5e=N4e(xJ,Us,Rc),Cs=a$e(dk),Tg=aHe(yp),ns=T$e(Tg),CJ=new WeakMap,RJ=Xje(iS),ox=F$e(yp),g3=b$e(ox),v3=E$e(yp),AJ=S$e(yp),Yw=j$e(yp),$o=ije(w4e(tJ),R4e(n5e,r5e,zR,i5e,GR,Rl,s5e,ZT,Us,wy,eg,iy,k1),ef,m$e(aU,GR,Rl,Us,Ww,eg),Np,fk,Nl,Lje(zR,aU,Rl,Us,Ww,Cs,eg,ns),Vje(CJ,Rl,Vh),RJ,Cs,g3,v3,AJ,ns,Yw),a5e=k4e($o,o5e,Np,xJ,Cs,ns),_3=new WeakSet,pz=D$e(yp),MJ=Mje(new Uint32Array(1)),y3=zHe(MJ,Np),b3=GHe(MJ),IJ=D4e(_3,ef,Nl,pz,Tg,LHe(pz),y3,b3),pk=M4e(pu),OJ=AHe(m3,tx,iy),Pp=wje(OJ),sS=U$e(pk,ef,JHe,QHe,ZHe,f3,SJ,p3,t5e,qHe(sx),wJ),Dp=CHe(s$e(tx),OJ),c5e=F4e(Pp,sS,Us,Dp,Rc),tf=sje(T4e(nJ),CJ,a3,oje,g4e,v4e,_4e,y4e,b4e,iU,ZX,ox,EJ),l5e=U4e($o,c5e,tf,ic,sS,Cs,ns,iS),u5e=W4e($o,K4e,Np,ic,B$e(pu,sx),Cs,ns,Rc),d5e=mje(Pp,gJ,Us,Dp,Rc),Ty=OHe(TJ),h5e=pje($o,tf,d5e,fk,gJ,Cs,ns,Ty),I_=k$e(wy,v3),f5e=WHe(ic,I_),O_=W$e(ox,f5e),p5e=yje(O_,Us,Rc),m5e=_je($o,p5e,O_,Cs,ns),g5e=Sje(rx,Us,Rc),v5e=Eje($o,g5e,rx,Cs,ns,YHe),_5e=X$e(pk,sS,pu,I_),oS=Y$e(pk,ef,_5e,f3,p3),y5e=Aje(Pp,oS,Us,Dp,Rc),b5e=Rje($o,tf,y5e,oS,Cs,ns,iS),kJ=J$e(Nl,sx),E5e=kje(kJ,Us,Rc),S5e=Oje($o,E5e,kJ,Cs,ns,Ty),w5e=Bje(Pp,vJ,Us,Dp,Rc),T5e=Fje($o,tf,w5e,vJ,Cs,ns,Ty),NJ=Q$e(Nl),x5e=Wje(Pp,NJ,Us,Dp,Rc),C5e=qje($o,tf,x5e,NJ,Nl,Cs,ns,Ty),R5e=t$e(Pp,pu,Us,Dp,Rc),A5e=e$e($o,tf,R5e,pu,Cs,ns),M5e=nHe(fk,ic,ix,Nl),mk=MHe(ef,pu,ix,FHe(pu,Tg)),I5e=p$e(sS,Us,Tg,Rc,mk),O5e=Z$e(M5e),k5e=h$e($o,O5e,I5e,Cs,ns,Ty),N5e=Y4e(tf,O_,oS,ix,Nl,yJ,ns,sx),PJ=new WeakMap,P5e=O$e(u5e,N5e,RJ,ns,PJ,iS),DJ=cHe(pk,ef,f3,SJ,p3,wJ),D5e=bHe(Pp,DJ,Us,Dp,Rc),L5e=yHe($o,tf,DJ,D5e,Cs,ns,iS),LJ=xje(sS),U5e=mHe(LJ,ic,pu,bJ,I_),gk=pHe(LJ,ic,U5e,bJ,I_,ox,sx),F5e=uHe(zR,ic,O_,pu,ix,gk,Nl,GR,yJ,I_),UJ=lHe(F5e),B5e=wHe(Pp,O_,oS,pu,UJ,Us,Tg,Dp,Rc,mk),j5e=SHe($o,tf,UJ,B5e,Cs,ns,Ty),$5e=dHe(Np),H5e=xHe($5e,Cs,new WeakSet,XHe),V5e=fHe(O_,rx,pu,gk,Nl,I_),FJ=hHe(V5e,Nl),z5e=DHe(Pp,FJ,Us,Dp,Rc),G5e=PHe($o,tf,FJ,z5e,Cs,ns),q5e=HHe(gk,Us,Rc),W5e=$He($o,ic,gk,q5e,Cs,ns,Ty),BJ=x$e(yp),E3=Jje(yp),jJ=new WeakMap,K5e=c$e(jJ,Tg),Y5e=BJ?C4e(ef,Nl,Yje(yp),E3,Qje(E4e),Cs,K5e,ns,Yw,new WeakMap,new WeakMap,UHe(Yw,Tg),yp):void 0,X5e=w$e(g3,ns),J5e=Dje(_3,ef,Pje,Kje,new WeakSet,Cs,X5e,HR,Kw,y3,b3),$J=hje(Y5e,a5e,IJ,l5e,h5e,m5e,v5e,b5e,S5e,J5e,T5e,C5e,A5e,k5e,P5e,L5e,j5e,H5e,G5e,W5e),Q5e=C$e($o,rHe,Cs,ns),Z5e=A$e($o,iHe,Cs,ns),eVe=M$e($o,sHe,Cs,ns),tVe=oHe(ic,ns),nVe=I$e($o,tVe,Cs),rVe=q4e($J,ic,Nl,BHe,Q5e,Z5e,eVe,nVe,ox),S3=l$e(PJ),iVe=I4e(S3),HJ=Tje(Np),sVe=$je(S3),VJ=zje(Np),zJ=new WeakMap,oVe=n$e(zJ,Vh),aVe=q$e(HJ,Np,ic,O_,rx,oS,pu,ix,Nl,VJ,E3,oVe,I_),cVe=H$e(ic,aVe,pu,Nl,I_),lVe=dje(Pp,HJ,sS,O_,rx,oS,pu,sVe,VJ,E3,Us,Yw,Tg,Dp,Rc,mk),uVe=o$e(jJ),dVe=IHe(zJ),mz=BJ?cje(iVe,$o,tf,lVe,cVe,Rl,uVe,Cs,ns,Yw,KHe,dVe,e5e,iS):void 0,hVe=Nje(Nl,Tg),fVe=kHe(_3,ef,m3,S3,mk,HR,y3,b3),pVe=vHe($J,ef,ic,hVe,fVe),mVe=g$e(dk,g3),gVe=v$e(o3,v3),vVe=_$e(a3,AJ),_Ve=y$e(dk,ns);function qu(t){return t===void 0}function ei(t){return t!==void 0}function yVe(t){return typeof t=="function"}function zh(t){return typeof t=="number"}function r_(t){return Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object}function GJ(t){return typeof t=="boolean"}function au(t){return Array.isArray(t)}function lg(t){return typeof t=="string"}function BC(t){return lg(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function or(t,e){if(!t)throw new Error(e)}function bp(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function qJ(t){!t.isOffline&&t.state!=="running"&&vk('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let WJ=!1,gz=!1;function vz(t){WJ=t}function bVe(t){qu(t)&&WJ&&!gz&&(gz=!0,vk("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let KJ=console;function EVe(...t){KJ.log(...t)}function vk(...t){KJ.warn(...t)}function SVe(t){return new rVe(t)}function wVe(t,e,n){return new pVe(t,e,n)}const Bu=typeof self=="object"?self:null,TVe=Bu&&(Bu.hasOwnProperty("AudioContext")||Bu.hasOwnProperty("webkitAudioContext"));function xVe(t,e,n){return or(ei(mz),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof(Bu==null?void 0:Bu.BaseAudioContext)?Bu==null?void 0:Bu.AudioWorkletNode:mz)(t,e,n)}var hU=function(t,e){return hU=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},hU(t,e)};function YJ(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");hU(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Rs(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function co(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function w3(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function _k(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function fU(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}class CVe{constructor(e,n,r,i){this._callback=e,this._type=n,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),n=URL.createObjectURL(e),r=new Worker(n);r.onmessage=this._callback.bind(this),this._worker=r}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var n;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((n=this._worker)===null||n===void 0||n.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function sy(t){return vVe(t)}function i_(t){return gVe(t)}function N1(t){return _Ve(t)}function Cb(t){return mVe(t)}function RVe(t){return t instanceof IJ}function AVe(t,e){return t==="value"||sy(e)||i_(e)||RVe(e)}function B0(t,...e){if(!e.length)return t;const n=e.shift();if(r_(t)&&r_(n))for(const r in n)AVe(r,n[r])?t[r]=n[r]:r_(n[r])?(t[r]||Object.assign(t,{[r]:{}}),B0(t[r],n[r])):Object.assign(t,{[r]:n[r]});return B0(t,...e)}function MVe(t,e){return t.length===e.length&&t.every((n,r)=>e[r]===n)}function xn(t,e,n=[],r){const i={},s=Array.from(e);if(r_(s[0])&&r&&!Reflect.has(s[0],r)&&(Object.keys(s[0]).some(a=>Reflect.has(t,a))||(B0(i,{[r]:s[0]}),n.splice(n.indexOf(r),1),s.shift())),s.length===1&&r_(s[0]))B0(i,s[0]);else for(let o=0;o<n.length;o++)ei(s[o])&&(i[n[o]]=s[o]);return B0(t,i)}function IVe(t){return t.constructor.getDefaults()}function dp(t,e){return qu(t)?e:t}function Xw(t,e){return e.forEach(n=>{Reflect.has(t,n)&&delete t[n]}),t}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class xg{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Bu&&this.toString()===Bu.TONE_DEBUG_CLASS)&&EVe(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}xg.version=QX;const T3=1e-6;function FE(t,e){return t>e+T3}function pU(t,e){return FE(t,e)||Ch(t,e)}function YR(t,e){return t+T3<e}function Ch(t,e){return Math.abs(t-e)<T3}function OVe(t,e,n){return Math.max(Math.min(t,n),e)}class Id extends xg{constructor(){super(),this.name="Timeline",this._timeline=[];const e=xn(Id.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(or(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const n=this._timeline[this.length-1];or(pU(e.time,n.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const n=this._search(e.time);this._timeline.splice(n+1,0,e)}if(this.length>this.memory){const n=this.length-this.memory;this._timeline.splice(0,n)}return this}remove(e){const n=this._timeline.indexOf(e);return n!==-1&&this._timeline.splice(n,1),this}get(e,n="time"){const r=this._search(e,n);return r!==-1?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,n="time"){const r=this._search(e,n);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(e){const n=this._timeline.length;if(n>0&&this._timeline[n-1].time<e)return this._timeline[n-1];const r=this._search(e);return r-1>=0?this._timeline[r-1]:null}cancel(e){if(this._timeline.length>1){let n=this._search(e);if(n>=0)if(Ch(this._timeline[n].time,e)){for(let r=n;r>=0&&Ch(this._timeline[r].time,e);r--)n=r;this._timeline=this._timeline.slice(0,n)}else this._timeline=this._timeline.slice(0,n+1);else this._timeline=[]}else this._timeline.length===1&&pU(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const n=this._search(e);return n>=0&&(this._timeline=this._timeline.slice(n+1)),this}previousEvent(e){const n=this._timeline.indexOf(e);return n>0?this._timeline[n-1]:null}_search(e,n="time"){if(this._timeline.length===0)return-1;let r=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][n]<=e)return i-1;for(;r<s;){let o=Math.floor(r+(s-r)/2);const a=this._timeline[o],c=this._timeline[o+1];if(Ch(a[n],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(Ch(u[n],e))o=l;else break}return o}else{if(YR(a[n],e)&&FE(c[n],e))return o;FE(a[n],e)?s=o:r=o+1}}return-1}_iterate(e,n=0,r=this._timeline.length-1){this._timeline.slice(n,r+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,n){const r=this._search(e);return r!==-1&&this._iterate(n,0,r),this}forEachAfter(e,n){const r=this._search(e);return this._iterate(n,r+1),this}forEachBetween(e,n,r){let i=this._search(e),s=this._search(n);return i!==-1&&s!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[s].time===n&&(s-=1),this._iterate(r,i,s)):i===-1&&this._iterate(r,0,s),this}forEachFrom(e,n){let r=this._search(e);for(;r>=0&&this._timeline[r].time>=e;)r--;return this._iterate(n,r+1),this}forEachAtTime(e,n){const r=this._search(e);if(r!==-1&&Ch(this._timeline[r].time,e)){let i=r;for(let s=r;s>=0&&Ch(this._timeline[s].time,e);s--)i=s;this._iterate(s=>{n(s)},i,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const XJ=[];function yk(t){XJ.push(t)}function kVe(t){XJ.forEach(e=>e(t))}const JJ=[];function bk(t){JJ.push(t)}function NVe(t){JJ.forEach(e=>e(t))}class ax extends xg{constructor(){super(...arguments),this.name="Emitter"}on(e,n){return e.split(/\W+/).forEach(i=>{qu(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(n)}),this}once(e,n){const r=(...i)=>{n(...i),this.off(e,r)};return this.on(e,r),this}off(e,n){return e.split(/\W+/).forEach(i=>{if(qu(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(qu(n))this._events[i]=[];else{const s=this._events[i];for(let o=s.length-1;o>=0;o--)s[o]===n&&s.splice(o,1)}}),this}emit(e,...n){if(this._events&&this._events.hasOwnProperty(e)){const r=this._events[e].slice(0);for(let i=0,s=r.length;i<s;i++)r[i].apply(this,n)}return this}static mixin(e){["on","once","off","emit"].forEach(n=>{const r=Object.getOwnPropertyDescriptor(ax.prototype,n);Object.defineProperty(e.prototype,n,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class QJ extends ax{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class cx extends QJ{constructor(){var e,n;super(),this.name="Context",this._constants=new Map,this._timeouts=new Id,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const r=xn(cx.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=SVe({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new CVe(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((n=arguments[0])===null||n===void 0)&&n.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(kVe(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,n,r){return this._context.createBuffer(e,n,r)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,n){return this._context.createIIRFilter(e,n)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,n,r){return this._context.createPeriodicWave(e,n,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return or(Cb(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return or(Cb(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return or(Cb(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){or(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){or(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){or(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){or(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,n){return xVe(this.rawContext,e,n)}addAudioWorkletModule(e){return co(this,void 0,void 0,function*(){or(ei(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return co(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Cb(this._context)?this._context.resume():Promise.resolve()}close(){return co(this,void 0,void 0,function*(){Cb(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&NVe(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const n=this._context.createBuffer(1,128,this._context.sampleRate),r=n.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=n,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();let n=this._timeouts.peek();for(;this._timeouts.length&&n&&n.time<=e;)n.callback(),this._timeouts.shift(),n=this._timeouts.peek()}setTimeout(e,n){this._timeoutIds++;const r=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:r+n}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(n=>{n.id===e&&this._timeouts.remove(n)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,n){const r=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),i()},id:r,time:s+n})};return i(),r}}class PVe extends QJ{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,n,r){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,n){return{}}createPanner(){return{}}createPeriodicWave(e,n,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,n){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return co(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,n){return 0}clearTimeout(e){return this}setInterval(e,n){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function ui(t,e){au(e)?e.forEach(n=>ui(t,n)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function lx(t,e){au(e)?e.forEach(n=>lx(t,n)):Object.defineProperty(t,e,{writable:!0})}const $i=()=>{};class zi extends xg{constructor(){super(),this.name="ToneAudioBuffer",this.onload=$i;const e=xn(zi.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,lg(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:$i,onload:$i,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:rc().sampleRate}set(e){return e instanceof zi?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return co(this,void 0,void 0,function*(){const n=zi.load(e).then(r=>{this.set(r),this.onload(this)});zi.downloads.push(n);try{yield n}finally{const r=zi.downloads.indexOf(n);zi.downloads.splice(r,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const n=au(e)&&e[0].length>0,r=n?e.length:1,i=n?e[0].length:e.length,s=rc(),o=s.createBuffer(r,i,s.sampleRate),a=!n&&r===1?[e]:e;for(let c=0;c<r;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(zh(e))this.fromArray(this.toArray(e));else{let n=new Float32Array(this.length);const r=this.numberOfChannels;for(let i=0;i<r;i++){const s=this.toArray(i);for(let o=0;o<s.length;o++)n[o]+=s[o]}n=n.map(i=>i/r),this.fromArray(n)}return this}toArray(e){if(zh(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const n=[];for(let r=0;r<this.numberOfChannels;r++)n[r]=this.getChannelData(r);return n}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,n=this.duration){or(this.loaded,"Buffer is not loaded");const r=Math.floor(e*this.sampleRate),i=Math.floor(n*this.sampleRate);or(r<i,"The start time must be less than the end time");const s=i-r,o=rc().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(r,i),a);return new zi(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new zi().fromArray(e)}static fromUrl(e){return co(this,void 0,void 0,function*(){return yield new zi().load(e)})}static load(e){return co(this,void 0,void 0,function*(){const n=e.match(/\[([^\]\[]+\|.+)\]$/);if(n){const c=n[1].split("|");let l=c[0];for(const u of c)if(zi.supportsType(u)){l=u;break}e=e.replace(n[0],l)}const r=zi.baseUrl===""||zi.baseUrl.endsWith("/")?zi.baseUrl:zi.baseUrl+"/",i=document.createElement("a");i.href=r+e,i.pathname=(i.pathname+i.hash).split("/").map(encodeURIComponent).join("/");const s=yield fetch(i.href);if(!s.ok)throw new Error(`could not load url: ${e}`);const o=yield s.arrayBuffer();return yield rc().decodeAudioData(o)})}static supportsType(e){const n=e.split("."),r=n[n.length-1];return document.createElement("audio").canPlayType("audio/"+r)!==""}static loaded(){return co(this,void 0,void 0,function*(){for(yield Promise.resolve();zi.downloads.length;)yield zi.downloads[0]})}}zi.baseUrl="";zi.downloads=[];class Ek extends cx{constructor(){super({clockSource:"offline",context:N1(arguments[0])?arguments[0]:wVe(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:N1(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=N1(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return co(this,void 0,void 0,function*(){let n=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,n++;const r=Math.floor(this.sampleRate/128);e&&n%r===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return co(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const n=yield this._context.startRendering();return new zi(n)})}close(){return Promise.resolve()}}const ZJ=new PVe;let O0=ZJ;function rc(){return O0===ZJ&&TVe&&DVe(new cx),O0}function DVe(t,e=!1){e&&O0.dispose(),Cb(t)?O0=new cx(t):N1(t)?O0=new Ek(t):O0=t}function LVe(){return O0.resume()}if(Bu&&!Bu.TONE_SILENCE_LOGGING){const e=` * Tone.js v${QX} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function UVe(t){return Math.pow(10,t/20)}function FVe(t){return 20*(Math.log(t)/Math.LN10)}function eQ(t){return Math.pow(2,t/12)}let Sk=440;function BVe(){return Sk}function jVe(t){Sk=t}function k0(t){return Math.round(tQ(t))}function tQ(t){return 69+12*Math.log2(t/Sk)}function nQ(t){return Sk*Math.pow(2,(t-69)/12)}class x3 extends xg{constructor(e,n,r){super(),this.defaultUnits="s",this._val=n,this._units=r,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,n)=>{const r=parseInt(e,10),i=n==="."?1.5:1;return r===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/r)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const n=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(n)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,n,r)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i+=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i+=this._beatsToUnits(parseFloat(r)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof x3&&this.fromType(this._val),qu(this._val))return this._noArg();if(lg(this._val)&&qu(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(r_(this._val)){let e=0;for(const n in this._val)if(ei(this._val[n])){const r=this._val[n],i=new this.constructor(this.context,n).valueOf()*r;e+=i}return e}if(ei(this._units)){const e=this._expressions[this._units],n=this._val.toString().trim().match(e.regexp);return n?e.method.apply(this,n.slice(1)):e.method.call(this,this._val)}else return lg(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Ad extends x3{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const n=new Ad(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(n))},regexp:/^@(.+)/}})}quantize(e,n=1){const r=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/r)*r-i;return i+a*n}toNotation(){const e=this.toSeconds(),n=["1m"];for(let s=1;s<9;s++){const o=Math.pow(2,s);n.push(o+"n."),n.push(o+"n"),n.push(o+"t")}n.push("0");let r=n[0],i=new Ad(this.context,n[0]).toSeconds();return n.forEach(s=>{const o=new Ad(this.context,s).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(r=s,i=o)}),r}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let n=this.valueOf()/e;n=parseFloat(n.toFixed(4));const r=Math.floor(n/this._getTimeSignature());let i=n%1*4;n=Math.floor(n)%this._getTimeSignature();const s=i.toString();return s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3))),[r,n,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return k0(this.toFrequency())}_now(){return this.context.now()}}function Ca(t,e){return new Ad(rc(),t,e)}class ru extends Ad{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return BVe()}static set A4(e){jVe(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:ru.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,n){const i=$Ve[e.toLowerCase()]+(parseInt(n,10)+1)*12;return this.defaultUnits==="midi"?i:ru.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,n,r){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),n&&n!=="0"&&(i*=this._beatsToUnits(parseFloat(n))),r&&r!=="0"&&(i*=this._beatsToUnits(parseFloat(r)/4)),i}}})}transpose(e){return new ru(this.context,this.valueOf()*eQ(e))}harmonize(e){return e.map(n=>this.transpose(n))}toMidi(){return k0(this.valueOf())}toNote(){const e=this.toFrequency(),n=Math.log2(e/ru.A4);let r=Math.round(12*n)+57;const i=Math.floor(r/12);return i<0&&(r+=-12*i),HVe[r%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),n=this.valueOf()/e;return Math.floor(n*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return nQ(e)}static ftom(e){return k0(e)}}const $Ve={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},HVe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function _z(t,e){return new ru(rc(),t,e)}class tE extends Ad{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class zc extends xg{constructor(){super();const e=xn(zc.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:rc()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return bVe(e),new Ad(this.context,e).toSeconds()}toFrequency(e){return new ru(this.context,e).toFrequency()}toTicks(e){return new tE(this.context,e).toTicks()}_getPartialProperties(e){const n=this.get();return Object.keys(n).forEach(r=>{qu(e[r])&&delete n[r]}),n}get(){const e=IVe(this);return Object.keys(e).forEach(n=>{if(Reflect.has(this,n)){const r=this[n];ei(r)&&ei(r.value)&&ei(r.setValueAtTime)?e[n]=r.value:r instanceof zc?e[n]=r._getPartialProperties(e[n]):au(r)||zh(r)||lg(r)||GJ(r)?e[n]=r:delete e[n]}}),e}set(e){return Object.keys(e).forEach(n=>{Reflect.has(this,n)&&ei(this[n])&&(this[n]&&ei(this[n].value)&&ei(this[n].setValueAtTime)?this[n].value!==e[n]&&(this[n].value=e[n]):this[n]instanceof zc?this[n].set(e[n]):this[n]=e[n])}),this}}class ux extends Id{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const n=this.get(e);return n!==null?n.state:this._initial}setStateAtTime(e,n,r){return bp(n,0),this.add(Object.assign({},r,{state:e,time:n})),this}getLastState(e,n){const r=this._search(n);for(let i=r;i>=0;i--){const s=this._timeline[i];if(s.state===e)return s}}getNextState(e,n){const r=this._search(n);if(r!==-1)for(let i=r;i<this._timeline.length;i++){const s=this._timeline[i];if(s.state===e)return s}}}class ri extends zc{constructor(){const e=xn(ri.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,or(ei(e.param)&&(sy(e.param)||e.param instanceof ri),"param must be an AudioParam");!sy(e.param);)e.param=e.param._param;this._swappable=ei(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Id(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,ei(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(zc.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return ei(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return ei(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,n){return this.units===n}_assertRange(e){return ei(this.maxValue)&&ei(this.minValue)&&bp(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?UVe(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?FVe(e):e}setValueAtTime(e,n){const r=this.toSeconds(n),i=this._fromType(e);return or(isFinite(i)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,r),this._events.add({time:r,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,r),this}getValueAtTime(e){const n=Math.max(this.toSeconds(e),0),r=this._events.getAfter(n),i=this._events.get(n);let s=this._initialValue;if(i===null)s=this._initialValue;else if(i.type==="setTargetAtTime"&&(r===null||r.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(s=this._exponentialApproach(i.time,a,i.value,i.constant,n))}else if(r===null)s=i.value;else if(r.type==="linearRampToValueAtTime"||r.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}r.type==="linearRampToValueAtTime"?s=this._linearInterpolate(i.time,o,r.time,r.value,n):s=this._exponentialInterpolate(i.time,o,r.time,r.value,n)}else s=i.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let n=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(n)===0&&(n=this._toType(this._minOutput)),this.setValueAtTime(n,e),this}linearRampToValueAtTime(e,n){const r=this._fromType(e),i=this.toSeconds(n);return or(isFinite(r)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._assertRange(r),this._events.add({time:i,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(r,i),this}exponentialRampToValueAtTime(e,n){let r=this._fromType(e);r=Ch(r,0)?this._minOutput:r,this._assertRange(r);const i=this.toSeconds(n);return or(isFinite(r)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(r,i),this}exponentialRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(e,r+this.toSeconds(n)),this}linearRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(e,r+this.toSeconds(n)),this}targetRampTo(e,n,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(e,r,n),this}exponentialApproachValueAtTime(e,n,r){n=this.toSeconds(n),r=this.toSeconds(r);const i=Math.log(r+1)/Math.log(200);return this.setTargetAtTime(e,n,i),this.cancelAndHoldAtTime(n+r*.9),this.linearRampToValueAtTime(e,n+r),this}setTargetAtTime(e,n,r){const i=this._fromType(e);or(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(n);return this._assertRange(i),or(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(n)}`),this._events.add({constant:r,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,s,r),this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(e,n,r,i=1){r=this.toSeconds(r),n=this.toSeconds(n);const s=this._fromType(e[0])*i;this.setValueAtTime(this._toType(s),n);const o=r/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),n+a*o)}return this}cancelScheduledValues(e){const n=this.toSeconds(e);return or(isFinite(n),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(n),this._param.cancelScheduledValues(n),this.log(this.units,"cancelScheduledValues",n),this}cancelAndHoldAtTime(e){const n=this.toSeconds(e),r=this._fromType(this.getValueAtTime(n));or(isFinite(n),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",n,"value="+r);const i=this._events.get(n),s=this._events.getAfter(n);return i&&Ch(i.time,n)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(n),this._events.cancel(n+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(r),n):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(r),n)),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}rampTo(e,n=.1,r){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,n,r):this.linearRampTo(e,n,r),this}apply(e){const n=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(n),n);const r=this._events.get(n);if(r&&r.type==="setTargetAtTime"){const i=this._events.getAfter(r.time),s=i?i.time:n+2,o=(s-n)/10;for(let a=n;a<s;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){or(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const n=this.input;return n.disconnect(this._param),this.apply(e),this._param=e,n.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,n,r,i,s){return r+(n-r)*Math.exp(-(s-e)/i)}_linearInterpolate(e,n,r,i,s){return n+(i-n)*((s-e)/(r-e))}_exponentialInterpolate(e,n,r,i,s){return n*Math.pow(i/n,(s-e)/(r-e))}}class On extends zc{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return ei(this.input)?sy(this.input)||this.input instanceof ri?1:this.input.numberOfInputs:0}get numberOfOutputs(){return ei(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return ei(e)&&(e instanceof On||i_(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(r=>{r.channelCount=e.channelCount,r.channelCountMode=e.channelCountMode,r.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();or(e.length>0,"ToneAudioNode does not have any internal nodes");const n=e[0];return{channelCount:n.channelCount,channelCountMode:n.channelCountMode,channelInterpretation:n.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelInterpretation:e}))}connect(e,n=0,r=0){return Gh(this,e,n,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return vk("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,n=0,r=0){return rQ(this,e,n,r),this}chain(...e){return oy(this,...e),this}fan(...e){return e.forEach(n=>this.connect(n)),this}dispose(){return super.dispose(),ei(this.input)&&(this.input instanceof On?this.input.dispose():i_(this.input)&&this.input.disconnect()),ei(this.output)&&(this.output instanceof On?this.output.dispose():i_(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function oy(...t){const e=t.shift();t.reduce((n,r)=>(n instanceof On?n.connect(r):i_(n)&&Gh(n,r),r),e)}function Gh(t,e,n=0,r=0){for(or(ei(t),"Cannot connect from undefined node"),or(ei(e),"Cannot connect to undefined node"),(e instanceof On||i_(e))&&or(e.numberOfInputs>0,"Cannot connect to node with no inputs"),or(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof On||e instanceof ri;)ei(e.input)&&(e=e.input);for(;t instanceof On;)ei(t.output)&&(t=t.output);sy(e)?t.connect(e,n):t.connect(e,n,r)}function rQ(t,e,n=0,r=0){if(ei(e))for(;e instanceof On;)e=e.input;for(;!i_(t);)ei(t.output)&&(t=t.output);sy(e)?t.disconnect(e,n):i_(e)?t.disconnect(e,n,r):t.disconnect()}class ii extends On{constructor(){const e=xn(ii.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new ri({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),ui(this,"gain")}static getDefaults(){return Object.assign(On.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class BE extends On{constructor(e){super(e),this.onended=$i,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ii({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(n){const r=this.toSeconds(n);return this._startTime!==-1&&r>=this._startTime&&(this._stopTime===-1||r<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(On.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:$i})}_startGain(e,n=1){or(this._startTime===-1,"Source cannot be started more than once");const r=this.toSeconds(this._fadeIn);return this._startTime=e+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(n,e+r):this._gainNode.gain.exponentialApproachValueAtTime(n,e,r)):this._gainNode.gain.setValueAtTime(n,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){or(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const n=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+n,this._stopTime=Math.max(this._stopTime,this.now()),n>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,n,e):this._gainNode.gain.targetRampTo(0,n,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const r=this._curve==="exponential"?n*2:0;this._stopSource(this.now()+r),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==$i&&(this.onended(this),this.onended=$i,!this.context.isOffline)){const e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),or(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=$i,this}}class C3 extends BE{constructor(){const e=xn(C3.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Gh(this._source,this._gainNode),this.offset=new ri({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(BE.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._source.start(n),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ji extends On{constructor(){const e=xn(ji.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new C3({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(On.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,n=0,r=0){return wk(this,e,n,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,n){return this._param.setValueAtTime(e,n),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,n){return this._param.linearRampToValueAtTime(e,n),this}exponentialRampToValueAtTime(e,n){return this._param.exponentialRampToValueAtTime(e,n),this}exponentialRampTo(e,n,r){return this._param.exponentialRampTo(e,n,r),this}linearRampTo(e,n,r){return this._param.linearRampTo(e,n,r),this}targetRampTo(e,n,r){return this._param.targetRampTo(e,n,r),this}exponentialApproachValueAtTime(e,n,r){return this._param.exponentialApproachValueAtTime(e,n,r),this}setTargetAtTime(e,n,r){return this._param.setTargetAtTime(e,n,r),this}setValueCurveAtTime(e,n,r,i){return this._param.setValueCurveAtTime(e,n,r,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,n,r){return this._param.rampTo(e,n,r),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function wk(t,e,n,r){(e instanceof ri||sy(e)||e instanceof ji&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ji&&(e.overridden=!0)),Gh(t,e,n,r)}class R3 extends ri{constructor(){const e=xn(R3.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Id(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ri.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,n,r){n=this.toSeconds(n),this.setRampPoint(n);const i=this._fromType(e),s=this._events.get(n),o=Math.round(Math.max(1/r,1));for(let a=0;a<=o;a++){const c=r*a+n,l=this._exponentialApproach(s.time,s.value,i,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,n){const r=this.toSeconds(n);super.setValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,n){const r=this.toSeconds(n);super.linearRampToValueAtTime(e,n);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,n){n=this.toSeconds(n);const r=this._fromType(e),i=this._events.get(n),s=Math.round(Math.max((n-i.time)*10,1)),o=(n-i.time)/s;for(let a=0;a<=s;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,n,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,n){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(qu(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const r=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(n));const s=this._events.get(n);return s&&s.time===n&&s.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(n-this.sampleTime))),.5*(n-e.time)*(r+i)+e.ticks}getTicksAtTime(e){const n=this.toSeconds(e),r=this._events.get(n);return Math.max(this._getTicksUntilEvent(r,n),0)}getDurationOfTicks(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(n);return this.getTimeOfTick(i+e)-r}getTimeOfTick(e){const n=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(n&&n.ticks===e)return n.time;if(n&&r&&r.type==="linearRampToValueAtTime"&&n.value!==r.value){const i=this._fromType(this.getValueAtTime(n.time)),o=(this._fromType(this.getValueAtTime(r.time))-i)/(r.time-n.time),a=Math.sqrt(Math.pow(i,2)-2*o*(n.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+n.time}else return n?n.value===0?1/0:n.time+(e-n.ticks)/n.value:e/this._initialValue}ticksToTime(e,n){return this.getDurationOfTicks(e,n)}timeToTicks(e,n){const r=this.toSeconds(n),i=this.toSeconds(e),s=this.getTicksAtTime(r);return this.getTicksAtTime(r+i)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const n=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(n,0)}}class A3 extends ji{constructor(){const e=xn(A3.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new R3({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ji.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,n){return this._param.ticksToTime(e,n)}timeToTicks(e,n){return this._param.timeToTicks(e,n)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,n){return this._param.getDurationOfTicks(e,n)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class M3 extends zc{constructor(){const e=xn(M3.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new ux,this._tickOffset=new Id,this._ticksAtTime=new Id,this._secondsAtTime=new Id,this.frequency=new A3({context:this.context,units:e.units,value:e.frequency}),ui(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},zc.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,n){const r=this.toSeconds(e);return this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),ei(n)&&this.setTicksAtTime(n,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(e){const n=this.toSeconds(e);if(this._state.getValueAtTime(n)==="stopped"){const r=this._state.get(n);r&&r.time>0&&(this._tickOffset.cancel(r.time),this._state.cancel(r.time))}return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this.setTicksAtTime(0,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const n=this.toSeconds(e),r=this._state.getLastState("stopped",n),i=this._ticksAtTime.get(n),s={state:"paused",time:n};this._state.add(s);let o=i||r,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,n+this.sampleTime,l=>{let u=o.time;const d=this._tickOffset.get(l.time);d&&d.time>=o.time&&(a=d.ticks,u=d.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const n=this.now(),r=this.frequency.timeToTicks(e,n);this.setTicksAtTime(r,n)}getSecondsAtTime(e){e=this.toSeconds(e);const n=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);const i=this._secondsAtTime.get(e);let s=i||n,o=i?i.seconds:0,a=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time;const u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(o=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==r.time&&(a={state:c.state,time:c.time,seconds:o})),s=c}),this._state.remove(r),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,n){return n=this.toSeconds(n),this._tickOffset.cancel(n),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,n),ticks:e,time:n}),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,n=this.now()){const r=this._tickOffset.get(n),i=this._state.get(n),s=Math.max(r.time,i.time),o=this.frequency.getTicksAtTime(s)+e-r.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,n,r){let i=this._state.get(e);this._state.forEachBetween(e,n,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,r),i=o});let s=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=Ch(u,1)?0:u;let d=this.frequency.getTimeOfTick(a+u);for(;d<n;){try{r(d,Math.round(this.getTicksAtTime(d)))}catch(h){s=h;break}d+=this.frequency.getDurationOfTicks(1,d)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class Tk extends zc{constructor(){const e=xn(Tk.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=$i,this._lastUpdate=0,this._state=new ux("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new M3({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,ui(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(zc.getDefaults(),{callback:$i,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,n){qJ(this.context);const r=this.toSeconds(e);return this.log("start",r),this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,n),r<this._lastUpdate&&this.emit("start",r,n)),this}stop(e){const n=this.toSeconds(e);return this.log("stop",n),this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._tickSource.stop(n),n<this._lastUpdate&&this.emit("stop",n),this}pause(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._tickSource.pause(n),n<this._lastUpdate&&this.emit("pause",n)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,n){return this._tickSource.setTicksAtTime(e,n),this}getTimeOfTick(e,n=this.now()){return this._tickSource.getTimeOfTick(e,n)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,n){const r=this.toSeconds(n),i=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(i+e,r)}_loop(){const e=this._lastUpdate,n=this.now();this._lastUpdate=n,this.log("loop",e,n),e!==n&&(this._state.forEachBetween(e,n,r=>{switch(r.state){case"started":const i=this._tickSource.getTicksAtTime(r.time);this.emit("start",r.time,i);break;case"stopped":r.time!==0&&this.emit("stop",r.time);break;case"paused":this.emit("pause",r.time);break}}),this._tickSource.forEachTickBetween(e,n,(r,i)=>{this.callback(r,i)}))}getStateAtTime(e){const n=this.toSeconds(e);return this._state.getValueAtTime(n)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}ax.mixin(Tk);class jE extends On{constructor(){const e=xn(jE.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const n=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(n,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(n),this.delayTime=new ri({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),ui(this,"delayTime")}static getDefaults(){return Object.assign(On.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Mh extends On{constructor(){const e=xn(Mh.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new ii({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,ui(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(On.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class I3 extends On{constructor(){const e=xn(I3.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Mh({context:this.context}),this.output=new ii({context:this.context}),this.volume=this.input.volume,oy(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(On.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),oy(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}yk(t=>{t.destination=new I3({context:t})});bk(t=>{t.destination.dispose()});class VVe extends On{constructor(){super(...arguments),this.name="Listener",this.positionX=new ri({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ri({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ri({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ri({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ri({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ri({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ri({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ri({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ri({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(On.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}yk(t=>{t.listener=new VVe({context:t})});bk(t=>{t.listener.dispose()});class O3 extends xg{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=xn(O3.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(n=>{this._loadingCount++;const r=e.urls[n];this.add(n,r,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:$i,onload:$i,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return or(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,n])=>n.loaded)}add(e,n,r=$i,i=$i){return lg(n)?(this.baseUrl&&n.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new zi(this.baseUrl+n,r,i))):this._buffers.set(e.toString(),new zi(n,r,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class XR extends ru{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return k0(super._frequencyToUnits(e))}_ticksToUnits(e){return k0(super._ticksToUnits(e))}_beatsToUnits(e){return k0(super._beatsToUnits(e))}_secondsToUnits(e){return k0(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return nQ(this.toMidi())}transpose(e){return new XR(this.context,this.toMidi()+e)}}class Ia extends tE{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class zVe extends zc{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Id,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,n){return this._events.add({callback:e,time:this.toSeconds(n)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const n=this._events.shift();n&&e-n.time<=this.expiration&&n.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}yk(t=>{t.draw=new zVe({context:t})});bk(t=>{t.draw.dispose()});class GVe extends xg{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){or(ei(e.time),"Events must have a time property"),or(ei(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let n=new qVe(e.time,e.time+e.duration,e);for(this._root===null?this._root=n:this._root.insert(n),this._length++;n!==null;)n.updateHeight(),n.updateMax(),this._rebalance(n),n=n.parent;return this}remove(e){if(this._root!==null){const n=[];this._root.search(e.time,n);for(const r of n)if(r.event===e){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,n=>this.remove(n)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,n){e.parent!==null?(e.isLeftChild()?e.parent.left=n:e.parent.right=n,this._rebalance(e.parent)):this._setRoot(n)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const n=e.getBalance();let r,i=null;if(n>0)if(e.left.right===null)r=e.left,r.right=e.right,i=r;else{for(r=e.left.right;r.right!==null;)r=r.right;r.parent&&(r.parent.right=r.left,i=r.parent,r.left=e.left,r.right=e.right)}else if(e.right.left===null)r=e.right,r.left=e.left,i=r;else{for(r=e.right.left;r.left!==null;)r=r.left;r.parent&&(r.parent.left=r.right,i=r.parent,r.left=e.left,r.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=r:e.parent.right=r:this._setRoot(r),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const n=e.parent,r=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rotateRight(e){const n=e.parent,r=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),n!==null?r?n.left=i:n.right=i:this._setRoot(i)}_rebalance(e){const n=e.getBalance();n>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):n<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const n=[];if(this._root.search(e,n),n.length>0){let r=n[0];for(let i=1;i<n.length;i++)n[i].low>r.low&&(r=n[i]);return r.event}}return null}forEach(e){if(this._root!==null){const n=[];this._root.traverse(r=>n.push(r)),n.forEach(r=>{r.event&&e(r.event)})}return this}forEachAtTime(e,n){if(this._root!==null){const r=[];this._root.search(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}forEachFrom(e,n){if(this._root!==null){const r=[];this._root.searchAfter(e,r),r.forEach(i=>{i.event&&n(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class qVe{constructor(e,n,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=e,this.high=n,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,n){e>this.max||(this.left!==null&&this.left.search(e,n),this.low<=e&&this.high>e&&n.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,n))}searchAfter(e,n){this.low>=e&&(n.push(this),this.left!==null&&this.left.searchAfter(e,n)),this.right!==null&&this.right.searchAfter(e,n)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class WVe extends xg{constructor(e){super(),this.name="TimelineValue",this._timeline=new Id({memory:10}),this._initialValue=e}set(e,n){return this._timeline.add({value:e,time:n}),this}get(e){const n=this._timeline.get(e);return n?n.value:this._initialValue}}class Ep extends On{constructor(){super(xn(Ep.getDefaults(),arguments,["context"]))}connect(e,n=0,r=0){return wk(this,e,n,r),this}}class xy extends Ep{constructor(){const e=xn(xy.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,au(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):yVe(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ji.getDefaults(),{length:1024})}setMap(e,n=1024){const r=new Float32Array(n);for(let i=0,s=n;i<s;i++){const o=i/(s-1)*2-1;r[i]=e(o,i)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const n=["none","2x","4x"].some(r=>r.includes(e));or(n,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class k3 extends Ep{constructor(){const e=xn(k3.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new xy({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Ep.getDefaults(),{value:1})}_expFunc(e){return n=>Math.pow(Math.abs(n),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class __{constructor(e,n){this.id=__._eventId++,this._remainderTime=0;const r=Object.assign(__.getDefaults(),n);this.transport=e,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:$i,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const n=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*n),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}__._eventId=0;class N3 extends __{constructor(e,n){super(e,n),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const r=Object.assign(N3.getDefaults(),n);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},__.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return YR(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Ia(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){YR(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ia(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const n=this.transport.getTicksAtTime(e);FE(n,this.time)&&(this._nextTick=this.floatTime+Math.ceil((n-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class xk extends zc{constructor(){const e=xn(xk.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new WVe(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Id,this._repeatedEvents=new GVe,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new Tk({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),ui(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(zc.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,n){if(this._loop.get(e)&&n>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),n=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&n%this._ppq!==0&&n%(this._swingTicks*2)!==0){const r=n%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(r*Math.PI)*this._swingAmount;e+=new Ia(this.context,this._swingTicks*2/3).toSeconds()*i}vz(!0),this._timeline.forEachAtTime(n,r=>r.invoke(e)),vz(!1)}schedule(e,n){const r=new __(this,{callback:e,time:new tE(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(e,n,r,i=1/0){const s=new N3(this,{callback:e,duration:new Ad(this.context,i).toTicks(),interval:new Ad(this.context,n).toTicks(),time:new tE(this.context,r).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,n){const r=new __(this,{callback:e,once:!0,time:new tE(this.context,n).toTicks()});return this._addEvent(r,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const n=this._scheduledEvents[e.toString()];n.timeline.remove(n.event),n.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,n){return this._scheduledEvents[e.id.toString()]={event:e,timeline:n},n.add(e),e.id}cancel(e=0){const n=this.toTicks(e);return this._timeline.forEachFrom(n,r=>this.clear(r.id)),this._repeatedEvents.forEachFrom(n,r=>this.clear(r.id)),this}_bindClockEvents(){this._clock.on("start",(e,n)=>{n=new Ia(this.context,n).toSeconds(),this.emit("start",e,n)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,n){this.context.resume();let r;return ei(n)&&(r=this.toTicks(n)),this._clock.start(e,r),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){au(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Ad(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Ad(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Ia(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),n=this._clock.getTicksAtTime(e);return new Ia(this.context,n).toBarsBeatsSixteenths()}set position(e){const n=this.toTicks(e);this.ticks=n}get seconds(){return this._clock.seconds}set seconds(e){const n=this.now(),r=this._clock.frequency.timeToTicks(e,n);this.ticks=r}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const n=this.now();if(this.state==="started"){const r=this._clock.getTicksAtTime(n),i=this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,n),s=n+i;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",n),this._clock.setTicksAtTime(e,n)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const n=this.now(),r=this.getTicksAtTime(n),i=e-r%e;return this._clock.nextTickTime(i,n)}}syncSignal(e,n){const r=this.now();let i=this.bpm,s=1/(60/i.getValueAtTime(r)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/s,l=new ii(c),u=new k3(-1),d=new ii(c);i.chain(l,u,d),i=d,s=1/s,o=[l,u,d]}n||(e.getValueAtTime(r)!==0?n=e.getValueAtTime(r)/s:n=0);const a=new ii(n);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let n=this._syncedSignals.length-1;n>=0;n--){const r=this._syncedSignals[n];r.signal===e&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(n,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),lx(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}ax.mixin(xk);yk(t=>{t.transport=new xk({context:t})});bk(t=>{t.transport.dispose()});class Kc extends On{constructor(e){super(e),this.input=void 0,this._state=new ux("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=$i,this._syncedStop=$i,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Mh({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,ui(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(On.getDefaults(),{mute:!1,onstop:$i,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,n,r){let i=qu(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")or(FE(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,n,r);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const s=this._state.get(i);s&&(s.offset=this.toSeconds(dp(n,0)),s.duration=r?this.toSeconds(r):void 0);const o=this.context.transport.schedule(a=>{this._start(a,n,r)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else qJ(this.context),this._start(i,n,r);return this}stop(e){let n=qu(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(n=this._clampToCurrentTime(n),this._state.getValueAtTime(n)==="started"||ei(this._state.getNextState("started",n))){if(this.log("stop",n),!this._synced)this._stop(n);else{const r=this.context.transport.schedule(this._stop.bind(this),n);this._scheduled.push(r)}this._state.cancel(n),this._state.setStateAtTime("stopped",n)}return this}restart(e,n,r){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,n,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,n)=>{if(FE(n,0)){const r=this._state.get(n);if(r&&r.state==="started"&&r.time!==n){const i=n-this.toSeconds(r.time);let s;r.duration&&(s=this.toSeconds(r.duration)-i),this._start(e,this.toSeconds(r.offset)+i,s)}}},this._syncedStop=e=>{const n=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(n)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=$i,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class dx extends BE{constructor(){const e=xn(dx.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Gh(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ri({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new zi(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(BE.getDefaults(),{url:new zi,loop:!1,loopEnd:0,loopStart:0,onload:$i,onerror:$i,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,n,r,i=1){or(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,i),this.loop?n=dp(n,this.loopStart):n=dp(n,0);let o=Math.max(this.toSeconds(n),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;pU(o,a)&&(o=(o-c)%l+c),Ch(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,YR(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,o)),ei(r)){let a=this.toSeconds(r);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class $E extends Kc{constructor(){const e=xn($E.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Kc.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(or(e in yz,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const n=this.now();this._stop(n),this._start(n)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const n=yz[this._type];this._source=new dx({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const mb=44100*5,VP=2,Dm={brown:null,pink:null,white:null},yz={get brown(){if(!Dm.brown){const t=[];for(let e=0;e<VP;e++){const n=new Float32Array(mb);t[e]=n;let r=0;for(let i=0;i<mb;i++){const s=Math.random()*2-1;n[i]=(r+.02*s)/1.02,r=n[i],n[i]*=3.5}}Dm.brown=new zi().fromArray(t)}return Dm.brown},get pink(){if(!Dm.pink){const t=[];for(let e=0;e<VP;e++){const n=new Float32Array(mb);t[e]=n;let r,i,s,o,a,c,l;r=i=s=o=a=c=l=0;for(let u=0;u<mb;u++){const d=Math.random()*2-1;r=.99886*r+d*.0555179,i=.99332*i+d*.0750759,s=.969*s+d*.153852,o=.8665*o+d*.3104856,a=.55*a+d*.5329522,c=-.7616*c-d*.016898,n[u]=r+i+s+o+a+c+l+d*.5362,n[u]*=.11,l=d*.115926}}Dm.pink=new zi().fromArray(t)}return Dm.pink},get white(){if(!Dm.white){const t=[];for(let e=0;e<VP;e++){const n=new Float32Array(mb);t[e]=n;for(let r=0;r<mb;r++)n[r]=Math.random()*2-1}Dm.white=new zi().fromArray(t)}return Dm.white}};function Cy(t,e){return co(this,void 0,void 0,function*(){const n=e/t.context.sampleRate,r=new Ek(1,n,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:r})).toDestination().start(0),(yield r.render()).getChannelData(0)})}class P3 extends BE{constructor(){const e=xn(P3.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Gh(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new ri({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new ri({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),ui(this,["frequency","detune"])}static getDefaults(){return Object.assign(BE.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const n=this.toSeconds(e);return this.log("start",n),this._startGain(n),this._oscillator.start(n),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Eo extends Kc{constructor(){const e=xn(Eo.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new ji({context:this.context,units:"frequency",value:e.frequency}),ui(this,"frequency"),this.detune=new ji({context:this.context,units:"cents",value:e.detune}),ui(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Kc.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const n=this.toSeconds(e),r=new P3({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}_stop(e){const n=this.toSeconds(e);this._oscillator&&this._oscillator.stop(n)}_restart(e){const n=this.toSeconds(e);return this.log("restart",n),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(n),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Eo._periodicWaveCache.find(n=>n.phase===this._phase&&MVe(n.partials,this._partials));{const e=Eo._periodicWaveCache.find(n=>n.type===this._type&&n.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const n=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&n)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const r=this._getCachedPeriodicWave();if(ei(r)){const{partials:i,wave:s}=r;this._wave=s,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,s]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,s);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Eo._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Eo._periodicWaveCache.length>100&&Eo._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){bp(e,0);let n=this._type;const r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(n=r[1]),this._type!=="custom")e===0?this.type=n:this.type=n+e.toString();else{const i=new Float32Array(e);this._partials.forEach((s,o)=>i[o]=s),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,n){let i=2048;const s=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[s,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(s[c]=-u*Math.sin(n*c),o[c]=u*Math.cos(n*c)):(s[c]=0,o[c]=0)}return[s,o]}_inverseFFT(e,n,r){let i=0;const s=e.length;for(let o=0;o<s;o++)i+=e[o]*Math.cos(o*r)+n[o]*Math.sin(o*r);return i}getInitialValue(){const[e,n]=this._getRealImaginary(this._type,0);let r=0;const i=Math.PI*2,s=32;for(let o=0;o<s;o++)r=Math.max(this._inverseFFT(e,n,o/s*i),r);return OVe(-this._inverseFFT(e,n,this._phase)/r,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return co(this,arguments,void 0,function*(e=1024){return Cy(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Eo._periodicWaveCache=[];class iQ extends Ep{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new xy({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class ay extends ji{constructor(){const e=xn(ay.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new ii({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ji.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Ck extends Kc{constructor(){const e=xn(Ck.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new iQ({context:this.context}),this._modulationNode=new ii({context:this.context}),this._carrier=new Eo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Eo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new ay({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),ui(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Eo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return co(this,arguments,void 0,function*(e=1024){return Cy(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Rk extends Kc{constructor(){const e=xn(Rk.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new ii({context:this.context,gain:0}),this._carrier=new Eo({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ji({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Eo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new ay({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new ay({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),ui(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Eo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return co(this,arguments,void 0,function*(e=1024){return Cy(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class hx extends Kc{constructor(){const e=xn(hx.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new ii({context:this.context,gain:0}),this._thresh=new xy({context:this.context,mapping:n=>n<=0?-1:1}),this.width=new ji({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Eo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),ui(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Kc.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return co(this,arguments,void 0,function*(e=1024){return Cy(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Ak extends Kc{constructor(){const e=xn(Ak.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new ji({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ji({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,ui(this,["frequency","detune"])}static getDefaults(){return Object.assign(Eo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(n=>n.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(n=>n.stop(e))}_restart(e){this._forEach(n=>n.restart(e))}_forEach(e){for(let n=0;n<this._oscillators.length;n++)e(this._oscillators[n],n)}get type(){return this._type}set type(e){this._type=e,this._forEach(n=>n.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const n=-e/2,r=e/(this._oscillators.length-1);this._forEach((i,s)=>i.detune.value=n+r*s)}}get count(){return this._oscillators.length}set count(e){if(bp(e,1),this._oscillators.length!==e){this._forEach(n=>n.dispose()),this._oscillators=[];for(let n=0;n<e;n++){const r=new Eo({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+n/e*360,partialCount:this._partialCount,onstop:n===0?()=>this.onstop(this):$i});this.type==="custom"&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state==="started"&&this._forEach(n=>n.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((n,r)=>n.phase=this._phase+r/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(n=>n.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(n=>n.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(n=>n.partialCount=e),this._type=this._oscillators[0].type}asArray(){return co(this,arguments,void 0,function*(e=1024){return Cy(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class Mk extends Kc{constructor(){const e=xn(Mk.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new ay({context:this.context,value:2}),this._pulse=new hx({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Eo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),ui(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Kc.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return co(this,arguments,void 0,function*(e=1024){return Cy(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const bz={am:Ck,fat:Ak,fm:Rk,oscillator:Eo,pulse:hx,pwm:Mk};class JR extends Kc{constructor(){const e=xn(JR.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new ji({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ji({context:this.context,units:"cents",value:e.detune}),ui(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Eo.getDefaults(),Rk.getDefaults(),Ck.getDefaults(),Ak.getDefaults(),hx.getDefaults(),Mk.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(n=>this._sourceType===n)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const n=bz[e],r=this.now();if(this._oscillator){const i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new n({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let n="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(n=this._oscillator.type),e==="fm"?this.type="fm"+n:e==="am"?this.type="am"+n:e==="fat"?this.type="fat"+n:e==="oscillator"?this.type=n:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,n){return e instanceof bz[n]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&zh(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&zh(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&lg(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return co(this,arguments,void 0,function*(e=1024){return Cy(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class D3 extends ji{constructor(){super(xn(D3.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new ii({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,oy(this._constantSource,this._sum)}static getDefaults(){return Object.assign(ji.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class L3 extends Ep{constructor(){const e=xn(L3.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new ay({context:this.context,value:e.max-e.min}),this._add=this.output=new D3({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Ep.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class U3 extends Ep{constructor(){super(xn(U3.getDefaults(),arguments)),this.name="Zero",this._gain=new ii({context:this.context}),this.output=this._gain,this.input=void 0,Gh(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),rQ(this.context.getConstant(0),this._gain),this}}class cy extends On{constructor(){const e=xn(cy.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=ri.prototype._fromType,this._toType=ri.prototype._toType,this._is=ri.prototype._is,this._clampValue=ri.prototype._clampValue,this._oscillator=new Eo(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new ii({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new ji({context:this.context,units:"audioRange",value:0}),this._zeros=new U3({context:this.context}),this._a2g=new iQ({context:this.context}),this._scaler=this.output=new L3({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),ui(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(Eo.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const n=this.min,r=this.max;this._units=e,this.min=n,this.max=r}get state(){return this._oscillator.state}connect(e,n,r){return(e instanceof ri||e instanceof ji)&&(this.convert=e.convert,this.units=e.units),wk(this,e,n,r),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function sQ(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){bp(s,t,e),n.set(this,s)}})}}function Cg(t,e=1/0){const n=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){bp(this.toSeconds(s),t,e),n.set(this,s)}})}}class fx extends Kc{constructor(){const e=xn(fx.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new zi({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Kc.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:$i,onerror:$i,playbackRate:1,reverse:!1})}load(e){return co(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=$i){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,n,r){return super.start(e,n,r),this}_start(e,n,r){this._loop?n=dp(n,this._loopStart):n=dp(n,0);const i=this.toSeconds(n),s=r;r=dp(r,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(r);o=o/this._playbackRate,e=this.toSeconds(e);const a=new dx({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&qu(s)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const n=this.toSeconds(e);this._activeSources.forEach(r=>r.stop(n))}restart(e,n,r){return super.restart(e,n,r),this}_restart(e,n,r){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,n,r)}seek(e,n){const r=this.toSeconds(n);if(this._state.getValueAtTime(r)==="started"){const i=this.toSeconds(e);this._stop(r),this._start(r,i)}return this}setLoopPoints(e,n){return this.loopStart=e,this.loopEnd=n,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&bp(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&bp(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(n=>{n.loop=e}),e)){const n=this._state.getNextState("stopped",this.now());n&&this._state.cancel(n.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const n=this.now(),r=this._state.getNextState("stopped",n);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,n)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Rs([Cg(0)],fx.prototype,"fadeIn",void 0);Rs([Cg(0)],fx.prototype,"fadeOut",void 0);class KVe extends Ep{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new xy({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Rg extends On{constructor(){const e=xn(Rg.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new ji({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(On.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,n){if(lg(e))return e;{let r;for(r in jC)if(jC[r][n]===e)return r;return e}}_setCurve(e,n,r){if(lg(r)&&Reflect.has(jC,r)){const i=jC[r];r_(i)?e!=="_decayCurve"&&(this[e]=i[n]):this[e]=i}else if(au(r)&&e!=="_decayCurve")this[e]=r;else throw new Error("Envelope: invalid curve: "+r)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,n=1){this.log("triggerAttack",e,n),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(n,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(n,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(n,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,n)}if(s&&this.sustain<1){const a=n*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const n=this.getValueAtTime(e);if(n>0){const r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,r,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,r,e):(or(au(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,r,n))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),this.triggerAttack(n,r),this.triggerRelease(n+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,n=0,r=0){return wk(this,e,n,r),this}asArray(){return co(this,arguments,void 0,function*(e=1024){const n=e/this.context.sampleRate,r=new Ek(1,n,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),o=s*.1,a=s+o,c=new this.constructor(Object.assign(this.get(),{attack:n*this.toSeconds(this.attack)/a,decay:n*this.toSeconds(this.decay)/a,release:n*this.toSeconds(this.release)/a,context:r}));return c._sig.toDestination(),c.triggerAttackRelease(n*(i+o)/a,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Rs([Cg(0)],Rg.prototype,"attack",void 0);Rs([Cg(0)],Rg.prototype,"decay",void 0);Rs([sQ(0,1)],Rg.prototype,"sustain",void 0);Rs([Cg(0)],Rg.prototype,"release",void 0);const jC=(()=>{let e,n;const r=[];for(e=0;e<128;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[],s=6.4;for(e=0;e<127;e++){n=e/127;const h=Math.sin(n*(Math.PI*2)*s-Math.PI/2)+1;i[e]=h/10+n*.83}i[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)n=e/127,c[e]=.5*(1-Math.cos(Math.PI*n));const l=[];for(e=0;e<128;e++){n=e/127;const h=Math.pow(n,3)*4+.2,f=Math.cos(h*Math.PI*2*n);l[e]=Math.abs(f*(1-n))}function u(h){const f=new Array(h.length);for(let p=0;p<h.length;p++)f[p]=1-h[p];return f}function d(h){return h.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:r,Out:d(r)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class Sp extends On{constructor(){const e=xn(Sp.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=n=>this._original_triggerRelease(n),this._volume=this.output=new Mh({context:this.context,volume:e.volume}),this.volume=this._volume.volume,ui(this,"volume")}static getDefaults(){return Object.assign(On.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,n){const r=this["_original_"+e]=this[e];this[e]=(...i)=>{const s=i[n],o=this.context.transport.schedule(a=>{i[n]=a,r.apply(this,i)},s);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r),o=this.toSeconds(n);return this.triggerAttack(e,s,i),this.triggerRelease(s+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class ly extends Sp{constructor(){const e=xn(ly.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Sp.getDefaults(),{detune:0,onsilence:$i,portamento:0})}triggerAttack(e,n,r=1){this.log("triggerAttack",e,n,r);const i=this.toSeconds(n);return this._triggerEnvelopeAttack(i,r),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const n=this.toSeconds(e);return this._triggerEnvelopeRelease(n),this}setNote(e,n){const r=this.toSeconds(n),i=e instanceof ru?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(r)>.05){const s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,s,r)}else this.frequency.setValueAtTime(i,r);return this}}Rs([Cg(0)],ly.prototype,"portamento",void 0);class Ik extends Rg{constructor(){super(xn(Ik.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ii({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class wl extends ly{constructor(){const e=xn(wl.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new JR(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Ik(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),ui(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(ly.getDefaults(),{envelope:Object.assign(Xw(Rg.getDefaults(),Object.keys(On.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Xw(JR.getDefaults(),[...Object.keys(Kc.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,n){if(this.envelope.triggerAttack(e,n),this.oscillator.start(e),this.envelope.sustain===0){const r=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+r+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class QR extends On{constructor(){const e=xn(QR.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new ri({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new ri({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new ri({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new ri({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(On.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){or(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const n=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*19980+20;n[o]=c}const r=new Float32Array(e),i=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(n,r,i),r}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Sd extends On{constructor(){const e=xn(Sd.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new ii({context:this.context}),this.output=new ii({context:this.context}),this._filters=[],this._filters=[],this.Q=new ji({context:this.context,units:"positive",value:e.Q}),this.frequency=new ji({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ji({context:this.context,units:"cents",value:e.detune}),this.gain=new ji({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,ui(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(On.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){or(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(r=>r.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const n=zh(e)?e:parseInt(e,10),r=[-12,-24,-48,-96];let i=r.indexOf(n);or(i!==-1,`rolloff can only be ${r.join(", ")}`),i+=1,this._rolloff=n,this.input.disconnect(),this._filters.forEach(s=>s.disconnect()),this._filters=new Array(i);for(let s=0;s<i;s++){const o=new QR({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[s]=o}this._internalChannels=this._filters,oy(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const n=new QR({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),r=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{n.getFrequencyResponse(e).forEach((s,o)=>r[o]*=s)}),n.dispose(),r}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),lx(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class px extends wl{constructor(){const e=xn(px.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,ui(this,["oscillator","envelope"])}static getDefaults(){return B0(ly.getDefaults(),wl.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,n){const r=this.toSeconds(n),i=this.toFrequency(e instanceof ru?e.toFrequency():e),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,r),this.oscillator.frequency.exponentialRampToValueAtTime(i,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Rs([sQ(0)],px.prototype,"octaves",void 0);Rs([Cg(0)],px.prototype,"pitchDecay",void 0);class Ub extends Sp{constructor(){const e=xn(Ub.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new $E(Object.assign({context:this.context},e.noise)),this.envelope=new Ik(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Sp.getDefaults(),{envelope:Object.assign(Xw(Rg.getDefaults(),Object.keys(On.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(Xw($E.getDefaults(),Object.keys(Kc.getDefaults())),{type:"white"})})}triggerAttack(e,n=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,n),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,n,r=1){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(n,r),this.triggerRelease(n+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const oQ=new Set;function F3(t){oQ.add(t)}function aQ(t,e){const n=`registerProcessor("${t}", ${e})`;oQ.add(n)}const YVe=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;F3(YVe);const XVe=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;F3(XVe);const JVe=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;F3(JVe);const QVe="feedback-comb-filter",ZVe=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;aQ(QVe,ZVe);class ZR extends Sp{constructor(){const e=xn(ZR.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),or(!zh(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const n=e.voice.getDefaults();this.options=Object.assign(n,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const r=this._voices.indexOf(this._dummyVoice);this._voices.splice(r,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Sp.getDefaults(),{maxPolyphony:32,options:{},voice:wl})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const n=this._activeVoices.findIndex(r=>r.voice===e);this._activeVoices.splice(n,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return or(e instanceof ly,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else vk("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),n=this._voices.indexOf(e);this._voices.splice(n,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,n,r){e.forEach(i=>{const s=new XR(this.context,i).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(i,n,r),this._activeVoices.push({midi:s,voice:o,released:!1}),this.log("triggerAttack",i,n))})}_triggerRelease(e,n){e.forEach(r=>{const i=new XR(this.context,r).toMidi(),s=this._activeVoices.find(({midi:o,released:a})=>o===i&&!a);s&&(s.voice.triggerRelease(n),s.released=!0,this.log("triggerRelease",r,n))})}_scheduleEvent(e,n,r,i){or(!this.disposed,"Synth was already disposed"),r<=this.now()?e==="attack"?this._triggerAttack(n,r,i):this._triggerRelease(n,r):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,n,r,i)},r-this.now())}triggerAttack(e,n,r){Array.isArray(e)||(e=[e]);const i=this.toSeconds(n);return this._scheduleEvent("attack",e,i,r),this}triggerRelease(e,n){Array.isArray(e)||(e=[e]);const r=this.toSeconds(n);return this._scheduleEvent("release",e,r),this}triggerAttackRelease(e,n,r,i){const s=this.toSeconds(r);if(this.triggerAttack(e,s,i),au(n)){or(au(e),"If the duration is an array, the notes must also be an array"),e=e;for(let o=0;o<e.length;o++){const a=n[Math.min(o,n.length-1)],c=this.toSeconds(a);or(c>0,"The duration must be greater than 0"),this.triggerRelease(e[o],s+c)}}else{const o=this.toSeconds(n);or(o>0,"The duration must be greater than 0"),this.triggerRelease(e,s+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const n=Xw(e,["onsilence","context"]);return this.options=B0(this.options,n),this._voices.forEach(r=>r.set(n)),this._dummyVoice.set(n),this}get(){return this._dummyVoice.get()}releaseAll(e){const n=this.toSeconds(e);return this._activeVoices.forEach(({voice:r})=>{r.triggerRelease(n)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class mx extends Sp{constructor(){const e=xn(mx.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const n={};Object.keys(e.urls).forEach(r=>{const i=parseInt(r,10);if(or(BC(r)||zh(i)&&isFinite(i),`url key is neither a note or midi pitch: ${r}`),BC(r)){const s=new ru(this.context,r).toMidi();n[s]=e.urls[r]}else zh(i)&&isFinite(i)&&(n[i]=e.urls[i])}),this._buffers=new O3({urls:n,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Sp.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:$i,onerror:$i,release:.1,urls:{}})}_findClosest(e){let r=0;for(;r<96;){if(this._buffers.has(e+r))return-r;if(this._buffers.has(e-r))return r;r++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,n,r=1){return this.log("triggerAttack",e,n,r),Array.isArray(e)||(e=[e]),e.forEach(i=>{const s=tQ(new ru(this.context,i).toFrequency()),o=Math.round(s),a=s-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),d=eQ(c+a),h=new dx({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:d}).connect(this.output);h.start(n,0,u.duration/d,r),au(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(h),h.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const f=this._activeSources.get(o),p=f.indexOf(h);p!==-1&&f.splice(p,1)}}}),this}triggerRelease(e,n){return this.log("triggerRelease",e,n),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=new ru(this.context,r).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const s=this._activeSources.get(i);n=this.toSeconds(n),s.forEach(o=>{o.stop(n)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const n=this.toSeconds(e);return this._activeSources.forEach(r=>{for(;r.length;)r.shift().stop(n)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,n,r,i=1){const s=this.toSeconds(r);return this.triggerAttack(e,s,i),au(n)?(or(au(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=n[Math.min(a,n.length-1)];this.triggerRelease(o,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(n)),this}add(e,n,r){if(or(BC(e)||isFinite(e),`note must be a pitch or midi: ${e}`),BC(e)){const i=new ru(this.context,e).toMidi();this._buffers.add(i,n,r)}else this._buffers.add(e,n,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(n=>n.dispose())}),this._activeSources.clear(),this}}Rs([Cg(0)],mx.prototype,"attack",void 0);Rs([Cg(0)],mx.prototype,"release",void 0);class Fb extends zc{constructor(){const e=xn(Fb.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new ux("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(zc.getDefaults(),{callback:$i,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,n=>{let r;if(n.state==="started"){n.id!==-1&&this.context.transport.clear(n.id);const i=n.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||zh(this._loop)&&this._loop>1){r=1/0,zh(this._loop)&&(r=this._loop*this._getLoopDuration());const s=this._state.getAfter(i);s!==null&&(r=Math.min(r,s.time-i)),r!==1/0&&(r=new Ia(this.context,r));const o=new Ia(this.context,this._getLoopDuration());n.id=this.context.transport.scheduleRepeat(this._tick.bind(this),o,new Ia(this.context,i),r)}else n.id=this.context.transport.schedule(this._tick.bind(this),new Ia(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const n=this.toTicks(e);return this._state.getValueAtTime(n)==="stopped"&&(this._state.add({id:-1,state:"started",time:n}),this._rescheduleEvents(n)),this}stop(e){this.cancel(e);const n=this.toTicks(e);if(this._state.getValueAtTime(n)==="started"){this._state.setStateAtTime("stopped",n,{id:-1});const r=this._state.getBefore(n);let i=n;r!==null&&(i=r.time),this._rescheduleEvents(i)}return this}cancel(e){e=dp(e,-1/0);const n=this.toTicks(e);return this._state.forEachFrom(n,r=>{this.context.transport.clear(r.id)}),this._state.cancel(n),this}_tick(e){const n=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(n)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let r=.02;GJ(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*r}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new Ia(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new Ia(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,n=this._state.get(e);if(n!==null&&n.state==="started"){const r=this._getLoopDuration();return(e-n.time)%r/r}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class eA extends Fb{constructor(){const e=xn(eA.getDefaults(),arguments,["callback","events"]);super(e),this.name="Part",this._state=new ux("stopped"),this._events=new Set,this._state.increasing=!0,e.events.forEach(n=>{au(n)?this.add(n[0],n[1]):this.add(n)})}static getDefaults(){return Object.assign(Fb.getDefaults(),{events:[]})}start(e,n){const r=this.toTicks(e);if(this._state.getValueAtTime(r)!=="started"){n=dp(n,this._loop?this._loopStart:0),this._loop?n=dp(n,this._loopStart):n=dp(n,0);const i=this.toTicks(n);this._state.add({id:-1,offset:i,state:"started",time:r}),this._forEach(s=>{this._startNote(s,r,i)})}return this}_startNote(e,n,r){n-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(n+=this._getLoopDuration()),e.start(new Ia(this.context,n))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(new Ia(this.context,n))):e.startOffset>=r&&e.start(new Ia(this.context,n))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(n=>{n.startOffset+=this._startOffset})}stop(e){const n=this.toTicks(e);return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._forEach(r=>{r.stop(e)}),this}at(e,n){const r=new tE(this.context,e).toTicks(),i=new Ia(this.context,1).toSeconds(),s=this._events.values();let o=s.next();for(;!o.done;){const a=o.value;if(Math.abs(r-a.startOffset)<i)return ei(n)&&(a.value=n),a;o=s.next()}return ei(n)?(this.add(e,n),this.at(e)):null}add(e,n){e instanceof Object&&Reflect.has(e,"time")&&(n=e,e=n.time);const r=this.toTicks(e);let i;return n instanceof Fb?(i=n,i.callback=this._tick.bind(this)):i=new Fb({callback:this._tick.bind(this),context:this.context,value:n}),i.startOffset=r,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(e){this._state.forEach(n=>{n.state==="started"?this._startNote(e,n.time,n.offset):e.stop(new Ia(this.context,n.time))})}remove(e,n){return r_(e)&&e.hasOwnProperty("time")&&(n=e,e=n.time),e=this.toTicks(e),this._events.forEach(r=>{r.startOffset===e&&(qu(n)||ei(n)&&r.value===n)&&(this._events.delete(r),r.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(n=>n.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(n=>{n instanceof eA?n._forEach(e):e(n)}),this}_setAll(e,n){this._forEach(r=>{r[e]=n})}_tick(e,n){this.mute||this.callback(e,n)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(n=>{n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.loop=e,this._testLoopBoundries(n)})}get loopEnd(){return new Ia(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopEnd=e,this._testLoopBoundries(n)})}get loopStart(){return new Ia(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(n=>{n.loopStart=this.loopStart,this._testLoopBoundries(n)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class Ok extends On{constructor(){const e=xn(Ok.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new KVe({context:this.context}),this.a=new ii({context:this.context,gain:0}),this.b=new ii({context:this.context,gain:0}),this.output=new ii({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new ji({context:this.context,units:"normalRange",value:e.fade}),ui(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Gh(this._split,this.a.gain,0),Gh(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(On.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}let y_=class extends On{constructor(e){super(e),this.name="Effect",this._dryWet=new Ok({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ii({context:this.context}),this.effectReturn=new ii({context:this.context}),this.input=new ii({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],ui(this,"wet")}static getDefaults(){return Object.assign(On.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};class B3 extends On{constructor(){const e=xn(B3.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new ri({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",ui(this,"pan")}static getDefaults(){return Object.assign(On.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const eze="bit-crusher",tze=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;aQ(eze,tze);class kk extends On{constructor(){const e=xn(kk.getDefaults(),arguments,["channels"]);super(e),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(On.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class gx extends On{constructor(){const e=xn(gx.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(On.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class tA extends On{constructor(e){super(e),this.name="StereoEffect",this.input=new ii({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new Ok({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new kk({context:this.context,channels:2}),this._merge=new gx({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),ui(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),oy(...e),Gh(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),oy(...e),Gh(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(On.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Ez extends tA{constructor(e){super(e),this.feedback=new ji({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new ii({context:this.context}),this._feedbackR=new ii({context:this.context}),this._feedbackSplit=new kk({context:this.context,channels:2}),this._feedbackMerge=new gx({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),ui(this,["feedback"])}static getDefaults(){return Object.assign(tA.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class j3 extends Ez{constructor(){const e=xn(j3.getDefaults(),arguments,["frequency","delayTime","depth"]);super(e),this.name="Chorus",this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new cy({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new cy({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new jE({context:this.context}),this._delayNodeR=new jE({context:this.context}),this.frequency=this._lfoL.frequency,ui(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(Ez.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;const n=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-n,0),this._lfoL.max=this._delayTime+n,this._lfoR.min=Math.max(this._delayTime-n,0),this._lfoR.max=this._delayTime+n}get delayTime(){return this._delayTime*1e3}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class Jw extends y_{constructor(){const e=xn(Jw.getDefaults(),arguments,["distortion"]);super(e),this.name="Distortion",this._shaper=new xy({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(y_.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;const n=e*100,r=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+n)*i*20*r/(Math.PI+n*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Sz extends y_{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new ii({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,ui(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(y_.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Nk extends Sz{constructor(){const e=xn(Nk.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new jE({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),ui(this,"delayTime")}static getDefaults(){return Object.assign(Sz.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class $3 extends tA{constructor(){const e=xn($3.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(e),this.name="Phaser",this._lfoL=new cy({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new cy({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this.Q=new ji({context:this.context,value:e.Q,units:"positive"}),this._filtersL=this._makeFilters(e.stages,this._lfoL),this._filtersR=this._makeFilters(e.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),ui(this,["frequency","Q"])}static getDefaults(){return Object.assign(tA.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(e,n){const r=[];for(let i=0;i<e;i++){const s=this.context.createBiquadFilter();s.type="allpass",this.Q.connect(s.Q),n.connect(s.frequency),r.push(s)}return r}get octaves(){return this._octaves}set octaves(e){this._octaves=e;const n=this._baseFrequency*Math.pow(2,e);this._lfoL.max=n,this._lfoR.max=n}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(e=>e.disconnect()),this._filtersR.forEach(e=>e.disconnect()),this.frequency.dispose(),this}}class H3 extends y_{constructor(){const e=xn(H3.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve(),this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(y_.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),bp(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),bp(e,0),this._preDelay=e,this.generate()}generate(){return co(this,void 0,void 0,function*(){const e=this.ready,n=new Ek(2,this._decay+this._preDelay,this.context.sampleRate),r=new $E({context:n}),i=new $E({context:n}),s=new gx({context:n});r.connect(s,0,0),i.connect(s,0,1);const o=new ii({context:n}).toDestination();s.connect(o),r.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=n.render();return this.ready=a.then($i),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class V3 extends y_{constructor(){const e=xn(V3.getDefaults(),arguments,["frequency","depth"]);super(e),this.name="Vibrato",this._delayNode=new jE({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new cy({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,ui(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(y_.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class oa extends On{constructor(){const e=xn(oa.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new ii({context:this.context}),oa._allSolos.has(this.context)||oa._allSolos.set(this.context,new Set),oa._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(On.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),oa._allSolos.get(this.context).forEach(n=>n._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){oa._soloed.has(this.context)||oa._soloed.set(this.context,new Set),oa._soloed.get(this.context).add(this)}_removeSolo(){oa._soloed.has(this.context)&&oa._soloed.get(this.context).delete(this)}_isSoloed(){return oa._soloed.has(this.context)&&oa._soloed.get(this.context).has(this)}_noSolos(){return!oa._soloed.has(this.context)||oa._soloed.has(this.context)&&oa._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),oa._allSolos.get(this.context).delete(this),this._removeSolo(),this}}oa._allSolos=new Map;oa._soloed=new Map;class z3 extends On{constructor(){const e=xn(z3.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new B3({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Mh({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,ui(this,["pan","volume"])}static getDefaults(){return Object.assign(On.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Bb extends On{constructor(){const e=xn(Bb.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new oa({solo:e.solo,context:this.context}),this._panVol=this.output=new z3({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),ui(this,["pan","volume"])}static getDefaults(){return Object.assign(On.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Bb.buses.has(e)||Bb.buses.set(e,new ii({context:this.context})),Bb.buses.get(e)}send(e,n=0){const r=this._getBus(e),i=new ii({context:this.context,units:"decibels",gain:n});return this.connect(i),i.connect(r),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Bb.buses=new Map;class G3 extends On{constructor(){const e=xn(G3.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(e),this.name="MultibandSplit",this.input=new ii({context:this.context}),this.output=void 0,this.low=new Sd({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Sd({context:this.context,frequency:0,type:"highpass"}),this.mid=new Sd({context:this.context,frequency:0,type:"lowpass"}),this.high=new Sd({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new ji({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new ji({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new ji({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),ui(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(On.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),lx(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class q3 extends On{constructor(){const e=xn(q3.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new ri({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new ri({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new ri({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new ri({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new ri({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),ui(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(On.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class W3 extends On{constructor(){const e=xn(W3.getDefaults(),arguments,["low","mid","high"]);super(e),this.name="EQ3",this.output=new ii({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new G3({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new ii({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new ii({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new ii({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),ui(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(On.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),lx(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}rc().transport;function K3(){return rc().transport}rc().destination;rc().destination;function nze(){return rc().destination}rc().listener;rc().draw;rc();const mU=Ca("256n").toSeconds(),rze=Ca("8n").toSeconds();function zP(){const t=new H3,e=$c(t.get()),n=new Nk,r=$c(n.get()),i=new j3,s=$c(i.get()),o=new $3,a=$c(o.get()),c=new Jw,l=$c(c.get()),u=new V3,d=$c(u.get());function h(){t.set({...e,wet:0}),n.set({...r,wet:0,delayTime:mU,maxDelay:"1n",feedback:.666}),i.set({...s,wet:0,depth:.999,frequency:7,feedback:.666}),o.set({...a,wet:0,Q:10}),c.set({...l,wet:0,distortion:.9}),u.set({...d,wet:0,depth:.2})}return h(),{reverb:t,echo:n,chorus:i,phaser:o,distortion:c,vibrato:u,applyreset:h}}const wz=4,ize={a:1,b:2,c:3,d:4,e:5,f:6,g:7,x:8,"#":9,"!":10,y:13,t:14,s:15,i:16,q:17,h:18,w:19,3:20,".":21,"+":11,"-":12,0:22,1:23,2:24,p:25,4:26,5:27,6:29,7:28,8:30,9:31};function sze(t,e,n,r=!0){let i=e,s=3,o="32n",a="",c="";const l=[];function u(){c="",a="",i+=Ca(o).toSeconds()}function d(){c===null?(l.push([i,[t,o,c]]),u()):Mn(c)?(l.push([i,[t,o,c]]),u()):c.startsWith("#")?(l.push([i,[t,o,c]]),u()):c!==""&&(l.push([i,[t,o,`${c}${a}${s}`]]),u())}if(Yn(n))c=n;else for(let h=0;h<n.length;++h){switch(n[h]){case 9:case 10:break;default:d();break}switch(n[h]){case 1:c="A";break;case 2:c="B";break;case 3:c="C";break;case 4:c="D";break;case 5:c="E";break;case 6:c="F";break;case 7:c="G";break;case 8:c=null;break;case 9:a+="#";break;case 10:a+="b";break;case 11:++s;break;case 12:--s;break;case 13:o="64n";break;case 14:o="32n";break;case 15:o="16n";break;case 16:o="8n";break;case 17:o="4n";break;case 18:o="2n";break;case 19:o="1n";break;case 20:o=o.replace("n","t");break;case 21:o+=".";break;case 22:c=0;break;case 23:c=1;break;case 24:c=2;break;case 25:c=3;break;case 26:c=4;break;case 27:c=5;break;case 29:c=6;break;case 28:c=7;break;case 30:c=8;break;case 31:c=9;break}}return d(),r&&l.push([i,[t,"8n",-1]]),l}function oze(t){const e=[],n=t.split(";");for(let r=0;r<n.length;++r){const i=[],s=n[r];if(s.startsWith("#"))e.push(s);else{for(let o=0;o<s.length;++o){const a=ize[s[o]];he(a)&&i.push(a)}e.push(i)}}return e}var wc=(t=>(t[t.SYNTH=0]="SYNTH",t[t.RETRO_NOISE=1]="RETRO_NOISE",t[t.BUZZ_NOISE=2]="BUZZ_NOISE",t[t.CLANG_NOISE=3]="CLANG_NOISE",t[t.METALLIC_NOISE=4]="METALLIC_NOISE",t))(wc||{});const Tz=32768;function aze(t){const e=rc().createBuffer(1,Tz,rc().sampleRate);let n=1;const r=e.getChannelData(0);for(let i=0;i<Tz;i++){t===4?r[i]=(n&1)*4*(Math.random()*14+1)-8:r[i]=(n&1)*2-1;let s=n>>1;if((n+s&1)==1)switch(t){default:case 1:s+=16384;break;case 3:s+=32768;break;case 2:s+=40;break;case 4:s+=60;break}n=s}return e}function Lm(t){let e,n;function r(){switch(e==null?void 0:e.type){case 0:{e.synth.set({...n,envelope:{...n.envelope,attack:.01,decay:.01,sustain:.5,release:.01},oscillator:{...n.oscillator,type:"square"}});break}case 1:e.synth.set({...n,release:"8n"})}}switch(t){case 0:return e={type:t,synth:new wl},n=$c(e.synth.get()),r(),{source:e,applyreset:r};case 1:case 2:case 3:case 4:return e={type:t,synth:new mx({attack:.001,release:.75,urls:{C4:aze(t)}})},n=$c(e.synth.get()),r(),{source:e,applyreset:r}}}const cze=Date.now(),Eh={get value(){return(Date.now()-cze)/1e3%1e6}},lze=120;let cQ=0;function Y3(t){cQ=lze/t,K3().bpm.value=t}Y3(150);const X3={get value(){return cQ}};function J3(t){const e=t.clone();return e.uniforms.time=Eh,e.uniforms.interval=X3,e}let P1=!1;function aS(){P1||LVe().then(()=>{if(!P1){const t=K3();P1=!0,t.start(),Fh(aa,"audio is enabled!"),Y3(107);try{const e=navigator;he(e.audioSession)&&(e.audioSession.type="playback")}catch{}Ole(aa,Ci())}}).catch(t=>{ci(aa,"audio",t.message)})}function uze(){const t=nze(),e=rc().createMediaStreamDestination(),n=new Mh(-10);n.connect(t),n.connect(e);const r=new q3({threshold:-24,ratio:4,attack:.003,release:.25,knee:30});r.connect(n);const i=new Mh(-5);i.connect(r),new Mh(0).connect(r);const o=new Mh(-4);o.connect(r);const a=new Mh(0);a.connect(r);const c=[Lm(wc.SYNTH),Lm(wc.SYNTH),Lm(wc.SYNTH),Lm(wc.SYNTH),Lm(wc.SYNTH),Lm(wc.SYNTH),Lm(wc.SYNTH),Lm(wc.SYNTH)],l=[zP(),zP(),zP()];function u(je){return je<4?Math.floor(je/2):2}function d(je){const Fe=u(je);c[je].source.synth.chain(l[Fe].vibrato,l[Fe].chorus,l[Fe].phaser,l[Fe].distortion,l[Fe].echo,l[Fe].reverb,i)}for(let je=0;je<c.length;++je)d(je);function h(je,Fe){c[je].source.type!==Fe&&(c[je].source.synth.dispose(),c[je]=Lm(Fe),d(je))}const f=new ZR().connect(o);f.maxPolyphony=8,f.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"square"}});function p(je){f.triggerAttackRelease("C6","1i",je)}const g=new wl().connect(o);f.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"square"}});function v(je){const Fe=Ca("64n").toSeconds();g.triggerAttackRelease("C6","8n",je),g.frequency.exponentialRampToValueAtTime("C11",Fe+je)}const E=new Sd(350,"bandpass").connect(o),T=new ii().connect(E);T.gain.value=0;const C=new ZR().connect(T);C.maxPolyphony=8,C.set({envelope:{attack:.001,decay:.01,sustain:.1,release:.1},oscillator:{type:"square"}});function A(je,Fe){const Ht=Ca("64n").toSeconds()+Ca(je).toSeconds();T.gain.setValueAtTime(.5,Fe),T.gain.exponentialRampToValueAtTime(.01,Ht+Fe),C.triggerAttackRelease([800,540],je,Fe)}const k=new W3(-10,10,-1).connect(o),I=new Sd(800,"highpass",-12);I.connect(k);const N=new Ub;N.set({envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),N.connect(I);function U(je,Fe){N.triggerAttackRelease(je,Fe)}const F=new Jw().connect(o);F.set({distortion:.666});const $=new wl;$.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),$.connect(F);const X=new Sd;X.set({type:"highpass",frequency:1e4}),X.connect(F);const q=new Ub;q.set({envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),q.connect(X);function W(je,Fe){const Ht=Ca("512n").toSeconds(),St=Ca("32n").toSeconds();$.triggerAttackRelease(1e4,je,Fe,1),$.frequency.exponentialRampToValueAtTime(300,Fe+Ht),$.frequency.exponentialRampToValueAtTime(100,Fe+St),q.triggerAttackRelease("8n",Fe,.333),q.volume.setValueAtTime(1,Fe),q.volume.exponentialRampToValueAtTime(0,Fe+Ca("32n").toSeconds())}const K=new Sd;K.set({type:"bandpass",frequency:256,Q:.17}),K.connect(o);const ne=new wl;ne.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),ne.connect(K);const Q=new wl;Q.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),Q.connect(K);function ie(je,Fe){ne.triggerAttackRelease(2e3,je,Fe),ne.frequency.exponentialRampToValueAtTime(1e3,Fe+Ca("32n").toSeconds()),Q.triggerAttackRelease(999,je,Fe),Q.frequency.exponentialRampToValueAtTime(888,Fe+Ca("256n").toSeconds())}const G=new Jw().connect(o);G.set({distortion:.876});const Z=new wl;Z.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),Z.connect(G);const se=new Sd;se.set({type:"highpass",frequency:1e4}),se.connect(G);const ue=new Ub;ue.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),ue.connect(se);function Ae(je,Fe){const Ht=Ca("512n").toSeconds(),St=Ca("32n").toSeconds();Z.triggerAttackRelease(1e4,je,Fe,1),Z.frequency.exponentialRampToValueAtTime(150,Fe+Ht),Z.frequency.exponentialRampToValueAtTime(100,Fe+St),ue.triggerAttackRelease("8n",Fe,.25),ue.volume.setValueAtTime(1,Fe),ue.volume.exponentialRampToValueAtTime(0,Fe+Ca("32n").toSeconds())}const Be=new wl().connect(o);Be.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"sawtooth"}});const Se=new wl().connect(o);Be.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"triangle"}});const Pe=new Ub().connect(o);Pe.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}});function we(je,Fe){const Ht=Ca("256n").toSeconds(),St=Ca(je).toSeconds()-Ht;Be.triggerAttackRelease("C4",St,Fe,1),Be.frequency.exponentialRampToValueAtTime(_z("C0").toFrequency(),Fe+St),Se.triggerAttackRelease("C5",St,Fe,.5),Se.frequency.exponentialRampToValueAtTime(_z("C0").toFrequency(),Fe+St);const Dt=Ca("4n").toSeconds();Pe.triggerAttackRelease("8n",Fe),Pe.volume.setValueAtTime(1,Fe),Pe.volume.exponentialRampToValueAtTime(0,Fe+Dt)}const Te=new Sd;Te.set({type:"bandpass",frequency:256,Q:.17}),Te.connect(o);const Oe=new wl;Oe.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),Oe.connect(Te);const _t=new wl;_t.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),_t.connect(Te);function Ct(je,Fe){Oe.triggerAttackRelease(2e3,je,Fe),Oe.frequency.exponentialRampToValueAtTime(100,Fe+Ca("32n").toSeconds()),_t.triggerAttackRelease(699,je,Fe),_t.frequency.exponentialRampToValueAtTime(399,Fe+Ca("256n").toSeconds())}const me=new px().connect(o);me.set({octaves:8});function ge(je){me.triggerAttackRelease("C1","8n",je)}const nt=new eA(Ce);function Ce(je,Fe){if(Fe===null)return;const[Ht,St,Dt]=Fe;if(Yn(Dt)&&he(c[Ht])&&(Dt.startsWith("#")?tue(aa,Dt.slice(1)):c[Ht].source.synth.triggerAttackRelease(Dt,St,je)),Mn(Dt))switch(Dt){case 0:p(je);break;case 1:v(je);break;case 2:A(St,je);break;case 3:U(St,je);break;case 4:W(St,je);break;case 5:ie(St,je);break;case 6:Ae(St,je);break;case 7:we(St,je);break;case 8:Ct(St,je);break;case 9:ge(je);break;case-1:--Rt,Rt===0&&(nt.clear(),He=-1);break}}function ut(je,Fe,Ht,St=!0){let Dt=Fe;const oe=sze(je,Fe,Ht,St),j=oe[oe.length-1];he(j)&&(Dt=Math.max(Dt,j[0]));for(let V=0;V<oe.length;++V){const[fe,Ie]=oe[V];nt.add(fe,Ie)}return Dt}let He=-1,Rt=0,$t=wz;function Tt(je,Fe){const Ht=oze(je),St=K3().seconds+.01;if(Fe)for(let Dt=0;Dt<Ht.length;++Dt)ut($t++,St,Ht[Dt],!1),$t>=c.length&&($t=wz);else{He===-1&&(He=St),Rt+=Ht.length;const Dt=He;for(let oe=0;oe<Ht.length&&oe<c.length;++oe){const j=ut(oe,Dt,Ht[oe]);He=Math.max(He,j)}}}nt.start(0);function Ft(){nt.clear(),He=-1,Rt=0}function Ee(je){n.volume.value=je}function le(je){o.volume.value=je}function We(je){new fx(je).connect(a).start(0)}function it(je){a.volume.value=je}return{broadcastdestination:e,addplay:Tt,stopplay:Ft,addttsaudiobuffer:We,setmainvolume:Ee,setdrumvolume:le,setttsvolume:it,SOURCE:c,FX:l,changesource:h,mapindextofx:u}}const dze=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]+/,hze=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]*/;function fze(t,e){if(Yn(t)){const n=rr(t);if(dze.test(n))return Lr(e);switch(n){case"pwm":case"pulse":case"retro":case"buzz":case"clang":case"metallic":return!0;default:return hze.test(n)}}return!1}let GP;const xz=new Map;let io;function pze(){return io==null?void 0:io.broadcastdestination}const aa=Wh("synth",[],t=>{if(aa.session(t)&&(P1&&!he(io)&&(io=uze()),!!he(io)))switch(t.target){case"audioenabled":Tl(aa,async()=>{await Xf(1e3),Xm(aa,void 0,"text","audioenabled","",Ci())});break;case"bpm":Mn(t.data)&&Y3(t.data);break;case"mainvolume":Mn(t.data)&&io.setmainvolume(t.data);break;case"drumvolume":Mn(t.data)&&io.setdrumvolume(t.data);break;case"ttsvolume":Mn(t.data)&&io.setttsvolume(t.data);break;case"play":if(Lr(t.data)){const[e,n]=t.data;e===""?io.stopplay():io.addplay(e,n)}break;case"voice":if(Lr(t.data)){const[e,n,r]=t.data,i=io.SOURCE[e];if(!he(i)){ci(aa,t.target,`unknown voice ${e}`);return}switch(n){case"reset":case"restart":i.applyreset();return;case"vol":case"volume":Mn(r)&&(i.source.synth.volume.value=r);return;case"port":case"portamento":if(Mn(r))switch(i.source.type){case wc.SYNTH:i.source.synth.portamento=r;break;case wc.RETRO_NOISE:ci(aa,t.target,"portamento for retro synth not supported");break}return;case"env":case"envelope":if(Lr(r)){const[s,o,a,c]=r;i.source.synth.set({envelope:{attack:s,decay:o,sustain:a,release:c}})}return;default:if(Yn(n)){if(fze(n,r)){switch(n){case"retro":io.changesource(e,wc.RETRO_NOISE);break;case"buzz":io.changesource(e,wc.BUZZ_NOISE);break;case"clang":io.changesource(e,wc.CLANG_NOISE);break;case"metallic":io.changesource(e,wc.METALLIC_NOISE);break;default:io.changesource(e,wc.SYNTH),i.source.synth.set({oscillator:{type:n}}),Lr(r)&&i.source.synth.set({oscillator:{type:n,partials:r,partialCount:r.length}}),Mn(r)&&i.source.synth.set({oscillator:{type:n,partials:[r],partialCount:1}});break}return}switch(i.source.type){case wc.SYNTH:{switch(i.source.synth.get().oscillator.type){case"pwm":switch(n){case"modfreq":case"modulationfrequency":Mn(r)&&i.source.synth.set({oscillator:{modulationFrequency:r}});return}break;case"pulse":switch(n){case"width":Mn(r)&&i.source.synth.set({oscillator:{width:r}});return}break;case"custom":case"sine":case"square":case"triangle":case"sawtooth":switch(n){case"phase":Mn(r)&&i.source.synth.set({oscillator:{phase:r}});return}break;case"amcustom":case"amsine":case"amsquare":case"amtriangle":case"amsawtooth":switch(n){case"harmonicity":Mn(r)&&i.source.synth.set({oscillator:{harmonicity:r}});return;case"modtype":case"modulationtype":Yn(r)&&i.source.synth.set({oscillator:{modulationType:r}});return;case"modenv":case"modulationenvelope":if(Lr(r)){const[o,a,c,l]=r;i.source.synth.set({oscillator:{modulationEnvelope:{attack:o,decay:a,sustain:c,release:l}}});return}break}break;case"fmcustom":case"fmsine":case"fmsquare":case"fmtriangle":case"fmsawtooth":switch(n){case"harmonicity":if(Mn(r)){i.source.synth.set({oscillator:{harmonicity:r}});return}break;case"modindex":if(Mn(r)){i.source.synth.set({oscillator:{modulationIndex:r}});return}break;case"modtype":if(Yn(r)){i.source.synth.set({oscillator:{modulationType:r}});return}break;case"modenv":if(Lr(r)){const[o,a,c,l]=r;i.source.synth.set({oscillator:{modulationEnvelope:{attack:o,decay:a,sustain:c,release:l}}});return}break}break;case"fatcustom":case"fatsine":case"fatsquare":case"fattriangle":case"fatsawtooth":switch(n){case"count":if(Mn(r)){i.source.synth.set({oscillator:{count:r}});return}break;case"phase":if(Mn(r)){i.source.synth.set({oscillator:{phase:r}});return}break;case"spread":if(Mn(r)){i.source.synth.set({oscillator:{spread:r}});return}break}break}return}}ci(aa,t.target,`unknown config ${n}`)}break}}break;case"voicefx":if(Lr(t.data)){const[e,n,r,i]=t.data,s=io.mapindextofx(e),o=io.FX[s][n];if(he(o)){switch(r){case"on":o.wet.value=.2;break;case"off":o.wet.value=0;break;default:if(Mn(r))o.wet.value=xi(.01*r,0,1);else switch(n){case"vibrato":{switch(r){default:ci(aa,t.target,`unknown ${n} config ${r}`);break}break}case"chorus":{switch(r){default:ci(aa,t.target,`unknown ${n} config ${r}`);break}break}case"phaser":{const a=o;switch(r){case"q":Mn(i)&&(a.Q.value=i);break;case"octaves":Mn(i)&&(a.octaves=i);break;case"basefrequency":Mn(i)&&(a.baseFrequency=i);break;default:ci(aa,t.target,`unknown ${n} config ${r}`);break}break}case"distortion":{const a=o;switch(r){case"distortion":Mn(i)&&(a.distortion=i);break;case"oversample":switch(i){case"2x":case"4x":case"none":a.oversample=i;break}break;default:ci(aa,t.target,`unknown ${n} config ${r}`);break}break}case"echo":{const a=o;switch(r){case"delaytime":a.delayTime.value=i;break;default:ci(aa,t.target,`unknown ${n} config ${r}`);break}break}case"reverb":{const a=o;switch(r){case"decay":a.decay=i;break;case"predelay":a.preDelay=i;break;default:ci(aa,t.target,`unknown ${n} config ${r}`);break}break}}break}o instanceof Nk&&(o.wet.value===0?o.set({delayTime:mU}):o.get().delayTime===mU&&o.set({delayTime:rze}));return}ci(aa,t.target,`unknown fx ${n}`)}break;case"tts":Tl(aa,async()=>{if(he(GP)||(GP=new QT({locale:"en-US"})),he(io)&&Lr(t.data)){const[e,n]=t.data,r=await GP.createAudio({input:n,options:{voice:e||"en-US-GuyNeural"}});io.addttsaudiobuffer(r)}});break;case"tta":Tl(aa,async()=>{var e,n;if(he(io)&&Lr(t.data)){const[r]=t.data,i=xz.get(r);if(he(i))i.loaded&&io.addttsaudiobuffer(i);else{const o=await(await tU.connect("declare-lab/TangoFlux")).predict("/predict",[r,25,4.5,3]);if(Lr(o.data)&&Yn((e=o.data[0])==null?void 0:e.url)){const a=(n=o.data[0])==null?void 0:n.url;xz.set(r,new zi(a,()=>{Fh(aa,"loaded",`${a.substring(0,8)}...${a.slice(-8)}`)}))}}}});break}});/**
 * postprocessing v6.36.4 build Tue Nov 05 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rschen
 * @license Zlib
 */var qP=1/1e3,mze=1e3,gze=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(t){typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=t)}get delta(){return this._delta*qP}get fixedDelta(){return this._fixedDelta*qP}set fixedDelta(t){this._fixedDelta=t*mze}get elapsed(){return this._elapsed*qP}update(t){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(t!==void 0?t:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(t){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},vze=(()=>{const t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),n=new qh;return n.setAttribute("position",new oo(t,3)),n.setAttribute("uv",new oo(e,2)),n})(),nf=class gU{static get fullscreenGeometry(){return vze}constructor(e="Pass",n=new K1,r=new TA){this.name=e,this.renderer=null,this.scene=n,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const n=this.fullscreenMaterial;n!==null&&(n.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let n=this.screen;n!==null?n.material=e:(n=new Ih(gU.fullscreenGeometry,e),n.frustumCulled=!1,this.scene===null&&(this.scene=new K1),this.scene.add(n),this.screen=n)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,n=uy){}render(e,n,r,i,s){throw new Error("Render method not implemented!")}setSize(e,n){}initialize(e,n,r){}dispose(){for(const e of Object.keys(this)){const n=this[e];(n instanceof Ku||n instanceof fg||n instanceof wo||n instanceof gU)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},_ze=class extends nf{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,n,r,i){const s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},yze=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,bze="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Eze=class extends Al{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new qi(null),opacity:new qi(1)},blending:Dh,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:yze,vertexShader:bze})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},Sze=class extends nf{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new Eze,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new Ku(1,1,{minFilter:Zl,magFilter:Zl,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,n,r,i){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,n){n!==void 0&&(this.renderTarget.texture.type=n,n!==Gc?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t!==null&&t.outputColorSpace===Lo&&(this.renderTarget.texture.colorSpace=Lo))}},Cz=new bi,lQ=class extends nf{constructor(t=!0,e=!0,n=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=n,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,n){this.color=t,this.depth=e,this.stencil=n}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,n,r,i){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=t.getClearAlpha(),c=s!==null,l=o>=0;c?(t.getClearColor(Cz),t.setClearColor(s,l?o:a)):l&&t.setClearAlpha(o),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),c?t.setClearColor(Cz,a):l&&t.setClearAlpha(a)}},wze=class extends nf{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new lQ(!1,!1,!0),this.inverse=!1}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,n,r,i){const s=t.getContext(),o=t.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,d=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,u,4294967295),o.stencil.setClear(d),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(t,null):(l.render(t,e),l.render(t,n))),this.renderToScreen?(t.setRenderTarget(null),t.render(a,c)):(t.setRenderTarget(e),t.render(a,c),t.setRenderTarget(n),t.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},Tze=class{constructor(e=null,{depthBuffer:n=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(n,r,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Sze,this.depthTexture=null,this.passes=[],this.timer=new gze,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const n=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(n.depthBuffer,n.stencilBuffer,n.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const n=e.getSize(new Vn),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===Gc&&e.outputColorSpace===Lo&&(this.inputBuffer.texture.colorSpace=Lo,this.outputBuffer.texture.colorSpace=Lo,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(n.width,n.height);for(const s of this.passes)s.initialize(e,r,i)}}replaceRenderer(e,n=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),n&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new ZU;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=V0,e.type=H0):e.type=s_,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,n,r,i){const s=this.renderer,o=s===null?new Vn:s.getDrawingBufferSize(new Vn),a={minFilter:Zl,magFilter:Zl,stencilBuffer:n,depthBuffer:e,type:r},c=new Ku(o.width,o.height,a);return i>0&&(c.ignoreDepthForMultisampleCopy=!1,c.samples=i),r===Gc&&s!==null&&s.outputColorSpace===Lo&&(c.texture.colorSpace=Lo),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const n of this.passes)n.mainScene=e}setMainCamera(e){for(const n of this.passes)n.mainCamera=e}addPass(e,n){const r=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new Vn),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(s.width,s.height),e.initialize(i,o,a),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),n!==void 0?r.splice(n,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of r)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const n=this.passes,r=n.indexOf(e);if(r!==-1&&n.splice(r,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;n.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===n.length&&(e.renderToScreen=!1,n.length>0&&(n[n.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const n=this.renderer,r=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(n,i,s,e,o),u.needsSwap&&(o&&(r.renderToScreen=u.renderToScreen,a=n.getContext(),c=n.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),r.render(n,i,s,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=s,s=l),u instanceof wze?o=!0:u instanceof _ze&&(o=!1))}setSize(e,n,r){const i=this.renderer,s=i.getSize(new Vn);(e===void 0||n===void 0)&&(e=s.width,n=s.height),(s.width!==e||s.height!==n)&&i.setSize(e,n,r);const o=i.getDrawingBufferSize(new Vn);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),nf.fullscreenGeometry.dispose()}},hp={NONE:0,DEPTH:1,CONVOLUTION:2},Fi={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},xze=class{constructor(){this.shaderParts=new Map([[Fi.FRAGMENT_HEAD,null],[Fi.FRAGMENT_MAIN_UV,null],[Fi.FRAGMENT_MAIN_IMAGE,null],[Fi.VERTEX_HEAD,null],[Fi.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=hp.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=S_}},WP=!1,Rz=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let n;if(e.material.flatShading)switch(e.material.side){case $u:n=this.materialsFlatShadedDoubleSide;break;case ec:n=this.materialsFlatShadedBackSide;break;default:n=this.materialsFlatShaded;break}else switch(e.material.side){case $u:n=this.materialsDoubleSide;break;case ec:n=this.materialsBackSide;break;default:n=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=n[2]:e.isInstancedMesh?e.material=n[1]:e.material=n[0],++this.meshCount}}}cloneMaterial(t){if(!(t instanceof Al))return t.clone();const e=t.uniforms,n=new Map;for(const i in e){const s=e[i].value;s.isRenderTargetTexture&&(e[i].value=null,n.set(i,s))}const r=t.clone();for(const i of n)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){const e=this.materials=[this.cloneMaterial(t),this.cloneMaterial(t),this.cloneMaterial(t)];for(const n of e)n.uniforms=Object.assign({},t.uniforms),n.side=ng;e[2].skinning=!0,this.materialsBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=ec,r}),this.materialsDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.side=$u,r}),this.materialsFlatShaded=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=ec,r}),this.materialsFlatShadedDoubleSide=e.map(n=>{const r=this.cloneMaterial(n);return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=$u,r})}}render(t,e,n){const r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,WP){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,n);for(const s of i)s[0].material=s[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,n),e.overrideMaterial=i}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return WP}static set workaroundEnabled(t){WP=t}},_v=-1,nE=class extends hg{constructor(t,e=_v,n=_v,r=1){super(),this.resizable=t,this.baseSize=new Vn(1,1),this.preferredSize=new Vn(e,n),this.target=this.preferredSize,this.s=r,this.effectiveSize=new Vn,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const t=this.baseSize,e=this.preferredSize,n=this.effectiveSize,r=this.scale;e.width!==_v?n.width=e.width:e.height!==_v?n.width=Math.round(e.height*(t.width/Math.max(t.height,1))):n.width=Math.round(t.width*r),e.height!==_v?n.height=e.height:e.width!==_v?n.height=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):n.height=Math.round(t.height*r)}get width(){return this.effectiveSize.width}set width(t){this.preferredWidth=t}get height(){return this.effectiveSize.height}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferredSize.setScalar(_v),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.baseSize.width}set baseWidth(t){this.baseSize.width!==t&&(this.baseSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(t){this.baseWidth=t}get baseHeight(){return this.baseSize.height}set baseHeight(t){this.baseSize.height!==t&&(this.baseSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.baseSize.width!==t||this.baseSize.height!==e)&&(this.baseSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(t){this.preferredSize.width!==t&&(this.preferredSize.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferredSize.height}set preferredHeight(t){this.preferredSize.height!==t&&(this.preferredSize.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferredSize.width!==t||this.preferredSize.height!==e)&&(this.preferredSize.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(t){this.s=t.scale,this.baseSize.set(t.baseWidth,t.baseHeight),this.preferredSize.set(t.preferredWidth,t.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return _v}},fi={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},Cze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",Rze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",Aze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",Mze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Ize="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",Oze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",kze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",Nze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",Pze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",Dze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",Lze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",Uze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",Fze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",Bze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",jze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",$ze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",Hze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",Vze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",zze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",Gze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",qze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",Wze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",Kze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",Yze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",Xze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",Jze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",Qze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",Zze="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",e6e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",t6e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",n6e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",r6e="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",i6e=new Map([[fi.ADD,Cze],[fi.ALPHA,Rze],[fi.AVERAGE,Aze],[fi.COLOR,Mze],[fi.COLOR_BURN,Ize],[fi.COLOR_DODGE,Oze],[fi.DARKEN,kze],[fi.DIFFERENCE,Nze],[fi.DIVIDE,Pze],[fi.DST,null],[fi.EXCLUSION,Dze],[fi.HARD_LIGHT,Lze],[fi.HARD_MIX,Uze],[fi.HUE,Fze],[fi.INVERT,Bze],[fi.INVERT_RGB,jze],[fi.LIGHTEN,$ze],[fi.LINEAR_BURN,Hze],[fi.LINEAR_DODGE,Vze],[fi.LINEAR_LIGHT,zze],[fi.LUMINOSITY,Gze],[fi.MULTIPLY,qze],[fi.NEGATION,Wze],[fi.NORMAL,Kze],[fi.OVERLAY,Yze],[fi.PIN_LIGHT,Xze],[fi.REFLECT,Jze],[fi.SATURATION,Qze],[fi.SCREEN,Zze],[fi.SOFT_LIGHT,e6e],[fi.SRC,t6e],[fi.SUBTRACT,n6e],[fi.VIVID_LIGHT,r6e]]),s6e=class extends hg{constructor(t,e=1){super(),this._blendFunction=t,this.opacity=new qi(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this._blendFunction}set blendFunction(t){this._blendFunction=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return i6e.get(this.blendFunction)}},vU=class extends hg{constructor(t,e,{attributes:n=hp.NONE,blendFunction:r=fi.NORMAL,defines:i=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=t,this.renderer=null,this.attributes=n,this.fragmentShader=e,this.vertexShader=a,this.defines=i,this.uniforms=s,this.extensions=o,this.blendMode=new s6e(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=S_,this._outputColorSpace=Zf}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(t){this._inputColorSpace=t,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t,this.setChanged()}set mainScene(t){}set mainCamera(t){}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=uy){}update(t,e,n){}setSize(t,e){}initialize(t,e,n){}dispose(){for(const t of Object.keys(this)){const e=this[t];(e instanceof Ku||e instanceof fg||e instanceof wo||e instanceof nf)&&this[t].dispose()}}},$C={RED:0,GREEN:1,BLUE:2,ALPHA:3},uQ=class extends nf{constructor(t,e,n=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new lQ,this.overrideMaterialManager=n===null?null:new Rz(n),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(t){this.scene=t}set mainCamera(t){this.camera=t}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){const t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){const e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new Rz(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,n,r,i){const s=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=s.background,u=t.shadowMap.autoUpdate,d=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(d),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,s,o):t.render(s,o),o.layers.mask=c,s.background=l,t.shadowMap.autoUpdate=u}},o6e=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,a6e="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",c6e=class extends Al{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new qi(null),normalBuffer:new qi(null),texelSize:new qi(new Vn)},blending:Dh,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:o6e,vertexShader:a6e})}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=uy){this.depthBuffer=t,this.depthPacking=e}set normalBuffer(t){this.uniforms.normalBuffer.value=t,t!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(t){this.normalBuffer=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},l6e=class extends nf{constructor({normalBuffer:t=null,resolutionScale:e=.5,width:n=nE.AUTO_SIZE,height:r=nE.AUTO_SIZE,resolutionX:i=n,resolutionY:s=r}={}){super("DepthDownsamplingPass");const o=new c6e;o.normalBuffer=t,this.fullscreenMaterial=o,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new Ku(1,1,{minFilter:Bo,magFilter:Bo,depthBuffer:!1,type:sp}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const a=this.resolution=new nE(this,i,s,e);a.addEventListener("change",c=>this.setSize(a.baseWidth,a.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(t,e=uy){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e}render(t,e,n,r,i){t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height),this.fullscreenMaterial.setSize(t,e)}initialize(t,e,n){const r=t.getContext();if(!(r.getExtension("EXT_color_buffer_float")||r.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},u6e=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,d6e="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",h6e=class extends Al{constructor(t,e,n,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:yA.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new qi(null),depthBuffer:new qi(null),resolution:new qi(new Vn),texelSize:new qi(new Vn),cameraNear:new qi(.3),cameraFar:new qi(1e3),aspect:new qi(1),time:new qi(0)},blending:Dh,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),t&&this.setShaderParts(t),e&&this.setDefines(e),n&&this.setUniforms(n),this.copyCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=uy){this.depthBuffer=t,this.depthPacking=e}setShaderData(t){this.setShaderParts(t.shaderParts),this.setDefines(t.defines),this.setUniforms(t.uniforms),this.setExtensions(t.extensions)}setShaderParts(t){return this.fragmentShader=u6e.replace(Fi.FRAGMENT_HEAD,t.get(Fi.FRAGMENT_HEAD)||"").replace(Fi.FRAGMENT_MAIN_UV,t.get(Fi.FRAGMENT_MAIN_UV)||"").replace(Fi.FRAGMENT_MAIN_IMAGE,t.get(Fi.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=d6e.replace(Fi.VERTEX_HEAD,t.get(Fi.VERTEX_HEAD)||"").replace(Fi.VERTEX_MAIN_SUPPORT,t.get(Fi.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(t){for(const e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(const e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(const e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){this.copyCameraSettings(t)}copyCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof Lu?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){const n=this.uniforms;n.resolution.value.set(t,e),n.texelSize.value.set(1/t,1/e),n.aspect.value=t/e}static get Section(){return Fi}};function Az(t,e,n){for(const r of e){const i="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const o of n.entries())o[1]!==null&&n.set(o[0],o[1].replace(s,i))}}function f6e(t,e,n){let r=e.getFragmentShader(),i=e.getVertexShader();const s=r!==void 0&&/mainImage/.test(r),o=r!==void 0&&/mainUv/.test(r);if(n.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&n.attributes&hp.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=n.shaderParts;let l=c.get(Fi.FRAGMENT_HEAD)||"",u=c.get(Fi.FRAGMENT_MAIN_UV)||"",d=c.get(Fi.FRAGMENT_MAIN_IMAGE)||"",h=c.get(Fi.VERTEX_HEAD)||"",f=c.get(Fi.VERTEX_MAIN_SUPPORT)||"";const p=new Set,g=new Set;if(o&&(u+=`	${t}MainUv(UV);
`,n.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const T=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);f+=`	${t}MainSupport(`,f+=T?`vUv);
`:`);
`;for(const C of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const A of C[1].split(/\s*,\s*/))n.varyings.add(A),p.add(A),g.add(A);for(const C of i.matchAll(a))g.add(C[1])}for(const T of r.matchAll(a))g.add(T[1]);for(const T of e.defines.keys())g.add(T.replace(/\([\w\s,]*\)/g,""));for(const T of e.uniforms.keys())g.add(T);g.delete("while"),g.delete("for"),g.delete("if"),e.uniforms.forEach((T,C)=>n.uniforms.set(t+C.charAt(0).toUpperCase()+C.slice(1),T)),e.defines.forEach((T,C)=>n.defines.set(t+C.charAt(0).toUpperCase()+C.slice(1),T));const v=new Map([["fragment",r],["vertex",i]]);Az(t,g,n.defines),Az(t,g,v),r=v.get("fragment"),i=v.get("vertex");const E=e.blendMode;if(n.blendModes.set(E.blendFunction,E),s){e.inputColorSpace!==null&&e.inputColorSpace!==n.colorSpace&&(d+=e.inputColorSpace===Lo?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Zf?n.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(n.colorSpace=e.inputColorSpace);const T=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;d+=`${t}MainImage(color0, UV, `,n.attributes&hp.DEPTH&&T.test(r)&&(d+="depth, ",n.readDepth=!0),d+=`color1);
	`;const C=t+"BlendOpacity";n.uniforms.set(C,E.opacity),d+=`color0 = blend${E.blendFunction}(color0, color1, ${C});

	`,l+=`uniform float ${C};

`}if(l+=r+`
`,i!==null&&(h+=i+`
`),c.set(Fi.FRAGMENT_HEAD,l),c.set(Fi.FRAGMENT_MAIN_UV,u),c.set(Fi.FRAGMENT_MAIN_IMAGE,d),c.set(Fi.VERTEX_HEAD,h),c.set(Fi.VERTEX_MAIN_SUPPORT,f),e.extensions!==null)for(const T of e.extensions)n.extensions.add(T)}}var p6e=class extends nf{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new h6e(null,null,null,t),this.listener=n=>this.handleEvent(n),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(t){for(const e of this.effects)e.mainScene=t}set mainCamera(t){this.fullscreenMaterial.copyCameraSettings(t);for(const e of this.effects)e.mainCamera=t}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){const e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}setEffects(t){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=t.sort((e,n)=>n.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const t=new xze;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===fi.DST)t.attributes|=o.getAttributes()&hp.DEPTH;else{if(t.attributes&o.getAttributes()&hp.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${o.name})`);f6e("e"+e++,o,t)}let n=t.shaderParts.get(Fi.FRAGMENT_HEAD),r=t.shaderParts.get(Fi.FRAGMENT_MAIN_IMAGE),i=t.shaderParts.get(Fi.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of t.blendModes.values())n+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;t.attributes&hp.DEPTH?(t.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,t.colorSpace===Lo&&(r+=`color0 = sRGBToLinear(color0);
	`),t.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,t.defines.set("UV","transformedUv")):t.defines.set("UV","vUv"),t.shaderParts.set(Fi.FRAGMENT_HEAD,n),t.shaderParts.set(Fi.FRAGMENT_MAIN_IMAGE,r),t.shaderParts.set(Fi.FRAGMENT_MAIN_UV,i);for(const[o,a]of t.shaderParts)a!==null&&t.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(t)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=uy){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(const n of this.effects)n.setDepthTexture(t,e)}render(t,e,n,r,i){for(const s of this.effects)s.update(t,e,r);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r*this.timeScale,t.setRenderTarget(this.renderToScreen?null:n),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(const n of this.effects)n.setSize(t,e)}initialize(t,e,n){this.renderer=t;for(const r of this.effects)r.initialize(t,e,n);this.updateMaterial(),n!==void 0&&n!==Gc&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const t of this.effects)t.removeEventListener("change",this.listener),t.dispose()}handleEvent(t){switch(t.type){case"change":this.recompile();break}}},m6e=class extends nf{constructor(t,e,{renderTarget:n,resolutionScale:r=1,width:i=nE.AUTO_SIZE,height:s=nE.AUTO_SIZE,resolutionX:o=i,resolutionY:a=s}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new uQ(t,e,new Zae);const c=this.renderPass;c.ignoreBackground=!0,c.skipShadowMapUpdate=!0;const l=c.getClearPass();l.overrideClearColor=new bi(7829503),l.overrideClearAlpha=1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new Ku(1,1,{minFilter:Bo,magFilter:Bo}),this.renderTarget.texture.name="NormalPass.Target");const u=this.resolution=new nE(this,o,a,r);u.addEventListener("change",d=>this.setSize(u.baseWidth,u.baseHeight))}set mainScene(t){this.renderPass.mainScene=t}set mainCamera(t){this.renderPass.mainCamera=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,n,r,i){const s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,s,s)}setSize(t,e){const n=this.resolution;n.setBaseSize(t,e),this.renderTarget.setSize(n.width,n.height)}};let OS;function g6e(){var t;if(OS!==void 0)return OS;try{let e;const n=document.createElement("canvas");return OS=!!(window.WebGL2RenderingContext&&(e=n.getContext("webgl2"))),e&&((t=e.getExtension("WEBGL_lose_context"))==null||t.loseContext()),OS}catch{return OS=!1}}const v6e=ft.createContext(null),Mz=t=>(t.getAttributes()&hp.CONVOLUTION)===hp.CONVOLUTION,_6e=Ph.memo(ft.forwardRef(({children:t,camera:e,scene:n,resolutionScale:r,enabled:i=!0,renderPriority:s=1,autoClear:o=!0,depthBuffer:a,enableNormalPass:c,stencilBuffer:l,multisampling:u=8,frameBufferType:d=GE},h)=>{const{gl:f,scene:p,camera:g,size:v}=KE(),E=n||p,T=e||g,[C,A,k]=ft.useMemo(()=>{const F=g6e(),$=new Tze(f,{depthBuffer:a,stencilBuffer:l,multisampling:u>0&&F?u:0,frameBufferType:d});$.addPass(new uQ(E,T));let X=null,q=null;return c&&(q=new m6e(E,T),q.enabled=!1,$.addPass(q),r!==void 0&&F&&(X=new l6e({normalBuffer:q.texture,resolutionScale:r}),X.enabled=!1,$.addPass(X))),[$,q,X]},[T,f,a,l,u,d,E,c,r]);ft.useEffect(()=>C==null?void 0:C.setSize(v.width,v.height),[C,v]),uT((F,$)=>{if(i){const X=f.autoClear;f.autoClear=o,l&&!o&&f.clearStencil(),C.render($),f.autoClear=X}},i?s:0);const I=ft.useRef(null),N=kce(I);ft.useLayoutEffect(()=>{const F=[];if(I.current&&N.current&&C){const $=N.current.objects;for(let X=0;X<$.length;X++){const q=$[X];if(q instanceof vU){const W=[q];if(!Mz(q)){let ne=null;for(;(ne=$[X+1])instanceof vU&&!Mz(ne);)W.push(ne),X++}const K=new p6e(T,...W);F.push(K)}else q instanceof nf&&F.push(q)}for(const X of F)C==null||C.addPass(X);A&&(A.enabled=!0),k&&(k.enabled=!0)}return()=>{for(const $ of F)C==null||C.removePass($);A&&(A.enabled=!1),k&&(k.enabled=!1)}},[C,t,T,A,k,N]),ft.useEffect(()=>{const F=f.toneMapping;return f.toneMapping=ap,()=>{f.toneMapping=F}},[]);const U=ft.useMemo(()=>({composer:C,normalPass:A,downSamplingPass:k,resolutionScale:r,camera:T,scene:E}),[C,A,k,r,T,E]);return ft.useImperativeHandle(h,()=>C,[C]),Ne.jsx(v6e.Provider,{value:U,children:Ne.jsx("group",{ref:I,children:t})})}));let y6e=0;const Iz=new WeakMap,b6e=(t,e)=>Ph.forwardRef(function({blendFunction:r=void 0,opacity:i=void 0,...s},o){let a=Iz.get(t);if(!a){const u=`@react-three/postprocessing/${t.name}-${y6e++}`;Y8({[u]:t}),Iz.set(t,a=u)}const c=KE(u=>u.camera),l=Ph.useMemo(()=>{var u,d;return[...(u=void 0)!=null?u:[],...(d=s.args)!=null?d:[{...e,...s}]]},[JSON.stringify(s)]);return Ne.jsx(a,{camera:c,"blendMode-blendFunction":r,"blendMode-opacity-value":i,...s,ref:o,args:l})});function KP(t,e,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{c(r.next(l))}catch(u){s(u)}}function a(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof n?u:new n(function(d){d(u)})).then(o,a)}c((r=r.apply(t,[])).next())})}const E6e=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function Oz(t){return t=t.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const dQ=typeof window>"u",Gf=(()=>{if(dQ)return;const{userAgent:t,platform:e,maxTouchPoints:n}=window.navigator,r=/(iphone|ipod|ipad)/i.test(t),i=e==="iPad"||e==="MacIntel"&&n>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(t)||r||i,isSafari12:/Version\/12.+Safari/.test(t),isFirefox:/Firefox/.test(t)}})();function S6e(t,e,n){if(!n)return[e];const r=function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,d=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,h=l.createShader(35633),f=l.createShader(35632),p=l.createProgram();if(!(f&&h&&p))return;l.shaderSource(h,u),l.shaderSource(f,d),l.compileShader(h),l.compileShader(f),l.attachShader(p,h),l.attachShader(p,f),l.linkProgram(p),l.detachShader(p,h),l.detachShader(p,f),l.deleteShader(h),l.deleteShader(f),l.useProgram(p);const g=l.createBuffer();l.bindBuffer(34962,g),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const v=l.getAttribLocation(p,"aPosition");l.vertexAttribPointer(v,3,5126,!1,0,0),l.enableVertexAttribArray(v),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const E=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,E),l.deleteProgram(p),l.deleteBuffer(g),E.join("")}(t),i="801621810",s="8016218135",o="80162181161",a=Gf!=null&&Gf.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return r==="80162181255"?c=a.filter(([,,l])=>l>=14):(c=a.filter(([,l])=>l===r),c.length||(c=a)),c.map(([l])=>`apple ${l} gpu`)}let kz=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};const YP=[],Nz=[];function w6e(t,e){if(t===e)return 0;const n=t;t.length>e.length&&(t=e,e=n);let r=t.length,i=e.length;for(;r>0&&t.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let s,o=0;for(;o<r&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,i-=o,r===0)return i;let a,c,l=0,u=0,d=0;for(;u<r;)Nz[u]=t.charCodeAt(o+u),YP[u]=++u;for(;d<i;)for(s=e.charCodeAt(o+d),a=d++,l=d,u=0;u<r;u++)c=s===Nz[u]?a:a+1,a=YP[u],l=YP[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function T6e(t){return t!=null}const x6e=({mobileTiers:t=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:n={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.56/dist/benchmarks"}={})=>KP(void 0,void 0,void 0,function*(){const o={};if(dQ)return{tier:0,type:"SSR"};const{isIpad:a=!!(Gf!=null&&Gf.isIpad),isMobile:c=!!(Gf!=null&&Gf.isMobile),screenSize:l=window.screen,loadBenchmarks:u=k=>KP(void 0,void 0,void 0,function*(){const I=yield fetch(`${s}/${k}`).then(N=>N.json());if(parseInt(I.shift().split(".")[0],10)<4)throw new kz("Detect GPU benchmark data is out of date. Please update to version 4x");return I})}=n;let{renderer:d}=n;const h=(k,I,N,U,F)=>({device:F,fps:U,gpu:N,isMobile:c,tier:k,type:I});let f,p="";if(d)d=Oz(d),f=[d];else{const k=r||function(N,U=!1){const F={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:U,powerPreference:"high-performance",stencil:!1};N&&delete F.powerPreference;const $=window.document.createElement("canvas"),X=$.getContext("webgl",F)||$.getContext("experimental-webgl",F);return X??void 0}(Gf==null?void 0:Gf.isSafari12,i);if(!k)return h(0,"WEBGL_UNSUPPORTED");const I=Gf!=null&&Gf.isFirefox?null:k.getExtension("WEBGL_debug_renderer_info");if(d=I?k.getParameter(I.UNMASKED_RENDERER_WEBGL):k.getParameter(k.RENDERER),!d)return h(1,"FALLBACK");p=d,d=Oz(d),f=function(N,U,F){return U==="apple gpu"?S6e(N,U,F):[U]}(k,d,c)}const g=(yield Promise.all(f.map(function(k){var I;return KP(this,void 0,void 0,function*(){const N=(Be=>{const Se=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const Pe of Se)if(Be.includes(Pe))return Pe})(k);if(!N)return;const U=`${c?"m":"d"}-${N}${a?"-ipad":""}.json`,F=o[U]=(I=o[U])!==null&&I!==void 0?I:u(U);let $;try{$=yield F}catch(Be){if(Be instanceof kz)throw Be;return}const X=function(Be){var Se;const Pe=(Be=Be.replace(/\([^)]+\)/,"")).match(/\d+/)||Be.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(Se=Pe==null?void 0:Pe.join("").replace(/\W|amd/g,""))!==null&&Se!==void 0?Se:""}(k);let q=$.filter(([,Be])=>Be===X);q.length||(q=$.filter(([Be])=>Be.includes(k)));const W=q.length;if(W===0)return;const K=k.split(/[.,()\[\]/\s]/g).sort().filter((Be,Se,Pe)=>Se===0||Be!==Pe[Se-1]).join(" ");let ne,[Q,,,,ie]=W>1?q.map(Be=>[Be,w6e(K,Be[2])]).sort(([,Be],[,Se])=>Be-Se)[0][0]:q[0],G=Number.MAX_VALUE;const{devicePixelRatio:Z}=window,se=l.width*Z*l.height*Z;for(const Be of ie){const[Se,Pe]=Be,we=Se*Pe,Te=Math.abs(se-we);Te<G&&(G=Te,ne=Be)}if(!ne)return;const[,,ue,Ae]=ne;return[G,ue,Q,Ae]})}))).filter(T6e).sort(([k=Number.MAX_VALUE,I],[N=Number.MAX_VALUE,U])=>k===N?I-U:k-N);if(!g.length){const k=E6e.find(I=>d.includes(I));return k?h(0,"BLOCKLISTED",k):h(1,"FALLBACK",`${d} (${p})`)}const[,v,E,T]=g[0];if(v===-1)return h(0,"BLOCKLISTED",E,v,T);const C=c?t:e;let A=0;for(let k=0;k<C.length;k++)v>=C[k]&&(A=k);return h(A,"BENCHMARK",E,v,T)});var Ld=typeof window<"u"?window:{screen:{},navigator:{}},HE=(Ld.matchMedia||function(){return{matches:!1}}).bind(Ld),C6e={get passive(){return!0}},hQ=function(){};Ld.addEventListener&&Ld.addEventListener("p",hQ,C6e);Ld.removeEventListener&&Ld.removeEventListener("p",hQ,!1);var Q3="ontouchstart"in Ld,R6e="TouchEvent"in Ld,A6e=Q3||R6e&&HE("(any-pointer: coarse)").matches,Pz=(Ld.navigator.maxTouchPoints||0)>0||A6e,fQ=Ld.navigator.userAgent||"",M6e=HE("(pointer: coarse)").matches&&/iPad|Macintosh/.test(fQ)&&Math.min(Ld.screen.width||0,Ld.screen.height||0)>=768,pQ=(HE("(pointer: coarse)").matches||!HE("(pointer: fine)").matches&&Q3)&&!/Windows.*Firefox/.test(fQ),I6e=HE("(any-pointer: fine)").matches||HE("(any-hover: hover)").matches||M6e||!Q3,_U=Pz&&(I6e||!pQ)?"hybrid":Pz?"touchOnly":"mouseOnly",O6e=_U==="mouseOnly"?"mouse":_U==="touchOnly"||pQ?"touch":"mouse",mQ={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(xc,function(){var n=function(){function r(f){return o.appendChild(f.dom),f}function i(f){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===f?"block":"none";s=f}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(f){f.preventDefault(),i(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,l=0,u=r(new n.Panel("FPS","#0ff","#002")),d=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=r(new n.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:r,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){l++;var f=(performance||Date).now();if(d.update(f-a,200),f>c+1e3&&(u.update(1e3*l/(f-c),100),c=f,l=0,h)){var p=performance.memory;h.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return f},update:function(){a=this.end()},domElement:o,setMode:i}};return n.Panel=function(r,i,s){var o=1/0,a=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,d=48*l,h=3*l,f=2*l,p=3*l,g=15*l,v=74*l,E=30*l,T=document.createElement("canvas");T.width=u,T.height=d,T.style.cssText="width:80px;height:48px";var C=T.getContext("2d");return C.font="bold "+9*l+"px Helvetica,Arial,sans-serif",C.textBaseline="top",C.fillStyle=s,C.fillRect(0,0,u,d),C.fillStyle=i,C.fillText(r,h,f),C.fillRect(p,g,v,E),C.fillStyle=s,C.globalAlpha=.9,C.fillRect(p,g,v,E),{dom:T,update:function(A,k){o=Math.min(o,A),a=Math.max(a,A),C.fillStyle=s,C.globalAlpha=1,C.fillRect(0,0,u,g),C.fillStyle=i,C.fillText(c(A)+" "+r+" ("+c(o)+"-"+c(a)+")",h,f),C.drawImage(T,p+l,g,v-l,E,p,g,v-l,E),C.fillRect(p+v-l,g,l,E),C.fillStyle=s,C.globalAlpha=.9,C.fillRect(p+v-l,g,l,c((1-A/k)*E))}}},n})})(mQ);var k6e=mQ.exports;const N6e=Yc(k6e),P6e=`  
vec3 halftone(vec3 texcolor, vec2 st, float frequency) {
  float n = 0.1 * snoise(st * 200.0); // Fractal noise
  n += 0.05 * snoise(st * 400.0);
  n += 0.025 * snoise(st * 800.0);

  // Perform a rough RGB-to-CMYK conversion
  vec4 cmyk;
  // CMY = 1-RGB
  cmyk.xyz = 1.0 - texcolor;
  // Black generation: K = min(C,M,Y)
  cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); 
  // Grey component replacement: subtract K from CMY
  cmyk.xyz -= cmyk.w; 

  // K based modifier
  float flex = pow(cmyk.w, 3.11);

  // Distance to nearest point in a grid of
  // (frequency x frequency) points over the unit square
  
  float t = 0.1 + 0.1 * n + 0.11 * flex + 0.1 * cmyk.y;

  // K component: 45 degrees screen angle
  vec2 Kst = frequency * mat2(0.707, -0.707, 0.707, 0.707) * st;
  vec2 Kuv = 2.0 * fract(Kst) - 1.0; 
  float k = aastep(0.0, sqrt(cmyk.w) + t - length(Kuv) + n);
  
  // C component: 15 degrees screen angle
  vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966) * st;
  vec2 Cuv = 2.0 * fract(Cst) - 1.0;
  float c = aastep(0.0, sqrt(cmyk.x) + t - length(Cuv) + n);
  
  // M component: -15 degrees screen angle
  vec2 Mst = frequency * mat2(0.966, 0.259, -0.259, 0.966) * st;
  vec2 Muv = 2.0 * fract(Mst) - 1.0;
  float m = aastep(0.0, sqrt(cmyk.y) + t - length(Muv) + n);

  // Y component: 0 degrees screen angle
  vec2 Yst = frequency * st; // 0 deg 
  vec2 Yuv = 2.0 * fract(Yst) - 1.0;
  float y = aastep(0.0, sqrt(cmyk.z) + t - length(Yuv) + n);

  // CMY screen in RGB
  vec3 black = vec3(n + 0.01);
  vec3 rgbscreen = 1.0 - vec3(c,m,y) + n;
  
  // Blend in K for final color
  vec3 factor = mix(rgbscreen, black, 1.1 * k + 0.3 * n);

  // Blend with og color
  return mix(factor, texcolor, 0.777);
}

vec3 halftone(vec3 texcolor, vec2 st) {
  return halftone(texcolor, st, 412.321);
}
`,D6e=`
float blendLighten(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten(vec3 base, vec3 blend) {
	return vec3(blendLighten(base.r,blend.r),blendLighten(base.g,blend.g),blendLighten(base.b,blend.b));
}

vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
	return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken(vec3 base, vec3 blend) {
	return vec3(blendDarken(base.r,blend.r),blendDarken(base.g,blend.g),blendDarken(base.b,blend.b));
}

vec3 blendDarken(vec3 base, vec3 blend, float opacity) {
	return (blendDarken(base, blend) * opacity + base * (1.0 - opacity));
}
`,L6e=`
float aastep(float threshold, float value) {
  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;
  return smoothstep(threshold-afwidth, threshold+afwidth, value);
}
`,U6e=`
//
// Description : Array and textureless GLSL 2D simplex noise function.
//      Author : Ian McEwan, Ashima Arts.
//  Maintainer : ijm
//     Lastmod : 20110822 (ijm)
//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
//               Distributed under the MIT License. See LICENSE file.
//               https://github.com/ashima/webgl-noise
//

vec3 mod289(vec3 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec2 mod289(vec2 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec3 permute(vec3 x) {
  return mod289(((x*34.0)+1.0)*x);
}

float snoise(vec2 v) {
  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)
                     -0.577350269189626,  // -1.0 + 2.0 * C.x
                      0.024390243902439); // 1.0 / 41.0
// First corner
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);

// Other corners
  vec2 i1;
  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0
  //i1.y = 1.0 - i1.x;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  // x0 = x0 - 0.0 + 0.0 * C.xx ;
  // x1 = x0 - i1 + 1.0 * C.xx ;
  // x2 = x0 - 1.0 + 2.0 * C.xx ;
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;

// Permutations
  i = mod289(i); // Avoid truncation effects in permutation
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
    + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;

// Gradients: 41 points uniformly over a line, mapped onto a diamond.
// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

// Normalise gradients implicitly by scaling m
// Approximation of: m *= inversesqrt( a0*a0 + h*h );
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );

// Compute final noise value at P
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}
`,F6e=`
#ifdef ASPECT_CORRECTION
	uniform float scale;
#else
	uniform mat3 uvTransform;
#endif

varying vec2 vUv2;

void mainSupport(const in vec2 uv) {
	#ifdef ASPECT_CORRECTION
		vUv2 = uv * vec2(aspect, 1.0) * scale;
	#else
		vUv2 = (uvTransform * vec3(uv, 1.0)).xy;
	#endif
}
`,B6e=`
uniform float viewheight;
uniform sampler2D splat;

${D6e}
${L6e}
${U6e}
${P6e}

float rectdistance(vec2 uv) {
  vec2 tl = vec2(-1.0);
  vec2 br = vec2(1.0);
  vec2 d = max(tl - uv, uv - br);
  return abs(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)));
}

vec2 bendy(const in vec2 xn, float dn, float sn) {
  // config
  float distortion = 0.0173 + dn; // 0.0173, 0.511
  float scale = 0.991 + sn; // 1.0, 0.7
  // calc
  vec3 xDistorted = vec3((1.0 + vec2(distortion, distortion) * dot(xn, xn)) * xn, 1.0);
  mat3 kk = mat3(
    vec3(1.0, 0.0, 0.0),
    vec3(0.0, 1.0, 0.0),
    vec3(0.0, 0.0, 1.0)
  );
  return (kk * xDistorted).xy * scale;
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
	#ifdef UV_TRANSFORM
		vec4 bright = texture2D(splat, vUv2);
		vec4 dark = texture2D(splat, 1.0 - vUv2);
	#else
		vec4 bright = texture2D(splat, uv);
		vec4 dark = texture2D(splat, 1.0 - uv);
	#endif
  
  float n = 0.1 * snoise(uv.st * 200.0); // Fractal noise
  n += 0.05 * snoise(uv.st * 400.0);
  n += 0.025 * snoise(uv.st * 800.0);

  vec2 xn = 2.0 * (uv.st - 0.5);
  float fz = 0.005;
  vec2 edge = bendy(xn, fz * n, -fz * n);
  vec2 bent = edge.xy * 0.5 + 0.5;
  
  float dx = rectdistance(xn);
  float bx = rectdistance(edge);

  // apply shape
  float doot = max(abs(edge.x), abs(edge.y));
  if (doot < 1.0) {
    // display
    outputColor = texture2D(inputBuffer, bent);

    // apply scratches
    outputColor.rgb = blendLighten(outputColor.rgb, bright.rgb, 0.079);
    outputColor.rgb = blendDarken(outputColor.rgb, dark.rgb, 0.0666);

    // apply halftones
    outputColor.rgb = halftone(outputColor.rgb, uv.st);
  
  } else if (doot > 1.004) {
    // display shell
    // rbgb 205 205 193
    vec3 matte = vec3(205.0 / 255.0, 205.0 / 255.0, 193.0 / 255.0);
    vec3 dkmatte = mix(matte, vec3(0.0), 0.5);
    float mx = pow(1.0 - bx, 16.0) + n;
    outputColor = vec4(mix(matte, dkmatte, mx), inputColor.a);

  } else {
    // border
    outputColor = vec4(mix(vec3(0.0), outputColor.rgb, 0.5), inputColor.a);
  }

  // apply inner shade
  if (doot >= 0.5 && doot < 1.0) {
    float sh = clamp(0.0, 1.0, 1.0 - bx - 0.7);
    vec3 shade = mix(outputColor.rgb, vec3(0.0), pow(sh, 4.0));
    outputColor = vec4(shade, inputColor.a);
  }

  // apply outer shade
  if (doot >= 0.97) {
    float sh = clamp(0.0, 1.0, bx * 24.0);
    vec3 dkout = mix(vec3(0.0), outputColor.rgb, 0.81);
    vec3 shade = mix(dkout, outputColor.rgb, sh);
    outputColor = vec4(shade, inputColor.a);
  }
}
`;class j6e extends vU{constructor({splat:e,viewheight:n}={}){super("CRTShapeEffect",B6e,{blendFunction:fi.NORMAL,attributes:hp.CONVOLUTION,defines:new Map([["TEXEL","texel"],["TEXTURE_PRECISION_HIGH","1"]]),uniforms:new Map([["splat",new qi(e)],["viewheight",new qi(n??128)]])})}get splat(){var e;return(e=this.uniforms.get("splat"))==null?void 0:e.value}set splat(e){const{splat:n,uniforms:r,defines:i}=this,s=r.get("splat"),o=r.get("uvTransform");n!==e&&s&&o&&(s.value=e,o.value=e.matrix,i.delete("TEXTURE_PRECISION_HIGH"),e!==null&&(e.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(F6e)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==Gc&&i.set("TEXTURE_PRECISION_HIGH","1"),(n===null||(n==null?void 0:n.type)!==e.type)&&this.setChanged()))}getTexture(){return this.splat}setTexture(e){this.splat=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){const e=this.splat;return!!(e!=null&&e.matrixAutoUpdate)}set uvTransform(e){const n=this.splat;he(n)&&(n.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,n=e,r=e,i=e){const s="rgba";let o="";(e!==$C.RED||n!==$C.GREEN||r!==$C.BLUE||i!==$C.ALPHA)&&(o=[".",s[e],s[n],s[r],s[i]].join("")),this.defines.set("TEXEL","texel"+o),this.setChanged()}update(){var e;(e=this.splat)!=null&&e.matrixAutoUpdate&&this.splat.updateMatrix()}}const $6e=b6e(j6e),H6e="data:image/gif;base64,R0lGODdhQAAgALMAAIuVpAgMEKy6xRgkIEFQUmJxe73GzZyltDFEWgAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQICgAAACwAAAAAQAAgAAAE/zDISc9EpSAhENBZhmAIQYwFcWgnEojEFFP0VNSupB1nYCCHTypVynBWgFNBGFxpajZoSSANYEyhAhIxCGFDJJDpZDDlrNAaAK2jGK/awUG+4mUIybG2VIoZJDlnaRdRgIQ9S0YEAklEGAUdjU9WGQEzhoM0k5c6lxoAADw8cosrZWEeMwaVnVCcmRN/N5SgH3x1lkB8LwQaIzEWAQOwxDI2JaAjljezRZR/nDkmxS8UgWezay4YazNnPAB8JS8CMdI3f9LUaRszkil/AsE3wC83LimWmuvsULPVgxAYYHSFEEBr/Cj0SHPHoJVeGk4dwCDhVcJ+xNQZEgTtoscAVIL0HXQI0NNHYvQqvpr1r+I2LOZqsNLxh5+gTEu2gZTRy8rNdRZPsnnSJ4YZoRd/4jjWoSLSi0FF7sOh9OkafySLVf1XNVNUrf66Pp1Kw5vQrwmvArokdixSQS3ZuB37aK4ruzPQIo3rMZpTu4AxtQk8dxphvX3HZSUsNAnjwBQNM44AADs=",XP=t=>t===Object(t)&&!Array.isArray(t)&&typeof t!="function";function Z3(t,e){const{gl:n}=KE(),r=dT(tF,XP(t)?Object.values(t):t);return ft.useLayoutEffect(()=>{e==null||e(r)},[e,r]),ft.useEffect(()=>{if("initTexture"in n){let s=[];Array.isArray(r)?s=r:r instanceof wo?s=[r]:XP(r)&&(s=Object.values(r)),s.forEach(o=>{o instanceof wo&&n.initTexture(o)})}},[n,r]),ft.useMemo(()=>{if(XP(t)){const s={};let o=0;for(const a in t)s[a]=r[o++];return s}else return r},[t,r])}Z3.preload=t=>dT.preload(tF,t);Z3.clear=t=>dT.clear(tF,t);function Dz(t){const e=ft.useRef();return n=>{const r=t(n);return(e.current===void 0||r===void 0?e.current===r:ZS(e.current,r))?e.current:e.current=r}}const tg=R_(()=>({desync:!1,gadget:{id:"",layers:[],scroll:[],sidebar:[]}}));var D1=(t=>(t[t.OFF=0]="OFF",t[t.INFO=1]="INFO",t[t.DEBUG=2]="DEBUG",t))(D1||{});const Lz=128;var ju=(t=>(t[t.TOP=0]="TOP",t[t.FULL=1]="FULL",t[t.BOTTOM=2]="BOTTOM",t[t.SPLIT_Y=3]="SPLIT_Y",t[t.SPLIT_Y_ALT=4]="SPLIT_Y_ALT",t[t.MAX=5]="MAX",t))(ju||{});const Ls=R_(()=>({layout:0,inspector:X2(),quickterminal:!1,terminal:{open:!0,level:1,logs:[]},editor:{open:!1,player:"",book:"",path:[],type:"",title:""}})),ia=R_(()=>({scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""]})),No=R_(()=>({id:"",xscroll:0,yscroll:0,cursor:0,select:void 0})),gb=R_(()=>({cursor:void 0,select:void 0})),V6e=new ht,gQ=ft.createContext([]);function Pk(){return ft.useContext(gQ)}function z6e({width:t=0,height:e=0,children:n,...r}){const i=ft.useRef(null),[s]=ft.useState(()=>{const a=[];return t&&a.push(new Sh,new Sh),e&&a.push(new Sh,new Sh),a}),[o]=ft.useState(()=>[new ht(0,0,0),new ht(0,0,0),new ht(0,0,0),new ht(0,0,0),new ht(0,0,0)]);return uT(()=>{if(i.current){const a=i.current.localToWorld(o[0].set(0,0,0)),c=[];if(t){const l=t*.5;c.push(i.current.localToWorld(o[3].set(l,0,0)),i.current.localToWorld(o[4].set(-l,0,0)))}if(e){const l=e*.5;c.push(i.current.localToWorld(o[1].set(0,l,0)),i.current.localToWorld(o[2].set(0,-l,0)))}for(let l=0;l<s.length;l+=1)s[l].setFromNormalAndCoplanarPoint(V6e.subVectors(a,c[l]).normalize(),c[l])}}),Ne.jsx(gQ.Provider,{value:s,children:Ne.jsx("group",{position:[t*.5,e*.5,0],children:Ne.jsx("group",{ref:i,...r,children:Ne.jsx("group",{position:[t*-.5,e*-.5,0],children:n})})})})}const Uz=t=>Symbol.iterator in t,Fz=t=>"entries"in t,Bz=(t,e)=>{const n=t instanceof Map?t:new Map(t.entries()),r=e instanceof Map?e:new Map(e.entries());if(n.size!==r.size)return!1;for(const[i,s]of n)if(!Object.is(s,r.get(i)))return!1;return!0},G6e=(t,e)=>{const n=t[Symbol.iterator](),r=e[Symbol.iterator]();let i=n.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=n.next(),s=r.next()}return!!i.done&&!!s.done};function q6e(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!Uz(t)||!Uz(e)?Bz({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):Fz(t)&&Fz(e)?Bz(t,e):G6e(t,e)}function wp(t){const e=Ph.useRef();return n=>{const r=t(n);return q6e(e.current,r)?e.current:e.current=r}}function W6e(t,e,n,r){const i=e*n*4;for(let s=0,o=0;s<i;++o)t.image.data[s]=r[o]*255,s+=4;return t.needsUpdate=!0,t}function K6e(t,e){const n=new Uint8Array(4*t*e);return new H8(n,t,e)}const Y6e=new Al({transparent:!1,uniforms:{color:{value:new bi(0,0,0)},data:{value:null}},vertexShader:`
      #include <clipping_planes_pars_vertex>
  
      varying vec2 vUv;
    
      void main() {
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * mvPosition;
        
        vUv = uv;
        
        #include <clipping_planes_vertex>
      }
    `,fragmentShader:`
      #include <clipping_planes_pars_fragment>
  
      uniform vec3 color;
      uniform sampler2D data;
  
      varying vec2 vUv;

      // adapted from https://www.shadertoy.com/view/Mlt3z8
      float bayerDither2x2( vec2 v ) {
        return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
      }

      float bayerDither4x4( vec2 v ) {
        vec2 P1 = mod( v, 2.0 );
        vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
        return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
      }

      void main() {
        #include <clipping_planes_fragment>
  
        float alpha = texture2D(data, vUv).r;
        if (alpha < 1.0) {
          vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
          if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
            discard;
          }
        }

        gl_FragColor.rgba = vec4(color.xyz, 1.0);
      }
    `});function X6e(){return J3(Y6e)}const nA=[0,1,0],vQ=[1,1,0],rA=[1,0,0],_Q=[0,0,0],J6e=new Float32Array([...nA,...rA,...vQ,...nA,..._Q,...rA]),Q6e=new Float32Array([...nA.slice(0,2),...rA.slice(0,2),...vQ.slice(0,2),...nA.slice(0,2),..._Q.slice(0,2),...rA.slice(0,2)]);function Z6e(t,e,n,r,i,s){const o=e*n*4;for(let a=0,c=0;a<o;++c){const l=r[c]??0;t.image.data[a++]=l%Rd,t.image.data[a++]=Math.floor(l/Rd),t.image.data[a++]=i[c]??16,t.image.data[a++]=s[c]??16}return t.needsUpdate=!0,t}function e8e(t,e){const n=new Uint8Array(4*t*e),r=new H8(n,t,e,EA,Gc);return r.internalFormat="RGBA8UI",r}function yQ(t,e,n){const r=e*ar.DRAW_CHAR_WIDTH(),i=n*ar.DRAW_CHAR_HEIGHT(),s=J6e.map((o,a)=>{switch(a%3){case 0:return o*r;case 1:return o*i;default:return o}});t.setAttribute("position",new oo(s,3)),t.setAttribute("uv",new oo(Q6e,2)),t.computeBoundingBox(),t.computeBoundingSphere()}const t8e=CR(wT(OA)),jz=iw(TT(IA)),n8e=new Al({transparent:!1,uniforms:{time:Eh,interval:X3,palette:new qi(t8e),map:new qi(jz),alt:new qi(jz),data:new qi(null),size:{value:new Vn},step:{value:new Vn}},vertexShader:`
    #include <clipping_planes_pars_vertex>
    varying vec2 vUv;
    void main() {
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      gl_Position = projectionMatrix * mvPosition;
      vUv = uv;
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform usampler2D data;
    uniform vec3 palette[16];
    uniform vec2 size;
    uniform vec2 step;
    varying vec2 vUv;

    void main() {
      #include <clipping_planes_fragment>

      uvec4 tiledata = texture(data, vUv);
      int colori = int(tiledata.z);
      int bgi = int(tiledata.w);

      vec2 charPosition = mod(vUv, size) / size;
      vec2 uv = vec2(charPosition.x * step.x, charPosition.y * step.y);
      vec3 color = palette[colori];

      uv.x += step.x * float(tiledata.x);
      uv.y += step.y * float(tiledata.y);
      uv.y = 1.0 - uv.y;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${cr.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function r8e(){return J3(n8e)}function Dk({width:t,height:e,alphas:n}){const r=Pk(),i=ft.useRef(null),[s]=ft.useState(()=>X6e());return ft.useEffect(()=>{s.uniforms.data.value=K6e(t,e)},[s.uniforms.data,t,e]),ft.useEffect(()=>{W6e(s.uniforms.data.value,t,e,n)},[s.uniforms.data.value,t,e,n]),ft.useEffect(()=>{i.current&&(yQ(i.current,t,e),s.clipping=r.length>0,s.clippingPlanes=r,s.needsUpdate=!0)},[s,r,t,e]),Ne.jsx("mesh",{material:s,children:Ne.jsx("bufferGeometry",{ref:i})})}function i8e({width:t,height:e,alpha:n}){const r=ft.useMemo(()=>new Array(t*e).fill(n),[t,e,n]);return Ne.jsx(Dk,{width:t,height:e,alphas:r})}const kS=new sce,h0=new Vn;function iA({width:t,height:e,top:n,left:r,right:i,bottom:s,scale:o=.125,alpha:a=.25}){const c=ft.useMemo(()=>{const l=new Array(t*e);kS.min.x=r,kS.min.y=n,kS.max.x=i,kS.max.y=s,h0.x=0,h0.y=0;for(let u=0;u<l.length;++u)l[u]=Lne.smootherstep(1-kS.distanceToPoint(h0)*o,0,1)*a,++h0.x,h0.x>=t&&(h0.x=0,++h0.y);return l},[t,e,n,r,i,s,o,a]);return Ne.jsx(Dk,{width:t,height:e,alphas:c})}const s8e=RW,o8e=CR(wT(OA)),$z=iw(TT(IA)),a8e=new Al({transparent:!1,uniforms:{time:Eh,interval:X3,smoothrate:new qi(s8e),palette:new qi(o8e),map:new qi($z),alt:new qi($z),dpr:new qi(1),pointSize:{value:new Vn(1,1)},rows:new qi(1),step:new qi(new Vn)},vertexShader:`
    #include <clipping_planes_pars_vertex>

    attribute float visible;
    attribute vec4 charData;
    attribute vec3 lastPosition;
    attribute vec2 lastColor;
    attribute vec2 lastBg;
    attribute vec2 animShake;
    attribute vec2 animBounce;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float tindex;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    float rand(float co) {
      return fract(sin(co*(91.3458)) * 47453.5453);
    }

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    void main() {
      vVisible = visible;

      float deltaPosition = clamp((time - lastPosition.z) * smoothrate, 0.0, 1.0);
      vec2 animPosition = mix(lastPosition.xy, position.xy, deltaPosition);

      float deltaShake = 1.0 - animDelta(animShake.y, smoothrate * 0.5, 1.0); 
      animPosition += vec2(
        deltaShake - rand(cos(time) + animShake.x) * deltaShake * 2.0,
        deltaShake - rand(sin(time) + animShake.x) * deltaShake * 2.0
      ) * 0.5;

      float deltaBounce = 1.0 - abs(1.0 - animDelta(animBounce.y, smoothrate, 2.0));
      animPosition.y -= smoothstep(0.0, 1.0, deltaBounce);

      float deltaColor = animDelta(lastColor.y, smoothrate, 1.0);
      vec3 sourceColor = colorFromIndex(lastColor.x);
      vec3 destColor = colorFromIndex(charData.z);
      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastBg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastBg.x);
      vec4 destBg = bgFromIndex(charData.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      vCharData.xy = charData.xy;

      animPosition = animPosition * pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x += (pointSize.y - pointSize.x) * 0.5;

      vec4 mvPosition = modelViewMatrix * vec4(animPosition, 0.0, 1.0);
      gl_Position = projectionMatrix * mvPosition;      

      // this handles things being scaled
      gl_PointSize = pointSize.y * modelViewMatrix[0][0] * dpr;
      
      #include <clipping_planes_vertex>
    }
  `,fragmentShader:`
    #include <clipping_planes_pars_fragment>

    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 pointSize;

    varying float vVisible;
    varying vec2 vCharData;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      #include <clipping_planes_fragment>

      float xscale = pointSize.y / pointSize.x;
      float px = gl_PointCoord.x * xscale;
      
      if (vVisible == 0.0 || px >= 1.0) {
        discard;
      }

      vec2 lookup = vec2(vCharData.x, vCharData.y);

      vec2 idx = vec2(px, 1.0 - gl_PointCoord.y);
      vec2 char = vec2(lookup.x * step.x, (rows - lookup.y) * step.y);
      vec2 uv = idx * step + char;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 1.0) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function c8e(){return J3(a8e)}const Hz=2048;function l8e({sprites:t}){const e=U0(u=>u.palettedata),n=U0(u=>u.charsetdata),r=U0(u=>u.altcharsetdata),i=Pk(),s=ft.useRef(null),o=ft.useRef([]),[a]=ft.useState(()=>c8e()),{width:c=0,height:l=0}=(n==null?void 0:n.image)??{};return ft.useMemo(()=>{var f;o.current.length===0&&(o.current=Array.from({length:Hz},()=>({id:"",x:0,y:0,char:0,color:0,bg:0})));const u={};for(let p=0;p<t.length;++p)u[t[p].id]=t[p];const d=new Set(o.current.map(p=>p.id));let h=0;for(let p=0;p<Hz;++p)if(o.current[p].id){const g=u[o.current[p].id];he(g)?o.current[p]={...g}:o.current[p].id=""}else if(h<t.length){for(;d.has((f=t[h])==null?void 0:f.id)===!0;)++h;h<t.length&&(o.current[p]={...t[h++]})}},[t]),ft.useEffect(()=>{const{current:u}=s,{current:d}=o;if(!u||!d)return;let h=u.getAttribute("visible"),f=u.getAttribute("lastVisible"),p=u.getAttribute("position"),g=u.getAttribute("charData"),v=u.getAttribute("lastPosition"),E=u.getAttribute("lastColor"),T=u.getAttribute("lastBg"),C=u.getAttribute("animShake"),A=u.getAttribute("animBounce");if(!h||h.count!==d.length){h=new oo(new Float32Array(d.length),1),f=new oo(new Float32Array(d.length),1),p=new oo(new Float32Array(d.length*3),3),g=new oo(new Float32Array(d.length*4),4),v=new oo(new Float32Array(d.length*3),3),E=new oo(new Float32Array(d.length*2),2),T=new oo(new Float32Array(d.length*2),2),C=new oo(new Float32Array(d.length*2),2),A=new oo(new Float32Array(d.length*2),2);for(let k=0;k<d.length;++k){const I=d[k],N=I.id?1:0;h.setX(k,N),f.setX(k,N),p.setXY(k,I.x,I.y),g.setXYZW(k,I.char%Rd,Math.floor(I.char/Rd),I.color,I.bg),v.setXYZ(k,I.x,I.y,Eh.value),E.setXY(k,I.color,Eh.value),T.setXY(k,I.bg,Eh.value),C.setXY(k,0,Eh.value-1e6),A.setXY(k,0,Eh.value-1e6)}u.setAttribute("visible",h),u.setAttribute("lastVisible",f),u.setAttribute("position",p),u.setAttribute("charData",g),u.setAttribute("lastPosition",v),u.setAttribute("lastColor",E),u.setAttribute("lastBg",T),u.setAttribute("animShake",C),u.setAttribute("animBounce",A)}else for(let k=0;k<d.length;++k){const I=d[k],N=p.getX(k),U=p.getY(k),F=g.getX(k),$=g.getY(k),X=g.getZ(k),q=g.getW(k);f.setX(k,h.getX(k)),f.needsUpdate=!0,h.setX(k,I.id?1:0),h.needsUpdate=!0;const W=f.getX(k)===0&&h.getX(k)===1;(W||N!==I.x||U!==I.y)&&(v.setXYZ(k,W?I.x:N,W?I.y:U,Eh.value),v.needsUpdate=!0,p.setXY(k,I.x,I.y),p.needsUpdate=!0),(W||X!==I.color)&&(E.setXY(k,W?I.color:X,Eh.value),E.needsUpdate=!0,g.setZ(k,I.color),g.needsUpdate=!0),(W||q!==I.bg)&&(T.setXY(k,W?I.bg:q,Eh.value),T.needsUpdate=!0,g.setW(k,I.bg),g.needsUpdate=!0);const K=I.char%Rd,ne=Math.floor(I.char/Rd);(F!==K||$!==ne)&&(g.setXY(k,K,ne),g.needsUpdate=!0)}u.computeBoundingBox(),u.computeBoundingSphere()},[t]),ft.useEffect(()=>{if(!n||!s.current)return;const u=Math.round(c/Gv),d=Math.round(l/qv);a.uniforms.palette.value=e,a.uniforms.map.value=n,a.uniforms.alt.value=r??n,a.uniforms.dpr.value=window.devicePixelRatio,a.uniforms.pointSize.value.x=ar.DRAW_CHAR_WIDTH(),a.uniforms.pointSize.value.y=ar.DRAW_CHAR_HEIGHT(),a.uniforms.rows.value=d-1,a.uniforms.step.value.x=1/u,a.uniforms.step.value.y=1/d,a.clipping=i.length>0,a.clippingPlanes=i,a.needsUpdate=!0},[e,n,r,a,c,l,i]),Ne.jsx("points",{frustumCulled:!1,material:a,children:Ne.jsx("bufferGeometry",{ref:s})})}function bQ({width:t,height:e,char:n,color:r,bg:i}){const s=U0(f=>f.palettedata),o=U0(f=>f.charsetdata),a=U0(f=>f.altcharsetdata),c=Pk(),[l]=ft.useState(()=>r8e()),u=ft.useRef(null),{width:d=0,height:h=0}=(o==null?void 0:o.image)??{};return ft.useEffect(()=>{t===0||e===0||(l.uniforms.data.value=e8e(t,e))},[l.uniforms.data,t,e]),ft.useEffect(()=>{t===0||e===0||Z6e(l.uniforms.data.value,t,e,n,r,i)},[l.uniforms.data.value,t,e,n,r,i]),ft.useEffect(()=>{t===0||e===0||!u.current||!o||(yQ(u.current,t,e),l.uniforms.map.value=o,l.uniforms.alt.value=a??o,l.uniforms.palette.value=s,l.uniforms.size.value.x=1/t,l.uniforms.size.value.y=1/e,l.uniforms.step.value.x=1/Math.round(d/Gv),l.uniforms.step.value.y=1/Math.round(h/qv),l.clipping=c.length>0,l.clippingPlanes=c,l.needsUpdate=!0)},[s,o,a,l,t,e,d,h,c]),Ne.jsx("mesh",{material:l,children:Ne.jsx("bufferGeometry",{ref:u})})}function u8e({id:t,z:e}){const n=U0(),r=tg(wp(s=>{var o;return(o=s.gadget.layers)==null?void 0:o.find(a=>a.id===t)})),i=(r==null?void 0:r.type)===v0.MEDIA?r:void 0;switch(ft.useEffect(()=>{switch(i==null?void 0:i.mime){case"image/palette":Lr(i.media)&&n.setpalette(XN(_E,Wq,i.media));break;case"image/charset":Lr(i.media)&&n.setcharset(XN(Rd*Gv,DL*qv,i.media));break;case"image/altcharset":Lr(i.media)&&n.setaltcharset(XN(Rd*Gv,DL*qv,i.media));break}},[n,i]),r==null?void 0:r.type){default:case v0.BLANK:case v0.MEDIA:return null;case v0.TILES:return Ne.jsx("group",{position:[0,0,e],children:Ne.jsx(bQ,{width:r.width,height:r.height,char:[...r.char],color:[...r.color],bg:[...r.bg]})},r.id);case v0.SPRITES:return Ne.jsx("group",{position:[0,0,e],children:Ne.jsx(l8e,{sprites:[...r.sprites]})},r.id);case v0.DITHER:return Ne.jsx("group",{position:[0,0,e],children:Ne.jsx(Dk,{width:r.width,height:r.height,alphas:[...r.alphas]})},r.id)}}function Vz(){}const d8e=Ph.forwardRef(function({args:e,children:n,...r},i){const s=Ph.useRef(null);return Ph.useImperativeHandle(i,()=>s.current),Ne.jsxs("mesh",{ref:s,...r,children:[Ne.jsx("planeGeometry",{attach:"geometry",args:e}),n]})}),zu=Ph.forwardRef(function({blocking:e=!1,cursor:n="default",x:r=0,y:i=0,z:s=0,width:o=1,height:a=1,opacity:c=1,visible:l=!0,color:u="white",...d},h){const f=o*.5,p=a*.5,g=[(r+f)*ar.DRAW_CHAR_WIDTH(),(i+p)*ar.DRAW_CHAR_HEIGHT(),s],v=Pk();return Ne.jsx(d8e,{ref:h,args:[o*ar.DRAW_CHAR_WIDTH(),a*ar.DRAW_CHAR_HEIGHT()],userData:{blocking:e,cursor:n,clippingPlanes:v},onClick:e?Vz:void 0,onPointerMove:e?Vz:void 0,position:g,...d,children:Ne.jsx("meshBasicMaterial",{color:u,opacity:c,visible:l,transparent:c!==1,clippingPlanes:v})})}),sA=new ht;function zz(){const t=ar.DRAW_CHAR_WIDTH(),e=ar.DRAW_CHAR_HEIGHT(),n=Math.floor(sA.x/t),r=Math.floor((sA.y+e*.5)/e);return{x:n,y:Il*.5+r}}function h8e(){const t=Ls(u=>u.inspector),[e,n]=gb(wp(u=>[u.cursor,u.select])),r=lH(e??0,ts),i=lH(n??e??0,ts),s={x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},o={x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)},a=o.x-s.x+1,c=o.y-s.y+1;function l(){gb.getState().cursor&&Jle(qe,s,o,Ci()),gb.setState(()=>({cursor:void 0,select:void 0}))}return Ne.jsxs(Ne.Fragment,{children:[t?Ne.jsx(zu,{visible:!0,x:0,y:0,z:-1,width:ts,height:Il,color:"black",cursor:"pointer",onPointerDown:u=>{u.intersections[0].object.worldToLocal(sA.copy(u.intersections[0].point));const d=zz();gb.setState(()=>({cursor:Sw(d,ts)}))},onPointerMove:u=>{if(he(gb.getState().cursor)){u.intersections[0].object.worldToLocal(sA.copy(u.intersections[0].point));const d=zz();gb.setState(()=>({select:Sw(d,ts)}))}},onPointerUp:l,onPointerOut:l,onPointerCancel:l}):Ne.jsx(zu,{visible:!0,x:0,y:0,z:-1,width:ts,height:Il,color:"black"}),he(e)&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(zu,{x:s.x+.25,y:s.y+.25,z:100,width:a-.5,height:c-.5,color:"black",opacity:.3}),Ne.jsx(zu,{x:s.x,y:s.y,z:101,width:a,height:c,color:"white",opacity:.25})]})]})}var e4={};Object.defineProperty(e4,"__esModule",{value:!0});var EQ=e4.GamepadHelper=void 0;const ro=class ro{static getButtonValue(e,n){var r,i;return(i=(r=ro.gamepads[e])==null?void 0:r.buttons[n])==null?void 0:i.value}static getAxisValue(e,n){var r;return(r=ro.gamepads[e])==null?void 0:r.axes[n]}static update(){ro.checkForNewGamepads(),!(!ro.gamepads||Object.keys(ro.gamepads).length<1)&&(ro.gamepadsLastUpdate&&Object.keys(ro.gamepadsLastUpdate).length>0&&Object.values(ro.gamepads).forEach(e=>{var n;for(let r=0;r<e.buttons.length;r++){const i=(n=ro.gamepadsLastUpdate[e.index])==null?void 0:n.buttons[r],s=e.buttons[r];(s==null?void 0:s.value)==1&&(i==null?void 0:i.value)==0?ro.dispatchButtonDownEvent(e.index,r):(s==null?void 0:s.value)==0&&(i==null?void 0:i.value)==1&&ro.dispatchButtonUpEvent(e.index,r)}}),ro.gamepadsLastUpdate=Object.assign({},ro.gamepads))}static checkForNewGamepads(){const e=navigator.getGamepads();for(const n of e)n&&(ro.gamepads[n.index]||ro.logOutput&&console.log("gamepad "+n.index+" connected"),ro.gamepads[n.index]=n)}static dispatchButtonDownEvent(e,n){ro.logOutput&&console.log(`gamepad ${e}: button ${n} is down`),document.dispatchEvent(new CustomEvent("gamepadbuttondown",{detail:{gamepad:e,button:n}}))}static dispatchButtonUpEvent(e,n){ro.logOutput&&console.log(`gamepad ${e}: button ${n} is up`),document.dispatchEvent(new CustomEvent("gamepadbuttonup",{detail:{gamepad:e,button:n}}))}};Gn(ro,"gamepads",{}),Gn(ro,"gamepadsLastUpdate"),Gn(ro,"logOutput",!1);let yU=ro;EQ=e4.GamepadHelper=yU;var Ag={};Object.defineProperty(Ag,"__esModule",{value:!0});var f8e=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),JP={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},SQ={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:f8e?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},t4={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(var HC=1;HC<20;HC++)t4["f"+HC]=111+HC;function Lk(t,e,n){e&&!("byKey"in e)&&(n=e,e=null),Array.isArray(t)||(t=[t]);var r=t.map(function(o){return wQ(o,e)}),i=function(a){return r.some(function(c){return TQ(c,a)})},s=n==null?i:i(n);return s}function p8e(t,e){return Lk(t,e)}function m8e(t,e){return Lk(t,{byKey:!0},e)}function wQ(t,e){var n=e&&e.byKey,r={};t=t.replace("++","+add");var i=t.split("+"),s=i.length;for(var o in JP)r[JP[o]]=!1;var a=!0,c=!1,l=void 0;try{for(var u=i[Symbol.iterator](),d;!(a=(d=u.next()).done);a=!0){var h=d.value,f=h.endsWith("?")&&h.length>1;f&&(h=h.slice(0,-1));var p=n4(h),g=JP[p];if(h.length>1&&!g&&!SQ[h]&&!t4[p])throw new TypeError('Unknown modifier: "'+h+'"');(s===1||!g)&&(n?r.key=p:r.which=xQ(h)),g&&(r[g]=f?null:!0)}}catch(v){c=!0,l=v}finally{try{!a&&u.return&&u.return()}finally{if(c)throw l}}return r}function TQ(t,e){for(var n in t){var r=t[n],i=void 0;if(r!=null&&(n==="key"&&e.key!=null?i=e.key.toLowerCase():n==="which"?i=r===91&&e.which===93?91:e.which:i=e[n],!(i==null&&r===!1)&&i!==r))return!1}return!0}function xQ(t){t=n4(t);var e=t4[t]||t.toUpperCase().charCodeAt(0);return e}function n4(t){return t=t.toLowerCase(),t=SQ[t]||t,t}var g8e=Ag.default=Lk;Ag.isHotkey=Lk;Ag.isCodeHotkey=p8e;Ag.isKeyHotkey=m8e;Ag.parseHotkey=wQ;Ag.compareHotkey=TQ;Ag.toKeyCode=xQ;Ag.toKeyName=n4;function CQ(t){return{all:t=t||new Map,on:function(e,n){var r=t.get(e);r?r.push(n):t.set(e,[n])},off:function(e,n){var r=t.get(e);r&&(n?r.splice(r.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var r=t.get(e);r&&r.slice().map(function(i){i(n)}),(r=t.get("*"))&&r.slice().map(function(i){i(e,n)})}}}const rp={[Kt.NONE]:!1,[Kt.ALT]:!1,[Kt.CTRL]:!1,[Kt.SHIFT]:!1,[Kt.MOVE_UP]:!1,[Kt.MOVE_DOWN]:!1,[Kt.MOVE_LEFT]:!1,[Kt.MOVE_RIGHT]:!1,[Kt.OK_BUTTON]:!1,[Kt.CANCEL_BUTTON]:!1,[Kt.MENU_BUTTON]:!1};let L1=0,Gz=performance.now();const Qw=200;function RQ(){const t=performance.now(),e=t-Gz;if(L1+=e,L1>=Qw){L1%=Qw;const n={alt:!!rp[Kt.ALT],ctrl:!!rp[Kt.CTRL],shift:!!rp[Kt.SHIFT]};[Kt.MOVE_UP,Kt.MOVE_DOWN,Kt.MOVE_LEFT,Kt.MOVE_RIGHT,Kt.OK_BUTTON,Kt.CANCEL_BUTTON,Kt.MENU_BUTTON].forEach(i=>{rp[i]&&MQ(i,n)})}Gz=t,EQ.update(),setTimeout(RQ,100)}RQ();function El(t){rp[t]||(L1=0,MQ(t,{alt:rp[Kt.ALT],ctrl:rp[Kt.CTRL],shift:rp[Kt.SHIFT]})),rp[t]=!0}function Aa(t){rp[t]=!1}const Qf={root:CQ(),ignorehotkeys:!1},AQ=ft.createContext(Qf.root);function Uk(t){return{alt:t.altKey,ctrl:DT?t.metaKey:t.ctrlKey,shift:t.shiftKey}}function MQ(t,e){Qf.root.emit(Kt[t],e)}document.addEventListener("keydown",t=>{const e=rr(t.key),n=Uk(t);switch(e){case"s":case"o":case"p":case"f":case"arrowleft":case"arrowright":case"arrowup":case"arrowdown":n.ctrl&&t.preventDefault();break;case"tab":t.preventDefault();break}switch(n.alt?El(Kt.ALT):Aa(Kt.ALT),n.ctrl?El(Kt.CTRL):Aa(Kt.CTRL),n.shift?El(Kt.SHIFT):Aa(Kt.SHIFT),e){case"arrowleft":El(Kt.MOVE_LEFT);break;case"arrowright":El(Kt.MOVE_RIGHT);break;case"arrowup":El(Kt.MOVE_UP);break;case"arrowdown":El(Kt.MOVE_DOWN);break;case"enter":El(Kt.OK_BUTTON);break;case"esc":case"escape":El(Kt.CANCEL_BUTTON);break;case"tab":El(Kt.MENU_BUTTON);break;case"s":n.ctrl&&fE(qe,"#save",Ci());break;case"f":n.ctrl&&fE(qe,"#fork",Ci());break}Qf.root.emit("keydown",t)},{capture:!0});document.addEventListener("keyup",t=>{const e=rr(t.key),n=Uk(t);switch(n.alt?El(Kt.ALT):Aa(Kt.ALT),n.ctrl?El(Kt.CTRL):Aa(Kt.CTRL),n.shift?El(Kt.SHIFT):Aa(Kt.SHIFT),e){case"meta":Aa(Kt.MOVE_LEFT),Aa(Kt.MOVE_RIGHT),Aa(Kt.MOVE_UP),Aa(Kt.MOVE_DOWN);break;case"arrowleft":Aa(Kt.MOVE_LEFT);break;case"arrowright":Aa(Kt.MOVE_RIGHT);break;case"arrowup":Aa(Kt.MOVE_UP);break;case"arrowdown":Aa(Kt.MOVE_DOWN);break;case"enter":Aa(Kt.OK_BUTTON);break;case"esc":case"escape":Aa(Kt.CANCEL_BUTTON);break;case"tab":Aa(Kt.MENU_BUTTON);break}},{capture:!0});Wh("userinput",["tock"],t=>{switch(t.target){case"up":Mn(t.data)&&Aa(t.data);break;case"down":Mn(t.data)&&El(t.data);break}});const v8e=0,_8e=1,y8e=2,b8e=3,E8e=4,S8e=5,w8e=6,T8e=7,x8e=9,C8e=12,R8e=13,A8e=14,M8e=15,IQ={[v8e]:Kt.OK_BUTTON,[_8e]:Kt.CANCEL_BUTTON,[y8e]:Kt.OK_BUTTON,[b8e]:Kt.CANCEL_BUTTON,[E8e]:Kt.ALT,[S8e]:Kt.CTRL,[w8e]:Kt.SHIFT,[T8e]:Kt.SHIFT,[x8e]:Kt.MENU_BUTTON,[C8e]:Kt.MOVE_UP,[R8e]:Kt.MOVE_DOWN,[A8e]:Kt.MOVE_LEFT,[M8e]:Kt.MOVE_RIGHT};document.addEventListener("gamepadbuttondown",t=>{El(IQ[t.detail.button])});document.addEventListener("gamepadbuttonup",t=>{Aa(IQ[t.detail.button])});const qz="keyup";function rE({hotkey:t,children:e}){return ft.useEffect(()=>{const n=g8e(t,{byKey:!0});function r(i){Qf.ignorehotkeys===!1&&n(i)&&e()}return document.addEventListener(qz,r,!1),()=>document.removeEventListener(qz,r,!1)},[t,e]),null}function da(t){const e=ft.useContext(AQ);return ft.useEffect(()=>{const n=Object.entries(t);return n.forEach(([r,i])=>e.on(r,i)),()=>{n.forEach(([r,i])=>e.off(r,i))}},[e,t]),null}function Ry({blockhotkeys:t,children:e}){const[n]=ft.useState(()=>CQ());return ft.useEffect(()=>{const r=Qf.root,i=Qf.ignorehotkeys;return Qf.root=n,Qf.ignorehotkeys=!!t,()=>{Qf.root=r,Qf.ignorehotkeys=i}},[n,t]),Ne.jsx(AQ.Provider,{value:n,children:e})}const I8e=new Vn(0,0);function f0(t,e,n){let r=0;n.alt&&(r|=Kq),n.ctrl&&(r|=Yq),n.shift&&(r|=Xq),CG(t)&&Xle(qe,e,r,t)}function O8e({width:t,height:e}){const n=t*ar.DRAW_CHAR_WIDTH(),r=e*ar.DRAW_CHAR_HEIGHT(),i=ft.useRef(null);uT((a,c)=>{const{current:l}=i;if(!l)return;const u=K_e(tg.getState().gadget.layers??[]),d=u.width*ar.DRAW_CHAR_WIDTH()*u.viewscale,h=d-n,f=u.height*ar.DRAW_CHAR_HEIGHT()*u.viewscale,p=f-r,g=Math.round(Math.min(n,r)*.3333),v=-u.focusx*ar.DRAW_CHAR_WIDTH()*u.viewscale,E=n*.5+v,T=-u.focusy*ar.DRAW_CHAR_HEIGHT()*u.viewscale,C=r*.5+T,A=d<n?h*-.5:E,k=f<r?p*-.5:C;if(he(l.userData.focus)||(l.position.x=A,l.position.y=k,l.userData.focus=I8e,l.userData.focus.x=A,l.userData.focus.y=k),l.scale.setScalar(u.viewscale),h<0)l.userData.focus.x=A;else{const N=l.position.x-A;if(Math.abs(N)>=g){const U=N<0?-g:g;l.userData.focus.x=Math.round(A-U)}}if(p<0)l.userData.focus.y=k;else{const N=l.position.y-k;if(Math.abs(N)>=g){const U=N<0?-g:g;l.userData.focus.y=Math.round(k-U*.5)}}const I=6;l.position.x+=(l.userData.focus.x-l.position.x)*c*I,l.position.y+=(l.userData.focus.y-l.position.y)*c*I,h>=0&&(l.position.x=xi(l.position.x,-h,0)),p>=0&&(l.position.y=xi(l.position.y,-p,0))});const s=Ci();tg(a=>{var c;return((c=a.gadget.layers)==null?void 0:c.length)??0});const{layers:o=[]}=tg.getState().gadget;return Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(da,{MOVE_LEFT:a=>f0(s,Kt.MOVE_LEFT,a),MOVE_RIGHT:a=>f0(s,Kt.MOVE_RIGHT,a),MOVE_UP:a=>f0(s,Kt.MOVE_UP,a),MOVE_DOWN:a=>f0(s,Kt.MOVE_DOWN,a),OK_BUTTON:a=>f0(s,Kt.OK_BUTTON,a),CANCEL_BUTTON:a=>f0(s,Kt.CANCEL_BUTTON,a),MENU_BUTTON:a=>f0(s,Kt.MENU_BUTTON,a),keydown:a=>{const{key:c}=a;switch(rr(c)){case"t":jle(qe,Ci());break}}}),o.length>0&&Ne.jsx(zu,{visible:!0,color:new bi(.076,.076,0),width:t,height:e,z:-2}),Ne.jsx(z6e,{width:n,height:r,children:Ne.jsxs("group",{ref:i,children:[Ne.jsx(h8e,{}),o.map((a,c)=>Ne.jsx(u8e,{id:a.id,z:c*2},a.id))]})})]})}const Lp=ft.createContext({sendmessage(){},sendclose(){},didclose(){}}),Wz={input:{color:"$white",active:"$yellow"}};function $d(t){return t?Wz.input.active:Wz.input.color}function vx(t,e){switch(t){case"touchkey":return`register:${t}:${e}`}return`vm:${t}:${e}`}function YS(t,e,n=0,r=""){return`${t.substring(0,e)}${r}${t.substring(e+n)}`}function Xu(t,e){he(t)&&(e.x=1,e.y=t)}const Rv=32,OQ=8,bU=new ht;function k8e(){const t=ar.DRAW_CHAR_WIDTH(),e=ar.DRAW_CHAR_HEIGHT(),n=Math.floor(bU.x/t),r=Math.floor(bU.y/e);return{x:Rv*.5+n,y:OQ*.5+r}}function N8e({chip:t,row:e,label:n,args:r,context:i}){Xu(e,i);const[s]=[tc(r[0],"")],o=x_(t,s),a=PT(o),l=(a==null?void 0:a.value)??0,u=Fd(),[d,h]=ft.useState(!1);ft.useLayoutEffect(()=>{h(!0)},[]);const f=`${l}`.padStart(3,"0"),p=n.trim(),g=i.x-1,v=i.y+2,E=[`$green${p} ${f}
$white`];for(let F=0;F<256;++F)if(F%Rv===0&&E.push(`
`),F===l){const $=u?"$green$onwhite":"$white$ongreen";E.push(`${$}$${F}$white$ondkblue`)}else E.push(`$${F}`);const T=E.join("");qn(T,i,!0);const C=ft.useContext(Lp),A=ft.useCallback(()=>{l>=Rv&&Za(o,l-Rv)},[o,l]),k=ft.useCallback(()=>{l>0&&Za(o,l-1)},[o,l]),I=ft.useCallback(()=>{l<255&&Za(o,l+1)},[o,l]),N=ft.useCallback(()=>{l<=255-Rv&&Za(o,l+Rv)},[o,l]),U=ft.useCallback(()=>{C.sendclose()},[C]);return Ne.jsx("group",{position:[g*ar.DRAW_CHAR_WIDTH(),v*ar.DRAW_CHAR_HEIGHT(),1],children:d&&Ne.jsxs(Ry,{blockhotkeys:!0,children:[Ne.jsx(zu,{blocking:!0,visible:!1,width:Rv,height:OQ,onClick:F=>{F.intersections[0].object.worldToLocal(bU.copy(F.intersections[0].point));const $=Sw(k8e(),Rv);$>=0&&$<=255&&(Za(o,$),C.sendclose())}}),Ne.jsx(da,{MOVE_LEFT:k,MOVE_UP:A,MOVE_RIGHT:I,MOVE_DOWN:N,OK_BUTTON:U,CANCEL_BUTTON:U})]})})}const Av=8,kQ=2,EU=new ht;function P8e(){const t=ar.DRAW_CHAR_WIDTH(),e=ar.DRAW_CHAR_HEIGHT(),n=Math.floor(EU.x/t),r=Math.floor(EU.y/e);return{x:Av*.5+n,y:kQ*.5+r}}function D8e({chip:t,row:e,label:n,args:r,context:i}){Xu(e,i);const[s]=[tc(r[0],"")],o=x_(t,s),a=PT(o),l=(a==null?void 0:a.value)??0,u=Fd(),[d,h]=ft.useState(!1);ft.useLayoutEffect(()=>{h(!0)},[]);const f=`${l}`.padStart(2,"0"),p=n.trim(),g=(cr[l]||cr[cr.BLACK]).padEnd(12," ").toLowerCase(),v=i.x-1,E=i.y+2,T=[`$green${p} ${f} ${g}
$white`];for(let F=0;F<16;++F)if(F%Av===0&&T.push(`
`),F===l){const $=F<8?"$white":"$black",X=u?$:`$${cr[F]}`;T.push(`${X}$219`)}else T.push(`$${cr[F]}$219`);T.push("$white"),qn(T.join(""),i,!0);const C=ft.useContext(Lp),A=ft.useCallback(()=>{l>=Av&&Za(o,l-Av)},[o,l]),k=ft.useCallback(()=>{l>0&&Za(o,l-1)},[o,l]),I=ft.useCallback(()=>{l<15&&Za(o,l+1)},[o,l]),N=ft.useCallback(()=>{l<=15-Av&&Za(o,l+Av)},[o,l]),U=ft.useCallback(()=>{C.sendclose()},[C]);return Ne.jsx("group",{position:[v*ar.DRAW_CHAR_WIDTH(),E*ar.DRAW_CHAR_HEIGHT(),1],children:d&&Ne.jsxs(Ry,{blockhotkeys:!0,children:[Ne.jsx(zu,{blocking:!0,visible:!1,width:Av,height:kQ,onClick:F=>{F.intersections[0].object.worldToLocal(EU.copy(F.intersections[0].point));const $=P8e(),X=Sw($,Av);X>=0&&X<=16&&(Za(o,X),C.sendclose())}}),Ne.jsx(da,{MOVE_LEFT:k,MOVE_UP:A,MOVE_RIGHT:I,MOVE_DOWN:N,OK_BUTTON:U,CANCEL_BUTTON:U})]})})}function L8e({item:t,row:e,context:n}){return Xu(e,n),qn(`${t}${he(e)?`
`:""}`,n,!0),null}function U8e({chip:t,row:e,active:n,label:r,args:i,context:s}){Xu(e,s);const[o,a]=[tc(i[0],""),i[1]],c=$d(n);qn(`  $purple$16 ${c}${r}
`,s,!0);const l=ft.useContext(Lp),u=ft.useCallback(()=>{l.sendmessage(vx(t,o),a),l.sendclose()},[l,t,o,a]);return n&&Ne.jsx(da,{OK_BUTTON:u})}function F8e({chip:t,row:e,active:n,label:r,args:i,context:s}){var v;Xu(e,s);const[o,a,c,l]=[tc(i[0],""),tc(i[1],((v=i[1])==null?void 0:v.toString())??""),tc(i[2],""),tc(i[3],"")],u=c||` ${a.toUpperCase()} `,d=$d(n),h=s.x-.25,f=s.y-.25;qn(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${u}${d}$onclear ${r}${he(e)?`
`:""}`,s,!0);const p=ft.useContext(Lp),g=ft.useCallback(()=>{p.sendmessage(vx(t,o)),l||p.sendclose()},[t,p,o,l]);return Ne.jsxs("group",{position:[h*ar.DRAW_CHAR_WIDTH(),f*ar.DRAW_CHAR_HEIGHT(),1],children:[Ne.jsx(zu,{visible:!1,width:u.length+.5,height:1.5,blocking:!0,onClick:g}),n&&Ne.jsx(da,{OK_BUTTON:g}),a&&Ne.jsx(rE,{hotkey:a,children:g})]})}function B8e({chip:t,row:e,active:n,label:r,args:i,context:s}){Xu(e,s);const[o,a]=[tc(i[0],""),i[1]],c=$d(n);qn(`  $purple$16 ${c}${r}
`,s,!0);const l=ft.useContext(Lp),u=ft.useCallback(()=>{l.sendmessage(vx(t,o),a),l.sendclose()},[l,t,o,a]);return n&&Ne.jsx(da,{OK_BUTTON:u})}function j8e({chip:t,row:e,active:n,label:r,args:i,context:s}){Xu(e,s);const[o,a]=[tc(i[0],""),i[1]],c=$d(n);qn(`  $purple$16 ${c}${r}
`,s,!0);const l=ft.useContext(Lp),u=ft.useCallback(()=>{l.sendmessage(vx(t,o),a),l.sendclose()},[l,t,o,a]);return n&&Ne.jsx(da,{OK_BUTTON:u})}function $8e({chip:t,row:e,active:n,label:r,args:i,context:s}){Xu(e,s);const[o,a,c]=[tc(i[0],""),tc(i[1],-1),tc(i[2],-1)];let l,u;a===-1?(l=0,u=31):c===-1?(l=0,u=a):(l=a,u=c);const d=x_(t,o),h=PT(d),f=h==null?void 0:h.value,p=f??0,g=Fd(),[v,E]=ft.useState(""),[T,C]=ft.useState(0),[A,k]=ft.useState(!1);let I=`${p}`;const N=r.trim(),U=$d(n);A&&(I=g?YS(v,T,1,"$219+"):v),s.writefullwidth=32,qn(`  # ${U}${N} $green${I}`,s,!1),s.writefullwidth=void 0,qn(`
`,s,!1);const F=ft.useCallback(q=>{const W=q.alt?10:1;Za(d,Math.min(u,p+W))},[u,p,d]),$=ft.useCallback(q=>{const W=q.alt?10:1;Za(d,Math.max(l,p-W))},[l,p,d]),X=ft.useCallback(()=>{k(q=>{const W=!q;if(W){const K=`${f}`;E(K),C(K.length)}else{const K=parseFloat(v),ne=isNaN(K)?0:K;Za(o,Math.min(u,Math.max(l,ne)))}return W})},[u,l,v,o,f]);return f!==void 0&&Ne.jsxs(Ne.Fragment,{children:[n&&!A&&Ne.jsx(da,{MOVE_LEFT:$,MOVE_RIGHT:F,OK_BUTTON:X}),A&&Ne.jsxs(Ry,{blockhotkeys:!0,children:[Ne.jsx(rE,{hotkey:"ctrl+c",children:()=>{console.info("copy")}}),Ne.jsx(rE,{hotkey:"ctrl+v",children:()=>{console.info("paste")}}),Ne.jsx(rE,{hotkey:"ctrl+a",children:()=>{console.info("select all")}}),Ne.jsx(da,{MOVE_LEFT:()=>{C(q=>Math.max(0,q-1))},MOVE_RIGHT:()=>{C(q=>Math.min(v.length,q+1))},CANCEL_BUTTON:X,OK_BUTTON:X,keydown:q=>{switch(rr(q.key)){case"delete":v.length>0&&E(W=>YS(W,T,1));break;case"backspace":T>0&&(E(W=>YS(W,T-1,1)),C(W=>Math.max(0,W-1)));break}q.key.length===1&&v.length<s.width*.5&&(E(W=>YS(W,T,0,q.key)),C(W=>W+1))}})]})]})}function H8e({chip:t,row:e,active:n,label:r,args:i,context:s}){Xu(e,s);const[o,a,c]=[tc(i[0],""),tc(i[1],""),tc(i[2],"")];let l,u;a===""?(l="L ",u=" H"):c===""?(l="L ",u=` ${a}`):(l=`${a} `,u=` ${c}`);const d=0,h=8,f=x_(t,o),p=PT(f),g=(p==null?void 0:p.value)??0,v=Fd(),E=r.trim(),T=$d(n);qn(` $red $29 ${T}${E} `,s,!1);const A=YS("----:----",g,1,`$green${n?v?"$26":"$27":"$4"}${T}`).replaceAll("-","$7").replaceAll(":","$9");qn(`${T}${l}${A}${u} $green${g+1}
`,s,!1);const k=ft.useCallback(N=>{const U=N.alt?10:1;Za(f,Math.min(h,g+U))},[h,g,f]),I=ft.useCallback(N=>{const U=N.alt?10:1;Za(f,Math.max(d,g-U))},[d,g,f]);return Ne.jsx(Ne.Fragment,{children:n&&Ne.jsx(da,{MOVE_LEFT:I,MOVE_RIGHT:k})})}function V8e({chip:t,row:e,active:n,label:r,args:i,context:s}){Xu(e,s);const[o,...a]=[tc(i[0],""),...i.slice(1)],c=[],l=[];for(let I=0;I<a.length;I+=2)c.push(a[I]),l.push(a[I+1]);const u=0,d=l.length-1,h=x_(t,o),f=PT(h),p=(f==null?void 0:f.value)??0,g=Fd(),v=`${c[p]}`,E=r.trim(),T=$d(n);qn(` $dkred ? ${T}${E} `,s,!1);const C=n?g?"$26":"$27":"/";qn(`${p+1}$green${C}${T}${d+1}`,s,!1),s.writefullwidth=32,qn(` $green${v}`,s,!1),s.writefullwidth=void 0,qn(`
`,s,!1);const A=ft.useCallback(I=>{const N=I.alt?10:1;Za(h,Math.min(d,p+N))},[d,p,h]),k=ft.useCallback(I=>{const N=I.alt?10:1;Za(h,Math.max(u,p-N))},[u,p,h]);return Ne.jsx(Ne.Fragment,{children:n&&Ne.jsx(da,{MOVE_LEFT:k,MOVE_RIGHT:A})})}function z8e({chip:t,row:e,active:n,label:r,args:i,context:s}){Xu(e,s);const o=tc(i[0],""),a=x_(t,o),c=T7(a),l=c==null?void 0:c.value,u=(l==null?void 0:l.toJSON())??"",d=Fd(),[h,f]=ft.useState(0),[p,g]=ft.useState(!1),[v,E]=ft.useState(void 0),T=`${u} `,C=r.trim(),A=$d(n);qn(`$green  $20 ${A}${C} $green`,s,!1);const k=s.x,N=s.y*s.width;s.writefullwidth=32,qn(`${T}`,s,!1),s.writefullwidth=void 0,qn(`
`,s,!1);const U=he(v),F=s.width-k-2,$=U?Math.min(v,h):h;let X=U?Math.max(v,h):h;U&&(X!==$&&X===h&&--X,Fw(k+$+N,k+X+N,15,8,s)),p&&d&&yM(k+h+N,"",s);function q(){he(l)&&(f($),E(void 0),l.delete($,X-$+1))}return Ne.jsxs(Ne.Fragment,{children:[n&&Ne.jsx(da,{OK_BUTTON:()=>{l&&(g(!0),f(l.length),E(void 0))}}),p&&Ne.jsx(Ry,{blockhotkeys:!0,children:Ne.jsx(da,{MOVE_LEFT:W=>{W.shift?he(v)||E(xi(h-1,0,u.length)):E(void 0),f(K=>xi(K-1,0,u.length))},MOVE_RIGHT:W=>{W.shift?he(v)||E(h):E(void 0),f(K=>xi(K+1,0,u.length))},CANCEL_BUTTON:()=>{g(!1),f(u.length),E(void 0)},OK_BUTTON:()=>g(!1),keydown:W=>{if(!l)return;const{key:K}=W,ne=rr(K),Q={alt:W.altKey,ctrl:DT?W.metaKey:W.ctrlKey,shift:W.shiftKey},ie=l.toJSON();switch(ne){case"delete":U?q():ie.length>0&&l.delete(h,1);break;case"backspace":U?q():h>0&&(l.delete(h-1,1),f(G=>Math.max(0,G-1)));break;default:if(Q.ctrl)switch(ne){case"a":E(0),f(ie.length);break;case"c":he(ua())&&ua().writeText(l.toJSON()).catch(G=>console.error(G));break;case"v":he(ua())&&ua().readText().then(G=>{U&&q(),l.insert(h,G),f(h+G.length)}).catch(G=>console.error(G));break;case"x":he(ua())&&ua().writeText(l.toJSON()).then(()=>q()).catch(G=>console.error(G));break}else Q.alt||K.length===1&&ie.length<F&&(l.insert(h,K),f(G=>G+1));break}}})})]})}function G8e({chip:t,row:e,active:n,label:r,args:i,context:s}){Xu(e,s);const[o]=[tc(i[0],"")],a="z",c=` ${a.toUpperCase()} `,l=$d(n),u=s.x-.25,d=s.y-.25;qn(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${c}${l}$onclear ${r}${he(e)?`
`:""}`,s,!0);const h=ft.useContext(Lp),f=ft.useCallback(()=>{h.sendmessage(vx(t,o),void 0)},[h,t,o]);return Ne.jsxs("group",{position:[u*ar.DRAW_CHAR_WIDTH(),d*ar.DRAW_CHAR_HEIGHT(),1],children:[Ne.jsx(zu,{visible:!1,width:c.length+.5,height:1.5,blocking:!0,onClick:f}),n&&Ne.jsx(da,{OK_BUTTON:f}),Ne.jsx(rE,{hotkey:a,children:f})]})}function q8e({row:t,item:e,active:n}){const r=Ci(),i=Qh();if(Xu(t,i),i.iseven=i.y%2===0,typeof e=="string")return Ne.jsx(L8e,{player:r,item:e,row:t,context:i});if(Lr(e)){const[s,o,a,c,...l]=e;if(typeof s!="string"||typeof o!="string"||typeof a!="string")return null;const u={player:r,chip:s,row:t,active:n,label:o,args:[a,...l],context:i},d=Yn(c)?c:"";switch(rr(d)){default:case"hyperlink":return Ne.jsx(B8e,{...u});case"hk":case"hotkey":return Ne.jsx(F8e,{...u});case"rn":case"range":return Ne.jsx(H8e,{...u});case"sl":case"select":return Ne.jsx(V8e,{...u});case"nm":case"number":return Ne.jsx($8e,{...u});case"tx":case"text":return Ne.jsx(z8e,{...u});case"copyit":return Ne.jsx(U8e,{...u});case"linkit":return Ne.jsx(j8e,{...u});case"zssedit":return Ne.jsx(G8e,{...u});case"charedit":return Ne.jsx(N8e,{...u});case"coloredit":return Ne.jsx(D8e,{...u})}vM(i)}return null}function Fk({store:t,children:e}){return Ne.jsx(IB.Provider,{value:t,children:e})}function Bk({width:t,height:e}){const n=ft.useContext(IB),[r,i,s]=MB(n,wp(o=>[o.char,o.color,o.bg,o.render]));return t>0&&e>0&&Ne.jsx(bQ,{char:r.slice(),color:i.slice(),bg:s.slice(),width:t,height:e})}function r4({inline:t=!1,xmargin:e=1,ymargin:n=1,selected:r=-1,width:i,height:s,color:o,bg:a,text:c}){const l=bM(i,s,0,o,a),u=l.getState(),d={...yy(i,s,o,a,n,e,i-e,s-n),...l.getState(),x:e,y:n};return fK(u,0,o,a),Ne.jsxs(Fk,{store:l,children:[Ne.jsx(Bk,{width:i,height:s}),Ne.jsx(Iv.Provider,{value:d,children:c.map((h,f)=>Ne.jsx(q8e,{row:t?void 0:f,item:h,active:f===r},f))})]})}var W8e=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/n)*Math.atan(Math.sin(2*Math.PI*e*i)/n)},K8e=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function Y8e(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:K8e,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(t.__damp===void 0&&(t.__damp={}),t.__damp[c]===void 0&&(t.__damp[c]=0),Math.abs(t[e]-n)<=a)return t[e]=n,!1;r=Math.max(1e-4,r);var l=2/r,u=o(l*i),d=t[e]-n,h=n,f=s*r;d=Math.min(Math.max(d,-f),f),n=t[e]-d;var p=(t.__damp[c]+l*d)*i;t.__damp[c]=(t.__damp[c]-l*p)*u;var g=n+(d+p)*u;return h-t[e]>0==g>h&&(g=h,t.__damp[c]=(g-h)/i),t[e]=g,!0}const X8e=2,J8e=14,NQ=J8e*X8e;function Q8e(t){return RA(t,NQ*.5)}function Z8e(t,e,n,r,i=1.235){function s(a){return W8e(a,r)}Y8e(t.userData,e,n,i,r,NQ*12,s),t.position[e]=Q8e(t.userData[e]);const o=n-t.position.y;return Math.abs(o)<.1}function eGe({name:t,width:e,height:n,context:r}){const i=pK();for(let c=1;c<e-1;++c)ca(i,e,n,c,0,{char:196,color:15}),c>2&&c<e-1&&ca(i,e,n,c,1,{char:205,color:15}),ca(i,e,n,c,n-1,{char:205,color:15});ca(i,e,n,1,0,{char:205,color:15}),ca(i,e,n,2,0,{char:187,color:15}),ca(i,e,n,2,1,{char:200,color:15});for(let c=1;c<n-1;++c)ca(i,e,n,0,c,{char:179,color:15}),ca(i,e,n,e-1,c,{char:179,color:15});for(let c=2;c<n-1;++c)ca(i,e,n,1,c,{char:0,color:15}),ca(i,e,n,e-2,c,{char:0,color:15});ca(i,e,n,0,0,{char:213,color:15}),ca(i,e,n,e-1,0,{char:191,color:15}),ca(i,e,n,e-1,1,{char:181,color:15}),ca(i,e,n,0,n-1,{char:212,color:15}),ca(i,e,n,e-1,n-1,{char:190,color:15});const s=` ${t} `,o=_M(s,e,n),a=(o==null?void 0:o.x)??s.length;return r.x=Math.round(e*.5)-Math.round(a*.5),qn(s,r,!0),null}function Kz({x:t,y:e,color:n,on:r=232,off:i=7,alt:s}){const o=Fd(),a=pK(),c=ft.useRef(0),l=he(s)?c.current%2===0?r:s:r;return ca(a,a.width,a.height,t,e,{char:o?l:i,color:n}),a.changed(),o&&++c.current,null}function tGe({store:t,children:e}){return Ne.jsx(dK.Provider,{value:t,children:e})}function nGe({width:t,height:e}){const n=ft.useContext(dK),[r]=MB(n,wp(i=>[i.dither,i.render]));return t>0&&e>0&&Ne.jsx(Dk,{alphas:r.slice(),width:t,height:e})}function rGe({row:t,width:e,height:n,panelwidth:r,panelheight:i,children:s}){const o=_xe(r,i,0),a=[.001,.05,.1,.2],c=.4,{dither:l}=o.getState();vxe(l);for(let u=0;u<r;++u){fP(l,r,i,u,t,c);for(let d=0;d<a.length;++d){const h=a.length-d;fP(l,r,i,u,t-h,a[d]),fP(l,r,i,u,t+h,a[d])}}return Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Bk,{width:e,height:n}),Ne.jsxs("group",{position:[2*ar.DRAW_CHAR_WIDTH(),2*ar.DRAW_CHAR_HEIGHT(),0],children:[Ne.jsx(tGe,{store:o,children:Ne.jsx(nGe,{width:r,height:i})}),s,Ne.jsx(Kz,{x:1,y:1}),Ne.jsx(Kz,{x:1,y:2+t,on:26,alt:27,off:45,color:12})]})]})}function iGe({name:t,width:e,height:n,color:r,bg:i,text:s,shouldclose:o}){const{viewport:a}=KE(),c=e-3,l=n-3,u=bM(e,n,0,r,i),d=ft.useContext(Lp),h={...yy(e,n,r,i,0,0,e,n),...u.getState()},[f,p]=ft.useState(0);let g=f-Math.floor(l*.5);g=Math.min(s.length-l,g),g=Math.max(0,g);const v=s.slice(g,g+l),E=f-g,T=ft.useRef(null),C=ft.useCallback(()=>{o&&d.didclose()},[o,d]),A=ft.useCallback(I=>{const N=I.alt?10:1;p(U=>Math.max(0,U-N))},[p]),k=ft.useCallback(I=>{const N=I.alt?10:1;p(U=>Math.min(s.length,U+N))},[p,s.length]);return ft.useEffect(()=>{if(T.current&&!o){const I=a.height;T.current.position.y=I,T.current.userData.y=I,T.current.userData.vy=0}},[o]),uT(ft.useCallback((I,N)=>{if(he(T.current)){const U=o?n*2*-ar.DRAW_CHAR_HEIGHT():0;Z8e(T.current,"y",U,N)&&C()}},[o,C,n])),Ne.jsx("group",{ref:T,"position-y":1e6,children:Ne.jsxs(Ry,{children:[Ne.jsx(da,{MOVE_UP:A,MOVE_DOWN:k,CANCEL_BUTTON:d.sendclose}),Ne.jsxs(Fk,{store:u,children:[Ne.jsx(eGe,{name:t,width:e,height:n,context:h}),Ne.jsx(rGe,{row:E,width:e,height:n,panelwidth:c,panelheight:l,children:Ne.jsx(r4,{name:t,width:c,height:l,xmargin:0,ymargin:0,color:r,bg:cr.ONCLEAR,text:v,selected:E})})]})]})})}const Yz=new Vn,Xz=[153,5,42,94,24,25,26,27,16,17,30,31,234,227,227].map((t,e)=>[t,e%3===0?176:177,e%3===0?178:176]).flat();function sGe({context:t,width:e,height:n,drawstick:r}){const{islandscape:i,sidebaropen:s,showkeyboard:o}=nu();if(fK(t,0,cr.WHITE,cr.ONCLEAR),!i){const a=e*n;for(let c=4*e;c<a;++c)t.char[c]=s?Xz[c%Xz.length]:0,t.color[c]=s?cr.DKPURPLE:cr.ONCLEAR}t.y=3;for(let a=0;a<3;++a)t.x=t.active.leftedge=1,qn("$YELLOW$176$176$176$176$176",t,!1),t.x=t.active.leftedge=e-7,qn(`$WHITE$176$176$176$176$176
`,t,!1);t.y=n-5;for(let a=0;a<3;++a)t.x=t.active.leftedge=1,qn("$GREEN$176$176$176$176$176",t,!1),t.x=t.active.leftedge=e-7,qn(`$RED$176$176$176$176$176
`,t,!1);if(t.y=n-5,t.active.leftedge=1,t.active.bg=cr.ONCLEAR,o?(++t.y,t.x=Math.round((e-8)*.5),qn("$GREY$221",t,!1),t.x+=5,qn(`$GREY$222
`,t,!1),t.x=Math.round((e-6)*.5),qn("$GREY$221",t,!1),t.x+=3,qn(`$GREY$222
`,t,!1),t.x=Math.round((e-4)*.5),qn("$GREY$221",t,!1),++t.x,qn(`$GREY$222
`,t,!1)):(t.x=Math.round((e-4)*.5),qn("$GREY$221",t,!1),++t.x,qn(`$GREY$222
`,t,!1),t.x=Math.round((e-6)*.5),qn("$GREY$221",t,!1),t.x+=3,qn(`$GREY$222
`,t,!1),t.x=Math.round((e-8)*.5),qn("$GREY$221",t,!1),t.x+=5,qn(`$GREY$222
`,t,!1)),r.startx!==-1){t.active.leftedge=0,t.x=t.active.leftedge=r.startx-4,t.y=r.starty-3;for(let c=0;c<5;++c)qn(`$BLUE$176$176$176$176$176$176$176$176
`,t,!1);Yz.set(r.tipx-r.startx,r.tipy-r.starty);const a=Gce(RA(hG(Yz.angle()),45));t.x=t.active.leftedge=Math.round(r.startx+Math.cos(a)*4)-2,t.y=Math.round(r.starty+Math.sin(a)*3)-2;for(let c=0;c<3;++c)qn(`$BLUE$177$177$177$177
`,t,!1)}return i||(t.active.leftedge=1,t.y=4,t.x=2,qn("$YELLOW?",t,!1),t.x=e-7,qn("$WHITEMENU",t,!1),t.y=n-4,t.x=2,qn("$GREENOKAY",t,!1),t.x=e-9,qn("$REDCANCEL",t,!1)),null}function oGe(t,e){switch(t){case 0:Pu.keyboard(e?"{Shift>}[ArrowLeft]{/Shift}":"[ArrowLeft]").catch(Sl);break;case 45:Pu.keyboard(e?"{Shift>}[ArrowLeft][ArrowUp]{/Shift}":"[ArrowLeft][ArrowUp]").catch(Sl);break;case 90:Pu.keyboard(e?"{Shift>}[ArrowUp]{/Shift}":"[ArrowUp]").catch(Sl);break;case 135:Pu.keyboard(e?"{Shift>}[ArrowRight][ArrowUp]{/Shift}":"[ArrowRight][ArrowUp]").catch(Sl);break;case 180:Pu.keyboard(e?"{Shift>}[ArrowRight]{/Shift}":"[ArrowRight]").catch(Sl);break;case 225:Pu.keyboard(e?"{Shift>}[ArrowRight][ArrowDown]{/Shift}":"[ArrowRight][ArrowDown]").catch(Sl);break;case 270:Pu.keyboard(e?"{Shift>}[ArrowDown]{/Shift}":"[ArrowDown]").catch(Sl);break;case 315:Pu.keyboard(e?"{Shift>}[ArrowLeft][ArrowDown]{/Shift}":"[ArrowLeft][ArrowDown]").catch(Sl);break;case 360:Pu.keyboard(e?"{Shift>}[ArrowLeft]{/Shift}":"[ArrowLeft]").catch(Sl);break}}const aGe=Qw/1e3,NS=new Vn,jb=new ht;function PS(t,e){const n=ar.DRAW_CHAR_WIDTH(),r=ar.DRAW_CHAR_HEIGHT(),i=jb.x+n*.5,s=jb.y+r*.5;return{cx:Math.floor(t*.5)+Math.floor(i/n),cy:Math.floor(e*.5)+Math.floor(s/r)}}function cGe({width:t,height:e,player:n,onDrawStick:r}){const{islandscape:i}=nu(),[s]=ft.useState({startx:-1,starty:-1,tipx:-1,tipy:-1,pointerid:-1,presscount:0,inputacc:Qw});function o(a,c){s.tipx===-1&&(a0(a,c,3,6,6,1)?$le(qe,n):a0(a,c,3,t-2,6,t-6)?Pu.keyboard("[Tab]").catch(Sl):a0(a,c,e-5,6,e-2,1)?Pu.keyboard("[Enter]").catch(Sl):a0(a,c,e-5,t-2,e-2,t-6)?Pu.keyboard("[Escape]").catch(Sl):i&&a0(a,c,6,t,e-6,t-5)||!i&&a0(a,c,0,t-12,3,12)?nu.setState(l=>({...l,sidebaropen:!l.sidebaropen})):a0(a,c,e-4,t-12,e-2,12)&&nu.setState({showkeyboard:!0})),s.startx=-1,s.starty=-1,s.tipx=-1,s.tipy=-1,s.pointerid=-1,r(s.startx,s.starty,s.tipx,s.tipy)}return uT((a,c)=>{if(s.inputacc+=c,s.inputacc>=aGe&&s.presscount>0){s.inputacc=0;const{cx:l,cy:u}=PS(t,e);if(NS.set(s.startx-l,s.starty-u),s.tipx!==-1||NS.length()>3){const d=RA(hG(NS.angle()),45);oGe(d,s.presscount>1)}}}),Ne.jsx(zu,{width:t,height:e,visible:!1,onPointerDown:a=>{if(++s.presscount,s.startx===-1){a.intersections[0].object.worldToLocal(jb.copy(a.intersections[0].point));const{cx:c,cy:l}=PS(t,e);s.startx=c,s.starty=l,s.tipx=-1,s.tipy=-1,s.pointerid=a.pointerId,s.inputacc=Qw}},onPointerMove:a=>{if(a.pointerId===s.pointerid){a.intersections[0].object.worldToLocal(jb.copy(a.intersections[0].point));const{cx:c,cy:l}=PS(t,e);NS.set(s.startx-c,s.starty-l),(s.tipx!==-1||NS.length()>3)&&(s.tipx=c,s.tipy=l,r(s.startx,s.starty,s.tipx,s.tipy))}},onPointerCancel:a=>{if(--s.presscount,a.pointerId===s.pointerid){a.intersections[0].object.worldToLocal(jb.copy(a.intersections[0].point));const{cx:c,cy:l}=PS(t,e);o(c,l)}},onPointerUp:a=>{if(--s.presscount,a.pointerId===s.pointerid){a.intersections[0].object.worldToLocal(jb.copy(a.intersections[0].point));const{cx:c,cy:l}=PS(t,e);o(c,l)}}})}function lGe({width:t,height:e}){const n=Ci(),[r,i]=ft.useState({startx:-1,starty:-1,tipx:-1,tipy:-1}),s=bM(t,e,0,cr.WHITE,cr.ONCLEAR),o={...yy(t,e,cr.WHITE,cr.ONCLEAR),...s.getState()};return pxe(1,1,t-2,e-2,o),Ne.jsxs(Fk,{store:s,children:[Ne.jsx(sGe,{context:o,width:t,height:e,drawstick:r}),Ne.jsx(cGe,{width:t,height:e,player:n,onDrawStick:(a,c,l,u)=>i({startx:a,starty:c,tipx:l,tipy:u})}),Ne.jsx(iA,{width:t,height:e,top:5,left:0,right:5,bottom:e-6,alpha:.47135}),Ne.jsx(iA,{width:t,height:e,top:5,left:t-6,right:t-1,bottom:e-6,alpha:.47135}),Ne.jsx(Bk,{width:t,height:e})]})}const Jz=1.5,Qz=56,uGe=16,dGe=[[`
`],["[Escape]","$","1","2","3","4","5","6","7","8","9","0","&",`
`],[" ","Q","W","E","R","T","Y","U","I","O","P","-","+","*",`
`,`
`],["A","S","D","F","G","H","J","K","L","[Backspace]","_","=","%",`
`],[" ","Z","X","C","V","B","N","M","!","[Enter]","(",")","|",`
`],["                                          ","<",">","`",`
`],["[Space]","#","/","?",":","'",";",'"',"  ","[ArrowUp]",`
`],["         ","[Shift]","[Ctrl]","[Alt]","@","[ArrowLeft]","    ","[ArrowRight]",`
`],["                                      ","[ArrowDown]",`
`],["$greenz s s k e y s"]].flat();function hGe(t){return t.replaceAll("{","").replaceAll("}","").replaceAll("[","").replaceAll("]","")}function fGe(t,e,n,r){let i=t,s=hGe(t);switch(t){case"$":s=" $$ ";break;case";":s=" $59 ";break;case"[Escape]":s=" esc ";break;case"[ArrowUp]":s=" $30 ";break;case"[ArrowDown]":s=" $31 ";break;case"[ArrowRight]":s=" $16 ";break;case"[ArrowLeft]":s=" $17 ";break;case"[Backspace]":s=" del ";break;case"[Shift]":s=r?" SHIFT ":" shift ";break;case"[Ctrl]":s=n?" CTRL ":" ctrl ";break;case"[Alt]":s=e?" ALT ":" alt ";break;default:if(!r)i=i.toLowerCase(),s=s.toLowerCase();else switch(s){case"(":s="[";break;case")":s="]";break;case"<":s="{";break;case">":s="}";break;case"`":s="~";break}s=` ${s} `;break}return["touchkey","",i,"hk","",s]}function pGe({width:t,height:e}){const n=Ci(),{showkeyboard:r,keyboardalt:i,keyboardctrl:s,keyboardshift:o}=nu(),a=ft.useRef(null),[c]=ft.useState({}),l=16;return r&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(zu,{blocking:!0,width:t,height:e,visible:!1,onPointerDown:u=>{c[u.pointerId]=u.point.x,he(a.current)&&(a.current.userData.x=a.current.position.x)},onPointerMove:u=>{const d=c[u.pointerId],h=u.point.x;if(he(d)&&a.current){const f=ar.DRAW_CHAR_WIDTH()*Jz,p=Math.round(RA(h-d,f)/f);a.current.position.x=xi(a.current.userData.x+p*f,Qz*-f+t*ar.DRAW_CHAR_WIDTH(),0)}},onPointerUp:u=>{delete c[u.pointerId]}}),Ne.jsx(iA,{width:t,height:e,top:5,left:0,right:t-1,bottom:e-1,alpha:.753718}),Ne.jsx("group",{position:[0,0,1],children:Ne.jsx(zu,{visible:!1,x:t*.5-l*.5,y:e-3.5,width:l,height:4,onClick:()=>{nu.setState({showkeyboard:!1})}})}),Ne.jsx("group",{ref:a,scale:Jz,children:Ne.jsx(Lp.Provider,{value:{sendmessage(u,d){qe.emit(u,d,n)},sendclose(){},didclose(){}},children:Ne.jsx(r4,{name:"keyboard",inline:!0,ymargin:1,color:cr.WHITE,bg:cr.ONCLEAR,width:Qz,height:uGe,text:dGe.map(u=>{switch(u){case`
`:return u;default:if(u.includes(" "))return u}return fGe(u,i,s,o)})})})})]})}function mGe({width:t,height:e}){const n=i4();return n.cols<10||n.rows<10?null:Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("group",{position:[0,0,800],children:Ne.jsx(lGe,{width:t,height:e})}),Ne.jsx("group",{position:[0,0,850],children:Ne.jsx(pGe,{width:t,height:e})})]})}const PQ=ft.createContext({cols:1,rows:1});function i4(){return ft.useContext(PQ)}function gGe({children:t}){const{viewport:e,set:n,size:r,camera:i}=KE(),s=ft.useRef(null),{width:o,height:a}=e.getCurrentViewport(),{islandscape:c,showtouchcontrols:l}=nu();ft.useLayoutEffect(()=>{const A=i;return i.updateProjectionMatrix(),n(()=>({camera:s.current})),()=>n(()=>({camera:A}))},[n,i,s]);const u=o/ar.DRAW_CHAR_WIDTH();let d=Math.floor(u);const h=a/ar.DRAW_CHAR_HEIGHT();let f=Math.floor(h);const p=(o-d*ar.DRAW_CHAR_WIDTH())*.5,g=(a-f*ar.DRAW_CHAR_HEIGHT())*.5;let v=0,E=0;const T=Math.round(u);let C=Math.round(h);if(l)if(c)v=5*ar.DRAW_CHAR_WIDTH(),d-=5*2;else{f=Math.round(f*.666);const A=f-4;C-=A,E=A*ar.DRAW_CHAR_HEIGHT()}return ft.useEffect(()=>{nu.setState(A=>({...A,insetcols:T,insetrows:C}))},[T,C]),Ne.jsxs(PQ.Provider,{value:{cols:d,rows:f},children:[Ne.jsx("orthographicCamera",{ref:s,left:r.width/-2,right:r.width/2,top:r.height/2,bottom:r.height/-2,near:1,far:2e3,position:[0,0,1e3]}),d>=10&&f>=10&&Ne.jsx("group",{"scale-x":-1,"rotation-z":Math.PI,children:Ne.jsxs("group",{position:[o*-.5+p,a*-.5+g,0],children:[Ne.jsx("group",{position:[v,0,0],children:t}),l&&Ne.jsx("group",{position:[0,E,0],children:Ne.jsx(mGe,{width:T,height:C},T*C)})]})})]})}function Zz({rect:t,islandscape:e=!0,sidebaropen:n=!0,shouldclose:r=!1}){switch(t.type){case 0:return Ne.jsx(r4,{name:t.name,width:t.width,height:t.height,color:14,bg:1,text:t.text,xmargin:e?1:n?3:10,ymargin:e&&!n?6:0});case 1:return Ne.jsx(iGe,{name:t.name,width:t.width,height:t.height,color:14,bg:1,text:t.text,shouldclose:r});case 2:return Ne.jsx(O8e,{width:t.width,height:t.height})}return null}const vb=20;function vGe(){const t=i4(),{islandscape:e,sidebaropen:n,insetrows:r,showtouchcontrols:i}=nu(),s=tg(Dz(p=>p.gadget.scroll??[])),o=s.length===0,[a,c]=ft.useState(!1),l=tg(Dz(p=>p.gadget.sidebar??[]));if(t.cols<10||t.rows<10)return null;const u={name:"main",type:2,x:0,y:0,text:[],width:t.cols,height:t.rows},d=[];if(l.length)if(i)if(e){const p=n?vb+5:vb,g=n?vb:4,v={name:"sidebar",type:0,x:u.x+u.width-g,y:u.y,width:p,height:u.height,text:l};u.width-=g,d.push(v)}else{const p=n?r-7:r,g=n?p:4,v={name:"sidebar",type:0,x:0,y:u.y+u.height-g,width:u.width,height:p,text:l};u.height-=g,d.push(v)}else{const p={name:"sidebar",type:0,x:u.x+u.width-vb,y:u.y,width:vb,height:u.height,text:l};u.width-=vb,d.push(p)}const h={name:"scroll",type:1,x:0,y:0,width:xi(50,24,u.width-2),height:xi(18,8,u.height-8),text:s};h.x=u.x+Math.floor((u.width-h.width)*.5),h.y=u.y+Math.floor((u.height-h.height)*.5),!o&&!a&&c(!0),d.unshift(u);const f=Ci();return Ne.jsx(Lp.Provider,{value:{sendmessage(p,g){qe.emit(p,g,f)},sendclose(){wle(qe,f)},didclose(){c(!1)}},children:Ne.jsxs("group",{position:[0,0,-512],children:[d.map(p=>Ne.jsx("group",{position:[p.x*ar.DRAW_CHAR_WIDTH(),p.y*ar.DRAW_CHAR_HEIGHT(),0],children:Ne.jsx(Zz,{islandscape:!i||e,sidebaropen:!i||n,rect:p})},p.name)),a&&Ne.jsxs(Ph.Fragment,{children:[Ne.jsx("group",{position:[0,0,800],children:Ne.jsx(i8e,{width:t.cols,height:t.rows,alpha:.14})}),Ne.jsx("group",{position:[h.x*ar.DRAW_CHAR_WIDTH(),h.y*ar.DRAW_CHAR_HEIGHT(),900],children:Ne.jsx(Zz,{rect:h,shouldclose:o})})]},"scroll")]})})}const _Ge=250,yGe=249,oA=cr.BLUE,bGe=cr.WHITE,EGe=cr.DKGRAY,s4=cr.BLACK;function cS(t){return t?cr.ONCLEAR:cr.DKBLUE}const DQ=ft.createContext({sendmessage(){}});function j0(t,e,n,r,i){const s=Jh(i);i.iseven=i.y%2===0,i.active.bg=e&&!t?s4:i.reset.bg,i.active.leftedge=s.left,i.active.rightedge=s.right,i.active.topedge=s.top,i.active.bottomedge=s.bottom,i.x=i.active.leftedge+n,i.y=i.active.topedge+r}function $b(t,e,n,r,i,s,o,a){const c=Jh(i);i.iseven=i.y%2===0,i.active.color=cr.WHITE,i.active.bg=i.reset.bg,i.active.leftedge=c.left+s,i.active.rightedge=c.right-s,i.active.topedge=c.top+o,i.active.bottomedge=c.bottom-a,i.x=i.active.leftedge+n,i.y=i.active.topedge+r}function SGe(t){let e=0;return t.split(/\r?\n/).map(r=>{const i=e,s=`${r}
`;return e+=s.length,{start:i,code:s,end:i+r.length}})}function wGe(t){return t.reduce((e,n)=>{const r=n.code.length;return r>e?r:e},0)}function TGe(t,e){for(let n=0;n<e.length;++n)if(t<=e[n].end)return n;return 0}function LQ(t){return he(t)?t.value:void 0}function o4({context:t}){const e=Jh(t),{quickterminal:n}=Ls(),r=cS(n);if(n){for(let i=e.top;i<=e.bottom;++i)for(let s=e.left;s<=e.right;++s)ca(t,t.width,t.height,s,i,{char:0,color:oA,bg:r});return null}for(let i=e.top;i<=e.bottom;++i)for(let s=e.left;s<=e.right;++s){let o=0;(s+i)%2===0&&(o=Math.abs(Math.round(Math.cos(s*i*.01)))?_Ge:yGe),ca(t,t.width,t.height,s,i,{char:o,color:oA,bg:r})}return null}function xGe(){const t=Qh(),e=Jh(t),[n,r,i]=Ls(wp(v=>[v.quickterminal,v.editor.type,v.editor.title])),s=cr.WHITE,o=cS(n);for(let v=e.top;v<e.bottom;++v)ca(t,t.width,t.height,e.left,v,{char:179,color:s,bg:o}),ca(t,t.width,t.height,e.right,v,{char:179,color:s,bg:o});const a="$196".repeat(e.width-4);$b(!1,!1,0,0,t,0,0,0),qn(`$213$205$187${a}$191`,t,!0);const c="$205".repeat(e.width-2);$b(!1,!1,0,e.height-1,t,0,0,0),qn(`$212${c}$190`,t,!0);const l=Fd(),u="$205".repeat(e.width-4);$b(!1,!1,0,1,t,0,0,0),qn(`$179$${l?"7":"232"}$200${u}$181`,t,!0);const h=` ${`[${r}] `}${i} `,f=_M(h,e.width,e.height),p=(f==null?void 0:f.measuredwidth)??1,g=Math.round(e.width*.5)-Math.round(p*.5);return $b(!1,!1,g,0,t,0,0,0),qn(h,t,!0),null}const CGe=t=>{const e="nativeEvent"in t?t.nativeEvent:t;return{deltaX:e.deltaX||0,deltaY:e.deltaY||0,deltaZ:e.deltaZ||0,timeStamp:e.timeStamp}},RGe=t=>[t.deltaX,t.deltaY,t.deltaZ],VC=t=>{const e=RGe(t).map(Math.abs);return Math.max(...e)};var Lv;(function(t){t.ALL_OTHER_CHECKS_FAILED="ALL_OTHER_CHECKS_FAILED",t.NO_PREVIOUS_EVENT_TO_COMPARE="NO_PREVIOUS_EVENT_TO_COMPARE",t.PAST_TIMESTAMP_EVENT="PAST_TIMESTAMP_EVENT",t.ENOUGH_TIME_PASSED="ENOUGH_TIME_PASSED",t.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN="NON_DECREASING_DELTAS_OF_KNOWN_HUMAN",t.DELTA_MODULE_HAS_BEEN_INCREASING="DELTA_MODULE_HAS_BEEN_INCREASING"})(Lv||(Lv={}));class AGe{constructor({sensitivity:e=2,delay:n=100,increasingDeltasThreshold:r=3}={}){Gn(this,"sensitivity");Gn(this,"delay");Gn(this,"increasingDeltasThreshold");Gn(this,"previousEvents");this.sensitivity=Math.max(1,e),this.delay=Math.max(1,n),this.increasingDeltasThreshold=Math.max(2,r),this.previousEvents=[]}check(e){var s;if(!(("nativeEvent"in e?e.nativeEvent:e)instanceof Event))throw new Error(`"${e}" is not a valid event`);const r=CGe(e);if(VC(r)<this.sensitivity)return!1;const{isHuman:i}=this.isHuman(r);return i?this.previousEvents=[r]:r.timeStamp>(((s=this.previousEvents.at(-1))==null?void 0:s.timeStamp)||0)&&this.previousEvents.push(r),i}isHuman(e){const n=this.previousEvents.at(-1);if(!n)return{isHuman:!0,reason:Lv.NO_PREVIOUS_EVENT_TO_COMPARE};if(e.timeStamp<n.timeStamp)return{isHuman:!1,reason:Lv.PAST_TIMESTAMP_EVENT};if(e.timeStamp>n.timeStamp+this.delay)return{isHuman:!0,reason:Lv.ENOUGH_TIME_PASSED};const s=VC(e),o=VC(n);if(s>=o){if(this.previousEvents.length===1)return{isHuman:!0,reason:Lv.NON_DECREASING_DELTAS_OF_KNOWN_HUMAN};if(this.increasingDeltasThreshold<=2||this.previousEvents.length>=this.increasingDeltasThreshold&&this.previousEvents.slice(-this.increasingDeltasThreshold).map(VC).every((u,d,h)=>d===0||u>h[d-1]))return{isHuman:!0,reason:Lv.DELTA_MODULE_HAS_BEEN_INCREASING}}return{isHuman:!1,reason:Lv.ALL_OTHER_CHECKS_FAILED}}}const MGe=new AGe({sensitivity:DT?7:2}),e6=4,IGe=.75;function OGe(t){const e=xi(t,-e6,e6);return Math.round(e*IGe)}function UQ({debug:t=!1,disabled:e=!1,blocking:n=!0,cursor:r="pointer",x:i=0,y:s=0,width:o=30,height:a=10,children:c,onScroll:l,...u}){return Ne.jsxs("group",{...u,children:[Ne.jsx(zu,{blocking:n,cursor:r,visible:t,x:i,y:s,width:o,height:a,onWheel:d=>{e||!MGe.check(d)||l==null||l(OGe(d.deltaY))}}),c]})}function kGe({xcursor:t,ycursor:e,xoffset:n,yoffset:r,rows:i,codepage:s}){var W,K;const o=Fd(),a=Qh(),c=ft.useRef(),l=No(),u=Jh(a),d=Ls(ne=>ne.editor.player),h=LQ(s),f=he(h)?h.toJSON():"",p=i.length-1,g=t+1-n,v=e+2-r;if(he(s)){const ne=((W=c.current)==null?void 0:W.x)!==g||((K=c.current)==null?void 0:K.y)!==v;if(o||ne){const Q=u.left+g,ie=u.top+v;ie>u.top+1&&ie<u.bottom&&Q>u.left&&Q<u.right&&yM(Q+ie*a.width,"",a)}}c.current={x:g,y:v};const E=i[p].end,T=i[e];let C=l.cursor,A=l.cursor,k=!1;he(l.select)&&(k=!0,C=Math.min(l.cursor,l.select),A=Math.max(l.cursor,l.select),l.cursor!==l.select&&--A);const I=A-C+1,N=k?f.substring(C,A+1):f;function U(ne){ne?he(l.select)||No.setState({select:l.cursor}):No.setState({select:void 0})}function F(ne,Q,ie){Q>0&&(h==null||h.delete(ne,Q)),he(ie)&&(h==null||h.insert(ne,ie)),No.setState({cursor:ne+(ie??"").length,select:void 0})}function $(){he(l.select)&&(No.setState({cursor:C}),F(C,I))}function X(){No.setState({cursor:E,select:void 0})}const q=ft.useCallback(function(Q){const ie=Math.round(e+Q);if(ie<0)No.setState({cursor:0});else if(ie>p)No.setState({cursor:E});else{const G=i[ie];No.setState({cursor:G.start+Math.min(t,G.code.length-1)})}},[E,i,p,t,e]);return Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(UQ,{blocking:!0,x:u.left,y:u.top,width:u.width,height:u.height,onScroll:ne=>q(ne*.75)}),Ne.jsx(da,{keydown:ne=>{if(!he(h))return;const{key:Q}=ne,ie=rr(Q),G=Uk(ne);switch(ie){case"arrowleft":if(U(G.shift),G.ctrl)No.setState({cursor:T.start});else{const Z=l.cursor-(G.alt?10:1);No.setState({cursor:xi(Z,0,E)})}break;case"arrowright":if(U(G.shift),G.ctrl)No.setState({cursor:T.end});else{const Z=l.cursor+(G.alt?10:1);No.setState({cursor:xi(Z,0,E)})}break;case"arrowup":U(G.shift),G.ctrl?No.setState({cursor:0}):q(G.alt?-10:-1);break;case"arrowdown":U(G.shift),G.ctrl?No.setState({cursor:E}):q(G.alt?10:1);break;case"enter":he(h)&&(h.insert(l.cursor,`
`),No.setState({cursor:l.cursor+1}));break;case"esc":case"escape":G.shift||G.alt||G.ctrl?Q1(qe,d):Vle(qe,d);break;case"tab":vG(qe,!G.shift,d);break;case"delete":k?$():F(l.cursor,1);break;case"backspace":k?$():f.length>0&&F(Math.max(l.cursor-1,0),1);break;default:if(G.ctrl)switch(ie){case"a":No.setState({cursor:E,select:0});break;case"c":he(ua())?ua().writeText(N).catch(Z=>ci(qe,"clipboard",Z)):X();break;case"v":he(ua())?ua().readText().then(Z=>{const se=Z.replaceAll("\r","");k?F(C,I,se):F(l.cursor,0,se)}).catch(Z=>ci(qe,"clipboard",Z)):X();break;case"x":he(ua())?ua().writeText(N).then(()=>$()).catch(Z=>ci(qe,"clipboard",Z)):X();break;case"p":fE(qe,N,d),Oi(qe,`running: ${N.substring(0,18)}`);break}else if(!G.alt){if(Q.length===1)if(k)F(C,I,Q);else{const Z=l.cursor+Q.length;h.insert(l.cursor,Q),No.setState({cursor:Z})}}break}}})]})}function NGe({ycursor:t,xoffset:e,yoffset:n,rows:r,codepage:i}){const s=Fd(),o=Qh(),a=No(),{quickterminal:c}=Ls(),l=Jh(o);if(!he(i)){const p=(s?"|":"-").repeat(3);return $b(!1,!1,0,0,o,1,2,1),qn(` ${p} LOADING ${p}`,o,!0),null}let u=a.cursor,d=a.cursor,h=!1;he(a.select)&&(h=!0,u=Math.min(a.cursor,a.select),d=Math.max(a.cursor,a.select),a.cursor!==a.select&&--d);const f=l.left+1;$b(!1,!1,-e,-n,o,1,2,1);for(let p=0;p<r.length;++p){if(o.y<=l.top+1){++o.y;continue}const g=r[p],v=p===t,E=g.code.replaceAll(`
`,"");if(o.x=f-e,o.iseven=o.y%2===0,o.active.bg=v?s4:cS(c),o.disablewrap=!0,cK(`${E} `,o,!1),h&&g.start<=d&&g.end>=u){const T=Math.max(g.start,u)-g.start-e,C=Math.min(g.end,d)-g.start-e,A=l.width-3,k=1+o.y*o.width,I=Math.max(0,T),N=Math.min(A,C);I<=A&&N>=f&&Fw(k+I,k+N,bGe,EGe,o)}if(++o.y,o.y>=l.bottom)break}return o.disablewrap=!1,null}function QP(){const[t]=Ls(wp(g=>[g.editor])),e=Qh(),n=No(),r=T7(yG(t.book,t.path)),i=Jh(e);ft.useEffect(()=>(Qle(qe,t.book,t.path,t.player),()=>{Zle(qe,t.book,t.path,t.player)}),[t.book,t.path,t.player]);const s=LQ(r),o=he(s)?s.toJSON():"",a=SGe(o),c=TGe(n.cursor,a),l=n.cursor-a[c].start,u=wGe(a),d={rows:a,xcursor:l,ycursor:c,codepage:r,xoffset:n.xscroll,yoffset:n.yscroll},h=32,f=(Math.round(u/h)+1)*h,p=a.length;return ft.useEffect(()=>{let g=n.xscroll;const v=l-g,E=i.width-3;let T=Math.round(xi(Math.abs(v)*.5,1,h));T<8&&(T=1),v>E-8&&(g+=T),v<8&&(g-=T);let C=n.yscroll;const A=c-C,k=i.height-4,I=Math.round(k*.5);let N=Math.round(xi(Math.abs(A)*.25,1,I));N<8&&(N=1),A>k-4&&(C+=N),A<4&&(C-=N),setTimeout(()=>No.setState({xscroll:Math.round(xi(g,0,f)),yscroll:Math.round(xi(C,0,p))}),16)},[l,f,n.xscroll,c,p,n.yscroll,i.width,i.height]),Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(o4,{context:e}),Ne.jsx(xGe,{}),Ne.jsx(NGe,{...d}),Ne.jsx(kGe,{...d})]})}function PGe(t,e,n,r){const i=t.slice(0,e),s=t.slice(e+n);return`${i}${r??""}${s}`}function DGe(t){const[e,n]=t.split(":"),r=he(n)?e:"self",i=he(n)?n:t;return[r,i]}function LGe({tapeycursor:t,logrowtotalheight:e}){const n=Fd(),r=Qh(),{quickterminal:i}=Ls(),s=ia(),o=Ci(),a=Jh(r),c=s.buffer[s.bufferindex];let l=s.xcursor,u=s.xcursor,d=!1;he(s.xselect)&&he(s.yselect)&&(d=!0,l=Math.min(s.xcursor,s.xselect),u=Math.max(s.xcursor,s.xselect),s.xcursor!==s.xselect&&--u);const h=u-l+1,f=s.ycursor===0,p=d?c.substring(l,u+1):c;function g(U,F,$){s.bufferindex>0&&ia.setState({bufferindex:0}),s.buffer[0]=PGe(c,U,F,$),ia.setState({buffer:s.buffer,xselect:void 0,xcursor:U+($??"").length})}function v(U){const F=s.buffer.length-1,$=xi(U,0,F);ia.setState({bufferindex:$,xcursor:s.buffer[$].length,ycursor:0,xselect:void 0,yselect:void 0})}function E(U){U?he(s.xselect)||ia.setState({xselect:s.xcursor,yselect:s.ycursor}):ia.setState({xselect:void 0,yselect:void 0})}function T(){he(s.xselect)&&(ia.setState({xcursor:l,xselect:void 0,yselect:void 0}),g(l,h))}function C(){ia.setState({xcursor:c.length,ycursor:0,xselect:void 0,yselect:void 0})}if(r.reset.bg=cS(i),!i){j0(!1,!1,0,0,r);const U="main:0.33.0 - if lost try #help";r.x=a.right-U.length,qn(`$dkcyan${U}`,r,!0)}const A="$196",I="$205".repeat(a.width-6);j0(!1,!1,0,a.height-2,r),r.active.color=cr.WHITE,qn(`  ${A}${I}${A}  `,r,!0);const N=c.padEnd(a.width," ");if(j0(!1,!1,0,a.height-1,r),r.active.color=cr.WHITE,cK(N,r,!0),he(s.xselect)&&he(s.yselect)&&s.xcursor!==s.xselect){const U=Math.min(s.xcursor,s.xselect),F=Math.min(s.ycursor,s.yselect),$=Math.max(s.xcursor,s.xselect)-1,X=Math.max(s.ycursor,s.yselect);for(let q=F;q<=X;++q){const W=U+(a.bottom-q)*a.width,K=$+(a.bottom-q)*a.width;Fw(W,K,15,8,r)}}if(n){const U=a.left+s.xcursor,F=a.top+t,$=U+F*r.width;yM($,"",r),Fw($,$,15,r.reset.bg,r)}return ft.useEffect(()=>{let U=s.scroll;t<4&&U++,t>a.bottom-4&&U--,ia.setState({scroll:Math.round(xi(U,0,e))})},[s.scroll,t,e,a.bottom]),Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(UQ,{blocking:!0,x:a.left,y:a.top,width:a.width,height:a.height,onScroll:U=>{E(!1),ia.setState({ycursor:xi(Math.round(s.ycursor-U),0,e)})}}),Ne.jsx(da,{keydown:U=>{const{key:F}=U,$=rr(F),X=Uk(U);switch($){case"arrowleft":E(X.shift),X.ctrl?ia.setState({xcursor:0}):ia.setState({xcursor:xi(s.xcursor-(X.alt?10:1),0,a.right)});break;case"arrowright":E(X.shift),X.ctrl?ia.setState({xcursor:f?c.length:a.right}):ia.setState({xcursor:xi(s.xcursor+(X.alt?10:1),0,a.right)});break;case"arrowup":X.ctrl?v(s.bufferindex+1):(E(X.shift),ia.setState({ycursor:xi(Math.round(s.ycursor+(X.alt?10:1)),0,e)}));break;case"arrowdown":X.ctrl?v(s.bufferindex-1):(E(X.shift),ia.setState({ycursor:xi(Math.round(s.ycursor-(X.alt?10:1)),0,e)}));break;case"enter":{const q=d?p:c;q.length&&(f?(ia.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:["",q,...s.buffer.slice(1).filter(W=>W!==q)]}),fE(qe,q,o),i&&Q1(qe,o)):C());break}case"esc":case"escape":Q1(qe,o);break;case"tab":vG(qe,!X.shift,o);break;case"delete":f?d?T():c.length>0&&g(s.xcursor,1):C();break;case"backspace":f?d?T():s.xcursor>0&&g(s.xcursor-1,1):C();break;default:if(X.ctrl)switch($){case"a":ia.setState({xselect:0,yselect:0,xcursor:c.length,ycursor:0});break;case"c":f&&he(ua())?ua().writeText(p).catch(q=>console.error(q)):C();break;case"v":f&&he(ua())?ua().readText().then(q=>{const W=q.replaceAll("\r","");d?g(l,h,W):g(s.xcursor,0,W)}).catch(q=>console.error(q)):C();break;case"x":f&&he(ua())?ua().writeText(p).then(()=>T()).catch(q=>console.error(q)):C();break}else X.alt||F.length===1&&(f&&s.xcursor<=c.length?d?(g(l,h,F),ia.setState({xselect:void 0})):g(s.xcursor,0,F):C());break}}})]})}function UGe({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const o=Qh(),a=ft.useCallback(()=>{if(he(ua())){const[,...l]=i,u=l.join(" ");ua().writeText(u).then(()=>Oi(qe,"copied!")).catch(d=>console.error(d))}},[i]),c=$d(!!e);return j0(!!t,!!e,0,s,o),qn(`${n} $purple$16 $yellowCOPYIT ${c}${r}`,o,!0),e&&Ne.jsx(da,{OK_BUTTON:a})}function FGe({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const o=Qh(),a=ft.useContext(DQ),c=ft.useCallback(()=>{const[u,d]=i;a.sendmessage(u,d)},[i,a]),l=$d(!!e);return j0(!!t,!!e,0,s,o),qn(`${n} $purple$16 ${l}${r}`,o,!0),e&&Ne.jsx(da,{OK_BUTTON:c})}function BGe({blink:t,active:e,prefix:n,label:r,words:i,y:s}){const o=Qh(),a=ft.useCallback(()=>{const[,...l]=i,u=l.join(" ");window.open(u,"_blank")},[i]),c=$d(!!e);return j0(!!t,!!e,0,s,o),qn(`${n} $purple$16 $yellowOPENIT ${c}${r}`,o,!0),e&&Ne.jsx(da,{OK_BUTTON:a})}function FQ({blink:t,active:e,text:n,y:r}){const i=Qh(),{quickterminal:s}=Ls(),o=Jh(i),a=n.startsWith("!");if(j0(!!t,!!e,0,r,i),i.reset.bg=e?s4:cS(s),i.active.bottomedge=o.bottom,qn(a?"":n,i,!0),a){const[c,...l]=n.slice(1).split("!"),u=`${l.join("!")}`;let d="PRESS ME";const h=[];gM(u,!0).tokens.forEach(E=>{switch(E.tokenType){case CB:d=E.image.slice(1);break;default:h.push(E.image);break}});const[p,...g]=h,v={blink:t,active:e,prefix:c,label:d,words:g,y:r};switch(rr(p)){case"copyit":return Ne.jsx(UGe,{...v,words:h});case"openit":return Ne.jsx(BGe,{...v,words:h});default:case"hyperlink":return Ne.jsx(FGe,{...v,words:h});case"hk":case"hotkey":return null;case"rn":case"range":return null;case"sl":case"select":return null;case"nm":case"number":return null;case"tx":case"text":return null;case"zssedit":return null;case"charedit":return null;case"coloredit":return null}}return null}function jGe(t){const e=Fd();return Ne.jsx(FQ,{active:!0,blink:e,...t})}function ZP(){const t=Ci(),[e]=Ls(wp(f=>[f.editor.open])),n=Ls(wp(f=>f.terminal.logs)),r=Qh(),i=ia(),s=Jh(r),o=n.map(f=>{const[,p,g,...v]=f;let E="$white";switch(p){case"debug":E="$yellow";break;case"error":E="$red";break}const T=v.map(k=>`${k}`).join(" "),C=T.startsWith("!"),A=`$onclear${E}${g}$white$180$blue`;return`${C?"!":""}${A}${T}`}),a=o.map(f=>{if(f.startsWith("!"))return 1;const p=_M(f,s.width,s.height);return(p==null?void 0:p.y)??1}),c=s.bottom-s.top-(e?0:2);let l=0,u=c+1;const d=a.map(f=>(u-=f,l+=f,u));++l;const h=s.bottom-i.ycursor+i.scroll;return Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(o4,{context:r}),Ne.jsxs(DQ.Provider,{value:{sendmessage(f,p){const[g,v]=DGe(f);if(g==="self"){const E=`#${v} ${p??""}`;fE(qe,E,t)}else qe.emit(`${g}:${v}`,p,t)}},children:[o.map((f,p)=>{const g=d[p]+i.scroll,v=a[p],E=g+v;return E<0||g>c?null:!e&&h>=g&&h<E?Ne.jsx(jGe,{text:f,y:g},p):Ne.jsx(FQ,{text:f,y:g},p)}),!e&&Ne.jsx(LGe,{tapeycursor:h,logrowtotalheight:l})]})]})}function t6(t,e,n,r,i){return{...i,x:t,y:e,reset:{...$c(i.reset),topedge:e,leftedge:t,rightedge:n,bottomedge:r},active:{...$c(i.active),topedge:e,leftedge:t,rightedge:n,bottomedge:r}}}function $Ge({context:t}){const[e,n]=Ls(wp(d=>[d.layout,d.editor.open])),r=0,i=0,s=t.width-1,o=t.height-1,a=Jh(t),c=Math.floor(a.height*.5),l=ft.useMemo(()=>t6(i,r,s,c-1,t),[c,s,t]),u=ft.useMemo(()=>t6(i,c,s,o,t),[c,s,o,t]);if(n)switch(e){case ju.SPLIT_Y:return Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Iv.Provider,{value:l,children:Ne.jsx(ZP,{})}),Ne.jsx(Iv.Provider,{value:u,children:Ne.jsx(QP,{})})]});case ju.SPLIT_Y_ALT:return Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Iv.Provider,{value:l,children:Ne.jsx(QP,{})}),Ne.jsx(Iv.Provider,{value:u,children:Ne.jsx(ZP,{})})]});default:return Ne.jsx(Iv.Provider,{value:t,children:Ne.jsx(QP,{})})}return Ne.jsx(Iv.Provider,{value:t,children:Ne.jsx(ZP,{})},"single")}function HGe(){const t=i4();let e=0,n=t.rows-2;const[r,i,s,o]=Ls(wp(h=>[h.layout,h.quickterminal,h.terminal.open,h.editor.open]));switch(r){case ju.TOP:n=Math.floor(t.rows*.5);break;case ju.BOTTOM:n=Math.ceil(t.rows*.5),e=t.rows-n;break;default:case ju.FULL:break}const a=cS(i),c=bM(t.cols,n,0,oA,a),l={...yy(t.cols,n,oA,a),...c.getState()};if(t.cols<10||t.rows<10)return null;const u=Ci(),d=i||s||o;return Ne.jsxs(Fk,{store:c,children:[d&&Ne.jsx(iA,{width:t.cols,height:t.rows,top:e,left:0,right:t.cols-1,bottom:e+n-1}),d?Ne.jsxs(Ry,{blockhotkeys:!0,children:[Ne.jsx(o4,{context:l}),Ne.jsx($Ge,{context:l}),Ne.jsx("group",{position:[0,e*ar.DRAW_CHAR_HEIGHT(),0],children:Ne.jsx(Bk,{width:t.cols,height:n})})]}):Ne.jsx(rE,{hotkey:"Shift+?",children:()=>Ble(qe,u)})]})}var BQ={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(self,()=>(()=>{var n={9669:(o,a,c)=>{o.exports=c(1609)},5448:(o,a,c)=>{var l=c(4867),u=c(6026),d=c(4372),h=c(5327),f=c(4097),p=c(4109),g=c(7985),v=c(7874),E=c(2648),T=c(644),C=c(205);o.exports=function(A){return new Promise(function(k,I){var N,U=A.data,F=A.headers,$=A.responseType;function X(){A.cancelToken&&A.cancelToken.unsubscribe(N),A.signal&&A.signal.removeEventListener("abort",N)}l.isFormData(U)&&l.isStandardBrowserEnv()&&delete F["Content-Type"];var q=new XMLHttpRequest;if(A.auth){var W=A.auth.username||"",K=A.auth.password?unescape(encodeURIComponent(A.auth.password)):"";F.Authorization="Basic "+btoa(W+":"+K)}var ne=f(A.baseURL,A.url);function Q(){if(q){var Z="getAllResponseHeaders"in q?p(q.getAllResponseHeaders()):null,se={data:$&&$!=="text"&&$!=="json"?q.response:q.responseText,status:q.status,statusText:q.statusText,headers:Z,config:A,request:q};u(function(ue){k(ue),X()},function(ue){I(ue),X()},se),q=null}}if(q.open(A.method.toUpperCase(),h(ne,A.params,A.paramsSerializer),!0),q.timeout=A.timeout,"onloadend"in q?q.onloadend=Q:q.onreadystatechange=function(){q&&q.readyState===4&&(q.status!==0||q.responseURL&&q.responseURL.indexOf("file:")===0)&&setTimeout(Q)},q.onabort=function(){q&&(I(new E("Request aborted",E.ECONNABORTED,A,q)),q=null)},q.onerror=function(){I(new E("Network Error",E.ERR_NETWORK,A,q,q)),q=null},q.ontimeout=function(){var Z=A.timeout?"timeout of "+A.timeout+"ms exceeded":"timeout exceeded",se=A.transitional||v;A.timeoutErrorMessage&&(Z=A.timeoutErrorMessage),I(new E(Z,se.clarifyTimeoutError?E.ETIMEDOUT:E.ECONNABORTED,A,q)),q=null},l.isStandardBrowserEnv()){var ie=(A.withCredentials||g(ne))&&A.xsrfCookieName?d.read(A.xsrfCookieName):void 0;ie&&(F[A.xsrfHeaderName]=ie)}"setRequestHeader"in q&&l.forEach(F,function(Z,se){U===void 0&&se.toLowerCase()==="content-type"?delete F[se]:q.setRequestHeader(se,Z)}),l.isUndefined(A.withCredentials)||(q.withCredentials=!!A.withCredentials),$&&$!=="json"&&(q.responseType=A.responseType),typeof A.onDownloadProgress=="function"&&q.addEventListener("progress",A.onDownloadProgress),typeof A.onUploadProgress=="function"&&q.upload&&q.upload.addEventListener("progress",A.onUploadProgress),(A.cancelToken||A.signal)&&(N=function(Z){q&&(I(!Z||Z&&Z.type?new T:Z),q.abort(),q=null)},A.cancelToken&&A.cancelToken.subscribe(N),A.signal&&(A.signal.aborted?N():A.signal.addEventListener("abort",N))),U||(U=null);var G=C(ne);G&&["http","https","file"].indexOf(G)===-1?I(new E("Unsupported protocol "+G+":",E.ERR_BAD_REQUEST,A)):q.send(U)})}},1609:(o,a,c)=>{var l=c(4867),u=c(1849),d=c(321),h=c(7185),f=function p(g){var v=new d(g),E=u(d.prototype.request,v);return l.extend(E,d.prototype,v),l.extend(E,v),E.create=function(T){return p(h(g,T))},E}(c(5546));f.Axios=d,f.CanceledError=c(644),f.CancelToken=c(4972),f.isCancel=c(6502),f.VERSION=c(7288).version,f.toFormData=c(7675),f.AxiosError=c(2648),f.Cancel=f.CanceledError,f.all=function(p){return Promise.all(p)},f.spread=c(8713),f.isAxiosError=c(6268),o.exports=f,o.exports.default=f},4972:(o,a,c)=>{var l=c(644);function u(d){if(typeof d!="function")throw new TypeError("executor must be a function.");var h;this.promise=new Promise(function(p){h=p});var f=this;this.promise.then(function(p){if(f._listeners){var g,v=f._listeners.length;for(g=0;g<v;g++)f._listeners[g](p);f._listeners=null}}),this.promise.then=function(p){var g,v=new Promise(function(E){f.subscribe(E),g=E}).then(p);return v.cancel=function(){f.unsubscribe(g)},v},d(function(p){f.reason||(f.reason=new l(p),h(f.reason))})}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.prototype.subscribe=function(d){this.reason?d(this.reason):this._listeners?this._listeners.push(d):this._listeners=[d]},u.prototype.unsubscribe=function(d){if(this._listeners){var h=this._listeners.indexOf(d);h!==-1&&this._listeners.splice(h,1)}},u.source=function(){var d;return{token:new u(function(h){d=h}),cancel:d}},o.exports=u},644:(o,a,c)=>{var l=c(2648);function u(d){l.call(this,d??"canceled",l.ERR_CANCELED),this.name="CanceledError"}c(4867).inherits(u,l,{__CANCEL__:!0}),o.exports=u},6502:o=>{o.exports=function(a){return!(!a||!a.__CANCEL__)}},321:(o,a,c)=>{var l=c(4867),u=c(5327),d=c(782),h=c(3572),f=c(7185),p=c(4097),g=c(4875),v=g.validators;function E(T){this.defaults=T,this.interceptors={request:new d,response:new d}}E.prototype.request=function(T,C){typeof T=="string"?(C=C||{}).url=T:C=T||{},(C=f(this.defaults,C)).method?C.method=C.method.toLowerCase():this.defaults.method?C.method=this.defaults.method.toLowerCase():C.method="get";var A=C.transitional;A!==void 0&&g.assertOptions(A,{silentJSONParsing:v.transitional(v.boolean),forcedJSONParsing:v.transitional(v.boolean),clarifyTimeoutError:v.transitional(v.boolean)},!1);var k=[],I=!0;this.interceptors.request.forEach(function(W){typeof W.runWhen=="function"&&W.runWhen(C)===!1||(I=I&&W.synchronous,k.unshift(W.fulfilled,W.rejected))});var N,U=[];if(this.interceptors.response.forEach(function(W){U.push(W.fulfilled,W.rejected)}),!I){var F=[h,void 0];for(Array.prototype.unshift.apply(F,k),F=F.concat(U),N=Promise.resolve(C);F.length;)N=N.then(F.shift(),F.shift());return N}for(var $=C;k.length;){var X=k.shift(),q=k.shift();try{$=X($)}catch(W){q(W);break}}try{N=h($)}catch(W){return Promise.reject(W)}for(;U.length;)N=N.then(U.shift(),U.shift());return N},E.prototype.getUri=function(T){T=f(this.defaults,T);var C=p(T.baseURL,T.url);return u(C,T.params,T.paramsSerializer)},l.forEach(["delete","get","head","options"],function(T){E.prototype[T]=function(C,A){return this.request(f(A||{},{method:T,url:C,data:(A||{}).data}))}}),l.forEach(["post","put","patch"],function(T){function C(A){return function(k,I,N){return this.request(f(N||{},{method:T,headers:A?{"Content-Type":"multipart/form-data"}:{},url:k,data:I}))}}E.prototype[T]=C(),E.prototype[T+"Form"]=C(!0)}),o.exports=E},2648:(o,a,c)=>{var l=c(4867);function u(f,p,g,v,E){Error.call(this),this.message=f,this.name="AxiosError",p&&(this.code=p),g&&(this.config=g),v&&(this.request=v),E&&(this.response=E)}l.inherits(u,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var d=u.prototype,h={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(f){h[f]={value:f}}),Object.defineProperties(u,h),Object.defineProperty(d,"isAxiosError",{value:!0}),u.from=function(f,p,g,v,E,T){var C=Object.create(d);return l.toFlatObject(f,C,function(A){return A!==Error.prototype}),u.call(C,f.message,p,g,v,E),C.name=f.name,T&&Object.assign(C,T),C},o.exports=u},782:(o,a,c)=>{var l=c(4867);function u(){this.handlers=[]}u.prototype.use=function(d,h,f){return this.handlers.push({fulfilled:d,rejected:h,synchronous:!!f&&f.synchronous,runWhen:f?f.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(d){this.handlers[d]&&(this.handlers[d]=null)},u.prototype.forEach=function(d){l.forEach(this.handlers,function(h){h!==null&&d(h)})},o.exports=u},4097:(o,a,c)=>{var l=c(1793),u=c(7303);o.exports=function(d,h){return d&&!l(h)?u(d,h):h}},3572:(o,a,c)=>{var l=c(4867),u=c(8527),d=c(6502),h=c(5546),f=c(644);function p(g){if(g.cancelToken&&g.cancelToken.throwIfRequested(),g.signal&&g.signal.aborted)throw new f}o.exports=function(g){return p(g),g.headers=g.headers||{},g.data=u.call(g,g.data,g.headers,g.transformRequest),g.headers=l.merge(g.headers.common||{},g.headers[g.method]||{},g.headers),l.forEach(["delete","get","head","post","put","patch","common"],function(v){delete g.headers[v]}),(g.adapter||h.adapter)(g).then(function(v){return p(g),v.data=u.call(g,v.data,v.headers,g.transformResponse),v},function(v){return d(v)||(p(g),v&&v.response&&(v.response.data=u.call(g,v.response.data,v.response.headers,g.transformResponse))),Promise.reject(v)})}},7185:(o,a,c)=>{var l=c(4867);o.exports=function(u,d){d=d||{};var h={};function f(C,A){return l.isPlainObject(C)&&l.isPlainObject(A)?l.merge(C,A):l.isPlainObject(A)?l.merge({},A):l.isArray(A)?A.slice():A}function p(C){return l.isUndefined(d[C])?l.isUndefined(u[C])?void 0:f(void 0,u[C]):f(u[C],d[C])}function g(C){if(!l.isUndefined(d[C]))return f(void 0,d[C])}function v(C){return l.isUndefined(d[C])?l.isUndefined(u[C])?void 0:f(void 0,u[C]):f(void 0,d[C])}function E(C){return C in d?f(u[C],d[C]):C in u?f(void 0,u[C]):void 0}var T={url:g,method:g,data:g,baseURL:v,transformRequest:v,transformResponse:v,paramsSerializer:v,timeout:v,timeoutMessage:v,withCredentials:v,adapter:v,responseType:v,xsrfCookieName:v,xsrfHeaderName:v,onUploadProgress:v,onDownloadProgress:v,decompress:v,maxContentLength:v,maxBodyLength:v,beforeRedirect:v,transport:v,httpAgent:v,httpsAgent:v,cancelToken:v,socketPath:v,responseEncoding:v,validateStatus:E};return l.forEach(Object.keys(u).concat(Object.keys(d)),function(C){var A=T[C]||p,k=A(C);l.isUndefined(k)&&A!==E||(h[C]=k)}),h}},6026:(o,a,c)=>{var l=c(2648);o.exports=function(u,d,h){var f=h.config.validateStatus;h.status&&f&&!f(h.status)?d(new l("Request failed with status code "+h.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(h.status/100)-4],h.config,h.request,h)):u(h)}},8527:(o,a,c)=>{var l=c(4867),u=c(5546);o.exports=function(d,h,f){var p=this||u;return l.forEach(f,function(g){d=g.call(p,d,h)}),d}},5546:(o,a,c)=>{var l=c(4867),u=c(6016),d=c(2648),h=c(7874),f=c(7675),p={"Content-Type":"application/x-www-form-urlencoded"};function g(T,C){!l.isUndefined(T)&&l.isUndefined(T["Content-Type"])&&(T["Content-Type"]=C)}var v,E={transitional:h,adapter:((typeof XMLHttpRequest<"u"||typeof Hn<"u"&&Object.prototype.toString.call(Hn)==="[object process]")&&(v=c(5448)),v),transformRequest:[function(T,C){if(u(C,"Accept"),u(C,"Content-Type"),l.isFormData(T)||l.isArrayBuffer(T)||l.isBuffer(T)||l.isStream(T)||l.isFile(T)||l.isBlob(T))return T;if(l.isArrayBufferView(T))return T.buffer;if(l.isURLSearchParams(T))return g(C,"application/x-www-form-urlencoded;charset=utf-8"),T.toString();var A,k=l.isObject(T),I=C&&C["Content-Type"];if((A=l.isFileList(T))||k&&I==="multipart/form-data"){var N=this.env&&this.env.FormData;return f(A?{"files[]":T}:T,N&&new N)}return k||I==="application/json"?(g(C,"application/json"),function(U,F,$){if(l.isString(U))try{return(F||JSON.parse)(U),l.trim(U)}catch(X){if(X.name!=="SyntaxError")throw X}return(0,JSON.stringify)(U)}(T)):T}],transformResponse:[function(T){var C=this.transitional||E.transitional,A=C&&C.silentJSONParsing,k=C&&C.forcedJSONParsing,I=!A&&this.responseType==="json";if(I||k&&l.isString(T)&&T.length)try{return JSON.parse(T)}catch(N){if(I)throw N.name==="SyntaxError"?d.from(N,d.ERR_BAD_RESPONSE,this,null,this.response):N}return T}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c(1623)},validateStatus:function(T){return T>=200&&T<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],function(T){E.headers[T]={}}),l.forEach(["post","put","patch"],function(T){E.headers[T]=l.merge(p)}),o.exports=E},7874:o=>{o.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},7288:o=>{o.exports={version:"0.27.2"}},1849:o=>{o.exports=function(a,c){return function(){for(var l=new Array(arguments.length),u=0;u<l.length;u++)l[u]=arguments[u];return a.apply(c,l)}}},5327:(o,a,c)=>{var l=c(4867);function u(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}o.exports=function(d,h,f){if(!h)return d;var p;if(f)p=f(h);else if(l.isURLSearchParams(h))p=h.toString();else{var g=[];l.forEach(h,function(E,T){E!=null&&(l.isArray(E)?T+="[]":E=[E],l.forEach(E,function(C){l.isDate(C)?C=C.toISOString():l.isObject(C)&&(C=JSON.stringify(C)),g.push(u(T)+"="+u(C))}))}),p=g.join("&")}if(p){var v=d.indexOf("#");v!==-1&&(d=d.slice(0,v)),d+=(d.indexOf("?")===-1?"?":"&")+p}return d}},7303:o=>{o.exports=function(a,c){return c?a.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):a}},4372:(o,a,c)=>{var l=c(4867);o.exports=l.isStandardBrowserEnv()?{write:function(u,d,h,f,p,g){var v=[];v.push(u+"="+encodeURIComponent(d)),l.isNumber(h)&&v.push("expires="+new Date(h).toGMTString()),l.isString(f)&&v.push("path="+f),l.isString(p)&&v.push("domain="+p),g===!0&&v.push("secure"),document.cookie=v.join("; ")},read:function(u){var d=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},1793:o=>{o.exports=function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}},6268:(o,a,c)=>{var l=c(4867);o.exports=function(u){return l.isObject(u)&&u.isAxiosError===!0}},7985:(o,a,c)=>{var l=c(4867);o.exports=l.isStandardBrowserEnv()?function(){var u,d=/(msie|trident)/i.test(navigator.userAgent),h=document.createElement("a");function f(p){var g=p;return d&&(h.setAttribute("href",g),g=h.href),h.setAttribute("href",g),{href:h.href,protocol:h.protocol?h.protocol.replace(/:$/,""):"",host:h.host,search:h.search?h.search.replace(/^\?/,""):"",hash:h.hash?h.hash.replace(/^#/,""):"",hostname:h.hostname,port:h.port,pathname:h.pathname.charAt(0)==="/"?h.pathname:"/"+h.pathname}}return u=f(window.location.href),function(p){var g=l.isString(p)?f(p):p;return g.protocol===u.protocol&&g.host===u.host}}():function(){return!0}},6016:(o,a,c)=>{var l=c(4867);o.exports=function(u,d){l.forEach(u,function(h,f){f!==d&&f.toUpperCase()===d.toUpperCase()&&(u[d]=h,delete u[f])})}},1623:o=>{o.exports=null},4109:(o,a,c)=>{var l=c(4867),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];o.exports=function(d){var h,f,p,g={};return d&&l.forEach(d.split(`
`),function(v){if(p=v.indexOf(":"),h=l.trim(v.substr(0,p)).toLowerCase(),f=l.trim(v.substr(p+1)),h){if(g[h]&&u.indexOf(h)>=0)return;g[h]=h==="set-cookie"?(g[h]?g[h]:[]).concat([f]):g[h]?g[h]+", "+f:f}}),g}},205:o=>{o.exports=function(a){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return c&&c[1]||""}},8713:o=>{o.exports=function(a){return function(c){return a.apply(null,c)}}},7675:(o,a,c)=>{var l=c(4867);o.exports=function(u,d){d=d||new FormData;var h=[];function f(p){return p===null?"":l.isDate(p)?p.toISOString():l.isArrayBuffer(p)||l.isTypedArray(p)?typeof Blob=="function"?new Blob([p]):Tc.from(p):p}return function p(g,v){if(l.isPlainObject(g)||l.isArray(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+v);h.push(g),l.forEach(g,function(E,T){if(!l.isUndefined(E)){var C,A=v?v+"."+T:T;if(E&&!v&&typeof E=="object"){if(l.endsWith(T,"{}"))E=JSON.stringify(E);else if(l.endsWith(T,"[]")&&(C=l.toArray(E)))return void C.forEach(function(k){!l.isUndefined(k)&&d.append(A,f(k))})}p(E,A)}}),h.pop()}else d.append(v,f(g))}(u),d}},4875:(o,a,c)=>{var l=c(7288).version,u=c(2648),d={};["object","boolean","number","function","string","symbol"].forEach(function(f,p){d[f]=function(g){return typeof g===f||"a"+(p<1?"n ":" ")+f}});var h={};d.transitional=function(f,p,g){function v(E,T){return"[Axios v"+l+"] Transitional option '"+E+"'"+T+(g?". "+g:"")}return function(E,T,C){if(f===!1)throw new u(v(T," has been removed"+(p?" in "+p:"")),u.ERR_DEPRECATED);return p&&!h[T]&&(h[T]=!0,console.warn(v(T," has been deprecated since v"+p+" and will be removed in the near future"))),!f||f(E,T,C)}},o.exports={assertOptions:function(f,p,g){if(typeof f!="object")throw new u("options must be an object",u.ERR_BAD_OPTION_VALUE);for(var v=Object.keys(f),E=v.length;E-- >0;){var T=v[E],C=p[T];if(C){var A=f[T],k=A===void 0||C(A,T,f);if(k!==!0)throw new u("option "+T+" must be "+k,u.ERR_BAD_OPTION_VALUE)}else if(g!==!0)throw new u("Unknown option "+T,u.ERR_BAD_OPTION)}},validators:d}},4867:(o,a,c)=>{var l,u=c(1849),d=Object.prototype.toString,h=(l=Object.create(null),function(q){var W=d.call(q);return l[W]||(l[W]=W.slice(8,-1).toLowerCase())});function f(q){return q=q.toLowerCase(),function(W){return h(W)===q}}function p(q){return Array.isArray(q)}function g(q){return q===void 0}var v=f("ArrayBuffer");function E(q){return q!==null&&typeof q=="object"}function T(q){if(h(q)!=="object")return!1;var W=Object.getPrototypeOf(q);return W===null||W===Object.prototype}var C=f("Date"),A=f("File"),k=f("Blob"),I=f("FileList");function N(q){return d.call(q)==="[object Function]"}var U=f("URLSearchParams");function F(q,W){if(q!=null)if(typeof q!="object"&&(q=[q]),p(q))for(var K=0,ne=q.length;K<ne;K++)W.call(null,q[K],K,q);else for(var Q in q)Object.prototype.hasOwnProperty.call(q,Q)&&W.call(null,q[Q],Q,q)}var $,X=($=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(q){return $&&q instanceof $});o.exports={isArray:p,isArrayBuffer:v,isBuffer:function(q){return q!==null&&!g(q)&&q.constructor!==null&&!g(q.constructor)&&typeof q.constructor.isBuffer=="function"&&q.constructor.isBuffer(q)},isFormData:function(q){var W="[object FormData]";return q&&(typeof FormData=="function"&&q instanceof FormData||d.call(q)===W||N(q.toString)&&q.toString()===W)},isArrayBufferView:function(q){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(q):q&&q.buffer&&v(q.buffer)},isString:function(q){return typeof q=="string"},isNumber:function(q){return typeof q=="number"},isObject:E,isPlainObject:T,isUndefined:g,isDate:C,isFile:A,isBlob:k,isFunction:N,isStream:function(q){return E(q)&&N(q.pipe)},isURLSearchParams:U,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:F,merge:function q(){var W={};function K(ie,G){T(W[G])&&T(ie)?W[G]=q(W[G],ie):T(ie)?W[G]=q({},ie):p(ie)?W[G]=ie.slice():W[G]=ie}for(var ne=0,Q=arguments.length;ne<Q;ne++)F(arguments[ne],K);return W},extend:function(q,W,K){return F(W,function(ne,Q){q[Q]=K&&typeof ne=="function"?u(ne,K):ne}),q},trim:function(q){return q.trim?q.trim():q.replace(/^\s+|\s+$/g,"")},stripBOM:function(q){return q.charCodeAt(0)===65279&&(q=q.slice(1)),q},inherits:function(q,W,K,ne){q.prototype=Object.create(W.prototype,ne),q.prototype.constructor=q,K&&Object.assign(q.prototype,K)},toFlatObject:function(q,W,K){var ne,Q,ie,G={};W=W||{};do{for(Q=(ne=Object.getOwnPropertyNames(q)).length;Q-- >0;)G[ie=ne[Q]]||(W[ie]=q[ie],G[ie]=!0);q=Object.getPrototypeOf(q)}while(q&&(!K||K(q,W))&&q!==Object.prototype);return W},kindOf:h,kindOfTest:f,endsWith:function(q,W,K){q=String(q),(K===void 0||K>q.length)&&(K=q.length),K-=W.length;var ne=q.indexOf(W,K);return ne!==-1&&ne===K},toArray:function(q){if(!q)return null;var W=q.length;if(g(W))return null;for(var K=new Array(W);W-- >0;)K[W]=q[W];return K},isTypedArray:X,isFileList:I}},1206:function(o){o.exports=function(a){var c={};function l(u){if(c[u])return c[u].exports;var d=c[u]={i:u,l:!1,exports:{}};return a[u].call(d.exports,d,d.exports,l),d.l=!0,d.exports}return l.m=a,l.c=c,l.d=function(u,d,h){l.o(u,d)||Object.defineProperty(u,d,{enumerable:!0,get:h})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,d){if(1&d&&(u=l(u)),8&d||4&d&&typeof u=="object"&&u&&u.__esModule)return u;var h=Object.create(null);if(l.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:u}),2&d&&typeof u!="string")for(var f in u)l.d(h,f,(function(p){return u[p]}).bind(null,f));return h},l.n=function(u){var d=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(d,"a",d),d},l.o=function(u,d){return Object.prototype.hasOwnProperty.call(u,d)},l.p="",l(l.s=90)}({17:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=l(18),d=function(){function h(){}return h.getFirstMatch=function(f,p){var g=p.match(f);return g&&g.length>0&&g[1]||""},h.getSecondMatch=function(f,p){var g=p.match(f);return g&&g.length>1&&g[2]||""},h.matchAndReturnConst=function(f,p,g){if(f.test(p))return g},h.getWindowsVersionName=function(f){switch(f){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},h.getMacOSVersionName=function(f){var p=f.split(".").splice(0,2).map(function(g){return parseInt(g,10)||0});if(p.push(0),p[0]===10)switch(p[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},h.getAndroidVersionName=function(f){var p=f.split(".").splice(0,2).map(function(g){return parseInt(g,10)||0});if(p.push(0),!(p[0]===1&&p[1]<5))return p[0]===1&&p[1]<6?"Cupcake":p[0]===1&&p[1]>=6?"Donut":p[0]===2&&p[1]<2?"Eclair":p[0]===2&&p[1]===2?"Froyo":p[0]===2&&p[1]>2?"Gingerbread":p[0]===3?"Honeycomb":p[0]===4&&p[1]<1?"Ice Cream Sandwich":p[0]===4&&p[1]<4?"Jelly Bean":p[0]===4&&p[1]>=4?"KitKat":p[0]===5?"Lollipop":p[0]===6?"Marshmallow":p[0]===7?"Nougat":p[0]===8?"Oreo":p[0]===9?"Pie":void 0},h.getVersionPrecision=function(f){return f.split(".").length},h.compareVersions=function(f,p,g){g===void 0&&(g=!1);var v=h.getVersionPrecision(f),E=h.getVersionPrecision(p),T=Math.max(v,E),C=0,A=h.map([f,p],function(k){var I=T-h.getVersionPrecision(k),N=k+new Array(I+1).join(".0");return h.map(N.split("."),function(U){return new Array(20-U.length).join("0")+U}).reverse()});for(g&&(C=T-Math.min(v,E)),T-=1;T>=C;){if(A[0][T]>A[1][T])return 1;if(A[0][T]===A[1][T]){if(T===C)return 0;T-=1}else if(A[0][T]<A[1][T])return-1}},h.map=function(f,p){var g,v=[];if(Array.prototype.map)return Array.prototype.map.call(f,p);for(g=0;g<f.length;g+=1)v.push(p(f[g]));return v},h.find=function(f,p){var g,v;if(Array.prototype.find)return Array.prototype.find.call(f,p);for(g=0,v=f.length;g<v;g+=1){var E=f[g];if(p(E,g))return E}},h.assign=function(f){for(var p,g,v=f,E=arguments.length,T=new Array(E>1?E-1:0),C=1;C<E;C++)T[C-1]=arguments[C];if(Object.assign)return Object.assign.apply(Object,[f].concat(T));var A=function(){var k=T[p];typeof k=="object"&&k!==null&&Object.keys(k).forEach(function(I){v[I]=k[I]})};for(p=0,g=T.length;p<g;p+=1)A();return f},h.getBrowserAlias=function(f){return u.BROWSER_ALIASES_MAP[f]},h.getBrowserTypeByAlias=function(f){return u.BROWSER_MAP[f]||""},h}();c.default=d,a.exports=c.default},18:function(a,c,l){c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(91))&&u.__esModule?u:{default:u},h=l(18);function f(g,v){for(var E=0;E<v.length;E++){var T=v[E];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(g,T.key,T)}}var p=function(){function g(){}var v,E,T;return g.getParser=function(C,A){if(A===void 0&&(A=!1),typeof C!="string")throw new Error("UserAgent should be a string");return new d.default(C,A)},g.parse=function(C){return new d.default(C).getResult()},v=g,T=[{key:"BROWSER_MAP",get:function(){return h.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return h.ENGINE_MAP}},{key:"OS_MAP",get:function(){return h.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return h.PLATFORMS_MAP}}],(E=null)&&f(v.prototype,E),T&&f(v,T),g}();c.default=p,a.exports=c.default},91:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=g(l(92)),d=g(l(93)),h=g(l(94)),f=g(l(95)),p=g(l(17));function g(E){return E&&E.__esModule?E:{default:E}}var v=function(){function E(C,A){if(A===void 0&&(A=!1),C==null||C==="")throw new Error("UserAgent parameter can't be empty");this._ua=C,this.parsedResult={},A!==!0&&this.parse()}var T=E.prototype;return T.getUA=function(){return this._ua},T.test=function(C){return C.test(this._ua)},T.parseBrowser=function(){var C=this;this.parsedResult.browser={};var A=p.default.find(u.default,function(k){if(typeof k.test=="function")return k.test(C);if(k.test instanceof Array)return k.test.some(function(I){return C.test(I)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.browser=A.describe(this.getUA())),this.parsedResult.browser},T.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},T.getBrowserName=function(C){return C?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},T.getBrowserVersion=function(){return this.getBrowser().version},T.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},T.parseOS=function(){var C=this;this.parsedResult.os={};var A=p.default.find(d.default,function(k){if(typeof k.test=="function")return k.test(C);if(k.test instanceof Array)return k.test.some(function(I){return C.test(I)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.os=A.describe(this.getUA())),this.parsedResult.os},T.getOSName=function(C){var A=this.getOS().name;return C?String(A).toLowerCase()||"":A||""},T.getOSVersion=function(){return this.getOS().version},T.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},T.getPlatformType=function(C){C===void 0&&(C=!1);var A=this.getPlatform().type;return C?String(A).toLowerCase()||"":A||""},T.parsePlatform=function(){var C=this;this.parsedResult.platform={};var A=p.default.find(h.default,function(k){if(typeof k.test=="function")return k.test(C);if(k.test instanceof Array)return k.test.some(function(I){return C.test(I)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.platform=A.describe(this.getUA())),this.parsedResult.platform},T.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},T.getEngineName=function(C){return C?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},T.parseEngine=function(){var C=this;this.parsedResult.engine={};var A=p.default.find(f.default,function(k){if(typeof k.test=="function")return k.test(C);if(k.test instanceof Array)return k.test.some(function(I){return C.test(I)});throw new Error("Browser's test function is not valid")});return A&&(this.parsedResult.engine=A.describe(this.getUA())),this.parsedResult.engine},T.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},T.getResult=function(){return p.default.assign({},this.parsedResult)},T.satisfies=function(C){var A=this,k={},I=0,N={},U=0;if(Object.keys(C).forEach(function(Q){var ie=C[Q];typeof ie=="string"?(N[Q]=ie,U+=1):typeof ie=="object"&&(k[Q]=ie,I+=1)}),I>0){var F=Object.keys(k),$=p.default.find(F,function(Q){return A.isOS(Q)});if($){var X=this.satisfies(k[$]);if(X!==void 0)return X}var q=p.default.find(F,function(Q){return A.isPlatform(Q)});if(q){var W=this.satisfies(k[q]);if(W!==void 0)return W}}if(U>0){var K=Object.keys(N),ne=p.default.find(K,function(Q){return A.isBrowser(Q,!0)});if(ne!==void 0)return this.compareVersion(N[ne])}},T.isBrowser=function(C,A){A===void 0&&(A=!1);var k=this.getBrowserName().toLowerCase(),I=C.toLowerCase(),N=p.default.getBrowserTypeByAlias(I);return A&&N&&(I=N.toLowerCase()),I===k},T.compareVersion=function(C){var A=[0],k=C,I=!1,N=this.getBrowserVersion();if(typeof N=="string")return C[0]===">"||C[0]==="<"?(k=C.substr(1),C[1]==="="?(I=!0,k=C.substr(2)):A=[],C[0]===">"?A.push(1):A.push(-1)):C[0]==="="?k=C.substr(1):C[0]==="~"&&(I=!0,k=C.substr(1)),A.indexOf(p.default.compareVersions(N,k,I))>-1},T.isOS=function(C){return this.getOSName(!0)===String(C).toLowerCase()},T.isPlatform=function(C){return this.getPlatformType(!0)===String(C).toLowerCase()},T.isEngine=function(C){return this.getEngineName(!0)===String(C).toLowerCase()},T.is=function(C,A){return A===void 0&&(A=!1),this.isBrowser(C,A)||this.isOS(C)||this.isPlatform(C)},T.some=function(C){var A=this;return C===void 0&&(C=[]),C.some(function(k){return A.is(k)})},E}();c.default=v,a.exports=c.default},92:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(17))&&u.__esModule?u:{default:u},h=/version\/(\d+(\.?_?\d+)+)/i,f=[{test:[/googlebot/i],describe:function(p){var g={name:"Googlebot"},v=d.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/opera/i],describe:function(p){var g={name:"Opera"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/opr\/|opios/i],describe:function(p){var g={name:"Opera"},v=d.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/SamsungBrowser/i],describe:function(p){var g={name:"Samsung Internet for Android"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/Whale/i],describe:function(p){var g={name:"NAVER Whale Browser"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/MZBrowser/i],describe:function(p){var g={name:"MZ Browser"},v=d.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/focus/i],describe:function(p){var g={name:"Focus"},v=d.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/swing/i],describe:function(p){var g={name:"Swing"},v=d.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/coast/i],describe:function(p){var g={name:"Opera Coast"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(p){var g={name:"Opera Touch"},v=d.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/yabrowser/i],describe:function(p){var g={name:"Yandex Browser"},v=d.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/ucbrowser/i],describe:function(p){var g={name:"UC Browser"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/Maxthon|mxios/i],describe:function(p){var g={name:"Maxthon"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/epiphany/i],describe:function(p){var g={name:"Epiphany"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/puffin/i],describe:function(p){var g={name:"Puffin"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/sleipnir/i],describe:function(p){var g={name:"Sleipnir"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/k-meleon/i],describe:function(p){var g={name:"K-Meleon"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/micromessenger/i],describe:function(p){var g={name:"WeChat"},v=d.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/qqbrowser/i],describe:function(p){var g={name:/qqbrowserlite/i.test(p)?"QQ Browser Lite":"QQ Browser"},v=d.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/msie|trident/i],describe:function(p){var g={name:"Internet Explorer"},v=d.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/\sedg\//i],describe:function(p){var g={name:"Microsoft Edge"},v=d.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/edg([ea]|ios)/i],describe:function(p){var g={name:"Microsoft Edge"},v=d.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/vivaldi/i],describe:function(p){var g={name:"Vivaldi"},v=d.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/seamonkey/i],describe:function(p){var g={name:"SeaMonkey"},v=d.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/sailfish/i],describe:function(p){var g={name:"Sailfish"},v=d.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,p);return v&&(g.version=v),g}},{test:[/silk/i],describe:function(p){var g={name:"Amazon Silk"},v=d.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/phantom/i],describe:function(p){var g={name:"PhantomJS"},v=d.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/slimerjs/i],describe:function(p){var g={name:"SlimerJS"},v=d.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var g={name:"BlackBerry"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var g={name:"WebOS Browser"},v=d.default.getFirstMatch(h,p)||d.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/bada/i],describe:function(p){var g={name:"Bada"},v=d.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/tizen/i],describe:function(p){var g={name:"Tizen"},v=d.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/qupzilla/i],describe:function(p){var g={name:"QupZilla"},v=d.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/firefox|iceweasel|fxios/i],describe:function(p){var g={name:"Firefox"},v=d.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/electron/i],describe:function(p){var g={name:"Electron"},v=d.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/MiuiBrowser/i],describe:function(p){var g={name:"Miui"},v=d.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/chromium/i],describe:function(p){var g={name:"Chromium"},v=d.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,p)||d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/chrome|crios|crmo/i],describe:function(p){var g={name:"Chrome"},v=d.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/GSA/i],describe:function(p){var g={name:"Google Search"},v=d.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:function(p){var g=!p.test(/like android/i),v=p.test(/android/i);return g&&v},describe:function(p){var g={name:"Android Browser"},v=d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/playstation 4/i],describe:function(p){var g={name:"PlayStation 4"},v=d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/safari|applewebkit/i],describe:function(p){var g={name:"Safari"},v=d.default.getFirstMatch(h,p);return v&&(g.version=v),g}},{test:[/.*/i],describe:function(p){var g=p.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:d.default.getFirstMatch(g,p),version:d.default.getSecondMatch(g,p)}}}];c.default=f,a.exports=c.default},93:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(17))&&u.__esModule?u:{default:u},h=l(18),f=[{test:[/Roku\/DVP/],describe:function(p){var g=d.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,p);return{name:h.OS_MAP.Roku,version:g}}},{test:[/windows phone/i],describe:function(p){var g=d.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,p);return{name:h.OS_MAP.WindowsPhone,version:g}}},{test:[/windows /i],describe:function(p){var g=d.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,p),v=d.default.getWindowsVersionName(g);return{name:h.OS_MAP.Windows,version:g,versionName:v}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(p){var g={name:h.OS_MAP.iOS},v=d.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,p);return v&&(g.version=v),g}},{test:[/macintosh/i],describe:function(p){var g=d.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,p).replace(/[_\s]/g,"."),v=d.default.getMacOSVersionName(g),E={name:h.OS_MAP.MacOS,version:g};return v&&(E.versionName=v),E}},{test:[/(ipod|iphone|ipad)/i],describe:function(p){var g=d.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,p).replace(/[_\s]/g,".");return{name:h.OS_MAP.iOS,version:g}}},{test:function(p){var g=!p.test(/like android/i),v=p.test(/android/i);return g&&v},describe:function(p){var g=d.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,p),v=d.default.getAndroidVersionName(g),E={name:h.OS_MAP.Android,version:g};return v&&(E.versionName=v),E}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var g=d.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,p),v={name:h.OS_MAP.WebOS};return g&&g.length&&(v.version=g),v}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var g=d.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,p)||d.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,p)||d.default.getFirstMatch(/\bbb(\d+)/i,p);return{name:h.OS_MAP.BlackBerry,version:g}}},{test:[/bada/i],describe:function(p){var g=d.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,p);return{name:h.OS_MAP.Bada,version:g}}},{test:[/tizen/i],describe:function(p){var g=d.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,p);return{name:h.OS_MAP.Tizen,version:g}}},{test:[/linux/i],describe:function(){return{name:h.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:h.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(p){var g=d.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,p);return{name:h.OS_MAP.PlayStation4,version:g}}}];c.default=f,a.exports=c.default},94:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(17))&&u.__esModule?u:{default:u},h=l(18),f=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(p){var g=d.default.getFirstMatch(/(can-l01)/i,p)&&"Nova",v={type:h.PLATFORMS_MAP.mobile,vendor:"Huawei"};return g&&(v.model=g),v}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:h.PLATFORMS_MAP.tablet}}},{test:function(p){var g=p.test(/ipod|iphone/i),v=p.test(/like (ipod|iphone)/i);return g&&!v},describe:function(p){var g=d.default.getFirstMatch(/(ipod|iphone)/i,p);return{type:h.PLATFORMS_MAP.mobile,vendor:"Apple",model:g}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:h.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:h.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName(!0)==="blackberry"},describe:function(){return{type:h.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(p){return p.getBrowserName(!0)==="bada"},describe:function(){return{type:h.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName()==="windows phone"},describe:function(){return{type:h.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(p){var g=Number(String(p.getOSVersion()).split(".")[0]);return p.getOSName(!0)==="android"&&g>=3},describe:function(){return{type:h.PLATFORMS_MAP.tablet}}},{test:function(p){return p.getOSName(!0)==="android"},describe:function(){return{type:h.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getOSName(!0)==="macos"},describe:function(){return{type:h.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(p){return p.getOSName(!0)==="windows"},describe:function(){return{type:h.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="linux"},describe:function(){return{type:h.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="playstation 4"},describe:function(){return{type:h.PLATFORMS_MAP.tv}}},{test:function(p){return p.getOSName(!0)==="roku"},describe:function(){return{type:h.PLATFORMS_MAP.tv}}}];c.default=f,a.exports=c.default},95:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,d=(u=l(17))&&u.__esModule?u:{default:u},h=l(18),f=[{test:function(p){return p.getBrowserName(!0)==="microsoft edge"},describe:function(p){if(/\sedg\//i.test(p))return{name:h.ENGINE_MAP.Blink};var g=d.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,p);return{name:h.ENGINE_MAP.EdgeHTML,version:g}}},{test:[/trident/i],describe:function(p){var g={name:h.ENGINE_MAP.Trident},v=d.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:function(p){return p.test(/presto/i)},describe:function(p){var g={name:h.ENGINE_MAP.Presto},v=d.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:function(p){var g=p.test(/gecko/i),v=p.test(/like gecko/i);return g&&!v},describe:function(p){var g={name:h.ENGINE_MAP.Gecko},v=d.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:h.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(p){var g={name:h.ENGINE_MAP.WebKit},v=d.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,p);return v&&(g.version=v),g}}];c.default=f,a.exports=c.default}})},6729:o=>{var a=Object.prototype.hasOwnProperty,c="~";function l(){}function u(p,g,v){this.fn=p,this.context=g,this.once=v||!1}function d(p,g,v,E,T){if(typeof v!="function")throw new TypeError("The listener must be a function");var C=new u(v,E||p,T),A=c?c+g:g;return p._events[A]?p._events[A].fn?p._events[A]=[p._events[A],C]:p._events[A].push(C):(p._events[A]=C,p._eventsCount++),p}function h(p,g){--p._eventsCount==0?p._events=new l:delete p._events[g]}function f(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(c=!1)),f.prototype.eventNames=function(){var p,g,v=[];if(this._eventsCount===0)return v;for(g in p=this._events)a.call(p,g)&&v.push(c?g.slice(1):g);return Object.getOwnPropertySymbols?v.concat(Object.getOwnPropertySymbols(p)):v},f.prototype.listeners=function(p){var g=c?c+p:p,v=this._events[g];if(!v)return[];if(v.fn)return[v.fn];for(var E=0,T=v.length,C=new Array(T);E<T;E++)C[E]=v[E].fn;return C},f.prototype.listenerCount=function(p){var g=c?c+p:p,v=this._events[g];return v?v.fn?1:v.length:0},f.prototype.emit=function(p,g,v,E,T,C){var A=c?c+p:p;if(!this._events[A])return!1;var k,I,N=this._events[A],U=arguments.length;if(N.fn){switch(N.once&&this.removeListener(p,N.fn,void 0,!0),U){case 1:return N.fn.call(N.context),!0;case 2:return N.fn.call(N.context,g),!0;case 3:return N.fn.call(N.context,g,v),!0;case 4:return N.fn.call(N.context,g,v,E),!0;case 5:return N.fn.call(N.context,g,v,E,T),!0;case 6:return N.fn.call(N.context,g,v,E,T,C),!0}for(I=1,k=new Array(U-1);I<U;I++)k[I-1]=arguments[I];N.fn.apply(N.context,k)}else{var F,$=N.length;for(I=0;I<$;I++)switch(N[I].once&&this.removeListener(p,N[I].fn,void 0,!0),U){case 1:N[I].fn.call(N[I].context);break;case 2:N[I].fn.call(N[I].context,g);break;case 3:N[I].fn.call(N[I].context,g,v);break;case 4:N[I].fn.call(N[I].context,g,v,E);break;default:if(!k)for(F=1,k=new Array(U-1);F<U;F++)k[F-1]=arguments[F];N[I].fn.apply(N[I].context,k)}}return!0},f.prototype.on=function(p,g,v){return d(this,p,g,v,!1)},f.prototype.once=function(p,g,v){return d(this,p,g,v,!0)},f.prototype.removeListener=function(p,g,v,E){var T=c?c+p:p;if(!this._events[T])return this;if(!g)return h(this,T),this;var C=this._events[T];if(C.fn)C.fn!==g||E&&!C.once||v&&C.context!==v||h(this,T);else{for(var A=0,k=[],I=C.length;A<I;A++)(C[A].fn!==g||E&&!C[A].once||v&&C[A].context!==v)&&k.push(C[A]);k.length?this._events[T]=k.length===1?k[0]:k:h(this,T)}return this},f.prototype.removeAllListeners=function(p){var g;return p?(g=c?c+p:p,this._events[g]&&h(this,g)):(this._events=new l,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=c,f.EventEmitter=f,o.exports=f},1564:o=>{var a;a=()=>(()=>{var c={228:u=>{var d=Object.prototype.hasOwnProperty,h="~";function f(){}function p(T,C,A){this.fn=T,this.context=C,this.once=A||!1}function g(T,C,A,k,I){if(typeof A!="function")throw new TypeError("The listener must be a function");var N=new p(A,k||T,I),U=h?h+C:C;return T._events[U]?T._events[U].fn?T._events[U]=[T._events[U],N]:T._events[U].push(N):(T._events[U]=N,T._eventsCount++),T}function v(T,C){--T._eventsCount==0?T._events=new f:delete T._events[C]}function E(){this._events=new f,this._eventsCount=0}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(h=!1)),E.prototype.eventNames=function(){var T,C,A=[];if(this._eventsCount===0)return A;for(C in T=this._events)d.call(T,C)&&A.push(h?C.slice(1):C);return Object.getOwnPropertySymbols?A.concat(Object.getOwnPropertySymbols(T)):A},E.prototype.listeners=function(T){var C=h?h+T:T,A=this._events[C];if(!A)return[];if(A.fn)return[A.fn];for(var k=0,I=A.length,N=new Array(I);k<I;k++)N[k]=A[k].fn;return N},E.prototype.listenerCount=function(T){var C=h?h+T:T,A=this._events[C];return A?A.fn?1:A.length:0},E.prototype.emit=function(T,C,A,k,I,N){var U=h?h+T:T;if(!this._events[U])return!1;var F,$,X=this._events[U],q=arguments.length;if(X.fn){switch(X.once&&this.removeListener(T,X.fn,void 0,!0),q){case 1:return X.fn.call(X.context),!0;case 2:return X.fn.call(X.context,C),!0;case 3:return X.fn.call(X.context,C,A),!0;case 4:return X.fn.call(X.context,C,A,k),!0;case 5:return X.fn.call(X.context,C,A,k,I),!0;case 6:return X.fn.call(X.context,C,A,k,I,N),!0}for($=1,F=new Array(q-1);$<q;$++)F[$-1]=arguments[$];X.fn.apply(X.context,F)}else{var W,K=X.length;for($=0;$<K;$++)switch(X[$].once&&this.removeListener(T,X[$].fn,void 0,!0),q){case 1:X[$].fn.call(X[$].context);break;case 2:X[$].fn.call(X[$].context,C);break;case 3:X[$].fn.call(X[$].context,C,A);break;case 4:X[$].fn.call(X[$].context,C,A,k);break;default:if(!F)for(W=1,F=new Array(q-1);W<q;W++)F[W-1]=arguments[W];X[$].fn.apply(X[$].context,F)}}return!0},E.prototype.on=function(T,C,A){return g(this,T,C,A,!1)},E.prototype.once=function(T,C,A){return g(this,T,C,A,!0)},E.prototype.removeListener=function(T,C,A,k){var I=h?h+T:T;if(!this._events[I])return this;if(!C)return v(this,I),this;var N=this._events[I];if(N.fn)N.fn!==C||k&&!N.once||A&&N.context!==A||v(this,I);else{for(var U=0,F=[],$=N.length;U<$;U++)(N[U].fn!==C||k&&!N[U].once||A&&N[U].context!==A)&&F.push(N[U]);F.length?this._events[I]=F.length===1?F[0]:F:v(this,I)}return this},E.prototype.removeAllListeners=function(T){var C;return T?(C=h?h+T:T,this._events[C]&&v(this,C)):(this._events=new f,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=h,E.EventEmitter=E,u.exports=E},815:function(u,d){var h,f,p=this&&this.__extends||(h=function(G,Z){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(se,ue){se.__proto__=ue}||function(se,ue){for(var Ae in ue)Object.prototype.hasOwnProperty.call(ue,Ae)&&(se[Ae]=ue[Ae])},h(G,Z)},function(G,Z){if(typeof Z!="function"&&Z!==null)throw new TypeError("Class extends value "+String(Z)+" is not a constructor or null");function se(){this.constructor=G}h(G,Z),G.prototype=Z===null?Object.create(Z):(se.prototype=Z.prototype,new se)});function g(G){return 60*G*60}function v(G){return 60*G*60*24}Object.defineProperty(d,"__esModule",{value:!0}),d.daysToSeconds=d.hoursToSeconds=d.ConfigurationHolder=d.ConfigurationManager=d.Env=void 0,function(G){G.BETA="beta",G.PROD="prod",G.CUSTOM="custom"}(f||(d.Env=f={})),d.hoursToSeconds=g,d.daysToSeconds=v;var E=function(G){function Z(se){return G.call(this,se)||this}return p(Z,G),Z}(Error),T="data",C="metrics",A=g(1),k=v(3),I=g(2),N="base64",U=function(){function G(Z,se){var ue,Ae,Be,Se,Pe,we,Te,Oe;if(!se.fileKey)throw new Error("options.fileKey cannot be empty");var _t=(ue=se.clock)!==null&&ue!==void 0?ue:new ne,Ct=_t.getMillis();switch(this.context=Z,this.fileKey=se.fileKey,this.env=se.standardEnv,se.standardEnv){case f.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case f.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case f.CUSTOM:if(!se.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=se.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(se.standardEnv))}this.trace=(Ae=se.trace)!==null&&Ae!==void 0?Ae:new q(this.env),this.fetch=(Be=se.fetch)!==null&&Be!==void 0?Be:new X(Z),this.storage=new K("amazon_ivs_device_config_v1_"+se.fileKey,Z.localStorage),this.state=new ie(this.storage,"state"),this.refresh={refreshIntervalSeconds:(Se=se.refresh.refreshIntervalSeconds)!==null&&Se!==void 0?Se:A,retryCount:(Pe=se.refresh.retryCount)!==null&&Pe!==void 0?Pe:3,retryIntervalSeconds:(we=se.refresh.retryIntervalSeconds)!==null&&we!==void 0?we:10,maxCacheAgeSeconds:(Te=se.refresh.maxCacheAgeSeconds)!==null&&Te!==void 0?Te:k,stopRefreshAfterSeconds:(Oe=se.refresh.stopRefreshAfterSeconds)!==null&&Oe!==void 0?Oe:I,canRefreshNow:se.refresh.canRefreshNow},this.clock=_t,this.isInitialRefreshDone=!1;var me=0,ge=this.state.getState();ge&&ge.fetchServer===this.fetchServer&&ge.lastFetchWhenMs&&(me=ge.lastFetchWhenMs);var nt=_t.getMillis(),Ce=(nt-me)/1e3;if(Ce<=this.refresh.maxCacheAgeSeconds){var ut=this.storage.getJson(T);ut&&ut.fetchServer===this.fetchServer&&this.setData(ut.json)}if(this.lastUseMs=nt,Ce>=this.refresh.refreshIntervalSeconds||me==0)this.trace.onTrace("Will start refresh right now"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),0);else{var He=Math.round(this.refresh.refreshIntervalSeconds-Ce);this.trace.onTrace("Will start refresh in "+He+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*He),this.isInitialRefreshDone=!0}var Rt=_t.getMillis();this.initialLoadTime=Rt-Ct}return G.getInstance=function(Z,se){try{if(!(Z.fetch&&Z.setTimeout&&Z.clearTimeout&&Z.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(ue){return void console.error("Error checking for context properties "+ue)}if(this.gInstance){if(this.gInstance.fileKey!=se.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(se.fileKey));return this.gInstance}return this.gInstance=new G(Z,se),this.gInstance},G.prototype.getConfigurationHolder=function(Z){var se,ue=this,Ae=this.clock.getMillis();this.lastUseMs=Ae;var Be=(se=Z.analytics)!==null&&se!==void 0?se:new W(this.env);this.context.setTimeout(function(){ue.emitMetrics(Be)});var Se=0,Pe=this.state.getState();return Pe&&Pe.fetchServer===this.fetchServer&&Pe.lastFetchWhenMs&&(Se=Pe.lastFetchWhenMs),(Ae-Se)/1e3<=this.refresh.maxCacheAgeSeconds?new F(Be,this.properties):new F(Be,void 0)},G.prototype.getFetchUrl=function(){var Z="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),se=new URL(Z);return se.searchParams.set("version","1.0"),se},G.clearInstance=function(){var Z;(Z=this.gInstance)===null||Z===void 0||Z.clearInstanceImpl(),this.gInstance=void 0},G.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},G.prototype.startRefresh=function(){var Z=this;this.trace.onTrace("Starting refresh request..."),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0);var se=this.clock.getMillis();return(se-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds?(this.trace.onTrace("Actually will not refresh due to refresh timeout"),void(this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds))):this.isInitialRefreshDone&&!this.refresh.canRefreshNow()?(this.trace.onTrace("Will not refresh due to callback having returned false"),void(this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds))):void this.fetchData().then(function(ue){Z.processResponse(ue,se)}).catch(function(ue){Z.exceptionMetrics(ue),Z.trace.onTrace("Fetch error: "+ue),Z.refresh.retryCount>0&&Z.scheduleRetry(1)}).finally(function(){Z.isInitialRefreshDone=!0,Z.fetchTask=Z.context.setTimeout(Z.startRefresh.bind(Z),1e3*Z.refresh.refreshIntervalSeconds)})},G.prototype.fetchData=function(){var Z=this.getFetchUrl(),se=new Headers,ue=this.state.getState();return ue.fetchServer===this.fetchServer&&(ue.lastFetchWhenFullMs&&this.clock.getMillis()-ue.lastFetchWhenFullMs>1e3*g(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&ue.lastFetchEtagHeader&&se.set("If-None-Match",ue.lastFetchEtagHeader)),this.incrementMetrics("fetch_attempt_count"),this.fetch.fetchUrl(Z,se)},G.prototype.processResponse=function(Z,se){var ue={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},Ae=Z.headers.get("etag");Ae&&(ue.lastFetchEtagHeader=Ae);try{if(Z.status<300&&Z.json)if(this.setData(Z.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(T,{fetchServer:this.fetchServer,json:Z.json});var Be=this.clock.getMillis();ue.lastFetchWhenFullMs=Be,this.incrementMetricsWithDuration("success_new_data_count",Be-se)}else this.incrementMetrics("fail_invalid_data_count");else{if(Z.status!==304){var Se="Unexpected http fetch status: "+Z.status;throw this.trace.onTrace(Se),new E(Se)}this.trace.onTrace("Server said no change in data"),Be=this.clock.getMillis(),this.incrementMetricsWithDuration("success_no_change_count",Be-se)}}finally{this.state.setState(ue)}},G.prototype.scheduleRetry=function(Z){var se=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var ue=Z*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout(function(){se.retryTask=void 0,se.fetchRetry(Z)},1e3*ue)},G.prototype.fetchRetry=function(Z){var se=this;this.trace.onTrace("Starting retry request ".concat(Z,"..."));var ue=this.clock.getMillis();this.fetchData().then(function(Ae){se.processResponse(Ae,ue)}).catch(function(Ae){se.exceptionMetrics(Ae),se.trace.onTrace("Fetch error: "+Ae),se.refresh.retryCount>Z&&se.scheduleRetry(Z+1)})},G.prototype.setData=function(Z){if(!Z)return!1;if(Z.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var se=Z.properties;if(!se||!Array.isArray(se))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var ue=new Map,Ae=0,Be=se;Ae<Be.length;Ae++){var Se=Be[Ae];if(Se.name&&Se.type&&this.isValidValueType(Se.type)){if(Se.value_string&&typeof Se.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof Se.value_string);continue}if(Se.value_number&&typeof Se.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof Se.value_number);continue}if(Se.value_boolean&&typeof Se.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof Se.value_boolean);continue}if(Se.value_json&&typeof Se.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof Se.value_json);continue}if(Se.value_analytics&&typeof Se.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof Se.value_analytics);continue}var Pe=new Q(Se.name,this.parseValueType(Se.type),Se.value_string,Se.value_number,Se.value_boolean,Se.value_json,Se.value_analytics,Se.encoding);ue.set(Pe.name,Pe)}}return ue.size!=0&&(this.properties=ue,!0)},G.prototype.isValidValueType=function(Z){return Z==="string"||Z==="number"||Z==="boolean"||Z=="json"},G.prototype.parseValueType=function(Z){switch(Z){case"string":return $.STRING;case"number":return $.NUMBER;case"boolean":return $.BOOLEAN;case"json":return $.JSON;default:throw new Error("Unsupported value type ".concat(Z))}},G.prototype.emitMetrics=function(Z){var se,ue,Ae,Be,Se,Pe,we,Te,Oe=(se=this.storage.getJson(C))!==null&&se!==void 0?se:{},_t={initial_load_time:this.initialLoadTime,fetch_attempt_count:(ue=Oe.fetch_attempt_count)!==null&&ue!==void 0?ue:0,fetch_duration_average:(Ae=Oe.fetch_duration_average)!==null&&Ae!==void 0?Ae:0,success_no_change_count:(Be=Oe.success_no_change_count)!==null&&Be!==void 0?Be:0,success_new_data_count:(Se=Oe.success_new_data_count)!==null&&Se!==void 0?Se:0,fail_exception_count:(Pe=Oe.fail_exception_count)!==null&&Pe!==void 0?Pe:0,fail_http_error_count:(we=Oe.fail_http_error_count)!==null&&we!==void 0?we:0,fail_invalid_data_count:(Te=Oe.fail_invalid_data_count)!==null&&Te!==void 0?Te:0};Z.onMetrics(_t),Oe.fetch_attempt_count=0,Oe.success_no_change_count=0,Oe.success_new_data_count=0,Oe.fail_exception_count=0,Oe.fail_http_error_count=0,Oe.fail_invalid_data_count=0,this.storage.setJson(C,Oe)},G.prototype.exceptionMetrics=function(Z){Z instanceof E||Z.message.startsWith("http error")?this.incrementMetrics("fail_http_error_count"):this.incrementMetrics("fail_exception_count")},G.prototype.incrementMetrics=function(Z){var se,ue,Ae=(se=this.storage.getJson(C))!==null&&se!==void 0?se:{};Ae[Z]=((ue=Ae[Z])!==null&&ue!==void 0?ue:0)+1,this.storage.setJson(C,Ae)},G.prototype.incrementMetricsWithDuration=function(Z,se){var ue,Ae,Be=(ue=this.storage.getJson(C))!==null&&ue!==void 0?ue:{};Be[Z]=((Ae=Be[Z])!==null&&Ae!==void 0?Ae:0)+1,se>0&&(Be.fetch_duration_average!==void 0?Be.fetch_duration_average=.9*Be.fetch_duration_average+.1*se|0:Be.fetch_duration_average=se),this.storage.setJson(C,Be)},G}();d.ConfigurationManager=U;var F=function(){function G(Z,se){this.analytics=Z,this.properties=se}return G.prototype.getSize=function(){return this.properties?this.properties.size:-1},G.prototype.getStringValue=function(Z){var se,ue;if(this.properties){var Ae=this.properties.get(Z);if(Ae){if(Ae.type===$.STRING){var Be=(se=Ae.valueString)!==null&&se!==void 0?se:"";return this.analytics.onValue(Z,(ue=Ae.valueAnalytics)!==null&&ue!==void 0?ue:Be),Be}this.analytics.onError(Z,"Type is not string")}}else this.analytics.onTrace(Z,"Configuration is not available")},G.prototype.getNumberValue=function(Z){var se,ue;if(this.properties){var Ae=this.properties.get(Z);if(Ae){if(Ae.type===$.NUMBER){var Be=(se=Ae.valueNumber)!==null&&se!==void 0?se:0;return this.analytics.onValue(Z,(ue=Ae.valueAnalytics)!==null&&ue!==void 0?ue:Be.toString()),Be}this.analytics.onError(Z,"Type is not number")}}else this.analytics.onTrace(Z,"Configuration is not available")},G.prototype.getBooleanValue=function(Z){var se,ue;if(this.properties){var Ae=this.properties.get(Z);if(Ae){if(Ae.type===$.BOOLEAN){var Be=(se=Ae.valueBoolean)!==null&&se!==void 0&&se;return this.analytics.onValue(Z,(ue=Ae.valueAnalytics)!==null&&ue!==void 0?ue:Be.toString()),Be}this.analytics.onError(Z,"Type is not boolean")}}else this.analytics.onTrace(Z,"Configuration is not available")},G.prototype.getJsonValue=function(Z){var se,ue;if(this.properties){var Ae=this.properties.get(Z);if(Ae){if(Ae.type===$.JSON){var Be=Ae.valueJson;if(!Be)return this.analytics.onValue(Z,(se=Ae.valueAnalytics)!==null&&se!==void 0?se:""),null;try{var Se=JSON.parse(Be);return this.analytics.onValue(Z,(ue=Ae.valueAnalytics)!==null&&ue!==void 0?ue:Be),Se}catch{return void this.analytics.onError(Z,"Json parse error")}}this.analytics.onError(Z,"Type is not json")}}else this.analytics.onTrace(Z,"Configuration is not available")},G}();d.ConfigurationHolder=F;var $,X=function(){function G(Z){this.context=Z}return G.prototype.fetchUrl=function(Z,se){var ue=this;return new Promise(function(Ae,Be){ue.context.fetch(Z,{headers:se,cache:"no-store"}).then(function(Se){if(Se.status>=400)Be(new E("http error ".concat(Se.status,", ").concat(Se.statusText)));else{var Pe={status:Se.status,headers:Se.headers};Se.json().then(function(we){Pe.json=we}).catch(function(){}).finally(function(){Ae(Pe)})}}).catch(function(Se){Be(Se)})})},G}(),q=function(){function G(Z){this.env=Z}return G.prototype.onTrace=function(Z){this.env!=f.PROD&&console.log("Configuration: "+Z)},G}(),W=function(){function G(Z){this.env=Z}return G.prototype.onMetrics=function(Z){this.env!=f.PROD&&console.log("Metrics",Z)},G.prototype.onValue=function(Z,se){this.env!=f.PROD&&console.log("Configuration for ".concat(Z,": value = ").concat(se))},G.prototype.onError=function(Z,se){this.env!=f.PROD&&console.error("Configuration for ".concat(Z,": error = ").concat(se))},G.prototype.onTrace=function(Z,se){this.env!=f.PROD&&console.log("Configuration for ".concat(Z,": trace = ").concat(se))},G}(),K=function(){function G(Z,se){this.prefix=Z,this.storage=se}return G.prototype.getJson=function(Z){var se=this.prefix+"_"+Z;try{var ue=this.storage.getItem(se);if(ue)return JSON.parse(ue)}catch(Ae){console.error("Error getting local storage key ".concat(se)+Ae)}return null},G.prototype.setJson=function(Z,se){var ue=this.prefix+"_"+Z;try{this.storage.setItem(ue,JSON.stringify(se))}catch(Ae){console.error("Error setting local storage key ".concat(ue,": ")+Ae)}},G}(),ne=function(){function G(){}return G.prototype.getMillis=function(){return Date.now()},G}();(function(G){G[G.STRING=0]="STRING",G[G.NUMBER=1]="NUMBER",G[G.BOOLEAN=2]="BOOLEAN",G[G.JSON=3]="JSON"})($||($={}));var Q=function(G,Z,se,ue,Ae,Be,Se,Pe){switch(this.name=G,this.type=Z,this.valueString=se,this.valueNumber=ue,this.valueBoolean=Ae,this.valueJson=Be,this.valueAnalytics=Se,this.type){case $.STRING:Pe===N&&se&&(this.valueString=atob(se));break;case $.JSON:Pe===N&&Be&&(this.valueJson=atob(Be))}},ie=function(){function G(Z,se){var ue;this.storage=Z,this.key=se,this.state=(ue=Z.getJson(se))!==null&&ue!==void 0?ue:{}}return G.prototype.getState=function(){return this.state},G.prototype.setState=function(Z){Object.assign(this.state,Z),this.storage.setJson(this.key,this.state)},G}()},456:function(u,d,h){var f=this&&this.__createBinding||(Object.create?function(g,v,E,T){T===void 0&&(T=E);var C=Object.getOwnPropertyDescriptor(v,E);C&&!("get"in C?!v.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return v[E]}}),Object.defineProperty(g,T,C)}:function(g,v,E,T){T===void 0&&(T=E),g[T]=v[E]}),p=this&&this.__exportStar||function(g,v){for(var E in g)E==="default"||Object.prototype.hasOwnProperty.call(v,E)||f(v,g,E)};Object.defineProperty(d,"__esModule",{value:!0}),p(h(903),d)},903:function(u,d,h){var f=this&&this.__spreadArray||function(v,E,T){if(T||arguments.length===2)for(var C,A=0,k=E.length;A<k;A++)!C&&A in E||(C||(C=Array.prototype.slice.call(E,0,A)),C[A]=E[A]);return v.concat(C||Array.prototype.slice.call(E))};Object.defineProperty(d,"__esModule",{value:!0}),d.TypedEmitter=void 0;var p=h(228),g=function(){function v(E){var T=E.propagateErrors;this.emitter=new p.EventEmitter,this.propagateErrors=T!=null&&T}return v.prototype.on=function(E,T){T.call=this.wrapCall(E,T),this.emitter.on(E,T)},v.prototype.off=function(E,T){this.emitter.off(E,T)},v.prototype.emit=function(E){for(var T,C=[],A=1;A<arguments.length;A++)C[A-1]=arguments[A];(T=this.emitter).emit.apply(T,f([E],C,!1))},v.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},v.prototype.wrapCall=function(E,T){var C=this;return function(A){for(var k=[],I=1;I<arguments.length;I++)k[I-1]=arguments[I];if(C.propagateErrors)T.apply(A,k);else try{T.apply(A,k)}catch(F){var N="Error in callback for ".concat(E),U=T.name;return U&&(N+=" for function ".concat(U)),void console.error(N,F)}}},v}();d.TypedEmitter=g},987:function(u,d,h){var f,p=this&&this.__extends||(f=function(k,I){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,U){N.__proto__=U}||function(N,U){for(var F in U)Object.prototype.hasOwnProperty.call(U,F)&&(N[F]=U[F])},f(k,I)},function(k,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function N(){this.constructor=k}f(k,I),k.prototype=I===null?Object.create(I):(N.prototype=I.prototype,new N)}),g=this&&this.__createBinding||(Object.create?function(k,I,N,U){U===void 0&&(U=N);var F=Object.getOwnPropertyDescriptor(I,N);F&&!("get"in F?!I.__esModule:F.writable||F.configurable)||(F={enumerable:!0,get:function(){return I[N]}}),Object.defineProperty(k,U,F)}:function(k,I,N,U){U===void 0&&(U=N),k[U]=I[N]}),v=this&&this.__setModuleDefault||(Object.create?function(k,I){Object.defineProperty(k,"default",{enumerable:!0,value:I})}:function(k,I){k.default=I}),E=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var I={};if(k!=null)for(var N in k)N!=="default"&&Object.prototype.hasOwnProperty.call(k,N)&&g(I,k,N);return v(I,k),I};Object.defineProperty(d,"__esModule",{value:!0}),d.createFsm=d.FsmWildcardState=d.RejectedTransitionError=d.InvalidStateTransitionError=void 0;var T=E(h(293)),C=function(k){function I(N,U){var F=k.call(this,"Invalid transition from '".concat(U,"' via event '").concat(N,"'"))||this;return F.name="InvalidStateTransitionError",F}return p(I,k),I}(Error);d.InvalidStateTransitionError=C;var A=function(k){function I(N,U,F){var $=k.call(this,"Transition from '".concat(U,"' via event '").concat(N,"' was rejected for: ").concat(F))||this;return $.name="RejectedTransitionError",$}return p(I,k),I}(Error);d.RejectedTransitionError=A,d.FsmWildcardState="*",d.createFsm=function(k){var I,N=k.transitions,U=k.callbacks,F=k.initialState,$=function(X){var q,W=(q=N[X])===null||q===void 0?void 0:q.from;return!!W&&(typeof W=="string"?W===d.FsmWildcardState:W.includes(F))};return{canTransition:$,transition:function(X,q){var W,K,ne,Q,ie,G;if(!$(X))return T.err(new C(String(F),String(X)));var Z=N[X];return Z.shouldTransition===void 0||Z.shouldTransition(F)?((K=(W=U==null?void 0:U[F])===null||W===void 0?void 0:W.onExiting)===null||K===void 0||K.call(W),(ne=U==null?void 0:U.onStateExiting)===null||ne===void 0||ne.call(U,F),I=F,F=Z.to,(ie=(Q=U==null?void 0:U[F])===null||Q===void 0?void 0:Q.onChanged)===null||ie===void 0||ie.call(Q,I,q),(G=U==null?void 0:U.onStateChanged)===null||G===void 0||G.call(U,I,F,q),T.ok(F)):T.err(new A(String(F),String(X),"shouldTransition returned false"))},previousState:function(){return I},currentState:function(){return F}}}},156:function(u,d,h){var f=this&&this.__createBinding||(Object.create?function(g,v,E,T){T===void 0&&(T=E);var C=Object.getOwnPropertyDescriptor(v,E);C&&!("get"in C?!v.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return v[E]}}),Object.defineProperty(g,T,C)}:function(g,v,E,T){T===void 0&&(T=E),g[T]=v[E]}),p=this&&this.__exportStar||function(g,v){for(var E in g)E==="default"||Object.prototype.hasOwnProperty.call(v,E)||f(v,g,E)};Object.defineProperty(d,"__esModule",{value:!0}),d.VERSION=void 0,d.VERSION="0.2.0",p(h(815),d),p(h(456),d),p(h(987),d),p(h(293),d)},293:(u,d)=>{Object.defineProperty(d,"__esModule",{value:!0}),d.getErr=d.getOk_or=d.getOk=d.isNotOk=d.isOk=d.err=d.ok=void 0,d.ok=function(h){return{ok:!0,value:h}},d.err=function(h){return{ok:!1,error:h}},d.isOk=function(h){return h.ok===!0},d.isNotOk=function(h){return!(0,d.isOk)(h)},d.getOk=function(h){return h.ok===!0?h.value:void 0},d.getOk_or=function(h,f){return h.ok===!0?h.value:f},d.getErr=function(h){return h.ok===!0?void 0:h.error}}},l={};return function u(d){var h=l[d];if(h!==void 0)return h.exports;var f=l[d]={exports:{}};return c[d].call(f.exports,f,f.exports,u),f.exports}(156)})(),o.exports=a()},1989:(o,a,c)=>{var l=c(1789),u=c(401),d=c(7667),h=c(1327),f=c(1866);function p(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var T=g[v];this.set(T[0],T[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=d,p.prototype.has=h,p.prototype.set=f,o.exports=p},8407:(o,a,c)=>{var l=c(7040),u=c(4125),d=c(2117),h=c(7518),f=c(4705);function p(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var T=g[v];this.set(T[0],T[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=d,p.prototype.has=h,p.prototype.set=f,o.exports=p},7071:(o,a,c)=>{var l=c(852)(c(5639),"Map");o.exports=l},3369:(o,a,c)=>{var l=c(4785),u=c(1285),d=c(6e3),h=c(9916),f=c(5265);function p(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var T=g[v];this.set(T[0],T[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=d,p.prototype.has=h,p.prototype.set=f,o.exports=p},6384:(o,a,c)=>{var l=c(8407),u=c(7465),d=c(3779),h=c(7599),f=c(4758),p=c(4309);function g(v){var E=this.__data__=new l(v);this.size=E.size}g.prototype.clear=u,g.prototype.delete=d,g.prototype.get=h,g.prototype.has=f,g.prototype.set=p,o.exports=g},2705:(o,a,c)=>{var l=c(5639).Symbol;o.exports=l},1149:(o,a,c)=>{var l=c(5639).Uint8Array;o.exports=l},6874:o=>{o.exports=function(a,c,l){switch(l.length){case 0:return a.call(c);case 1:return a.call(c,l[0]);case 2:return a.call(c,l[0],l[1]);case 3:return a.call(c,l[0],l[1],l[2])}return a.apply(c,l)}},4636:(o,a,c)=>{var l=c(2545),u=c(5694),d=c(1469),h=c(4144),f=c(5776),p=c(6719),g=Object.prototype.hasOwnProperty;o.exports=function(v,E){var T=d(v),C=!T&&u(v),A=!T&&!C&&h(v),k=!T&&!C&&!A&&p(v),I=T||C||A||k,N=I?l(v.length,String):[],U=N.length;for(var F in v)!E&&!g.call(v,F)||I&&(F=="length"||A&&(F=="offset"||F=="parent")||k&&(F=="buffer"||F=="byteLength"||F=="byteOffset")||f(F,U))||N.push(F);return N}},6556:(o,a,c)=>{var l=c(9465),u=c(7813);o.exports=function(d,h,f){(f!==void 0&&!u(d[h],f)||f===void 0&&!(h in d))&&l(d,h,f)}},4865:(o,a,c)=>{var l=c(9465),u=c(7813),d=Object.prototype.hasOwnProperty;o.exports=function(h,f,p){var g=h[f];d.call(h,f)&&u(g,p)&&(p!==void 0||f in h)||l(h,f,p)}},8470:(o,a,c)=>{var l=c(7813);o.exports=function(u,d){for(var h=u.length;h--;)if(l(u[h][0],d))return h;return-1}},9465:(o,a,c)=>{var l=c(8777);o.exports=function(u,d,h){d=="__proto__"&&l?l(u,d,{configurable:!0,enumerable:!0,value:h,writable:!0}):u[d]=h}},3118:(o,a,c)=>{var l=c(3218),u=Object.create,d=function(){function h(){}return function(f){if(!l(f))return{};if(u)return u(f);h.prototype=f;var p=new h;return h.prototype=void 0,p}}();o.exports=d},8483:(o,a,c)=>{var l=c(5063)();o.exports=l},4239:(o,a,c)=>{var l=c(2705),u=c(9607),d=c(2333),h="[object Null]",f="[object Undefined]",p=l?l.toStringTag:void 0;o.exports=function(g){return g==null?g===void 0?f:h:p&&p in Object(g)?u(g):d(g)}},9454:(o,a,c)=>{var l=c(4239),u=c(7005),d="[object Arguments]";o.exports=function(h){return u(h)&&l(h)==d}},8458:(o,a,c)=>{var l=c(3560),u=c(5346),d=c(3218),h=c(346),f=/^\[object .+?Constructor\]$/,p=Function.prototype,g=Object.prototype,v=p.toString,E=g.hasOwnProperty,T=RegExp("^"+v.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(C){return!(!d(C)||u(C))&&(l(C)?T:f).test(h(C))}},8749:(o,a,c)=>{var l=c(4239),u=c(1780),d=c(7005),h={};h["[object Float32Array]"]=h["[object Float64Array]"]=h["[object Int8Array]"]=h["[object Int16Array]"]=h["[object Int32Array]"]=h["[object Uint8Array]"]=h["[object Uint8ClampedArray]"]=h["[object Uint16Array]"]=h["[object Uint32Array]"]=!0,h["[object Arguments]"]=h["[object Array]"]=h["[object ArrayBuffer]"]=h["[object Boolean]"]=h["[object DataView]"]=h["[object Date]"]=h["[object Error]"]=h["[object Function]"]=h["[object Map]"]=h["[object Number]"]=h["[object Object]"]=h["[object RegExp]"]=h["[object Set]"]=h["[object String]"]=h["[object WeakMap]"]=!1,o.exports=function(f){return d(f)&&u(f.length)&&!!h[l(f)]}},313:(o,a,c)=>{var l=c(3218),u=c(5726),d=c(3498),h=Object.prototype.hasOwnProperty;o.exports=function(f){if(!l(f))return d(f);var p=u(f),g=[];for(var v in f)(v!="constructor"||!p&&h.call(f,v))&&g.push(v);return g}},2980:(o,a,c)=>{var l=c(6384),u=c(6556),d=c(8483),h=c(9783),f=c(3218),p=c(1704),g=c(6390);o.exports=function v(E,T,C,A,k){E!==T&&d(T,function(I,N){if(k||(k=new l),f(I))h(E,T,N,C,v,A,k);else{var U=A?A(g(E,N),I,N+"",E,T,k):void 0;U===void 0&&(U=I),u(E,N,U)}},p)}},9783:(o,a,c)=>{var l=c(6556),u=c(4626),d=c(7133),h=c(278),f=c(8517),p=c(5694),g=c(1469),v=c(9246),E=c(4144),T=c(3560),C=c(3218),A=c(8630),k=c(6719),I=c(6390),N=c(9881);o.exports=function(U,F,$,X,q,W,K){var ne=I(U,$),Q=I(F,$),ie=K.get(Q);if(ie)l(U,$,ie);else{var G=W?W(ne,Q,$+"",U,F,K):void 0,Z=G===void 0;if(Z){var se=g(Q),ue=!se&&E(Q),Ae=!se&&!ue&&k(Q);G=Q,se||ue||Ae?g(ne)?G=ne:v(ne)?G=h(ne):ue?(Z=!1,G=u(Q,!0)):Ae?(Z=!1,G=d(Q,!0)):G=[]:A(Q)||p(Q)?(G=ne,p(ne)?G=N(ne):C(ne)&&!T(ne)||(G=f(Q))):Z=!1}Z&&(K.set(Q,G),q(G,Q,X,W,K),K.delete(Q)),l(U,$,G)}}},5976:(o,a,c)=>{var l=c(6557),u=c(5357),d=c(61);o.exports=function(h,f){return d(u(h,f,l),h+"")}},6560:(o,a,c)=>{var l=c(5703),u=c(8777),d=c(6557),h=u?function(f,p){return u(f,"toString",{configurable:!0,enumerable:!1,value:l(p),writable:!0})}:d;o.exports=h},2545:o=>{o.exports=function(a,c){for(var l=-1,u=Array(a);++l<a;)u[l]=c(l);return u}},1717:o=>{o.exports=function(a){return function(c){return a(c)}}},4318:(o,a,c)=>{var l=c(1149);o.exports=function(u){var d=new u.constructor(u.byteLength);return new l(d).set(new l(u)),d}},4626:(o,a,c)=>{o=c.nmd(o);var l=c(5639),u=a&&!a.nodeType&&a,d=u&&o&&!o.nodeType&&o,h=d&&d.exports===u?l.Buffer:void 0,f=h?h.allocUnsafe:void 0;o.exports=function(p,g){if(g)return p.slice();var v=p.length,E=f?f(v):new p.constructor(v);return p.copy(E),E}},7133:(o,a,c)=>{var l=c(4318);o.exports=function(u,d){var h=d?l(u.buffer):u.buffer;return new u.constructor(h,u.byteOffset,u.length)}},278:o=>{o.exports=function(a,c){var l=-1,u=a.length;for(c||(c=Array(u));++l<u;)c[l]=a[l];return c}},8363:(o,a,c)=>{var l=c(4865),u=c(9465);o.exports=function(d,h,f,p){var g=!f;f||(f={});for(var v=-1,E=h.length;++v<E;){var T=h[v],C=p?p(f[T],d[T],T,f,d):void 0;C===void 0&&(C=d[T]),g?u(f,T,C):l(f,T,C)}return f}},4429:(o,a,c)=>{var l=c(5639)["__core-js_shared__"];o.exports=l},1463:(o,a,c)=>{var l=c(5976),u=c(6612);o.exports=function(d){return l(function(h,f){var p=-1,g=f.length,v=g>1?f[g-1]:void 0,E=g>2?f[2]:void 0;for(v=d.length>3&&typeof v=="function"?(g--,v):void 0,E&&u(f[0],f[1],E)&&(v=g<3?void 0:v,g=1),h=Object(h);++p<g;){var T=f[p];T&&d(h,T,p,v)}return h})}},5063:o=>{o.exports=function(a){return function(c,l,u){for(var d=-1,h=Object(c),f=u(c),p=f.length;p--;){var g=f[a?p:++d];if(l(h[g],g,h)===!1)break}return c}}},8777:(o,a,c)=>{var l=c(852),u=function(){try{var d=l(Object,"defineProperty");return d({},"",{}),d}catch{}}();o.exports=u},1957:(o,a,c)=>{var l=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;o.exports=l},5050:(o,a,c)=>{var l=c(7019);o.exports=function(u,d){var h=u.__data__;return l(d)?h[typeof d=="string"?"string":"hash"]:h.map}},852:(o,a,c)=>{var l=c(8458),u=c(7801);o.exports=function(d,h){var f=u(d,h);return l(f)?f:void 0}},5924:(o,a,c)=>{var l=c(5569)(Object.getPrototypeOf,Object);o.exports=l},9607:(o,a,c)=>{var l=c(2705),u=Object.prototype,d=u.hasOwnProperty,h=u.toString,f=l?l.toStringTag:void 0;o.exports=function(p){var g=d.call(p,f),v=p[f];try{p[f]=void 0;var E=!0}catch{}var T=h.call(p);return E&&(g?p[f]=v:delete p[f]),T}},7801:o=>{o.exports=function(a,c){return a==null?void 0:a[c]}},1789:(o,a,c)=>{var l=c(4536);o.exports=function(){this.__data__=l?l(null):{},this.size=0}},401:o=>{o.exports=function(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}},7667:(o,a,c)=>{var l=c(4536),u="__lodash_hash_undefined__",d=Object.prototype.hasOwnProperty;o.exports=function(h){var f=this.__data__;if(l){var p=f[h];return p===u?void 0:p}return d.call(f,h)?f[h]:void 0}},1327:(o,a,c)=>{var l=c(4536),u=Object.prototype.hasOwnProperty;o.exports=function(d){var h=this.__data__;return l?h[d]!==void 0:u.call(h,d)}},1866:(o,a,c)=>{var l=c(4536),u="__lodash_hash_undefined__";o.exports=function(d,h){var f=this.__data__;return this.size+=this.has(d)?0:1,f[d]=l&&h===void 0?u:h,this}},8517:(o,a,c)=>{var l=c(3118),u=c(5924),d=c(5726);o.exports=function(h){return typeof h.constructor!="function"||d(h)?{}:l(u(h))}},5776:o=>{var a=9007199254740991,c=/^(?:0|[1-9]\d*)$/;o.exports=function(l,u){var d=typeof l;return!!(u=u??a)&&(d=="number"||d!="symbol"&&c.test(l))&&l>-1&&l%1==0&&l<u}},6612:(o,a,c)=>{var l=c(7813),u=c(8612),d=c(5776),h=c(3218);o.exports=function(f,p,g){if(!h(g))return!1;var v=typeof p;return!!(v=="number"?u(g)&&d(p,g.length):v=="string"&&p in g)&&l(g[p],f)}},7019:o=>{o.exports=function(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}},5346:(o,a,c)=>{var l,u=c(4429),d=(l=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";o.exports=function(h){return!!d&&d in h}},5726:o=>{var a=Object.prototype;o.exports=function(c){var l=c&&c.constructor;return c===(typeof l=="function"&&l.prototype||a)}},7040:o=>{o.exports=function(){this.__data__=[],this.size=0}},4125:(o,a,c)=>{var l=c(8470),u=Array.prototype.splice;o.exports=function(d){var h=this.__data__,f=l(h,d);return!(f<0)&&(f==h.length-1?h.pop():u.call(h,f,1),--this.size,!0)}},2117:(o,a,c)=>{var l=c(8470);o.exports=function(u){var d=this.__data__,h=l(d,u);return h<0?void 0:d[h][1]}},7518:(o,a,c)=>{var l=c(8470);o.exports=function(u){return l(this.__data__,u)>-1}},4705:(o,a,c)=>{var l=c(8470);o.exports=function(u,d){var h=this.__data__,f=l(h,u);return f<0?(++this.size,h.push([u,d])):h[f][1]=d,this}},4785:(o,a,c)=>{var l=c(1989),u=c(8407),d=c(7071);o.exports=function(){this.size=0,this.__data__={hash:new l,map:new(d||u),string:new l}}},1285:(o,a,c)=>{var l=c(5050);o.exports=function(u){var d=l(this,u).delete(u);return this.size-=d?1:0,d}},6e3:(o,a,c)=>{var l=c(5050);o.exports=function(u){return l(this,u).get(u)}},9916:(o,a,c)=>{var l=c(5050);o.exports=function(u){return l(this,u).has(u)}},5265:(o,a,c)=>{var l=c(5050);o.exports=function(u,d){var h=l(this,u),f=h.size;return h.set(u,d),this.size+=h.size==f?0:1,this}},4536:(o,a,c)=>{var l=c(852)(Object,"create");o.exports=l},3498:o=>{o.exports=function(a){var c=[];if(a!=null)for(var l in Object(a))c.push(l);return c}},1167:(o,a,c)=>{o=c.nmd(o);var l=c(1957),u=a&&!a.nodeType&&a,d=u&&o&&!o.nodeType&&o,h=d&&d.exports===u&&l.process,f=function(){try{var p=d&&d.require&&d.require("util").types;return p||h&&h.binding&&h.binding("util")}catch{}}();o.exports=f},2333:o=>{var a=Object.prototype.toString;o.exports=function(c){return a.call(c)}},5569:o=>{o.exports=function(a,c){return function(l){return a(c(l))}}},5357:(o,a,c)=>{var l=c(6874),u=Math.max;o.exports=function(d,h,f){return h=u(h===void 0?d.length-1:h,0),function(){for(var p=arguments,g=-1,v=u(p.length-h,0),E=Array(v);++g<v;)E[g]=p[h+g];g=-1;for(var T=Array(h+1);++g<h;)T[g]=p[g];return T[h]=f(E),l(d,this,T)}}},5639:(o,a,c)=>{var l=c(1957),u=typeof self=="object"&&self&&self.Object===Object&&self,d=l||u||Function("return this")();o.exports=d},6390:o=>{o.exports=function(a,c){if((c!=="constructor"||typeof a[c]!="function")&&c!="__proto__")return a[c]}},61:(o,a,c)=>{var l=c(6560),u=c(1275)(l);o.exports=u},1275:o=>{var a=800,c=16,l=Date.now;o.exports=function(u){var d=0,h=0;return function(){var f=l(),p=c-(f-h);if(h=f,p>0){if(++d>=a)return arguments[0]}else d=0;return u.apply(void 0,arguments)}}},7465:(o,a,c)=>{var l=c(8407);o.exports=function(){this.__data__=new l,this.size=0}},3779:o=>{o.exports=function(a){var c=this.__data__,l=c.delete(a);return this.size=c.size,l}},7599:o=>{o.exports=function(a){return this.__data__.get(a)}},4758:o=>{o.exports=function(a){return this.__data__.has(a)}},4309:(o,a,c)=>{var l=c(8407),u=c(7071),d=c(3369),h=200;o.exports=function(f,p){var g=this.__data__;if(g instanceof l){var v=g.__data__;if(!u||v.length<h-1)return v.push([f,p]),this.size=++g.size,this;g=this.__data__=new d(v)}return g.set(f,p),this.size=g.size,this}},346:o=>{var a=Function.prototype.toString;o.exports=function(c){if(c!=null){try{return a.call(c)}catch{}try{return c+""}catch{}}return""}},5703:o=>{o.exports=function(a){return function(){return a}}},7813:o=>{o.exports=function(a,c){return a===c||a!=a&&c!=c}},6557:o=>{o.exports=function(a){return a}},5694:(o,a,c)=>{var l=c(9454),u=c(7005),d=Object.prototype,h=d.hasOwnProperty,f=d.propertyIsEnumerable,p=l(function(){return arguments}())?l:function(g){return u(g)&&h.call(g,"callee")&&!f.call(g,"callee")};o.exports=p},1469:o=>{var a=Array.isArray;o.exports=a},8612:(o,a,c)=>{var l=c(3560),u=c(1780);o.exports=function(d){return d!=null&&u(d.length)&&!l(d)}},9246:(o,a,c)=>{var l=c(8612),u=c(7005);o.exports=function(d){return u(d)&&l(d)}},4144:(o,a,c)=>{o=c.nmd(o);var l=c(5639),u=c(5062),d=a&&!a.nodeType&&a,h=d&&o&&!o.nodeType&&o,f=h&&h.exports===d?l.Buffer:void 0,p=(f?f.isBuffer:void 0)||u;o.exports=p},3560:(o,a,c)=>{var l=c(4239),u=c(3218),d="[object AsyncFunction]",h="[object Function]",f="[object GeneratorFunction]",p="[object Proxy]";o.exports=function(g){if(!u(g))return!1;var v=l(g);return v==h||v==f||v==d||v==p}},1780:o=>{var a=9007199254740991;o.exports=function(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=a}},3218:o=>{o.exports=function(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}},7005:o=>{o.exports=function(a){return a!=null&&typeof a=="object"}},8630:(o,a,c)=>{var l=c(4239),u=c(5924),d=c(7005),h="[object Object]",f=Function.prototype,p=Object.prototype,g=f.toString,v=p.hasOwnProperty,E=g.call(Object);o.exports=function(T){if(!d(T)||l(T)!=h)return!1;var C=u(T);if(C===null)return!0;var A=v.call(C,"constructor")&&C.constructor;return typeof A=="function"&&A instanceof A&&g.call(A)==E}},6719:(o,a,c)=>{var l=c(8749),u=c(1717),d=c(1167),h=d&&d.isTypedArray,f=h?u(h):l;o.exports=f},1704:(o,a,c)=>{var l=c(4636),u=c(313),d=c(8612);o.exports=function(h){return d(h)?l(h,!0):u(h)}},6486:function(o,a,c){var l;o=c.nmd(o),(function(){var u,d="Expected a function",h="__lodash_hash_undefined__",f="__lodash_placeholder__",p=16,g=32,v=64,E=128,T=256,C=1/0,A=9007199254740991,k=NaN,I=4294967295,N=[["ary",E],["bind",1],["bindKey",2],["curry",8],["curryRight",p],["flip",512],["partial",g],["partialRight",v],["rearg",T]],U="[object Arguments]",F="[object Array]",$="[object Boolean]",X="[object Date]",q="[object Error]",W="[object Function]",K="[object GeneratorFunction]",ne="[object Map]",Q="[object Number]",ie="[object Object]",G="[object Promise]",Z="[object RegExp]",se="[object Set]",ue="[object String]",Ae="[object Symbol]",Be="[object WeakMap]",Se="[object ArrayBuffer]",Pe="[object DataView]",we="[object Float32Array]",Te="[object Float64Array]",Oe="[object Int8Array]",_t="[object Int16Array]",Ct="[object Int32Array]",me="[object Uint8Array]",ge="[object Uint8ClampedArray]",nt="[object Uint16Array]",Ce="[object Uint32Array]",ut=/\b__p \+= '';/g,He=/\b(__p \+=) '' \+/g,Rt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,$t=/&(?:amp|lt|gt|quot|#39);/g,Tt=/[&<>"']/g,Ft=RegExp($t.source),Ee=RegExp(Tt.source),le=/<%-([\s\S]+?)%>/g,We=/<%([\s\S]+?)%>/g,it=/<%=([\s\S]+?)%>/g,je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Fe=/^\w*$/,Ht=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,St=/[\\^$.*+?()[\]{}|]/g,Dt=RegExp(St.source),oe=/^\s+/,j=/\s/,V=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,fe=/\{\n\/\* \[wrapped with (.+)\] \*/,Ie=/,? & /,Ue=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,dt=/[()=,{}\[\]\/\s]/,yt=/\\(\\)?/g,Dn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Le=/\w*$/,Lt=/^[-+]0x[0-9a-f]+$/i,rt=/^0b[01]+$/i,xt=/^\[object .+?Constructor\]$/,sn=/^0o[0-7]+$/i,Jt=/^(?:0|[1-9]\d*)$/,De=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,tt=/($^)/,Et=/['\n\r\u2028\u2029\\]/g,wt="\\ud800-\\udfff",Pn="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Xr="\\u2700-\\u27bf",lr="a-z\\xdf-\\xf6\\xf8-\\xff",zn="A-Z\\xc0-\\xd6\\xd8-\\xde",dn="\\ufe0e\\ufe0f",tn="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Cn="[']",Rn="["+wt+"]",yr="["+tn+"]",hi="["+Pn+"]",si="\\d+",Co="["+Xr+"]",mu="["+lr+"]",Vd="[^"+wt+tn+si+Xr+lr+zn+"]",rf="\\ud83c[\\udffb-\\udfff]",sf="[^"+wt+"]",ve="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",pt="["+zn+"]",vt="\\u200d",Xe="(?:"+mu+"|"+Vd+")",zt="(?:"+pt+"|"+Vd+")",Qt="(?:['](?:d|ll|m|re|s|t|ve))?",hn="(?:['](?:D|LL|M|RE|S|T|VE))?",mn="(?:"+hi+"|"+rf+")?",Un="["+dn+"]?",Jn=Un+mn+("(?:"+vt+"(?:"+[sf,ve,Ke].join("|")+")"+Un+mn+")*"),_n="(?:"+[Co,ve,Ke].join("|")+")"+Jn,br="(?:"+[sf+hi+"?",hi,ve,Ke,Rn].join("|")+")",Gr=RegExp(Cn,"g"),En=RegExp(hi,"g"),Bn=RegExp(rf+"(?="+rf+")|"+br+Jn,"g"),Er=RegExp([pt+"?"+mu+"+"+Qt+"(?="+[yr,pt,"$"].join("|")+")",zt+"+"+hn+"(?="+[yr,pt+Xe,"$"].join("|")+")",pt+"?"+Xe+"+"+Qt,pt+"+"+hn,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",si,_n].join("|"),"g"),on=RegExp("["+vt+wt+Pn+dn+"]"),Wi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Sr=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Fs=-1,Qn={};Qn[we]=Qn[Te]=Qn[Oe]=Qn[_t]=Qn[Ct]=Qn[me]=Qn[ge]=Qn[nt]=Qn[Ce]=!0,Qn[U]=Qn[F]=Qn[Se]=Qn[$]=Qn[Pe]=Qn[X]=Qn[q]=Qn[W]=Qn[ne]=Qn[Q]=Qn[ie]=Qn[Z]=Qn[se]=Qn[ue]=Qn[Be]=!1;var ur={};ur[U]=ur[F]=ur[Se]=ur[Pe]=ur[$]=ur[X]=ur[we]=ur[Te]=ur[Oe]=ur[_t]=ur[Ct]=ur[ne]=ur[Q]=ur[ie]=ur[Z]=ur[se]=ur[ue]=ur[Ae]=ur[me]=ur[ge]=ur[nt]=ur[Ce]=!0,ur[q]=ur[W]=ur[Be]=!1;var Pl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Si=parseFloat,Ro=parseInt,Dl=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g,Ki=typeof self=="object"&&self&&self.Object===Object&&self,vn=Dl||Ki||Function("return this")(),sc=a&&!a.nodeType&&a,Ll=sc&&o&&!o.nodeType&&o,vr=Ll&&Ll.exports===sc,zd=vr&&Dl.process,Ho=function(){try{var st=Ll&&Ll.require&&Ll.require("util").types;return st||zd&&zd.binding&&zd.binding("util")}catch{}}(),Gd=Ho&&Ho.isArrayBuffer,of=Ho&&Ho.isDate,gu=Ho&&Ho.isMap,Up=Ho&&Ho.isRegExp,Fp=Ho&&Ho.isSet,Ju=Ho&&Ho.isTypedArray;function ha(st,et,It){switch(It.length){case 0:return st.call(et);case 1:return st.call(et,It[0]);case 2:return st.call(et,It[0],It[1]);case 3:return st.call(et,It[0],It[1],It[2])}return st.apply(et,It)}function af(st,et,It,nn){for(var Gt=-1,qr=st==null?0:st.length;++Gt<qr;){var Bs=st[Gt];et(nn,Bs,It(Bs),st)}return nn}function dr(st,et){for(var It=-1,nn=st==null?0:st.length;++It<nn&&et(st[It],It,st)!==!1;);return st}function Iy(st,et){for(var It=st==null?0:st.length;It--&&et(st[It],It,st)!==!1;);return st}function Mg(st,et){for(var It=-1,nn=st==null?0:st.length;++It<nn;)if(!et(st[It],It,st))return!1;return!0}function Ul(st,et){for(var It=-1,nn=st==null?0:st.length,Gt=0,qr=[];++It<nn;){var Bs=st[It];et(Bs,It,st)&&(qr[Gt++]=Bs)}return qr}function Bp(st,et){return!!(st!=null&&st.length)&&cf(st,et,0)>-1}function Qu(st,et,It){for(var nn=-1,Gt=st==null?0:st.length;++nn<Gt;)if(It(et,st[nn]))return!0;return!1}function Tr(st,et){for(var It=-1,nn=st==null?0:st.length,Gt=Array(nn);++It<nn;)Gt[It]=et(st[It],It,st);return Gt}function Fl(st,et){for(var It=-1,nn=et.length,Gt=st.length;++It<nn;)st[Gt+It]=et[It];return st}function N_(st,et,It,nn){var Gt=-1,qr=st==null?0:st.length;for(nn&&qr&&(It=st[++Gt]);++Gt<qr;)It=et(It,st[Gt],Gt,st);return It}function Ig(st,et,It,nn){var Gt=st==null?0:st.length;for(nn&&Gt&&(It=st[--Gt]);Gt--;)It=et(It,st[Gt],Gt,st);return It}function Og(st,et){for(var It=-1,nn=st==null?0:st.length;++It<nn;)if(et(st[It],It,st))return!0;return!1}var jp=Hp("length");function Qc(st,et,It){var nn;return It(st,function(Gt,qr,Bs){if(et(Gt,qr,Bs))return nn=qr,!1}),nn}function kg(st,et,It,nn){for(var Gt=st.length,qr=It+(nn?1:-1);nn?qr--:++qr<Gt;)if(et(st[qr],qr,st))return qr;return-1}function cf(st,et,It){return et==et?function(nn,Gt,qr){for(var Bs=qr-1,tl=nn.length;++Bs<tl;)if(nn[Bs]===Gt)return Bs;return-1}(st,et,It):kg(st,jl,It)}function Bl(st,et,It,nn){for(var Gt=It-1,qr=st.length;++Gt<qr;)if(nn(st[Gt],et))return Gt;return-1}function jl(st){return st!=st}function $p(st,et){var It=st==null?0:st.length;return It?oc(st,et)/It:k}function Hp(st){return function(et){return et==null?u:et[st]}}function Ng(st){return function(et){return st==null?u:st[et]}}function Oy(st,et,It,nn,Gt){return Gt(st,function(qr,Bs,tl){It=nn?(nn=!1,qr):et(It,qr,Bs,tl)}),It}function oc(st,et){for(var It,nn=-1,Gt=st.length;++nn<Gt;){var qr=et(st[nn]);qr!==u&&(It=It===u?qr:It+qr)}return It}function P_(st,et){for(var It=-1,nn=Array(st);++It<st;)nn[It]=et(It);return nn}function Vp(st){return st&&st.slice(0,el(st)+1).replace(oe,"")}function ac(st){return function(et){return st(et)}}function oi(st,et){return Tr(et,function(It){return st[It]})}function Zc(st,et){return st.has(et)}function zp(st,et){for(var It=-1,nn=st.length;++It<nn&&cf(et,st[It],0)>-1;);return It}function $l(st,et){for(var It=st.length;It--&&cf(et,st[It],0)>-1;);return It}var D_=Ng({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),lf=Ng({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ky(st){return"\\"+Pl[st]}function vu(st){return on.test(st)}function qd(st){var et=-1,It=Array(st.size);return st.forEach(function(nn,Gt){It[++et]=[Gt,nn]}),It}function Ks(st,et){return function(It){return st(et(It))}}function Yi(st,et){for(var It=-1,nn=st.length,Gt=0,qr=[];++It<nn;){var Bs=st[It];Bs!==et&&Bs!==f||(st[It]=f,qr[Gt++]=It)}return qr}function ja(st){var et=-1,It=Array(st.size);return st.forEach(function(nn){It[++et]=nn}),It}function Zu(st){var et=-1,It=Array(st.size);return st.forEach(function(nn){It[++et]=[nn,nn]}),It}function As(st){return vu(st)?function(et){for(var It=Bn.lastIndex=0;Bn.test(et);)++It;return It}(st):jp(st)}function Ms(st){return vu(st)?function(et){return et.match(Bn)||[]}(st):function(et){return et.split("")}(st)}function el(st){for(var et=st.length;et--&&j.test(st.charAt(et)););return et}var fa=Ng({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),ed=function st(et){var It,nn=(et=et==null?vn:ed.defaults(vn.Object(),et,ed.pick(vn,Sr))).Array,Gt=et.Date,qr=et.Error,Bs=et.Function,tl=et.Math,Fr=et.Object,Wd=et.RegExp,Kd=et.String,Ao=et.TypeError,Yd=nn.prototype,Pg=Bs.prototype,Ys=Fr.prototype,Xs=et["__core-js_shared__"],Hl=Pg.toString,Wr=Ys.hasOwnProperty,Ac=0,td=(It=/[^.]+$/.exec(Xs&&Xs.keys&&Xs.keys.IE_PROTO||""))?"Symbol(src)_1."+It:"",Gp=Ys.toString,nd=Hl.call(Fr),L_=vn._,cc=Wd("^"+Hl.call(Wr).replace(St,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vo=vr?et.Buffer:u,mi=et.Symbol,Mc=et.Uint8Array,Ic=Vo?Vo.allocUnsafe:u,uf=Ks(Fr.getPrototypeOf,Fr),qp=Fr.create,Wp=Ys.propertyIsEnumerable,_u=Yd.splice,U_=mi?mi.isConcatSpreadable:u,nl=mi?mi.iterator:u,lc=mi?mi.toStringTag:u,Xd=function(){try{var _=za(Fr,"defineProperty");return _({},"",{}),_}catch{}}(),Yt=et.clearTimeout!==vn.clearTimeout&&et.clearTimeout,is=Gt&&Gt.now!==vn.Date.now&&Gt.now,Ny=et.setTimeout!==vn.setTimeout&&et.setTimeout,Kp=tl.ceil,uo=tl.floor,Yp=Fr.getOwnPropertySymbols,Xp=Vo?Vo.isBuffer:u,Js=et.isFinite,df=Yd.join,Qs=Ks(Fr.keys,Fr),ai=tl.max,ds=tl.min,Zn=Gt.now,uc=et.parseInt,ho=tl.random,Ai=Yd.reverse,Jd=za(et,"DataView"),fo=za(et,"Map"),Ut=za(et,"Promise"),Is=za(et,"Set"),zo=za(et,"WeakMap"),dc=za(Fr,"create"),Ni=zo&&new zo,ss={},Os=uh(Jd),hf=uh(fo),Jp=uh(Ut),yu=uh(Is),Py=uh(zo),js=mi?mi.prototype:u,rd=js?js.valueOf:u,ff=js?js.toString:u;function pe(_){if(O(_)&&!Ge(_)&&!(_ instanceof Mr)){if(_ instanceof $s)return _;if(Wr.call(_,"__wrapped__"))return Ru(_)}return new $s(_)}var Go=function(){function _(){}return function(w){if(!R(w))return{};if(qp)return qp(w);_.prototype=w;var D=new _;return _.prototype=u,D}}();function $a(){}function $s(_,w){this.__wrapped__=_,this.__actions__=[],this.__chain__=!!w,this.__index__=0,this.__values__=u}function Mr(_){this.__wrapped__=_,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=I,this.__views__=[]}function rl(_){var w=-1,D=_==null?0:_.length;for(this.clear();++w<D;){var Y=_[w];this.set(Y[0],Y[1])}}function il(_){var w=-1,D=_==null?0:_.length;for(this.clear();++w<D;){var Y=_[w];this.set(Y[0],Y[1])}}function sl(_){var w=-1,D=_==null?0:_.length;for(this.clear();++w<D;){var Y=_[w];this.set(Y[0],Y[1])}}function ol(_){var w=-1,D=_==null?0:_.length;for(this.__data__=new sl;++w<D;)this.add(_[w])}function hc(_){var w=this.__data__=new il(_);this.size=w.size}function Dg(_,w){var D=Ge(_),Y=!D&&Rr(_),ae=!D&&!Y&&yn(_),be=!D&&!Y&&!ae&&de(_),ke=D||Y||ae||be,ze=ke?P_(_.length,Kd):[],ot=ze.length;for(var Ot in _)!w&&!Wr.call(_,Ot)||ke&&(Ot=="length"||ae&&(Ot=="offset"||Ot=="parent")||be&&(Ot=="buffer"||Ot=="byteLength"||Ot=="byteOffset")||Ii(Ot,ot))||ze.push(Ot);return ze}function al(_){var w=_.length;return w?_[qg(0,w-1)]:u}function Lg(_,w){return kf(Yo(_),Eu(w,0,_.length))}function Qd(_){return kf(Yo(_))}function Qp(_,w,D){(D!==u&&!er(_[w],D)||D===u&&!(w in _))&&cl(_,w,D)}function bu(_,w,D){var Y=_[w];Wr.call(_,w)&&er(Y,D)&&(D!==u||w in _)||cl(_,w,D)}function id(_,w){for(var D=_.length;D--;)if(er(_[D][0],w))return D;return-1}function Ug(_,w,D,Y){return sd(_,function(ae,be,ke){w(Y,ae,D(ae),ke)}),Y}function pf(_,w){return _&&ul(w,Sn(w),_)}function cl(_,w,D){w=="__proto__"&&Xd?Xd(_,w,{configurable:!0,enumerable:!0,value:D,writable:!0}):_[w]=D}function Fg(_,w){for(var D=-1,Y=w.length,ae=nn(Y),be=_==null;++D<Y;)ae[D]=be?u:kr(_,w[D]);return ae}function Eu(_,w,D){return _==_&&(D!==u&&(_=_<=D?_:D),w!==u&&(_=_>=w?_:w)),_}function qo(_,w,D,Y,ae,be){var ke,ze=1&w,ot=2&w,Ot=4&w;if(D&&(ke=ae?D(_,Y,ae,be):D(_)),ke!==u)return ke;if(!R(_))return _;var At=Ge(_);if(At){if(ke=function(kt){var Xt=kt.length,ir=new kt.constructor(Xt);return Xt&&typeof kt[0]=="string"&&Wr.call(kt,"index")&&(ir.index=kt.index,ir.input=kt.input),ir}(_),!ze)return Yo(_,ke)}else{var qt=os(_),An=qt==W||qt==K;if(yn(_))return rh(_,ze);if(qt==ie||qt==U||An&&!ae){if(ke=ot||An?{}:Zg(_),!ze)return ot?function(kt,Xt){return ul(kt,fm(kt),Xt)}(_,function(kt,Xt){return kt&&ul(Xt,Wn(Xt),kt)}(ke,_)):function(kt,Xt){return ul(kt,ld(kt),Xt)}(_,pf(ke,_))}else{if(!ur[qt])return ae?_:{};ke=function(kt,Xt,ir){var an=kt.constructor;switch(Xt){case Se:return Sf(kt);case $:case X:return new an(+kt);case Pe:return function(wr,Li){var jn=Li?Sf(wr.buffer):wr.buffer;return new wr.constructor(jn,wr.byteOffset,wr.byteLength)}(kt,ir);case we:case Te:case Oe:case _t:case Ct:case me:case ge:case nt:case Ce:return Xg(kt,ir);case ne:return new an;case Q:case ue:return new an(kt);case Z:return function(wr){var Li=new wr.constructor(wr.source,Le.exec(wr));return Li.lastIndex=wr.lastIndex,Li}(kt);case se:return new an;case Ae:return Vr=kt,rd?Fr(rd.call(Vr)):{}}var Vr}(_,qt,ze)}}be||(be=new hc);var Nn=be.get(_);if(Nn)return Nn;be.set(_,ke),z(_)?_.forEach(function(kt){ke.add(qo(kt,w,D,kt,_,be))}):P(_)&&_.forEach(function(kt,Xt){ke.set(Xt,qo(kt,w,D,Xt,_,be))});var Xn=At?u:(Ot?ot?fs:Cr:ot?Wn:Sn)(_);return dr(Xn||_,function(kt,Xt){Xn&&(kt=_[Xt=kt]),bu(ke,Xt,qo(kt,w,D,Xt,_,be))}),ke}function ks(_,w,D){var Y=D.length;if(_==null)return!Y;for(_=Fr(_);Y--;){var ae=D[Y],be=w[ae],ke=_[ae];if(ke===u&&!(ae in _)||!be(ke))return!1}return!0}function Bg(_,w,D){if(typeof _!="function")throw new Ao(d);return gc(function(){_.apply(u,D)},w)}function Zd(_,w,D,Y){var ae=-1,be=Bp,ke=!0,ze=_.length,ot=[],Ot=w.length;if(!ze)return ot;D&&(w=Tr(w,ac(D))),Y?(be=Qu,ke=!1):w.length>=200&&(be=Zc,ke=!1,w=new ol(w));e:for(;++ae<ze;){var At=_[ae],qt=D==null?At:D(At);if(At=Y||At!==0?At:0,ke&&qt==qt){for(var An=Ot;An--;)if(w[An]===qt)continue e;ot.push(At)}else be(w,qt,Y)||ot.push(At)}return ot}pe.templateSettings={escape:le,evaluate:We,interpolate:it,variable:"",imports:{_:pe}},pe.prototype=$a.prototype,pe.prototype.constructor=pe,$s.prototype=Go($a.prototype),$s.prototype.constructor=$s,Mr.prototype=Go($a.prototype),Mr.prototype.constructor=Mr,rl.prototype.clear=function(){this.__data__=dc?dc(null):{},this.size=0},rl.prototype.delete=function(_){var w=this.has(_)&&delete this.__data__[_];return this.size-=w?1:0,w},rl.prototype.get=function(_){var w=this.__data__;if(dc){var D=w[_];return D===h?u:D}return Wr.call(w,_)?w[_]:u},rl.prototype.has=function(_){var w=this.__data__;return dc?w[_]!==u:Wr.call(w,_)},rl.prototype.set=function(_,w){var D=this.__data__;return this.size+=this.has(_)?0:1,D[_]=dc&&w===u?h:w,this},il.prototype.clear=function(){this.__data__=[],this.size=0},il.prototype.delete=function(_){var w=this.__data__,D=id(w,_);return!(D<0)&&(D==w.length-1?w.pop():_u.call(w,D,1),--this.size,!0)},il.prototype.get=function(_){var w=this.__data__,D=id(w,_);return D<0?u:w[D][1]},il.prototype.has=function(_){return id(this.__data__,_)>-1},il.prototype.set=function(_,w){var D=this.__data__,Y=id(D,_);return Y<0?(++this.size,D.push([_,w])):D[Y][1]=w,this},sl.prototype.clear=function(){this.size=0,this.__data__={hash:new rl,map:new(fo||il),string:new rl}},sl.prototype.delete=function(_){var w=ms(this,_).delete(_);return this.size-=w?1:0,w},sl.prototype.get=function(_){return ms(this,_).get(_)},sl.prototype.has=function(_){return ms(this,_).has(_)},sl.prototype.set=function(_,w){var D=ms(this,_),Y=D.size;return D.set(_,w),this.size+=D.size==Y?0:1,this},ol.prototype.add=ol.prototype.push=function(_){return this.__data__.set(_,h),this},ol.prototype.has=function(_){return this.__data__.has(_)},hc.prototype.clear=function(){this.__data__=new il,this.size=0},hc.prototype.delete=function(_){var w=this.__data__,D=w.delete(_);return this.size=w.size,D},hc.prototype.get=function(_){return this.__data__.get(_)},hc.prototype.has=function(_){return this.__data__.has(_)},hc.prototype.set=function(_,w){var D=this.__data__;if(D instanceof il){var Y=D.__data__;if(!fo||Y.length<199)return Y.push([_,w]),this.size=++D.size,this;D=this.__data__=new sl(Y)}return D.set(_,w),this.size=D.size,this};var sd=V_(Ha),Zp=V_(F_,!0);function Dy(_,w){var D=!0;return sd(_,function(Y,ae,be){return D=!!w(Y,ae,be)}),D}function em(_,w,D){for(var Y=-1,ae=_.length;++Y<ae;){var be=_[Y],ke=w(be);if(ke!=null&&(ze===u?ke==ke&&!ce(ke):D(ke,ze)))var ze=ke,ot=be}return ot}function mf(_,w){var D=[];return sd(_,function(Y,ae,be){w(Y,ae,be)&&D.push(Y)}),D}function po(_,w,D,Y,ae){var be=-1,ke=_.length;for(D||(D=pm),ae||(ae=[]);++be<ke;){var ze=_[be];w>0&&D(ze)?w>1?po(ze,w-1,D,Y,ae):Fl(ae,ze):Y||(ae[ae.length]=ze)}return ae}var jg=Jg(),$g=Jg(!0);function Ha(_,w){return _&&jg(_,w,Sn)}function F_(_,w){return _&&$g(_,w,Sn)}function Vl(_,w){return Ul(w,function(D){return x(_[D])})}function hs(_,w){for(var D=0,Y=(w=ll(w,_)).length;_!=null&&D<Y;)_=_[kc(w[D++])];return D&&D==Y?_:u}function Su(_,w,D){var Y=w(_);return Ge(_)?Y:Fl(Y,D(_))}function Hs(_){return _==null?_===u?"[object Undefined]":"[object Null]":lc&&lc in Fr(_)?function(w){var D=Wr.call(w,lc),Y=w[lc];try{w[lc]=u;var ae=!0}catch{}var be=Gp.call(w);return ae&&(D?w[lc]=Y:delete w[lc]),be}(_):function(w){return Gp.call(w)}(_)}function Mi(_,w){return _>w}function gf(_,w){return _!=null&&Wr.call(_,w)}function eh(_,w){return _!=null&&w in Fr(_)}function Hg(_,w,D){for(var Y=D?Qu:Bp,ae=_[0].length,be=_.length,ke=be,ze=nn(be),ot=1/0,Ot=[];ke--;){var At=_[ke];ke&&w&&(At=Tr(At,ac(w))),ot=ds(At.length,ot),ze[ke]=!D&&(w||ae>=120&&At.length>=120)?new ol(ke&&At):u}At=_[0];var qt=-1,An=ze[0];e:for(;++qt<ae&&Ot.length<ot;){var Nn=At[qt],Xn=w?w(Nn):Nn;if(Nn=D||Nn!==0?Nn:0,!(An?Zc(An,Xn):Y(Ot,Xn,D))){for(ke=be;--ke;){var kt=ze[ke];if(!(kt?Zc(kt,Xn):Y(_[ke],Xn,D)))continue e}An&&An.push(Xn),Ot.push(Nn)}}return Ot}function zl(_,w,D){var Y=(_=Of(_,w=ll(w,_)))==null?_:_[kc(go(w))];return Y==null?u:ha(Y,_,D)}function tm(_){return O(_)&&Hs(_)==U}function Mo(_,w,D,Y,ae){return _===w||(_==null||w==null||!O(_)&&!O(w)?_!=_&&w!=w:function(be,ke,ze,ot,Ot,At){var qt=Ge(be),An=Ge(ke),Nn=qt?F:os(be),Xn=An?F:os(ke),kt=(Nn=Nn==U?ie:Nn)==ie,Xt=(Xn=Xn==U?ie:Xn)==ie,ir=Nn==Xn;if(ir&&yn(be)){if(!yn(ke))return!1;qt=!0,kt=!1}if(ir&&!kt)return At||(At=new hc),qt||de(be)?hm(be,ke,ze,ot,Ot,At):function(jn,sr,Sa,ko,pl,Ps,Pc){switch(Sa){case Pe:if(jn.byteLength!=sr.byteLength||jn.byteOffset!=sr.byteOffset)return!1;jn=jn.buffer,sr=sr.buffer;case Se:return!(jn.byteLength!=sr.byteLength||!Ps(new Mc(jn),new Mc(sr)));case $:case X:case Q:return er(+jn,+sr);case q:return jn.name==sr.name&&jn.message==sr.message;case Z:case ue:return jn==sr+"";case ne:var Uf=qd;case se:var av=1&ko;if(Uf||(Uf=ja),jn.size!=sr.size&&!av)return!1;var xx=Pc.get(jn);if(xx)return xx==sr;ko|=2,Pc.set(jn,sr);var Jk=hm(Uf(jn),Uf(sr),ko,pl,Ps,Pc);return Pc.delete(jn),Jk;case Ae:if(rd)return rd.call(jn)==rd.call(sr)}return!1}(be,ke,Nn,ze,ot,Ot,At);if(!(1&ze)){var an=kt&&Wr.call(be,"__wrapped__"),Vr=Xt&&Wr.call(ke,"__wrapped__");if(an||Vr){var wr=an?be.value():be,Li=Vr?ke.value():ke;return At||(At=new hc),Ot(wr,Li,ze,ot,At)}}return ir?(At||(At=new hc),function(jn,sr,Sa,ko,pl,Ps){var Pc=1&Sa,Uf=Cr(jn),av=Uf.length,xx=Cr(sr),Jk=xx.length;if(av!=Jk&&!Pc)return!1;for(var Cx=av;Cx--;){var e0=Uf[Cx];if(!(Pc?e0 in sr:Wr.call(sr,e0)))return!1}var O4=Ps.get(jn),k4=Ps.get(sr);if(O4&&k4)return O4==sr&&k4==jn;var Rx=!0;Ps.set(jn,sr),Ps.set(sr,jn);for(var Qk=Pc;++Cx<av;){var Ax=jn[e0=Uf[Cx]],Mx=sr[e0];if(ko)var N4=Pc?ko(Mx,Ax,e0,sr,jn,Ps):ko(Ax,Mx,e0,jn,sr,Ps);if(!(N4===u?Ax===Mx||pl(Ax,Mx,Sa,ko,Ps):N4)){Rx=!1;break}Qk||(Qk=e0=="constructor")}if(Rx&&!Qk){var Ix=jn.constructor,Ox=sr.constructor;Ix==Ox||!("constructor"in jn)||!("constructor"in sr)||typeof Ix=="function"&&Ix instanceof Ix&&typeof Ox=="function"&&Ox instanceof Ox||(Rx=!1)}return Ps.delete(jn),Ps.delete(sr),Rx}(be,ke,ze,ot,Ot,At)):!1}(_,w,D,Y,Mo,ae))}function Vg(_,w,D,Y){var ae=D.length,be=ae,ke=!Y;if(_==null)return!be;for(_=Fr(_);ae--;){var ze=D[ae];if(ke&&ze[2]?ze[1]!==_[ze[0]]:!(ze[0]in _))return!1}for(;++ae<be;){var ot=(ze=D[ae])[0],Ot=_[ot],At=ze[1];if(ke&&ze[2]){if(Ot===u&&!(ot in _))return!1}else{var qt=new hc;if(Y)var An=Y(Ot,At,ot,_,w,qt);if(!(An===u?Mo(At,Ot,3,Y,qt):An))return!1}}return!0}function vf(_){return!(!R(_)||(w=_,td&&td in w))&&(x(_)?cc:xt).test(uh(_));var w}function _f(_){return typeof _=="function"?_:_==null?Ns:typeof _=="object"?Ge(_)?B_(_[0],_[1]):mo(_):Em(_)}function yf(_){if(!Oc(_))return Qs(_);var w=[];for(var D in Fr(_))Wr.call(_,D)&&D!="constructor"&&w.push(D);return w}function nm(_){if(!R(_))return function(ae){var be=[];if(ae!=null)for(var ke in Fr(ae))be.push(ke);return be}(_);var w=Oc(_),D=[];for(var Y in _)(Y!="constructor"||!w&&Wr.call(_,Y))&&D.push(Y);return D}function rm(_,w){return _<w}function pa(_,w){var D=-1,Y=ct(_)?nn(_.length):[];return sd(_,function(ae,be,ke){Y[++D]=w(ae,be,ke)}),Y}function mo(_){var w=In(_);return w.length==1&&w[0][2]?If(w[0][0],w[0][1]):function(D){return D===_||Vg(D,_,w)}}function B_(_,w){return Mf(_)&&mm(w)?If(kc(_),w):function(D){var Y=kr(D,_);return Y===u&&Y===w?Nr(D,_):Mo(w,Y,3)}}function zg(_,w,D,Y,ae){_!==w&&jg(w,function(be,ke){if(ae||(ae=new hc),R(be))(function(ot,Ot,At,qt,An,Nn,Xn){var kt=lh(ot,At),Xt=lh(Ot,At),ir=Xn.get(Xt);if(ir)return void Qp(ot,At,ir);var an=Nn?Nn(kt,Xt,At+"",ot,Ot,Xn):u,Vr=an===u;if(Vr){var wr=Ge(Xt),Li=!wr&&yn(Xt),jn=!wr&&!Li&&de(Xt);an=Xt,wr||Li||jn?Ge(kt)?an=kt:Vt(kt)?an=Yo(kt):Li?(Vr=!1,an=rh(Xt,!0)):jn?(Vr=!1,an=Xg(Xt,!0)):an=[]:J(Xt)||Rr(Xt)?(an=kt,Rr(kt)?an=en(kt):R(kt)&&!x(kt)||(an=Zg(Xt))):Vr=!1}Vr&&(Xn.set(Xt,an),An(an,Xt,qt,Nn,Xn),Xn.delete(Xt)),Qp(ot,At,an)})(_,w,ke,D,zg,Y,ae);else{var ze=Y?Y(lh(_,ke),be,ke+"",_,w,ae):u;ze===u&&(ze=be),Qp(_,ke,ze)}},Wn)}function Va(_,w){var D=_.length;if(D)return Ii(w+=w<0?D:0,D)?_[w]:u}function Wo(_,w,D){w=w.length?Tr(w,function(be){return Ge(be)?function(ke){return hs(ke,be.length===1?be[0]:be)}:be}):[Ns];var Y=-1;w=Tr(w,ac(kn()));var ae=pa(_,function(be,ke,ze){var ot=Tr(w,function(Ot){return Ot(be)});return{criteria:ot,index:++Y,value:be}});return function(be,ke){var ze=be.length;for(be.sort(ke);ze--;)be[ze]=be[ze].value;return be}(ae,function(be,ke){return function(ze,ot,Ot){for(var At=-1,qt=ze.criteria,An=ot.criteria,Nn=qt.length,Xn=Ot.length;++At<Nn;){var kt=wf(qt[At],An[At]);if(kt)return At>=Xn?kt:kt*(Ot[At]=="desc"?-1:1)}return ze.index-ot.index}(be,ke,D)})}function j_(_,w,D){for(var Y=-1,ae=w.length,be={};++Y<ae;){var ke=w[Y],ze=hs(_,ke);D(ze,ke)&&bf(be,ll(ke,_),ze)}return be}function Gg(_,w,D,Y){var ae=Y?Bl:cf,be=-1,ke=w.length,ze=_;for(_===w&&(w=Yo(w)),D&&(ze=Tr(_,ac(D)));++be<ke;)for(var ot=0,Ot=w[be],At=D?D(Ot):Ot;(ot=ae(ze,At,ot,Y))>-1;)ze!==_&&_u.call(ze,ot,1),_u.call(_,ot,1);return _}function $_(_,w){for(var D=_?w.length:0,Y=D-1;D--;){var ae=w[D];if(D==Y||ae!==be){var be=ae;Ii(ae)?_u.call(_,ae,1):ga(_,ae)}}return _}function qg(_,w){return _+uo(ho()*(w-_+1))}function Wg(_,w){var D="";if(!_||w<1||w>A)return D;do w%2&&(D+=_),(w=uo(w/2))&&(_+=_);while(w);return D}function xr(_,w){return va(ud(_,w,Ns),_+"")}function im(_){return al(Di(_))}function H_(_,w){var D=Di(_);return kf(D,Eu(w,0,D.length))}function bf(_,w,D,Y){if(!R(_))return _;for(var ae=-1,be=(w=ll(w,_)).length,ke=be-1,ze=_;ze!=null&&++ae<be;){var ot=kc(w[ae]),Ot=D;if(ot==="__proto__"||ot==="constructor"||ot==="prototype")return _;if(ae!=ke){var At=ze[ot];(Ot=Y?Y(At,ot,ze):u)===u&&(Ot=R(At)?At:Ii(w[ae+1])?[]:{})}bu(ze,ot,Ot),ze=ze[ot]}return _}var od=Ni?function(_,w){return Ni.set(_,w),_}:Ns,wu=Xd?function(_,w){return Xd(_,"toString",{configurable:!0,enumerable:!1,value:Yl(w),writable:!0})}:Ns;function Gl(_){return kf(Di(_))}function Ko(_,w,D){var Y=-1,ae=_.length;w<0&&(w=-w>ae?0:ae+w),(D=D>ae?ae:D)<0&&(D+=ae),ae=w>D?0:D-w>>>0,w>>>=0;for(var be=nn(ae);++Y<ae;)be[Y]=_[Y+w];return be}function ql(_,w){var D;return sd(_,function(Y,ae,be){return!(D=w(Y,ae,be))}),!!D}function ad(_,w,D){var Y=0,ae=_==null?Y:_.length;if(typeof w=="number"&&w==w&&ae<=2147483647){for(;Y<ae;){var be=Y+ae>>>1,ke=_[be];ke!==null&&!ce(ke)&&(D?ke<=w:ke<w)?Y=be+1:ae=be}return ae}return Kg(_,w,Ns,D)}function Kg(_,w,D,Y){var ae=0,be=_==null?0:_.length;if(be===0)return 0;for(var ke=(w=D(w))!=w,ze=w===null,ot=ce(w),Ot=w===u;ae<be;){var At=uo((ae+be)/2),qt=D(_[At]),An=qt!==u,Nn=qt===null,Xn=qt==qt,kt=ce(qt);if(ke)var Xt=Y||Xn;else Xt=Ot?Xn&&(Y||An):ze?Xn&&An&&(Y||!Nn):ot?Xn&&An&&!Nn&&(Y||!kt):!Nn&&!kt&&(Y?qt<=w:qt<w);Xt?ae=At+1:be=At}return ds(be,4294967294)}function sm(_,w){for(var D=-1,Y=_.length,ae=0,be=[];++D<Y;){var ke=_[D],ze=w?w(ke):ke;if(!D||!er(ze,ot)){var ot=ze;be[ae++]=ke===0?0:ke}}return be}function Ef(_){return typeof _=="number"?_:ce(_)?k:+_}function ma(_){if(typeof _=="string")return _;if(Ge(_))return Tr(_,ma)+"";if(ce(_))return ff?ff.call(_):"";var w=_+"";return w=="0"&&1/_==-1/0?"-0":w}function Tu(_,w,D){var Y=-1,ae=Bp,be=_.length,ke=!0,ze=[],ot=ze;if(D)ke=!1,ae=Qu;else if(be>=200){var Ot=w?null:q_(_);if(Ot)return ja(Ot);ke=!1,ae=Zc,ot=new ol}else ot=w?[]:ze;e:for(;++Y<be;){var At=_[Y],qt=w?w(At):At;if(At=D||At!==0?At:0,ke&&qt==qt){for(var An=ot.length;An--;)if(ot[An]===qt)continue e;w&&ot.push(qt),ze.push(At)}else ae(ot,qt,D)||(ot!==ze&&ot.push(qt),ze.push(At))}return ze}function ga(_,w){return(_=Of(_,w=ll(w,_)))==null||delete _[kc(go(w))]}function Ly(_,w,D,Y){return bf(_,w,D(hs(_,w)),Y)}function Yg(_,w,D,Y){for(var ae=_.length,be=Y?ae:-1;(Y?be--:++be<ae)&&w(_[be],be,_););return D?Ko(_,Y?0:be,Y?be+1:ae):Ko(_,Y?be+1:0,Y?ae:be)}function th(_,w){var D=_;return D instanceof Mr&&(D=D.value()),N_(w,function(Y,ae){return ae.func.apply(ae.thisArg,Fl([Y],ae.args))},D)}function xu(_,w,D){var Y=_.length;if(Y<2)return Y?Tu(_[0]):[];for(var ae=-1,be=nn(Y);++ae<Y;)for(var ke=_[ae],ze=-1;++ze<Y;)ze!=ae&&(be[ae]=Zd(be[ae]||ke,_[ze],w,D));return Tu(po(be,1),w,D)}function om(_,w,D){for(var Y=-1,ae=_.length,be=w.length,ke={};++Y<ae;){var ze=Y<be?w[Y]:u;D(ke,_[Y],ze)}return ke}function rn(_){return Vt(_)?_:[]}function nh(_){return typeof _=="function"?_:Ns}function ll(_,w){return Ge(_)?_:Mf(_,w)?[_]:gm(Pt(_))}var Uy=xr;function Io(_,w,D){var Y=_.length;return D=D===u?Y:D,!w&&D>=Y?_:Ko(_,w,D)}var Cu=Yt||function(_){return vn.clearTimeout(_)};function rh(_,w){if(w)return _.slice();var D=_.length,Y=Ic?Ic(D):new _.constructor(D);return _.copy(Y),Y}function Sf(_){var w=new _.constructor(_.byteLength);return new Mc(w).set(new Mc(_)),w}function Xg(_,w){var D=w?Sf(_.buffer):_.buffer;return new _.constructor(D,_.byteOffset,_.length)}function wf(_,w){if(_!==w){var D=_!==u,Y=_===null,ae=_==_,be=ce(_),ke=w!==u,ze=w===null,ot=w==w,Ot=ce(w);if(!ze&&!Ot&&!be&&_>w||be&&ke&&ot&&!ze&&!Ot||Y&&ke&&ot||!D&&ot||!ae)return 1;if(!Y&&!be&&!Ot&&_<w||Ot&&D&&ae&&!Y&&!be||ze&&D&&ae||!ke&&ae||!ot)return-1}return 0}function ih(_,w,D,Y){for(var ae=-1,be=_.length,ke=D.length,ze=-1,ot=w.length,Ot=ai(be-ke,0),At=nn(ot+Ot),qt=!Y;++ze<ot;)At[ze]=w[ze];for(;++ae<ke;)(qt||ae<be)&&(At[D[ae]]=_[ae]);for(;Ot--;)At[ze++]=_[ae++];return At}function Tf(_,w,D,Y){for(var ae=-1,be=_.length,ke=-1,ze=D.length,ot=-1,Ot=w.length,At=ai(be-ze,0),qt=nn(At+Ot),An=!Y;++ae<At;)qt[ae]=_[ae];for(var Nn=ae;++ot<Ot;)qt[Nn+ot]=w[ot];for(;++ke<ze;)(An||ae<be)&&(qt[Nn+D[ke]]=_[ae++]);return qt}function Yo(_,w){var D=-1,Y=_.length;for(w||(w=nn(Y));++D<Y;)w[D]=_[D];return w}function ul(_,w,D,Y){var ae=!D;D||(D={});for(var be=-1,ke=w.length;++be<ke;){var ze=w[be],ot=Y?Y(D[ze],_[ze],ze,D,_):u;ot===u&&(ot=_[ze]),ae?cl(D,ze,ot):bu(D,ze,ot)}return D}function xf(_,w){return function(D,Y){var ae=Ge(D)?af:Ug,be=w?w():{};return ae(D,_,kn(Y,2),be)}}function cd(_){return xr(function(w,D){var Y=-1,ae=D.length,be=ae>1?D[ae-1]:u,ke=ae>2?D[2]:u;for(be=_.length>3&&typeof be=="function"?(ae--,be):u,ke&&eo(D[0],D[1],ke)&&(be=ae<3?u:be,ae=1),w=Fr(w);++Y<ae;){var ze=D[Y];ze&&_(w,ze,Y,be)}return w})}function V_(_,w){return function(D,Y){if(D==null)return D;if(!ct(D))return _(D,Y);for(var ae=D.length,be=w?ae:-1,ke=Fr(D);(w?be--:++be<ae)&&Y(ke[be],be,ke)!==!1;);return D}}function Jg(_){return function(w,D,Y){for(var ae=-1,be=Fr(w),ke=Y(w),ze=ke.length;ze--;){var ot=ke[_?ze:++ae];if(D(be[ot],ot,be)===!1)break}return w}}function am(_){return function(w){var D=vu(w=Pt(w))?Ms(w):u,Y=D?D[0]:w.charAt(0),ae=D?Io(D,1).join(""):w.slice(1);return Y[_]()+ae}}function sh(_){return function(w){return N_(Nc(Zi(w).replace(Gr,"")),_,"")}}function cm(_){return function(){var w=arguments;switch(w.length){case 0:return new _;case 1:return new _(w[0]);case 2:return new _(w[0],w[1]);case 3:return new _(w[0],w[1],w[2]);case 4:return new _(w[0],w[1],w[2],w[3]);case 5:return new _(w[0],w[1],w[2],w[3],w[4]);case 6:return new _(w[0],w[1],w[2],w[3],w[4],w[5]);case 7:return new _(w[0],w[1],w[2],w[3],w[4],w[5],w[6])}var D=Go(_.prototype),Y=_.apply(D,w);return R(Y)?Y:D}}function z_(_){return function(w,D,Y){var ae=Fr(w);if(!ct(w)){var be=kn(D,3);w=Sn(w),D=function(ze){return be(ae[ze],ze,ae)}}var ke=_(w,D,Y);return ke>-1?ae[be?w[ke]:ke]:u}}function Qg(_){return Ti(function(w){var D=w.length,Y=D,ae=$s.prototype.thru;for(_&&w.reverse();Y--;){var be=w[Y];if(typeof be!="function")throw new Ao(d);if(ae&&!ke&&Vs(be)=="wrapper")var ke=new $s([],!0)}for(Y=ke?Y:D;++Y<D;){var ze=Vs(be=w[Y]),ot=ze=="wrapper"?ps(be):u;ke=ot&&Wl(ot[0])&&ot[1]==424&&!ot[4].length&&ot[9]==1?ke[Vs(ot[0])].apply(ke,ot[3]):be.length==1&&Wl(be)?ke[ze]():ke.thru(be)}return function(){var Ot=arguments,At=Ot[0];if(ke&&Ot.length==1&&Ge(At))return ke.plant(At).value();for(var qt=0,An=D?w[qt].apply(this,Ot):At;++qt<D;)An=w[qt].call(this,An);return An}})}function lm(_,w,D,Y,ae,be,ke,ze,ot,Ot){var At=w&E,qt=1&w,An=2&w,Nn=24&w,Xn=512&w,kt=An?u:cm(_);return function Xt(){for(var ir=arguments.length,an=nn(ir),Vr=ir;Vr--;)an[Vr]=arguments[Vr];if(Nn)var wr=Zs(Xt),Li=function(ko,pl){for(var Ps=ko.length,Pc=0;Ps--;)ko[Ps]===pl&&++Pc;return Pc}(an,wr);if(Y&&(an=ih(an,Y,ae,Nn)),be&&(an=Tf(an,be,ke,Nn)),ir-=Li,Nn&&ir<Ot){var jn=Yi(an,wr);return Rf(_,w,lm,Xt.placeholder,D,an,jn,ze,ot,Ot-ir)}var sr=qt?D:this,Sa=An?sr[_]:_;return ir=an.length,ze?an=function(ko,pl){for(var Ps=ko.length,Pc=ds(pl.length,Ps),Uf=Yo(ko);Pc--;){var av=pl[Pc];ko[Pc]=Ii(av,Ps)?Uf[av]:u}return ko}(an,ze):Xn&&ir>1&&an.reverse(),At&&ot<ir&&(an.length=ot),this&&this!==vn&&this instanceof Xt&&(Sa=kt||cm(Sa)),Sa.apply(sr,an)}}function G_(_,w){return function(D,Y){return function(ae,be,ke,ze){return Ha(ae,function(ot,Ot,At){be(ze,ke(ot),Ot,At)}),ze}(D,_,w(Y),{})}}function oh(_,w){return function(D,Y){var ae;if(D===u&&Y===u)return w;if(D!==u&&(ae=D),Y!==u){if(ae===u)return Y;typeof D=="string"||typeof Y=="string"?(D=ma(D),Y=ma(Y)):(D=Ef(D),Y=Ef(Y)),ae=_(D,Y)}return ae}}function Cf(_){return Ti(function(w){return w=Tr(w,ac(kn())),xr(function(D){var Y=this;return _(w,function(ae){return ha(ae,Y,D)})})})}function ah(_,w){var D=(w=w===u?" ":ma(w)).length;if(D<2)return D?Wg(w,_):w;var Y=Wg(w,Kp(_/As(w)));return vu(w)?Io(Ms(Y),0,_).join(""):Y.slice(0,_)}function um(_){return function(w,D,Y){return Y&&typeof Y!="number"&&eo(w,D,Y)&&(D=Y=u),w=Re(w),D===u?(D=w,w=0):D=Re(D),function(ae,be,ke,ze){for(var ot=-1,Ot=ai(Kp((be-ae)/(ke||1)),0),At=nn(Ot);Ot--;)At[ze?Ot:++ot]=ae,ae+=ke;return At}(w,D,Y=Y===u?w<D?1:-1:Re(Y),_)}}function ch(_){return function(w,D){return typeof w=="string"&&typeof D=="string"||(w=Bt(w),D=Bt(D)),_(w,D)}}function Rf(_,w,D,Y,ae,be,ke,ze,ot,Ot){var At=8&w;w|=At?g:v,4&(w&=~(At?v:g))||(w&=-4);var qt=[_,w,ae,At?be:u,At?ke:u,At?u:be,At?u:ke,ze,ot,Ot],An=D.apply(u,qt);return Wl(_)&&Pi(An,qt),An.placeholder=Y,gs(An,_,w)}function Af(_){var w=tl[_];return function(D,Y){if(D=Bt(D),(Y=Y==null?0:ds(ye(Y),292))&&Js(D)){var ae=(Pt(D)+"e").split("e");return+((ae=(Pt(w(ae[0]+"e"+(+ae[1]+Y)))+"e").split("e"))[0]+"e"+(+ae[1]-Y))}return w(D)}}var q_=Is&&1/ja(new Is([,-0]))[1]==C?function(_){return new Is(_)}:Xl;function dm(_){return function(w){var D=os(w);return D==ne?qd(w):D==se?Zu(w):function(Y,ae){return Tr(ae,function(be){return[be,Y[be]]})}(w,_(w))}}function fc(_,w,D,Y,ae,be,ke,ze){var ot=2&w;if(!ot&&typeof _!="function")throw new Ao(d);var Ot=Y?Y.length:0;if(Ot||(w&=-97,Y=ae=u),ke=ke===u?ke:ai(ye(ke),0),ze=ze===u?ze:ye(ze),Ot-=ae?ae.length:0,w&v){var At=Y,qt=ae;Y=ae=u}var An=ot?u:ps(_),Nn=[_,w,D,Y,ae,At,qt,be,ke,ze];if(An&&function(kt,Xt){var ir=kt[1],an=Xt[1],Vr=ir|an,wr=Vr<131,Li=an==E&&ir==8||an==E&&ir==T&&kt[7].length<=Xt[8]||an==384&&Xt[7].length<=Xt[8]&&ir==8;if(!wr&&!Li)return kt;1&an&&(kt[2]=Xt[2],Vr|=1&ir?0:4);var jn=Xt[3];if(jn){var sr=kt[3];kt[3]=sr?ih(sr,jn,Xt[4]):jn,kt[4]=sr?Yi(kt[3],f):Xt[4]}(jn=Xt[5])&&(sr=kt[5],kt[5]=sr?Tf(sr,jn,Xt[6]):jn,kt[6]=sr?Yi(kt[5],f):Xt[6]),(jn=Xt[7])&&(kt[7]=jn),an&E&&(kt[8]=kt[8]==null?Xt[8]:ds(kt[8],Xt[8])),kt[9]==null&&(kt[9]=Xt[9]),kt[0]=Xt[0],kt[1]=Vr}(Nn,An),_=Nn[0],w=Nn[1],D=Nn[2],Y=Nn[3],ae=Nn[4],!(ze=Nn[9]=Nn[9]===u?ot?0:_.length:ai(Nn[9]-Ot,0))&&24&w&&(w&=-25),w&&w!=1)Xn=w==8||w==p?function(kt,Xt,ir){var an=cm(kt);return function Vr(){for(var wr=arguments.length,Li=nn(wr),jn=wr,sr=Zs(Vr);jn--;)Li[jn]=arguments[jn];var Sa=wr<3&&Li[0]!==sr&&Li[wr-1]!==sr?[]:Yi(Li,sr);return(wr-=Sa.length)<ir?Rf(kt,Xt,lm,Vr.placeholder,u,Li,Sa,u,u,ir-wr):ha(this&&this!==vn&&this instanceof Vr?an:kt,this,Li)}}(_,w,ze):w!=g&&w!=33||ae.length?lm.apply(u,Nn):function(kt,Xt,ir,an){var Vr=1&Xt,wr=cm(kt);return function Li(){for(var jn=-1,sr=arguments.length,Sa=-1,ko=an.length,pl=nn(ko+sr),Ps=this&&this!==vn&&this instanceof Li?wr:kt;++Sa<ko;)pl[Sa]=an[Sa];for(;sr--;)pl[Sa++]=arguments[++jn];return ha(Ps,Vr?ir:this,pl)}}(_,w,D,Y);else var Xn=function(kt,Xt,ir){var an=1&Xt,Vr=cm(kt);return function wr(){return(this&&this!==vn&&this instanceof wr?Vr:kt).apply(an?ir:this,arguments)}}(_,w,D);return gs((An?od:Pi)(Xn,Nn),_,w)}function pc(_,w,D,Y){return _===u||er(_,Ys[D])&&!Wr.call(Y,D)?w:_}function mc(_,w,D,Y,ae,be){return R(_)&&R(w)&&(be.set(w,_),zg(_,w,u,mc,be),be.delete(w)),_}function wi(_){return J(_)?u:_}function hm(_,w,D,Y,ae,be){var ke=1&D,ze=_.length,ot=w.length;if(ze!=ot&&!(ke&&ot>ze))return!1;var Ot=be.get(_),At=be.get(w);if(Ot&&At)return Ot==w&&At==_;var qt=-1,An=!0,Nn=2&D?new ol:u;for(be.set(_,w),be.set(w,_);++qt<ze;){var Xn=_[qt],kt=w[qt];if(Y)var Xt=ke?Y(kt,Xn,qt,w,_,be):Y(Xn,kt,qt,_,w,be);if(Xt!==u){if(Xt)continue;An=!1;break}if(Nn){if(!Og(w,function(ir,an){if(!Zc(Nn,an)&&(Xn===ir||ae(Xn,ir,D,Y,be)))return Nn.push(an)})){An=!1;break}}else if(Xn!==kt&&!ae(Xn,kt,D,Y,be)){An=!1;break}}return be.delete(_),be.delete(w),An}function Ti(_){return va(ud(_,u,W_),_+"")}function Cr(_){return Su(_,Sn,ld)}function fs(_){return Su(_,Wn,fm)}var ps=Ni?function(_){return Ni.get(_)}:Xl;function Vs(_){for(var w=_.name+"",D=ss[w],Y=Wr.call(ss,w)?D.length:0;Y--;){var ae=D[Y],be=ae.func;if(be==null||be==_)return ae.name}return w}function Zs(_){return(Wr.call(pe,"placeholder")?pe:_).placeholder}function kn(){var _=pe.iteratee||Iu;return _=_===Iu?_f:_,arguments.length?_(arguments[0],arguments[1]):_}function ms(_,w){var D,Y,ae=_.__data__;return((Y=typeof(D=w))=="string"||Y=="number"||Y=="symbol"||Y=="boolean"?D!=="__proto__":D===null)?ae[typeof w=="string"?"string":"hash"]:ae.map}function In(_){for(var w=Sn(_),D=w.length;D--;){var Y=w[D],ae=_[Y];w[D]=[Y,ae,mm(ae)]}return w}function za(_,w){var D=function(Y,ae){return Y==null?u:Y[ae]}(_,w);return vf(D)?D:u}var ld=Yp?function(_){return _==null?[]:(_=Fr(_),Ul(Yp(_),function(w){return Wp.call(_,w)}))}:Sm,fm=Yp?function(_){for(var w=[];_;)Fl(w,ld(_)),_=uf(_);return w}:Sm,os=Hs;function Xo(_,w,D){for(var Y=-1,ae=(w=ll(w,_)).length,be=!1;++Y<ae;){var ke=kc(w[Y]);if(!(be=_!=null&&D(_,ke)))break;_=_[ke]}return be||++Y!=ae?be:!!(ae=_==null?0:_.length)&&S(ae)&&Ii(ke,ae)&&(Ge(_)||Rr(_))}function Zg(_){return typeof _.constructor!="function"||Oc(_)?{}:Go(uf(_))}function pm(_){return Ge(_)||Rr(_)||!!(U_&&_&&_[U_])}function Ii(_,w){var D=typeof _;return!!(w=w??A)&&(D=="number"||D!="symbol"&&Jt.test(_))&&_>-1&&_%1==0&&_<w}function eo(_,w,D){if(!R(D))return!1;var Y=typeof w;return!!(Y=="number"?ct(D)&&Ii(w,D.length):Y=="string"&&w in D)&&er(D[w],_)}function Mf(_,w){if(Ge(_))return!1;var D=typeof _;return!(D!="number"&&D!="symbol"&&D!="boolean"&&_!=null&&!ce(_))||Fe.test(_)||!je.test(_)||w!=null&&_ in Fr(w)}function Wl(_){var w=Vs(_),D=pe[w];if(typeof D!="function"||!(w in Mr.prototype))return!1;if(_===D)return!0;var Y=ps(D);return!!Y&&_===Y[0]}(Jd&&os(new Jd(new ArrayBuffer(1)))!=Pe||fo&&os(new fo)!=ne||Ut&&os(Ut.resolve())!=G||Is&&os(new Is)!=se||zo&&os(new zo)!=Be)&&(os=function(_){var w=Hs(_),D=w==ie?_.constructor:u,Y=D?uh(D):"";if(Y)switch(Y){case Os:return Pe;case hf:return ne;case Jp:return G;case yu:return se;case Py:return Be}return w});var ev=Xs?x:wm;function Oc(_){var w=_&&_.constructor;return _===(typeof w=="function"&&w.prototype||Ys)}function mm(_){return _==_&&!R(_)}function If(_,w){return function(D){return D!=null&&D[_]===w&&(w!==u||_ in Fr(D))}}function ud(_,w,D){return w=ai(w===u?_.length-1:w,0),function(){for(var Y=arguments,ae=-1,be=ai(Y.length-w,0),ke=nn(be);++ae<be;)ke[ae]=Y[w+ae];ae=-1;for(var ze=nn(w+1);++ae<w;)ze[ae]=Y[ae];return ze[w]=D(ke),ha(_,this,ze)}}function Of(_,w){return w.length<2?_:hs(_,Ko(w,0,-1))}function lh(_,w){if((w!=="constructor"||typeof _[w]!="function")&&w!="__proto__")return _[w]}var Pi=to(od),gc=Ny||function(_,w){return vn.setTimeout(_,w)},va=to(wu);function gs(_,w,D){var Y=w+"";return va(_,function(ae,be){var ke=be.length;if(!ke)return ae;var ze=ke-1;return be[ze]=(ke>1?"& ":"")+be[ze],be=be.join(ke>2?", ":" "),ae.replace(V,`{
/* [wrapped with `+be+`] */
`)}(Y,function(ae,be){return dr(N,function(ke){var ze="_."+ke[0];be&ke[1]&&!Bp(ae,ze)&&ae.push(ze)}),ae.sort()}(function(ae){var be=ae.match(fe);return be?be[1].split(Ie):[]}(Y),D)))}function to(_){var w=0,D=0;return function(){var Y=Zn(),ae=16-(Y-D);if(D=Y,ae>0){if(++w>=800)return arguments[0]}else w=0;return _.apply(u,arguments)}}function kf(_,w){var D=-1,Y=_.length,ae=Y-1;for(w=w===u?Y:w;++D<w;){var be=qg(D,ae),ke=_[be];_[be]=_[D],_[D]=ke}return _.length=w,_}var gm=function(_){var w=Ve(_,function(Y){return D.size===500&&D.clear(),Y}),D=w.cache;return w}(function(_){var w=[];return _.charCodeAt(0)===46&&w.push(""),_.replace(Ht,function(D,Y,ae,be){w.push(ae?be.replace(yt,"$1"):Y||D)}),w});function kc(_){if(typeof _=="string"||ce(_))return _;var w=_+"";return w=="0"&&1/_==-1/0?"-0":w}function uh(_){if(_!=null){try{return Hl.call(_)}catch{}try{return _+""}catch{}}return""}function Ru(_){if(_ instanceof Mr)return _.clone();var w=new $s(_.__wrapped__,_.__chain__);return w.__actions__=Yo(_.__actions__),w.__index__=_.__index__,w.__values__=_.__values__,w}var Nf=xr(function(_,w){return Vt(_)?Zd(_,po(w,1,Vt,!0)):[]}),no=xr(function(_,w){var D=go(w);return Vt(D)&&(D=u),Vt(_)?Zd(_,po(w,1,Vt,!0),kn(D,2)):[]}),Pf=xr(function(_,w){var D=go(w);return Vt(D)&&(D=u),Vt(_)?Zd(_,po(w,1,Vt,!0),u,D):[]});function Hi(_,w,D){var Y=_==null?0:_.length;if(!Y)return-1;var ae=D==null?0:ye(D);return ae<0&&(ae=ai(Y+ae,0)),kg(_,kn(w,3),ae)}function dl(_,w,D){var Y=_==null?0:_.length;if(!Y)return-1;var ae=Y-1;return D!==u&&(ae=ye(D),ae=D<0?ai(Y+ae,0):ds(ae,Y-1)),kg(_,kn(w,3),ae,!0)}function W_(_){return _!=null&&_.length?po(_,1):[]}function dd(_){return _&&_.length?_[0]:u}var dh=xr(function(_){var w=Tr(_,rn);return w.length&&w[0]===_[0]?Hg(w):[]}),_a=xr(function(_){var w=go(_),D=Tr(_,rn);return w===go(D)?w=u:D.pop(),D.length&&D[0]===_[0]?Hg(D,kn(w,2)):[]}),Jo=xr(function(_){var w=go(_),D=Tr(_,rn);return(w=typeof w=="function"?w:u)&&D.pop(),D.length&&D[0]===_[0]?Hg(D,u,w):[]});function go(_){var w=_==null?0:_.length;return w?_[w-1]:u}var tv=xr(hd);function hd(_,w){return _&&_.length&&w&&w.length?Gg(_,w):_}var Au=Ti(function(_,w){var D=_==null?0:_.length,Y=Fg(_,w);return $_(_,Tr(w,function(ae){return Ii(ae,D)?+ae:ae}).sort(wf)),Y});function Ir(_){return _==null?_:Ai.call(_)}var Fy=xr(function(_){return Tu(po(_,1,Vt,!0))}),Ga=xr(function(_){var w=go(_);return Vt(w)&&(w=u),Tu(po(_,1,Vt,!0),kn(w,2))}),uS=xr(function(_){var w=go(_);return w=typeof w=="function"?w:u,Tu(po(_,1,Vt,!0),u,w)});function hh(_){if(!_||!_.length)return[];var w=0;return _=Ul(_,function(D){if(Vt(D))return w=ai(D.length,w),!0}),P_(w,function(D){return Tr(_,Hp(D))})}function Df(_,w){if(!_||!_.length)return[];var D=hh(_);return w==null?D:Tr(D,function(Y){return ha(w,u,Y)})}var vm=xr(function(_,w){return Vt(_)?Zd(_,w):[]}),By=xr(function(_){return xu(Ul(_,Vt))}),jy=xr(function(_){var w=go(_);return Vt(w)&&(w=u),xu(Ul(_,Vt),kn(w,2))}),dS=xr(function(_){var w=go(_);return w=typeof w=="function"?w:u,xu(Ul(_,Vt),u,w)}),vs=xr(hh),vc=xr(function(_){var w=_.length,D=w>1?_[w-1]:u;return D=typeof D=="function"?(_.pop(),D):u,Df(_,D)});function fh(_){var w=pe(_);return w.__chain__=!0,w}function Qo(_,w){return w(_)}var Kl=Ti(function(_){var w=_.length,D=w?_[0]:0,Y=this.__wrapped__,ae=function(be){return Fg(be,_)};return!(w>1||this.__actions__.length)&&Y instanceof Mr&&Ii(D)?((Y=Y.slice(D,+D+(w?1:0))).__actions__.push({func:Qo,args:[ae],thisArg:u}),new $s(Y,this.__chain__).thru(function(be){return w&&!be.length&&be.push(u),be})):this.thru(ae)}),ya=xf(function(_,w,D){Wr.call(_,D)?++_[D]:cl(_,D,1)}),Vi=z_(Hi),Oo=z_(dl);function _m(_,w){return(Ge(_)?dr:sd)(_,kn(w,3))}function nv(_,w){return(Ge(_)?Iy:Zp)(_,kn(w,3))}var K_=xf(function(_,w,D){Wr.call(_,D)?_[D].push(w):cl(_,D,[w])}),$y=xr(function(_,w,D){var Y=-1,ae=typeof w=="function",be=ct(_)?nn(_.length):[];return sd(_,function(ke){be[++Y]=ae?ha(w,ke,D):zl(ke,w,D)}),be}),Y_=xf(function(_,w,D){cl(_,D,w)});function ym(_,w){return(Ge(_)?Tr:pa)(_,kn(w,3))}var rv=xf(function(_,w,D){_[D?0:1].push(w)},function(){return[[],[]]}),hS=xr(function(_,w){if(_==null)return[];var D=w.length;return D>1&&eo(_,w[0],w[1])?w=[]:D>2&&eo(w[0],w[1],w[2])&&(w=[w[0]]),Wo(_,po(w,1),[])}),bm=is||function(){return vn.Date.now()};function m(_,w,D){return w=D?u:w,w=_&&w==null?_.length:w,fc(_,E,u,u,u,u,w)}function y(_,w){var D;if(typeof w!="function")throw new Ao(d);return _=ye(_),function(){return--_>0&&(D=w.apply(this,arguments)),_<=1&&(w=u),D}}var M=xr(function(_,w,D){var Y=1;if(D.length){var ae=Yi(D,Zs(M));Y|=g}return fc(_,Y,w,D,ae)}),L=xr(function(_,w,D){var Y=3;if(D.length){var ae=Yi(D,Zs(L));Y|=g}return fc(w,Y,_,D,ae)});function H(_,w,D){var Y,ae,be,ke,ze,ot,Ot=0,At=!1,qt=!1,An=!0;if(typeof _!="function")throw new Ao(d);function Nn(an){var Vr=Y,wr=ae;return Y=ae=u,Ot=an,ke=_.apply(wr,Vr)}function Xn(an){var Vr=an-ot;return ot===u||Vr>=w||Vr<0||qt&&an-Ot>=be}function kt(){var an=bm();if(Xn(an))return Xt(an);ze=gc(kt,function(Vr){var wr=w-(Vr-ot);return qt?ds(wr,be-(Vr-Ot)):wr}(an))}function Xt(an){return ze=u,An&&Y?Nn(an):(Y=ae=u,ke)}function ir(){var an=bm(),Vr=Xn(an);if(Y=arguments,ae=this,ot=an,Vr){if(ze===u)return function(wr){return Ot=wr,ze=gc(kt,w),At?Nn(wr):ke}(ot);if(qt)return Cu(ze),ze=gc(kt,w),Nn(ot)}return ze===u&&(ze=gc(kt,w)),ke}return w=Bt(w)||0,R(D)&&(At=!!D.leading,be=(qt="maxWait"in D)?ai(Bt(D.maxWait)||0,w):be,An="trailing"in D?!!D.trailing:An),ir.cancel=function(){ze!==u&&Cu(ze),Ot=0,Y=ot=ae=ze=u},ir.flush=function(){return ze===u?ke:Xt(bm())},ir}var ee=xr(function(_,w){return Bg(_,1,w)}),xe=xr(function(_,w,D){return Bg(_,Bt(w)||0,D)});function Ve(_,w){if(typeof _!="function"||w!=null&&typeof w!="function")throw new Ao(d);var D=function(){var Y=arguments,ae=w?w.apply(this,Y):Y[0],be=D.cache;if(be.has(ae))return be.get(ae);var ke=_.apply(this,Y);return D.cache=be.set(ae,ke)||be,ke};return D.cache=new(Ve.Cache||sl),D}function bt(_){if(typeof _!="function")throw new Ao(d);return function(){var w=arguments;switch(w.length){case 0:return!_.call(this);case 1:return!_.call(this,w[0]);case 2:return!_.call(this,w[0],w[1]);case 3:return!_.call(this,w[0],w[1],w[2])}return!_.apply(this,w)}}Ve.Cache=sl;var Wt=Uy(function(_,w){var D=(w=w.length==1&&Ge(w[0])?Tr(w[0],ac(kn())):Tr(po(w,1),ac(kn()))).length;return xr(function(Y){for(var ae=-1,be=ds(Y.length,D);++ae<be;)Y[ae]=w[ae].call(this,Y[ae]);return ha(_,this,Y)})}),fn=xr(function(_,w){var D=Yi(w,Zs(fn));return fc(_,g,u,w,D)}),mr=xr(function(_,w){var D=Yi(w,Zs(mr));return fc(_,v,u,w,D)}),gn=Ti(function(_,w){return fc(_,T,u,u,u,w)});function er(_,w){return _===w||_!=_&&w!=w}var bn=ch(Mi),Zo=ch(function(_,w){return _>=w}),Rr=tm(function(){return arguments}())?tm:function(_){return O(_)&&Wr.call(_,"callee")&&!Wp.call(_,"callee")},Ge=nn.isArray,Je=Gd?ac(Gd):function(_){return O(_)&&Hs(_)==Se};function ct(_){return _!=null&&S(_.length)&&!x(_)}function Vt(_){return O(_)&&ct(_)}var yn=Xp||wm,hr=of?ac(of):function(_){return O(_)&&Hs(_)==X};function fr(_){if(!O(_))return!1;var w=Hs(_);return w==q||w=="[object DOMException]"||typeof _.message=="string"&&typeof _.name=="string"&&!J(_)}function x(_){if(!R(_))return!1;var w=Hs(_);return w==W||w==K||w=="[object AsyncFunction]"||w=="[object Proxy]"}function b(_){return typeof _=="number"&&_==ye(_)}function S(_){return typeof _=="number"&&_>-1&&_%1==0&&_<=A}function R(_){var w=typeof _;return _!=null&&(w=="object"||w=="function")}function O(_){return _!=null&&typeof _=="object"}var P=gu?ac(gu):function(_){return O(_)&&os(_)==ne};function B(_){return typeof _=="number"||O(_)&&Hs(_)==Q}function J(_){if(!O(_)||Hs(_)!=ie)return!1;var w=uf(_);if(w===null)return!0;var D=Wr.call(w,"constructor")&&w.constructor;return typeof D=="function"&&D instanceof D&&Hl.call(D)==nd}var te=Up?ac(Up):function(_){return O(_)&&Hs(_)==Z},z=Fp?ac(Fp):function(_){return O(_)&&os(_)==se};function re(_){return typeof _=="string"||!Ge(_)&&O(_)&&Hs(_)==ue}function ce(_){return typeof _=="symbol"||O(_)&&Hs(_)==Ae}var de=Ju?ac(Ju):function(_){return O(_)&&S(_.length)&&!!Qn[Hs(_)]},Me=ch(rm),Qe=ch(function(_,w){return _<=w});function $e(_){if(!_)return[];if(ct(_))return re(_)?Ms(_):Yo(_);if(nl&&_[nl])return function(D){for(var Y,ae=[];!(Y=D.next()).done;)ae.push(Y.value);return ae}(_[nl]());var w=os(_);return(w==ne?qd:w==se?ja:Di)(_)}function Re(_){return _?(_=Bt(_))===C||_===-1/0?17976931348623157e292*(_<0?-1:1):_==_?_:0:_===0?_:0}function ye(_){var w=Re(_),D=w%1;return w==w?D?w-D:w:0}function gt(_){return _?Eu(ye(_),0,I):0}function Bt(_){if(typeof _=="number")return _;if(ce(_))return k;if(R(_)){var w=typeof _.valueOf=="function"?_.valueOf():_;_=R(w)?w+"":w}if(typeof _!="string")return _===0?_:+_;_=Vp(_);var D=rt.test(_);return D||sn.test(_)?Ro(_.slice(2),D?2:8):Lt.test(_)?k:+_}function en(_){return ul(_,Wn(_))}function Pt(_){return _==null?"":ma(_)}var $n=cd(function(_,w){if(Oc(w)||ct(w))ul(w,Sn(w),_);else for(var D in w)Wr.call(w,D)&&bu(_,D,w[D])}),Ln=cd(function(_,w){ul(w,Wn(w),_)}),Or=cd(function(_,w,D,Y){ul(w,Wn(w),_,Y)}),Br=cd(function(_,w,D,Y){ul(w,Sn(w),_,Y)}),jr=Ti(Fg),$r=xr(function(_,w){_=Fr(_);var D=-1,Y=w.length,ae=Y>2?w[2]:u;for(ae&&eo(w[0],w[1],ae)&&(Y=1);++D<Y;)for(var be=w[D],ke=Wn(be),ze=-1,ot=ke.length;++ze<ot;){var Ot=ke[ze],At=_[Ot];(At===u||er(At,Ys[Ot])&&!Wr.call(_,Ot))&&(_[Ot]=be[Ot])}return _}),_r=xr(function(_){return _.push(u,mc),ha(Xi,u,_)});function kr(_,w,D){var Y=_==null?u:hs(_,w);return Y===u?D:Y}function Nr(_,w){return _!=null&&Xo(_,w,eh)}var Pr=G_(function(_,w,D){w!=null&&typeof w.toString!="function"&&(w=Gp.call(w)),_[w]=D},Yl(Ns)),Hr=G_(function(_,w,D){w!=null&&typeof w.toString!="function"&&(w=Gp.call(w)),Wr.call(_,w)?_[w].push(D):_[w]=[D]},kn),tr=xr(zl);function Sn(_){return ct(_)?Dg(_):yf(_)}function Wn(_){return ct(_)?Dg(_,!0):nm(_)}var gi=cd(function(_,w,D){zg(_,w,D)}),Xi=cd(function(_,w,D,Y){zg(_,w,D,Y)}),Ji=Ti(function(_,w){var D={};if(_==null)return D;var Y=!1;w=Tr(w,function(be){return be=ll(be,_),Y||(Y=be.length>1),be}),ul(_,fs(_),D),Y&&(D=qo(D,7,wi));for(var ae=w.length;ae--;)ga(D,w[ae]);return D}),_s=Ti(function(_,w){return _==null?{}:function(D,Y){return j_(D,Y,function(ae,be){return Nr(D,be)})}(_,w)});function as(_,w){if(_==null)return{};var D=Tr(fs(_),function(Y){return[Y]});return w=kn(w),j_(_,D,function(Y,ae){return w(Y,ae[0])})}var cs=dm(Sn),Qi=dm(Wn);function Di(_){return _==null?[]:oi(_,Sn(_))}var ls=sh(function(_,w,D){return w=w.toLowerCase(),_+(D?zs(w):w)});function zs(_){return qa(Pt(_).toLowerCase())}function Zi(_){return(_=Pt(_))&&_.replace(De,D_).replace(En,"")}var ba=sh(function(_,w,D){return _+(D?"-":"")+w.toLowerCase()}),ea=sh(function(_,w,D){return _+(D?" ":"")+w.toLowerCase()}),_c=am("toLowerCase"),yc=sh(function(_,w,D){return _+(D?"_":"")+w.toLowerCase()}),Ea=sh(function(_,w,D){return _+(D?" ":"")+qa(w)}),hl=sh(function(_,w,D){return _+(D?" ":"")+w.toUpperCase()}),qa=am("toUpperCase");function Nc(_,w,D){return _=Pt(_),(w=D?u:w)===u?function(Y){return Wi.test(Y)}(_)?function(Y){return Y.match(Er)||[]}(_):function(Y){return Y.match(Ue)||[]}(_):_.match(w)||[]}var fl=xr(function(_,w){try{return ha(_,u,w)}catch(D){return fr(D)?D:new qr(D)}}),Wa=Ti(function(_,w){return dr(w,function(D){D=kc(D),cl(_,D,M(_[D],_))}),_});function Yl(_){return function(){return _}}var ph=Qg(),Mu=Qg(!0);function Ns(_){return _}function Iu(_){return _f(typeof _=="function"?_:qo(_,1))}var fd=xr(function(_,w){return function(D){return zl(D,_,w)}}),pd=xr(function(_,w){return function(D){return zl(_,D,w)}});function Ou(_,w,D){var Y=Sn(w),ae=Vl(w,Y);D!=null||R(w)&&(ae.length||!Y.length)||(D=w,w=_,_=this,ae=Vl(w,Sn(w)));var be=!(R(D)&&"chain"in D&&!D.chain),ke=x(_);return dr(ae,function(ze){var ot=w[ze];_[ze]=ot,ke&&(_.prototype[ze]=function(){var Ot=this.__chain__;if(be||Ot){var At=_(this.__wrapped__);return(At.__actions__=Yo(this.__actions__)).push({func:ot,args:arguments,thisArg:_}),At.__chain__=Ot,At}return ot.apply(_,Fl([this.value()],arguments))})}),_}function Xl(){}var md=Cf(Tr),gd=Cf(Mg),iv=Cf(Og);function Em(_){return Mf(_)?Hp(kc(_)):function(w){return function(D){return hs(D,w)}}(_)}var sv=um(),ov=um(!0);function Sm(){return[]}function wm(){return!1}var X_=oh(function(_,w){return _+w},0),J_=Af("ceil"),Q_=oh(function(_,w){return _/w},1),Hy=Af("floor"),Z_,Lf=oh(function(_,w){return _*w},1),Vy=Af("round"),zy=oh(function(_,w){return _-w},0);return pe.after=function(_,w){if(typeof w!="function")throw new Ao(d);return _=ye(_),function(){if(--_<1)return w.apply(this,arguments)}},pe.ary=m,pe.assign=$n,pe.assignIn=Ln,pe.assignInWith=Or,pe.assignWith=Br,pe.at=jr,pe.before=y,pe.bind=M,pe.bindAll=Wa,pe.bindKey=L,pe.castArray=function(){if(!arguments.length)return[];var _=arguments[0];return Ge(_)?_:[_]},pe.chain=fh,pe.chunk=function(_,w,D){w=(D?eo(_,w,D):w===u)?1:ai(ye(w),0);var Y=_==null?0:_.length;if(!Y||w<1)return[];for(var ae=0,be=0,ke=nn(Kp(Y/w));ae<Y;)ke[be++]=Ko(_,ae,ae+=w);return ke},pe.compact=function(_){for(var w=-1,D=_==null?0:_.length,Y=0,ae=[];++w<D;){var be=_[w];be&&(ae[Y++]=be)}return ae},pe.concat=function(){var _=arguments.length;if(!_)return[];for(var w=nn(_-1),D=arguments[0],Y=_;Y--;)w[Y-1]=arguments[Y];return Fl(Ge(D)?Yo(D):[D],po(w,1))},pe.cond=function(_){var w=_==null?0:_.length,D=kn();return _=w?Tr(_,function(Y){if(typeof Y[1]!="function")throw new Ao(d);return[D(Y[0]),Y[1]]}):[],xr(function(Y){for(var ae=-1;++ae<w;){var be=_[ae];if(ha(be[0],this,Y))return ha(be[1],this,Y)}})},pe.conforms=function(_){return function(w){var D=Sn(w);return function(Y){return ks(Y,w,D)}}(qo(_,1))},pe.constant=Yl,pe.countBy=ya,pe.create=function(_,w){var D=Go(_);return w==null?D:pf(D,w)},pe.curry=function _(w,D,Y){var ae=fc(w,8,u,u,u,u,u,D=Y?u:D);return ae.placeholder=_.placeholder,ae},pe.curryRight=function _(w,D,Y){var ae=fc(w,p,u,u,u,u,u,D=Y?u:D);return ae.placeholder=_.placeholder,ae},pe.debounce=H,pe.defaults=$r,pe.defaultsDeep=_r,pe.defer=ee,pe.delay=xe,pe.difference=Nf,pe.differenceBy=no,pe.differenceWith=Pf,pe.drop=function(_,w,D){var Y=_==null?0:_.length;return Y?Ko(_,(w=D||w===u?1:ye(w))<0?0:w,Y):[]},pe.dropRight=function(_,w,D){var Y=_==null?0:_.length;return Y?Ko(_,0,(w=Y-(w=D||w===u?1:ye(w)))<0?0:w):[]},pe.dropRightWhile=function(_,w){return _&&_.length?Yg(_,kn(w,3),!0,!0):[]},pe.dropWhile=function(_,w){return _&&_.length?Yg(_,kn(w,3),!0):[]},pe.fill=function(_,w,D,Y){var ae=_==null?0:_.length;return ae?(D&&typeof D!="number"&&eo(_,w,D)&&(D=0,Y=ae),function(be,ke,ze,ot){var Ot=be.length;for((ze=ye(ze))<0&&(ze=-ze>Ot?0:Ot+ze),(ot=ot===u||ot>Ot?Ot:ye(ot))<0&&(ot+=Ot),ot=ze>ot?0:gt(ot);ze<ot;)be[ze++]=ke;return be}(_,w,D,Y)):[]},pe.filter=function(_,w){return(Ge(_)?Ul:mf)(_,kn(w,3))},pe.flatMap=function(_,w){return po(ym(_,w),1)},pe.flatMapDeep=function(_,w){return po(ym(_,w),C)},pe.flatMapDepth=function(_,w,D){return D=D===u?1:ye(D),po(ym(_,w),D)},pe.flatten=W_,pe.flattenDeep=function(_){return _!=null&&_.length?po(_,C):[]},pe.flattenDepth=function(_,w){return _!=null&&_.length?po(_,w=w===u?1:ye(w)):[]},pe.flip=function(_){return fc(_,512)},pe.flow=ph,pe.flowRight=Mu,pe.fromPairs=function(_){for(var w=-1,D=_==null?0:_.length,Y={};++w<D;){var ae=_[w];Y[ae[0]]=ae[1]}return Y},pe.functions=function(_){return _==null?[]:Vl(_,Sn(_))},pe.functionsIn=function(_){return _==null?[]:Vl(_,Wn(_))},pe.groupBy=K_,pe.initial=function(_){return _!=null&&_.length?Ko(_,0,-1):[]},pe.intersection=dh,pe.intersectionBy=_a,pe.intersectionWith=Jo,pe.invert=Pr,pe.invertBy=Hr,pe.invokeMap=$y,pe.iteratee=Iu,pe.keyBy=Y_,pe.keys=Sn,pe.keysIn=Wn,pe.map=ym,pe.mapKeys=function(_,w){var D={};return w=kn(w,3),Ha(_,function(Y,ae,be){cl(D,w(Y,ae,be),Y)}),D},pe.mapValues=function(_,w){var D={};return w=kn(w,3),Ha(_,function(Y,ae,be){cl(D,ae,w(Y,ae,be))}),D},pe.matches=function(_){return mo(qo(_,1))},pe.matchesProperty=function(_,w){return B_(_,qo(w,1))},pe.memoize=Ve,pe.merge=gi,pe.mergeWith=Xi,pe.method=fd,pe.methodOf=pd,pe.mixin=Ou,pe.negate=bt,pe.nthArg=function(_){return _=ye(_),xr(function(w){return Va(w,_)})},pe.omit=Ji,pe.omitBy=function(_,w){return as(_,bt(kn(w)))},pe.once=function(_){return y(2,_)},pe.orderBy=function(_,w,D,Y){return _==null?[]:(Ge(w)||(w=w==null?[]:[w]),Ge(D=Y?u:D)||(D=D==null?[]:[D]),Wo(_,w,D))},pe.over=md,pe.overArgs=Wt,pe.overEvery=gd,pe.overSome=iv,pe.partial=fn,pe.partialRight=mr,pe.partition=rv,pe.pick=_s,pe.pickBy=as,pe.property=Em,pe.propertyOf=function(_){return function(w){return _==null?u:hs(_,w)}},pe.pull=tv,pe.pullAll=hd,pe.pullAllBy=function(_,w,D){return _&&_.length&&w&&w.length?Gg(_,w,kn(D,2)):_},pe.pullAllWith=function(_,w,D){return _&&_.length&&w&&w.length?Gg(_,w,u,D):_},pe.pullAt=Au,pe.range=sv,pe.rangeRight=ov,pe.rearg=gn,pe.reject=function(_,w){return(Ge(_)?Ul:mf)(_,bt(kn(w,3)))},pe.remove=function(_,w){var D=[];if(!_||!_.length)return D;var Y=-1,ae=[],be=_.length;for(w=kn(w,3);++Y<be;){var ke=_[Y];w(ke,Y,_)&&(D.push(ke),ae.push(Y))}return $_(_,ae),D},pe.rest=function(_,w){if(typeof _!="function")throw new Ao(d);return xr(_,w=w===u?w:ye(w))},pe.reverse=Ir,pe.sampleSize=function(_,w,D){return w=(D?eo(_,w,D):w===u)?1:ye(w),(Ge(_)?Lg:H_)(_,w)},pe.set=function(_,w,D){return _==null?_:bf(_,w,D)},pe.setWith=function(_,w,D,Y){return Y=typeof Y=="function"?Y:u,_==null?_:bf(_,w,D,Y)},pe.shuffle=function(_){return(Ge(_)?Qd:Gl)(_)},pe.slice=function(_,w,D){var Y=_==null?0:_.length;return Y?(D&&typeof D!="number"&&eo(_,w,D)?(w=0,D=Y):(w=w==null?0:ye(w),D=D===u?Y:ye(D)),Ko(_,w,D)):[]},pe.sortBy=hS,pe.sortedUniq=function(_){return _&&_.length?sm(_):[]},pe.sortedUniqBy=function(_,w){return _&&_.length?sm(_,kn(w,2)):[]},pe.split=function(_,w,D){return D&&typeof D!="number"&&eo(_,w,D)&&(w=D=u),(D=D===u?I:D>>>0)?(_=Pt(_))&&(typeof w=="string"||w!=null&&!te(w))&&!(w=ma(w))&&vu(_)?Io(Ms(_),0,D):_.split(w,D):[]},pe.spread=function(_,w){if(typeof _!="function")throw new Ao(d);return w=w==null?0:ai(ye(w),0),xr(function(D){var Y=D[w],ae=Io(D,0,w);return Y&&Fl(ae,Y),ha(_,this,ae)})},pe.tail=function(_){var w=_==null?0:_.length;return w?Ko(_,1,w):[]},pe.take=function(_,w,D){return _&&_.length?Ko(_,0,(w=D||w===u?1:ye(w))<0?0:w):[]},pe.takeRight=function(_,w,D){var Y=_==null?0:_.length;return Y?Ko(_,(w=Y-(w=D||w===u?1:ye(w)))<0?0:w,Y):[]},pe.takeRightWhile=function(_,w){return _&&_.length?Yg(_,kn(w,3),!1,!0):[]},pe.takeWhile=function(_,w){return _&&_.length?Yg(_,kn(w,3)):[]},pe.tap=function(_,w){return w(_),_},pe.throttle=function(_,w,D){var Y=!0,ae=!0;if(typeof _!="function")throw new Ao(d);return R(D)&&(Y="leading"in D?!!D.leading:Y,ae="trailing"in D?!!D.trailing:ae),H(_,w,{leading:Y,maxWait:w,trailing:ae})},pe.thru=Qo,pe.toArray=$e,pe.toPairs=cs,pe.toPairsIn=Qi,pe.toPath=function(_){return Ge(_)?Tr(_,kc):ce(_)?[_]:Yo(gm(Pt(_)))},pe.toPlainObject=en,pe.transform=function(_,w,D){var Y=Ge(_),ae=Y||yn(_)||de(_);if(w=kn(w,4),D==null){var be=_&&_.constructor;D=ae?Y?new be:[]:R(_)&&x(be)?Go(uf(_)):{}}return(ae?dr:Ha)(_,function(ke,ze,ot){return w(D,ke,ze,ot)}),D},pe.unary=function(_){return m(_,1)},pe.union=Fy,pe.unionBy=Ga,pe.unionWith=uS,pe.uniq=function(_){return _&&_.length?Tu(_):[]},pe.uniqBy=function(_,w){return _&&_.length?Tu(_,kn(w,2)):[]},pe.uniqWith=function(_,w){return w=typeof w=="function"?w:u,_&&_.length?Tu(_,u,w):[]},pe.unset=function(_,w){return _==null||ga(_,w)},pe.unzip=hh,pe.unzipWith=Df,pe.update=function(_,w,D){return _==null?_:Ly(_,w,nh(D))},pe.updateWith=function(_,w,D,Y){return Y=typeof Y=="function"?Y:u,_==null?_:Ly(_,w,nh(D),Y)},pe.values=Di,pe.valuesIn=function(_){return _==null?[]:oi(_,Wn(_))},pe.without=vm,pe.words=Nc,pe.wrap=function(_,w){return fn(nh(w),_)},pe.xor=By,pe.xorBy=jy,pe.xorWith=dS,pe.zip=vs,pe.zipObject=function(_,w){return om(_||[],w||[],bu)},pe.zipObjectDeep=function(_,w){return om(_||[],w||[],bf)},pe.zipWith=vc,pe.entries=cs,pe.entriesIn=Qi,pe.extend=Ln,pe.extendWith=Or,Ou(pe,pe),pe.add=X_,pe.attempt=fl,pe.camelCase=ls,pe.capitalize=zs,pe.ceil=J_,pe.clamp=function(_,w,D){return D===u&&(D=w,w=u),D!==u&&(D=(D=Bt(D))==D?D:0),w!==u&&(w=(w=Bt(w))==w?w:0),Eu(Bt(_),w,D)},pe.clone=function(_){return qo(_,4)},pe.cloneDeep=function(_){return qo(_,5)},pe.cloneDeepWith=function(_,w){return qo(_,5,w=typeof w=="function"?w:u)},pe.cloneWith=function(_,w){return qo(_,4,w=typeof w=="function"?w:u)},pe.conformsTo=function(_,w){return w==null||ks(_,w,Sn(w))},pe.deburr=Zi,pe.defaultTo=function(_,w){return _==null||_!=_?w:_},pe.divide=Q_,pe.endsWith=function(_,w,D){_=Pt(_),w=ma(w);var Y=_.length,ae=D=D===u?Y:Eu(ye(D),0,Y);return(D-=w.length)>=0&&_.slice(D,ae)==w},pe.eq=er,pe.escape=function(_){return(_=Pt(_))&&Ee.test(_)?_.replace(Tt,lf):_},pe.escapeRegExp=function(_){return(_=Pt(_))&&Dt.test(_)?_.replace(St,"\\$&"):_},pe.every=function(_,w,D){var Y=Ge(_)?Mg:Dy;return D&&eo(_,w,D)&&(w=u),Y(_,kn(w,3))},pe.find=Vi,pe.findIndex=Hi,pe.findKey=function(_,w){return Qc(_,kn(w,3),Ha)},pe.findLast=Oo,pe.findLastIndex=dl,pe.findLastKey=function(_,w){return Qc(_,kn(w,3),F_)},pe.floor=Hy,pe.forEach=_m,pe.forEachRight=nv,pe.forIn=function(_,w){return _==null?_:jg(_,kn(w,3),Wn)},pe.forInRight=function(_,w){return _==null?_:$g(_,kn(w,3),Wn)},pe.forOwn=function(_,w){return _&&Ha(_,kn(w,3))},pe.forOwnRight=function(_,w){return _&&F_(_,kn(w,3))},pe.get=kr,pe.gt=bn,pe.gte=Zo,pe.has=function(_,w){return _!=null&&Xo(_,w,gf)},pe.hasIn=Nr,pe.head=dd,pe.identity=Ns,pe.includes=function(_,w,D,Y){_=ct(_)?_:Di(_),D=D&&!Y?ye(D):0;var ae=_.length;return D<0&&(D=ai(ae+D,0)),re(_)?D<=ae&&_.indexOf(w,D)>-1:!!ae&&cf(_,w,D)>-1},pe.indexOf=function(_,w,D){var Y=_==null?0:_.length;if(!Y)return-1;var ae=D==null?0:ye(D);return ae<0&&(ae=ai(Y+ae,0)),cf(_,w,ae)},pe.inRange=function(_,w,D){return w=Re(w),D===u?(D=w,w=0):D=Re(D),function(Y,ae,be){return Y>=ds(ae,be)&&Y<ai(ae,be)}(_=Bt(_),w,D)},pe.invoke=tr,pe.isArguments=Rr,pe.isArray=Ge,pe.isArrayBuffer=Je,pe.isArrayLike=ct,pe.isArrayLikeObject=Vt,pe.isBoolean=function(_){return _===!0||_===!1||O(_)&&Hs(_)==$},pe.isBuffer=yn,pe.isDate=hr,pe.isElement=function(_){return O(_)&&_.nodeType===1&&!J(_)},pe.isEmpty=function(_){if(_==null)return!0;if(ct(_)&&(Ge(_)||typeof _=="string"||typeof _.splice=="function"||yn(_)||de(_)||Rr(_)))return!_.length;var w=os(_);if(w==ne||w==se)return!_.size;if(Oc(_))return!yf(_).length;for(var D in _)if(Wr.call(_,D))return!1;return!0},pe.isEqual=function(_,w){return Mo(_,w)},pe.isEqualWith=function(_,w,D){var Y=(D=typeof D=="function"?D:u)?D(_,w):u;return Y===u?Mo(_,w,u,D):!!Y},pe.isError=fr,pe.isFinite=function(_){return typeof _=="number"&&Js(_)},pe.isFunction=x,pe.isInteger=b,pe.isLength=S,pe.isMap=P,pe.isMatch=function(_,w){return _===w||Vg(_,w,In(w))},pe.isMatchWith=function(_,w,D){return D=typeof D=="function"?D:u,Vg(_,w,In(w),D)},pe.isNaN=function(_){return B(_)&&_!=+_},pe.isNative=function(_){if(ev(_))throw new qr("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return vf(_)},pe.isNil=function(_){return _==null},pe.isNull=function(_){return _===null},pe.isNumber=B,pe.isObject=R,pe.isObjectLike=O,pe.isPlainObject=J,pe.isRegExp=te,pe.isSafeInteger=function(_){return b(_)&&_>=-9007199254740991&&_<=A},pe.isSet=z,pe.isString=re,pe.isSymbol=ce,pe.isTypedArray=de,pe.isUndefined=function(_){return _===u},pe.isWeakMap=function(_){return O(_)&&os(_)==Be},pe.isWeakSet=function(_){return O(_)&&Hs(_)=="[object WeakSet]"},pe.join=function(_,w){return _==null?"":df.call(_,w)},pe.kebabCase=ba,pe.last=go,pe.lastIndexOf=function(_,w,D){var Y=_==null?0:_.length;if(!Y)return-1;var ae=Y;return D!==u&&(ae=(ae=ye(D))<0?ai(Y+ae,0):ds(ae,Y-1)),w==w?function(be,ke,ze){for(var ot=ze+1;ot--;)if(be[ot]===ke)return ot;return ot}(_,w,ae):kg(_,jl,ae,!0)},pe.lowerCase=ea,pe.lowerFirst=_c,pe.lt=Me,pe.lte=Qe,pe.max=function(_){return _&&_.length?em(_,Ns,Mi):u},pe.maxBy=function(_,w){return _&&_.length?em(_,kn(w,2),Mi):u},pe.mean=function(_){return $p(_,Ns)},pe.meanBy=function(_,w){return $p(_,kn(w,2))},pe.min=function(_){return _&&_.length?em(_,Ns,rm):u},pe.minBy=function(_,w){return _&&_.length?em(_,kn(w,2),rm):u},pe.stubArray=Sm,pe.stubFalse=wm,pe.stubObject=function(){return{}},pe.stubString=function(){return""},pe.stubTrue=function(){return!0},pe.multiply=Lf,pe.nth=function(_,w){return _&&_.length?Va(_,ye(w)):u},pe.noConflict=function(){return vn._===this&&(vn._=L_),this},pe.noop=Xl,pe.now=bm,pe.pad=function(_,w,D){_=Pt(_);var Y=(w=ye(w))?As(_):0;if(!w||Y>=w)return _;var ae=(w-Y)/2;return ah(uo(ae),D)+_+ah(Kp(ae),D)},pe.padEnd=function(_,w,D){_=Pt(_);var Y=(w=ye(w))?As(_):0;return w&&Y<w?_+ah(w-Y,D):_},pe.padStart=function(_,w,D){_=Pt(_);var Y=(w=ye(w))?As(_):0;return w&&Y<w?ah(w-Y,D)+_:_},pe.parseInt=function(_,w,D){return D||w==null?w=0:w&&(w=+w),uc(Pt(_).replace(oe,""),w||0)},pe.random=function(_,w,D){if(D&&typeof D!="boolean"&&eo(_,w,D)&&(w=D=u),D===u&&(typeof w=="boolean"?(D=w,w=u):typeof _=="boolean"&&(D=_,_=u)),_===u&&w===u?(_=0,w=1):(_=Re(_),w===u?(w=_,_=0):w=Re(w)),_>w){var Y=_;_=w,w=Y}if(D||_%1||w%1){var ae=ho();return ds(_+ae*(w-_+Si("1e-"+((ae+"").length-1))),w)}return qg(_,w)},pe.reduce=function(_,w,D){var Y=Ge(_)?N_:Oy,ae=arguments.length<3;return Y(_,kn(w,4),D,ae,sd)},pe.reduceRight=function(_,w,D){var Y=Ge(_)?Ig:Oy,ae=arguments.length<3;return Y(_,kn(w,4),D,ae,Zp)},pe.repeat=function(_,w,D){return w=(D?eo(_,w,D):w===u)?1:ye(w),Wg(Pt(_),w)},pe.replace=function(){var _=arguments,w=Pt(_[0]);return _.length<3?w:w.replace(_[1],_[2])},pe.result=function(_,w,D){var Y=-1,ae=(w=ll(w,_)).length;for(ae||(ae=1,_=u);++Y<ae;){var be=_==null?u:_[kc(w[Y])];be===u&&(Y=ae,be=D),_=x(be)?be.call(_):be}return _},pe.round=Vy,pe.runInContext=st,pe.sample=function(_){return(Ge(_)?al:im)(_)},pe.size=function(_){if(_==null)return 0;if(ct(_))return re(_)?As(_):_.length;var w=os(_);return w==ne||w==se?_.size:yf(_).length},pe.snakeCase=yc,pe.some=function(_,w,D){var Y=Ge(_)?Og:ql;return D&&eo(_,w,D)&&(w=u),Y(_,kn(w,3))},pe.sortedIndex=function(_,w){return ad(_,w)},pe.sortedIndexBy=function(_,w,D){return Kg(_,w,kn(D,2))},pe.sortedIndexOf=function(_,w){var D=_==null?0:_.length;if(D){var Y=ad(_,w);if(Y<D&&er(_[Y],w))return Y}return-1},pe.sortedLastIndex=function(_,w){return ad(_,w,!0)},pe.sortedLastIndexBy=function(_,w,D){return Kg(_,w,kn(D,2),!0)},pe.sortedLastIndexOf=function(_,w){if(_!=null&&_.length){var D=ad(_,w,!0)-1;if(er(_[D],w))return D}return-1},pe.startCase=Ea,pe.startsWith=function(_,w,D){return _=Pt(_),D=D==null?0:Eu(ye(D),0,_.length),w=ma(w),_.slice(D,D+w.length)==w},pe.subtract=zy,pe.sum=function(_){return _&&_.length?oc(_,Ns):0},pe.sumBy=function(_,w){return _&&_.length?oc(_,kn(w,2)):0},pe.template=function(_,w,D){var Y=pe.templateSettings;D&&eo(_,w,D)&&(w=u),_=Pt(_),w=Or({},w,Y,pc);var ae,be,ke=Or({},w.imports,Y.imports,pc),ze=Sn(ke),ot=oi(ke,ze),Ot=0,At=w.interpolate||tt,qt="__p += '",An=Wd((w.escape||tt).source+"|"+At.source+"|"+(At===it?Dn:tt).source+"|"+(w.evaluate||tt).source+"|$","g"),Nn="//# sourceURL="+(Wr.call(w,"sourceURL")?(w.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Fs+"]")+`
`;_.replace(An,function(Xt,ir,an,Vr,wr,Li){return an||(an=Vr),qt+=_.slice(Ot,Li).replace(Et,ky),ir&&(ae=!0,qt+=`' +
__e(`+ir+`) +
'`),wr&&(be=!0,qt+=`';
`+wr+`;
__p += '`),an&&(qt+=`' +
((__t = (`+an+`)) == null ? '' : __t) +
'`),Ot=Li+Xt.length,Xt}),qt+=`';
`;var Xn=Wr.call(w,"variable")&&w.variable;if(Xn){if(dt.test(Xn))throw new qr("Invalid `variable` option passed into `_.template`")}else qt=`with (obj) {
`+qt+`
}
`;qt=(be?qt.replace(ut,""):qt).replace(He,"$1").replace(Rt,"$1;"),qt="function("+(Xn||"obj")+`) {
`+(Xn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ae?", __e = _.escape":"")+(be?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+qt+`return __p
}`;var kt=fl(function(){return Bs(ze,Nn+"return "+qt).apply(u,ot)});if(kt.source=qt,fr(kt))throw kt;return kt},pe.times=function(_,w){if((_=ye(_))<1||_>A)return[];var D=I,Y=ds(_,I);w=kn(w),_-=I;for(var ae=P_(Y,w);++D<_;)w(D);return ae},pe.toFinite=Re,pe.toInteger=ye,pe.toLength=gt,pe.toLower=function(_){return Pt(_).toLowerCase()},pe.toNumber=Bt,pe.toSafeInteger=function(_){return _?Eu(ye(_),-9007199254740991,A):_===0?_:0},pe.toString=Pt,pe.toUpper=function(_){return Pt(_).toUpperCase()},pe.trim=function(_,w,D){if((_=Pt(_))&&(D||w===u))return Vp(_);if(!_||!(w=ma(w)))return _;var Y=Ms(_),ae=Ms(w);return Io(Y,zp(Y,ae),$l(Y,ae)+1).join("")},pe.trimEnd=function(_,w,D){if((_=Pt(_))&&(D||w===u))return _.slice(0,el(_)+1);if(!_||!(w=ma(w)))return _;var Y=Ms(_);return Io(Y,0,$l(Y,Ms(w))+1).join("")},pe.trimStart=function(_,w,D){if((_=Pt(_))&&(D||w===u))return _.replace(oe,"");if(!_||!(w=ma(w)))return _;var Y=Ms(_);return Io(Y,zp(Y,Ms(w))).join("")},pe.truncate=function(_,w){var D=30,Y="...";if(R(w)){var ae="separator"in w?w.separator:ae;D="length"in w?ye(w.length):D,Y="omission"in w?ma(w.omission):Y}var be=(_=Pt(_)).length;if(vu(_)){var ke=Ms(_);be=ke.length}if(D>=be)return _;var ze=D-As(Y);if(ze<1)return Y;var ot=ke?Io(ke,0,ze).join(""):_.slice(0,ze);if(ae===u)return ot+Y;if(ke&&(ze+=ot.length-ze),te(ae)){if(_.slice(ze).search(ae)){var Ot,At=ot;for(ae.global||(ae=Wd(ae.source,Pt(Le.exec(ae))+"g")),ae.lastIndex=0;Ot=ae.exec(At);)var qt=Ot.index;ot=ot.slice(0,qt===u?ze:qt)}}else if(_.indexOf(ma(ae),ze)!=ze){var An=ot.lastIndexOf(ae);An>-1&&(ot=ot.slice(0,An))}return ot+Y},pe.unescape=function(_){return(_=Pt(_))&&Ft.test(_)?_.replace($t,fa):_},pe.uniqueId=function(_){var w=++Ac;return Pt(_)+w},pe.upperCase=hl,pe.upperFirst=qa,pe.each=_m,pe.eachRight=nv,pe.first=dd,Ou(pe,(Z_={},Ha(pe,function(_,w){Wr.call(pe.prototype,w)||(Z_[w]=_)}),Z_),{chain:!1}),pe.VERSION="4.17.21",dr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(_){pe[_].placeholder=pe}),dr(["drop","take"],function(_,w){Mr.prototype[_]=function(D){D=D===u?1:ai(ye(D),0);var Y=this.__filtered__&&!w?new Mr(this):this.clone();return Y.__filtered__?Y.__takeCount__=ds(D,Y.__takeCount__):Y.__views__.push({size:ds(D,I),type:_+(Y.__dir__<0?"Right":"")}),Y},Mr.prototype[_+"Right"]=function(D){return this.reverse()[_](D).reverse()}}),dr(["filter","map","takeWhile"],function(_,w){var D=w+1,Y=D==1||D==3;Mr.prototype[_]=function(ae){var be=this.clone();return be.__iteratees__.push({iteratee:kn(ae,3),type:D}),be.__filtered__=be.__filtered__||Y,be}}),dr(["head","last"],function(_,w){var D="take"+(w?"Right":"");Mr.prototype[_]=function(){return this[D](1).value()[0]}}),dr(["initial","tail"],function(_,w){var D="drop"+(w?"":"Right");Mr.prototype[_]=function(){return this.__filtered__?new Mr(this):this[D](1)}}),Mr.prototype.compact=function(){return this.filter(Ns)},Mr.prototype.find=function(_){return this.filter(_).head()},Mr.prototype.findLast=function(_){return this.reverse().find(_)},Mr.prototype.invokeMap=xr(function(_,w){return typeof _=="function"?new Mr(this):this.map(function(D){return zl(D,_,w)})}),Mr.prototype.reject=function(_){return this.filter(bt(kn(_)))},Mr.prototype.slice=function(_,w){_=ye(_);var D=this;return D.__filtered__&&(_>0||w<0)?new Mr(D):(_<0?D=D.takeRight(-_):_&&(D=D.drop(_)),w!==u&&(D=(w=ye(w))<0?D.dropRight(-w):D.take(w-_)),D)},Mr.prototype.takeRightWhile=function(_){return this.reverse().takeWhile(_).reverse()},Mr.prototype.toArray=function(){return this.take(I)},Ha(Mr.prototype,function(_,w){var D=/^(?:filter|find|map|reject)|While$/.test(w),Y=/^(?:head|last)$/.test(w),ae=pe[Y?"take"+(w=="last"?"Right":""):w],be=Y||/^find/.test(w);ae&&(pe.prototype[w]=function(){var ke=this.__wrapped__,ze=Y?[1]:arguments,ot=ke instanceof Mr,Ot=ze[0],At=ot||Ge(ke),qt=function(ir){var an=ae.apply(pe,Fl([ir],ze));return Y&&An?an[0]:an};At&&D&&typeof Ot=="function"&&Ot.length!=1&&(ot=At=!1);var An=this.__chain__,Nn=!!this.__actions__.length,Xn=be&&!An,kt=ot&&!Nn;if(!be&&At){ke=kt?ke:new Mr(this);var Xt=_.apply(ke,ze);return Xt.__actions__.push({func:Qo,args:[qt],thisArg:u}),new $s(Xt,An)}return Xn&&kt?_.apply(this,ze):(Xt=this.thru(qt),Xn?Y?Xt.value()[0]:Xt.value():Xt)})}),dr(["pop","push","shift","sort","splice","unshift"],function(_){var w=Yd[_],D=/^(?:push|sort|unshift)$/.test(_)?"tap":"thru",Y=/^(?:pop|shift)$/.test(_);pe.prototype[_]=function(){var ae=arguments;if(Y&&!this.__chain__){var be=this.value();return w.apply(Ge(be)?be:[],ae)}return this[D](function(ke){return w.apply(Ge(ke)?ke:[],ae)})}}),Ha(Mr.prototype,function(_,w){var D=pe[w];if(D){var Y=D.name+"";Wr.call(ss,Y)||(ss[Y]=[]),ss[Y].push({name:w,func:D})}}),ss[lm(u,2).name]=[{name:"wrapper",func:u}],Mr.prototype.clone=function(){var _=new Mr(this.__wrapped__);return _.__actions__=Yo(this.__actions__),_.__dir__=this.__dir__,_.__filtered__=this.__filtered__,_.__iteratees__=Yo(this.__iteratees__),_.__takeCount__=this.__takeCount__,_.__views__=Yo(this.__views__),_},Mr.prototype.reverse=function(){if(this.__filtered__){var _=new Mr(this);_.__dir__=-1,_.__filtered__=!0}else(_=this.clone()).__dir__*=-1;return _},Mr.prototype.value=function(){var _=this.__wrapped__.value(),w=this.__dir__,D=Ge(_),Y=w<0,ae=D?_.length:0,be=function(Li,jn,sr){for(var Sa=-1,ko=sr.length;++Sa<ko;){var pl=sr[Sa],Ps=pl.size;switch(pl.type){case"drop":Li+=Ps;break;case"dropRight":jn-=Ps;break;case"take":jn=ds(jn,Li+Ps);break;case"takeRight":Li=ai(Li,jn-Ps)}}return{start:Li,end:jn}}(0,ae,this.__views__),ke=be.start,ze=be.end,ot=ze-ke,Ot=Y?ze:ke-1,At=this.__iteratees__,qt=At.length,An=0,Nn=ds(ot,this.__takeCount__);if(!D||!Y&&ae==ot&&Nn==ot)return th(_,this.__actions__);var Xn=[];e:for(;ot--&&An<Nn;){for(var kt=-1,Xt=_[Ot+=w];++kt<qt;){var ir=At[kt],an=ir.iteratee,Vr=ir.type,wr=an(Xt);if(Vr==2)Xt=wr;else if(!wr){if(Vr==1)continue e;break e}}Xn[An++]=Xt}return Xn},pe.prototype.at=Kl,pe.prototype.chain=function(){return fh(this)},pe.prototype.commit=function(){return new $s(this.value(),this.__chain__)},pe.prototype.next=function(){this.__values__===u&&(this.__values__=$e(this.value()));var _=this.__index__>=this.__values__.length;return{done:_,value:_?u:this.__values__[this.__index__++]}},pe.prototype.plant=function(_){for(var w,D=this;D instanceof $a;){var Y=Ru(D);Y.__index__=0,Y.__values__=u,w?ae.__wrapped__=Y:w=Y;var ae=Y;D=D.__wrapped__}return ae.__wrapped__=_,w},pe.prototype.reverse=function(){var _=this.__wrapped__;if(_ instanceof Mr){var w=_;return this.__actions__.length&&(w=new Mr(this)),(w=w.reverse()).__actions__.push({func:Qo,args:[Ir],thisArg:u}),new $s(w,this.__chain__)}return this.thru(Ir)},pe.prototype.toJSON=pe.prototype.valueOf=pe.prototype.value=function(){return th(this.__wrapped__,this.__actions__)},pe.prototype.first=pe.prototype.head,nl&&(pe.prototype[nl]=function(){return this}),pe}();vn._=ed,(l=(function(){return ed}).call(a,c,a,o))===u||(o.exports=l)}).call(this)},2492:(o,a,c)=>{var l=c(2980),u=c(1463)(function(d,h,f){l(d,h,f)});o.exports=u},5062:o=>{o.exports=function(){return!1}},9881:(o,a,c)=>{var l=c(8363),u=c(1704);o.exports=function(d){return l(d,u(d))}},6692:o=>{var a=o.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var l="candidate:%s %d %s %d %s %d typ %s";return l+=c.raddr!=null?" raddr %s rport %d":"%v%v",l+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(l+=" generation %d"),l+=c["network-id"]!=null?" network-id %d":"%v",l+=c["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var l="ssrc:%d";return c.attribute!=null&&(l+=" %s",c.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var l="mediaclk:";return l+=c.id!=null?"id=%s %s":"%v%s",l+=c.mediaClockValue!=null?"=%s":"",l+=c.rateNumerator!=null?" rate=%s":"",l+=c.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(a).forEach(function(c){a[c].forEach(function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")})})},766:(o,a,c)=>{var l=c(962),u=c(8627);a.cW=u,a.Qc=l.parse,a.rz=l.parseParams,l.parseFmtpConfig,l.parsePayloads,l.parseRemoteCandidates,l.parseImageAttributes,l.parseSimulcastStreamList},962:(o,a,c)=>{var l=function(p){return String(Number(p))===p?Number(p):p},u=function(p,g,v){var E=p.name&&p.names;p.push&&!g[p.push]?g[p.push]=[]:E&&!g[p.name]&&(g[p.name]={});var T=p.push?{}:E?g[p.name]:g;(function(C,A,k,I){if(I&&!k)A[I]=l(C[1]);else for(var N=0;N<k.length;N+=1)C[N+1]!=null&&(A[k[N]]=l(C[N+1]))})(v.match(p.reg),T,p.names,p.name),p.push&&g[p.push].push(T)},d=c(6692),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(p){var g={},v=[],E=g;return p.split(/(\r\n|\r|\n)/).filter(h).forEach(function(T){var C=T[0],A=T.slice(2);C==="m"&&(v.push({rtp:[],fmtp:[]}),E=v[v.length-1]);for(var k=0;k<(d[C]||[]).length;k+=1){var I=d[C][k];if(I.reg.test(A))return u(I,E,A)}}),g.media=v,g};var f=function(p,g){var v=g.split(/=(.+)/,2);return v.length===2?p[v[0]]=l(v[1]):v.length===1&&g.length>1&&(p[v[0]]=void 0),p};a.parseParams=function(p){return p.split(/;\s?/).reduce(f,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(p){return p.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(p){for(var g=[],v=p.split(" ").map(l),E=0;E<v.length;E+=3)g.push({component:v[E],ip:v[E+1],port:v[E+2]});return g},a.parseImageAttributes=function(p){return p.split(" ").map(function(g){return g.substring(1,g.length-1).split(",").reduce(f,{})})},a.parseSimulcastStreamList=function(p){return p.split(";").map(function(g){return g.split(",").map(function(v){var E,T=!1;return v[0]!=="~"?E=l(v):(E=l(v.substring(1,v.length)),T=!0),{scid:E,paused:T}})})}},8627:(o,a,c)=>{var l=c(6692),u=/%[sdv%]/g,d=function(g){var v=1,E=arguments,T=E.length;return g.replace(u,function(C){if(v>=T)return C;var A=E[v];switch(v+=1,C){case"%%":return"%";case"%s":return String(A);case"%d":return Number(A);case"%v":return""}})},h=function(g,v,E){var T=[g+"="+(v.format instanceof Function?v.format(v.push?E:E[v.name]):v.format)];if(v.names)for(var C=0;C<v.names.length;C+=1){var A=v.names[C];v.name?T.push(E[v.name][A]):T.push(E[v.names[C]])}else T.push(E[v.name]);return d.apply(null,T)},f=["v","o","s","i","u","e","p","c","b","t","r","z","a"],p=["i","c","b","a"];o.exports=function(g,v){v=v||{},g.version==null&&(g.version=0),g.name==null&&(g.name=" "),g.media.forEach(function(A){A.payloads==null&&(A.payloads="")});var E=v.outerOrder||f,T=v.innerOrder||p,C=[];return E.forEach(function(A){l[A].forEach(function(k){k.name in g&&g[k.name]!=null?C.push(h(A,k,g)):k.push in g&&g[k.push]!=null&&g[k.push].forEach(function(I){C.push(h(A,k,I))})})}),g.media.forEach(function(A){C.push(h("m",l.m[0],A)),T.forEach(function(k){l[k].forEach(function(I){I.name in A&&A[I.name]!=null?C.push(h(k,I,A)):I.push in A&&A[I.push]!=null&&A[I.push].forEach(function(N){C.push(h(k,I,N))})})})}),C.join(`\r
`)+`\r
`}},7539:o=>{const a={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};a.localCName=a.generateIdentifier(),a.splitLines=function(c){return c.trim().split(`
`).map(l=>l.trim())},a.splitSections=function(c){return c.split(`
m=`).map((l,u)=>(u>0?"m="+l:l).trim()+`\r
`)},a.getDescription=function(c){const l=a.splitSections(c);return l&&l[0]},a.getMediaSections=function(c){const l=a.splitSections(c);return l.shift(),l},a.matchPrefix=function(c,l){return a.splitLines(c).filter(u=>u.indexOf(l)===0)},a.parseCandidate=function(c){let l;l=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" ");const u={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let d=8;d<l.length;d+=2)switch(l[d]){case"raddr":u.relatedAddress=l[d+1];break;case"rport":u.relatedPort=parseInt(l[d+1],10);break;case"tcptype":u.tcpType=l[d+1];break;case"ufrag":u.ufrag=l[d+1],u.usernameFragment=l[d+1];break;default:u[l[d]]===void 0&&(u[l[d]]=l[d+1])}return u},a.writeCandidate=function(c){const l=[];l.push(c.foundation);const u=c.component;u==="rtp"?l.push(1):u==="rtcp"?l.push(2):l.push(u),l.push(c.protocol.toUpperCase()),l.push(c.priority),l.push(c.address||c.ip),l.push(c.port);const d=c.type;return l.push("typ"),l.push(d),d!=="host"&&c.relatedAddress&&c.relatedPort&&(l.push("raddr"),l.push(c.relatedAddress),l.push("rport"),l.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(l.push("ufrag"),l.push(c.usernameFragment||c.ufrag)),"candidate:"+l.join(" ")},a.parseIceOptions=function(c){return c.substring(14).split(" ")},a.parseRtpMap=function(c){let l=c.substring(9).split(" ");const u={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),u.name=l[0],u.clockRate=parseInt(l[1],10),u.channels=l.length===3?parseInt(l[2],10):1,u.numChannels=u.channels,u},a.writeRtpMap=function(c){let l=c.payloadType;c.preferredPayloadType!==void 0&&(l=c.preferredPayloadType);const u=c.channels||c.numChannels||1;return"a=rtpmap:"+l+" "+c.name+"/"+c.clockRate+(u!==1?"/"+u:"")+`\r
`},a.parseExtmap=function(c){const l=c.substring(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1],attributes:l.slice(2).join(" ")}},a.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+(c.attributes?" "+c.attributes:"")+`\r
`},a.parseFmtp=function(c){const l={};let u;const d=c.substring(c.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)u=d[h].trim().split("="),l[u[0].trim()]=u[1];return l},a.writeFmtp=function(c){let l="",u=c.payloadType;if(c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){const d=[];Object.keys(c.parameters).forEach(h=>{c.parameters[h]!==void 0?d.push(h+"="+c.parameters[h]):d.push(h)}),l+="a=fmtp:"+u+" "+d.join(";")+`\r
`}return l},a.parseRtcpFb=function(c){const l=c.substring(c.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},a.writeRtcpFb=function(c){let l="",u=c.payloadType;return c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach(d=>{l+="a=rtcp-fb:"+u+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),l},a.parseSsrcMedia=function(c){const l=c.indexOf(" "),u={ssrc:parseInt(c.substring(7,l),10)},d=c.indexOf(":",l);return d>-1?(u.attribute=c.substring(l+1,d),u.value=c.substring(d+1)):u.attribute=c.substring(l+1),u},a.parseSsrcGroup=function(c){const l=c.substring(13).split(" ");return{semantics:l.shift(),ssrcs:l.map(u=>parseInt(u,10))}},a.getMid=function(c){const l=a.matchPrefix(c,"a=mid:")[0];if(l)return l.substring(6)},a.parseFingerprint=function(c){const l=c.substring(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},a.getDtlsParameters=function(c,l){return{role:"auto",fingerprints:a.matchPrefix(c+l,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(c,l){let u="a=setup:"+l+`\r
`;return c.fingerprints.forEach(d=>{u+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),u},a.parseCryptoLine=function(c){const l=c.substring(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},a.writeCryptoLine=function(c){return"a=crypto:"+c.tag+" "+c.cryptoSuite+" "+(typeof c.keyParams=="object"?a.writeCryptoKeyParams(c.keyParams):c.keyParams)+(c.sessionParams?" "+c.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(c){if(c.indexOf("inline:")!==0)return null;const l=c.substring(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(c){return c.keyMethod+":"+c.keySalt+(c.lifeTime?"|"+c.lifeTime:"")+(c.mkiValue&&c.mkiLength?"|"+c.mkiValue+":"+c.mkiLength:"")},a.getCryptoParameters=function(c,l){return a.matchPrefix(c+l,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(c,l){const u=a.matchPrefix(c+l,"a=ice-ufrag:")[0],d=a.matchPrefix(c+l,"a=ice-pwd:")[0];return u&&d?{usernameFragment:u.substring(12),password:d.substring(10)}:null},a.writeIceParameters=function(c){let l="a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`;return c.iceLite&&(l+=`a=ice-lite\r
`),l},a.parseRtpParameters=function(c){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=a.splitLines(c)[0].split(" ");l.profile=u[2];for(let h=3;h<u.length;h++){const f=u[h],p=a.matchPrefix(c,"a=rtpmap:"+f+" ")[0];if(p){const g=a.parseRtpMap(p),v=a.matchPrefix(c,"a=fmtp:"+f+" ");switch(g.parameters=v.length?a.parseFmtp(v[0]):{},g.rtcpFeedback=a.matchPrefix(c,"a=rtcp-fb:"+f+" ").map(a.parseRtcpFb),l.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(g.name.toUpperCase())}}}a.matchPrefix(c,"a=extmap:").forEach(h=>{l.headerExtensions.push(a.parseExtmap(h))});const d=a.matchPrefix(c,"a=rtcp-fb:* ").map(a.parseRtcpFb);return l.codecs.forEach(h=>{d.forEach(f=>{h.rtcpFeedback.find(p=>p.type===f.type&&p.parameter===f.parameter)||h.rtcpFeedback.push(f)})}),l},a.writeRtpDescription=function(c,l){let u="";u+="m="+c+" ",u+=l.codecs.length>0?"9":"0",u+=" "+(l.profile||"UDP/TLS/RTP/SAVPF")+" ",u+=l.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach(h=>{u+=a.writeRtpMap(h),u+=a.writeFmtp(h),u+=a.writeRtcpFb(h)});let d=0;return l.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(u+="a=maxptime:"+d+`\r
`),l.headerExtensions&&l.headerExtensions.forEach(h=>{u+=a.writeExtmap(h)}),u},a.parseRtpEncodingParameters=function(c){const l=[],u=a.parseRtpParameters(c),d=u.fecMechanisms.indexOf("RED")!==-1,h=u.fecMechanisms.indexOf("ULPFEC")!==-1,f=a.matchPrefix(c,"a=ssrc:").map(T=>a.parseSsrcMedia(T)).filter(T=>T.attribute==="cname"),p=f.length>0&&f[0].ssrc;let g;const v=a.matchPrefix(c,"a=ssrc-group:FID").map(T=>T.substring(17).split(" ").map(C=>parseInt(C,10)));v.length>0&&v[0].length>1&&v[0][0]===p&&(g=v[0][1]),u.codecs.forEach(T=>{if(T.name.toUpperCase()==="RTX"&&T.parameters.apt){let C={ssrc:p,codecPayloadType:parseInt(T.parameters.apt,10)};p&&g&&(C.rtx={ssrc:g}),l.push(C),d&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:p,mechanism:h?"red+ulpfec":"red"},l.push(C))}}),l.length===0&&p&&l.push({ssrc:p});let E=a.matchPrefix(c,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,l.forEach(T=>{T.maxBitrate=E})),l},a.parseRtcpParameters=function(c){const l={},u=a.matchPrefix(c,"a=ssrc:").map(f=>a.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];u&&(l.cname=u.value,l.ssrc=u.ssrc);const d=a.matchPrefix(c,"a=rtcp-rsize");l.reducedSize=d.length>0,l.compound=d.length===0;const h=a.matchPrefix(c,"a=rtcp-mux");return l.mux=h.length>0,l},a.writeRtcpParameters=function(c){let l="";return c.reducedSize&&(l+=`a=rtcp-rsize\r
`),c.mux&&(l+=`a=rtcp-mux\r
`),c.ssrc!==void 0&&c.cname&&(l+="a=ssrc:"+c.ssrc+" cname:"+c.cname+`\r
`),l},a.parseMsid=function(c){let l;const u=a.matchPrefix(c,"a=msid:");if(u.length===1)return l=u[0].substring(7).split(" "),{stream:l[0],track:l[1]};const d=a.matchPrefix(c,"a=ssrc:").map(h=>a.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(l=d[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},a.parseSctpDescription=function(c){const l=a.parseMLine(c),u=a.matchPrefix(c,"a=max-message-size:");let d;u.length>0&&(d=parseInt(u[0].substring(19),10)),isNaN(d)&&(d=65536);const h=a.matchPrefix(c,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:l.fmt,maxMessageSize:d};const f=a.matchPrefix(c,"a=sctpmap:");if(f.length>0){const p=f[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:d}}},a.writeSctpDescription=function(c,l){let u=[];return u=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&u.push("a=max-message-size:"+l.maxMessageSize+`\r
`),u.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(c,l,u){let d;const h=l!==void 0?l:2;return d=c||a.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(c,l){const u=a.splitLines(c);for(let d=0;d<u.length;d++)switch(u[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[d].substring(2)}return l?a.getDirection(l):"sendrecv"},a.getKind=function(c){return a.splitLines(c)[0].split(" ")[0].substring(2)},a.isRejected=function(c){return c.split(" ",2)[1]==="0"},a.parseMLine=function(c){const l=a.splitLines(c)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},a.parseOLine=function(c){const l=a.matchPrefix(c,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},a.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;const l=a.splitLines(c);for(let u=0;u<l.length;u++)if(l[u].length<2||l[u].charAt(1)!=="=")return!1;return!0},o.exports=a},477:o=>{o.exports=function(a,c,l,u){var d=self||window;try{try{var h;try{h=new d.Blob([a])}catch{(h=new(d.BlobBuilder||d.WebKitBlobBuilder||d.MozBlobBuilder||d.MSBlobBuilder)).append(a),h=h.getBlob()}var f=d.URL||d.webkitURL,p=f.createObjectURL(h),g=new d[c](p,l);return f.revokeObjectURL(p),g}catch{return new d[c]("data:application/javascript,".concat(encodeURIComponent(a)),l)}}catch{if(!u)throw Error("Inline worker is not supported");return new d[c](u,l)}}},8520:(o,a,c)=>{var l;(function(u){(function(d){var h=typeof globalThis=="object"?globalThis:typeof c.g=="object"?c.g:typeof self=="object"?self:typeof this=="object"?this:function(){try{return Function("return this;")()}catch{}}()||function(){try{return(0,eval)("(function() { return this; })()")}catch{}}(),f=p(u);function p(g,v){return function(E,T){Object.defineProperty(g,E,{configurable:!0,writable:!0,value:T}),v&&v(E,T)}}h.Reflect!==void 0&&(f=p(h.Reflect,f)),function(g,v){var E=Object.prototype.hasOwnProperty,T=typeof Symbol=="function",C=T&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",A=T&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",k=typeof Object.create=="function",I={__proto__:[]}instanceof Array,N=!k&&!I,U={create:k?function(){return Jt(Object.create(null))}:I?function(){return Jt({__proto__:null})}:function(){return Jt({})},has:N?function(De,tt){return E.call(De,tt)}:function(De,tt){return tt in De},get:N?function(De,tt){return E.call(De,tt)?De[tt]:void 0}:function(De,tt){return De[tt]}},F=Object.getPrototypeOf(Function),$=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:rt(),X=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:xt(),q=typeof WeakMap=="function"?WeakMap:sn(),W=T?Symbol.for("@reflect-metadata:registry"):void 0,K=yt(),ne=Dn(K);function Q(De,tt,Et,wt){if(He(Et)){if(!je(De))throw new TypeError;if(!Ht(tt))throw new TypeError;return we(De,tt)}if(!je(De))throw new TypeError;if(!Tt(tt))throw new TypeError;if(!Tt(wt)&&!He(wt)&&!Rt(wt))throw new TypeError;return Rt(wt)&&(wt=void 0),Te(De,tt,Et=it(Et),wt)}function ie(De,tt){function Et(wt,Pn){if(!Tt(wt))throw new TypeError;if(!He(Pn)&&!St(Pn))throw new TypeError;ge(De,tt,wt,Pn)}return Et}function G(De,tt,Et,wt){if(!Tt(Et))throw new TypeError;return He(wt)||(wt=it(wt)),ge(De,tt,Et,wt)}function Z(De,tt,Et){if(!Tt(tt))throw new TypeError;return He(Et)||(Et=it(Et)),Oe(De,tt,Et)}function se(De,tt,Et){if(!Tt(tt))throw new TypeError;return He(Et)||(Et=it(Et)),_t(De,tt,Et)}function ue(De,tt,Et){if(!Tt(tt))throw new TypeError;return He(Et)||(Et=it(Et)),Ct(De,tt,Et)}function Ae(De,tt,Et){if(!Tt(tt))throw new TypeError;return He(Et)||(Et=it(Et)),me(De,tt,Et)}function Be(De,tt){if(!Tt(De))throw new TypeError;return He(tt)||(tt=it(tt)),nt(De,tt)}function Se(De,tt){if(!Tt(De))throw new TypeError;return He(tt)||(tt=it(tt)),Ce(De,tt)}function Pe(De,tt,Et){if(!Tt(tt))throw new TypeError;if(He(Et)||(Et=it(Et)),!Tt(tt))throw new TypeError;He(Et)||(Et=it(Et));var wt=Lt(tt,Et,!1);return!He(wt)&&wt.OrdinaryDeleteMetadata(De,tt,Et)}function we(De,tt){for(var Et=De.length-1;Et>=0;--Et){var wt=(0,De[Et])(tt);if(!He(wt)&&!Rt(wt)){if(!Ht(wt))throw new TypeError;tt=wt}}return tt}function Te(De,tt,Et,wt){for(var Pn=De.length-1;Pn>=0;--Pn){var Xr=(0,De[Pn])(tt,Et,wt);if(!He(Xr)&&!Rt(Xr)){if(!Tt(Xr))throw new TypeError;wt=Xr}}return wt}function Oe(De,tt,Et){if(_t(De,tt,Et))return!0;var wt=Ue(tt);return!Rt(wt)&&Oe(De,wt,Et)}function _t(De,tt,Et){var wt=Lt(tt,Et,!1);return!He(wt)&&le(wt.OrdinaryHasOwnMetadata(De,tt,Et))}function Ct(De,tt,Et){if(_t(De,tt,Et))return me(De,tt,Et);var wt=Ue(tt);return Rt(wt)?void 0:Ct(De,wt,Et)}function me(De,tt,Et){var wt=Lt(tt,Et,!1);if(!He(wt))return wt.OrdinaryGetOwnMetadata(De,tt,Et)}function ge(De,tt,Et,wt){Lt(Et,wt,!0).OrdinaryDefineOwnMetadata(De,tt,Et,wt)}function nt(De,tt){var Et=Ce(De,tt),wt=Ue(De);if(wt===null)return Et;var Pn=nt(wt,tt);if(Pn.length<=0)return Et;if(Et.length<=0)return Pn;for(var Xr=new X,lr=[],zn=0,dn=Et;zn<dn.length;zn++){var tn=dn[zn];Xr.has(tn)||(Xr.add(tn),lr.push(tn))}for(var Cn=0,Rn=Pn;Cn<Rn.length;Cn++)tn=Rn[Cn],Xr.has(tn)||(Xr.add(tn),lr.push(tn));return lr}function Ce(De,tt){var Et=Lt(De,tt,!1);return Et?Et.OrdinaryOwnMetadataKeys(De,tt):[]}function ut(De){if(De===null)return 1;switch(typeof De){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return De===null?1:6;default:return 6}}function He(De){return De===void 0}function Rt(De){return De===null}function $t(De){return typeof De=="symbol"}function Tt(De){return typeof De=="object"?De!==null:typeof De=="function"}function Ft(De,tt){switch(ut(De)){case 0:case 1:case 2:case 3:case 4:case 5:return De}var Et="string",wt=oe(De,C);if(wt!==void 0){var Pn=wt.call(De,Et);if(Tt(Pn))throw new TypeError;return Pn}return Ee(De)}function Ee(De,tt){var Et,wt;{var Pn=De.toString;if(Fe(Pn)&&!Tt(wt=Pn.call(De))||Fe(Et=De.valueOf)&&!Tt(wt=Et.call(De)))return wt}throw new TypeError}function le(De){return!!De}function We(De){return""+De}function it(De){var tt=Ft(De);return $t(tt)?tt:We(tt)}function je(De){return Array.isArray?Array.isArray(De):De instanceof Object?De instanceof Array:Object.prototype.toString.call(De)==="[object Array]"}function Fe(De){return typeof De=="function"}function Ht(De){return typeof De=="function"}function St(De){switch(ut(De)){case 3:case 4:return!0;default:return!1}}function Dt(De,tt){return De===tt||De!=De&&tt!=tt}function oe(De,tt){var Et=De[tt];if(Et!=null){if(!Fe(Et))throw new TypeError;return Et}}function j(De){var tt=oe(De,A);if(!Fe(tt))throw new TypeError;var Et=tt.call(De);if(!Tt(Et))throw new TypeError;return Et}function V(De){return De.value}function fe(De){var tt=De.next();return!tt.done&&tt}function Ie(De){var tt=De.return;tt&&tt.call(De)}function Ue(De){var tt=Object.getPrototypeOf(De);if(typeof De!="function"||De===F||tt!==F)return tt;var Et=De.prototype,wt=Et&&Object.getPrototypeOf(Et);if(wt==null||wt===Object.prototype)return tt;var Pn=wt.constructor;return typeof Pn!="function"||Pn===De?tt:Pn}function dt(){var De,tt,Et,wt;He(W)||v.Reflect===void 0||W in v.Reflect||typeof v.Reflect.defineMetadata!="function"||(De=Le(v.Reflect));var Pn=new q,Xr={registerProvider:lr,getProvider:dn,setProvider:Cn};return Xr;function lr(Rn){if(!Object.isExtensible(Xr))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case De===Rn:break;case He(tt):tt=Rn;break;case tt===Rn:break;case He(Et):Et=Rn;break;case Et===Rn:break;default:wt===void 0&&(wt=new X),wt.add(Rn)}}function zn(Rn,yr){if(!He(tt)){if(tt.isProviderFor(Rn,yr))return tt;if(!He(Et)){if(Et.isProviderFor(Rn,yr))return tt;if(!He(wt))for(var hi=j(wt);;){var si=fe(hi);if(!si)return;var Co=V(si);if(Co.isProviderFor(Rn,yr))return Ie(hi),Co}}}if(!He(De)&&De.isProviderFor(Rn,yr))return De}function dn(Rn,yr){var hi,si=Pn.get(Rn);return He(si)||(hi=si.get(yr)),He(hi)&&(He(hi=zn(Rn,yr))||(He(si)&&(si=new $,Pn.set(Rn,si)),si.set(yr,hi))),hi}function tn(Rn){if(He(Rn))throw new TypeError;return tt===Rn||Et===Rn||!He(wt)&&wt.has(Rn)}function Cn(Rn,yr,hi){if(!tn(hi))throw new Error("Metadata provider not registered.");var si=dn(Rn,yr);if(si!==hi){if(!He(si))return!1;var Co=Pn.get(Rn);He(Co)&&(Co=new $,Pn.set(Rn,Co)),Co.set(yr,hi)}return!0}}function yt(){var De;return!He(W)&&Tt(v.Reflect)&&Object.isExtensible(v.Reflect)&&(De=v.Reflect[W]),He(De)&&(De=dt()),!He(W)&&Tt(v.Reflect)&&Object.isExtensible(v.Reflect)&&Object.defineProperty(v.Reflect,W,{enumerable:!1,configurable:!1,writable:!1,value:De}),De}function Dn(De){var tt=new q,Et={isProviderFor:function(tn,Cn){var Rn=tt.get(tn);return!He(Rn)&&Rn.has(Cn)},OrdinaryDefineOwnMetadata:lr,OrdinaryHasOwnMetadata:Pn,OrdinaryGetOwnMetadata:Xr,OrdinaryOwnMetadataKeys:zn,OrdinaryDeleteMetadata:dn};return K.registerProvider(Et),Et;function wt(tn,Cn,Rn){var yr=tt.get(tn),hi=!1;if(He(yr)){if(!Rn)return;yr=new $,tt.set(tn,yr),hi=!0}var si=yr.get(Cn);if(He(si)){if(!Rn)return;if(si=new $,yr.set(Cn,si),!De.setProvider(tn,Cn,Et))throw yr.delete(Cn),hi&&tt.delete(tn),new Error("Wrong provider for target.")}return si}function Pn(tn,Cn,Rn){var yr=wt(Cn,Rn,!1);return!He(yr)&&le(yr.has(tn))}function Xr(tn,Cn,Rn){var yr=wt(Cn,Rn,!1);if(!He(yr))return yr.get(tn)}function lr(tn,Cn,Rn,yr){wt(Rn,yr,!0).set(tn,Cn)}function zn(tn,Cn){var Rn=[],yr=wt(tn,Cn,!1);if(He(yr))return Rn;for(var hi=j(yr.keys()),si=0;;){var Co=fe(hi);if(!Co)return Rn.length=si,Rn;var mu=V(Co);try{Rn[si]=mu}catch(Vd){try{Ie(hi)}finally{throw Vd}}si++}}function dn(tn,Cn,Rn){var yr=wt(Cn,Rn,!1);if(He(yr)||!yr.delete(tn))return!1;if(yr.size===0){var hi=tt.get(Cn);He(hi)||(hi.delete(Rn),hi.size===0&&tt.delete(hi))}return!0}}function Le(De){var tt=De.defineMetadata,Et=De.hasOwnMetadata,wt=De.getOwnMetadata,Pn=De.getOwnMetadataKeys,Xr=De.deleteMetadata,lr=new q;return{isProviderFor:function(zn,dn){var tn=lr.get(zn);return!(He(tn)||!tn.has(dn))||!!Pn(zn,dn).length&&(He(tn)&&(tn=new X,lr.set(zn,tn)),tn.add(dn),!0)},OrdinaryDefineOwnMetadata:tt,OrdinaryHasOwnMetadata:Et,OrdinaryGetOwnMetadata:wt,OrdinaryOwnMetadataKeys:Pn,OrdinaryDeleteMetadata:Xr}}function Lt(De,tt,Et){var wt=K.getProvider(De,tt);if(!He(wt))return wt;if(Et){if(K.setProvider(De,tt,ne))return ne;throw new Error("Illegal state.")}}function rt(){var De={},tt=[],Et=function(){function lr(zn,dn,tn){this._index=0,this._keys=zn,this._values=dn,this._selector=tn}return lr.prototype["@@iterator"]=function(){return this},lr.prototype[A]=function(){return this},lr.prototype.next=function(){var zn=this._index;if(zn>=0&&zn<this._keys.length){var dn=this._selector(this._keys[zn],this._values[zn]);return zn+1>=this._keys.length?(this._index=-1,this._keys=tt,this._values=tt):this._index++,{value:dn,done:!1}}return{value:void 0,done:!0}},lr.prototype.throw=function(zn){throw this._index>=0&&(this._index=-1,this._keys=tt,this._values=tt),zn},lr.prototype.return=function(zn){return this._index>=0&&(this._index=-1,this._keys=tt,this._values=tt),{value:zn,done:!0}},lr}();return function(){function lr(){this._keys=[],this._values=[],this._cacheKey=De,this._cacheIndex=-2}return Object.defineProperty(lr.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),lr.prototype.has=function(zn){return this._find(zn,!1)>=0},lr.prototype.get=function(zn){var dn=this._find(zn,!1);return dn>=0?this._values[dn]:void 0},lr.prototype.set=function(zn,dn){var tn=this._find(zn,!0);return this._values[tn]=dn,this},lr.prototype.delete=function(zn){var dn=this._find(zn,!1);if(dn>=0){for(var tn=this._keys.length,Cn=dn+1;Cn<tn;Cn++)this._keys[Cn-1]=this._keys[Cn],this._values[Cn-1]=this._values[Cn];return this._keys.length--,this._values.length--,Dt(zn,this._cacheKey)&&(this._cacheKey=De,this._cacheIndex=-2),!0}return!1},lr.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=De,this._cacheIndex=-2},lr.prototype.keys=function(){return new Et(this._keys,this._values,wt)},lr.prototype.values=function(){return new Et(this._keys,this._values,Pn)},lr.prototype.entries=function(){return new Et(this._keys,this._values,Xr)},lr.prototype["@@iterator"]=function(){return this.entries()},lr.prototype[A]=function(){return this.entries()},lr.prototype._find=function(zn,dn){if(!Dt(this._cacheKey,zn)){this._cacheIndex=-1;for(var tn=0;tn<this._keys.length;tn++)if(Dt(this._keys[tn],zn)){this._cacheIndex=tn;break}}return this._cacheIndex<0&&dn&&(this._cacheIndex=this._keys.length,this._keys.push(zn),this._values.push(void 0)),this._cacheIndex},lr}();function wt(lr,zn){return lr}function Pn(lr,zn){return zn}function Xr(lr,zn){return[lr,zn]}}function xt(){return function(){function De(){this._map=new $}return Object.defineProperty(De.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),De.prototype.has=function(tt){return this._map.has(tt)},De.prototype.add=function(tt){return this._map.set(tt,tt),this},De.prototype.delete=function(tt){return this._map.delete(tt)},De.prototype.clear=function(){this._map.clear()},De.prototype.keys=function(){return this._map.keys()},De.prototype.values=function(){return this._map.keys()},De.prototype.entries=function(){return this._map.entries()},De.prototype["@@iterator"]=function(){return this.keys()},De.prototype[A]=function(){return this.keys()},De}()}function sn(){var De=16,tt=U.create(),Et=wt();return function(){function dn(){this._key=wt()}return dn.prototype.has=function(tn){var Cn=Pn(tn,!1);return Cn!==void 0&&U.has(Cn,this._key)},dn.prototype.get=function(tn){var Cn=Pn(tn,!1);return Cn!==void 0?U.get(Cn,this._key):void 0},dn.prototype.set=function(tn,Cn){return Pn(tn,!0)[this._key]=Cn,this},dn.prototype.delete=function(tn){var Cn=Pn(tn,!1);return Cn!==void 0&&delete Cn[this._key]},dn.prototype.clear=function(){this._key=wt()},dn}();function wt(){var dn;do dn="@@WeakMap@@"+zn();while(U.has(tt,dn));return tt[dn]=!0,dn}function Pn(dn,tn){if(!E.call(dn,Et)){if(!tn)return;Object.defineProperty(dn,Et,{value:U.create()})}return dn[Et]}function Xr(dn,tn){for(var Cn=0;Cn<tn;++Cn)dn[Cn]=255*Math.random()|0;return dn}function lr(dn){if(typeof Uint8Array=="function"){var tn=new Uint8Array(dn);return typeof crypto<"u"?crypto.getRandomValues(tn):typeof msCrypto<"u"?msCrypto.getRandomValues(tn):Xr(tn,dn),tn}return Xr(new Array(dn),dn)}function zn(){var dn=lr(De);dn[6]=79&dn[6]|64,dn[8]=191&dn[8]|128;for(var tn="",Cn=0;Cn<De;++Cn){var Rn=dn[Cn];Cn!==4&&Cn!==6&&Cn!==8||(tn+="-"),Rn<16&&(tn+="0"),tn+=Rn.toString(16).toLowerCase()}return tn}}function Jt(De){return De.__=void 0,delete De.__,De}g("decorate",Q),g("metadata",ie),g("defineMetadata",G),g("hasMetadata",Z),g("hasOwnMetadata",se),g("getMetadata",ue),g("getOwnMetadata",Ae),g("getMetadataKeys",Be),g("getOwnMetadataKeys",Se),g("deleteMetadata",Pe)}(f,h),h.Reflect===void 0&&(h.Reflect=u)})()})(l||(l={}))}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={id:o,loaded:!1,exports:{}};return n[o].call(c.exports,c,c.exports,i),c.loaded=!0,c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.nmd=o=>(o.paths=[],o.children||(o.children=[]),o);var s={};return(()=>{i.r(s),i.d(s,{BASIC_FULL_HD_LANDSCAPE:()=>Qn,BASIC_FULL_HD_PORTRAIT:()=>ur,BASIC_LANDSCAPE:()=>Sr,BASIC_PORTRAIT:()=>Fs,BroadcastClientError:()=>yt,BroadcastClientEvents:()=>As,ConnectionState:()=>et,Errors:()=>u,InitialLayerPreference:()=>Su,JitterBufferMinDelay:()=>hs,LOG_LEVEL:()=>V,LocalStageStream:()=>K_,LocalStageStreamEvents:()=>Kl,LogLevels:()=>V,RemoteStageStream:()=>L,RemoteStageStreamEvents:()=>fh,STANDARD_LANDSCAPE:()=>Pl,STANDARD_PORTRAIT:()=>Si,Stage:()=>yn,StageConnectionState:()=>wi,StageErrorCategory:()=>Au,StageErrorCode:()=>Ir,StageEvents:()=>Rr,StageLeftReason:()=>hr,StageParticipantPublishState:()=>Vi,StageParticipantSubscribeState:()=>Oo,StageStream:()=>nv,StageStreamLayerSelectedReason:()=>Qo,StreamType:()=>Gt,SubscribeType:()=>Jo,__version:()=>Xd,create:()=>lc,default:()=>fr,isSupported:()=>j});var o={};i.r(o),i.d(o,{fixNegotiationNeeded:()=>Z,shimAddTrackRemoveTrack:()=>ie,shimAddTrackRemoveTrackWithNative:()=>Q,shimGetDisplayMedia:()=>$,shimGetSendersWithDtmf:()=>W,shimGetStats:()=>K,shimGetUserMedia:()=>F,shimMediaStream:()=>X,shimOnTrack:()=>q,shimPeerConnection:()=>G,shimSenderReceiverGetStats:()=>ne});var a={};i.r(a),i.d(a,{shimAddTransceiver:()=>Oe,shimCreateAnswer:()=>me,shimCreateOffer:()=>Ct,shimGetDisplayMedia:()=>ue,shimGetParameters:()=>_t,shimGetUserMedia:()=>se,shimOnTrack:()=>Ae,shimPeerConnection:()=>Be,shimRTCDataChannel:()=>Te,shimReceiverGetStats:()=>Pe,shimRemoveStream:()=>we,shimSenderGetStats:()=>Se});var c={};i.r(c),i.d(c,{shimAudioContext:()=>Ft,shimCallbacksAPI:()=>Ce,shimConstraints:()=>He,shimCreateOfferLegacy:()=>Tt,shimGetUserMedia:()=>ut,shimLocalStreamsAPI:()=>ge,shimRTCIceServerUrls:()=>Rt,shimRemoteStreamsAPI:()=>nt,shimTrackEventTransceiver:()=>$t});var l={};i.r(l),i.d(l,{removeExtmapAllowMixed:()=>St,shimAddIceCandidateNullOrEmpty:()=>Dt,shimConnectionState:()=>Ht,shimMaxMessageSize:()=>je,shimParameterlessSetLocalDescription:()=>oe,shimRTCIceCandidate:()=>We,shimRTCIceCandidateRelayProtocol:()=>it,shimSendThrowTypeError:()=>Fe});var u={};i.r(u),i.d(u,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Jt,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>sn,ADD_DEVICE_CONSTRAINTS_ERROR:()=>Et,ADD_DEVICE_DEVICE_ERROR:()=>rt,ADD_DEVICE_NAME_EXISTS_ERROR:()=>xt,ADD_DEVICE_NAME_MISSING_ERROR:()=>De,ADD_DEVICE_UNSUPPORTED:()=>tt,BROADCAST_CONFIGURATION_ERROR:()=>hi,BROADCAST_ERROR:()=>Dn,CAMERA_ERROR:()=>Le,CLIENT_INVALID_ERROR:()=>sf,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>dn,FAILED_TO_ADD_IMAGE_ERROR:()=>tn,INGEST_ENDPOINT_TYPE_ERROR:()=>Co,INGEST_ENDPOINT_URL_ERROR:()=>mu,INPUT_ERROR:()=>Lt,INVALID_STREAM_KEY:()=>yr,LOGGER_TYPE_ERROR:()=>rf,LOG_LEVEL_TYPE_ERROR:()=>Vd,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>ve,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>Ke,PEER_CONNECTION_ERROR:()=>Rn,PEER_SETUP_ERROR:()=>Cn,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>wt,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>Pn,STAGE_TOKEN_TYPE_ERROR:()=>vt,STAGE_WHIP_OVERRIDE_ERROR:()=>Xe,STREAM_CONFIGURATION_ERROR:()=>si,STREAM_KEY_INVALID_CHAR_ERROR:()=>pt,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>lr,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>Xr,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>zn});var d={};i.r(d),i.d(d,{BASIC_FULL_HD_LANDSCAPE:()=>Qn,BASIC_FULL_HD_PORTRAIT:()=>ur,BASIC_LANDSCAPE:()=>Sr,BASIC_PORTRAIT:()=>Fs,BroadcastClientError:()=>yt,BroadcastClientEvents:()=>As,ConnectionState:()=>et,Errors:()=>u,LOG_LEVEL:()=>V,LogLevels:()=>V,STANDARD_LANDSCAPE:()=>Pl,STANDARD_PORTRAIT:()=>Si,__version:()=>Xd,create:()=>lc,isSupported:()=>j});let h=!0,f=!0;function p(x,b,S){const R=x.match(b);return R&&R.length>=S&&parseInt(R[S],10)}function g(x,b,S){if(!x.RTCPeerConnection)return;const R=x.RTCPeerConnection.prototype,O=R.addEventListener;R.addEventListener=function(B,J){if(B!==b)return O.apply(this,arguments);const te=z=>{const re=S(z);re&&(J.handleEvent?J.handleEvent(re):J(re))};return this._eventMap=this._eventMap||{},this._eventMap[b]||(this._eventMap[b]=new Map),this._eventMap[b].set(J,te),O.apply(this,[B,te])};const P=R.removeEventListener;R.removeEventListener=function(B,J){if(B!==b||!this._eventMap||!this._eventMap[b])return P.apply(this,arguments);if(!this._eventMap[b].has(J))return P.apply(this,arguments);const te=this._eventMap[b].get(J);return this._eventMap[b].delete(J),this._eventMap[b].size===0&&delete this._eventMap[b],Object.keys(this._eventMap).length===0&&delete this._eventMap,P.apply(this,[B,te])},Object.defineProperty(R,"on"+b,{get(){return this["_on"+b]},set(B){this["_on"+b]&&(this.removeEventListener(b,this["_on"+b]),delete this["_on"+b]),B&&this.addEventListener(b,this["_on"+b]=B)},enumerable:!0,configurable:!0})}function v(x){return typeof x!="boolean"?new Error("Argument type: "+typeof x+". Please use a boolean."):(h=x,x?"adapter.js logging disabled":"adapter.js logging enabled")}function E(x){return typeof x!="boolean"?new Error("Argument type: "+typeof x+". Please use a boolean."):(f=!x,"adapter.js deprecation warnings "+(x?"disabled":"enabled"))}function T(){if(typeof window=="object"){if(h)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function C(x,b){f&&console.warn(x+" is deprecated, please use "+b+" instead.")}function A(x){return Object.prototype.toString.call(x)==="[object Object]"}function k(x){return A(x)?Object.keys(x).reduce(function(b,S){const R=A(x[S]),O=R?k(x[S]):x[S],P=R&&!Object.keys(O).length;return O===void 0||P?b:Object.assign(b,{[S]:O})},{}):x}function I(x,b,S){b&&!S.has(b.id)&&(S.set(b.id,b),Object.keys(b).forEach(R=>{R.endsWith("Id")?I(x,x.get(b[R]),S):R.endsWith("Ids")&&b[R].forEach(O=>{I(x,x.get(O),S)})}))}function N(x,b,S){const R=S?"outbound-rtp":"inbound-rtp",O=new Map;if(b===null)return O;const P=[];return x.forEach(B=>{B.type==="track"&&B.trackIdentifier===b.id&&P.push(B)}),P.forEach(B=>{x.forEach(J=>{J.type===R&&J.trackId===B.id&&I(x,J,O)})}),O}const U=T;function F(x,b){const S=x&&x.navigator;if(!S.mediaDevices)return;const R=function(B){if(typeof B!="object"||B.mandatory||B.optional)return B;const J={};return Object.keys(B).forEach(te=>{if(te==="require"||te==="advanced"||te==="mediaSource")return;const z=typeof B[te]=="object"?B[te]:{ideal:B[te]};z.exact!==void 0&&typeof z.exact=="number"&&(z.min=z.max=z.exact);const re=function(ce,de){return ce?ce+de.charAt(0).toUpperCase()+de.slice(1):de==="deviceId"?"sourceId":de};if(z.ideal!==void 0){J.optional=J.optional||[];let ce={};typeof z.ideal=="number"?(ce[re("min",te)]=z.ideal,J.optional.push(ce),ce={},ce[re("max",te)]=z.ideal,J.optional.push(ce)):(ce[re("",te)]=z.ideal,J.optional.push(ce))}z.exact!==void 0&&typeof z.exact!="number"?(J.mandatory=J.mandatory||{},J.mandatory[re("",te)]=z.exact):["min","max"].forEach(ce=>{z[ce]!==void 0&&(J.mandatory=J.mandatory||{},J.mandatory[re(ce,te)]=z[ce])})}),B.advanced&&(J.optional=(J.optional||[]).concat(B.advanced)),J},O=function(B,J){if(b.version>=61)return J(B);if((B=JSON.parse(JSON.stringify(B)))&&typeof B.audio=="object"){const te=function(z,re,ce){re in z&&!(ce in z)&&(z[ce]=z[re],delete z[re])};te((B=JSON.parse(JSON.stringify(B))).audio,"autoGainControl","googAutoGainControl"),te(B.audio,"noiseSuppression","googNoiseSuppression"),B.audio=R(B.audio)}if(B&&typeof B.video=="object"){let te=B.video.facingMode;te=te&&(typeof te=="object"?te:{ideal:te});const z=b.version<66;if(te&&(te.exact==="user"||te.exact==="environment"||te.ideal==="user"||te.ideal==="environment")&&(!S.mediaDevices.getSupportedConstraints||!S.mediaDevices.getSupportedConstraints().facingMode||z)){let re;if(delete B.video.facingMode,te.exact==="environment"||te.ideal==="environment"?re=["back","rear"]:te.exact!=="user"&&te.ideal!=="user"||(re=["front"]),re)return S.mediaDevices.enumerateDevices().then(ce=>{let de=(ce=ce.filter(Me=>Me.kind==="videoinput")).find(Me=>re.some(Qe=>Me.label.toLowerCase().includes(Qe)));return!de&&ce.length&&re.includes("back")&&(de=ce[ce.length-1]),de&&(B.video.deviceId=te.exact?{exact:de.deviceId}:{ideal:de.deviceId}),B.video=R(B.video),U("chrome: "+JSON.stringify(B)),J(B)})}B.video=R(B.video)}return U("chrome: "+JSON.stringify(B)),J(B)},P=function(B){return b.version>=64?B:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[B.name]||B.name,message:B.message,constraint:B.constraint||B.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(S.getUserMedia=(function(B,J,te){O(B,z=>{S.webkitGetUserMedia(z,J,re=>{te&&te(P(re))})})}).bind(S),S.mediaDevices.getUserMedia){const B=S.mediaDevices.getUserMedia.bind(S.mediaDevices);S.mediaDevices.getUserMedia=function(J){return O(J,te=>B(te).then(z=>{if(te.audio&&!z.getAudioTracks().length||te.video&&!z.getVideoTracks().length)throw z.getTracks().forEach(re=>{re.stop()}),new DOMException("","NotFoundError");return z},z=>Promise.reject(P(z))))}}}function $(x,b){x.navigator.mediaDevices&&"getDisplayMedia"in x.navigator.mediaDevices||x.navigator.mediaDevices&&(typeof b=="function"?x.navigator.mediaDevices.getDisplayMedia=function(S){return b(S).then(R=>{const O=S.video&&S.video.width,P=S.video&&S.video.height,B=S.video&&S.video.frameRate;return S.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:R,maxFrameRate:B||3}},O&&(S.video.mandatory.maxWidth=O),P&&(S.video.mandatory.maxHeight=P),x.navigator.mediaDevices.getUserMedia(S)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function X(x){x.MediaStream=x.MediaStream||x.webkitMediaStream}function q(x){if(typeof x=="object"&&x.RTCPeerConnection&&!("ontrack"in x.RTCPeerConnection.prototype)){Object.defineProperty(x.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(S){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=S)},enumerable:!0,configurable:!0});const b=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=S=>{S.stream.addEventListener("addtrack",R=>{let O;O=x.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(B=>B.track&&B.track.id===R.track.id):{track:R.track};const P=new Event("track");P.track=R.track,P.receiver=O,P.transceiver={receiver:O},P.streams=[S.stream],this.dispatchEvent(P)}),S.stream.getTracks().forEach(R=>{let O;O=x.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(B=>B.track&&B.track.id===R.id):{track:R};const P=new Event("track");P.track=R,P.receiver=O,P.transceiver={receiver:O},P.streams=[S.stream],this.dispatchEvent(P)})},this.addEventListener("addstream",this._ontrackpoly)),b.apply(this,arguments)}}else g(x,"track",b=>(b.transceiver||Object.defineProperty(b,"transceiver",{value:{receiver:b.receiver}}),b))}function W(x){if(typeof x=="object"&&x.RTCPeerConnection&&!("getSenders"in x.RTCPeerConnection.prototype)&&"createDTMFSender"in x.RTCPeerConnection.prototype){const b=function(O,P){return{track:P,get dtmf(){return this._dtmf===void 0&&(P.kind==="audio"?this._dtmf=O.createDTMFSender(P):this._dtmf=null),this._dtmf},_pc:O}};if(!x.RTCPeerConnection.prototype.getSenders){x.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const O=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addTrack=function(B,J){let te=O.apply(this,arguments);return te||(te=b(this,B),this._senders.push(te)),te};const P=x.RTCPeerConnection.prototype.removeTrack;x.RTCPeerConnection.prototype.removeTrack=function(B){P.apply(this,arguments);const J=this._senders.indexOf(B);J!==-1&&this._senders.splice(J,1)}}const S=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(O){this._senders=this._senders||[],S.apply(this,[O]),O.getTracks().forEach(P=>{this._senders.push(b(this,P))})};const R=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(O){this._senders=this._senders||[],R.apply(this,[O]),O.getTracks().forEach(P=>{const B=this._senders.find(J=>J.track===P);B&&this._senders.splice(this._senders.indexOf(B),1)})}}else if(typeof x=="object"&&x.RTCPeerConnection&&"getSenders"in x.RTCPeerConnection.prototype&&"createDTMFSender"in x.RTCPeerConnection.prototype&&x.RTCRtpSender&&!("dtmf"in x.RTCRtpSender.prototype)){const b=x.RTCPeerConnection.prototype.getSenders;x.RTCPeerConnection.prototype.getSenders=function(){const S=b.apply(this,[]);return S.forEach(R=>R._pc=this),S},Object.defineProperty(x.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function K(x){if(!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){const[S,R,O]=arguments;if(arguments.length>0&&typeof S=="function")return b.apply(this,arguments);if(b.length===0&&(arguments.length===0||typeof S!="function"))return b.apply(this,[]);const P=function(J){const te={};return J.result().forEach(z=>{const re={id:z.id,timestamp:z.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[z.type]||z.type};z.names().forEach(ce=>{re[ce]=z.stat(ce)}),te[re.id]=re}),te},B=function(J){return new Map(Object.keys(J).map(te=>[te,J[te]]))};if(arguments.length>=2){const J=function(te){R(B(P(te)))};return b.apply(this,[J,S])}return new Promise((J,te)=>{b.apply(this,[function(z){J(B(P(z)))},te])}).then(R,O)}}function ne(x){if(!(typeof x=="object"&&x.RTCPeerConnection&&x.RTCRtpSender&&x.RTCRtpReceiver))return;if(!("getStats"in x.RTCRtpSender.prototype)){const S=x.RTCPeerConnection.prototype.getSenders;S&&(x.RTCPeerConnection.prototype.getSenders=function(){const O=S.apply(this,[]);return O.forEach(P=>P._pc=this),O});const R=x.RTCPeerConnection.prototype.addTrack;R&&(x.RTCPeerConnection.prototype.addTrack=function(){const O=R.apply(this,arguments);return O._pc=this,O}),x.RTCRtpSender.prototype.getStats=function(){const O=this;return this._pc.getStats().then(P=>N(P,O.track,!0))}}if(!("getStats"in x.RTCRtpReceiver.prototype)){const S=x.RTCPeerConnection.prototype.getReceivers;S&&(x.RTCPeerConnection.prototype.getReceivers=function(){const R=S.apply(this,[]);return R.forEach(O=>O._pc=this),R}),g(x,"track",R=>(R.receiver._pc=R.srcElement,R)),x.RTCRtpReceiver.prototype.getStats=function(){const R=this;return this._pc.getStats().then(O=>N(O,R.track,!1))}}if(!("getStats"in x.RTCRtpSender.prototype)||!("getStats"in x.RTCRtpReceiver.prototype))return;const b=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof x.MediaStreamTrack){const S=arguments[0];let R,O,P;return this.getSenders().forEach(B=>{B.track===S&&(R?P=!0:R=B)}),this.getReceivers().forEach(B=>(B.track===S&&(O?P=!0:O=B),B.track===S)),P||R&&O?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):R?R.getStats():O?O.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return b.apply(this,arguments)}}function Q(x){x.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(P=>this._shimmedLocalStreams[P][0])};const b=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addTrack=function(P,B){if(!B)return b.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const J=b.apply(this,arguments);return this._shimmedLocalStreams[B.id]?this._shimmedLocalStreams[B.id].indexOf(J)===-1&&this._shimmedLocalStreams[B.id].push(J):this._shimmedLocalStreams[B.id]=[B,J],J};const S=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(P){this._shimmedLocalStreams=this._shimmedLocalStreams||{},P.getTracks().forEach(te=>{if(this.getSenders().find(z=>z.track===te))throw new DOMException("Track already exists.","InvalidAccessError")});const B=this.getSenders();S.apply(this,arguments);const J=this.getSenders().filter(te=>B.indexOf(te)===-1);this._shimmedLocalStreams[P.id]=[P].concat(J)};const R=x.RTCPeerConnection.prototype.removeStream;x.RTCPeerConnection.prototype.removeStream=function(P){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[P.id],R.apply(this,arguments)};const O=x.RTCPeerConnection.prototype.removeTrack;x.RTCPeerConnection.prototype.removeTrack=function(P){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},P&&Object.keys(this._shimmedLocalStreams).forEach(B=>{const J=this._shimmedLocalStreams[B].indexOf(P);J!==-1&&this._shimmedLocalStreams[B].splice(J,1),this._shimmedLocalStreams[B].length===1&&delete this._shimmedLocalStreams[B]}),O.apply(this,arguments)}}function ie(x,b){if(!x.RTCPeerConnection)return;if(x.RTCPeerConnection.prototype.addTrack&&b.version>=65)return Q(x);const S=x.RTCPeerConnection.prototype.getLocalStreams;x.RTCPeerConnection.prototype.getLocalStreams=function(){const te=S.apply(this);return this._reverseStreams=this._reverseStreams||{},te.map(z=>this._reverseStreams[z.id])};const R=x.RTCPeerConnection.prototype.addStream;x.RTCPeerConnection.prototype.addStream=function(te){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},te.getTracks().forEach(z=>{if(this.getSenders().find(re=>re.track===z))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[te.id]){const z=new x.MediaStream(te.getTracks());this._streams[te.id]=z,this._reverseStreams[z.id]=te,te=z}R.apply(this,[te])};const O=x.RTCPeerConnection.prototype.removeStream;function P(te,z){let re=z.sdp;return Object.keys(te._reverseStreams||[]).forEach(ce=>{const de=te._reverseStreams[ce],Me=te._streams[de.id];re=re.replace(new RegExp(Me.id,"g"),de.id)}),new RTCSessionDescription({type:z.type,sdp:re})}x.RTCPeerConnection.prototype.removeStream=function(te){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},O.apply(this,[this._streams[te.id]||te]),delete this._reverseStreams[this._streams[te.id]?this._streams[te.id].id:te.id],delete this._streams[te.id]},x.RTCPeerConnection.prototype.addTrack=function(te,z){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const re=[].slice.call(arguments,1);if(re.length!==1||!re[0].getTracks().find(de=>de===te))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(de=>de.track===te))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const ce=this._streams[z.id];if(ce)ce.addTrack(te),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const de=new x.MediaStream([te]);this._streams[z.id]=de,this._reverseStreams[de.id]=z,this.addStream(de)}return this.getSenders().find(de=>de.track===te)},["createOffer","createAnswer"].forEach(function(te){const z=x.RTCPeerConnection.prototype[te],re={[te](){const ce=arguments;return arguments.length&&typeof arguments[0]=="function"?z.apply(this,[de=>{const Me=P(this,de);ce[0].apply(null,[Me])},de=>{ce[1]&&ce[1].apply(null,de)},arguments[2]]):z.apply(this,arguments).then(de=>P(this,de))}};x.RTCPeerConnection.prototype[te]=re[te]});const B=x.RTCPeerConnection.prototype.setLocalDescription;x.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(te,z){let re=z.sdp;return Object.keys(te._reverseStreams||[]).forEach(ce=>{const de=te._reverseStreams[ce],Me=te._streams[de.id];re=re.replace(new RegExp(de.id,"g"),Me.id)}),new RTCSessionDescription({type:z.type,sdp:re})}(this,arguments[0]),B.apply(this,arguments)):B.apply(this,arguments)};const J=Object.getOwnPropertyDescriptor(x.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(x.RTCPeerConnection.prototype,"localDescription",{get(){const te=J.get.apply(this);return te.type===""?te:P(this,te)}}),x.RTCPeerConnection.prototype.removeTrack=function(te){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!te._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(te._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let z;this._streams=this._streams||{},Object.keys(this._streams).forEach(re=>{this._streams[re].getTracks().find(ce=>te.track===ce)&&(z=this._streams[re])}),z&&(z.getTracks().length===1?this.removeStream(this._reverseStreams[z.id]):z.removeTrack(te.track),this.dispatchEvent(new Event("negotiationneeded")))}}function G(x,b){!x.RTCPeerConnection&&x.webkitRTCPeerConnection&&(x.RTCPeerConnection=x.webkitRTCPeerConnection),x.RTCPeerConnection&&b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(S){const R=x.RTCPeerConnection.prototype[S],O={[S](){return arguments[0]=new(S==="addIceCandidate"?x.RTCIceCandidate:x.RTCSessionDescription)(arguments[0]),R.apply(this,arguments)}};x.RTCPeerConnection.prototype[S]=O[S]})}function Z(x,b){g(x,"negotiationneeded",S=>{const R=S.target;if(!(b.version<72||R.getConfiguration&&R.getConfiguration().sdpSemantics==="plan-b")||R.signalingState==="stable")return S})}function se(x,b){const S=x&&x.navigator,R=x&&x.MediaStreamTrack;if(S.getUserMedia=function(O,P,B){C("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),S.mediaDevices.getUserMedia(O).then(P,B)},!(b.version>55&&"autoGainControl"in S.mediaDevices.getSupportedConstraints())){const O=function(B,J,te){J in B&&!(te in B)&&(B[te]=B[J],delete B[J])},P=S.mediaDevices.getUserMedia.bind(S.mediaDevices);if(S.mediaDevices.getUserMedia=function(B){return typeof B=="object"&&typeof B.audio=="object"&&(B=JSON.parse(JSON.stringify(B)),O(B.audio,"autoGainControl","mozAutoGainControl"),O(B.audio,"noiseSuppression","mozNoiseSuppression")),P(B)},R&&R.prototype.getSettings){const B=R.prototype.getSettings;R.prototype.getSettings=function(){const J=B.apply(this,arguments);return O(J,"mozAutoGainControl","autoGainControl"),O(J,"mozNoiseSuppression","noiseSuppression"),J}}if(R&&R.prototype.applyConstraints){const B=R.prototype.applyConstraints;R.prototype.applyConstraints=function(J){return this.kind==="audio"&&typeof J=="object"&&(J=JSON.parse(JSON.stringify(J)),O(J,"autoGainControl","mozAutoGainControl"),O(J,"noiseSuppression","mozNoiseSuppression")),B.apply(this,[J])}}}}function ue(x,b){x.navigator.mediaDevices&&"getDisplayMedia"in x.navigator.mediaDevices||x.navigator.mediaDevices&&(x.navigator.mediaDevices.getDisplayMedia=function(S){if(!S||!S.video){const R=new DOMException("getDisplayMedia without video constraints is undefined");return R.name="NotFoundError",R.code=8,Promise.reject(R)}return S.video===!0?S.video={mediaSource:b}:S.video.mediaSource=b,x.navigator.mediaDevices.getUserMedia(S)})}function Ae(x){typeof x=="object"&&x.RTCTrackEvent&&"receiver"in x.RTCTrackEvent.prototype&&!("transceiver"in x.RTCTrackEvent.prototype)&&Object.defineProperty(x.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Be(x,b){if(typeof x!="object"||!x.RTCPeerConnection&&!x.mozRTCPeerConnection)return;!x.RTCPeerConnection&&x.mozRTCPeerConnection&&(x.RTCPeerConnection=x.mozRTCPeerConnection),b.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(O){const P=x.RTCPeerConnection.prototype[O],B={[O](){return arguments[0]=new(O==="addIceCandidate"?x.RTCIceCandidate:x.RTCSessionDescription)(arguments[0]),P.apply(this,arguments)}};x.RTCPeerConnection.prototype[O]=B[O]});const S={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},R=x.RTCPeerConnection.prototype.getStats;x.RTCPeerConnection.prototype.getStats=function(){const[O,P,B]=arguments;return R.apply(this,[O||null]).then(J=>{if(b.version<53&&!P)try{J.forEach(te=>{te.type=S[te.type]||te.type})}catch(te){if(te.name!=="TypeError")throw te;J.forEach((z,re)=>{J.set(re,Object.assign({},z,{type:S[z.type]||z.type}))})}return J}).then(P,B)}}function Se(x){if(typeof x!="object"||!x.RTCPeerConnection||!x.RTCRtpSender||x.RTCRtpSender&&"getStats"in x.RTCRtpSender.prototype)return;const b=x.RTCPeerConnection.prototype.getSenders;b&&(x.RTCPeerConnection.prototype.getSenders=function(){const R=b.apply(this,[]);return R.forEach(O=>O._pc=this),R});const S=x.RTCPeerConnection.prototype.addTrack;S&&(x.RTCPeerConnection.prototype.addTrack=function(){const R=S.apply(this,arguments);return R._pc=this,R}),x.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Pe(x){if(typeof x!="object"||!x.RTCPeerConnection||!x.RTCRtpSender||x.RTCRtpSender&&"getStats"in x.RTCRtpReceiver.prototype)return;const b=x.RTCPeerConnection.prototype.getReceivers;b&&(x.RTCPeerConnection.prototype.getReceivers=function(){const S=b.apply(this,[]);return S.forEach(R=>R._pc=this),S}),g(x,"track",S=>(S.receiver._pc=S.srcElement,S)),x.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function we(x){x.RTCPeerConnection&&!("removeStream"in x.RTCPeerConnection.prototype)&&(x.RTCPeerConnection.prototype.removeStream=function(b){C("removeStream","removeTrack"),this.getSenders().forEach(S=>{S.track&&b.getTracks().includes(S.track)&&this.removeTrack(S)})})}function Te(x){x.DataChannel&&!x.RTCDataChannel&&(x.RTCDataChannel=x.DataChannel)}function Oe(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype.addTransceiver;b&&(x.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let S=arguments[1]&&arguments[1].sendEncodings;S===void 0&&(S=[]),S=[...S];const R=S.length>0;R&&S.forEach(P=>{if("rid"in P&&!/^[a-z0-9]{0,16}$/i.test(P.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in P&&!(parseFloat(P.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in P&&!(parseFloat(P.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const O=b.apply(this,arguments);if(R){const{sender:P}=O,B=P.getParameters();(!("encodings"in B)||B.encodings.length===1&&Object.keys(B.encodings[0]).length===0)&&(B.encodings=S,P.sendEncodings=S,this.setParametersPromises.push(P.setParameters(B).then(()=>{delete P.sendEncodings}).catch(()=>{delete P.sendEncodings})))}return O})}function _t(x){if(typeof x!="object"||!x.RTCRtpSender)return;const b=x.RTCRtpSender.prototype.getParameters;b&&(x.RTCRtpSender.prototype.getParameters=function(){const S=b.apply(this,arguments);return"encodings"in S||(S.encodings=[].concat(this.sendEncodings||[{}])),S})}function Ct(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype.createOffer;x.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}function me(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype.createAnswer;x.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>b.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):b.apply(this,arguments)}}function ge(x){if(typeof x=="object"&&x.RTCPeerConnection){if("getLocalStreams"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in x.RTCPeerConnection.prototype)){const b=x.RTCPeerConnection.prototype.addTrack;x.RTCPeerConnection.prototype.addStream=function(S){this._localStreams||(this._localStreams=[]),this._localStreams.includes(S)||this._localStreams.push(S),S.getAudioTracks().forEach(R=>b.call(this,R,S)),S.getVideoTracks().forEach(R=>b.call(this,R,S))},x.RTCPeerConnection.prototype.addTrack=function(S,...R){return R&&R.forEach(O=>{this._localStreams?this._localStreams.includes(O)||this._localStreams.push(O):this._localStreams=[O]}),b.apply(this,arguments)}}"removeStream"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.removeStream=function(b){this._localStreams||(this._localStreams=[]);const S=this._localStreams.indexOf(b);if(S===-1)return;this._localStreams.splice(S,1);const R=b.getTracks();this.getSenders().forEach(O=>{R.includes(O.track)&&this.removeTrack(O)})})}}function nt(x){if(typeof x=="object"&&x.RTCPeerConnection&&("getRemoteStreams"in x.RTCPeerConnection.prototype||(x.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in x.RTCPeerConnection.prototype))){Object.defineProperty(x.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(S){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=S),this.addEventListener("track",this._onaddstreampoly=R=>{R.streams.forEach(O=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(O))return;this._remoteStreams.push(O);const P=new Event("addstream");P.stream=O,this.dispatchEvent(P)})})}});const b=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){const S=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(R){R.streams.forEach(O=>{if(S._remoteStreams||(S._remoteStreams=[]),S._remoteStreams.indexOf(O)>=0)return;S._remoteStreams.push(O);const P=new Event("addstream");P.stream=O,S.dispatchEvent(P)})}),b.apply(S,arguments)}}}function Ce(x){if(typeof x!="object"||!x.RTCPeerConnection)return;const b=x.RTCPeerConnection.prototype,S=b.createOffer,R=b.createAnswer,O=b.setLocalDescription,P=b.setRemoteDescription,B=b.addIceCandidate;b.createOffer=function(te,z){const re=arguments.length>=2?arguments[2]:arguments[0],ce=S.apply(this,[re]);return z?(ce.then(te,z),Promise.resolve()):ce},b.createAnswer=function(te,z){const re=arguments.length>=2?arguments[2]:arguments[0],ce=R.apply(this,[re]);return z?(ce.then(te,z),Promise.resolve()):ce};let J=function(te,z,re){const ce=O.apply(this,[te]);return re?(ce.then(z,re),Promise.resolve()):ce};b.setLocalDescription=J,J=function(te,z,re){const ce=P.apply(this,[te]);return re?(ce.then(z,re),Promise.resolve()):ce},b.setRemoteDescription=J,J=function(te,z,re){const ce=B.apply(this,[te]);return re?(ce.then(z,re),Promise.resolve()):ce},b.addIceCandidate=J}function ut(x){const b=x&&x.navigator;if(b.mediaDevices&&b.mediaDevices.getUserMedia){const S=b.mediaDevices,R=S.getUserMedia.bind(S);b.mediaDevices.getUserMedia=O=>R(He(O))}!b.getUserMedia&&b.mediaDevices&&b.mediaDevices.getUserMedia&&(b.getUserMedia=(function(S,R,O){b.mediaDevices.getUserMedia(S).then(R,O)}).bind(b))}function He(x){return x&&x.video!==void 0?Object.assign({},x,{video:k(x.video)}):x}function Rt(x){if(!x.RTCPeerConnection)return;const b=x.RTCPeerConnection;x.RTCPeerConnection=function(S,R){if(S&&S.iceServers){const O=[];for(let P=0;P<S.iceServers.length;P++){let B=S.iceServers[P];B.urls===void 0&&B.url?(C("RTCIceServer.url","RTCIceServer.urls"),B=JSON.parse(JSON.stringify(B)),B.urls=B.url,delete B.url,O.push(B)):O.push(S.iceServers[P])}S.iceServers=O}return new b(S,R)},x.RTCPeerConnection.prototype=b.prototype,"generateCertificate"in b&&Object.defineProperty(x.RTCPeerConnection,"generateCertificate",{get:()=>b.generateCertificate})}function $t(x){typeof x=="object"&&x.RTCTrackEvent&&"receiver"in x.RTCTrackEvent.prototype&&!("transceiver"in x.RTCTrackEvent.prototype)&&Object.defineProperty(x.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Tt(x){const b=x.RTCPeerConnection.prototype.createOffer;x.RTCPeerConnection.prototype.createOffer=function(S){if(S){S.offerToReceiveAudio!==void 0&&(S.offerToReceiveAudio=!!S.offerToReceiveAudio);const R=this.getTransceivers().find(P=>P.receiver.track.kind==="audio");S.offerToReceiveAudio===!1&&R?R.direction==="sendrecv"?R.setDirection?R.setDirection("sendonly"):R.direction="sendonly":R.direction==="recvonly"&&(R.setDirection?R.setDirection("inactive"):R.direction="inactive"):S.offerToReceiveAudio!==!0||R||this.addTransceiver("audio",{direction:"recvonly"}),S.offerToReceiveVideo!==void 0&&(S.offerToReceiveVideo=!!S.offerToReceiveVideo);const O=this.getTransceivers().find(P=>P.receiver.track.kind==="video");S.offerToReceiveVideo===!1&&O?O.direction==="sendrecv"?O.setDirection?O.setDirection("sendonly"):O.direction="sendonly":O.direction==="recvonly"&&(O.setDirection?O.setDirection("inactive"):O.direction="inactive"):S.offerToReceiveVideo!==!0||O||this.addTransceiver("video",{direction:"recvonly"})}return b.apply(this,arguments)}}function Ft(x){typeof x!="object"||x.AudioContext||(x.AudioContext=x.webkitAudioContext)}var Ee=i(7539),le=i.n(Ee);function We(x){if(!x.RTCIceCandidate||x.RTCIceCandidate&&"foundation"in x.RTCIceCandidate.prototype)return;const b=x.RTCIceCandidate;x.RTCIceCandidate=function(S){if(typeof S=="object"&&S.candidate&&S.candidate.indexOf("a=")===0&&((S=JSON.parse(JSON.stringify(S))).candidate=S.candidate.substring(2)),S.candidate&&S.candidate.length){const R=new b(S),O=le().parseCandidate(S.candidate);for(const P in O)P in R||Object.defineProperty(R,P,{value:O[P]});return R.toJSON=function(){return{candidate:R.candidate,sdpMid:R.sdpMid,sdpMLineIndex:R.sdpMLineIndex,usernameFragment:R.usernameFragment}},R}return new b(S)},x.RTCIceCandidate.prototype=b.prototype,g(x,"icecandidate",S=>(S.candidate&&Object.defineProperty(S,"candidate",{value:new x.RTCIceCandidate(S.candidate),writable:"false"}),S))}function it(x){!x.RTCIceCandidate||x.RTCIceCandidate&&"relayProtocol"in x.RTCIceCandidate.prototype||g(x,"icecandidate",b=>{if(b.candidate){const S=le().parseCandidate(b.candidate.candidate);S.type==="relay"&&(b.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[S.priority>>24])}return b})}function je(x,b){if(!x.RTCPeerConnection)return;"sctp"in x.RTCPeerConnection.prototype||Object.defineProperty(x.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const S=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,b.browser==="chrome"&&b.version>=76){const{sdpSemantics:R}=this.getConfiguration();R==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(R){if(!R||!R.sdp)return!1;const O=le().splitSections(R.sdp);return O.shift(),O.some(P=>{const B=le().parseMLine(P);return B&&B.kind==="application"&&B.protocol.indexOf("SCTP")!==-1})}(arguments[0])){const R=function(te){const z=te.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(z===null||z.length<2)return-1;const re=parseInt(z[1],10);return re!=re?-1:re}(arguments[0]),O=function(te){let z=65536;return b.browser==="firefox"&&(z=b.version<57?te===-1?16384:2147483637:b.version<60?b.version===57?65535:65536:2147483637),z}(R),P=function(te,z){let re=65536;b.browser==="firefox"&&b.version===57&&(re=65535);const ce=le().matchPrefix(te.sdp,"a=max-message-size:");return ce.length>0?re=parseInt(ce[0].substring(19),10):b.browser==="firefox"&&z!==-1&&(re=2147483637),re}(arguments[0],R);let B;B=O===0&&P===0?Number.POSITIVE_INFINITY:O===0||P===0?Math.max(O,P):Math.min(O,P);const J={};Object.defineProperty(J,"maxMessageSize",{get:()=>B}),this._sctp=J}return S.apply(this,arguments)}}function Fe(x){if(!x.RTCPeerConnection||!("createDataChannel"in x.RTCPeerConnection.prototype))return;function b(R,O){const P=R.send;R.send=function(){const B=arguments[0],J=B.length||B.size||B.byteLength;if(R.readyState==="open"&&O.sctp&&J>O.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+O.sctp.maxMessageSize+" bytes)");return P.apply(R,arguments)}}const S=x.RTCPeerConnection.prototype.createDataChannel;x.RTCPeerConnection.prototype.createDataChannel=function(){const R=S.apply(this,arguments);return b(R,this),R},g(x,"datachannel",R=>(b(R.channel,R.target),R))}function Ht(x){if(!x.RTCPeerConnection||"connectionState"in x.RTCPeerConnection.prototype)return;const b=x.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(b,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(S){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),S&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=S)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(S=>{const R=b[S];b[S]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=O=>{const P=O.target;if(P._lastConnectionState!==P.connectionState){P._lastConnectionState=P.connectionState;const B=new Event("connectionstatechange",O);P.dispatchEvent(B)}return O},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),R.apply(this,arguments)}})}function St(x,b){if(!x.RTCPeerConnection||b.browser==="chrome"&&b.version>=71||b.browser==="safari"&&b.version>=605)return;const S=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(R){if(R&&R.sdp&&R.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const O=R.sdp.split(`
`).filter(P=>P.trim()!=="a=extmap-allow-mixed").join(`
`);x.RTCSessionDescription&&R instanceof x.RTCSessionDescription?arguments[0]=new x.RTCSessionDescription({type:R.type,sdp:O}):R.sdp=O}return S.apply(this,arguments)}}function Dt(x,b){if(!x.RTCPeerConnection||!x.RTCPeerConnection.prototype)return;const S=x.RTCPeerConnection.prototype.addIceCandidate;S&&S.length!==0&&(x.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(b.browser==="chrome"&&b.version<78||b.browser==="firefox"&&b.version<68||b.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():S.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function oe(x,b){if(!x.RTCPeerConnection||!x.RTCPeerConnection.prototype)return;const S=x.RTCPeerConnection.prototype.setLocalDescription;S&&S.length!==0&&(x.RTCPeerConnection.prototype.setLocalDescription=function(){let R=arguments[0]||{};if(typeof R!="object"||R.type&&R.sdp)return S.apply(this,arguments);if(R={type:R.type,sdp:R.sdp},!R.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":R.type="offer";break;default:R.type="answer"}return R.sdp||R.type!=="offer"&&R.type!=="answer"?S.apply(this,[R]):(R.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(O=>S.apply(this,[O]))})}(function({window:x}={},b={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const S=T,R=function(P){const B={browser:null,version:null};if(P===void 0||!P.navigator||!P.navigator.userAgent)return B.browser="Not a browser.",B;const{navigator:J}=P;if(J.mozGetUserMedia)B.browser="firefox",B.version=p(J.userAgent,/Firefox\/(\d+)\./,1);else if(J.webkitGetUserMedia||P.isSecureContext===!1&&P.webkitRTCPeerConnection)B.browser="chrome",B.version=p(J.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!P.RTCPeerConnection||!J.userAgent.match(/AppleWebKit\/(\d+)\./))return B.browser="Not a supported browser.",B;B.browser="safari",B.version=p(J.userAgent,/AppleWebKit\/(\d+)\./,1),B.supportsUnifiedPlan=P.RTCRtpTransceiver&&"currentDirection"in P.RTCRtpTransceiver.prototype}return B}(x),O={browserDetails:R,commonShim:l,extractVersion:p,disableLog:v,disableWarnings:E,sdp:Ee};switch(R.browser){case"chrome":if(!o||!G||!b.shimChrome)return S("Chrome shim is not included in this adapter release."),O;if(R.version===null)return S("Chrome shim can not determine version, not shimming."),O;S("adapter.js shimming chrome."),O.browserShim=o,Dt(x,R),oe(x),F(x,R),X(x),G(x,R),q(x),ie(x,R),W(x),K(x),ne(x),Z(x,R),We(x),it(x),Ht(x),je(x,R),Fe(x),St(x,R);break;case"firefox":if(!a||!Be||!b.shimFirefox)return S("Firefox shim is not included in this adapter release."),O;S("adapter.js shimming firefox."),O.browserShim=a,Dt(x,R),oe(x),se(x,R),Be(x,R),Ae(x),we(x),Se(x),Pe(x),Te(x),Oe(x),_t(x),Ct(x),me(x),We(x),Ht(x),je(x,R),Fe(x);break;case"safari":if(!c||!b.shimSafari)return S("Safari shim is not included in this adapter release."),O;S("adapter.js shimming safari."),O.browserShim=c,Dt(x,R),oe(x),Rt(x),Tt(x),Ce(x),ge(x),nt(x),$t(x),ut(x),Ft(x),We(x),it(x),je(x,R),Fe(x),St(x,R);break;default:S("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),i(8520);const j=()=>typeof RTCPeerConnection=="function";var V,fe;(function(x){x[x.TRACE=0]="TRACE",x[x.DEBUG=1]="DEBUG",x[x.INFO=2]="INFO",x[x.WARN=3]="WARN",x[x.ERROR=4]="ERROR",x[x.SILENT=5]="SILENT"})(V||(V={})),function(x){x.SPADE="SPADE",x.TIME="Time",x.WEBRTC="WebRTC",x.EMITTER="Emitter",x.MEDIA="Media",x.SUBSCRIPTION="StageSubscription",x.PUBLICATION="StagePublication",x.CONNECTION="StageConnection",x.SOCKET="StageSocket",x.BROADCAST_STAGE_CLIENT="BroadcastStageClient",x.STAGE="Stage",x.REMOTE_PARTICIPANT="RemoteParticipant",x.LOCAL_PARTICIPANT="LocalParticipant",x.CONFIGURATION="Configuration",x.REMOTE_PLAYBACK="RemotePlaybackController",x.REMOTE_STAGE_STREAM="RemoteStageStream"}(fe||(fe={}));const Ie=1007,Ue=12e4,dt=3e5;class yt extends Error{constructor({name:b,message:S,code:R,details:O,cause:P,params:B}){super(S),Error.captureStackTrace&&Error.captureStackTrace(this,yt),this.name=b||"BroadcastClientError",this.message=S,this.code=R,this.details=O,this.cause=P,this.params=B}}const Dn={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},Le={name:"CameraError",code:2e3,message:"Camera could not be captured"},Lt={name:"InputError",code:3e3,message:"Input could not be attached"},rt={name:"AddDeviceError",code:4e3,message:"Device is missing"},xt={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},sn={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},Jt={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},De={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},tt={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},Et={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},wt={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},Pn={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},Xr={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},lr={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},zn={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},dn={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},tn={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},Cn={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},Rn={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},yr={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},hi={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},si={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},Co={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},mu={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},Vd={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},rf={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},sf={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},ve={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},Ke={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},pt={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},vt={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},Xe={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var zt,Qt,hn,mn,Un,Jn,_n,br,Gr,En=function(x,b,S,R){if(S==="a"&&!R)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!R:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?R:S==="a"?R.call(x):R?R.value:b.get(x)},Bn=function(x,b,S,R,O){if(typeof b=="function"?x!==b||!O:!b.has(x))throw new TypeError("Cannot write private member to an object whose class did not declare it");return b.set(x,S),S};const Er=1920,on=1080,Wi=V.ERROR,Sr={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},Fs={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},Qn={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},ur={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},Pl={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},Si={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},Ro={reconnect:!1,timeout:Ue};function Dl(x){var b,S;if(typeof x!="string"&&x!==void 0)throw new yt(Co);if(x){if(x.startsWith("https"))return x;{const R=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(x);if(((b=R==null?void 0:R.groups)===null||b===void 0?void 0:b.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(S=R==null?void 0:R.groups)===null||S===void 0?void 0:S.id)return`https://${R.groups.id}.webrtc.live-video.net:4443`;throw new yt(mu)}}return""}class Ki{constructor(b,S,R=Sr,O,P=Ro){this.LOG_LEVEL=V,this.BASIC_LANDSCAPE=Sr,this.BASIC_PORTRAIT=Fs,this.BASIC_FULL_HD_LANDSCAPE=Qn,this.BASIC_FULL_HD_PORTRAIT=ur,this.STANDARD_LANDSCAPE=Pl,this.STANDARD_PORTRAIT=Si,zt.set(this,void 0),Qt.set(this,void 0),hn.set(this,Sr),mn.set(this,void 0),Un.set(this,Ro),Jn.set(this,B=>{if(!B)throw new yt(Object.assign(Object.assign({},si),{details:"missing stream configuration"}));if(!(B.maxBitrate<=8500&&B.maxBitrate>=200))throw new yt(Object.assign(Object.assign({},si),{details:"maxBitrate must be between 200 and 8500"}));if(!(B.maxFramerate<=60&&B.maxFramerate>=10))throw new yt(Object.assign(Object.assign({},si),{details:"maxFramerate must be between 10 and 60"}));const J=B.maxResolution.width,te=B.maxResolution.height;if(J>Er||te>Er||J<160||te<160||J===Er&&te>on||te===Er&&J>on)throw new yt(Object.assign(Object.assign({},si),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))}),_n.set(this,B=>{if(!B)return;const J=Number(B),te=Number.isInteger(J),z=J>=V.TRACE,re=J<=V.SILENT;if(!te||!z||!re)throw new yt(Vd)}),br.set(this,B=>{if(B&&typeof B!="object")throw new yt(rf)}),Gr.set(this,B=>{if(!B)return;if(typeof B!="object"||typeof B.reconnect!="boolean")throw new yt(ve);const{timeout:J}=B;if(J!==void 0&&(Number.isNaN(J)||typeof J!="number"||J<1e4||J>dt))throw new yt(Ke)}),En(this,br,"f").call(this,O),En(this,_n,"f").call(this,S),En(this,Jn,"f").call(this,R),Bn(this,zt,b),Bn(this,Qt,S),Bn(this,hn,R),Bn(this,mn,O),Bn(this,Un,P)}get ingestEndpoint(){return En(this,zt,"f")}set ingestEndpoint(b){Bn(this,zt,Dl(b))}get streamConfig(){return En(this,hn,"f")}set streamConfig(b){En(this,Jn,"f").call(this,b),Bn(this,hn,b)}get logLevel(){return En(this,Qt,"f")}set logLevel(b){En(this,_n,"f").call(this,b),Bn(this,Qt,b)}get logger(){return En(this,mn,"f")}set logger(b){En(this,br,"f").call(this,b),Bn(this,mn,b)}get networkReconnectConfig(){return En(this,Un,"f")}set networkReconnectConfig(b){En(this,Gr,"f").call(this,b),Bn(this,Un,b)}}zt=new WeakMap,Qt=new WeakMap,hn=new WeakMap,mn=new WeakMap,Un=new WeakMap,Jn=new WeakMap,_n=new WeakMap,br=new WeakMap,Gr=new WeakMap;var vn,sc=i(6729),Ll=i(1206);(function(x){x.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",x.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",x.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",x.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",x.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",x.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",x.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",x.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",x.PUBLISH="ivs_broadcast_multihost_publish",x.UNPUBLISH="ivs_broadcast_multihost_unpublish",x.SUBSCRIBE="ivs_broadcast_multihost_subscribe",x.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",x.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",x.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",x.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",x.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",x.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",x.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",x.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",x.FIRST_FRAME="ivs_broadcast_multihost_first_frame",x.JOIN="ivs_broadcast_multihost_join",x.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",x.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",x.JOIN_ENDED="ivs_broadcast_multihost_join_ended",x.LEAVE="ivs_broadcast_multihost_leave",x.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",x.SERVER_REQUEST="ivs_broadcast_multihost_server_request",x.TRACE="ivs_broadcast_stage_trace",x.ERROR="ivs_broadcast_error",x.MINUTE="ivs_broadcast_multihost_minute",x.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",x.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",x.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",x.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",x.EDP_PONG="ivs_broadcast_multihost_edp_rtt",x.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",x.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",x.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",x.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",x.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state"})(vn||(vn={}));class vr{constructor(b,S,R,O){let P="unknown";if(S.stageARN&&S.stageARN.startsWith("arn:aws:ivs:")){const B=S.stageARN.split(":");B.length===6&&(P=B[4])}this.event=b,this.properties={client_time:new Date().toISOString(),customer_id:P,device_software:window.navigator.userAgent,multihost_id:S.stageARN,participant_id:S.participantID,participant_user_id:S.userID,platform:"web",sdk_version:"1.19.0",stage_arn:S.stageARN,trace_id:R.value},S.attrGsRole&&(this.properties.token_attribute_0=S.attrGsRole),S.attrGsSessionId&&(this.properties.token_attribute_1=S.attrGsSessionId),this.critical=O}}class zd extends vr{constructor(b){super(vn.ERROR,b.token,b.traceId,!0),Object.assign(this.properties,{code:b.code,tag:b.tag,description:b.message,remote_participant_id:b.remoteParticipantId,request_uuid:b.requestUUID,is_nominal:b.nominal,is_fatal:b.fatal,details:b.details,location:b.location})}}const Ho="IVS_CLIENT_OVERRIDES";function Gd(x){const b=window[Ho];return typeof b=="object"?b[x]:x==="logLevel"?window.STAGES_LOG_LEVEL:x==="appLabel"?window.IVS_APP_LABEL:x==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function of(x){const b=Gd(x);if(typeof b=="string")return b}function gu(x){const b=Gd(x);if(typeof b=="boolean")return b}function Up(){const x=Gd("logLevel");if(typeof x=="number"&&Object.values(V).includes(x))return x}function Fp(){return gu("disableXdp")}function Ju(){return gu("enableXdpPublish")}function ha(){return gu("preferMainProfile")}function af(){return gu("enableInitialLayerOnSdp")}var dr=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};const Iy=4;class Mg{constructor(b="https://broadcast.stats.live-video.net/"){this.spadeUrl=b}send(b,S=!1){return dr(this,void 0,void 0,function*(){const R=Date.now();for(const J of b)J.properties.batch_time_millis=R;const O=this.b64EncodeUnicode(JSON.stringify(b)),P={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},B=`data=${O}`;S?navigator.sendBeacon(this.spadeUrl,B):dr(this,void 0,void 0,function*(){try{yield function(J,te,z={},re=""){return dr(this,void 0,void 0,function*(){const ce=new XMLHttpRequest;return ce.open(J,te,!0),z&&Object.keys(z).forEach(de=>{z.hasOwnProperty(de)&&ce.setRequestHeader(de,z[de])}),new Promise((de,Me)=>{ce.onreadystatechange=()=>{ce.readyState===Iy&&(ce.status>=200&&ce.status<300?de(ce.responseText):Me(new Error(`Spade ${J} ${te} responded ${ce.status}
${ce.responseText}`)))},ce.send(re)})})}("POST",this.spadeUrl,P,B)}catch{}})})}b64EncodeUnicode(b){return btoa(encodeURIComponent(b).replace(/%([0-9A-F]{2})/g,(S,R)=>String.fromCharCode(+`0x${R}`)))}}function Ul(x){if(!x)throw new Error("SpadeClient is not defined")}function Bp(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,x=>{const b=16*Math.random()|0;return(x==="x"?b:3&b|8).toString(16)})}class Qu{constructor(){this.sharedProperties={},this.spadeClient={},this.queuedEvents=[],this.genSessionId();const b=function(){const R=of("analyticsPostUrl");if(R!==void 0)return R}()||"https://broadcast.stats.live-video.net/",S=function(){const R=of("appLabel");if(R!==void 0)return R.substring(0,64)}();this.spadeClient=new Mg(b),this.initSharedProperties({appLabel:S})}start(){this.flushInterval||(this.flushInterval=window.setInterval(()=>{this.flushEvents()},1e3))}stop(b){let S=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,b&&(this.queuedEvents=this.queuedEvents.filter(R=>R.critical),S=!0),this.flushEvents(S),this.genSessionId()}trackEvent(b,S=!1){let R=this.sharedProperties;S&&(R={global_session_id:Qu.globalSessionId,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version}),"data"in b?(b.data.properties=Object.assign({},R,b.data.properties),this.queuedEvents.push(b.data)):(b.properties=Object.assign({},R,b.properties),this.queuedEvents.push(b))}trackEventNoSharedProps(b){this.trackEvent(b,!0)}trackErrorAndThrow(b){throw this.trackError(b),b}trackError(b){this.trackEvent(new zd(b))}batchEvents(b){Ul(this.spadeClient);const S=b.map(R=>(R.data.properties=Object.assign({},this.sharedProperties,R.data.properties),R.data));this.spadeClient.send(S)}initSharedProperties({appLabel:b}){const S=Ll.getParser(navigator.userAgent),R=this.parseSemver(String(S.getBrowserVersion()));this.sharedProperties={browser:navigator.appVersion,browser_family:S.getBrowserName().toLowerCase(),browser_version:`${R.major}.${R.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:S.getOSName(),os_version:String(S.getOSVersion()),platform:"web",global_session_id:Qu.globalSessionId,session_id:this.sessionId,sdk_version:"1.19.0",user_agent:navigator.userAgent},b&&(this.sharedProperties.app_label=b)}genSessionId(){this.sessionId=Bp(),this.sharedProperties.session_id=this.sessionId}flushEvents(b=!1){Ul(this.spadeClient),this.queuedEvents.length>0&&this.spadeClient.send(this.queuedEvents,b),this.queuedEvents=[]}parseSemver(b){const S=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(b)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(b)||/^(\d+)$/.exec(b)||[];return{major:parseInt(S[1],10)||0,minor:parseInt(S[2],10)||0,patch:parseInt(S[3],10)||0}}getSessionId(){return this.sessionId}}Qu.globalSessionId=Bp();class Tr{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const R=this.transformProperties(b,S);this.data={event:oi.CONGESTION_TIME,properties:R}}}class Fl{constructor(b,S,R){this.transformProperties=(P,B,J)=>({duration:(P.getTime()-((B==null?void 0:B.getTime())||0))/1e3,ecn_negotiated:!1,ingest_session_id:J});const O=this.transformProperties(b,S,R);this.data={event:oi.CONNECTION_ESTABLISHED,properties:O}}}class N_{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const R=this.transformProperties(b,S);this.data={event:oi.CONNECTION_RTT,properties:R}}}class Ig{constructor(b){this.transformProperties=R=>{var O;return{is_fatal:(O=R.isFatal)!==null&&O!==void 0&&O,value:R.value,code:R.code,description:R.description}};const S=this.transformProperties(b);this.data={event:oi.ERROR,properties:S}}}class Og{constructor(b,S){this.transformProperties=(O,P)=>({type:O,input_device_id:P.deviceId,position:P.facingMode||"unknown"});const R=this.transformProperties(b,S);this.data={event:oi.INPUT_DEVICE_ATTACHED,properties:R}}}class jp{constructor(b,S){this.transformProperties=(O,P)=>({type:O,input_device_id:P.deviceId,position:P.facingMode||"unknown"});const R=this.transformProperties(b,S);this.data={event:oi.INPUT_DEVICE_DETACHED,properties:R}}}class Qc{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const R=this.transformProperties(b,S);this.data={event:oi.MEASURED_BITRATE,properties:R}}}class kg{constructor(b,S){this.transformProperties=(O,P)=>({minutes_logged:Math.round((O.timestamp-P)/6e4)});const R=this.transformProperties(b,S);this.data={event:oi.MINUTE_BROADCAST,properties:R}}}class cf{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const R=this.transformProperties(b,S);this.data={event:oi.RECOMMENDED_BITRATE,properties:R}}}class Bl{constructor(b){this.transformProperties=R=>({codec:R.mimeType,bitrate:0,sample_rate:R.clockRate,channel_count:R.channels});const S=this.transformProperties(b);this.data={event:oi.SESSION_AUDIO_ENCODER_CONFIGURED,properties:S}}}class jl{constructor(b){this.transformProperties=R=>({codec:"audio",bitrate:32e3,sample_rate:R.sampleRate,channel_count:R.channelCount});const S=this.transformProperties(b);this.data={event:oi.SESSION_AUDIO_PROPERTIES,properties:S}}}class $p{constructor(b,S,R){this.transformProperties=(P,B,J)=>({codec:J.mimeType,codec_profile:B.profile,codec_level:B.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:P.width,height:P.height,bframe_count:0,target_fps:P.frameRate});const O=this.transformProperties(b,S,R);this.data={event:oi.SESSION_VIDEO_ENCODER_CONFIGURED,properties:O}}}class Hp{constructor(b){this.transformProperties=R=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:R.width,height:R.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:R.frameRate});const S=this.transformProperties(b);this.data={event:oi.SESSION_VIDEO_PROPERTIES,properties:S}}}class Ng{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const R=this.transformProperties(b,S);this.data={event:oi.SOURCE_AUDIO_LATENCY,properties:R}}}class Oy{constructor(b,S){this.transformProperties=(O,P)=>({sum:O.sum,median:O.median(),min:O.min,max:O.max,p90:O.percentile(.9),event_count:O.data.length,period:P});const R=this.transformProperties(b,S);this.data={event:oi.SOURCE_VIDEO_LATENCY,properties:R}}}class oc{constructor(b,S){this.transformProperties=({protocol:O,hostname:P,port:B},J)=>({protocol:O,endpoint_host:P,endpoint_port:B,reason:J});const R=this.transformProperties(b,S);this.data={event:oi.START_BROADCAST,properties:R}}}class P_{constructor(b){this.transformProperties=({protocol:R,hostname:O,port:P})=>({protocol:R,endpoint_host:O,endpoint_port:P});const S=this.transformProperties(b);this.data={event:oi.STOP_BROADCAST,properties:S}}}class Vp{constructor(b){this.transformProperties=R=>({bytes_sent:R.bytesSent,header_bytes_sent:R.headerBytesSent,nack_count:R.nackCount,packets_sent:R.packetsSent,retransmitted_bytes_sent:R.retransmittedBytesSent,retransmitted_packets_sent:R.retransmittedPacketsSent});const S=this.transformProperties(b);this.data={event:oi.WEBRTC_AUDIO_STATS,properties:S}}}class ac{constructor(b){this.transformProperties=R=>({bytes_sent:R.bytesSent,fir_count:R.firCount,frames_encoded:R.framesEncoded,frames_sent:R.framesSent,header_bytes_sent:R.headerBytesSent,huge_frames_sent:R.hugeFramesSent,key_frames_encoded:R.keyFramesEncoded,nack_count:R.nackCount,packets_sent:R.packetsSent,pli_count:R.pliCount,quality_limitation_reason:R.qualityLimitationReason,quality_limitation_resolution_changes:R.qualityLimitationResolutionChanges,retransmitted_bytes_sent:R.retransmittedBytesSent,retransmitted_packets_sent:R.retransmittedPacketsSent,total_encode_time:R.totalEncodeTime,total_encoded_bytes_target:R.totalEncodedBytesTarget,total_packet_send_delay:R.totalPacketSendDelay});const S=this.transformProperties(b);this.data={event:oi.WEBRTC_VIDEO_STATS,properties:S}}}var oi,Zc;(function(x){x.START_BROADCAST="ivs_broadcast_start_broadcast",x.STOP_BROADCAST="ivs_broadcast_stop_broadcast",x.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",x.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",x.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",x.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",x.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",x.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",x.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",x.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",x.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",x.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",x.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",x.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",x.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",x.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",x.CONGESTION_TIME="ivs_broadcast_congestion_time",x.BUFFER_DURATION="ivs_broadcast_buffer_duration",x.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",x.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",x.CONNECTION_RTT="ivs_broadcast_connection_rtt",x.ERROR="ivs_broadcast_error"})(oi||(oi={})),function(x){x.USER_INITIATED="user-initiated",x.NETWORK_DISCONNECT="network-disconnect"}(Zc||(Zc={}));const zp={[V.INFO]:"#528bff",[V.WARN]:"#ffb31a",[V.DEBUG]:"#00f593",[V.ERROR]:"#ff4f4d",[V.TRACE]:"",[V.SILENT]:"",[fe.SPADE]:"#a970ff",[fe.TIME]:"#53535f",[fe.WEBRTC]:"#0e9bd8",[fe.SUBSCRIPTION]:"#ffc400",[fe.CONNECTION]:"#ff5edb",[fe.SOCKET]:"#8585ff",[fe.EMITTER]:"#adadb8",[fe.LOCAL_PARTICIPANT]:"#1DD21D",[fe.STAGE]:"#EC9806",[fe.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},$l=({label:x})=>`background: ${zp[x]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,D_=Object.entries(V),lf=(x,b,S)=>{const R=$l({label:x}),[O]=D_.find(([,Qe])=>Qe===Number(x))||[],P=`%c${O}`,B=$l({label:b}),J=`%c${b}`,te=$l({label:fe.TIME}),z=`%c[${new Date().toISOString()}]`,re=$l({label:"details"}),ce=`%c[${S}]`,de=[z,P,J],Me=[te,R,B];return S&&(de.push(ce),Me.push(re)),[de.join(""),...Me]},ky={debug(x){console.groupCollapsed(...lf(V.DEBUG,x.scope,x.label)),console.debug(x.msg,Object.assign(Object.assign({},x),{level:"debug"})),console.groupEnd()},info(x){console.groupCollapsed(...lf(V.INFO,x.scope,x.label)),console.info(x.msg,Object.assign(Object.assign({},x),{level:"info"})),console.groupEnd()},warn(x){console.groupCollapsed(...lf(V.WARN,x.scope,x.label)),console.warn(x.msg,Object.assign(Object.assign({},x),{level:"warn"})),console.groupEnd()},error(x){console.groupCollapsed(...lf(V.ERROR,x.scope,x.label)),console.error(x),console.groupEnd()}};var vu=function(x,b){var S={};for(var R in x)Object.prototype.hasOwnProperty.call(x,R)&&b.indexOf(R)<0&&(S[R]=x[R]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function"){var O=0;for(R=Object.getOwnPropertySymbols(x);O<R.length;O++)b.indexOf(R[O])<0&&Object.prototype.propertyIsEnumerable.call(x,R[O])&&(S[R[O]]=x[R[O]])}return S};Object.entries(V);class qd{constructor(b=Wi,S=ky){this.logLevel=b,this.loggerInstance=S}debug(b){var S,R;this.logLevel>V.DEBUG||(R=(S=this.loggerInstance).debug)===null||R===void 0||R.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{level:"debug"}))))}info(b){var S,R;this.logLevel>V.INFO||(R=(S=this.loggerInstance).info)===null||R===void 0||R.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{level:"info"}))))}warn(b){var S,R;this.logLevel>V.WARN||(R=(S=this.loggerInstance).warn)===null||R===void 0||R.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{level:"warn"}))))}error(b){var S,R,{err:O}=b,P=vu(b,["err"]);this.logLevel>V.ERROR||(R=(S=this.loggerInstance).error)===null||R===void 0||R.call(S,Object.assign({err:O},P))}}class Ks{constructor(b,S){this.logger=b,this.scope=S}debug(b){var S,R;(R=(S=this.logger).debug)===null||R===void 0||R.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{scope:this.scope}))))}info(b){var S,R;(R=(S=this.logger).info)===null||R===void 0||R.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{scope:this.scope}))))}warn(b){var S,R;(R=(S=this.logger).warn)===null||R===void 0||R.call(S,JSON.parse(JSON.stringify(Object.assign(Object.assign({},b),{scope:this.scope}))))}error(b){var S,R,{err:O}=b,P=vu(b,["err"]);(R=(S=this.logger).error)===null||R===void 0||R.call(S,Object.assign(Object.assign({err:O},P),{scope:this.scope}))}unwrap(){return this.logger}}class Yi{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(b){(this.min===0||b<this.min)&&(this.min=b),b>=this.max&&(this.max=b),this.data.push(b),this.sum+=b}median(){this.data.sort();const b=this.data.length>>1;return this.data.length%2==0?this.data[b-1]+this.data[b]>>1:this.data[b]}percentile(b){if(this.data.length===0)return 0;if(b<=0)return this.data[0];if(b>=1)return this.data[this.data.length-1];const S=(this.data.length-1)*b,R=Math.floor(S),O=R+1,P=S%1;return O>=this.data.length?this.data[R]:this.data[R]*(1-P)+this.data[O]*P}}var ja=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};class Zu{constructor(b,S,R,O){this.peerClient=b,this.broadcastCanvasManager=S,this.analyticsTracker=O,this.logger=new Ks(R,fe.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval(()=>{this.collectSamples()},1e3),this.trackSamplesTimerId=window.setInterval(()=>{this.trackSamples()},3e4),this.trackPeerConnectionStatsTimerId=window.setInterval(()=>{this.trackPeerConnectionStats()},6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return ja(this,void 0,void 0,function*(){(yield this.peerClient.getReports()).forEach(b=>{if(b.type==="outbound-rtp")switch(b.kind){case"audio":this.analyticsTracker.trackEvent(new Vp(b));break;case"video":{const S=new ac(b),R=new kg(b,this.startTimestamp);this.analyticsTracker.batchEvents([S,R]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:b.kind})}})})}collectSamples(){return ja(this,void 0,void 0,function*(){let b=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach(R=>{switch(R.type){case"candidate-pair":R.nominated&&(this.rttSamples.push(R.currentRoundTripTime),this.recommendedBitrateSamples.push(R.availableOutgoingBitrate));break;case"outbound-rtp":b+=R.bytesSent||0,this.startTimestamp===0&&R.kind==="video"&&(this.startTimestamp=R.timestamp)}});const S=8*Math.round(b-this.previousBytesSent);this.previousBytesSent=b,this.measuredBitrateSamples.push(S)})}trackSamples(){const S=new Ng(this.audioLatencySamples,30),R=new Oy(this.videoLatencySamples,30),O=new Tr(this.congestionTimeSamples,30),P=new Qc(this.measuredBitrateSamples,30),B=new cf(this.recommendedBitrateSamples,30),J=new N_(this.rttSamples,30);this.analyticsTracker.batchEvents([S,R,O,P,B,J]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new Yi,this.videoLatencySamples=new Yi,this.congestionTimeSamples=new Yi,this.measuredBitrateSamples=new Yi,this.recommendedBitrateSamples=new Yi,this.rttSamples=new Yi}}const As={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},Ms="connectionStateChange",el="sdpNegotiated",fa="clientError",ed="seiMessageReceived",st="transformError";var et;(function(x){x.CLOSED="closed",x.COMPLETED="completed",x.CONNECTED="connected",x.CONNECTING="connecting",x.DISCONNECTED="disconnected",x.FAILED="failed",x.IDLE="idle",x.NEW="new",x.NONE="none"})(et||(et={}));const It=x=>{const b=P=>{var B;return!((B=P.deviceId)===null||B===void 0)&&B.startsWith("web-contents-media-stream")?"tab":void 0},S=P=>{var B;return!((B=P.deviceId)===null||B===void 0)&&B.startsWith("window")&&P.displaySurface==="window"?"window":void 0},R=P=>{var B;return!((B=P.deviceId)===null||B===void 0)&&B.startsWith("screen")&&P.displaySurface==="monitor"?"screen":void 0};return(b(O=x)||S(O)||R(O)?void 0:"camera")||R(x)||S(x)||b(x)||"unknown";var O};function nn(x,b){return x.find(S=>S.kind===b)}var Gt;(function(x){x.VIDEO="video",x.AUDIO="audio"})(Gt||(Gt={}));class qr{constructor(){this.mediaTracks=new Map([[Gt.VIDEO,void 0],[Gt.AUDIO,void 0]])}setTrack(b,S){this.mediaTracks.set(b,S)}getTrack(b){return this.mediaTracks.get(b)}}class Bs{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(b){return b?(b.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map(S=>S.trim()).filter(Boolean).forEach(S=>{const R=S.split("=");if(R.length===2)switch(R[0]){case"level-asymmetry-allowed":R[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":R[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(R[1]),this.level=this.getLevelFromId(R[1])}}),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(b){const S=b.substr(0,2),R=b.substr(2,2);switch(S.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return R==="00"?"high 10":"high 10 intra";case"7a":return R==="00"?"high 42":"high 42 intra";case"f4":return R==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(b){return parseInt(b.substr(4,2),16)}}function tl(x){return btoa(JSON.stringify(x))}var Fr,Wd=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};(function(x){x.IDLE="idle",x.EXECUTING="executing",x.RECONNECTING="reconnecting"})(Fr||(Fr={}));class Kd{constructor(b,S=12e4,R,O){this.state=Fr.IDLE,this.failureCallback=()=>{},this.peerClient=b,this.timeout=S,this.logger=R,this.emitter=O}onFailure(b){this.failureCallback=b}setStartConfig(b,S){this.ingestEndpoint=b,this.streamKey=S}execute(){const{id:b}=this;this.state===Fr.IDLE&&(this.state=Fr.EXECUTING,this.emitter.emit(As.CONNECTION_STATE_CHANGE,et.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:b}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(b){this.timeoutTimerId=window.setTimeout(()=>{this.state!==Fr.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(As.CONNECTION_STATE_CHANGE,et.FAILED),this.failureCallback())},b)}stop(){this.state=Fr.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return Wd(this,void 0,void 0,function*(){if(this.ingestEndpoint&&this.streamKey){const b=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),b===et.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(S){throw this.logger.error({err:S}),S}}})}isActive(){return this.state!==Fr.IDLE}}class Ao extends Kd{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let b=5e3;const S=()=>Wd(this,void 0,void 0,function*(){if(this.state===Fr.EXECUTING)try{this.state=Fr.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:b}),this.state=Fr.EXECUTING,this.currentTimeoutId=window.setTimeout(S,b),b*=2}});this.currentTimeoutId=window.setTimeout(S,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class Yd extends Kd{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>Wd(this,void 0,void 0,function*(){if(navigator.onLine&&this.state===Fr.EXECUTING){this.state=Fr.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=Fr.EXECUTING}}})}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class Pg{static create(b,S=Ro,R,O){const{reconnect:P,timeout:B}=S;if(P){const J=Ll.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(J)&&navigator.connection?new Yd(b,B,R,O):new Ao(b,B,R,O)}}}var Ys,Xs=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})},Hl=function(x,b,S,R){if(S==="a"&&!R)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!R:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?R:S==="a"?R.call(x):R?R.value:b.get(x)};const Wr=x=>!!x;function Ac(x){if(!x)throw new Error("PeerConnection is not defined")}const td={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class Gp{constructor(b,S,R,O,P){this.config=b,this.emitter=S,this.mediaStreamManager=R,this.analyticsTracker=P,this.establishConnection=(B,J)=>Xs(this,void 0,void 0,function*(){var te,z,re;Ac(this.peerConnection);try{const ce=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(ce),yield this.sendSetupRequest(B,J,ce)}catch(ce){if(ce instanceof Error){(te=(re=ce).code)!==null&&te!==void 0||(re.code=Cn.code);const de=new yt(Object.assign(Object.assign({},Cn),{name:ce.name,message:ce.message,code:ce==null?void 0:ce.code,cause:ce}));throw!((z=this.reconnectStrategy)===null||z===void 0)&&z.isActive()||this.handleError(ce.code,ce.message),this.stop(),de}}}),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var B;if(!this.peerConnection)return et.NONE;const J=(B=this.reconnectStrategy)===null||B===void 0?void 0:B.isActive(),te=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(te){case"new":return et.NEW;case"closed":return et.CLOSED;case"disconnected":return J?et.CONNECTING:et.DISCONNECTED;case"failed":return J?et.CONNECTING:et.FAILED;case"idle":return et.IDLE;case"checking":case"connecting":return et.CONNECTING;case"completed":case"connected":return et.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:te}),et.IDLE}},this.onConnectionStateChange=()=>{var B;const J=this.getConnectionState();switch(J){case et.CONNECTED:{this.emitter.emit(As.CONNECTION_STATE_CHANGE,J);const te=new Date;this.analyticsTracker.trackEvent(new Fl(te,this.connectionStartDate,this.ingestSessionId));const z=this.mediaStreamManager.getTrack(Gt.AUDIO),re=this.mediaStreamManager.getTrack(Gt.VIDEO);if(re){const ce=re.getSettings();this.analyticsTracker.trackEvent(new Hp(ce))}if(z){const ce=z.getSettings();this.analyticsTracker.trackEvent(new jl(ce))}(((B=this.peerConnection)===null||B===void 0?void 0:B.getSenders())||[]).forEach(ce=>{var de;(((de=ce.getParameters())===null||de===void 0?void 0:de.codecs)||[]).forEach(Me=>{var Qe;switch((Qe=ce.track)===null||Qe===void 0?void 0:Qe.kind){case"video":{if(!re)break;const $e=new Bs().extractVideoSdpFmtpLine(Me.sdpFmtpLine),Re=re.getSettings();this.analyticsTracker.trackEvent(new $p(Re,$e,Me));break}case"audio":if(!z)break;this.analyticsTracker.trackEvent(new Bl(Me))}})});break}case et.CONNECTING:this.emitter.emit(As.CONNECTION_STATE_CHANGE,J),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case et.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(As.CONNECTION_STATE_CHANGE,J),this.handleTerminalConnectionFailure());break;case et.DISCONNECTED:this.emitter.emit(As.CONNECTION_STATE_CHANGE,J),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(As.CONNECTION_STATE_CHANGE,J)}},this.handleLocalDescription=B=>Xs(this,void 0,void 0,function*(){var J;return(J=this.peerConnection)===null||J===void 0?void 0:J.setLocalDescription(B)}),Ys.set(this,B=>{if(typeof B!="string")throw new yt(Co);try{new URL(B)}catch{throw new yt(mu)}}),this.logger=new Ks(O,fe.WEBRTC),this.createReconnectStrategy(b)}start(b,S){var R;return Xs(this,void 0,void 0,function*(){Hl(this,Ys,"f").call(this,b);const O=[this.mediaStreamManager.getTrack(Gt.VIDEO),this.mediaStreamManager.getTrack(Gt.AUDIO)].filter(Wr);if(this.createPeerConnection(),this.addTracks({tracks:O}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(b,S),yield this.establishConnection(b,S),!((R=this.reconnectStrategy)===null||R===void 0)&&R.isActive()){const P=new URL(b);this.analyticsTracker.trackEvent(new oc({protocol:"webrtc",hostname:P.hostname,port:P.port},Zc.NETWORK_DISCONNECT))}})}stop(){var b,S,R,O;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[et.NEW,et.CONNECTING,et.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(As.CONNECTION_STATE_CHANGE,et.CLOSED),(b=this.peerConnection)===null||b===void 0||b.close(),(S=this.peerConnection)===null||S===void 0||S.removeEventListener("connectionstatechange",this.onConnectionStateChange),(R=this.peerConnection)===null||R===void 0||R.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(O=this.reconnectStrategy)===null||O===void 0||O.stop()}addTracks(b){var S;if(Ac(this.peerConnection),!b)return;const R=this.peerConnection.getSenders().map(P=>{var B;return(B=P.track)===null||B===void 0?void 0:B.id}),O=b.tracks.filter(P=>!R.includes(P.id));for(const P of O)(S=this.peerConnection)===null||S===void 0||S.addTrack(P)}getReports(){var b;return Xs(this,void 0,void 0,function*(){try{const S=(yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats())||[],R=[];return S.forEach(O=>{R.push(O)}),R}catch{return[]}})}sendSetupRequest(b,S,R){var O;return Xs(this,void 0,void 0,function*(){const P=yield fetch(`${b}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:tl(R),streamKey:S},this.config.streamConfig))});if(!P.ok)throw function(J){let te=new yt(Object.assign({},Cn));return(J==null?void 0:J.code)===Ie&&(te=new yt(Object.assign({},yr))),J!=null&&J.message&&(te.message=J.message),te}(yield P.json());const B=yield P.json();B!=null&&B.answer&&(yield(O=this.peerConnection)===null||O===void 0?void 0:O.setRemoteDescription(function(J){return JSON.parse(atob(J))}(B.answer)),this.ingestSessionId=B.ingestSessionId)})}handleTerminalConnectionFailure(){const b=new yt(Rn);this.handleError(b.code,b.message)}handleError(b,S){this.analyticsTracker.trackEvent(new Ig({code:b,description:S,isFatal:!0})),this.emitter.emit(As.ERROR,{code:b,message:S})}createPeerConnection(){var b;const S=this.getConnectionState(),R=S!==et.NONE,O=S!==et.CLOSED,P=(b=this.reconnectStrategy)===null||b===void 0?void 0:b.isActive();R&&O&&!P||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval(()=>{const B=this.getConnectionState();if(this.reconnectStrategy&&B===et.DISCONNECTED&&this.disconnectionStartDate){const J=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:J}),J>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else B===et.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)},1e3),this.peerConnection=new RTCPeerConnection(td),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(b){if(this.reconnectStrategy=Pg.create(this,b.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const S=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:S})}}}Ys=new WeakMap;var nd,L_=i(2492);(function(x){x.CONFIG="config",x.UPDATE="update",x.START="start",x.STOP="stop"})(nd||(nd={}));var cc=i(477),Vo=i.n(cc);function mi(){return Vo()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var t;!function(t){t.CONFIG="config",t.UPDATE="update",t.START="start",t.STOP="stop"}(t||(t={}));const i=self;const s=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(t){this.config=Object.assign(Object.assign({},this.config),t),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{i.postMessage({type:t.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};i.addEventListener("message",(function(i){var n;if(null===(n=null==i?void 0:i.data)||void 0===n?void 0:n.type)switch(i.data.type){case t.CONFIG:s.setConfig(i.data.payload||{});break;case t.START:s.start();break;case t.STOP:s.stop()}}))})();`,"Worker",void 0,void 0)}var Mc=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};class Ic{constructor(b,S,R){this.config=b,this.mediaStreamManager=S,this.analyticsTracker=R,this.handleWorkerEvent=J=>{var te;((te=J.data)===null||te===void 0?void 0:te.type)===nd.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new mi,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const O=this.compositeEl.getContext("2d");if(O===null)throw new yt(Object.assign({},Dn));this.compositeContext=O,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const P=nn(this.compositeStream.getTracks(),Gt.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const B=nn(this.audioDestination.stream.getTracks(),Gt.AUDIO);P&&this.mediaStreamManager.setTrack(Gt.VIDEO,P),B&&this.mediaStreamManager.setTrack(Gt.AUDIO,B),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:nd.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(b){this.previewElement=b;const{width:S,height:R}=this.config.streamConfig.maxResolution;this.previewElement.width=S,this.previewElement.height=R,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const b=this.audioContext.createConstantSource(),S=this.audioContext.createGain();S.gain.value=.001,b.connect(S),S.connect(this.audioDestination),b.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const b=document.body,S=["touchstart","touchend","mousedown","keydown"],R=()=>{S.forEach(P=>{b.removeEventListener(P,O)})},O=()=>{this.audioContext.resume().then(R)};S.forEach(P=>{b.addEventListener(P,O,!1)})}getTracks(){return[this.mediaStreamManager.getTrack(Gt.VIDEO),this.mediaStreamManager.getTrack(Gt.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(Gt.VIDEO)}getAudioInputDevice(b){if(typeof b!="string")return;const S=this.mixer.audio.find(R=>{if(R.name===b)return R.source});return S==null?void 0:S.source}getVideoInputDevice(b){if(typeof b=="string")return this.mixer.video.find(S=>S.name===b)}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(b,S,R){var O;return Mc(this,void 0,void 0,function*(){if(typeof b!="object")throw new yt(Object.assign({},rt));if(!S||typeof S!="string")throw new yt(Object.assign({},De));if(this.mixer.video.some(de=>de.name===S))throw new yt(Object.assign({},xt));if(!R)throw new yt(Object.assign({},sn));if(typeof R.index!="number")throw new yt(Object.assign({},Jt));const P=function(){const de=document.createElement("video");return de.autoplay=!0,de.muted=!0,de.setAttribute("playsinline",""),de.setAttribute("webkit-playsinline",""),de}(),B=b.getVideoTracks(),[J]=B;if(!B.length)throw new yt(Object.assign({},Le));const te=J.getConstraints(),z=L_({},te,{frameRate:this.config.streamConfig.maxFramerate});try{yield J.applyConstraints(z)}catch(de){let Me="Unknown constraints error";de instanceof Error&&(Me=de.message),this.analyticsTracker.trackEvent(new Ig({description:`${Et.message}: ${Me}`,isFatal:!1,code:Et.code}))}const re=()=>Mc(this,void 0,void 0,function*(){let de=0;for(;de<5;)try{return void(yield P.play())}catch(Me){if(!(Me instanceof Error))throw new Error("unknown error trying to add video to broadcast");de++,yield new Promise(Qe=>setTimeout(Qe,150))}throw new Error("Error playing video, tries exceeded")}),ce=new MediaStream([J]);P.srcObject=ce;try{yield re();const de={name:S,element:P,position:R,source:ce,render:!0},Me=((O=J.getSettings)===null||O===void 0?void 0:O.call(J))||{};this.analyticsTracker.trackEvent(new Og(It(Me),Me)),this.mixer.video.push(de)}catch(de){throw new yt(Object.assign(Object.assign({},Le),{cause:de}))}})}addImageSource(b,S,R){var O;return Mc(this,void 0,void 0,function*(){if(!b)throw new yt(Object.assign({},rt));if(!S||typeof S!="string")throw new yt(Object.assign({},De));if(b.tagName==="image")throw new yt(Object.assign({},tt));if(this.mixer.video.some(B=>B.name===S))throw new yt(Object.assign({},xt));if(!R)throw new yt(Object.assign({},sn));if(typeof R.index!="number")throw new yt(Object.assign({},Jt));if(b instanceof Image){const B=(O=b.src)===null||O===void 0?void 0:O.slice();try{const J=b.src?new URL(b.src):{};if(J.host&&J.hostname){const te=yield fetch(b.src).then(re=>Mc(this,void 0,void 0,function*(){return re.blob()})),z=yield new Promise(re=>{const ce=new FileReader;ce.onload=()=>{re(ce.result)},ce.readAsDataURL(te)});b.src=z}}catch{throw new yt(Object.assign(Object.assign({},tn),{params:{details:`Image URL: ${B}`}}))}}const P={name:S,element:b,position:R,render:!0};this.mixer.video.push(P)})}addAudioInputDevice(b,S){return Mc(this,void 0,void 0,function*(){if(typeof b!="object")throw new yt(Object.assign({},rt));if(!S||typeof S!="string")throw new yt(Object.assign({},De));if(this.mixer.audio.some(J=>J.name===S))throw new yt(Object.assign({},xt));const R=b.getAudioTracks();if(!R.length)throw new yt(Object.assign({},Lt));const O=this.audioContext.createMediaStreamSource(new MediaStream(R)),P=this.audioContext.createGain();P.gain.value=1,O.connect(P),P.connect(this.audioDestination);const B={name:S,source:b,audioTrackSource:O,gainNode:P};this.analyticsTracker.trackEvent(new Og("audio",{deviceId:b.id})),this.mixer.audio.push(B)})}removeImage(b){const S=this.mixer.video.findIndex(R=>R.name===b);if(S<0)throw new yt(Object.assign({},Pn));this.mixer.video.splice(S,1)}removeVideoInputDevice(b){var S;const R=this.removeDevice(b,this.mixer.video);if(!R)throw new yt(Object.assign({},wt));{const O=nn(R.source.getTracks(),Gt.VIDEO);if(!O)throw new yt(Object.assign({},wt));R.element.srcObject=null,O.stop();const P=((S=O==null?void 0:O.getSettings)===null||S===void 0?void 0:S.call(O))||{};this.analyticsTracker.trackEvent(new jp(It(P),P))}}removeAudioInputDevice(b){const S=this.removeDevice(b,this.mixer.audio);if(S!=null&&S.audioTrackSource){for(const R of S.source.getTracks())R.stop(),this.analyticsTracker.trackEvent(new jp("audio",{deviceId:R.id}));S.gainNode.disconnect(this.audioDestination)}else if(!S)throw new yt(Object.assign({},wt))}updateVideoDeviceComposition(b,S){if(!b||typeof b!="string")throw new yt(Object.assign({},zn));if(!S)throw new yt(Object.assign({},Xr));if(typeof S.index!="number")throw new yt(Object.assign({},lr));this.mixer.video.forEach((R,O)=>{R.name===b&&(R.position=S)})}exchangeVideoDevicePositions(b,S){const R=this.getVideoInputDevice(b),O=this.getVideoInputDevice(S);if(!R)throw new yt(Object.assign(Object.assign({},dn),{params:{details:`device with name: "${b}" not found`}}));if(!O)throw new yt(Object.assign(Object.assign({},dn),{params:{details:`device with name: "${S}" not found`}}));const P=Object.assign({},R.position),B=Object.assign({},O.position);for(const J of this.mixer.video)J.name===b&&(uf(B.x)?J.position=Object.assign(Object.assign({},J.position),B):J.position={index:B.index}),J.name===S&&(uf(P.x)?J.position=Object.assign(Object.assign({},J.position),P):J.position={index:P.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:nd.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:nd.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var b;return((b=this.mediaStreamManager.getTrack(Gt.VIDEO))===null||b===void 0?void 0:b.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach(b=>{b.render=!1})}enableVideo(){this.mixer.video.forEach(b=>{b.render=!0})}disableAudio(){this.mixer.audio.forEach(b=>{b.audioTrackSource&&(b.gainNode.gain.value=0)})}enableAudio(){this.mixer.audio.forEach(b=>{b.audioTrackSource&&(b.gainNode.gain.value=1)})}getDrawRegion(b,S,R){var O,P,B,J;let te=(O=b.position.x)!==null&&O!==void 0?O:0,z=(P=b.position.y)!==null&&P!==void 0?P:0;const re=(B=b.position.width)!==null&&B!==void 0?B:S-te,ce=(J=b.position.height)!==null&&J!==void 0?J:R-z,de=re/ce;let Me=b.element.width,Qe=b.element.height;b.element instanceof HTMLVideoElement&&(Me=b.element.videoWidth,Qe=b.element.videoHeight);const $e=Me/Qe;let Re=re,ye=ce;return $e>de?(Re=re,ye=2*Math.round(re/$e/2),z+=(ce-ye)/2):$e<de&&(ye=ce,Re=2*Math.round(ce*$e/2),te+=(re-Re)/2),{x:te,y:z,width:Re,height:ye}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const b=this.mixer.video.filter(S=>S.render);b.sort((S,R)=>S.position.index-R.position.index);for(const S of b){const{x:R,y:O,width:P,height:B}=this.getDrawRegion(S,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(S.element,R,O,P,B)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(Gt.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(b,S){const R=S.findIndex(O=>(P=>P.name===b)(O));if(!(R<0))return S.splice(R,1)[0]}shouldMix(b){if(b.getTime()<this.nextMix)return!1;for(;this.nextMix<=b.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function uf(x){return Number.isSafeInteger(x)}var qp,Wp,_u=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})},U_=function(x,b,S,R){if(S==="a"&&!R)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!R:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?R:S==="a"?R.call(x):R?R.value:b.get(x)};class nl{constructor(b){this.config=b,qp.add(this),this.emitter=new sc,this.isValid=!0,this.emitter.on(As.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new Qu,this.mediaStreamManager=new qr;const S=new qd(b.logLevel,b.logger);this.peerClient=new Gp(this.config,this.emitter,this.mediaStreamManager,S,this.analyticsTracker),this.broadcastCanvasManager=new Ic(b,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new Zu(this.peerClient,this.broadcastCanvasManager,S,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(nl.prototype).forEach(R=>{this[R]=new Proxy(this[R],{apply:(O,P,B)=>{if(!P.isValid)throw new yt(Object.assign({},sf));return Reflect.apply(O,P,B)}})}),window.addEventListener("beforeunload",()=>{this.analyticsTracker.stop(!0)})}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(b,S){return _u(this,void 0,void 0,function*(){U_(this,qp,"m",Wp).call(this,b);const R=Dl(S||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(R,b),this.emitter.emit(As.ACTIVE_STATE_CHANGE,!0),this.url=new URL(R),this.url&&this.analyticsTracker.trackEvent(new oc({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},Zc.USER_INITIATED))})}stopBroadcast(){var b,S,R;this.url&&this.analyticsTracker.trackEvent(new P_({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(b=this.peerStatsTracker)===null||b===void 0||b.stop(),(S=this.peerClient)===null||S===void 0||S.stop(),(R=this.emitter)===null||R===void 0||R.emit(As.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(b,S,R){return _u(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addVideoInputDevice(b,S,R)})}addImageSource(b,S,R){return _u(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addImageSource(b,S,R)})}addAudioInputDevice(b,S){return _u(this,void 0,void 0,function*(){return this.broadcastCanvasManager.addAudioInputDevice(b,S)})}removeVideoInputDevice(b){this.broadcastCanvasManager.removeVideoInputDevice(b)}removeAudioInputDevice(b){this.broadcastCanvasManager.removeAudioInputDevice(b)}removeImage(b){this.broadcastCanvasManager.removeImage(b)}updateVideoDeviceComposition(b,S){this.broadcastCanvasManager.updateVideoDeviceComposition(b,S)}exchangeVideoDevicePositions(b,S){this.broadcastCanvasManager.exchangeVideoDevicePositions(b,S)}getAudioInputDevice(b){return this.broadcastCanvasManager.getAudioInputDevice(b)}getVideoInputDevice(b){return this.broadcastCanvasManager.getVideoInputDevice(b)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(b,S){this.emitter.on(b,S)}off(b,S){this.emitter.off(b,S)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(b){this.broadcastCanvasManager.attachPreview(b)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function lc(x){return new nl(function(b){const S=new Ki;return S.streamConfig=b.streamConfig,S.ingestEndpoint=b.ingestEndpoint,S.logger=b.logger,S.logLevel=b.logLevel,S.networkReconnectConfig=b.networkReconnectConfig,S}(x))}qp=new WeakSet,Wp=function(x){if(typeof x!="string"||!/^[a-zA-Z0-9_-]+$/.test(x))throw new yt(pt)};const Xd="1.19.0";var Yt,is=i(6486);(function(x){x.PUBLISH="publish",x.SUBSCRIBE="subscribe",x.JOIN="join",x.LEAVE="leave"})(Yt||(Yt={}));const Ny=2;class Kp extends vr{constructor(b){super(vn.LEAVE,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.LEAVE,event_endpoint:b.eventEndpoint,whip_endpoint:b.whipEndpoint,reason:b.reason}),this.critical=!0}}class uo{constructor(){this.emitter=new sc}on(b,S,R){S.call=function(O,P){return function(B,...J){try{P.apply(B,J)}catch(te){let z=`Error in callback for ${O}`;const re=P.name;return re&&(z+=` for function ${re}`),void console.error(`${z}
`,te)}}}(b,S),this.emitter.on(b,S,R)}off(b,S,R){this.emitter.off(b,S,R)}emit(b,...S){this.emitter.emit(b,...S)}removeAllListeners(){this.emitter.removeAllListeners()}}function Yp(x){const b="0123456789abcdef";let S="";for(let R=0;R<x;R+=1)S+=b.charAt(Math.floor(Math.random()*b.length));return S}class Xp{constructor(){const b=Yp;this.value=`${b(8)}-${b(4)}-${b(4)}-${b(4)}-${b(12)}`}}function Js(){return new Xp}class df{constructor(){const b=(Date.now()/1e3|0).toString(16);this.value=`1-${b}-${Yp(24)}`}}function Qs(){return new df}var ai=i(9669),ds=i.n(ai);class Zn extends yt{constructor({token:b,traceId:S,code:R,tag:O,location:P,message:B,details:J,remoteParticipantId:te,requestUUID:z,fatal:re,nominal:ce,action:de}){super({name:"StageClientError",message:B,code:R}),Error.captureStackTrace&&Error.captureStackTrace(this,Zn),this.action=de,this.token=b,this.traceId=S,this.code=R,this.tag=O,this.location=P,this.message=B,this.details=J,this.remoteParticipantId=te,this.requestUUID=z,this.fatal=re,this.nominal=ce}}const uc={JOIN_RELATED:"signalling_session",PUBLISH_RELATED:"webrtc_sink",UNPUBLISH_RELATED:"webrtc_unsink",SUBSCRIBE_RELATED:"webrtc_source"};function ho(x,b){switch(x){case Yt.PUBLISH:return uc.PUBLISH_RELATED;case Yt.SUBSCRIBE:return`webrtc_source:${b}`;default:return"unknown"}}function Ai(x,b){var S,R,O,P;const B={code:x.code,message:`${x.message}: ${b.name} ${b.message}`,fatal:(S=x.fatal)!==null&&S!==void 0&&S,nominal:(R=x.nominal)!==null&&R!==void 0&&R};return b instanceof Zn&&(B.fatal=(O=b.fatal)!==null&&O!==void 0&&O,B.nominal=(P=b.nominal)!==null&&P!==void 0&&P),B}function Jd(x,b){if(x===0)return Ut.UNKNOWN_SERVER_ERROR;if(!(x<400))if(x>=400&&x<=403)switch(b){case fo.TokenExpired:return Ut.EXPIRED_TOKEN;case fo.NoPermissions:return Ut.TOKEN_PERMISSIONS_DENIED;case fo.StageAtCapacity:return Ut.STAGE_AT_CAPACITY;case fo.NoMatchingCodec:return Ut.NO_MATCHING_CODEC;default:return Ut.UNKNOWN_SERVER_ERROR}else{if(x===404)return b===fo.RemoteStreamNotFound?Ut.REMOTE_STREAM_NOT_FOUND:Ut.UNKNOWN_SERVER_ERROR;if(x===412)return b===fo.AbortedMHCPError?Ut.MHCP_ABORTED:Ut.UNKNOWN_SERVER_ERROR;if(x===429)return b===fo.StageAuthThrottled?Ut.STAGE_AUTH_THROTTLED:Ut.WHIP_TOO_MANY_REQUESTS;if(x!==500)return Ut.UNKNOWN_SERVER_ERROR;switch(b){case fo.InternalMHCPError:return Ut.INTERNAL_MHCP_ERROR;case fo.UnreachableMHCP:return Ut.UNREACHABLE_MHCP;case fo.InvalidSessionStatus:return Ut.INVALID_SESSION_STATUS;default:return Ut.INTERNAL_SERVER_ERROR}}}var fo;(function(x){x[x.Unspecified=2001]="Unspecified",x[x.TokenExpired=2002]="TokenExpired",x[x.NoPermissions=2003]="NoPermissions",x[x.RemoteStreamNotFound=2004]="RemoteStreamNotFound",x[x.StageAtCapacity=2005]="StageAtCapacity",x[x.InternalMHCPError=2006]="InternalMHCPError",x[x.UncategorizedMHCPError=2007]="UncategorizedMHCPError",x[x.UnreachableMHCP=2008]="UnreachableMHCP",x[x.InvalidSessionStatus=2010]="InvalidSessionStatus",x[x.PostWithoutOptions=2011]="PostWithoutOptions",x[x.AbortedMHCPError=2012]="AbortedMHCPError",x[x.StageAuthThrottled=2013]="StageAuthThrottled",x[x.NoMatchingCodec=2014]="NoMatchingCodec"})(fo||(fo={}));const Ut={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},NO_CANDIDATES:{code:1022,message:"No ICE candidates",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNCATEGORIZED_MHCP_ERROR:{code:1029,message:"Authorization failed due to uncategorized MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},POST_WITHOUT_OPTIONS:{code:1032,message:"Cannot POST without OPTIONS in mandatory TURN",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},CHIME_MEETING_NOT_FOUND:{code:1098,message:"Meeting or Attendee was deleted",fatal:!0,nominal:!0},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message",fatal:!1,nominal:!1},WHIP_SESSION_RESOURCE_DELETED:{code:1206,message:"WHIP signaling session resource not found",fatal:!0,nominal:!0},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_OPTIONS_FAILURE:{code:1501,message:"Failed to get ICE Servers from OPTIONS",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PING_SEND_FAIL:{code:1303,message:"Ping send fail",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var Is;(function(x){x.UNPUBLISH="unpublish",x.UNSUBSCRIBE="unsubscribe",x.UNLOAD="unload",x.CONNECTION_FAIL="connection fail",x.REASSIGNMENT="reassignment"})(Is||(Is={}));const zo="stageJoined",dc="stageParticipantJoined",Ni="stageParticipantLeft",ss="stageParticipantKicked",Os="stageParticipantUpdated",hf="localPublishingChanged",Jp="stageRefresh",yu="stateChange",Py="error",js="reassignmentRequest",rd="incompatibleCodecs",ff="connectionStateChange",pe="stageStreamUpdate",Go="error",$a="stageStreamSeiMessageReceived",$s="transformError",Mr="reassignmentStarted",rl="reassignmentSuccess",il="reassignmentFailed",sl="open",ol="closed",hc="messageParseError",Dg="refresh",al="error",Lg="stageStateMessage",Qd="sdpAnswer",Qp="disconnectMessage",bu="reassignmentMessage",id="incompatibleCodecs";function Ug(x){return S=function(R){return R.replace(/-/g,"+").replace(/_/g,"/").padEnd(R.length+(4-R.length%4)%4,"=")}(x),window.atob(S);var S}class pf{constructor(b,S){this.analyticsTracker=S,this.rawToken=b;const R=b.split(".");if(R.length!==3)throw Error(`Token format incorrect. length: ${R.length}`);try{this.header=JSON.parse(Ug(R[0]))}catch(B){const J=B instanceof Error?`: ${B.message}`:"";throw Error(`Error parsing Stage Token header${J}`)}try{this.claims=JSON.parse(Ug(R[1]))}catch(B){const J=B instanceof Error?`: ${B.message}`:"";throw Error(`Error parsing Stage Token claims${J}`)}this.signature=R[2];const{claims:O}=this;this.stageARN=O.resource,this.participantID=O.jti,this.eventsURL=O.events_url,this.whipURL=of("whipUrl")||O.whip_url,this.userID=O.user_id,this.expirationTime=O.exp,this.topic=O.topic,this.parseVersionFlags(O.version);const{attributes:P}=O;P&&(this.attrGsRole=P.gs_role,this.attrGsSessionId=P.gs_session_id)}getPublishEndpoint(){let b="";return this.whipURL&&this.participantID&&(b=`${this.whipURL}/publish/${this.participantID}`),b}getSubscribeEndpoint(b){let S="";return this.whipURL&&(S=`${this.whipURL}/subscribe/${b}`),S}assertTokenIsUnexpired(b,S,R,O){(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new Zn(Object.assign(Object.assign({},Ut.EXPIRED_TOKEN),{action:Yt.JOIN,location:R,tag:S,token:this,traceId:b,remoteParticipantId:O,message:Ut.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(b){if(!b)return;const S=b.split(".");S.length===2&&(this.versionFlags=parseInt(S[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||(this.versionFlags&Ny)!=0}}function cl(x,b){return new pf(x,b)}class Fg{constructor(b,S){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=b,this.trailing=!(S&&S.skipTrailing)}invoke(b,...S){return this.throttled?(this.trailingFn=b,this.trailingFnArgs=S,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),b(...S),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}class Eu extends vr{constructor(b,S,R,O,P,B,J,te){super(vn.SERVER_REQUEST,S,J,!0),Object.assign(this.properties,{action:b,http_method:O,remote_participant_id:B,request_uuid:P,url:R,transport:te})}}const qo="draft-ietf-wish-whip-04";var ks,Bg=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};function Zd(x,b){return Bg(this,void 0,void 0,function*(){x.validateStatus=R=>R>=200&&R<300||R===403;const S=yield ds()(x);if(S.status===403){if(S.data.code===2003)throw new ai.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",x,S.request,S);return x.url===S.request.responseURL?(x.validateStatus=R=>R>=200&&R<300,ds()(x)):(x.url=S.request.responseURL,b<5?Zd(x,b+1):(x.validateStatus=R=>R>=200&&R<300,ds()(x)))}return S})}function sd(x){return Bg(this,void 0,void 0,function*(){return Zd(x,0)})}function Zp(){}function Dy(x){switch(x){case"new":return et.NEW;case"closed":return et.CLOSED;case"disconnected":return et.DISCONNECTED;case"failed":return et.FAILED;case"idle":return et.IDLE;case"checking":case"connecting":return et.CONNECTING;case"completed":case"connected":return et.CONNECTED;default:throw new Error(`unknown connecion state: ${x}`)}}function em(x,b,S){let R=document.createElement(b);const O=()=>{R&&(R.removeEventListener("loadeddata",P),R.removeEventListener("error",O),R.srcObject=null,R.src="",R=null)},P=()=>{O(),S(b)};return R.addEventListener("loadeddata",P),R.addEventListener("error",O),R.srcObject=x,O}class mf extends vr{constructor(b,S,R,O,P){super(vn.TRACE,b,S,!1),Object.assign(this.properties,{action:O,message:R,remote_participant_id:P})}}class po extends vr{constructor(b,S,R,O,P){super(vn.CONNECTION_STATE,S,R,!1),Object.assign(this.properties,{action:b,remote_participant_id:P,state:O})}}class jg extends vr{constructor(b,S,R,O,P){super(vn.ICE_GATHERING_STATE,S,R,!1),Object.assign(this.properties,{action:b,remote_participant_id:P,state:O})}}(function(x){x.POST="post",x.CONNECTED="connected",x.ICE_GATHERING="icegathering",x.SDP_EXCHANGE="sdpExchange",x.SET_REMOTE_DESC="setRemoteDesc",x.PEER_CONNECTION="peerConnection"})(ks||(ks={}));const $g="start",Ha="stop";class F_{constructor(b,S){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=b,this.traceId=S}markActionStart(){this.markStart(ks.CONNECTED)}markPostStart(){this.markStart(ks.POST)}markPostStop(){this.markStop(ks.POST),this.postDuration=this.measure(ks.POST)}markIceGatheringStart(){this.markStart(ks.ICE_GATHERING)}markIceGatheringStop(){this.markStop(ks.ICE_GATHERING),this.timeToCandidate=this.measure(ks.ICE_GATHERING)}markActionStop(){this.markStop(ks.CONNECTED),this.timeToConnected=this.measure(ks.CONNECTED),this.markStop(ks.PEER_CONNECTION),this.peerConnectionDuration=this.measure(ks.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(ks.SET_REMOTE_DESC)}markSetRemoteDescStop(){const b=ks.SET_REMOTE_DESC;this.markStop(b),this.setRemoteDescDuration=this.measure(b),this.markStart(ks.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(ks.SDP_EXCHANGE)}markSdpExchangeStop(){const b=ks.SDP_EXCHANGE;this.markStop(b),this.sdpExchangeDuration=this.measure(b)}setTransport(b){this.sdpExchangeTransport=b}markStart(b){this.marks[`${this.namespace}.${b}.${$g}`]=performance.now()}markStop(b){this.marks[`${this.namespace}.${b}.${Ha}`]=performance.now()}measure(b){const S=`${this.namespace}.${b}.${$g}`,R=`${this.namespace}.${b}.${Ha}`,O=this.marks[S],P=this.marks[R];return O===void 0||P===void 0?0:P-O}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:b,postDuration:S,timeToCandidate:R,timeToConnected:O,sdpExchangeDuration:P,sdpExchangeTransport:B,setRemoteDescDuration:J,peerConnectionDuration:te}=this;return{optionsDuration:b,postDuration:S,timeToCandidate:R,timeToConnected:O,sdpExchangeDuration:P,sdpExchangeTransport:B,setRemoteDescDuration:J,peerConnectionDuration:te}}resetMeasurements(b){this.traceId=b,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var Vl,hs,Su;(function(x){x.VIDEO="video",x.AUDIO="audio"})(Vl||(Vl={})),function(x){x.DEFAULT="default",x.LOW="low",x.MEDIUM="medium",x.HIGH="high"}(hs||(hs={})),function(x){x.LOWEST_QUALITY="lowest_quality",x.HIGHEST_QUALITY="highest_quality"}(Su||(Su={}));var Hs=i(766);class Mi{constructor(b){this.sdp=b}static splitLines(b){return b.trim().split(`
`).map(S=>S.trim())}static splitSections(b){return b.split(`
m=`).map((S,R)=>(R>0?`m=${S}`:S).trim()+Mi.CRLF)}getUniqueRtpHeaderExtensionId(b){const S=[];for(const O of b)if(/^a=extmap:/.test(O.trim())){const P=+O.split("a=extmap:")[1].split(" ")[0];S.includes(P)||S.push(P)}S.sort((O,P)=>O-P);let R=0;for(const O of S){if(O-R>1)return R+1;R=O}return R===14?-1:R+1}withVideoLayersAllocationRtpHeaderExtension(b){const S="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",R=b?b.getRtpHeaderExtensionId(S):-1,O=R===-1?this.getUniqueRtpHeaderExtensionId(Mi.splitLines(this.sdp)):R,P=Mi.splitSections(this.sdp),B=[];for(let te of P){if(/^m=video/.test(te)&&Mi.getRtpHeaderExtensionIdInSection(te,S)===-1){const z=Mi.splitLines(te),re=[];if(O===-1||this.hasRtpHeaderExtensionId(O)){B.push(te);continue}for(const ce of z)if(re.push(ce),/^a=sendrecv/.test(ce.trim())){const de=`a=extmap:${O} ${S}`;re.push(de)}te=re.join(Mi.CRLF)+Mi.CRLF}else if(R!==-1&&/^m=video/.test(te)&&Mi.getRtpHeaderExtensionIdInSection(te,S)!==R){const z=Mi.splitLines(te),re=[];for(const ce of z){if(/^a=extmap:/.test(ce.trim())&&ce.split("a=extmap:")[1].split(" ")[1]===S){if(!this.hasRtpHeaderExtensionId(R)){const de=`a=extmap:${R} ${S}`;re.push(de)}continue}re.push(ce)}te=re.join(Mi.CRLF)+Mi.CRLF}B.push(te)}const J=B.join("");return new Mi(J)}withOpusAudioConfig(b,S){const R=Hs.Qc(this.sdp);for(const O of R.media)if(O.type==="audio"){const{payload:P}=O.rtp.find(z=>z.codec==="opus");if(!P)continue;let B=O.fmtp.find(z=>z.payload===P);B||(B={payload:P,config:""});const J=Hs.rz(B.config);if(J.maxaveragebitrate=b,typeof S=="boolean"){const z=S?1:0;J["sprop-stereo"]=z,J.stereo=z}let te="";for(const z of Object.keys(J))te+=`${z}=${J[z]}; `;B.config=te.trim()}return new Mi(Hs.cW(R))}static getRtpHeaderExtensionIdInSection(b,S){const R=Mi.splitLines(b);for(const O of R)if(/^a=extmap:/.test(O.trim())){const P=O.split("a=extmap:")[1].split(" "),B=+P[0];if(P[1]===S)return B}return-1}getRtpHeaderExtensionId(b){const S=Mi.splitSections(this.sdp);for(const R of S)if(/^m=video/.test(R)){const O=Mi.getRtpHeaderExtensionIdInSection(R,b);if(O!==-1)return O}return-1}hasRtpHeaderExtensionId(b){const S=Mi.splitLines(this.sdp);for(const R of S)if(/^a=extmap:/.test(R.trim())&&+R.split("a=extmap:")[1].split(" ")[0]===b)return!0;return!1}hasAudioNacksEnabled(){var b,S,R;return((R=(S=((b=Hs.Qc(this.sdp).media.filter(O=>O.type==="audio")[0])!==null&&b!==void 0?b:{}).rtcpFb)===null||S===void 0?void 0:S.filter(O=>O.type==="nack"))!==null&&R!==void 0?R:[]).length>0}}Mi.CRLF=`\r
`,Mi.rfc7587LowestBitrate=6e3,Mi.rfc7587HighestBitrate=51e4;const gf=200,eh=2500,Hg=10,zl=30,tm=12,Mo=128,Vg={[hs.DEFAULT]:0,[hs.LOW]:50,[hs.MEDIUM]:150,[hs.HIGH]:250},vf={[hs.DEFAULT]:0,[hs.LOW]:100,[hs.MEDIUM]:200,[hs.HIGH]:300},_f=()=>({minBitrate:gf,maxBitrate:eh,maxFramerate:zl,simulcast:{enabled:!1},maxAudioBitrateKbps:64,stereo:!1});var yf=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};const nm="H264",rm=x=>{const b=x==null?void 0:x.split("/");if((b==null?void 0:b.length)===2)return b[1]},pa=(x,b)=>{const S=rm(x);if(x===void 0||S===void 0)return;const R={mimeSubtype:S};if(b){const O=(P=>{const B=P.split(";"),J=new Map;for(const te of B){const[z,re]=te.split("=");J.set(z,re)}return J})(b);switch(S){case nm:{const P=O.get("profile-level-id");P&&((B,J)=>{if(J.length<6)return;const te=J.substring(0,4),z=parseInt(J.substring(4,6),16);B.profile=te,B.level=z})(R,P);break}case"H265":((P,B)=>{const J=B.get("profile-id")||"0",te=B.get("tier-flag")||"0",z=parseInt(B.get("level-id")||"0",10),re=[te,J].join("_");P.profile=re,P.level=z})(R,O)}}return R},mo=(x,b)=>x.sort((S,R)=>{if(rm(S.mimeType)===nm){const O=pa(S.mimeType,S.sdpFmtpLine);if((O==null?void 0:O.profile)===b)return-1}return 0}),B_=(x,b)=>{var S;const R=pa(x.mimeType,x.sdpFmtpLine);return(R==null?void 0:R.mimeSubtype.toLowerCase())===b.mime.toLowerCase()&&((S=R==null?void 0:R.profile)===null||S===void 0?void 0:S.toLowerCase().indexOf(b.config.toLowerCase()))===0},zg=(x,b)=>b.filter(S=>!S.mimeType.endsWith("rtx")).filter(S=>S.mimeType.indexOf("packetization-mode=0")===-1).find(S=>x.reduce((R,O)=>R&&B_(S,O)===!1,!0));class Va extends vr{constructor(b,S,R,O,P,B,J,te,z){var re,ce;super(vn.PUBLISHED_VIDEO_STATS,b,S,!1),Object.assign(this.properties,Object.assign({action:Yt.PUBLISH,node:(re=R==null?void 0:R.node)!==null&&re!==void 0?re:"",cluster:(ce=R==null?void 0:R.cluster)!==null&&ce!==void 0?ce:""},((de,Me,Qe,$e,Re,ye)=>{var gt,Bt,en,Pt,$n,Ln,Or,Br,jr,$r,_r,kr,Nr,Pr,Hr,tr,Sn,Wn,gi,Xi,Ji,_s,as,cs,Qi,Di,ls,zs,Zi,ba,ea;const _c=(Bt=(gt=de==null?void 0:de.qualityLimitationDurations)===null||gt===void 0?void 0:gt.cpu)!==null&&Bt!==void 0?Bt:0,yc=(Pt=(en=de==null?void 0:de.qualityLimitationDurations)===null||en===void 0?void 0:en.bandwidth)!==null&&Pt!==void 0?Pt:0,Ea=Math.max(($n=de==null?void 0:de.bytesSent)!==null&&$n!==void 0?$n:0,0),hl=8*Ea/(ye??1),qa=Math.max((Ln=Me==null?void 0:Me.packetsLost)!==null&&Ln!==void 0?Ln:0,0),Nc=Math.max((Or=de==null?void 0:de.packetsSent)!==null&&Or!==void 0?Or:0,0),fl=qa/Math.max(Nc,1),Wa=pa($e==null?void 0:$e.mimeType,$e==null?void 0:$e.sdpFmtpLine);return{active:!!(de!=null&&de.framesPerSecond)&&de.framesPerSecond!==0,bytes_sent:Ea,codec_mime_type:Wa==null?void 0:Wa.mimeSubtype,codec_profile:Wa==null?void 0:Wa.profile,codec_level:Wa==null?void 0:Wa.level,configured_bitrate:Re==null?void 0:Re.max_bitrate,connection_bandwidth:(Br=Qe==null?void 0:Qe.availableOutgoingBitrate)!==null&&Br!==void 0?Br:0,encode_bitrate:hl,encoder_implementation:(jr=de==null?void 0:de.encoderImplementation)!==null&&jr!==void 0?jr:"unknown",fir_count:($r=de==null?void 0:de.firCount)!==null&&$r!==void 0?$r:0,fraction_packets_lost:fl,frame_height:Math.max((_r=de==null?void 0:de.frameHeight)!==null&&_r!==void 0?_r:0,0),frame_width:Math.max((kr=de==null?void 0:de.frameWidth)!==null&&kr!==void 0?kr:0,0),frames_encoded:(Nr=de==null?void 0:de.framesEncoded)!==null&&Nr!==void 0?Nr:0,frames_per_second:Math.max((Pr=de==null?void 0:de.framesPerSecond)!==null&&Pr!==void 0?Pr:0,0),frames_sent:(Hr=de==null?void 0:de.framesSent)!==null&&Hr!==void 0?Hr:0,header_bytes_sent:(tr=de==null?void 0:de.headerBytesSent)!==null&&tr!==void 0?tr:0,huge_frames_sent:(Sn=de==null?void 0:de.hugeFramesSent)!==null&&Sn!==void 0?Sn:0,key_frames_encoded:(Wn=de==null?void 0:de.keyFramesEncoded)!==null&&Wn!==void 0?Wn:0,nack_count:(gi=de==null?void 0:de.nackCount)!==null&&gi!==void 0?gi:0,packets_lost:qa,packets_sent:Nc,power_efficient_encoder:(Xi=de==null?void 0:de.powerEfficientEncoder)!==null&&Xi!==void 0&&Xi,pli_count:(Ji=de==null?void 0:de.pliCount)!==null&&Ji!==void 0?Ji:0,quality_limitation_reason:(_s=de==null?void 0:de.qualityLimitationReason)!==null&&_s!==void 0?_s:"none",quality_limitation_resolution_changes:(as=de==null?void 0:de.qualityLimitationResolutionChanges)!==null&&as!==void 0?as:0,quality_limitation_cpu_duration:_c,quality_limitation_bandwidth_duration:yc,retransmitted_bytes_sent:(cs=de==null?void 0:de.retransmittedBytesSent)!==null&&cs!==void 0?cs:0,retransmitted_packets_sent:(Qi=de==null?void 0:de.retransmittedPacketsSent)!==null&&Qi!==void 0?Qi:0,rid:(Di=de==null?void 0:de.rid)!==null&&Di!==void 0?Di:"no-rid",scalability_mode:(ls=de==null?void 0:de.scalabilityMode)!==null&&ls!==void 0?ls:"unknown",target_bitrate:Math.max((zs=de==null?void 0:de.targetBitrate)!==null&&zs!==void 0?zs:0,0),total_encode_time:(Zi=de==null?void 0:de.totalEncodeTime)!==null&&Zi!==void 0?Zi:0,total_encoded_bytes_target:(ba=de==null?void 0:de.totalEncodedBytesTarget)!==null&&ba!==void 0?ba:0,total_packet_send_delay:(ea=de==null?void 0:de.totalPacketSendDelay)!==null&&ea!==void 0?ea:0}})(O,P,B,J,te,z)))}}class Wo extends vr{constructor(b,S,R,O,P,B,J,te,z,re){var ce,de,Me,Qe;super(vn.PUBLISHED_VIDEO_STATS_WINDOW,b,S,!1);const $e=Math.max(((ce=O==null?void 0:O.timestamp)!==null&&ce!==void 0?ce:0)-((de=P==null?void 0:P.timestamp)!==null&&de!==void 0?de:0),0);Object.assign(this.properties,Object.assign({action:Yt.PUBLISH,node:(Me=R==null?void 0:R.node)!==null&&Me!==void 0?Me:"",cluster:(Qe=R==null?void 0:R.cluster)!==null&&Qe!==void 0?Qe:"",window_size_ms:$e},((Re,ye,gt,Bt,en,Pt,$n,Ln)=>{var Or,Br,jr,$r,_r,kr,Nr,Pr,Hr,tr,Sn,Wn,gi,Xi,Ji,_s,as,cs,Qi,Di,ls,zs,Zi,ba,ea,_c,yc,Ea,hl,qa,Nc,fl,Wa,Yl,ph,Mu,Ns,Iu,fd,pd,Ou,Xl,md,gd,iv,Em,sv,ov,Sm,wm,X_,J_;const Q_=(Br=(Or=Re==null?void 0:Re.qualityLimitationDurations)===null||Or===void 0?void 0:Or.cpu)!==null&&Br!==void 0?Br:0,Hy=($r=(jr=ye==null?void 0:ye.qualityLimitationDurations)===null||jr===void 0?void 0:jr.cpu)!==null&&$r!==void 0?$r:0,Z_=(kr=(_r=Re==null?void 0:Re.qualityLimitationDurations)===null||_r===void 0?void 0:_r.bandwidth)!==null&&kr!==void 0?kr:0,Lf=(Pr=(Nr=ye==null?void 0:ye.qualityLimitationDurations)===null||Nr===void 0?void 0:Nr.bandwidth)!==null&&Pr!==void 0?Pr:0,Vy=Math.max(((Hr=Re==null?void 0:Re.bytesSent)!==null&&Hr!==void 0?Hr:0)-((tr=ye==null?void 0:ye.bytesSent)!==null&&tr!==void 0?tr:0),0),zy=8*Vy/(typeof Ln!="number"?1:Ln/1e3),_=Math.max(((Sn=gt==null?void 0:gt.packetsLost)!==null&&Sn!==void 0?Sn:0)-((Wn=Bt==null?void 0:Bt.packetsLost)!==null&&Wn!==void 0?Wn:0),0),w=Math.max(((gi=Re==null?void 0:Re.packetsSent)!==null&&gi!==void 0?gi:0)-((Xi=ye==null?void 0:ye.packetsSent)!==null&&Xi!==void 0?Xi:0),0),D=_/Math.max(w,1),Y=pa(Pt==null?void 0:Pt.mimeType,Pt==null?void 0:Pt.sdpFmtpLine);return{active:!!(Re!=null&&Re.framesPerSecond)&&(Re==null?void 0:Re.framesPerSecond)!==0,bytes_sent:Vy,codec_mime_type:Y==null?void 0:Y.mimeSubtype,codec_profile:Y==null?void 0:Y.profile,codec_level:Y==null?void 0:Y.level,configured_bitrate:$n==null?void 0:$n.max_bitrate,connection_bandwidth:(Ji=en==null?void 0:en.availableOutgoingBitrate)!==null&&Ji!==void 0?Ji:0,encode_bitrate:zy,encoder_implementation:(_s=Re==null?void 0:Re.encoderImplementation)!==null&&_s!==void 0?_s:"unknown",fir_count:Math.max(((as=Re==null?void 0:Re.firCount)!==null&&as!==void 0?as:0)-((cs=ye==null?void 0:ye.firCount)!==null&&cs!==void 0?cs:0),0),fraction_packets_lost:D,frame_height:Math.max((Qi=Re==null?void 0:Re.frameHeight)!==null&&Qi!==void 0?Qi:0,0),frame_width:Math.max((Di=Re==null?void 0:Re.frameWidth)!==null&&Di!==void 0?Di:0,0),frames_encoded:Math.max(((ls=Re==null?void 0:Re.framesEncoded)!==null&&ls!==void 0?ls:0)-((zs=ye==null?void 0:ye.framesEncoded)!==null&&zs!==void 0?zs:0),0),frames_per_second:Math.max((Zi=Re==null?void 0:Re.framesPerSecond)!==null&&Zi!==void 0?Zi:0,0),frames_sent:Math.max(((ba=Re==null?void 0:Re.framesSent)!==null&&ba!==void 0?ba:0)-((ea=ye==null?void 0:ye.framesSent)!==null&&ea!==void 0?ea:0),0),header_bytes_sent:Math.max(((_c=Re==null?void 0:Re.headerBytesSent)!==null&&_c!==void 0?_c:0)-((yc=ye==null?void 0:ye.headerBytesSent)!==null&&yc!==void 0?yc:0),0),huge_frames_sent:Math.max(((Ea=Re==null?void 0:Re.hugeFramesSent)!==null&&Ea!==void 0?Ea:0)-((hl=ye==null?void 0:ye.hugeFramesSent)!==null&&hl!==void 0?hl:0),0),key_frames_encoded:Math.max(((qa=Re==null?void 0:Re.keyFramesEncoded)!==null&&qa!==void 0?qa:0)-((Nc=ye==null?void 0:ye.keyFramesEncoded)!==null&&Nc!==void 0?Nc:0),0),nack_count:Math.max(((fl=Re==null?void 0:Re.nackCount)!==null&&fl!==void 0?fl:0)-((Wa=ye==null?void 0:ye.nackCount)!==null&&Wa!==void 0?Wa:0),0),packets_lost:_,packets_sent:w,power_efficient_encoder:(Yl=Re==null?void 0:Re.powerEfficientEncoder)!==null&&Yl!==void 0&&Yl,pli_count:Math.max(((ph=Re==null?void 0:Re.pliCount)!==null&&ph!==void 0?ph:0)-((Mu=ye==null?void 0:ye.pliCount)!==null&&Mu!==void 0?Mu:0),0),quality_limitation_reason:(Ns=Re==null?void 0:Re.qualityLimitationReason)!==null&&Ns!==void 0?Ns:"none",quality_limitation_resolution_changes:Math.max(((Iu=Re==null?void 0:Re.qualityLimitationResolutionChanges)!==null&&Iu!==void 0?Iu:0)-((fd=ye==null?void 0:ye.qualityLimitationResolutionChanges)!==null&&fd!==void 0?fd:0),0),quality_limitation_cpu_duration:Math.max(Q_-Hy,0),quality_limitation_bandwidth_duration:Math.max(Z_-Lf,0),retransmitted_bytes_sent:Math.max(((pd=Re==null?void 0:Re.retransmittedBytesSent)!==null&&pd!==void 0?pd:0)-((Ou=ye==null?void 0:ye.retransmittedBytesSent)!==null&&Ou!==void 0?Ou:0),0),rid:(Xl=Re==null?void 0:Re.rid)!==null&&Xl!==void 0?Xl:"no-rid",retransmitted_packets_sent:Math.max(((md=Re==null?void 0:Re.retransmittedPacketsSent)!==null&&md!==void 0?md:0)-((gd=ye==null?void 0:ye.retransmittedPacketsSent)!==null&&gd!==void 0?gd:0),0),scalability_mode:(iv=Re==null?void 0:Re.scalabilityMode)!==null&&iv!==void 0?iv:"unknown",target_bitrate:Math.max((Em=Re==null?void 0:Re.targetBitrate)!==null&&Em!==void 0?Em:0,0),total_encode_time:Math.max(((sv=Re==null?void 0:Re.totalEncodeTime)!==null&&sv!==void 0?sv:0)-((ov=ye==null?void 0:ye.totalEncodeTime)!==null&&ov!==void 0?ov:0),0),total_encoded_bytes_target:Math.max(((Sm=Re==null?void 0:Re.totalEncodedBytesTarget)!==null&&Sm!==void 0?Sm:0)-((wm=ye==null?void 0:ye.totalEncodedBytesTarget)!==null&&wm!==void 0?wm:0),0),total_packet_send_delay:Math.max(((X_=Re==null?void 0:Re.totalPacketSendDelay)!==null&&X_!==void 0?X_:0)-((J_=ye==null?void 0:ye.totalPacketSendDelay)!==null&&J_!==void 0?J_:0),0)}})(O,P,B,J,te,z,re,$e)))}}class j_ extends vr{constructor(b,S,R,O,P,B,J,te,z,re){var ce,de;super(vn.PUBLISHED_AUDIO_STATS,b,S,!1),Object.assign(this.properties,Object.assign({action:Yt.PUBLISH,node:(ce=R==null?void 0:R.node)!==null&&ce!==void 0?ce:"",cluster:(de=R==null?void 0:R.cluster)!==null&&de!==void 0?de:""},((Me,Qe,$e,Re,ye,gt,Bt)=>{var en,Pt,$n,Ln,Or,Br,jr,$r,_r,kr,Nr;const Pr=Math.max((en=Me==null?void 0:Me.bytesSent)!==null&&en!==void 0?en:0,0),Hr=8*Pr/(gt??1),tr=Math.max((Pt=Qe==null?void 0:Qe.packetsLost)!==null&&Pt!==void 0?Pt:0,0),Sn=Math.max(($n=Me==null?void 0:Me.packetsSent)!==null&&$n!==void 0?$n:0,0),Wn=tr/Math.max(Sn,1),gi=pa(Re==null?void 0:Re.mimeType,Re==null?void 0:Re.sdpFmtpLine);return{audio_nacks_enabled:(Ln=Bt==null?void 0:Bt.audioNacks)!==null&&Ln!==void 0&&Ln,bytes_sent:Pr,codec_mime_type:gi==null?void 0:gi.mimeSubtype,configured_bitrate:(Or=ye==null?void 0:ye.max_audio_bitrate_bps)!==null&&Or!==void 0?Or:0,connection_bandwidth:(Br=$e==null?void 0:$e.availableOutgoingBitrate)!==null&&Br!==void 0?Br:0,encode_bitrate:Hr,fraction_packets_lost:Wn,header_bytes_sent:(jr=Me==null?void 0:Me.headerBytesSent)!==null&&jr!==void 0?jr:0,nack_count:($r=Me==null?void 0:Me.nackCount)!==null&&$r!==void 0?$r:0,packets_lost:tr,packets_sent:Sn,retransmitted_bytes_sent:(_r=Me==null?void 0:Me.retransmittedBytesSent)!==null&&_r!==void 0?_r:0,retransmitted_packets_sent:(kr=Me==null?void 0:Me.retransmittedPacketsSent)!==null&&kr!==void 0?kr:0,target_bitrate:(Nr=Me==null?void 0:Me.targetBitrate)!==null&&Nr!==void 0?Nr:0}})(O,P,B,J,te,z,re)))}}class Gg extends vr{constructor(b,S,R,O,P,B,J,te,z,re,ce){var de,Me,Qe,$e;super(vn.PUBLISHED_AUDIO_STATS_WINDOW,b,S,!1);const Re=Math.max(((de=O==null?void 0:O.timestamp)!==null&&de!==void 0?de:0)-((Me=P==null?void 0:P.timestamp)!==null&&Me!==void 0?Me:0),0);Object.assign(this.properties,Object.assign({action:Yt.PUBLISH,node:(Qe=R==null?void 0:R.node)!==null&&Qe!==void 0?Qe:"",cluster:($e=R==null?void 0:R.cluster)!==null&&$e!==void 0?$e:"",window_size_ms:Re},((ye,gt,Bt,en,Pt,$n,Ln,Or,Br)=>{var jr,$r,_r,kr,Nr,Pr,Hr,tr,Sn,Wn,gi,Xi,Ji,_s,as,cs,Qi,Di,ls,zs;const Zi=Math.max(((jr=ye==null?void 0:ye.bytesSent)!==null&&jr!==void 0?jr:0)-(($r=gt==null?void 0:gt.bytesSent)!==null&&$r!==void 0?$r:0),0),ba=8*Zi/(typeof Or!="number"?1:Or/1e3),ea=Math.max(((_r=Bt==null?void 0:Bt.packetsLost)!==null&&_r!==void 0?_r:0)-((kr=en==null?void 0:en.packetsLost)!==null&&kr!==void 0?kr:0),0),_c=Math.max(((Nr=ye==null?void 0:ye.packetsSent)!==null&&Nr!==void 0?Nr:0)-((Pr=gt==null?void 0:gt.packetsSent)!==null&&Pr!==void 0?Pr:0),0),yc=ea/Math.max(_c,1),Ea=pa($n==null?void 0:$n.mimeType,$n==null?void 0:$n.sdpFmtpLine);return{audio_nacks_enabled:(Hr=Br==null?void 0:Br.audioNacks)!==null&&Hr!==void 0&&Hr,bytes_sent:Zi,codec_mime_type:Ea==null?void 0:Ea.mimeSubtype,configured_bitrate:(tr=Ln==null?void 0:Ln.max_audio_bitrate_bps)!==null&&tr!==void 0?tr:0,connection_bandwidth:(Sn=Pt==null?void 0:Pt.availableOutgoingBitrate)!==null&&Sn!==void 0?Sn:0,encode_bitrate:ba,fraction_packets_lost:yc,header_bytes_sent:Math.max(((Wn=ye==null?void 0:ye.headerBytesSent)!==null&&Wn!==void 0?Wn:0)-((gi=gt==null?void 0:gt.headerBytesSent)!==null&&gi!==void 0?gi:0),0),nack_count:Math.max(((Xi=ye==null?void 0:ye.nackCount)!==null&&Xi!==void 0?Xi:0)-((Ji=gt==null?void 0:gt.nackCount)!==null&&Ji!==void 0?Ji:0),0),packets_lost:ea,packets_sent:Math.max(((_s=ye==null?void 0:ye.packetsSent)!==null&&_s!==void 0?_s:0)-((as=gt==null?void 0:gt.packetsSent)!==null&&as!==void 0?as:0),0),retransmitted_bytes_sent:Math.max(((cs=ye==null?void 0:ye.retransmittedBytesSent)!==null&&cs!==void 0?cs:0)-((Qi=gt==null?void 0:gt.retransmittedBytesSent)!==null&&Qi!==void 0?Qi:0),0),retransmitted_packets_sent:Math.max(((Di=ye==null?void 0:ye.retransmittedPacketsSent)!==null&&Di!==void 0?Di:0)-((ls=gt==null?void 0:gt.retransmittedPacketsSent)!==null&&ls!==void 0?ls:0),0),target_bitrate:Math.max((zs=ye==null?void 0:ye.targetBitrate)!==null&&zs!==void 0?zs:0,0)}})(O,P,B,J,te,z,re,Re,ce)))}}class $_ extends vr{constructor(b,S,R,O,P,B,J,te){var z,re;super(vn.SUBSCRIBED_VIDEO_STATS,b,S,!1),Object.assign(this.properties,Object.assign({action:Yt.SUBSCRIBE,node:(z=O==null?void 0:O.node)!==null&&z!==void 0?z:"",cluster:(re=O==null?void 0:O.cluster)!==null&&re!==void 0?re:"",remote_participant_id:R},((ce,de,Me,Qe)=>{var $e,Re,ye,gt,Bt,en,Pt,$n,Ln,Or,Br,jr,$r,_r,kr,Nr,Pr,Hr,tr,Sn,Wn,gi,Xi;let Ji=0;ce!=null&&ce.jitterBufferDelay&&(ce!=null&&ce.jitterBufferEmittedCount)&&ce.jitterBufferEmittedCount>0&&(Ji=ce.jitterBufferDelay/ce.jitterBufferEmittedCount);const _s=Qe??1,as=Math.max(($e=ce==null?void 0:ce.bytesReceived)!==null&&$e!==void 0?$e:0,0),cs=8*as/_s;let Qi=0;ce!=null&&ce.totalDecodeTime&&(ce!=null&&ce.framesDecoded)&&(Qi=ce.totalDecodeTime/Math.max(ce==null?void 0:ce.framesDecoded,1));const Di=Math.max((Re=ce==null?void 0:ce.packetsLost)!==null&&Re!==void 0?Re:0,0),ls=Math.max((ye=ce==null?void 0:ce.packetsReceived)!==null&&ye!==void 0?ye:0,0),zs=Di/Math.max(ls+Di,1),Zi=pa(Me==null?void 0:Me.mimeType,Me==null?void 0:Me.sdpFmtpLine);return{bytes_received:as,codec_mime_type:Zi==null?void 0:Zi.mimeSubtype,codec_profile:Zi==null?void 0:Zi.profile,codec_level:Zi==null?void 0:Zi.level,connection_bandwidth:(gt=de==null?void 0:de.availableIncomingBitrate)!==null&&gt!==void 0?gt:0,decode_bitrate:cs,decoder_implementation:(Bt=ce==null?void 0:ce.decoderImplementation)!==null&&Bt!==void 0?Bt:"unknown",fir_count:Math.max((en=ce==null?void 0:ce.firCount)!==null&&en!==void 0?en:0,0),fraction_packets_lost:zs,frame_decode_time_avg:Qi,frame_height:Math.max((Pt=ce==null?void 0:ce.frameHeight)!==null&&Pt!==void 0?Pt:0,0),frame_width:Math.max(($n=ce==null?void 0:ce.frameWidth)!==null&&$n!==void 0?$n:0,0),frames_decoded:Math.max((Ln=ce==null?void 0:ce.framesDecoded)!==null&&Ln!==void 0?Ln:0,0),frames_dropped:Math.max((Or=ce==null?void 0:ce.framesDropped)!==null&&Or!==void 0?Or:0,0),frames_received:Math.max((Br=ce==null?void 0:ce.framesReceived)!==null&&Br!==void 0?Br:0,0),freeze_count:Math.max((jr=ce==null?void 0:ce.freezeCount)!==null&&jr!==void 0?jr:0,0),frames_rendered:Math.max(($r=ce==null?void 0:ce.framesRendered)!==null&&$r!==void 0?$r:0,0),frames_per_second:Math.max((_r=ce==null?void 0:ce.framesPerSecond)!==null&&_r!==void 0?_r:0,0),header_bytes_received:Math.max((kr=ce==null?void 0:ce.headerBytesReceived)!==null&&kr!==void 0?kr:0,0),jitter_buffer_delay_avg:Ji,key_frames_decoded:Math.max((Nr=ce==null?void 0:ce.keyFramesDecoded)!==null&&Nr!==void 0?Nr:0,0),nack_count:Math.max((Pr=ce==null?void 0:ce.nackCount)!==null&&Pr!==void 0?Pr:0,0),packets_discarded:Math.max((Hr=ce==null?void 0:ce.packetsDiscarded)!==null&&Hr!==void 0?Hr:0,0),packets_lost:Di,packets_received:ls,pause_count:Math.max((tr=ce==null?void 0:ce.pauseCount)!==null&&tr!==void 0?tr:0,0),pli_count:Math.max((Sn=ce==null?void 0:ce.pliCount)!==null&&Sn!==void 0?Sn:0,0),power_efficient_decoder:(Wn=ce==null?void 0:ce.powerEfficientDecoder)!==null&&Wn!==void 0&&Wn,total_freezes_duration:Math.max((gi=ce==null?void 0:ce.totalFreezesDuration)!==null&&gi!==void 0?gi:0,0),total_pauses_duration:Math.max((Xi=ce==null?void 0:ce.totalPausesDuration)!==null&&Xi!==void 0?Xi:0,0)}})(P,B,J,te)))}}class qg extends vr{constructor(b,S,R,O,P,B,J,te,z,re,ce){var de,Me,Qe,$e;super(vn.SUBSCRIBED_VIDEO_STATS_WINDOW,b,S,!1);const Re=Math.max(((de=P==null?void 0:P.timestamp)!==null&&de!==void 0?de:0)-((Me=B==null?void 0:B.timestamp)!==null&&Me!==void 0?Me:0),0);Object.assign(this.properties,Object.assign({action:Yt.SUBSCRIBE,node:(Qe=O==null?void 0:O.node)!==null&&Qe!==void 0?Qe:"",cluster:($e=O==null?void 0:O.cluster)!==null&&$e!==void 0?$e:"",window_size_ms:Re,remote_participant_id:R},((ye,gt,Bt,en,Pt,$n,Ln,Or)=>{var Br,jr,$r,_r,kr,Nr,Pr,Hr,tr,Sn,Wn,gi,Xi,Ji,_s,as,cs,Qi,Di,ls,zs,Zi,ba,ea,_c,yc,Ea,hl,qa,Nc,fl,Wa,Yl,ph,Mu,Ns,Iu,fd,pd,Ou,Xl,md,gd;let iv=0,Em=0;if(ye!=null&&ye.jitterBufferEmittedCount&&(gt!=null&&gt.jitterBufferEmittedCount)&&ye.jitterBufferEmittedCount>gt.jitterBufferEmittedCount){ye!=null&&ye.jitterBufferDelay&&(gt!=null&&gt.jitterBufferDelay)&&(iv=(ye.jitterBufferDelay-gt.jitterBufferDelay)/(ye.jitterBufferEmittedCount-gt.jitterBufferEmittedCount));const zy=gt==null?void 0:gt.jitterBufferMinimumDelay,_=ye==null?void 0:ye.jitterBufferMinimumDelay;zy&&_&&(Em=(_-zy)/(ye.jitterBufferEmittedCount-gt.jitterBufferEmittedCount))}const sv=Math.max(((Br=ye==null?void 0:ye.bytesReceived)!==null&&Br!==void 0?Br:0)-((jr=gt==null?void 0:gt.bytesReceived)!==null&&jr!==void 0?jr:0),0),ov=typeof Pt!="number"?1:Pt/1e3,Sm=8*sv/ov,wm=Math.max((($r=ye==null?void 0:ye.totalDecodeTime)!==null&&$r!==void 0?$r:0)-((_r=gt==null?void 0:gt.totalDecodeTime)!==null&&_r!==void 0?_r:0),0),X_=Math.max(((kr=ye==null?void 0:ye.framesDecoded)!==null&&kr!==void 0?kr:0)-((Nr=gt==null?void 0:gt.framesDecoded)!==null&&Nr!==void 0?Nr:0),0),J_=wm/Math.max(X_,1),Q_=Math.max(((Pr=ye==null?void 0:ye.packetsLost)!==null&&Pr!==void 0?Pr:0)-((Hr=gt==null?void 0:gt.packetsLost)!==null&&Hr!==void 0?Hr:0),0),Hy=Math.max(((tr=ye==null?void 0:ye.packetsReceived)!==null&&tr!==void 0?tr:0)-((Sn=gt==null?void 0:gt.packetsReceived)!==null&&Sn!==void 0?Sn:0),0),Z_=Q_/Math.max(Hy+Q_,1),Lf=pa(en==null?void 0:en.mimeType,en==null?void 0:en.sdpFmtpLine),Vy=8*(Or||0)/ov;return{bytes_received:sv,codec_mime_type:Lf==null?void 0:Lf.mimeSubtype,codec_profile:Lf==null?void 0:Lf.profile,codec_level:Lf==null?void 0:Lf.level,connection_bandwidth:(Wn=Bt==null?void 0:Bt.availableIncomingBitrate)!==null&&Wn!==void 0?Wn:0,decode_bitrate:Sm,decoder_implementation:(gi=ye==null?void 0:ye.decoderImplementation)!==null&&gi!==void 0?gi:"unknown",fir_count:Math.max(((Xi=ye==null?void 0:ye.firCount)!==null&&Xi!==void 0?Xi:0)-((Ji=gt==null?void 0:gt.firCount)!==null&&Ji!==void 0?Ji:0),0),fraction_packets_lost:Z_,frame_decode_time_avg:J_,frame_height:Math.max((_s=ye==null?void 0:ye.frameHeight)!==null&&_s!==void 0?_s:0,0),frame_width:Math.max((as=ye==null?void 0:ye.frameWidth)!==null&&as!==void 0?as:0,0),frames_decoded:Math.max(((cs=ye==null?void 0:ye.framesDecoded)!==null&&cs!==void 0?cs:0)-((Qi=gt==null?void 0:gt.framesDecoded)!==null&&Qi!==void 0?Qi:0),0),frames_dropped:Math.max(((Di=ye==null?void 0:ye.framesDropped)!==null&&Di!==void 0?Di:0)-((ls=gt==null?void 0:gt.framesDropped)!==null&&ls!==void 0?ls:0),0),frames_received:Math.max(((zs=ye==null?void 0:ye.framesReceived)!==null&&zs!==void 0?zs:0)-((Zi=gt==null?void 0:gt.framesReceived)!==null&&Zi!==void 0?Zi:0),0),freeze_count:Math.max(((ba=ye==null?void 0:ye.freezeCount)!==null&&ba!==void 0?ba:0)-((ea=gt==null?void 0:gt.freezeCount)!==null&&ea!==void 0?ea:0),0),frames_rendered:Math.max((_c=ye==null?void 0:ye.framesRendered)!==null&&_c!==void 0?_c:0,0),frames_per_second:Math.max((yc=ye==null?void 0:ye.framesPerSecond)!==null&&yc!==void 0?yc:0,0),header_bytes_received:Math.max(((Ea=ye==null?void 0:ye.headerBytesReceived)!==null&&Ea!==void 0?Ea:0)-((hl=gt==null?void 0:gt.headerBytesReceived)!==null&&hl!==void 0?hl:0),0),configured_jitter_buffer_min_delay_ms:$n??0,jitter_buffer_min_obtainable_delay:Em,jitter_buffer_delay_avg:iv,key_frames_decoded:Math.max(((qa=ye==null?void 0:ye.keyFramesDecoded)!==null&&qa!==void 0?qa:0)-((Nc=gt==null?void 0:gt.keyFramesDecoded)!==null&&Nc!==void 0?Nc:0),0),nack_count:Math.max(((fl=ye==null?void 0:ye.nackCount)!==null&&fl!==void 0?fl:0)-((Wa=gt==null?void 0:gt.nackCount)!==null&&Wa!==void 0?Wa:0),0),packets_discarded:Math.max(((Yl=ye==null?void 0:ye.packetsDiscarded)!==null&&Yl!==void 0?Yl:0)-((ph=gt==null?void 0:gt.packetsDiscarded)!==null&&ph!==void 0?ph:0),0),packets_lost:Q_,packets_received:Hy,pause_count:Math.max(((Mu=ye==null?void 0:ye.pauseCount)!==null&&Mu!==void 0?Mu:0)-((Ns=gt==null?void 0:gt.pauseCount)!==null&&Ns!==void 0?Ns:0),0),pli_count:Math.max(((Iu=ye==null?void 0:ye.pliCount)!==null&&Iu!==void 0?Iu:0)-((fd=gt==null?void 0:gt.pliCount)!==null&&fd!==void 0?fd:0),0),power_efficient_decoder:(pd=ye==null?void 0:ye.powerEfficientDecoder)!==null&&pd!==void 0&&pd,total_freezes_duration:Math.max(((Ou=ye==null?void 0:ye.totalFreezesDuration)!==null&&Ou!==void 0?Ou:0)-((Xl=gt==null?void 0:gt.totalFreezesDuration)!==null&&Xl!==void 0?Xl:0),0),total_pauses_duration:Math.max(((md=ye==null?void 0:ye.totalPausesDuration)!==null&&md!==void 0?md:0)-((gd=gt==null?void 0:gt.totalPausesDuration)!==null&&gd!==void 0?gd:0),0),sei_read_count:Ln,sei_bytes_received:Or,sei_bitrate:Vy}})(P,B,J,te,Re,z,re,ce)))}}class Wg extends vr{constructor(b,S,R,O,P,B,J,te,z){var re,ce;super(vn.SUBSCRIBED_AUDIO_STATS,b,S,!1),Object.assign(this.properties,Object.assign({action:Yt.SUBSCRIBE,node:(re=O==null?void 0:O.node)!==null&&re!==void 0?re:"",cluster:(ce=O==null?void 0:O.cluster)!==null&&ce!==void 0?ce:"",remote_participant_id:R},((de,Me,Qe,$e,Re)=>{var ye,gt,Bt,en,Pt,$n,Ln,Or,Br,jr,$r,_r,kr,Nr,Pr,Hr,tr;let Sn=0;de!=null&&de.jitterBufferDelay&&(de!=null&&de.jitterBufferEmittedCount)&&de.jitterBufferEmittedCount>0&&(Sn=de.jitterBufferDelay/de.jitterBufferEmittedCount);const Wn=$e??1,gi=Math.max((ye=de==null?void 0:de.bytesReceived)!==null&&ye!==void 0?ye:0,0),Xi=8*gi/Wn,Ji=Math.max((gt=de==null?void 0:de.packetsLost)!==null&&gt!==void 0?gt:0,0),_s=Math.max((Bt=de==null?void 0:de.packetsReceived)!==null&&Bt!==void 0?Bt:0,0),as=Ji/Math.max(_s+Ji,1),cs=Math.max((en=de==null?void 0:de.concealedSamples)!==null&&en!==void 0?en:0,0),Qi=Math.max((Pt=de==null?void 0:de.totalSamplesReceived)!==null&&Pt!==void 0?Pt:0,0),Di=cs/Math.max(Qi,1),ls=pa(Qe==null?void 0:Qe.mimeType,Qe==null?void 0:Qe.sdpFmtpLine);return{audio_level:($n=de==null?void 0:de.audioLevel)!==null&&$n!==void 0?$n:0,audio_nacks_enabled:(Ln=Re==null?void 0:Re.audioNacks)!==null&&Ln!==void 0&&Ln,bytes_received:gi,codec_mime_type:ls==null?void 0:ls.mimeSubtype,connection_bandwidth:(Or=Me==null?void 0:Me.availableIncomingBitrate)!==null&&Or!==void 0?Or:0,concealed_samples:cs,concealment_events:Math.max((Br=de==null?void 0:de.concealmentEvents)!==null&&Br!==void 0?Br:0,0),silent_concealed_samples:Math.max((jr=de==null?void 0:de.silentConcealedSamples)!==null&&jr!==void 0?jr:0,0),decode_bitrate:Xi,fraction_audio_concealed:Di,fraction_packets_lost:as,header_bytes_received:Math.max(($r=de==null?void 0:de.headerBytesReceived)!==null&&$r!==void 0?$r:0,0),inserted_samples_for_deceleration:Math.max((_r=de==null?void 0:de.insertedSamplesForDeceleration)!==null&&_r!==void 0?_r:0,0),jitter_buffer_delay_avg:Sn,packets_discarded:Math.max((kr=de==null?void 0:de.packetsDiscarded)!==null&&kr!==void 0?kr:0,0),retransmitted_packets_received:Math.max((Nr=de==null?void 0:de.retransmittedPacketsReceived)!==null&&Nr!==void 0?Nr:0,0),retransmitted_bytes_received:Math.max((Pr=de==null?void 0:de.retransmittedBytesReceived)!==null&&Pr!==void 0?Pr:0,0),packets_lost:Ji,packets_received:_s,nack_count:Math.max((Hr=de==null?void 0:de.nackCount)!==null&&Hr!==void 0?Hr:0,0),removed_samples_for_acceleration:Math.max((tr=de==null?void 0:de.removedSamplesForAcceleration)!==null&&tr!==void 0?tr:0,0),total_samples_received:Qi}})(P,B,J,te,z)))}}class xr extends vr{constructor(b,S,R,O,P,B,J,te,z,re){var ce,de,Me,Qe;super(vn.SUBSCRIBED_AUDIO_STATS_WINDOW,b,S,!1);const $e=Math.max(((ce=P==null?void 0:P.timestamp)!==null&&ce!==void 0?ce:0)-((de=B==null?void 0:B.timestamp)!==null&&de!==void 0?de:0),0);Object.assign(this.properties,Object.assign({action:Yt.SUBSCRIBE,window_size_ms:$e,node:(Me=O==null?void 0:O.node)!==null&&Me!==void 0?Me:"",cluster:(Qe=O==null?void 0:O.cluster)!==null&&Qe!==void 0?Qe:"",remote_participant_id:R},((Re,ye,gt,Bt,en,Pt,$n)=>{var Ln,Or,Br,jr,$r,_r,kr,Nr,Pr,Hr,tr,Sn,Wn,gi,Xi,Ji,_s,as,cs,Qi,Di,ls,zs,Zi,ba,ea,_c,yc,Ea,hl,qa;let Nc=0,fl=0;if(Re!=null&&Re.jitterBufferEmittedCount&&(ye!=null&&ye.jitterBufferEmittedCount)&&Re.jitterBufferEmittedCount>ye.jitterBufferEmittedCount){Re!=null&&Re.jitterBufferDelay&&(ye!=null&&ye.jitterBufferDelay)&&(Nc=(Re.jitterBufferDelay-ye.jitterBufferDelay)/(Re.jitterBufferEmittedCount-ye.jitterBufferEmittedCount));const md=ye==null?void 0:ye.jitterBufferMinimumDelay,gd=Re==null?void 0:Re.jitterBufferMinimumDelay;md&&gd&&(fl=(gd-md)/(Re.jitterBufferEmittedCount-ye.jitterBufferEmittedCount))}const Wa=typeof en!="number"?1:en/1e3,Yl=Math.max(((Ln=Re==null?void 0:Re.bytesReceived)!==null&&Ln!==void 0?Ln:0)-((Or=ye==null?void 0:ye.bytesReceived)!==null&&Or!==void 0?Or:0),0),ph=8*Yl/Wa,Mu=Math.max(((Br=Re==null?void 0:Re.packetsLost)!==null&&Br!==void 0?Br:0)-((jr=ye==null?void 0:ye.packetsLost)!==null&&jr!==void 0?jr:0),0),Ns=Math.max((($r=Re==null?void 0:Re.packetsReceived)!==null&&$r!==void 0?$r:0)-((_r=ye==null?void 0:ye.packetsReceived)!==null&&_r!==void 0?_r:0),0),Iu=Mu/Math.max(Ns+Mu,1),fd=Math.max(((kr=Re==null?void 0:Re.concealedSamples)!==null&&kr!==void 0?kr:0)-((Nr=ye==null?void 0:ye.concealedSamples)!==null&&Nr!==void 0?Nr:0),0),pd=Math.max(((Pr=Re==null?void 0:Re.totalSamplesReceived)!==null&&Pr!==void 0?Pr:0)-((Hr=ye==null?void 0:ye.totalSamplesReceived)!==null&&Hr!==void 0?Hr:0),0),Ou=fd/Math.max(pd,1),Xl=pa(Bt==null?void 0:Bt.mimeType,Bt==null?void 0:Bt.sdpFmtpLine);return{audio_level:(tr=Re==null?void 0:Re.audioLevel)!==null&&tr!==void 0?tr:0,audio_nacks_enabled:(Sn=Pt==null?void 0:Pt.audioNacks)!==null&&Sn!==void 0&&Sn,bytes_received:Yl,codec_mime_type:Xl==null?void 0:Xl.mimeSubtype,connection_bandwidth:(Wn=gt==null?void 0:gt.availableIncomingBitrate)!==null&&Wn!==void 0?Wn:0,decode_bitrate:ph,concealed_samples:fd,concealment_events:Math.max(((gi=Re==null?void 0:Re.concealmentEvents)!==null&&gi!==void 0?gi:0)-((Xi=ye==null?void 0:ye.concealmentEvents)!==null&&Xi!==void 0?Xi:0),0),silent_concealed_samples:Math.max(((Ji=Re==null?void 0:Re.silentConcealedSamples)!==null&&Ji!==void 0?Ji:0)-((_s=ye==null?void 0:ye.silentConcealedSamples)!==null&&_s!==void 0?_s:0),0),fraction_audio_concealed:Ou,fraction_packets_lost:Iu,header_bytes_received:Math.max(((as=Re==null?void 0:Re.headerBytesReceived)!==null&&as!==void 0?as:0)-((cs=ye==null?void 0:ye.headerBytesReceived)!==null&&cs!==void 0?cs:0),0),inserted_samples_for_deceleration:Math.max(((Qi=Re==null?void 0:Re.insertedSamplesForDeceleration)!==null&&Qi!==void 0?Qi:0)-((Di=ye==null?void 0:ye.insertedSamplesForDeceleration)!==null&&Di!==void 0?Di:0),0),configured_jitter_buffer_min_delay_ms:$n??0,jitter_buffer_min_obtainable_delay:fl,jitter_buffer_delay_avg:Nc,packets_discarded:Math.max(((ls=Re==null?void 0:Re.packetsDiscarded)!==null&&ls!==void 0?ls:0)-((zs=ye==null?void 0:ye.packetsDiscarded)!==null&&zs!==void 0?zs:0),0),packets_lost:Mu,packets_received:Ns,nack_count:Math.max(((Zi=Re==null?void 0:Re.nackCount)!==null&&Zi!==void 0?Zi:0)-((ba=ye==null?void 0:ye.nackCount)!==null&&ba!==void 0?ba:0),0),removed_samples_for_acceleration:Math.max(((ea=Re==null?void 0:Re.removedSamplesForAcceleration)!==null&&ea!==void 0?ea:0)-((_c=ye==null?void 0:ye.removedSamplesForAcceleration)!==null&&_c!==void 0?_c:0),0),retransmitted_packets_received:Math.max(((yc=Re==null?void 0:Re.retransmittedPacketsReceived)!==null&&yc!==void 0?yc:0)-((Ea=ye==null?void 0:ye.retransmittedPacketsReceived)!==null&&Ea!==void 0?Ea:0),0),retransmitted_bytes_received:Math.max(((hl=Re==null?void 0:Re.retransmittedBytesReceived)!==null&&hl!==void 0?hl:0)-((qa=ye==null?void 0:ye.retransmittedBytesReceived)!==null&&qa!==void 0?qa:0),0),total_samples_received:pd}})(P,B,J,te,$e,z,re)))}}class im extends vr{constructor(b,S,R,O,P=Yt.PUBLISH,B=!1,J=""){super(vn.SIMULCAST_LAYER_INFO,b,S,!1),Object.assign(this.properties,{rid:R,active:O,selected:B,source:P===Yt.PUBLISH?"publisher":"subscriber",remote_participant_id:J})}}class H_ extends vr{constructor(b,S,R,O){super(vn.MULTIHOST_CONFIGURATION,b,S,!1),Object.assign(this.properties,Object.assign(Object.assign({},R),{action:O}))}}class bf extends vr{constructor(b,S,R){super(vn.MULTIHOST_SUBSCRIBE_CONFIGURATION,b,S,!1),Object.assign(this.properties,Object.assign({},R))}}var od,wu,Gl;(function(x){x.Mobile="mobile",x.Tablet="tablet",x.Desktop="desktop",x.Tv="tv"})(od||(od={})),function(x){x.IOS="iOS",x.MacOS="macOS",x.Windows="Windows",x.Android="Android"}(wu||(wu={})),function(x){x.Safari="Safari",x.Firefox="Firefox",x.Chrome="Chrome",x.IE="Internet Explorer",x.Edge="Microsoft Edge"}(Gl||(Gl={}));const Ko=function(x){const b=ql(x);return{platform:{isMobile:ad(od.Mobile,b),isTablet:ad(od.Tablet,b),isDesktop:ad(od.Desktop,b),isTv:ad(od.Tv,b)},os:{name:sm(b),version:Kg(b),isIOS:Ef(wu.IOS,b),isMacOS:Ef(wu.MacOS,b),isWindows:Ef(wu.Windows,b),isAndroid:Ef(wu.Android,b)},browser:{name:Tu(b),version:ma(b),isSafari:ga(Gl.Safari,b),isFirefox:ga(Gl.Firefox,b),isChrome:ga(Gl.Chrome,b),isIE:ga(Gl.IE,b),isEdge:ga(Gl.Edge,b)}}}(window.navigator.userAgent);function ql(x){try{return Ll.getParser(x||window.navigator.userAgent)}catch{}}function ad(x,b){return()=>(b||(b=ql()),!(!b||b.getPlatformType(!0)!==x.toLowerCase()))}function Kg(x){return()=>(x||(x=ql()),x&&x.getOSVersion()||"")}function sm(x){return()=>(x||(x=ql()),x&&x.getOSName()||"")}function Ef(x,b){return()=>(b||(b=ql()),!(!b||b.getOSName(!0)!==x.toLowerCase()))}function ma(x){return()=>(x||(x=ql()),x&&x.getBrowserVersion()||"")}function Tu(x){return()=>(x||(x=ql()),x&&x.getBrowserName()||"")}function ga(x,b){return()=>(b||(b=ql()),!(!b||b.getBrowserName().toLowerCase()!==x.toLowerCase()))}const Ly={active:!1,maxBitrate:2e5,rid:"low",maxFramerate:15,scaleResolutionDownBy:4},Yg={width:320,height:180},th={active:!1,maxBitrate:7e5,rid:"mid",maxFramerate:20,scaleResolutionDownBy:2},xu={width:640,height:360},om={active:!1,maxBitrate:17e5,rid:"hi",maxFramerate:30,scaleResolutionDownBy:1},rn={width:1280,height:720};function nh(x){const{config:b}=x;return[{maxBitrate:b.maxBitrateBps}]}function ll(x,b){var S,R;const O=b==null?void 0:b.track,P=b==null?void 0:b.config;if(x&&O){const B=(0,is.cloneDeep)([{encodingParams:Ly,targetResolution:Yg},{encodingParams:th,targetResolution:xu},{encodingParams:om,targetResolution:rn}]),{height:J,width:te}=O.getSettings(),z=J&&te?{width:te,height:J}:void 0;for(const de of B){de.encodingParams.active=!0;let Me=1;z&&(Me=Math.floor(Math.sqrt(z.width*z.height/(de.targetResolution.width*de.targetResolution.height))),Me=Math.max(Me,1)),de.encodingParams.scaleResolutionDownBy=Me}let re=(S=P==null?void 0:P.maxBitrateBps)!==null&&S!==void 0?S:om.maxBitrate;const ce=(R=P==null?void 0:P.maxFramerate)!==null&&R!==void 0?R:om.maxFramerate;return re<th.maxBitrate&&(re=om.maxBitrate),B[2].encodingParams.maxBitrate=re,B[2].encodingParams.maxFramerate=ce,B[2].encodingParams.scaleResolutionDownBy=1,B.map(de=>de.encodingParams)}return P?[{maxBitrate:P.maxBitrateBps,maxFramerate:P.maxFramerate}]:[{maxBitrate:Io(eh),maxFramerate:zl}]}const Uy=1e3;function Io(x){return x*Uy}const Cu=(x,...b)=>{const S=b.map(R=>typeof R!="object").filter(Boolean).length>0;if(typeof x=="object"&&!S)return(0,is.merge)({},x,...b)},rh=x=>Sf(x),Sf=x=>(0,is.cloneDeep)(x),Xg=x=>{switch(x){case Su.HIGHEST_QUALITY:return"highest";case Su.LOWEST_QUALITY:default:return"lowest"}};var wf=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};const ih="no-rid";class Tf{constructor(b,S,R,O,P,B){this.analyticsTracker=P,this.receiveVideoTransformer=B,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new Mi(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=Tf.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case et.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case et.FAILED:this.flushStats()}},this.action=b,this.token=S,this.traceId=R,this.identifier=O}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:Io(Mo)}}set sdpAnswer(b){try{this.sdp=new Mi(b),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(b,S=!1){this.peerConnection=b,this.simulcastEnabled=S,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var b;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(b=this.peerConnection)===null||b===void 0||b.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(b){this.sfuResource=b}updateMultihostConfiguration(b,S){var R,O,P,B,J,te;return wf(this,void 0,void 0,function*(){if(this.action!==Yt.PUBLISH||!this.peerConnection)return;const z=Tf.defaultMultihostConfiguration();if(S){const re=this.peerConnection.getSenders().filter(de=>de.track!==null&&de.track.kind==="video");re.length>0&&(yield re[0].getStats()).forEach(de=>{de.type==="codec"&&(z.video_codec=de.mimeType)});const ce=S.track.getSettings();z.width=(R=ce.width)!==null&&R!==void 0?R:0,z.height=(O=ce.height)!==null&&O!==void 0?O:0,z.target_fps=(P=ce.frameRate)!==null&&P!==void 0?P:0,S.config?(z.max_bitrate=S.config.maxBitrateBps,z.min_bitrate=S.config.minBitrateBps,z.enable_simulcast=S.config.simulcastEnabled):(z.max_bitrate=Io(eh),z.min_bitrate=Io(gf),z.enable_simulcast=!1)}if(b){const re=b.track.getSettings();z.auto_gain=(B=re.autoGainControl)!==null&&B!==void 0&&B,z.echo_cancellation=(J=re.echoCancellation)!==null&&J!==void 0&&J,z.noise_suppression=(te=re.noiseSuppression)!==null&&te!==void 0&&te,z.max_audio_bitrate_bps=b.config.maxBitrateBps,z.stereo=b.config.stereo}(0,is.isEqual)(z,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new H_(this.token,this.traceId,z,this.action)),this.multihostConfiguration=z)})}updateJitterBufferMinDelay(b){this.jitterBufferMinDelayInMs=b}setupIntervals(){this.action===Yt.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(b,S){return setInterval(b.bind(this),S)}getConnectionState(){var b;if(!this.peerConnection)return et.NONE;const S=(b=this.peerConnection.connectionState)!==null&&b!==void 0?b:this.peerConnection.iceConnectionState;try{return Dy(S)}catch{return et.IDLE}}pollSimulcastLayers(){var b;return wf(this,void 0,void 0,function*(){if(this.getConnectionState()===et.CONNECTED){const S=yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats();if(!S)return;S.forEach(R=>{var O;if(R.type==="outbound-rtp"){const P=((O=R.framesPerSecond)!==null&&O!==void 0?O:0)!==0;switch(R.rid){case"low":P!==this.simulcastState.low&&(this.simulcastState.low=P,this.analyticsTracker.trackEventNoSharedProps(new im(this.token,this.traceId,R.rid,P)));break;case"mid":P!==this.simulcastState.mid&&(this.simulcastState.mid=P,this.analyticsTracker.trackEventNoSharedProps(new im(this.token,this.traceId,R.rid,P)));break;case"hi":P!==this.simulcastState.hi&&(this.simulcastState.hi=P,this.analyticsTracker.trackEventNoSharedProps(new im(this.token,this.traceId,R.rid,P)))}}})}})}flushStats(){var b;return wf(this,void 0,void 0,function*(){const S=yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats();S&&(this.action===Yt.PUBLISH?this.uploadPublisherStats(S):this.action===Yt.SUBSCRIBE&&this.uploadSubscriberStats(S))})}uploadStats(){var b;return wf(this,void 0,void 0,function*(){if(this.getConnectionState()===et.CONNECTED){const S=yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats();if(!S)return;this.action===Yt.PUBLISH?this.uploadPublisherStats(S):this.action===Yt.SUBSCRIBE&&this.uploadSubscriberStats(S)}})}uploadPublisherStats(b){const S={audio:{},video:[]},R=new Map,O=(Date.now()-this.connectionStartedTimestamp)/1e3,P=Object.assign({},this.multihostConfiguration);b.forEach(B=>{if(B.type==="outbound-rtp"){const J=b.get(B.remoteId),te=this.prevRemoteInboundStats.get(B.remoteId);switch(J&&this.prevRemoteInboundStats.set(J.id,J),B.kind){case"audio":S.audio=this.updateOutboundAudio(B),S.audio.remoteInbound=J,S.audio.prevRemoteInbound=te,S.audio.codec=R.get(B.codecId);break;case"video":S.video.push(Object.assign({},this.updateOutboundVideo(B),{remoteInbound:J,prevRemoteInbound:te,codec:R.get(B.codecId)}))}}B.type==="candidate-pair"&&B.nominated&&(S.candidatePair=B),B.type==="codec"&&R.set(B.id,B)}),this.analyticsTracker.trackEventNoSharedProps(new j_(this.token,this.traceId,this.sfuResource,S.audio.outbound,S.audio.remoteInbound,S.candidatePair,S.audio.codec,P,O,this.sdpFeatures)),S.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Gg(this.token,this.traceId,this.sfuResource,S.audio.outbound,S.audio.prevOutbound,S.audio.remoteInbound,S.audio.prevRemoteInbound,S.candidatePair,S.audio.codec,P,this.sdpFeatures)),S.video.forEach(B=>{this.analyticsTracker.trackEventNoSharedProps(new Va(this.token,this.traceId,this.sfuResource,B.outbound,B.remoteInbound,S.candidatePair,B.codec,P,O)),B.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Wo(this.token,this.traceId,this.sfuResource,B.outbound,B.prevOutbound,B.remoteInbound,B.prevRemoteInbound,S.candidatePair,B.codec,P))})}uploadSubscriberStats(b){var S;const R={audio:{},video:{}},O=new Map,P=(Date.now()-this.connectionStartedTimestamp)/1e3,B=(S=this.jitterBufferMinDelayInMs)!==null&&S!==void 0?S:0,{seiReadCnt:J,seiBytesRead:te}=this.updateAndDiffSinceLastUpdate(this.receiveVideoTransformer.getReceiverStats());b.forEach(z=>{if(z.type==="inbound-rtp")switch(z.kind){case"audio":R.audio=this.updateInboundAudio(z),R.audio.codec=O.get(z.codecId);break;case"video":R.video=this.updateInboundVideo(z),R.video.codec=O.get(z.codecId)}z.type==="candidate-pair"&&z.nominated&&(R.candidatePair=z),z.type==="codec"&&O.set(z.id,z)}),this.analyticsTracker.trackEventNoSharedProps(new Wg(this.token,this.traceId,this.identifier,this.sfuResource,R.audio.inbound,R.candidatePair,R.audio.codec,P,this.sdpFeatures)),R.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new xr(this.token,this.traceId,this.identifier,this.sfuResource,R.audio.inbound,R.audio.prevInbound,R.candidatePair,R.audio.codec,this.sdpFeatures,B)),this.analyticsTracker.trackEventNoSharedProps(new $_(this.token,this.traceId,this.identifier,this.sfuResource,R.video.inbound,R.candidatePair,R.video.codec,P)),R.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new qg(this.token,this.traceId,this.identifier,this.sfuResource,R.video.inbound,R.video.prevInbound,R.candidatePair,R.video.codec,B,J,te))}updateAndDiffSinceLastUpdate(b){const S=this.prevVideoReceiverTransformerStats,R=b.seiReadCnt-S.seiReadCnt,O=b.seiBytesRead-S.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:b.seiReadCnt,seiBytesRead:b.seiBytesRead},{seiReadCnt:R,seiBytesRead:O}}updateOutboundAudio(b){const S=b,R=this.prevOutboundAudioStats,O=b.id===(R==null?void 0:R.id)?R:void 0;return this.prevOutboundAudioStats=b,{outbound:S,prevOutbound:O}}updateInboundAudio(b){const S=b,R=this.prevInboundAudioStats,O=b.id===(R==null?void 0:R.id)?R:void 0;return this.prevInboundAudioStats=b,{inbound:S,prevInbound:O}}updateInboundVideo(b){const S=b,R=this.prevInboundVideoStats.get(ih),O=b.id===(R==null?void 0:R.id)?R:void 0;return this.prevInboundVideoStats.set(ih,b),{inbound:S,prevInbound:O}}updateOutboundVideo(b){const S=b,R=this.getPrevOutboundVideo(b),O=b.id===(R==null?void 0:R.id)?R:void 0;return this.setPrevVideoStat(b),{outbound:S,prevOutbound:O}}getPrevOutboundVideo(b){return this.simulcastEnabled&&b.rid&&this.prevOutboundVideoStats.has(b.rid)?this.prevOutboundVideoStats.get(b.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(ih)?this.prevOutboundVideoStats.get(ih):void 0}setPrevVideoStat(b){this.simulcastEnabled&&b.rid?this.prevOutboundVideoStats.set(b.rid,b):this.simulcastEnabled||this.prevOutboundVideoStats.set(ih,b)}}class Yo extends vr{constructor(b,S,R,O,P){super(vn.MINUTE,b,S,!1),Object.assign(this.properties,{action:O?Yt.PUBLISH:Yt.SUBSCRIBE,is_publishing:O,minutes_logged:R,subscribed_number:P})}}class ul extends vr{constructor(b){super(vn.PUBLISH,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.PUBLISH,remote_participant_id:b.token.participantID})}}class xf extends vr{constructor(b){super(vn.UNPUBLISH,b.token,b.traceId,!0),Object.assign(this.properties,{action:Yt.PUBLISH,remote_participant_id:b.token.participantID})}}class cd extends vr{constructor(b){var S,R,O,P;super(vn.SUBSCRIBE,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.subscribedId,subscribed_id:b.subscribedId,is_edp_connected:b.isEdpConnected,is_reassignment:b.isReassignment,node:(R=(S=b.preAttemptSfuResource)===null||S===void 0?void 0:S.node)!==null&&R!==void 0?R:"",cluster:(P=(O=b.preAttemptSfuResource)===null||O===void 0?void 0:O.cluster)!==null&&P!==void 0?P:""})}}class V_ extends vr{constructor(b){super(vn.UNSUBSCRIBE,b.token,b.traceId,!0),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.unsubscribedId,unsubscribed_id:b.unsubscribedId})}}class Jg extends vr{constructor(b){var S,R,O,P;super(vn.PUBLISH_STARTED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.PUBLISH,options_duration:b.optionsDuration,post_duration:b.postDuration,remote_participant_id:b.token.participantID,time_to_candidate:b.timeToCandidate,total_duration:b.totalDuration,edp_initial_connect_duration:b.edpInitialConnectDuration,edp_initial_connect_retry_times:b.edpInitialConnectRetries,edp_initial_state_duration:b.edpInitialStateDuration,edp_state_update_count:b.edpStateUpdateCount,sdp_exchange_duration:b.sdpExchangeDuration,sdp_exchange_transport:b.sdpExchangeTransport,set_remote_desc_duration:b.setRemoteDescDuration,peer_connection_duration:b.peerConnectionDuration,node:(R=(S=b.sfuResource)===null||S===void 0?void 0:S.node)!==null&&R!==void 0?R:"",cluster:(P=(O=b.sfuResource)===null||O===void 0?void 0:O.cluster)!==null&&P!==void 0?P:"",publish_retry_times:b.publishRetries,total_duration_with_retries:b.totalDurationWithRetries})}}class am extends vr{constructor(b){super(vn.PUBLISH_FAILED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.PUBLISH,code:b.code,message:b.message,fatal:b.fatal,nominal:b.nominal})}}class sh extends vr{constructor(b){super(vn.PUBLISH_ENDED,b.token,b.traceId,!0),Object.assign(this.properties,{action:Yt.PUBLISH,remote_participant_id:b.token.participantID,unpublish_successful:b.isUnpublishSuccessful,reason:b.reason})}}class cm extends vr{constructor(b){var S,R,O,P;super(vn.SUBSCRIBE_STARTED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.SUBSCRIBE,options_duration:b.optionsDuration,post_duration:b.postDuration,remote_participant_id:b.remoteParticipantId,time_to_candidate:b.timeToCandidate,total_duration:b.totalDuration,edp_initial_connect_duration:b.edpInitialConnectDuration,edp_initial_connect_retry_times:b.edpInitialConnectRetries,edp_initial_state_duration:b.edpInitialStateDuration,edp_initial_state_publishing_count:b.edpInitialStatePublishingCount,edp_state_update_count:b.edpStateUpdateCount,sdp_exchange_duration:b.sdpExchangeDuration,sdp_exchange_transport:b.sdpExchangeTransport,set_remote_desc_duration:b.setRemoteDescDuration,peer_connection_duration:b.peerConnectionDuration,node:(R=(S=b.sfuResource)===null||S===void 0?void 0:S.node)!==null&&R!==void 0?R:"",cluster:(P=(O=b.sfuResource)===null||O===void 0?void 0:O.cluster)!==null&&P!==void 0?P:"",total_duration_with_retries:b.totalDurationWithRetries,subscribe_retry_times:b.subscribeRetryTimes,is_reassignment:b.isReassignment})}}class z_ extends vr{constructor(b){super(vn.SUBSCRIBE_FAILED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.remoteParticipantId,code:b.code,message:b.message,fatal:b.fatal,nominal:b.nominal,is_reassignment:b.isReassignment})}}class Qg extends vr{constructor(b){super(vn.SUBSCRIBE_ENDED,b.token,b.traceId,!0),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.remoteParticipantId,unsubscribe_successful:b.isUnsubscribeSuccessful,reason:b.reason}),this.critical=!0}}class lm extends vr{constructor(b){super(vn.STATE_UPDATED,b.token,b.traceId,!1),Object.assign(this.properties,{audio_muted:b.isAudioMuted,is_disconnected:b.isDisconnected,is_publishing:b.isPublishing,other_participant_id:b.otherParticipantId,other_participant_user_id:b.otherParticipantUserId,video_stopped:b.isVideoStopped})}}class G_ extends vr{constructor(b){var S,R,O,P,B;super(vn.FIRST_FRAME,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.SUBSCRIBE,remote_participant_id:b.remoteParticipantId,edp_initial_connect_duration:b.edpInitialConnectDuration,edp_initial_connect_retry_times:b.edpInitialConnectRetries,edp_initial_state_duration:b.edpInitialStateDuration,edp_initial_state_publishing_count:b.edpInitialStatePublishingCount,edp_state_update_count:b.edpStateUpdateCount,sdp_exchange_duration:b.sdpExchangeDuration,sdp_exchange_transport:b.sdpExchangeTransport,set_remote_desc_duration:b.setRemoteDescDuration,peer_connection_duration:b.peerConnectionDuration,node:(R=(S=b.sfuResource)===null||S===void 0?void 0:S.node)!==null&&R!==void 0?R:"",cluster:(P=(O=b.sfuResource)===null||O===void 0?void 0:O.cluster)!==null&&P!==void 0?P:"",video_was_paused:b.videoWasPaused,first_frame_duration:b.firstFrameDuration,total_duration_with_retries:b.totalDurationWithRetries,subscribe_retry_times:b.subscribeRetryTimes,media_type:b.mediaType,configured_jitter_buffer_min_delay_ms:(B=b.currentJitterBufferMinDelayInMs)!==null&&B!==void 0?B:0})}}class oh extends vr{constructor(b){super(vn.EDP_PONG,b.token,b.traceId,!1),Object.assign(this.properties,{event_endpoint:b.eventEndpoint,protocol:b.protocol,edp_rtt:b.edpRttMs})}}class Cf extends vr{constructor(b){super(vn.JOIN,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.JOIN,event_endpoint:b.eventEndpoint,whip_endpoint:b.whipEndpoint})}}class ah extends vr{constructor(b){super(vn.JOIN_ATTEMPT,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.JOIN,event_endpoint:b.eventEndpoint,whip_endpoint:b.whipEndpoint})}}class um extends vr{constructor(b){super(vn.JOIN_ATTEMPT_FAILED,b.token,b.traceId,!1),Object.assign(this.properties,{action:Yt.JOIN,event_endpoint:b.eventEndpoint,whip_endpoint:b.whipEndpoint,code:b.code,message:b.message,fatal:b.fatal,nominal:b.nominal,connect_retry_times:b.retryCnt})}}class ch extends vr{constructor(b){super(vn.EDP_DISCONNECTED,b.token,b.traceId,!1),Object.assign(this.properties,{event_endpoint:b.eventEndpoint,protocol:b.protocol}),this.critical=!0}}class Rf extends vr{constructor(b){super(vn.EDP_CONNECTED,b.token,b.traceId,!1),Object.assign(this.properties,{event_endpoint:b.eventEndpoint,protocol:b.protocol,connect_retry_times:b.numRetries}),this.critical=!0}}var Af;(function(x){x.MESSAGE="message",x.RESPONSE="response"})(Af||(Af={}));class q_{constructor(b,S,R){this.token=b,this.analyticsTracker=R,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.latestPingTimestamp=0,this.pongCount=0,this.latestSequenceNumber=0,this.nextConnectionAttempt=0,this.pingInterval=0,this.pongTimeout=0,this.connectTimeout=0,this.beforeUnload=()=>{this.emitter.emit(ol,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(O,P,B,J,te,z,re,ce)=>{var de;const Me={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:P,requestId:J,traceId:B,platform:"web",sdk:"1.19.0",whipVersion:qo,content:O,contentType:"application/sdp"}};te&&(Me.payload.forceNode=te),z&&(Me.payload.assignmentToken=z),re&&(Me.payload.multiCodec=re);const Qe=af()===void 0,$e=af()||Qe;ce&&$e&&(Me.payload.initialLayerPref=Xg(ce)),(de=this.socket)===null||de===void 0||de.send(JSON.stringify(Me))},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new ch({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.logger=new Ks(S,fe.SOCKET),this.emitter=new sc.EventEmitter,this.connectionAttempts=0,this.sentPing=!1,this.receivedPong=!1,this.traceId=Qs(),this.id=`[${Js().value}] `,window.addEventListener("beforeunload",this.beforeUnload)}connect(b,S,R=!1){this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=b,this.traceId=S,R&&!this.connecting&&(window.clearTimeout(this.connectTimeout),this.connectTimeout=window.setTimeout(this.connectTimedOut.bind(this),1e4)),this.attemptConnect(S)}attemptConnect(b){this.traceId=b||Qs(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:S,rawToken:R}=this.token;this.connecting=!0,this.closing=!1;try{const O=encodeURIComponent(this.traceId.value);this.socket=this.createWebSocket(`${this.addr}?topic=${S}/publishers&traceid=${O}`,R),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(O){const P=O instanceof Error?O.message:void 0,B=this.createError(Ut.EVENT_PLANE_WS_CREATE_FAILED,P);this.trackJoinFailed(B,this.getRetryCount()),this.emitter.emit(al,B)}}send(b){var S;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(b)}`}),this.isReady()?(S=this.socket)===null||S===void 0||S.send(JSON.stringify(b)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const b=this.connecting,S=this.socket&&this.socket.readyState===this.socket.OPEN,R=this.socket&&this.socket.readyState===this.socket.CLOSING,O=this.getRetryCount();if(this.closing=!0,this.connecting=!1,this.cleanPingPongTimeouts(),window.clearTimeout(this.nextConnectionAttempt),window.clearTimeout(this.connectTimeout),this.connectionAttempts=0,this.connectTimeout=0,this.socket){if(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,S)this.trackJoinEnded(),this.emitter.emit(ol,"intentional-close");else if(b&&!R){const P=this.createError(Ut.OPERATION_ABORTED);this.trackJoinFailed(P,O),this.analyticsTracker.trackError(P),this.emitter.emit(al,P)}}}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(b,S){return new WebSocket(b,S)}createError(b,S){return new Zn(Object.assign({action:Yt.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:uc.JOIN_RELATED,details:S},b))}on(b,S){this.emitter.on(b,S)}off(b,S){this.emitter.off(b,S)}isReady(){return this.logger.debug({msg:`${this.id}isReady called`}),!!this.socket&&this.socket.readyState===this.socket.OPEN}onMessage(b){this.logger.debug({msg:`${this.id}received message: ${b.data}`});try{const S=JSON.parse(b.data);switch(S.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const R=S.payload.sequenceNumber;R>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&Ju()&&this.connectTimeout>0&&this.triggerSocketOpen(S),this.emitter.emit(Lg,S),this.latestSequenceNumber=R);break}case"PONG":this.receivedPong=!0,this.pongCount%2==0&&this.analyticsTracker.trackEventNoSharedProps(new oh({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp})),this.pongCount++;break;case"REFRESH":this.emitter.emit(Dg);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(Qd,S.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(Qp,S.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(bu,S.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit(id,S.payload);break;default:(0,is.noop)()}}catch(S){this.logger.debug({msg:`onMessage JSON Parse error: ${S}`}),this.emitter.emit(hc,S)}}onError(b){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(b)}`})}onClose(b){if(this.logger.debug({msg:`${this.id}onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.cleanPingPongTimeouts(),this.closing)this.closing=!1;else if(!this.windowUnloading)if(this.connecting){let S=Math.pow(2,this.connectionAttempts-1);S>64&&(S=64),this.logger.debug({msg:`${this.id}reconnecting in ${S} seconds`}),window.clearTimeout(this.nextConnectionAttempt),this.nextConnectionAttempt=window.setTimeout(this.attemptConnect.bind(this),1e3*S);const R=this.createError(Ut.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,`code: ${b==null?void 0:b.code}, reason: ${b==null?void 0:b.reason}, wasClean: ${b==null?void 0:b.wasClean}`);this.trackJoinFailed(R,this.getRetryCount()),this.analyticsTracker.trackError(R)}else{this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(ol,"unknown");const S=this.createError(Ut.EVENT_PLANE_WS_UNEXPECTED_CLOSE,`code: ${b==null?void 0:b.code}, reason: ${b==null?void 0:b.reason}, wasClean: ${b==null?void 0:b.wasClean}`);this.trackJoinEnded(),this.emitter.emit(al,S)}}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),Ju()?this.connectTimeout=window.setTimeout(()=>{this.triggerSocketOpen()},1e4):this.triggerSocketOpen()}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttempt),window.clearTimeout(this.connectTimeout),this.nextConnectionAttempt=0,this.connectTimeout=0}triggerSocketOpen(b){this.clearConnectionAttemptTimeouts();const S=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(),this.emitter.emit(sl,{retryCnt:S,traceId:this.traceId,initialStageState:b}),this.pingInterval=window.setInterval(this.ping.bind(this),3e4)}ping(){var b;this.logger.debug({msg:`${this.id}sending PING`});try{this.latestPingTimestamp=performance.now(),(b=this.socket)===null||b===void 0||b.send(JSON.stringify({type:"PING"})),this.sentPing=!0,this.receivedPong=!1,this.pongTimeout&&clearTimeout(this.pongTimeout),this.pongTimeout=window.setTimeout(this.pongTimedOut.bind(this),5e3)}catch(S){const R=S instanceof Error?S.message:void 0,O=this.createError(Ut.EVENT_PLANE_PING_SEND_FAIL,R);this.emitter.emit(al,O)}}connectTimedOut(){const b=this.socket&&this.socket.readyState===this.socket.CONNECTING;this.connecting=!1,this.logger.debug({msg:`${this.id}Connect timed out!`});const S=this.createError(Ut.JOIN_TIMED_OUT);b&&this.trackJoinFailed(S,this.getRetryCount()),this.createError(Ut.JOIN_TIMED_OUT),this.emitter.emit(al,S),this.close()}pongTimedOut(){if(this.sentPing&&!this.receivedPong){this.logger.debug({msg:`${this.id}Pong timed out!`});const b=this.createError(Ut.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(al,b)}}cleanPingPongTimeouts(){this.sentPing=this.receivedPong=!1,window.clearTimeout(this.pongTimeout),window.clearInterval(this.pingInterval)}trackJoinAttempt(b){const{token:S,traceId:R}=this;this.analyticsTracker.trackEvent(new ah({token:S,eventEndpoint:(S==null?void 0:S.eventsURL)||"",whipEndpoint:(S==null?void 0:S.whipURL)||"",traceId:R}))}trackJoinFailed(b,S){const{token:R,traceId:O,code:P,message:B,fatal:J,nominal:te}=b;this.analyticsTracker.trackEvent(new um({token:R,eventEndpoint:R.eventsURL,whipEndpoint:R.whipURL,traceId:O,code:P,message:B,fatal:J,nominal:te,retryCnt:S}))}trackJoinStarted(){this.analyticsTracker.trackEventNoSharedProps(new Rf({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:this.getRetryCount(),protocol:this.protocol,traceId:this.traceId}))}}var dm=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})},fc,pc,mc,wi;(function(x){x.SDP_EXCHANGE="xdp",x.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(fc||(fc={})),function(x){x.USER_INITIATED="user-initiated",x.CLIENT_RECONNECT="reconnect",x.TOKEN_REUSED="token-reused",x.UNKNOWN="unknown",x.PARTICIPANT_DISCONNECTED="participant-disconnected",x.STAGE_DELETED="stage-deleted"}(pc||(pc={})),function(x){x[x.NOT_CONNECTED=0]="NOT_CONNECTED",x[x.CONNECTION_LOST=1]="CONNECTION_LOST",x[x.TIMEDOUT=2]="TIMEDOUT",x[x.ABORTED=3]="ABORTED",x[x.INVALID_MESSAGE=4]="INVALID_MESSAGE",x[x.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"}(mc||(mc={})),function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"}(wi||(wi={}));class hm extends uo{constructor(b,S,R){super(),this.token=b,this.nonScopedLogger=S,this.analyticsTracker=R,this.participants=new Map,this.disconnected=[],this.state={value:wi.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(O,P)=>{this.logger.debug({msg:"onConnecting",context:O,event:P}),O.connectStartTime=performance.now();const B=P.type==="RECONNECT";B&&this.stageSocket.close();const{eventsURL:J}=this.token;this.emit(yu,wi.CONNECTING),this.state.value=wi.CONNECTING;const te=!B;this.stageSocket.connect(J,this.traceId,te)},this.onConnected=(O,P)=>{this.logger.debug({msg:"onConnected",context:O,event:P}),O.hasConnected=!0,this.emit(zo),this.emit(yu,wi.CONNECTED),this.state.value=wi.CONNECTED},this.onDisconnected=(O,P)=>{this.logger.debug({msg:"onDisconnected",context:O}),this.state.value=wi.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),O.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(yu,wi.DISCONNECTED,P)},this.onErrored=(O,P)=>{this.logger.error({msg:"Connection failure occurred",err:P.payload.error}),this.emit(yu,wi.ERRORED),this.emit(Py,P.payload.error),this.state.value=wi.ERRORED,O.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=O=>{const P=this.state.value,B=this.state.context;switch(P){case wi.DISCONNECTED:O.type==="CONNECT"&&this.onConnecting(B,O);break;case wi.CONNECTING:O.type==="RECONNECT"?this.onConnecting(B,O):O.type==="DISCONNECT"?this.onDisconnected(B,O.reason):O.type==="CONNECT_SUCCESS"?this.onConnected(B,O):O.type==="ERROR"&&this.onErrored(B,O);break;case wi.CONNECTED:O.type==="RECONNECT"?this.onConnecting(B,O):O.type==="DISCONNECT"?this.onDisconnected(B,O.reason):O.type==="ERROR"&&this.onErrored(B,O);break;case wi.ERRORED:O.type==="RECONNECT"?this.onConnecting(B,O):O.type==="DISCONNECT"&&this.onDisconnected(B,O.reason)}},this.measureConnect=(O,P)=>{const B=this.stats.edpConnectCount,J=B+1,te=performance.now(),z=te-P;return Object.assign(this.stats,{edpConnectCount:J,edpConnectDuration:z}),B===0&&Object.assign(this.stats,{edpInitialStartConnectTime:P,edpInitialFinishConnectTime:te,edpInitialConnectDuration:z,edpInitialConnectRetries:O}),this.stats},this.measureStateUpdate=O=>{const{edpInitialFinishConnectTime:P}=this.stats,B=this.stats.edpStateUpdateCount,J=B+1;return Object.assign(this.stats,{edpStateUpdateCount:J}),B===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-P,edpInitialStatePublishingCount:O}),this.stats},this.trackMessageParseError=O=>{this.logger.error({msg:"Message Parse Error occurred",err:O.err});const P=new Zn({token:O.token,traceId:O.traceId,code:Ut.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:O.tag,location:O.location,message:O.message,details:O.err.message});this.analyticsTracker.trackEvent(new zd(P))},this.trackStageSocketMessageParseError=(O,P,B)=>{this.trackMessageParseError({token:O,traceId:P,tag:uc.JOIN_RELATED,location:"StageConnection.onMessage",message:Ut.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:B})},this.trackStageStateMessageParseError=(O,P,B,J)=>{this.trackMessageParseError({token:O,traceId:P,tag:uc.JOIN_RELATED,location:"StageConnection.onStageStateMessage",message:J,err:B})},this.onDisconnectMessage=O=>{this.analyticsTracker.trackEventNoSharedProps(new mf(this.token,this.traceId,`DISCONNECT message received: ${O.code}:${O.reason}`,Yt.JOIN));let P=pc.UNKNOWN;if(O.code==="PARTICIPANT_DISCONNECTED")P=pc.PARTICIPANT_DISCONNECTED;else if(O.code==="STAGE_DELETED")P=pc.STAGE_DELETED;else if(O.code==="TOKEN_REUSED"&&(P=pc.TOKEN_REUSED,gu("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${O.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:P})},this.onReassignmentMessage=O=>{this.emit(js,O)},this.onIncompatibleCodecsMessage=O=>{this.emit(rd,O)},this.onStageStateMessage=(O,P,B)=>{var J,te;this.logger.debug({msg:"State Stage Message occurred",state:B});const z=B.payload,re=(J=z.participants)!==null&&J!==void 0?J:[],ce=(te=z.disconnected)!==null&&te!==void 0?te:[],de=[],Me=[];this.measureStateUpdate(re.length),this.enableFeaturesBasedOnServerFeatures(z.serverFeatures||[]);const Qe=($e,Re)=>{this.analyticsTracker.trackEventNoSharedProps(new lm({token:O,otherParticipantId:$e.id,otherParticipantUserId:$e.userId,isAudioMuted:$e.audioMuted,isVideoStopped:$e.videoStopped,isPublishing:$e.isPublishing,isDisconnected:Re,traceId:P}))};this.participants.forEach($e=>{const Re=re.find(ye=>ye.id===$e.id);if(Re){let ye=!0,gt=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach(Bt=>{ye=ye&&Re[Bt.toString()]===$e[Bt.toString()],ye||($e[Bt.toString()]=Re[Bt.toString()],gt=!0)}),Object.keys($e.attributes).forEach(Bt=>{ye=ye&&Re.attributes[Bt]===$e.attributes[Bt],ye||($e.attributes=Re.attributes,gt=!0)}),gt&&(Qe($e,!1),this.emit(Os,Re))}else Me.push($e)}),re.forEach($e=>{this.participants.get($e.id)||de.push($e)}),Me.forEach($e=>{this.participants.delete($e.id),Qe($e,!0),this.emit(Ni,$e)}),de.forEach($e=>{this.participants.set($e.id,$e),Qe($e,!1),this.emit(dc,$e)}),ce.forEach($e=>{this.disconnected.find(Re=>Re.id===$e.id)||(this.disconnected.push($e),$e.status==="KICKED"&&this.emit(ss,$e))}),this.disconnected=ce},this.nonScopedLogger=S,this.logger=new Ks(S,fe.CONNECTION),this.stageSocket=new q_(b,this.nonScopedLogger,R),this.token=b,this.traceId=Qs()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(b){return dm(this,void 0,void 0,function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:b}),this.traceId=b,this.state.value!==wi.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:pc.CLIENT_RECONNECT})),new Promise((S,R)=>{this.stageSocket.on(sl,O=>{var P,B;const{retryCnt:J,initialStageState:te}=O;te&&this.enableFeaturesBasedOnServerFeatures((B=(P=te.payload)===null||P===void 0?void 0:P.serverFeatures)!==null&&B!==void 0?B:[]),this.traceId=O.traceId||Qs(),this.measureConnect(J,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),S(this.traceId)}),this.stageSocket.on(al,O=>{R(O),this.processStateUpdate({type:"ERROR",payload:{error:O}})}),this.stageSocket.on(Dg,()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit(Jp),this.processStateUpdate({type:"RECONNECT"})}),this.stageSocket.on(Lg,O=>this.onStageStateMessage(this.token,this.traceId,O)),this.stageSocket.on(hc,O=>this.trackStageSocketMessageParseError(this.token,this.traceId,O)),this.stageSocket.on(Qp,this.onDisconnectMessage),this.stageSocket.on(bu,this.onReassignmentMessage),this.stageSocket.on(id,this.onIncompatibleCodecsMessage),this.stageSocket.on(ol,O=>{this.stopStageMinuteLoggedInterval()}),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:b}})})})}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:pc.USER_INITIATED}),this.traceId}getParticipant(b){return this.participants.get(b)}listConnectedParticipants(){const b=[];return this.participants.forEach(S=>{S.subscribed&&b.push(S)}),b}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(b,S){this.stageSocket.send({audioMuted:b,type:"SET_STATE",version:"0",videoStopped:S})}setStagePublishing(b){this.isStagePublishing=b,this.emit(hf,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(b,S){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new Yo(b,S,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval(()=>{this.analyticsTracker.trackEvent(new Yo(b,S??Qs(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++},6e4))}stopStageMinuteLoggedInterval(b=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),b&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(b){const S=(B,J)=>{this.trackStageStateMessageParseError(this.token,this.traceId,J,`Could not parse "${B}" from the Eevee server features list`)},R=b.includes(fc.SDP_EXCHANGE);this.features.sdpExchange!==R&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${R}`}),this.features.sdpExchange=R);const O=b.find(B=>B.indexOf(fc.JITTER_BUFFER_MIN_DELAY_MS)!==-1),P=B=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${B}`}),this.features.jitterBufferMinDelayInMs=B};if(O!==void 0)try{const B=O.split("=")[1],J=parseInt(B,10);if(isNaN(J))throw new Error("Unable to parse - result is NaN");if(J<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===J||P(J)}catch(B){S(O,B),P(void 0)}else P(void 0)}isConnected(){return this.state.value===wi.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(b,S,R,O,P,B,J,te,z){return dm(this,void 0,void 0,function*(){return this.isConnected()?new Promise((re,ce)=>{const de=window.setTimeout(()=>{Me(),ce(mc.TIMEDOUT)},8e3),Me=()=>{window.clearTimeout(de),this.stageSocket.off(Qd,Qe),this.stageSocket.off(al,$e)},Qe=Re=>{Re.requestId===O&&(Me(),re(Re))},$e=()=>{Me(),ce(mc.CONNECTION_LOST)};P==null||P.addEventListener("abort",()=>{Me(),ce(mc.ABORTED)}),this.stageSocket.on(Qd,Qe),this.stageSocket.on(al,$e),this.stageSocket.sendSdpOffer(b,S,R,O,B,J,te,z)}):Promise.reject(mc.NOT_CONNECTED)})}}class Ti{constructor(b){this.token=b}}var Cr=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};const fs={[mc.ABORTED]:Ut.OPERATION_ABORTED,[mc.NOT_CONNECTED]:Ut.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[mc.CONNECTION_LOST]:Ut.XDP_CONNECTION_LOST,[mc.TIMEDOUT]:Ut.XDP_TIMEOUT,[mc.INVALID_MESSAGE]:Ut.XDP_INVALID_ANSWER_MSG,[mc.UNEXPECTED_ERROR]:Ut.XDP_UNEXPECTED_ERROR};class ps extends Ti{constructor(b,S,R,O){super(b),this.token=b,this.stageConnection=S,this.contextData=R,this.analyticsTracker=O}exchange(b){return Cr(this,void 0,void 0,function*(){const S=Js(),{action:R}=this.contextData,{sdpOffer:O,url:P,traceId:B,forceNode:J,assignmentToken:te,multiCodec:z,abortController:re,initialLayerPreference:ce}=b;let de;this.trackAttempt(P,S,B);try{de=yield this.stageConnection.exchangeSdp(O,P,B.value,S.value,re==null?void 0:re.signal,J,te,z,ce)}catch(en){if(typeof en=="number")throw this.createClientSideErrorFromReasonCode(en,B,S,R)}if(!de)return;const{httpStatusCode:Me,errorCode:Qe,location:$e,content:Re,sessionDeleteLink:ye,subscriberControlLink:gt,videoLayersLink:Bt}=de;if(Me>=200&&Me<300)return{sdpAnswer:Re,url:P,location:$e,sessionDeleteLink:ye,mediaControls:gt,layerControls:Bt};throw this.createServerSideError(B,S,Me,Qe,R)})}trackAttempt(b,S,R){const{remoteParticipantId:O,action:P}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new Eu(P,this.token,b,"POST",S.value,O,R,"xdp"))}createServerSideError(b,S,R,O,P){const B=this.baseErrorProps(b,S);let J=Jd(R,O);return J||(J=Ut.UNKNOWN_SERVER_ERROR),new Zn(Object.assign(Object.assign({action:P},B),J))}baseErrorProps(b,S){const{remoteParticipantId:R,action:O}=this.contextData;return{token:this.token,traceId:b,tag:ho(O,R),location:"EdpSdpExchanger.exchange",requestUUID:S,remoteParticipantId:R}}createClientSideErrorFromReasonCode(b,S,R,O){const P=this.baseErrorProps(S,R),B=fs[b];return new Zn(B?Object.assign(Object.assign({action:O},P),B):Object.assign(Object.assign({action:O},P),Ut.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}const Vs=new RegExp("^(?:[a-z+]+:)?//","i");function Zs(x){return Vs.test(x)}var kn=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};class ms extends Ti{constructor(b,S,R){super(b),this.contextData=S,this.analyticsTracker=R}exchange(b){return kn(this,void 0,void 0,function*(){const S=Js(),{token:R}=this,{action:O,remoteParticipantId:P}=this.contextData,{sdpOffer:B,url:J,traceId:te,forceNode:z,assignmentToken:re,multiCodec:ce,abortController:de,initialLayerPreference:Me}=b;try{const $e="POST",Re="http";this.analyticsTracker.trackEventNoSharedProps(new Eu(O,R,J,$e,S.value,P,te,Re));const ye={data:B,headers:{Authorization:`Bearer ${R.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":S.value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":te.value,"X-Stages-WHIP-Version":qo,"X-Stages-Options":(Qe=JSON.stringify({cap:["sau"]}),btoa(Qe).replace(/[^A-Za-z0-9+/]/g,""))},method:$e,responseType:"text",url:J,signal:de==null?void 0:de.signal,params:{}};z&&(ye.params.force_node=z),re&&(ye.params.assignment_token=re),ce&&(ye.params.multi_codec=!0);const gt=af()===void 0,Bt=af()||gt;Me&&ye.headers&&Bt&&(ye.headers["X-Stages-Initial-Layer-Pref"]=Xg(Me));const{data:en,headers:Pt,request:$n}=yield sd(ye),Ln=this.parseWhipResource(J,Pt.location,Pt.link);return{url:$n.responseURL,sdpAnswer:en,location:Ln==null?void 0:Ln.location,sessionDeleteLink:Ln==null?void 0:Ln.sessionDeleteLink,mediaControls:Ln==null?void 0:Ln.mediaControls,layerControls:Ln==null?void 0:Ln.layerControls}}catch($e){if(ds().isCancel($e))throw new Zn(Object.assign(Object.assign({},Ai(Ut.OPERATION_ABORTED,$e)),{action:O,token:R,traceId:te,tag:ho(O,P),location:"StagePeerClient.start",requestUUID:S,remoteParticipantId:P}));const Re=function(ye,gt){var Bt;return ye instanceof ai.AxiosError&&ye.response&&typeof ye.response.status=="number"?ye instanceof ai.AxiosError&&ye.code==="ERR_NETWORK"?Ut.NETWORK_FAILURE:Jd(Number(ye.response.status),(Bt=ye.response.data)===null||Bt===void 0?void 0:Bt.code)||gt:gt}($e,Ut.WHIP_POST_FAILURE);throw new Zn(Object.assign(Object.assign({},Ai(Re,$e)),{action:O,token:R,traceId:te,tag:ho(O,P),location:"StagePeerClient.start",requestUUID:S,remoteParticipantId:P}))}var Qe})}parseWhipResource(b,S,R){const O=new URL(b);let P;return P=function(B,J,te){if(!te)return B;if(B||(B={}),Zs(te))return B.location=te,B;const z=J.port?`:${J.port}`:"";return B.location=`${J.protocol}//${J.hostname}${z}${te}`,B}(P,O,S),P=function(B,J,te){if(!te)return B;B||(B={});const z=B;return te.split(",").forEach(re=>{const ce=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(re);if((ce==null?void 0:ce.length)!==3)return;let de;if(Zs(ce[1]))de=ce[1];else{const Me=J.port?`:${J.port}`:"";de=`${J.protocol}//${J.hostname}${Me}${ce[1]}`}switch(ce[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":z.sessionDeleteLink=de;break;case"urn:ietf:params:whep:core:playback-controls":z.mediaControls=de;break;case"urn:ietf:params:whep:ext:core:layer":z.layerControls=de;break;default:return}}),z}(P,O,R),P}getTransport(){return"http"}}var In=i(1564);function za(x){return x.track.kind===Vl.AUDIO}function ld(x){return x.track.kind===Vl.VIDEO&&typeof x.config=="object"}const fm=(x,b)=>function(S){return S.kind===Vl.AUDIO}(x)?((S,R)=>{var O;const P={maxBitrateBps:Io((O=R==null?void 0:R.maxAudioBitrateKbps)!==null&&O!==void 0?O:64)},B=R==null?void 0:R.stereo;return typeof B=="boolean"&&(P.stereo=B),{track:S,config:P}})(x,b):((S,R)=>{var O,P,B,J;const te=(O=R==null?void 0:R.minBitrate)!==null&&O!==void 0?O:gf,z=(P=R==null?void 0:R.maxBitrate)!==null&&P!==void 0?P:eh,re=(B=R==null?void 0:R.maxFramerate)!==null&&B!==void 0?B:zl,ce=!!(!((J=R==null?void 0:R.simulcast)===null||J===void 0)&&J.enabled);return{track:S,config:{minBitrateBps:Io(te),maxBitrateBps:Io(z),maxFramerate:re,simulcastEnabled:ce,inBandMessagingEnabled:!1}}})(x,b),os=(x,b)=>{if(typeof x=="number")return x;const S=b?Vg:vf;return S[x]!==void 0?S[x]:0};function Xo(x){if(x<gf||x>eh)throw new Error(`Stage bitrate must be between ${gf} kbps and ${eh} kbps`)}function Zg(x,b){const S=_f();let R=Object.assign({},S,(0,is.cloneDeep)(b));return R=function(O,P){var B,J,te;const z=Object.assign({},(0,is.cloneDeep)(P)),re=!Ko.browser.isChrome()&&!Ko.browser.isEdge(),ce=(te=(J=(B=O.getSettings)===null||B===void 0?void 0:B.call(O))===null||J===void 0?void 0:J.displaySurface)!==null&&te!==void 0&&te,de=Io(z.maxBitrate)<th.maxBitrate;return(re||ce||de)&&(z.simulcast.enabled=!1),z}(x,R),Xo(R.maxBitrate),Xo(R.minBitrate),function(O){if(O&&(O>zl||O<Hg))throw new Error(`framerate cannot exceed ${zl} fps`)}(R.maxFramerate),function(O){if(O<tm||O>Mo)throw new Error(`Stage audio bitrate must be between ${tm} kbps and ${Mo} kbps`)}(R.maxAudioBitrateKbps),function(O){if(typeof O!="boolean")throw new Error("Stage stereo prop must be a boolean")}(R.stereo),R}function pm({stageErrorValue:x,action:b,token:S,traceId:R,tag:O,identifier:P,details:B}){return new Zn(Object.assign(Object.assign({},x),{token:S,traceId:R,location:"peer-client",tag:O,action:b,remoteParticipantId:P,details:B}))}var Ii;function eo(x){var b;return!((b=x==null?void 0:x.sender)===null||b===void 0)&&b.createEncodedStreams?Ii.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?Ii.ENCODED_TRANSFORMS:Ii.NONE}function Mf(x){var b;return!((b=x==null?void 0:x.receiver)===null||b===void 0)&&b.createEncodedStreams?Ii.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?Ii.ENCODED_TRANSFORMS:Ii.NONE}function Wl(x){let b=[];const S=new Map;function R(O){const P="0123456789abcdef";let B="";for(let J=0;J<O;J+=1)B+=P.charAt(Math.floor(Math.random()*P.length));return B}return{add(O){const P=R,B=`${P(8)}-${P(4)}-${P(4)}-${P(4)}-${P(12)}`,J=Date.now();return b.push({id:B,enqueuedAt:J,payload:O}),B},poll(O){return S.has(O)||S.set(O,[]),S.size>=x&&(S.forEach(P=>{P.push(...b)}),b=[]),(S.get(O)||[]).splice(0,1)}}}function ev(x,b){return b.type==="sei"?function(S,R){const J=new Uint8Array([1,2,1,8,1,2,3,4,2,2,2,4,4,3,2,1]);function te(ce,de,Me){return Me+de.length<=ce.byteLength&&de.every((Qe,$e)=>ce.getUint8(Me+$e)===Qe)}function z(ce,de){const Me=function($e,Re){return new Uint8Array([0,0,1,6,5,...Re,...$e])}(ce,function($e){const Re=[];for(;$e>=255;)Re.push(255),$e-=255;return Re.push($e),new Uint8Array(Re)}(de.length+ce.length)),Qe=function($e){const Re=[...$e];let ye=3;for(;ye<Re.length-2;)Re[ye]!==0||Re[ye+1]!==0||Re[ye+2]!==0&&Re[ye+2]!==1&&Re[ye+2]!==2&&Re[ye+2]!==3?ye+=1:(Re.splice(ye+2,0,3),ye+=3);return Re}(new Uint8Array([...Me,...de,128]));return new Uint8Array(Qe)}function re(ce,de){const Me=function(Qe){const $e=new DataView(Qe);for(let Re=0;Re<$e.byteLength-4;Re++)if(te($e,[0,0,1],Re)){const ye=31&$e.getUint8(Re+3);if(ye>=1&&ye<=5)return Re}return-1}(S.data);if(Me>=0){const Qe=new ArrayBuffer(S.data.byteLength+de.byteLength),$e=new Uint8Array(Qe);return $e.set(new Uint8Array(S.data.slice(0,Me)),0),$e.set(de,Me),$e.set(new Uint8Array(S.data.slice(Me)),Me+de.byteLength),Qe}return ce}return function(){for(let ce=0;ce<R.length;ce+=1){const de=z(J,new Uint8Array(R[ce]));S.data=re(S.data,de)}return S}()}(x,b.payloads||[]):x}function Oc(x,b){const{type:S,transformerId:R}=b;if(S==="sei"){const O=function(J){function re(Me,Qe,$e){return $e+Qe.length<Me.byteLength&&Qe.every((Re,ye)=>Me.getUint8($e+ye)===Re)}function ce(Me){const Qe=[];let $e=0;for(;$e<Me.length;)Me[$e]===0&&Me[$e+1]===0&&Me[$e+2]===3?(Qe.push(Me[$e]),Qe.push(Me[$e+1]),$e+=3):(Qe.push(Me[$e]),$e+=1);return new Uint8Array(Qe)}function de(Me){let Qe=2;const $e=Me.byteLength;for(;Qe<$e;){let Re=0;for(;Qe<$e&&Me[Qe]===255;)Re+=255,Qe++;Re+=Me[Qe],Qe++;const ye=Math.min(Qe+Re,$e),gt=new Uint8Array(Me.slice(Qe,ye));return{uuid:gt.slice(0,16),payload:gt.slice(16)}}}return{messages:function(Me){const Qe=new DataView(Me.data),$e=[];let Re=0;if(!re(Qe,[0,0,1],0)&&!re(Qe,[0,0,0,1],0))return[];for(;Re<Qe.byteLength-5;)if(re(Qe,[0,0,1],Re)){const ye=Re+3;Re=ye;const gt=31&Qe.getUint8(Re),Bt=31&Qe.getUint8(Re+1);if(gt===6&&Bt===5){for(;Re<Qe.byteLength&&!re(Qe,[0,0,1],Re);)Re++;const en=Re,Pt=de(ce(new Uint8Array(Me.data.slice(ye,en))));Pt&&$e.push(Object.assign(Object.assign({},Pt),{timestamp:Me.timestamp,type:Me.type}))}else Re++}else Re++;return $e}(J),frame:J}}(x),{frame:P,messages:B}=O;return{success:!0,frame:P,type:S,transformerId:R,seiResult:B}}return{success:!0,frame:x,transformerId:R,type:S}}function mm(){let x;const b=O=>(P,B)=>{const J=P.getMetadata().synchronizationSource,te=(x?x.poll(J):[]).map(z=>z.payload);B.enqueue("<SEND_TRANSFORMER_IMPL>"(P,Object.assign(Object.assign({},O),{payloads:te})))},S=O=>(P,B)=>{try{const J="<RECEIVE_TRANSFORMER_IMPL>"(P,O);B.enqueue(J.frame),self.postMessage(Object.assign(Object.assign({success:J.success},O),{seiResult:J.seiResult}))}catch{self.postMessage(Object.assign({success:!1},O))}};function R(O,P,B,J){const te=new TransformStream({transform:O==="video/send"?b(P):S(P)});B.pipeThrough(te).pipeTo(J)}return self.onrtctransform=O=>{const P=O.transformer;P&&R(P.options.method,P.options,P.readable,P.writable)},self.onmessage=O=>{var P;const{operation:B,transformerId:J}=O.data;B==="insert"?(x||(x="<CREATE_MESSAGE_QUEUE>"(1)),x.add((P=O.data)===null||P===void 0?void 0:P.payload)):B!=="video/receive"&&B!=="video/send"||R(B,{method:B,transformerId:J,type:"sei"},O.data.readable,O.data.writable)},{videoReceiveTransform:S,videoSendTransform:b}}(function(x){x.NONE="none",x.ENCODED_TRANSFORMS="encodedTransforms",x.INSERTABLE_STREAMS="insertableStreams"})(Ii||(Ii={}));const If=()=>{let x=mm.toString();return x=x.replace('"<SEND_TRANSFORMER_IMPL>"',ev.toString()),x=x.replace('"<RECEIVE_TRANSFORMER_IMPL>"',Oc.toString()),x=x.replace('"<CREATE_MESSAGE_QUEUE>"',Wl.toString()),x},ud=(()=>{let x;return{getWorker:()=>(x||(x=function(){const b=new Blob([`(${If()})()`],{type:"text/javascript"}),S=URL.createObjectURL(b);return new Worker(S)}()),x),destroy:()=>{x&&x.terminate(),x=void 0}}})(),Of="seiMessageReceived",lh="error";var Pi;(function(x){x.CREATED="created",x.INITIALIZED="initialized",x.DESTROYED="destroyed"})(Pi||(Pi={}));class gc extends uo{constructor({enabled:b}){super(),this.state=Pi.CREATED,this.transformerId=Js().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=S=>{this.onTransformResult(S.data)},b||this.destroy()}initializeInsertableStreams(b){var S;this.worker=ud.getWorker();const R=b.receiver.createEncodedStreams(),{readable:O,writable:P}=R;(S=this.worker)===null||S===void 0||S.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:O,writable:P},[O,P]),this.worker.addEventListener("message",this.onMessage)}initializeEncodedTransforms(b){this.worker=ud.getWorker();const S={method:"video/receive",type:"sei",transformerId:this.transformerId};b.receiver.transform=new RTCRtpScriptTransform(this.worker,S),this.worker.addEventListener("message",this.onMessage)}initialize(b,S){if(this.state!==Pi.CREATED)return!1;const R=Mf(b);if(R===Ii.NONE)return!1;if(S&&R===Ii.INSERTABLE_STREAMS)this.initializeInsertableStreams(b);else{if(S||R!==Ii.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(b)}return this.transceiver=b,this.state=Pi.INITIALIZED,!0}onTransceiverAdd(b){return this.initialize(b,!0)}onTrackEvent(b){return b.track.kind==="video"&&this.initialize(b.transceiver,!1)}static isSupported(b){return Mf(b)!==Ii.NONE}onTransformResult(b){return b.transformerId===this.transformerId&&(b.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!b.seiResult&&(b.seiResult.forEach(S=>{const{payload:R,uuid:O}=S;this.updateReadStats(S),this.emit(Of,{uuid:O,payload:R})}),b.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(b,Ut.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(b,Ut.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(b){this.seiReadCnt++,this.seiBytesRead+=b.payload.byteLength}getReceiverStats(){const{seiBytesRead:b,seiReadCnt:S}=this;return{seiReadCnt:S,seiBytesRead:b}}onError(b,S){const{type:R}=b;this.emit(lh,{type:R,stageErrorValue:S})}destroy(){var b,S;this.state!==Pi.DESTROYED&&(this.removeAllListeners(),(b=this.worker)===null||b===void 0||b.removeEventListener("message",this.onMessage),!((S=this.transceiver)===null||S===void 0)&&S.receiver&&(this.transceiver.receiver.transform=null),this.state=Pi.DESTROYED)}getState(){return this.state}}class va{constructor({enabled:b}){this.state=Pi.CREATED,this.transformerId=Js().value,b||this.destroy()}initializeInsertableStreams(b,S){var R;this.worker=ud.getWorker();const O=b.sender.createEncodedStreams(),{readable:P,writable:B}=O;(R=this.worker)===null||R===void 0||R.postMessage({operation:"video/send",transformerId:this.transformerId,readable:P,writable:B},[P,B])}initializeEncodedTransforms(b,S){this.worker=ud.getWorker();const R={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:S};b.sender.transform=new RTCRtpScriptTransform(this.worker,R)}initialize(b){var S;if(this.state!==Pi.CREATED)return!1;const R=eo(b);if(R===Ii.NONE)return!1;const O=b.sender.getParameters(),P=((S=O==null?void 0:O.encodings)===null||S===void 0?void 0:S.length)||1;if(R===Ii.INSERTABLE_STREAMS)this.initializeInsertableStreams(b,P);else{if(R!==Ii.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(b,P)}return this.transceiver=b,this.state=Pi.INITIALIZED,!0}static isSupported(b){return eo(b)!==Ii.NONE}sendSeiMessage(b){var S;this.state===Pi.INITIALIZED&&this.transceiver&&((S=this.worker)===null||S===void 0||S.postMessage({operation:"insert",transformerId:this.transformerId,payload:b}))}onTransceiverAdd(b){return this.initialize(b)}onTrackEvent(b){return!1}destroy(){var b;this.state!==Pi.DESTROYED&&(!((b=this.transceiver)===null||b===void 0)&&b.receiver&&(this.transceiver.receiver.transform=null),this.state=Pi.DESTROYED)}getState(){return this.state}}var gs=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};let to=null;class kf extends uo{constructor(b,S,R,O,P,B,J,te,z){var re,ce;if(super(),this.analyticsTracker=B,this.sfuResource={node:"",cluster:""},this.stageCapabilities={simulcastNegotiated:!1},this.incompatibleCodecs=new Set,this.connect=({audioOnly:de=!1,traceId:Me,iceRestartOptions:Qe})=>gs(this,void 0,void 0,function*(){const{token:$e,tag:Re,identifier:ye,action:gt}=this,Bt=!!Qe,en=new AbortController;let Pt,$n,Ln;this.abortController=en,this.traceId=Me,this.perfTracker.resetMeasurements(Me);const Or=()=>{Pt&&this.off(fa,Pt),$n&&this.off(Ms,$n)},Br=new Promise((jr,$r)=>{const _r=function({action:Pr,token:Hr,traceId:tr,tag:Sn,identifier:Wn}){const gi=Pr===Yt.SUBSCRIBE?Ut.SUBSCRIBE_TIMED_OUT:Ut.PUBLISH_TIMED_OUT;return new Zn(Object.assign(Object.assign({},gi),{action:Pr,token:Hr,traceId:tr,tag:Sn,location:"connect",remoteParticipantId:Wn}))}({action:gt,token:$e,traceId:Me,tag:Re,identifier:ye}),kr=function({action:Pr,token:Hr,traceId:tr,tag:Sn}){const Wn=Ut.OPERATION_ABORTED;return new Zn(Object.assign(Object.assign({},Wn),{token:Hr,traceId:tr,location:"peer-client.connect",tag:Sn,action:Pr}))}({action:gt,token:$e,traceId:Me,tag:Re}),Nr=setTimeout(()=>{this.stop(),this.analyticsTracker.trackError(_r),$r(_r)},1e4);Pt=Pr=>{clearTimeout(Nr),Bt||this.stop(),$r(Pr)},$n=Pr=>{if(Pr===et.CONNECTED)clearTimeout(Nr),jr();else if(Pr===et.FAILED){const Hr=function({action:tr,token:Sn,traceId:Wn,tag:gi}){return new Zn(Object.assign(Object.assign({},Ut.PEER_CONNECTION_NETWORK_FAILURE),{token:Sn,traceId:Wn,location:"peer-client.connect",tag:gi,action:tr}))}({action:gt,token:$e,traceId:Me,tag:Re});clearTimeout(Nr),$r(Hr)}},this.on(fa,Pt),this.on(Ms,$n),Ln=()=>{clearTimeout(Nr)},en.signal.aborted&&(clearTimeout(Nr),$r(kr)),en.signal.addEventListener("abort",()=>{clearTimeout(Nr),$r(kr)})});try{const jr=yield Promise.all([gs(this,void 0,void 0,function*(){Bt||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(de));const _r=Qe==null?void 0:Qe.assignmentToken,kr=Qe==null?void 0:Qe.nodeOverride;return yield this.exchangeSdp({iceRestart:Bt,nodeOverride:kr,assignmentToken:_r,abortController:en}),this.mediaStream}),Br]);this.statsReporter.traceId=Me;const $r=jr[0];if(this.abortController=void 0,!Bt&&gt===Yt.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(_r){this.logger.error({err:_r,msg:"error syncing transceivers"})}return{mediaStream:$r}}catch(jr){throw Ln&&Ln(),jr}finally{Or()}}),this.disconnect=(de=!1)=>gs(this,void 0,void 0,function*(){var Me;const{token:Qe,action:$e}=this;(Me=this.abortController)===null||Me===void 0||Me.abort(),this.stop(),de?this.cleanup($e,Qe.participantID,Qe,de):yield this.cleanup($e,Qe.participantID,Qe,de)}),this.onTrack=de=>{const{token:Me,action:Qe,traceId:$e,identifier:Re}=this;this.trace(Me,$e,`onTrack: ${de.track.kind}`,Qe,Re),this.videoSenderTransformer.onTrackEvent(de),this.videoReceiverTransformer.onTrackEvent(de)},this.onIceGatheringStateChange=()=>{var de,Me,Qe;const{token:$e,action:Re,traceId:ye,identifier:gt}=this;if(((de=this.peerConnection)===null||de===void 0?void 0:de.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((Me=this.peerConnection)===null||Me===void 0?void 0:Me.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const Bt=this.peerConnection.iceGatheringState,en=new jg(Re,$e,ye,Bt,gt);this.analyticsTracker.trackEventNoSharedProps(en)}this.trace($e,ye,`ICE gathering state change: ${(Qe=this.peerConnection)===null||Qe===void 0?void 0:Qe.iceGatheringState}`,Re,gt)},this.onSelectedCandidatePairChange=()=>{var de,Me;const{token:Qe,action:$e,traceId:Re,identifier:ye}=this,gt=(Me=(de=this.peerConnection)===null||de===void 0?void 0:de.getReceivers()[0].transport)===null||Me===void 0?void 0:Me.iceTransport,Bt=gt==null?void 0:gt.getSelectedCandidatePair();if(Bt){const{local:en,remote:Pt}=Bt,$n=`Selected candidate pair change (local, remote): ${en==null?void 0:en.candidate}, ${Pt==null?void 0:Pt.candidate}`;this.logger.debug({msg:$n}),this.trace(Qe,Re,$n,$e,ye)}},this.onIceCandidate=de=>gs(this,void 0,void 0,function*(){var Me,Qe;const{identifier:$e,action:Re,traceId:ye}=this,gt=(Me=de.target.localDescription)===null||Me===void 0?void 0:Me.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new mf(this.token,ye,`ice candidate: hasRelay = ${gt}, candidate = ${(Qe=de.candidate)===null||Qe===void 0?void 0:Qe.candidate}`,Re,$e))}),this.onMute=()=>gs(this,void 0,void 0,function*(){const{token:de,action:Me,traceId:Qe,identifier:$e}=this;this.trace(de,Qe,"Track has muted",Me,$e)}),this.onUnMute=()=>gs(this,void 0,void 0,function*(){const{token:de,action:Me,traceId:Qe,identifier:$e}=this;this.trace(de,Qe,"Track has unmuted",Me,$e)}),this.fetchAndSetRemoteDescription=de=>gs(this,void 0,void 0,function*(){var Me,Qe,$e,Re;const ye=(Qe=(Me=this.peerConnection)===null||Me===void 0?void 0:Me.localDescription)===null||Qe===void 0?void 0:Qe.sdp;ye||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:gt,traceId:Bt,action:en,identifier:Pt,tag:$n}=this,{endpointURL:Ln,nodeOverride:Or,assignmentToken:Br,multiCodec:jr,abortController:$r}=de;let _r;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{this.perfTracker.setTransport(this.sdpExchanger.getTransport());const tr=Or||of("node")||of("dataPlaneEndpoint");_r=yield this.sdpExchanger.exchange({sdpOffer:ye,url:Ln,traceId:Bt,forceNode:tr,assignmentToken:Br,multiCodec:jr,abortController:$r,initialLayerPreference:($e=this.simulcastSubscribeConfig)===null||$e===void 0?void 0:$e.initialLayerPreference})}catch(tr){let Sn=tr;Sn instanceof Zn||(Sn=new Zn(Object.assign(Object.assign({},Ut.UNEXPECTED_ERROR),{action:en,token:gt,traceId:Bt,tag:$n,details:tr instanceof Error?tr.message:"",location:"sdp-exchange"}))),Sn instanceof Zn&&(this.analyticsTracker.trackError(Sn),this.emit(fa,Sn))}if(this.perfTracker.markSdpExchangeStop(),!_r)return;const{location:kr,sessionDeleteLink:Nr,mediaControls:Pr}=_r;let Hr=_r.sdpAnswer;try{Hr=this.mungeSdpAnswer(Hr),_r.sdpAnswer=Hr}catch(tr){this.logger.error({err:tr,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=Hr,this.emit(el,_r),kr&&(this.whipResource={location:kr,sessionDeleteLink:Nr,mediaControls:Pr},this.sfuResource=function(tr){const Sn=tr.match(/https:\/\/([^/]+)\//);if(Sn){const Wn=Sn[1].split(".");if(Wn[0].includes("video-rtx"))return{node:`${Wn[0]}.${Wn[1]}`,cluster:Wn[1]}}}(kr)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(Re=this.peerConnection)===null||Re===void 0?void 0:Re.setRemoteDescription({sdp:Hr,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(tr){const Sn=new Zn(Object.assign(Object.assign({},Ut.SET_ANSWER_FAILURE),{action:en,token:gt,traceId:Bt,tag:ho(en,Pt),location:"setRemoteDescription",remoteParticipantId:Pt,details:tr instanceof Error?tr.message:""}));this.analyticsTracker.trackError(Sn),this.emit(fa,Sn)}}),this.cleanup=(de,Me,Qe,$e=!1)=>gs(this,void 0,void 0,function*(){var Re,ye,gt;const Bt=Js();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,!(!((Re=this.whipResource)===null||Re===void 0)&&Re.location))return this.trace(Qe,this.traceId,"whipResource location not known, exiting cleanup",de,Me),void this.analyticsTracker.trackError(new Zn(Object.assign(Object.assign({},Ut.WHIP_URL_MISSING),{action:de,token:Qe,traceId:this.traceId,tag:ho(de,Me),location:de===Yt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Bt,remoteParticipantId:Me})));let en=this.whipResource.location;if(this.trace(Qe,this.traceId,`use hostnamecachedurl: ${en}`,de,Me),$e){if(!((gt=this.whipResource)===null||gt===void 0)&&gt.sessionDeleteLink){en=this.whipResource.sessionDeleteLink,this.trace(Qe,this.traceId,`DELETE via session-delete beacon path: ${en}`,de,Me);try{navigator.sendBeacon(en,JSON.stringify({authorization:Qe.rawToken}))}catch(Pt){this.analyticsTracker.trackErrorAndThrow(new Zn(Object.assign(Object.assign({},Ai(Ut.WHIP_DELETE_FAILURE,Pt)),{action:de,token:Qe,traceId:this.traceId,tag:ho(de,Me),location:Yt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Bt,remoteParticipantId:Me})))}}}else try{yield ds().delete(en,{headers:{Authorization:`Bearer ${Qe.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":Bt.value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":qo}})}catch(Pt){((ye=Pt.response)===null||ye===void 0?void 0:ye.status)===404?this.trace(Qe,this.traceId,`DELETE returned 404, ignoring, action = ${de}, uuid = ${Bt.value}`,de,Me):this.analyticsTracker.trackErrorAndThrow(new Zn(Object.assign(Object.assign({},Ai(Ut.WHIP_DELETE_FAILURE,Pt)),{action:de,token:Qe,traceId:this.traceId,tag:ho(de,Me),location:Yt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:Bt,remoteParticipantId:Me})))}}),this.getConnectionState=()=>{if(!this.peerConnection)return et.NONE;const de=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return Dy(de)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:de}),et.IDLE}},this.onIceCandidateError=de=>{const{token:Me,traceId:Qe,tag:$e}=this;if(de.errorCode!==701){const Re=new Zn(Object.assign(Object.assign({},Ut.ICE_CANDIDATE_ERROR),{action:this.action,token:Me,traceId:Qe,tag:$e,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(Re),this.emit(fa,Re)}},this.onIceConnectionStateChange=()=>{var de;const{token:Me,traceId:Qe,action:$e,identifier:Re}=this;this.trace(Me,Qe,`ICE connection state change: ${(de=this.peerConnection)===null||de===void 0?void 0:de.iceConnectionState}`,$e,Re),this.onConnectionStateChange()},this.createVideoReceiverTransformer=({enabled:de})=>{const Me=new gc({enabled:de}),{token:Qe,tag:$e,identifier:Re,action:ye,traceId:gt}=this;Me.on(Of,Pt=>{this.emit(ed,Pt)});const Bt=function(Pt,$n){let Ln=0;return function(...Or){const Br=Date.now();Br-Ln>=$n&&(Ln=Br,Pt(...Or))}}(Pt=>{const $n=`Transform error occurred: ${Pt.type}`,Ln=pm({traceId:gt,token:Qe,tag:$e,identifier:Re,action:ye,details:$n,stageErrorValue:Ut.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:Ln,msg:"Error encountered when transforming receiver",error:Pt})},1e3),en=Pt=>{const $n=`Too many errors occurred: ${Pt.type}`,Ln=pm({traceId:gt,token:Qe,tag:$e,identifier:Re,action:ye,details:$n,stageErrorValue:Ut.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:Ln,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:Pt}),Me.destroy(),this.analyticsTracker.trackError(Ln),this.emit(st,Ln)};return Me.on(lh,Pt=>{Pt.stageErrorValue.code!==Ut.TRANSFORM_TOO_MANY_ERRORS.code?Bt(Pt):en(Pt)}),Me},this.onConnectionStateChange=()=>{var de;if(this.peerConnection){const Qe=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:$e,traceId:Re,identifier:ye,action:gt}=this,Bt=new po(gt,$e,Re,Qe,ye);this.analyticsTracker.trackEventNoSharedProps(Bt),this.trace($e,Re,`connection state change: ${Qe}`,gt,ye)}const Me=this.getConnectionState();switch(Me){case et.CONNECTED:this.perfTracker.markActionStop(),this.emit(Ms,Me),this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub),(de=this.peerConnection)===null||de===void 0||de.getTransceivers().forEach(Qe=>{var $e,Re;!((Re=($e=Qe.receiver)===null||$e===void 0?void 0:$e.transport)===null||Re===void 0)&&Re.iceTransport&&Qe.receiver.transport.iceTransport.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)});break;case et.FAILED:this.emit(Ms,Me),this.handleConnectionFailure();break;default:this.emit(Ms,Me)}},this.onIncompatibleCodecs=de=>gs(this,void 0,void 0,function*(){if(de.forEach($e=>{let Re=!1;this.incompatibleCodecs.forEach(ye=>{ye.config===$e.config&&ye.mime===$e.mime&&(Re=!0)}),Re||this.incompatibleCodecs.add($e)}),this.peerConnection)try{yield(Me=this.peerConnection,Qe=[...this.incompatibleCodecs],yf(void 0,void 0,void 0,function*(){var $e;for(const Re of Me.getSenders()){const ye=Re.getParameters();if(ye.codecs.length>1){const gt=ye.codecs[0];let Bt=!1;for(const en of Qe)B_(gt,en)&&(Bt=!0);if(Bt){const en=zg(Qe,ye.codecs);($e=ye.encodings)===null||$e===void 0||$e.forEach(Pt=>{Pt.active&&(Pt.codec=en)}),yield Re.setParameters(ye)}}}}))}catch($e){const{token:Re,action:ye,traceId:gt,identifier:Bt}=this,en=new Zn(Object.assign(Object.assign({},Ut.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:ye,token:Re,traceId:gt,tag:ho(ye,Bt),location:"onIncompatibleCodecs",remoteParticipantId:Bt,details:$e instanceof Error?$e.message:""}));this.analyticsTracker.trackError(en),this.emit(fa,en)}var Me,Qe}),this.token=b,this.logger=new Ks(S,fe.WEBRTC),this.action=R,this.tag=O,this.traceId=P,R===Yt.SUBSCRIBE&&!J)throw new Error("Subscribe action provided without subscriber Id");this.inBandMessagingEnabled=R===Yt.SUBSCRIBE?!!(!((re=z==null?void 0:z.inBandMessaging)===null||re===void 0)&&re.enabled):(ce=gu("enableInBandMessaging"))!==null&&ce!==void 0&&ce,this.jitterBufferConfig=z==null?void 0:z.jitterBuffer,this.simulcastSubscribeConfig=z==null?void 0:z.simulcast,this.subscriberId=J,this.stageConnection=te,this.videoSenderTransformer=new va({enabled:this.action===Yt.PUBLISH&&this.inBandMessagingEnabled}),this.videoReceiverTransformer=this.createVideoReceiverTransformer({enabled:this.action===Yt.SUBSCRIBE&&this.inBandMessagingEnabled}),this.perfTracker=new F_(this.action,this.traceId),this.statsReporter=new Tf(R,b,P,this.identifier,this.analyticsTracker,this.videoReceiverTransformer),this.sdpExchanger=function(de){const{connection:Me,token:Qe,action:$e,identifier:Re,tracker:ye}=de,gt=Me&&Me.supportsSdpExchange(),Bt=$e===Yt.SUBSCRIBE&&gt&&!Fp(),en=$e===Yt.PUBLISH&&gt&&Ju()&&!Fp();return Bt||en?new ps(Qe,Me,{action:$e,remoteParticipantId:Re},ye):new ms(Qe,{action:$e,remoteParticipantId:Re},ye)}({connection:te,action:R,token:b,identifier:this.identifier,tracker:B}),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var b,S;return(S=(b=this.videoTransceiver)===null||b===void 0?void 0:b.mid)!==null&&S!==void 0?S:null}toggleStageConnectionListeners(b){var S,R;b?(S=this.stageConnection)===null||S===void 0||S.on(hf,this.handlePublishingChangedBinding):(R=this.stageConnection)===null||R===void 0||R.off(hf,this.handlePublishingChangedBinding)}updateSubscribeConfig(b){var S,R;this.jitterBufferConfig=b.jitterBuffer,this.simulcastSubscribeConfig=b.simulcast,this.action===Yt.SUBSCRIBE&&(this.inBandMessagingEnabled=b.inBandMessaging.enabled),this.applyJitterBufferMinDelayConditionally((R=(S=this.stageConnection)===null||S===void 0?void 0:S.getIsStagePublishing())!==null&&R!==void 0&&R)}verifyOrUpdateTransceiverSync(){var b,S;return gs(this,void 0,void 0,function*(){if(this.videoTrackForPub){const R=this.getTransceiverForKind("video");R?this.videoTrackForPub.track.id!==((b=R.sender.track)===null||b===void 0?void 0:b.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateTrack(this.videoTrackForPub)):this.logger.warn({msg:"missing transceiver for video"})}if(this.audioTrackForPub){const R=this.getTransceiverForKind("audio");R?this.audioTrackForPub.track.id!==((S=R.sender.track)===null||S===void 0?void 0:S.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateTrack(this.audioTrackForPub)):this.logger.warn({msg:"missing transceiver for audio"})}})}start(){var b,S,R;return gs(this,void 0,void 0,function*(){const{token:O,action:P,traceId:B,identifier:J}=this;P!==Yt.PUBLISH||O.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new Zn(Object.assign(Object.assign({},Ai(Ut.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:P,token:O,traceId:B,tag:ho(P,J),location:"StagePeerClient.start",remoteParticipantId:J})));const te=function({action:z,identifier:re,token:ce,analyticsTracker:de}){let Me="";const Qe=cl(ce,de);switch(z){case Yt.PUBLISH:Me=Qe.getPublishEndpoint();break;case Yt.SUBSCRIBE:re&&(Me=Qe.getSubscribeEndpoint(re))}return Me}({action:P,identifier:J,token:O.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.stageCapabilities={simulcastNegotiated:(R=(S=(b=this.videoTrackForPub)===null||b===void 0?void 0:b.config)===null||S===void 0?void 0:S.simulcastEnabled)!==null&&R!==void 0&&R},this.endpointURL=te,this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,this.stageCapabilities.simulcastNegotiated),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute),this.trace(O,B,"peer connection created",P,J)}catch(z){const re=new Zn(Object.assign(Object.assign({action:P},Ai(Ut.CREATE_PEER_CONNECTION_FAILURE,z)),{token:O,traceId:B,tag:ho(P,J),location:"StagePeerClient.start",remoteParticipantId:J}));P===Yt.PUBLISH&&this.emit(Ms,et.FAILED),this.emit(fa,re),this.analyticsTracker.trackErrorAndThrow(re)}})}mungeSdpOffer(b,S,R){if(R.simulcastNegotiated&&(b=new Mi(b).withVideoLayersAllocationRtpHeaderExtension().sdp),S===Yt.SUBSCRIBE)b=new Mi(b).withOpusAudioConfig(Io(Mo),!0).sdp;else if(S===Yt.PUBLISH&&R.audioConfig){const{maxBitrateBps:O,stereo:P}=R.audioConfig;b=new Mi(b).withOpusAudioConfig(O,P).sdp}return b}mungeSdpAnswer(b){return Ko.browser.isFirefox()&&this.audioTrackForPub&&this.action===Yt.PUBLISH&&(b=new Mi(b).withOpusAudioConfig(this.audioTrackForPub.config.maxBitrateBps,void 0).sdp),b}stop(){var b,S,R,O,P,B,J,te,z;this.statsReporter.stop(),this.videoReceiverTransformer.destroy(),this.videoSenderTransformer.destroy(),(b=this.peerConnection)===null||b===void 0||b.removeEventListener("connectionstatechange",this.onConnectionStateChange),(S=this.peerConnection)===null||S===void 0||S.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(R=this.peerConnection)===null||R===void 0||R.removeEventListener("icecandidateerror",this.onIceCandidateError),(O=this.peerConnection)===null||O===void 0||O.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(P=this.peerConnection)===null||P===void 0||P.removeEventListener("track",this.onTrack),(B=this.peerConnection)===null||B===void 0||B.removeEventListener("mute",this.onMute),(J=this.peerConnection)===null||J===void 0||J.removeEventListener("unmute",this.onUnMute),(te=this.peerConnection)===null||te===void 0||te.removeEventListener("icecandidate",this.onIceCandidate),(z=this.peerConnection)===null||z===void 0||z.close()}getTransceiverForKind(b){if(!this.peerConnection)return;const S=this.peerConnection.getTransceivers();return b==="audio"?S.find(R=>R.mid==="0"):b==="video"?S.find(R=>R.mid==="1"):void 0}removeTrack(b){return gs(this,void 0,void 0,function*(){if(b==="audio"||b==="video")if(this.peerConnection)try{const S=this.getTransceiverForKind(b);if(!S)return void this.logger.warn({msg:`tried removing track type ${b} but couldn't find transceiver`});yield S.sender.replaceTrack(null),b===Vl.AUDIO?this.audioTrackForPub=void 0:this.videoTrackForPub=void 0,yield this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub)}catch(S){this.logger.warn({msg:"error replacing track",err:S})}else b===Vl.AUDIO?this.audioTrackForPub=void 0:this.videoTrackForPub=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:b})})}replaceOrUpdateTrack(b){return gs(this,void 0,void 0,function*(){if(b.track){if(za(b)?this.audioTrackForPub=b:ld(b)&&(this.videoTrackForPub=b),this.peerConnection)try{const S=this.getTransceiverForKind(b.track.kind);if(!S)return void this.logger.warn({msg:`tried replacing track type ${b.track.kind} but couldn't find transceiver`,track:b.track});if(ld(b)){const R=S.sender.getParameters(),O=ll(this.stageCapabilities.simulcastNegotiated,b);R.encodings=R.encodings.map(P=>{var B;const J=(B=P.rid)!==null&&B!==void 0?B:"",te=O.find(z=>{var re;return((re=z.rid)!==null&&re!==void 0?re:"")===J});return te?Object.assign(Object.assign({},P),te):P}),yield S.sender.setParameters(R)}else if(za(b)){const R=S.sender.getParameters(),O=nh(b)[0];R.encodings=R.encodings.map(P=>Object.assign(Object.assign({},P),O)),yield S.sender.setParameters(R)}yield S.sender.replaceTrack(b.track),yield this.statsReporter.updateMultihostConfiguration(this.audioTrackForPub,this.videoTrackForPub)}catch(S){this.logger.warn({msg:"error replacing track",err:S})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateTrack with no track"})})}initializePeerConnection(b=!1){var S,R,O;return gs(this,void 0,void 0,function*(){const{traceId:P,token:B,action:J,identifier:te}=this;Ac(this.peerConnection);let z=new MediaStream;if(J===Yt.PUBLISH){this.audioTrackForPub||(this.audioTrackForPub={track:this.getSilentAudio(),config:{maxBitrateBps:Io(tm),stereo:!1}});const re=this.peerConnection.getTransceivers(),ce=[];re.forEach(ye=>{var gt;ce.concat((gt=ye.sender.track)===null||gt===void 0?void 0:gt.id)}),z=new MediaStream([this.audioTrackForPub.track,(S=this.videoTrackForPub)===null||S===void 0?void 0:S.track].filter(ye=>!!ye&&!ce.includes(ye.id)));const de=z.getAudioTracks()[0]||"audio",Me=z.getVideoTracks()[0]||"video",Qe={direction:"sendonly",streams:[z],sendEncodings:nh(this.audioTrackForPub)},$e={direction:"sendrecv",streams:[z],sendEncodings:ll(this.stageCapabilities.simulcastNegotiated,this.videoTrackForPub)};this.peerConnection.addTransceiver(de,Qe),this.trace(B,P,`track added, type: ${de.kind||de}`,J,te);const Re=this.peerConnection.addTransceiver(Me,$e);this.trace(B,P,`track added, type: ${Me.kind||Me}`,J,te),this.inBandMessagingEnabled&&!va.isSupported(Re)&&this.handleTransformNotSupported(),this.videoSenderTransformer.onTransceiverAdd(Re)}else J===Yt.SUBSCRIBE&&(B.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(B,P,"track added, type: audio",J,te),b||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(B,P,"track added, type: video",J,te),this.inBandMessagingEnabled&&!gc.isSupported(this.videoTransceiver)&&this.handleTransformNotSupported(),this.videoReceiverTransformer.onTransceiverAdd(this.videoTransceiver)),this.peerConnection.getTransceivers().forEach(re=>{re.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),z==null||z.addTrack(re.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})}),this.applyJitterBufferMinDelayConditionally((O=(R=this.stageConnection)===null||R===void 0?void 0:R.getIsStagePublishing())!==null&&O!==void 0&&O));return z})}handlePublishingChanged(b){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${b}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===Yt.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(b)}applyJitterBufferMinDelayConditionally(b){const S=this.currentJitterBufferMinDelayInMs,R=this.calcJitterBufferMinDelay(b,this.jitterBufferConfig);if(b){if(S===void 0||S>R){const O=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${R}`;this.logger.debug({msg:O}),this.trace(this.token,this.traceId,O,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(R)}}else if(S===void 0||R!==S){const O=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${R}`;this.logger.debug({msg:O}),this.trace(this.token,this.traceId,O,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(R)}}calcJitterBufferMinDelay(b,S){var R,O,P;let B=0;if(!(()=>{const J=RTCRtpReceiver.prototype;return!(!J||typeof J!="object")&&("jitterBufferTarget"in J||"playoutDelayHint"in J)})())return 0;if(b)B=os((R=S==null?void 0:S.minDelayWhenPublishing)!==null&&R!==void 0?R:hs.DEFAULT,b);else{B=os((O=S==null?void 0:S.minDelayWhenSubscribeOnly)!==null&&O!==void 0?O:hs.DEFAULT,b);const J=(P=this.stageConnection)===null||P===void 0?void 0:P.jitterBufferMinDelayInMs();(S==null?void 0:S.minDelayWhenSubscribeOnly)===hs.DEFAULT&&J!==void 0&&(B=J,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${B}`}))}return B}applyAndTrackJitterBufferMinDelay(b){var S,R;this.currentJitterBufferMinDelayInMs=b,this.statsReporter.updateJitterBufferMinDelay(b),b!==void 0&&((R=(S=this.peerConnection)===null||S===void 0?void 0:S.getTransceivers())===null||R===void 0||R.forEach(O=>{O.receiver&&this.applyJitterBufferMinDelay(O.receiver,b)}))}applyJitterBufferMinDelay(b,S){let R="Unable to set jitter buffer min delay";if("jitterBufferTarget"in b)R=`setting jitterBufferTarget to: ${S} for track: ${b.track.kind}`,this.logger.debug({msg:R}),b.jitterBufferTarget=S;else if("playoutDelayHint"in b){const O=S/1e3;R=`setting playoutDelayHint to: ${S} for track: ${b.track.kind}`,this.logger.debug({msg:R}),b.playoutDelayHint=O}else this.logger.warn({msg:R});this.trace(this.token,this.traceId,R,this.action,this.identifier)}exchangeSdp(b){var S;return gs(this,void 0,void 0,function*(){const{traceId:R,token:O,action:P,identifier:B,tag:J,endpointURL:te}=this,{iceRestart:z=!1,nodeOverride:re,assignmentToken:ce,abortController:de}=b;let Me;this.logger.debug({msg:`Exchanging SDP: ${R.value}, iceRestart=${z}, nodeOverride=${re}, assignmentToken=${ce}`}),Ac(this.peerConnection),P===Yt.PUBLISH&&ha()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),(($e,Re)=>{var ye,gt;const Bt=(ye=RTCRtpReceiver.getCapabilities("video"))===null||ye===void 0?void 0:ye.codecs;if(!Bt)return;let en=Bt;en=mo(Bt,"42e0"),Re.preferMainProfile&&(en=mo(Bt,"4d00")),(gt=$e.getTransceivers().find(Pt=>Pt.receiver.track.kind==="video"))===null||gt===void 0||gt.setCodecPreferences(en)})(this.peerConnection,{preferMainProfile:ha()}));try{this.trace(O,R,"Creating offer",P,B),Me=yield this.peerConnection.createOffer({iceRestart:z})}catch($e){const Re=new Zn(Object.assign(Object.assign({},Ai(Ut.CREATE_OFFER_FAILURE,$e)),{action:P,token:O,traceId:R,tag:J,location:"exchangeSdp",remoteParticipantId:B}));this.emit(fa,Re),this.analyticsTracker.trackErrorAndThrow(Re)}Me.sdp&&(Me.sdp=this.mungeSdpOffer(Me.sdp,P,{simulcastNegotiated:this.stageCapabilities.simulcastNegotiated,audioConfig:(S=this.audioTrackForPub)===null||S===void 0?void 0:S.config})),this.trace(O,R,"Setting local description",P,B),yield this.peerConnection.setLocalDescription(Me),this.trace(O,R,"local description set",P,B),te||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const Qe=P===Yt.PUBLISH&&ha()||P===Yt.SUBSCRIBE&&gu("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:te,nodeOverride:re,assignmentToken:ce,multiCodec:Qe,abortController:de})})}getReports(){var b;return gs(this,void 0,void 0,function*(){try{const S=(yield(b=this.peerConnection)===null||b===void 0?void 0:b.getStats())||[],R=[];return S.forEach(O=>{R.push(O)}),R}catch{return[]}})}requestRTCStats(b){return gs(this,void 0,void 0,function*(){if(this.peerConnection)return this.peerConnection.getStats(b)})}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:b,tag:S,identifier:R,action:O,traceId:P}=this,B=pm({traceId:P,token:b,tag:S,identifier:R,action:O,stageErrorValue:Ut.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:B,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(B),this.emit(st,B)}handleConnectionFailure(){return gs(this,void 0,void 0,function*(){const{token:b,traceId:S,tag:R}=this;this.analyticsTracker.trackError(new Zn(Object.assign(Object.assign({},Ut.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:b,traceId:S,tag:R,location:"onIceCandidateError",remoteParticipantId:this.identifier})))})}getSilentAudio(){to||(to=new AudioContext);const b=to.createOscillator(),S=to.createGain();b.connect(S);const R=to.createMediaStreamDestination();return S.connect(R),S.gain.value=0,b.start(),R.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}initTracksToPublish(b){this.videoTrackForPub=b.find(ld),this.audioTrackForPub=b.find(za)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var b,S;return this.calcJitterBufferMinDelay((S=(b=this.stageConnection)===null||b===void 0?void 0:b.getIsStagePublishing())!==null&&S!==void 0&&S,this.jitterBufferConfig)}trace(b,S,R,O,P){this.analyticsTracker.trackEventNoSharedProps(new mf(b,S,R,O,P))}sendSeiMessage(b){var S;this.action===Yt.PUBLISH&&((S=this.videoSenderTransformer)===null||S===void 0||S.sendSeiMessage(b))}}const gm=Yt.SUBSCRIBE;class kc{constructor(b,S,R){this.analyticsTracker=b,this.token=S,this.remoteId=R,this.action=gm}trackAttempt({stageConnectionStats:b,isReassignment:S=!1,traceIdOverride:R,preAttemptSfuResource:O}){const{action:P,analyticsTracker:B,token:J,remoteId:te}=this,z=R||Qs();return B.trackEvent(new cd({token:this.token,subscribedId:this.remoteId,traceId:z,isEdpConnected:b.isConnected,isReassignment:S,preAttemptSfuResource:O})),{getTraceId:()=>z,trackSubscribeStarted({totalDurationWithRetries:re,retryTimes:ce,sfuResource:de,peerClientPerfStats:Me}){const{optionsDuration:Qe,postDuration:$e,timeToCandidate:Re,timeToConnected:ye,sdpExchangeDuration:gt,sdpExchangeTransport:Bt,setRemoteDescDuration:en,peerConnectionDuration:Pt}=Me,{edpInitialConnectDuration:$n,edpInitialConnectRetries:Ln,edpInitialStateDuration:Or,edpInitialStatePublishingCount:Br,edpStateUpdateCount:jr}=b;B.trackEvent(new cm({token:J,traceId:z,remoteParticipantId:te,optionsDuration:Qe,postDuration:$e,timeToCandidate:Re,totalDuration:ye,edpInitialConnectDuration:$n,edpInitialConnectRetries:Ln,edpInitialStateDuration:Or,edpInitialStatePublishingCount:Br,edpStateUpdateCount:jr,sdpExchangeDuration:gt,sdpExchangeTransport:Bt,setRemoteDescDuration:en,peerConnectionDuration:Pt,sfuResource:de,totalDurationWithRetries:re,subscribeRetryTimes:ce,isReassignment:S}))},trackSubscribeFirstFrame:({peerClientPerfStats:re,totalDurationWithRetries:ce,sfuResource:de,retryTimes:Me,currentJitterBufferMinDelayInMs:Qe,mediaType:$e,firstFrameDuration:Re})=>{const{sdpExchangeDuration:ye,sdpExchangeTransport:gt,setRemoteDescDuration:Bt,peerConnectionDuration:en}=re,{edpInitialConnectDuration:Pt,edpInitialConnectRetries:$n,edpInitialStateDuration:Ln,edpInitialStatePublishingCount:Or,edpStateUpdateCount:Br}=b;this.analyticsTracker.trackEvent(new G_({token:this.token,traceId:z,remoteParticipantId:te,edpInitialConnectDuration:Pt,edpInitialConnectRetries:$n,edpInitialStateDuration:Ln,edpInitialStatePublishingCount:Or,edpStateUpdateCount:Br,sdpExchangeDuration:ye,sdpExchangeTransport:gt,setRemoteDescDuration:Bt,peerConnectionDuration:en,videoWasPaused:!1,firstFrameDuration:Re,mediaType:$e,sfuResource:de,totalDurationWithRetries:ce,subscribeRetryTimes:Me,currentJitterBufferMinDelayInMs:Qe}))},trackSubscribeFailed(re,ce){const de=(($e,Re,ye)=>{if($e instanceof Zn)return $e;let gt="";return $e instanceof ai.AxiosError&&(gt+=`AxiosError - ${$e.code}`),new Zn(Object.assign(Object.assign(Object.assign({},Ut.SUBSCRIBE_FAILURE),{action:gm,token:Re,traceId:ye,tag:uc.SUBSCRIBE_RELATED,location:"subscribe",details:`${gt} ${$e==null?void 0:$e.message}`}),{fatal:!0}))})(re,J,z);B.trackEvent(new z_({token:J,traceId:z,remoteParticipantId:te,code:de.code,message:de.message,fatal:de.fatal,nominal:de.nominal,isReassignment:S}));const{isConnected:Me}=b,Qe=new Zn(Object.assign(Object.assign({},Ut.SUBSCRIBE_FAILURE),{action:P,token:J,traceId:z,tag:ho(Yt.SUBSCRIBE,te),location:"subscribe",remoteParticipantId:te,isEdpConnected:Me,details:ce}));return re instanceof Zn&&(Qe.fatal=re.fatal,Qe.nominal=re.nominal,Qe.location=`subscribe > ${re.location}`),B.trackError(Qe),de},trackUnsubscribe:()=>{B.trackEvent(new V_({token:J,unsubscribedId:te,traceId:z}))},trackEndSucceeded:re=>{B.trackEvent(new Qg({token:J,traceId:z,remoteParticipantId:te,isUnsubscribeSuccessful:!0,reason:re}))},trackEndFailed:re=>{const ce=new Zn(Object.assign(Object.assign({},Ut.UNSUBSCRIBE_FAILURE),{token:J,traceId:z,tag:ho(Yt.SUBSCRIBE,te),location:"unsubscribe",remoteParticipantId:te}));return re!==Is.UNLOAD&&re!==Is.UNSUBSCRIBE||B.trackError(ce),B.trackEvent(new Qg({token:J,traceId:z,remoteParticipantId:te,isUnsubscribeSuccessful:!0,reason:re})),ce}}}}class uh extends vr{constructor(b,S,R,O,P,B){super(vn.PLAYBACK_LAYER_REQUEST,b,S,!1),Object.assign(this.properties,{media_type:R,remote_participant_id:O,track_id:P,layer_id:B})}}class Ru extends vr{constructor(b,S,R,O,P,B=1){super(vn.PLAYBACK_LAYER_STATE,b,S,!1),Object.assign(this.properties,{media_type:R,remote_participant_id:O,track_id:P,request_count:B})}}var Nf,no,Pf,Hi;(function(x){x.PAUSE="pause",x.PLAY="play"})(Nf||(Nf={})),function(x){x.IDLE="idle",x.ACTIVE="active",x.ERRORED="errored",x.DESTROYED="destroyed"}(no||(no={})),function(x){x.SUCCESS="success"}(Pf||(Pf={})),function(x){x.FAILED="failed",x.DESTROYED="destroyed",x.THROTTLED="throttled"}(Hi||(Hi={}));var dl=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};class W_{constructor(b){this.state=no.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>dl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(Nf.PAUSE)}),this.startVideo=()=>dl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(Nf.PLAY)}),this.setLayer=S=>dl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(S)}),this.unsetLayer=()=>dl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()}),this.getLayers=()=>dl(this,void 0,void 0,function*(){return this.state!==no.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()}),this.sendPlaybackRequest=S=>dl(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,In.err)(Hi.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,In.err)(Hi.FAILED);this.logger.info({msg:`Sending ${S} request to ${this.playbackEndpoint}`});const R=S===Nf.PAUSE?{pause:[this.mid]}:{play:[this.mid]},O=this.createPostWhepRequest(R);return fetch(this.playbackEndpoint,O).then(P=>P.status>=300?(new Error(`Error sending media controls request: ${P.status}:${P.statusText}`),this.logger.error({err:In.err}),(0,In.err)(Hi.FAILED)):(this.logger.debug({msg:`Request to ${S} was successful: ${P.status}`}),(0,In.ok)(Pf.SUCCESS))).catch(P=>(this.logger.error({err:P,msg:"Error sending media controls request"}),(0,In.err)(Hi.FAILED)))}),this.sendLayerRequest=S=>dl(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,In.err)(Hi.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,In.err)(Hi.FAILED);const R=typeof S=="string",O=R?{mediaId:this.mid,encodingId:S}:{},P=R?`set : ${S}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${P} at ${this.layersEndpoint}`});const B=this.createPostWhepRequest(O);return this.trackLayerRequest(S??"auto"),fetch(this.layersEndpoint,B).then(J=>this.state===no.DESTROYED?(0,In.err)(Hi.DESTROYED):J.status>=300?this.handleLayerRequestError(J.status,J.statusText):(this.logger.debug({msg:`Request to ${P} was successful: ${J.status}`}),(0,In.ok)(Pf.SUCCESS))).catch(J=>this.handleLayerRequestError(0,J.message))}),this.sendLayerStateRequest=()=>dl(this,void 0,void 0,function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,In.err)(Hi.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,In.err)(Hi.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const S=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,S).then(R=>dl(this,void 0,void 0,function*(){var O;if(this.state===no.DESTROYED)return(0,In.err)(Hi.DESTROYED);if(R.status>=300)return this.handleLayerStateRequestError(R.status,R.statusText);const P=yield R.json(),B=(O=P==null?void 0:P.layers)!==null&&O!==void 0?O:[],J=JSON.stringify(B,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${J}`}),(0,In.ok)(B)})).catch(R=>this.handleLayerStateRequestError(0,R.message))}),this.logger=new Ks(b.logger,fe.REMOTE_PLAYBACK),this.token=b.token,this.traceId=b.traceId,this.analyticsTracker=b.analyticsTracker,this.remoteParticipantId=b.remoteParticipantId}set mediaId(b){if(this.state!==no.DESTROYED){if(this.mid=b,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=no.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=no.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(b){var S,R;if(this.state!==no.DESTROYED){if(this.playbackEndpoint=(S=b.playback)!==null&&S!==void 0?S:null,this.layersEndpoint=(R=b.layers)!==null&&R!==void 0?R:null,!this.playbackEndpoint||!this.layersEndpoint){const O={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(O,null)}`}),void(this.state=no.IDLE)}this.mid&&(this.state=no.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=no.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(b="command"){this.logger.info({msg:`skipping ${b}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(b){return b===no.DESTROYED?(0,In.err)(Hi.DESTROYED):(0,In.err)(Hi.FAILED)}createPostWhepRequest(b){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(b)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var b,S;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":Js().value,"X-Stages-SDK":"1.19.0","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(S=(b=this.traceId)===null||b===void 0?void 0:b.value)!==null&&S!==void 0?S:"","X-Stages-WHIP-Version":qo}}trackLayerRequest(b){var S;this.analyticsTracker.trackEventNoSharedProps(new uh(this.token,this.traceId,Gt.VIDEO,this.remoteParticipantId,(S=this.mid)!==null&&S!==void 0?S:"unknown",b))}trackLayerStateRequest(b=1){var S;this.analyticsTracker.trackEventNoSharedProps(new Ru(this.token,this.traceId,Gt.VIDEO,this.remoteParticipantId,(S=this.mid)!==null&&S!==void 0?S:"unknown",b))}handleLayerRequestError(b,S){const R=`sendLayerRequest failed for reason: ${b} ${S}`;let O,P;return b===429?(O=Hi.THROTTLED,P=Ut.WHEP_SET_LAYER_REQUEST_THROTTLED):(O=Hi.FAILED,P=Ut.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError(P,R),(0,In.err)(O)}handleLayerStateRequestError(b,S){const R=`sendLayerStateRequest failed for reason: ${b} ${S}`;let O,P;return b===429?(O=Hi.THROTTLED,P=Ut.WHEP_GET_LAYER_STATE_THROTTLED):(O=Hi.FAILED,P=Ut.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError(P,R),(0,In.err)(O)}trackRequestError(b,S){const R=new Error(S);this.logger.error({err:R}),b.message=S;const O=this.createError(b);this.analyticsTracker.trackError(O)}createError(b,S){return new Zn(Object.assign({action:Yt.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:uc.SUBSCRIBE_RELATED,details:S},b))}}var dd,dh,_a,Jo,go=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})},tv=function(x,b,S,R){if(S==="a"&&!R)throw new TypeError("Private accessor was defined without a getter");if(typeof b=="function"?x!==b||!R:!b.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return S==="m"?R:S==="a"?R.call(x):R?R.value:b.get(x)};(function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"})(_a||(_a={})),function(x){x.NONE="none",x.AUDIO_ONLY="audio_only",x.AUDIO_VIDEO="audio_video"}(Jo||(Jo={}));class hd extends uo{constructor(b,S,R,O,P,B,J){super(),this.id=b,this.token=S,this.stageConnection=R,this.nonScopedLogger=O,this.analyticsTracker=P,this.desiredSubscribeType=B,dd.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:_a.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new Fg(1e3),this.cleanupFirstFrameTracking=Zp,this.actualSubscribeType=Jo.NONE,this.action=Yt.SUBSCRIBE,this.updateDesiredSubscribeType=z=>{this.desiredSubscribeType=z,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=z=>{this.peerClient.updateSubscribeConfig(z)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const z=this.actualSubscribeType,re=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${re}`}),this.subscriptionState.connectionState===_a.CONNECTED&&re!==Jo.NONE&&z!==re&&this.applyVideoControlsBySubscribeType(re,z)},this.onParticipantUpdated=z=>{tv(this,dd,"m",dh).call(this,z)&&(this.logger.debug({msg:"onParticipantUpdated",participant:z}),this.processStateUpdate({isTargetPublishing:z.isPublishing}))},this.onParticipantJoined=z=>{tv(this,dd,"m",dh).call(this,z)&&(this.logger.debug({msg:"onParticipantJoined",participant:z}),this.processStateUpdate({isTargetPublishing:z.isPublishing}))},this.onParticipantLeft=z=>{tv(this,dd,"m",dh).call(this,z)&&(this.logger.debug({msg:"onParticipantLeft",participant:z}),this.processStateUpdate({isTargetPublishing:!1}))},this.requestRTCStats=z=>go(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(z)}),this.trySubscribe=z=>go(this,void 0,void 0,function*(){if(this.logger.debug({msg:`Subscribe attempt started: ${z}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==_a.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:_a.CONNECTING}));const re=this.stageConnection.getConnectionStats(),ce=this.peerClient.getExpectedJitterBufferMinDelayInMs(),de=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:re,preAttemptSfuResource:de});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:Me}=yield this.subscribe(this.attemptTracker.getTraceId()),Qe=performance.now()-this.startConnectingTimestamp,$e=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const Re=this.failedRetries;this.attemptToActualizeSubscribeType();const ye=this.peerClient.getActionMeasurements();if(this.attemptTracker.trackSubscribeStarted({sfuResource:$e,totalDurationWithRetries:Qe,retryTimes:Re,peerClientPerfStats:ye}),Me){this.cleanupFirstFrameTracking();const gt=this.actualSubscribeType,Bt=this.attemptTracker,en=(Pt,$n)=>{Bt.trackSubscribeFirstFrame({peerClientPerfStats:ye,sfuResource:$e,totalDurationWithRetries:Qe,retryTimes:Re,currentJitterBufferMinDelayInMs:ce,mediaType:$n,firstFrameDuration:Pt})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:Me,subscribeType:gt,callback:en})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,Me&&this.emit(pe,Me,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(Me){const Qe=this.attemptTracker.trackSubscribeFailed(Me);this.logger.error({log:"Subscribe attempt failed",err:Me}),this.onTrySubscribeFailure(Qe,z)}return!1});const te=Qs();this.peerClient=new kf(S,this.nonScopedLogger,this.action,ho(this.action,b),te,P,b,R,J),this.logger=new Ks(O,fe.SUBSCRIPTION),this.subscribeTracker=new kc(this.analyticsTracker,S,b),this.remotePlaybackController=new W_({token:S,analyticsTracker:P,traceId:te,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(b,S){try{b===Jo.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch(R=>{this.logger.error({err:R,msg:"Remote playback request to stop video failed"})}):b===Jo.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch(R=>{this.logger.error({err:R,msg:"Remote playback request to start video failed"})}),this.actualSubscribeType=b,this.logger.debug({msg:`Desired subscribe type actualized from ${S} to ${b}.`})}catch(R){this.logger.error({err:R,msg:`Error updating subscribe type from ${S} to ${b}.`})}}onPeerClientConnectionStateChange(b){const S=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${b}`,state:b,targetParticipant:S}),this.processStateUpdate({peerClientState:b})}onPeerClientTransformError(b){this.emit($s,b)}processStateUpdate(b){const S=this.previousSignalState,R=Object.assign({},S,b);this.isSubscriptionActive?(R.isTargetPublishing?b.peerClientState===et.CONNECTED?this.updateState({connectionState:_a.CONNECTED,subscribeInProgress:!0}):b.peerClientState===et.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(Is.CONNECTION_FAIL),this.updateState({subscribeInProgress:!1})):(S.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:_a.DISCONNECTED})),(!S.isTargetPublishing&&b.isTargetPublishing||b.peerClientState===et.FAILED)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,b)):this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"})}onTrySubscribeFailure(b,S){this.logger.debug({msg:"Changing/keeping state FAILED"});const R=b.fatal,O=b.code===Ut.OPERATION_ABORTED.code,P=this.failedRetries<=4;if(!O&&!R&&P){const B=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${B}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout(()=>go(this,void 0,void 0,function*(){this.throttledTrySubscribe(S)}),B)}else this.updateState({connectionState:_a.ERRORED}),this.emit(Go,b),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(Ms,this.onPeerClientConnectionStateChange,this),this.peerClient.on(el,S=>{this.remotePlaybackController.endpoints={playback:S.mediaControls,layers:S.layerControls}}),this.peerClient.on(ed,S=>{this.emit($a,S)}),this.peerClient.on(st,this.onPeerClientTransformError,this),this.stageConnection.on(Os,this.onParticipantUpdated),this.stageConnection.on(dc,this.onParticipantJoined),this.stageConnection.on(Ni,this.onParticipantLeft),this.stageConnection.on(ss,this.onParticipantLeft);let b=!0;if(this.stageConnection.isConnected()){const S=this.stageConnection.getParticipant(this.id);b=!!(S!=null&&S.isPublishing)}this.processStateUpdate({isTargetPublishing:b})}throttledTrySubscribe(b){return this.throttler.invoke(this.trySubscribe,b)}updateState(b){b.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=b.subscribeInProgress),b.connectionState&&this.subscriptionState.connectionState!==b.connectionState&&(this.subscriptionState.connectionState=b.connectionState,this.emit(ff,this.subscriptionState.connectionState))}stop(b=!1){this.peerClient.off(Ms,this.onPeerClientConnectionStateChange,this),this.peerClient.off(st,this.onPeerClientTransformError,this),this.unsubscribe(b),this.throttler.clear(),this.stageConnection.off(Os,this.onParticipantUpdated),this.stageConnection.off(dc,this.onParticipantJoined),this.stageConnection.off(Ni,this.onParticipantLeft),this.stageConnection.off(ss,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:_a.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(b,S){return go(this,void 0,void 0,function*(){const{token:R,id:O}=this;R.assertTokenIsUnexpired(b,ho(Yt.SUBSCRIBE,O),"subscribe",O);const{mediaStream:P}=yield this.peerClient.connect({audioOnly:S,traceId:b});return{peerClient:this.peerClient,mediaStream:P}})}unsubscribe(b=!1){return go(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===_a.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const S=b?Is.UNLOAD:Is.UNSUBSCRIBE;try{b?this.peerClient.disconnect(b):yield this.peerClient.disconnect(b),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(S)}catch{this.attemptTracker.trackEndFailed(S)}})}triggerIceRestart(b){var S;return go(this,void 0,void 0,function*(){const R=this.stageConnection.getConnectionStats(),O=this.peerClient.getSfuResource(),P=this.subscribeTracker.trackAttempt({stageConnectionStats:R,isReassignment:!0,traceIdOverride:b.traceId,preAttemptSfuResource:O}),B=performance.now();try{this.emit(Mr),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:b,traceId:b.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const J=performance.now()-B,te=this.peerClient.getSfuResource(),z=this.peerClient.getActionMeasurements();(S=this.attemptTracker)===null||S===void 0||S.trackEndSucceeded(Is.REASSIGNMENT),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),P.trackSubscribeStarted({totalDurationWithRetries:J,sfuResource:te,retryTimes:0,peerClientPerfStats:z}),this.emit(rl)}catch(J){this.emit(il),this.logger.error({msg:"ICE restart attempt failed",err:J});const te=this.peerClient.getSfuResource(),z=P.trackSubscribeFailed(J,`iceRestart=true, startNode=${O.node}, endNode=${te==null?void 0:te.node}`);throw z.code===Ut.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(z,"ice restart timeout"),J}})}measureFirstFrameDuration({mediaStream:b,subscribeType:S,callback:R}){const O=performance.now(),P=te=>{const z=performance.now()-O;R(z,te),te==="audio"?J():B()};let B=Zp,J=Zp;return S!==Jo.AUDIO_ONLY&&(B=function(te,z){return em(te,"video",z)}(b,P)),J=function(te,z){return em(te,"audio",z)}(b,P),()=>{B(),J()}}}var Au,Ir;dd=new WeakSet,dh=function(x){return x.id===this.id},function(x){x.JOIN_ERROR="JOIN_ERROR",x.PUBLISH_ERROR="PUBLISH_ERROR",x.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"}(Au||(Au={})),function(x){x[x.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",x[x.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",x[x.TIMEOUT=3]="TIMEOUT",x[x.FAILED=4]="FAILED",x[x.CANCELED=5]="CANCELED",x[x.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",x[x.CODEC_MISMATCH=7]="CODEC_MISMATCH",x[x.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED"}(Ir||(Ir={}));const Fy={[Ir.TOKEN_MALFORMED]:"Token is malformed",[Ir.TOKEN_EXPIRED]:"Token expired and is no longer valid",[Ir.TIMEOUT]:"Operation timed out",[Ir.FAILED]:"Operation failed",[Ir.CANCELED]:"Operation canceled",[Ir.STAGE_AT_CAPACITY]:"Stage at capacity",[Ir.CODEC_MISMATCH]:"Client codec is not supported",[Ir.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation"},Ga={[Ut.EXPIRED_TOKEN.code]:Ir.TOKEN_EXPIRED,[Ut.MALFORMED_TOKEN.code]:Ir.TOKEN_MALFORMED,[Ut.TOKEN_PERMISSIONS_DENIED.code]:Ir.TOKEN_NOT_ALLOWED,[Ut.OPERATION_ABORTED.code]:Ir.CANCELED,[Ut.JOIN_TIMED_OUT.code]:Ir.TIMEOUT,[Ut.EVENT_PLANE_WS_CREATE_FAILED.code]:Ir.FAILED,[Ut.EVENT_PLANE_PONG_TIMEOUT.code]:Ir.FAILED,[Ut.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:Ir.FAILED,[Ut.PUBLISH_TIMED_OUT.code]:Ir.TIMEOUT,[Ut.PUBLISH_FAILURE.code]:Ir.FAILED,[Ut.SUBSCRIBE_TIMED_OUT.code]:Ir.TIMEOUT,[Ut.SUBSCRIBE_FAILURE.code]:Ir.FAILED,[Ut.STAGE_AT_CAPACITY.code]:Ir.STAGE_AT_CAPACITY,[Ut.NO_MATCHING_CODEC.code]:Ir.CODEC_MISMATCH,[Ut.NETWORK_FAILURE.code]:Ir.FAILED,[Ut.INTERNAL_SERVER_ERROR.code]:Ir.FAILED,[Ut.REMOTE_STREAM_NOT_FOUND.code]:Ir.FAILED,[Ut.INTERNAL_MHCP_ERROR.code]:Ir.FAILED,[Ut.UNREACHABLE_MHCP.code]:Ir.FAILED,[Ut.INVALID_SESSION_STATUS.code]:Ir.FAILED,[Ut.MHCP_ABORTED.code]:Ir.FAILED};class uS extends Error{constructor(b,S,R){super(),this.code=b,this.category=S,this.message=R,this.name="StageError",this.errorDetails=[],this.message=`[${S}] ${R}`}addDetails(b){this.errorDetails.push(b)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var hh,Df,vm;(function(x){x.ERROR="error"})(hh||(hh={}));class By extends uo{constructor(){super(...arguments),this.handleError=(b,S,R=!0)=>{let O;if(b instanceof Zn){const P=Ga[b.code];P&&(O=function(B,J,te){var z,re;const ce=Fy[B],de=new uS(B,J,ce);return de.addDetails({stageErrorMessage:ce,stageErrorCode:B,stageErrorCategory:J,stageArn:(z=te.token)===null||z===void 0?void 0:z.stageARN,traceId:(re=te.traceId)===null||re===void 0?void 0:re.value,causeCode:te.code,causeDetails:te.details,causeMessage:te.message,causeLocation:te.location}),de}(P,S,b))}if(O)return R&&this.emit(hh.ERROR,O),O}}}(function(x){x.INTERNAL="internal",x.API="api"})(Df||(Df={})),function(x){x.ADDITIVE="additive",x.REPLACE="replace"}(vm||(vm={}));class jy{constructor(b){this.logger=new Ks(b.logger,fe.CONNECTION),this.subscribeConfig={defaults:b.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(b,S,R,O=vm.REPLACE){S=(re=>{const ce=Sf(re);if(ce.jitterBuffer!==void 0){const de=Me=>{if(typeof Me=="number"){if(Me<0)return 0;if(Me>4e3)return 4e3}return Me};ce.jitterBuffer.minDelayWhenPublishing!==void 0&&(ce.jitterBuffer.minDelayWhenPublishing=de(ce.jitterBuffer.minDelayWhenPublishing)),ce.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(ce.jitterBuffer.minDelayWhenSubscribeOnly=de(ce.jitterBuffer.minDelayWhenSubscribeOnly))}return ce})(S),this.subscribeConfig.participants[b]===void 0&&(this.subscribeConfig.participants[b]={internalOverrides:{},apiOverrides:{},lastMerged:this.subscribeConfig.defaults});const P=this.subscribeConfig.participants[b];switch(R){case Df.INTERNAL:P.internalOverrides=this.handleSubscribeConfigLevelMerging(P.internalOverrides,S,O);break;case Df.API:P.apiOverrides=this.handleSubscribeConfigLevelMerging(P.apiOverrides,S,O);break;default:(function(re){throw new Error(`Unknown case kind: ${re}`)})(R)}const B=Cu(this.subscribeConfig.defaults,P.internalOverrides,P.apiOverrides);if(B===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${b} | ${P}, ${S}`}),!1;const J=(te=P.lastMerged,z=B,(typeof te=="object"&&typeof z=="object"&&(0,is.isEqual)(te,z))===!1);var te,z;return P.lastMerged=B,this.subscribeConfig.participants[b]=P,J}handleExternalSubscribeConfigUpdate(b,S,R,O=vm.REPLACE){const P=(B=>{const J={};return typeof B!="object"?In.err(new Error("Invalid input")):(B.jitterBuffer!==void 0&&(J.jitterBuffer={},B.jitterBuffer.minDelay!==void 0&&(J.jitterBuffer.minDelayWhenSubscribeOnly=B.jitterBuffer.minDelay)),B.inBandMessaging!==void 0&&(J.inBandMessaging={enabled:B.inBandMessaging.enabled===!0}),B.simulcast!==void 0&&(J.simulcast={},B.simulcast.initialLayerPreference!==void 0&&(J.simulcast.initialLayerPreference=B.simulcast.initialLayerPreference)),In.ok(J))})(S);return P.ok===!0&&this.handleSubscribeConfigUpdate(b,P.value,R,O)}handleSubscribeConfigLevelMerging(b,S,R){if(R===vm.REPLACE)return S;{const O=Cu(b,S);return O===void 0?(this.logger.warn({msg:`Unable to merge '${b}' and '${S}' with type ${R}`}),b):O}}getSubscribeConfigSnapshot(b){return this.subscribeConfig.participants[b]===void 0?rh(this.subscribeConfig.defaults):rh(this.subscribeConfig.participants[b].lastMerged)}}class dS extends vr{constructor(b){super(vn.REASSIGNMENT_REQUEST,b.token,b.traceId,!1),Object.assign(this.properties,{target_local_participant_id:b.targetLocalParticipantId,target_remote_participant_id:b.targetRemoteParticipantId}),this.critical=!0}}var vs,vc,fh,Qo,Kl,ya,Vi,Oo,_m=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};class nv extends uo{constructor(b,S){super(),this.setGetStats=R=>{this.getInternalStats=R},this.getStats=()=>_m(this,void 0,void 0,function*(){return this.requestRTCStats()}),this.requestRTCStats=()=>_m(this,void 0,void 0,function*(){if(this.getInternalStats)return this.getInternalStats(this.mediaStreamTrack)}),this.getInternalStats=S,this.id=b.id,this.isMuted=!b.enabled,this.mediaStreamTrack=b,this.streamType=this.mediaStreamTrack.kind==="audio"?Gt.AUDIO:Gt.VIDEO}cleanup(){this.removeAllListeners(),this.getInternalStats=void 0}}(function(x){x.IDLE="IDLE",x.INITIALIZING="INITIALIZING",x.ACTIVE="ACTIVE",x.CONTROLS_PAUSED="CONTROLS_PAUSED",x.DESTROYED="DESTROYED"})(vs||(vs={})),function(x){x.LAYERS_CHANGED="LAYERS_CHANGED",x.LAYER_SELECTED="LAYER_SELECTED",x.ADAPTION_CHANGED="ADAPTION_CHANGED"}(vc||(vc={})),function(x){x.LAYERS_CHANGED="LAYERS_CHANGED",x.LAYER_SELECTED="LAYER_SELECTED",x.ADAPTION_CHANGED="ADAPTION_CHANGED"}(fh||(fh={})),function(x){x.UNAVAILABLE="unavailable",x.SELECTED="selected"}(Qo||(Qo={})),function(x){x.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged"}(Kl||(Kl={}));class K_ extends nv{constructor(b,S){super(b),this.setMuted=R=>{R!==this.isMuted&&(this.mediaStreamTrack.enabled=!R,this.isMuted=R,this.emit(Kl.LOCAL_STREAM_MUTE_CHANGED,this))},this.mediaConfig=Zg(b,S)}}class $y{constructor(b,S){this.strategy=b,this.logger=S}setStrategy(b){this.strategy=b}stageStreamsToPublish(){let b=[];try{b=this.strategy.stageStreamsToPublish(),b=b.filter(O=>O instanceof K_)}catch(O){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:O}),console.error("Error executing stageStreamsToPublish",O),In.err(O)}let S=0,R=0;for(const O of b)O.mediaStreamTrack.kind==="audio"?S++:O.mediaStreamTrack.kind==="video"&&R++;if(S>1||R>1){const O=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return In.err(O)}return In.ok(b)}shouldPublishParticipant(b){try{return In.ok(this.strategy.shouldPublishParticipant(b))}catch(S){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:S}),console.error("Error executing shouldPublishParticipant",S),In.err(S)}}shouldSubscribeToParticipant(b){try{return In.ok(this.strategy.shouldSubscribeToParticipant(b))}catch(S){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:S}),console.error("Error executing shouldSubscribeToParticipant",S),In.err(S)}}subscribeConfiguration(b){var S,R;try{return In.ok((R=(S=this.strategy).subscribeConfiguration)===null||R===void 0?void 0:R.call(S,b))}catch(O){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:O}),console.error("Error executing subscribeConfiguration",O),In.err(O)}}preferredLayerForStream(b,S){var R,O;try{return In.ok((O=(R=this.strategy).preferredLayerForStream)===null||O===void 0?void 0:O.call(R,b,S))}catch(P){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:P}),console.error("Error executing preferredLayerForStream",P),In.err(P)}}}class Y_ extends uo{constructor(b,S){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=Vi.NOT_PUBLISHED,this.logger=S,this.info=b,this.audioMuted=b.audioMuted,this.videoStopped=b.videoStopped}}(function(x){x.PUBLISH="publish",x.SUBSCRIBE="subscribe"})(ya||(ya={})),function(x){x.NOT_PUBLISHED="not_published",x.ATTEMPTING_PUBLISH="attempting_publish",x.PUBLISHED="published",x.ERRORED="errored"}(Vi||(Vi={})),function(x){x.NOT_SUBSCRIBED="not_subscribed",x.ATTEMPTING_SUBSCRIBE="attempting_subscribe",x.SUBSCRIBED="subscribed",x.ERRORED="errored"}(Oo||(Oo={}));const ym=1e3;function rv(x){return x.map(b=>b.remote)}function hS(x){return{label:x.encodingId,bitrateBps:x.bitrate*ym,width:x.width,height:x.height,framesPerSecond:x.framesPerSecond,selected:x.selected}}function bm(x,b){const S=x.width*x.height,R=b.width*b.height;return S>R||x.bitrateBps>b.bitrateBps||x.framesPerSecond>b.framesPerSecond?1:S===R||x.bitrateBps===b.bitrateBps||x.framesPerSecond>b.framesPerSecond?0:-1}var m,y,M=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};class L extends uo{constructor(b){super(),this.setGetStats=()=>{},this.requestRTCStats=()=>this.internalStream.requestRTCStats(),this.getStats=()=>M(this,void 0,void 0,function*(){return this.internalStream.requestRTCStats()}),this.setMuted=S=>{this.internalStream.setMuted(S)},this.getLayers=()=>this.internalStream.layers,this.getSelectedLayer=()=>this.internalStream.selectedLayer,this.getLowestQualityLayer=()=>this.internalStream.lowestQualityLayer,this.getHighestQualityLayer=()=>this.internalStream.highestQualityLayer,this.internalStream=b,this.internalStream.on(vc.ADAPTION_CHANGED,S=>{this.emit(fh.ADAPTION_CHANGED,S)}),this.internalStream.on(vc.LAYERS_CHANGED,S=>{this.emit(fh.LAYERS_CHANGED,S)}),this.internalStream.on(vc.LAYER_SELECTED,(S,R)=>{this.emit(fh.LAYER_SELECTED,S,R)})}get id(){return this.internalStream.id}get participantInfo(){return this.internalStream.participantInfo}get streamType(){return this.internalStream.streamType}get mediaStreamTrack(){return this.internalStream.mediaStreamTrack}get isMuted(){return this.internalStream.isMuted}set isMuted(b){this.internalStream.setMuted(b)}get isAdapting(){return this.internalStream.isAdapting}cleanup(){this.removeAllListeners()}}class H extends nv{constructor({track:b,info:S,getStats:R,remotePlaybackController:O,analyticsTracker:P,token:B}){super(b,R),this.setMuted=te=>{this.isMuted=te},this.setLayer=te=>{const z=(0,is.cloneDeep)(te);if(this.queueLayerUpdateForValidState(z))return void this.logger.debug({msg:`setLayer:${z} queued, skipping for now`});const re=function(de,Me){if(!de)return(0,In.ok)(void 0);const Qe=typeof de=="string"?de:de.label,$e=Me.filter(Re=>Re.label===Qe)[0];return $e?(0,In.ok)($e):(0,In.err)(`Provided layer with id ${Qe} does not exist`)}(z,this._layers);if(!re.ok){const de=re.error;return void this.logger.error({err:de,msg:"Unable to select layer, skipping skipping selection"})}const ce=re.value;if(this.isNextUpdateAdaptionOnly(ce))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(ce)||this.isAdapting?ce&&(this.logger.warn({msg:`setLayer:${JSON.stringify(ce)} `}),this.handleManualUpdate(ce)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=vs.INITIALIZING,this.prevState=vs.IDLE,this.analyticsTracker=P,this.token=B,this.id=b.id,this.info=S,this.mediaStreamTrack=b,this.remotePlaybackController=O,this.layerPollingTimeoutId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const J=Up();this.logger=new Ks(new qd(J),fe.REMOTE_STAGE_STREAM),this.streamType===Gt.AUDIO?this.isMuted=S.audioMuted:this.isMuted=S.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers()}transitionStateTo(b){this.state!==b&&(this.prevState=this.state,this.state=b)}initializeLayerPolling(){this.streamType!==Gt.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingTimeoutId=setInterval(()=>{this.pollInternalLayers()},3e3)):this.logger.debug({msg:"Skipping initializing polling for audio streams"})}startLayerPolling(){this.layerPollingTimeoutId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingTimeoutId!==null?(clearInterval(this.layerPollingTimeoutId),this.layerPollingTimeoutId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(){this.streamType!==Gt.AUDIO?this.remotePlaybackController.getLayers().then(b=>{if(this.isStateValidForLayerUpdates()){if(!b.ok)throw Error(b.error);this.updateInternalLayersFromRemote(b.value),this.transitionStateTo(vs.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})}).catch(b=>{this.logger.error({err:b,msg:"Error calling getLayers, returning current layers"})}):this.logger.debug({msg:"Skipping layer poll request for audio stream"})}updateInternalLayersFromRemote(b){const S=this._layers,R=b.map(hS).sort(bm),O=!(0,is.isEqual)(R,S);this._layers=R;const P=this._selectedLayer,B=this._layers.filter(te=>te.selected)[0],J=!(0,is.isEqual)(B,P);P&&(P.selected=!1),this._selectedLayer=B,J&&(this.trackLayerUpdate(P),this.trackLayerUpdate(B)),this.isCommandQueueEmpty()&&(O&&this.emitLayersChanged(),J&&this.emitLayerSelected(B))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const b=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${b}`});for(const S of this.commandMap.keys()){const R=this.commandMap.get(S);R==null||R()}this.commandMap.clear()}queueLayerUpdateForValidState(b){if(!b)return this.commandMap.delete("setLayer"),!1;if(this.state===vs.INITIALIZING){const S=this.setLayer.bind(this,b);return this.commandMap.set("setLayer",S),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const b=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then(S=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(b,`Stream in invalid state: ${this.state}`);S.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(b,S.error)}).catch(()=>{})}resetAdaptionStateOnError(b,S){this._isAdapting=b,this.emitAdaptionChanged(),this.logger.error({err:S,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(b){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const S=this._isAdapting,R=this._selectedLayer;R&&(R.selected=!1),this._isAdapting=!1,this._selectedLayer=b,b.selected=!0,S!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(b,R),this.trackLayerUpdate(R),this.trackLayerUpdate(b),this.emitLayersChanged(),this.emitLayerSelected(b),this.remotePlaybackController.setLayer(b.label).then(O=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const P=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(S,P),void this.resetLayerOnError(R,b,P)}if(!O.ok){const P=O.error;return this.resetAdaptionStateOnError(S,P),void this.resetLayerOnError(R,b,P)}this.logger.debug({msg:`Layer successfully selected: ${b.label}`})}).catch(()=>{})}applyExistingControlState(){var b;this._isAdapting?this.remotePlaybackController.unsetLayer().then(()=>{}).catch(()=>{}):!((b=this._selectedLayer)===null||b===void 0)&&b.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then(()=>{}).catch(()=>{})}resetLayerOnError(b,S,R){S&&(S.selected=!1),b&&(b.selected=!0),this._selectedLayer=b,this.logger.error({err:R,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(b,S),this.emitLayersChanged(),b!==null&&this.emitLayerSelected(b,Qo.UNAVAILABLE),this.trackLayerUpdate(S),this.trackLayerUpdate(b)}updateLocalLayerStateBeforeRemote(b,S){this._layers=this._layers.map(R=>R.label===(b==null?void 0:b.label)?b:R.label===(S==null?void 0:S.label)?S:R).sort(bm)}trackLayerUpdate(b){var S,R;this.analyticsTracker.trackEventNoSharedProps(new im(this.token,Qs(),(S=b==null?void 0:b.label)!==null&&S!==void 0?S:"auto",!0,Yt.SUBSCRIBE,(R=b==null?void 0:b.selected)!==null&&R!==void 0&&R,this.info.id))}isNextUpdateAdaptionOnly(b){return b===void 0&&this.isFirstLayerUpdate()||b===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(b){var S;return((S=this._selectedLayer)===null||S===void 0?void 0:S.label)===(b==null?void 0:b.label)}isStateValidForLayerUpdates(){return this.state===vs.ACTIVE||this.state===vs.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(b,S=Qo.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(b,null,2)}`}),this.emit(vc.LAYER_SELECTED,(0,is.cloneDeep)(b),S)}emitLayersChanged(){this.emit(vc.LAYERS_CHANGED,(0,is.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(vc.ADAPTION_CHANGED,this._isAdapting)}get remote(){const b=this.weakRemoteMap.get(this.weakRemoteKey);if(b)return b;const S=new L(this);return this.weakRemoteMap.set(this.weakRemoteKey,S),S}get participantInfo(){return(0,is.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,is.cloneDeep)(this._layers)}get selectedLayer(){var b;return(0,is.cloneDeep)((b=this._selectedLayer)!==null&&b!==void 0?b:void 0)}get highestQualityLayer(){return(0,is.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,is.cloneDeep)(this.layers[0])}pauseControls(){this.transitionStateTo(vs.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(vs.ACTIVE)}cleanup(){this.transitionStateTo(vs.DESTROYED),super.cleanup(),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(x){x.STATE_CHANGE="stateChange",x.MEDIA_STREAM_ADDED="mediaStreamAdded",x.MEDIA_STREAM_REMOVED="mediaStreamRemoved",x.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",x.ERROR="error"})(m||(m={})),function(x){x.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",x.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"}(y||(y={}));const ee=Object.assign(Object.assign({},m),y);var xe;(function(x){x.PUBLICATION_STATE_CHANGE="publicationStateChange"})(xe||(xe={}));const Ve=Object.assign(Object.assign({},m),xe);var bt=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};class Wt extends Y_{constructor(b,S,R,O,P,B,J,te=!1){super(b,new Ks(O,fe.REMOTE_PARTICIPANT)),this.subscribeState=Oo.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=z=>{this.logger.debug({msg:"subscriptionStateChange",state:z}),z===_a.DISCONNECTED?this.updateSubscriptionState(Oo.NOT_SUBSCRIBED):z===_a.CONNECTED?this.updateSubscriptionState(Oo.SUBSCRIBED):z===_a.CONNECTING?this.updateSubscriptionState(Oo.ATTEMPTING_SUBSCRIBE):z===_a.ERRORED?this.updateSubscriptionState(Oo.ERRORED):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:z})},this.onSubscriptionMediaStream=(z,re)=>{this.logger.debug({msg:"onSubscriptionMediaStream",stream:z});let ce=z.getTracks().map(de=>{const Me=new H({track:de,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:re,analyticsTracker:this.analyticsTracker,token:this.token});return this.streams.push(Me),Me});this.subscription.getDesiredSubscribeType()===Jo.AUDIO_ONLY&&(ce=ce.filter(de=>de.streamType!==Gt.VIDEO)),this.emit(ee.MEDIA_STREAM_ADDED,ce)},this.onSubscriptionError=z=>{this.emit(ee.ERROR,z)},this.onSubscriptionSeiMessageReceived=z=>{this.emit(ee.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,z)},this.onSubscriptionTransformError=z=>{this.emit(ee.ERROR,z)},this.onSubscriptionReassignmentStart=()=>{for(const z of this.streams)z.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const z of this.streams)z.resumeControls()},this.updateSubscribeStateIfNecessary=(z,re)=>{if(!this.info.capabilities.has(ya.SUBSCRIBE))return;re!==void 0&&this.subscription.updateSubscribeConfig(re);const ce=z!==Jo.NONE&&this.publishState===Vi.PUBLISHED,de=this.subscribeState!==Oo.NOT_SUBSCRIBED&&this.subscribeState!==Oo.ERRORED;if(ce&&!de)this.subscription.updateDesiredSubscribeType(z),this.subscribe();else if(!ce&&de)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(z);else if(this.subscribeState===Oo.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==z)try{z===Jo.AUDIO_ONLY?this.emit(ee.MEDIA_STREAM_REMOVED,this.streams.filter(Me=>Me.streamType===Gt.VIDEO)):z===Jo.AUDIO_VIDEO&&this.emit(ee.MEDIA_STREAM_ADDED,this.streams.filter(Me=>Me.streamType===Gt.VIDEO)),this.subscription.updateDesiredSubscribeType(z)}catch(Me){this.logger.error({err:Me,msg:"error updating subscribe type"})}},this.updatePublishState=z=>{const re=z&&this.publishState===Vi.PUBLISHED,ce=!z&&this.publishState===Vi.NOT_PUBLISHED;return!re&&!ce&&(this.info.isPublishing=z,this.publishState=z?Vi.PUBLISHED:Vi.NOT_PUBLISHED,!0)},this.updateStreamState=(z,re)=>{this.audioMuted!==z&&(this.audioMuted=z,this.info.audioMuted=z,this.updateStreamMuteState(Gt.AUDIO,z)),this.videoStopped!==re&&(this.videoStopped=re,this.info.videoStopped=re,this.updateStreamMuteState(Gt.VIDEO,re))},this.updateStreamMuteState=(z,re)=>{const ce=this.streams.find(de=>de.streamType===z);ce?(ce.setMuted(re),this.emit(ee.MEDIA_STREAM_MUTE_CHANGED,ce)):this.logger.warn({msg:`tried to update mute state for ${z} stream on participant ${this.info.id} that didn't exist`})},this.cleanup=()=>{for(const z of this.streams)z.remote.removeAllListeners(),z.removeAllListeners();this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==Oo.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=J,this.token=S,this.createSubscription=()=>{const z=new hd(b.id,S,R,O,J,P,B);return z.on(ff,this.onSubscriptionStateChange),z.on(pe,this.onSubscriptionMediaStream),z.on(Go,this.onSubscriptionError),z.on($a,this.onSubscriptionSeiMessageReceived),z.on($s,this.onSubscriptionTransformError),z.on(Mr,this.onSubscriptionReassignmentStart),z.on(rl,this.onSubscriptionReassignmentDone),z.on(il,this.onSubscriptionReassignmentDone),z},this.subscription=this.createSubscription(),te&&(this.publishState=Vi.PUBLISHED)}updateSubscriptionState(b){b!==this.subscribeState&&(this.subscribeState=b,this.emit(ee.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(Oo.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===Oo.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off(ff,this.onSubscriptionStateChange),this.subscription.off(pe,this.onSubscriptionMediaStream),this.subscription.off(Go,this.onSubscriptionError),this.subscription.off($s,this.onSubscriptionTransformError);const b=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),b===Jo.AUDIO_ONLY?this.emit(ee.MEDIA_STREAM_REMOVED,this.streams.filter(S=>S.streamType===Gt.AUDIO)):this.emit(ee.MEDIA_STREAM_REMOVED,this.streams),this.updateSubscriptionState(Oo.NOT_SUBSCRIBED),this.streams.forEach(S=>{S.cleanup()}),this.streams=[]}triggerIceRestart(b){return bt(this,void 0,void 0,function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(b)}finally{this.reassigning=!1}})}}const fn=Yt.PUBLISH;class mr{constructor(b,S){this.analyticsTracker=b,this.token=S,this.action=fn,this.traceId=Qs()}trackPublish(b){const{action:S,traceId:R,analyticsTracker:O,token:P}=this;return O.trackEvent(new ul({token:P,traceId:R})),{getTraceId:()=>R,trackPublishStarted({totalDurationWithRetries:B,retryTimes:J,sfuResource:te,peerClientPerfStats:z}){const{optionsDuration:re,postDuration:ce,timeToCandidate:de,timeToConnected:Me,sdpExchangeDuration:Qe,sdpExchangeTransport:$e,setRemoteDescDuration:Re,peerConnectionDuration:ye}=z,{edpInitialConnectDuration:gt,edpInitialConnectRetries:Bt,edpInitialStateDuration:en,edpStateUpdateCount:Pt}=b;O.trackEvent(new Jg({token:P,traceId:R,optionsDuration:re,postDuration:ce,timeToCandidate:de,totalDuration:Me,edpInitialConnectDuration:gt,edpInitialConnectRetries:Bt,edpInitialStateDuration:en,edpStateUpdateCount:Pt,sdpExchangeDuration:Qe,sdpExchangeTransport:$e,setRemoteDescDuration:Re,peerConnectionDuration:ye,publishRetries:J,totalDurationWithRetries:B,sfuResource:te}))},trackPublishFailed(B){const J=((z,re,ce)=>{if(z instanceof Zn)return z;let de="";return z instanceof ai.AxiosError&&(de+=`AxiosError - ${z.code}`),new Zn(Object.assign(Object.assign(Object.assign({},Ut.PUBLISH_FAILURE),{action:fn,token:re,traceId:ce,tag:uc.PUBLISH_RELATED,location:"publish",details:`${de} ${z.message}`}),{fatal:!0}))})(B,P,R);O.trackEvent(new am({token:P,traceId:R,code:J.code,message:J.message,fatal:J.fatal,nominal:J.nominal}));const te=new Zn(Object.assign(Object.assign({},Ut.PUBLISH_FAILURE),{action:S,token:P,traceId:R,tag:uc.PUBLISH_RELATED,location:"publish"}));return B instanceof Zn&&(te.fatal=B.fatal,te.nominal=B.nominal,te.location=`publish > ${B.location}`),O.trackError(te),J},trackUnpublish:()=>{O.trackEvent(new xf({token:P,traceId:R}))},trackEndSucceeded:B=>{O.trackEvent(new sh({token:P,isUnpublishSuccessful:!0,traceId:R,reason:B}))},trackEndFailed:B=>{const J=new Zn(Object.assign(Object.assign({},Ut.UNPUBLISH_FAILURE),{token:P,traceId:R,tag:uc.UNPUBLISH_RELATED,location:"unpublish"}));return B!==Is.UNLOAD&&B!==Is.UNPUBLISH||this.analyticsTracker.trackError(J),O.trackEvent(new sh({token:P,isUnpublishSuccessful:!1,traceId:R,reason:B})),J}}}}var gn,er,bn=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};(function(x){x.DISCONNECTED="disconnected",x.CONNECTING="connecting",x.CONNECTED="connected",x.ERRORED="errored"})(gn||(gn={})),function(x){x.STATE_CHANGE="stateChange",x.ERROR="error",x.TRANSFORM_ERROR="transformError"}(er||(er={}));class Zo extends uo{constructor(b,S,R,O){super(),this.token=b,this.stageConnection=S,this.nonScopedLogger=R,this.analyticsTracker=O,this.tracksToPublish=[],this.publicationState=gn.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=Yt.PUBLISH,this.start=P=>{this.publicationState===gn.DISCONNECTED||this.publicationState===gn.ERRORED?(this.tracksToPublish=P,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=P=>bn(this,void 0,void 0,function*(){return this.peerClient.requestRTCStats(P)}),this.stop=(P=!1)=>bn(this,void 0,void 0,function*(){this.peerClient.off(Ms,this.onPeerClientConnectionStateChange,this),this.peerClient.off(st,this.onPeerClientTransformError,this),yield this.unpublish(P),this.updateState(gn.DISCONNECTED)}),this.processStateUpdate=P=>{const{publicationState:B}=this;B===gn.DISCONNECTED||B===gn.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(gn.CONNECTING),this.tryPublish()):B===gn.CONNECTING?P===et.CONNECTED&&this.updateState(gn.CONNECTED):B===gn.CONNECTED&&P===et.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(Is.CONNECTION_FAIL),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState(gn.CONNECTING),this.tryPublish()))},this.updateState=P=>{this.publicationState=P,this.emit(er.STATE_CHANGE,P)},this.tryPublish=()=>bn(this,void 0,void 0,function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const P=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish(P);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.tracksToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const B=this.peerClient.getSfuResource(),J=this.latestPubAttemptNum-1,te=performance.now()-this.startConnectingTimestamp,z=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:B,totalDurationWithRetries:te,retryTimes:J,peerClientPerfStats:z}),this.latestPubAttemptNum=0}catch(B){this.logger.error({msg:"publish failed!",err:B});const J=this.attemptTracker.trackPublishFailed(B),te=J.code===Ut.OPERATION_ABORTED.code,z=J.fatal,re=this.latestPubAttemptNum===4;if(te)return;if(z||re)return this.logger.error({msg:`Stopping attempts: isFatal=${z}, isLastAttempt=${re}`,err:B}),this.updateState(gn.ERRORED),void this.emit(er.ERROR,J);const ce=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${ce}ms`}),this.nextAttemptTimerId=window.setTimeout(()=>{this.tryPublish()},ce)}}}),this.publish=(P,B)=>bn(this,void 0,void 0,function*(){this.peerClient.initTracksToPublish(P),yield this.peerClient.connect({audioOnly:!1,traceId:B})}),this.unpublish=(P=!1)=>bn(this,void 0,void 0,function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===gn.DISCONNECTED||this.publicationState===gn.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const B=P?Is.UNLOAD:Is.UNPUBLISH;try{P?this.peerClient.disconnect(P):yield this.peerClient.disconnect(P),this.attemptTracker.trackEndSucceeded(B)}catch{this.attemptTracker.trackEndFailed(B)}}),this.replaceOrUpdateTrack=P=>bn(this,void 0,void 0,function*(){this.tracksToPublish.find(B=>B.track.kind===P.track.kind)?this.tracksToPublish=this.tracksToPublish.map(B=>B.track.kind===P.track.kind?P:B):this.tracksToPublish.push(P),yield this.peerClient.replaceOrUpdateTrack(P)}),this.onPeerClientConnectionStateChange=P=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${P}`,state:P}),this.processStateUpdate(P)},this.onPeerClientTransformError=P=>{this.emit(er.TRANSFORM_ERROR,P)},this.onIncompatibleCodecs=P=>bn(this,void 0,void 0,function*(){yield this.peerClient.onIncompatibleCodecs(P)}),this.sendSeiMessage=P=>{this.peerClient.sendSeiMessage(P)},this.peerClient=new kf(b,this.nonScopedLogger,this.action,ho(this.action),Qs(),this.analyticsTracker,void 0,S,void 0),this.logger=new Ks(R,fe.PUBLICATION),this.peerClient.on(Ms,this.onPeerClientConnectionStateChange,this),this.peerClient.on(st,this.onPeerClientTransformError,this),this.publishTracker=new mr(this.analyticsTracker,this.token)}removeTrack(b){return bn(this,void 0,void 0,function*(){this.tracksToPublish=this.tracksToPublish.filter(S=>S.track.kind!==b),yield this.peerClient.removeTrack(b)})}}var Rr,Ge=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};class Je extends Y_{constructor(b,S,R,O,P){super(b,new Ks(R,fe.LOCAL_PARTICIPANT)),this.onPublicationStateChange=B=>{switch(this.logger.debug({msg:"publicationStateChange",state:B}),B){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(Vi.PUBLISHED);break;case"connecting":this.updatePublishState(Vi.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(Vi.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:B})}},this.onPublicationError=B=>{this.emit(Ve.ERROR,B)},this.updatePublishState=B=>{this.info.isPublishing=B===Vi.PUBLISHED,this.publishState=B,this.emit(Ve.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=B=>{B.streamType===Gt.AUDIO&&(this.audioMuted=B.isMuted,this.info.audioMuted=B.isMuted),B.streamType===Gt.VIDEO&&(this.videoStopped=B.isMuted,this.info.videoStopped=B.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(Ve.MEDIA_STREAM_MUTE_CHANGED,B)},this.publish=B=>{this.logger.debug({msg:"publish"}),B.forEach(te=>{te&&(this.setupStreamListener(te),te.streamType===Gt.AUDIO?(this.audioStream=te,this.audioMuted=!te.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):te.streamType===Gt.VIDEO&&(this.videoStream=te,this.videoStopped=!te.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),te.setGetStats(this.publication.requestRTCStats))}),this.connection.emitStageState(this.audioMuted,this.videoStopped);const J=B.map(te=>fm(te.mediaStreamTrack,te.mediaConfig));this.publication.start(J)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==Vi.NOT_PUBLISHED&&this.publishState!==Vi.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=B=>Ge(this,void 0,void 0,function*(){yield this.publication.onIncompatibleCodecs(B)}),this.sendSeiMessage=B=>{this.publication.sendSeiMessage(B)},this.sendSeiMessageString=B=>{const J=new TextEncoder().encode(B);this.publication.sendSeiMessage(J)},this.connection=O,this.createPublication=()=>{const B=new Zo(S,O,R,P);return B.on(er.STATE_CHANGE,this.onPublicationStateChange),B.on(er.ERROR,this.onPublicationError),B.on(er.TRANSFORM_ERROR,this.onPublicationError),B},this.publication=this.createPublication()}setupStreamListener(b){b.on(Kl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute)}removeTrack(b){var S,R;b.streamType===Gt.AUDIO?((S=this.audioStream)===null||S===void 0||S.off(Kl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):b.streamType===Gt.VIDEO&&((R=this.videoStream)===null||R===void 0||R.off(Kl.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(b.streamType)}replaceOrAddTrack(b){return Ge(this,void 0,void 0,function*(){this.setupStreamListener(b),b.setGetStats(this.publication.requestRTCStats),b.streamType===Gt.AUDIO?(this.audioStream=b,this.audioMuted=!b.mediaStreamTrack.enabled):b.streamType===Gt.VIDEO&&(this.videoStream=b,this.videoStopped=!b.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const S=fm(b.mediaStreamTrack,b.mediaConfig);yield this.publication.replaceOrUpdateTrack(S)})}unpublish(){if(this.publishState===Vi.NOT_PUBLISHED||this.publishState===Vi.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off(er.STATE_CHANGE,this.onPublicationStateChange),this.publication.off(er.ERROR,this.onPublicationError),this.publication.off(er.TRANSFORM_ERROR,this.onPublicationError);const b=[this.audioStream,this.videoStream].filter(S=>!!S);b.forEach(S=>{S.cleanup()}),this.audioStream=void 0,this.videoStream=void 0,this.emit(Ve.MEDIA_STREAM_REMOVED,b),this.updatePublishState(Vi.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(x){x.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",x.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",x.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",x.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",x.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",x.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",x.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",x.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",x.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",x.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",x.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",x.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",x.ERROR="error",x.STAGE_LEFT="stageLeft"})(Rr||(Rr={}));var ct=function(x,b,S,R){return new(S||(S=Promise))(function(O,P){function B(z){try{te(R.next(z))}catch(re){P(re)}}function J(z){try{te(R.throw(z))}catch(re){P(re)}}function te(z){var re;z.done?O(z.value):(re=z.value,re instanceof S?re:new S(function(ce){ce(re)})).then(B,J)}te((R=R.apply(x,[])).next())})};const Vt=x=>!!x;class yn extends uo{constructor(b,S){super(),this.connectionState=wi.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=(O,P)=>{var B,J;if(this.connectionState=O,O===wi.ERRORED&&(this.connectionStateErrored=!0),O===wi.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==Vi.NOT_PUBLISHED&&this.stageConnection.emitStageState((B=this.localParticipant)===null||B===void 0?void 0:B.audioMuted,(J=this.localParticipant)===null||J===void 0?void 0:J.videoStopped),O===wi.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),O===wi.DISCONNECTED){if(P&&P!==pc.CLIENT_RECONNECT&&P!==pc.USER_INITIATED){let te=hr.UNKNOWN;(function(z){return Object.values(hr).includes(z)})(P)?te=P:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${P}`}),this.cleanup(te)}}else this.emit(Rr.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var O;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new mf(this.token,(O=this.joinTraceId)!==null&&O!==void 0?O:new df,"reusing local participant from repeat join",Yt.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const O=function(P){var B,J;const te=new Set;return P.token.claims.capabilities.allow_publish&&te.add(ya.PUBLISH),P.token.claims.capabilities.allow_subscribe&&te.add(ya.SUBSCRIBE),{id:P.token.participantID,userId:(B=P.token.userID)!==null&&B!==void 0?B:"",attributes:(J=P.token.claims.attributes)!==null&&J!==void 0?J:{},capabilities:te,isLocal:!0,userInfo:{},videoStopped:P.videoStopped,audioMuted:P.audioMuted,isPublishing:P.isPublishing}}({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new Je(O,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(Ve.PUBLICATION_STATE_CHANGE,P=>{this.onPublishStateChanged(this.localParticipant.info,P)}),this.localParticipant.on(Ve.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(Ve.MEDIA_STREAM_MUTE_CHANGED,P=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,P):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})}),this.localParticipant.on(Ve.ERROR,P=>{this.errorManager.handleError(P,Au.PUBLISH_ERROR)}),this.emit(Rr.STAGE_PARTICIPANT_JOINED,O)},this.onRemoteParticipantJoined=O=>{var P;if(O.id!==((P=this.localParticipant)===null||P===void 0?void 0:P.info.id)){const B=function(re){return{id:re.id,userId:re.userId,attributes:re.attributes,capabilities:new Set([ya.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:re.videoStopped,audioMuted:re.audioMuted,isPublishing:re.isPublishing}}(O);if(this.participants.has(B.id))return void this.logger.warn({msg:"Remote participant already tracked"});let J=Jo.NONE;B.capabilities.has(ya.SUBSCRIBE)&&(J=In.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(B),J),this.updateManagerWithExternalSubscribeConfig(B,"joined"));const te=this.configManager.getSubscribeConfigSnapshot(B.id),z=new Wt(B,this.token,this.stageConnection,this.logger.unwrap(),J,te,this.analyticsTracker,O.isPublishing);this.participants.set(B.id,z),this.setupRemoteParticipantListeners(z),this.emit(Rr.STAGE_PARTICIPANT_JOINED,z.info),z.updateSubscribeStateIfNecessary(J)}},this.setupRemoteParticipantListeners=O=>{O.on(ee.SUBSCRIPTION_STATE_CHANGE,P=>{this.onParticipantSubscribeStateChanged(O.info.id,P)}),O.on(ee.MEDIA_STREAM_ADDED,P=>{const B=this.participants.get(O.info.id);if(B){for(const J of P)this.setupRemoteParticipantStreamEvents(B.info,J);this.emit(Rr.STAGE_PARTICIPANT_STREAMS_ADDED,B.info,rv(P)),this.updateStreamLayerForParticipant(O)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})}),O.on(ee.MEDIA_STREAM_REMOVED,P=>{const B=this.participants.get(O.info.id);B?this.emit(Rr.STAGE_PARTICIPANT_STREAMS_REMOVED,B.info,rv(P)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})}),O.on(ee.MEDIA_STREAM_MUTE_CHANGED,P=>{this.onStreamMuteChange(O.info,P.remote)}),O.on(ee.ERROR,P=>{this.errorManager.handleError(P,Au.SUBSCRIBE_ERROR)}),O.on(ee.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,P=>{this.onSeiMessageReceived(O.info,P)})},this.onRemoteParticipantLeft=O=>{if(this.connectionState!==wi.CONNECTED)return;const P=this.participants.get(O);P?(P.participantLeave(),P.unsubscribe(),P.cleanup(),this.participants.delete(O),this.emitParticipantLeave(P.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=O=>{this.emit(Rr.STAGE_PARTICIPANT_LEFT,O)},this.onRemoteParticipantStateChanged=O=>{const P=this.participants.get(O.id);if(!P)return void this.logger.warn({msg:"Remote participant updated but not tracked"});P.updatePublishState(O.isPublishing)&&this.onPublishStateChanged(P.info,P.publishState),P.updateStreamState(O.audioMuted,O.videoStopped);const B=this.strategyWrapper.shouldSubscribeToParticipant(P.info);if(In.isNotOk(B))return;this.updateManagerWithExternalSubscribeConfig(P.info,"updated");const J=this.configManager.getSubscribeConfigSnapshot(P.info.id),te=In.getOk_or(B,Jo.NONE);P.updateSubscribeStateIfNecessary(te,J)},this.onPublishStateChanged=(O,P)=>{this.emit(Rr.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,O,P)},this.onParticipantSubscribeStateChanged=(O,P)=>{const B=this.participants.get(O);B?this.emit(Rr.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,B.info,P):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=O=>{this.localParticipant&&this.emit(Rr.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,O)},this.onLocalStreamsRemoved=O=>{this.localParticipant&&this.emit(Rr.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,O)},this.onStreamMuteChange=(O,P)=>{this.emit(Rr.STAGE_STREAM_MUTE_CHANGED,O,P)},this.onSeiMessageReceived=(O,P)=>{this.emit(Rr.STAGE_STREAM_SEI_MESSAGE_RECEIVED,O,P)},this.leave=()=>{this.cleanup(hr.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var O;this.participants.forEach(P=>{P.quickUnsubscribe()}),(O=this.localParticipant)===null||O===void 0||O.quickUnpublish(),this.stageConnection.disconnect(),this.emit(Rr.STAGE_CONNECTION_STATE_CHANGED,wi.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=O=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new Kp({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:O})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const P=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(P);const B=this.participants.entries();for(const[J,te]of B)te.unsubscribe(),this.participants.delete(J),te.cleanup(),this.emitParticipantLeave(te.info);ud.destroy(),this.stageConnection.disconnect(),this.emit(Rr.STAGE_CONNECTION_STATE_CHANGED,wi.DISCONNECTED),this.emit(Rr.STAGE_LEFT,O),this.stageConnection.removeAllListeners(),this.stageConnection=new hm(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners(),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach(O=>{if(O.info.capabilities.has(ya.SUBSCRIBE)){const P=this.strategyWrapper.shouldSubscribeToParticipant(O.info);if(In.isNotOk(P))return;const B=In.getOk_or(P,Jo.NONE);this.updateManagerWithExternalSubscribeConfig(O.info,"updated");const J=this.configManager.getSubscribeConfigSnapshot(O.info.id);O.updateSubscribeStateIfNecessary(B,J),this.updateStreamLayerForParticipant(O)}}),this.updateStreamsToPublishIfNecessary()},this.updateStreamsToPublishIfNecessary=()=>{var O;if(!this.localParticipant||!(!((O=this.localParticipant)===null||O===void 0)&&O.info.capabilities.has(ya.PUBLISH)))return;const P=this.localParticipant.publishState!==Vi.NOT_PUBLISHED&&this.localParticipant.publishState!==Vi.ERRORED,B=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(In.isNotOk(B))return;let J=In.getOk_or(B,!1);if(!P&&!J)return;if(P&&!J)return void this.localParticipant.unpublish();const te=this.strategyWrapper.stageStreamsToPublish();if(In.isNotOk(te)){const re=In.getErr(te);if(re instanceof Error&&re.cause==="UserStrategy")throw re;return}const z=In.getOk_or(te,[]);J=J&&z.length>0,!P&&J?(this.localParticipant.publish(z),this.onLocalStreamsAdded(z)):this.syncTracksToPublish(z)},this.syncTracksToPublish=O=>{var P;if(!this.localParticipant)return;const B=this.localParticipant.audioStream,J=this.localParticipant.videoStream,{updates:te,streamsToAdd:z,streamsToRemove:re}=this.determineStreamUpdates(B,J,O);if(te.length){for(const ce of te)ce.newStream?(P=this.localParticipant)===null||P===void 0||P.replaceOrAddTrack(ce.newStream):ce.oldStream&&this.localParticipant.removeTrack(ce.oldStream);re.length!==0&&this.onLocalStreamsRemoved(re),z.length!==0&&this.onLocalStreamsAdded(z)}},this.determineStreamUpdates=(O,P,B=[])=>{const J=[],te=B.slice(0,2);if(te.sort((ce,de)=>ce.streamType===Gt.AUDIO?-1:1),te.length===0)O&&J.push({oldStream:O}),P&&J.push({oldStream:P});else if(te.length===1){const ce=te[0];ce.streamType===Gt.AUDIO?P&&J.push({oldStream:P}):ce.streamType===Gt.VIDEO&&O&&J.push({oldStream:O})}te.forEach(ce=>{var de,Me;ce.streamType===Gt.AUDIO?O?O.id===ce.id&&(0,is.isEqual)(O.mediaConfig,ce.mediaConfig)||(!!(!((de=O.mediaConfig)===null||de===void 0)&&de.stereo)!=!!(!((Me=ce.mediaConfig)===null||Me===void 0)&&Me.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),J.push({oldStream:O,newStream:ce})):J.push({newStream:ce}):ce.streamType===Gt.VIDEO&&(P?P.id===ce.id&&(0,is.isEqual)(P.mediaConfig,ce.mediaConfig)||J.push({oldStream:P,newStream:ce}):J.push({newStream:ce}))});const z=J.map(ce=>ce.newStream).filter(Vt),re=J.map(ce=>ce.oldStream).filter(Vt);return{updates:J,streamsToAdd:z,streamsToRemove:re}},this.onReassignmentMessage=O=>ct(this,void 0,void 0,function*(){if(gu("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!Ko.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const P=Qs();this.trackReassignmentRequest(O,P);const B=this.participants.get(O.remoteParticipantId),J=this.token.participantID,te=function(z,{localParticipantId:re,remoteParticipant:ce}){const{participantId:de}=z;if(re!==de)return In.err(Object.assign(Object.assign({},Ut.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${de}`}));if(!ce)return In.err(Object.assign(Object.assign({},Ut.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${ce}`}));if(ce.isReassigning())return In.err(Ut.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const Me=ce.subscription.peerClient.getConnectionState();return[et.CONNECTED,et.DISCONNECTED].includes(Me)?In.ok(ce):In.err(Object.assign(Object.assign({},Ut.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${Me}`}))}(O,{localParticipantId:J,remoteParticipant:B});if(!te.ok)this.trackReassignmentRequestRejected(te.error,P);else try{const{token:z,nodeOverride:re}=O;yield te.value.triggerIceRestart({assignmentToken:z,traceId:P,nodeOverride:re})}catch(z){this.logger.error({msg:"Reassignment failed.",err:z})}}),this.onIncompatibleCodecsMessage=O=>ct(this,void 0,void 0,function*(){var P;yield(P=this.localParticipant)===null||P===void 0?void 0:P.onIncompatibleCodecs(O.codecs)}),this.analyticsTracker=new Qu;const R=Up();this.logger=new Ks(new qd(R),fe.STAGE),this.strategyWrapper=new $y(S,this.logger),this.configManager=new jy({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:hs.DEFAULT,minDelayWhenSubscribeOnly:hs.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:Su.LOWEST_QUALITY}}}),this.errorManager=new By;try{this.token=cl(b,this.analyticsTracker)}catch(O){const P=new Zn(Object.assign({action:Yt.JOIN,token:b,traceId:Qs(),tag:uc.JOIN_RELATED,location:"Stage.constructor"},Ut.MALFORMED_TOKEN));throw O instanceof Error&&(P.details=O.message),this.errorManager.handleError(P,Au.JOIN_ERROR)||O}this.stageConnection=new hm(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(yu,(b,S)=>{this.onConnectionStateChanged(b,S)}),this.stageConnection.on(dc,b=>{this.onRemoteParticipantJoined(b)}),this.stageConnection.on(Ni,b=>{this.onRemoteParticipantLeft(b.id)}),this.stageConnection.on(Os,b=>{var S;b.id!==((S=this.localParticipant)===null||S===void 0?void 0:S.info.id)&&this.onRemoteParticipantStateChanged(b)}),this.stageConnection.on(js,b=>ct(this,void 0,void 0,function*(){yield this.onReassignmentMessage(b)})),this.stageConnection.on(rd,b=>ct(this,void 0,void 0,function*(){yield this.onIncompatibleCodecsMessage(b)})),this.stageConnection.on(Py,b=>{b instanceof Zn&&this.analyticsTracker.trackError(b),this.errorManager.handleError(b,Au.JOIN_ERROR)}),this.errorManager.on(hh.ERROR,b=>{this.emit(Rr.ERROR,b)})}setupRemoteParticipantStreamEvents(b,S){const R=S.remote;S.on(vc.ADAPTION_CHANGED,O=>{this.emit(Rr.STAGE_STREAM_ADAPTION_CHANGED,b,R,O)}),S.on(vc.LAYERS_CHANGED,O=>{this.emit(Rr.STAGE_STREAM_LAYERS_CHANGED,b,R,O)}),S.on(vc.LAYER_SELECTED,(O,P)=>{this.emit(Rr.STAGE_STREAM_LAYER_SELECTED,b,R,O,P)}),S.layers.length>0&&(this.emit(Rr.STAGE_STREAM_LAYERS_CHANGED,b,R,R.getLayers()),this.emit(Rr.STAGE_STREAM_LAYER_SELECTED,b,R,R.getSelectedLayer(),Qo.SELECTED))}join(){return ct(this,void 0,void 0,function*(){this.analyticsTracker.start(),this.joinTraceId=Qs(),this.analyticsTracker.trackEvent(new Cf({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(Qs(),uc.JOIN_RELATED,"join")}catch(b){throw this.errorManager.handleError(b,Au.JOIN_ERROR)||b}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===wi.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(b){throw this.logger.error({err:b,msg:"error joining stage"}),this.errorManager.handleError(b,Au.JOIN_ERROR,!1)||b}})}replaceStrategy(b){this.strategyWrapper.setStrategy(b),this.refreshStrategy()}updateManagerWithExternalSubscribeConfig(b,S){const R=In.getOk(this.strategyWrapper.subscribeConfiguration(b));if(R===void 0)return;const O=b.id;if(this.configManager.handleExternalSubscribeConfigUpdate(O,R,Df.API)){const P=this.configManager.getSubscribeConfigSnapshot(O);this.analyticsTracker.trackEventNoSharedProps(new bf(this.token,this.joinTraceId,{trigger:S==="joined"?"initial":"ad-hoc",remote_participant_id:O,min_delay_when_publishing:os(P.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:os(P.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:P.inBandMessaging.enabled,simulcast_initial_layer_preference:P.simulcast.initialLayerPreference}))}}updateStreamLayerForParticipant(b){b.streams.forEach(S=>{if(S.streamType==="audio")return;const R=this.strategyWrapper.preferredLayerForStream(b.info,S.remote),O=In.getOk_or(R,void 0);S.setLayer(O)})}trackReassignmentRequestRejected(b,S){const{token:R}=this,O=new Zn(Object.assign(Object.assign({},b),{token:R,action:Yt.JOIN,traceId:S,tag:uc.SUBSCRIBE_RELATED,location:"publish"}));this.logger.error({err:O,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(O)}trackReassignmentRequest(b,S){const{token:R}=this;this.analyticsTracker.trackEvent(new dS({token:R,traceId:S,targetLocalParticipantId:b.participantId,targetRemoteParticipantId:b.remoteParticipantId}))}}var hr;(function(x){x.UNKNOWN="unknown",x.USER_INITIATED="user-initiated",x.TOKEN_REUSED="token-reused",x.PARTICIPANT_DISCONNECTED="participant-disconnected",x.STAGE_DELETED="stage-deleted"})(hr||(hr={}));const fr=d})(),s})())})(BQ);var VGe=BQ.exports;const p0=Yc(VGe);let Fc;const vl=Wh("broadcast",["second"],t=>{if(vl.session(t))switch(t.target){case"startstream":Tl(vl,async()=>{if(he(Fc))ci(vl,"session","session is already open");else{const e=window.innerHeight>window.innerWidth;Fc=p0.create({streamConfig:e?p0.STANDARD_PORTRAIT:p0.STANDARD_LANDSCAPE,logLevel:p0.LOG_LEVEL.DEBUG}),Fc.on(p0.BroadcastClientEvents.ACTIVE_STATE_CHANGE,function(i){console.info({activestate:i})}),Fc.on(p0.BroadcastClientEvents.CONNECTION_STATE_CHANGE,function(i){Ar(vl,i)}),Fc.on(p0.BroadcastClientEvents.ERROR,function(i){ci(vl,"connection",i),Fc=void 0});const n=document.querySelector("canvas");if(he(n))await Fc.addImageSource(n,"video",{index:1});else{ci(vl,"video","unabled to find canvas element"),Fc=void 0;return}const r=pze();if(he(r))await Fc.addAudioInputDevice(r.stream,"audio");else{ci(vl,"video","unable create media audio node destination"),Fc=void 0;return}Ar(vl,"created client")}Yn(t.data)&&he(Fc)&&(np(vl,"broadcasting in"),ni(vl,"3","..."),await Xf(1e3),ni(vl,"2","..."),await Xf(1e3),ni(vl,"1","..."),await Xf(1e3),np(vl,"GOING LIVE"),await Fc.startBroadcast(t.data,"https://g.webrtc.live-video.net:4443"))});break;case"stopstream":he(Fc)?(Fc.stopBroadcast(),Fc.delete(),Fc=void 0,Ar(vl,"closed client")):ci(vl,"session","need an active session to stop stream");break}}),a4=Object.prototype.toString.call(typeof Hn<"u"?Hn:0)==="[object process]";var yv,Kn;(function(t){t[t.CRITICAL=0]="CRITICAL",t[t.ERROR=1]="ERROR",t[t.WARNING=2]="WARNING",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t[t.TRACE=7]="TRACE"})(Kn||(Kn={}));function c4(t){if(typeof t=="number"){if(Object.prototype.hasOwnProperty.call(Kn,t))return t;var e=Object.keys(Kn).map(function(r){return parseInt(r,10)}).filter(function(r){return!isNaN(r)&&r<t});return e.length?Math.max.apply(Math,e):Kn.WARNING}var n=t.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(Kn,n))throw new Error("Unknown log level string: ".concat(t));return Kn[n]}var zGe=a4?console.log.bind(console):console.debug.bind(console),jQ=(yv={},yv[Kn.CRITICAL]=console.error.bind(console),yv[Kn.ERROR]=console.error.bind(console),yv[Kn.WARNING]=console.warn.bind(console),yv[Kn.INFO]=console.info.bind(console),yv[Kn.DEBUG]=zGe.bind(console),yv[Kn.TRACE]=console.trace.bind(console),yv);function k_(t){return function(e,n){Object.defineProperty(e,n,{get:function(){},set:function(r){Object.defineProperty(this,n,{value:r,writable:!0,enumerable:t})},enumerable:t})}}function SU(t){return co(this,void 0,Promise,function(){return w3(this,function(e){switch(e.label){case 0:return typeof t!="function"?[3,2]:[4,t()];case 1:return[2,e.sent()];case 2:return[2,t]}})})}function GGe(t){return typeof t=="function"?t():t}function $Q(t){var e,n,r;return w3(this,function(i){switch(i.label){case 0:e=0,n=1,i.label=1;case 1:return e<t?[4,e]:[3,3];case 2:return i.sent(),r=_k([n,e+n],2),e=r[0],n=r[1],[3,1];case 3:return[4,t];case 4:return i.sent(),[3,3];case 5:return[2]}})}function zC(t,e){return Object.assign.apply(Object,fU([{}],_k(t.map(e)),!1))}function wU(t,e){Object.entries(t).forEach(function(n){var r=_k(n,2),i=r[0],s=r[1];return e(s,i)})}function HQ(t){return t==null}function Zw(t,e){return HQ(t)?null:e(t)}function VQ(t,e){return HQ(t)?void 0:e(t)}function qGe(t){return co(this,void 0,Promise,function(){return w3(this,function(e){switch(e.label){case 0:return[4,new Promise(function(n){return setTimeout(n,t)})];case 1:return e.sent(),[2]}})})}function TU(){var t,e,n=new Promise(function(r,i){t=r,e=i});return{promise:n,resolve:t,reject:e}}function WGe(t,e,n){if(typeof t=="number"&&(t=t.toString()),e=e-t.length,e<=0)return t;n===void 0&&(n=" ");var r="";do(e&1)===1&&(r+=n),e>>=1,e&&(n+=n);while(e);return r+t}function $0(t,e,n){var r=t.split(e);return r.length<=n?r:fU(fU([],_k(r.slice(0,n-1)),!1),[r.slice(n-1).join(e)],!1)}var KGe={},eD,tD,aA=typeof Hn>"u"?[]:(tD=(eD=KGe.LOGGING)===null||eD===void 0?void 0:eD.split(";").map(function(t){var e=t.split("=",2),n=e[0],r=e[1];return r?[n==="default"?void 0:n.split(":"),c4(r)]:null}).filter(function(t){return!!t}).sort(function(t,e){var n,r,i=t[0],s=e[0];return((n=s==null?void 0:s.length)!==null&&n!==void 0?n:0)-((r=i==null?void 0:i.length)!==null&&r!==void 0?r:0)}))!==null&&tD!==void 0?tD:[],nD=aA.findIndex(function(t){var e=t[0];return!e}),zQ=void 0;nD!==-1&&(zQ=aA[nD][1],aA.splice(nD));function YGe(t,e){return e.length<=t.length&&e.every(function(n,r){return n===t[r]})}function GQ(t){for(var e=t.split(":"),n=0,r=aA;n<r.length;n++){var i=r[n],s=i[0],o=i[1];if(YGe(e,s))return o}return zQ}var qQ=function(){function t(e){var n=e.name,r=e.minLevel,i=e.emoji,s=i===void 0?!1:i,o=e.colors,a=e.timestamps,c=a===void 0?a4:a,l,u;this._name=n,this._minLevel=(u=(l=VQ(r,function(d){return c4(d)}))!==null&&l!==void 0?l:GQ(n))!==null&&u!==void 0?u:Kn.WARNING,this._emoji=s,this._colors=o,this._timestamps=c}return t.prototype.crit=function(e){this.log(Kn.CRITICAL,e)},t.prototype.error=function(e){this.log(Kn.ERROR,e)},t.prototype.warn=function(e){this.log(Kn.WARNING,e)},t.prototype.info=function(e){this.log(Kn.INFO,e)},t.prototype.debug=function(e){this.log(Kn.DEBUG,e)},t.prototype.trace=function(e){this.log(Kn.TRACE,e)},t}(),XGe=function(t){YJ(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){if(!(n>this._minLevel)){var i=jQ[n],s="[".concat(this._name,"] ").concat(r);this._timestamps&&(s="[".concat(new Date().toISOString(),"] ").concat(r)),i(s)}},e}(qQ),JGe=function(){function t(e){var n=e.name,r=e.minLevel,i=e.custom,s;this._minLevel=(s=VQ(r,function(o){return c4(o)}))!==null&&s!==void 0?s:GQ(n),this._override=typeof i=="function"?{log:i}:i}return t.prototype.log=function(e,n){this._shouldLog(e)&&this._override.log(e,n)},t.prototype.crit=function(e){this._override.crit?this._shouldLog(Kn.CRITICAL)&&this._override.crit(e):this.log(Kn.CRITICAL,e)},t.prototype.error=function(e){this._override.error?this._shouldLog(Kn.ERROR)&&this._override.error(e):this.log(Kn.ERROR,e)},t.prototype.warn=function(e){this._override.warn?this._shouldLog(Kn.WARNING)&&this._override.warn(e):this.log(Kn.WARNING,e)},t.prototype.info=function(e){this._override.info?this._shouldLog(Kn.INFO)&&this._override.info(e):this.log(Kn.INFO,e)},t.prototype.debug=function(e){this._override.debug?this._shouldLog(Kn.DEBUG)&&this._override.debug(e):this.log(Kn.DEBUG,e)},t.prototype.trace=function(e){this._override.trace?this._shouldLog(Kn.TRACE)&&this._override.trace(e):this.log(Kn.TRACE,e)},t.prototype._shouldLog=function(e){return this._minLevel===void 0||this._minLevel>=e},t}(),bv,Ev,Sv,QGe=(bv={},bv[Kn.CRITICAL]="",bv[Kn.ERROR]="",bv[Kn.WARNING]=" ",bv[Kn.INFO]=" ",bv[Kn.DEBUG]="",bv[Kn.TRACE]="",bv),ZGe={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},eqe={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function jk(t,e,n){return function(r){return"\x1B[".concat(t,"m").concat(n?n(r):r,"\x1B[").concat(e,"m")}}function ip(t){return jk(ZGe[t],39)}function DS(t,e){return jk(eqe[t],49,e)}var tqe=(Ev={},Ev[Kn.CRITICAL]=ip("red"),Ev[Kn.ERROR]=ip("redBright"),Ev[Kn.WARNING]=ip("yellow"),Ev[Kn.INFO]=ip("blue"),Ev[Kn.DEBUG]=ip("magenta"),Ev[Kn.TRACE]=jk(0,0),Ev),n6=(Sv={},Sv[Kn.CRITICAL]=DS("bgRed",ip("white")),Sv[Kn.ERROR]=DS("bgRedBright",ip("white")),Sv[Kn.WARNING]=DS("bgYellow",ip("black")),Sv[Kn.INFO]=DS("bgBlue",ip("white")),Sv[Kn.DEBUG]=DS("bgMagenta",ip("black")),Sv[Kn.TRACE]=jk(7,27),Sv),nqe=function(t){YJ(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.log=function(n,r){var i,s,o;if(!(n>this._minLevel)){var a=jQ[n],c="";if(this._timestamps&&(c+="[".concat(new Date().toISOString(),"] ")),this._emoji){var l=QGe[n];c+="".concat(l," ")}var u=(o=(i=this._colors)!==null&&i!==void 0?i:(s=Hn.stdout)===null||s===void 0?void 0:s.isTTY)!==null&&o!==void 0?o:!0;u?c+="".concat(n6[n](this._name)," ").concat(n6[n](Kn[n])," ").concat(tqe[n](r)):c+="[".concat(this._name,":").concat(Kn[n].toLowerCase(),"] ").concat(r),a(c)}},e}(qQ);function $k(t){return t.custom?new JGe(t):a4?new nqe(t):new XGe(t)}let rqe=class extends Error{constructor(...e){var n;super(...e),Object.setPrototypeOf(this,new.target.prototype),(n=Error.captureStackTrace)===null||n===void 0||n.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}};class WQ extends rqe{}class iqe{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._paused=!1,this._logger=$k({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i,this._partitionKeyCallback=s}async request(e,n){return await new Promise((r,i)=>{var s,o;const a={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n==null?void 0:n.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"},c=this._partitionKeyCallback(e),l=(o=this._usedFromBucket.get(c))!==null&&o!==void 0?o:0;if(l>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{const u=this._getPartitionedQueue(c);u.push(a),l+u.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${u.length}`):this._logger.info(`Enqueueing request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused; queue size is ${u.length}`);break}case"null":{a.resolve(null),this._paused?this._logger.info(`Returning null for request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{a.reject(new WQ(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${c?`partition ${c}`:"default partition"} was reached`}`));break}default:throw new Error("this should never happen")}else this._runRequest(a,c)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const n=[];return this._partitionedQueue.set(e,n),n}async _runRequest(e,n){var r;const i=this._getPartitionedQueue(n);this._logger.debug(`doing a request for ${n?`partition ${n}`:"default partition"}, new queue length is ${i.length}`),this._usedFromBucket.set(n,((r=this._usedFromBucket.get(n))!==null&&r!==void 0?r:0)+1);const{req:s,resolve:o,reject:a}=e;try{o(await this._callback(s))}catch(c){a(c)}finally{setTimeout(()=>{const c=this._usedFromBucket.get(n)-1;this._usedFromBucket.set(n,c),i.length&&c<this._bucketSize&&this._runNextRequest(n)},this._timeFrame)}}_runNextRequest(e){if(this._paused)return;const r=this._getPartitionedQueue(e).shift();r&&this._runRequest(r,e)}}class xU{constructor({logger:e,bucketSize:n,timeFrame:r,doRequest:i}){this._queue=[],this._usedFromBucket=0,this._paused=!1,this._logger=$k({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=n,this._timeFrame=r,this._callback=i}async request(e,n){return await new Promise((r,i)=>{var s;const o={req:e,resolve:r,reject:i,limitReachedBehavior:(s=n==null?void 0:n.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(o.limitReachedBehavior){case"enqueue":{this._queue.push(o),this._usedFromBucket+this._queue.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`):this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{o.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused?this._logger.info("Returning null for request because the rate limiter is paused"):this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{o.reject(new WQ(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw new Error("this should never happen")}else this._runRequest(o)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}async _runRequest(e){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;const{req:n,resolve:r,reject:i}=e;try{r(await this._callback(n))}catch(s){i(s)}finally{setTimeout(()=>{this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize&&this._runNextRequest()},this._timeFrame)}}_runNextRequest(){if(this._paused)return;const e=this._queue.shift();e&&this._runRequest(e)}}class sqe extends xU{constructor(e,n){super({...n,async doRequest(r,i){return await e.request(r,i)}})}}class oqe{constructor(e,n,r,i=!1){this.owner=e,this.event=n,this.listener=r,this._internal=i}unbind(){this.owner.removeListener(this)}}let _x=class{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,n){return this._addListener(!1,e,n)}addListener(e,n){return this._addListener(!1,e,n)}removeListener(e,n){this._removeListener(!1,e,n)}registerEvent(){const e=n=>this.addListener(e,n);return e}emit(e,...n){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...n);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...n)}registerInternalEvent(){const e=n=>this.addInternalListener(e,n);return e}addInternalListener(e,n){return this._addListener(!0,e,n)}removeInternalListener(e,n){this._removeListener(!0,e,n)}_addListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;return i.has(n)?i.get(n).push(r):i.set(n,[r]),new oqe(this,n,r,e)}_removeListener(e,n,r){const i=e?this._eventListeners:this._internalEventListeners;if(!n)i.clear();else if(typeof n=="object"){const s=n;this._removeListener(s._internal,s.event,s.listener)}else{const s=n;if(i.has(s))if(r){const o=i.get(s);let a=0;for(;(a=o.indexOf(r))!==-1;)o.splice(a,1)}else i.delete(s)}}};const aqe=6e4;function cqe(t){return Zw(t.expiresIn,e=>t.obtainmentTimestamp+e*1e3-aqe)}function U1(t){var e;return(e=Zw(cqe(t),n=>Date.now()>n))!==null&&e!==void 0?e:!1}var CU={exports:{}};(function(t,e){var n=typeof self<"u"?self:xc,r=function(){function s(){this.fetch=!1,this.DOMException=n.DOMException}return s.prototype=n,new s}();(function(s){(function(o){var a={searchParams:"URLSearchParams"in s,iterable:"Symbol"in s&&"iterator"in Symbol,blob:"FileReader"in s&&"Blob"in s&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in s,arrayBuffer:"ArrayBuffer"in s};function c(K){return K&&DataView.prototype.isPrototypeOf(K)}if(a.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(K){return K&&l.indexOf(Object.prototype.toString.call(K))>-1};function d(K){if(typeof K!="string"&&(K=String(K)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(K))throw new TypeError("Invalid character in header field name");return K.toLowerCase()}function h(K){return typeof K!="string"&&(K=String(K)),K}function f(K){var ne={next:function(){var Q=K.shift();return{done:Q===void 0,value:Q}}};return a.iterable&&(ne[Symbol.iterator]=function(){return ne}),ne}function p(K){this.map={},K instanceof p?K.forEach(function(ne,Q){this.append(Q,ne)},this):Array.isArray(K)?K.forEach(function(ne){this.append(ne[0],ne[1])},this):K&&Object.getOwnPropertyNames(K).forEach(function(ne){this.append(ne,K[ne])},this)}p.prototype.append=function(K,ne){K=d(K),ne=h(ne);var Q=this.map[K];this.map[K]=Q?Q+", "+ne:ne},p.prototype.delete=function(K){delete this.map[d(K)]},p.prototype.get=function(K){return K=d(K),this.has(K)?this.map[K]:null},p.prototype.has=function(K){return this.map.hasOwnProperty(d(K))},p.prototype.set=function(K,ne){this.map[d(K)]=h(ne)},p.prototype.forEach=function(K,ne){for(var Q in this.map)this.map.hasOwnProperty(Q)&&K.call(ne,this.map[Q],Q,this)},p.prototype.keys=function(){var K=[];return this.forEach(function(ne,Q){K.push(Q)}),f(K)},p.prototype.values=function(){var K=[];return this.forEach(function(ne){K.push(ne)}),f(K)},p.prototype.entries=function(){var K=[];return this.forEach(function(ne,Q){K.push([Q,ne])}),f(K)},a.iterable&&(p.prototype[Symbol.iterator]=p.prototype.entries);function g(K){if(K.bodyUsed)return Promise.reject(new TypeError("Already read"));K.bodyUsed=!0}function v(K){return new Promise(function(ne,Q){K.onload=function(){ne(K.result)},K.onerror=function(){Q(K.error)}})}function E(K){var ne=new FileReader,Q=v(ne);return ne.readAsArrayBuffer(K),Q}function T(K){var ne=new FileReader,Q=v(ne);return ne.readAsText(K),Q}function C(K){for(var ne=new Uint8Array(K),Q=new Array(ne.length),ie=0;ie<ne.length;ie++)Q[ie]=String.fromCharCode(ne[ie]);return Q.join("")}function A(K){if(K.slice)return K.slice(0);var ne=new Uint8Array(K.byteLength);return ne.set(new Uint8Array(K)),ne.buffer}function k(){return this.bodyUsed=!1,this._initBody=function(K){this._bodyInit=K,K?typeof K=="string"?this._bodyText=K:a.blob&&Blob.prototype.isPrototypeOf(K)?this._bodyBlob=K:a.formData&&FormData.prototype.isPrototypeOf(K)?this._bodyFormData=K:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(K)?this._bodyText=K.toString():a.arrayBuffer&&a.blob&&c(K)?(this._bodyArrayBuffer=A(K.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(K)||u(K))?this._bodyArrayBuffer=A(K):this._bodyText=K=Object.prototype.toString.call(K):this._bodyText="",this.headers.get("content-type")||(typeof K=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(K)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var K=g(this);if(K)return K;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(E)}),this.text=function(){var K=g(this);if(K)return K;if(this._bodyBlob)return T(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(C(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(F)}),this.json=function(){return this.text().then(JSON.parse)},this}var I=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function N(K){var ne=K.toUpperCase();return I.indexOf(ne)>-1?ne:K}function U(K,ne){ne=ne||{};var Q=ne.body;if(K instanceof U){if(K.bodyUsed)throw new TypeError("Already read");this.url=K.url,this.credentials=K.credentials,ne.headers||(this.headers=new p(K.headers)),this.method=K.method,this.mode=K.mode,this.signal=K.signal,!Q&&K._bodyInit!=null&&(Q=K._bodyInit,K.bodyUsed=!0)}else this.url=String(K);if(this.credentials=ne.credentials||this.credentials||"same-origin",(ne.headers||!this.headers)&&(this.headers=new p(ne.headers)),this.method=N(ne.method||this.method||"GET"),this.mode=ne.mode||this.mode||null,this.signal=ne.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&Q)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(Q)}U.prototype.clone=function(){return new U(this,{body:this._bodyInit})};function F(K){var ne=new FormData;return K.trim().split("&").forEach(function(Q){if(Q){var ie=Q.split("="),G=ie.shift().replace(/\+/g," "),Z=ie.join("=").replace(/\+/g," ");ne.append(decodeURIComponent(G),decodeURIComponent(Z))}}),ne}function $(K){var ne=new p,Q=K.replace(/\r?\n[\t ]+/g," ");return Q.split(/\r?\n/).forEach(function(ie){var G=ie.split(":"),Z=G.shift().trim();if(Z){var se=G.join(":").trim();ne.append(Z,se)}}),ne}k.call(U.prototype);function X(K,ne){ne||(ne={}),this.type="default",this.status=ne.status===void 0?200:ne.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in ne?ne.statusText:"OK",this.headers=new p(ne.headers),this.url=ne.url||"",this._initBody(K)}k.call(X.prototype),X.prototype.clone=function(){return new X(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},X.error=function(){var K=new X(null,{status:0,statusText:""});return K.type="error",K};var q=[301,302,303,307,308];X.redirect=function(K,ne){if(q.indexOf(ne)===-1)throw new RangeError("Invalid status code");return new X(null,{status:ne,headers:{location:K}})},o.DOMException=s.DOMException;try{new o.DOMException}catch{o.DOMException=function(ne,Q){this.message=ne,this.name=Q;var ie=Error(ne);this.stack=ie.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function W(K,ne){return new Promise(function(Q,ie){var G=new U(K,ne);if(G.signal&&G.signal.aborted)return ie(new o.DOMException("Aborted","AbortError"));var Z=new XMLHttpRequest;function se(){Z.abort()}Z.onload=function(){var ue={status:Z.status,statusText:Z.statusText,headers:$(Z.getAllResponseHeaders()||"")};ue.url="responseURL"in Z?Z.responseURL:ue.headers.get("X-Request-URL");var Ae="response"in Z?Z.response:Z.responseText;Q(new X(Ae,ue))},Z.onerror=function(){ie(new TypeError("Network request failed"))},Z.ontimeout=function(){ie(new TypeError("Network request failed"))},Z.onabort=function(){ie(new o.DOMException("Aborted","AbortError"))},Z.open(G.method,G.url,!0),G.credentials==="include"?Z.withCredentials=!0:G.credentials==="omit"&&(Z.withCredentials=!1),"responseType"in Z&&a.blob&&(Z.responseType="blob"),G.headers.forEach(function(ue,Ae){Z.setRequestHeader(Ae,ue)}),G.signal&&(G.signal.addEventListener("abort",se),Z.onreadystatechange=function(){Z.readyState===4&&G.signal.removeEventListener("abort",se)}),Z.send(typeof G._bodyInit>"u"?null:G._bodyInit)})}return W.polyfill=!0,s.fetch||(s.fetch=W,s.Headers=p,s.Request=U,s.Response=X),o.Headers=p,o.Request=U,o.Response=X,o.fetch=W,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e})(CU,CU.exports);var KQ=CU.exports;const lqe=Yc(KQ);var rD=Object.prototype.hasOwnProperty,Rb=Array.isArray,jf=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),uqe=function(e){for(;e.length>1;){var n=e.pop(),r=n.obj[n.prop];if(Rb(r)){for(var i=[],s=0;s<r.length;++s)typeof r[s]<"u"&&i.push(r[s]);n.obj[n.prop]=i}}},YQ=function(e,n){for(var r=n&&n.plainObjects?Object.create(null):{},i=0;i<e.length;++i)typeof e[i]<"u"&&(r[i]=e[i]);return r},dqe=function t(e,n,r){if(!n)return e;if(typeof n!="object"){if(Rb(e))e.push(n);else if(e&&typeof e=="object")(r&&(r.plainObjects||r.allowPrototypes)||!rD.call(Object.prototype,n))&&(e[n]=!0);else return[e,n];return e}if(!e||typeof e!="object")return[e].concat(n);var i=e;return Rb(e)&&!Rb(n)&&(i=YQ(e,r)),Rb(e)&&Rb(n)?(n.forEach(function(s,o){if(rD.call(e,o)){var a=e[o];a&&typeof a=="object"&&s&&typeof s=="object"?e[o]=t(a,s,r):e.push(s)}else e[o]=s}),e):Object.keys(n).reduce(function(s,o){var a=n[o];return rD.call(s,o)?s[o]=t(s[o],a,r):s[o]=a,s},i)},hqe=function(e,n){return Object.keys(n).reduce(function(r,i){return r[i]=n[i],r},e)},fqe=function(t,e,n){var r=t.replace(/\+/g," ");if(n==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},pqe=function(e,n,r){if(e.length===0)return e;var i=e;if(typeof e=="symbol"?i=Symbol.prototype.toString.call(e):typeof e!="string"&&(i=String(e)),r==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});for(var s="",o=0;o<i.length;++o){var a=i.charCodeAt(o);if(a===45||a===46||a===95||a===126||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122){s+=i.charAt(o);continue}if(a<128){s=s+jf[a];continue}if(a<2048){s=s+(jf[192|a>>6]+jf[128|a&63]);continue}if(a<55296||a>=57344){s=s+(jf[224|a>>12]+jf[128|a>>6&63]+jf[128|a&63]);continue}o+=1,a=65536+((a&1023)<<10|i.charCodeAt(o)&1023),s+=jf[240|a>>18]+jf[128|a>>12&63]+jf[128|a>>6&63]+jf[128|a&63]}return s},mqe=function(e){for(var n=[{obj:{o:e},prop:"o"}],r=[],i=0;i<n.length;++i)for(var s=n[i],o=s.obj[s.prop],a=Object.keys(o),c=0;c<a.length;++c){var l=a[c],u=o[l];typeof u=="object"&&u!==null&&r.indexOf(u)===-1&&(n.push({obj:o,prop:l}),r.push(u))}return uqe(n),e},gqe=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},vqe=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},_qe=function(e,n){return[].concat(e,n)},l4={arrayToObject:YQ,assign:hqe,combine:_qe,compact:mqe,decode:fqe,encode:pqe,isBuffer:vqe,isRegExp:gqe,merge:dqe},yqe=String.prototype.replace,bqe=/%20/g,Eqe=l4,r6={RFC1738:"RFC1738",RFC3986:"RFC3986"},Sqe=Eqe.assign({default:r6.RFC3986,formatters:{RFC1738:function(t){return yqe.call(t,bqe,"+")},RFC3986:function(t){return String(t)}}},r6),XQ=l4,cw=Sqe,wqe=Object.prototype.hasOwnProperty,i6={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,n){return e+"["+n+"]"},repeat:function(e){return e}},iE=Array.isArray,Tqe=Array.prototype.push,RU=function(t,e){Tqe.apply(t,iE(e)?e:[e])},xqe=Date.prototype.toISOString,s6=cw.default,Bc={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:XQ.encode,encodeValuesOnly:!1,format:s6,formatter:cw.formatters[s6],indices:!1,serializeDate:function(e){return xqe.call(e)},skipNulls:!1,strictNullHandling:!1},Cqe=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Rqe=function t(e,n,r,i,s,o,a,c,l,u,d,h,f){var p=e;if(typeof a=="function"?p=a(n,p):p instanceof Date?p=u(p):r==="comma"&&iE(p)&&(p=p.join(",")),p===null){if(i)return o&&!h?o(n,Bc.encoder,f,"key"):n;p=""}if(Cqe(p)||XQ.isBuffer(p)){if(o){var g=h?n:o(n,Bc.encoder,f,"key");return[d(g)+"="+d(o(p,Bc.encoder,f,"value"))]}return[d(n)+"="+d(String(p))]}var v=[];if(typeof p>"u")return v;var E;if(iE(a))E=a;else{var T=Object.keys(p);E=c?T.sort(c):T}for(var C=0;C<E.length;++C){var A=E[C];s&&p[A]===null||(iE(p)?RU(v,t(p[A],typeof r=="function"?r(n,A):n,r,i,s,o,a,c,l,u,d,h,f)):RU(v,t(p[A],n+(l?"."+A:"["+A+"]"),r,i,s,o,a,c,l,u,d,h,f)))}return v},Aqe=function(e){if(!e)return Bc;if(e.encoder!==null&&e.encoder!==void 0&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var n=e.charset||Bc.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=cw.default;if(typeof e.format<"u"){if(!wqe.call(cw.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var i=cw.formatters[r],s=Bc.filter;return(typeof e.filter=="function"||iE(e.filter))&&(s=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:Bc.addQueryPrefix,allowDots:typeof e.allowDots>"u"?Bc.allowDots:!!e.allowDots,charset:n,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Bc.charsetSentinel,delimiter:typeof e.delimiter>"u"?Bc.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:Bc.encode,encoder:typeof e.encoder=="function"?e.encoder:Bc.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:Bc.encodeValuesOnly,filter:s,formatter:i,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:Bc.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:Bc.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Bc.strictNullHandling}},Mqe=function(t,e){var n=t,r=Aqe(e),i,s;typeof r.filter=="function"?(s=r.filter,n=s("",n)):iE(r.filter)&&(s=r.filter,i=s);var o=[];if(typeof n!="object"||n===null)return"";var a;e&&e.arrayFormat in i6?a=e.arrayFormat:e&&"indices"in e?a=e.indices?"indices":"repeat":a="indices";var c=i6[a];i||(i=Object.keys(n)),r.sort&&i.sort(r.sort);for(var l=0;l<i.length;++l){var u=i[l];r.skipNulls&&n[u]===null||RU(o,Rqe(n[u],u,c,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.formatter,r.encodeValuesOnly,r.charset))}var d=o.join(r.delimiter),h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""};const JQ=Yc(Mqe);var Iqe=l4;Iqe.decode;const Ab=Symbol("twurpleRawData");class Oqe{constructor(e){this[Ab]=e}}class Ay extends Error{constructor(e,n){var r;super(e,n),Object.setPrototypeOf(this,new.target.prototype),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}function yx(t,e,n){return r=>{const i=n?function(){return`[${e}#${this[n]} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`}:function(){return`[${e} - please check https://twurple.js.org/reference/${t}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class o6 extends Ay{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}function Um(t){return typeof t=="string"?t:typeof t=="number"?t.toString(10):t.id}class QQ extends Ay{constructor(e,n,r,i,s,o){super(`Encountered HTTP status code ${e}: ${n}

URL: ${r}
Method: ${i}
Body:
${!o&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=i,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function kqe(t,e){var n;if(!t.ok){const r=t.headers.get("Content-Type")==="application/json",i=r?JSON.stringify(await t.json(),null,2):await t.text(),s=JQ(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),o=`${e.url}${s}`;throw new QQ(t.status,t.statusText,o,(n=e.method)!==null&&n!==void 0?n:"GET",i,r)}}async function Nqe(t){if(t.status===204)return;const e=await t.text();if(e)return JSON.parse(e)}function Pqe(t,e,n){switch(e){case"helix":return`https://api.twitch.tv/helix/${t.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${t.replace(/^\//,"")}`;case"custom":return t;default:return t}}async function Dqe(t,e,n,r,i={},s){var o,a;const c=(o=t.type)!==null&&o!==void 0?o:"helix",l=Pqe(t.url,c),u=JQ(t.query,{arrayFormat:"repeat",addQueryPrefix:!0}),d=new KQ.Headers({Accept:"application/json"});let h;t.jsonBody&&(h=JSON.stringify(t.jsonBody),d.append("Content-Type","application/json")),e&&c!=="auth"&&d.append("Client-ID",e),n&&d.append("Authorization",`${c==="helix"?"Bearer":"OAuth"} ${n}`);const f={...i,method:(a=t.method)!==null&&a!==void 0?a:"GET",headers:d,body:h};return await lqe(`${l}${u}`,f)}async function Hk(t,e,n,r,i={}){const s=await Dqe(t,e,n,r,i);return await kqe(s,t),await Nqe(s)}class sE extends Ay{constructor(e){super("Invalid token supplied",e)}}class F1 extends Ay{}function Lqe(t,e,n,r){return{grant_type:"authorization_code",client_id:t,client_secret:e,code:n,redirect_uri:r}}function Uqe(t,e){return{grant_type:"client_credentials",client_id:t,client_secret:e}}function Fqe(t,e,n){return{grant_type:"refresh_token",client_id:t,client_secret:e,refresh_token:n}}let AU=class extends Oqe{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[Ab].client_id}get userId(){var e;return(e=this[Ab].user_id)!==null&&e!==void 0?e:null}get userName(){var e;return(e=this[Ab].login)!==null&&e!==void 0?e:null}get scopes(){return this[Ab].scopes}get expiryDate(){return Zw(this[Ab].expires_in,e=>new Date(this._obtainmentDate.getTime()+e*1e3))}};AU=Rs([yx("auth","TokenInfo","clientId")],AU);function u4(t){var e,n;return{accessToken:t.access_token,refreshToken:t.refresh_token||null,scope:(e=t.scope)!==null&&e!==void 0?e:[],expiresIn:(n=t.expires_in)!==null&&n!==void 0?n:null,obtainmentTimestamp:Date.now()}}async function Bqe(t,e,n,r){return u4(await Hk({type:"auth",url:"token",method:"POST",query:Lqe(t,e,n,r)}))}async function jqe(t,e){return u4(await Hk({type:"auth",url:"token",method:"POST",query:Uqe(t,e)}))}async function a6(t,e,n){return u4(await Hk({type:"auth",url:"token",method:"POST",query:Fqe(t,e,n)}))}async function eT(t,e){try{const n=await Hk({type:"auth",url:"validate"},e,t);return new AU(n)}catch(n){throw n instanceof QQ&&n.statusCode===401?new sE({cause:n}):n}}const $qe=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function Hqe(t,e){if(e!=null&&e.length){const n=new Set(t.flatMap(r=>{var i;return[r,...(i=$qe.get(r))!==null&&i!==void 0?i:[]]}));if(e.every(r=>!n.has(r))){const r=e.join(", ");throw new Error(`This token does not have any of the requested scopes (${r}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function B1(t,e){for(const n of e)Hqe(t,n)}async function Vqe(t,e,n,r,i){if(i!=null&&i.length||!n){const s=await eT(e,t);if(!s.userId)throw new Error("Trying to use an app access token as a user access token");const o=r??s.scopes;return i&&B1(o,i.filter(a=>!!a)),[o,s.userId]}return[r,n]}class c6{constructor(e){this._newTokenScopeSets=[],this._newTokenPromise=null,this._queuedScopeSets=[],this._queueExecutor=null,this._queuePromise=null,this._executor=e}async fetch(...e){var n;const r=e.filter(a=>!!a);if(this._newTokenPromise){if(!r.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...r):this._queuedScopeSets=[...r],!this._queuePromise){const{promise:a,resolve:c,reject:l}=TU();this._queuePromise=a,this._queueExecutor=async()=>{var u;if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{c(await this._executor(this._newTokenScopeSets))}catch(d){l(d)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(u=this._queueExecutor)===null||u===void 0||u.call(this)}}}}return await this._queuePromise}this._newTokenScopeSets=[...r];const{promise:i,resolve:s,reject:o}=TU();this._newTokenPromise=i;try{s(await this._executor(this._newTokenScopeSets))}catch(a){o(a)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],(n=this._queueExecutor)===null||n===void 0||n.call(this)}return await i}}class l6 extends Ay{constructor(e){super(`The user context for the user ${e} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class zqe extends Ay{constructor(e){super(`User ${e} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class Gqe extends Ay{constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}let b_=class extends _x{constructor(e){var n;super(),this._userAccessTokens=new Map,this._userTokenFetchers=new Map,this._intentToUserId=new Map,this._userIdToIntents=new Map,this._cachedRefreshFailures=new Set,this.onRefresh=this.registerEvent(),this.onRefreshFailure=this.registerEvent(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=(n=e.appImpliedScopes)!==null&&n!==void 0?n:[],this._appTokenFetcher=new c6(async r=>await this._fetchAppToken(r))}addUser(e,n,r){const i=Um(e);if(!n.refreshToken)throw new Error(`Trying to add user ${i} without refresh token`);this._cachedRefreshFailures.delete(i),this._userAccessTokens.set(i,{...n,userId:i}),this._userTokenFetchers.has(i)||this._userTokenFetchers.set(i,new c6(async s=>await this._fetchUserToken(i,s))),r&&this.addIntentsToUser(e,r)}async addUserForToken(e,n){let r=null;if(e.accessToken&&!U1(e))try{const a=await eT(e.accessToken);r=[e,a]}catch(a){if(!(a instanceof sE))throw a}if(!r){if(!e.refreshToken)throw new sE;const a=await a6(this._clientId,this._clientSecret,e.refreshToken),c=await eT(a.accessToken);this.emit(this.onRefresh,c.userId,a),r=[a,c]}const[i,s]=r;if(!s.userId)throw new F1("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const o=i.scope?i:{...i,scope:s.scopes};return this.addUser(s.userId,o,n),s.userId}async addUserForCode(e,n){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const r=await Bqe(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(r,n)}hasUser(e){return this._userTokenFetchers.has(Um(e))}removeUser(e){const n=Um(e);if(this._userIdToIntents.has(n)){const r=this._userIdToIntents.get(n);for(const i of r)this._intentToUserId.delete(i);this._userIdToIntents.delete(n)}this._userAccessTokens.delete(n),this._userTokenFetchers.delete(n),this._cachedRefreshFailures.delete(n)}addIntentsToUser(e,n){const r=Um(e);if(!this._userAccessTokens.has(r))throw new Error("Trying to add intents to a user that was not added to this provider");for(const i of n)this._intentToUserId.has(i)&&this._userIdToIntents.get(this._intentToUserId.get(i)).delete(i),this._intentToUserId.set(i,r),this._userIdToIntents.has(r)?this._userIdToIntents.get(r).add(i):this._userIdToIntents.set(r,new Set([i]))}getIntentsForUser(e){const n=Um(e);return this._userIdToIntents.has(n)?Array.from(this._userIdToIntents.get(n)):[]}removeIntents(e){var n;for(const r of e)if(this._intentToUserId.has(r)){const i=this._intentToUserId.get(r);(n=this._userIdToIntents.get(i))===null||n===void 0||n.delete(r),this._intentToUserId.delete(r)}}async refreshAccessTokenForUser(e){const n=Um(e);if(this._cachedRefreshFailures.has(n))throw new l6(n);const r=this._userAccessTokens.get(n);if(!r)throw new Error("Trying to refresh token for user that was not added to the provider");const i=await this._refreshUserTokenWithCallback(n,r.refreshToken);return this._checkIntermediateUserRemoval(n),this._userAccessTokens.set(n,{...i,userId:n}),this.emit(this.onRefresh,n,i),{...i,userId:n}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new Gqe(e);const n=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(n)}get clientId(){return this._clientId}getCurrentScopesForUser(e){var n;const r=this._userAccessTokens.get(Um(e));if(!r)throw new Error("Trying to get scopes for user that was not added to the provider");return(n=r.scope)!==null&&n!==void 0?n:[]}async getAccessTokenForUser(e,...n){const r=Um(e),i=this._userTokenFetchers.get(r);if(!i)return null;if(this._cachedRefreshFailures.has(r))throw new l6(r);return B1(this.getCurrentScopesForUser(r),n.filter(Boolean)),await i.fetch(...n)}async getAccessTokenForIntent(e,...n){if(!this._intentToUserId.has(e))return null;const r=this._intentToUserId.get(e),i=await this.getAccessTokenForUser(r,...n);if(!i)throw new o6(`Found intent ${e} corresponding to user ID ${r} but no token was found`);return{...i,userId:r}}async getAnyAccessToken(e){if(e){const n=Um(e);if(this._userAccessTokens.has(n)){const r=await this.getAccessTokenForUser(n);if(!r)throw new o6(`Token for user ID ${n} exists but nothing was returned by getAccessTokenForUser`);return{...r,userId:n}}}return await this.getAppAccessToken()}async getAppAccessToken(e=!1){return e&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(n=>[n]))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new zqe(e)}async _fetchUserToken(e,n){const r=this._userAccessTokens.get(e);if(!r)throw new Error("Trying to get token for user that was not added to the provider");if(r.accessToken&&!U1(r))try{if(r.scope)return B1(r.scope,n),r;const[s=[]]=await Vqe(this._clientId,r.accessToken,e,r.scope,n),o={...r,scope:s};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,o),o}catch(s){if(!(s instanceof sE))throw s}this._checkIntermediateUserRemoval(e);const i=await this.refreshAccessTokenForUser(e);return B1(i.scope,n),i}async _refreshUserTokenWithCallback(e,n){try{return await a6(this.clientId,this._clientSecret,n)}catch(r){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e,r),r}}async _fetchAppToken(e){if(e.length>0)for(const n of e)if(this._appImpliedScopes.length){if(n.every(r=>!this._appImpliedScopes.includes(r)))throw new Error(`One of the scopes ${n.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw new Error(`One of the scopes ${n.join(", ")} requested but the client credentials flow does not support scopes`);return!this._appAccessToken||U1(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await jqe(this._clientId,this._clientSecret)}};Rs([k_(!1)],b_.prototype,"_clientSecret",void 0);Rs([k_(!1)],b_.prototype,"_userAccessTokens",void 0);Rs([k_(!1)],b_.prototype,"_userTokenFetchers",void 0);Rs([k_(!1)],b_.prototype,"_appAccessToken",void 0);Rs([k_(!1)],b_.prototype,"_appTokenFetcher",void 0);b_=Rs([yx("auth","RefreshingAuthProvider","clientId")],b_);class qqe extends _x{constructor({lineBased:e,logger:n,additionalOptions:r}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=e??!1,this._logger=n,this._additionalOptions=r}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r
`))}assumeExternalDisconnect(){var e;(e=this._logger)===null||e===void 0||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var n,r;if(!this._lineBased){this.emit(this.onReceive,e);return}const i=e.split(`\r
`);if(this._currentLine+=(n=i.shift())!==null&&n!==void 0?n:"",i.length){this.emit(this.onReceive,this._currentLine),this._currentLine=(r=i.pop())!==null&&r!==void 0?r:"";for(const s of i)this.emit(this.onReceive,s)}}}class Wqe{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}class Kqe extends _x{constructor(e,n,r={}){var i;super(),this._type=e,this._target=n,this._config=r,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(i=r.retryLimit)!==null&&i!==void 0?i:1/0,this._logger=r.logger}get isConnected(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnected)!==null&&n!==void 0?n:!1}get isConnecting(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnecting)!==null&&n!==void 0?n:this._connecting}get hasSocket(){var e,n;return(n=(e=this._currentConnection)===null||e===void 0?void 0:e.hasSocket)!==null&&n!==void 0?n:!1}sendLine(e){var n;(n=this._currentConnection)===null||n===void 0||n.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if((e=this._logger)===null||e===void 0||e.trace(`PersistentConnection disconnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const n=this._currentConnection;this._currentConnection=void 0,n.disconnect()}}assumeExternalDisconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("PersistentConnection assumeExternalDisconnect"),(n=this._currentConnection)===null||n===void 0||n.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(e=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(e=!1){var n,r;(n=this._logger)===null||n===void 0||n.trace(`PersistentConnection tryConnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;(r=this._retryTimerGenerator)!==null&&r!==void 0||(this._retryTimerGenerator=$Q(120));const s=this._currentConnection=new this._type(GGe(this._target),this._config);s.onReceive(o=>this.emit(this.onReceive,o)),s.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),s.onDisconnect((o,a)=>{var c,l,u;if(this.emit(this.onDisconnect,o,a),o)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,s.disconnect(),this._currentConnection===s&&(this._currentConnection=void 0),this._previousConnection===s&&(this._previousConnection=void 0);else if(this._connecting){if((c=this._logger)===null||c===void 0||c.debug(`Connection error caught: ${(l=a==null?void 0:a.message)!==null&&l!==void 0?l:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const d=this._retryTimerGenerator.next().value;d!==0&&((u=this._logger)===null||u===void 0||u.info(`Retrying in ${d} seconds`)),setTimeout(()=>{var h;this._connecting&&((h=this._logger)===null||h===void 0||h.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())},d*1e3)}else this._reconnect()}),s.connect()}_reconnect(e=!1){e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}var Mb=null;typeof WebSocket<"u"?Mb=WebSocket:typeof MozWebSocket<"u"?Mb=MozWebSocket:typeof Oh<"u"?Mb=Oh.WebSocket||Oh.MozWebSocket:typeof window<"u"?Mb=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Mb=self.WebSocket||self.MozWebSocket);class Yqe extends qqe{constructor(e,n){if(super(n),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else if(e.url)this._url=e.url;else throw new Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(e){var n;(n=this._socket)===null||n===void 0||n.send(e)}connect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new Mb(this._url,(n=this._additionalOptions)===null||n===void 0?void 0:n.wsOptions),this._socket.onopen=()=>{var r;(r=this._logger)===null||r===void 0||r.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:r})=>{this.receiveRaw(r.toString())},this._socket.onerror=r=>{var i;(i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onError message:${r.message}`)},this._socket.onclose=r=>{var i;const s=this._connected,o=this._connecting;if((i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onClose wasConnected:${s.toString()} wasConnecting:${o.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${r.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const a=new Error(`[${r.code}] ${r.reason}`);this.emit(this.onDisconnect,!1,a),this.emit(this.onEnd,!1,a)}this.clearSocket()}}disconnect(){var e,n;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(n=this._socket)===null||n===void 0||n.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}function lw(t){var e,n,r;if(Array.isArray(t)){for(n=Array(e=t.length);e--;)n[e]=(r=t[e])&&typeof r=="object"?lw(r):r;return n}if(Object.prototype.toString.call(t)==="[object Object]"){n={};for(e in t)e==="__proto__"?Object.defineProperty(n,e,{value:lw(t[e]),configurable:!0,enumerable:!0,writable:!0}):n[e]=(r=t[e])&&typeof r=="object"?lw(r):r;return n}return t}const Xqe={name:"away-notify"};class cA extends Error{constructor(e,n,r){super(`command "${e}" expected ${n} or more parameters, got ${r}`),this._command=e,this._expectedParams=n,this._actualParams=r,Object.setPrototypeOf(this,cA.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cA)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class lA extends Error{constructor(e,n,r,i){var s;super(`required parameter "${n}" did not validate against ${(s=r.type)!==null&&s!==void 0?s:"regex"} validation: "${i}"`),this._command=e,this._paramName=n,this._paramSpec=r,this._givenValue=i,Object.setPrototypeOf(this,lA.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lA)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const oE={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var ZQ={exports:{}};(function(t){t.exports=e=>{if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},t.exports.default=t.exports})(ZQ);var Jqe=ZQ.exports;const Qqe=Yc(Jqe);function MU(t,e="#&"){return new RegExp(`^[${Qqe(e)}][^ \b\0
\r,]+$`).test(t)}const u6={0:"\0",n:`
`,r:"\r","":""};function d6(t){if(!t.startsWith("")||(t=t.substring(1),t.endsWith("")&&(t=t.slice(0,-1)),!t))return!1;t=t.replace(/\x10(.)/,(r,i)=>i in u6?u6[i]:"");let[e,n=""]=$0(t," ",2);return e=e?e.toUpperCase():"",{command:e,params:n}}const Zqe={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function eWe(t){return t.replace(/[\\;\n\r ]/g,e=>`\\${Zqe[e]}`)}function tWe(t){let e=`${t.nick}`;return t.user&&(e+=`!${t.user}`),t.host&&(e+=`@${t.host}`),e}function nWe(t,e,n,r,i=oE,s=!1){const o=new t(t.COMMAND,void 0,{serverProperties:i}),a={};if(o._paramSpec&&wU(o._paramSpec,(c,l)=>{if(!(s&&c.noServer)&&!(!s&&c.noClient)){if(l in e){const u=e[l];if(u!==void 0){if(t.checkParam(u,c,i))a[l]={value:u,trailing:!!c.trailing};else if(!c.optional)throw new Error(`required parameter "${l}" did not suit requirements: "${u}"`)}}if(!(l in a)&&!c.optional)throw new Error(`required parameter "${l}" not found in command "${t.COMMAND}"`)}}),o._parsedParams=a,o._paramSpec)for(const c of Object.keys(o._paramSpec))Object.defineProperty(o,c,{get(){var l,u;return(u=(l=this._parsedParams)===null||l===void 0?void 0:l[c])===null||u===void 0?void 0:u.value}});return o._initPrefixAndTags(n,r),o}class Nt{static checkParam(e,n,r=oE){return!(n.type==="channel"&&!MU(e,r.channelTypes)||n.type==="channelList"&&!e.split(",").every(s=>MU(s,r.channelTypes))||n.match&&!n.match.test(e))}constructor(e,{params:n,tags:r,prefix:i,rawLine:s}={},{serverProperties:o=oE,isServer:a=!1,shouldParseParams:c=!0}={},l){this._params=[],this._serverProperties=oE,this._paramSpec=l,this._command=e,this._params=n,this._tags=r??new Map,this._prefix=i,this._serverProperties=o,this._raw=s,c&&this.parseParams(a)}getMinParamCount(e=!1){return this._paramSpec?Object.values(this._paramSpec).filter(n=>n.noServer&&e||n.noClient&&!e?!1:!n.optional).length:0}get paramCount(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.length)!==null&&n!==void 0?n:0}prefixToString(){return this._prefix?tWe(this._prefix):""}tagsToString(){return[...this._tags.entries()].map(([e,n])=>n?`${e}=${eWe(n)}`:e).join(";")}toString(e=!1,n=!1){const i=[n?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const o=this.prefixToString();o&&i.unshift(`:${o}`)}const s=this.tagsToString();return s&&i.unshift(`@${s}`),i.join(" ")}_initPrefixAndTags(e,n){this._prefix=e,n&&(this._tags=n)}parseParams(e=!1){if(this._params){let n=this.getMinParamCount(e);if(n>this._params.length)throw new cA(this._command,n,this._params.length);const r=this._paramSpec;if(!r)return;let i=0;const s={};for(const[o,a]of Object.entries(r)){if(a.noServer&&e||a.noClient&&!e)continue;if(this._params.length-i<=n){if(a.optional)continue;if(this._params.length-i!==n)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let c=this._params[i];if(!c){if(a.optional)break;throw new Error("unexpected parameter underflow")}if(a.rest){const l=[];for(;this._params[i]&&!this._params[i].trailing;)l.push(this._params[i].value),++i;if(!l.length){if(a.optional)continue;throw new Error(`no parameters left for required rest parameter "${o}"`)}c={value:l.join(" "),trailing:!1}}if(Nt.checkParam(c.value,a))s[o]={...c},a.optional||--n,a.rest||++i;else if(!a.optional)throw new lA(this._command,o,a,c.value);if(a.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const o of Object.keys(this._paramSpec))Object.defineProperty(this,o,{get(){var a,c;return(c=(a=this._parsedParams)===null||a===void 0?void 0:a[o])===null||c===void 0?void 0:c.value}})}}get rawParamValues(){var e,n;return(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>r.value))!==null&&n!==void 0?n:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map(n=>{var r;const i=(r=this._parsedParams)===null||r===void 0?void 0:r[n];if(i)return(i.trailing?":":"")+i.value}).filter(n=>n!==void 0)].join(" ")}_buildCommandFromRawParams(){var e,n;return[this._command,...(n=(e=this._params)===null||e===void 0?void 0:e.map(r=>`${r.trailing?":":""}${r.value}`))!==null&&n!==void 0?n:[]].join(" ")}}Nt.COMMAND="";Nt.SUPPORTS_CAPTURE=!1;class eZ extends Nt{constructor(e,n,r){super(e,n,r,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}eZ.COMMAND="BATCH";const rWe={name:"batch",messageTypes:[eZ],usesTags:!0},iWe={name:"cap-notify"};class tZ extends Nt{constructor(e,n,r){super(e,n,r,{newUser:{},newHost:{}})}}tZ.COMMAND="CHGHOST";const sWe={name:"chghost",messageTypes:[tZ]},oWe={name:"invite-notify"};class nZ extends Nt{}nZ.COMMAND="ACK";const aWe={name:"labeled-response",messageTypes:[nZ],usesTags:!0},cWe={name:"message-tags",usesTags:!0},lWe={name:"multi-prefix"},uWe=Object.freeze(Object.defineProperty({__proto__:null,AwayNotify:Xqe,Batch:rWe,CapNotify:iWe,ChgHost:sWe,InviteNotify:oWe,LabeledResponse:aWe,MessageTags:cWe,MultiPrefix:lWe},Symbol.toStringTag,{value:"Module"}));class dWe{constructor(e,n,...r){this._client=e,this._originalMessage=n,this._messages=[],this._endEventHandlers=new Map,this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const n=this._client.on(e,()=>this.end());this._endEventHandlers.set(e,n)}async promise(){return this._promise||(this._promise=new Promise(e=>{this._promiseResolve=e})),await this._promise}collect(e){return this._originalMessage._acceptsInReplyCollection(e)?(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0):!1}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach(e=>{this._client.removeListener(e)}),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class d4 extends Nt{constructor(e,n,r){super(e,n,r,{password:{}})}}d4.COMMAND="PASS";class uw extends Nt{constructor(e,n,r){super(e,n,r,{nick:{}})}}uw.COMMAND="NICK";class h4 extends Nt{constructor(e,n,r){super(e,n,r,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}h4.COMMAND="USER";class rZ extends Nt{constructor(e,n,r){super(e,n,r,{name:{},password:{}})}}rZ.COMMAND="OPER";class f4 extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}f4.COMMAND="QUIT";class iZ extends Nt{constructor(e,n,r){super(e,n,r,{server:{},reason:{trailing:!0}})}}iZ.COMMAND="SQUIT";class tT extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},key:{optional:!0}})}}tT.COMMAND="JOIN";class nT extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}nT.COMMAND="PART";class uA extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,uA.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,uA)}get char(){return this._char}}class sZ extends Nt{constructor(e,n,r){super(e,n,r,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return MU(this.target,this._serverProperties.channelTypes)}separate(){const e=[],n=this.modes;if(!n)throw new Error("can't separate a channel mode request, just set actions");const r=n.split(" "),i=r.shift();let s="add";for(const o of i){let a=s;switch(o){case"+":{s="add";break}case"-":{s="remove";break}default:{let c=!1,l=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(o)||this._serverProperties.supportedChannelModes.prefix.includes(o))c=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(o))s==="add"&&(c=!0);else if(this._serverProperties.supportedChannelModes.list.includes(o))r.length?c=!0:a="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(o))throw new uA(o)}else l=this._serverProperties.supportedUserModes.includes(o);if(c&&!r.length)continue;e.push({prefix:this._prefix,action:a,letter:o,param:c?r.shift():void 0,known:l})}}}return e}}sZ.COMMAND="MODE";class oZ extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}oZ.COMMAND="TOPIC";class bx extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channelList",optional:!0}})}}bx.COMMAND="NAMES";bx.SUPPORTS_CAPTURE=!0;class aZ extends Nt{constructor(e,n,r){super(e,n,r,{channel:{optional:!0},server:{optional:!0}})}}aZ.COMMAND="LIST";class cZ extends Nt{constructor(e,n,r){super(e,n,r,{target:{},channel:{type:"channel"}})}}cZ.COMMAND="INVITE";class lZ extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}lZ.COMMAND="KICK";class uZ extends Nt{constructor(e,n,r){super(e,n,r,{server:{optional:!0}})}}uZ.COMMAND="TIME";class rT extends Nt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}rT.COMMAND="PRIVMSG";class Vk extends Nt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}}Vk.COMMAND="NOTICE";class zk extends Nt{constructor(e,n,r){super(e,n,r,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}zk.COMMAND="WHO";class dZ extends Nt{constructor(e,n,r){super(e,n,r,{server:{optional:!0},nickMask:{}})}}dZ.COMMAND="WHOIS";class hZ extends Nt{constructor(e,n,r){super(e,n,r,{nick:{},count:{optional:!0},server:{optional:!0}})}}hZ.COMMAND="WHOWAS";class fZ extends Nt{constructor(e,n,r){super(e,n,r,{target:{},reason:{trailing:!0,optional:!0}})}}fZ.COMMAND="KILL";class dA extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}dA.COMMAND="PING";class hA extends Nt{constructor(e,n,r){super(e,n,r,{server:{noClient:!0},text:{trailing:!0}})}}hA.COMMAND="PONG";class pZ extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}pZ.COMMAND="ERROR";class mZ extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0,optional:!0}})}}mZ.COMMAND="AWAY";class gZ extends Nt{}gZ.COMMAND="REHASH";class vZ extends Nt{}vZ.COMMAND="RESTART";class _Z extends Nt{constructor(e,n,r){super(e,n,r,{text:{trailing:!0}})}}_Z.COMMAND="WALLOPS";class yZ extends Nt{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}yZ.COMMAND="USERHOST";class bZ extends Nt{constructor(e,n,r){super(e,n,r,{nicks:{rest:!0}})}}bZ.COMMAND="ISON";class wd extends Nt{constructor(e,n,r){super(e,n,r,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof wd))return!1;switch(this.subCommand){case"ACK":case"NAK":return e.subCommand==="REQ"&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof wd))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}wd.COMMAND="CAP";wd.SUPPORTS_CAPTURE=!0;class EZ extends Nt{constructor(e,n,r){super(e,n,r,{target:{}})}}EZ.COMMAND="TAGMSG";const SZ=Object.freeze(Object.defineProperty({__proto__:null,Away:mZ,CapabilityNegotiation:wd,ChannelInvite:cZ,ChannelJoin:tT,ChannelKick:lZ,ChannelList:aZ,ChannelPart:nT,ClientQuit:f4,ErrorMessage:pZ,IsOnQuery:bZ,Kill:fZ,Mode:sZ,Names:bx,NickChange:uw,Notice:Vk,OperLogin:rZ,Password:d4,Ping:dA,Pong:hA,PrivateMessage:rT,Rehash:gZ,Restart:vZ,ServerQuit:iZ,TagMessage:EZ,Time:uZ,Topic:oZ,UserHostQuery:yZ,UserRegistration:h4,Wallops:_Z,WhoIsQuery:dZ,WhoQuery:zk,WhoWasQuery:hZ},Symbol.toStringTag,{value:"Module"}));class p4 extends Nt{constructor(e,n,r){super(e,n,r,{me:{},welcomeText:{trailing:!0}})}}p4.COMMAND="001";class wZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},yourHost:{trailing:!0}})}}wZ.COMMAND="002";class TZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},createdText:{trailing:!0}})}}TZ.COMMAND="003";class m4 extends Nt{constructor(e,n,r){super(e,n,r,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}m4.COMMAND="004";class g4 extends Nt{constructor(e,n,r){super(e,n,r,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}g4.COMMAND="005";class xZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},modes:{}})}}xZ.COMMAND="221";class CZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},text:{trailing:!0}})}}CZ.COMMAND="301";class RZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},hosts:{trailing:!0}})}}RZ.COMMAND="302";class AZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}AZ.COMMAND="305";class MZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}MZ.COMMAND="306";class IZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}IZ.COMMAND="311";class OZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof zk}endsResponseTo(){return!0}}OZ.COMMAND="315";class kZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nickMask:{},suffix:{trailing:!0}})}}kZ.COMMAND="318";class NZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channels:{trailing:!0}})}}NZ.COMMAND="319";class PZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}PZ.COMMAND="322";class DZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}DZ.COMMAND="323";class LZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}LZ.COMMAND="324";class UZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}UZ.COMMAND="331";class FZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}FZ.COMMAND="332";class BZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},who:{},ts:{}})}}BZ.COMMAND="333";class jZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"}})}}jZ.COMMAND="341";class $Z extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}$Z.COMMAND="348";class HZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}HZ.COMMAND="349";class VZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof zk}}VZ.COMMAND="352";class zZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof bx}}zZ.COMMAND="353";class GZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof bx}endsResponseTo(){return!0}}GZ.COMMAND="366";class qZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}qZ.COMMAND="367";class WZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}WZ.COMMAND="368";class KZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}KZ.COMMAND="372";class YZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},line:{trailing:!0}})}}YZ.COMMAND="375";class v4 extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}v4.COMMAND="376";class XZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}XZ.COMMAND="381";class JZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}JZ.COMMAND="391";class QZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}}QZ.COMMAND="401";class ZZ extends Nt{constructor(e,n,r){super(e,n,r,{me:{},server:{},suffix:{trailing:!0}})}}ZZ.COMMAND="402";class eee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}eee.COMMAND="403";class tee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}tee.COMMAND="404";class nee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}nee.COMMAND="405";class ree extends Nt{constructor(e,n,r){super(e,n,r,{me:{},subCommand:{},suffix:{trailing:!0}})}}ree.COMMAND="410";class iee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}iee.COMMAND="421";class _4 extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}_4.COMMAND="422";class see extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}see.COMMAND="431";class oee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}oee.COMMAND="432";class aee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}aee.COMMAND="433";class cee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}cee.COMMAND="436";class lee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}lee.COMMAND="441";class uee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}uee.COMMAND="442";class dee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}dee.COMMAND="443";class hee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}hee.COMMAND="451";class fee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}}fee.COMMAND="461";class y4 extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}y4.COMMAND="462";class pee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}pee.COMMAND="471";class mee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},char:{},suffix:{trailing:!0}})}}mee.COMMAND="472";class gee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}gee.COMMAND="473";class vee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}vee.COMMAND="474";class _ee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}_ee.COMMAND="475";class yee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}yee.COMMAND="479";class bee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}bee.COMMAND="481";class Eee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},channel:{},suffix:{trailing:!0}})}}Eee.COMMAND="482";class See extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}See.COMMAND="491";class wee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}wee.COMMAND="501";class Tee extends Nt{constructor(e,n,r){super(e,n,r,{me:{},suffix:{trailing:!0}})}}Tee.COMMAND="502";const xee=Object.freeze(Object.defineProperty({__proto__:null,Error401NoSuchNick:QZ,Error402NoSuchServer:ZZ,Error403NoSuchChannel:eee,Error404CanNotSendToChan:tee,Error405TooManyChannels:nee,Error410InvalidCapCmd:ree,Error421UnknownCommand:iee,Error422NoMotd:_4,Error431NoNickNameGiven:see,Error432ErroneusNickname:oee,Error433NickNameInUse:aee,Error436NickCollision:cee,Error441UserNotInChannel:lee,Error442NotOnChannel:uee,Error443UserOnChannel:dee,Error451NotRegistered:hee,Error461NeedMoreParams:fee,Error462AlreadyRegistered:y4,Error471ChannelIsFull:pee,Error472UnknownMode:mee,Error473InviteOnlyChan:gee,Error474BannedFromChan:vee,Error475BadChannelKey:_ee,Error479BadChanName:yee,Error481NoPrivileges:bee,Error482ChanOpPrivsNeeded:Eee,Error491NoOperHost:See,Error501UmodeUnknownFlag:wee,Error502UsersDontMatch:Tee,Reply001Welcome:p4,Reply002YourHost:wZ,Reply003Created:TZ,Reply004ServerInfo:m4,Reply005Isupport:g4,Reply221UmodeIs:xZ,Reply301Away:CZ,Reply302UserHost:RZ,Reply305UnAway:AZ,Reply306NowAway:MZ,Reply311WhoisUser:IZ,Reply315EndOfWho:OZ,Reply318EndOfWhois:kZ,Reply319WhoisChannels:NZ,Reply322List:PZ,Reply323ListEnd:DZ,Reply324ChannelModeIs:LZ,Reply331NoTopic:UZ,Reply332Topic:FZ,Reply333TopicWhoTime:BZ,Reply341Inviting:jZ,Reply348ExceptList:$Z,Reply349EndOfExceptList:HZ,Reply352WhoReply:VZ,Reply353NamesReply:zZ,Reply366EndOfNames:GZ,Reply367BanList:qZ,Reply368EndOfBanList:WZ,Reply372Motd:KZ,Reply375MotdStart:YZ,Reply376EndOfMotd:v4,Reply381YoureOper:XZ,Reply391Time:JZ},Symbol.toStringTag,{value:"Module"})),hWe=new Map([...Object.values(SZ),...Object.values(xee)].map(t=>[t.COMMAND,t]));function fWe(t){const[e,n]=$0(t,"!",2);if(n){const[r,i]=$0(n,"@",2);return i?{nick:e,user:r,host:i}:{nick:e,host:r}}return{nick:e}}const h6={":":";",n:`
`,r:"\r",s:" "};function pWe(t){const e=new Map,n=t.split(";");for(const r of n){const[i,s]=$0(r,"=",2);i!==""&&e.set(i,s?s.replace(/\\(.?)/g,(o,a)=>Object.prototype.hasOwnProperty.call(h6,a)?h6[a]:a):"")}return e}function mWe(t,e=oE,n=hWe,r=!1,i=[],s=!0){const o=t.split(" ");let a,c;const l=[];let u,d;for(;o.length;){if([a]=o,a.startsWith("@")&&!u&&!c&&!d)u=pWe(a.slice(1));else if(a.startsWith(":"))if(!d&&!c)a.length>1&&(d=fWe(a.slice(1)));else{l.push({value:o.join(" ").slice(1),trailing:!0});break}else c?l.push({value:a,trailing:!1}):c=a.toUpperCase();o.shift()}if(u||(u=new Map),!c)throw new Error(`line without command received: ${t}`);s&&(s=!i.includes(c));let h=Nt;return n.has(c)&&(h=n.get(c)),new h(c,{params:l,tags:u,prefix:d,rawLine:t},{serverProperties:e,isServer:r,shouldParseParams:s})}class Cee extends _x{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=lw(oE),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:n,credentials:r,channels:i,channelTypes:s,webSocket:o,logger:a={}}=e;this._options=e;const{pingOnInactivity:c=60,pingTimeout:l=10}=n;this._pingOnInactivity=c,this._pingTimeout=l,this._currentNick=r.nick,this._logger=$k({name:"ircv3",emoji:!0,...a}),this.registerCoreMessageTypes();const{hostName:u,secure:d,reconnect:h=!0}=n,f={hostName:u,port:this.port,secure:d},p={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},g=o?Yqe:Wqe;h?this._connection=new Kqe(g,f,p):this._connection=new g(p,this._logger,e.connectionOptions);for(const v of Object.values(uWe))this.addCapability(v);this.addInternalListener(this.onRegister,async()=>{const v=this._hasRegisteredBefore,E=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const T=v&&this._options.rejoinChannelsOnReconnect?E:await SU(i);if(T)for(const C of T)this.join(C)}),this.onTypedMessage(wd,async({subCommand:v,capabilities:E})=>{const T=E.split(" ");switch(v.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${T.join(", ")}`);const C=zC(T,k=>{if(!k)return{};const[I,N]=$0(k,"=",2);return{[I]:{name:I,param:N||!0}}});for(const[k,I]of Object.entries(C))this._serverCapabilities.set(k,I);const A=Object.keys(C);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([k])=>A.includes(k)).map(([,k])=>k));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${T.join(", ")}`);for(const C of T)this._serverCapabilities.delete(C),this._negotiatedCapabilities.delete(C)}}}),this.onTypedMessage(dA,({text:v})=>{this.sendMessage(hA,{text:v})}),this.onTypedMessage(p4,({me:v})=>this._handleReceivedClientNick(v)),this.onTypedMessage(m4,({userModes:v})=>{v&&(this._serverProperties.supportedUserModes=v)}),this.onTypedMessage(g4,({supports:v})=>{const E=zC(v.split(" "),T=>{const[C,A]=$0(T,"=",2);return{[C]:A||!0}});this._supportedFeatures={...this._supportedFeatures,...E}}),this.onTypedMessage(v4,({me:v})=>{this._registered||(this._handleReceivedClientNick(v),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(_4,({me:v})=>{this._registered||(this._handleReceivedClientNick(v),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(y4,({me:v})=>{this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(v),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(rT,v=>{var E;const{target:T,text:C}=v,A=d6(C),k=(E=v.prefix)===null||E===void 0?void 0:E.nick;A?A.command==="ACTION"?this.emit(this.onAction,T,k,A.params,v):this.emit(this.onCtcp,T,k,A.command,A.params,v):this.emit(this.onPrivmsg,T,k,C,v)}),this.onTypedMessage(uw,v=>{var E;const{nick:T}=v,C=(E=v.prefix)===null||E===void 0?void 0:E.nick;C===this._currentNick&&(this._currentNick=T),this.emit(this.onNickChange,C,T,v)}),this.onTypedMessage(Vk,v=>{var E;const{target:T,text:C}=v,A=d6(C),k=(E=v.prefix)===null||E===void 0?void 0:E.nick;A&&this.emit(this.onCtcpReply,T,k,A.command,A.params,v),this.emit(this.onNotice,T,k,C,v)}),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(tT,({channel:v,prefix:E})=>{(E==null?void 0:E.nick)===this._currentNick&&this.acknowledgeJoin(v)}),this.onTypedMessage(nT,v=>{var E;((E=v.prefix)===null||E===void 0?void 0:E.nick)===this._currentNick&&(this._currentChannels.delete(v.channel),this._channelsFromLastRegister.delete(v.channel))}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=r.nick,this._userName=r.userName,this._realName=r.realName,s&&(this._serverProperties.channelTypes=s)}receiveLine(e){var n;this._logger.debug(`Received message: ${e}`);let r;try{r=mWe(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(i){this._logger.error(`Error parsing message: ${i.message}`),this._logger.trace((n=i.stack)!==null&&n!==void 0?n:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify(r)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,r),this._handleEvents(r)}get serverProperties(){return lw(this._serverProperties)}get port(){const{webSocket:e,connection:{port:n,secure:r}}=this._options;return n||(e?r?443:80:r?6697:6667)}pingCheck(){const e=Date.now(),n=e.toString(),r=this.onTypedMessage(hA,i=>{const{text:s}=i;s===n&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(r))});this._pingTimeoutTimer=setTimeout(()=>{this.removeMessageListener(r),this._options.connection.reconnect===!1?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()},this._pingTimeout*1e3),this.sendMessage(dA,{text:n})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){e.COMMAND!==""&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const n of Object.values(e.messageTypes))this.registerMessageType(n)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,n,r){this._events.has(e)||this._events.set(e,new Map);const i=this._events.get(e);if(!r)do r=`${e}:${WGe(Math.random()*1e4,4,"0")}`;while(i.has(r));return i.set(r,n),r}onTypedMessage(e,n,r){return this.onNamedMessage(e.COMMAND,n,r)}removeMessageListener(e){const[n]=e.split(":");this._events.has(n)&&this._events.get(n).delete(e)}createMessage(e,n,r){const i=r?new Map(Object.entries(r)):void 0;return nWe(e,n,void 0,i,this.serverProperties)}sendMessage(e,n,r){this.send(this.createMessage(e,n,r))}async sendMessageAndCaptureReply(e,n){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const r=this.createMessage(e,n),i=this.collect(r).promise();return this.send(r),await i}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e,...n){const r=new dWe(this,e,...n);return this._collectors.push(r),r}stopCollect(e){this._collectors.splice(this._collectors.findIndex(n=>n===e),1)}join(e,n){this.sendMessage(tT,{channel:e,key:n})}part(e){this.sendMessage(nT,{channel:e})}quit(e){this.sendMessage(f4,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,n,r={}){this.sendMessage(rT,{target:e,text:n},r)}sendCtcp(e,n,r){this.say(e,`${n.toUpperCase()} ${r}`)}action(e,n){this.sendCtcp(e,"ACTION",n)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(uw,{nick:e}))}registerCoreMessageTypes(){wU(SZ,e=>{this.registerMessageType(e)}),wU(xee,e=>{this.registerMessageType(e)})}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter(n=>n.length).map(async n=>await this._negotiateCapabilities(n)))}async _negotiateCapabilities(e){const n=zC(e,o=>({[o.name]:o})),i=(await this.sendMessageAndCaptureReply(wd,{subCommand:"REQ",capabilities:e.map(o=>o.name).join(" ")})).shift();if(!i)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(i instanceof wd))throw new Error(`capability negotiation failed unexpectedly with "${i.command}" command`);const s=i.capabilities.split(" ").filter(o=>o);if(i.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${s.join(", ")}`);const o=s.map(a=>n[a]);for(const a of o){const c=this._clientCapabilities.get(a.name);c.param=a.param,this._negotiatedCapabilities.set(c.name,c)}return o}return this._logger.warn(`Failed to negotiate capabilities: ${s.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect(async()=>{var e,n;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[r]=await Promise.all([SU(this._options.credentials.password),this.sendMessageAndCaptureReply(wd,{subCommand:"LS",version:"302"}).then(async i=>{if(!i.length||!(i[0]instanceof wd))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const s=i.map(a=>zC(a.capabilities.split(" "),c=>{if(!c)return{};const[l,u]=$0(c,"=",2);return{[l]:{name:l,param:u||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...s))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const o=s.map(a=>{const c=Object.keys(a);return Array.from(this._clientCapabilities.entries()).filter(([l])=>c.includes(l)).map(([,l])=>l)});return await this._negotiateCapabilityBatch(o)}).then(()=>{this.sendMessage(wd,{subCommand:"END"})})]);r&&this.sendMessage(d4,{password:r}),this.sendMessage(uw,{nick:this._desiredNick}),this.sendMessage(h4,{user:(e=this._userName)!==null&&e!==void 0?e:this._desiredNick,mode:"8",unused:"*",realName:(n=this._realName)!==null&&n!==void 0?n:this._desiredNick})}catch(r){this.emit(this.onPasswordError,r),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive(e=>{this.receiveLine(e)}),this._connection.onDisconnect((e,n)=>{var r;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const i=(r=this._options.connection.reconnect)!==null&&r!==void 0?r:!0,s=n?`Disconnected unexpectedly: ${n.message}`:"Disconnected unexpectedly";i?this._logger.warn(`${s}; trying to reconnect`):this._logger.error(s)}this.emit(this.onDisconnect,e,n)}),this._connection.onEnd(e=>{e||this._logger.warn("No further retries will be made")}))}_handleReceivedClientNick(e){this._currentNick!==e&&(this._currentNick!==""&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some(r=>r.collect(e));const n=this._events.get(e.constructor.COMMAND);if(n)for(const r of n.values())r(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1e3):this._pingCheckTimer=void 0}}Rs([k_(!1)],Cee.prototype,"_options",void 0);class b4 extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return(e=this._tags.get("target-user-id"))!==null&&e!==void 0?e:null}}b4.COMMAND="CLEARCHAT";class Ree extends Nt{}Ree.COMMAND="RECONNECT";class E4 extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}E4.COMMAND="ROOMSTATE";function gWe(t){switch(typeof t){case"undefined":return"";case"object":{if(t===null)return"";if("cacheKey"in t)return t.cacheKey;const e=JSON.stringify(t);if(e!=="{}")return e}default:return t.toString()}}function Aee(t,e,n){return[t,...e.map(gWe)].join("/")+(n?"/":"")}const Fm=Symbol("cache");function vWe(t){var e,n;return n=class extends t{constructor(){super(...arguments),this[e]=new Map}getFromCache(r){if(this._cleanCache(),this[Fm].has(r)){const i=this[Fm].get(r);if(i)return i.value}}setCache(r,i,s){this[Fm].set(r,{value:i,expires:Date.now()+s*1e3})}removeFromCache(r,i){const s=this._getInternalCacheKey(r,i);i?this[Fm].forEach((o,a)=>{a.startsWith(s)&&this[Fm].delete(a)}):this[Fm].delete(s)}_cleanCache(){const r=Date.now();this[Fm].forEach((i,s)=>{i.expires<r&&this[Fm].delete(s)})}_getInternalCacheKey(r,i){if(typeof r=="string"){let s=r;return s.endsWith("/")||(s+="/"),s}else{const s=r.shift();return Aee(s,r,i)}}},e=Fm,n}function Mee(t=1/0){return function(e,n,r){if(r.get){const i=r.get;r.get=function(){const s=Aee(n,[]),o=this.getFromCache(s);if(o)return o;const a=i.call(this);return this.setCache(s,a,t),a}}return r}}var j1;let E_=j1=class{constructor(e,n){this._userName=e.toLowerCase(),this._userData=n?new Map(n):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map(n=>{const r=n.indexOf("/");return r===-1?[n,""]:[n.slice(0,r),n.slice(r+1)]})):new Map}get userName(){return this._userName}get displayName(){var e;return(e=this._userData.get("display-name"))!==null&&e!==void 0?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return j1._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return j1._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){const e=this._userData.get("vip");return e!=null&&e!=="0"}get isArtist(){return this.badges.has("artist-badge")}};Rs([k_(!1)],E_.prototype,"_userData",void 0);Rs([Mee()],E_.prototype,"badges",null);Rs([Mee()],E_.prototype,"badgeInfo",null);E_=j1=Rs([vWe,yx("chat","ChatUser","userId")],E_);function S4(t){return t?new Map(t.split("/").map(e=>{const[n,r]=e.split(":",2);return r?[n,r.split(",")]:null}).filter(e=>e!==null)):new Map}class w4 extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new E_(this._tags.get("login"),this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get emoteOffsets(){return S4(this._tags.get("emotes"))}}w4.COMMAND="USERNOTICE";class Iee extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"}})}}Iee.COMMAND="USERSTATE";class T4 extends Nt{constructor(e,n,r){super(e,n,r,{target:{},text:{trailing:!0}})}get userInfo(){return new E_(this._prefix.nick,this._tags)}get emoteOffsets(){return S4(this._tags.get("emotes"))}}T4.COMMAND="WHISPER";const _We={name:"twitch.tv/commands",messageTypes:[b4,Ree,E4,w4,Iee,T4]},yWe={name:"twitch.tv/membership"};class x4 extends Nt{constructor(e,n,r){super(e,n,r,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}x4.COMMAND="CLEARMSG";class Oee extends Nt{}Oee.COMMAND="GLOBALUSERSTATE";const bWe={name:"twitch.tv/tags",messageTypes:[Oee,x4]},EWe=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"];let fA=class extends rT{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new E_(this._prefix.nick,this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return!!this._tags.get("custom-reward-id")}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return(e=this._tags.get("reply-parent-msg-id"))!==null&&e!==void 0?e:null}get parentMessageText(){var e;return(e=this._tags.get("reply-parent-msg-body"))!==null&&e!==void 0?e:null}get parentMessageUserId(){var e;return(e=this._tags.get("reply-parent-user-id"))!==null&&e!==void 0?e:null}get parentMessageUserName(){var e;return(e=this._tags.get("reply-parent-user-login"))!==null&&e!==void 0?e:null}get parentMessageUserDisplayName(){var e;return(e=this._tags.get("reply-parent-display-name"))!==null&&e!==void 0?e:null}get threadMessageId(){var e;return(e=this._tags.get("reply-thread-parent-msg-id"))!==null&&e!==void 0?e:null}get threadMessageUserId(){var e;return(e=this._tags.get("reply-thread-parent-user-id"))!==null&&e!==void 0?e:null}get bits(){var e;return Number((e=this._tags.get("bits"))!==null&&e!==void 0?e:0)}get emoteOffsets(){return S4(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return Zw(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return Zw(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){const e=this.hypeChatAmount;return e?e/10**this.hypeChatDecimalPlaces:null}get hypeChatCurrency(){var e;return(e=this._tags.get("pinned-chat-paid-currency"))!==null&&e!==void 0?e:null}get hypeChatLevel(){const e=this._tags.get("pinned-chat-paid-level");return e?EWe.indexOf(e)+1:null}get hypeChatIsSystemMessage(){const e=this._tags.get("pinned-chat-paid-is-system-message");return e?!!Number(e):null}};fA=Rs([yx("chat","ChatMessage","id")],fA);function SWe(t){return t instanceof fA?t.tags.get("id"):t}function f6(t,e){if(t.length<=e)return[t];t=t.trim();const n=[];let r=0,i=e;for(;r<t.length;){let s=t.lastIndexOf(" ",i);(s===-1||s<=r||t.length-r+1<=e)&&(s=r+e);const o=t.slice(r,s).trim();o.length&&n.push(o),r=s+(t[s]===" "?1:0),i=r+e}return n}const wWe=/^[a-z0-9][a-z0-9_]{0,24}$/;function Ta(t){const e=t.replace(/^#/,"").toLowerCase();if(!wWe.test(e))throw new Error(`"${e}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return e}function GC(t){return`#${Ta(t)}`}var IU;let pA=IU=class extends _x{constructor(e={}){var n,r,i,s,o;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new F1("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new Cee({connection:{hostName:(n=e.hostName)!==null&&n!==void 0?n:!((r=e.webSocket)!==null&&r!==void 0)||r?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(i=e.ssl)!==null&&i!==void 0?i:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(s=e.webSocket)!==null&&s!==void 0?s:!0,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((l,u)=>{this._messageRateLimiter.clear(),this._messageRateLimiter.pause(),this._joinRateLimiter.clear(),this._joinRateLimiter.pause(),this.emit(this.onDisconnect,l,u)}),this._ircClient.registerMessageType(fA),this._chatLogger=$k({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...(o=e.authIntents)!==null&&o!==void 0?o:[],"chat"];const a=async({type:l,text:u,channel:d,tags:h})=>{l==="say"?this._ircClient.say(d,u,h):this._ircClient.action(d,u)},c=async l=>{const{promise:u,resolve:d,reject:h}=TU();let f;const p=this.addInternalListener(this._onJoinResult,(g,v,E)=>{g===l&&(clearTimeout(f),E?h(E):d(),this.removeListener(p))});f=setTimeout(()=>{this.removeListener(p),this.emit(this._onJoinResult,l,void 0,"twurple_timeout"),h(new Error(`Did not receive a reply to join ${l} in time; assuming that the join failed`))},1e4),this._ircClient.join(l),await u};if(e.isAlwaysMod)this._messageRateLimiter=new xU({bucketSize:e.botLevel==="verified"?7500:100,timeFrame:32e3,doRequest:a});else{let l=20;e.botLevel==="verified"?l=7500:e.botLevel==="known"&&(l=50),this._messageRateLimiter=new sqe(new iqe({bucketSize:1,timeFrame:1200,logger:{minLevel:Kn.ERROR},doRequest:a,getPartitionKey:({channel:u})=>u}),{bucketSize:l,timeFrame:32e3})}this._joinRateLimiter=new xU({bucketSize:e.botLevel==="verified"?2e3:20,timeFrame:11e3,doRequest:c}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause(),this._ircClient.addCapability(bWe),this._ircClient.addCapability(_We),e.requestMembershipEvents&&this._ircClient.addCapability(yWe),this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{this._messageRateLimiter.resume(),this._joinRateLimiter.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const l=await SU(e.channels);l&&await Promise.all(l.map(async u=>{var d;try{await this.join(u)}catch(h){this._chatLogger.warn(`Failed to join configured channel ${u}; original message: ${(d=h==null?void 0:h.message)!==null&&d!==void 0?d:h}`)}}))}),this._ircClient.onPasswordError(l=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${l.message}`),this.emit(this.onTokenFetchFailure,l)}),this._ircClient.onPrivmsg((l,u,d,h)=>{u!=="jtv"&&this.emit(this.onMessage,Ta(l),u,d,h)}),this._ircClient.onAction((l,u,d,h)=>{this.emit(this.onAction,Ta(l),u,d,h)}),this.addInternalListener(this._onJoinResult,(l,u,d)=>{d?this.emit(this.onJoinFailure,Ta(l),d):this._ircClient.acknowledgeJoin(l)}),this._ircClient.onTypedMessage(b4,l=>{const{channel:u,user:d,tags:h}=l,f=Ta(u);if(d){const p=h.get("ban-duration");p===void 0?this.emit(this.onBan,f,d,l):this.emit(this.onTimeout,f,d,Number(p),l)}else this.emit(this.onChatClear,f,l)}),this._ircClient.onTypedMessage(x4,l=>{const{channel:u,targetMessageId:d}=l;this.emit(this.onMessageRemove,Ta(u),d,l)}),this._ircClient.onTypedMessage(tT,({prefix:l,channel:u})=>{this.emit(this.onJoin,Ta(u),l.nick)}),this._ircClient.onTypedMessage(nT,({prefix:l,channel:u})=>{this.emit(this.onPart,Ta(u),l.nick)}),this._ircClient.onTypedMessage(E4,({channel:l,tags:u})=>{let d=!1;if(u.has("subs-only")&&u.has("slow")&&(this.emit(this._onJoinResult,l,u),d=!0),!d){const h=Ta(l);if(u.has("slow")){const f=Number(u.get("slow"));f?this.emit(this.onSlow,h,!0,f):this.emit(this.onSlow,h,!1)}if(u.has("followers-only")){const f=Number(u.get("followers-only"));f===-1?this.emit(this.onFollowersOnly,h,!1):this.emit(this.onFollowersOnly,h,!0,f)}}}),this._ircClient.onTypedMessage(w4,l=>{const{channel:u,text:d,tags:h}=l,f=h.get("msg-id"),p=Ta(u);switch(f){case"sub":case"resub":{const g=f==="sub"?this.onSub:this.onResub,v=h.get("msg-param-sub-plan"),E=h.get("msg-param-streak-months"),T={userId:h.get("user-id"),displayName:h.get("display-name"),plan:v,planName:h.get("msg-param-sub-plan-name"),isPrime:v==="Prime",months:Number(h.get("msg-param-cumulative-months")),streak:E?Number(E):void 0,message:d};if(h.get("msg-param-was-gifted")==="true"){const A=h.get("msg-param-anon-gift")==="true",k=Number(h.get("msg-param-gift-months")),I=Number(h.get("msg-param-gift-month-being-redeemed"));A?T.originalGiftInfo={anonymous:!0,duration:k,redeemedMonth:I}:T.originalGiftInfo={anonymous:!1,duration:k,redeemedMonth:I,userId:h.get("msg-param-gifter-id"),userName:h.get("msg-param-gifter-login"),userDisplayName:h.get("msg-param-gifter-name")}}this.emit(g,p,h.get("login"),T,l);break}case"subgift":{const g=h.get("msg-param-sub-plan"),v=h.get("login"),E=v==="ananonymousgifter",T={userId:h.get("msg-param-recipient-id"),displayName:h.get("msg-param-recipient-display-name"),gifter:E?void 0:v,gifterUserId:E?void 0:h.get("user-id"),gifterDisplayName:E?void 0:h.get("display-name"),gifterGiftCount:E?void 0:Number(h.get("msg-param-sender-count")),giftDuration:Number(h.get("msg-param-gift-months")),plan:g,planName:h.get("msg-param-sub-plan-name"),isPrime:g==="Prime",months:Number(h.get("msg-param-months"))};this.emit(this.onSubGift,p,h.get("msg-param-recipient-user-name"),T,l);break}case"submysterygift":{const g=h.get("login"),v=g==="ananonymousgifter",E={gifter:v?void 0:g,gifterUserId:v?void 0:h.get("user-id"),gifterDisplayName:v?void 0:h.get("display-name"),gifterGiftCount:v?void 0:Number(h.get("msg-param-sender-count")),count:Number(h.get("msg-param-mass-gift-count")),plan:h.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,p,h.get("login"),E,l);break}case"primepaidupgrade":{const g={userId:h.get("user-id"),displayName:h.get("display-name"),plan:h.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,p,h.get("login"),g,l);break}case"giftpaidupgrade":{const g={userId:h.get("user-id"),displayName:h.get("display-name"),gifter:h.get("msg-param-sender-login"),gifterDisplayName:h.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,p,h.get("login"),g,l);break}case"standardpayforward":{const g=h.get("msg-param-prior-gifter-anonymous")==="true",v={userId:h.get("user-id"),displayName:h.get("display-name"),originalGifterUserId:g?void 0:h.get("msg-param-prior-gifter-id"),originalGifterDisplayName:g?void 0:h.get("msg-param-prior-gifter-display-name"),recipientUserId:h.get("msg-param-recipient-id"),recipientDisplayName:h.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,p,h.get("login"),v,l);break}case"communitypayforward":{const g=h.get("msg-param-prior-gifter-anonymous")==="true",v={userId:h.get("user-id"),displayName:h.get("display-name"),originalGifterUserId:g?void 0:h.get("msg-param-prior-gifter-id"),originalGifterDisplayName:g?void 0:h.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,p,h.get("login"),v,l);break}case"primecommunitygiftreceived":{const g={name:h.get("msg-param-gift-name"),gifter:h.get("login"),gifterDisplayName:h.get("display-name")};this.emit(this.onPrimeCommunityGift,p,h.get("msg-param-recipient"),g,l);break}case"raid":{const g={displayName:h.get("msg-param-displayName"),viewerCount:Number(h.get("msg-param-viewerCount"))};this.emit(this.onRaid,p,h.get("login"),g,l);break}case"unraid":{this.emit(this.onRaidCancel,p,l);break}case"ritual":{const g={ritualName:h.get("msg-param-ritual-name"),message:d};this.emit(this.onRitual,p,h.get("login"),g,l);break}case"bitsbadgetier":{const g={displayName:h.get("display-name"),threshold:Number(h.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,p,h.get("login"),g,l);break}case"extendsub":{const g={userId:h.get("user-id"),displayName:h.get("display-name"),plan:h.get("msg-param-sub-plan"),months:Number(h.get("msg-param-cumulative-months")),endMonth:Number(h.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,p,h.get("login"),g,l);break}case"rewardgift":{const g={domain:h.get("msg-param-domain"),gifterId:h.get("user-id"),gifterDisplayName:h.get("display-name"),count:Number(h.get("msg-param-selected-count")),gifterGiftCount:Number(h.get("msg-param-total-reward-count")),triggerType:h.get("msg-param-trigger-type")};this.emit(this.onRewardGift,p,h.get("login"),g,l);break}case"announcement":{const g={color:h.get("msg-param-color")};this.emit(this.onAnnouncement,p,h.get("login"),g,l);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${f}`)}}),this._ircClient.onTypedMessage(T4,l=>{this.emit(this.onWhisper,l.prefix.nick,l.text,l)}),this._ircClient.onTypedMessage(Vk,async({target:l,text:u,tags:d})=>{const h=d.get("msg-id");switch(h){case"emote_only_on":{this.emit(this.onEmoteOnly,Ta(l),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,Ta(l),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,l,void 0,h);break}case"r9k_on":{this.emit(this.onUniqueChat,Ta(l),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,Ta(l),!1);break}case"subs_on":{this.emit(this.onSubsOnly,Ta(l),!0);break}case"subs_off":{this.emit(this.onSubsOnly,Ta(l),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,Ta(l),u);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,Ta(l),u);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,Ta(l),h);break}case void 0:{if(u==="Login authentication failed"||u==="Improperly formatted AUTH"||u==="Invalid NICK"){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=$Q(120),this._authRetryCount=0);const f=this._authRetryTimer.next().value,p=++this._authRetryCount;this.emit(this.onAuthenticationFailure,u,p),f!==0&&this._chatLogger.info(`Retrying authentication in ${f} seconds`),await qGe(f*1e3),this._ircClient.reconnect()}break}default:h.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${h}'`)}})}connect(){this._authProvider||this._ircClient.changeNick(IU._generateJustinfanNick()),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,n,r={},i){const s={};r.replyTo&&(s["reply-parent-msg-id"]=SWe(r.replyTo));const o=f6(n,500);await Promise.all(o.map(async a=>await this._messageRateLimiter.request({type:"say",channel:GC(e),text:a,tags:s},i)))}async action(e,n,r){const i=f6(n,490);await Promise.all(i.map(async s=>await this._messageRateLimiter.request({type:"action",channel:GC(e),text:s},r)))}async join(e){await this._joinRateLimiter.request(GC(e))}part(e){this._ircClient.part(GC(e))}quit(){this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,n;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!U1(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const r=this._getNecessaryScopes();let i,s=!1;for(const o of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(o,r),!this._authToken)continue;s=!0;const a=await eT(this._authToken.accessToken);if(!a.userName)throw new F1("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}catch(a){a instanceof sE?i=a:this._chatLogger.error(`Retrieving an access token failed: ${a.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await((n=(e=this._authProvider).refreshAccessTokenForIntent)===null||n===void 0?void 0:n.call(e,o)),this._authToken){const a=await eT(this._authToken.accessToken);if(!a.userName)throw new F1("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}}catch(a){a instanceof sE?i=a:this._chatLogger.error(`Refreshing the access token failed: ${a.message}`)}}throw this._authVerified=!1,i??new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof b_?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}};Rs([k_(!1)],pA.prototype,"_authProvider",void 0);pA=IU=Rs([yx("chat","ChatClient")],pA);let $f;const Bm=Wh("chat",[],t=>{if(Bm.session(t))switch(t.target){case"connect":he($f)?ci(Bm,"connection","chat is already connected"):Yn(t.data)&&(Ar(Bm,`connecting to ${t.data}`),$f=new pA({channels:[t.data]}),$f.connect(),$f.onConnect(()=>{Ar(Bm,"connected")}),$f.onDisconnect(()=>{Ar(Bm,"disconnected")}),$f.onMessage((e,n,r)=>{Xm(Bm,void 0,"text",`chat:message:${t.data}`,`${n}:${r}`,Ci())}),$f.onAction((e,n,r)=>{Xm(Bm,void 0,"text",`chat:action:${t.data}`,`${n}:${r}`,Ci())}));break;case"disconnect":he($f)?($f.quit(),$f=void 0,Ar(Bm,"client quit")):ci(Bm,"connection","chat is already disconnected");break}}),p6=Wh("gadgetclient",[],t=>{if(!p6.session(t))return;const{desync:e}=tg.getState();switch(t.target){case"paint":t.player===Ci()&&tg.setState({desync:!1,gadget:t.data});break;case"patch":t.player===Ci()&&!e&&tg.setState(n=>{let r;try{r=iF(t.data,n.gadget)}catch(s){r=s}if(he(r))return p6.replynext(t,"desync",void 0,t.player),{...n,desync:!0};const i=AA(n.gadget,t.data,!0,!1);return{...n,gadget:i.newDocument}});break}}),kee="0123456789abcdefABCDEF";kee.split("").map(t=>t.codePointAt(0));Array(256).fill(!0).map((t,e)=>{const n=String.fromCodePoint(e),r=kee.indexOf(n);return r<0?void 0:r<16?r:r-6});new TextEncoder;new TextDecoder;function _b(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;++r)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return t.length===e.length?0:t.length>e.length?1:-1}var TWe=(t,e,n=Math.min(t.length,e.length))=>{for(let r=0;r<n;r++){const i=t[r],s=e[r];if(i!==s)return 8*n-(r*8+Math.clz32(i^s)-24)}return 0},xWe=class{constructor(t,e){this.id=t,this.bucketSize=e.bucketSize||20,this.buckets=new Array(t.length*8+1).fill(void 0).map(()=>[]),this.compare=e.compare||(()=>0),this.getId=e.getId}get length(){return this.buckets.reduce((t,e)=>t+e.length,0)}*[Symbol.iterator](){for(const t of this.buckets)for(const e of t)yield e}add(t,e=this.getBitwiseDistance(this.getId(t))){if(this.has(this.getId(t),e))return!1;if(this.buckets[e].length<this.bucketSize)return this.buckets[e].push(t),!0;const n=this.buckets[e].slice(0);n.push(t);const r=n.sort(this.compare);this.buckets[e]=r.slice(0,this.bucketSize);const i=r.at(-1);return _b(this.getId(t),this.getId(i))!==0}clear(){for(let t=0;t<this.buckets.length;t++)this.buckets[t]=[]}listClosestToId(t,e=this.buckets.length*this.bucketSize){const n=this.getBitwiseDistance(t);return this.getNodes(n,e)}get(t){const e=this.buckets[t].shift();return e&&this.buckets[t].push(e),e}getById(t,e=this.getBitwiseDistance(t)){const n=this.buckets[e].findIndex(i=>_b(this.getId(i),t)===0);if(n===-1)return;const r=this.buckets[e][n];return this.buckets[e]=this.buckets[e].splice(n,1).concat(r),r}getBitwiseDistance(t){return TWe(this.id,t)}getNodes(t,e,n=0){const r=(n%2===0?1:-1)*Math.ceil(n/2);if(Math.abs(r)>Math.max(t,this.buckets.length-1-t))return[];const i=t+r;if(0>i||i>this.buckets.length-1)return this.getNodes(t,e,n+1);const s=this.buckets[i].slice(0,e);return s.length>=e?(this.buckets[i]=this.buckets[i].slice(s.length).concat(this.buckets[i].slice(0,s.length)),s):s.concat(this.getNodes(t,e-s.length,n+1))}has(t,e=this.getBitwiseDistance(t)){return!!this.buckets[e].find(n=>_b(this.getId(n),t)===0)}peek(t){return this.buckets[t].at(0)}peekById(t,e=this.getBitwiseDistance(t)){return this.buckets[e].find(n=>_b(this.getId(n),t)===0)}update(t,e=this.getBitwiseDistance(this.getId(t))){const n=this.buckets[e].findIndex(r=>_b(this.getId(r),this.getId(t))===0);return n===-1?!1:(this.buckets[e][n]=t,!0)}remove(t,e=this.getBitwiseDistance(t)){const n=this.buckets[e].findIndex(r=>_b(this.getId(r),t)===0);return n===-1?!1:(this.buckets[e].splice(n,1),!0)}},Nee={exports:{}};(function(t){var e=function(){function n(h,f){return f!=null&&h instanceof f}var r;try{r=Map}catch{r=function(){}}var i;try{i=Set}catch{i=function(){}}var s;try{s=Promise}catch{s=function(){}}function o(h,f,p,g,v){typeof f=="object"&&(p=f.depth,g=f.prototype,v=f.includeNonEnumerable,f=f.circular);var E=[],T=[],C=typeof Tc<"u";typeof f>"u"&&(f=!0),typeof p>"u"&&(p=1/0);function A(k,I){if(k===null)return null;if(I===0)return k;var N,U;if(typeof k!="object")return k;if(n(k,r))N=new r;else if(n(k,i))N=new i;else if(n(k,s))N=new s(function(ie,G){k.then(function(Z){ie(A(Z,I-1))},function(Z){G(A(Z,I-1))})});else if(o.__isArray(k))N=[];else if(o.__isRegExp(k))N=new RegExp(k.source,d(k)),k.lastIndex&&(N.lastIndex=k.lastIndex);else if(o.__isDate(k))N=new Date(k.getTime());else{if(C&&Tc.isBuffer(k))return Tc.allocUnsafe?N=Tc.allocUnsafe(k.length):N=new Tc(k.length),k.copy(N),N;n(k,Error)?N=Object.create(k):typeof g>"u"?(U=Object.getPrototypeOf(k),N=Object.create(U)):(N=Object.create(g),U=g)}if(f){var F=E.indexOf(k);if(F!=-1)return T[F];E.push(k),T.push(N)}n(k,r)&&k.forEach(function(ie,G){var Z=A(G,I-1),se=A(ie,I-1);N.set(Z,se)}),n(k,i)&&k.forEach(function(ie){var G=A(ie,I-1);N.add(G)});for(var $ in k){var X;U&&(X=Object.getOwnPropertyDescriptor(U,$)),!(X&&X.set==null)&&(N[$]=A(k[$],I-1))}if(Object.getOwnPropertySymbols)for(var q=Object.getOwnPropertySymbols(k),$=0;$<q.length;$++){var W=q[$],K=Object.getOwnPropertyDescriptor(k,W);K&&!K.enumerable&&!v||(N[W]=A(k[W],I-1),K.enumerable||Object.defineProperty(N,W,{enumerable:!1}))}if(v)for(var ne=Object.getOwnPropertyNames(k),$=0;$<ne.length;$++){var Q=ne[$],K=Object.getOwnPropertyDescriptor(k,Q);K&&K.enumerable||(N[Q]=A(k[Q],I-1),Object.defineProperty(N,Q,{enumerable:!1}))}return N}return A(h,p)}o.clonePrototype=function(f){if(f===null)return null;var p=function(){};return p.prototype=f,new p};function a(h){return Object.prototype.toString.call(h)}o.__objToStr=a;function c(h){return typeof h=="object"&&a(h)==="[object Date]"}o.__isDate=c;function l(h){return typeof h=="object"&&a(h)==="[object Array]"}o.__isArray=l;function u(h){return typeof h=="object"&&a(h)==="[object RegExp]"}o.__isRegExp=u;function d(h){var f="";return h.global&&(f+="g"),h.ignoreCase&&(f+="i"),h.multiline&&(f+="m"),f}return o.__getRegExpFlags=d,o}();t.exports&&(t.exports=e)})(Nee);var CWe=Nee.exports,OU={exports:{}},iD,m6;function RWe(){if(m6)return iD;m6=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,s=r*365.25;iD=function(u,d){d=d||{};var h=typeof u;if(h==="string"&&u.length>0)return o(u);if(h==="number"&&isFinite(u))return d.long?c(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var h=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*r;case"hours":case"hour":case"hrs":case"hr":case"h":return h*n;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=n?Math.round(u/n)+"h":d>=e?Math.round(u/e)+"m":d>=t?Math.round(u/t)+"s":u+"ms"}function c(u){var d=Math.abs(u);return d>=r?l(u,d,r,"day"):d>=n?l(u,d,n,"hour"):d>=e?l(u,d,e,"minute"):d>=t?l(u,d,t,"second"):u+" ms"}function l(u,d,h,f){var p=d>=h*1.5;return Math.round(u/h)+" "+f+(p?"s":"")}return iD}function AWe(t){n.debug=n,n.default=n,n.coerce=c,n.disable=s,n.enable=i,n.enabled=o,n.humanize=RWe(),n.destroy=l,Object.keys(t).forEach(u=>{n[u]=t[u]}),n.names=[],n.skips=[],n.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return n.colors[Math.abs(d)%n.colors.length]}n.selectColor=e;function n(u){let d,h=null,f,p;function g(...v){if(!g.enabled)return;const E=g,T=Number(new Date),C=T-(d||T);E.diff=C,E.prev=d,E.curr=T,d=T,v[0]=n.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let A=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(I,N)=>{if(I==="%%")return"%";A++;const U=n.formatters[N];if(typeof U=="function"){const F=v[A];I=U.call(E,F),v.splice(A,1),A--}return I}),n.formatArgs.call(E,v),(E.log||n.log).apply(E,v)}return g.namespace=u,g.useColors=n.useColors(),g.color=n.selectColor(u),g.extend=r,g.destroy=n.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(f!==n.namespaces&&(f=n.namespaces,p=n.enabled(u)),p),set:v=>{h=v}}),typeof n.init=="function"&&n.init(g),g}function r(u,d){const h=n(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function i(u){n.save(u),n.namespaces=u,n.names=[],n.skips=[];let d;const h=(typeof u=="string"?u:"").split(/[\s,]+/),f=h.length;for(d=0;d<f;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?n.skips.push(new RegExp("^"+u.slice(1)+"$")):n.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...n.names.map(a),...n.skips.map(a).map(d=>"-"+d)].join(",");return n.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=n.skips.length;d<h;d++)if(n.skips[d].test(u))return!1;for(d=0,h=n.names.length;d<h;d++)if(n.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var MWe=AWe;(function(t,e){var n={};e.formatArgs=i,e.save=s,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let d=0,h=0;l[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(d++,f==="%c"&&(h=d))}),l.splice(h,0,u)}e.log=console.debug||console.log||(()=>{});function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function o(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof Hn<"u"&&"env"in Hn&&(l=n.DEBUG),l}function a(){try{return localStorage}catch{}}t.exports=MWe(e);const{formatters:c}=t.exports;c.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(OU,OU.exports);var Gk=OU.exports,IWe=function(){if(typeof globalThis>"u")return null;var e={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null},kU={exports:{}},NU={exports:{}};const Ex=J6(D0e);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(t,e){var n=Ex,r=n.Buffer;function i(o,a){for(var c in o)a[c]=o[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(i(n,e),e.Buffer=s);function s(o,a,c){return r(o,a,c)}s.prototype=Object.create(r.prototype),i(r,s),s.from=function(o,a,c){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,c)},s.alloc=function(o,a,c){if(typeof o!="number")throw new TypeError("Argument must be a number");var l=r(o);return a!==void 0?typeof c=="string"?l.fill(a,c):l.fill(a):l.fill(0),l},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(o)}})(NU,NU.exports);var Pee=NU.exports,sD=65536,OWe=4294967295;function kWe(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var NWe=Pee.Buffer,mA=xc.crypto||xc.msCrypto;mA&&mA.getRandomValues?kU.exports=PWe:kU.exports=kWe;function PWe(t,e){if(t>OWe)throw new RangeError("requested too many random bytes");var n=NWe.allocUnsafe(t);if(t>0)if(t>sD)for(var r=0;r<t;r+=sD)mA.getRandomValues(n.slice(r,r+sD));else mA.getRandomValues(n);return typeof e=="function"?Hn.nextTick(function(){e(null,n)}):n}var qk=kU.exports,PU={exports:{}},C4={exports:{}},aE=typeof Reflect=="object"?Reflect:null,g6=aE&&typeof aE.apply=="function"?aE.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},$1;aE&&typeof aE.ownKeys=="function"?$1=aE.ownKeys:Object.getOwnPropertySymbols?$1=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:$1=function(e){return Object.getOwnPropertyNames(e)};function DWe(t){console&&console.warn&&console.warn(t)}var Dee=Number.isNaN||function(e){return e!==e};function rs(){rs.init.call(this)}C4.exports=rs;C4.exports.once=BWe;rs.EventEmitter=rs;rs.prototype._events=void 0;rs.prototype._eventsCount=0;rs.prototype._maxListeners=void 0;var v6=10;function Wk(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(rs,"defaultMaxListeners",{enumerable:!0,get:function(){return v6},set:function(t){if(typeof t!="number"||t<0||Dee(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");v6=t}});rs.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};rs.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Dee(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Lee(t){return t._maxListeners===void 0?rs.defaultMaxListeners:t._maxListeners}rs.prototype.getMaxListeners=function(){return Lee(this)};rs.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(n.length>0&&(o=n[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")g6(c,this,n);else for(var l=c.length,u=$ee(c,l),r=0;r<l;++r)g6(u[r],this,n);return!0};function Uee(t,e,n,r){var i,s,o;if(Wk(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]),o===void 0)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),i=Lee(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,DWe(a)}return t}rs.prototype.addListener=function(e,n){return Uee(this,e,n,!1)};rs.prototype.on=rs.prototype.addListener;rs.prototype.prependListener=function(e,n){return Uee(this,e,n,!0)};function LWe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Fee(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=LWe.bind(r);return i.listener=n,r.wrapFn=i,i}rs.prototype.once=function(e,n){return Wk(n),this.on(e,Fee(this,e,n)),this};rs.prototype.prependOnceListener=function(e,n){return Wk(n),this.prependListener(e,Fee(this,e,n)),this};rs.prototype.removeListener=function(e,n){var r,i,s,o,a;if(Wk(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length-1;o>=0;o--)if(r[o]===n||r[o].listener===n){a=r[o].listener,s=o;break}if(s<0)return this;s===0?r.shift():UWe(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||n)}return this};rs.prototype.off=rs.prototype.removeListener;rs.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function Bee(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?FWe(i):$ee(i,i.length)}rs.prototype.listeners=function(e){return Bee(this,e,!0)};rs.prototype.rawListeners=function(e){return Bee(this,e,!1)};rs.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):jee.call(t,e)};rs.prototype.listenerCount=jee;function jee(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}rs.prototype.eventNames=function(){return this._eventsCount>0?$1(this._events):[]};function $ee(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function UWe(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function FWe(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function BWe(t,e){return new Promise(function(n,r){function i(o){t.removeListener(e,s),r(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}Hee(t,e,s,{once:!0}),e!=="error"&&jWe(t,i,{once:!0})})}function jWe(t,e,n){typeof t.on=="function"&&Hee(t,"error",e,n)}function Hee(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Sx=C4.exports;const kKe=Yc(Sx);var Vee=Sx.EventEmitter,oD,_6;function $We(){if(_6)return oD;_6=1;function t(p,g){var v=Object.keys(p);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(p);g&&(E=E.filter(function(T){return Object.getOwnPropertyDescriptor(p,T).enumerable})),v.push.apply(v,E)}return v}function e(p){for(var g=1;g<arguments.length;g++){var v=arguments[g]!=null?arguments[g]:{};g%2?t(Object(v),!0).forEach(function(E){n(p,E,v[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(v)):t(Object(v)).forEach(function(E){Object.defineProperty(p,E,Object.getOwnPropertyDescriptor(v,E))})}return p}function n(p,g,v){return g=o(g),g in p?Object.defineProperty(p,g,{value:v,enumerable:!0,configurable:!0,writable:!0}):p[g]=v,p}function r(p,g){if(!(p instanceof g))throw new TypeError("Cannot call a class as a function")}function i(p,g){for(var v=0;v<g.length;v++){var E=g[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(p,o(E.key),E)}}function s(p,g,v){return g&&i(p.prototype,g),Object.defineProperty(p,"prototype",{writable:!1}),p}function o(p){var g=a(p,"string");return typeof g=="symbol"?g:String(g)}function a(p,g){if(typeof p!="object"||p===null)return p;var v=p[Symbol.toPrimitive];if(v!==void 0){var E=v.call(p,g||"default");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(p)}var c=Ex,l=c.Buffer,u=Z0,d=u.inspect,h=d&&d.custom||"inspect";function f(p,g,v){l.prototype.copy.call(p,g,v)}return oD=function(){function p(){r(this,p),this.head=null,this.tail=null,this.length=0}return s(p,[{key:"push",value:function(v){var E={data:v,next:null};this.length>0?this.tail.next=E:this.head=E,this.tail=E,++this.length}},{key:"unshift",value:function(v){var E={data:v,next:this.head};this.length===0&&(this.tail=E),this.head=E,++this.length}},{key:"shift",value:function(){if(this.length!==0){var v=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,v}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(v){if(this.length===0)return"";for(var E=this.head,T=""+E.data;E=E.next;)T+=v+E.data;return T}},{key:"concat",value:function(v){if(this.length===0)return l.alloc(0);for(var E=l.allocUnsafe(v>>>0),T=this.head,C=0;T;)f(T.data,E,C),C+=T.data.length,T=T.next;return E}},{key:"consume",value:function(v,E){var T;return v<this.head.data.length?(T=this.head.data.slice(0,v),this.head.data=this.head.data.slice(v)):v===this.head.data.length?T=this.shift():T=E?this._getString(v):this._getBuffer(v),T}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(v){var E=this.head,T=1,C=E.data;for(v-=C.length;E=E.next;){var A=E.data,k=v>A.length?A.length:v;if(k===A.length?C+=A:C+=A.slice(0,v),v-=k,v===0){k===A.length?(++T,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=A.slice(k));break}++T}return this.length-=T,C}},{key:"_getBuffer",value:function(v){var E=l.allocUnsafe(v),T=this.head,C=1;for(T.data.copy(E),v-=T.data.length;T=T.next;){var A=T.data,k=v>A.length?A.length:v;if(A.copy(E,E.length-v,0,k),v-=k,v===0){k===A.length?(++C,T.next?this.head=T.next:this.head=this.tail=null):(this.head=T,T.data=A.slice(k));break}++C}return this.length-=C,E}},{key:h,value:function(v,E){return d(this,e(e({},E),{},{depth:0,customInspect:!1}))}}]),p}(),oD}function HWe(t,e){var n=this,r=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return r||i?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Hn.nextTick(DU,this,t)):Hn.nextTick(DU,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(s){!e&&s?n._writableState?n._writableState.errorEmitted?Hn.nextTick(H1,n):(n._writableState.errorEmitted=!0,Hn.nextTick(y6,n,s)):Hn.nextTick(y6,n,s):e?(Hn.nextTick(H1,n),e(s)):Hn.nextTick(H1,n)}),this)}function y6(t,e){DU(t,e),H1(t)}function H1(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function VWe(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function DU(t,e){t.emit("error",e)}function zWe(t,e){var n=t._readableState,r=t._writableState;n&&n.autoDestroy||r&&r.autoDestroy?t.destroy(e):t.emit("error",e)}var zee={destroy:HWe,undestroy:VWe,errorOrDestroy:zWe},My={};function GWe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var Gee={};function Hd(t,e,n){n||(n=Error);function r(s,o,a){return typeof e=="string"?e:e(s,o,a)}var i=function(s){GWe(o,s);function o(a,c,l){return s.call(this,r(a,c,l))||this}return o}(n);i.prototype.name=n.name,i.prototype.code=t,Gee[t]=i}function b6(t,e){if(Array.isArray(t)){var n=t.length;return t=t.map(function(r){return String(r)}),n>2?"one of ".concat(e," ").concat(t.slice(0,n-1).join(", "),", or ")+t[n-1]:n===2?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}else return"of ".concat(e," ").concat(String(t))}function qWe(t,e,n){return t.substr(0,e.length)===e}function WWe(t,e,n){return(n===void 0||n>t.length)&&(n=t.length),t.substring(n-e.length,n)===e}function KWe(t,e,n){return typeof n!="number"&&(n=0),n+e.length>t.length?!1:t.indexOf(e,n)!==-1}Hd("ERR_INVALID_OPT_VALUE",function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'},TypeError);Hd("ERR_INVALID_ARG_TYPE",function(t,e,n){var r;typeof e=="string"&&qWe(e,"not ")?(r="must not be",e=e.replace(/^not /,"")):r="must be";var i;if(WWe(t," argument"))i="The ".concat(t," ").concat(r," ").concat(b6(e,"type"));else{var s=KWe(t,".")?"property":"argument";i='The "'.concat(t,'" ').concat(s," ").concat(r," ").concat(b6(e,"type"))}return i+=". Received type ".concat(typeof n),i},TypeError);Hd("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");Hd("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"});Hd("ERR_STREAM_PREMATURE_CLOSE","Premature close");Hd("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"});Hd("ERR_MULTIPLE_CALLBACK","Callback called multiple times");Hd("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");Hd("ERR_STREAM_WRITE_AFTER_END","write after end");Hd("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);Hd("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError);Hd("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");My.codes=Gee;var YWe=My.codes.ERR_INVALID_OPT_VALUE;function XWe(t,e,n){return t.highWaterMark!=null?t.highWaterMark:e?t[n]:null}function JWe(t,e,n,r){var i=XWe(e,r,n);if(i!=null){if(!(isFinite(i)&&Math.floor(i)===i)||i<0){var s=r?n:"highWaterMark";throw new YWe(s,i)}return Math.floor(i)}return t.objectMode?16:16*1024}var qee={getHighWaterMark:JWe},LU={exports:{}};typeof Object.create=="function"?LU.exports=function(e,n){n&&(e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:LU.exports=function(e,n){if(n){e.super_=n;var r=function(){};r.prototype=n.prototype,e.prototype=new r,e.prototype.constructor=e}};var wx=LU.exports,QWe=ZWe;function ZWe(t,e){if(aD("noDeprecation"))return t;var n=!1;function r(){if(!n){if(aD("throwDeprecation"))throw new Error(e);aD("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}return r}function aD(t){try{if(!xc.localStorage)return!1}catch{return!1}var e=xc.localStorage[t];return e==null?!1:String(e).toLowerCase()==="true"}var cD,E6;function Wee(){if(E6)return cD;E6=1,cD=U;function t(we){var Te=this;this.next=null,this.entry=null,this.finish=function(){Pe(Te,we)}}var e;U.WritableState=I;var n={deprecate:QWe},r=Vee,i=Ex.Buffer,s=(typeof xc<"u"?xc:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function o(we){return i.from(we)}function a(we){return i.isBuffer(we)||we instanceof s}var c=zee,l=qee,u=l.getHighWaterMark,d=My.codes,h=d.ERR_INVALID_ARG_TYPE,f=d.ERR_METHOD_NOT_IMPLEMENTED,p=d.ERR_MULTIPLE_CALLBACK,g=d.ERR_STREAM_CANNOT_PIPE,v=d.ERR_STREAM_DESTROYED,E=d.ERR_STREAM_NULL_VALUES,T=d.ERR_STREAM_WRITE_AFTER_END,C=d.ERR_UNKNOWN_ENCODING,A=c.errorOrDestroy;wx(U,r);function k(){}function I(we,Te,Oe){e=e||VE(),we=we||{},typeof Oe!="boolean"&&(Oe=Te instanceof e),this.objectMode=!!we.objectMode,Oe&&(this.objectMode=this.objectMode||!!we.writableObjectMode),this.highWaterMark=u(this,we,"writableHighWaterMark",Oe),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var _t=we.decodeStrings===!1;this.decodeStrings=!_t,this.defaultEncoding=we.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Ct){Q(Te,Ct)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=we.emitClose!==!1,this.autoDestroy=!!we.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new t(this)}I.prototype.getBuffer=function(){for(var Te=this.bufferedRequest,Oe=[];Te;)Oe.push(Te),Te=Te.next;return Oe},function(){try{Object.defineProperty(I.prototype,"buffer",{get:n.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var N;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(N=Function.prototype[Symbol.hasInstance],Object.defineProperty(U,Symbol.hasInstance,{value:function(Te){return N.call(this,Te)?!0:this!==U?!1:Te&&Te._writableState instanceof I}})):N=function(Te){return Te instanceof this};function U(we){e=e||VE();var Te=this instanceof e;if(!Te&&!N.call(U,this))return new U(we);this._writableState=new I(we,this,Te),this.writable=!0,we&&(typeof we.write=="function"&&(this._write=we.write),typeof we.writev=="function"&&(this._writev=we.writev),typeof we.destroy=="function"&&(this._destroy=we.destroy),typeof we.final=="function"&&(this._final=we.final)),r.call(this)}U.prototype.pipe=function(){A(this,new g)};function F(we,Te){var Oe=new T;A(we,Oe),Hn.nextTick(Te,Oe)}function $(we,Te,Oe,_t){var Ct;return Oe===null?Ct=new E:typeof Oe!="string"&&!Te.objectMode&&(Ct=new h("chunk",["string","Buffer"],Oe)),Ct?(A(we,Ct),Hn.nextTick(_t,Ct),!1):!0}U.prototype.write=function(we,Te,Oe){var _t=this._writableState,Ct=!1,me=!_t.objectMode&&a(we);return me&&!i.isBuffer(we)&&(we=o(we)),typeof Te=="function"&&(Oe=Te,Te=null),me?Te="buffer":Te||(Te=_t.defaultEncoding),typeof Oe!="function"&&(Oe=k),_t.ending?F(this,Oe):(me||$(this,_t,we,Oe))&&(_t.pendingcb++,Ct=q(this,_t,me,we,Te,Oe)),Ct},U.prototype.cork=function(){this._writableState.corked++},U.prototype.uncork=function(){var we=this._writableState;we.corked&&(we.corked--,!we.writing&&!we.corked&&!we.bufferProcessing&&we.bufferedRequest&&Z(this,we))},U.prototype.setDefaultEncoding=function(Te){if(typeof Te=="string"&&(Te=Te.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Te+"").toLowerCase())>-1))throw new C(Te);return this._writableState.defaultEncoding=Te,this},Object.defineProperty(U.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function X(we,Te,Oe){return!we.objectMode&&we.decodeStrings!==!1&&typeof Te=="string"&&(Te=i.from(Te,Oe)),Te}Object.defineProperty(U.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function q(we,Te,Oe,_t,Ct,me){if(!Oe){var ge=X(Te,_t,Ct);_t!==ge&&(Oe=!0,Ct="buffer",_t=ge)}var nt=Te.objectMode?1:_t.length;Te.length+=nt;var Ce=Te.length<Te.highWaterMark;if(Ce||(Te.needDrain=!0),Te.writing||Te.corked){var ut=Te.lastBufferedRequest;Te.lastBufferedRequest={chunk:_t,encoding:Ct,isBuf:Oe,callback:me,next:null},ut?ut.next=Te.lastBufferedRequest:Te.bufferedRequest=Te.lastBufferedRequest,Te.bufferedRequestCount+=1}else W(we,Te,!1,nt,_t,Ct,me);return Ce}function W(we,Te,Oe,_t,Ct,me,ge){Te.writelen=_t,Te.writecb=ge,Te.writing=!0,Te.sync=!0,Te.destroyed?Te.onwrite(new v("write")):Oe?we._writev(Ct,Te.onwrite):we._write(Ct,me,Te.onwrite),Te.sync=!1}function K(we,Te,Oe,_t,Ct){--Te.pendingcb,Oe?(Hn.nextTick(Ct,_t),Hn.nextTick(Be,we,Te),we._writableState.errorEmitted=!0,A(we,_t)):(Ct(_t),we._writableState.errorEmitted=!0,A(we,_t),Be(we,Te))}function ne(we){we.writing=!1,we.writecb=null,we.length-=we.writelen,we.writelen=0}function Q(we,Te){var Oe=we._writableState,_t=Oe.sync,Ct=Oe.writecb;if(typeof Ct!="function")throw new p;if(ne(Oe),Te)K(we,Oe,_t,Te,Ct);else{var me=se(Oe)||we.destroyed;!me&&!Oe.corked&&!Oe.bufferProcessing&&Oe.bufferedRequest&&Z(we,Oe),_t?Hn.nextTick(ie,we,Oe,me,Ct):ie(we,Oe,me,Ct)}}function ie(we,Te,Oe,_t){Oe||G(we,Te),Te.pendingcb--,_t(),Be(we,Te)}function G(we,Te){Te.length===0&&Te.needDrain&&(Te.needDrain=!1,we.emit("drain"))}function Z(we,Te){Te.bufferProcessing=!0;var Oe=Te.bufferedRequest;if(we._writev&&Oe&&Oe.next){var _t=Te.bufferedRequestCount,Ct=new Array(_t),me=Te.corkedRequestsFree;me.entry=Oe;for(var ge=0,nt=!0;Oe;)Ct[ge]=Oe,Oe.isBuf||(nt=!1),Oe=Oe.next,ge+=1;Ct.allBuffers=nt,W(we,Te,!0,Te.length,Ct,"",me.finish),Te.pendingcb++,Te.lastBufferedRequest=null,me.next?(Te.corkedRequestsFree=me.next,me.next=null):Te.corkedRequestsFree=new t(Te),Te.bufferedRequestCount=0}else{for(;Oe;){var Ce=Oe.chunk,ut=Oe.encoding,He=Oe.callback,Rt=Te.objectMode?1:Ce.length;if(W(we,Te,!1,Rt,Ce,ut,He),Oe=Oe.next,Te.bufferedRequestCount--,Te.writing)break}Oe===null&&(Te.lastBufferedRequest=null)}Te.bufferedRequest=Oe,Te.bufferProcessing=!1}U.prototype._write=function(we,Te,Oe){Oe(new f("_write()"))},U.prototype._writev=null,U.prototype.end=function(we,Te,Oe){var _t=this._writableState;return typeof we=="function"?(Oe=we,we=null,Te=null):typeof Te=="function"&&(Oe=Te,Te=null),we!=null&&this.write(we,Te),_t.corked&&(_t.corked=1,this.uncork()),_t.ending||Se(this,_t,Oe),this},Object.defineProperty(U.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function se(we){return we.ending&&we.length===0&&we.bufferedRequest===null&&!we.finished&&!we.writing}function ue(we,Te){we._final(function(Oe){Te.pendingcb--,Oe&&A(we,Oe),Te.prefinished=!0,we.emit("prefinish"),Be(we,Te)})}function Ae(we,Te){!Te.prefinished&&!Te.finalCalled&&(typeof we._final=="function"&&!Te.destroyed?(Te.pendingcb++,Te.finalCalled=!0,Hn.nextTick(ue,we,Te)):(Te.prefinished=!0,we.emit("prefinish")))}function Be(we,Te){var Oe=se(Te);if(Oe&&(Ae(we,Te),Te.pendingcb===0&&(Te.finished=!0,we.emit("finish"),Te.autoDestroy))){var _t=we._readableState;(!_t||_t.autoDestroy&&_t.endEmitted)&&we.destroy()}return Oe}function Se(we,Te,Oe){Te.ending=!0,Be(we,Te),Oe&&(Te.finished?Hn.nextTick(Oe):we.once("finish",Oe)),Te.ended=!0,we.writable=!1}function Pe(we,Te,Oe){var _t=we.entry;for(we.entry=null;_t;){var Ct=_t.callback;Te.pendingcb--,Ct(Oe),_t=_t.next}Te.corkedRequestsFree.next=we}return Object.defineProperty(U.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Te){this._writableState&&(this._writableState.destroyed=Te)}}),U.prototype.destroy=c.destroy,U.prototype._undestroy=c.undestroy,U.prototype._destroy=function(we,Te){Te(we)},cD}var lD,S6;function VE(){if(S6)return lD;S6=1;var t=Object.keys||function(l){var u=[];for(var d in l)u.push(d);return u};lD=o;var e=Yee(),n=Wee();wx(o,e);for(var r=t(n.prototype),i=0;i<r.length;i++){var s=r[i];o.prototype[s]||(o.prototype[s]=n.prototype[s])}function o(l){if(!(this instanceof o))return new o(l);e.call(this,l),n.call(this,l),this.allowHalfOpen=!0,l&&(l.readable===!1&&(this.readable=!1),l.writable===!1&&(this.writable=!1),l.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}Object.defineProperty(o.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(o.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(o.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function a(){this._writableState.ended||Hn.nextTick(c,this)}function c(l){l.end()}return Object.defineProperty(o.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(u){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=u,this._writableState.destroyed=u)}}),lD}var uD={},w6;function T6(){if(w6)return uD;w6=1;var t=Pee.Buffer,e=t.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(E){if(!E)return"utf8";for(var T;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(T)return;E=(""+E).toLowerCase(),T=!0}}function r(E){var T=n(E);if(typeof T!="string"&&(t.isEncoding===e||!e(E)))throw new Error("Unknown encoding: "+E);return T||E}uD.StringDecoder=i;function i(E){this.encoding=r(E);var T;switch(this.encoding){case"utf16le":this.text=d,this.end=h,T=4;break;case"utf8":this.fillLast=c,T=4;break;case"base64":this.text=f,this.end=p,T=3;break;default:this.write=g,this.end=v;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(T)}i.prototype.write=function(E){if(E.length===0)return"";var T,C;if(this.lastNeed){if(T=this.fillLast(E),T===void 0)return"";C=this.lastNeed,this.lastNeed=0}else C=0;return C<E.length?T?T+this.text(E,C):this.text(E,C):T||""},i.prototype.end=u,i.prototype.text=l,i.prototype.fillLast=function(E){if(this.lastNeed<=E.length)return E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),this.lastNeed-=E.length};function s(E){return E<=127?0:E>>5===6?2:E>>4===14?3:E>>3===30?4:E>>6===2?-1:-2}function o(E,T,C){var A=T.length-1;if(A<C)return 0;var k=s(T[A]);return k>=0?(k>0&&(E.lastNeed=k-1),k):--A<C||k===-2?0:(k=s(T[A]),k>=0?(k>0&&(E.lastNeed=k-2),k):--A<C||k===-2?0:(k=s(T[A]),k>=0?(k>0&&(k===2?k=0:E.lastNeed=k-3),k):0))}function a(E,T,C){if((T[0]&192)!==128)return E.lastNeed=0,"";if(E.lastNeed>1&&T.length>1){if((T[1]&192)!==128)return E.lastNeed=1,"";if(E.lastNeed>2&&T.length>2&&(T[2]&192)!==128)return E.lastNeed=2,""}}function c(E){var T=this.lastTotal-this.lastNeed,C=a(this,E);if(C!==void 0)return C;if(this.lastNeed<=E.length)return E.copy(this.lastChar,T,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,T,0,E.length),this.lastNeed-=E.length}function l(E,T){var C=o(this,E,T);if(!this.lastNeed)return E.toString("utf8",T);this.lastTotal=C;var A=E.length-(C-this.lastNeed);return E.copy(this.lastChar,0,A),E.toString("utf8",T,A)}function u(E){var T=E&&E.length?this.write(E):"";return this.lastNeed?T+"":T}function d(E,T){if((E.length-T)%2===0){var C=E.toString("utf16le",T);if(C){var A=C.charCodeAt(C.length-1);if(A>=55296&&A<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],C.slice(0,-1)}return C}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",T,E.length-1)}function h(E){var T=E&&E.length?this.write(E):"";if(this.lastNeed){var C=this.lastTotal-this.lastNeed;return T+this.lastChar.toString("utf16le",0,C)}return T}function f(E,T){var C=(E.length-T)%3;return C===0?E.toString("base64",T):(this.lastNeed=3-C,this.lastTotal=3,C===1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",T,E.length-C))}function p(E){var T=E&&E.length?this.write(E):"";return this.lastNeed?T+this.lastChar.toString("base64",0,3-this.lastNeed):T}function g(E){return E.toString(this.encoding)}function v(E){return E&&E.length?this.write(E):""}return uD}var x6=My.codes.ERR_STREAM_PREMATURE_CLOSE;function e9e(t){var e=!1;return function(){if(!e){e=!0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];t.apply(this,r)}}}function t9e(){}function n9e(t){return t.setHeader&&typeof t.abort=="function"}function Kee(t,e,n){if(typeof e=="function")return Kee(t,null,e);e||(e={}),n=e9e(n||t9e);var r=e.readable||e.readable!==!1&&t.readable,i=e.writable||e.writable!==!1&&t.writable,s=function(){t.writable||a()},o=t._writableState&&t._writableState.finished,a=function(){i=!1,o=!0,r||n.call(t)},c=t._readableState&&t._readableState.endEmitted,l=function(){r=!1,c=!0,i||n.call(t)},u=function(p){n.call(t,p)},d=function(){var p;if(r&&!c)return(!t._readableState||!t._readableState.ended)&&(p=new x6),n.call(t,p);if(i&&!o)return(!t._writableState||!t._writableState.ended)&&(p=new x6),n.call(t,p)},h=function(){t.req.on("finish",a)};return n9e(t)?(t.on("complete",a),t.on("abort",d),t.req?h():t.on("request",h)):i&&!t._writableState&&(t.on("end",s),t.on("close",s)),t.on("end",l),t.on("finish",a),e.error!==!1&&t.on("error",u),t.on("close",d),function(){t.removeListener("complete",a),t.removeListener("abort",d),t.removeListener("request",h),t.req&&t.req.removeListener("finish",a),t.removeListener("end",s),t.removeListener("close",s),t.removeListener("finish",a),t.removeListener("end",l),t.removeListener("error",u),t.removeListener("close",d)}}var R4=Kee,dD,C6;function r9e(){if(C6)return dD;C6=1;var t;function e(C,A,k){return A=n(A),A in C?Object.defineProperty(C,A,{value:k,enumerable:!0,configurable:!0,writable:!0}):C[A]=k,C}function n(C){var A=r(C,"string");return typeof A=="symbol"?A:String(A)}function r(C,A){if(typeof C!="object"||C===null)return C;var k=C[Symbol.toPrimitive];if(k!==void 0){var I=k.call(C,A||"default");if(typeof I!="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(C)}var i=R4,s=Symbol("lastResolve"),o=Symbol("lastReject"),a=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),u=Symbol("handlePromise"),d=Symbol("stream");function h(C,A){return{value:C,done:A}}function f(C){var A=C[s];if(A!==null){var k=C[d].read();k!==null&&(C[l]=null,C[s]=null,C[o]=null,A(h(k,!1)))}}function p(C){Hn.nextTick(f,C)}function g(C,A){return function(k,I){C.then(function(){if(A[c]){k(h(void 0,!0));return}A[u](k,I)},I)}}var v=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((t={get stream(){return this[d]},next:function(){var A=this,k=this[a];if(k!==null)return Promise.reject(k);if(this[c])return Promise.resolve(h(void 0,!0));if(this[d].destroyed)return new Promise(function(F,$){Hn.nextTick(function(){A[a]?$(A[a]):F(h(void 0,!0))})});var I=this[l],N;if(I)N=new Promise(g(I,this));else{var U=this[d].read();if(U!==null)return Promise.resolve(h(U,!1));N=new Promise(this[u])}return this[l]=N,N}},e(t,Symbol.asyncIterator,function(){return this}),e(t,"return",function(){var A=this;return new Promise(function(k,I){A[d].destroy(null,function(N){if(N){I(N);return}k(h(void 0,!0))})})}),t),v),T=function(A){var k,I=Object.create(E,(k={},e(k,d,{value:A,writable:!0}),e(k,s,{value:null,writable:!0}),e(k,o,{value:null,writable:!0}),e(k,a,{value:null,writable:!0}),e(k,c,{value:A._readableState.endEmitted,writable:!0}),e(k,u,{value:function(U,F){var $=I[d].read();$?(I[l]=null,I[s]=null,I[o]=null,U(h($,!1))):(I[s]=U,I[o]=F)},writable:!0}),k));return I[l]=null,i(A,function(N){if(N&&N.code!=="ERR_STREAM_PREMATURE_CLOSE"){var U=I[o];U!==null&&(I[l]=null,I[s]=null,I[o]=null,U(N)),I[a]=N;return}var F=I[s];F!==null&&(I[l]=null,I[s]=null,I[o]=null,F(h(void 0,!0))),I[c]=!0}),A.on("readable",p.bind(null,I)),I};return dD=T,dD}var hD,R6;function i9e(){return R6||(R6=1,hD=function(){throw new Error("Readable.from is not available in the browser")}),hD}var fD,A6;function Yee(){if(A6)return fD;A6=1,fD=F;var t;F.ReadableState=U,Sx.EventEmitter;var e=function(ge,nt){return ge.listeners(nt).length},n=Vee,r=Ex.Buffer,i=(typeof xc<"u"?xc:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(me){return r.from(me)}function o(me){return r.isBuffer(me)||me instanceof i}var a=Z0,c;a&&a.debuglog?c=a.debuglog("stream"):c=function(){};var l=$We(),u=zee,d=qee,h=d.getHighWaterMark,f=My.codes,p=f.ERR_INVALID_ARG_TYPE,g=f.ERR_STREAM_PUSH_AFTER_EOF,v=f.ERR_METHOD_NOT_IMPLEMENTED,E=f.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,T,C,A;wx(F,n);var k=u.errorOrDestroy,I=["error","close","destroy","pause","resume"];function N(me,ge,nt){if(typeof me.prependListener=="function")return me.prependListener(ge,nt);!me._events||!me._events[ge]?me.on(ge,nt):Array.isArray(me._events[ge])?me._events[ge].unshift(nt):me._events[ge]=[nt,me._events[ge]]}function U(me,ge,nt){t=t||VE(),me=me||{},typeof nt!="boolean"&&(nt=ge instanceof t),this.objectMode=!!me.objectMode,nt&&(this.objectMode=this.objectMode||!!me.readableObjectMode),this.highWaterMark=h(this,me,"readableHighWaterMark",nt),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=me.emitClose!==!1,this.autoDestroy=!!me.autoDestroy,this.destroyed=!1,this.defaultEncoding=me.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,me.encoding&&(T||(T=T6().StringDecoder),this.decoder=new T(me.encoding),this.encoding=me.encoding)}function F(me){if(t=t||VE(),!(this instanceof F))return new F(me);var ge=this instanceof t;this._readableState=new U(me,this,ge),this.readable=!0,me&&(typeof me.read=="function"&&(this._read=me.read),typeof me.destroy=="function"&&(this._destroy=me.destroy)),n.call(this)}Object.defineProperty(F.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(ge){this._readableState&&(this._readableState.destroyed=ge)}}),F.prototype.destroy=u.destroy,F.prototype._undestroy=u.undestroy,F.prototype._destroy=function(me,ge){ge(me)},F.prototype.push=function(me,ge){var nt=this._readableState,Ce;return nt.objectMode?Ce=!0:typeof me=="string"&&(ge=ge||nt.defaultEncoding,ge!==nt.encoding&&(me=r.from(me,ge),ge=""),Ce=!0),$(this,me,ge,!1,Ce)},F.prototype.unshift=function(me){return $(this,me,null,!0,!1)};function $(me,ge,nt,Ce,ut){c("readableAddChunk",ge);var He=me._readableState;if(ge===null)He.reading=!1,Q(me,He);else{var Rt;if(ut||(Rt=q(He,ge)),Rt)k(me,Rt);else if(He.objectMode||ge&&ge.length>0)if(typeof ge!="string"&&!He.objectMode&&Object.getPrototypeOf(ge)!==r.prototype&&(ge=s(ge)),Ce)He.endEmitted?k(me,new E):X(me,He,ge,!0);else if(He.ended)k(me,new g);else{if(He.destroyed)return!1;He.reading=!1,He.decoder&&!nt?(ge=He.decoder.write(ge),He.objectMode||ge.length!==0?X(me,He,ge,!1):Z(me,He)):X(me,He,ge,!1)}else Ce||(He.reading=!1,Z(me,He))}return!He.ended&&(He.length<He.highWaterMark||He.length===0)}function X(me,ge,nt,Ce){ge.flowing&&ge.length===0&&!ge.sync?(ge.awaitDrain=0,me.emit("data",nt)):(ge.length+=ge.objectMode?1:nt.length,Ce?ge.buffer.unshift(nt):ge.buffer.push(nt),ge.needReadable&&ie(me)),Z(me,ge)}function q(me,ge){var nt;return!o(ge)&&typeof ge!="string"&&ge!==void 0&&!me.objectMode&&(nt=new p("chunk",["string","Buffer","Uint8Array"],ge)),nt}F.prototype.isPaused=function(){return this._readableState.flowing===!1},F.prototype.setEncoding=function(me){T||(T=T6().StringDecoder);var ge=new T(me);this._readableState.decoder=ge,this._readableState.encoding=this._readableState.decoder.encoding;for(var nt=this._readableState.buffer.head,Ce="";nt!==null;)Ce+=ge.write(nt.data),nt=nt.next;return this._readableState.buffer.clear(),Ce!==""&&this._readableState.buffer.push(Ce),this._readableState.length=Ce.length,this};var W=1073741824;function K(me){return me>=W?me=W:(me--,me|=me>>>1,me|=me>>>2,me|=me>>>4,me|=me>>>8,me|=me>>>16,me++),me}function ne(me,ge){return me<=0||ge.length===0&&ge.ended?0:ge.objectMode?1:me!==me?ge.flowing&&ge.length?ge.buffer.head.data.length:ge.length:(me>ge.highWaterMark&&(ge.highWaterMark=K(me)),me<=ge.length?me:ge.ended?ge.length:(ge.needReadable=!0,0))}F.prototype.read=function(me){c("read",me),me=parseInt(me,10);var ge=this._readableState,nt=me;if(me!==0&&(ge.emittedReadable=!1),me===0&&ge.needReadable&&((ge.highWaterMark!==0?ge.length>=ge.highWaterMark:ge.length>0)||ge.ended))return c("read: emitReadable",ge.length,ge.ended),ge.length===0&&ge.ended?Oe(this):ie(this),null;if(me=ne(me,ge),me===0&&ge.ended)return ge.length===0&&Oe(this),null;var Ce=ge.needReadable;c("need readable",Ce),(ge.length===0||ge.length-me<ge.highWaterMark)&&(Ce=!0,c("length less than watermark",Ce)),ge.ended||ge.reading?(Ce=!1,c("reading or ended",Ce)):Ce&&(c("do read"),ge.reading=!0,ge.sync=!0,ge.length===0&&(ge.needReadable=!0),this._read(ge.highWaterMark),ge.sync=!1,ge.reading||(me=ne(nt,ge)));var ut;return me>0?ut=Te(me,ge):ut=null,ut===null?(ge.needReadable=ge.length<=ge.highWaterMark,me=0):(ge.length-=me,ge.awaitDrain=0),ge.length===0&&(ge.ended||(ge.needReadable=!0),nt!==me&&ge.ended&&Oe(this)),ut!==null&&this.emit("data",ut),ut};function Q(me,ge){if(c("onEofChunk"),!ge.ended){if(ge.decoder){var nt=ge.decoder.end();nt&&nt.length&&(ge.buffer.push(nt),ge.length+=ge.objectMode?1:nt.length)}ge.ended=!0,ge.sync?ie(me):(ge.needReadable=!1,ge.emittedReadable||(ge.emittedReadable=!0,G(me)))}}function ie(me){var ge=me._readableState;c("emitReadable",ge.needReadable,ge.emittedReadable),ge.needReadable=!1,ge.emittedReadable||(c("emitReadable",ge.flowing),ge.emittedReadable=!0,Hn.nextTick(G,me))}function G(me){var ge=me._readableState;c("emitReadable_",ge.destroyed,ge.length,ge.ended),!ge.destroyed&&(ge.length||ge.ended)&&(me.emit("readable"),ge.emittedReadable=!1),ge.needReadable=!ge.flowing&&!ge.ended&&ge.length<=ge.highWaterMark,we(me)}function Z(me,ge){ge.readingMore||(ge.readingMore=!0,Hn.nextTick(se,me,ge))}function se(me,ge){for(;!ge.reading&&!ge.ended&&(ge.length<ge.highWaterMark||ge.flowing&&ge.length===0);){var nt=ge.length;if(c("maybeReadMore read 0"),me.read(0),nt===ge.length)break}ge.readingMore=!1}F.prototype._read=function(me){k(this,new v("_read()"))},F.prototype.pipe=function(me,ge){var nt=this,Ce=this._readableState;switch(Ce.pipesCount){case 0:Ce.pipes=me;break;case 1:Ce.pipes=[Ce.pipes,me];break;default:Ce.pipes.push(me);break}Ce.pipesCount+=1,c("pipe count=%d opts=%j",Ce.pipesCount,ge);var ut=(!ge||ge.end!==!1)&&me!==Hn.stdout&&me!==Hn.stderr,He=ut?$t:Fe;Ce.endEmitted?Hn.nextTick(He):nt.once("end",He),me.on("unpipe",Rt);function Rt(Ht,St){c("onunpipe"),Ht===nt&&St&&St.hasUnpiped===!1&&(St.hasUnpiped=!0,Ee())}function $t(){c("onend"),me.end()}var Tt=ue(nt);me.on("drain",Tt);var Ft=!1;function Ee(){c("cleanup"),me.removeListener("close",it),me.removeListener("finish",je),me.removeListener("drain",Tt),me.removeListener("error",We),me.removeListener("unpipe",Rt),nt.removeListener("end",$t),nt.removeListener("end",Fe),nt.removeListener("data",le),Ft=!0,Ce.awaitDrain&&(!me._writableState||me._writableState.needDrain)&&Tt()}nt.on("data",le);function le(Ht){c("ondata");var St=me.write(Ht);c("dest.write",St),St===!1&&((Ce.pipesCount===1&&Ce.pipes===me||Ce.pipesCount>1&&Ct(Ce.pipes,me)!==-1)&&!Ft&&(c("false write response, pause",Ce.awaitDrain),Ce.awaitDrain++),nt.pause())}function We(Ht){c("onerror",Ht),Fe(),me.removeListener("error",We),e(me,"error")===0&&k(me,Ht)}N(me,"error",We);function it(){me.removeListener("finish",je),Fe()}me.once("close",it);function je(){c("onfinish"),me.removeListener("close",it),Fe()}me.once("finish",je);function Fe(){c("unpipe"),nt.unpipe(me)}return me.emit("pipe",nt),Ce.flowing||(c("pipe resume"),nt.resume()),me};function ue(me){return function(){var nt=me._readableState;c("pipeOnDrain",nt.awaitDrain),nt.awaitDrain&&nt.awaitDrain--,nt.awaitDrain===0&&e(me,"data")&&(nt.flowing=!0,we(me))}}F.prototype.unpipe=function(me){var ge=this._readableState,nt={hasUnpiped:!1};if(ge.pipesCount===0)return this;if(ge.pipesCount===1)return me&&me!==ge.pipes?this:(me||(me=ge.pipes),ge.pipes=null,ge.pipesCount=0,ge.flowing=!1,me&&me.emit("unpipe",this,nt),this);if(!me){var Ce=ge.pipes,ut=ge.pipesCount;ge.pipes=null,ge.pipesCount=0,ge.flowing=!1;for(var He=0;He<ut;He++)Ce[He].emit("unpipe",this,{hasUnpiped:!1});return this}var Rt=Ct(ge.pipes,me);return Rt===-1?this:(ge.pipes.splice(Rt,1),ge.pipesCount-=1,ge.pipesCount===1&&(ge.pipes=ge.pipes[0]),me.emit("unpipe",this,nt),this)},F.prototype.on=function(me,ge){var nt=n.prototype.on.call(this,me,ge),Ce=this._readableState;return me==="data"?(Ce.readableListening=this.listenerCount("readable")>0,Ce.flowing!==!1&&this.resume()):me==="readable"&&!Ce.endEmitted&&!Ce.readableListening&&(Ce.readableListening=Ce.needReadable=!0,Ce.flowing=!1,Ce.emittedReadable=!1,c("on readable",Ce.length,Ce.reading),Ce.length?ie(this):Ce.reading||Hn.nextTick(Be,this)),nt},F.prototype.addListener=F.prototype.on,F.prototype.removeListener=function(me,ge){var nt=n.prototype.removeListener.call(this,me,ge);return me==="readable"&&Hn.nextTick(Ae,this),nt},F.prototype.removeAllListeners=function(me){var ge=n.prototype.removeAllListeners.apply(this,arguments);return(me==="readable"||me===void 0)&&Hn.nextTick(Ae,this),ge};function Ae(me){var ge=me._readableState;ge.readableListening=me.listenerCount("readable")>0,ge.resumeScheduled&&!ge.paused?ge.flowing=!0:me.listenerCount("data")>0&&me.resume()}function Be(me){c("readable nexttick read 0"),me.read(0)}F.prototype.resume=function(){var me=this._readableState;return me.flowing||(c("resume"),me.flowing=!me.readableListening,Se(this,me)),me.paused=!1,this};function Se(me,ge){ge.resumeScheduled||(ge.resumeScheduled=!0,Hn.nextTick(Pe,me,ge))}function Pe(me,ge){c("resume",ge.reading),ge.reading||me.read(0),ge.resumeScheduled=!1,me.emit("resume"),we(me),ge.flowing&&!ge.reading&&me.read(0)}F.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function we(me){var ge=me._readableState;for(c("flow",ge.flowing);ge.flowing&&me.read()!==null;);}F.prototype.wrap=function(me){var ge=this,nt=this._readableState,Ce=!1;me.on("end",function(){if(c("wrapped end"),nt.decoder&&!nt.ended){var Rt=nt.decoder.end();Rt&&Rt.length&&ge.push(Rt)}ge.push(null)}),me.on("data",function(Rt){if(c("wrapped data"),nt.decoder&&(Rt=nt.decoder.write(Rt)),!(nt.objectMode&&Rt==null)&&!(!nt.objectMode&&(!Rt||!Rt.length))){var $t=ge.push(Rt);$t||(Ce=!0,me.pause())}});for(var ut in me)this[ut]===void 0&&typeof me[ut]=="function"&&(this[ut]=function($t){return function(){return me[$t].apply(me,arguments)}}(ut));for(var He=0;He<I.length;He++)me.on(I[He],this.emit.bind(this,I[He]));return this._read=function(Rt){c("wrapped _read",Rt),Ce&&(Ce=!1,me.resume())},this},typeof Symbol=="function"&&(F.prototype[Symbol.asyncIterator]=function(){return C===void 0&&(C=r9e()),C(this)}),Object.defineProperty(F.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(F.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(F.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(ge){this._readableState&&(this._readableState.flowing=ge)}}),F._fromList=Te,Object.defineProperty(F.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Te(me,ge){if(ge.length===0)return null;var nt;return ge.objectMode?nt=ge.buffer.shift():!me||me>=ge.length?(ge.decoder?nt=ge.buffer.join(""):ge.buffer.length===1?nt=ge.buffer.first():nt=ge.buffer.concat(ge.length),ge.buffer.clear()):nt=ge.buffer.consume(me,ge.decoder),nt}function Oe(me){var ge=me._readableState;c("endReadable",ge.endEmitted),ge.endEmitted||(ge.ended=!0,Hn.nextTick(_t,ge,me))}function _t(me,ge){if(c("endReadableNT",me.endEmitted,me.length),!me.endEmitted&&me.length===0&&(me.endEmitted=!0,ge.readable=!1,ge.emit("end"),me.autoDestroy)){var nt=ge._writableState;(!nt||nt.autoDestroy&&nt.finished)&&ge.destroy()}}typeof Symbol=="function"&&(F.from=function(me,ge){return A===void 0&&(A=i9e()),A(F,me,ge)});function Ct(me,ge){for(var nt=0,Ce=me.length;nt<Ce;nt++)if(me[nt]===ge)return nt;return-1}return fD}var Xee=ug,Kk=My.codes,s9e=Kk.ERR_METHOD_NOT_IMPLEMENTED,o9e=Kk.ERR_MULTIPLE_CALLBACK,a9e=Kk.ERR_TRANSFORM_ALREADY_TRANSFORMING,c9e=Kk.ERR_TRANSFORM_WITH_LENGTH_0,Yk=VE();wx(ug,Yk);function l9e(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(r===null)return this.emit("error",new o9e);n.writechunk=null,n.writecb=null,e!=null&&this.push(e),r(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function ug(t){if(!(this instanceof ug))return new ug(t);Yk.call(this,t),this._transformState={afterTransform:l9e.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(typeof t.transform=="function"&&(this._transform=t.transform),typeof t.flush=="function"&&(this._flush=t.flush)),this.on("prefinish",u9e)}function u9e(){var t=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,n){M6(t,e,n)}):M6(this,null,null)}ug.prototype.push=function(t,e){return this._transformState.needTransform=!1,Yk.prototype.push.call(this,t,e)};ug.prototype._transform=function(t,e,n){n(new s9e("_transform()"))};ug.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}};ug.prototype._read=function(t){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};ug.prototype._destroy=function(t,e){Yk.prototype._destroy.call(this,t,function(n){e(n)})};function M6(t,e,n){if(e)return t.emit("error",e);if(n!=null&&t.push(n),t._writableState.length)throw new c9e;if(t._transformState.transforming)throw new a9e;return t.push(null)}var d9e=iT,Jee=Xee;wx(iT,Jee);function iT(t){if(!(this instanceof iT))return new iT(t);Jee.call(this,t)}iT.prototype._transform=function(t,e,n){n(null,t)};var pD;function h9e(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}var Qee=My.codes,f9e=Qee.ERR_MISSING_ARGS,p9e=Qee.ERR_STREAM_DESTROYED;function I6(t){if(t)throw t}function m9e(t){return t.setHeader&&typeof t.abort=="function"}function g9e(t,e,n,r){r=h9e(r);var i=!1;t.on("close",function(){i=!0}),pD===void 0&&(pD=R4),pD(t,{readable:e,writable:n},function(o){if(o)return r(o);i=!0,r()});var s=!1;return function(o){if(!i&&!s){if(s=!0,m9e(t))return t.abort();if(typeof t.destroy=="function")return t.destroy();r(o||new p9e("pipe"))}}}function O6(t){t()}function v9e(t,e){return t.pipe(e)}function _9e(t){return!t.length||typeof t[t.length-1]!="function"?I6:t.pop()}function y9e(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=_9e(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new f9e("streams");var i,s=e.map(function(o,a){var c=a<e.length-1,l=a>0;return g9e(o,c,l,function(u){i||(i=u),u&&s.forEach(O6),!c&&(s.forEach(O6),r(i))})});return e.reduce(v9e)}var b9e=y9e;(function(t,e){e=t.exports=Yee(),e.Stream=e,e.Readable=e,e.Writable=Wee(),e.Duplex=VE(),e.Transform=Xee,e.PassThrough=d9e,e.finished=R4,e.pipeline=b9e})(PU,PU.exports);var Zee=PU.exports;/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let k6;var ete=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:xc):t=>(k6||(k6=Promise.resolve())).then(t).catch(e=>setTimeout(()=>{throw e},0));function N6(t,e){for(const n in e)Object.defineProperty(t,n,{value:e[n],enumerable:!0,configurable:!0});return t}function E9e(t,e,n){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");n||(n={}),typeof e=="object"&&(n=e,e=""),e&&(n.code=e);try{return N6(t,n)}catch{n.message=t.message,n.stack=t.stack;const i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(t)),N6(new i,n)}}var S9e=E9e;/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const w9e=Gk("simple-peer"),tte=IWe,P6=qk,T9e=Zee,mD=ete,vi=S9e,{Buffer:x9e}=Ex,gD=64*1024,C9e=5*1e3,R9e=5*1e3;function D6(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}function A9e(t){console.warn(t)}let Xk=class UU extends T9e.Duplex{constructor(e){if(e=Object.assign({allowHalfOpen:!1},e),super(e),this._id=P6(4).toString("hex").slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||P6(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||UU.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},UU.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(n=>n),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||C9e,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:tte(),!this._wrtc)throw vi(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(n){this.destroy(vi(n,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=n=>{this._onIceCandidate(n)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(n=>{this.destroy(vi(n,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=n=>{this._setupData(n)},this.streams&&this.streams.forEach(n=>{this.addStream(n)}),this._pc.ontrack=n=>{this._onTrack(n)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw vi(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(n=>{this._addIceCandidate(n)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(n=>{this.destroy(vi(n,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(vi(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const n=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(n).catch(r=>{!n.address||n.address.endsWith(".local")?A9e("Ignoring unsupported ICE candidate."):this.destroy(vi(r,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw vi(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,n){if(!this.destroying){if(this.destroyed)throw vi(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,n),this._needsNegotiation()}catch(r){this.destroy(vi(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:n}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw vi(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(n=>{this.addTrack(n,e)})}}addTrack(e,n){if(this.destroying)return;if(this.destroyed)throw vi(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(e)||new Map;let i=r.get(n);if(!i)i=this._pc.addTrack(e,n),r.set(n,i),this._senderMap.set(e,r),this._needsNegotiation();else throw i.removed?vi(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):vi(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,n,r){if(this.destroying)return;if(this.destroyed)throw vi(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const i=this._senderMap.get(e),s=i?i.get(r):null;if(!s)throw vi(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");n&&this._senderMap.set(n,i),s.replaceTrack!=null?s.replaceTrack(n):this.destroy(vi(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,n){if(this.destroying)return;if(this.destroyed)throw vi(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(e),i=r?r.get(n):null;if(!i)throw vi(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{i.removed=!0,this._pc.removeTrack(i)}catch(s){s.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(i):this.destroy(vi(s,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw vi(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(n=>{this.removeTrack(n,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,mD(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw vi(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this._destroy(e,()=>{})}_destroy(e,n){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),mD(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),n()}))}_setupData(e){if(!e.channel)return this.destroy(vi(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=gD),this.channelName=this._channel.label,this._channel.onmessage=r=>{this._onChannelMessage(r)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=r=>{const i=r.error instanceof Error?r.error:new Error(`Datachannel error: ${r.message} ${r.filename}:${r.lineno}:${r.colno}`);this.destroy(vi(i,"ERR_DATA_CHANNEL"))};let n=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(n&&this._onChannelClose(),n=!0):n=!1},R9e)}_read(){}_write(e,n,r){if(this.destroyed)return r(vi(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(i){return this.destroy(vi(i,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>gD?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_onFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?e():this.once("connect",e)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=D6(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp})},r=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},i=s=>{this.destroy(vi(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(vi(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=D6(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const n=()=>{if(this.destroyed)return;const s=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:s.type,sdp:s.sdp}),this.initiator||this._requestMissingTransceivers()},r=()=>{this.destroyed||(this.trickle||this._iceComplete?n():this.once("_iceComplete",n))},i=s=>{this.destroy(vi(s,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(r).catch(i)}).catch(e=>{this.destroy(vi(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(vi(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,n=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,n),this.emit("iceStateChange",e,n),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(vi(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(vi(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const n=r=>(Object.prototype.toString.call(r.values)==="[object Array]"&&r.values.forEach(i=>{Object.assign(r,i)}),r);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(r=>{const i=[];r.forEach(s=>{i.push(n(s))}),e(null,i)},r=>e(r)):this._pc.getStats.length>0?this._pc.getStats(r=>{if(this.destroyed)return;const i=[];r.result().forEach(s=>{const o={};s.names().forEach(a=>{o[a]=s.stat(a)}),o.id=s.id,o.type=s.type,o.timestamp=s.timestamp,i.push(n(o))}),e(null,i)},r=>e(r)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((n,r)=>{if(this.destroyed)return;n&&(r=[]);const i={},s={},o={};let a=!1;r.forEach(l=>{(l.type==="remotecandidate"||l.type==="remote-candidate")&&(i[l.id]=l),(l.type==="localcandidate"||l.type==="local-candidate")&&(s[l.id]=l),(l.type==="candidatepair"||l.type==="candidate-pair")&&(o[l.id]=l)});const c=l=>{a=!0;let u=s[l.localCandidateId];u&&(u.ip||u.address)?(this.localAddress=u.ip||u.address,this.localPort=Number(u.port)):u&&u.ipAddress?(this.localAddress=u.ipAddress,this.localPort=Number(u.portNumber)):typeof l.googLocalAddress=="string"&&(u=l.googLocalAddress.split(":"),this.localAddress=u[0],this.localPort=Number(u[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let d=i[l.remoteCandidateId];d&&(d.ip||d.address)?(this.remoteAddress=d.ip||d.address,this.remotePort=Number(d.port)):d&&d.ipAddress?(this.remoteAddress=d.ipAddress,this.remotePort=Number(d.portNumber)):typeof l.googRemoteAddress=="string"&&(d=l.googRemoteAddress.split(":"),this.remoteAddress=d[0],this.remotePort=Number(d[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach(l=>{l.type==="transport"&&l.selectedCandidatePairId&&c(o[l.selectedCandidatePairId]),(l.type==="googCandidatePair"&&l.googActiveConnection==="true"||(l.type==="candidatepair"||l.type==="candidate-pair")&&l.selected)&&c(l)}),!a&&(!Object.keys(o).length||Object.keys(s).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(u){return this.destroy(vi(u,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const l=this._cb;this._cb=null,l(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>gD||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let n=e.data;n instanceof ArrayBuffer&&(n=x9e.from(n)),this.push(n)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(n=>{this._debug("on track"),this.emit("track",e.track,n),this._remoteTracks.push({track:e.track,stream:n}),!this._remoteStreams.some(r=>r.id===n.id)&&(this._remoteStreams.push(n),mD(()=>{this._debug("on stream"),this.emit("stream",n)}))})}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],w9e.apply(null,e)}};Xk.WEBRTC_SUPPORT=!!tte();Xk.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};Xk.channelConfig={};var M9e=Xk;const I9e=Gk("simple-websocket"),O9e=qk,k9e=Zee,L6=ete,dw=Z0,XS=typeof dw!="function"?WebSocket:dw,U6=64*1024;let nte=class extends k9e.Duplex{constructor(e={}){if(typeof e=="string"&&(e={url:e}),e=Object.assign({allowHalfOpen:!1},e),super(e),e.url==null&&e.socket==null)throw new Error("Missing required `url` or `socket` option");if(e.url!=null&&e.socket!=null)throw new Error("Must specify either `url` or `socket` option, not both");if(this._id=O9e(4).toString("hex").slice(0,7),this._debug("new websocket: %o",e),this.connected=!1,this.destroyed=!1,this._chunk=null,this._cb=null,this._interval=null,e.socket)this.url=e.socket.url,this._ws=e.socket,this.connected=e.socket.readyState===XS.OPEN;else{this.url=e.url;try{typeof dw=="function"?this._ws=new XS(e.url,null,{...e,encoding:void 0}):this._ws=new XS(e.url)}catch(n){L6(()=>this.destroy(n));return}}this._ws.binaryType="arraybuffer",e.socket&&this.connected?L6(()=>this._handleOpen()):this._ws.onopen=()=>this._handleOpen(),this._ws.onmessage=n=>this._handleMessage(n),this._ws.onclose=()=>this._handleClose(),this._ws.onerror=n=>this._handleError(n),this._handleFinishBound=()=>this._handleFinish(),this.once("finish",this._handleFinishBound)}send(e){this._ws.send(e)}destroy(e){this._destroy(e,()=>{})}_destroy(e,n){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.connected=!1,this.destroyed=!0,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._handleFinishBound&&this.removeListener("finish",this._handleFinishBound),this._handleFinishBound=null,this._ws){const r=this._ws,i=()=>{r.onclose=null};if(r.readyState===XS.CLOSED)i();else try{r.onclose=i,r.close()}catch{i()}r.onopen=null,r.onmessage=null,r.onerror=()=>{}}this._ws=null,e&&this.emit("error",e),this.emit("close"),n()}}_read(){}_write(e,n,r){if(this.destroyed)return r(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(i){return this.destroy(i)}typeof dw!="function"&&this._ws.bufferedAmount>U6?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}_handleOpen(){if(!(this.connected||this.destroyed)){if(this.connected=!0,this._chunk){try{this.send(this._chunk)}catch(n){return this.destroy(n)}this._chunk=null,this._debug('sent chunk from "write before connect"');const e=this._cb;this._cb=null,e(null)}typeof dw!="function"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}}_handleMessage(e){if(this.destroyed)return;let n=e.data;n instanceof ArrayBuffer&&(n=Tc.from(n)),this.push(n)}_handleClose(){this.destroyed||(this._debug("on close"),this.destroy())}_handleError(e){this.destroy(new Error(`Error connecting to ${this.url}`))}_handleFinish(){if(this.destroyed)return;const e=()=>{setTimeout(()=>this.destroy(),1e3)};this.connected?e():this.once("connect",e)}_onInterval(){if(!this._cb||!this._ws||this._ws.bufferedAmount>U6)return;this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_debug(){const e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],I9e.apply(null,e)}};nte.WEBSOCKET_SUPPORT=!!XS;var N9e=nte,rte={};(function(t){t.DEFAULT_ANNOUNCE_PEERS=50,t.MAX_ANNOUNCE_PEERS=82,t.binaryToHex=n=>(typeof n!="string"&&(n=String(n)),Tc.from(n,"binary").toString("hex")),t.hexToBinary=n=>(typeof n!="string"&&(n=String(n)),Tc.from(n,"hex").toString("binary")),t.parseUrl=n=>{const r=new URL(n.replace(/^udp:/,"http:"));return n.match(/^udp:/)&&Object.defineProperties(r,{href:{value:r.href.replace(/^http/,"udp")},protocol:{value:r.protocol.replace(/^http/,"udp")},origin:{value:r.origin.replace(/^http/,"udp")}}),r},Object.assign(t,Z0)})(rte);const P9e=Sx;let D9e=class extends P9e{constructor(e,n){super(),this.client=e,this.announceUrl=n,this.interval=null,this.destroyed=!1}setInterval(e){e==null&&(e=this.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(this.interval),e&&(this.interval=setInterval(()=>{this.announce(this.client._defaultAnnounceOpts())},e),this.interval.unref&&this.interval.unref())}};var L9e=D9e;const U9e=CWe,yh=Gk("bittorrent-tracker:websocket-tracker"),F9e=M9e,B9e=qk,j9e=N9e,$9e=Z0,wv=rte,H9e=L9e,jm={},V9e=10*1e3,z9e=60*60*1e3,G9e=5*60*1e3,q9e=50*1e3;let A4=class extends H9e{constructor(e,n){super(e,n),yh("new websocket tracker %s",n),this.peers={},this.socket=null,this.reconnecting=!1,this.retries=0,this.reconnectTimer=null,this.expectingResponse=!1,this._openSocket()}announce(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.announce(e)});return}const n=Object.assign({},e,{action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary});if(this._trackerId&&(n.trackerid=this._trackerId),e.event==="stopped"||e.event==="completed")this._send(n);else{const r=Math.min(e.numwant,5);this._generateOffers(r,i=>{n.numwant=r,n.offers=i,this._send(n)})}}scrape(e){if(this.destroyed||this.reconnecting)return;if(!this.socket.connected){this.socket.once("connect",()=>{this.scrape(e)});return}const r={action:"scrape",info_hash:Array.isArray(e.infoHash)&&e.infoHash.length>0?e.infoHash.map(i=>i.toString("binary")):e.infoHash&&e.infoHash.toString("binary")||this.client._infoHashBinary};this._send(r)}destroy(e=F6){if(this.destroyed)return e(null);this.destroyed=!0,clearInterval(this.interval),clearTimeout(this.reconnectTimer);for(const s in this.peers){const o=this.peers[s];clearTimeout(o.trackerTimeout),o.destroy()}if(this.peers=null,this.socket&&(this.socket.removeListener("connect",this._onSocketConnectBound),this.socket.removeListener("data",this._onSocketDataBound),this.socket.removeListener("close",this._onSocketCloseBound),this.socket.removeListener("error",this._onSocketErrorBound),this.socket=null),this._onSocketConnectBound=null,this._onSocketErrorBound=null,this._onSocketDataBound=null,this._onSocketCloseBound=null,jm[this.announceUrl]&&(jm[this.announceUrl].consumers-=1),jm[this.announceUrl].consumers>0)return e();let n=jm[this.announceUrl];delete jm[this.announceUrl],n.on("error",F6),n.once("close",e);let r;if(!this.expectingResponse)return i();r=setTimeout(i,wv.DESTROY_TIMEOUT),n.once("data",i);function i(){r&&(clearTimeout(r),r=null),n.removeListener("data",i),n.destroy(),n=null}}_openSocket(){if(this.destroyed=!1,this.peers||(this.peers={}),this._onSocketConnectBound=()=>{this._onSocketConnect()},this._onSocketErrorBound=e=>{this._onSocketError(e)},this._onSocketDataBound=e=>{this._onSocketData(e)},this._onSocketCloseBound=()=>{this._onSocketClose()},this.socket=jm[this.announceUrl],this.socket)jm[this.announceUrl].consumers+=1,this.socket.connected&&this._onSocketConnectBound();else{const e=new URL(this.announceUrl);let n;this.client._proxyOpts&&(n=e.protocol==="wss:"?this.client._proxyOpts.httpsAgent:this.client._proxyOpts.httpAgent,!n&&this.client._proxyOpts.socksProxy&&(n=new $9e.Agent(U9e(this.client._proxyOpts.socksProxy),e.protocol==="wss:"))),this.socket=jm[this.announceUrl]=new j9e({url:this.announceUrl,agent:n}),this.socket.consumers=1,this.socket.once("connect",this._onSocketConnectBound)}this.socket.on("data",this._onSocketDataBound),this.socket.once("close",this._onSocketCloseBound),this.socket.once("error",this._onSocketErrorBound)}_onSocketConnect(){this.destroyed||this.reconnecting&&(this.reconnecting=!1,this.retries=0,this.announce(this.client._defaultAnnounceOpts()))}_onSocketData(e){if(!this.destroyed){this.expectingResponse=!1;try{e=JSON.parse(e)}catch{this.client.emit("warning",new Error("Invalid tracker response"));return}e.action==="announce"?this._onAnnounceResponse(e):e.action==="scrape"?this._onScrapeResponse(e):this._onSocketError(new Error(`invalid action in WS response: ${e.action}`))}}_onAnnounceResponse(e){if(e.info_hash!==this.client._infoHashBinary){yh("ignoring websocket data from %s for %s (looking for %s: reused socket)",this.announceUrl,wv.binaryToHex(e.info_hash),this.client.infoHash);return}if(e.peer_id&&e.peer_id===this.client._peerIdBinary)return;yh("received %s from %s for %s",JSON.stringify(e),this.announceUrl,this.client.infoHash);const n=e["failure reason"];if(n)return this.client.emit("warning",new Error(n));const r=e["warning message"];r&&this.client.emit("warning",new Error(r));const i=e.interval||e["min interval"];i&&this.setInterval(i*1e3);const s=e["tracker id"];if(s&&(this._trackerId=s),e.complete!=null){const a=Object.assign({},e,{announce:this.announceUrl,infoHash:wv.binaryToHex(e.info_hash)});this.client.emit("update",a)}let o;if(e.offer&&e.peer_id&&(yh("creating peer (from remote offer)"),o=this._createPeer(),o.id=wv.binaryToHex(e.peer_id),o.once("signal",a=>{const c={action:"announce",info_hash:this.client._infoHashBinary,peer_id:this.client._peerIdBinary,to_peer_id:e.peer_id,answer:a,offer_id:e.offer_id};this._trackerId&&(c.trackerid=this._trackerId),this._send(c)}),this.client.emit("peer",o),o.signal(e.offer)),e.answer&&e.peer_id){const a=wv.binaryToHex(e.offer_id);o=this.peers[a],o?(o.id=wv.binaryToHex(e.peer_id),this.client.emit("peer",o),o.signal(e.answer),clearTimeout(o.trackerTimeout),o.trackerTimeout=null,delete this.peers[a]):yh(`got unexpected answer: ${JSON.stringify(e.answer)}`)}}_onScrapeResponse(e){e=e.files||{};const n=Object.keys(e);if(n.length===0){this.client.emit("warning",new Error("invalid scrape response"));return}n.forEach(r=>{const i=Object.assign(e[r],{announce:this.announceUrl,infoHash:wv.binaryToHex(r)});this.client.emit("scrape",i)})}_onSocketClose(){this.destroyed||(this.destroy(),this._startReconnectTimer())}_onSocketError(e){this.destroyed||(this.destroy(),this.client.emit("warning",e),this._startReconnectTimer())}_startReconnectTimer(){const e=Math.floor(Math.random()*G9e)+Math.min(Math.pow(2,this.retries)*V9e,z9e);this.reconnecting=!0,clearTimeout(this.reconnectTimer),this.reconnectTimer=setTimeout(()=>{this.retries++,this._openSocket()},e),this.reconnectTimer.unref&&this.reconnectTimer.unref(),yh("reconnecting socket in %s ms",e)}_send(e){if(this.destroyed)return;this.expectingResponse=!0;const n=JSON.stringify(e);yh("send %s",n),this.socket.send(n)}_generateOffers(e,n){const r=this,i=[];yh("generating %s offers",e);for(let a=0;a<e;++a)s();o();function s(){const a=B9e(20).toString("hex");yh("creating peer (from _generateOffers)");const c=r.peers[a]=r._createPeer({initiator:!0});c.once("signal",l=>{i.push({offer:l,offer_id:wv.hexToBinary(a)}),o()}),c.trackerTimeout=setTimeout(()=>{yh("tracker timeout: destroying peer"),c.trackerTimeout=null,delete r.peers[a],c.destroy()},q9e),c.trackerTimeout.unref&&c.trackerTimeout.unref()}function o(){i.length===e&&(yh("generated %s offers",e),n(i))}}_createPeer(e){const n=this;e=Object.assign({trickle:!1,config:n.client._rtcConfig,wrtc:n.client._wrtc},e);const r=new F9e(e);return r.once("error",i),r.once("connect",s),r;function i(o){n.client.emit("warning",new Error(`Connection error: ${o.message}`)),r.destroy()}function s(){r.removeListener("error",i),r.removeListener("connect",s)}}};A4.prototype.DEFAULT_ANNOUNCE_INTERVAL=30*1e3;A4._socketPool=jm;function F6(){}var W9e=A4,M4={exports:{}},ite={exports:{}};(function(t,e){(function(r,i){t.exports=i()})(typeof self<"u"?self:xc,function(){return function(n){var r={};function i(s){if(r[s])return r[s].exports;var o=r[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=r,i.d=function(s,o,a){i.o(s,o)||Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:a})},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=3)}([function(n,r,i){function s(v,E){if(!(v instanceof E))throw new TypeError("Cannot call a class as a function")}var o=i(5),a=i(1),c=a.toHex,l=a.ceilHeapSize,u=i(6),d=function(v){for(v+=9;v%64>0;v+=1);return v},h=function(v,E){var T=new Uint8Array(v.buffer),C=E%4,A=E-C;switch(C){case 0:T[A+3]=0;case 1:T[A+2]=0;case 2:T[A+1]=0;case 3:T[A+0]=0}for(var k=(E>>2)+1;k<v.length;k++)v[k]=0},f=function(v,E,T){v[E>>2]|=128<<24-(E%4<<3),v[((E>>2)+2&-16)+14]=T/(1<<29)|0,v[((E>>2)+2&-16)+15]=T<<3},p=function(v,E){var T=new Int32Array(v,E+320,5),C=new Int32Array(5),A=new DataView(C.buffer);return A.setInt32(0,T[0],!1),A.setInt32(4,T[1],!1),A.setInt32(8,T[2],!1),A.setInt32(12,T[3],!1),A.setInt32(16,T[4],!1),C},g=function(){function v(E){if(s(this,v),E=E||64*1024,E%64>0)throw new Error("Chunk size must be a multiple of 128 bit");this._offset=0,this._maxChunkLen=E,this._padMaxChunkLen=d(E),this._heap=new ArrayBuffer(l(this._padMaxChunkLen+320+20)),this._h32=new Int32Array(this._heap),this._h8=new Int8Array(this._heap),this._core=new o({Int32Array},{},this._heap)}return v.prototype._initState=function(T,C){this._offset=0;var A=new Int32Array(T,C+320,5);A[0]=1732584193,A[1]=-271733879,A[2]=-1732584194,A[3]=271733878,A[4]=-1009589776},v.prototype._padChunk=function(T,C){var A=d(T),k=new Int32Array(this._heap,0,A>>2);return h(k,T),f(k,T,C),A},v.prototype._write=function(T,C,A,k){u(T,this._h8,this._h32,C,A,k||0)},v.prototype._coreCall=function(T,C,A,k,I){var N=A;this._write(T,C,A),I&&(N=this._padChunk(A,k)),this._core.hash(N,this._padMaxChunkLen)},v.prototype.rawDigest=function(T){var C=T.byteLength||T.length||T.size||0;this._initState(this._heap,this._padMaxChunkLen);var A=0,k=this._maxChunkLen;for(A=0;C>A+k;A+=k)this._coreCall(T,A,k,C,!1);return this._coreCall(T,A,C-A,C,!0),p(this._heap,this._padMaxChunkLen)},v.prototype.digest=function(T){return c(this.rawDigest(T).buffer)},v.prototype.digestFromString=function(T){return this.digest(T)},v.prototype.digestFromBuffer=function(T){return this.digest(T)},v.prototype.digestFromArrayBuffer=function(T){return this.digest(T)},v.prototype.resetState=function(){return this._initState(this._heap,this._padMaxChunkLen),this},v.prototype.append=function(T){var C=0,A=T.byteLength||T.length||T.size||0,k=this._offset%this._maxChunkLen,I=void 0;for(this._offset+=A;C<A;)I=Math.min(A-C,this._maxChunkLen-k),this._write(T,C,I,k),k+=I,C+=I,k===this._maxChunkLen&&(this._core.hash(this._maxChunkLen,this._padMaxChunkLen),k=0);return this},v.prototype.getState=function(){var T=this._offset%this._maxChunkLen,C=void 0;if(T)C=this._heap.slice(0);else{var A=new Int32Array(this._heap,this._padMaxChunkLen+320,5);C=A.buffer.slice(A.byteOffset,A.byteOffset+A.byteLength)}return{offset:this._offset,heap:C}},v.prototype.setState=function(T){if(this._offset=T.offset,T.heap.byteLength===20){var C=new Int32Array(this._heap,this._padMaxChunkLen+320,5);C.set(new Int32Array(T.heap))}else this._h32.set(new Int32Array(T.heap));return this},v.prototype.rawEnd=function(){var T=this._offset,C=T%this._maxChunkLen,A=this._padChunk(C,T);this._core.hash(A,this._padMaxChunkLen);var k=p(this._heap,this._padMaxChunkLen);return this._initState(this._heap,this._padMaxChunkLen),k},v.prototype.end=function(){return c(this.rawEnd().buffer)},v}();n.exports=g,n.exports._core=o},function(n,r){for(var i=new Array(256),s=0;s<256;s++)i[s]=(s<16?"0":"")+s.toString(16);n.exports.toHex=function(o){for(var a=new Uint8Array(o),c=new Array(o.byteLength),l=0;l<c.length;l++)c[l]=i[a[l]];return c.join("")},n.exports.ceilHeapSize=function(o){var a=0;if(o<=65536)return 65536;if(o<16777216)for(a=1;a<o;a=a<<1);else for(a=16777216;a<o;a+=16777216);return a},n.exports.isDedicatedWorkerScope=function(o){var a="WorkerGlobalScope"in o&&o instanceof o.WorkerGlobalScope,c="SharedWorkerGlobalScope"in o&&o instanceof o.SharedWorkerGlobalScope,l="ServiceWorkerGlobalScope"in o&&o instanceof o.ServiceWorkerGlobalScope;return a&&!c&&!l}},function(n,r,i){n.exports=function(){var s=i(0),o=function(l,u,d){try{return d(null,l.digest(u))}catch(h){return d(h)}},a=function(l,u,d,h,f){var p=new self.FileReader;p.onloadend=function(){if(p.error)return f(p.error);var v=p.result;u+=p.result.byteLength;try{l.append(v)}catch(E){f(E);return}u<h.size?a(l,u,d,h,f):f(null,l.end())},p.readAsArrayBuffer(h.slice(u,u+d))},c=!0;return self.onmessage=function(l){if(c){var u=l.data.data,d=l.data.file,h=l.data.id;if(!(typeof h>"u")&&!(!d&&!u)){var f=l.data.blockSize||4*1024*1024,p=new s(f);p.resetState();var g=function(v,E){v?self.postMessage({id:h,error:v.name}):self.postMessage({id:h,hash:E})};u&&o(p,u,g),d&&a(p,0,f,d,g)}}},function(){c=!1}}},function(n,r,i){var s=i(4),o=i(0),a=i(7),c=i(2),l=i(1),u=l.isDedicatedWorkerScope,d=typeof self<"u"&&u(self);o.disableWorkerBehaviour=d?c():function(){},o.createWorker=function(){var h=s(2),f=h.terminate;return h.terminate=function(){URL.revokeObjectURL(h.objectURL),f.call(h)},h},o.createHash=a,n.exports=o},function(n,r,i){function s(h){var f={};function p(v){if(f[v])return f[v].exports;var E=f[v]={i:v,l:!1,exports:{}};return h[v].call(E.exports,E,E.exports,p),E.l=!0,E.exports}p.m=h,p.c=f,p.i=function(v){return v},p.d=function(v,E,T){p.o(v,E)||Object.defineProperty(v,E,{configurable:!1,enumerable:!0,get:T})},p.r=function(v){Object.defineProperty(v,"__esModule",{value:!0})},p.n=function(v){var E=v&&v.__esModule?function(){return v.default}:function(){return v};return p.d(E,"a",E),E},p.o=function(v,E){return Object.prototype.hasOwnProperty.call(v,E)},p.p="/",p.oe=function(v){throw console.error(v),v};var g=p(p.s=ENTRY_MODULE);return g.default||g}var o="[\\.|\\-|\\+|\\w|/|@]+",a="\\((/\\*.*?\\*/)?s?.*?("+o+").*?\\)";function c(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function l(h,f,p){var g={};g[p]=[];var v=f.toString(),E=v.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!E)return g;for(var T=E[1],C=new RegExp("(\\\\n|\\W)"+c(T)+a,"g"),A;A=C.exec(v);)A[3]!=="dll-reference"&&g[p].push(A[3]);for(C=new RegExp("\\("+c(T)+'\\("(dll-reference\\s('+o+'))"\\)\\)'+a,"g");A=C.exec(v);)h[A[2]]||(g[p].push(A[1]),h[A[2]]=i(A[1]).m),g[A[2]]=g[A[2]]||[],g[A[2]].push(A[4]);return g}function u(h){var f=Object.keys(h);return f.reduce(function(p,g){return p||h[g].length>0},!1)}function d(h,f){for(var p={main:[f]},g={main:[]},v={main:{}};u(p);)for(var E=Object.keys(p),T=0;T<E.length;T++){var C=E[T],A=p[C],k=A.pop();if(v[C]=v[C]||{},!(v[C][k]||!h[C][k])){v[C][k]=!0,g[C]=g[C]||[],g[C].push(k);for(var I=l(h,h[C][k],C),N=Object.keys(I),U=0;U<N.length;U++)p[N[U]]=p[N[U]]||[],p[N[U]]=p[N[U]].concat(I[N[U]])}}return g}n.exports=function(h,f){f=f||{};var p={main:i.m},g=f.all?{main:Object.keys(p)}:d(p,h),v="";Object.keys(g).filter(function(k){return k!=="main"}).forEach(function(k){for(var I=0;g[k][I];)I++;g[k].push(I),p[k][I]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",v=v+"var "+k+" = ("+s.toString().replace("ENTRY_MODULE",JSON.stringify(I))+")({"+g[k].map(function(N){return""+JSON.stringify(N)+": "+p[k][N].toString()}).join(",")+`});
`}),v=v+"("+s.toString().replace("ENTRY_MODULE",JSON.stringify(h))+")({"+g.main.map(function(k){return""+JSON.stringify(k)+": "+p.main[k].toString()}).join(",")+"})(self);";var E=new window.Blob([v],{type:"text/javascript"});if(f.bare)return E;var T=window.URL||window.webkitURL||window.mozURL||window.msURL,C=T.createObjectURL(E),A=new window.Worker(C);return A.objectURL=C,A}},function(n,r){n.exports=function(s,o,a){var c=new s.Int32Array(a);function l(u,d){u=u|0,d=d|0;var h=0,f=0,p=0,g=0,v=0,E=0,T=0,C=0,A=0,k=0,I=0,N=0,U=0,F=0;for(p=c[d+320>>2]|0,v=c[d+324>>2]|0,T=c[d+328>>2]|0,A=c[d+332>>2]|0,I=c[d+336>>2]|0,h=0;(h|0)<(u|0);h=h+64|0){for(g=p,E=v,C=T,k=A,N=I,f=0;(f|0)<64;f=f+4|0)F=c[h+f>>2]|0,U=((p<<5|p>>>27)+(v&T|~v&A)|0)+((F+I|0)+1518500249|0)|0,I=A,A=T,T=v<<30|v>>>2,v=p,p=U,c[u+f>>2]=F;for(f=u+64|0;(f|0)<(u+80|0);f=f+4|0)F=(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])<<1|(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])>>>31,U=((p<<5|p>>>27)+(v&T|~v&A)|0)+((F+I|0)+1518500249|0)|0,I=A,A=T,T=v<<30|v>>>2,v=p,p=U,c[f>>2]=F;for(f=u+80|0;(f|0)<(u+160|0);f=f+4|0)F=(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])<<1|(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])>>>31,U=((p<<5|p>>>27)+(v^T^A)|0)+((F+I|0)+1859775393|0)|0,I=A,A=T,T=v<<30|v>>>2,v=p,p=U,c[f>>2]=F;for(f=u+160|0;(f|0)<(u+240|0);f=f+4|0)F=(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])<<1|(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])>>>31,U=((p<<5|p>>>27)+(v&T|v&A|T&A)|0)+((F+I|0)-1894007588|0)|0,I=A,A=T,T=v<<30|v>>>2,v=p,p=U,c[f>>2]=F;for(f=u+240|0;(f|0)<(u+320|0);f=f+4|0)F=(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])<<1|(c[f-12>>2]^c[f-32>>2]^c[f-56>>2]^c[f-64>>2])>>>31,U=((p<<5|p>>>27)+(v^T^A)|0)+((F+I|0)-899497514|0)|0,I=A,A=T,T=v<<30|v>>>2,v=p,p=U,c[f>>2]=F;p=p+g|0,v=v+E|0,T=T+C|0,A=A+k|0,I=I+N|0}c[d+320>>2]=p,c[d+324>>2]=v,c[d+328>>2]=T,c[d+332>>2]=A,c[d+336>>2]=I}return{hash:l}}},function(n,r){var i=this,s=void 0;typeof self<"u"&&typeof self.FileReaderSync<"u"&&(s=new self.FileReaderSync);var o=function(l,u,d,h,f,p){var g=void 0,v=p%4,E=(f+v)%4,T=f-E;switch(v){case 0:u[p]=l.charCodeAt(h+3);case 1:u[p+1-(v<<1)|0]=l.charCodeAt(h+2);case 2:u[p+2-(v<<1)|0]=l.charCodeAt(h+1);case 3:u[p+3-(v<<1)|0]=l.charCodeAt(h)}if(!(f<E+(4-v))){for(g=4-v;g<T;g=g+4|0)d[p+g>>2]=l.charCodeAt(h+g)<<24|l.charCodeAt(h+g+1)<<16|l.charCodeAt(h+g+2)<<8|l.charCodeAt(h+g+3);switch(E){case 3:u[p+T+1|0]=l.charCodeAt(h+T+2);case 2:u[p+T+2|0]=l.charCodeAt(h+T+1);case 1:u[p+T+3|0]=l.charCodeAt(h+T)}}},a=function(l,u,d,h,f,p){var g=void 0,v=p%4,E=(f+v)%4,T=f-E;switch(v){case 0:u[p]=l[h+3];case 1:u[p+1-(v<<1)|0]=l[h+2];case 2:u[p+2-(v<<1)|0]=l[h+1];case 3:u[p+3-(v<<1)|0]=l[h]}if(!(f<E+(4-v))){for(g=4-v;g<T;g=g+4|0)d[p+g>>2|0]=l[h+g]<<24|l[h+g+1]<<16|l[h+g+2]<<8|l[h+g+3];switch(E){case 3:u[p+T+1|0]=l[h+T+2];case 2:u[p+T+2|0]=l[h+T+1];case 1:u[p+T+3|0]=l[h+T]}}},c=function(l,u,d,h,f,p){var g=void 0,v=p%4,E=(f+v)%4,T=f-E,C=new Uint8Array(s.readAsArrayBuffer(l.slice(h,h+f)));switch(v){case 0:u[p]=C[3];case 1:u[p+1-(v<<1)|0]=C[2];case 2:u[p+2-(v<<1)|0]=C[1];case 3:u[p+3-(v<<1)|0]=C[0]}if(!(f<E+(4-v))){for(g=4-v;g<T;g=g+4|0)d[p+g>>2|0]=C[g]<<24|C[g+1]<<16|C[g+2]<<8|C[g+3];switch(E){case 3:u[p+T+1|0]=C[T+2];case 2:u[p+T+2|0]=C[T+1];case 1:u[p+T+3|0]=C[T]}}};n.exports=function(l,u,d,h,f,p){if(typeof l=="string")return o(l,u,d,h,f,p);if(l instanceof Array||i&&i.Buffer&&i.Buffer.isBuffer(l))return a(l,u,d,h,f,p);if(l instanceof ArrayBuffer)return a(new Uint8Array(l),u,d,h,f,p);if(l.buffer instanceof ArrayBuffer)return a(new Uint8Array(l.buffer,l.byteOffset,l.byteLength),u,d,h,f,p);if(l instanceof Blob)return c(l,u,d,h,f,p);throw new Error("Unsupported data type.")}},function(n,r,i){var s=function(){function d(h,f){for(var p=0;p<f.length;p++){var g=f[p];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(h,g.key,g)}}return function(h,f,p){return f&&d(h.prototype,f),p&&d(h,p),h}}();function o(d,h){if(!(d instanceof h))throw new TypeError("Cannot call a class as a function")}var a=i(0),c=i(1),l=c.toHex,u=function(){function d(){o(this,d),this._rusha=new a,this._rusha.resetState()}return d.prototype.update=function(f){return this._rusha.append(f),this},d.prototype.digest=function(f){var p=this._rusha.rawEnd().buffer;if(!f)return p;if(f==="hex")return l(p);throw new Error("unsupported digest encoding")},s(d,[{key:"state",get:function(){return this._rusha.getState()},set:function(h){this._rusha.setState(h)}}]),d}();n.exports=function(){return new u}}])})})(ite);var ste=ite.exports;const K9e=ste;let gA,V1,z1;function Y9e(){gA=K9e.createWorker(),V1=1,z1={},gA.onmessage=function(e){const n=e.data.id,r=z1[n];delete z1[n],e.data.error!=null?r(new Error("Rusha worker error: "+e.data.error)):r(null,e.data.hash)}}function X9e(t,e){gA||Y9e(),z1[V1]=e,gA.postMessage({id:V1,data:t}),V1+=1}var J9e=X9e;const Q9e=ste,Z9e=J9e,e7e=new Q9e,B6=typeof window<"u"?window:self,j6=B6.crypto||B6.msCrypto||{};let hw=j6.subtle||j6.webkitSubtle;function G1(t){return e7e.digest(t)}try{hw.digest({name:"sha-1"},new Uint8Array).catch(function(){hw=!1})}catch{hw=!1}function t7e(t,e){if(!hw){typeof window<"u"?Z9e(t,function(r,i){if(r){e(G1(t));return}e(i)}):queueMicrotask(()=>e(G1(t)));return}typeof t=="string"&&(t=n7e(t)),hw.digest({name:"sha-1"},t).then(function(r){e(r7e(new Uint8Array(r)))},function(){e(G1(t))})}function n7e(t){const e=t.length,n=new Uint8Array(e);for(let r=0;r<e;r++)n[r]=t.charCodeAt(r);return n}function r7e(t){const e=t.length,n=[];for(let r=0;r<e;r++){const i=t[r];n.push((i>>>4).toString(16)),n.push((i&15).toString(16))}return n.join("")}M4.exports=t7e;M4.exports.sync=G1;var i7e=M4.exports;const $6=W9e,s7e=qk,o7e=Sx,a7e=i7e,LS=Gk("p2pt"),H6="^",V6=16e3;class c7e extends o7e{constructor(e=[],n=""){super(),this.announceURLs=e,this.trackers={},this.peers={},this.msgChunks={},this.responseWaiting={},n&&this.setIdentifier(n),this._peerIdBuffer=s7e(20),this._peerId=this._peerIdBuffer.toString("hex"),this._peerIdBinary=this._peerIdBuffer.toString("binary"),LS("my peer id: "+this._peerId)}setIdentifier(e){this.identifierString=e,this.infoHash=a7e.sync(e).toLowerCase(),this._infoHashBuffer=Tc.from(this.infoHash,"hex"),this._infoHashBinary=this._infoHashBuffer.toString("binary")}start(){this.on("peer",e=>{let n=!1;this.peers[e.id]||(n=!0,this.peers[e.id]={},this.responseWaiting[e.id]={}),e.on("connect",()=>{this.peers[e.id][e.channelName]=e,n&&this.emit("peerconnect",e)}),e.on("data",r=>{if(this.emit("data",e,r),r=r.toString(),LS("got a message from "+e.id),r[0]===H6)try{r=JSON.parse(r.slice(1)),e.respond=this._peerRespond(e,r.id);let i=this._chunkHandler(r);i!==!1&&(r.o&&(i=JSON.parse(i)),this.responseWaiting[e.id][r.id]?(this.responseWaiting[e.id][r.id]([e,i]),delete this.responseWaiting[e.id][r.id]):this.emit("msg",e,i),this._destroyChunks(r.id))}catch(i){console.log(i)}}),e.on("error",r=>{this._removePeer(e),LS("Error in connection : "+r)}),e.on("close",()=>{this._removePeer(e),LS("Connection closed with "+e.id)})}),this.on("update",e=>{const n=this.trackers[this.announceURLs.indexOf(e.announce)];this.emit("trackerconnect",n,this.getTrackerStats())}),this.on("warning",e=>{this.emit("trackerwarning",e,this.getTrackerStats())}),this._fetchPeers()}addTracker(e){if(this.announceURLs.indexOf(e)!==-1)throw new Error("Tracker already added");const n=this.announceURLs.push(e);this.trackers[n]=new $6(this,e),this.trackers[n].announce(this._defaultAnnounceOpts())}removeTracker(e){const n=this.announceURLs.indexOf(e);if(n===-1)throw new Error("Tracker does not exist");this.trackers[n].peers=[],this.trackers[n].destroy(),delete this.trackers[n],delete this.announceURLs[n]}_removePeer(e){if(!this.peers[e.id])return!1;delete this.peers[e.id][e.channelName],Object.keys(this.peers[e.id]).length===0&&(this.emit("peerclose",e),delete this.responseWaiting[e.id],delete this.peers[e.id])}send(e,n,r=""){return new Promise((i,s)=>{const o={id:r!==""?r:Math.floor(Math.random()*1e5+1e5),msg:n};typeof n=="object"&&(o.msg=JSON.stringify(n),o.o=1);try{if(!e.connected){for(const l in this.peers[e.id])if(e=this.peers[e.id][l],e.connected)break}this.responseWaiting[e.id]||(this.responseWaiting[e.id]={}),this.responseWaiting[e.id][o.id]=i}catch(l){return s(Error("Connection to peer closed"+l))}let a=0,c="";for(;o.msg.length>0;)o.c=a,c=o.msg.slice(V6),o.msg=o.msg.slice(0,V6),c||(o.last=!0),e.send(H6+JSON.stringify(o)),o.msg=c,a++;LS("sent a message to "+e.id)})}requestMorePeers(){return new Promise(e=>{for(const n in this.trackers)this.trackers[n].announce(this._defaultAnnounceOpts());e(this.peers)})}getTrackerStats(){let e=0;for(const n in this.trackers)this.trackers[n].socket&&this.trackers[n].socket.connected&&e++;return{connected:e,total:this.announceURLs.length}}destroy(){let e;for(e in this.peers)for(const n in this.peers[e])this.peers[e][n].destroy();for(e in this.trackers)this.trackers[e].destroy()}_peerRespond(e,n){return r=>this.send(e,r,n)}_chunkHandler(e){return this.msgChunks[e.id]||(this.msgChunks[e.id]=[]),this.msgChunks[e.id][e.c]=e.msg,e.last?this.msgChunks[e.id].join(""):!1}_destroyChunks(e){delete this.msgChunks[e]}_defaultAnnounceOpts(e={}){return e.numwant==null&&(e.numwant=50),e.uploaded==null&&(e.uploaded=0),e.downloaded==null&&(e.downloaded=0),e}_fetchPeers(){for(const e in this.announceURLs)this.trackers[e]=new $6(this,this.announceURLs[e]),this.trackers[e].announce(this._defaultAnnounceOpts())}}var l7e=c7e;const u7e=Yc(l7e);/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wrting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const vA=[];for(let t=0;t<256;t++)t<16&&(t<10?vA[48+t]=t:vA[87+t]=t);const d7e=t=>{const e=t.length>>1,n=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<n;)r[i++]=vA[t.charCodeAt(s++)]<<4|vA[t.charCodeAt(s++)];return r};var z6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h7e=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var qC=0;qC<z6.length;qC++)h7e[z6.charCodeAt(qC)]=qC;new TextDecoder;new TextEncoder;const G6=typeof window<"u"?window:self,q6=G6.crypto||G6.msCrypto||{};q6.subtle||q6.webkitSubtle;const f7e=`
wss://tracker.btorrent.xyz
wss://tracker.webtorrent.dev
wss://tracker.openwebtorrent.com
`.split(`
`).map(t=>t.trim()).filter(t=>t);function lS(t){return d7e(t)}const p7e="hubworld_e0f0773939e2fabb3d7be2be077347c5a43edf7d",Wu=new u7e(f7e,p7e),Tx=new xWe(lS(Wu._peerId),{getId(t){return t.id}});Wu.on("peerconnect",t=>{Ar(qe,`remote connected ${t.id}`),Tx.add({id:lS(t.id),peer:t})});Wu.on("peerclose",t=>{Ar(qe,`remote closed ${t.id}`),Tx.remove(lS(t.id))});let q1="";const W6=new Map;Wu.on("msg",(t,e)=>{const n=Date.now(),r=W6.get(e.topic)??new Map;if("pub"in e){e.topic===q1&&(Uv==null||Uv.forward({...e.gme,session:qe.session()}));for(const[i,s]of r)if(n-s>1e3*60)r.delete(i);else{const[a]=Tx.listClosestToId(lS(i),1);he(a)&&Wu.send(a.peer,e).catch(console.error)}}else"sub"in e&&(r.set(e.sub,n),e.topic===q1&&Wu._peerId===q1?Uv==null||Uv.forward({...e.gme,session:qe.session()}):he(e.gme)&&I4(e.topic,e.sub,e.gme));W6.set(e.topic,r)});Wu.on("trackerconnect",(t,e)=>{Ar(qe,`looking for players ${t.announceUrl} [${e.connected}]`)});let K6=!1,Uv;function ote(t){K6||(K6=!0,q1=t,Wu.start(),Ar(qe,`connecting to hubworld for ${t}`))}function vD(t,e){const[n]=Tx.listClosestToId(lS(t),1);he(n)&&Wu.send(n.peer,{topic:t,pub:!0,gme:e}).catch(console.error)}function m7e(t,e){const n=Wu._peerId;ote(n),Rle(qe,t,n,e),Uv=QB(r=>{switch(r.target){case"tape:info":case"tape:error":case"tape:debug":case"tape:terminal:open":case"tape:terminal:close":case"tape:terminal:toggle":case"tape:terminal:inclayout":case"tape:terminal:crash":case"register:loginready":case"synth:audioenabled":case"synth:tts":case"synth:play":case"synth:bpm":case"synth:mainvolume":case"synth:drumvolume":case"synth:ttsvolume":case"synth:voice":case"synth:voicefx":case"gadgetclient:paint":case"gadgetclient:patch":vD(n,r);break;default:{const i=r.target.split(":"),[s]=i;switch(s){case"error":console.info(r.target),vD(n,r);break}const[o]=i.slice(-1);switch(o){case"acklogin":case"acklogout":console.info(r.target),vD(n,r);break}break}}})}function I4(t,e,n){const[r]=Tx.listClosestToId(lS(t),1);he(r)&&Wu.send(r.peer,{topic:t,sub:e,gme:n}).catch(console.error)}function ate(t,e){I4(t,Wu._peerId,RG(qe.session(),"vm:joinack",qe.id(),t,e)),setTimeout(()=>ate(t,e),1e3*3)}function g7e(t,e){ote(t),ate(t,e),Uv=QB(n=>{switch(n.target){case"vm:cli":case"vm:doot":case"vm:input":case"vm:login":case"vm:joinack":case"gadgetserver:desync":case"gadgetserver:clearscroll":I4(t,Wu._peerId,n);break}})}async function v7e(t,e,n,r,i){let s;switch(rr(r)){case"get":{s=await fetch(n);break}case"post:json":{const c=[];for(let l=0;l<i.length;l+=2)c.push([i[l],i[l+1]]);s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(mle(c))});break}}if(!(s!=null&&s.ok))return;const o=`fetch:${e}`,[a]=(s.headers.get("content-type")??"").split(";");switch(a){case"text/plain":{const c=await s.text();Ar(qe,JSON.stringify(c)),Xm(qe,t,"text",o,c,Ci());break}case"application/json":{const c=await s.json();Ar(qe,JSON.stringify(c)),Xm(qe,t,"json",o,c,Ci());break}case"application/octet-stream":{const c=await s.arrayBuffer();Xm(qe,t,"binary",o,new Uint8Array(c),Ci());break}}}const WC=Wh("network",[],t=>{if(WC.session(t))switch(t.target){case"fetch":if(Lr(t.data)){const[e,n,r,i,s]=t.data;Tl(qe,async()=>{await v7e(e,n,r,i,s)})}break;case"start":t.player===Ci()&&m7e(!!t.data,t.player);break;case"join":t.player===Ci()&&Yn(t.data)&&g7e(t.data,t.player);break;case"showjoincode":{Tl(WC,async()=>{if(t.player===Ci()&&Lr(t.data)){const[e,n]=t.data,r=`${location.origin}/join/#${n}`,i=await Y2(r);e?ER(WC,i,"secret join url",!1):ER(WC,i,i)}});break}}}),_7e=["$brown$153","$purple$5","$green$42","$ltgray$94","$white$24","$white$25","$white$26","$white$27","$white$16","$white$17","$white$30","$white$31","$red$234","$cyan$227","$dkpurple$227"];function y7e(t){return Lr(t.data)?[t.sender,...t.data.map(e=>`${e}`)].join(" "):""}function _D(t){const{terminal:e}=Ls.getState();let n=[[Po(),t.target,Jq(t.sender,_7e),...t.data],...e.logs];n.length>Lz&&(n=n.slice(0,Lz)),Ls.setState(r=>({terminal:{...r.terminal,logs:n}}))}function b7e(t){const{layout:e,editor:n}=Ls.getState();let i=e+(t?1:-1);if(i<0&&(i+=ju.MAX),i>=ju.MAX&&(i-=ju.MAX),!n.open)switch(i){case ju.SPLIT_Y:case ju.SPLIT_Y_ALT:i=ju.TOP;break}Ls.setState({layout:i})}const yD=Wh("tape",[],t=>{if(!yD.session(t))return;const{terminal:e}=Ls.getState();switch(t.target){case"inspector":t.player===Ci()&&Ls.setState(n=>{const r=he(t.data)?!!t.data:!n.inspector;return Ar(yD,`gadget inspector ${r?"$greenon":"$redoff"}`),r&&Ar(yD,"mouse click or tap elements to inspect"),{inspector:r}});break;case"info":e.level>=D1.INFO&&_D(t);break;case"debug":e.level>=D1.DEBUG&&_D(t);break;case"error":e.level>D1.OFF&&_D(t),console.error(y7e(t));break;case"crash":Ls.setState(n=>({layout:ju.FULL,terminal:{...n.terminal,open:!0}}));break;case"terminal:open":t.player===Ci()&&Ls.setState(n=>({terminal:{...n.terminal,open:!0}}));break;case"terminal:quickopen":t.player===Ci()&&Ls.setState({quickterminal:!0});break;case"terminal:close":t.player===Ci()&&Ls.setState(n=>({quickterminal:!1,terminal:{...n.terminal,open:!1}}));break;case"terminal:toggle":t.player===Ci()&&Ls.setState(n=>({terminal:{...n.terminal,open:!n.terminal.open}}));break;case"terminal:inclayout":t.player===Ci()&&gle(t.data)&&b7e(t.data);break;case"editor:open":if(Lr(t.data)&&he(t.player)){const{player:n}=t,[r,i,s,o]=t.data??["","",""];Ls.setState(()=>({editor:{open:!0,player:n,book:r,path:i,type:s,title:o}}))}break;case"editor:close":Ls.setState(n=>({editor:{...n.editor,open:!1}}));break}});function E7e(){const{viewport:t}=KE(),{width:e,height:n}=t.getCurrentViewport(),[r]=ft.useState(()=>new N6e);ft.useEffect(()=>{if(!X_e)return;document.body.appendChild(r.dom),r.showPanel(0),r.dom.style.cssText="position:fixed;bottom:0;left:0;";const h=Mce(()=>r.begin()),f=Ice(()=>r.end());return()=>{document.body.removeChild(r.dom),h(),f()}},[r]);const[i,s]=ft.useState();ft.useEffect(()=>{Tl(qe,async()=>{const h=await x6e();s(h)})},[]);const a=Math.min(e,n)<600||Z_e;ar.DRAW_CHAR_SCALE=a?1:2;const c=e>n,l=e0e||_U==="touchOnly"||O6e==="touch",u=Z3(H6e);u.minFilter=Bo,u.magFilter=Bo;const d=!Q_e&&!a&&!l&&i&&i.tier>2&&!i.isMobile;return ft.useEffect(()=>{nu.setState(h=>({...h,islowrez:a,islandscape:c,showtouchcontrols:l}))},[a,c,l]),Ne.jsxs(Ne.Fragment,{children:[Ne.jsx(Ry,{children:Ne.jsxs(gGe,{children:[Ne.jsx(vGe,{}),Ne.jsx(HGe,{})]})}),d&&Ne.jsx(_6e,{children:Ne.jsx($6e,{splat:u,viewheight:n})})]})}Y8({BufferGeometry:qh,Group:BS,Mesh:Ih,MeshBasicMaterial:XU,OrthographicCamera:JU,PlaneGeometry:lT,Points:Jae});document.addEventListener("keydown",()=>{aS()});window.addEventListener("touchstart",()=>{aS()});window.addEventListener("click",()=>{aS()});window.addEventListener("dragover",t=>{t.preventDefault()});window.addEventListener("contextmenu",t=>{aS(),t.preventDefault()});window.addEventListener("paste",t=>{var n;if(!((n=t.clipboardData)!=null&&n.files.length))return;aS(),t.preventDefault(),[...t.clipboardData.files].forEach(r=>Xm(qe,void 0,"file",`file:${r.name}`,r,Ci()))});window.addEventListener("drop",t=>{var e,n;aS(),t.preventDefault(),(e=t.dataTransfer)!=null&&e.items?[...t.dataTransfer.items].forEach(i=>{if(i.kind==="file"){const s=i.getAsFile();he(s)&&Xm(qe,void 0,"file",s.name,s,Ci())}}):[...((n=t.dataTransfer)==null?void 0:n.files)??[]].forEach(i=>Xm(qe,void 0,"file",i.name,i,Ci()))});function S7e(){return Ne.jsx(E7e,{})}Vce();const KC=new ht,Y6=new ht,w7e=t=>({...Fce(t),filter:e=>{const n=e.filter(o=>!(!o.object.visible||(o.object.userData.clippingPlanes??[]).some(c=>(c.projectPoint(o.point,KC),Y6.subVectors(o.point,KC).normalize().round(),KC.copy(c.normal).round(),KC.equals(Y6)===!1)))),r=n.findIndex(o=>o.object.userData.blocking),i=r===-1?n:n.slice(0,r+1);let s="default";return i.some(o=>o.object.userData.cursor?(s=o.object.userData.cursor,!0):!1),document.querySelectorAll("html, body").forEach(o=>{o.style.cursor=s}),i}}),X6=document.querySelector("canvas");if(he(X6)){const t=Dce(X6),e=(r,i)=>{const s=Zj(r),o=Zj(i);t.configure({...$c({flat:!0,linear:!0,shadows:!1,gl:{alpha:!1,stencil:!1,antialias:!1,powerPreference:"low-power",preserveDrawingBuffer:!0}}),events:w7e,size:{width:s,height:o,top:0,left:0},onCreated({gl:a}){a.localClippingEnabled=!0}})},n=jce(e,256);window.addEventListener("resize",()=>{n(window.innerWidth,window.innerHeight)}),e(window.innerWidth,window.innerHeight),t.render(Ne.jsx(S7e,{}))}export{Tc as B,kKe as a,bTe as b,xc as c,Hn as p,Z0 as r};

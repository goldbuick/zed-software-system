var Koe=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var eXe=Koe((mf,gf)=>{function Xoe(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var sd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function nW(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var G3={exports:{}},LT={};var ZB;function Zoe(){if(ZB)return LT;ZB=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:n,type:r,key:o,ref:i!==void 0?i:null,props:s}}return LT.Fragment=e,LT.jsx=t,LT.jsxs=t,LT}var JB;function Joe(){return JB||(JB=1,G3.exports=Zoe()),G3.exports}var be=Joe();function Qoe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var rW={exports:{}},Na=rW.exports={},Am,Cm;function AD(){throw new Error("setTimeout has not been defined")}function CD(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Am=setTimeout:Am=AD}catch{Am=AD}try{typeof clearTimeout=="function"?Cm=clearTimeout:Cm=CD}catch{Cm=CD}})();function iW(n){if(Am===setTimeout)return setTimeout(n,0);if((Am===AD||!Am)&&setTimeout)return Am=setTimeout,setTimeout(n,0);try{return Am(n,0)}catch{try{return Am.call(null,n,0)}catch{return Am.call(this,n,0)}}}function eae(n){if(Cm===clearTimeout)return clearTimeout(n);if((Cm===CD||!Cm)&&clearTimeout)return Cm=clearTimeout,clearTimeout(n);try{return Cm(n)}catch{try{return Cm.call(null,n)}catch{return Cm.call(this,n)}}}var F0=[],UE=!1,Eb,Ek=-1;function tae(){!UE||!Eb||(UE=!1,Eb.length?F0=Eb.concat(F0):Ek=-1,F0.length&&sW())}function sW(){if(!UE){var n=iW(tae);UE=!0;for(var e=F0.length;e;){for(Eb=F0,F0=[];++Ek<e;)Eb&&Eb[Ek].run();Ek=-1,e=F0.length}Eb=null,UE=!1,eae(n)}}Na.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];F0.push(new oW(n,e)),F0.length===1&&!UE&&iW(sW)};function oW(n,e){this.fun=n,this.array=e}oW.prototype.run=function(){this.fun.apply(null,this.array)};Na.title="browser";Na.browser=!0;Na.env={};Na.argv=[];Na.version="";Na.versions={};function r_(){}Na.on=r_;Na.addListener=r_;Na.once=r_;Na.off=r_;Na.removeListener=r_;Na.removeAllListeners=r_;Na.emit=r_;Na.prependListener=r_;Na.prependOnceListener=r_;Na.listeners=function(n){return[]};Na.binding=function(n){throw new Error("process.binding is not supported")};Na.cwd=function(){return"/"};Na.chdir=function(n){throw new Error("process.chdir is not supported")};Na.umask=function(){return 0};var nae=rW.exports;const Ga=Qoe(nae);var W3={exports:{}},ni={},QB;function rae(){if(QB)return ni;QB=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.for("react.activity"),f=Symbol.iterator;function d(z){return z===null||typeof z!="object"?null:(z=f&&z[f]||z["@@iterator"],typeof z=="function"?z:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,_={};function v(z,q,ee){this.props=z,this.context=q,this.refs=_,this.updater=ee||p}v.prototype.isReactComponent={},v.prototype.setState=function(z,q){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,q,"setState")},v.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function S(){}S.prototype=v.prototype;function b(z,q,ee){this.props=z,this.context=q,this.refs=_,this.updater=ee||p}var T=b.prototype=new S;T.constructor=b,m(T,v.prototype),T.isPureReactComponent=!0;var w=Array.isArray;function R(){}var C={H:null,A:null,T:null,S:null},N=Object.prototype.hasOwnProperty;function U(z,q,ee){var te=ee.ref;return{$$typeof:n,type:z,key:q,ref:te!==void 0?te:null,props:ee}}function B(z,q){return U(z.type,q,z.props)}function $(z){return typeof z=="object"&&z!==null&&z.$$typeof===n}function I(z){var q={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(ee){return q[ee]})}var L=/\/+/g;function P(z,q){return typeof z=="object"&&z!==null&&z.key!=null?I(""+z.key):q.toString(36)}function H(z){switch(z.status){case"fulfilled":return z.value;case"rejected":throw z.reason;default:switch(typeof z.status=="string"?z.then(R,R):(z.status="pending",z.then(function(q){z.status==="pending"&&(z.status="fulfilled",z.value=q)},function(q){z.status==="pending"&&(z.status="rejected",z.reason=q)})),z.status){case"fulfilled":return z.value;case"rejected":throw z.reason}}throw z}function X(z,q,ee,te,ie){var Ee=typeof z;(Ee==="undefined"||Ee==="boolean")&&(z=null);var Re=!1;if(z===null)Re=!0;else switch(Ee){case"bigint":case"string":case"number":Re=!0;break;case"object":switch(z.$$typeof){case n:case e:Re=!0;break;case u:return Re=z._init,X(Re(z._payload),q,ee,te,ie)}}if(Re)return ie=ie(z),Re=te===""?"."+P(z,0):te,w(ie)?(ee="",Re!=null&&(ee=Re.replace(L,"$&/")+"/"),X(ie,q,ee,"",function(We){return We})):ie!=null&&($(ie)&&(ie=B(ie,ee+(ie.key==null||z&&z.key===ie.key?"":(""+ie.key).replace(L,"$&/")+"/")+Re)),q.push(ie)),1;Re=0;var Te=te===""?".":te+":";if(w(z))for(var Pe=0;Pe<z.length;Pe++)te=z[Pe],Ee=Te+P(te,Pe),Re+=X(te,q,ee,Ee,ie);else if(Pe=d(z),typeof Pe=="function")for(z=Pe.call(z),Pe=0;!(te=z.next()).done;)te=te.value,Ee=Te+P(te,Pe++),Re+=X(te,q,ee,Ee,ie);else if(Ee==="object"){if(typeof z.then=="function")return X(H(z),q,ee,te,ie);throw q=String(z),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return Re}function G(z,q,ee){if(z==null)return z;var te=[],ie=0;return X(z,te,"","",function(Ee){return q.call(ee,Ee,ie++)}),te}function Y(z){if(z._status===-1){var q=z._result;q=q(),q.then(function(ee){(z._status===0||z._status===-1)&&(z._status=1,z._result=ee)},function(ee){(z._status===0||z._status===-1)&&(z._status=2,z._result=ee)}),z._status===-1&&(z._status=0,z._result=q)}if(z._status===1)return z._result.default;throw z._result}var J=typeof reportError=="function"?reportError:function(z){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof z=="object"&&z!==null&&typeof z.message=="string"?String(z.message):String(z),error:z});if(!window.dispatchEvent(q))return}else if(typeof Ga=="object"&&typeof Ga.emit=="function"){Ga.emit("uncaughtException",z);return}console.error(z)},Q={map:G,forEach:function(z,q,ee){G(z,function(){q.apply(this,arguments)},ee)},count:function(z){var q=0;return G(z,function(){q++}),q},toArray:function(z){return G(z,function(q){return q})||[]},only:function(z){if(!$(z))throw Error("React.Children.only expected to receive a single React element child.");return z}};return ni.Activity=h,ni.Children=Q,ni.Component=v,ni.Fragment=t,ni.Profiler=i,ni.PureComponent=b,ni.StrictMode=r,ni.Suspense=c,ni.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,ni.__COMPILER_RUNTIME={__proto__:null,c:function(z){return C.H.useMemoCache(z)}},ni.cache=function(z){return function(){return z.apply(null,arguments)}},ni.cacheSignal=function(){return null},ni.cloneElement=function(z,q,ee){if(z==null)throw Error("The argument must be a React element, but you passed "+z+".");var te=m({},z.props),ie=z.key;if(q!=null)for(Ee in q.key!==void 0&&(ie=""+q.key),q)!N.call(q,Ee)||Ee==="key"||Ee==="__self"||Ee==="__source"||Ee==="ref"&&q.ref===void 0||(te[Ee]=q[Ee]);var Ee=arguments.length-2;if(Ee===1)te.children=ee;else if(1<Ee){for(var Re=Array(Ee),Te=0;Te<Ee;Te++)Re[Te]=arguments[Te+2];te.children=Re}return U(z.type,ie,te)},ni.createContext=function(z){return z={$$typeof:o,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null},z.Provider=z,z.Consumer={$$typeof:s,_context:z},z},ni.createElement=function(z,q,ee){var te,ie={},Ee=null;if(q!=null)for(te in q.key!==void 0&&(Ee=""+q.key),q)N.call(q,te)&&te!=="key"&&te!=="__self"&&te!=="__source"&&(ie[te]=q[te]);var Re=arguments.length-2;if(Re===1)ie.children=ee;else if(1<Re){for(var Te=Array(Re),Pe=0;Pe<Re;Pe++)Te[Pe]=arguments[Pe+2];ie.children=Te}if(z&&z.defaultProps)for(te in Re=z.defaultProps,Re)ie[te]===void 0&&(ie[te]=Re[te]);return U(z,Ee,ie)},ni.createRef=function(){return{current:null}},ni.forwardRef=function(z){return{$$typeof:a,render:z}},ni.isValidElement=$,ni.lazy=function(z){return{$$typeof:u,_payload:{_status:-1,_result:z},_init:Y}},ni.memo=function(z,q){return{$$typeof:l,type:z,compare:q===void 0?null:q}},ni.startTransition=function(z){var q=C.T,ee={};C.T=ee;try{var te=z(),ie=C.S;ie!==null&&ie(ee,te),typeof te=="object"&&te!==null&&typeof te.then=="function"&&te.then(R,J)}catch(Ee){J(Ee)}finally{q!==null&&ee.types!==null&&(q.types=ee.types),C.T=q}},ni.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},ni.use=function(z){return C.H.use(z)},ni.useActionState=function(z,q,ee){return C.H.useActionState(z,q,ee)},ni.useCallback=function(z,q){return C.H.useCallback(z,q)},ni.useContext=function(z){return C.H.useContext(z)},ni.useDebugValue=function(){},ni.useDeferredValue=function(z,q){return C.H.useDeferredValue(z,q)},ni.useEffect=function(z,q){return C.H.useEffect(z,q)},ni.useEffectEvent=function(z){return C.H.useEffectEvent(z)},ni.useId=function(){return C.H.useId()},ni.useImperativeHandle=function(z,q,ee){return C.H.useImperativeHandle(z,q,ee)},ni.useInsertionEffect=function(z,q){return C.H.useInsertionEffect(z,q)},ni.useLayoutEffect=function(z,q){return C.H.useLayoutEffect(z,q)},ni.useMemo=function(z,q){return C.H.useMemo(z,q)},ni.useOptimistic=function(z,q){return C.H.useOptimistic(z,q)},ni.useReducer=function(z,q,ee){return C.H.useReducer(z,q,ee)},ni.useRef=function(z){return C.H.useRef(z)},ni.useState=function(z){return C.H.useState(z)},ni.useSyncExternalStore=function(z,q,ee){return C.H.useSyncExternalStore(z,q,ee)},ni.useTransition=function(){return C.H.useTransition()},ni.version="19.2.4",ni}var eF;function l5(){return eF||(eF=1,W3.exports=rae()),W3.exports}var Ke=l5();const yh=wu(Ke);const YA="176",iae=0,tF=1,sae=2,oae=0,u5=1,xk=2,Tm=3,X0=0,Uc=1,Ia=2,ul=0,BE=1,nF=2,rF=3,iF=4,aae=5,_b=100,cae=101,lae=102,uae=103,hae=104,fae=200,dae=201,pae=202,mae=203,RD=204,kD=205,gae=206,_ae=207,vae=208,yae=209,bae=210,Sae=211,Eae=212,xae=213,Tae=214,MD=0,_M=1,ID=2,ZE=3,OD=4,ND=5,PD=6,DD=7,aW=0,wae=1,Aae=2,$0=0,Cae=1,Rae=2,kae=3,cW=4,Mae=5,Iae=6,Oae=7,lW=300,JE=301,QE=302,LD=303,UD=304,eO=306,vM=1e3,xb=1001,BD=1002,jl=1003,Nae=1004,JC=1005,Bl=1006,q3=1007,Tb=1008,Oo=1009,uW=1010,hW=1011,Kw=1012,h5=1013,jv=1014,dp=1015,Zv=1016,f5=1017,d5=1018,ex=1020,fW=35902,dW=1021,pW=1022,_u=1023,Xw=1026,tx=1027,KA=1028,p5=1029,m5=1030,g5=1031,tO=1033,Tk=33776,wk=33777,Ak=33778,Ck=33779,FD=35840,jD=35841,zD=35842,$D=35843,VD=36196,HD=37492,GD=37496,WD=37808,qD=37809,YD=37810,KD=37811,XD=37812,ZD=37813,JD=37814,QD=37815,eL=37816,tL=37817,nL=37818,rL=37819,iL=37820,sL=37821,Rk=36492,oL=36494,aL=36495,mW=36283,cL=36284,lL=36285,uL=36286,d1=3200,Pae=3201,Dae=0,Lae=1,Pm="",Fi="srgb",Z0="srgb-linear",yM="linear",Bs="srgb",kS=7680,sF=519,Uae=512,Bae=513,Fae=514,gW=515,jae=516,zae=517,$ae=518,Vae=519,oF=35044,L0=35048,aF="300 es",j0=2e3,bM=2001;class i_{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const r=t[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const Ml=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let cF=1234567;const Nw=Math.PI/180,Zw=180/Math.PI;function Bx(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ml[n&255]+Ml[n>>8&255]+Ml[n>>16&255]+Ml[n>>24&255]+"-"+Ml[e&255]+Ml[e>>8&255]+"-"+Ml[e>>16&15|64]+Ml[e>>24&255]+"-"+Ml[t&63|128]+Ml[t>>8&255]+"-"+Ml[t>>16&255]+Ml[t>>24&255]+Ml[r&255]+Ml[r>>8&255]+Ml[r>>16&255]+Ml[r>>24&255]).toLowerCase()}function Di(n,e,t){return Math.max(e,Math.min(t,n))}function _5(n,e){return(n%e+e)%e}function Hae(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function Gae(n,e,t){return n!==e?(t-n)/(e-n):0}function Pw(n,e,t){return(1-t)*n+t*e}function Wae(n,e,t,r){return Pw(n,e,1-Math.exp(-t*r))}function qae(n,e=1){return e-Math.abs(_5(n,e*2)-e)}function Yae(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function Kae(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function Xae(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Zae(n,e){return n+Math.random()*(e-n)}function Jae(n){return n*(.5-Math.random())}function Qae(n){n!==void 0&&(cF=n);let e=cF+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function ece(n){return n*Nw}function tce(n){return n*Zw}function nce(n){return(n&n-1)===0&&n!==0}function rce(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function ice(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function sce(n,e,t,r,i){const s=Math.cos,o=Math.sin,a=s(t/2),c=o(t/2),l=s((e+r)/2),u=o((e+r)/2),h=s((e-r)/2),f=o((e-r)/2),d=s((r-e)/2),p=o((r-e)/2);switch(i){case"XYX":n.set(a*u,c*h,c*f,a*l);break;case"YZY":n.set(c*f,a*u,c*h,a*l);break;case"ZXZ":n.set(c*h,c*f,a*u,a*l);break;case"XZX":n.set(a*u,c*p,c*d,a*l);break;case"YXY":n.set(c*d,a*u,c*p,a*l);break;case"ZYZ":n.set(c*p,c*d,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function dE(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function cu(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const _W={DEG2RAD:Nw,RAD2DEG:Zw,generateUUID:Bx,clamp:Di,euclideanModulo:_5,mapLinear:Hae,inverseLerp:Gae,lerp:Pw,damp:Wae,pingpong:qae,smoothstep:Yae,smootherstep:Kae,randInt:Xae,randFloat:Zae,randFloatSpread:Jae,seededRandom:Qae,degToRad:ece,radToDeg:tce,isPowerOfTwo:nce,ceilPowerOfTwo:rce,floorPowerOfTwo:ice,setQuaternionFromProperEuler:sce,normalize:cu,denormalize:dE};class zn{constructor(e=0,t=0){zn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Di(this.x,e.x,t.x),this.y=Di(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Di(this.x,e,t),this.y=Di(this.y,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Di(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Di(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pi{constructor(e,t,r,i,s,o,a,c,l){pi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,o,a,c,l)}set(e,t,r,i,s,o,a,c,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=c,u[6]=r,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[3],c=r[6],l=r[1],u=r[4],h=r[7],f=r[2],d=r[5],p=r[8],m=i[0],_=i[3],v=i[6],S=i[1],b=i[4],T=i[7],w=i[2],R=i[5],C=i[8];return s[0]=o*m+a*S+c*w,s[3]=o*_+a*b+c*R,s[6]=o*v+a*T+c*C,s[1]=l*m+u*S+h*w,s[4]=l*_+u*b+h*R,s[7]=l*v+u*T+h*C,s[2]=f*m+d*S+p*w,s[5]=f*_+d*b+p*R,s[8]=f*v+d*T+p*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-r*s*u+r*a*c+i*s*l-i*o*c}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,f=a*c-u*s,d=l*s-o*c,p=t*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*l-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=f*m,e[4]=(u*t-i*c)*m,e[5]=(i*s-a*t)*m,e[6]=d*m,e[7]=(r*c-l*t)*m,e[8]=(o*t-r*s)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(r*c,r*l,-r*(c*o+l*a)+o+e,-i*l,i*c,-i*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Y3.makeScale(e,t)),this}rotate(e){return this.premultiply(Y3.makeRotation(-e)),this}translate(e,t){return this.premultiply(Y3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Y3=new pi;function vW(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Jw(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function oce(){const n=Jw("canvas");return n.style.display="block",n}const lF={};function kk(n){n in lF||(lF[n]=!0,console.warn(n))}function ace(n,e,t){return new Promise(function(r,i){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:r()}}setTimeout(s,t)})}function cce(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function lce(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const uF=new pi().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),hF=new pi().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function uce(){const n={enabled:!0,workingColorSpace:Z0,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Bs&&(i.r=V0(i.r),i.g=V0(i.g),i.b=V0(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Bs&&(i.r=FE(i.r),i.g=FE(i.g),i.b=FE(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Pm?yM:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],r=[.3127,.329];return n.define({[Z0]:{primaries:e,whitePoint:r,transfer:yM,toXYZ:uF,fromXYZ:hF,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Fi},outputColorSpaceConfig:{drawingBufferColorSpace:Fi}},[Fi]:{primaries:e,whitePoint:r,transfer:Bs,toXYZ:uF,fromXYZ:hF,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Fi}}}),n}const Zi=uce();function V0(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function FE(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let MS;class hce{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{MS===void 0&&(MS=Jw("canvas")),MS.width=e.width,MS.height=e.height;const i=MS.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=MS}return r.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Jw("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=V0(s[o]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(V0(t[r]/255)*255):t[r]=V0(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let fce=0,v5=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:fce++}),this.uuid=Bx(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(K3(i[o].image)):s.push(K3(i[o]))}else s=K3(i);r.url=s}return t||(e.images[this.uuid]=r),r}};function K3(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?hce.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let dce=0;class pc extends i_{constructor(e=pc.DEFAULT_IMAGE,t=pc.DEFAULT_MAPPING,r=xb,i=xb,s=Bl,o=Tb,a=_u,c=Oo,l=pc.DEFAULT_ANISOTROPY,u=Pm){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:dce++}),this.uuid=Bx(),this.name="",this.source=new v5(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new zn(0,0),this.repeat=new zn(1,1),this.center=new zn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isTextureArray=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isTextureArray=e.isTextureArray,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lW)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case vM:e.x=e.x-Math.floor(e.x);break;case xb:e.x=e.x<0?0:1;break;case BD:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case vM:e.y=e.y-Math.floor(e.y);break;case xb:e.y=e.y<0?0:1;break;case BD:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}pc.DEFAULT_IMAGE=null;pc.DEFAULT_MAPPING=lW;pc.DEFAULT_ANISOTROPY=1;class Xo{constructor(e=0,t=0,r=0,i=1){Xo.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const c=e.elements,l=c[0],u=c[4],h=c[8],f=c[1],d=c[5],p=c[9],m=c[2],_=c[6],v=c[10];if(Math.abs(u-f)<.01&&Math.abs(h-m)<.01&&Math.abs(p-_)<.01){if(Math.abs(u+f)<.1&&Math.abs(h+m)<.1&&Math.abs(p+_)<.1&&Math.abs(l+d+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const b=(l+1)/2,T=(d+1)/2,w=(v+1)/2,R=(u+f)/4,C=(h+m)/4,N=(p+_)/4;return b>T&&b>w?b<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(b),i=R/r,s=C/r):T>w?T<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(T),r=R/i,s=N/i):w<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(w),r=C/s,i=N/s),this.set(r,i,s,t),this}let S=Math.sqrt((_-p)*(_-p)+(h-m)*(h-m)+(f-u)*(f-u));return Math.abs(S)<.001&&(S=1),this.x=(_-p)/S,this.y=(h-m)/S,this.z=(f-u)/S,this.w=Math.acos((l+d+v-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Di(this.x,e.x,t.x),this.y=Di(this.y,e.y,t.y),this.z=Di(this.z,e.z,t.z),this.w=Di(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Di(this.x,e,t),this.y=Di(this.y,e,t),this.z=Di(this.z,e,t),this.w=Di(this.w,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Di(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class pce extends i_{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=r.depth?r.depth:1,this.scissor=new Xo(0,0,e,t),this.scissorTest=!1,this.viewport=new Xo(0,0,e,t);const i={width:e,height:t,depth:this.depth};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Bl,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,multiview:!1},r);const s=new pc(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const o=r.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,r=e.textures.length;t<r;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new v5(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class hl extends pce{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class yW extends pc{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=jl,this.minFilter=jl,this.wrapR=xb,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class mce extends pc{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=jl,this.minFilter=jl,this.wrapR=xb,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class XA{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,s,o,a){let c=r[i+0],l=r[i+1],u=r[i+2],h=r[i+3];const f=s[o+0],d=s[o+1],p=s[o+2],m=s[o+3];if(a===0){e[t+0]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=f,e[t+1]=d,e[t+2]=p,e[t+3]=m;return}if(h!==m||c!==f||l!==d||u!==p){let _=1-a;const v=c*f+l*d+u*p+h*m,S=v>=0?1:-1,b=1-v*v;if(b>Number.EPSILON){const w=Math.sqrt(b),R=Math.atan2(w,v*S);_=Math.sin(_*R)/w,a=Math.sin(a*R)/w}const T=a*S;if(c=c*_+f*T,l=l*_+d*T,u=u*_+p*T,h=h*_+m*T,_===1-a){const w=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=w,l*=w,u*=w,h*=w}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,s,o){const a=r[i],c=r[i+1],l=r[i+2],u=r[i+3],h=s[o],f=s[o+1],d=s[o+2],p=s[o+3];return e[t]=a*p+u*h+c*d-l*f,e[t+1]=c*p+u*f+l*h-a*d,e[t+2]=l*p+u*d+a*f-c*h,e[t+3]=u*p-a*h-c*f-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(r/2),u=a(i/2),h=a(s/2),f=c(r/2),d=c(i/2),p=c(s/2);switch(o){case"XYZ":this._x=f*u*h+l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h-f*d*p;break;case"YXZ":this._x=f*u*h+l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h+f*d*p;break;case"ZXY":this._x=f*u*h-l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h-f*d*p;break;case"ZYX":this._x=f*u*h-l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h+f*d*p;break;case"YZX":this._x=f*u*h+l*d*p,this._y=l*d*h+f*u*p,this._z=l*u*p-f*d*h,this._w=l*u*h-f*d*p;break;case"XZY":this._x=f*u*h-l*d*p,this._y=l*d*h-f*u*p,this._z=l*u*p+f*d*h,this._w=l*u*h+f*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],h=t[10],f=r+a+h;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(u-c)*d,this._y=(s-l)*d,this._z=(o-i)*d}else if(r>a&&r>h){const d=2*Math.sqrt(1+r-a-h);this._w=(u-c)/d,this._x=.25*d,this._y=(i+o)/d,this._z=(s+l)/d}else if(a>h){const d=2*Math.sqrt(1+a-r-h);this._w=(s-l)/d,this._x=(i+o)/d,this._y=.25*d,this._z=(c+u)/d}else{const d=2*Math.sqrt(1+h-r-a);this._w=(o-i)/d,this._x=(s+l)/d,this._y=(c+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Di(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=r*u+o*a+i*l-s*c,this._y=i*u+o*c+s*a-r*l,this._z=s*u+o*l+r*c-i*a,this._w=o*u-r*a-i*c-s*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const d=1-t;return this._w=d*o+t*this._w,this._x=d*r+t*this._x,this._y=d*i+t*this._y,this._z=d*s+t*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),h=Math.sin((1-t)*u)/l,f=Math.sin(t*u)/l;return this._w=o*h+this._w*f,this._x=r*h+this._x*f,this._y=i*h+this._y*f,this._z=s*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class zt{constructor(e=0,t=0,r=0){zt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(fF.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(fF.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,c=e.w,l=2*(o*i-a*r),u=2*(a*t-s*i),h=2*(s*r-o*t);return this.x=t+c*l+o*h-a*u,this.y=r+c*u+a*l-s*h,this.z=i+c*h+s*u-o*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Di(this.x,e.x,t.x),this.y=Di(this.y,e.y,t.y),this.z=Di(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Di(this.x,e,t),this.y=Di(this.y,e,t),this.z=Di(this.z,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Di(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,o=t.x,a=t.y,c=t.z;return this.x=i*c-s*a,this.y=s*o-r*c,this.z=r*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return X3.copy(this).projectOnVector(e),this.sub(X3)}reflect(e){return this.sub(X3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Di(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const X3=new zt,fF=new XA;class p1{constructor(e=new zt(1/0,1/0,1/0),t=new zt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Xd.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Xd.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Xd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Xd):Xd.fromBufferAttribute(s,o),Xd.applyMatrix4(e.matrixWorld),this.expandByPoint(Xd);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),QC.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),QC.copy(r.boundingBox)),QC.applyMatrix4(e.matrixWorld),this.union(QC)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Xd),Xd.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(UT),eR.subVectors(this.max,UT),IS.subVectors(e.a,UT),OS.subVectors(e.b,UT),NS.subVectors(e.c,UT),av.subVectors(OS,IS),cv.subVectors(NS,OS),Gy.subVectors(IS,NS);let t=[0,-av.z,av.y,0,-cv.z,cv.y,0,-Gy.z,Gy.y,av.z,0,-av.x,cv.z,0,-cv.x,Gy.z,0,-Gy.x,-av.y,av.x,0,-cv.y,cv.x,0,-Gy.y,Gy.x,0];return!Z3(t,IS,OS,NS,eR)||(t=[1,0,0,0,1,0,0,0,1],!Z3(t,IS,OS,NS,eR))?!1:(tR.crossVectors(av,cv),t=[tR.x,tR.y,tR.z],Z3(t,IS,OS,NS,eR))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Xd).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Xd).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(b0[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),b0[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),b0[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),b0[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),b0[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),b0[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),b0[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),b0[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(b0),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const b0=[new zt,new zt,new zt,new zt,new zt,new zt,new zt,new zt],Xd=new zt,QC=new p1,IS=new zt,OS=new zt,NS=new zt,av=new zt,cv=new zt,Gy=new zt,UT=new zt,eR=new zt,tR=new zt,Wy=new zt;function Z3(n,e,t,r,i){for(let s=0,o=n.length-3;s<=o;s+=3){Wy.fromArray(n,s);const a=i.x*Math.abs(Wy.x)+i.y*Math.abs(Wy.y)+i.z*Math.abs(Wy.z),c=e.dot(Wy),l=t.dot(Wy),u=r.dot(Wy);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const gce=new p1,BT=new zt,J3=new zt;class Fx{constructor(e=new zt,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):gce.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;BT.subVectors(e,this.center);const t=BT.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(BT,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(J3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(BT.copy(e.center).add(J3)),this.expandByPoint(BT.copy(e.center).sub(J3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const S0=new zt,Q3=new zt,nR=new zt,lv=new zt,eN=new zt,rR=new zt,tN=new zt;class y5{constructor(e=new zt,t=new zt(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,S0)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=S0.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(S0.copy(this.origin).addScaledVector(this.direction,t),S0.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){Q3.copy(e).add(t).multiplyScalar(.5),nR.copy(t).sub(e).normalize(),lv.copy(this.origin).sub(Q3);const s=e.distanceTo(t)*.5,o=-this.direction.dot(nR),a=lv.dot(this.direction),c=-lv.dot(nR),l=lv.lengthSq(),u=Math.abs(1-o*o);let h,f,d,p;if(u>0)if(h=o*c-a,f=o*a-c,p=s*u,h>=0)if(f>=-p)if(f<=p){const m=1/u;h*=m,f*=m,d=h*(h+o*f+2*a)+f*(o*h+f+2*c)+l}else f=s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;else f=-s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;else f<=-p?(h=Math.max(0,-(-o*s+a)),f=h>0?-s:Math.min(Math.max(-s,-c),s),d=-h*h+f*(f+2*c)+l):f<=p?(h=0,f=Math.min(Math.max(-s,-c),s),d=f*(f+2*c)+l):(h=Math.max(0,-(o*s+a)),f=h>0?s:Math.min(Math.max(-s,-c),s),d=-h*h+f*(f+2*c)+l);else f=o>0?-s:s,h=Math.max(0,-(o*f+a)),d=-h*h+f*(f+2*c)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(Q3).addScaledVector(nR,f),d}intersectSphere(e,t){S0.subVectors(e.center,this.origin);const r=S0.dot(this.direction),i=S0.dot(S0)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,c=r+o;return c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,f=this.origin;return l>=0?(r=(e.min.x-f.x)*l,i=(e.max.x-f.x)*l):(r=(e.max.x-f.x)*l,i=(e.min.x-f.x)*l),u>=0?(s=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(s=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),r>o||s>i||((s>r||isNaN(r))&&(r=s),(o<i||isNaN(i))&&(i=o),h>=0?(a=(e.min.z-f.z)*h,c=(e.max.z-f.z)*h):(a=(e.max.z-f.z)*h,c=(e.min.z-f.z)*h),r>c||a>i)||((a>r||r!==r)&&(r=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,S0)!==null}intersectTriangle(e,t,r,i,s){eN.subVectors(t,e),rR.subVectors(r,e),tN.crossVectors(eN,rR);let o=this.direction.dot(tN),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;lv.subVectors(this.origin,e);const c=a*this.direction.dot(rR.crossVectors(lv,rR));if(c<0)return null;const l=a*this.direction.dot(eN.cross(lv));if(l<0||c+l>o)return null;const u=-a*lv.dot(tN);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class To{constructor(e,t,r,i,s,o,a,c,l,u,h,f,d,p,m,_){To.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,s,o,a,c,l,u,h,f,d,p,m,_)}set(e,t,r,i,s,o,a,c,l,u,h,f,d,p,m,_){const v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=i,v[1]=s,v[5]=o,v[9]=a,v[13]=c,v[2]=l,v[6]=u,v[10]=h,v[14]=f,v[3]=d,v[7]=p,v[11]=m,v[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new To().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/PS.setFromMatrixColumn(e,0).length(),s=1/PS.setFromMatrixColumn(e,1).length(),o=1/PS.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),c=Math.cos(i),l=Math.sin(i),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const f=o*u,d=o*h,p=a*u,m=a*h;t[0]=c*u,t[4]=-c*h,t[8]=l,t[1]=d+p*l,t[5]=f-m*l,t[9]=-a*c,t[2]=m-f*l,t[6]=p+d*l,t[10]=o*c}else if(e.order==="YXZ"){const f=c*u,d=c*h,p=l*u,m=l*h;t[0]=f+m*a,t[4]=p*a-d,t[8]=o*l,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=d*a-p,t[6]=m+f*a,t[10]=o*c}else if(e.order==="ZXY"){const f=c*u,d=c*h,p=l*u,m=l*h;t[0]=f-m*a,t[4]=-o*h,t[8]=p+d*a,t[1]=d+p*a,t[5]=o*u,t[9]=m-f*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){const f=o*u,d=o*h,p=a*u,m=a*h;t[0]=c*u,t[4]=p*l-d,t[8]=f*l+m,t[1]=c*h,t[5]=m*l+f,t[9]=d*l-p,t[2]=-l,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){const f=o*c,d=o*l,p=a*c,m=a*l;t[0]=c*u,t[4]=m-f*h,t[8]=p*h+d,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=d*h+p,t[10]=f-m*h}else if(e.order==="XZY"){const f=o*c,d=o*l,p=a*c,m=a*l;t[0]=c*u,t[4]=-h,t[8]=l*u,t[1]=f*h+m,t[5]=o*u,t[9]=d*h-p,t[2]=p*h-d,t[6]=a*u,t[10]=m*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_ce,e,vce)}lookAt(e,t,r){const i=this.elements;return rf.subVectors(e,t),rf.lengthSq()===0&&(rf.z=1),rf.normalize(),uv.crossVectors(r,rf),uv.lengthSq()===0&&(Math.abs(r.z)===1?rf.x+=1e-4:rf.z+=1e-4,rf.normalize(),uv.crossVectors(r,rf)),uv.normalize(),iR.crossVectors(rf,uv),i[0]=uv.x,i[4]=iR.x,i[8]=rf.x,i[1]=uv.y,i[5]=iR.y,i[9]=rf.y,i[2]=uv.z,i[6]=iR.z,i[10]=rf.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[4],c=r[8],l=r[12],u=r[1],h=r[5],f=r[9],d=r[13],p=r[2],m=r[6],_=r[10],v=r[14],S=r[3],b=r[7],T=r[11],w=r[15],R=i[0],C=i[4],N=i[8],U=i[12],B=i[1],$=i[5],I=i[9],L=i[13],P=i[2],H=i[6],X=i[10],G=i[14],Y=i[3],J=i[7],Q=i[11],z=i[15];return s[0]=o*R+a*B+c*P+l*Y,s[4]=o*C+a*$+c*H+l*J,s[8]=o*N+a*I+c*X+l*Q,s[12]=o*U+a*L+c*G+l*z,s[1]=u*R+h*B+f*P+d*Y,s[5]=u*C+h*$+f*H+d*J,s[9]=u*N+h*I+f*X+d*Q,s[13]=u*U+h*L+f*G+d*z,s[2]=p*R+m*B+_*P+v*Y,s[6]=p*C+m*$+_*H+v*J,s[10]=p*N+m*I+_*X+v*Q,s[14]=p*U+m*L+_*G+v*z,s[3]=S*R+b*B+T*P+w*Y,s[7]=S*C+b*$+T*H+w*J,s[11]=S*N+b*I+T*X+w*Q,s[15]=S*U+b*L+T*G+w*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],f=e[10],d=e[14],p=e[3],m=e[7],_=e[11],v=e[15];return p*(+s*c*h-i*l*h-s*a*f+r*l*f+i*a*d-r*c*d)+m*(+t*c*d-t*l*f+s*o*f-i*o*d+i*l*u-s*c*u)+_*(+t*l*h-t*a*d-s*o*h+r*o*d+s*a*u-r*l*u)+v*(-i*a*u-t*c*h+t*a*f+i*o*h-r*o*f+r*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],_=e[14],v=e[15],S=h*_*l-m*f*l+m*c*d-a*_*d-h*c*v+a*f*v,b=p*f*l-u*_*l-p*c*d+o*_*d+u*c*v-o*f*v,T=u*m*l-p*h*l+p*a*d-o*m*d-u*a*v+o*h*v,w=p*h*c-u*m*c-p*a*f+o*m*f+u*a*_-o*h*_,R=t*S+r*b+i*T+s*w;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/R;return e[0]=S*C,e[1]=(m*f*s-h*_*s-m*i*d+r*_*d+h*i*v-r*f*v)*C,e[2]=(a*_*s-m*c*s+m*i*l-r*_*l-a*i*v+r*c*v)*C,e[3]=(h*c*s-a*f*s-h*i*l+r*f*l+a*i*d-r*c*d)*C,e[4]=b*C,e[5]=(u*_*s-p*f*s+p*i*d-t*_*d-u*i*v+t*f*v)*C,e[6]=(p*c*s-o*_*s-p*i*l+t*_*l+o*i*v-t*c*v)*C,e[7]=(o*f*s-u*c*s+u*i*l-t*f*l-o*i*d+t*c*d)*C,e[8]=T*C,e[9]=(p*h*s-u*m*s-p*r*d+t*m*d+u*r*v-t*h*v)*C,e[10]=(o*m*s-p*a*s+p*r*l-t*m*l-o*r*v+t*a*v)*C,e[11]=(u*a*s-o*h*s-u*r*l+t*h*l+o*r*d-t*a*d)*C,e[12]=w*C,e[13]=(u*m*i-p*h*i+p*r*f-t*m*f-u*r*_+t*h*_)*C,e[14]=(p*a*i-o*m*i-p*r*c+t*m*c+o*r*_-t*a*_)*C,e[15]=(o*h*i-u*a*i+u*r*c-t*h*c-o*r*f+t*a*f)*C,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,o=e.x,a=e.y,c=e.z,l=s*o,u=s*a;return this.set(l*o+r,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+r,u*c-i*o,0,l*c-i*a,u*c+i*o,s*c*c+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,o=t._y,a=t._z,c=t._w,l=s+s,u=o+o,h=a+a,f=s*l,d=s*u,p=s*h,m=o*u,_=o*h,v=a*h,S=c*l,b=c*u,T=c*h,w=r.x,R=r.y,C=r.z;return i[0]=(1-(m+v))*w,i[1]=(d+T)*w,i[2]=(p-b)*w,i[3]=0,i[4]=(d-T)*R,i[5]=(1-(f+v))*R,i[6]=(_+S)*R,i[7]=0,i[8]=(p+b)*C,i[9]=(_-S)*C,i[10]=(1-(f+m))*C,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=PS.set(i[0],i[1],i[2]).length();const o=PS.set(i[4],i[5],i[6]).length(),a=PS.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Zd.copy(this);const l=1/s,u=1/o,h=1/a;return Zd.elements[0]*=l,Zd.elements[1]*=l,Zd.elements[2]*=l,Zd.elements[4]*=u,Zd.elements[5]*=u,Zd.elements[6]*=u,Zd.elements[8]*=h,Zd.elements[9]*=h,Zd.elements[10]*=h,t.setFromRotationMatrix(Zd),r.x=s,r.y=o,r.z=a,this}makePerspective(e,t,r,i,s,o,a=j0){const c=this.elements,l=2*s/(t-e),u=2*s/(r-i),h=(t+e)/(t-e),f=(r+i)/(r-i);let d,p;if(a===j0)d=-(o+s)/(o-s),p=-2*o*s/(o-s);else if(a===bM)d=-o/(o-s),p=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=h,c[12]=0,c[1]=0,c[5]=u,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=d,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,r,i,s,o,a=j0){const c=this.elements,l=1/(t-e),u=1/(r-i),h=1/(o-s),f=(t+e)*l,d=(r+i)*u;let p,m;if(a===j0)p=(o+s)*h,m=-2*h;else if(a===bM)p=s*h,m=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-d,c[2]=0,c[6]=0,c[10]=m,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const PS=new zt,Zd=new To,_ce=new zt(0,0,0),vce=new zt(1,1,1),uv=new zt,iR=new zt,rf=new zt,dF=new To,pF=new XA;class Xm{constructor(e=0,t=0,r=0,i=Xm.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],h=i[2],f=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Di(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Di(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Di(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Di(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Di(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Di(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return dF.makeRotationFromQuaternion(e),this.setFromRotationMatrix(dF,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return pF.setFromEuler(this),this.setFromQuaternion(pF,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Xm.DEFAULT_ORDER="XYZ";class Qw{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let yce=0;const mF=new zt,DS=new XA,E0=new To,sR=new zt,FT=new zt,bce=new zt,Sce=new XA,gF=new zt(1,0,0),_F=new zt(0,1,0),vF=new zt(0,0,1),yF={type:"added"},Ece={type:"removed"},LS={type:"childadded",child:null},nN={type:"childremoved",child:null};class Fc extends i_{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:yce++}),this.uuid=Bx(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Fc.DEFAULT_UP.clone();const e=new zt,t=new Xm,r=new XA,i=new zt(1,1,1);function s(){r.setFromEuler(t,!1)}function o(){t.setFromQuaternion(r,void 0,!1)}t._onChange(s),r._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new To},normalMatrix:{value:new pi}}),this.matrix=new To,this.matrixWorld=new To,this.matrixAutoUpdate=Fc.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Fc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Qw,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return DS.setFromAxisAngle(e,t),this.quaternion.multiply(DS),this}rotateOnWorldAxis(e,t){return DS.setFromAxisAngle(e,t),this.quaternion.premultiply(DS),this}rotateX(e){return this.rotateOnAxis(gF,e)}rotateY(e){return this.rotateOnAxis(_F,e)}rotateZ(e){return this.rotateOnAxis(vF,e)}translateOnAxis(e,t){return mF.copy(e).applyQuaternion(this.quaternion),this.position.add(mF.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(gF,e)}translateY(e){return this.translateOnAxis(_F,e)}translateZ(e){return this.translateOnAxis(vF,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(E0.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?sR.copy(e):sR.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),FT.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?E0.lookAt(FT,sR,this.up):E0.lookAt(sR,FT,this.up),this.quaternion.setFromRotationMatrix(E0),i&&(E0.extractRotation(i.matrixWorld),DS.setFromRotationMatrix(E0),this.quaternion.premultiply(DS.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(yF),LS.child=e,this.dispatchEvent(LS),LS.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Ece),nN.child=e,this.dispatchEvent(nN),nN.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),E0.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),E0.multiply(e.parent.matrixWorld)),e.applyMatrix4(E0),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(yF),LS.child=e,this.dispatchEvent(LS),LS.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(FT,e,bce),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(FT,Sce,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?{min:a.boundingBox.min.toArray(),max:a.boundingBox.max.toArray()}:void 0,boundingSphere:a.boundingSphere?{radius:a.boundingSphere.radius,center:a.boundingSphere.center.toArray()}:void 0})),i.instanceInfo=this._instanceInfo.map(a=>({...a})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const h=c[l];s(e.shapes,h)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(e.materials,this.material[c]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(e.animations,c))}}if(t){const a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),h=o(e.shapes),f=o(e.skeletons),d=o(e.animations),p=o(e.nodes);a.length>0&&(r.geometries=a),c.length>0&&(r.materials=c),l.length>0&&(r.textures=l),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),d.length>0&&(r.animations=d),p.length>0&&(r.nodes=p)}return r.object=i,r;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}Fc.DEFAULT_UP=new zt(0,1,0);Fc.DEFAULT_MATRIX_AUTO_UPDATE=!0;Fc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Jd=new zt,x0=new zt,rN=new zt,T0=new zt,US=new zt,BS=new zt,bF=new zt,iN=new zt,sN=new zt,oN=new zt,aN=new Xo,cN=new Xo,lN=new Xo;class fp{constructor(e=new zt,t=new zt,r=new zt){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),Jd.subVectors(e,t),i.cross(Jd);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){Jd.subVectors(i,t),x0.subVectors(r,t),rN.subVectors(e,t);const o=Jd.dot(Jd),a=Jd.dot(x0),c=Jd.dot(rN),l=x0.dot(x0),u=x0.dot(rN),h=o*l-a*a;if(h===0)return s.set(0,0,0),null;const f=1/h,d=(l*c-a*u)*f,p=(o*u-a*c)*f;return s.set(1-d-p,p,d)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,T0)===null?!1:T0.x>=0&&T0.y>=0&&T0.x+T0.y<=1}static getInterpolation(e,t,r,i,s,o,a,c){return this.getBarycoord(e,t,r,i,T0)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,T0.x),c.addScaledVector(o,T0.y),c.addScaledVector(a,T0.z),c)}static getInterpolatedAttribute(e,t,r,i,s,o){return aN.setScalar(0),cN.setScalar(0),lN.setScalar(0),aN.fromBufferAttribute(e,t),cN.fromBufferAttribute(e,r),lN.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(aN,s.x),o.addScaledVector(cN,s.y),o.addScaledVector(lN,s.z),o}static isFrontFacing(e,t,r,i){return Jd.subVectors(r,t),x0.subVectors(e,t),Jd.cross(x0).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Jd.subVectors(this.c,this.b),x0.subVectors(this.a,this.b),Jd.cross(x0).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return fp.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return fp.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,s){return fp.getInterpolation(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return fp.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return fp.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let o,a;US.subVectors(i,r),BS.subVectors(s,r),iN.subVectors(e,r);const c=US.dot(iN),l=BS.dot(iN);if(c<=0&&l<=0)return t.copy(r);sN.subVectors(e,i);const u=US.dot(sN),h=BS.dot(sN);if(u>=0&&h<=u)return t.copy(i);const f=c*h-u*l;if(f<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(r).addScaledVector(US,o);oN.subVectors(e,s);const d=US.dot(oN),p=BS.dot(oN);if(p>=0&&d<=p)return t.copy(s);const m=d*l-c*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(r).addScaledVector(BS,a);const _=u*p-d*h;if(_<=0&&h-u>=0&&d-p>=0)return bF.subVectors(s,i),a=(h-u)/(h-u+(d-p)),t.copy(i).addScaledVector(bF,a);const v=1/(_+m+f);return o=m*v,a=f*v,t.copy(r).addScaledVector(US,o).addScaledVector(BS,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const bW={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},hv={h:0,s:0,l:0},oR={h:0,s:0,l:0};function uN(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class Ti{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Fi){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Zi.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=Zi.workingColorSpace){return this.r=e,this.g=t,this.b=r,Zi.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=Zi.workingColorSpace){if(e=_5(e,1),t=Di(t,0,1),r=Di(r,0,1),t===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+t):r+t-r*t,o=2*r-s;this.r=uN(o,s,e+1/3),this.g=uN(o,s,e),this.b=uN(o,s,e-1/3)}return Zi.toWorkingColorSpace(this,i),this}setStyle(e,t=Fi){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Fi){const r=bW[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=V0(e.r),this.g=V0(e.g),this.b=V0(e.b),this}copyLinearToSRGB(e){return this.r=FE(e.r),this.g=FE(e.g),this.b=FE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Fi){return Zi.fromWorkingColorSpace(Il.copy(this),e),Math.round(Di(Il.r*255,0,255))*65536+Math.round(Di(Il.g*255,0,255))*256+Math.round(Di(Il.b*255,0,255))}getHexString(e=Fi){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Zi.workingColorSpace){Zi.fromWorkingColorSpace(Il.copy(this),t);const r=Il.r,i=Il.g,s=Il.b,o=Math.max(r,i,s),a=Math.min(r,i,s);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case r:c=(i-s)/h+(i<s?6:0);break;case i:c=(s-r)/h+2;break;case s:c=(r-i)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,t=Zi.workingColorSpace){return Zi.fromWorkingColorSpace(Il.copy(this),t),e.r=Il.r,e.g=Il.g,e.b=Il.b,e}getStyle(e=Fi){Zi.fromWorkingColorSpace(Il.copy(this),e);const t=Il.r,r=Il.g,i=Il.b;return e!==Fi?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(hv),this.setHSL(hv.h+e,hv.s+t,hv.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(hv),e.getHSL(oR);const r=Pw(hv.h,oR.h,t),i=Pw(hv.s,oR.s,t),s=Pw(hv.l,oR.l,t);return this.setHSL(r,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*r+s[6]*i,this.g=s[1]*t+s[4]*r+s[7]*i,this.b=s[2]*t+s[5]*r+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Il=new Ti;Ti.NAMES=bW;let xce=0;class m1 extends i_{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:xce++}),this.uuid=Bx(),this.name="",this.type="Material",this.blending=BE,this.side=X0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=RD,this.blendDst=kD,this.blendEquation=_b,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ti(0,0,0),this.blendAlpha=0,this.depthFunc=ZE,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=sF,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kS,this.stencilZFail=kS,this.stencilZPass=kS,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==BE&&(r.blending=this.blending),this.side!==X0&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==RD&&(r.blendSrc=this.blendSrc),this.blendDst!==kD&&(r.blendDst=this.blendDst),this.blendEquation!==_b&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==ZE&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==sF&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==kS&&(r.stencilFail=this.stencilFail),this.stencilZFail!==kS&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==kS&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(t){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class b5 extends m1{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ti(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Xm,this.combine=aW,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Fa=new zt,aR=new zn;let Tce=0;class Eh{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Tce++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=oF,this.updateRanges=[],this.gpuType=dp,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)aR.fromBufferAttribute(this,t),aR.applyMatrix3(e),this.setXY(t,aR.x,aR.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)Fa.fromBufferAttribute(this,t),Fa.applyMatrix3(e),this.setXYZ(t,Fa.x,Fa.y,Fa.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Fa.fromBufferAttribute(this,t),Fa.applyMatrix4(e),this.setXYZ(t,Fa.x,Fa.y,Fa.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Fa.fromBufferAttribute(this,t),Fa.applyNormalMatrix(e),this.setXYZ(t,Fa.x,Fa.y,Fa.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Fa.fromBufferAttribute(this,t),Fa.transformDirection(e),this.setXYZ(t,Fa.x,Fa.y,Fa.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=dE(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=cu(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=dE(t,this.array)),t}setX(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=dE(t,this.array)),t}setY(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=dE(t,this.array)),t}setZ(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=dE(t,this.array)),t}setW(e,t){return this.normalized&&(t=cu(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),r=cu(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),r=cu(r,this.array),i=cu(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return e*=this.itemSize,this.normalized&&(t=cu(t,this.array),r=cu(r,this.array),i=cu(i,this.array),s=cu(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==oF&&(e.usage=this.usage),e}}class SW extends Eh{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class EW extends Eh{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Ib extends Eh{constructor(e,t,r){super(new Float32Array(e),t,r)}}let wce=0;const Gf=new To,hN=new Fc,FS=new zt,sf=new p1,jT=new p1,Mc=new zt;class ag extends i_{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:wce++}),this.uuid=Bx(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vW(e)?EW:SW)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new pi().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Gf.makeRotationFromQuaternion(e),this.applyMatrix4(Gf),this}rotateX(e){return Gf.makeRotationX(e),this.applyMatrix4(Gf),this}rotateY(e){return Gf.makeRotationY(e),this.applyMatrix4(Gf),this}rotateZ(e){return Gf.makeRotationZ(e),this.applyMatrix4(Gf),this}translate(e,t,r){return Gf.makeTranslation(e,t,r),this.applyMatrix4(Gf),this}scale(e,t,r){return Gf.makeScale(e,t,r),this.applyMatrix4(Gf),this}lookAt(e){return hN.lookAt(e),hN.updateMatrix(),this.applyMatrix4(hN.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(FS).negate(),this.translate(FS.x,FS.y,FS.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const r=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];r.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Ib(r,3))}else{const r=Math.min(e.length,t.count);for(let i=0;i<r;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new p1);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new zt(-1/0,-1/0,-1/0),new zt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const s=t[r];sf.setFromBufferAttribute(s),this.morphTargetsRelative?(Mc.addVectors(this.boundingBox.min,sf.min),this.boundingBox.expandByPoint(Mc),Mc.addVectors(this.boundingBox.max,sf.max),this.boundingBox.expandByPoint(Mc)):(this.boundingBox.expandByPoint(sf.min),this.boundingBox.expandByPoint(sf.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Fx);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new zt,1/0);return}if(e){const r=this.boundingSphere.center;if(sf.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];jT.setFromBufferAttribute(a),this.morphTargetsRelative?(Mc.addVectors(sf.min,jT.min),sf.expandByPoint(Mc),Mc.addVectors(sf.max,jT.max),sf.expandByPoint(Mc)):(sf.expandByPoint(jT.min),sf.expandByPoint(jT.max))}sf.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)Mc.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(Mc));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Mc.fromBufferAttribute(a,l),c&&(FS.fromBufferAttribute(e,l),Mc.add(FS)),i=Math.max(i,r.distanceToSquared(Mc))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Eh(new Float32Array(4*r.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let N=0;N<r.count;N++)a[N]=new zt,c[N]=new zt;const l=new zt,u=new zt,h=new zt,f=new zn,d=new zn,p=new zn,m=new zt,_=new zt;function v(N,U,B){l.fromBufferAttribute(r,N),u.fromBufferAttribute(r,U),h.fromBufferAttribute(r,B),f.fromBufferAttribute(s,N),d.fromBufferAttribute(s,U),p.fromBufferAttribute(s,B),u.sub(l),h.sub(l),d.sub(f),p.sub(f);const $=1/(d.x*p.y-p.x*d.y);isFinite($)&&(m.copy(u).multiplyScalar(p.y).addScaledVector(h,-d.y).multiplyScalar($),_.copy(h).multiplyScalar(d.x).addScaledVector(u,-p.x).multiplyScalar($),a[N].add(m),a[U].add(m),a[B].add(m),c[N].add(_),c[U].add(_),c[B].add(_))}let S=this.groups;S.length===0&&(S=[{start:0,count:e.count}]);for(let N=0,U=S.length;N<U;++N){const B=S[N],$=B.start,I=B.count;for(let L=$,P=$+I;L<P;L+=3)v(e.getX(L+0),e.getX(L+1),e.getX(L+2))}const b=new zt,T=new zt,w=new zt,R=new zt;function C(N){w.fromBufferAttribute(i,N),R.copy(w);const U=a[N];b.copy(U),b.sub(w.multiplyScalar(w.dot(U))).normalize(),T.crossVectors(R,U);const $=T.dot(c[N])<0?-1:1;o.setXYZW(N,b.x,b.y,b.z,$)}for(let N=0,U=S.length;N<U;++N){const B=S[N],$=B.start,I=B.count;for(let L=$,P=$+I;L<P;L+=3)C(e.getX(L+0)),C(e.getX(L+1)),C(e.getX(L+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Eh(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let f=0,d=r.count;f<d;f++)r.setXYZ(f,0,0,0);const i=new zt,s=new zt,o=new zt,a=new zt,c=new zt,l=new zt,u=new zt,h=new zt;if(e)for(let f=0,d=e.count;f<d;f+=3){const p=e.getX(f+0),m=e.getX(f+1),_=e.getX(f+2);i.fromBufferAttribute(t,p),s.fromBufferAttribute(t,m),o.fromBufferAttribute(t,_),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),a.fromBufferAttribute(r,p),c.fromBufferAttribute(r,m),l.fromBufferAttribute(r,_),a.add(u),c.add(u),l.add(u),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(m,c.x,c.y,c.z),r.setXYZ(_,l.x,l.y,l.z)}else for(let f=0,d=t.count;f<d;f+=3)i.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),u.subVectors(o,s),h.subVectors(i,s),u.cross(h),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Mc.fromBufferAttribute(e,t),Mc.normalize(),e.setXYZ(t,Mc.x,Mc.y,Mc.z)}toNonIndexed(){function e(a,c){const l=a.array,u=a.itemSize,h=a.normalized,f=new l.constructor(c.length*u);let d=0,p=0;for(let m=0,_=c.length;m<_;m++){a.isInterleavedBufferAttribute?d=c[m]*a.data.stride+a.offset:d=c[m]*u;for(let v=0;v<u;v++)f[p++]=l[d++]}return new Eh(f,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ag,r=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=e(c,r);t.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let u=0,h=l.length;u<h;u++){const f=l[u],d=e(f,r);c.push(d)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const c in r){const l=r[c];e.data.attributes[c]=l.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let h=0,f=l.length;h<f;h++){const d=l[h];u.push(d.toJSON(e.data))}u.length>0&&(i[c]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(t))}const s=e.morphAttributes;for(const l in s){const u=[],h=s[l];for(let f=0,d=h.length;f<d;f++)u.push(h[f].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,u=o.length;l<u;l++){const h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const SF=new To,qy=new y5,cR=new Fx,EF=new zt,lR=new zt,uR=new zt,hR=new zt,fN=new zt,fR=new zt,xF=new zt,dR=new zt;class df extends Fc{constructor(e=new ag,t=new b5){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,s=r.morphAttributes.position,o=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){fR.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const u=a[c],h=s[c];u!==0&&(fN.fromBufferAttribute(h,e),o?fR.addScaledVector(fN,u):fR.addScaledVector(fN.sub(t),u))}t.add(fR)}return t}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),cR.copy(r.boundingSphere),cR.applyMatrix4(s),qy.copy(e.ray).recast(e.near),!(cR.containsPoint(qy.origin)===!1&&(qy.intersectSphere(cR,EF)===null||qy.origin.distanceToSquared(EF)>(e.far-e.near)**2))&&(SF.copy(s).invert(),qy.copy(e.ray).applyMatrix4(SF),!(r.boundingBox!==null&&qy.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,qy)))}_computeIntersections(e,t,r){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,f=s.groups,d=s.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,m=f.length;p<m;p++){const _=f[p],v=o[_.materialIndex],S=Math.max(_.start,d.start),b=Math.min(a.count,Math.min(_.start+_.count,d.start+d.count));for(let T=S,w=b;T<w;T+=3){const R=a.getX(T),C=a.getX(T+1),N=a.getX(T+2);i=pR(this,v,e,r,l,u,h,R,C,N),i&&(i.faceIndex=Math.floor(T/3),i.face.materialIndex=_.materialIndex,t.push(i))}}else{const p=Math.max(0,d.start),m=Math.min(a.count,d.start+d.count);for(let _=p,v=m;_<v;_+=3){const S=a.getX(_),b=a.getX(_+1),T=a.getX(_+2);i=pR(this,o,e,r,l,u,h,S,b,T),i&&(i.faceIndex=Math.floor(_/3),t.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let p=0,m=f.length;p<m;p++){const _=f[p],v=o[_.materialIndex],S=Math.max(_.start,d.start),b=Math.min(c.count,Math.min(_.start+_.count,d.start+d.count));for(let T=S,w=b;T<w;T+=3){const R=T,C=T+1,N=T+2;i=pR(this,v,e,r,l,u,h,R,C,N),i&&(i.faceIndex=Math.floor(T/3),i.face.materialIndex=_.materialIndex,t.push(i))}}else{const p=Math.max(0,d.start),m=Math.min(c.count,d.start+d.count);for(let _=p,v=m;_<v;_+=3){const S=_,b=_+1,T=_+2;i=pR(this,o,e,r,l,u,h,S,b,T),i&&(i.faceIndex=Math.floor(_/3),t.push(i))}}}}function Ace(n,e,t,r,i,s,o,a){let c;if(e.side===Uc?c=r.intersectTriangle(o,s,i,!0,a):c=r.intersectTriangle(i,s,o,e.side===X0,a),c===null)return null;dR.copy(a),dR.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(dR);return l<t.near||l>t.far?null:{distance:l,point:dR.clone(),object:n}}function pR(n,e,t,r,i,s,o,a,c,l){n.getVertexPosition(a,lR),n.getVertexPosition(c,uR),n.getVertexPosition(l,hR);const u=Ace(n,e,t,r,lR,uR,hR,xF);if(u){const h=new zt;fp.getBarycoord(xF,lR,uR,hR,h),i&&(u.uv=fp.getInterpolatedAttribute(i,a,c,l,h,new zn)),s&&(u.uv1=fp.getInterpolatedAttribute(s,a,c,l,h,new zn)),o&&(u.normal=fp.getInterpolatedAttribute(o,a,c,l,h,new zt),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const f={a,b:c,c:l,normal:new zt,materialIndex:0};fp.getNormal(lR,uR,hR,f.normal),u.face=f,u.barycoord=h}return u}class jx extends ag{constructor(e=1,t=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],u=[],h=[];let f=0,d=0;p("z","y","x",-1,-1,r,t,e,o,s,0),p("z","y","x",1,-1,r,t,-e,o,s,1),p("x","z","y",1,1,e,r,t,i,o,2),p("x","z","y",1,-1,e,r,-t,i,o,3),p("x","y","z",1,-1,e,t,r,i,s,4),p("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(c),this.setAttribute("position",new Ib(l,3)),this.setAttribute("normal",new Ib(u,3)),this.setAttribute("uv",new Ib(h,2));function p(m,_,v,S,b,T,w,R,C,N,U){const B=T/C,$=w/N,I=T/2,L=w/2,P=R/2,H=C+1,X=N+1;let G=0,Y=0;const J=new zt;for(let Q=0;Q<X;Q++){const z=Q*$-L;for(let q=0;q<H;q++){const ee=q*B-I;J[m]=ee*S,J[_]=z*b,J[v]=P,l.push(J.x,J.y,J.z),J[m]=0,J[_]=0,J[v]=R>0?1:-1,u.push(J.x,J.y,J.z),h.push(q/C),h.push(1-Q/N),G+=1}}for(let Q=0;Q<N;Q++)for(let z=0;z<C;z++){const q=f+z+H*Q,ee=f+z+H*(Q+1),te=f+(z+1)+H*(Q+1),ie=f+(z+1)+H*Q;c.push(q,ee,ie),c.push(ee,te,ie),Y+=6}a.addGroup(d,Y,U),d+=Y,f+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jx(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function nx(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function lu(n){const e={};for(let t=0;t<n.length;t++){const r=nx(n[t]);for(const i in r)e[i]=r[i]}return e}function Cce(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function xW(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Zi.workingColorSpace}const Rce={clone:nx,merge:lu};var kce=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Mce=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class lo extends m1{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=kce,this.fragmentShader=Mce,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=nx(e.uniforms),this.uniformsGroups=Cce(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class TW extends Fc{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new To,this.projectionMatrix=new To,this.projectionMatrixInverse=new To,this.coordinateSystem=j0}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const fv=new zt,TF=new zn,wF=new zn;class du extends TW{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Zw*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Nw*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Zw*2*Math.atan(Math.tan(Nw*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){fv.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(fv.x,fv.y).multiplyScalar(-e/fv.z),fv.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(fv.x,fv.y).multiplyScalar(-e/fv.z)}getViewSize(e,t){return this.getViewBounds(e,TF,wF),t.subVectors(wF,TF)}setViewOffset(e,t,r,i,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Nw*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,t-=o.offsetY*r/l,i*=o.width/c,r*=o.height/l}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const jS=-90,zS=1;class Ice extends Fc{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new du(jS,zS,e,t);i.layers=this.layers,this.add(i);const s=new du(jS,zS,e,t);s.layers=this.layers,this.add(s);const o=new du(jS,zS,e,t);o.layers=this.layers,this.add(o);const a=new du(jS,zS,e,t);a.layers=this.layers,this.add(a);const c=new du(jS,zS,e,t);c.layers=this.layers,this.add(c);const l=new du(jS,zS,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,s,o,a,c]=t;for(const l of t)this.remove(l);if(e===j0)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===bM)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,u]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const m=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,s),e.setRenderTarget(r,1,i),e.render(t,o),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,c),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=m,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(h,f,d),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class wW extends pc{constructor(e=[],t=JE,r,i,s,o,a,c,l,u){super(e,t,r,i,s,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Oce extends hl{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new wW(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Bl}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new jx(5,5,5),s=new lo({name:"CubemapFromEquirect",uniforms:nx(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Uc,blending:ul});s.uniforms.tEquirect.value=t;const o=new df(i,s),a=t.minFilter;return t.minFilter===Tb&&(t.minFilter=Bl),new Ice(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,r=!0,i=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,r,i);e.setRenderTarget(s)}}class Ew extends Fc{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Nce={type:"move"};class dN{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ew,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ew,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new zt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new zt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ew,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new zt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new zt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const m of e.hand.values()){const _=t.getJointPose(m,r),v=this._getHandJoint(l,m);_!==null&&(v.matrix.fromArray(_.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=_.radius),v.visible=_!==null}const u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],f=u.position.distanceTo(h.position),d=.02,p=.005;l.inputState.pinching&&f>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Nce)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new Ew;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class SM extends Fc{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Xm,this.environmentIntensity=1,this.environmentRotation=new Xm,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class nO extends pc{constructor(e=null,t=1,r=1,i,s,o,a,c,l=jl,u=jl,h,f){super(null,o,a,c,l,u,i,s,h,f),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class hL extends Eh{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const $S=new To,AF=new To,mR=[],CF=new p1,Pce=new To,zT=new df,$T=new Fx;class Dce extends df{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new hL(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,Pce)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new p1),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,$S),CF.copy(e.boundingBox).applyMatrix4($S),this.boundingBox.union(CF)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Fx),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,$S),$T.copy(e.boundingSphere).applyMatrix4($S),this.boundingSphere.union($T)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const r=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=r.length+1,o=e*s+1;for(let a=0;a<r.length;a++)r[a]=i[o+a]}raycast(e,t){const r=this.matrixWorld,i=this.count;if(zT.geometry=this.geometry,zT.material=this.material,zT.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),$T.copy(this.boundingSphere),$T.applyMatrix4(r),e.ray.intersectsSphere($T)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,$S),AF.multiplyMatrices(r,$S),zT.matrixWorld=AF,zT.raycast(e,mR);for(let o=0,a=mR.length;o<a;o++){const c=mR[o];c.instanceId=s,c.object=this,t.push(c)}mR.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new hL(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const r=t.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new nO(new Float32Array(i*this.count),i,this.count,KA,dp));const s=this.morphTexture.source.data.data;let o=0;for(let l=0;l<r.length;l++)o+=r[l];const a=this.geometry.morphTargetsRelative?1:1-o,c=i*e;s[c]=a,s.set(r,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const pN=new zt,Lce=new zt,Uce=new pi;let ub=class{constructor(e=new zt(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=pN.subVectors(r,t).cross(Lce.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(pN),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||Uce.getNormalMatrix(e),i=this.coplanarPoint(pN).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Yy=new Fx,gR=new zt;class AW{constructor(e=new ub,t=new ub,r=new ub,i=new ub,s=new ub,o=new ub){this.planes=[e,t,r,i,s,o]}set(e,t,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=j0){const r=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],h=i[6],f=i[7],d=i[8],p=i[9],m=i[10],_=i[11],v=i[12],S=i[13],b=i[14],T=i[15];if(r[0].setComponents(c-s,f-l,_-d,T-v).normalize(),r[1].setComponents(c+s,f+l,_+d,T+v).normalize(),r[2].setComponents(c+o,f+u,_+p,T+S).normalize(),r[3].setComponents(c-o,f-u,_-p,T-S).normalize(),r[4].setComponents(c-a,f-h,_-m,T-b).normalize(),t===j0)r[5].setComponents(c+a,f+h,_+m,T+b).normalize();else if(t===bM)r[5].setComponents(a,h,m,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Yy.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Yy.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Yy)}intersectsSprite(e){return Yy.center.set(0,0,0),Yy.radius=.7071067811865476,Yy.applyMatrix4(e.matrixWorld),this.intersectsSphere(Yy)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(gR.x=i.normal.x>0?e.max.x:e.min.x,gR.y=i.normal.y>0?e.max.y:e.min.y,gR.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(gR)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Bce extends m1{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ti(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const RF=new To,fL=new y5,_R=new Fx,vR=new zt;class Fce extends Fc{constructor(e=new ag,t=new Bce){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),_R.copy(r.boundingSphere),_R.applyMatrix4(i),_R.radius+=s,e.ray.intersectsSphere(_R)===!1)return;RF.copy(i).invert(),fL.copy(e.ray).applyMatrix4(RF);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=r.index,h=r.attributes.position;if(l!==null){const f=Math.max(0,o.start),d=Math.min(l.count,o.start+o.count);for(let p=f,m=d;p<m;p++){const _=l.getX(p);vR.fromBufferAttribute(h,_),kF(vR,_,c,i,e,t,this)}}else{const f=Math.max(0,o.start),d=Math.min(h.count,o.start+o.count);for(let p=f,m=d;p<m;p++)vR.fromBufferAttribute(h,p),kF(vR,p,c,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function kF(n,e,t,r,i,s,o){const a=fL.distanceSqToPoint(n);if(a<t){const c=new zt;fL.closestPointToPoint(n,c),c.applyMatrix4(r);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class jce extends pc{constructor(e,t,r,i,s,o,a,c,l){super(e,t,r,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class rO extends pc{constructor(e,t,r=jv,i,s,o,a=jl,c=jl,l,u=Xw){if(u!==Xw&&u!==tx)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,s,o,a,c,u,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new v5(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class ZA extends ag{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(r),c=Math.floor(i),l=a+1,u=c+1,h=e/a,f=t/c,d=[],p=[],m=[],_=[];for(let v=0;v<u;v++){const S=v*f-o;for(let b=0;b<l;b++){const T=b*h-s;p.push(T,-S,0),m.push(0,0,1),_.push(b/a),_.push(1-v/c)}}for(let v=0;v<c;v++)for(let S=0;S<a;S++){const b=S+l*v,T=S+l*(v+1),w=S+1+l*(v+1),R=S+1+l*v;d.push(b,T,R),d.push(T,w,R)}this.setIndex(d),this.setAttribute("position",new Ib(p,3)),this.setAttribute("normal",new Ib(m,3)),this.setAttribute("uv",new Ib(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ZA(e.width,e.height,e.widthSegments,e.heightSegments)}}class zce extends m1{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=d1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class $ce extends m1{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const MF={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Vce{constructor(e,t,r){const i=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){a++,s===!1&&i.onStart!==void 0&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,i.onProgress!==void 0&&i.onProgress(u,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){const h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,f=l.length;h<f;h+=2){const d=l[h],p=l[h+1];if(d.global&&(d.lastIndex=0),d.test(u))return p}return null}}}const Hce=new Vce;class S5{constructor(e){this.manager=e!==void 0?e:Hce,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,s){r.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}S5.DEFAULT_MATERIAL_NAME="__DEFAULT";class Gce extends S5{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=MF.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=Jw("img");function c(){u(),MF.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(h){u(),i&&i(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class Wce extends S5{constructor(e){super(e)}load(e,t,r,i){const s=new pc,o=new Gce(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},r,i),s}}let iO=class extends TW{constructor(e=-1,t=1,r=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+t,c=i-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};class qce extends du{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}let Yce=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=IF(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=IF();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function IF(){return performance.now()}class hn{constructor(e){this.value=e}clone(){return new hn(this.value.clone===void 0?this.value:this.value.clone())}}const OF=new To;class CW{constructor(e,t,r=0,i=1/0){this.ray=new y5(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Qw,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return OF.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(OF),this}intersectObject(e,t=!0,r=[]){return dL(e,this,r,t),r.sort(NF),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)dL(e[i],this,r,t);return r.sort(NF),r}}function NF(n,e){return n.distance-e.distance}function dL(n,e,t,r){let i=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(i=!1),i===!0&&r===!0){const s=n.children;for(let o=0,a=s.length;o<a;o++)dL(s[o],e,t,!0)}}const PF=new zn;class Kce{constructor(e=new zn(1/0,1/0),t=new zn(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=PF.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,PF).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function DF(n,e,t,r){const i=Xce(r);switch(t){case dW:return n*e;case KA:return n*e/i.components*i.byteLength;case p5:return n*e/i.components*i.byteLength;case m5:return n*e*2/i.components*i.byteLength;case g5:return n*e*2/i.components*i.byteLength;case pW:return n*e*3/i.components*i.byteLength;case _u:return n*e*4/i.components*i.byteLength;case tO:return n*e*4/i.components*i.byteLength;case Tk:case wk:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Ak:case Ck:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case jD:case $D:return Math.max(n,16)*Math.max(e,8)/4;case FD:case zD:return Math.max(n,8)*Math.max(e,8)/2;case VD:case HD:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case GD:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case WD:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case qD:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case YD:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case KD:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case XD:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case ZD:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case JD:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case QD:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case eL:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case tL:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case nL:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case rL:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case iL:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case sL:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Rk:case oL:case aL:return Math.ceil(n/4)*Math.ceil(e/4)*16;case mW:case cL:return Math.ceil(n/4)*Math.ceil(e/4)*8;case lL:case uL:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Xce(n){switch(n){case Oo:case uW:return{byteLength:1,components:1};case Kw:case hW:case Zv:return{byteLength:2,components:1};case f5:case d5:return{byteLength:2,components:4};case jv:case h5:case dp:return{byteLength:4,components:1};case fW:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:YA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=YA);function RW(){let n=null,e=!1,t=null,r=null;function i(s,o){t(s,o),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function Zce(n){const e=new WeakMap;function t(a,c){const l=a.array,u=a.usage,h=l.byteLength,f=n.createBuffer();n.bindBuffer(c,f),n.bufferData(c,l,u),a.onUploadCallback();let d;if(l instanceof Float32Array)d=n.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?d=n.HALF_FLOAT:d=n.UNSIGNED_SHORT;else if(l instanceof Int16Array)d=n.SHORT;else if(l instanceof Uint32Array)d=n.UNSIGNED_INT;else if(l instanceof Int32Array)d=n.INT;else if(l instanceof Int8Array)d=n.BYTE;else if(l instanceof Uint8Array)d=n.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)d=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:f,type:d,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:h}}function r(a,c,l){const u=c.array,h=c.updateRanges;if(n.bindBuffer(l,a),h.length===0)n.bufferSubData(l,0,u);else{h.sort((d,p)=>d.start-p.start);let f=0;for(let d=1;d<h.length;d++){const p=h[f],m=h[d];m.start<=p.start+p.count+1?p.count=Math.max(p.count,m.start+m.count-p.start):(++f,h[f]=m)}h.length=f+1;for(let d=0,p=h.length;d<p;d++){const m=h[d];n.bufferSubData(l,m.start*u.BYTES_PER_ELEMENT,u,m.start,m.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(n.deleteBuffer(c.buffer),e.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=e.get(a);if(l===void 0)e.set(a,t(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}var Jce=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Qce=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,ele=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,tle=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,nle=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,rle=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ile=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,sle=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ole=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,ale=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,cle=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,lle=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ule=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,hle=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,fle=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,dle=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,ple=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,mle=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,gle=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,_le=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,vle=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,yle=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,ble=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Sle=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Ele=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,xle=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Tle=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,wle=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Ale=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Cle=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Rle="gl_FragColor = linearToOutputTexel( gl_FragColor );",kle=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Mle=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Ile=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Ole=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Nle=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Ple=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Dle=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Lle=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Ule=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Ble=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Fle=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,jle=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,zle=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,$le=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Vle=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Hle=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Gle=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Wle=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,qle=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Yle=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Kle=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Xle=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Zle=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Jle=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Qle=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,eue=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,tue=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,nue=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,rue=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,iue=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,sue=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,oue=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,aue=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,cue=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,lue=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,uue=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,hue=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,fue=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,due=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,pue=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,mue=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,gue=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,_ue=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,vue=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,yue=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,bue=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Sue=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Eue=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,xue=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Tue=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,wue=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Aue=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Cue=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Rue=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,kue=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Mue=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Iue=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Oue=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Nue=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Pue=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Due=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Lue=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Uue=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Bue=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Fue=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,jue=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,zue=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,$ue=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Vue=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Hue=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Gue=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Wue=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,que=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Yue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Kue=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Xue=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Zue=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Jue=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Que=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ehe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,the=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,nhe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,rhe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,ihe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,she=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,ohe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,ahe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,che=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lhe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,uhe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,hhe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fhe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dhe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,phe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mhe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ghe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_he=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,vhe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,yhe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,bhe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,She=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Ehe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xhe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,The=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,whe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Ahe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Che=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Rhe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,khe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Mhe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vi={alphahash_fragment:Jce,alphahash_pars_fragment:Qce,alphamap_fragment:ele,alphamap_pars_fragment:tle,alphatest_fragment:nle,alphatest_pars_fragment:rle,aomap_fragment:ile,aomap_pars_fragment:sle,batching_pars_vertex:ole,batching_vertex:ale,begin_vertex:cle,beginnormal_vertex:lle,bsdfs:ule,iridescence_fragment:hle,bumpmap_pars_fragment:fle,clipping_planes_fragment:dle,clipping_planes_pars_fragment:ple,clipping_planes_pars_vertex:mle,clipping_planes_vertex:gle,color_fragment:_le,color_pars_fragment:vle,color_pars_vertex:yle,color_vertex:ble,common:Sle,cube_uv_reflection_fragment:Ele,defaultnormal_vertex:xle,displacementmap_pars_vertex:Tle,displacementmap_vertex:wle,emissivemap_fragment:Ale,emissivemap_pars_fragment:Cle,colorspace_fragment:Rle,colorspace_pars_fragment:kle,envmap_fragment:Mle,envmap_common_pars_fragment:Ile,envmap_pars_fragment:Ole,envmap_pars_vertex:Nle,envmap_physical_pars_fragment:Hle,envmap_vertex:Ple,fog_vertex:Dle,fog_pars_vertex:Lle,fog_fragment:Ule,fog_pars_fragment:Ble,gradientmap_pars_fragment:Fle,lightmap_pars_fragment:jle,lights_lambert_fragment:zle,lights_lambert_pars_fragment:$le,lights_pars_begin:Vle,lights_toon_fragment:Gle,lights_toon_pars_fragment:Wle,lights_phong_fragment:qle,lights_phong_pars_fragment:Yle,lights_physical_fragment:Kle,lights_physical_pars_fragment:Xle,lights_fragment_begin:Zle,lights_fragment_maps:Jle,lights_fragment_end:Qle,logdepthbuf_fragment:eue,logdepthbuf_pars_fragment:tue,logdepthbuf_pars_vertex:nue,logdepthbuf_vertex:rue,map_fragment:iue,map_pars_fragment:sue,map_particle_fragment:oue,map_particle_pars_fragment:aue,metalnessmap_fragment:cue,metalnessmap_pars_fragment:lue,morphinstance_vertex:uue,morphcolor_vertex:hue,morphnormal_vertex:fue,morphtarget_pars_vertex:due,morphtarget_vertex:pue,normal_fragment_begin:mue,normal_fragment_maps:gue,normal_pars_fragment:_ue,normal_pars_vertex:vue,normal_vertex:yue,normalmap_pars_fragment:bue,clearcoat_normal_fragment_begin:Sue,clearcoat_normal_fragment_maps:Eue,clearcoat_pars_fragment:xue,iridescence_pars_fragment:Tue,opaque_fragment:wue,packing:Aue,premultiplied_alpha_fragment:Cue,project_vertex:Rue,dithering_fragment:kue,dithering_pars_fragment:Mue,roughnessmap_fragment:Iue,roughnessmap_pars_fragment:Oue,shadowmap_pars_fragment:Nue,shadowmap_pars_vertex:Pue,shadowmap_vertex:Due,shadowmask_pars_fragment:Lue,skinbase_vertex:Uue,skinning_pars_vertex:Bue,skinning_vertex:Fue,skinnormal_vertex:jue,specularmap_fragment:zue,specularmap_pars_fragment:$ue,tonemapping_fragment:Vue,tonemapping_pars_fragment:Hue,transmission_fragment:Gue,transmission_pars_fragment:Wue,uv_pars_fragment:que,uv_pars_vertex:Yue,uv_vertex:Kue,worldpos_vertex:Xue,background_vert:Zue,background_frag:Jue,backgroundCube_vert:Que,backgroundCube_frag:ehe,cube_vert:the,cube_frag:nhe,depth_vert:rhe,depth_frag:ihe,distanceRGBA_vert:she,distanceRGBA_frag:ohe,equirect_vert:ahe,equirect_frag:che,linedashed_vert:lhe,linedashed_frag:uhe,meshbasic_vert:hhe,meshbasic_frag:fhe,meshlambert_vert:dhe,meshlambert_frag:phe,meshmatcap_vert:mhe,meshmatcap_frag:ghe,meshnormal_vert:_he,meshnormal_frag:vhe,meshphong_vert:yhe,meshphong_frag:bhe,meshphysical_vert:She,meshphysical_frag:Ehe,meshtoon_vert:xhe,meshtoon_frag:The,points_vert:whe,points_frag:Ahe,shadow_vert:Che,shadow_frag:Rhe,sprite_vert:khe,sprite_frag:Mhe},qn={common:{diffuse:{value:new Ti(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new pi},alphaMap:{value:null},alphaMapTransform:{value:new pi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new pi}},envmap:{envMap:{value:null},envMapRotation:{value:new pi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new pi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new pi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new pi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new pi},normalScale:{value:new zn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new pi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new pi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new pi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new pi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ti(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ti(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new pi},alphaTest:{value:0},uvTransform:{value:new pi}},sprite:{diffuse:{value:new Ti(16777215)},opacity:{value:1},center:{value:new zn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new pi},alphaMap:{value:null},alphaMapTransform:{value:new pi},alphaTest:{value:0}}},Rm={basic:{uniforms:lu([qn.common,qn.specularmap,qn.envmap,qn.aomap,qn.lightmap,qn.fog]),vertexShader:vi.meshbasic_vert,fragmentShader:vi.meshbasic_frag},lambert:{uniforms:lu([qn.common,qn.specularmap,qn.envmap,qn.aomap,qn.lightmap,qn.emissivemap,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.fog,qn.lights,{emissive:{value:new Ti(0)}}]),vertexShader:vi.meshlambert_vert,fragmentShader:vi.meshlambert_frag},phong:{uniforms:lu([qn.common,qn.specularmap,qn.envmap,qn.aomap,qn.lightmap,qn.emissivemap,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.fog,qn.lights,{emissive:{value:new Ti(0)},specular:{value:new Ti(1118481)},shininess:{value:30}}]),vertexShader:vi.meshphong_vert,fragmentShader:vi.meshphong_frag},standard:{uniforms:lu([qn.common,qn.envmap,qn.aomap,qn.lightmap,qn.emissivemap,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.roughnessmap,qn.metalnessmap,qn.fog,qn.lights,{emissive:{value:new Ti(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:vi.meshphysical_vert,fragmentShader:vi.meshphysical_frag},toon:{uniforms:lu([qn.common,qn.aomap,qn.lightmap,qn.emissivemap,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.gradientmap,qn.fog,qn.lights,{emissive:{value:new Ti(0)}}]),vertexShader:vi.meshtoon_vert,fragmentShader:vi.meshtoon_frag},matcap:{uniforms:lu([qn.common,qn.bumpmap,qn.normalmap,qn.displacementmap,qn.fog,{matcap:{value:null}}]),vertexShader:vi.meshmatcap_vert,fragmentShader:vi.meshmatcap_frag},points:{uniforms:lu([qn.points,qn.fog]),vertexShader:vi.points_vert,fragmentShader:vi.points_frag},dashed:{uniforms:lu([qn.common,qn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vi.linedashed_vert,fragmentShader:vi.linedashed_frag},depth:{uniforms:lu([qn.common,qn.displacementmap]),vertexShader:vi.depth_vert,fragmentShader:vi.depth_frag},normal:{uniforms:lu([qn.common,qn.bumpmap,qn.normalmap,qn.displacementmap,{opacity:{value:1}}]),vertexShader:vi.meshnormal_vert,fragmentShader:vi.meshnormal_frag},sprite:{uniforms:lu([qn.sprite,qn.fog]),vertexShader:vi.sprite_vert,fragmentShader:vi.sprite_frag},background:{uniforms:{uvTransform:{value:new pi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:vi.background_vert,fragmentShader:vi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new pi}},vertexShader:vi.backgroundCube_vert,fragmentShader:vi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:vi.cube_vert,fragmentShader:vi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vi.equirect_vert,fragmentShader:vi.equirect_frag},distanceRGBA:{uniforms:lu([qn.common,qn.displacementmap,{referencePosition:{value:new zt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vi.distanceRGBA_vert,fragmentShader:vi.distanceRGBA_frag},shadow:{uniforms:lu([qn.lights,qn.fog,{color:{value:new Ti(0)},opacity:{value:1}}]),vertexShader:vi.shadow_vert,fragmentShader:vi.shadow_frag}};Rm.physical={uniforms:lu([Rm.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new pi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new pi},clearcoatNormalScale:{value:new zn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new pi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new pi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new pi},sheen:{value:0},sheenColor:{value:new Ti(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new pi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new pi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new pi},transmissionSamplerSize:{value:new zn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new pi},attenuationDistance:{value:0},attenuationColor:{value:new Ti(0)},specularColor:{value:new Ti(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new pi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new pi},anisotropyVector:{value:new zn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new pi}}]),vertexShader:vi.meshphysical_vert,fragmentShader:vi.meshphysical_frag};const yR={r:0,b:0,g:0},Ky=new Xm,Ihe=new To;function Ohe(n,e,t,r,i,s,o){const a=new Ti(0);let c=s===!0?0:1,l,u,h=null,f=0,d=null;function p(b){let T=b.isScene===!0?b.background:null;return T&&T.isTexture&&(T=(b.backgroundBlurriness>0?t:e).get(T)),T}function m(b){let T=!1;const w=p(b);w===null?v(a,c):w&&w.isColor&&(v(w,1),T=!0);const R=n.xr.getEnvironmentBlendMode();R==="additive"?r.buffers.color.setClear(0,0,0,1,o):R==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,o),(n.autoClear||T)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function _(b,T){const w=p(T);w&&(w.isCubeTexture||w.mapping===eO)?(u===void 0&&(u=new df(new jx(1,1,1),new lo({name:"BackgroundCubeMaterial",uniforms:nx(Rm.backgroundCube.uniforms),vertexShader:Rm.backgroundCube.vertexShader,fragmentShader:Rm.backgroundCube.fragmentShader,side:Uc,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(R,C,N){this.matrixWorld.copyPosition(N.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),Ky.copy(T.backgroundRotation),Ky.x*=-1,Ky.y*=-1,Ky.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(Ky.y*=-1,Ky.z*=-1),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=T.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=T.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Ihe.makeRotationFromEuler(Ky)),u.material.toneMapped=Zi.getTransfer(w.colorSpace)!==Bs,(h!==w||f!==w.version||d!==n.toneMapping)&&(u.material.needsUpdate=!0,h=w,f=w.version,d=n.toneMapping),u.layers.enableAll(),b.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(l===void 0&&(l=new df(new ZA(2,2),new lo({name:"BackgroundMaterial",uniforms:nx(Rm.background.uniforms),vertexShader:Rm.background.vertexShader,fragmentShader:Rm.background.fragmentShader,side:X0,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=w,l.material.uniforms.backgroundIntensity.value=T.backgroundIntensity,l.material.toneMapped=Zi.getTransfer(w.colorSpace)!==Bs,w.matrixAutoUpdate===!0&&w.updateMatrix(),l.material.uniforms.uvTransform.value.copy(w.matrix),(h!==w||f!==w.version||d!==n.toneMapping)&&(l.material.needsUpdate=!0,h=w,f=w.version,d=n.toneMapping),l.layers.enableAll(),b.unshift(l,l.geometry,l.material,0,0,null))}function v(b,T){b.getRGB(yR,xW(n)),r.buffers.color.setClear(yR.r,yR.g,yR.b,T,o)}function S(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),l!==void 0&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}return{getClearColor:function(){return a},setClearColor:function(b,T=1){a.set(b),c=T,v(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(b){c=b,v(a,c)},render:m,addToRenderList:_,dispose:S}}function Nhe(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=f(null);let s=i,o=!1;function a(B,$,I,L,P){let H=!1;const X=h(L,I,$);s!==X&&(s=X,l(s.object)),H=d(B,L,I,P),H&&p(B,L,I,P),P!==null&&e.update(P,n.ELEMENT_ARRAY_BUFFER),(H||o)&&(o=!1,T(B,$,I,L),P!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(P).buffer))}function c(){return n.createVertexArray()}function l(B){return n.bindVertexArray(B)}function u(B){return n.deleteVertexArray(B)}function h(B,$,I){const L=I.wireframe===!0;let P=r[B.id];P===void 0&&(P={},r[B.id]=P);let H=P[$.id];H===void 0&&(H={},P[$.id]=H);let X=H[L];return X===void 0&&(X=f(c()),H[L]=X),X}function f(B){const $=[],I=[],L=[];for(let P=0;P<t;P++)$[P]=0,I[P]=0,L[P]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:$,enabledAttributes:I,attributeDivisors:L,object:B,attributes:{},index:null}}function d(B,$,I,L){const P=s.attributes,H=$.attributes;let X=0;const G=I.getAttributes();for(const Y in G)if(G[Y].location>=0){const Q=P[Y];let z=H[Y];if(z===void 0&&(Y==="instanceMatrix"&&B.instanceMatrix&&(z=B.instanceMatrix),Y==="instanceColor"&&B.instanceColor&&(z=B.instanceColor)),Q===void 0||Q.attribute!==z||z&&Q.data!==z.data)return!0;X++}return s.attributesNum!==X||s.index!==L}function p(B,$,I,L){const P={},H=$.attributes;let X=0;const G=I.getAttributes();for(const Y in G)if(G[Y].location>=0){let Q=H[Y];Q===void 0&&(Y==="instanceMatrix"&&B.instanceMatrix&&(Q=B.instanceMatrix),Y==="instanceColor"&&B.instanceColor&&(Q=B.instanceColor));const z={};z.attribute=Q,Q&&Q.data&&(z.data=Q.data),P[Y]=z,X++}s.attributes=P,s.attributesNum=X,s.index=L}function m(){const B=s.newAttributes;for(let $=0,I=B.length;$<I;$++)B[$]=0}function _(B){v(B,0)}function v(B,$){const I=s.newAttributes,L=s.enabledAttributes,P=s.attributeDivisors;I[B]=1,L[B]===0&&(n.enableVertexAttribArray(B),L[B]=1),P[B]!==$&&(n.vertexAttribDivisor(B,$),P[B]=$)}function S(){const B=s.newAttributes,$=s.enabledAttributes;for(let I=0,L=$.length;I<L;I++)$[I]!==B[I]&&(n.disableVertexAttribArray(I),$[I]=0)}function b(B,$,I,L,P,H,X){X===!0?n.vertexAttribIPointer(B,$,I,P,H):n.vertexAttribPointer(B,$,I,L,P,H)}function T(B,$,I,L){m();const P=L.attributes,H=I.getAttributes(),X=$.defaultAttributeValues;for(const G in H){const Y=H[G];if(Y.location>=0){let J=P[G];if(J===void 0&&(G==="instanceMatrix"&&B.instanceMatrix&&(J=B.instanceMatrix),G==="instanceColor"&&B.instanceColor&&(J=B.instanceColor)),J!==void 0){const Q=J.normalized,z=J.itemSize,q=e.get(J);if(q===void 0)continue;const ee=q.buffer,te=q.type,ie=q.bytesPerElement,Ee=te===n.INT||te===n.UNSIGNED_INT||J.gpuType===h5;if(J.isInterleavedBufferAttribute){const Re=J.data,Te=Re.stride,Pe=J.offset;if(Re.isInstancedInterleavedBuffer){for(let We=0;We<Y.locationSize;We++)v(Y.location+We,Re.meshPerAttribute);B.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=Re.meshPerAttribute*Re.count)}else for(let We=0;We<Y.locationSize;We++)_(Y.location+We);n.bindBuffer(n.ARRAY_BUFFER,ee);for(let We=0;We<Y.locationSize;We++)b(Y.location+We,z/Y.locationSize,te,Q,Te*ie,(Pe+z/Y.locationSize*We)*ie,Ee)}else{if(J.isInstancedBufferAttribute){for(let Re=0;Re<Y.locationSize;Re++)v(Y.location+Re,J.meshPerAttribute);B.isInstancedMesh!==!0&&L._maxInstanceCount===void 0&&(L._maxInstanceCount=J.meshPerAttribute*J.count)}else for(let Re=0;Re<Y.locationSize;Re++)_(Y.location+Re);n.bindBuffer(n.ARRAY_BUFFER,ee);for(let Re=0;Re<Y.locationSize;Re++)b(Y.location+Re,z/Y.locationSize,te,Q,z*ie,z/Y.locationSize*Re*ie,Ee)}}else if(X!==void 0){const Q=X[G];if(Q!==void 0)switch(Q.length){case 2:n.vertexAttrib2fv(Y.location,Q);break;case 3:n.vertexAttrib3fv(Y.location,Q);break;case 4:n.vertexAttrib4fv(Y.location,Q);break;default:n.vertexAttrib1fv(Y.location,Q)}}}}S()}function w(){N();for(const B in r){const $=r[B];for(const I in $){const L=$[I];for(const P in L)u(L[P].object),delete L[P];delete $[I]}delete r[B]}}function R(B){if(r[B.id]===void 0)return;const $=r[B.id];for(const I in $){const L=$[I];for(const P in L)u(L[P].object),delete L[P];delete $[I]}delete r[B.id]}function C(B){for(const $ in r){const I=r[$];if(I[B.id]===void 0)continue;const L=I[B.id];for(const P in L)u(L[P].object),delete L[P];delete I[B.id]}}function N(){U(),o=!0,s!==i&&(s=i,l(s.object))}function U(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:N,resetDefaultState:U,dispose:w,releaseStatesOfGeometry:R,releaseStatesOfProgram:C,initAttributes:m,enableAttribute:_,disableUnusedAttributes:S}}function Phe(n,e,t){let r;function i(l){r=l}function s(l,u){n.drawArrays(r,l,u),t.update(u,r,1)}function o(l,u,h){h!==0&&(n.drawArraysInstanced(r,l,u,h),t.update(u,r,h))}function a(l,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,u,0,h);let d=0;for(let p=0;p<h;p++)d+=u[p];t.update(d,r,1)}function c(l,u,h,f){if(h===0)return;const d=e.get("WEBGL_multi_draw");if(d===null)for(let p=0;p<l.length;p++)o(l[p],u[p],f[p]);else{d.multiDrawArraysInstancedWEBGL(r,l,0,u,0,f,0,h);let p=0;for(let m=0;m<h;m++)p+=u[m]*f[m];t.update(p,r,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function Dhe(n,e,t,r){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(C){return!(C!==_u&&r.convert(C)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(C){const N=C===Zv&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(C!==Oo&&r.convert(C)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&C!==dp&&!N)}function c(C){if(C==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";C="mediump"}return C==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=t.precision!==void 0?t.precision:"highp";const u=c(l);u!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",u,"instead."),l=u);const h=t.logarithmicDepthBuffer===!0,f=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),d=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_TEXTURE_SIZE),_=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),v=n.getParameter(n.MAX_VERTEX_ATTRIBS),S=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),b=n.getParameter(n.MAX_VARYING_VECTORS),T=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),w=p>0,R=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:h,reverseDepthBuffer:f,maxTextures:d,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:_,maxAttributes:v,maxVertexUniforms:S,maxVaryings:b,maxFragmentUniforms:T,vertexTextures:w,maxSamples:R}}function Lhe(n){const e=this;let t=null,r=0,i=!1,s=!1;const o=new ub,a=new pi,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const d=h.length!==0||f||r!==0||i;return i=f,r=h.length,d},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,f){t=u(h,f,0)},this.setState=function(h,f,d){const p=h.clippingPlanes,m=h.clipIntersection,_=h.clipShadows,v=n.get(h);if(!i||p===null||p.length===0||s&&!_)s?u(null):l();else{const S=s?0:r,b=S*4;let T=v.clippingState||null;c.value=T,T=u(p,f,b,d);for(let w=0;w!==b;++w)T[w]=t[w];v.clippingState=T,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=S}};function l(){c.value!==t&&(c.value=t,c.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,f,d,p){const m=h!==null?h.length:0;let _=null;if(m!==0){if(_=c.value,p!==!0||_===null){const v=d+m*4,S=f.matrixWorldInverse;a.getNormalMatrix(S),(_===null||_.length<v)&&(_=new Float32Array(v));for(let b=0,T=d;b!==m;++b,T+=4)o.copy(h[b]).applyMatrix4(S,a),o.normal.toArray(_,T),_[T+3]=o.constant}c.value=_,c.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,_}}function Uhe(n){let e=new WeakMap;function t(o,a){return a===LD?o.mapping=JE:a===UD&&(o.mapping=QE),o}function r(o){if(o&&o.isTexture){const a=o.mapping;if(a===LD||a===UD)if(e.has(o)){const c=e.get(o).texture;return t(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new Oce(c.height);return l.fromEquirectangularTexture(n,o),e.set(o,l),o.addEventListener("dispose",i),t(l.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const TE=4,LF=[.125,.215,.35,.446,.526,.582],vb=20,mN=new iO,UF=new Ti;let gN=null,_N=0,vN=0,yN=!1;const hb=(1+Math.sqrt(5))/2,VS=1/hb,BF=[new zt(-hb,VS,0),new zt(hb,VS,0),new zt(-VS,0,hb),new zt(VS,0,hb),new zt(0,hb,-VS),new zt(0,hb,VS),new zt(-1,1,-1),new zt(1,1,-1),new zt(-1,1,1),new zt(1,1,1)],Bhe=new zt;class FF{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100,s={}){const{size:o=256,position:a=Bhe}=s;gN=this._renderer.getRenderTarget(),_N=this._renderer.getActiveCubeFace(),vN=this._renderer.getActiveMipmapLevel(),yN=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,r,i,c,a),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=$F(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=zF(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(gN,_N,vN),this._renderer.xr.enabled=yN,e.scissorTest=!1,bR(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===JE||e.mapping===QE?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),gN=this._renderer.getRenderTarget(),_N=this._renderer.getActiveCubeFace(),vN=this._renderer.getActiveMipmapLevel(),yN=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Bl,minFilter:Bl,generateMipmaps:!1,type:Zv,format:_u,colorSpace:Z0,depthBuffer:!1},i=jF(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=jF(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Fhe(s)),this._blurMaterial=jhe(s,e,t)}return i}_compileMaterial(e){const t=new df(this._lodPlanes[0],e);this._renderer.compile(t,mN)}_sceneToCubeUV(e,t,r,i,s){const c=new du(90,1,t,r),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,d=h.toneMapping;h.getClearColor(UF),h.toneMapping=$0,h.autoClear=!1;const p=new b5({name:"PMREM.Background",side:Uc,depthWrite:!1,depthTest:!1}),m=new df(new jx,p);let _=!1;const v=e.background;v?v.isColor&&(p.color.copy(v),e.background=null,_=!0):(p.color.copy(UF),_=!0);for(let S=0;S<6;S++){const b=S%3;b===0?(c.up.set(0,l[S],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+u[S],s.y,s.z)):b===1?(c.up.set(0,0,l[S]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+u[S],s.z)):(c.up.set(0,l[S],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+u[S]));const T=this._cubeSize;bR(i,b*T,S>2?T:0,T,T),h.setRenderTarget(i),_&&h.render(m,c),h.render(e,c)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=d,h.autoClear=f,e.background=v}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===JE||e.mapping===QE;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=$F()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=zF());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new df(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;bR(t,0,0,3*c,2*c),r.setRenderTarget(t),r.render(o,mN)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=BF[(i-s-1)%BF.length];this._blur(e,s-1,s,o,a)}t.autoClear=r}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new df(this._lodPlanes[i],l),f=l.uniforms,d=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*d):2*Math.PI/(2*vb-1),m=s/p,_=isFinite(s)?1+Math.floor(u*m):vb;_>vb&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${vb}`);const v=[];let S=0;for(let C=0;C<vb;++C){const N=C/m,U=Math.exp(-N*N/2);v.push(U),C===0?S+=U:C<_&&(S+=2*U)}for(let C=0;C<v.length;C++)v[C]=v[C]/S;f.envMap.value=e.texture,f.samples.value=_,f.weights.value=v,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:b}=this;f.dTheta.value=p,f.mipInt.value=b-r;const T=this._sizeLods[i],w=3*T*(i>b-TE?i-b+TE:0),R=4*(this._cubeSize-T);bR(t,w,R,3*T,2*T),c.setRenderTarget(t),c.render(h,mN)}}function Fhe(n){const e=[],t=[],r=[];let i=n;const s=n-TE+1+LF.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let c=1/a;o>n-TE?c=LF[o-n+TE-1]:o===0&&(c=0),r.push(c);const l=1/(a-2),u=-l,h=1+l,f=[u,u,h,u,h,h,u,u,h,h,u,h],d=6,p=6,m=3,_=2,v=1,S=new Float32Array(m*p*d),b=new Float32Array(_*p*d),T=new Float32Array(v*p*d);for(let R=0;R<d;R++){const C=R%3*2/3-1,N=R>2?0:-1,U=[C,N,0,C+2/3,N,0,C+2/3,N+1,0,C,N,0,C+2/3,N+1,0,C,N+1,0];S.set(U,m*p*R),b.set(f,_*p*R);const B=[R,R,R,R,R,R];T.set(B,v*p*R)}const w=new ag;w.setAttribute("position",new Eh(S,m)),w.setAttribute("uv",new Eh(b,_)),w.setAttribute("faceIndex",new Eh(T,v)),e.push(w),i>TE&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function jF(n,e,t){const r=new hl(n,e,t);return r.texture.mapping=eO,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function bR(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function jhe(n,e,t){const r=new Float32Array(vb),i=new zt(0,1,0);return new lo({name:"SphericalGaussianBlur",defines:{n:vb,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:E5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ul,depthTest:!1,depthWrite:!1})}function zF(){return new lo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:E5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ul,depthTest:!1,depthWrite:!1})}function $F(){return new lo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:E5(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ul,depthTest:!1,depthWrite:!1})}function E5(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function zhe(n){let e=new WeakMap,t=null;function r(a){if(a&&a.isTexture){const c=a.mapping,l=c===LD||c===UD,u=c===JE||c===QE;if(l||u){let h=e.get(a);const f=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==f)return t===null&&(t=new FF(n)),h=l?t.fromEquirectangular(a,h):t.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const d=a.image;return l&&d&&d.height>0||u&&d&&i(d)?(t===null&&(t=new FF(n)),h=l?t.fromEquirectangular(a):t.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function i(a){let c=0;const l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:o}}function $he(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&kk("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Vhe(n,e,t,r){const i={},s=new WeakMap;function o(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const p in f.attributes)e.remove(f.attributes[p]);f.removeEventListener("dispose",o),delete i[f.id];const d=s.get(f);d&&(e.remove(d),s.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(h,f){return i[f.id]===!0||(f.addEventListener("dispose",o),i[f.id]=!0,t.memory.geometries++),f}function c(h){const f=h.attributes;for(const d in f)e.update(f[d],n.ARRAY_BUFFER)}function l(h){const f=[],d=h.index,p=h.attributes.position;let m=0;if(d!==null){const S=d.array;m=d.version;for(let b=0,T=S.length;b<T;b+=3){const w=S[b+0],R=S[b+1],C=S[b+2];f.push(w,R,R,C,C,w)}}else if(p!==void 0){const S=p.array;m=p.version;for(let b=0,T=S.length/3-1;b<T;b+=3){const w=b+0,R=b+1,C=b+2;f.push(w,R,R,C,C,w)}}else return;const _=new(vW(f)?EW:SW)(f,1);_.version=m;const v=s.get(h);v&&e.remove(v),s.set(h,_)}function u(h){const f=s.get(h);if(f){const d=h.index;d!==null&&f.version<d.version&&l(h)}else l(h);return s.get(h)}return{get:a,update:c,getWireframeAttribute:u}}function Hhe(n,e,t){let r;function i(f){r=f}let s,o;function a(f){s=f.type,o=f.bytesPerElement}function c(f,d){n.drawElements(r,d,s,f*o),t.update(d,r,1)}function l(f,d,p){p!==0&&(n.drawElementsInstanced(r,d,s,f*o,p),t.update(d,r,p))}function u(f,d,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,d,0,s,f,0,p);let _=0;for(let v=0;v<p;v++)_+=d[v];t.update(_,r,1)}function h(f,d,p,m){if(p===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let v=0;v<f.length;v++)l(f[v]/o,d[v],m[v]);else{_.multiDrawElementsInstancedWEBGL(r,d,0,s,f,0,m,0,p);let v=0;for(let S=0;S<p;S++)v+=d[S]*m[S];t.update(v,r,1)}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function Ghe(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function Whe(n,e,t){const r=new WeakMap,i=new Xo;function s(o,a,c){const l=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let f=r.get(a);if(f===void 0||f.count!==h){let B=function(){N.dispose(),r.delete(a),a.removeEventListener("dispose",B)};var d=B;f!==void 0&&f.texture.dispose();const p=a.morphAttributes.position!==void 0,m=a.morphAttributes.normal!==void 0,_=a.morphAttributes.color!==void 0,v=a.morphAttributes.position||[],S=a.morphAttributes.normal||[],b=a.morphAttributes.color||[];let T=0;p===!0&&(T=1),m===!0&&(T=2),_===!0&&(T=3);let w=a.attributes.position.count*T,R=1;w>e.maxTextureSize&&(R=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const C=new Float32Array(w*R*4*h),N=new yW(C,w,R,h);N.type=dp,N.needsUpdate=!0;const U=T*4;for(let $=0;$<h;$++){const I=v[$],L=S[$],P=b[$],H=w*R*4*$;for(let X=0;X<I.count;X++){const G=X*U;p===!0&&(i.fromBufferAttribute(I,X),C[H+G+0]=i.x,C[H+G+1]=i.y,C[H+G+2]=i.z,C[H+G+3]=0),m===!0&&(i.fromBufferAttribute(L,X),C[H+G+4]=i.x,C[H+G+5]=i.y,C[H+G+6]=i.z,C[H+G+7]=0),_===!0&&(i.fromBufferAttribute(P,X),C[H+G+8]=i.x,C[H+G+9]=i.y,C[H+G+10]=i.z,C[H+G+11]=P.itemSize===4?i.w:1)}}f={count:h,texture:N,size:new zn(w,R)},r.set(a,f),a.addEventListener("dispose",B)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let p=0;for(let _=0;_<l.length;_++)p+=l[_];const m=a.morphTargetsRelative?1:1-p;c.getUniforms().setValue(n,"morphTargetBaseInfluence",m),c.getUniforms().setValue(n,"morphTargetInfluences",l)}c.getUniforms().setValue(n,"morphTargetsTexture",f.texture,t),c.getUniforms().setValue(n,"morphTargetsTextureSize",f.size)}return{update:s}}function qhe(n,e,t,r){let i=new WeakMap;function s(c){const l=r.render.frame,u=c.geometry,h=e.get(c,u);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,n.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const f=c.skeleton;i.get(f)!==l&&(f.update(),i.set(f,l))}return h}function o(){i=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:s,dispose:o}}const kW=new pc,VF=new rO(1,1),MW=new yW,IW=new mce,OW=new wW,HF=[],GF=[],WF=new Float32Array(16),qF=new Float32Array(9),YF=new Float32Array(4);function zx(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=HF[i];if(s===void 0&&(s=new Float32Array(i),HF[i]=s),e!==0){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function gc(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function _c(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function sO(n,e){let t=GF[e];t===void 0&&(t=new Int32Array(e),GF[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function Yhe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Khe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gc(t,e))return;n.uniform2fv(this.addr,e),_c(t,e)}}function Xhe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(gc(t,e))return;n.uniform3fv(this.addr,e),_c(t,e)}}function Zhe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gc(t,e))return;n.uniform4fv(this.addr,e),_c(t,e)}}function Jhe(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(gc(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),_c(t,e)}else{if(gc(t,r))return;YF.set(r),n.uniformMatrix2fv(this.addr,!1,YF),_c(t,r)}}function Qhe(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(gc(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),_c(t,e)}else{if(gc(t,r))return;qF.set(r),n.uniformMatrix3fv(this.addr,!1,qF),_c(t,r)}}function efe(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(gc(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),_c(t,e)}else{if(gc(t,r))return;WF.set(r),n.uniformMatrix4fv(this.addr,!1,WF),_c(t,r)}}function tfe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function nfe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gc(t,e))return;n.uniform2iv(this.addr,e),_c(t,e)}}function rfe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(gc(t,e))return;n.uniform3iv(this.addr,e),_c(t,e)}}function ife(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gc(t,e))return;n.uniform4iv(this.addr,e),_c(t,e)}}function sfe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function ofe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(gc(t,e))return;n.uniform2uiv(this.addr,e),_c(t,e)}}function afe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(gc(t,e))return;n.uniform3uiv(this.addr,e),_c(t,e)}}function cfe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(gc(t,e))return;n.uniform4uiv(this.addr,e),_c(t,e)}}function lfe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let s;this.type===n.SAMPLER_2D_SHADOW?(VF.compareFunction=gW,s=VF):s=kW,t.setTexture2D(e||s,i)}function ufe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||IW,i)}function hfe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||OW,i)}function ffe(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||MW,i)}function dfe(n){switch(n){case 5126:return Yhe;case 35664:return Khe;case 35665:return Xhe;case 35666:return Zhe;case 35674:return Jhe;case 35675:return Qhe;case 35676:return efe;case 5124:case 35670:return tfe;case 35667:case 35671:return nfe;case 35668:case 35672:return rfe;case 35669:case 35673:return ife;case 5125:return sfe;case 36294:return ofe;case 36295:return afe;case 36296:return cfe;case 35678:case 36198:case 36298:case 36306:case 35682:return lfe;case 35679:case 36299:case 36307:return ufe;case 35680:case 36300:case 36308:case 36293:return hfe;case 36289:case 36303:case 36311:case 36292:return ffe}}function pfe(n,e){n.uniform1fv(this.addr,e)}function mfe(n,e){const t=zx(e,this.size,2);n.uniform2fv(this.addr,t)}function gfe(n,e){const t=zx(e,this.size,3);n.uniform3fv(this.addr,t)}function _fe(n,e){const t=zx(e,this.size,4);n.uniform4fv(this.addr,t)}function vfe(n,e){const t=zx(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function yfe(n,e){const t=zx(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function bfe(n,e){const t=zx(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function Sfe(n,e){n.uniform1iv(this.addr,e)}function Efe(n,e){n.uniform2iv(this.addr,e)}function xfe(n,e){n.uniform3iv(this.addr,e)}function Tfe(n,e){n.uniform4iv(this.addr,e)}function wfe(n,e){n.uniform1uiv(this.addr,e)}function Afe(n,e){n.uniform2uiv(this.addr,e)}function Cfe(n,e){n.uniform3uiv(this.addr,e)}function Rfe(n,e){n.uniform4uiv(this.addr,e)}function kfe(n,e,t){const r=this.cache,i=e.length,s=sO(t,i);gc(r,s)||(n.uniform1iv(this.addr,s),_c(r,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||kW,s[o])}function Mfe(n,e,t){const r=this.cache,i=e.length,s=sO(t,i);gc(r,s)||(n.uniform1iv(this.addr,s),_c(r,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||IW,s[o])}function Ife(n,e,t){const r=this.cache,i=e.length,s=sO(t,i);gc(r,s)||(n.uniform1iv(this.addr,s),_c(r,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||OW,s[o])}function Ofe(n,e,t){const r=this.cache,i=e.length,s=sO(t,i);gc(r,s)||(n.uniform1iv(this.addr,s),_c(r,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||MW,s[o])}function Nfe(n){switch(n){case 5126:return pfe;case 35664:return mfe;case 35665:return gfe;case 35666:return _fe;case 35674:return vfe;case 35675:return yfe;case 35676:return bfe;case 5124:case 35670:return Sfe;case 35667:case 35671:return Efe;case 35668:case 35672:return xfe;case 35669:case 35673:return Tfe;case 5125:return wfe;case 36294:return Afe;case 36295:return Cfe;case 36296:return Rfe;case 35678:case 36198:case 36298:case 36306:case 35682:return kfe;case 35679:case 36299:case 36307:return Mfe;case 35680:case 36300:case 36308:case 36293:return Ife;case 36289:case 36303:case 36311:case 36292:return Ofe}}class Pfe{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=dfe(t.type)}}class Dfe{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Nfe(t.type)}}class Lfe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,t[a.id],r)}}}const bN=/(\w+)(\])?(\[|\.)?/g;function KF(n,e){n.seq.push(e),n.map[e.id]=e}function Ufe(n,e,t){const r=n.name,i=r.length;for(bN.lastIndex=0;;){const s=bN.exec(r),o=bN.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){KF(t,l===void 0?new Pfe(a,n,e):new Dfe(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new Lfe(a),KF(t,h)),t=h}}}class Mk{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const s=e.getActiveUniform(t,i),o=e.getUniformLocation(t,s.name);Ufe(s,o,this)}}setValue(e,t,r,i){const s=this.map[t];s!==void 0&&s.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let s=0,o=t.length;s!==o;++s){const a=t[s],c=r[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&r.push(o)}return r}}function XF(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const Bfe=37297;let Ffe=0;function jfe(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const a=o+1;r.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return r.join(`
`)}const ZF=new pi;function zfe(n){Zi._getMatrix(ZF,Zi.workingColorSpace,n);const e=`mat3( ${ZF.elements.map(t=>t.toFixed(4))} )`;switch(Zi.getTransfer(n)){case yM:return[e,"LinearTransferOETF"];case Bs:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function JF(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+jfe(n.getShaderSource(e),o)}else return i}function $fe(n,e){const t=zfe(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function Vfe(n,e){let t;switch(e){case Cae:t="Linear";break;case Rae:t="Reinhard";break;case kae:t="Cineon";break;case cW:t="ACESFilmic";break;case Iae:t="AgX";break;case Oae:t="Neutral";break;case Mae:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const SR=new zt;function Hfe(){Zi.getLuminanceCoefficients(SR);const n=SR.x.toFixed(4),e=SR.y.toFixed(4),t=SR.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Gfe(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(xw).join(`
`)}function Wfe(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function qfe(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function xw(n){return n!==""}function QF(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function e7(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Yfe=/^[ \t]*#include +<([\w\d./]+)>/gm;function pL(n){return n.replace(Yfe,Xfe)}const Kfe=new Map;function Xfe(n,e){let t=vi[e];if(t===void 0){const r=Kfe.get(e);if(r!==void 0)t=vi[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return pL(t)}const Zfe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function t7(n){return n.replace(Zfe,Jfe)}function Jfe(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function n7(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Qfe(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===u5?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===xk?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Tm&&(e="SHADOWMAP_TYPE_VSM"),e}function ede(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case JE:case QE:e="ENVMAP_TYPE_CUBE";break;case eO:e="ENVMAP_TYPE_CUBE_UV";break}return e}function tde(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===QE&&(e="ENVMAP_MODE_REFRACTION"),e}function nde(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case aW:e="ENVMAP_BLENDING_MULTIPLY";break;case wae:e="ENVMAP_BLENDING_MIX";break;case Aae:e="ENVMAP_BLENDING_ADD";break}return e}function rde(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}function ide(n,e,t,r){const i=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const c=Qfe(t),l=ede(t),u=tde(t),h=nde(t),f=rde(t),d=Gfe(t),p=Wfe(s),m=i.createProgram();let _,v,S=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(_=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(xw).join(`
`),_.length>0&&(_+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(xw).join(`
`),v.length>0&&(v+=`
`)):(_=[n7(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(xw).join(`
`),v=[n7(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==$0?"#define TONE_MAPPING":"",t.toneMapping!==$0?vi.tonemapping_pars_fragment:"",t.toneMapping!==$0?Vfe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",vi.colorspace_pars_fragment,$fe("linearToOutputTexel",t.outputColorSpace),Hfe(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(xw).join(`
`)),o=pL(o),o=QF(o,t),o=e7(o,t),a=pL(a),a=QF(a,t),a=e7(a,t),o=t7(o),a=t7(a),t.isRawShaderMaterial!==!0&&(S=`#version 300 es
`,_=[d,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+_,v=["#define varying in",t.glslVersion===aF?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===aF?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const b=S+_+o,T=S+v+a,w=XF(i,i.VERTEX_SHADER,b),R=XF(i,i.FRAGMENT_SHADER,T);i.attachShader(m,w),i.attachShader(m,R),t.index0AttributeName!==void 0?i.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m);function C($){if(n.debug.checkShaderErrors){const I=i.getProgramInfoLog(m).trim(),L=i.getShaderInfoLog(w).trim(),P=i.getShaderInfoLog(R).trim();let H=!0,X=!0;if(i.getProgramParameter(m,i.LINK_STATUS)===!1)if(H=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,m,w,R);else{const G=JF(i,w,"vertex"),Y=JF(i,R,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+`

Material Name: `+$.name+`
Material Type: `+$.type+`

Program Info Log: `+I+`
`+G+`
`+Y)}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(L===""||P==="")&&(X=!1);X&&($.diagnostics={runnable:H,programLog:I,vertexShader:{log:L,prefix:_},fragmentShader:{log:P,prefix:v}})}i.deleteShader(w),i.deleteShader(R),N=new Mk(i,m),U=qfe(i,m)}let N;this.getUniforms=function(){return N===void 0&&C(this),N};let U;this.getAttributes=function(){return U===void 0&&C(this),U};let B=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return B===!1&&(B=i.getProgramParameter(m,Bfe)),B},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Ffe++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=R,this}let sde=0;class ode{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new ade(e),t.set(e,r)),r}}class ade{constructor(e){this.id=sde++,this.code=e,this.usedTimes=0}}function cde(n,e,t,r,i,s,o){const a=new Qw,c=new ode,l=new Set,u=[],h=i.logarithmicDepthBuffer,f=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(U){return l.add(U),U===0?"uv":`uv${U}`}function _(U,B,$,I,L){const P=I.fog,H=L.geometry,X=U.isMeshStandardMaterial?I.environment:null,G=(U.isMeshStandardMaterial?t:e).get(U.envMap||X),Y=G&&G.mapping===eO?G.image.height:null,J=p[U.type];U.precision!==null&&(d=i.getMaxPrecision(U.precision),d!==U.precision&&console.warn("THREE.WebGLProgram.getParameters:",U.precision,"not supported, using",d,"instead."));const Q=H.morphAttributes.position||H.morphAttributes.normal||H.morphAttributes.color,z=Q!==void 0?Q.length:0;let q=0;H.morphAttributes.position!==void 0&&(q=1),H.morphAttributes.normal!==void 0&&(q=2),H.morphAttributes.color!==void 0&&(q=3);let ee,te,ie,Ee;if(J){const ot=Rm[J];ee=ot.vertexShader,te=ot.fragmentShader}else ee=U.vertexShader,te=U.fragmentShader,c.update(U),ie=c.getVertexShaderID(U),Ee=c.getFragmentShaderID(U);const Re=n.getRenderTarget(),Te=n.state.buffers.depth.getReversed(),Pe=L.isInstancedMesh===!0,We=L.isBatchedMesh===!0,it=!!U.map,ht=!!U.matcap,vt=!!G,re=!!U.aoMap,Le=!!U.lightMap,$e=!!U.bumpMap,De=!!U.normalMap,Oe=!!U.displacementMap,ae=!!U.emissiveMap,ve=!!U.metalnessMap,xe=!!U.roughnessMap,pe=U.anisotropy>0,ze=U.clearcoat>0,Je=U.dispersion>0,Xe=U.iridescence>0,et=U.sheen>0,Ut=U.transmission>0,gt=pe&&!!U.anisotropyMap,At=ze&&!!U.clearcoatMap,Ce=ze&&!!U.clearcoatNormalMap,se=ze&&!!U.clearcoatRoughnessMap,W=Xe&&!!U.iridescenceMap,oe=Xe&&!!U.iridescenceThicknessMap,Se=et&&!!U.sheenColorMap,Ae=et&&!!U.sheenRoughnessMap,ye=!!U.specularMap,_e=!!U.specularColorMap,Ye=!!U.specularIntensityMap,ke=Ut&&!!U.transmissionMap,Ve=Ut&&!!U.thicknessMap,Fe=!!U.gradientMap,Ge=!!U.alphaMap,at=U.alphaTest>0,Be=!!U.alphaHash,tt=!!U.extensions;let rt=$0;U.toneMapped&&(Re===null||Re.isXRRenderTarget===!0)&&(rt=n.toneMapping);const xt={shaderID:J,shaderType:U.type,shaderName:U.name,vertexShader:ee,fragmentShader:te,defines:U.defines,customVertexShaderID:ie,customFragmentShaderID:Ee,isRawShaderMaterial:U.isRawShaderMaterial===!0,glslVersion:U.glslVersion,precision:d,batching:We,batchingColor:We&&L._colorsTexture!==null,instancing:Pe,instancingColor:Pe&&L.instanceColor!==null,instancingMorph:Pe&&L.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:Re===null?n.outputColorSpace:Re.isXRRenderTarget===!0?Re.texture.colorSpace:Z0,alphaToCoverage:!!U.alphaToCoverage,map:it,matcap:ht,envMap:vt,envMapMode:vt&&G.mapping,envMapCubeUVHeight:Y,aoMap:re,lightMap:Le,bumpMap:$e,normalMap:De,displacementMap:f&&Oe,emissiveMap:ae,normalMapObjectSpace:De&&U.normalMapType===Lae,normalMapTangentSpace:De&&U.normalMapType===Dae,metalnessMap:ve,roughnessMap:xe,anisotropy:pe,anisotropyMap:gt,clearcoat:ze,clearcoatMap:At,clearcoatNormalMap:Ce,clearcoatRoughnessMap:se,dispersion:Je,iridescence:Xe,iridescenceMap:W,iridescenceThicknessMap:oe,sheen:et,sheenColorMap:Se,sheenRoughnessMap:Ae,specularMap:ye,specularColorMap:_e,specularIntensityMap:Ye,transmission:Ut,transmissionMap:ke,thicknessMap:Ve,gradientMap:Fe,opaque:U.transparent===!1&&U.blending===BE&&U.alphaToCoverage===!1,alphaMap:Ge,alphaTest:at,alphaHash:Be,combine:U.combine,mapUv:it&&m(U.map.channel),aoMapUv:re&&m(U.aoMap.channel),lightMapUv:Le&&m(U.lightMap.channel),bumpMapUv:$e&&m(U.bumpMap.channel),normalMapUv:De&&m(U.normalMap.channel),displacementMapUv:Oe&&m(U.displacementMap.channel),emissiveMapUv:ae&&m(U.emissiveMap.channel),metalnessMapUv:ve&&m(U.metalnessMap.channel),roughnessMapUv:xe&&m(U.roughnessMap.channel),anisotropyMapUv:gt&&m(U.anisotropyMap.channel),clearcoatMapUv:At&&m(U.clearcoatMap.channel),clearcoatNormalMapUv:Ce&&m(U.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:se&&m(U.clearcoatRoughnessMap.channel),iridescenceMapUv:W&&m(U.iridescenceMap.channel),iridescenceThicknessMapUv:oe&&m(U.iridescenceThicknessMap.channel),sheenColorMapUv:Se&&m(U.sheenColorMap.channel),sheenRoughnessMapUv:Ae&&m(U.sheenRoughnessMap.channel),specularMapUv:ye&&m(U.specularMap.channel),specularColorMapUv:_e&&m(U.specularColorMap.channel),specularIntensityMapUv:Ye&&m(U.specularIntensityMap.channel),transmissionMapUv:ke&&m(U.transmissionMap.channel),thicknessMapUv:Ve&&m(U.thicknessMap.channel),alphaMapUv:Ge&&m(U.alphaMap.channel),vertexTangents:!!H.attributes.tangent&&(De||pe),vertexColors:U.vertexColors,vertexAlphas:U.vertexColors===!0&&!!H.attributes.color&&H.attributes.color.itemSize===4,pointsUvs:L.isPoints===!0&&!!H.attributes.uv&&(it||Ge),fog:!!P,useFog:U.fog===!0,fogExp2:!!P&&P.isFogExp2,flatShading:U.flatShading===!0,sizeAttenuation:U.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:Te,skinning:L.isSkinnedMesh===!0,morphTargets:H.morphAttributes.position!==void 0,morphNormals:H.morphAttributes.normal!==void 0,morphColors:H.morphAttributes.color!==void 0,morphTargetsCount:z,morphTextureStride:q,numDirLights:B.directional.length,numPointLights:B.point.length,numSpotLights:B.spot.length,numSpotLightMaps:B.spotLightMap.length,numRectAreaLights:B.rectArea.length,numHemiLights:B.hemi.length,numDirLightShadows:B.directionalShadowMap.length,numPointLightShadows:B.pointShadowMap.length,numSpotLightShadows:B.spotShadowMap.length,numSpotLightShadowsWithMaps:B.numSpotLightShadowsWithMaps,numLightProbes:B.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:U.dithering,shadowMapEnabled:n.shadowMap.enabled&&$.length>0,shadowMapType:n.shadowMap.type,toneMapping:rt,decodeVideoTexture:it&&U.map.isVideoTexture===!0&&Zi.getTransfer(U.map.colorSpace)===Bs,decodeVideoTextureEmissive:ae&&U.emissiveMap.isVideoTexture===!0&&Zi.getTransfer(U.emissiveMap.colorSpace)===Bs,premultipliedAlpha:U.premultipliedAlpha,doubleSided:U.side===Ia,flipSided:U.side===Uc,useDepthPacking:U.depthPacking>=0,depthPacking:U.depthPacking||0,index0AttributeName:U.index0AttributeName,extensionClipCullDistance:tt&&U.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(tt&&U.extensions.multiDraw===!0||We)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:U.customProgramCacheKey()};return xt.vertexUv1s=l.has(1),xt.vertexUv2s=l.has(2),xt.vertexUv3s=l.has(3),l.clear(),xt}function v(U){const B=[];if(U.shaderID?B.push(U.shaderID):(B.push(U.customVertexShaderID),B.push(U.customFragmentShaderID)),U.defines!==void 0)for(const $ in U.defines)B.push($),B.push(U.defines[$]);return U.isRawShaderMaterial===!1&&(S(B,U),b(B,U),B.push(n.outputColorSpace)),B.push(U.customProgramCacheKey),B.join()}function S(U,B){U.push(B.precision),U.push(B.outputColorSpace),U.push(B.envMapMode),U.push(B.envMapCubeUVHeight),U.push(B.mapUv),U.push(B.alphaMapUv),U.push(B.lightMapUv),U.push(B.aoMapUv),U.push(B.bumpMapUv),U.push(B.normalMapUv),U.push(B.displacementMapUv),U.push(B.emissiveMapUv),U.push(B.metalnessMapUv),U.push(B.roughnessMapUv),U.push(B.anisotropyMapUv),U.push(B.clearcoatMapUv),U.push(B.clearcoatNormalMapUv),U.push(B.clearcoatRoughnessMapUv),U.push(B.iridescenceMapUv),U.push(B.iridescenceThicknessMapUv),U.push(B.sheenColorMapUv),U.push(B.sheenRoughnessMapUv),U.push(B.specularMapUv),U.push(B.specularColorMapUv),U.push(B.specularIntensityMapUv),U.push(B.transmissionMapUv),U.push(B.thicknessMapUv),U.push(B.combine),U.push(B.fogExp2),U.push(B.sizeAttenuation),U.push(B.morphTargetsCount),U.push(B.morphAttributeCount),U.push(B.numDirLights),U.push(B.numPointLights),U.push(B.numSpotLights),U.push(B.numSpotLightMaps),U.push(B.numHemiLights),U.push(B.numRectAreaLights),U.push(B.numDirLightShadows),U.push(B.numPointLightShadows),U.push(B.numSpotLightShadows),U.push(B.numSpotLightShadowsWithMaps),U.push(B.numLightProbes),U.push(B.shadowMapType),U.push(B.toneMapping),U.push(B.numClippingPlanes),U.push(B.numClipIntersection),U.push(B.depthPacking)}function b(U,B){a.disableAll(),B.supportsVertexTextures&&a.enable(0),B.instancing&&a.enable(1),B.instancingColor&&a.enable(2),B.instancingMorph&&a.enable(3),B.matcap&&a.enable(4),B.envMap&&a.enable(5),B.normalMapObjectSpace&&a.enable(6),B.normalMapTangentSpace&&a.enable(7),B.clearcoat&&a.enable(8),B.iridescence&&a.enable(9),B.alphaTest&&a.enable(10),B.vertexColors&&a.enable(11),B.vertexAlphas&&a.enable(12),B.vertexUv1s&&a.enable(13),B.vertexUv2s&&a.enable(14),B.vertexUv3s&&a.enable(15),B.vertexTangents&&a.enable(16),B.anisotropy&&a.enable(17),B.alphaHash&&a.enable(18),B.batching&&a.enable(19),B.dispersion&&a.enable(20),B.batchingColor&&a.enable(21),U.push(a.mask),a.disableAll(),B.fog&&a.enable(0),B.useFog&&a.enable(1),B.flatShading&&a.enable(2),B.logarithmicDepthBuffer&&a.enable(3),B.reverseDepthBuffer&&a.enable(4),B.skinning&&a.enable(5),B.morphTargets&&a.enable(6),B.morphNormals&&a.enable(7),B.morphColors&&a.enable(8),B.premultipliedAlpha&&a.enable(9),B.shadowMapEnabled&&a.enable(10),B.doubleSided&&a.enable(11),B.flipSided&&a.enable(12),B.useDepthPacking&&a.enable(13),B.dithering&&a.enable(14),B.transmission&&a.enable(15),B.sheen&&a.enable(16),B.opaque&&a.enable(17),B.pointsUvs&&a.enable(18),B.decodeVideoTexture&&a.enable(19),B.decodeVideoTextureEmissive&&a.enable(20),B.alphaToCoverage&&a.enable(21),U.push(a.mask)}function T(U){const B=p[U.type];let $;if(B){const I=Rm[B];$=Rce.clone(I.uniforms)}else $=U.uniforms;return $}function w(U,B){let $;for(let I=0,L=u.length;I<L;I++){const P=u[I];if(P.cacheKey===B){$=P,++$.usedTimes;break}}return $===void 0&&($=new ide(n,B,U,s),u.push($)),$}function R(U){if(--U.usedTimes===0){const B=u.indexOf(U);u[B]=u[u.length-1],u.pop(),U.destroy()}}function C(U){c.remove(U)}function N(){c.dispose()}return{getParameters:_,getProgramCacheKey:v,getUniforms:T,acquireProgram:w,releaseProgram:R,releaseShaderCache:C,programs:u,dispose:N}}function lde(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function r(o){n.delete(o)}function i(o,a,c){n.get(o)[a]=c}function s(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:s}}function ude(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function r7(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function i7(){const n=[];let e=0;const t=[],r=[],i=[];function s(){e=0,t.length=0,r.length=0,i.length=0}function o(h,f,d,p,m,_){let v=n[e];return v===void 0?(v={id:h.id,object:h,geometry:f,material:d,groupOrder:p,renderOrder:h.renderOrder,z:m,group:_},n[e]=v):(v.id=h.id,v.object=h,v.geometry=f,v.material=d,v.groupOrder=p,v.renderOrder=h.renderOrder,v.z=m,v.group=_),e++,v}function a(h,f,d,p,m,_){const v=o(h,f,d,p,m,_);d.transmission>0?r.push(v):d.transparent===!0?i.push(v):t.push(v)}function c(h,f,d,p,m,_){const v=o(h,f,d,p,m,_);d.transmission>0?r.unshift(v):d.transparent===!0?i.unshift(v):t.unshift(v)}function l(h,f){t.length>1&&t.sort(h||ude),r.length>1&&r.sort(f||r7),i.length>1&&i.sort(f||r7)}function u(){for(let h=e,f=n.length;h<f;h++){const d=n[h];if(d.id===null)break;d.id=null,d.object=null,d.geometry=null,d.material=null,d.group=null}}return{opaque:t,transmissive:r,transparent:i,init:s,push:a,unshift:c,finish:u,sort:l}}function hde(){let n=new WeakMap;function e(r,i){const s=n.get(r);let o;return s===void 0?(o=new i7,n.set(r,[o])):i>=s.length?(o=new i7,s.push(o)):o=s[i],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function fde(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new zt,color:new Ti};break;case"SpotLight":t={position:new zt,direction:new zt,color:new Ti,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new zt,color:new Ti,distance:0,decay:0};break;case"HemisphereLight":t={direction:new zt,skyColor:new Ti,groundColor:new Ti};break;case"RectAreaLight":t={color:new Ti,position:new zt,halfWidth:new zt,halfHeight:new zt};break}return n[e.id]=t,t}}}function dde(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zn};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zn};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zn,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let pde=0;function mde(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function gde(n){const e=new fde,t=dde(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new zt);const i=new zt,s=new To,o=new To;function a(l){let u=0,h=0,f=0;for(let U=0;U<9;U++)r.probe[U].set(0,0,0);let d=0,p=0,m=0,_=0,v=0,S=0,b=0,T=0,w=0,R=0,C=0;l.sort(mde);for(let U=0,B=l.length;U<B;U++){const $=l[U],I=$.color,L=$.intensity,P=$.distance,H=$.shadow&&$.shadow.map?$.shadow.map.texture:null;if($.isAmbientLight)u+=I.r*L,h+=I.g*L,f+=I.b*L;else if($.isLightProbe){for(let X=0;X<9;X++)r.probe[X].addScaledVector($.sh.coefficients[X],L);C++}else if($.isDirectionalLight){const X=e.get($);if(X.color.copy($.color).multiplyScalar($.intensity),$.castShadow){const G=$.shadow,Y=t.get($);Y.shadowIntensity=G.intensity,Y.shadowBias=G.bias,Y.shadowNormalBias=G.normalBias,Y.shadowRadius=G.radius,Y.shadowMapSize=G.mapSize,r.directionalShadow[d]=Y,r.directionalShadowMap[d]=H,r.directionalShadowMatrix[d]=$.shadow.matrix,S++}r.directional[d]=X,d++}else if($.isSpotLight){const X=e.get($);X.position.setFromMatrixPosition($.matrixWorld),X.color.copy(I).multiplyScalar(L),X.distance=P,X.coneCos=Math.cos($.angle),X.penumbraCos=Math.cos($.angle*(1-$.penumbra)),X.decay=$.decay,r.spot[m]=X;const G=$.shadow;if($.map&&(r.spotLightMap[w]=$.map,w++,G.updateMatrices($),$.castShadow&&R++),r.spotLightMatrix[m]=G.matrix,$.castShadow){const Y=t.get($);Y.shadowIntensity=G.intensity,Y.shadowBias=G.bias,Y.shadowNormalBias=G.normalBias,Y.shadowRadius=G.radius,Y.shadowMapSize=G.mapSize,r.spotShadow[m]=Y,r.spotShadowMap[m]=H,T++}m++}else if($.isRectAreaLight){const X=e.get($);X.color.copy(I).multiplyScalar(L),X.halfWidth.set($.width*.5,0,0),X.halfHeight.set(0,$.height*.5,0),r.rectArea[_]=X,_++}else if($.isPointLight){const X=e.get($);if(X.color.copy($.color).multiplyScalar($.intensity),X.distance=$.distance,X.decay=$.decay,$.castShadow){const G=$.shadow,Y=t.get($);Y.shadowIntensity=G.intensity,Y.shadowBias=G.bias,Y.shadowNormalBias=G.normalBias,Y.shadowRadius=G.radius,Y.shadowMapSize=G.mapSize,Y.shadowCameraNear=G.camera.near,Y.shadowCameraFar=G.camera.far,r.pointShadow[p]=Y,r.pointShadowMap[p]=H,r.pointShadowMatrix[p]=$.shadow.matrix,b++}r.point[p]=X,p++}else if($.isHemisphereLight){const X=e.get($);X.skyColor.copy($.color).multiplyScalar(L),X.groundColor.copy($.groundColor).multiplyScalar(L),r.hemi[v]=X,v++}}_>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=qn.LTC_FLOAT_1,r.rectAreaLTC2=qn.LTC_FLOAT_2):(r.rectAreaLTC1=qn.LTC_HALF_1,r.rectAreaLTC2=qn.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=f;const N=r.hash;(N.directionalLength!==d||N.pointLength!==p||N.spotLength!==m||N.rectAreaLength!==_||N.hemiLength!==v||N.numDirectionalShadows!==S||N.numPointShadows!==b||N.numSpotShadows!==T||N.numSpotMaps!==w||N.numLightProbes!==C)&&(r.directional.length=d,r.spot.length=m,r.rectArea.length=_,r.point.length=p,r.hemi.length=v,r.directionalShadow.length=S,r.directionalShadowMap.length=S,r.pointShadow.length=b,r.pointShadowMap.length=b,r.spotShadow.length=T,r.spotShadowMap.length=T,r.directionalShadowMatrix.length=S,r.pointShadowMatrix.length=b,r.spotLightMatrix.length=T+w-R,r.spotLightMap.length=w,r.numSpotLightShadowsWithMaps=R,r.numLightProbes=C,N.directionalLength=d,N.pointLength=p,N.spotLength=m,N.rectAreaLength=_,N.hemiLength=v,N.numDirectionalShadows=S,N.numPointShadows=b,N.numSpotShadows=T,N.numSpotMaps=w,N.numLightProbes=C,r.version=pde++)}function c(l,u){let h=0,f=0,d=0,p=0,m=0;const _=u.matrixWorldInverse;for(let v=0,S=l.length;v<S;v++){const b=l[v];if(b.isDirectionalLight){const T=r.directional[h];T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(_),h++}else if(b.isSpotLight){const T=r.spot[d];T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(_),T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(_),d++}else if(b.isRectAreaLight){const T=r.rectArea[p];T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(_),o.identity(),s.copy(b.matrixWorld),s.premultiply(_),o.extractRotation(s),T.halfWidth.set(b.width*.5,0,0),T.halfHeight.set(0,b.height*.5,0),T.halfWidth.applyMatrix4(o),T.halfHeight.applyMatrix4(o),p++}else if(b.isPointLight){const T=r.point[f];T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(_),f++}else if(b.isHemisphereLight){const T=r.hemi[m];T.direction.setFromMatrixPosition(b.matrixWorld),T.direction.transformDirection(_),m++}}}return{setup:a,setupView:c,state:r}}function s7(n){const e=new gde(n),t=[],r=[];function i(u){l.camera=u,t.length=0,r.length=0}function s(u){t.push(u)}function o(u){r.push(u)}function a(){e.setup(t)}function c(u){e.setupView(t,u)}const l={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function _de(n){let e=new WeakMap;function t(i,s=0){const o=e.get(i);let a;return o===void 0?(a=new s7(n),e.set(i,[a])):s>=o.length?(a=new s7(n),o.push(a)):a=o[s],a}function r(){e=new WeakMap}return{get:t,dispose:r}}const vde=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,yde=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function bde(n,e,t){let r=new AW;const i=new zn,s=new zn,o=new Xo,a=new zce({depthPacking:Pae}),c=new $ce,l={},u=t.maxTextureSize,h={[X0]:Uc,[Uc]:X0,[Ia]:Ia},f=new lo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new zn},radius:{value:4}},vertexShader:vde,fragmentShader:yde}),d=f.clone();d.defines.HORIZONTAL_PASS=1;const p=new ag;p.setAttribute("position",new Eh(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new df(p,f),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=u5;let v=this.type;this.render=function(R,C,N){if(_.enabled===!1||_.autoUpdate===!1&&_.needsUpdate===!1||R.length===0)return;const U=n.getRenderTarget(),B=n.getActiveCubeFace(),$=n.getActiveMipmapLevel(),I=n.state;I.setBlending(ul),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);const L=v!==Tm&&this.type===Tm,P=v===Tm&&this.type!==Tm;for(let H=0,X=R.length;H<X;H++){const G=R[H],Y=G.shadow;if(Y===void 0){console.warn("THREE.WebGLShadowMap:",G,"has no shadow.");continue}if(Y.autoUpdate===!1&&Y.needsUpdate===!1)continue;i.copy(Y.mapSize);const J=Y.getFrameExtents();if(i.multiply(J),s.copy(Y.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/J.x),i.x=s.x*J.x,Y.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/J.y),i.y=s.y*J.y,Y.mapSize.y=s.y)),Y.map===null||L===!0||P===!0){const z=this.type!==Tm?{minFilter:jl,magFilter:jl}:{};Y.map!==null&&Y.map.dispose(),Y.map=new hl(i.x,i.y,z),Y.map.texture.name=G.name+".shadowMap",Y.camera.updateProjectionMatrix()}n.setRenderTarget(Y.map),n.clear();const Q=Y.getViewportCount();for(let z=0;z<Q;z++){const q=Y.getViewport(z);o.set(s.x*q.x,s.y*q.y,s.x*q.z,s.y*q.w),I.viewport(o),Y.updateMatrices(G,z),r=Y.getFrustum(),T(C,N,Y.camera,G,this.type)}Y.isPointLightShadow!==!0&&this.type===Tm&&S(Y,N),Y.needsUpdate=!1}v=this.type,_.needsUpdate=!1,n.setRenderTarget(U,B,$)};function S(R,C){const N=e.update(m);f.defines.VSM_SAMPLES!==R.blurSamples&&(f.defines.VSM_SAMPLES=R.blurSamples,d.defines.VSM_SAMPLES=R.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),R.mapPass===null&&(R.mapPass=new hl(i.x,i.y)),f.uniforms.shadow_pass.value=R.map.texture,f.uniforms.resolution.value=R.mapSize,f.uniforms.radius.value=R.radius,n.setRenderTarget(R.mapPass),n.clear(),n.renderBufferDirect(C,null,N,f,m,null),d.uniforms.shadow_pass.value=R.mapPass.texture,d.uniforms.resolution.value=R.mapSize,d.uniforms.radius.value=R.radius,n.setRenderTarget(R.map),n.clear(),n.renderBufferDirect(C,null,N,d,m,null)}function b(R,C,N,U){let B=null;const $=N.isPointLight===!0?R.customDistanceMaterial:R.customDepthMaterial;if($!==void 0)B=$;else if(B=N.isPointLight===!0?c:a,n.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0||C.alphaToCoverage===!0){const I=B.uuid,L=C.uuid;let P=l[I];P===void 0&&(P={},l[I]=P);let H=P[L];H===void 0&&(H=B.clone(),P[L]=H,C.addEventListener("dispose",w)),B=H}if(B.visible=C.visible,B.wireframe=C.wireframe,U===Tm?B.side=C.shadowSide!==null?C.shadowSide:C.side:B.side=C.shadowSide!==null?C.shadowSide:h[C.side],B.alphaMap=C.alphaMap,B.alphaTest=C.alphaToCoverage===!0?.5:C.alphaTest,B.map=C.map,B.clipShadows=C.clipShadows,B.clippingPlanes=C.clippingPlanes,B.clipIntersection=C.clipIntersection,B.displacementMap=C.displacementMap,B.displacementScale=C.displacementScale,B.displacementBias=C.displacementBias,B.wireframeLinewidth=C.wireframeLinewidth,B.linewidth=C.linewidth,N.isPointLight===!0&&B.isMeshDistanceMaterial===!0){const I=n.properties.get(B);I.light=N}return B}function T(R,C,N,U,B){if(R.visible===!1)return;if(R.layers.test(C.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&B===Tm)&&(!R.frustumCulled||r.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices(N.matrixWorldInverse,R.matrixWorld);const L=e.update(R),P=R.material;if(Array.isArray(P)){const H=L.groups;for(let X=0,G=H.length;X<G;X++){const Y=H[X],J=P[Y.materialIndex];if(J&&J.visible){const Q=b(R,J,U,B);R.onBeforeShadow(n,R,C,N,L,Q,Y),n.renderBufferDirect(N,null,L,Q,R,Y),R.onAfterShadow(n,R,C,N,L,Q,Y)}}}else if(P.visible){const H=b(R,P,U,B);R.onBeforeShadow(n,R,C,N,L,H,null),n.renderBufferDirect(N,null,L,H,R,null),R.onAfterShadow(n,R,C,N,L,H,null)}}const I=R.children;for(let L=0,P=I.length;L<P;L++)T(I[L],C,N,U,B)}function w(R){R.target.removeEventListener("dispose",w);for(const N in l){const U=l[N],B=R.target.uuid;B in U&&(U[B].dispose(),delete U[B])}}}const Sde={[MD]:_M,[ID]:PD,[OD]:DD,[ZE]:ND,[_M]:MD,[PD]:ID,[DD]:OD,[ND]:ZE};function Ede(n,e){function t(){let ke=!1;const Ve=new Xo;let Fe=null;const Ge=new Xo(0,0,0,0);return{setMask:function(at){Fe!==at&&!ke&&(n.colorMask(at,at,at,at),Fe=at)},setLocked:function(at){ke=at},setClear:function(at,Be,tt,rt,xt){xt===!0&&(at*=rt,Be*=rt,tt*=rt),Ve.set(at,Be,tt,rt),Ge.equals(Ve)===!1&&(n.clearColor(at,Be,tt,rt),Ge.copy(Ve))},reset:function(){ke=!1,Fe=null,Ge.set(-1,0,0,0)}}}function r(){let ke=!1,Ve=!1,Fe=null,Ge=null,at=null;return{setReversed:function(Be){if(Ve!==Be){const tt=e.get("EXT_clip_control");Be?tt.clipControlEXT(tt.LOWER_LEFT_EXT,tt.ZERO_TO_ONE_EXT):tt.clipControlEXT(tt.LOWER_LEFT_EXT,tt.NEGATIVE_ONE_TO_ONE_EXT),Ve=Be;const rt=at;at=null,this.setClear(rt)}},getReversed:function(){return Ve},setTest:function(Be){Be?Re(n.DEPTH_TEST):Te(n.DEPTH_TEST)},setMask:function(Be){Fe!==Be&&!ke&&(n.depthMask(Be),Fe=Be)},setFunc:function(Be){if(Ve&&(Be=Sde[Be]),Ge!==Be){switch(Be){case MD:n.depthFunc(n.NEVER);break;case _M:n.depthFunc(n.ALWAYS);break;case ID:n.depthFunc(n.LESS);break;case ZE:n.depthFunc(n.LEQUAL);break;case OD:n.depthFunc(n.EQUAL);break;case ND:n.depthFunc(n.GEQUAL);break;case PD:n.depthFunc(n.GREATER);break;case DD:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Ge=Be}},setLocked:function(Be){ke=Be},setClear:function(Be){at!==Be&&(Ve&&(Be=1-Be),n.clearDepth(Be),at=Be)},reset:function(){ke=!1,Fe=null,Ge=null,at=null,Ve=!1}}}function i(){let ke=!1,Ve=null,Fe=null,Ge=null,at=null,Be=null,tt=null,rt=null,xt=null;return{setTest:function(ot){ke||(ot?Re(n.STENCIL_TEST):Te(n.STENCIL_TEST))},setMask:function(ot){Ve!==ot&&!ke&&(n.stencilMask(ot),Ve=ot)},setFunc:function(ot,tn,ln){(Fe!==ot||Ge!==tn||at!==ln)&&(n.stencilFunc(ot,tn,ln),Fe=ot,Ge=tn,at=ln)},setOp:function(ot,tn,ln){(Be!==ot||tt!==tn||rt!==ln)&&(n.stencilOp(ot,tn,ln),Be=ot,tt=tn,rt=ln)},setLocked:function(ot){ke=ot},setClear:function(ot){xt!==ot&&(n.clearStencil(ot),xt=ot)},reset:function(){ke=!1,Ve=null,Fe=null,Ge=null,at=null,Be=null,tt=null,rt=null,xt=null}}}const s=new t,o=new r,a=new i,c=new WeakMap,l=new WeakMap;let u={},h={},f=new WeakMap,d=[],p=null,m=!1,_=null,v=null,S=null,b=null,T=null,w=null,R=null,C=new Ti(0,0,0),N=0,U=!1,B=null,$=null,I=null,L=null,P=null;const H=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,G=0;const Y=n.getParameter(n.VERSION);Y.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(Y)[1]),X=G>=1):Y.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),X=G>=2);let J=null,Q={};const z=n.getParameter(n.SCISSOR_BOX),q=n.getParameter(n.VIEWPORT),ee=new Xo().fromArray(z),te=new Xo().fromArray(q);function ie(ke,Ve,Fe,Ge){const at=new Uint8Array(4),Be=n.createTexture();n.bindTexture(ke,Be),n.texParameteri(ke,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(ke,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let tt=0;tt<Fe;tt++)ke===n.TEXTURE_3D||ke===n.TEXTURE_2D_ARRAY?n.texImage3D(Ve,0,n.RGBA,1,1,Ge,0,n.RGBA,n.UNSIGNED_BYTE,at):n.texImage2D(Ve+tt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,at);return Be}const Ee={};Ee[n.TEXTURE_2D]=ie(n.TEXTURE_2D,n.TEXTURE_2D,1),Ee[n.TEXTURE_CUBE_MAP]=ie(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Ee[n.TEXTURE_2D_ARRAY]=ie(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Ee[n.TEXTURE_3D]=ie(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Re(n.DEPTH_TEST),o.setFunc(ZE),$e(!1),De(tF),Re(n.CULL_FACE),re(ul);function Re(ke){u[ke]!==!0&&(n.enable(ke),u[ke]=!0)}function Te(ke){u[ke]!==!1&&(n.disable(ke),u[ke]=!1)}function Pe(ke,Ve){return h[ke]!==Ve?(n.bindFramebuffer(ke,Ve),h[ke]=Ve,ke===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=Ve),ke===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=Ve),!0):!1}function We(ke,Ve){let Fe=d,Ge=!1;if(ke){Fe=f.get(Ve),Fe===void 0&&(Fe=[],f.set(Ve,Fe));const at=ke.textures;if(Fe.length!==at.length||Fe[0]!==n.COLOR_ATTACHMENT0){for(let Be=0,tt=at.length;Be<tt;Be++)Fe[Be]=n.COLOR_ATTACHMENT0+Be;Fe.length=at.length,Ge=!0}}else Fe[0]!==n.BACK&&(Fe[0]=n.BACK,Ge=!0);Ge&&n.drawBuffers(Fe)}function it(ke){return p!==ke?(n.useProgram(ke),p=ke,!0):!1}const ht={[_b]:n.FUNC_ADD,[cae]:n.FUNC_SUBTRACT,[lae]:n.FUNC_REVERSE_SUBTRACT};ht[uae]=n.MIN,ht[hae]=n.MAX;const vt={[fae]:n.ZERO,[dae]:n.ONE,[pae]:n.SRC_COLOR,[RD]:n.SRC_ALPHA,[bae]:n.SRC_ALPHA_SATURATE,[vae]:n.DST_COLOR,[gae]:n.DST_ALPHA,[mae]:n.ONE_MINUS_SRC_COLOR,[kD]:n.ONE_MINUS_SRC_ALPHA,[yae]:n.ONE_MINUS_DST_COLOR,[_ae]:n.ONE_MINUS_DST_ALPHA,[Sae]:n.CONSTANT_COLOR,[Eae]:n.ONE_MINUS_CONSTANT_COLOR,[xae]:n.CONSTANT_ALPHA,[Tae]:n.ONE_MINUS_CONSTANT_ALPHA};function re(ke,Ve,Fe,Ge,at,Be,tt,rt,xt,ot){if(ke===ul){m===!0&&(Te(n.BLEND),m=!1);return}if(m===!1&&(Re(n.BLEND),m=!0),ke!==aae){if(ke!==_||ot!==U){if((v!==_b||T!==_b)&&(n.blendEquation(n.FUNC_ADD),v=_b,T=_b),ot)switch(ke){case BE:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case nF:n.blendFunc(n.ONE,n.ONE);break;case rF:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case iF:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ke);break}else switch(ke){case BE:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case nF:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case rF:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case iF:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ke);break}S=null,b=null,w=null,R=null,C.set(0,0,0),N=0,_=ke,U=ot}return}at=at||Ve,Be=Be||Fe,tt=tt||Ge,(Ve!==v||at!==T)&&(n.blendEquationSeparate(ht[Ve],ht[at]),v=Ve,T=at),(Fe!==S||Ge!==b||Be!==w||tt!==R)&&(n.blendFuncSeparate(vt[Fe],vt[Ge],vt[Be],vt[tt]),S=Fe,b=Ge,w=Be,R=tt),(rt.equals(C)===!1||xt!==N)&&(n.blendColor(rt.r,rt.g,rt.b,xt),C.copy(rt),N=xt),_=ke,U=!1}function Le(ke,Ve){ke.side===Ia?Te(n.CULL_FACE):Re(n.CULL_FACE);let Fe=ke.side===Uc;Ve&&(Fe=!Fe),$e(Fe),ke.blending===BE&&ke.transparent===!1?re(ul):re(ke.blending,ke.blendEquation,ke.blendSrc,ke.blendDst,ke.blendEquationAlpha,ke.blendSrcAlpha,ke.blendDstAlpha,ke.blendColor,ke.blendAlpha,ke.premultipliedAlpha),o.setFunc(ke.depthFunc),o.setTest(ke.depthTest),o.setMask(ke.depthWrite),s.setMask(ke.colorWrite);const Ge=ke.stencilWrite;a.setTest(Ge),Ge&&(a.setMask(ke.stencilWriteMask),a.setFunc(ke.stencilFunc,ke.stencilRef,ke.stencilFuncMask),a.setOp(ke.stencilFail,ke.stencilZFail,ke.stencilZPass)),ae(ke.polygonOffset,ke.polygonOffsetFactor,ke.polygonOffsetUnits),ke.alphaToCoverage===!0?Re(n.SAMPLE_ALPHA_TO_COVERAGE):Te(n.SAMPLE_ALPHA_TO_COVERAGE)}function $e(ke){B!==ke&&(ke?n.frontFace(n.CW):n.frontFace(n.CCW),B=ke)}function De(ke){ke!==iae?(Re(n.CULL_FACE),ke!==$&&(ke===tF?n.cullFace(n.BACK):ke===sae?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Te(n.CULL_FACE),$=ke}function Oe(ke){ke!==I&&(X&&n.lineWidth(ke),I=ke)}function ae(ke,Ve,Fe){ke?(Re(n.POLYGON_OFFSET_FILL),(L!==Ve||P!==Fe)&&(n.polygonOffset(Ve,Fe),L=Ve,P=Fe)):Te(n.POLYGON_OFFSET_FILL)}function ve(ke){ke?Re(n.SCISSOR_TEST):Te(n.SCISSOR_TEST)}function xe(ke){ke===void 0&&(ke=n.TEXTURE0+H-1),J!==ke&&(n.activeTexture(ke),J=ke)}function pe(ke,Ve,Fe){Fe===void 0&&(J===null?Fe=n.TEXTURE0+H-1:Fe=J);let Ge=Q[Fe];Ge===void 0&&(Ge={type:void 0,texture:void 0},Q[Fe]=Ge),(Ge.type!==ke||Ge.texture!==Ve)&&(J!==Fe&&(n.activeTexture(Fe),J=Fe),n.bindTexture(ke,Ve||Ee[ke]),Ge.type=ke,Ge.texture=Ve)}function ze(){const ke=Q[J];ke!==void 0&&ke.type!==void 0&&(n.bindTexture(ke.type,null),ke.type=void 0,ke.texture=void 0)}function Je(){try{n.compressedTexImage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function Xe(){try{n.compressedTexImage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function et(){try{n.texSubImage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function Ut(){try{n.texSubImage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function gt(){try{n.compressedTexSubImage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function At(){try{n.compressedTexSubImage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function Ce(){try{n.texStorage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function se(){try{n.texStorage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function W(){try{n.texImage2D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function oe(){try{n.texImage3D(...arguments)}catch(ke){console.error("THREE.WebGLState:",ke)}}function Se(ke){ee.equals(ke)===!1&&(n.scissor(ke.x,ke.y,ke.z,ke.w),ee.copy(ke))}function Ae(ke){te.equals(ke)===!1&&(n.viewport(ke.x,ke.y,ke.z,ke.w),te.copy(ke))}function ye(ke,Ve){let Fe=l.get(Ve);Fe===void 0&&(Fe=new WeakMap,l.set(Ve,Fe));let Ge=Fe.get(ke);Ge===void 0&&(Ge=n.getUniformBlockIndex(Ve,ke.name),Fe.set(ke,Ge))}function _e(ke,Ve){const Ge=l.get(Ve).get(ke);c.get(Ve)!==Ge&&(n.uniformBlockBinding(Ve,Ge,ke.__bindingPointIndex),c.set(Ve,Ge))}function Ye(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},J=null,Q={},h={},f=new WeakMap,d=[],p=null,m=!1,_=null,v=null,S=null,b=null,T=null,w=null,R=null,C=new Ti(0,0,0),N=0,U=!1,B=null,$=null,I=null,L=null,P=null,ee.set(0,0,n.canvas.width,n.canvas.height),te.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Re,disable:Te,bindFramebuffer:Pe,drawBuffers:We,useProgram:it,setBlending:re,setMaterial:Le,setFlipSided:$e,setCullFace:De,setLineWidth:Oe,setPolygonOffset:ae,setScissorTest:ve,activeTexture:xe,bindTexture:pe,unbindTexture:ze,compressedTexImage2D:Je,compressedTexImage3D:Xe,texImage2D:W,texImage3D:oe,updateUBOMapping:ye,uniformBlockBinding:_e,texStorage2D:Ce,texStorage3D:se,texSubImage2D:et,texSubImage3D:Ut,compressedTexSubImage2D:gt,compressedTexSubImage3D:At,scissor:Se,viewport:Ae,reset:Ye}}function xde(n,e,t,r,i,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new zn,u=new WeakMap;let h;const f=new WeakMap;let d=!1;try{d=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(xe,pe){return d?new OffscreenCanvas(xe,pe):Jw("canvas")}function m(xe,pe,ze){let Je=1;const Xe=ve(xe);if((Xe.width>ze||Xe.height>ze)&&(Je=ze/Math.max(Xe.width,Xe.height)),Je<1)if(typeof HTMLImageElement<"u"&&xe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&xe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&xe instanceof ImageBitmap||typeof VideoFrame<"u"&&xe instanceof VideoFrame){const et=Math.floor(Je*Xe.width),Ut=Math.floor(Je*Xe.height);h===void 0&&(h=p(et,Ut));const gt=pe?p(et,Ut):h;return gt.width=et,gt.height=Ut,gt.getContext("2d").drawImage(xe,0,0,et,Ut),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Xe.width+"x"+Xe.height+") to ("+et+"x"+Ut+")."),gt}else return"data"in xe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Xe.width+"x"+Xe.height+")."),xe;return xe}function _(xe){return xe.generateMipmaps}function v(xe){n.generateMipmap(xe)}function S(xe){return xe.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:xe.isWebGL3DRenderTarget?n.TEXTURE_3D:xe.isWebGLArrayRenderTarget||xe.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function b(xe,pe,ze,Je,Xe=!1){if(xe!==null){if(n[xe]!==void 0)return n[xe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+xe+"'")}let et=pe;if(pe===n.RED&&(ze===n.FLOAT&&(et=n.R32F),ze===n.HALF_FLOAT&&(et=n.R16F),ze===n.UNSIGNED_BYTE&&(et=n.R8)),pe===n.RED_INTEGER&&(ze===n.UNSIGNED_BYTE&&(et=n.R8UI),ze===n.UNSIGNED_SHORT&&(et=n.R16UI),ze===n.UNSIGNED_INT&&(et=n.R32UI),ze===n.BYTE&&(et=n.R8I),ze===n.SHORT&&(et=n.R16I),ze===n.INT&&(et=n.R32I)),pe===n.RG&&(ze===n.FLOAT&&(et=n.RG32F),ze===n.HALF_FLOAT&&(et=n.RG16F),ze===n.UNSIGNED_BYTE&&(et=n.RG8)),pe===n.RG_INTEGER&&(ze===n.UNSIGNED_BYTE&&(et=n.RG8UI),ze===n.UNSIGNED_SHORT&&(et=n.RG16UI),ze===n.UNSIGNED_INT&&(et=n.RG32UI),ze===n.BYTE&&(et=n.RG8I),ze===n.SHORT&&(et=n.RG16I),ze===n.INT&&(et=n.RG32I)),pe===n.RGB_INTEGER&&(ze===n.UNSIGNED_BYTE&&(et=n.RGB8UI),ze===n.UNSIGNED_SHORT&&(et=n.RGB16UI),ze===n.UNSIGNED_INT&&(et=n.RGB32UI),ze===n.BYTE&&(et=n.RGB8I),ze===n.SHORT&&(et=n.RGB16I),ze===n.INT&&(et=n.RGB32I)),pe===n.RGBA_INTEGER&&(ze===n.UNSIGNED_BYTE&&(et=n.RGBA8UI),ze===n.UNSIGNED_SHORT&&(et=n.RGBA16UI),ze===n.UNSIGNED_INT&&(et=n.RGBA32UI),ze===n.BYTE&&(et=n.RGBA8I),ze===n.SHORT&&(et=n.RGBA16I),ze===n.INT&&(et=n.RGBA32I)),pe===n.RGB&&ze===n.UNSIGNED_INT_5_9_9_9_REV&&(et=n.RGB9_E5),pe===n.RGBA){const Ut=Xe?yM:Zi.getTransfer(Je);ze===n.FLOAT&&(et=n.RGBA32F),ze===n.HALF_FLOAT&&(et=n.RGBA16F),ze===n.UNSIGNED_BYTE&&(et=Ut===Bs?n.SRGB8_ALPHA8:n.RGBA8),ze===n.UNSIGNED_SHORT_4_4_4_4&&(et=n.RGBA4),ze===n.UNSIGNED_SHORT_5_5_5_1&&(et=n.RGB5_A1)}return(et===n.R16F||et===n.R32F||et===n.RG16F||et===n.RG32F||et===n.RGBA16F||et===n.RGBA32F)&&e.get("EXT_color_buffer_float"),et}function T(xe,pe){let ze;return xe?pe===null||pe===jv||pe===ex?ze=n.DEPTH24_STENCIL8:pe===dp?ze=n.DEPTH32F_STENCIL8:pe===Kw&&(ze=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):pe===null||pe===jv||pe===ex?ze=n.DEPTH_COMPONENT24:pe===dp?ze=n.DEPTH_COMPONENT32F:pe===Kw&&(ze=n.DEPTH_COMPONENT16),ze}function w(xe,pe){return _(xe)===!0||xe.isFramebufferTexture&&xe.minFilter!==jl&&xe.minFilter!==Bl?Math.log2(Math.max(pe.width,pe.height))+1:xe.mipmaps!==void 0&&xe.mipmaps.length>0?xe.mipmaps.length:xe.isCompressedTexture&&Array.isArray(xe.image)?pe.mipmaps.length:1}function R(xe){const pe=xe.target;pe.removeEventListener("dispose",R),N(pe),pe.isVideoTexture&&u.delete(pe)}function C(xe){const pe=xe.target;pe.removeEventListener("dispose",C),B(pe)}function N(xe){const pe=r.get(xe);if(pe.__webglInit===void 0)return;const ze=xe.source,Je=f.get(ze);if(Je){const Xe=Je[pe.__cacheKey];Xe.usedTimes--,Xe.usedTimes===0&&U(xe),Object.keys(Je).length===0&&f.delete(ze)}r.remove(xe)}function U(xe){const pe=r.get(xe);n.deleteTexture(pe.__webglTexture);const ze=xe.source,Je=f.get(ze);delete Je[pe.__cacheKey],o.memory.textures--}function B(xe){const pe=r.get(xe);if(xe.depthTexture&&(xe.depthTexture.dispose(),r.remove(xe.depthTexture)),xe.isWebGLCubeRenderTarget)for(let Je=0;Je<6;Je++){if(Array.isArray(pe.__webglFramebuffer[Je]))for(let Xe=0;Xe<pe.__webglFramebuffer[Je].length;Xe++)n.deleteFramebuffer(pe.__webglFramebuffer[Je][Xe]);else n.deleteFramebuffer(pe.__webglFramebuffer[Je]);pe.__webglDepthbuffer&&n.deleteRenderbuffer(pe.__webglDepthbuffer[Je])}else{if(Array.isArray(pe.__webglFramebuffer))for(let Je=0;Je<pe.__webglFramebuffer.length;Je++)n.deleteFramebuffer(pe.__webglFramebuffer[Je]);else n.deleteFramebuffer(pe.__webglFramebuffer);if(pe.__webglDepthbuffer&&n.deleteRenderbuffer(pe.__webglDepthbuffer),pe.__webglMultisampledFramebuffer&&n.deleteFramebuffer(pe.__webglMultisampledFramebuffer),pe.__webglColorRenderbuffer)for(let Je=0;Je<pe.__webglColorRenderbuffer.length;Je++)pe.__webglColorRenderbuffer[Je]&&n.deleteRenderbuffer(pe.__webglColorRenderbuffer[Je]);pe.__webglDepthRenderbuffer&&n.deleteRenderbuffer(pe.__webglDepthRenderbuffer)}const ze=xe.textures;for(let Je=0,Xe=ze.length;Je<Xe;Je++){const et=r.get(ze[Je]);et.__webglTexture&&(n.deleteTexture(et.__webglTexture),o.memory.textures--),r.remove(ze[Je])}r.remove(xe)}let $=0;function I(){$=0}function L(){const xe=$;return xe>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+xe+" texture units while this GPU supports only "+i.maxTextures),$+=1,xe}function P(xe){const pe=[];return pe.push(xe.wrapS),pe.push(xe.wrapT),pe.push(xe.wrapR||0),pe.push(xe.magFilter),pe.push(xe.minFilter),pe.push(xe.anisotropy),pe.push(xe.internalFormat),pe.push(xe.format),pe.push(xe.type),pe.push(xe.generateMipmaps),pe.push(xe.premultiplyAlpha),pe.push(xe.flipY),pe.push(xe.unpackAlignment),pe.push(xe.colorSpace),pe.join()}function H(xe,pe){const ze=r.get(xe);if(xe.isVideoTexture&&Oe(xe),xe.isRenderTargetTexture===!1&&xe.version>0&&ze.__version!==xe.version){const Je=xe.image;if(Je===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Je.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{te(ze,xe,pe);return}}t.bindTexture(n.TEXTURE_2D,ze.__webglTexture,n.TEXTURE0+pe)}function X(xe,pe){const ze=r.get(xe);if(xe.version>0&&ze.__version!==xe.version){te(ze,xe,pe);return}t.bindTexture(n.TEXTURE_2D_ARRAY,ze.__webglTexture,n.TEXTURE0+pe)}function G(xe,pe){const ze=r.get(xe);if(xe.version>0&&ze.__version!==xe.version){te(ze,xe,pe);return}t.bindTexture(n.TEXTURE_3D,ze.__webglTexture,n.TEXTURE0+pe)}function Y(xe,pe){const ze=r.get(xe);if(xe.version>0&&ze.__version!==xe.version){ie(ze,xe,pe);return}t.bindTexture(n.TEXTURE_CUBE_MAP,ze.__webglTexture,n.TEXTURE0+pe)}const J={[vM]:n.REPEAT,[xb]:n.CLAMP_TO_EDGE,[BD]:n.MIRRORED_REPEAT},Q={[jl]:n.NEAREST,[Nae]:n.NEAREST_MIPMAP_NEAREST,[JC]:n.NEAREST_MIPMAP_LINEAR,[Bl]:n.LINEAR,[q3]:n.LINEAR_MIPMAP_NEAREST,[Tb]:n.LINEAR_MIPMAP_LINEAR},z={[Uae]:n.NEVER,[Vae]:n.ALWAYS,[Bae]:n.LESS,[gW]:n.LEQUAL,[Fae]:n.EQUAL,[$ae]:n.GEQUAL,[jae]:n.GREATER,[zae]:n.NOTEQUAL};function q(xe,pe){if(pe.type===dp&&e.has("OES_texture_float_linear")===!1&&(pe.magFilter===Bl||pe.magFilter===q3||pe.magFilter===JC||pe.magFilter===Tb||pe.minFilter===Bl||pe.minFilter===q3||pe.minFilter===JC||pe.minFilter===Tb)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(xe,n.TEXTURE_WRAP_S,J[pe.wrapS]),n.texParameteri(xe,n.TEXTURE_WRAP_T,J[pe.wrapT]),(xe===n.TEXTURE_3D||xe===n.TEXTURE_2D_ARRAY)&&n.texParameteri(xe,n.TEXTURE_WRAP_R,J[pe.wrapR]),n.texParameteri(xe,n.TEXTURE_MAG_FILTER,Q[pe.magFilter]),n.texParameteri(xe,n.TEXTURE_MIN_FILTER,Q[pe.minFilter]),pe.compareFunction&&(n.texParameteri(xe,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(xe,n.TEXTURE_COMPARE_FUNC,z[pe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(pe.magFilter===jl||pe.minFilter!==JC&&pe.minFilter!==Tb||pe.type===dp&&e.has("OES_texture_float_linear")===!1)return;if(pe.anisotropy>1||r.get(pe).__currentAnisotropy){const ze=e.get("EXT_texture_filter_anisotropic");n.texParameterf(xe,ze.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(pe.anisotropy,i.getMaxAnisotropy())),r.get(pe).__currentAnisotropy=pe.anisotropy}}}function ee(xe,pe){let ze=!1;xe.__webglInit===void 0&&(xe.__webglInit=!0,pe.addEventListener("dispose",R));const Je=pe.source;let Xe=f.get(Je);Xe===void 0&&(Xe={},f.set(Je,Xe));const et=P(pe);if(et!==xe.__cacheKey){Xe[et]===void 0&&(Xe[et]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,ze=!0),Xe[et].usedTimes++;const Ut=Xe[xe.__cacheKey];Ut!==void 0&&(Xe[xe.__cacheKey].usedTimes--,Ut.usedTimes===0&&U(pe)),xe.__cacheKey=et,xe.__webglTexture=Xe[et].texture}return ze}function te(xe,pe,ze){let Je=n.TEXTURE_2D;(pe.isDataArrayTexture||pe.isCompressedArrayTexture)&&(Je=n.TEXTURE_2D_ARRAY),pe.isData3DTexture&&(Je=n.TEXTURE_3D);const Xe=ee(xe,pe),et=pe.source;t.bindTexture(Je,xe.__webglTexture,n.TEXTURE0+ze);const Ut=r.get(et);if(et.version!==Ut.__version||Xe===!0){t.activeTexture(n.TEXTURE0+ze);const gt=Zi.getPrimaries(Zi.workingColorSpace),At=pe.colorSpace===Pm?null:Zi.getPrimaries(pe.colorSpace),Ce=pe.colorSpace===Pm||gt===At?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,pe.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,pe.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ce);let se=m(pe.image,!1,i.maxTextureSize);se=ae(pe,se);const W=s.convert(pe.format,pe.colorSpace),oe=s.convert(pe.type);let Se=b(pe.internalFormat,W,oe,pe.colorSpace,pe.isVideoTexture);q(Je,pe);let Ae;const ye=pe.mipmaps,_e=pe.isVideoTexture!==!0,Ye=Ut.__version===void 0||Xe===!0,ke=et.dataReady,Ve=w(pe,se);if(pe.isDepthTexture)Se=T(pe.format===tx,pe.type),Ye&&(_e?t.texStorage2D(n.TEXTURE_2D,1,Se,se.width,se.height):t.texImage2D(n.TEXTURE_2D,0,Se,se.width,se.height,0,W,oe,null));else if(pe.isDataTexture)if(ye.length>0){_e&&Ye&&t.texStorage2D(n.TEXTURE_2D,Ve,Se,ye[0].width,ye[0].height);for(let Fe=0,Ge=ye.length;Fe<Ge;Fe++)Ae=ye[Fe],_e?ke&&t.texSubImage2D(n.TEXTURE_2D,Fe,0,0,Ae.width,Ae.height,W,oe,Ae.data):t.texImage2D(n.TEXTURE_2D,Fe,Se,Ae.width,Ae.height,0,W,oe,Ae.data);pe.generateMipmaps=!1}else _e?(Ye&&t.texStorage2D(n.TEXTURE_2D,Ve,Se,se.width,se.height),ke&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,se.width,se.height,W,oe,se.data)):t.texImage2D(n.TEXTURE_2D,0,Se,se.width,se.height,0,W,oe,se.data);else if(pe.isCompressedTexture)if(pe.isCompressedArrayTexture){_e&&Ye&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ve,Se,ye[0].width,ye[0].height,se.depth);for(let Fe=0,Ge=ye.length;Fe<Ge;Fe++)if(Ae=ye[Fe],pe.format!==_u)if(W!==null)if(_e){if(ke)if(pe.layerUpdates.size>0){const at=DF(Ae.width,Ae.height,pe.format,pe.type);for(const Be of pe.layerUpdates){const tt=Ae.data.subarray(Be*at/Ae.data.BYTES_PER_ELEMENT,(Be+1)*at/Ae.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Fe,0,0,Be,Ae.width,Ae.height,1,W,tt)}pe.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Fe,0,0,0,Ae.width,Ae.height,se.depth,W,Ae.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Fe,Se,Ae.width,Ae.height,se.depth,0,Ae.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else _e?ke&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Fe,0,0,0,Ae.width,Ae.height,se.depth,W,oe,Ae.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Fe,Se,Ae.width,Ae.height,se.depth,0,W,oe,Ae.data)}else{_e&&Ye&&t.texStorage2D(n.TEXTURE_2D,Ve,Se,ye[0].width,ye[0].height);for(let Fe=0,Ge=ye.length;Fe<Ge;Fe++)Ae=ye[Fe],pe.format!==_u?W!==null?_e?ke&&t.compressedTexSubImage2D(n.TEXTURE_2D,Fe,0,0,Ae.width,Ae.height,W,Ae.data):t.compressedTexImage2D(n.TEXTURE_2D,Fe,Se,Ae.width,Ae.height,0,Ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_e?ke&&t.texSubImage2D(n.TEXTURE_2D,Fe,0,0,Ae.width,Ae.height,W,oe,Ae.data):t.texImage2D(n.TEXTURE_2D,Fe,Se,Ae.width,Ae.height,0,W,oe,Ae.data)}else if(pe.isDataArrayTexture)if(_e){if(Ye&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Ve,Se,se.width,se.height,se.depth),ke)if(pe.layerUpdates.size>0){const Fe=DF(se.width,se.height,pe.format,pe.type);for(const Ge of pe.layerUpdates){const at=se.data.subarray(Ge*Fe/se.data.BYTES_PER_ELEMENT,(Ge+1)*Fe/se.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Ge,se.width,se.height,1,W,oe,at)}pe.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,se.width,se.height,se.depth,W,oe,se.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Se,se.width,se.height,se.depth,0,W,oe,se.data);else if(pe.isData3DTexture)_e?(Ye&&t.texStorage3D(n.TEXTURE_3D,Ve,Se,se.width,se.height,se.depth),ke&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,se.width,se.height,se.depth,W,oe,se.data)):t.texImage3D(n.TEXTURE_3D,0,Se,se.width,se.height,se.depth,0,W,oe,se.data);else if(pe.isFramebufferTexture){if(Ye)if(_e)t.texStorage2D(n.TEXTURE_2D,Ve,Se,se.width,se.height);else{let Fe=se.width,Ge=se.height;for(let at=0;at<Ve;at++)t.texImage2D(n.TEXTURE_2D,at,Se,Fe,Ge,0,W,oe,null),Fe>>=1,Ge>>=1}}else if(ye.length>0){if(_e&&Ye){const Fe=ve(ye[0]);t.texStorage2D(n.TEXTURE_2D,Ve,Se,Fe.width,Fe.height)}for(let Fe=0,Ge=ye.length;Fe<Ge;Fe++)Ae=ye[Fe],_e?ke&&t.texSubImage2D(n.TEXTURE_2D,Fe,0,0,W,oe,Ae):t.texImage2D(n.TEXTURE_2D,Fe,Se,W,oe,Ae);pe.generateMipmaps=!1}else if(_e){if(Ye){const Fe=ve(se);t.texStorage2D(n.TEXTURE_2D,Ve,Se,Fe.width,Fe.height)}ke&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,W,oe,se)}else t.texImage2D(n.TEXTURE_2D,0,Se,W,oe,se);_(pe)&&v(Je),Ut.__version=et.version,pe.onUpdate&&pe.onUpdate(pe)}xe.__version=pe.version}function ie(xe,pe,ze){if(pe.image.length!==6)return;const Je=ee(xe,pe),Xe=pe.source;t.bindTexture(n.TEXTURE_CUBE_MAP,xe.__webglTexture,n.TEXTURE0+ze);const et=r.get(Xe);if(Xe.version!==et.__version||Je===!0){t.activeTexture(n.TEXTURE0+ze);const Ut=Zi.getPrimaries(Zi.workingColorSpace),gt=pe.colorSpace===Pm?null:Zi.getPrimaries(pe.colorSpace),At=pe.colorSpace===Pm||Ut===gt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,pe.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,pe.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,At);const Ce=pe.isCompressedTexture||pe.image[0].isCompressedTexture,se=pe.image[0]&&pe.image[0].isDataTexture,W=[];for(let Ge=0;Ge<6;Ge++)!Ce&&!se?W[Ge]=m(pe.image[Ge],!0,i.maxCubemapSize):W[Ge]=se?pe.image[Ge].image:pe.image[Ge],W[Ge]=ae(pe,W[Ge]);const oe=W[0],Se=s.convert(pe.format,pe.colorSpace),Ae=s.convert(pe.type),ye=b(pe.internalFormat,Se,Ae,pe.colorSpace),_e=pe.isVideoTexture!==!0,Ye=et.__version===void 0||Je===!0,ke=Xe.dataReady;let Ve=w(pe,oe);q(n.TEXTURE_CUBE_MAP,pe);let Fe;if(Ce){_e&&Ye&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Ve,ye,oe.width,oe.height);for(let Ge=0;Ge<6;Ge++){Fe=W[Ge].mipmaps;for(let at=0;at<Fe.length;at++){const Be=Fe[at];pe.format!==_u?Se!==null?_e?ke&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,at,0,0,Be.width,Be.height,Se,Be.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,at,ye,Be.width,Be.height,0,Be.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_e?ke&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,at,0,0,Be.width,Be.height,Se,Ae,Be.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,at,ye,Be.width,Be.height,0,Se,Ae,Be.data)}}}else{if(Fe=pe.mipmaps,_e&&Ye){Fe.length>0&&Ve++;const Ge=ve(W[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Ve,ye,Ge.width,Ge.height)}for(let Ge=0;Ge<6;Ge++)if(se){_e?ke&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,0,0,0,W[Ge].width,W[Ge].height,Se,Ae,W[Ge].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,0,ye,W[Ge].width,W[Ge].height,0,Se,Ae,W[Ge].data);for(let at=0;at<Fe.length;at++){const tt=Fe[at].image[Ge].image;_e?ke&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,at+1,0,0,tt.width,tt.height,Se,Ae,tt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,at+1,ye,tt.width,tt.height,0,Se,Ae,tt.data)}}else{_e?ke&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,0,0,0,Se,Ae,W[Ge]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,0,ye,Se,Ae,W[Ge]);for(let at=0;at<Fe.length;at++){const Be=Fe[at];_e?ke&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,at+1,0,0,Se,Ae,Be.image[Ge]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ge,at+1,ye,Se,Ae,Be.image[Ge])}}}_(pe)&&v(n.TEXTURE_CUBE_MAP),et.__version=Xe.version,pe.onUpdate&&pe.onUpdate(pe)}xe.__version=pe.version}function Ee(xe,pe,ze,Je,Xe,et){const Ut=s.convert(ze.format,ze.colorSpace),gt=s.convert(ze.type),At=b(ze.internalFormat,Ut,gt,ze.colorSpace),Ce=r.get(pe),se=r.get(ze);if(se.__renderTarget=pe,!Ce.__hasExternalTextures){const W=Math.max(1,pe.width>>et),oe=Math.max(1,pe.height>>et);Xe===n.TEXTURE_3D||Xe===n.TEXTURE_2D_ARRAY?t.texImage3D(Xe,et,At,W,oe,pe.depth,0,Ut,gt,null):t.texImage2D(Xe,et,At,W,oe,0,Ut,gt,null)}t.bindFramebuffer(n.FRAMEBUFFER,xe),De(pe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Je,Xe,se.__webglTexture,0,$e(pe)):(Xe===n.TEXTURE_2D||Xe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Xe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Je,Xe,se.__webglTexture,et),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Re(xe,pe,ze){if(n.bindRenderbuffer(n.RENDERBUFFER,xe),pe.depthBuffer){const Je=pe.depthTexture,Xe=Je&&Je.isDepthTexture?Je.type:null,et=T(pe.stencilBuffer,Xe),Ut=pe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,gt=$e(pe);De(pe)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,gt,et,pe.width,pe.height):ze?n.renderbufferStorageMultisample(n.RENDERBUFFER,gt,et,pe.width,pe.height):n.renderbufferStorage(n.RENDERBUFFER,et,pe.width,pe.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Ut,n.RENDERBUFFER,xe)}else{const Je=pe.textures;for(let Xe=0;Xe<Je.length;Xe++){const et=Je[Xe],Ut=s.convert(et.format,et.colorSpace),gt=s.convert(et.type),At=b(et.internalFormat,Ut,gt,et.colorSpace),Ce=$e(pe);ze&&De(pe)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ce,At,pe.width,pe.height):De(pe)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ce,At,pe.width,pe.height):n.renderbufferStorage(n.RENDERBUFFER,At,pe.width,pe.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Te(xe,pe){if(pe&&pe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,xe),!(pe.depthTexture&&pe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Je=r.get(pe.depthTexture);Je.__renderTarget=pe,(!Je.__webglTexture||pe.depthTexture.image.width!==pe.width||pe.depthTexture.image.height!==pe.height)&&(pe.depthTexture.image.width=pe.width,pe.depthTexture.image.height=pe.height,pe.depthTexture.needsUpdate=!0),H(pe.depthTexture,0);const Xe=Je.__webglTexture,et=$e(pe);if(pe.depthTexture.format===Xw)De(pe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Xe,0,et):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Xe,0);else if(pe.depthTexture.format===tx)De(pe)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Xe,0,et):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Xe,0);else throw new Error("Unknown depthTexture format")}function Pe(xe){const pe=r.get(xe),ze=xe.isWebGLCubeRenderTarget===!0;if(pe.__boundDepthTexture!==xe.depthTexture){const Je=xe.depthTexture;if(pe.__depthDisposeCallback&&pe.__depthDisposeCallback(),Je){const Xe=()=>{delete pe.__boundDepthTexture,delete pe.__depthDisposeCallback,Je.removeEventListener("dispose",Xe)};Je.addEventListener("dispose",Xe),pe.__depthDisposeCallback=Xe}pe.__boundDepthTexture=Je}if(xe.depthTexture&&!pe.__autoAllocateDepthBuffer){if(ze)throw new Error("target.depthTexture not supported in Cube render targets");const Je=xe.texture.mipmaps;Je&&Je.length>0?Te(pe.__webglFramebuffer[0],xe):Te(pe.__webglFramebuffer,xe)}else if(ze){pe.__webglDepthbuffer=[];for(let Je=0;Je<6;Je++)if(t.bindFramebuffer(n.FRAMEBUFFER,pe.__webglFramebuffer[Je]),pe.__webglDepthbuffer[Je]===void 0)pe.__webglDepthbuffer[Je]=n.createRenderbuffer(),Re(pe.__webglDepthbuffer[Je],xe,!1);else{const Xe=xe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,et=pe.__webglDepthbuffer[Je];n.bindRenderbuffer(n.RENDERBUFFER,et),n.framebufferRenderbuffer(n.FRAMEBUFFER,Xe,n.RENDERBUFFER,et)}}else{const Je=xe.texture.mipmaps;if(Je&&Je.length>0?t.bindFramebuffer(n.FRAMEBUFFER,pe.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,pe.__webglFramebuffer),pe.__webglDepthbuffer===void 0)pe.__webglDepthbuffer=n.createRenderbuffer(),Re(pe.__webglDepthbuffer,xe,!1);else{const Xe=xe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,et=pe.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,et),n.framebufferRenderbuffer(n.FRAMEBUFFER,Xe,n.RENDERBUFFER,et)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function We(xe,pe,ze){const Je=r.get(xe);pe!==void 0&&Ee(Je.__webglFramebuffer,xe,xe.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ze!==void 0&&Pe(xe)}function it(xe){const pe=xe.texture,ze=r.get(xe),Je=r.get(pe);xe.addEventListener("dispose",C);const Xe=xe.textures,et=xe.isWebGLCubeRenderTarget===!0,Ut=Xe.length>1;if(Ut||(Je.__webglTexture===void 0&&(Je.__webglTexture=n.createTexture()),Je.__version=pe.version,o.memory.textures++),et){ze.__webglFramebuffer=[];for(let gt=0;gt<6;gt++)if(pe.mipmaps&&pe.mipmaps.length>0){ze.__webglFramebuffer[gt]=[];for(let At=0;At<pe.mipmaps.length;At++)ze.__webglFramebuffer[gt][At]=n.createFramebuffer()}else ze.__webglFramebuffer[gt]=n.createFramebuffer()}else{if(pe.mipmaps&&pe.mipmaps.length>0){ze.__webglFramebuffer=[];for(let gt=0;gt<pe.mipmaps.length;gt++)ze.__webglFramebuffer[gt]=n.createFramebuffer()}else ze.__webglFramebuffer=n.createFramebuffer();if(Ut)for(let gt=0,At=Xe.length;gt<At;gt++){const Ce=r.get(Xe[gt]);Ce.__webglTexture===void 0&&(Ce.__webglTexture=n.createTexture(),o.memory.textures++)}if(xe.samples>0&&De(xe)===!1){ze.__webglMultisampledFramebuffer=n.createFramebuffer(),ze.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,ze.__webglMultisampledFramebuffer);for(let gt=0;gt<Xe.length;gt++){const At=Xe[gt];ze.__webglColorRenderbuffer[gt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ze.__webglColorRenderbuffer[gt]);const Ce=s.convert(At.format,At.colorSpace),se=s.convert(At.type),W=b(At.internalFormat,Ce,se,At.colorSpace,xe.isXRRenderTarget===!0),oe=$e(xe);n.renderbufferStorageMultisample(n.RENDERBUFFER,oe,W,xe.width,xe.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+gt,n.RENDERBUFFER,ze.__webglColorRenderbuffer[gt])}n.bindRenderbuffer(n.RENDERBUFFER,null),xe.depthBuffer&&(ze.__webglDepthRenderbuffer=n.createRenderbuffer(),Re(ze.__webglDepthRenderbuffer,xe,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(et){t.bindTexture(n.TEXTURE_CUBE_MAP,Je.__webglTexture),q(n.TEXTURE_CUBE_MAP,pe);for(let gt=0;gt<6;gt++)if(pe.mipmaps&&pe.mipmaps.length>0)for(let At=0;At<pe.mipmaps.length;At++)Ee(ze.__webglFramebuffer[gt][At],xe,pe,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+gt,At);else Ee(ze.__webglFramebuffer[gt],xe,pe,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+gt,0);_(pe)&&v(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ut){for(let gt=0,At=Xe.length;gt<At;gt++){const Ce=Xe[gt],se=r.get(Ce);t.bindTexture(n.TEXTURE_2D,se.__webglTexture),q(n.TEXTURE_2D,Ce),Ee(ze.__webglFramebuffer,xe,Ce,n.COLOR_ATTACHMENT0+gt,n.TEXTURE_2D,0),_(Ce)&&v(n.TEXTURE_2D)}t.unbindTexture()}else{let gt=n.TEXTURE_2D;if((xe.isWebGL3DRenderTarget||xe.isWebGLArrayRenderTarget)&&(gt=xe.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(gt,Je.__webglTexture),q(gt,pe),pe.mipmaps&&pe.mipmaps.length>0)for(let At=0;At<pe.mipmaps.length;At++)Ee(ze.__webglFramebuffer[At],xe,pe,n.COLOR_ATTACHMENT0,gt,At);else Ee(ze.__webglFramebuffer,xe,pe,n.COLOR_ATTACHMENT0,gt,0);_(pe)&&v(gt),t.unbindTexture()}xe.depthBuffer&&Pe(xe)}function ht(xe){const pe=xe.textures;for(let ze=0,Je=pe.length;ze<Je;ze++){const Xe=pe[ze];if(_(Xe)){const et=S(xe),Ut=r.get(Xe).__webglTexture;t.bindTexture(et,Ut),v(et),t.unbindTexture()}}}const vt=[],re=[];function Le(xe){if(xe.samples>0){if(De(xe)===!1){const pe=xe.textures,ze=xe.width,Je=xe.height;let Xe=n.COLOR_BUFFER_BIT;const et=xe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ut=r.get(xe),gt=pe.length>1;if(gt)for(let Ce=0;Ce<pe.length;Ce++)t.bindFramebuffer(n.FRAMEBUFFER,Ut.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ce,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Ut.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ce,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Ut.__webglMultisampledFramebuffer);const At=xe.texture.mipmaps;At&&At.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ut.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ut.__webglFramebuffer);for(let Ce=0;Ce<pe.length;Ce++){if(xe.resolveDepthBuffer&&(xe.depthBuffer&&(Xe|=n.DEPTH_BUFFER_BIT),xe.stencilBuffer&&xe.resolveStencilBuffer&&(Xe|=n.STENCIL_BUFFER_BIT)),gt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Ut.__webglColorRenderbuffer[Ce]);const se=r.get(pe[Ce]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,se,0)}n.blitFramebuffer(0,0,ze,Je,0,0,ze,Je,Xe,n.NEAREST),c===!0&&(vt.length=0,re.length=0,vt.push(n.COLOR_ATTACHMENT0+Ce),xe.depthBuffer&&xe.resolveDepthBuffer===!1&&(vt.push(et),re.push(et),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,re)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,vt))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),gt)for(let Ce=0;Ce<pe.length;Ce++){t.bindFramebuffer(n.FRAMEBUFFER,Ut.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ce,n.RENDERBUFFER,Ut.__webglColorRenderbuffer[Ce]);const se=r.get(pe[Ce]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Ut.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ce,n.TEXTURE_2D,se,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ut.__webglMultisampledFramebuffer)}else if(xe.depthBuffer&&xe.resolveDepthBuffer===!1&&c){const pe=xe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[pe])}}}function $e(xe){return Math.min(i.maxSamples,xe.samples)}function De(xe){const pe=r.get(xe);return xe.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&pe.__useRenderToTexture!==!1}function Oe(xe){const pe=o.render.frame;u.get(xe)!==pe&&(u.set(xe,pe),xe.update())}function ae(xe,pe){const ze=xe.colorSpace,Je=xe.format,Xe=xe.type;return xe.isCompressedTexture===!0||xe.isVideoTexture===!0||ze!==Z0&&ze!==Pm&&(Zi.getTransfer(ze)===Bs?(Je!==_u||Xe!==Oo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ze)),pe}function ve(xe){return typeof HTMLImageElement<"u"&&xe instanceof HTMLImageElement?(l.width=xe.naturalWidth||xe.width,l.height=xe.naturalHeight||xe.height):typeof VideoFrame<"u"&&xe instanceof VideoFrame?(l.width=xe.displayWidth,l.height=xe.displayHeight):(l.width=xe.width,l.height=xe.height),l}this.allocateTextureUnit=L,this.resetTextureUnits=I,this.setTexture2D=H,this.setTexture2DArray=X,this.setTexture3D=G,this.setTextureCube=Y,this.rebindTextures=We,this.setupRenderTarget=it,this.updateRenderTargetMipmap=ht,this.updateMultisampleRenderTarget=Le,this.setupDepthRenderbuffer=Pe,this.setupFrameBufferTexture=Ee,this.useMultisampledRTT=De}function Tde(n,e){function t(r,i=Pm){let s;const o=Zi.getTransfer(i);if(r===Oo)return n.UNSIGNED_BYTE;if(r===f5)return n.UNSIGNED_SHORT_4_4_4_4;if(r===d5)return n.UNSIGNED_SHORT_5_5_5_1;if(r===fW)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===uW)return n.BYTE;if(r===hW)return n.SHORT;if(r===Kw)return n.UNSIGNED_SHORT;if(r===h5)return n.INT;if(r===jv)return n.UNSIGNED_INT;if(r===dp)return n.FLOAT;if(r===Zv)return n.HALF_FLOAT;if(r===dW)return n.ALPHA;if(r===pW)return n.RGB;if(r===_u)return n.RGBA;if(r===Xw)return n.DEPTH_COMPONENT;if(r===tx)return n.DEPTH_STENCIL;if(r===KA)return n.RED;if(r===p5)return n.RED_INTEGER;if(r===m5)return n.RG;if(r===g5)return n.RG_INTEGER;if(r===tO)return n.RGBA_INTEGER;if(r===Tk||r===wk||r===Ak||r===Ck)if(o===Bs)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===Tk)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===wk)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Ak)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Ck)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===Tk)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===wk)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Ak)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Ck)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===FD||r===jD||r===zD||r===$D)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===FD)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===jD)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===zD)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===$D)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===VD||r===HD||r===GD)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===VD||r===HD)return o===Bs?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===GD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===WD||r===qD||r===YD||r===KD||r===XD||r===ZD||r===JD||r===QD||r===eL||r===tL||r===nL||r===rL||r===iL||r===sL)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===WD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===qD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===YD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===KD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===XD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===ZD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===JD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===QD)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===eL)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===tL)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===nL)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===rL)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===iL)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===sL)return o===Bs?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Rk||r===oL||r===aL)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===Rk)return o===Bs?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===oL)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===aL)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===mW||r===cL||r===lL||r===uL)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===Rk)return s.COMPRESSED_RED_RGTC1_EXT;if(r===cL)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===lL)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===uL)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===ex?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}const wde=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Ade=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Cde{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new pc,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!==r.depthNear||t.depthFar!==r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new lo({vertexShader:wde,fragmentShader:Ade,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new df(new ZA(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Rde extends i_{constructor(e,t){super();const r=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,u=null,h=null,f=null,d=null,p=null;const m=new Cde,_=t.getContextAttributes();let v=null,S=null;const b=[],T=[],w=new zn;let R=null;const C=new du;C.viewport=new Xo;const N=new du;N.viewport=new Xo;const U=[C,N],B=new qce;let $=null,I=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(te){let ie=b[te];return ie===void 0&&(ie=new dN,b[te]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(te){let ie=b[te];return ie===void 0&&(ie=new dN,b[te]=ie),ie.getGripSpace()},this.getHand=function(te){let ie=b[te];return ie===void 0&&(ie=new dN,b[te]=ie),ie.getHandSpace()};function L(te){const ie=T.indexOf(te.inputSource);if(ie===-1)return;const Ee=b[ie];Ee!==void 0&&(Ee.update(te.inputSource,te.frame,l||o),Ee.dispatchEvent({type:te.type,data:te.inputSource}))}function P(){i.removeEventListener("select",L),i.removeEventListener("selectstart",L),i.removeEventListener("selectend",L),i.removeEventListener("squeeze",L),i.removeEventListener("squeezestart",L),i.removeEventListener("squeezeend",L),i.removeEventListener("end",P),i.removeEventListener("inputsourceschange",H);for(let te=0;te<b.length;te++){const ie=T[te];ie!==null&&(T[te]=null,b[te].disconnect(ie))}$=null,I=null,m.reset(),e.setRenderTarget(v),d=null,f=null,h=null,i=null,S=null,ee.stop(),r.isPresenting=!1,e.setPixelRatio(R),e.setSize(w.width,w.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(te){s=te,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(te){a=te,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(te){l=te},this.getBaseLayer=function(){return f!==null?f:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(te){if(i=te,i!==null){if(v=e.getRenderTarget(),i.addEventListener("select",L),i.addEventListener("selectstart",L),i.addEventListener("selectend",L),i.addEventListener("squeeze",L),i.addEventListener("squeezestart",L),i.addEventListener("squeezeend",L),i.addEventListener("end",P),i.addEventListener("inputsourceschange",H),_.xrCompatible!==!0&&await t.makeXRCompatible(),R=e.getPixelRatio(),e.getSize(w),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Ee=null,Re=null,Te=null;_.depth&&(Te=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ee=_.stencil?tx:Xw,Re=_.stencil?ex:jv);const Pe={colorFormat:t.RGBA8,depthFormat:Te,scaleFactor:s};h=new XRWebGLBinding(i,t),f=h.createProjectionLayer(Pe),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),S=new hl(f.textureWidth,f.textureHeight,{format:_u,type:Oo,depthTexture:new rO(f.textureWidth,f.textureHeight,Re,void 0,void 0,void 0,void 0,void 0,void 0,Ee),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const Ee={antialias:_.antialias,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(i,t,Ee),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),S=new hl(d.framebufferWidth,d.framebufferHeight,{format:_u,type:Oo,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}S.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await i.requestReferenceSpace(a),ee.setContext(i),ee.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};function H(te){for(let ie=0;ie<te.removed.length;ie++){const Ee=te.removed[ie],Re=T.indexOf(Ee);Re>=0&&(T[Re]=null,b[Re].disconnect(Ee))}for(let ie=0;ie<te.added.length;ie++){const Ee=te.added[ie];let Re=T.indexOf(Ee);if(Re===-1){for(let Pe=0;Pe<b.length;Pe++)if(Pe>=T.length){T.push(Ee),Re=Pe;break}else if(T[Pe]===null){T[Pe]=Ee,Re=Pe;break}if(Re===-1)break}const Te=b[Re];Te&&Te.connect(Ee)}}const X=new zt,G=new zt;function Y(te,ie,Ee){X.setFromMatrixPosition(ie.matrixWorld),G.setFromMatrixPosition(Ee.matrixWorld);const Re=X.distanceTo(G),Te=ie.projectionMatrix.elements,Pe=Ee.projectionMatrix.elements,We=Te[14]/(Te[10]-1),it=Te[14]/(Te[10]+1),ht=(Te[9]+1)/Te[5],vt=(Te[9]-1)/Te[5],re=(Te[8]-1)/Te[0],Le=(Pe[8]+1)/Pe[0],$e=We*re,De=We*Le,Oe=Re/(-re+Le),ae=Oe*-re;if(ie.matrixWorld.decompose(te.position,te.quaternion,te.scale),te.translateX(ae),te.translateZ(Oe),te.matrixWorld.compose(te.position,te.quaternion,te.scale),te.matrixWorldInverse.copy(te.matrixWorld).invert(),Te[10]===-1)te.projectionMatrix.copy(ie.projectionMatrix),te.projectionMatrixInverse.copy(ie.projectionMatrixInverse);else{const ve=We+Oe,xe=it+Oe,pe=$e-ae,ze=De+(Re-ae),Je=ht*it/xe*ve,Xe=vt*it/xe*ve;te.projectionMatrix.makePerspective(pe,ze,Je,Xe,ve,xe),te.projectionMatrixInverse.copy(te.projectionMatrix).invert()}}function J(te,ie){ie===null?te.matrixWorld.copy(te.matrix):te.matrixWorld.multiplyMatrices(ie.matrixWorld,te.matrix),te.matrixWorldInverse.copy(te.matrixWorld).invert()}this.updateCamera=function(te){if(i===null)return;let ie=te.near,Ee=te.far;m.texture!==null&&(m.depthNear>0&&(ie=m.depthNear),m.depthFar>0&&(Ee=m.depthFar)),B.near=N.near=C.near=ie,B.far=N.far=C.far=Ee,($!==B.near||I!==B.far)&&(i.updateRenderState({depthNear:B.near,depthFar:B.far}),$=B.near,I=B.far),C.layers.mask=te.layers.mask|2,N.layers.mask=te.layers.mask|4,B.layers.mask=C.layers.mask|N.layers.mask;const Re=te.parent,Te=B.cameras;J(B,Re);for(let Pe=0;Pe<Te.length;Pe++)J(Te[Pe],Re);Te.length===2?Y(B,C,N):B.projectionMatrix.copy(C.projectionMatrix),Q(te,B,Re)};function Q(te,ie,Ee){Ee===null?te.matrix.copy(ie.matrixWorld):(te.matrix.copy(Ee.matrixWorld),te.matrix.invert(),te.matrix.multiply(ie.matrixWorld)),te.matrix.decompose(te.position,te.quaternion,te.scale),te.updateMatrixWorld(!0),te.projectionMatrix.copy(ie.projectionMatrix),te.projectionMatrixInverse.copy(ie.projectionMatrixInverse),te.isPerspectiveCamera&&(te.fov=Zw*2*Math.atan(1/te.projectionMatrix.elements[5]),te.zoom=1)}this.getCamera=function(){return B},this.getFoveation=function(){if(!(f===null&&d===null))return c},this.setFoveation=function(te){c=te,f!==null&&(f.fixedFoveation=te),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=te)},this.hasDepthSensing=function(){return m.texture!==null},this.getDepthSensingMesh=function(){return m.getMesh(B)};let z=null;function q(te,ie){if(u=ie.getViewerPose(l||o),p=ie,u!==null){const Ee=u.views;d!==null&&(e.setRenderTargetFramebuffer(S,d.framebuffer),e.setRenderTarget(S));let Re=!1;Ee.length!==B.cameras.length&&(B.cameras.length=0,Re=!0);for(let We=0;We<Ee.length;We++){const it=Ee[We];let ht=null;if(d!==null)ht=d.getViewport(it);else{const re=h.getViewSubImage(f,it);ht=re.viewport,We===0&&(e.setRenderTargetTextures(S,re.colorTexture,re.depthStencilTexture),e.setRenderTarget(S))}let vt=U[We];vt===void 0&&(vt=new du,vt.layers.enable(We),vt.viewport=new Xo,U[We]=vt),vt.matrix.fromArray(it.transform.matrix),vt.matrix.decompose(vt.position,vt.quaternion,vt.scale),vt.projectionMatrix.fromArray(it.projectionMatrix),vt.projectionMatrixInverse.copy(vt.projectionMatrix).invert(),vt.viewport.set(ht.x,ht.y,ht.width,ht.height),We===0&&(B.matrix.copy(vt.matrix),B.matrix.decompose(B.position,B.quaternion,B.scale)),Re===!0&&B.cameras.push(vt)}const Te=i.enabledFeatures;if(Te&&Te.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&h){const We=h.getDepthInformation(Ee[0]);We&&We.isValid&&We.texture&&m.init(e,We,i.renderState)}}for(let Ee=0;Ee<b.length;Ee++){const Re=T[Ee],Te=b[Ee];Re!==null&&Te!==void 0&&Te.update(Re,ie,l||o)}z&&z(te,ie),ie.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ie}),p=null}const ee=new RW;ee.setAnimationLoop(q),this.setAnimationLoop=function(te){z=te},this.dispose=function(){}}}const Xy=new Xm,kde=new To;function Mde(n,e){function t(_,v){_.matrixAutoUpdate===!0&&_.updateMatrix(),v.value.copy(_.matrix)}function r(_,v){v.color.getRGB(_.fogColor.value,xW(n)),v.isFog?(_.fogNear.value=v.near,_.fogFar.value=v.far):v.isFogExp2&&(_.fogDensity.value=v.density)}function i(_,v,S,b,T){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(_,v):v.isMeshToonMaterial?(s(_,v),h(_,v)):v.isMeshPhongMaterial?(s(_,v),u(_,v)):v.isMeshStandardMaterial?(s(_,v),f(_,v),v.isMeshPhysicalMaterial&&d(_,v,T)):v.isMeshMatcapMaterial?(s(_,v),p(_,v)):v.isMeshDepthMaterial?s(_,v):v.isMeshDistanceMaterial?(s(_,v),m(_,v)):v.isMeshNormalMaterial?s(_,v):v.isLineBasicMaterial?(o(_,v),v.isLineDashedMaterial&&a(_,v)):v.isPointsMaterial?c(_,v,S,b):v.isSpriteMaterial?l(_,v):v.isShadowMaterial?(_.color.value.copy(v.color),_.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function s(_,v){_.opacity.value=v.opacity,v.color&&_.diffuse.value.copy(v.color),v.emissive&&_.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(_.map.value=v.map,t(v.map,_.mapTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,t(v.alphaMap,_.alphaMapTransform)),v.bumpMap&&(_.bumpMap.value=v.bumpMap,t(v.bumpMap,_.bumpMapTransform),_.bumpScale.value=v.bumpScale,v.side===Uc&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,t(v.normalMap,_.normalMapTransform),_.normalScale.value.copy(v.normalScale),v.side===Uc&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,t(v.displacementMap,_.displacementMapTransform),_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,_.emissiveMapTransform)),v.specularMap&&(_.specularMap.value=v.specularMap,t(v.specularMap,_.specularMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest);const S=e.get(v),b=S.envMap,T=S.envMapRotation;b&&(_.envMap.value=b,Xy.copy(T),Xy.x*=-1,Xy.y*=-1,Xy.z*=-1,b.isCubeTexture&&b.isRenderTargetTexture===!1&&(Xy.y*=-1,Xy.z*=-1),_.envMapRotation.value.setFromMatrix4(kde.makeRotationFromEuler(Xy)),_.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=v.reflectivity,_.ior.value=v.ior,_.refractionRatio.value=v.refractionRatio),v.lightMap&&(_.lightMap.value=v.lightMap,_.lightMapIntensity.value=v.lightMapIntensity,t(v.lightMap,_.lightMapTransform)),v.aoMap&&(_.aoMap.value=v.aoMap,_.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,_.aoMapTransform))}function o(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,v.map&&(_.map.value=v.map,t(v.map,_.mapTransform))}function a(_,v){_.dashSize.value=v.dashSize,_.totalSize.value=v.dashSize+v.gapSize,_.scale.value=v.scale}function c(_,v,S,b){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.size.value=v.size*S,_.scale.value=b*.5,v.map&&(_.map.value=v.map,t(v.map,_.uvTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,t(v.alphaMap,_.alphaMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest)}function l(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.rotation.value=v.rotation,v.map&&(_.map.value=v.map,t(v.map,_.mapTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,t(v.alphaMap,_.alphaMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest)}function u(_,v){_.specular.value.copy(v.specular),_.shininess.value=Math.max(v.shininess,1e-4)}function h(_,v){v.gradientMap&&(_.gradientMap.value=v.gradientMap)}function f(_,v){_.metalness.value=v.metalness,v.metalnessMap&&(_.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,_.metalnessMapTransform)),_.roughness.value=v.roughness,v.roughnessMap&&(_.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,_.roughnessMapTransform)),v.envMap&&(_.envMapIntensity.value=v.envMapIntensity)}function d(_,v,S){_.ior.value=v.ior,v.sheen>0&&(_.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),_.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(_.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,_.sheenColorMapTransform)),v.sheenRoughnessMap&&(_.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,_.sheenRoughnessMapTransform))),v.clearcoat>0&&(_.clearcoat.value=v.clearcoat,_.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(_.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,_.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,_.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(_.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,_.clearcoatNormalMapTransform),_.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===Uc&&_.clearcoatNormalScale.value.negate())),v.dispersion>0&&(_.dispersion.value=v.dispersion),v.iridescence>0&&(_.iridescence.value=v.iridescence,_.iridescenceIOR.value=v.iridescenceIOR,_.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],_.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(_.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,_.iridescenceMapTransform)),v.iridescenceThicknessMap&&(_.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,_.iridescenceThicknessMapTransform))),v.transmission>0&&(_.transmission.value=v.transmission,_.transmissionSamplerMap.value=S.texture,_.transmissionSamplerSize.value.set(S.width,S.height),v.transmissionMap&&(_.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,_.transmissionMapTransform)),_.thickness.value=v.thickness,v.thicknessMap&&(_.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,_.thicknessMapTransform)),_.attenuationDistance.value=v.attenuationDistance,_.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(_.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(_.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,_.anisotropyMapTransform))),_.specularIntensity.value=v.specularIntensity,_.specularColor.value.copy(v.specularColor),v.specularColorMap&&(_.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,_.specularColorMapTransform)),v.specularIntensityMap&&(_.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,_.specularIntensityMapTransform))}function p(_,v){v.matcap&&(_.matcap.value=v.matcap)}function m(_,v){const S=e.get(v).light;_.referencePosition.value.setFromMatrixPosition(S.matrixWorld),_.nearDistance.value=S.shadow.camera.near,_.farDistance.value=S.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function Ide(n,e,t,r){let i={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function c(S,b){const T=b.program;r.uniformBlockBinding(S,T)}function l(S,b){let T=i[S.id];T===void 0&&(p(S),T=u(S),i[S.id]=T,S.addEventListener("dispose",_));const w=b.program;r.updateUBOMapping(S,w);const R=e.render.frame;s[S.id]!==R&&(f(S),s[S.id]=R)}function u(S){const b=h();S.__bindingPointIndex=b;const T=n.createBuffer(),w=S.__size,R=S.usage;return n.bindBuffer(n.UNIFORM_BUFFER,T),n.bufferData(n.UNIFORM_BUFFER,w,R),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,b,T),T}function h(){for(let S=0;S<a;S++)if(o.indexOf(S)===-1)return o.push(S),S;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(S){const b=i[S.id],T=S.uniforms,w=S.__cache;n.bindBuffer(n.UNIFORM_BUFFER,b);for(let R=0,C=T.length;R<C;R++){const N=Array.isArray(T[R])?T[R]:[T[R]];for(let U=0,B=N.length;U<B;U++){const $=N[U];if(d($,R,U,w)===!0){const I=$.__offset,L=Array.isArray($.value)?$.value:[$.value];let P=0;for(let H=0;H<L.length;H++){const X=L[H],G=m(X);typeof X=="number"||typeof X=="boolean"?($.__data[0]=X,n.bufferSubData(n.UNIFORM_BUFFER,I+P,$.__data)):X.isMatrix3?($.__data[0]=X.elements[0],$.__data[1]=X.elements[1],$.__data[2]=X.elements[2],$.__data[3]=0,$.__data[4]=X.elements[3],$.__data[5]=X.elements[4],$.__data[6]=X.elements[5],$.__data[7]=0,$.__data[8]=X.elements[6],$.__data[9]=X.elements[7],$.__data[10]=X.elements[8],$.__data[11]=0):(X.toArray($.__data,P),P+=G.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,I,$.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function d(S,b,T,w){const R=S.value,C=b+"_"+T;if(w[C]===void 0)return typeof R=="number"||typeof R=="boolean"?w[C]=R:w[C]=R.clone(),!0;{const N=w[C];if(typeof R=="number"||typeof R=="boolean"){if(N!==R)return w[C]=R,!0}else if(N.equals(R)===!1)return N.copy(R),!0}return!1}function p(S){const b=S.uniforms;let T=0;const w=16;for(let C=0,N=b.length;C<N;C++){const U=Array.isArray(b[C])?b[C]:[b[C]];for(let B=0,$=U.length;B<$;B++){const I=U[B],L=Array.isArray(I.value)?I.value:[I.value];for(let P=0,H=L.length;P<H;P++){const X=L[P],G=m(X),Y=T%w,J=Y%G.boundary,Q=Y+J;T+=J,Q!==0&&w-Q<G.storage&&(T+=w-Q),I.__data=new Float32Array(G.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=T,T+=G.storage}}}const R=T%w;return R>0&&(T+=w-R),S.__size=T,S.__cache={},this}function m(S){const b={boundary:0,storage:0};return typeof S=="number"||typeof S=="boolean"?(b.boundary=4,b.storage=4):S.isVector2?(b.boundary=8,b.storage=8):S.isVector3||S.isColor?(b.boundary=16,b.storage=12):S.isVector4?(b.boundary=16,b.storage=16):S.isMatrix3?(b.boundary=48,b.storage=48):S.isMatrix4?(b.boundary=64,b.storage=64):S.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",S),b}function _(S){const b=S.target;b.removeEventListener("dispose",_);const T=o.indexOf(b.__bindingPointIndex);o.splice(T,1),n.deleteBuffer(i[b.id]),delete i[b.id],delete s[b.id]}function v(){for(const S in i)n.deleteBuffer(i[S]);o=[],i={},s={}}return{bind:c,update:l,dispose:v}}class Ode{constructor(e={}){const{canvas:t=oce(),context:r=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:f=!1}=e;this.isWebGLRenderer=!0;let d;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=r.getContextAttributes().alpha}else d=o;const p=new Uint32Array(4),m=new Int32Array(4);let _=null,v=null;const S=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=$0,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const T=this;let w=!1;this._outputColorSpace=Fi;let R=0,C=0,N=null,U=-1,B=null;const $=new Xo,I=new Xo;let L=null;const P=new Ti(0);let H=0,X=t.width,G=t.height,Y=1,J=null,Q=null;const z=new Xo(0,0,X,G),q=new Xo(0,0,X,G);let ee=!1;const te=new AW;let ie=!1,Ee=!1;const Re=new To,Te=new To,Pe=new zt,We=new Xo,it={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ht=!1;function vt(){return N===null?Y:1}let re=r;function Le(je,_t){return t.getContext(je,_t)}try{const je={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${YA}`),t.addEventListener("webglcontextlost",Ge,!1),t.addEventListener("webglcontextrestored",at,!1),t.addEventListener("webglcontextcreationerror",Be,!1),re===null){const _t="webgl2";if(re=Le(_t,je),re===null)throw Le(_t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(je){throw console.error("THREE.WebGLRenderer: "+je.message),je}let $e,De,Oe,ae,ve,xe,pe,ze,Je,Xe,et,Ut,gt,At,Ce,se,W,oe,Se,Ae,ye,_e,Ye,ke;function Ve(){$e=new $he(re),$e.init(),_e=new Tde(re,$e),De=new Dhe(re,$e,e,_e),Oe=new Ede(re,$e),De.reverseDepthBuffer&&f&&Oe.buffers.depth.setReversed(!0),ae=new Ghe(re),ve=new lde,xe=new xde(re,$e,Oe,ve,De,_e,ae),pe=new Uhe(T),ze=new zhe(T),Je=new Zce(re),Ye=new Nhe(re,Je),Xe=new Vhe(re,Je,ae,Ye),et=new qhe(re,Xe,Je,ae),Se=new Whe(re,De,xe),se=new Lhe(ve),Ut=new cde(T,pe,ze,$e,De,Ye,se),gt=new Mde(T,ve),At=new hde,Ce=new _de($e),oe=new Ohe(T,pe,ze,Oe,et,d,c),W=new bde(T,et,De),ke=new Ide(re,ae,De,Oe),Ae=new Phe(re,$e,ae),ye=new Hhe(re,$e,ae),ae.programs=Ut.programs,T.capabilities=De,T.extensions=$e,T.properties=ve,T.renderLists=At,T.shadowMap=W,T.state=Oe,T.info=ae}Ve();const Fe=new Rde(T,re);this.xr=Fe,this.getContext=function(){return re},this.getContextAttributes=function(){return re.getContextAttributes()},this.forceContextLoss=function(){const je=$e.get("WEBGL_lose_context");je&&je.loseContext()},this.forceContextRestore=function(){const je=$e.get("WEBGL_lose_context");je&&je.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(je){je!==void 0&&(Y=je,this.setSize(X,G,!1))},this.getSize=function(je){return je.set(X,G)},this.setSize=function(je,_t,Ot=!0){if(Fe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}X=je,G=_t,t.width=Math.floor(je*Y),t.height=Math.floor(_t*Y),Ot===!0&&(t.style.width=je+"px",t.style.height=_t+"px"),this.setViewport(0,0,je,_t)},this.getDrawingBufferSize=function(je){return je.set(X*Y,G*Y).floor()},this.setDrawingBufferSize=function(je,_t,Ot){X=je,G=_t,Y=Ot,t.width=Math.floor(je*Ot),t.height=Math.floor(_t*Ot),this.setViewport(0,0,je,_t)},this.getCurrentViewport=function(je){return je.copy($)},this.getViewport=function(je){return je.copy(z)},this.setViewport=function(je,_t,Ot,Lt){je.isVector4?z.set(je.x,je.y,je.z,je.w):z.set(je,_t,Ot,Lt),Oe.viewport($.copy(z).multiplyScalar(Y).round())},this.getScissor=function(je){return je.copy(q)},this.setScissor=function(je,_t,Ot,Lt){je.isVector4?q.set(je.x,je.y,je.z,je.w):q.set(je,_t,Ot,Lt),Oe.scissor(I.copy(q).multiplyScalar(Y).round())},this.getScissorTest=function(){return ee},this.setScissorTest=function(je){Oe.setScissorTest(ee=je)},this.setOpaqueSort=function(je){J=je},this.setTransparentSort=function(je){Q=je},this.getClearColor=function(je){return je.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor(...arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha(...arguments)},this.clear=function(je=!0,_t=!0,Ot=!0){let Lt=0;if(je){let yt=!1;if(N!==null){const an=N.texture.format;yt=an===tO||an===g5||an===p5}if(yt){const an=N.texture.type,On=an===Oo||an===jv||an===Kw||an===ex||an===f5||an===d5,_n=oe.getClearColor(),Pn=oe.getClearAlpha(),er=_n.r,fr=_n.g,Cn=_n.b;On?(p[0]=er,p[1]=fr,p[2]=Cn,p[3]=Pn,re.clearBufferuiv(re.COLOR,0,p)):(m[0]=er,m[1]=fr,m[2]=Cn,m[3]=Pn,re.clearBufferiv(re.COLOR,0,m))}else Lt|=re.COLOR_BUFFER_BIT}_t&&(Lt|=re.DEPTH_BUFFER_BIT),Ot&&(Lt|=re.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),re.clear(Lt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ge,!1),t.removeEventListener("webglcontextrestored",at,!1),t.removeEventListener("webglcontextcreationerror",Be,!1),oe.dispose(),At.dispose(),Ce.dispose(),ve.dispose(),pe.dispose(),ze.dispose(),et.dispose(),Ye.dispose(),ke.dispose(),Ut.dispose(),Fe.dispose(),Fe.removeEventListener("sessionstart",Rt),Fe.removeEventListener("sessionend",$t),mt.stop()};function Ge(je){je.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function at(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const je=ae.autoReset,_t=W.enabled,Ot=W.autoUpdate,Lt=W.needsUpdate,yt=W.type;Ve(),ae.autoReset=je,W.enabled=_t,W.autoUpdate=Ot,W.needsUpdate=Lt,W.type=yt}function Be(je){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",je.statusMessage)}function tt(je){const _t=je.target;_t.removeEventListener("dispose",tt),rt(_t)}function rt(je){xt(je),ve.remove(je)}function xt(je){const _t=ve.get(je).programs;_t!==void 0&&(_t.forEach(function(Ot){Ut.releaseProgram(Ot)}),je.isShaderMaterial&&Ut.releaseShaderCache(je))}this.renderBufferDirect=function(je,_t,Ot,Lt,yt,an){_t===null&&(_t=it);const On=yt.isMesh&&yt.matrixWorld.determinant()<0,_n=ti(je,_t,Ot,Lt,yt);Oe.setMaterial(Lt,On);let Pn=Ot.index,er=1;if(Lt.wireframe===!0){if(Pn=Xe.getWireframeAttribute(Ot),Pn===void 0)return;er=2}const fr=Ot.drawRange,Cn=Ot.attributes.position;let yr=fr.start*er,Vr=(fr.start+fr.count)*er;an!==null&&(yr=Math.max(yr,an.start*er),Vr=Math.min(Vr,(an.start+an.count)*er)),Pn!==null?(yr=Math.max(yr,0),Vr=Math.min(Vr,Pn.count)):Cn!=null&&(yr=Math.max(yr,0),Vr=Math.min(Vr,Cn.count));const ms=Vr-yr;if(ms<0||ms===1/0)return;Ye.setup(yt,Lt,_n,Ot,Pn);let Lr,Gr=Ae;if(Pn!==null&&(Lr=Je.get(Pn),Gr=ye,Gr.setIndex(Lr)),yt.isMesh)Lt.wireframe===!0?(Oe.setLineWidth(Lt.wireframeLinewidth*vt()),Gr.setMode(re.LINES)):Gr.setMode(re.TRIANGLES);else if(yt.isLine){let or=Lt.linewidth;or===void 0&&(or=1),Oe.setLineWidth(or*vt()),yt.isLineSegments?Gr.setMode(re.LINES):yt.isLineLoop?Gr.setMode(re.LINE_LOOP):Gr.setMode(re.LINE_STRIP)}else yt.isPoints?Gr.setMode(re.POINTS):yt.isSprite&&Gr.setMode(re.TRIANGLES);if(yt.isBatchedMesh)if(yt._multiDrawInstances!==null)kk("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Gr.renderMultiDrawInstances(yt._multiDrawStarts,yt._multiDrawCounts,yt._multiDrawCount,yt._multiDrawInstances);else if($e.get("WEBGL_multi_draw"))Gr.renderMultiDraw(yt._multiDrawStarts,yt._multiDrawCounts,yt._multiDrawCount);else{const or=yt._multiDrawStarts,br=yt._multiDrawCounts,Un=yt._multiDrawCount,bi=Pn?Je.get(Pn).bytesPerElement:1,ai=ve.get(Lt).currentProgram.getUniforms();for(let Rs=0;Rs<Un;Rs++)ai.setValue(re,"_gl_DrawID",Rs),Gr.render(or[Rs]/bi,br[Rs])}else if(yt.isInstancedMesh)Gr.renderInstances(yr,ms,yt.count);else if(Ot.isInstancedBufferGeometry){const or=Ot._maxInstanceCount!==void 0?Ot._maxInstanceCount:1/0,br=Math.min(Ot.instanceCount,or);Gr.renderInstances(yr,ms,br)}else Gr.render(yr,ms)};function ot(je,_t,Ot){je.transparent===!0&&je.side===Ia&&je.forceSinglePass===!1?(je.side=Uc,je.needsUpdate=!0,mr(je,_t,Ot),je.side=X0,je.needsUpdate=!0,mr(je,_t,Ot),je.side=Ia):mr(je,_t,Ot)}this.compile=function(je,_t,Ot=null){Ot===null&&(Ot=je),v=Ce.get(Ot),v.init(_t),b.push(v),Ot.traverseVisible(function(yt){yt.isLight&&yt.layers.test(_t.layers)&&(v.pushLight(yt),yt.castShadow&&v.pushShadow(yt))}),je!==Ot&&je.traverseVisible(function(yt){yt.isLight&&yt.layers.test(_t.layers)&&(v.pushLight(yt),yt.castShadow&&v.pushShadow(yt))}),v.setupLights();const Lt=new Set;return je.traverse(function(yt){if(!(yt.isMesh||yt.isPoints||yt.isLine||yt.isSprite))return;const an=yt.material;if(an)if(Array.isArray(an))for(let On=0;On<an.length;On++){const _n=an[On];ot(_n,Ot,yt),Lt.add(_n)}else ot(an,Ot,yt),Lt.add(an)}),v=b.pop(),Lt},this.compileAsync=function(je,_t,Ot=null){const Lt=this.compile(je,_t,Ot);return new Promise(yt=>{function an(){if(Lt.forEach(function(On){ve.get(On).currentProgram.isReady()&&Lt.delete(On)}),Lt.size===0){yt(je);return}setTimeout(an,10)}$e.get("KHR_parallel_shader_compile")!==null?an():setTimeout(an,10)})};let tn=null;function ln(je){tn&&tn(je)}function Rt(){mt.stop()}function $t(){mt.start()}const mt=new RW;mt.setAnimationLoop(ln),typeof self<"u"&&mt.setContext(self),this.setAnimationLoop=function(je){tn=je,Fe.setAnimationLoop(je),je===null?mt.stop():mt.start()},Fe.addEventListener("sessionstart",Rt),Fe.addEventListener("sessionend",$t),this.render=function(je,_t){if(_t!==void 0&&_t.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;if(je.matrixWorldAutoUpdate===!0&&je.updateMatrixWorld(),_t.parent===null&&_t.matrixWorldAutoUpdate===!0&&_t.updateMatrixWorld(),Fe.enabled===!0&&Fe.isPresenting===!0&&(Fe.cameraAutoUpdate===!0&&Fe.updateCamera(_t),_t=Fe.getCamera()),je.isScene===!0&&je.onBeforeRender(T,je,_t,N),v=Ce.get(je,b.length),v.init(_t),b.push(v),Te.multiplyMatrices(_t.projectionMatrix,_t.matrixWorldInverse),te.setFromProjectionMatrix(Te),Ee=this.localClippingEnabled,ie=se.init(this.clippingPlanes,Ee),_=At.get(je,S.length),_.init(),S.push(_),Fe.enabled===!0&&Fe.isPresenting===!0){const an=T.xr.getDepthSensingMesh();an!==null&&Zt(an,_t,-1/0,T.sortObjects)}Zt(je,_t,0,T.sortObjects),_.finish(),T.sortObjects===!0&&_.sort(J,Q),ht=Fe.enabled===!1||Fe.isPresenting===!1||Fe.hasDepthSensing()===!1,ht&&oe.addToRenderList(_,je),this.info.render.frame++,ie===!0&&se.beginShadows();const Ot=v.state.shadowsArray;W.render(Ot,je,_t),ie===!0&&se.endShadows(),this.info.autoReset===!0&&this.info.reset();const Lt=_.opaque,yt=_.transmissive;if(v.setupLights(),_t.isArrayCamera){const an=_t.cameras;if(yt.length>0)for(let On=0,_n=an.length;On<_n;On++){const Pn=an[On];qt(Lt,yt,je,Pn)}ht&&oe.render(je);for(let On=0,_n=an.length;On<_n;On++){const Pn=an[On];wn(_,je,Pn,Pn.viewport)}}else yt.length>0&&qt(Lt,yt,je,_t),ht&&oe.render(je),wn(_,je,_t);N!==null&&C===0&&(xe.updateMultisampleRenderTarget(N),xe.updateRenderTargetMipmap(N)),je.isScene===!0&&je.onAfterRender(T,je,_t),Ye.resetDefaultState(),U=-1,B=null,b.pop(),b.length>0?(v=b[b.length-1],ie===!0&&se.setGlobalState(T.clippingPlanes,v.state.camera)):v=null,S.pop(),S.length>0?_=S[S.length-1]:_=null};function Zt(je,_t,Ot,Lt){if(je.visible===!1)return;if(je.layers.test(_t.layers)){if(je.isGroup)Ot=je.renderOrder;else if(je.isLOD)je.autoUpdate===!0&&je.update(_t);else if(je.isLight)v.pushLight(je),je.castShadow&&v.pushShadow(je);else if(je.isSprite){if(!je.frustumCulled||te.intersectsSprite(je)){Lt&&We.setFromMatrixPosition(je.matrixWorld).applyMatrix4(Te);const On=et.update(je),_n=je.material;_n.visible&&_.push(je,On,_n,Ot,We.z,null)}}else if((je.isMesh||je.isLine||je.isPoints)&&(!je.frustumCulled||te.intersectsObject(je))){const On=et.update(je),_n=je.material;if(Lt&&(je.boundingSphere!==void 0?(je.boundingSphere===null&&je.computeBoundingSphere(),We.copy(je.boundingSphere.center)):(On.boundingSphere===null&&On.computeBoundingSphere(),We.copy(On.boundingSphere.center)),We.applyMatrix4(je.matrixWorld).applyMatrix4(Te)),Array.isArray(_n)){const Pn=On.groups;for(let er=0,fr=Pn.length;er<fr;er++){const Cn=Pn[er],yr=_n[Cn.materialIndex];yr&&yr.visible&&_.push(je,On,yr,Ot,We.z,Cn)}}else _n.visible&&_.push(je,On,_n,Ot,We.z,null)}}const an=je.children;for(let On=0,_n=an.length;On<_n;On++)Zt(an[On],_t,Ot,Lt)}function wn(je,_t,Ot,Lt){const yt=je.opaque,an=je.transmissive,On=je.transparent;v.setupLightsView(Ot),ie===!0&&se.setGlobalState(T.clippingPlanes,Ot),Lt&&Oe.viewport($.copy(Lt)),yt.length>0&&An(yt,_t,Ot),an.length>0&&An(an,_t,Ot),On.length>0&&An(On,_t,Ot),Oe.buffers.depth.setTest(!0),Oe.buffers.depth.setMask(!0),Oe.buffers.color.setMask(!0),Oe.setPolygonOffset(!1)}function qt(je,_t,Ot,Lt){if((Ot.isScene===!0?Ot.overrideMaterial:null)!==null)return;v.state.transmissionRenderTarget[Lt.id]===void 0&&(v.state.transmissionRenderTarget[Lt.id]=new hl(1,1,{generateMipmaps:!0,type:$e.has("EXT_color_buffer_half_float")||$e.has("EXT_color_buffer_float")?Zv:Oo,minFilter:Tb,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Zi.workingColorSpace}));const an=v.state.transmissionRenderTarget[Lt.id],On=Lt.viewport||$;an.setSize(On.z*T.transmissionResolutionScale,On.w*T.transmissionResolutionScale);const _n=T.getRenderTarget();T.setRenderTarget(an),T.getClearColor(P),H=T.getClearAlpha(),H<1&&T.setClearColor(16777215,.5),T.clear(),ht&&oe.render(Ot);const Pn=T.toneMapping;T.toneMapping=$0;const er=Lt.viewport;if(Lt.viewport!==void 0&&(Lt.viewport=void 0),v.setupLightsView(Lt),ie===!0&&se.setGlobalState(T.clippingPlanes,Lt),An(je,Ot,Lt),xe.updateMultisampleRenderTarget(an),xe.updateRenderTargetMipmap(an),$e.has("WEBGL_multisampled_render_to_texture")===!1){let fr=!1;for(let Cn=0,yr=_t.length;Cn<yr;Cn++){const Vr=_t[Cn],ms=Vr.object,Lr=Vr.geometry,Gr=Vr.material,or=Vr.group;if(Gr.side===Ia&&ms.layers.test(Lt.layers)){const br=Gr.side;Gr.side=Uc,Gr.needsUpdate=!0,Ln(ms,Ot,Lt,Lr,Gr,or),Gr.side=br,Gr.needsUpdate=!0,fr=!0}}fr===!0&&(xe.updateMultisampleRenderTarget(an),xe.updateRenderTargetMipmap(an))}T.setRenderTarget(_n),T.setClearColor(P,H),er!==void 0&&(Lt.viewport=er),T.toneMapping=Pn}function An(je,_t,Ot){const Lt=_t.isScene===!0?_t.overrideMaterial:null;for(let yt=0,an=je.length;yt<an;yt++){const On=je[yt],_n=On.object,Pn=On.geometry,er=On.group;let fr=On.material;fr.allowOverride===!0&&Lt!==null&&(fr=Lt),_n.layers.test(Ot.layers)&&Ln(_n,_t,Ot,Pn,fr,er)}}function Ln(je,_t,Ot,Lt,yt,an){je.onBeforeRender(T,_t,Ot,Lt,yt,an),je.modelViewMatrix.multiplyMatrices(Ot.matrixWorldInverse,je.matrixWorld),je.normalMatrix.getNormalMatrix(je.modelViewMatrix),yt.onBeforeRender(T,_t,Ot,Lt,je,an),yt.transparent===!0&&yt.side===Ia&&yt.forceSinglePass===!1?(yt.side=Uc,yt.needsUpdate=!0,T.renderBufferDirect(Ot,_t,Lt,yt,je,an),yt.side=X0,yt.needsUpdate=!0,T.renderBufferDirect(Ot,_t,Lt,yt,je,an),yt.side=Ia):T.renderBufferDirect(Ot,_t,Lt,yt,je,an),je.onAfterRender(T,_t,Ot,Lt,yt,an)}function mr(je,_t,Ot){_t.isScene!==!0&&(_t=it);const Lt=ve.get(je),yt=v.state.lights,an=v.state.shadowsArray,On=yt.state.version,_n=Ut.getParameters(je,yt.state,an,_t,Ot),Pn=Ut.getProgramCacheKey(_n);let er=Lt.programs;Lt.environment=je.isMeshStandardMaterial?_t.environment:null,Lt.fog=_t.fog,Lt.envMap=(je.isMeshStandardMaterial?ze:pe).get(je.envMap||Lt.environment),Lt.envMapRotation=Lt.environment!==null&&je.envMap===null?_t.environmentRotation:je.envMapRotation,er===void 0&&(je.addEventListener("dispose",tt),er=new Map,Lt.programs=er);let fr=er.get(Pn);if(fr!==void 0){if(Lt.currentProgram===fr&&Lt.lightsStateVersion===On)return hi(je,_n),fr}else _n.uniforms=Ut.getUniforms(je),je.onBeforeCompile(_n,T),fr=Ut.acquireProgram(_n,Pn),er.set(Pn,fr),Lt.uniforms=_n.uniforms;const Cn=Lt.uniforms;return(!je.isShaderMaterial&&!je.isRawShaderMaterial||je.clipping===!0)&&(Cn.clippingPlanes=se.uniform),hi(je,_n),Lt.needsLights=ss(je),Lt.lightsStateVersion=On,Lt.needsLights&&(Cn.ambientLightColor.value=yt.state.ambient,Cn.lightProbe.value=yt.state.probe,Cn.directionalLights.value=yt.state.directional,Cn.directionalLightShadows.value=yt.state.directionalShadow,Cn.spotLights.value=yt.state.spot,Cn.spotLightShadows.value=yt.state.spotShadow,Cn.rectAreaLights.value=yt.state.rectArea,Cn.ltc_1.value=yt.state.rectAreaLTC1,Cn.ltc_2.value=yt.state.rectAreaLTC2,Cn.pointLights.value=yt.state.point,Cn.pointLightShadows.value=yt.state.pointShadow,Cn.hemisphereLights.value=yt.state.hemi,Cn.directionalShadowMap.value=yt.state.directionalShadowMap,Cn.directionalShadowMatrix.value=yt.state.directionalShadowMatrix,Cn.spotShadowMap.value=yt.state.spotShadowMap,Cn.spotLightMatrix.value=yt.state.spotLightMatrix,Cn.spotLightMap.value=yt.state.spotLightMap,Cn.pointShadowMap.value=yt.state.pointShadowMap,Cn.pointShadowMatrix.value=yt.state.pointShadowMatrix),Lt.currentProgram=fr,Lt.uniformsList=null,fr}function is(je){if(je.uniformsList===null){const _t=je.currentProgram.getUniforms();je.uniformsList=Mk.seqWithValue(_t.seq,je.uniforms)}return je.uniformsList}function hi(je,_t){const Ot=ve.get(je);Ot.outputColorSpace=_t.outputColorSpace,Ot.batching=_t.batching,Ot.batchingColor=_t.batchingColor,Ot.instancing=_t.instancing,Ot.instancingColor=_t.instancingColor,Ot.instancingMorph=_t.instancingMorph,Ot.skinning=_t.skinning,Ot.morphTargets=_t.morphTargets,Ot.morphNormals=_t.morphNormals,Ot.morphColors=_t.morphColors,Ot.morphTargetsCount=_t.morphTargetsCount,Ot.numClippingPlanes=_t.numClippingPlanes,Ot.numIntersection=_t.numClipIntersection,Ot.vertexAlphas=_t.vertexAlphas,Ot.vertexTangents=_t.vertexTangents,Ot.toneMapping=_t.toneMapping}function ti(je,_t,Ot,Lt,yt){_t.isScene!==!0&&(_t=it),xe.resetTextureUnits();const an=_t.fog,On=Lt.isMeshStandardMaterial?_t.environment:null,_n=N===null?T.outputColorSpace:N.isXRRenderTarget===!0?N.texture.colorSpace:Z0,Pn=(Lt.isMeshStandardMaterial?ze:pe).get(Lt.envMap||On),er=Lt.vertexColors===!0&&!!Ot.attributes.color&&Ot.attributes.color.itemSize===4,fr=!!Ot.attributes.tangent&&(!!Lt.normalMap||Lt.anisotropy>0),Cn=!!Ot.morphAttributes.position,yr=!!Ot.morphAttributes.normal,Vr=!!Ot.morphAttributes.color;let ms=$0;Lt.toneMapped&&(N===null||N.isXRRenderTarget===!0)&&(ms=T.toneMapping);const Lr=Ot.morphAttributes.position||Ot.morphAttributes.normal||Ot.morphAttributes.color,Gr=Lr!==void 0?Lr.length:0,or=ve.get(Lt),br=v.state.lights;if(ie===!0&&(Ee===!0||je!==B)){const Kn=je===B&&Lt.id===U;se.setState(Lt,je,Kn)}let Un=!1;Lt.version===or.__version?(or.needsLights&&or.lightsStateVersion!==br.state.version||or.outputColorSpace!==_n||yt.isBatchedMesh&&or.batching===!1||!yt.isBatchedMesh&&or.batching===!0||yt.isBatchedMesh&&or.batchingColor===!0&&yt.colorTexture===null||yt.isBatchedMesh&&or.batchingColor===!1&&yt.colorTexture!==null||yt.isInstancedMesh&&or.instancing===!1||!yt.isInstancedMesh&&or.instancing===!0||yt.isSkinnedMesh&&or.skinning===!1||!yt.isSkinnedMesh&&or.skinning===!0||yt.isInstancedMesh&&or.instancingColor===!0&&yt.instanceColor===null||yt.isInstancedMesh&&or.instancingColor===!1&&yt.instanceColor!==null||yt.isInstancedMesh&&or.instancingMorph===!0&&yt.morphTexture===null||yt.isInstancedMesh&&or.instancingMorph===!1&&yt.morphTexture!==null||or.envMap!==Pn||Lt.fog===!0&&or.fog!==an||or.numClippingPlanes!==void 0&&(or.numClippingPlanes!==se.numPlanes||or.numIntersection!==se.numIntersection)||or.vertexAlphas!==er||or.vertexTangents!==fr||or.morphTargets!==Cn||or.morphNormals!==yr||or.morphColors!==Vr||or.toneMapping!==ms||or.morphTargetsCount!==Gr)&&(Un=!0):(Un=!0,or.__version=Lt.version);let bi=or.currentProgram;Un===!0&&(bi=mr(Lt,_t,yt));let ai=!1,Rs=!1,ho=!1;const Mi=bi.getUniforms(),Mn=or.uniforms;if(Oe.useProgram(bi.program)&&(ai=!0,Rs=!0,ho=!0),Lt.id!==U&&(U=Lt.id,Rs=!0),ai||B!==je){Oe.buffers.depth.getReversed()?(Re.copy(je.projectionMatrix),cce(Re),lce(Re),Mi.setValue(re,"projectionMatrix",Re)):Mi.setValue(re,"projectionMatrix",je.projectionMatrix),Mi.setValue(re,"viewMatrix",je.matrixWorldInverse);const gs=Mi.map.cameraPosition;gs!==void 0&&gs.setValue(re,Pe.setFromMatrixPosition(je.matrixWorld)),De.logarithmicDepthBuffer&&Mi.setValue(re,"logDepthBufFC",2/(Math.log(je.far+1)/Math.LN2)),(Lt.isMeshPhongMaterial||Lt.isMeshToonMaterial||Lt.isMeshLambertMaterial||Lt.isMeshBasicMaterial||Lt.isMeshStandardMaterial||Lt.isShaderMaterial)&&Mi.setValue(re,"isOrthographic",je.isOrthographicCamera===!0),B!==je&&(B=je,Rs=!0,ho=!0)}if(yt.isSkinnedMesh){Mi.setOptional(re,yt,"bindMatrix"),Mi.setOptional(re,yt,"bindMatrixInverse");const Kn=yt.skeleton;Kn&&(Kn.boneTexture===null&&Kn.computeBoneTexture(),Mi.setValue(re,"boneTexture",Kn.boneTexture,xe))}yt.isBatchedMesh&&(Mi.setOptional(re,yt,"batchingTexture"),Mi.setValue(re,"batchingTexture",yt._matricesTexture,xe),Mi.setOptional(re,yt,"batchingIdTexture"),Mi.setValue(re,"batchingIdTexture",yt._indirectTexture,xe),Mi.setOptional(re,yt,"batchingColorTexture"),yt._colorsTexture!==null&&Mi.setValue(re,"batchingColorTexture",yt._colorsTexture,xe));const Li=Ot.morphAttributes;if((Li.position!==void 0||Li.normal!==void 0||Li.color!==void 0)&&Se.update(yt,Ot,bi),(Rs||or.receiveShadow!==yt.receiveShadow)&&(or.receiveShadow=yt.receiveShadow,Mi.setValue(re,"receiveShadow",yt.receiveShadow)),Lt.isMeshGouraudMaterial&&Lt.envMap!==null&&(Mn.envMap.value=Pn,Mn.flipEnvMap.value=Pn.isCubeTexture&&Pn.isRenderTargetTexture===!1?-1:1),Lt.isMeshStandardMaterial&&Lt.envMap===null&&_t.environment!==null&&(Mn.envMapIntensity.value=_t.environmentIntensity),Rs&&(Mi.setValue(re,"toneMappingExposure",T.toneMappingExposure),or.needsLights&&ji(Mn,ho),an&&Lt.fog===!0&&gt.refreshFogUniforms(Mn,an),gt.refreshMaterialUniforms(Mn,Lt,Y,G,v.state.transmissionRenderTarget[je.id]),Mk.upload(re,is(or),Mn,xe)),Lt.isShaderMaterial&&Lt.uniformsNeedUpdate===!0&&(Mk.upload(re,is(or),Mn,xe),Lt.uniformsNeedUpdate=!1),Lt.isSpriteMaterial&&Mi.setValue(re,"center",yt.center),Mi.setValue(re,"modelViewMatrix",yt.modelViewMatrix),Mi.setValue(re,"normalMatrix",yt.normalMatrix),Mi.setValue(re,"modelMatrix",yt.matrixWorld),Lt.isShaderMaterial||Lt.isRawShaderMaterial){const Kn=Lt.uniformsGroups;for(let gs=0,pl=Kn.length;gs<pl;gs++){const _s=Kn[gs];ke.update(_s,bi),ke.bind(_s,bi)}}return bi}function ji(je,_t){je.ambientLightColor.needsUpdate=_t,je.lightProbe.needsUpdate=_t,je.directionalLights.needsUpdate=_t,je.directionalLightShadows.needsUpdate=_t,je.pointLights.needsUpdate=_t,je.pointLightShadows.needsUpdate=_t,je.spotLights.needsUpdate=_t,je.spotLightShadows.needsUpdate=_t,je.rectAreaLights.needsUpdate=_t,je.hemisphereLights.needsUpdate=_t}function ss(je){return je.isMeshLambertMaterial||je.isMeshToonMaterial||je.isMeshPhongMaterial||je.isMeshStandardMaterial||je.isShadowMaterial||je.isShaderMaterial&&je.lights===!0}this.getActiveCubeFace=function(){return R},this.getActiveMipmapLevel=function(){return C},this.getRenderTarget=function(){return N},this.setRenderTargetTextures=function(je,_t,Ot){const Lt=ve.get(je);Lt.__autoAllocateDepthBuffer=je.resolveDepthBuffer===!1,Lt.__autoAllocateDepthBuffer===!1&&(Lt.__useRenderToTexture=!1),ve.get(je.texture).__webglTexture=_t,ve.get(je.depthTexture).__webglTexture=Lt.__autoAllocateDepthBuffer?void 0:Ot,Lt.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(je,_t){const Ot=ve.get(je);Ot.__webglFramebuffer=_t,Ot.__useDefaultFramebuffer=_t===void 0};const Yi=re.createFramebuffer();this.setRenderTarget=function(je,_t=0,Ot=0){N=je,R=_t,C=Ot;let Lt=!0,yt=null,an=!1,On=!1;if(je){const Pn=ve.get(je);if(Pn.__useDefaultFramebuffer!==void 0)Oe.bindFramebuffer(re.FRAMEBUFFER,null),Lt=!1;else if(Pn.__webglFramebuffer===void 0)xe.setupRenderTarget(je);else if(Pn.__hasExternalTextures)xe.rebindTextures(je,ve.get(je.texture).__webglTexture,ve.get(je.depthTexture).__webglTexture);else if(je.depthBuffer){const Cn=je.depthTexture;if(Pn.__boundDepthTexture!==Cn){if(Cn!==null&&ve.has(Cn)&&(je.width!==Cn.image.width||je.height!==Cn.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");xe.setupDepthRenderbuffer(je)}}const er=je.texture;(er.isData3DTexture||er.isDataArrayTexture||er.isCompressedArrayTexture)&&(On=!0);const fr=ve.get(je).__webglFramebuffer;je.isWebGLCubeRenderTarget?(Array.isArray(fr[_t])?yt=fr[_t][Ot]:yt=fr[_t],an=!0):je.samples>0&&xe.useMultisampledRTT(je)===!1?yt=ve.get(je).__webglMultisampledFramebuffer:Array.isArray(fr)?yt=fr[Ot]:yt=fr,$.copy(je.viewport),I.copy(je.scissor),L=je.scissorTest}else $.copy(z).multiplyScalar(Y).floor(),I.copy(q).multiplyScalar(Y).floor(),L=ee;if(Ot!==0&&(yt=Yi),Oe.bindFramebuffer(re.FRAMEBUFFER,yt)&&Lt&&Oe.drawBuffers(je,yt),Oe.viewport($),Oe.scissor(I),Oe.setScissorTest(L),an){const Pn=ve.get(je.texture);re.framebufferTexture2D(re.FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_CUBE_MAP_POSITIVE_X+_t,Pn.__webglTexture,Ot)}else if(On){const Pn=ve.get(je.texture),er=_t;re.framebufferTextureLayer(re.FRAMEBUFFER,re.COLOR_ATTACHMENT0,Pn.__webglTexture,Ot,er)}else if(je!==null&&Ot!==0){const Pn=ve.get(je.texture);re.framebufferTexture2D(re.FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_2D,Pn.__webglTexture,Ot)}U=-1},this.readRenderTargetPixels=function(je,_t,Ot,Lt,yt,an,On){if(!(je&&je.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let _n=ve.get(je).__webglFramebuffer;if(je.isWebGLCubeRenderTarget&&On!==void 0&&(_n=_n[On]),_n){Oe.bindFramebuffer(re.FRAMEBUFFER,_n);try{const Pn=je.texture,er=Pn.format,fr=Pn.type;if(!De.textureFormatReadable(er)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!De.textureTypeReadable(fr)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}_t>=0&&_t<=je.width-Lt&&Ot>=0&&Ot<=je.height-yt&&re.readPixels(_t,Ot,Lt,yt,_e.convert(er),_e.convert(fr),an)}finally{const Pn=N!==null?ve.get(N).__webglFramebuffer:null;Oe.bindFramebuffer(re.FRAMEBUFFER,Pn)}}},this.readRenderTargetPixelsAsync=async function(je,_t,Ot,Lt,yt,an,On){if(!(je&&je.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let _n=ve.get(je).__webglFramebuffer;if(je.isWebGLCubeRenderTarget&&On!==void 0&&(_n=_n[On]),_n)if(_t>=0&&_t<=je.width-Lt&&Ot>=0&&Ot<=je.height-yt){Oe.bindFramebuffer(re.FRAMEBUFFER,_n);const Pn=je.texture,er=Pn.format,fr=Pn.type;if(!De.textureFormatReadable(er))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!De.textureTypeReadable(fr))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Cn=re.createBuffer();re.bindBuffer(re.PIXEL_PACK_BUFFER,Cn),re.bufferData(re.PIXEL_PACK_BUFFER,an.byteLength,re.STREAM_READ),re.readPixels(_t,Ot,Lt,yt,_e.convert(er),_e.convert(fr),0);const yr=N!==null?ve.get(N).__webglFramebuffer:null;Oe.bindFramebuffer(re.FRAMEBUFFER,yr);const Vr=re.fenceSync(re.SYNC_GPU_COMMANDS_COMPLETE,0);return re.flush(),await ace(re,Vr,4),re.bindBuffer(re.PIXEL_PACK_BUFFER,Cn),re.getBufferSubData(re.PIXEL_PACK_BUFFER,0,an),re.deleteBuffer(Cn),re.deleteSync(Vr),an}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(je,_t=null,Ot=0){const Lt=Math.pow(2,-Ot),yt=Math.floor(je.image.width*Lt),an=Math.floor(je.image.height*Lt),On=_t!==null?_t.x:0,_n=_t!==null?_t.y:0;xe.setTexture2D(je,0),re.copyTexSubImage2D(re.TEXTURE_2D,Ot,0,0,On,_n,yt,an),Oe.unbindTexture()};const os=re.createFramebuffer(),as=re.createFramebuffer();this.copyTextureToTexture=function(je,_t,Ot=null,Lt=null,yt=0,an=null){an===null&&(yt!==0?(kk("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),an=yt,yt=0):an=0);let On,_n,Pn,er,fr,Cn,yr,Vr,ms;const Lr=je.isCompressedTexture?je.mipmaps[an]:je.image;if(Ot!==null)On=Ot.max.x-Ot.min.x,_n=Ot.max.y-Ot.min.y,Pn=Ot.isBox3?Ot.max.z-Ot.min.z:1,er=Ot.min.x,fr=Ot.min.y,Cn=Ot.isBox3?Ot.min.z:0;else{const Li=Math.pow(2,-yt);On=Math.floor(Lr.width*Li),_n=Math.floor(Lr.height*Li),je.isDataArrayTexture?Pn=Lr.depth:je.isData3DTexture?Pn=Math.floor(Lr.depth*Li):Pn=1,er=0,fr=0,Cn=0}Lt!==null?(yr=Lt.x,Vr=Lt.y,ms=Lt.z):(yr=0,Vr=0,ms=0);const Gr=_e.convert(_t.format),or=_e.convert(_t.type);let br;_t.isData3DTexture?(xe.setTexture3D(_t,0),br=re.TEXTURE_3D):_t.isDataArrayTexture||_t.isCompressedArrayTexture?(xe.setTexture2DArray(_t,0),br=re.TEXTURE_2D_ARRAY):(xe.setTexture2D(_t,0),br=re.TEXTURE_2D),re.pixelStorei(re.UNPACK_FLIP_Y_WEBGL,_t.flipY),re.pixelStorei(re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_t.premultiplyAlpha),re.pixelStorei(re.UNPACK_ALIGNMENT,_t.unpackAlignment);const Un=re.getParameter(re.UNPACK_ROW_LENGTH),bi=re.getParameter(re.UNPACK_IMAGE_HEIGHT),ai=re.getParameter(re.UNPACK_SKIP_PIXELS),Rs=re.getParameter(re.UNPACK_SKIP_ROWS),ho=re.getParameter(re.UNPACK_SKIP_IMAGES);re.pixelStorei(re.UNPACK_ROW_LENGTH,Lr.width),re.pixelStorei(re.UNPACK_IMAGE_HEIGHT,Lr.height),re.pixelStorei(re.UNPACK_SKIP_PIXELS,er),re.pixelStorei(re.UNPACK_SKIP_ROWS,fr),re.pixelStorei(re.UNPACK_SKIP_IMAGES,Cn);const Mi=je.isDataArrayTexture||je.isData3DTexture,Mn=_t.isDataArrayTexture||_t.isData3DTexture;if(je.isDepthTexture){const Li=ve.get(je),Kn=ve.get(_t),gs=ve.get(Li.__renderTarget),pl=ve.get(Kn.__renderTarget);Oe.bindFramebuffer(re.READ_FRAMEBUFFER,gs.__webglFramebuffer),Oe.bindFramebuffer(re.DRAW_FRAMEBUFFER,pl.__webglFramebuffer);for(let _s=0;_s<Pn;_s++)Mi&&(re.framebufferTextureLayer(re.READ_FRAMEBUFFER,re.COLOR_ATTACHMENT0,ve.get(je).__webglTexture,yt,Cn+_s),re.framebufferTextureLayer(re.DRAW_FRAMEBUFFER,re.COLOR_ATTACHMENT0,ve.get(_t).__webglTexture,an,ms+_s)),re.blitFramebuffer(er,fr,On,_n,yr,Vr,On,_n,re.DEPTH_BUFFER_BIT,re.NEAREST);Oe.bindFramebuffer(re.READ_FRAMEBUFFER,null),Oe.bindFramebuffer(re.DRAW_FRAMEBUFFER,null)}else if(yt!==0||je.isRenderTargetTexture||ve.has(je)){const Li=ve.get(je),Kn=ve.get(_t);Oe.bindFramebuffer(re.READ_FRAMEBUFFER,os),Oe.bindFramebuffer(re.DRAW_FRAMEBUFFER,as);for(let gs=0;gs<Pn;gs++)Mi?re.framebufferTextureLayer(re.READ_FRAMEBUFFER,re.COLOR_ATTACHMENT0,Li.__webglTexture,yt,Cn+gs):re.framebufferTexture2D(re.READ_FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_2D,Li.__webglTexture,yt),Mn?re.framebufferTextureLayer(re.DRAW_FRAMEBUFFER,re.COLOR_ATTACHMENT0,Kn.__webglTexture,an,ms+gs):re.framebufferTexture2D(re.DRAW_FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_2D,Kn.__webglTexture,an),yt!==0?re.blitFramebuffer(er,fr,On,_n,yr,Vr,On,_n,re.COLOR_BUFFER_BIT,re.NEAREST):Mn?re.copyTexSubImage3D(br,an,yr,Vr,ms+gs,er,fr,On,_n):re.copyTexSubImage2D(br,an,yr,Vr,er,fr,On,_n);Oe.bindFramebuffer(re.READ_FRAMEBUFFER,null),Oe.bindFramebuffer(re.DRAW_FRAMEBUFFER,null)}else Mn?je.isDataTexture||je.isData3DTexture?re.texSubImage3D(br,an,yr,Vr,ms,On,_n,Pn,Gr,or,Lr.data):_t.isCompressedArrayTexture?re.compressedTexSubImage3D(br,an,yr,Vr,ms,On,_n,Pn,Gr,Lr.data):re.texSubImage3D(br,an,yr,Vr,ms,On,_n,Pn,Gr,or,Lr):je.isDataTexture?re.texSubImage2D(re.TEXTURE_2D,an,yr,Vr,On,_n,Gr,or,Lr.data):je.isCompressedTexture?re.compressedTexSubImage2D(re.TEXTURE_2D,an,yr,Vr,Lr.width,Lr.height,Gr,Lr.data):re.texSubImage2D(re.TEXTURE_2D,an,yr,Vr,On,_n,Gr,or,Lr);re.pixelStorei(re.UNPACK_ROW_LENGTH,Un),re.pixelStorei(re.UNPACK_IMAGE_HEIGHT,bi),re.pixelStorei(re.UNPACK_SKIP_PIXELS,ai),re.pixelStorei(re.UNPACK_SKIP_ROWS,Rs),re.pixelStorei(re.UNPACK_SKIP_IMAGES,ho),an===0&&_t.generateMipmaps&&re.generateMipmap(br),Oe.unbindTexture()},this.copyTextureToTexture3D=function(je,_t,Ot=null,Lt=null,yt=0){return kk('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(je,_t,Ot,Lt,yt)},this.initRenderTarget=function(je){ve.get(je).__webglFramebuffer===void 0&&xe.setupRenderTarget(je)},this.initTexture=function(je){je.isCubeTexture?xe.setTextureCube(je,0):je.isData3DTexture?xe.setTexture3D(je,0):je.isDataArrayTexture||je.isCompressedArrayTexture?xe.setTexture2DArray(je,0):xe.setTexture2D(je,0),Oe.unbindTexture()},this.resetState=function(){R=0,C=0,N=null,Oe.reset(),Ye.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return j0}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Zi._getDrawingBufferColorSpace(e),t.unpackColorSpace=Zi._getUnpackColorSpace()}}var SN={exports:{}},EN={},xN={exports:{}},TN={};var o7;function Nde(){if(o7)return TN;o7=1;var n=l5();function e(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,i=n.useEffect,s=n.useLayoutEffect,o=n.useDebugValue;function a(h,f){var d=f(),p=r({inst:{value:d,getSnapshot:f}}),m=p[0].inst,_=p[1];return s(function(){m.value=d,m.getSnapshot=f,c(m)&&_({inst:m})},[h,d,f]),i(function(){return c(m)&&_({inst:m}),h(function(){c(m)&&_({inst:m})})},[h]),o(d),d}function c(h){var f=h.getSnapshot;h=h.value;try{var d=f();return!t(h,d)}catch{return!0}}function l(h,f){return f()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l:a;return TN.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:u,TN}var a7;function Pde(){return a7||(a7=1,xN.exports=Nde()),xN.exports}var c7;function Dde(){if(c7)return EN;c7=1;var n=l5(),e=Pde();function t(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var r=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,s=n.useRef,o=n.useEffect,a=n.useMemo,c=n.useDebugValue;return EN.useSyncExternalStoreWithSelector=function(l,u,h,f,d){var p=s(null);if(p.current===null){var m={hasValue:!1,value:null};p.current=m}else m=p.current;p=a(function(){function v(R){if(!S){if(S=!0,b=R,R=f(R),d!==void 0&&m.hasValue){var C=m.value;if(d(C,R))return T=C}return T=R}if(C=T,r(b,R))return C;var N=f(R);return d!==void 0&&d(C,N)?(b=R,C):(b=R,T=N)}var S=!1,b,T,w=h===void 0?null:h;return[function(){return v(u())},w===null?void 0:function(){return v(w())}]},[u,h,f,d]);var _=i(l,p[0],p[1]);return o(function(){m.hasValue=!0,m.value=_},[_]),c(_),_},EN}var l7;function Lde(){return l7||(l7=1,SN.exports=Dde()),SN.exports}var Ude=Lde();const Bde=wu(Ude),u7=n=>{let e;const t=new Set,r=(l,u)=>{const h=typeof l=="function"?l(e):l;if(!Object.is(h,e)){const f=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(d=>d(e,f))}},i=()=>e,a={setState:r,getState:i,getInitialState:()=>c,subscribe:l=>(t.add(l),()=>t.delete(l))},c=e=n(r,i,a);return a},oO=(n=>n?u7(n):u7),{useSyncExternalStoreWithSelector:Fde}=Bde,jde=n=>n;function zde(n,e=jde,t){const r=Fde(n.subscribe,n.getState,n.getInitialState,e,t);return yh.useDebugValue(r),r}const h7=(n,e)=>{const t=oO(n),r=(i,s=e)=>zde(t,i,s);return Object.assign(r,t),r},NW=((n,e)=>n?h7(n,e):h7),$de=n=>typeof n=="object"&&typeof n.then=="function",wb=[];function PW(n,e,t=(r,i)=>r===i){if(n===e)return!0;if(!n||!e)return!1;const r=n.length;if(e.length!==r)return!1;for(let i=0;i<r;i++)if(!t(n[i],e[i]))return!1;return!0}function DW(n,e=null,t=!1,r={}){e===null&&(e=[n]);for(const s of wb)if(PW(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return r.lifespan&&r.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,r.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:r.equal,remove:()=>{const s=wb.indexOf(i);s!==-1&&wb.splice(s,1)},promise:($de(n)?n:n(...e)).then(s=>{i.response=s,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(s=>i.error=s)};if(wb.push(i),!t)throw i.promise}const LW=(n,e,t)=>DW(n,e,!1,t),Vde=(n,e,t)=>{DW(n,e,!0,t)},Hde=n=>{if(n===void 0||n.length===0)wb.splice(0,wb.length);else{const e=wb.find(t=>PW(n,t.keys,t.equal));e&&e.remove()}};var wN={exports:{}},AN={};var f7;function Gde(){return f7||(f7=1,(function(n){function e(X,G){var Y=X.length;X.push(G);e:for(;0<Y;){var J=Y-1>>>1,Q=X[J];if(0<i(Q,G))X[J]=G,X[Y]=Q,Y=J;else break e}}function t(X){return X.length===0?null:X[0]}function r(X){if(X.length===0)return null;var G=X[0],Y=X.pop();if(Y!==G){X[0]=Y;e:for(var J=0,Q=X.length,z=Q>>>1;J<z;){var q=2*(J+1)-1,ee=X[q],te=q+1,ie=X[te];if(0>i(ee,Y))te<Q&&0>i(ie,ee)?(X[J]=ie,X[te]=Y,J=te):(X[J]=ee,X[q]=Y,J=q);else if(te<Q&&0>i(ie,Y))X[J]=ie,X[te]=Y,J=te;else break e}}return G}function i(X,G){var Y=X.sortIndex-G.sortIndex;return Y!==0?Y:X.id-G.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],l=[],u=1,h=null,f=3,d=!1,p=!1,m=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function T(X){for(var G=t(l);G!==null;){if(G.callback===null)r(l);else if(G.startTime<=X)r(l),G.sortIndex=G.expirationTime,e(c,G);else break;G=t(l)}}function w(X){if(m=!1,T(X),!p)if(t(c)!==null)p=!0,R||(R=!0,I());else{var G=t(l);G!==null&&H(w,G.startTime-X)}}var R=!1,C=-1,N=5,U=-1;function B(){return _?!0:!(n.unstable_now()-U<N)}function $(){if(_=!1,R){var X=n.unstable_now();U=X;var G=!0;try{e:{p=!1,m&&(m=!1,S(C),C=-1),d=!0;var Y=f;try{t:{for(T(X),h=t(c);h!==null&&!(h.expirationTime>X&&B());){var J=h.callback;if(typeof J=="function"){h.callback=null,f=h.priorityLevel;var Q=J(h.expirationTime<=X);if(X=n.unstable_now(),typeof Q=="function"){h.callback=Q,T(X),G=!0;break t}h===t(c)&&r(c),T(X)}else r(c);h=t(c)}if(h!==null)G=!0;else{var z=t(l);z!==null&&H(w,z.startTime-X),G=!1}}break e}finally{h=null,f=Y,d=!1}G=void 0}}finally{G?I():R=!1}}}var I;if(typeof b=="function")I=function(){b($)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,P=L.port2;L.port1.onmessage=$,I=function(){P.postMessage(null)}}else I=function(){v($,0)};function H(X,G){C=v(function(){X(n.unstable_now())},G)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(X){X.callback=null},n.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<X?Math.floor(1e3/X):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_next=function(X){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var Y=f;f=G;try{return X()}finally{f=Y}},n.unstable_requestPaint=function(){_=!0},n.unstable_runWithPriority=function(X,G){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var Y=f;f=X;try{return G()}finally{f=Y}},n.unstable_scheduleCallback=function(X,G,Y){var J=n.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?J+Y:J):Y=J,X){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=Y+Q,X={id:u++,callback:G,priorityLevel:X,startTime:Y,expirationTime:Q,sortIndex:-1},Y>J?(X.sortIndex=Y,e(l,X),t(c)===null&&X===t(l)&&(m?(S(C),C=-1):m=!0,H(w,Y-J))):(X.sortIndex=Q,e(c,X),p||d||(p=!0,R||(R=!0,I()))),X},n.unstable_shouldYield=B,n.unstable_wrapCallback=function(X){var G=f;return function(){var Y=f;f=G;try{return X.apply(this,arguments)}finally{f=Y}}}})(AN)),AN}var d7;function Wde(){return d7||(d7=1,wN.exports=Gde()),wN.exports}var mL=Wde();const qde=wu(mL);function UW(n){let e=n.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const BW=n=>n&&n.isOrthographicCamera,Yde=n=>n!=null&&(typeof n=="string"||typeof n=="number"||n.isColor),x5=((n,e)=>typeof window<"u"&&(((n=window.document)==null?void 0:n.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Ke.useLayoutEffect:Ke.useEffect;function FW(n){const e=Ke.useRef(n);return x5(()=>{e.current=n},[n]),e}function jW(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}function HS(n){var e;return(e=n.__r3f)==null?void 0:e.root.getState()}const Mo={obj:n=>n===Object(n)&&!Mo.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,nul:n=>n===null,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:r="reference",strict:i=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(Mo.str(n)||Mo.num(n)||Mo.boo(n))return n===e;const s=Mo.obj(n);if(s&&r==="reference")return n===e;const o=Mo.arr(n);if(o&&t==="reference")return n===e;if((o||s)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;if(s&&t==="shallow"&&r==="shallow"){for(a in i?e:n)if(!Mo.equ(n[a],e[a],{strict:i,objects:"reference"}))return!1}else for(a in i?e:n)if(n[a]!==e[a])return!1;if(Mo.und(a)){if(o&&n.length===0&&e.length===0||s&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function Kde(n){const e={nodes:{},materials:{},meshes:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function Xde(n){n.type!=="Scene"&&(n.dispose==null||n.dispose());for(const e in n){const t=n[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const zW=["children","key","ref"];function Zde(n){const e={};for(const t in n)zW.includes(t)||(e[t]=n[t]);return e}function EM(n,e,t,r){const i=n;let s=i?.__r3f;return s||(s={root:e,type:t,parent:null,children:[],props:Zde(r),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function eA(n,e){if(!e.includes("-"))return{root:n,key:e,target:n[e]};if(e in n)return{root:n,key:e,target:n[e]};let t=n;const r=e.split("-");for(const i of r){if(typeof t!="object"||t===null){if(t!==void 0){const s=r.slice(r.indexOf(i)).join("-");return{root:t,key:s,target:void 0}}return{root:n,key:e,target:void 0}}e=i,n=t,t=t[e]}return{root:n,key:e,target:t}}const p7=/-\d+$/;function xM(n,e){if(Mo.str(e.props.attach)){if(p7.test(e.props.attach)){const i=e.props.attach.replace(p7,""),{root:s,key:o}=eA(n.object,i);Array.isArray(s[o])||(s[o]=[])}const{root:t,key:r}=eA(n.object,e.props.attach);e.previousAttach=t[r],t[r]=e.object}else Mo.fun(e.props.attach)&&(e.previousAttach=e.props.attach(n.object,e.object))}function TM(n,e){if(Mo.str(e.props.attach)){const{root:t,key:r}=eA(n.object,e.props.attach),i=e.previousAttach;i===void 0?delete t[r]:t[r]=i}else e.previousAttach==null||e.previousAttach(n.object,e.object);delete e.previousAttach}const gL=[...zW,"args","dispose","attach","object","onUpdate","dispose"],m7=new Map;function Jde(n){let e=m7.get(n.constructor);try{e||(e=new n.constructor,m7.set(n.constructor,e))}catch{}return e}function Qde(n,e){const t={};for(const r in e)if(!gL.includes(r)&&!Mo.equ(e[r],n.props[r])){t[r]=e[r];for(const i in e)i.startsWith(`${r}-`)&&(t[i]=e[i])}for(const r in n.props){if(gL.includes(r)||e.hasOwnProperty(r))continue;const{root:i,key:s}=eA(n.object,r);if(i.constructor&&i.constructor.length===0){const o=Jde(i);Mo.und(o)||(t[s]=o[s])}else t[s]=0}return t}const epe=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],tpe=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function Av(n,e){var t;const r=n.__r3f,i=r&&UW(r).getState(),s=r?.eventCount;for(const a in e){let c=e[a];if(gL.includes(a))continue;if(r&&tpe.test(a)){typeof c=="function"?r.handlers[a]=c:delete r.handlers[a],r.eventCount=Object.keys(r.handlers).length;continue}if(c===void 0)continue;let{root:l,key:u,target:h}=eA(n,a);if(h===void 0&&(typeof l!="object"||l===null))throw Error(`R3F: Cannot set "${a}". Ensure it is an object before setting "${u}".`);if(h instanceof Qw&&c instanceof Qw)h.mask=c.mask;else if(h instanceof Ti&&Yde(c))h.set(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof h.copy=="function"&&c!=null&&c.constructor&&h.constructor===c.constructor)h.copy(c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&Array.isArray(c))typeof h.fromArray=="function"?h.fromArray(c):h.set(...c);else if(h!==null&&typeof h=="object"&&typeof h.set=="function"&&typeof c=="number")typeof h.setScalar=="function"?h.setScalar(c):h.set(c);else{var o;l[u]=c,i&&!i.linear&&epe.includes(u)&&(o=l[u])!=null&&o.isTexture&&l[u].format===_u&&l[u].type===Oo&&(l[u].colorSpace=Fi)}}if(r!=null&&r.parent&&i!=null&&i.internal&&(t=r.object)!=null&&t.isObject3D&&s!==r.eventCount){const a=r.object,c=i.internal.interaction.indexOf(a);c>-1&&i.internal.interaction.splice(c,1),r.eventCount&&a.raycast!==null&&i.internal.interaction.push(a)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&$x(r),n}function $x(n){var e;if(!n.parent)return;n.props.onUpdate==null||n.props.onUpdate(n.object);const t=(e=n.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function $W(n,e){n.manual||(BW(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix())}const hu=n=>n?.isObject3D;function ER(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function VW(n,e,t,r){const i=t.get(e);i&&(t.delete(e),t.size===0&&(n.delete(r),i.target.releasePointerCapture(r)))}function npe(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(r=>r!==e),t.initialHits=t.initialHits.filter(r=>r!==e),t.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((r,i)=>{VW(t.capturedMap,e,r,i)})}function rpe(n){function e(c){const{internal:l}=n.getState(),u=c.offsetX-l.initialClick[0],h=c.offsetY-l.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(c){return c.filter(l=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=l.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(c,l){const u=n.getState(),h=new Set,f=[],d=l?l(u.internal.interaction):u.internal.interaction;for(let v=0;v<d.length;v++){const S=HS(d[v]);S&&(S.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(c,u);function p(v){const S=HS(v);if(!S||!S.events.enabled||S.raycaster.camera===null)return[];if(S.raycaster.camera===void 0){var b;S.events.compute==null||S.events.compute(c,S,(b=S.previousRoot)==null?void 0:b.getState()),S.raycaster.camera===void 0&&(S.raycaster.camera=null)}return S.raycaster.camera?S.raycaster.intersectObject(v,!0):[]}let m=d.flatMap(p).sort((v,S)=>{const b=HS(v.object),T=HS(S.object);return!b||!T?v.distance-S.distance:T.events.priority-b.events.priority||v.distance-S.distance}).filter(v=>{const S=ER(v);return h.has(S)?!1:(h.add(S),!0)});u.events.filter&&(m=u.events.filter(m,u));for(const v of m){let S=v.object;for(;S;){var _;(_=S.__r3f)!=null&&_.eventCount&&f.push({...v,eventObject:S}),S=S.parent}}if("pointerId"in c&&u.internal.capturedMap.has(c.pointerId))for(let v of u.internal.capturedMap.get(c.pointerId).values())h.has(ER(v.intersection))||f.push(v.intersection);return f}function i(c,l,u,h){if(c.length){const f={stopped:!1};for(const d of c){let p=HS(d.object);if(p||d.object.traverseAncestors(m=>{const _=HS(m);if(_)return p=_,!1}),p){const{raycaster:m,pointer:_,camera:v,internal:S}=p,b=new zt(_.x,_.y,0).unproject(v),T=U=>{var B,$;return(B=($=S.capturedMap.get(U))==null?void 0:$.has(d.eventObject))!=null?B:!1},w=U=>{const B={intersection:d,target:l.target};S.capturedMap.has(U)?S.capturedMap.get(U).set(d.eventObject,B):S.capturedMap.set(U,new Map([[d.eventObject,B]])),l.target.setPointerCapture(U)},R=U=>{const B=S.capturedMap.get(U);B&&VW(S.capturedMap,d.eventObject,B,U)};let C={};for(let U in l){let B=l[U];typeof B!="function"&&(C[U]=B)}let N={...d,...C,pointer:_,intersections:c,stopped:f.stopped,delta:u,unprojectedPoint:b,ray:m.ray,camera:v,stopPropagation(){const U="pointerId"in l&&S.capturedMap.get(l.pointerId);if((!U||U.has(d.eventObject))&&(N.stopped=f.stopped=!0,S.hovered.size&&Array.from(S.hovered.values()).find(B=>B.eventObject===d.eventObject))){const B=c.slice(0,c.indexOf(d));s([...B,d])}},target:{hasPointerCapture:T,setPointerCapture:w,releasePointerCapture:R},currentTarget:{hasPointerCapture:T,setPointerCapture:w,releasePointerCapture:R},nativeEvent:l};if(h(N),f.stopped===!0)break}}}return c}function s(c){const{internal:l}=n.getState();for(const u of l.hovered.values())if(!c.length||!c.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const f=u.eventObject.__r3f;if(l.hovered.delete(ER(u)),f!=null&&f.eventCount){const d=f.handlers,p={...u,intersections:c};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function o(c,l){for(let u=0;u<l.length;u++){const h=l[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(c)}}function a(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return l=>{const{internal:u}=n.getState();"pointerId"in l&&u.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(l.pointerId)&&(u.capturedMap.delete(l.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:f}=n.getState();f.lastEvent.current=u;const d=c==="onPointerMove",p=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",_=r(u,d?t:void 0),v=p?e(u):0;c==="onPointerDown"&&(f.initialClick=[u.offsetX,u.offsetY],f.initialHits=_.map(b=>b.eventObject)),p&&!_.length&&v<=2&&(o(u,f.interaction),h&&h(u)),d&&s(_);function S(b){const T=b.eventObject,w=T.__r3f;if(!(w!=null&&w.eventCount))return;const R=w.handlers;if(d){if(R.onPointerOver||R.onPointerEnter||R.onPointerOut||R.onPointerLeave){const C=ER(b),N=f.hovered.get(C);N?N.stopped&&b.stopPropagation():(f.hovered.set(C,b),R.onPointerOver==null||R.onPointerOver(b),R.onPointerEnter==null||R.onPointerEnter(b))}R.onPointerMove==null||R.onPointerMove(b)}else{const C=R[c];C?(!p||f.initialHits.includes(T))&&(o(u,f.interaction.filter(N=>!f.initialHits.includes(N))),C(b)):p&&f.initialHits.includes(T)&&o(u,f.interaction.filter(N=>!f.initialHits.includes(N)))}}i(_,u,v,S)}}return{handlePointer:a}}const g7=n=>!!(n!=null&&n.render),T5=Ke.createContext(null),ipe=(n,e)=>{const t=NW((a,c)=>{const l=new zt,u=new zt,h=new zt;function f(v=c().camera,S=u,b=c().size){const{width:T,height:w,top:R,left:C}=b,N=T/w;S.isVector3?h.copy(S):h.set(...S);const U=v.getWorldPosition(l).distanceTo(h);if(BW(v))return{width:T/v.zoom,height:w/v.zoom,top:R,left:C,factor:1,distance:U,aspect:N};{const B=v.fov*Math.PI/180,$=2*Math.tan(B/2)*U,I=$*(T/w);return{width:I,height:$,top:R,left:C,factor:T/I,distance:U,aspect:N}}}let d;const p=v=>a(S=>({performance:{...S.performance,current:v}})),m=new zn;return{set:a,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(v=1)=>n(c(),v),advance:(v,S)=>e(v,S,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Yce,pointer:m,mouse:m,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const v=c();d&&clearTimeout(d),v.performance.current!==v.performance.min&&p(v.performance.min),d=setTimeout(()=>p(c().performance.max),v.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:v=>a(S=>({...S,events:{...S.events,...v}})),setSize:(v,S,b=0,T=0)=>{const w=c().camera,R={width:v,height:S,top:b,left:T};a(C=>({size:R,viewport:{...C.viewport,...f(w,u,R)}}))},setDpr:v=>a(S=>{const b=jW(v);return{viewport:{...S.viewport,dpr:b,initialDpr:S.viewport.initialDpr||b}}}),setFrameloop:(v="always")=>{const S=c().clock;S.stop(),S.elapsedTime=0,v!=="never"&&(S.start(),S.elapsedTime=0),a(()=>({frameloop:v}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Ke.createRef(),active:!1,frames:0,priority:0,subscribe:(v,S,b)=>{const T=c().internal;return T.priority=T.priority+(S>0?1:0),T.subscribers.push({ref:v,priority:S,store:b}),T.subscribers=T.subscribers.sort((w,R)=>w.priority-R.priority),()=>{const w=c().internal;w!=null&&w.subscribers&&(w.priority=w.priority-(S>0?1:0),w.subscribers=w.subscribers.filter(R=>R.ref!==v))}}}}}),r=t.getState();let i=r.size,s=r.viewport.dpr,o=r.camera;return t.subscribe(()=>{const{camera:a,size:c,viewport:l,gl:u,set:h}=t.getState();if(c.width!==i.width||c.height!==i.height||l.dpr!==s){i=c,s=l.dpr,$W(a,c),l.dpr>0&&u.setPixelRatio(l.dpr);const f=typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(c.width,c.height,f)}a!==o&&(o=a,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>n(a)),t};function w5(){const n=Ke.useContext(T5);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function jc(n=t=>t,e){return w5()(n,e)}function s_(n,e=0){const t=w5(),r=t.getState().internal.subscribe,i=FW(n);return x5(()=>r(i,e,t),[e,r,t]),null}const _7=new WeakMap,spe=n=>{var e;return typeof n=="function"&&(n==null||(e=n.prototype)==null?void 0:e.constructor)===n};function HW(n,e){return function(t,...r){let i;return spe(t)?(i=_7.get(t),i||(i=new t,_7.set(t,i))):i=t,n&&n(i),Promise.all(r.map(s=>new Promise((o,a)=>i.load(s,c=>{hu(c?.scene)&&Object.assign(c,Kde(c.scene)),o(c)},e,c=>a(new Error(`Could not load ${s}: ${c?.message}`))))))}}function A5(n,e,t,r){const i=Array.isArray(e)?e:[e],s=LW(HW(t,r),[n,...i],{equal:Mo.equ});return Array.isArray(e)?s:s[0]}A5.preload=function(n,e,t){const r=Array.isArray(e)?e:[e];return Vde(HW(t),[n,...r])};A5.clear=function(n,e){const t=Array.isArray(e)?e:[e];return Hde([n,...t])};const ope=1,ape=8,cpe=32,lpe=2;var upe={version:"9.5.0"};function hpe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var v7={exports:{}},y7={exports:{}},b7;function fpe(){return b7||(b7=1,(function(n){n.exports=function(e){function t(g,y,k,j){return new Nd(g,y,k,j)}function r(){}function i(g){var y="https://react.dev/errors/"+g;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var k=2;k<arguments.length;k++)y+="&args[]="+encodeURIComponent(arguments[k])}return"Minified React error #"+g+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(g){var y=g,k=g;if(g.alternate)for(;y.return;)y=y.return;else{g=y;do y=g,(y.flags&4098)!==0&&(k=y.return),g=y.return;while(g)}return y.tag===3?k:null}function o(g){if(s(g)!==g)throw Error(i(188))}function a(g){var y=g.alternate;if(!y){if(y=s(g),y===null)throw Error(i(188));return y!==g?null:g}for(var k=g,j=y;;){var ne=k.return;if(ne===null)break;var le=ne.alternate;if(le===null){if(j=ne.return,j!==null){k=j;continue}break}if(ne.child===le.child){for(le=ne.child;le;){if(le===k)return o(ne),g;if(le===j)return o(ne),y;le=le.sibling}throw Error(i(188))}if(k.return!==j.return)k=ne,j=le;else{for(var Ne=!1,Ze=ne.child;Ze;){if(Ze===k){Ne=!0,k=ne,j=le;break}if(Ze===j){Ne=!0,j=ne,k=le;break}Ze=Ze.sibling}if(!Ne){for(Ze=le.child;Ze;){if(Ze===k){Ne=!0,k=le,j=ne;break}if(Ze===j){Ne=!0,j=le,k=ne;break}Ze=Ze.sibling}if(!Ne)throw Error(i(189))}}if(k.alternate!==j)throw Error(i(190))}if(k.tag!==3)throw Error(i(188));return k.stateNode.current===k?g:y}function c(g){var y=g.tag;if(y===5||y===26||y===27||y===6)return g;for(g=g.child;g!==null;){if(y=c(g),y!==null)return y;g=g.sibling}return null}function l(g){var y=g.tag;if(y===5||y===26||y===27||y===6)return g;for(g=g.child;g!==null;){if(g.tag!==4&&(y=l(g),y!==null))return y;g=g.sibling}return null}function u(g){return g===null||typeof g!="object"?null:(g=Ud&&g[Ud]||g["@@iterator"],typeof g=="function"?g:null)}function h(g){if(g==null)return null;if(typeof g=="function")return g.$$typeof===xy?null:g.displayName||g.name||null;if(typeof g=="string")return g;switch(g){case Pd:return"Fragment";case qg:return"Profiler";case Dd:return"StrictMode";case Df:return"Suspense";case $u:return"SuspenseList";case Zp:return"Activity"}if(typeof g=="object")switch(g.$$typeof){case zu:return"Portal";case Zs:return g.displayName||"Context";case j_:return(g._context.displayName||"Context")+".Consumer";case Ac:var y=g.render;return g=g.displayName,g||(g=y.displayName||y.name||"",g=g!==""?"ForwardRef("+g+")":"ForwardRef"),g;case Xp:return y=g.displayName||null,y!==null?y:h(g.type)||"Memo";case Vu:y=g._payload,g=g._init;try{return h(g(y))}catch{}}return null}function f(g){return{current:g}}function d(g){0>Xu||(g.current=u0[Xu],u0[Xu]=null,Xu--)}function p(g,y){Xu++,u0[Xu]=g.current,g.current=y}function m(g){return g>>>=0,g===0?32:31-(Zu(g)/Q_|0)|0}function _(g){var y=g&42;if(y!==0)return y;switch(g&-g){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return g&261888;case 262144:case 524288:case 1048576:case 2097152:return g&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return g&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return g}}function v(g,y,k){var j=g.pendingLanes;if(j===0)return 0;var ne=0,le=g.suspendedLanes,Ne=g.pingedLanes;g=g.warmLanes;var Ze=j&134217727;return Ze!==0?(j=Ze&~le,j!==0?ne=_(j):(Ne&=Ze,Ne!==0?ne=_(Ne):k||(k=Ze&~g,k!==0&&(ne=_(k))))):(Ze=j&~le,Ze!==0?ne=_(Ze):Ne!==0?ne=_(Ne):k||(k=j&~g,k!==0&&(ne=_(k)))),ne===0?0:y!==0&&y!==ne&&(y&le)===0&&(le=ne&-ne,k=y&-y,le>=k||le===32&&(k&4194048)!==0)?y:ne}function S(g,y){return(g.pendingLanes&~(g.suspendedLanes&~g.pingedLanes)&y)===0}function b(g,y){switch(g){case 1:case 2:case 4:case 8:case 64:return y+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function T(){var g=Al;return Al<<=1,(Al&62914560)===0&&(Al=4194304),g}function w(g){for(var y=[],k=0;31>k;k++)y.push(g);return y}function R(g,y){g.pendingLanes|=y,y!==268435456&&(g.suspendedLanes=0,g.pingedLanes=0,g.warmLanes=0)}function C(g,y,k,j,ne,le){var Ne=g.pendingLanes;g.pendingLanes=k,g.suspendedLanes=0,g.pingedLanes=0,g.warmLanes=0,g.expiredLanes&=k,g.entangledLanes&=k,g.errorRecoveryDisabledLanes&=k,g.shellSuspendCounter=0;var Ze=g.entanglements,St=g.expirationTimes,Dt=g.hiddenUpdates;for(k=Ne&~k;0<k;){var Kt=31-Es(k),Xt=1<<Kt;Ze[Kt]=0,St[Kt]=-1;var vn=Dt[Kt];if(vn!==null)for(Dt[Kt]=null,Kt=0;Kt<vn.length;Kt++){var Zn=vn[Kt];Zn!==null&&(Zn.lane&=-536870913)}k&=~Xt}j!==0&&N(g,j,0),le!==0&&ne===0&&g.tag!==0&&(g.suspendedLanes|=le&~(Ne&~y))}function N(g,y,k){g.pendingLanes|=y,g.suspendedLanes&=~y;var j=31-Es(y);g.entangledLanes|=y,g.entanglements[j]=g.entanglements[j]|1073741824|k&261930}function U(g,y){var k=g.entangledLanes|=y;for(g=g.entanglements;k;){var j=31-Es(k),ne=1<<j;ne&y|g[j]&y&&(g[j]|=y),k&=~ne}}function B(g,y){var k=y&-y;return k=(k&42)!==0?1:$(k),(k&(g.suspendedLanes|y))!==0?0:k}function $(g){switch(g){case 2:g=1;break;case 8:g=4;break;case 32:g=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:g=128;break;case 268435456:g=134217728;break;default:g=0}return g}function I(g){return g&=-g,2<g?8<g?(g&134217727)!==0?32:268435456:8:2}function L(g){if(typeof RT=="function"&&kT(g),ec&&typeof ec.setStrictMode=="function")try{ec.setStrictMode(d0,g)}catch{}}function P(g,y){return g===y&&(g!==0||1/g===1/y)||g!==g&&y!==y}function H(g){if(jy===void 0)try{throw Error()}catch(k){var y=k.stack.trim().match(/\n( *(at )?)/);jy=y&&y[1]||"",Ro=-1<k.stack.indexOf(`
    at`)?" (<anonymous>)":-1<k.stack.indexOf("@")?"@unknown:0:0":""}return`
`+jy+g+Ro}function X(g,y){if(!g||Fo)return"";Fo=!0;var k=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var j={DetermineComponentFrameRoot:function(){try{if(y){var Xt=function(){throw Error()};if(Object.defineProperty(Xt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Xt,[])}catch(Zn){var vn=Zn}Reflect.construct(g,[],Xt)}else{try{Xt.call()}catch(Zn){vn=Zn}g.call(Xt.prototype)}}else{try{throw Error()}catch(Zn){vn=Zn}(Xt=g())&&typeof Xt.catch=="function"&&Xt.catch(function(){})}}catch(Zn){if(Zn&&vn&&typeof Zn.stack=="string")return[Zn.stack,vn.stack]}return[null,null]}};j.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var ne=Object.getOwnPropertyDescriptor(j.DetermineComponentFrameRoot,"name");ne&&ne.configurable&&Object.defineProperty(j.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var le=j.DetermineComponentFrameRoot(),Ne=le[0],Ze=le[1];if(Ne&&Ze){var St=Ne.split(`
`),Dt=Ze.split(`
`);for(ne=j=0;j<St.length&&!St[j].includes("DetermineComponentFrameRoot");)j++;for(;ne<Dt.length&&!Dt[ne].includes("DetermineComponentFrameRoot");)ne++;if(j===St.length||ne===Dt.length)for(j=St.length-1,ne=Dt.length-1;1<=j&&0<=ne&&St[j]!==Dt[ne];)ne--;for(;1<=j&&0<=ne;j--,ne--)if(St[j]!==Dt[ne]){if(j!==1||ne!==1)do if(j--,ne--,0>ne||St[j]!==Dt[ne]){var Kt=`
`+St[j].replace(" at new "," at ");return g.displayName&&Kt.includes("<anonymous>")&&(Kt=Kt.replace("<anonymous>",g.displayName)),Kt}while(1<=j&&0<=ne);break}}}finally{Fo=!1,Error.prepareStackTrace=k}return(k=g?g.displayName||g.name:"")?H(k):""}function G(g,y){switch(g.tag){case 26:case 27:case 5:return H(g.type);case 16:return H("Lazy");case 13:return g.child!==y&&y!==null?H("Suspense Fallback"):H("Suspense");case 19:return H("SuspenseList");case 0:case 15:return X(g.type,!1);case 11:return X(g.type.render,!1);case 1:return X(g.type,!0);case 31:return H("Activity");default:return""}}function Y(g){try{var y="",k=null;do y+=G(g,k),k=g,g=g.return;while(g);return y}catch(j){return`
Error generating stack: `+j.message+`
`+j.stack}}function J(g,y){if(typeof g=="object"&&g!==null){var k=nc.get(g);return k!==void 0?k:(y={value:g,source:y,stack:Y(y)},nc.set(g,y),y)}return{value:g,source:y,stack:Y(y)}}function Q(g,y){oa[Ni++]=$d,oa[Ni++]=tv,tv=g,$d=y}function z(g,y,k){el[Cc++]=Ju,el[Cc++]=nu,el[Cc++]=Rc,Rc=g;var j=Ju;g=nu;var ne=32-Es(j)-1;j&=~(1<<ne),k+=1;var le=32-Es(y)+ne;if(30<le){var Ne=ne-ne%5;le=(j&(1<<Ne)-1).toString(32),j>>=Ne,ne-=Ne,Ju=1<<32-Es(y)+ne|k<<ne|j,nu=le+g}else Ju=1<<le|k<<ne|j,nu=g}function q(g){g.return!==null&&(Q(g,1),z(g,1,0))}function ee(g){for(;g===tv;)tv=oa[--Ni],oa[Ni]=null,$d=oa[--Ni],oa[Ni]=null;for(;g===Rc;)Rc=el[--Cc],el[Cc]=null,nu=el[--Cc],el[Cc]=null,Ju=el[--Cc],el[Cc]=null}function te(g,y){el[Cc++]=Ju,el[Cc++]=nu,el[Cc++]=Rc,Ju=y.id,nu=y.overflow,Rc=g}function ie(g,y){p(jf,y),p(p0,g),p(aa,null),g=z_(y),d(aa),p(aa,g)}function Ee(){d(aa),d(p0),d(jf)}function Re(g){g.memoizedState!==null&&p(nv,g);var y=aa.current,k=Kg(y,g.type);y!==k&&(p(p0,g),p(aa,k))}function Te(g){p0.current===g&&(d(aa),d(p0)),nv.current===g&&(d(nv),Ba?qh._currentValue=xl:qh._currentValue2=xl)}function Pe(g){var y=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Le(J(y,g)),zf}function We(g,y){if(!gi)throw Error(i(175));TT(g.stateNode,g.type,g.memoizedProps,y,g)||Pe(g,!0)}function it(g){for(jo=g.return;jo;)switch(jo.tag){case 5:case 31:case 13:tl=!1;return;case 27:case 3:tl=!0;return;default:jo=jo.return}}function ht(g){if(!gi||g!==jo)return!1;if(!_i)return it(g),_i=!0,!1;var y=g.tag;if(Hs?y!==3&&y!==27&&(y!==5||Bo(g.type)&&!Qp(g.type,g.memoizedProps))&&li&&Pe(g):y!==3&&(y!==5||Bo(g.type)&&!Qp(g.type,g.memoizedProps))&&li&&Pe(g),it(g),y===13){if(!gi)throw Error(i(316));if(g=g.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));li=pS(g)}else if(y===31){if(g=g.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));li=dS(g)}else li=Hs&&y===27?im(g.type,li):jo?rm(g.stateNode):null;return!0}function vt(){gi&&(li=jo=null,_i=!1)}function re(){var g=ru;return g!==null&&(ue===null?ue=g:ue.push.apply(ue,g),ru=null),g}function Le(g){ru===null?ru=[g]:ru.push(g)}function $e(g,y,k){Ba?(p(ca,y._currentValue),y._currentValue=k):(p(ca,y._currentValue2),y._currentValue2=k)}function De(g){var y=ca.current;Ba?g._currentValue=y:g._currentValue2=y,d(ca)}function Oe(g,y,k){for(;g!==null;){var j=g.alternate;if((g.childLanes&y)!==y?(g.childLanes|=y,j!==null&&(j.childLanes|=y)):j!==null&&(j.childLanes&y)!==y&&(j.childLanes|=y),g===k)break;g=g.return}}function ae(g,y,k,j){var ne=g.child;for(ne!==null&&(ne.return=g);ne!==null;){var le=ne.dependencies;if(le!==null){var Ne=ne.child;le=le.firstContext;e:for(;le!==null;){var Ze=le;le=ne;for(var St=0;St<y.length;St++)if(Ze.context===y[St]){le.lanes|=k,Ze=le.alternate,Ze!==null&&(Ze.lanes|=k),Oe(le.return,k,g),j||(Ne=null);break e}le=Ze.next}}else if(ne.tag===18){if(Ne=ne.return,Ne===null)throw Error(i(341));Ne.lanes|=k,le=Ne.alternate,le!==null&&(le.lanes|=k),Oe(Ne,k,g),Ne=null}else Ne=ne.child;if(Ne!==null)Ne.return=ne;else for(Ne=ne;Ne!==null;){if(Ne===g){Ne=null;break}if(ne=Ne.sibling,ne!==null){ne.return=Ne.return,Ne=ne;break}Ne=Ne.return}ne=Ne}}function ve(g,y,k,j){g=null;for(var ne=y,le=!1;ne!==null;){if(!le){if((ne.flags&524288)!==0)le=!0;else if((ne.flags&262144)!==0)break}if(ne.tag===10){var Ne=ne.alternate;if(Ne===null)throw Error(i(387));if(Ne=Ne.memoizedProps,Ne!==null){var Ze=ne.type;tc(ne.pendingProps.value,Ne.value)||(g!==null?g.push(Ze):g=[Ze])}}else if(ne===nv.current){if(Ne=ne.alternate,Ne===null)throw Error(i(387));Ne.memoizedState.memoizedState!==ne.memoizedState.memoizedState&&(g!==null?g.push(qh):g=[qh])}ne=ne.return}g!==null&&ae(y,g,k,j),y.flags|=262144}function xe(g){for(g=g.firstContext;g!==null;){var y=g.context;if(!tc(Ba?y._currentValue:y._currentValue2,g.memoizedValue))return!0;g=g.next}return!1}function pe(g){Jh=g,Qu=null,g=g.dependencies,g!==null&&(g.firstContext=null)}function ze(g){return Xe(Jh,g)}function Je(g,y){return Jh===null&&pe(g),Xe(g,y)}function Xe(g,y){var k=Ba?y._currentValue:y._currentValue2;if(y={context:y,memoizedValue:k,next:null},Qu===null){if(g===null)throw Error(i(308));Qu=y,g.dependencies={lanes:0,firstContext:y},g.flags|=524288}else Qu=Qu.next=y;return k}function et(){return{controller:new SS,data:new Map,refCount:0}}function Ut(g){g.refCount--,g.refCount===0&&ys(rv,function(){g.controller.abort()})}function gt(){}function At(g){g!==xs&&g.next===null&&(xs===null?iv=xs=g:xs=xs.next=g),m0=!0,Qh||(Qh=!0,ye())}function Ce(g,y){if(!sv&&m0){sv=!0;do for(var k=!1,j=iv;j!==null;){if(g!==0){var ne=j.pendingLanes;if(ne===0)var le=0;else{var Ne=j.suspendedLanes,Ze=j.pingedLanes;le=(1<<31-Es(42|g)+1)-1,le&=ne&~(Ne&~Ze),le=le&201326741?le&201326741|1:le?le|2:0}le!==0&&(k=!0,Ae(j,le))}else le=Ei,le=v(j,j===ws?le:0,j.cancelPendingCommit!==null||j.timeoutHandle!==ra),(le&3)===0||S(j,le)||(k=!0,Ae(j,le));j=j.next}while(k);sv=!1}}function se(){W()}function W(){m0=Qh=!1;var g=0;Vd!==0&&H_()&&(g=Vd);for(var y=Fr(),k=null,j=iv;j!==null;){var ne=j.next,le=oe(j,y);le===0?(j.next=null,k===null?iv=ne:k.next=ne,ne===null&&(xs=k)):(k=j,(g!==0||(le&3)!==0)&&(m0=!0)),j=ne}bt!==0&&bt!==5||Ce(g),Vd!==0&&(Vd=0)}function oe(g,y){for(var k=g.suspendedLanes,j=g.pingedLanes,ne=g.expirationTimes,le=g.pendingLanes&-62914561;0<le;){var Ne=31-Es(le),Ze=1<<Ne,St=ne[Ne];St===-1?((Ze&k)===0||(Ze&j)!==0)&&(ne[Ne]=b(Ze,y)):St<=y&&(g.expiredLanes|=Ze),le&=~Ze}if(y=ws,k=Ei,k=v(g,g===y?k:0,g.cancelPendingCommit!==null||g.timeoutHandle!==ra),j=g.callbackNode,k===0||g===y&&(us===2||us===9)||g.cancelPendingCommit!==null)return j!==null&&j!==null&&ev(j),g.callbackNode=null,g.callbackPriority=0;if((k&3)===0||S(g,k)){if(y=k&-k,y===g.callbackPriority)return y;switch(j!==null&&ev(j),I(k)){case 2:case 8:k=yS;break;case 32:k=zd;break;case 268435456:k=CT;break;default:k=zd}return j=Se.bind(null,g),k=Br(k,j),g.callbackPriority=y,g.callbackNode=k,y}return j!==null&&j!==null&&ev(j),g.callbackPriority=2,g.callbackNode=null,2}function Se(g,y){if(bt!==0&&bt!==5)return g.callbackNode=null,g.callbackPriority=0,null;var k=g.callbackNode;if(Hh()&&g.callbackNode!==k)return null;var j=Ei;return j=v(g,g===ws?j:0,g.cancelPendingCommit!==null||g.timeoutHandle!==ra),j===0?null:(Os(g,j,y),oe(g,Fr()),g.callbackNode!=null&&g.callbackNode===k?Se.bind(null,g):null)}function Ae(g,y){if(Hh())return null;Os(g,y,!0)}function ye(){Lf?Wu(function(){(Yr&6)!==0?Br(vS,se):W()}):Br(vS,se)}function _e(){if(Vd===0){var g=eh;g===0&&(g=h0,h0<<=1,(h0&261888)===0&&(h0=256)),Vd=g}return Vd}function Ye(g,y){if(om===null){var k=om=[];zy=0,eh=_e(),Ts={status:"pending",value:void 0,then:function(j){k.push(j)}}}return zy++,y.then(ke,ke),y}function ke(){if(--zy===0&&om!==null){Ts!==null&&(Ts.status="fulfilled");var g=om;om=null,eh=0,Ts=null;for(var y=0;y<g.length;y++)(0,g[y])()}}function Ve(g,y){var k=[],j={status:"pending",value:null,reason:null,then:function(ne){k.push(ne)}};return g.then(function(){j.status="fulfilled",j.value=y;for(var ne=0;ne<k.length;ne++)(0,k[ne])(y)},function(ne){for(j.status="rejected",j.reason=ne,ne=0;ne<k.length;ne++)(0,k[ne])(void 0)}),j}function Fe(){var g=Ds.current;return g!==null?g:ws.pooledCache}function Ge(g,y){y===null?p(Ds,Ds.current):p(Ds,y.pool)}function at(){var g=Fe();return g===null?null:{parent:Ba?Ps._currentValue:Ps._currentValue2,pool:g}}function Be(g,y){if(tc(g,y))return!0;if(typeof g!="object"||g===null||typeof y!="object"||y===null)return!1;var k=Object.keys(g),j=Object.keys(y);if(k.length!==j.length)return!1;for(j=0;j<k.length;j++){var ne=k[j];if(!MT.call(y,ne)||!tc(g[ne],y[ne]))return!1}return!0}function tt(g){return g=g.status,g==="fulfilled"||g==="rejected"}function rt(g,y,k){switch(k=g[k],k===void 0?g.push(y):k!==y&&(y.then(gt,gt),y=k),y.status){case"fulfilled":return y.value;case"rejected":throw g=y.reason,tn(g),g;default:if(typeof y.status=="string")y.then(gt,gt);else{if(g=ws,g!==null&&100<g.shellSuspendCounter)throw Error(i(482));g=y,g.status="pending",g.then(function(j){if(y.status==="pending"){var ne=y;ne.status="fulfilled",ne.value=j}},function(j){if(y.status==="pending"){var ne=y;ne.status="rejected",ne.reason=j}})}switch(y.status){case"fulfilled":return y.value;case"rejected":throw g=y.reason,tn(g),g}throw eo=y,kc}}function xt(g){try{var y=g._init;return y(g._payload)}catch(k){throw k!==null&&typeof k=="object"&&typeof k.then=="function"?(eo=k,kc):k}}function ot(){if(eo===null)throw Error(i(459));var g=eo;return eo=null,g}function tn(g){if(g===kc||g===$f)throw Error(i(483))}function ln(g){var y=th;return th+=1,Gs===null&&(Gs=[]),rt(Gs,g,y)}function Rt(g,y){y=y.props.ref,g.ref=y!==void 0?y:null}function $t(g,y){throw y.$$typeof===F_?Error(i(525)):(g=Object.prototype.toString.call(y),Error(i(31,g==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":g)))}function mt(g){function y(Tt,pt){if(g){var Mt=Tt.deletions;Mt===null?(Tt.deletions=[pt],Tt.flags|=16):Mt.push(pt)}}function k(Tt,pt){if(!g)return null;for(;pt!==null;)y(Tt,pt),pt=pt.sibling;return null}function j(Tt){for(var pt=new Map;Tt!==null;)Tt.key!==null?pt.set(Tt.key,Tt):pt.set(Tt.index,Tt),Tt=Tt.sibling;return pt}function ne(Tt,pt){return Tt=Ns(Tt,pt),Tt.index=0,Tt.sibling=null,Tt}function le(Tt,pt,Mt){return Tt.index=Mt,g?(Mt=Tt.alternate,Mt!==null?(Mt=Mt.index,Mt<pt?(Tt.flags|=67108866,pt):Mt):(Tt.flags|=67108866,pt)):(Tt.flags|=1048576,pt)}function Ne(Tt){return g&&Tt.alternate===null&&(Tt.flags|=67108866),Tt}function Ze(Tt,pt,Mt,on){return pt===null||pt.tag!==6?(pt=Rr(Mt,Tt.mode,on),pt.return=Tt,pt):(pt=ne(pt,Mt),pt.return=Tt,pt)}function St(Tt,pt,Mt,on){var Hn=Mt.type;return Hn===Pd?Kt(Tt,pt,Mt.props.children,on,Mt.key):pt!==null&&(pt.elementType===Hn||typeof Hn=="object"&&Hn!==null&&Hn.$$typeof===Vu&&xt(Hn)===pt.type)?(pt=ne(pt,Mt.props),Rt(pt,Mt),pt.return=Tt,pt):(pt=Ja(Mt.type,Mt.key,Mt.props,null,Tt.mode,on),Rt(pt,Mt),pt.return=Tt,pt)}function Dt(Tt,pt,Mt,on){return pt===null||pt.tag!==4||pt.stateNode.containerInfo!==Mt.containerInfo||pt.stateNode.implementation!==Mt.implementation?(pt=Xc(Mt,Tt.mode,on),pt.return=Tt,pt):(pt=ne(pt,Mt.children||[]),pt.return=Tt,pt)}function Kt(Tt,pt,Mt,on,Hn){return pt===null||pt.tag!==7?(pt=Gh(Mt,Tt.mode,on,Hn),pt.return=Tt,pt):(pt=ne(pt,Mt),pt.return=Tt,pt)}function Xt(Tt,pt,Mt){if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return pt=Rr(""+pt,Tt.mode,Mt),pt.return=Tt,pt;if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case Pf:return Mt=Ja(pt.type,pt.key,pt.props,null,Tt.mode,Mt),Rt(Mt,pt),Mt.return=Tt,Mt;case zu:return pt=Xc(pt,Tt.mode,Mt),pt.return=Tt,pt;case Vu:return pt=xt(pt),Xt(Tt,pt,Mt)}if(Jp(pt)||u(pt))return pt=Gh(pt,Tt.mode,Mt,null),pt.return=Tt,pt;if(typeof pt.then=="function")return Xt(Tt,ln(pt),Mt);if(pt.$$typeof===Zs)return Xt(Tt,Je(Tt,pt),Mt);$t(Tt,pt)}return null}function vn(Tt,pt,Mt,on){var Hn=pt!==null?pt.key:null;if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number"||typeof Mt=="bigint")return Hn!==null?null:Ze(Tt,pt,""+Mt,on);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case Pf:return Mt.key===Hn?St(Tt,pt,Mt,on):null;case zu:return Mt.key===Hn?Dt(Tt,pt,Mt,on):null;case Vu:return Mt=xt(Mt),vn(Tt,pt,Mt,on)}if(Jp(Mt)||u(Mt))return Hn!==null?null:Kt(Tt,pt,Mt,on,null);if(typeof Mt.then=="function")return vn(Tt,pt,ln(Mt),on);if(Mt.$$typeof===Zs)return vn(Tt,pt,Je(Tt,Mt),on);$t(Tt,Mt)}return null}function Zn(Tt,pt,Mt,on,Hn){if(typeof on=="string"&&on!==""||typeof on=="number"||typeof on=="bigint")return Tt=Tt.get(Mt)||null,Ze(pt,Tt,""+on,Hn);if(typeof on=="object"&&on!==null){switch(on.$$typeof){case Pf:return Tt=Tt.get(on.key===null?Mt:on.key)||null,St(pt,Tt,on,Hn);case zu:return Tt=Tt.get(on.key===null?Mt:on.key)||null,Dt(pt,Tt,on,Hn);case Vu:return on=xt(on),Zn(Tt,pt,Mt,on,Hn)}if(Jp(on)||u(on))return Tt=Tt.get(Mt)||null,Kt(pt,Tt,on,Hn,null);if(typeof on.then=="function")return Zn(Tt,pt,Mt,ln(on),Hn);if(on.$$typeof===Zs)return Zn(Tt,pt,Mt,Je(pt,on),Hn);$t(pt,on)}return null}function Nr(Tt,pt,Mt,on){for(var Hn=null,Pr=null,Qn=pt,pr=pt=0,Ii=null;Qn!==null&&pr<Mt.length;pr++){Qn.index>pr?(Ii=Qn,Qn=null):Ii=Qn.sibling;var Ir=vn(Tt,Qn,Mt[pr],on);if(Ir===null){Qn===null&&(Qn=Ii);break}g&&Qn&&Ir.alternate===null&&y(Tt,Qn),pt=le(Ir,pt,pr),Pr===null?Hn=Ir:Pr.sibling=Ir,Pr=Ir,Qn=Ii}if(pr===Mt.length)return k(Tt,Qn),_i&&Q(Tt,pr),Hn;if(Qn===null){for(;pr<Mt.length;pr++)Qn=Xt(Tt,Mt[pr],on),Qn!==null&&(pt=le(Qn,pt,pr),Pr===null?Hn=Qn:Pr.sibling=Qn,Pr=Qn);return _i&&Q(Tt,pr),Hn}for(Qn=j(Qn);pr<Mt.length;pr++)Ii=Zn(Qn,Tt,pr,Mt[pr],on),Ii!==null&&(g&&Ii.alternate!==null&&Qn.delete(Ii.key===null?pr:Ii.key),pt=le(Ii,pt,pr),Pr===null?Hn=Ii:Pr.sibling=Ii,Pr=Ii);return g&&Qn.forEach(function(Ws){return y(Tt,Ws)}),_i&&Q(Tt,pr),Hn}function Vi(Tt,pt,Mt,on){if(Mt==null)throw Error(i(151));for(var Hn=null,Pr=null,Qn=pt,pr=pt=0,Ii=null,Ir=Mt.next();Qn!==null&&!Ir.done;pr++,Ir=Mt.next()){Qn.index>pr?(Ii=Qn,Qn=null):Ii=Qn.sibling;var Ws=vn(Tt,Qn,Ir.value,on);if(Ws===null){Qn===null&&(Qn=Ii);break}g&&Qn&&Ws.alternate===null&&y(Tt,Qn),pt=le(Ws,pt,pr),Pr===null?Hn=Ws:Pr.sibling=Ws,Pr=Ws,Qn=Ii}if(Ir.done)return k(Tt,Qn),_i&&Q(Tt,pr),Hn;if(Qn===null){for(;!Ir.done;pr++,Ir=Mt.next())Ir=Xt(Tt,Ir.value,on),Ir!==null&&(pt=le(Ir,pt,pr),Pr===null?Hn=Ir:Pr.sibling=Ir,Pr=Ir);return _i&&Q(Tt,pr),Hn}for(Qn=j(Qn);!Ir.done;pr++,Ir=Mt.next())Ir=Zn(Qn,Tt,pr,Ir.value,on),Ir!==null&&(g&&Ir.alternate!==null&&Qn.delete(Ir.key===null?pr:Ir.key),pt=le(Ir,pt,pr),Pr===null?Hn=Ir:Pr.sibling=Ir,Pr=Ir);return g&&Qn.forEach(function(rl){return y(Tt,rl)}),_i&&Q(Tt,pr),Hn}function Hi(Tt,pt,Mt,on){if(typeof Mt=="object"&&Mt!==null&&Mt.type===Pd&&Mt.key===null&&(Mt=Mt.props.children),typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case Pf:e:{for(var Hn=Mt.key;pt!==null;){if(pt.key===Hn){if(Hn=Mt.type,Hn===Pd){if(pt.tag===7){k(Tt,pt.sibling),on=ne(pt,Mt.props.children),on.return=Tt,Tt=on;break e}}else if(pt.elementType===Hn||typeof Hn=="object"&&Hn!==null&&Hn.$$typeof===Vu&&xt(Hn)===pt.type){k(Tt,pt.sibling),on=ne(pt,Mt.props),Rt(on,Mt),on.return=Tt,Tt=on;break e}k(Tt,pt);break}else y(Tt,pt);pt=pt.sibling}Mt.type===Pd?(on=Gh(Mt.props.children,Tt.mode,on,Mt.key),on.return=Tt,Tt=on):(on=Ja(Mt.type,Mt.key,Mt.props,null,Tt.mode,on),Rt(on,Mt),on.return=Tt,Tt=on)}return Ne(Tt);case zu:e:{for(Hn=Mt.key;pt!==null;){if(pt.key===Hn)if(pt.tag===4&&pt.stateNode.containerInfo===Mt.containerInfo&&pt.stateNode.implementation===Mt.implementation){k(Tt,pt.sibling),on=ne(pt,Mt.children||[]),on.return=Tt,Tt=on;break e}else{k(Tt,pt);break}else y(Tt,pt);pt=pt.sibling}on=Xc(Mt,Tt.mode,on),on.return=Tt,Tt=on}return Ne(Tt);case Vu:return Mt=xt(Mt),Hi(Tt,pt,Mt,on)}if(Jp(Mt))return Nr(Tt,pt,Mt,on);if(u(Mt)){if(Hn=u(Mt),typeof Hn!="function")throw Error(i(150));return Mt=Hn.call(Mt),Vi(Tt,pt,Mt,on)}if(typeof Mt.then=="function")return Hi(Tt,pt,ln(Mt),on);if(Mt.$$typeof===Zs)return Hi(Tt,pt,Je(Tt,Mt),on);$t(Tt,Mt)}return typeof Mt=="string"&&Mt!==""||typeof Mt=="number"||typeof Mt=="bigint"?(Mt=""+Mt,pt!==null&&pt.tag===6?(k(Tt,pt.sibling),on=ne(pt,Mt),on.return=Tt,Tt=on):(k(Tt,pt),on=Rr(Mt,Tt.mode,on),on.return=Tt,Tt=on),Ne(Tt)):k(Tt,pt)}return function(Tt,pt,Mt,on){try{th=0;var Hn=Hi(Tt,pt,Mt,on);return Gs=null,Hn}catch(Qn){if(Qn===kc||Qn===$f)throw Qn;var Pr=t(29,Qn,null,Tt.mode);return Pr.lanes=on,Pr.return=Tt,Pr}}}function Zt(){for(var g=ge,y=Ie=ge=0;y<g;){var k=Z[y];Z[y++]=null;var j=Z[y];Z[y++]=null;var ne=Z[y];Z[y++]=null;var le=Z[y];if(Z[y++]=null,j!==null&&ne!==null){var Ne=j.pending;Ne===null?ne.next=ne:(ne.next=Ne.next,Ne.next=ne),j.pending=ne}le!==0&&Ln(k,ne,le)}}function wn(g,y,k,j){Z[ge++]=g,Z[ge++]=y,Z[ge++]=k,Z[ge++]=j,Ie|=j,g.lanes|=j,g=g.alternate,g!==null&&(g.lanes|=j)}function qt(g,y,k,j){return wn(g,y,k,j),mr(g)}function An(g,y){return wn(g,null,null,y),mr(g)}function Ln(g,y,k){g.lanes|=k;var j=g.alternate;j!==null&&(j.lanes|=k);for(var ne=!1,le=g.return;le!==null;)le.childLanes|=k,j=le.alternate,j!==null&&(j.childLanes|=k),le.tag===22&&(g=le.stateNode,g===null||g._visibility&1||(ne=!0)),g=le,le=le.return;return g.tag===3?(le=g.stateNode,ne&&y!==null&&(ne=31-Es(k),g=le.hiddenUpdates,j=g[ne],j===null?g[ne]=[y]:j.push(y),y.lane=k|536870912),le):null}function mr(g){if(50<Dn)throw Dn=0,Xn=null,Error(i(185));for(var y=g.return;y!==null;)g=y,y=g.return;return g.tag===3?g.stateNode:null}function is(g){g.updateQueue={baseState:g.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function hi(g,y){g=g.updateQueue,y.updateQueue===g&&(y.updateQueue={baseState:g.baseState,firstBaseUpdate:g.firstBaseUpdate,lastBaseUpdate:g.lastBaseUpdate,shared:g.shared,callbacks:null})}function ti(g){return{lane:g,tag:0,payload:null,callback:null,next:null}}function ji(g,y,k){var j=g.updateQueue;if(j===null)return null;if(j=j.shared,(Yr&2)!==0){var ne=j.pending;return ne===null?y.next=y:(y.next=ne.next,ne.next=y),j.pending=y,y=mr(g),Ln(g,null,k),y}return wn(g,j,y,k),mr(g)}function ss(g,y,k){if(y=y.updateQueue,y!==null&&(y=y.shared,(k&4194048)!==0)){var j=y.lanes;j&=g.pendingLanes,k|=j,y.lanes=k,U(g,k)}}function Yi(g,y){var k=g.updateQueue,j=g.alternate;if(j!==null&&(j=j.updateQueue,k===j)){var ne=null,le=null;if(k=k.firstBaseUpdate,k!==null){do{var Ne={lane:k.lane,tag:k.tag,payload:k.payload,callback:null,next:null};le===null?ne=le=Ne:le=le.next=Ne,k=k.next}while(k!==null);le===null?ne=le=y:le=le.next=y}else ne=le=y;k={baseState:j.baseState,firstBaseUpdate:ne,lastBaseUpdate:le,shared:j.shared,callbacks:j.callbacks},g.updateQueue=k;return}g=k.lastBaseUpdate,g===null?k.firstBaseUpdate=y:g.next=y,k.lastBaseUpdate=y}function os(){if(ct){var g=Ts;if(g!==null)throw g}}function as(g,y,k,j){ct=!1;var ne=g.updateQueue;He=!1;var le=ne.firstBaseUpdate,Ne=ne.lastBaseUpdate,Ze=ne.shared.pending;if(Ze!==null){ne.shared.pending=null;var St=Ze,Dt=St.next;St.next=null,Ne===null?le=Dt:Ne.next=Dt,Ne=St;var Kt=g.alternate;Kt!==null&&(Kt=Kt.updateQueue,Ze=Kt.lastBaseUpdate,Ze!==Ne&&(Ze===null?Kt.firstBaseUpdate=Dt:Ze.next=Dt,Kt.lastBaseUpdate=St))}if(le!==null){var Xt=ne.baseState;Ne=0,Kt=Dt=St=null,Ze=le;do{var vn=Ze.lane&-536870913,Zn=vn!==Ze.lane;if(Zn?(Ei&vn)===vn:(j&vn)===vn){vn!==0&&vn===eh&&(ct=!0),Kt!==null&&(Kt=Kt.next={lane:0,tag:Ze.tag,payload:Ze.payload,callback:null,next:null});e:{var Nr=g,Vi=Ze;vn=y;var Hi=k;switch(Vi.tag){case 1:if(Nr=Vi.payload,typeof Nr=="function"){Xt=Nr.call(Hi,Xt,vn);break e}Xt=Nr;break e;case 3:Nr.flags=Nr.flags&-65537|128;case 0:if(Nr=Vi.payload,vn=typeof Nr=="function"?Nr.call(Hi,Xt,vn):Nr,vn==null)break e;Xt=Zc({},Xt,vn);break e;case 2:He=!0}}vn=Ze.callback,vn!==null&&(g.flags|=64,Zn&&(g.flags|=8192),Zn=ne.callbacks,Zn===null?ne.callbacks=[vn]:Zn.push(vn))}else Zn={lane:vn,tag:Ze.tag,payload:Ze.payload,callback:Ze.callback,next:null},Kt===null?(Dt=Kt=Zn,St=Xt):Kt=Kt.next=Zn,Ne|=vn;if(Ze=Ze.next,Ze===null){if(Ze=ne.shared.pending,Ze===null)break;Zn=Ze,Ze=Zn.next,Zn.next=null,ne.lastBaseUpdate=Zn,ne.shared.pending=null}}while(!0);Kt===null&&(St=Xt),ne.baseState=St,ne.firstBaseUpdate=Dt,ne.lastBaseUpdate=Kt,le===null&&(ne.shared.lanes=0),E|=Ne,g.lanes=Ne,g.memoizedState=Xt}}function je(g,y){if(typeof g!="function")throw Error(i(191,g));g.call(y)}function _t(g,y){var k=g.callbacks;if(k!==null)for(g.callbacks=null,g=0;g<k.length;g++)je(k[g],y)}function Ot(g,y){g=Yd,p(kt,g),p(ft,y),Yd=g|y.baseLanes}function Lt(){p(kt,Yd),p(ft,ft.current)}function yt(){Yd=kt.current,d(ft),d(kt)}function an(g){var y=g.alternate;p(nn,nn.current&1),p(Wt,g),Yt===null&&(y===null||ft.current!==null||y.memoizedState!==null)&&(Yt=g)}function On(g){p(nn,nn.current),p(Wt,g),Yt===null&&(Yt=g)}function _n(g){g.tag===22?(p(nn,nn.current),p(Wt,g),Yt===null&&(Yt=g)):Pn()}function Pn(){p(nn,nn.current),p(Wt,Wt.current)}function er(g){d(Wt),Yt===g&&(Yt=null),d(nn)}function fr(g){for(var y=g;y!==null;){if(y.tag===13){var k=y.memoizedState;if(k!==null&&(k=k.dehydrated,k===null||Iy(k)||n0(k)))return y}else if(y.tag===19&&(y.memoizedProps.revealOrder==="forwards"||y.memoizedProps.revealOrder==="backwards"||y.memoizedProps.revealOrder==="unstable_legacy-backwards"||y.memoizedProps.revealOrder==="together")){if((y.flags&128)!==0)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===g)break;for(;y.sibling===null;){if(y.return===null||y.return===g)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}function Cn(){throw Error(i(321))}function yr(g,y){if(y===null)return!1;for(var k=0;k<y.length&&k<g.length;k++)if(!tc(g[k],y[k]))return!1;return!0}function Vr(g,y,k,j,ne,le){return Gn=le,pn=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,dr.H=g===null||g.memoizedState===null?wi:Ls,Rn=!1,le=k(j,ne),Rn=!1,nr&&(le=Lr(y,k,j,ne)),ms(g),le}function ms(g){dr.H=jn;var y=Nn!==null&&Nn.next!==null;if(Gn=0,Vt=Nn=pn=null,mn=!1,Er=0,si=null,y)throw Error(i(300));g===null||$i||(g=g.dependencies,g!==null&&xe(g)&&($i=!0))}function Lr(g,y,k,j){pn=g;var ne=0;do{if(nr&&(si=null),Er=0,nr=!1,25<=ne)throw Error(i(301));if(ne+=1,Vt=Nn=null,g.updateQueue!=null){var le=g.updateQueue;le.lastEffect=null,le.events=null,le.stores=null,le.memoCache!=null&&(le.memoCache.index=0)}dr.H=wa,le=y(k,j)}while(nr);return le}function Gr(){var g=dr.H,y=g.useState()[0];return y=typeof y.then=="function"?ho(y):y,g=g.useState()[0],(Nn!==null?Nn.memoizedState:null)!==g&&(pn.flags|=1024),y}function or(){var g=gr!==0;return gr=0,g}function br(g,y,k){y.updateQueue=g.updateQueue,y.flags&=-2053,g.lanes&=~k}function Un(g){if(mn){for(g=g.memoizedState;g!==null;){var y=g.queue;y!==null&&(y.pending=null),g=g.next}mn=!1}Gn=0,Vt=Nn=pn=null,nr=!1,Er=gr=0,si=null}function bi(){var g={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vt===null?pn.memoizedState=Vt=g:Vt=Vt.next=g,Vt}function ai(){if(Nn===null){var g=pn.alternate;g=g!==null?g.memoizedState:null}else g=Nn.next;var y=Vt===null?pn.memoizedState:Vt.next;if(y!==null)Vt=y,Nn=g;else{if(g===null)throw pn.alternate===null?Error(i(467)):Error(i(310));Nn=g,g={memoizedState:Nn.memoizedState,baseState:Nn.baseState,baseQueue:Nn.baseQueue,queue:Nn.queue,next:null},Vt===null?pn.memoizedState=Vt=g:Vt=Vt.next=g}return Vt}function Rs(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ho(g){var y=Er;return Er+=1,si===null&&(si=[]),g=rt(si,g,y),y=pn,(Vt===null?y.memoizedState:Vt.next)===null&&(y=y.alternate,dr.H=y===null||y.memoizedState===null?wi:Ls),g}function Mi(g){if(g!==null&&typeof g=="object"){if(typeof g.then=="function")return ho(g);if(g.$$typeof===Zs)return ze(g)}throw Error(i(438,String(g)))}function Mn(g){var y=null,k=pn.updateQueue;if(k!==null&&(y=k.memoCache),y==null){var j=pn.alternate;j!==null&&(j=j.updateQueue,j!==null&&(j=j.memoCache,j!=null&&(y={data:j.data.map(function(ne){return ne.slice()}),index:0})))}if(y==null&&(y={data:[],index:0}),k===null&&(k=Rs(),pn.updateQueue=k),k.memoCache=y,k=y.data[y.index],k===void 0)for(k=y.data[y.index]=Array(g),j=0;j<g;j++)k[j]=Ld;return y.index++,k}function Li(g,y){return typeof y=="function"?y(g):y}function Kn(g){var y=ai();return gs(y,Nn,g)}function gs(g,y,k){var j=g.queue;if(j===null)throw Error(i(311));j.lastRenderedReducer=k;var ne=g.baseQueue,le=j.pending;if(le!==null){if(ne!==null){var Ne=ne.next;ne.next=le.next,le.next=Ne}y.baseQueue=ne=le,j.pending=null}if(le=g.baseState,ne===null)g.memoizedState=le;else{y=ne.next;var Ze=Ne=null,St=null,Dt=y,Kt=!1;do{var Xt=Dt.lane&-536870913;if(Xt!==Dt.lane?(Ei&Xt)===Xt:(Gn&Xt)===Xt){var vn=Dt.revertLane;if(vn===0)St!==null&&(St=St.next={lane:0,revertLane:0,gesture:null,action:Dt.action,hasEagerState:Dt.hasEagerState,eagerState:Dt.eagerState,next:null}),Xt===eh&&(Kt=!0);else if((Gn&vn)===vn){Dt=Dt.next,vn===eh&&(Kt=!0);continue}else Xt={lane:0,revertLane:Dt.revertLane,gesture:null,action:Dt.action,hasEagerState:Dt.hasEagerState,eagerState:Dt.eagerState,next:null},St===null?(Ze=St=Xt,Ne=le):St=St.next=Xt,pn.lanes|=vn,E|=vn;Xt=Dt.action,Rn&&k(le,Xt),le=Dt.hasEagerState?Dt.eagerState:k(le,Xt)}else vn={lane:Xt,revertLane:Dt.revertLane,gesture:Dt.gesture,action:Dt.action,hasEagerState:Dt.hasEagerState,eagerState:Dt.eagerState,next:null},St===null?(Ze=St=vn,Ne=le):St=St.next=vn,pn.lanes|=Xt,E|=Xt;Dt=Dt.next}while(Dt!==null&&Dt!==y);if(St===null?Ne=le:St.next=Ze,!tc(le,g.memoizedState)&&($i=!0,Kt&&(k=Ts,k!==null)))throw k;g.memoizedState=le,g.baseState=Ne,g.baseQueue=St,j.lastRenderedState=le}return ne===null&&(j.lanes=0),[g.memoizedState,j.dispatch]}function pl(g){var y=ai(),k=y.queue;if(k===null)throw Error(i(311));k.lastRenderedReducer=g;var j=k.dispatch,ne=k.pending,le=y.memoizedState;if(ne!==null){k.pending=null;var Ne=ne=ne.next;do le=g(le,Ne.action),Ne=Ne.next;while(Ne!==ne);tc(le,y.memoizedState)||($i=!0),y.memoizedState=le,y.baseQueue===null&&(y.baseState=le),k.lastRenderedState=le}return[le,j]}function _s(g,y,k){var j=pn,ne=ai(),le=_i;if(le){if(k===void 0)throw Error(i(407));k=k()}else k=y();var Ne=!tc((Nn||ne).memoizedState,k);if(Ne&&(ne.memoizedState=k,$i=!0),ne=ne.queue,xg(v_.bind(null,j,ne,g),[g]),ne.getSnapshot!==y||Ne||Vt!==null&&Vt.memoizedState.tag&1){if(j.flags|=2048,wf(9,{destroy:void 0},Sg.bind(null,j,ne,k,y),null),ws===null)throw Error(i(349));le||(Gn&127)!==0||Gc(j,y,k)}return k}function Gc(g,y,k){g.flags|=16384,g={getSnapshot:y,value:k},y=pn.updateQueue,y===null?(y=Rs(),pn.updateQueue=y,y.stores=[g]):(k=y.stores,k===null?y.stores=[g]:k.push(g))}function Sg(g,y,k,j){y.value=k,y.getSnapshot=j,y_(y)&&b_(g)}function v_(g,y,k){return k(function(){y_(y)&&b_(g)})}function y_(g){var y=g.getSnapshot;g=g.value;try{var k=y();return!tc(g,k)}catch{return!0}}function b_(g){var y=An(g,2);y!==null&&Xa(y,g,2)}function Pp(g){var y=bi();if(typeof g=="function"){var k=g;if(g=k(),Rn){L(!0);try{k()}finally{L(!1)}}}return y.memoizedState=y.baseState=g,y.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Li,lastRenderedState:g},y}function ba(g,y,k,j){return g.baseState=k,gs(g,Nn,typeof j=="function"?j:Li)}function V1(g,y,k,j,ne){if(_l(g))throw Error(i(485));if(g=y.action,g!==null){var le={payload:ne,action:g,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Ne){le.listeners.push(Ne)}};dr.T!==null?k(!0):le.isTransition=!1,j(le),k=y.pending,k===null?(le.next=y.pending=le,Wc(y,le)):(le.next=k.next,y.pending=k.next=le)}}function Wc(g,y){var k=y.action,j=y.payload,ne=g.state;if(y.isTransition){var le=dr.T,Ne={};dr.T=Ne;try{var Ze=k(ne,j),St=dr.S;St!==null&&St(Ne,Ze),uy(g,y,Ze)}catch(Dt){ml(g,y,Dt)}finally{le!==null&&Ne.types!==null&&(le.types=Ne.types),dr.T=le}}else try{le=k(ne,j),uy(g,y,le)}catch(Dt){ml(g,y,Dt)}}function uy(g,y,k){k!==null&&typeof k=="object"&&typeof k.then=="function"?k.then(function(j){S_(g,y,j)},function(j){return ml(g,y,j)}):S_(g,y,k)}function S_(g,y,k){y.status="fulfilled",y.value=k,Dp(y),g.state=k,y=g.pending,y!==null&&(k=y.next,k===y?g.pending=null:(k=k.next,y.next=k,Wc(g,k)))}function ml(g,y,k){var j=g.pending;if(g.pending=null,j!==null){j=j.next;do y.status="rejected",y.reason=k,Dp(y),y=y.next;while(y!==j)}g.action=null}function Dp(g){g=g.listeners;for(var y=0;y<g.length;y++)(0,g[y])()}function Eg(g,y){return y}function Ss(g,y){if(_i){var k=ws.formState;if(k!==null){e:{var j=pn;if(_i){if(li){var ne=ST(li,tl);if(ne){li=rm(ne),j=Y_(ne);break e}}Pe(j)}j=!1}j&&(y=k[0])}}k=bi(),k.memoizedState=k.baseState=y,j={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Eg,lastRenderedState:y},k.queue=j,k=Xl.bind(null,pn,j),j.dispatch=k,j=Pp(!1);var le=$s.bind(null,pn,!1,j.queue);return j=bi(),ne={state:y,dispatch:null,action:g,pending:null},j.queue=ne,k=V1.bind(null,pn,ne,le,k),ne.dispatch=k,j.memoizedState=g,[y,k,!1]}function bc(g){var y=ai();return Tf(y,Nn,g)}function Tf(g,y,k){if(y=gs(g,y,Eg)[0],g=Kn(Li)[0],typeof y=="object"&&y!==null&&typeof y.then=="function")try{var j=ho(y)}catch(Ne){throw Ne===kc?$f:Ne}else j=y;y=ai();var ne=y.queue,le=ne.dispatch;return k!==y.memoizedState&&(pn.flags|=2048,wf(9,{destroy:void 0},Sc.bind(null,ne,k),null)),[j,le,g]}function Sc(g,y){g.action=y}function qc(g){var y=ai(),k=Nn;if(k!==null)return Tf(y,k,g);ai(),y=y.memoizedState,k=ai();var j=k.queue.dispatch;return k.memoizedState=g,[y,j,!1]}function wf(g,y,k,j){return g={tag:g,create:k,deps:j,inst:y,next:null},y=pn.updateQueue,y===null&&(y=Rs(),pn.updateQueue=y),k=y.lastEffect,k===null?y.lastEffect=g.next=g:(j=k.next,k.next=g,g.next=j,y.lastEffect=g),g}function Ou(){return ai().memoizedState}function Lh(g,y,k,j){var ne=bi();pn.flags|=g,ne.memoizedState=wf(1|y,{destroy:void 0},k,j===void 0?null:j)}function Ec(g,y,k,j){var ne=ai();j=j===void 0?null:j;var le=ne.memoizedState.inst;Nn!==null&&j!==null&&yr(j,Nn.memoizedState.deps)?ne.memoizedState=wf(y,le,k,j):(pn.flags|=g,ne.memoizedState=wf(1|y,le,k,j))}function hr(g,y){Lh(8390656,8,g,y)}function xg(g,y){Ec(2048,8,g,y)}function hy(g){pn.flags|=4;var y=pn.updateQueue;if(y===null)y=Rs(),pn.updateQueue=y,y.events=[g];else{var k=y.events;k===null?y.events=[g]:k.push(g)}}function E_(g){var y=ai().memoizedState;return hy({ref:y,nextImpl:g}),function(){if((Yr&2)!==0)throw Error(i(440));return y.impl.apply(void 0,arguments)}}function Uh(g,y){return Ec(4,2,g,y)}function x_(g,y){return Ec(4,4,g,y)}function Tg(g,y){if(typeof y=="function"){g=g();var k=y(g);return function(){typeof k=="function"?k():y(null)}}if(y!=null)return g=g(),y.current=g,function(){y.current=null}}function Da(g,y,k){k=k!=null?k.concat([g]):null,Ec(4,4,Tg.bind(null,y,g),k)}function wg(){}function xc(g,y){var k=ai();y=y===void 0?null:y;var j=k.memoizedState;return y!==null&&yr(y,j[1])?j[0]:(k.memoizedState=[g,y],g)}function T_(g,y){var k=ai();y=y===void 0?null:y;var j=k.memoizedState;if(y!==null&&yr(y,j[1]))return j[0];if(j=g(),Rn){L(!0);try{g()}finally{L(!1)}}return k.memoizedState=[j,y],j}function Nu(g,y,k){return k===void 0||(Gn&1073741824)!==0&&(Ei&261930)===0?g.memoizedState=y:(g.memoizedState=k,g=N_(),pn.lanes|=g,E|=g,k)}function fo(g,y,k,j){return tc(k,y)?k:ft.current!==null?(g=Nu(g,k,j),tc(g,y)||($i=!0),g):(Gn&42)===0||(Gn&1073741824)!==0&&(Ei&261930)===0?($i=!0,g.memoizedState=k):(g=N_(),pn.lanes|=g,E|=g,y)}function fy(g,y,k,j,ne){var le=sa();go(le!==0&&8>le?le:8);var Ne=dr.T,Ze={};dr.T=Ze,$s(g,!1,y,k);try{var St=ne(),Dt=dr.S;if(Dt!==null&&Dt(Ze,St),St!==null&&typeof St=="object"&&typeof St.then=="function"){var Kt=Ve(St,j);Po(g,y,Kt,Xi(g))}else Po(g,y,j,Xi(g))}catch(Xt){Po(g,y,{then:function(){},status:"rejected",reason:Xt},Xi())}finally{go(le),Ne!==null&&Ze.types!==null&&(Ne.types=Ze.types),dr.T=Ne}}function w_(g){var y=g.memoizedState;if(y!==null)return y;y={memoizedState:xl,baseState:xl,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Li,lastRenderedState:xl},next:null};var k={};return y.next={memoizedState:k,baseState:k,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Li,lastRenderedState:k},next:null},g.memoizedState=y,g=g.alternate,g!==null&&(g.memoizedState=y),y}function gl(){return ze(qh)}function ks(){return ai().memoizedState}function Qo(){return ai().memoizedState}function dy(g){for(var y=g.return;y!==null;){switch(y.tag){case 24:case 3:var k=Xi();g=ti(k);var j=ji(y,g,k);j!==null&&(Xa(j,y,k),ss(j,y,k)),y={cache:et()},g.payload=y;return}y=y.return}}function H1(g,y,k){var j=Xi();k={lane:j,revertLane:0,gesture:null,action:k,hasEagerState:!1,eagerState:null,next:null},_l(g)?Sa(y,k):(k=qt(g,y,k,j),k!==null&&(Xa(k,g,j),xn(k,y,j)))}function Xl(g,y,k){var j=Xi();Po(g,y,k,j)}function Po(g,y,k,j){var ne={lane:j,revertLane:0,gesture:null,action:k,hasEagerState:!1,eagerState:null,next:null};if(_l(g))Sa(y,ne);else{var le=g.alternate;if(g.lanes===0&&(le===null||le.lanes===0)&&(le=y.lastRenderedReducer,le!==null))try{var Ne=y.lastRenderedState,Ze=le(Ne,k);if(ne.hasEagerState=!0,ne.eagerState=Ze,tc(Ze,Ne))return wn(g,y,ne,0),ws===null&&Zt(),!1}catch{}if(k=qt(g,y,ne,j),k!==null)return Xa(k,g,j),xn(k,y,j),!0}return!1}function $s(g,y,k,j){if(j={lane:2,revertLane:_e(),gesture:null,action:j,hasEagerState:!1,eagerState:null,next:null},_l(g)){if(y)throw Error(i(479))}else y=qt(g,k,j,2),y!==null&&Xa(y,g,2)}function _l(g){var y=g.alternate;return g===pn||y!==null&&y===pn}function Sa(g,y){nr=mn=!0;var k=g.pending;k===null?y.next=y:(y.next=k.next,k.next=y),g.pending=y}function xn(g,y,k){if((k&4194048)!==0){var j=y.lanes;j&=g.pendingLanes,k|=j,y.lanes=k,U(g,k)}}function py(g,y,k,j){y=g.memoizedState,k=k(j,y),k=k==null?y:Zc({},y,k),g.memoizedState=k,g.lanes===0&&(g.updateQueue.baseState=k)}function Ag(g,y,k,j,ne,le,Ne){return g=g.stateNode,typeof g.shouldComponentUpdate=="function"?g.shouldComponentUpdate(j,le,Ne):y.prototype&&y.prototype.isPureReactComponent?!Be(k,j)||!Be(ne,le):!0}function Bt(g,y,k,j){g=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(k,j),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(k,j),y.state!==g&&cs.enqueueReplaceState(y,y.state,null)}function en(g,y){var k=y;if("ref"in y){k={};for(var j in y)j!=="ref"&&(k[j]=y[j])}if(g=g.defaultProps){k===y&&(k=Zc({},k));for(var ne in g)k[ne]===void 0&&(k[ne]=g[ne])}return k}function sn(g,y){try{var k=g.onUncaughtError;k(y.value,{componentStack:y.stack})}catch(j){setTimeout(function(){throw j})}}function $n(g,y,k){try{var j=g.onCaughtError;j(k.value,{componentStack:k.stack,errorBoundary:y.tag===1?y.stateNode:null})}catch(ne){setTimeout(function(){throw ne})}}function kr(g,y,k){return k=ti(k),k.tag=3,k.payload={element:null},k.callback=function(){sn(g,y)},k}function Si(g){return g=ti(g),g.tag=3,g}function po(g,y,k,j){var ne=k.type.getDerivedStateFromError;if(typeof ne=="function"){var le=j.value;g.payload=function(){return ne(le)},g.callback=function(){$n(y,k,j)}}var Ne=k.stateNode;Ne!==null&&typeof Ne.componentDidCatch=="function"&&(g.callback=function(){$n(y,k,j),typeof ne!="function"&&(nt===null?nt=new Set([this]):nt.add(this));var Ze=j.stack;this.componentDidCatch(j.value,{componentStack:Ze!==null?Ze:""})})}function Zl(g,y,k,j,ne){if(k.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){if(y=k.alternate,y!==null&&ve(y,k,ne,!0),k=Wt.current,k!==null){switch(k.tag){case 31:case 13:return Yt===null?$g():k.alternate===null&&M===0&&(M=3),k.flags&=-257,k.flags|=65536,k.lanes=ne,j===ef?k.flags|=16384:(y=k.updateQueue,y===null?k.updateQueue=new Set([j]):y.add(j),Kr(g,j,ne)),!1;case 22:return k.flags|=65536,j===ef?k.flags|=16384:(y=k.updateQueue,y===null?(y={transitions:null,markerInstances:null,retryQueue:new Set([j])},k.updateQueue=y):(k=y.retryQueue,k===null?y.retryQueue=new Set([j]):k.add(j)),Kr(g,j,ne)),!1}throw Error(i(435,k.tag))}return Kr(g,j,ne),$g(),!1}if(_i)return y=Wt.current,y!==null?((y.flags&65536)===0&&(y.flags|=256),y.flags|=65536,y.lanes=ne,j!==zf&&(g=Error(i(422),{cause:j}),Le(J(g,k)))):(j!==zf&&(y=Error(i(423),{cause:j}),Le(J(y,k))),g=g.current.alternate,g.flags|=65536,ne&=-ne,g.lanes|=ne,j=J(j,k),ne=kr(g.stateNode,j,ne),Yi(g,ne),M!==4&&(M=2)),!1;var le=Error(i(520),{cause:j});if(le=J(le,k),K===null?K=[le]:K.push(le),M!==4&&(M=2),y===null)return!0;j=J(j,k),k=y;do{switch(k.tag){case 3:return k.flags|=65536,g=ne&-ne,k.lanes|=g,g=kr(k.stateNode,j,g),Yi(k,g),!1;case 1:if(y=k.type,le=k.stateNode,(k.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||le!==null&&typeof le.componentDidCatch=="function"&&(nt===null||!nt.has(le))))return k.flags|=65536,ne&=-ne,k.lanes|=ne,ne=Si(ne),po(ne,g,k,j),Yi(k,ne),!1}k=k.return}while(k!==null);return!1}function Wr(g,y,k,j){y.child=g===null?D(y,null,k,j):x(y,g.child,k,j)}function A_(g,y,k,j,ne){k=k.render;var le=y.ref;if("ref"in j){var Ne={};for(var Ze in j)Ze!=="ref"&&(Ne[Ze]=j[Ze])}else Ne=j;return pe(y),j=Vr(g,y,k,Ne,le,ne),Ze=or(),g!==null&&!$i?(br(g,y,ne),Pu(g,y,ne)):(_i&&Ze&&q(y),y.flags|=1,Wr(g,y,j,ne),y.child)}function G1(g,y,k,j,ne){if(g===null){var le=k.type;return typeof le=="function"&&!Za(le)&&le.defaultProps===void 0&&k.compare===null?(y.tag=15,y.type=le,Yc(g,y,le,j,ne)):(g=Ja(k.type,null,j,y,y.mode,ne),g.ref=y.ref,g.return=y,y.child=g)}if(le=g.child,!wd(g,ne)){var Ne=le.memoizedProps;if(k=k.compare,k=k!==null?k:Be,k(Ne,j)&&g.ref===y.ref)return Pu(g,y,ne)}return y.flags|=1,g=Ns(le,j),g.ref=y.ref,g.return=y,y.child=g}function Yc(g,y,k,j,ne){if(g!==null){var le=g.memoizedProps;if(Be(le,j)&&g.ref===y.ref)if($i=!1,y.pendingProps=j=le,wd(g,ne))(g.flags&131072)!==0&&($i=!0);else return y.lanes=g.lanes,Pu(g,y,ne)}return C_(g,y,k,j,ne)}function Cg(g,y,k,j){var ne=j.children,le=g!==null?g.memoizedState:null;if(g===null&&y.stateNode===null&&(y.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),j.mode==="hidden"){if((y.flags&128)!==0){if(le=le!==null?le.baseLanes|k:k,g!==null){for(j=y.child=g.child,ne=0;j!==null;)ne=ne|j.lanes|j.childLanes,j=j.sibling;j=ne&~le}else j=0,y.child=null;return Ed(g,y,le,k,j)}if((k&536870912)!==0)y.memoizedState={baseLanes:0,cachePool:null},g!==null&&Ge(y,le!==null?le.cachePool:null),le!==null?Ot(y,le):Lt(),_n(y);else return j=y.lanes=536870912,Ed(g,y,le!==null?le.baseLanes|k:k,k,j)}else le!==null?(Ge(y,le.cachePool),Ot(y,le),Pn(),y.memoizedState=null):(g!==null&&Ge(y,null),Lt(),Pn());return Wr(g,y,ne,k),y.child}function Rg(g,y){return g!==null&&g.tag===22||y.stateNode!==null||(y.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),y.sibling}function Ed(g,y,k,j,ne){var le=Fe();return le=le===null?null:{parent:Ba?Ps._currentValue:Ps._currentValue2,pool:le},y.memoizedState={baseLanes:k,cachePool:le},g!==null&&Ge(y,null),Lt(),_n(y),g!==null&&ve(g,y,j,!0),y.childLanes=ne,null}function xd(g,y){return y=zi({mode:y.mode,children:y.children},g.mode),y.ref=g.ref,g.child=y,y.return=g,y}function kg(g,y,k){return x(y,g.child,null,k),g=xd(y,y.pendingProps),g.flags|=2,er(y),y.memoizedState=null,g}function Ki(g,y,k){var j=y.pendingProps,ne=(y.flags&128)!==0;if(y.flags&=-129,g===null){if(_i){if(j.mode==="hidden")return g=xd(y,j),y.lanes=536870912,Rg(null,g);if(On(y),(g=li)?(g=r0(g,tl),g!==null&&(y.memoizedState={dehydrated:g,treeContext:Rc!==null?{id:Ju,overflow:nu}:null,retryLane:536870912,hydrationErrors:null},k=na(g),k.return=y,y.child=k,jo=y,li=null)):g=null,g===null)throw Pe(y);return y.lanes=536870912,null}return xd(y,j)}var le=g.memoizedState;if(le!==null){var Ne=le.dehydrated;if(On(y),ne)if(y.flags&256)y.flags&=-257,y=kg(g,y,k);else if(y.memoizedState!==null)y.child=g.child,y.flags|=128,y=null;else throw Error(i(558));else if($i||ve(g,y,k,!1),ne=(k&g.childLanes)!==0,$i||ne){if(j=ws,j!==null&&(Ne=B(j,k),Ne!==0&&Ne!==le.retryLane))throw le.retryLane=Ne,An(g,Ne),Xa(j,g,Ne),zo;$g(),y=kg(g,y,k)}else g=le.treeContext,gi&&(li=Kh(Ne),jo=y,_i=!0,ru=null,tl=!1,g!==null&&te(y,g)),y=xd(y,j),y.flags|=4096;return y}return g=Ns(g.child,{mode:j.mode,children:j.children}),g.ref=y.ref,y.child=g,g.return=y,g}function Mg(g,y){var k=y.ref;if(k===null)g!==null&&g.ref!==null&&(y.flags|=4194816);else{if(typeof k!="function"&&typeof k!="object")throw Error(i(284));(g===null||g.ref!==k)&&(y.flags|=4194816)}}function C_(g,y,k,j,ne){return pe(y),k=Vr(g,y,k,j,void 0,ne),j=or(),g!==null&&!$i?(br(g,y,ne),Pu(g,y,ne)):(_i&&j&&q(y),y.flags|=1,Wr(g,y,k,ne),y.child)}function Ig(g,y,k,j,ne,le){return pe(y),y.updateQueue=null,k=Lr(y,j,k,ne),ms(g),j=or(),g!==null&&!$i?(br(g,y,le),Pu(g,y,le)):(_i&&j&&q(y),y.flags|=1,Wr(g,y,k,le),y.child)}function W1(g,y,k,j,ne){if(pe(y),y.stateNode===null){var le=Zh,Ne=k.contextType;typeof Ne=="object"&&Ne!==null&&(le=ze(Ne)),le=new k(j,le),y.memoizedState=le.state!==null&&le.state!==void 0?le.state:null,le.updater=cs,y.stateNode=le,le._reactInternals=y,le=y.stateNode,le.props=j,le.state=y.memoizedState,le.refs={},is(y),Ne=k.contextType,le.context=typeof Ne=="object"&&Ne!==null?ze(Ne):Zh,le.state=y.memoizedState,Ne=k.getDerivedStateFromProps,typeof Ne=="function"&&(py(y,k,Ne,j),le.state=y.memoizedState),typeof k.getDerivedStateFromProps=="function"||typeof le.getSnapshotBeforeUpdate=="function"||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(Ne=le.state,typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount(),Ne!==le.state&&cs.enqueueReplaceState(le,le.state,null),as(y,j,le,ne),os(),le.state=y.memoizedState),typeof le.componentDidMount=="function"&&(y.flags|=4194308),j=!0}else if(g===null){le=y.stateNode;var Ze=y.memoizedProps,St=en(k,Ze);le.props=St;var Dt=le.context,Kt=k.contextType;Ne=Zh,typeof Kt=="object"&&Kt!==null&&(Ne=ze(Kt));var Xt=k.getDerivedStateFromProps;Kt=typeof Xt=="function"||typeof le.getSnapshotBeforeUpdate=="function",Ze=y.pendingProps!==Ze,Kt||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ze||Dt!==Ne)&&Bt(y,le,j,Ne),He=!1;var vn=y.memoizedState;le.state=vn,as(y,j,le,ne),os(),Dt=y.memoizedState,Ze||vn!==Dt||He?(typeof Xt=="function"&&(py(y,k,Xt,j),Dt=y.memoizedState),(St=He||Ag(y,k,St,j,vn,Dt,Ne))?(Kt||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount()),typeof le.componentDidMount=="function"&&(y.flags|=4194308)):(typeof le.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=j,y.memoizedState=Dt),le.props=j,le.state=Dt,le.context=Ne,j=St):(typeof le.componentDidMount=="function"&&(y.flags|=4194308),j=!1)}else{le=y.stateNode,hi(g,y),Ne=y.memoizedProps,Kt=en(k,Ne),le.props=Kt,Xt=y.pendingProps,vn=le.context,Dt=k.contextType,St=Zh,typeof Dt=="object"&&Dt!==null&&(St=ze(Dt)),Ze=k.getDerivedStateFromProps,(Dt=typeof Ze=="function"||typeof le.getSnapshotBeforeUpdate=="function")||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ne!==Xt||vn!==St)&&Bt(y,le,j,St),He=!1,vn=y.memoizedState,le.state=vn,as(y,j,le,ne),os();var Zn=y.memoizedState;Ne!==Xt||vn!==Zn||He||g!==null&&g.dependencies!==null&&xe(g.dependencies)?(typeof Ze=="function"&&(py(y,k,Ze,j),Zn=y.memoizedState),(Kt=He||Ag(y,k,Kt,j,vn,Zn,St)||g!==null&&g.dependencies!==null&&xe(g.dependencies))?(Dt||typeof le.UNSAFE_componentWillUpdate!="function"&&typeof le.componentWillUpdate!="function"||(typeof le.componentWillUpdate=="function"&&le.componentWillUpdate(j,Zn,St),typeof le.UNSAFE_componentWillUpdate=="function"&&le.UNSAFE_componentWillUpdate(j,Zn,St)),typeof le.componentDidUpdate=="function"&&(y.flags|=4),typeof le.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof le.componentDidUpdate!="function"||Ne===g.memoizedProps&&vn===g.memoizedState||(y.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ne===g.memoizedProps&&vn===g.memoizedState||(y.flags|=1024),y.memoizedProps=j,y.memoizedState=Zn),le.props=j,le.state=Zn,le.context=St,j=Kt):(typeof le.componentDidUpdate!="function"||Ne===g.memoizedProps&&vn===g.memoizedState||(y.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ne===g.memoizedProps&&vn===g.memoizedState||(y.flags|=1024),j=!1)}return le=j,Mg(g,y),j=(y.flags&128)!==0,le||j?(le=y.stateNode,k=j&&typeof k.getDerivedStateFromError!="function"?null:le.render(),y.flags|=1,g!==null&&j?(y.child=x(y,g.child,null,ne),y.child=x(y,null,k,ne)):Wr(g,y,k,ne),y.memoizedState=le.state,g=y.child):g=Pu(g,y,ne),g}function vl(g,y,k,j){return vt(),y.flags|=256,Wr(g,y,k,j),y.child}function Lp(g){return{baseLanes:g,cachePool:at()}}function yl(g,y,k){return g=g!==null?g.childLanes&~k:0,y&&(g|=F),g}function Ms(g,y,k){var j=y.pendingProps,ne=!1,le=(y.flags&128)!==0,Ne;if((Ne=le)||(Ne=g!==null&&g.memoizedState===null?!1:(nn.current&2)!==0),Ne&&(ne=!0,y.flags&=-129),Ne=(y.flags&32)!==0,y.flags&=-33,g===null){if(_i){if(ne?an(y):Pn(),(g=li)?(g=hS(g,tl),g!==null&&(y.memoizedState={dehydrated:g,treeContext:Rc!==null?{id:Ju,overflow:nu}:null,retryLane:536870912,hydrationErrors:null},k=na(g),k.return=y,y.child=k,jo=y,li=null)):g=null,g===null)throw Pe(y);return n0(g)?y.lanes=32:y.lanes=536870912,null}var Ze=j.children;return j=j.fallback,ne?(Pn(),ne=y.mode,Ze=zi({mode:"hidden",children:Ze},ne),j=Gh(j,ne,k,null),Ze.return=y,j.return=y,Ze.sibling=j,y.child=Ze,j=y.child,j.memoizedState=Lp(k),j.childLanes=yl(g,Ne,k),y.memoizedState=nh,Rg(null,j)):(an(y),Up(y,Ze))}var St=g.memoizedState;if(St!==null&&(Ze=St.dehydrated,Ze!==null)){if(le)y.flags&256?(an(y),y.flags&=-257,y=Bp(g,y,k)):y.memoizedState!==null?(Pn(),y.child=g.child,y.flags|=128,y=null):(Pn(),Ze=j.fallback,ne=y.mode,j=zi({mode:"visible",children:j.children},ne),Ze=Gh(Ze,ne,k,null),Ze.flags|=2,j.return=y,Ze.return=y,j.sibling=Ze,y.child=j,x(y,g.child,null,k),j=y.child,j.memoizedState=Lp(k),j.childLanes=yl(g,Ne,k),y.memoizedState=nh,y=Rg(null,j));else if(an(y),n0(Ze))Ne=uS(Ze).digest,j=Error(i(419)),j.stack="",j.digest=Ne,Le({value:j,source:null,stack:null}),y=Bp(g,y,k);else if($i||ve(g,y,k,!1),Ne=(k&g.childLanes)!==0,$i||Ne){if(Ne=ws,Ne!==null&&(j=B(Ne,k),j!==0&&j!==St.retryLane))throw St.retryLane=j,An(g,j),Xa(Ne,g,j),zo;Iy(Ze)||$g(),y=Bp(g,y,k)}else Iy(Ze)?(y.flags|=192,y.child=g.child,y=null):(g=St.treeContext,gi&&(li=Bf(Ze),jo=y,_i=!0,ru=null,tl=!1,g!==null&&te(y,g)),y=Up(y,j.children),y.flags|=4096);return y}return ne?(Pn(),Ze=j.fallback,ne=y.mode,St=g.child,le=St.sibling,j=Ns(St,{mode:"hidden",children:j.children}),j.subtreeFlags=St.subtreeFlags&65011712,le!==null?Ze=Ns(le,Ze):(Ze=Gh(Ze,ne,k,null),Ze.flags|=2),Ze.return=y,j.return=y,j.sibling=Ze,y.child=j,Rg(null,j),j=y.child,Ze=g.child.memoizedState,Ze===null?Ze=Lp(k):(ne=Ze.cachePool,ne!==null?(St=Ba?Ps._currentValue:Ps._currentValue2,ne=ne.parent!==St?{parent:St,pool:St}:ne):ne=at(),Ze={baseLanes:Ze.baseLanes|k,cachePool:ne}),j.memoizedState=Ze,j.childLanes=yl(g,Ne,k),y.memoizedState=nh,Rg(g.child,j)):(an(y),k=g.child,g=k.sibling,k=Ns(k,{mode:"visible",children:j.children}),k.return=y,k.sibling=null,g!==null&&(Ne=y.deletions,Ne===null?(y.deletions=[g],y.flags|=16):Ne.push(g)),y.child=k,y.memoizedState=null,k)}function Up(g,y){return y=zi({mode:"visible",children:y},g.mode),y.return=g,g.child=y}function zi(g,y){return g=t(22,g,null,y),g.lanes=0,g}function Bp(g,y,k){return x(y,g.child,null,k),g=Up(y,y.pendingProps.children),g.flags|=2,y.memoizedState=null,g}function Og(g,y,k){g.lanes|=y;var j=g.alternate;j!==null&&(j.lanes|=y),Oe(g.return,y,k)}function Fp(g,y,k,j,ne,le){var Ne=g.memoizedState;Ne===null?g.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:j,tail:k,tailMode:ne,treeForkCount:le}:(Ne.isBackwards=y,Ne.rendering=null,Ne.renderingStartTime=0,Ne.last=j,Ne.tail=k,Ne.tailMode=ne,Ne.treeForkCount=le)}function Td(g,y,k){var j=y.pendingProps,ne=j.revealOrder,le=j.tail;j=j.children;var Ne=nn.current,Ze=(Ne&2)!==0;if(Ze?(Ne=Ne&1|2,y.flags|=128):Ne&=1,p(nn,Ne),Wr(g,y,j,k),j=_i?$d:0,!Ze&&g!==null&&(g.flags&128)!==0)e:for(g=y.child;g!==null;){if(g.tag===13)g.memoizedState!==null&&Og(g,k,y);else if(g.tag===19)Og(g,k,y);else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===y)break e;for(;g.sibling===null;){if(g.return===null||g.return===y)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}switch(ne){case"forwards":for(k=y.child,ne=null;k!==null;)g=k.alternate,g!==null&&fr(g)===null&&(ne=k),k=k.sibling;k=ne,k===null?(ne=y.child,y.child=null):(ne=k.sibling,k.sibling=null),Fp(y,!1,ne,k,le,j);break;case"backwards":case"unstable_legacy-backwards":for(k=null,ne=y.child,y.child=null;ne!==null;){if(g=ne.alternate,g!==null&&fr(g)===null){y.child=ne;break}g=ne.sibling,ne.sibling=k,k=ne,ne=g}Fp(y,!0,k,null,le,j);break;case"together":Fp(y,!1,null,null,void 0,j);break;default:y.memoizedState=null}return y.child}function Pu(g,y,k){if(g!==null&&(y.dependencies=g.dependencies),E|=y.lanes,(k&y.childLanes)===0)if(g!==null){if(ve(g,y,k,!1),(k&y.childLanes)===0)return null}else return null;if(g!==null&&y.child!==g.child)throw Error(i(153));if(y.child!==null){for(g=y.child,k=Ns(g,g.pendingProps),y.child=k,k.return=y;g.sibling!==null;)g=g.sibling,k=k.sibling=Ns(g,g.pendingProps),k.return=y;k.sibling=null}return y.child}function wd(g,y){return(g.lanes&y)!==0?!0:(g=g.dependencies,!!(g!==null&&xe(g)))}function Af(g,y,k){switch(y.tag){case 3:ie(y,y.stateNode.containerInfo),$e(y,Ps,g.memoizedState.cache),vt();break;case 27:case 5:Re(y);break;case 4:ie(y,y.stateNode.containerInfo);break;case 10:$e(y,y.type,y.memoizedProps.value);break;case 31:if(y.memoizedState!==null)return y.flags|=128,On(y),null;break;case 13:var j=y.memoizedState;if(j!==null)return j.dehydrated!==null?(an(y),y.flags|=128,null):(k&y.child.childLanes)!==0?Ms(g,y,k):(an(y),g=Pu(g,y,k),g!==null?g.sibling:null);an(y);break;case 19:var ne=(g.flags&128)!==0;if(j=(k&y.childLanes)!==0,j||(ve(g,y,k,!1),j=(k&y.childLanes)!==0),ne){if(j)return Td(g,y,k);y.flags|=128}if(ne=y.memoizedState,ne!==null&&(ne.rendering=null,ne.tail=null,ne.lastEffect=null),p(nn,nn.current),j)break;return null;case 22:return y.lanes=0,Cg(g,y,k,y.pendingProps);case 24:$e(y,Ps,g.memoizedState.cache)}return Pu(g,y,k)}function Jl(g,y,k){if(g!==null)if(g.memoizedProps!==y.pendingProps)$i=!0;else{if(!wd(g,k)&&(y.flags&128)===0)return $i=!1,Af(g,y,k);$i=(g.flags&131072)!==0}else $i=!1,_i&&(y.flags&1048576)!==0&&z(y,$d,y.index);switch(y.lanes=0,y.tag){case 16:e:{var j=y.pendingProps;if(g=xt(y.elementType),y.type=g,typeof g=="function")Za(g)?(j=en(g,j),y.tag=1,y=W1(null,y,g,j,k)):(y.tag=0,y=C_(null,y,g,j,k));else{if(g!=null){var ne=g.$$typeof;if(ne===Ac){y.tag=11,y=A_(null,y,g,j,k);break e}else if(ne===Xp){y.tag=14,y=G1(null,y,g,j,k);break e}}throw y=h(g)||g,Error(i(306,y,""))}}return y;case 0:return C_(g,y,y.type,y.pendingProps,k);case 1:return j=y.type,ne=en(j,y.pendingProps),W1(g,y,j,ne,k);case 3:e:{if(ie(y,y.stateNode.containerInfo),g===null)throw Error(i(387));var le=y.pendingProps;ne=y.memoizedState,j=ne.element,hi(g,y),as(y,le,null,k);var Ne=y.memoizedState;if(le=Ne.cache,$e(y,Ps,le),le!==ne.cache&&ae(y,[Ps],k,!0),os(),le=Ne.element,gi&&ne.isDehydrated)if(ne={element:le,isDehydrated:!1,cache:Ne.cache},y.updateQueue.baseState=ne,y.memoizedState=ne,y.flags&256){y=vl(g,y,le,k);break e}else if(le!==j){j=J(Error(i(424)),y),Le(j),y=vl(g,y,le,k);break e}else for(gi&&(li=Uf(y.stateNode.containerInfo),jo=y,_i=!0,ru=null,tl=!0),k=D(y,null,le,k),y.child=k;k;)k.flags=k.flags&-3|4096,k=k.sibling;else{if(vt(),le===j){y=Pu(g,y,k);break e}Wr(g,y,le,k)}y=y.child}return y;case 26:if(Tl)return Mg(g,y),g===null?(k=Ly(y.type,null,y.pendingProps,null))?y.memoizedState=k:_i||(y.stateNode=Ff(y.type,y.pendingProps,jf.current,y)):y.memoizedState=Ly(y.type,g.memoizedProps,y.pendingProps,g.memoizedState),null;case 27:if(Hs)return Re(y),g===null&&Hs&&_i&&(j=y.stateNode=vs(y.type,y.pendingProps,jf.current,aa.current,!1),jo=y,tl=!0,li=K_(y.type,j,li)),Wr(g,y,y.pendingProps.children,k),Mg(g,y),g===null&&(y.flags|=4194304),y.child;case 5:return g===null&&_i&&(c0(y.type,y.pendingProps,aa.current),(ne=j=li)&&(j=ET(j,y.type,y.pendingProps,tl),j!==null?(y.stateNode=j,jo=y,li=sm(j),tl=!1,ne=!0):ne=!1),ne||Pe(y)),Re(y),ne=y.type,le=y.pendingProps,Ne=g!==null?g.memoizedProps:null,j=le.children,Qp(ne,le)?j=null:Ne!==null&&Qp(ne,Ne)&&(y.flags|=32),y.memoizedState!==null&&(ne=Vr(g,y,Gr,null,null,k),Ba?qh._currentValue=ne:qh._currentValue2=ne),Mg(g,y),Wr(g,y,j,k),y.child;case 6:return g===null&&_i&&(gS(y.pendingProps,aa.current),(g=k=li)&&(k=xT(k,y.pendingProps,tl),k!==null?(y.stateNode=k,jo=y,li=null,g=!0):g=!1),g||Pe(y)),null;case 13:return Ms(g,y,k);case 4:return ie(y,y.stateNode.containerInfo),j=y.pendingProps,g===null?y.child=x(y,null,j,k):Wr(g,y,j,k),y.child;case 11:return A_(g,y,y.type,y.pendingProps,k);case 7:return Wr(g,y,y.pendingProps,k),y.child;case 8:return Wr(g,y,y.pendingProps.children,k),y.child;case 12:return Wr(g,y,y.pendingProps.children,k),y.child;case 10:return j=y.pendingProps,$e(y,y.type,j.value),Wr(g,y,j.children,k),y.child;case 9:return ne=y.type._context,j=y.pendingProps.children,pe(y),ne=ze(ne),j=j(ne),y.flags|=1,Wr(g,y,j,k),y.child;case 14:return G1(g,y,y.type,y.pendingProps,k);case 15:return Yc(g,y,y.type,y.pendingProps,k);case 19:return Td(g,y,k);case 31:return Ki(g,y,k);case 22:return Cg(g,y,k,y.pendingProps);case 24:return pe(y),j=ze(Ps),g===null?(ne=Fe(),ne===null&&(ne=ws,le=et(),ne.pooledCache=le,le.refCount++,le!==null&&(ne.pooledCacheLanes|=k),ne=le),y.memoizedState={parent:j,cache:ne},is(y),$e(y,Ps,ne)):((g.lanes&k)!==0&&(hi(g,y),as(y,null,null,k),os()),ne=g.memoizedState,le=y.memoizedState,ne.parent!==j?(ne={parent:j,cache:j},y.memoizedState=ne,y.lanes===0&&(y.memoizedState=y.updateQueue.baseState=ne),$e(y,Ps,j)):(j=le.cache,$e(y,Ps,j),j!==ne.cache&&ae(y,[Ps],k,!0))),Wr(g,y,y.pendingProps.children,k),y.child;case 29:throw y.pendingProps}throw Error(i(156,y.tag))}function bl(g){g.flags|=4}function Ng(g){El&&(g.flags|=8)}function q1(g,y){if(g!==null&&g.child===y.child)return!1;if((y.flags&16)!==0)return!0;for(g=y.child;g!==null;){if((g.flags&8218)!==0||(g.subtreeFlags&8218)!==0)return!0;g=g.sibling}return!1}function jp(g,y,k,j){if(ia)for(k=y.child;k!==null;){if(k.tag===5||k.tag===6)Xg(g,k.stateNode);else if(!(k.tag===4||Hs&&k.tag===27)&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===y)break;for(;k.sibling===null;){if(k.return===null||k.return===y)return;k=k.return}k.sibling.return=k.return,k=k.sibling}else if(El)for(var ne=y.child;ne!==null;){if(ne.tag===5){var le=ne.stateNode;k&&j&&(le=cS(le,ne.type,ne.memoizedProps)),Xg(g,le)}else if(ne.tag===6)le=ne.stateNode,k&&j&&(le=lS(le,ne.memoizedProps)),Xg(g,le);else if(ne.tag!==4){if(ne.tag===22&&ne.memoizedState!==null)le=ne.child,le!==null&&(le.return=ne),jp(g,ne,!0,!0);else if(ne.child!==null){ne.child.return=ne,ne=ne.child;continue}}if(ne===y)break;for(;ne.sibling===null;){if(ne.return===null||ne.return===y)return;ne=ne.return}ne.sibling.return=ne.return,ne=ne.sibling}}function Pg(g,y,k,j){var ne=!1;if(El)for(var le=y.child;le!==null;){if(le.tag===5){var Ne=le.stateNode;k&&j&&(Ne=cS(Ne,le.type,le.memoizedProps)),W_(g,Ne)}else if(le.tag===6)Ne=le.stateNode,k&&j&&(Ne=lS(Ne,le.memoizedProps)),W_(g,Ne);else if(le.tag!==4){if(le.tag===22&&le.memoizedState!==null)ne=le.child,ne!==null&&(ne.return=le),Pg(g,le,!0,!0),ne=!0;else if(le.child!==null){le.child.return=le,le=le.child;continue}}if(le===y)break;for(;le.sibling===null;){if(le.return===null||le.return===y)return ne;le=le.return}le.sibling.return=le.return,le=le.sibling}return ne}function zp(g,y){if(El&&q1(g,y)){g=y.stateNode;var k=g.containerInfo,j=My();Pg(j,y,!1,!1),g.pendingChildren=j,bl(y),yT(k,j)}}function R_(g,y,k,j){if(ia)g.memoizedProps!==j&&bl(y);else if(El){var ne=g.stateNode,le=g.memoizedProps;if((g=q1(g,y))||le!==j){var Ne=aa.current;le=_o(ne,k,le,j,!g,null),le===ne?y.stateNode=ne:(Ng(y),Gu(le,k,j,Ne)&&bl(y),y.stateNode=le,g&&jp(le,y,!1,!1))}else y.stateNode=ne}}function Ad(g,y,k,j,ne){if((g.mode&32)!==0&&(k===null?Ta(y,j):Cy(y,k,j))){if(g.flags|=16777216,(ne&335544128)===ne||Zg(y,j))if(Ry(g.stateNode,y,j))g.flags|=8192;else if(K1())g.flags|=8192;else throw eo=ef,$y}else g.flags&=-16777217}function k_(g,y){if(Uy(y)){if(g.flags|=16777216,!wl(y))if(K1())g.flags|=8192;else throw eo=ef,$y}else g.flags&=-16777217}function M_(g,y){y!==null&&(g.flags|=4),g.flags&16384&&(y=g.tag!==22?T():536870912,g.lanes|=y,V|=y)}function Vs(g,y){if(!_i)switch(g.tailMode){case"hidden":y=g.tail;for(var k=null;y!==null;)y.alternate!==null&&(k=y),y=y.sibling;k===null?g.tail=null:k.sibling=null;break;case"collapsed":k=g.tail;for(var j=null;k!==null;)k.alternate!==null&&(j=k),k=k.sibling;j===null?y||g.tail===null?g.tail=null:g.tail.sibling=null:j.sibling=null}}function qr(g){var y=g.alternate!==null&&g.alternate.child===g.child,k=0,j=0;if(y)for(var ne=g.child;ne!==null;)k|=ne.lanes|ne.childLanes,j|=ne.subtreeFlags&65011712,j|=ne.flags&65011712,ne.return=g,ne=ne.sibling;else for(ne=g.child;ne!==null;)k|=ne.lanes|ne.childLanes,j|=ne.subtreeFlags,j|=ne.flags,ne.return=g,ne=ne.sibling;return g.subtreeFlags|=j,g.childLanes=k,y}function Y1(g,y,k){var j=y.pendingProps;switch(ee(y),y.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qr(y),null;case 1:return qr(y),null;case 3:return k=y.stateNode,j=null,g!==null&&(j=g.memoizedState.cache),y.memoizedState.cache!==j&&(y.flags|=2048),De(Ps),Ee(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(g===null||g.child===null)&&(ht(y)?bl(y):g===null||g.memoizedState.isDehydrated&&(y.flags&256)===0||(y.flags|=1024,re())),zp(g,y),qr(y),null;case 26:if(Tl){var ne=y.type,le=y.memoizedState;return g===null?(bl(y),le!==null?(qr(y),k_(y,le)):(qr(y),Ad(y,ne,null,j,k))):le?le!==g.memoizedState?(bl(y),qr(y),k_(y,le)):(qr(y),y.flags&=-16777217):(le=g.memoizedProps,ia?le!==j&&bl(y):R_(g,y,ne,j),qr(y),Ad(y,ne,le,j,k)),null}case 27:if(Hs){if(Te(y),k=jf.current,ne=y.type,g!==null&&y.stateNode!=null)ia?g.memoizedProps!==j&&bl(y):R_(g,y,ne,j);else{if(!j){if(y.stateNode===null)throw Error(i(166));return qr(y),null}g=aa.current,ht(y)?We(y,g):(g=vs(ne,j,k,g,!0),y.stateNode=g,bl(y))}return qr(y),null}case 5:if(Te(y),ne=y.type,g!==null&&y.stateNode!=null)R_(g,y,ne,j);else{if(!j){if(y.stateNode===null)throw Error(i(166));return qr(y),null}if(le=aa.current,ht(y))We(y,le),Z_(y.stateNode,ne,j,le)&&(y.flags|=64);else{var Ne=J1(ne,j,jf.current,le,y);Ng(y),jp(Ne,y,!1,!1),y.stateNode=Ne,Gu(Ne,ne,j,le)&&bl(y)}}return qr(y),Ad(y,y.type,g===null?null:g.memoizedProps,y.pendingProps,k),null;case 6:if(g&&y.stateNode!=null)k=g.memoizedProps,ia?k!==j&&bl(y):El&&(k!==j?(g=jf.current,k=aa.current,Ng(y),y.stateNode=V_(j,g,k,y)):y.stateNode=g.stateNode);else{if(typeof j!="string"&&y.stateNode===null)throw Error(i(166));if(g=jf.current,k=aa.current,ht(y)){if(!gi)throw Error(i(176));if(g=y.stateNode,k=y.memoizedProps,j=null,ne=jo,ne!==null)switch(ne.tag){case 27:case 5:j=ne.memoizedProps}i0(g,k,y,j)||Pe(y,!0)}else Ng(y),y.stateNode=V_(j,g,k,y)}return qr(y),null;case 31:if(k=y.memoizedState,g===null||g.memoizedState!==null){if(j=ht(y),k!==null){if(g===null){if(!j)throw Error(i(318));if(!gi)throw Error(i(556));if(g=y.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(557));fS(g,y)}else vt(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;qr(y),g=!1}else k=re(),g!==null&&g.memoizedState!==null&&(g.memoizedState.hydrationErrors=k),g=!0;if(!g)return y.flags&256?(er(y),y):(er(y),null);if((y.flags&128)!==0)throw Error(i(558))}return qr(y),null;case 13:if(j=y.memoizedState,g===null||g.memoizedState!==null&&g.memoizedState.dehydrated!==null){if(ne=ht(y),j!==null&&j.dehydrated!==null){if(g===null){if(!ne)throw Error(i(318));if(!gi)throw Error(i(344));if(ne=y.memoizedState,ne=ne!==null?ne.dehydrated:null,!ne)throw Error(i(317));Xh(ne,y)}else vt(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;qr(y),ne=!1}else ne=re(),g!==null&&g.memoizedState!==null&&(g.memoizedState.hydrationErrors=ne),ne=!0;if(!ne)return y.flags&256?(er(y),y):(er(y),null)}return er(y),(y.flags&128)!==0?(y.lanes=k,y):(k=j!==null,g=g!==null&&g.memoizedState!==null,k&&(j=y.child,ne=null,j.alternate!==null&&j.alternate.memoizedState!==null&&j.alternate.memoizedState.cachePool!==null&&(ne=j.alternate.memoizedState.cachePool.pool),le=null,j.memoizedState!==null&&j.memoizedState.cachePool!==null&&(le=j.memoizedState.cachePool.pool),le!==ne&&(j.flags|=2048)),k!==g&&k&&(y.child.flags|=8192),M_(y,y.updateQueue),qr(y),null);case 4:return Ee(),zp(g,y),g===null&&vr(y.stateNode.containerInfo),qr(y),null;case 10:return De(y.type),qr(y),null;case 19:if(d(nn),j=y.memoizedState,j===null)return qr(y),null;if(ne=(y.flags&128)!==0,le=j.rendering,le===null)if(ne)Vs(j,!1);else{if(M!==0||g!==null&&(g.flags&128)!==0)for(g=y.child;g!==null;){if(le=fr(g),le!==null){for(y.flags|=128,Vs(j,!1),g=le.updateQueue,y.updateQueue=g,M_(y,g),y.subtreeFlags=0,g=k,k=y.child;k!==null;)Kp(k,g),k=k.sibling;return p(nn,nn.current&1|2),_i&&Q(y,j.treeForkCount),y.child}g=g.sibling}j.tail!==null&&Fr()>we&&(y.flags|=128,ne=!0,Vs(j,!1),y.lanes=4194304)}else{if(!ne)if(g=fr(le),g!==null){if(y.flags|=128,ne=!0,g=g.updateQueue,y.updateQueue=g,M_(y,g),Vs(j,!0),j.tail===null&&j.tailMode==="hidden"&&!le.alternate&&!_i)return qr(y),null}else 2*Fr()-j.renderingStartTime>we&&k!==536870912&&(y.flags|=128,ne=!0,Vs(j,!1),y.lanes=4194304);j.isBackwards?(le.sibling=y.child,y.child=le):(g=j.last,g!==null?g.sibling=le:y.child=le,j.last=le)}return j.tail!==null?(g=j.tail,j.rendering=g,j.tail=g.sibling,j.renderingStartTime=Fr(),g.sibling=null,k=nn.current,p(nn,ne?k&1|2:k&1),_i&&Q(y,j.treeForkCount),g):(qr(y),null);case 22:case 23:return er(y),yt(),j=y.memoizedState!==null,g!==null?g.memoizedState!==null!==j&&(y.flags|=8192):j&&(y.flags|=8192),j?(k&536870912)!==0&&(y.flags&128)===0&&(qr(y),y.subtreeFlags&6&&(y.flags|=8192)):qr(y),k=y.updateQueue,k!==null&&M_(y,k.retryQueue),k=null,g!==null&&g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(k=g.memoizedState.cachePool.pool),j=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(j=y.memoizedState.cachePool.pool),j!==k&&(y.flags|=2048),g!==null&&d(Ds),null;case 24:return k=null,g!==null&&(k=g.memoizedState.cache),y.memoizedState.cache!==k&&(y.flags|=2048),De(Ps),qr(y),null;case 25:return null;case 30:return null}throw Error(i(156,y.tag))}function pT(g,y){switch(ee(y),y.tag){case 1:return g=y.flags,g&65536?(y.flags=g&-65537|128,y):null;case 3:return De(Ps),Ee(),g=y.flags,(g&65536)!==0&&(g&128)===0?(y.flags=g&-65537|128,y):null;case 26:case 27:case 5:return Te(y),null;case 31:if(y.memoizedState!==null){if(er(y),y.alternate===null)throw Error(i(340));vt()}return g=y.flags,g&65536?(y.flags=g&-65537|128,y):null;case 13:if(er(y),g=y.memoizedState,g!==null&&g.dehydrated!==null){if(y.alternate===null)throw Error(i(340));vt()}return g=y.flags,g&65536?(y.flags=g&-65537|128,y):null;case 19:return d(nn),null;case 4:return Ee(),null;case 10:return De(y.type),null;case 22:case 23:return er(y),yt(),g!==null&&d(Ds),g=y.flags,g&65536?(y.flags=g&-65537|128,y):null;case 24:return De(Ps),null;case 25:return null;default:return null}}function Dg(g,y){switch(ee(y),y.tag){case 3:De(Ps),Ee();break;case 26:case 27:case 5:Te(y);break;case 4:Ee();break;case 31:y.memoizedState!==null&&er(y);break;case 13:er(y);break;case 19:d(nn);break;case 10:De(y.type);break;case 22:case 23:er(y),yt(),g!==null&&d(Ds);break;case 24:De(Ps)}}function Tn(g,y){try{var k=y.updateQueue,j=k!==null?k.lastEffect:null;if(j!==null){var ne=j.next;k=ne;do{if((k.tag&g)===g){j=void 0;var le=k.create,Ne=k.inst;j=le(),Ne.destroy=j}k=k.next}while(k!==ne)}}catch(Ze){Qt(y,y.return,Ze)}}function fn(g,y,k){try{var j=y.updateQueue,ne=j!==null?j.lastEffect:null;if(ne!==null){var le=ne.next;j=le;do{if((j.tag&g)===g){var Ne=j.inst,Ze=Ne.destroy;if(Ze!==void 0){Ne.destroy=void 0,ne=y;var St=k,Dt=Ze;try{Dt()}catch(Kt){Qt(ne,St,Kt)}}}j=j.next}while(j!==le)}}catch(Kt){Qt(y,y.return,Kt)}}function Sn(g){var y=g.updateQueue;if(y!==null){var k=g.stateNode;try{_t(y,k)}catch(j){Qt(g,g.return,j)}}}function Cd(g,y,k){k.props=en(g.type,g.memoizedProps),k.state=g.memoizedState;try{k.componentWillUnmount()}catch(j){Qt(g,y,j)}}function Hr(g,y){try{var k=g.ref;if(k!==null){switch(g.tag){case 26:case 27:case 5:var j=Hu(g.stateNode);break;case 30:j=g.stateNode;break;default:j=g.stateNode}typeof k=="function"?g.refCleanup=k(j):k.current=j}}catch(ne){Qt(g,y,ne)}}function Cr(g,y){var k=g.ref,j=g.refCleanup;if(k!==null)if(typeof j=="function")try{j()}catch(ne){Qt(g,y,ne)}finally{g.refCleanup=null,g=g.alternate,g!=null&&(g.refCleanup=null)}else if(typeof k=="function")try{k(null)}catch(ne){Qt(g,y,ne)}else k.current=null}function Ea(g){var y=g.type,k=g.memoizedProps,j=g.stateNode;try{jd(j,y,k,g)}catch(ne){Qt(g,g.return,ne)}}function Du(g,y,k){try{eS(g.stateNode,g.type,k,y,g)}catch(j){Qt(g,g.return,j)}}function Cf(g){return g.tag===5||g.tag===3||(Tl?g.tag===26:!1)||(Hs?g.tag===27&&tu(g.type):!1)||g.tag===4}function $p(g){e:for(;;){for(;g.sibling===null;){if(g.return===null||Cf(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;g.tag!==5&&g.tag!==6&&g.tag!==18;){if(Hs&&g.tag===27&&tu(g.type)||g.flags&2||g.child===null||g.tag===4)continue e;g.child.return=g,g=g.child}if(!(g.flags&2))return g.stateNode}}function Rd(g,y,k){var j=g.tag;if(j===5||j===6)g=g.stateNode,y?nS(k,g,y):Q1(k,g);else if(j!==4&&(Hs&&j===27&&tu(g.type)&&(k=g.stateNode,y=null),g=g.child,g!==null))for(Rd(g,y,k),g=g.sibling;g!==null;)Rd(g,y,k),g=g.sibling}function Lg(g,y,k){var j=g.tag;if(j===5||j===6)g=g.stateNode,y?tS(k,g,y):t0(k,g);else if(j!==4&&(Hs&&j===27&&tu(g.type)&&(k=g.stateNode),g=g.child,g!==null))for(Lg(g,y,k),g=g.sibling;g!==null;)Lg(g,y,k),g=g.sibling}function Ug(g,y,k){g=g.containerInfo;try{q_(g,k)}catch(j){Qt(y,y.return,j)}}function my(g){var y=g.stateNode,k=g.memoizedProps;try{Qs(g.type,k,y,g)}catch(j){Qt(g,g.return,j)}}function Vp(g,y){for(wy(g.containerInfo),vo=y;vo!==null;)if(g=vo,y=g.child,(g.subtreeFlags&1028)!==0&&y!==null)y.return=g,vo=y;else for(;vo!==null;){g=vo;var k=g.alternate;switch(y=g.flags,g.tag){case 0:if((y&4)!==0&&(y=g.updateQueue,y=y!==null?y.events:null,y!==null))for(var j=0;j<y.length;j++){var ne=y[j];ne.ref.impl=ne.nextImpl}break;case 11:case 15:break;case 1:if((y&1024)!==0&&k!==null){y=void 0,j=g,ne=k.memoizedProps,k=k.memoizedState;var le=j.stateNode;try{var Ne=en(j.type,ne);y=le.getSnapshotBeforeUpdate(Ne,k),le.__reactInternalSnapshotBeforeUpdate=y}catch(Ze){Qt(j,j.return,Ze)}}break;case 3:(y&1024)!==0&&ia&&aS(g.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((y&1024)!==0)throw Error(i(163))}if(y=g.sibling,y!==null){y.return=g.return,vo=y;break}vo=g.return}}function Rf(g,y,k){var j=k.flags;switch(k.tag){case 0:case 11:case 15:Uu(g,k),j&4&&Tn(5,k);break;case 1:if(Uu(g,k),j&4)if(g=k.stateNode,y===null)try{g.componentDidMount()}catch(Ne){Qt(k,k.return,Ne)}else{var ne=en(k.type,y.memoizedProps);y=y.memoizedState;try{g.componentDidUpdate(ne,y,g.__reactInternalSnapshotBeforeUpdate)}catch(Ne){Qt(k,k.return,Ne)}}j&64&&Sn(k),j&512&&Hr(k,k.return);break;case 3:if(Uu(g,k),j&64&&(j=k.updateQueue,j!==null)){if(g=null,k.child!==null)switch(k.child.tag){case 27:case 5:g=Hu(k.child.stateNode);break;case 1:g=k.child.stateNode}try{_t(j,g)}catch(Ne){Qt(k,k.return,Ne)}}break;case 27:Hs&&y===null&&j&4&&my(k);case 26:case 5:if(Uu(g,k),y===null){if(j&4)Ea(k);else if(j&64){g=k.type,y=k.memoizedProps,ne=k.stateNode;try{s0(ne,g,y,k)}catch(Ne){Qt(k,k.return,Ne)}}}j&512&&Hr(k,k.return);break;case 12:Uu(g,k);break;case 31:Uu(g,k),j&4&&kf(g,k);break;case 13:Uu(g,k),j&4&&Ya(g,k),j&64&&(j=k.memoizedState,j!==null&&(j=j.dehydrated,j!==null&&(k=Hg.bind(null,k),bT(j,k))));break;case 22:if(j=k.memoizedState!==null||nl,!j){y=y!==null&&y.memoizedState!==null||Us,ne=nl;var le=Us;nl=j,(Us=y)&&!le?Fh(g,k,(k.subtreeFlags&8772)!==0):Uu(g,k),nl=ne,Us=le}break;case 30:break;default:Uu(g,k)}}function I_(g){var y=g.alternate;y!==null&&(g.alternate=null,I_(y)),g.child=null,g.deletions=null,g.sibling=null,g.tag===5&&(y=g.stateNode,y!==null&&eu(y)),g.stateNode=null,g.return=null,g.dependencies=null,g.memoizedProps=null,g.memoizedState=null,g.pendingProps=null,g.stateNode=null,g.updateQueue=null}function Ue(g,y,k){for(k=k.child;k!==null;)Bh(g,y,k),k=k.sibling}function Bh(g,y,k){if(ec&&typeof ec.onCommitFiberUnmount=="function")try{ec.onCommitFiberUnmount(d0,k)}catch{}switch(k.tag){case 26:if(Tl){Us||Cr(k,y),Ue(g,y,k),k.memoizedState?Ur(k.memoizedState):k.stateNode&&Js(k.stateNode);break}case 27:if(Hs){Us||Cr(k,y);var j=yo,ne=Aa;tu(k.type)&&(yo=k.stateNode,Aa=!1),Ue(g,y,k),By(k.stateNode),yo=j,Aa=ne;break}case 5:Us||Cr(k,y);case 6:if(ia){if(j=yo,ne=Aa,yo=null,Ue(g,y,k),yo=j,Aa=ne,yo!==null)if(Aa)try{rS(yo,k.stateNode)}catch(le){Qt(k,y,le)}else try{G_(yo,k.stateNode)}catch(le){Qt(k,y,le)}}else Ue(g,y,k);break;case 18:ia&&yo!==null&&(Aa?mS(yo,k.stateNode):Dy(yo,k.stateNode));break;case 4:ia?(j=yo,ne=Aa,yo=k.stateNode.containerInfo,Aa=!0,Ue(g,y,k),yo=j,Aa=ne):(El&&Ug(k.stateNode,k,My()),Ue(g,y,k));break;case 0:case 11:case 14:case 15:fn(2,k,y),Us||fn(4,k,y),Ue(g,y,k);break;case 1:Us||(Cr(k,y),j=k.stateNode,typeof j.componentWillUnmount=="function"&&Cd(k,y,j)),Ue(g,y,k);break;case 21:Ue(g,y,k);break;case 22:Us=(j=Us)||k.memoizedState!==null,Ue(g,y,k),Us=j;break;default:Ue(g,y,k)}}function kf(g,y){if(gi&&y.memoizedState===null&&(g=y.alternate,g!==null&&(g=g.memoizedState,g!==null))){g=g.dehydrated;try{Ny(g)}catch(k){Qt(y,y.return,k)}}}function Ya(g,y){if(gi&&y.memoizedState===null&&(g=y.alternate,g!==null&&(g=g.memoizedState,g!==null&&(g=g.dehydrated,g!==null))))try{X_(g)}catch(k){Qt(y,y.return,k)}}function ci(g){switch(g.tag){case 31:case 13:case 19:var y=g.stateNode;return y===null&&(y=g.stateNode=new iu),y;case 22:return g=g.stateNode,y=g._retryCache,y===null&&(y=g._retryCache=new iu),y;default:throw Error(i(435,g.tag))}}function Ql(g,y){var k=ci(g);y.forEach(function(j){if(!k.has(j)){k.add(j);var ne=Sy.bind(null,g,j);j.then(ne,ne)}})}function Is(g,y){var k=y.deletions;if(k!==null)for(var j=0;j<k.length;j++){var ne=k[j],le=g,Ne=y;if(ia){var Ze=Ne;e:for(;Ze!==null;){switch(Ze.tag){case 27:if(Hs){if(tu(Ze.type)){yo=Ze.stateNode,Aa=!1;break e}break}case 5:yo=Ze.stateNode,Aa=!1;break e;case 3:case 4:yo=Ze.stateNode.containerInfo,Aa=!0;break e}Ze=Ze.return}if(yo===null)throw Error(i(160));Bh(le,Ne,ne),yo=null,Aa=!1}else Bh(le,Ne,ne);le=ne.alternate,le!==null&&(le.return=null),ne.return=null}if(y.subtreeFlags&13886)for(y=y.child;y!==null;)Lu(y,g),y=y.sibling}function Lu(g,y){var k=g.alternate,j=g.flags;switch(g.tag){case 0:case 11:case 14:case 15:Is(y,g),mo(g),j&4&&(fn(3,g,g.return),Tn(3,g),fn(5,g,g.return));break;case 1:Is(y,g),mo(g),j&512&&(Us||k===null||Cr(k,k.return)),j&64&&nl&&(g=g.updateQueue,g!==null&&(j=g.callbacks,j!==null&&(k=g.shared.hiddenCallbacks,g.shared.hiddenCallbacks=k===null?j:k.concat(j))));break;case 26:if(Tl){var ne=ls;if(Is(y,g),mo(g),j&512&&(Us||k===null||Cr(k,k.return)),j&4){j=k!==null?k.memoizedState:null;var le=g.memoizedState;k===null?le===null?g.stateNode===null?g.stateNode=wT(ne,g.type,g.memoizedProps,g):Qa(ne,g.type,g.stateNode):g.stateNode=Qc(ne,le,g.memoizedProps):j!==le?(j===null?k.stateNode!==null&&Js(k.stateNode):Ur(j),le===null?Qa(ne,g.type,g.stateNode):Qc(ne,le,g.memoizedProps)):le===null&&g.stateNode!==null&&Du(g,g.memoizedProps,k.memoizedProps)}break}case 27:if(Hs){Is(y,g),mo(g),j&512&&(Us||k===null||Cr(k,k.return)),k!==null&&j&4&&Du(g,g.memoizedProps,k.memoizedProps);break}case 5:if(Is(y,g),mo(g),j&512&&(Us||k===null||Cr(k,k.return)),ia){if(g.flags&32){ne=g.stateNode;try{ky(ne)}catch(Xt){Qt(g,g.return,Xt)}}j&4&&g.stateNode!=null&&(ne=g.memoizedProps,Du(g,ne,k!==null?k.memoizedProps:ne)),j&1024&&(Gd=!0)}else El&&g.alternate!==null&&(g.alternate.stateNode=g.stateNode);break;case 6:if(Is(y,g),mo(g),j&4&&ia){if(g.stateNode===null)throw Error(i(162));j=g.memoizedProps,k=k!==null?k.memoizedProps:j,ne=g.stateNode;try{Ku(ne,k,j)}catch(Xt){Qt(g,g.return,Xt)}}break;case 3:if(Tl?(AT(),ne=ls,ls=l0(y.containerInfo),Is(y,g),ls=ne):Is(y,g),mo(g),j&4){if(ia&&gi&&k!==null&&k.memoizedState.isDehydrated)try{Oy(y.containerInfo)}catch(Xt){Qt(g,g.return,Xt)}if(El){j=y.containerInfo,k=y.pendingChildren;try{q_(j,k)}catch(Xt){Qt(g,g.return,Xt)}}}Gd&&(Gd=!1,Kc(g));break;case 4:Tl?(k=ls,ls=l0(g.stateNode.containerInfo),Is(y,g),mo(g),ls=k):(Is(y,g),mo(g)),j&4&&El&&Ug(g.stateNode,g,g.stateNode.pendingChildren);break;case 12:Is(y,g),mo(g);break;case 31:Is(y,g),mo(g),j&4&&(j=g.updateQueue,j!==null&&(g.updateQueue=null,Ql(g,j)));break;case 13:Is(y,g),mo(g),g.child.flags&8192&&g.memoizedState!==null!=(k!==null&&k.memoizedState!==null)&&(ce=Fr()),j&4&&(j=g.updateQueue,j!==null&&(g.updateQueue=null,Ql(g,j)));break;case 22:ne=g.memoizedState!==null;var Ne=k!==null&&k.memoizedState!==null,Ze=nl,St=Us;if(nl=Ze||ne,Us=St||Ne,Is(y,g),Us=St,nl=Ze,mo(g),j&8192&&(y=g.stateNode,y._visibility=ne?y._visibility&-2:y._visibility|1,ne&&(k===null||Ne||nl||Us||Mf(g)),ia)){e:if(k=null,ia)for(y=g;;){if(y.tag===5||Tl&&y.tag===26){if(k===null){Ne=k=y;try{le=Ne.stateNode,ne?iS(le):vT(Ne.stateNode,Ne.memoizedProps)}catch(Xt){Qt(Ne,Ne.return,Xt)}}}else if(y.tag===6){if(k===null){Ne=y;try{var Dt=Ne.stateNode;ne?sS(Dt):oS(Dt,Ne.memoizedProps)}catch(Xt){Qt(Ne,Ne.return,Xt)}}}else if(y.tag===18){if(k===null){Ne=y;try{var Kt=Ne.stateNode;ne?o0(Kt):a0(Ne.stateNode)}catch(Xt){Qt(Ne,Ne.return,Xt)}}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===g)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===g)break e;for(;y.sibling===null;){if(y.return===null||y.return===g)break e;k===y&&(k=null),y=y.return}k===y&&(k=null),y.sibling.return=y.return,y=y.sibling}}j&4&&(j=g.updateQueue,j!==null&&(k=j.retryQueue,k!==null&&(j.retryQueue=null,Ql(g,k))));break;case 19:Is(y,g),mo(g),j&4&&(j=g.updateQueue,j!==null&&(g.updateQueue=null,Ql(g,j)));break;case 30:break;case 21:break;default:Is(y,g),mo(g)}}function mo(g){var y=g.flags;if(y&2){try{for(var k,j=g.return;j!==null;){if(Cf(j)){k=j;break}j=j.return}if(ia){if(k==null)throw Error(i(160));switch(k.tag){case 27:if(Hs){var ne=k.stateNode,le=$p(g);Lg(g,le,ne);break}case 5:var Ne=k.stateNode;k.flags&32&&(ky(Ne),k.flags&=-33);var Ze=$p(g);Lg(g,Ze,Ne);break;case 3:case 4:var St=k.stateNode.containerInfo,Dt=$p(g);Rd(g,Dt,St);break;default:throw Error(i(161))}}}catch(Kt){Qt(g,g.return,Kt)}g.flags&=-3}y&4096&&(g.flags&=-4097)}function Kc(g){if(g.subtreeFlags&1024)for(g=g.child;g!==null;){var y=g;Kc(y),y.tag===5&&y.flags&1024&&Jg(y.stateNode),g=g.sibling}}function Uu(g,y){if(y.subtreeFlags&8772)for(y=y.child;y!==null;)Rf(g,y.alternate,y),y=y.sibling}function Mf(g){for(g=g.child;g!==null;){var y=g;switch(y.tag){case 0:case 11:case 14:case 15:fn(4,y,y.return),Mf(y);break;case 1:Cr(y,y.return);var k=y.stateNode;typeof k.componentWillUnmount=="function"&&Cd(y,y.return,k),Mf(y);break;case 27:Hs&&By(y.stateNode);case 26:case 5:Cr(y,y.return),Mf(y);break;case 22:y.memoizedState===null&&Mf(y);break;case 30:Mf(y);break;default:Mf(y)}g=g.sibling}}function Fh(g,y,k){for(k=k&&(y.subtreeFlags&8772)!==0,y=y.child;y!==null;){var j=y.alternate,ne=g,le=y,Ne=le.flags;switch(le.tag){case 0:case 11:case 15:Fh(ne,le,k),Tn(4,le);break;case 1:if(Fh(ne,le,k),j=le,ne=j.stateNode,typeof ne.componentDidMount=="function")try{ne.componentDidMount()}catch(Dt){Qt(j,j.return,Dt)}if(j=le,ne=j.updateQueue,ne!==null){var Ze=j.stateNode;try{var St=ne.shared.hiddenCallbacks;if(St!==null)for(ne.shared.hiddenCallbacks=null,ne=0;ne<St.length;ne++)je(St[ne],Ze)}catch(Dt){Qt(j,j.return,Dt)}}k&&Ne&64&&Sn(le),Hr(le,le.return);break;case 27:Hs&&my(le);case 26:case 5:Fh(ne,le,k),k&&j===null&&Ne&4&&Ea(le),Hr(le,le.return);break;case 12:Fh(ne,le,k);break;case 31:Fh(ne,le,k),k&&Ne&4&&kf(ne,le);break;case 13:Fh(ne,le,k),k&&Ne&4&&Ya(ne,le);break;case 22:le.memoizedState===null&&Fh(ne,le,k),Hr(le,le.return);break;case 30:break;default:Fh(ne,le,k)}y=y.sibling}}function Do(g,y){var k=null;g!==null&&g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(k=g.memoizedState.cachePool.pool),g=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(g=y.memoizedState.cachePool.pool),g!==k&&(g!=null&&g.refCount++,k!=null&&Ut(k))}function Hp(g,y){g=null,y.alternate!==null&&(g=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==g&&(y.refCount++,g!=null&&Ut(g))}function La(g,y,k,j){if(y.subtreeFlags&10256)for(y=y.child;y!==null;)Bg(g,y,k,j),y=y.sibling}function Bg(g,y,k,j){var ne=y.flags;switch(y.tag){case 0:case 11:case 15:La(g,y,k,j),ne&2048&&Tn(9,y);break;case 1:La(g,y,k,j);break;case 3:La(g,y,k,j),ne&2048&&(g=null,y.alternate!==null&&(g=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==g&&(y.refCount++,g!=null&&Ut(g)));break;case 12:if(ne&2048){La(g,y,k,j),g=y.stateNode;try{var le=y.memoizedProps,Ne=le.id,Ze=le.onPostCommit;typeof Ze=="function"&&Ze(Ne,y.alternate===null?"mount":"update",g.passiveEffectDuration,-0)}catch(St){Qt(y,y.return,St)}}else La(g,y,k,j);break;case 31:La(g,y,k,j);break;case 13:La(g,y,k,j);break;case 23:break;case 22:le=y.stateNode,Ne=y.alternate,y.memoizedState!==null?le._visibility&2?La(g,y,k,j):Gp(g,y):le._visibility&2?La(g,y,k,j):(le._visibility|=2,jh(g,y,k,j,(y.subtreeFlags&10256)!==0||!1)),ne&2048&&Do(Ne,y);break;case 24:La(g,y,k,j),ne&2048&&Hp(y.alternate,y);break;default:La(g,y,k,j)}}function jh(g,y,k,j,ne){for(ne=ne&&((y.subtreeFlags&10256)!==0||!1),y=y.child;y!==null;){var le=g,Ne=y,Ze=k,St=j,Dt=Ne.flags;switch(Ne.tag){case 0:case 11:case 15:jh(le,Ne,Ze,St,ne),Tn(8,Ne);break;case 23:break;case 22:var Kt=Ne.stateNode;Ne.memoizedState!==null?Kt._visibility&2?jh(le,Ne,Ze,St,ne):Gp(le,Ne):(Kt._visibility|=2,jh(le,Ne,Ze,St,ne)),ne&&Dt&2048&&Do(Ne.alternate,Ne);break;case 24:jh(le,Ne,Ze,St,ne),ne&&Dt&2048&&Hp(Ne.alternate,Ne);break;default:jh(le,Ne,Ze,St,ne)}y=y.sibling}}function Gp(g,y){if(y.subtreeFlags&10256)for(y=y.child;y!==null;){var k=g,j=y,ne=j.flags;switch(j.tag){case 22:Gp(k,j),ne&2048&&Do(j.alternate,j);break;case 24:Gp(k,j),ne&2048&&Hp(j.alternate,j);break;default:Gp(k,j)}y=y.sibling}}function ea(g,y,k){if(g.subtreeFlags&su)for(g=g.child;g!==null;)O_(g,y,k),g=g.sibling}function O_(g,y,k){switch(g.tag){case 26:if(ea(g,y,k),g.flags&su)if(g.memoizedState!==null)J_(k,ls,g.memoizedState,g.memoizedProps);else{var j=g.stateNode,ne=g.type;g=g.memoizedProps,((y&335544128)===y||Zg(ne,g))&&Uo(k,j,ne,g)}break;case 5:ea(g,y,k),g.flags&su&&(j=g.stateNode,ne=g.type,g=g.memoizedProps,((y&335544128)===y||Zg(ne,g))&&Uo(k,j,ne,g));break;case 3:case 4:Tl?(j=ls,ls=l0(g.stateNode.containerInfo),ea(g,y,k),ls=j):ea(g,y,k);break;case 22:g.memoizedState===null&&(j=g.alternate,j!==null&&j.memoizedState!==null?(j=su,su=16777216,ea(g,y,k),su=j):ea(g,y,k));break;default:ea(g,y,k)}}function zh(g){var y=g.alternate;if(y!==null&&(g=y.child,g!==null)){y.child=null;do y=g.sibling,g.sibling=null,g=y;while(g!==null)}}function ta(g){var y=g.deletions;if((g.flags&16)!==0){if(y!==null)for(var k=0;k<y.length;k++){var j=y[k];vo=j,kd(j,g)}zh(g)}if(g.subtreeFlags&10256)for(g=g.child;g!==null;)Ka(g),g=g.sibling}function Ka(g){switch(g.tag){case 0:case 11:case 15:ta(g),g.flags&2048&&fn(9,g,g.return);break;case 3:ta(g);break;case 12:ta(g);break;case 22:var y=g.stateNode;g.memoizedState!==null&&y._visibility&2&&(g.return===null||g.return.tag!==13)?(y._visibility&=-3,Bu(g)):ta(g);break;default:ta(g)}}function Bu(g){var y=g.deletions;if((g.flags&16)!==0){if(y!==null)for(var k=0;k<y.length;k++){var j=y[k];vo=j,kd(j,g)}zh(g)}for(g=g.child;g!==null;){switch(y=g,y.tag){case 0:case 11:case 15:fn(8,y,y.return),Bu(y);break;case 22:k=y.stateNode,k._visibility&2&&(k._visibility&=-3,Bu(y));break;default:Bu(y)}g=g.sibling}}function kd(g,y){for(;vo!==null;){var k=vo;switch(k.tag){case 0:case 11:case 15:fn(8,k,y);break;case 23:case 22:if(k.memoizedState!==null&&k.memoizedState.cachePool!==null){var j=k.memoizedState.cachePool.pool;j!=null&&j.refCount++}break;case 24:Ut(k.memoizedState.cache)}if(j=k.child,j!==null)j.return=k,vo=j;else e:for(k=g;vo!==null;){j=vo;var ne=j.sibling,le=j.return;if(I_(j),j===k){vo=null;break e}if(ne!==null){ne.return=le,vo=ne;break e}vo=le}}}function Fu(g){var y=Bd(g);if(y!=null){if(typeof y.memoizedProps["data-testname"]!="string")throw Error(i(364));return y}if(g=Yu(g),g===null)throw Error(i(362));return g.stateNode.current}function Fg(g,y){var k=g.tag;switch(y.$$typeof){case g0:if(g.type===y.value)return!0;break;case Wd:e:{for(y=y.value,g=[g,0],k=0;k<g.length;){var j=g[k++],ne=j.tag,le=g[k++],Ne=y[le];if(ne!==5&&ne!==26&&ne!==27||!Yh(j)){for(;Ne!=null&&Fg(j,Ne);)le++,Ne=y[le];if(le===y.length){y=!0;break e}else for(j=j.child;j!==null;)g.push(j,le),j=j.sibling}}y=!1}return y;case Vf:if((k===5||k===26||k===27)&&Qg(g.stateNode,y.value))return!0;break;case ES:if((k===5||k===6||k===26||k===27)&&(g=Fd(g),g!==null&&0<=g.indexOf(y.value)))return!0;break;case Vy:if((k===5||k===26||k===27)&&(g=g.memoizedProps["data-testname"],typeof g=="string"&&g.toLowerCase()===y.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function jg(g){switch(g.$$typeof){case g0:return"<"+(h(g.value)||"Unknown")+">";case Wd:return":has("+(jg(g)||"")+")";case Vf:return'[role="'+g.value+'"]';case ES:return'"'+g.value+'"';case Vy:return'[data-testname="'+g.value+'"]';default:throw Error(i(365))}}function Md(g,y){var k=[];g=[g,0];for(var j=0;j<g.length;){var ne=g[j++],le=ne.tag,Ne=g[j++],Ze=y[Ne];if(le!==5&&le!==26&&le!==27||!Yh(ne)){for(;Ze!=null&&Fg(ne,Ze);)Ne++,Ze=y[Ne];if(Ne===y.length)k.push(ne);else for(ne=ne.child;ne!==null;)g.push(ne,Ne),ne=ne.sibling}}return k}function Tr(g,y){if(!qu)throw Error(i(363));g=Fu(g),g=Md(g,y),y=[],g=Array.from(g);for(var k=0;k<g.length;){var j=g[k++],ne=j.tag;if(ne===5||ne===26||ne===27)Yh(j)||y.push(j.stateNode);else for(j=j.child;j!==null;)g.push(j),j=j.sibling}return y}function Xi(){return(Yr&2)!==0&&Ei!==0?Ei&-Ei:dr.T!==null?_e():fi()}function N_(){if(F===0)if((Ei&536870912)===0||_i){var g=f0;f0<<=1,(f0&3932160)===0&&(f0=262144),F=g}else F=536870912;return g=Wt.current,g!==null&&(g.flags|=32),F}function Xa(g,y,k){(g===ws&&(us===2||us===9)||g.cancelPendingCommit!==null)&&(ju(g,0),Tc(g,Ei,F,!1)),R(g,k),((Yr&2)===0||g!==ws)&&(g===ws&&((Yr&2)===0&&(A|=k),M===4&&Tc(g,Ei,F,!1)),At(g))}function Os(g,y,k){if((Yr&6)!==0)throw Error(i(327));var j=!k&&(y&127)===0&&(y&g.expiredLanes)===0||S(g,y),ne=j?_y(g,y):Id(g,y,!0),le=j;do{if(ne===0){ov&&!j&&Tc(g,y,0,!1);break}else{if(k=g.current.alternate,le&&!zg(k)){ne=Id(g,y,!1),le=!1;continue}if(ne===2){if(le=y,g.errorRecoveryDisabledLanes&le)var Ne=0;else Ne=g.pendingLanes&-536870913,Ne=Ne!==0?Ne:Ne&536870912?536870912:0;if(Ne!==0){y=Ne;e:{var Ze=g;ne=K;var St=gi&&Ze.current.memoizedState.isDehydrated;if(St&&(ju(Ze,Ne).flags|=256),Ne=Id(Ze,Ne,!1),Ne!==2){if(am&&!St){Ze.errorRecoveryDisabledLanes|=le,A|=le,ne=4;break e}le=ue,ue=ne,le!==null&&(ue===null?ue=le:ue.push.apply(ue,le))}ne=Ne}if(le=!1,ne!==2)continue}}if(ne===1){ju(g,0),Tc(g,y,0,!0);break}e:{switch(j=g,le=ne,le){case 0:case 1:throw Error(i(345));case 4:if((y&4194048)!==y)break;case 6:Tc(j,y,F,!qd);break e;case 2:ue=null;break;case 3:case 5:break;default:throw Error(i(329))}if((y&62914560)===y&&(ne=ce+300-Fr(),10<ne)){if(Tc(j,y,F,!qd),v(j,0,!0)!==0)break e;Qe=y,j.timeoutHandle=_T(Wp.bind(null,j,k,ue,Me,me,y,F,A,V,qd,le,"Throttled",-0,0),ne);break e}Wp(j,k,ue,Me,me,y,F,A,V,qd,le,null,-0,0)}}break}while(!0);At(g)}function Wp(g,y,k,j,ne,le,Ne,Ze,St,Dt,Kt,Xt,vn,Zn){if(g.timeoutHandle=ra,Xt=y.subtreeFlags,Xt&8192||(Xt&16785408)===16785408){Xt=Co(),O_(y,le,Xt);var Nr=(le&62914560)===le?ce-Fr():(le&4194048)===le?de-Fr():0;if(Nr=em(Xt,Nr),Nr!==null){Qe=le,g.cancelPendingCommit=Nr(L_.bind(null,g,y,le,k,j,ne,Ne,Ze,St,Kt,Xt,null,vn,Zn)),Tc(g,le,Ne,!Dt);return}}L_(g,y,le,k,j,ne,Ne,Ze,St)}function zg(g){for(var y=g;;){var k=y.tag;if((k===0||k===11||k===15)&&y.flags&16384&&(k=y.updateQueue,k!==null&&(k=k.stores,k!==null)))for(var j=0;j<k.length;j++){var ne=k[j],le=ne.getSnapshot;ne=ne.value;try{if(!tc(le(),ne))return!1}catch{return!1}}if(k=y.child,y.subtreeFlags&16384&&k!==null)k.return=y,y=k;else{if(y===g)break;for(;y.sibling===null;){if(y.return===null||y.return===g)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function Tc(g,y,k,j){y&=~O,y&=~A,g.suspendedLanes|=y,g.pingedLanes&=~y,j&&(g.warmLanes|=y),j=g.expirationTimes;for(var ne=y;0<ne;){var le=31-Es(ne),Ne=1<<le;j[le]=-1,ne&=~Ne}k!==0&&N(g,k,y)}function gy(){return(Yr&6)===0?(Ce(0),!1):!0}function xa(){if(ar!==null){if(us===0)var g=ar.return;else g=ar,Qu=Jh=null,Un(g),Gs=null,th=0,g=ar;for(;g!==null;)Dg(g.alternate,g),g=g.return;ar=null}}function ju(g,y){var k=g.timeoutHandle;k!==ra&&(g.timeoutHandle=ra,Ay(k)),k=g.cancelPendingCommit,k!==null&&(g.cancelPendingCommit=null,k()),Qe=0,xa(),ws=g,ar=k=Ns(g.current,null),Ei=y,us=0,rc=null,qd=!1,ov=S(g,y),am=!1,V=F=O=A=E=M=0,ue=K=null,me=!1,(y&8)!==0&&(y|=y&32);var j=g.entangledLanes;if(j!==0)for(g=g.entanglements,j&=y;0<j;){var ne=31-Es(j),le=1<<ne;y|=g[ne],j&=~le}return Yd=y,Zt(),k}function qp(g,y){pn=null,dr.H=jn,y===kc||y===$f?(y=ot(),us=3):y===$y?(y=ot(),us=4):us=y===zo?8:y!==null&&typeof y=="object"&&typeof y.then=="function"?6:1,rc=y,ar===null&&(M=1,sn(g,J(y,g.current)))}function K1(){var g=Wt.current;return g===null?!0:(Ei&4194048)===Ei?Yt===null:(Ei&62914560)===Ei||(Ei&536870912)!==0?g===Yt:!1}function P_(){var g=dr.H;return dr.H=jn,g===null?jn:g}function $h(){var g=dr.A;return dr.A=ou,g}function $g(){M=4,qd||(Ei&4194048)!==Ei&&Wt.current!==null||(ov=!0),(E&134217727)===0&&(A&134217727)===0||ws===null||Tc(ws,Ei,F,!1)}function Id(g,y,k){var j=Yr;Yr|=2;var ne=P_(),le=$h();(ws!==g||Ei!==y)&&(Me=null,ju(g,y)),y=!1;var Ne=M;e:do try{if(us!==0&&ar!==null){var Ze=ar,St=rc;switch(us){case 8:xa(),Ne=6;break e;case 3:case 2:case 9:case 6:Wt.current===null&&(y=!0);var Dt=us;if(us=0,rc=null,Of(g,Ze,St,Dt),k&&ov){Ne=0;break e}break;default:Dt=us,us=0,rc=null,Of(g,Ze,St,Dt)}}If(),Ne=M;break}catch(Kt){qp(g,Kt)}while(!0);return y&&g.shellSuspendCounter++,Qu=Jh=null,Yr=j,dr.H=ne,dr.A=le,ar===null&&(ws=null,Ei=0,Zt()),Ne}function If(){for(;ar!==null;)D_(ar)}function _y(g,y){var k=Yr;Yr|=2;var j=P_(),ne=$h();ws!==g||Ei!==y?(Me=null,we=Fr()+500,ju(g,y)):ov=S(g,y);e:do try{if(us!==0&&ar!==null){y=ar;var le=rc;t:switch(us){case 1:us=0,rc=null,Of(g,y,le,1);break;case 2:case 9:if(tt(le)){us=0,rc=null,vy(y);break}y=function(){us!==2&&us!==9||ws!==g||(us=7),At(g)},le.then(y,y);break e;case 3:us=7;break e;case 4:us=5;break e;case 7:tt(le)?(us=0,rc=null,vy(y)):(us=0,rc=null,Of(g,y,le,7));break;case 5:var Ne=null;switch(ar.tag){case 26:Ne=ar.memoizedState;case 5:case 27:var Ze=ar,St=Ze.type,Dt=Ze.pendingProps;if(Ne?wl(Ne):Ry(Ze.stateNode,St,Dt)){us=0,rc=null;var Kt=Ze.sibling;if(Kt!==null)ar=Kt;else{var Xt=Ze.return;Xt!==null?(ar=Xt,Vh(Xt)):ar=null}break t}}us=0,rc=null,Of(g,y,le,5);break;case 6:us=0,rc=null,Of(g,y,le,6);break;case 8:xa(),M=6;break e;default:throw Error(i(462))}}X1();break}catch(vn){qp(g,vn)}while(!0);return Qu=Jh=null,dr.H=j,dr.A=ne,Yr=k,ar!==null?0:(ws=null,Ei=0,Zt(),M)}function X1(){for(;ar!==null&&!Cl();)D_(ar)}function D_(g){var y=Jl(g.alternate,g,Yd);g.memoizedProps=g.pendingProps,y===null?Vh(g):ar=y}function vy(g){var y=g,k=y.alternate;switch(y.tag){case 15:case 0:y=Ig(k,y,y.pendingProps,y.type,void 0,Ei);break;case 11:y=Ig(k,y,y.pendingProps,y.type.render,y.ref,Ei);break;case 5:Un(y);default:Dg(k,y),y=ar=Kp(y,Yd),y=Jl(k,y,Yd)}g.memoizedProps=g.pendingProps,y===null?Vh(g):ar=y}function Of(g,y,k,j){Qu=Jh=null,Un(y),Gs=null,th=0;var ne=y.return;try{if(Zl(g,ne,y,k,Ei)){M=1,sn(g,J(k,g.current)),ar=null;return}}catch(le){if(ne!==null)throw ar=ne,le;M=1,sn(g,J(k,g.current)),ar=null;return}y.flags&32768?(_i||j===1?g=!0:ov||(Ei&536870912)!==0?g=!1:(qd=g=!0,(j===2||j===9||j===3||j===6)&&(j=Wt.current,j!==null&&j.tag===13&&(j.flags|=16384))),yy(y,g)):Vh(y)}function Vh(g){var y=g;do{if((y.flags&32768)!==0){yy(y,qd);return}g=y.return;var k=Y1(y.alternate,y,Yd);if(k!==null){ar=k;return}if(y=y.sibling,y!==null){ar=y;return}ar=y=g}while(y!==null);M===0&&(M=5)}function yy(g,y){do{var k=pT(g.alternate,g);if(k!==null){k.flags&=32767,ar=k;return}if(k=g.return,k!==null&&(k.flags|=32768,k.subtreeFlags=0,k.deletions=null),!y&&(g=g.sibling,g!==null)){ar=g;return}ar=g=k}while(g!==null);M=6,ar=null}function L_(g,y,k,j,ne,le,Ne,Ze,St){g.cancelPendingCommit=null;do Hh();while(bt!==0);if((Yr&6)!==0)throw Error(i(327));if(y!==null){if(y===g.current)throw Error(i(177));if(le=y.lanes|y.childLanes,le|=Ie,C(g,k,le,Ne,Ze,St),g===ws&&(ar=ws=null,Ei=0),dt=y,ut=g,Qe=k,st=le,It=ne,En=j,(y.subtreeFlags&10256)!==0||(y.flags&10256)!==0?(g.callbackNode=null,g.callbackPriority=0,gT(zd,function(){return B_(),null})):(g.callbackNode=null,g.callbackPriority=0),j=(y.flags&13878)!==0,(y.subtreeFlags&13878)!==0||j){j=dr.T,dr.T=null,ne=sa(),go(2),Ne=Yr,Yr|=4;try{Vp(g,y,k)}finally{Yr=Ne,go(ne),dr.T=j}}bt=1,Od(),U_(),Yp()}}function Od(){if(bt===1){bt=0;var g=ut,y=dt,k=(y.flags&13878)!==0;if((y.subtreeFlags&13878)!==0||k){k=dr.T,dr.T=null;var j=sa();go(2);var ne=Yr;Yr|=4;try{Lu(y,g),$_(g.containerInfo)}finally{Yr=ne,go(j),dr.T=k}}g.current=y,bt=2}}function U_(){if(bt===2){bt=0;var g=ut,y=dt,k=(y.flags&8772)!==0;if((y.subtreeFlags&8772)!==0||k){k=dr.T,dr.T=null;var j=sa();go(2);var ne=Yr;Yr|=4;try{Rf(g,y.alternate,y)}finally{Yr=ne,go(j),dr.T=k}}bt=3}}function Yp(){if(bt===4||bt===3){bt=0,_S();var g=ut,y=dt,k=Qe,j=En;(y.subtreeFlags&10256)!==0||(y.flags&10256)!==0?bt=5:(bt=0,dt=ut=null,by(g,g.pendingLanes));var ne=g.pendingLanes;if(ne===0&&(nt=null),I(k),y=y.stateNode,ec&&typeof ec.onCommitFiberRoot=="function")try{ec.onCommitFiberRoot(d0,y,void 0,(y.current.flags&128)===128)}catch{}if(j!==null){y=dr.T,ne=sa(),go(2),dr.T=null;try{for(var le=g.onRecoverableError,Ne=0;Ne<j.length;Ne++){var Ze=j[Ne];le(Ze.value,{componentStack:Ze.stack})}}finally{dr.T=y,go(ne)}}(Qe&3)!==0&&Hh(),At(g),ne=g.pendingLanes,(k&261930)!==0&&(ne&42)!==0?g===Xn?Dn++:(Dn=0,Xn=g):Dn=0,gi&&Py(),Ce(0)}}function by(g,y){(g.pooledCacheLanes&=y)===0&&(y=g.pooledCache,y!=null&&(g.pooledCache=null,Ut(y)))}function Hh(){return Od(),U_(),Yp(),B_()}function B_(){if(bt!==5)return!1;var g=ut,y=st;st=0;var k=I(Qe),j=32>k?32:k;k=dr.T;var ne=sa();try{go(j),dr.T=null,j=It,It=null;var le=ut,Ne=Qe;if(bt=0,dt=ut=null,Qe=0,(Yr&6)!==0)throw Error(i(331));var Ze=Yr;if(Yr|=4,Ka(le.current),Bg(le,le.current,Ne,j),Yr=Ze,Ce(0,!1),ec&&typeof ec.onPostCommitFiberRoot=="function")try{ec.onPostCommitFiberRoot(d0,le)}catch{}return!0}finally{go(ne),dr.T=k,by(g,y)}}function Vg(g,y,k){y=J(k,y),y=kr(g.stateNode,y,2),g=ji(g,y,2),g!==null&&(R(g,2),At(g))}function Qt(g,y,k){if(g.tag===3)Vg(g,g,k);else for(;y!==null;){if(y.tag===3){Vg(y,g,k);break}else if(y.tag===1){var j=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof j.componentDidCatch=="function"&&(nt===null||!nt.has(j))){g=J(k,g),k=Si(2),j=ji(y,k,2),j!==null&&(po(k,j,y,g),R(j,2),At(j));break}}y=y.return}}function Kr(g,y,k){var j=g.pingCache;if(j===null){j=g.pingCache=new Rl;var ne=new Set;j.set(y,ne)}else ne=j.get(y),ne===void 0&&(ne=new Set,j.set(y,ne));ne.has(k)||(am=!0,ne.add(k),g=mT.bind(null,g,y,k),y.then(g,g))}function mT(g,y,k){var j=g.pingCache;j!==null&&j.delete(y),g.pingedLanes|=g.suspendedLanes&k,g.warmLanes&=~k,ws===g&&(Ei&k)===k&&(M===4||M===3&&(Ei&62914560)===Ei&&300>Fr()-ce?(Yr&2)===0&&ju(g,0):O|=k,V===Ei&&(V=0)),At(g)}function Z1(g,y){y===0&&(y=T()),g=An(g,y),g!==null&&(R(g,y),At(g))}function Hg(g){var y=g.memoizedState,k=0;y!==null&&(k=y.retryLane),Z1(g,k)}function Sy(g,y){var k=0;switch(g.tag){case 31:case 13:var j=g.stateNode,ne=g.memoizedState;ne!==null&&(k=ne.retryLane);break;case 19:j=g.stateNode;break;case 22:j=g.stateNode._retryCache;break;default:throw Error(i(314))}j!==null&&j.delete(y),Z1(g,k)}function gT(g,y){return Br(g,y)}function Nd(g,y,k,j){this.tag=g,this.key=k,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=j,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Za(g){return g=g.prototype,!(!g||!g.isReactComponent)}function Ns(g,y){var k=g.alternate;return k===null?(k=t(g.tag,y,g.key,g.mode),k.elementType=g.elementType,k.type=g.type,k.stateNode=g.stateNode,k.alternate=g,g.alternate=k):(k.pendingProps=y,k.type=g.type,k.flags=0,k.subtreeFlags=0,k.deletions=null),k.flags=g.flags&65011712,k.childLanes=g.childLanes,k.lanes=g.lanes,k.child=g.child,k.memoizedProps=g.memoizedProps,k.memoizedState=g.memoizedState,k.updateQueue=g.updateQueue,y=g.dependencies,k.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},k.sibling=g.sibling,k.index=g.index,k.ref=g.ref,k.refCleanup=g.refCleanup,k}function Kp(g,y){g.flags&=65011714;var k=g.alternate;return k===null?(g.childLanes=0,g.lanes=y,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=k.childLanes,g.lanes=k.lanes,g.child=k.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=k.memoizedProps,g.memoizedState=k.memoizedState,g.updateQueue=k.updateQueue,g.type=k.type,y=k.dependencies,g.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext}),g}function Ja(g,y,k,j,ne,le){var Ne=0;if(j=g,typeof g=="function")Za(g)&&(Ne=1);else if(typeof g=="string")Ne=Tl&&Hs?Jc(g,k,aa.current)?26:Fy(g)?27:5:Tl?Jc(g,k,aa.current)?26:5:Hs&&Fy(g)?27:5;else e:switch(g){case Zp:return g=t(31,k,y,ne),g.elementType=Zp,g.lanes=le,g;case Pd:return Gh(k.children,ne,le,y);case Dd:Ne=8,ne|=24;break;case qg:return g=t(12,k,y,ne|2),g.elementType=qg,g.lanes=le,g;case Df:return g=t(13,k,y,ne),g.elementType=Df,g.lanes=le,g;case $u:return g=t(19,k,y,ne),g.elementType=$u,g.lanes=le,g;default:if(typeof g=="object"&&g!==null)switch(g.$$typeof){case Zs:Ne=10;break e;case j_:Ne=9;break e;case Ac:Ne=11;break e;case Xp:Ne=14;break e;case Vu:Ne=16,j=null;break e}Ne=29,k=Error(i(130,g===null?"null":typeof g,"")),j=null}return y=t(Ne,k,y,ne),y.elementType=g,y.type=j,y.lanes=le,y}function Gh(g,y,k,j){return g=t(7,g,j,y),g.lanes=k,g}function Rr(g,y,k){return g=t(6,g,null,y),g.lanes=k,g}function na(g){var y=t(18,null,null,0);return y.stateNode=g,y}function Xc(g,y,k){return y=t(4,g.children!==null?g.children:[],g.key,y),y.lanes=k,y.stateNode={containerInfo:g.containerInfo,pendingChildren:null,implementation:g.implementation},y}function Ey(g,y,k,j,ne,le,Ne,Ze,St){this.tag=1,this.containerInfo=g,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ra,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=w(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=w(0),this.hiddenUpdates=w(null),this.identifierPrefix=j,this.onUncaughtError=ne,this.onCaughtError=le,this.onRecoverableError=Ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=St,this.incompleteTransitions=new Map}function Gg(g,y,k,j,ne,le,Ne,Ze,St,Dt,Kt,Xt){return g=new Ey(g,y,k,Ne,St,Dt,Kt,Xt,Ze),y=1,le===!0&&(y|=24),le=t(3,null,null,y),g.current=le,le.stateNode=g,y=et(),y.refCount++,g.pooledCache=y,y.refCount++,le.memoizedState={element:j,isDehydrated:k,cache:y},is(le),g}function Lo(g){return g?(g=Zh,g):Zh}function Wh(g){var y=g._reactInternals;if(y===void 0)throw typeof g.render=="function"?Error(i(188)):(g=Object.keys(g).join(","),Error(i(268,g)));return g=a(y),g=g!==null?c(g):null,g===null?null:Hu(g.stateNode)}function Wg(g,y,k,j,ne,le){ne=Lo(ne),j.context===null?j.context=ne:j.pendingContext=ne,j=ti(y),j.payload={element:k},le=le===void 0?null:le,le!==null&&(j.callback=le),k=ji(g,j,y),k!==null&&(Xa(k,g,y),ss(k,g,y))}function wc(g,y){if(g=g.memoizedState,g!==null&&g.dehydrated!==null){var k=g.retryLane;g.retryLane=k!==0&&k<y?k:y}}function Jt(g,y){wc(g,y),(g=g.alternate)&&wc(g,y)}var Sr={},Nf=yh,Ua=qde,Zc=Object.assign,F_=Symbol.for("react.element"),Pf=Symbol.for("react.transitional.element"),zu=Symbol.for("react.portal"),Pd=Symbol.for("react.fragment"),Dd=Symbol.for("react.strict_mode"),qg=Symbol.for("react.profiler"),j_=Symbol.for("react.consumer"),Zs=Symbol.for("react.context"),Ac=Symbol.for("react.forward_ref"),Df=Symbol.for("react.suspense"),$u=Symbol.for("react.suspense_list"),Xp=Symbol.for("react.memo"),Vu=Symbol.for("react.lazy"),Zp=Symbol.for("react.activity"),Ld=Symbol.for("react.memo_cache_sentinel"),Ud=Symbol.iterator,xy=Symbol.for("react.client.reference"),Jp=Array.isArray,dr=Nf.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ty=e.rendererVersion,Yg=e.rendererPackageName,Sl=e.extraDevToolsConfig,Hu=e.getPublicInstance,z_=e.getRootHostContext,Kg=e.getChildHostContext,wy=e.prepareForCommit,$_=e.resetAfterCommit,J1=e.createInstance;e.cloneMutableInstance;var Xg=e.appendInitialChild,Gu=e.finalizeInitialChildren,Qp=e.shouldSetTextContent,V_=e.createTextInstance;e.cloneMutableTextInstance;var _T=e.scheduleTimeout,Ay=e.cancelTimeout,ra=e.noTimeout,Ba=e.isPrimaryRenderer;e.warnsIfNotActing;var ia=e.supportsMutation,El=e.supportsPersistence,gi=e.supportsHydration,Bd=e.getInstanceFromNode;e.beforeActiveInstanceBlur;var vr=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var go=e.setCurrentUpdatePriority,sa=e.getCurrentUpdatePriority,fi=e.resolveUpdatePriority;e.trackSchedulerEvent,e.resolveEventType,e.resolveEventTimeStamp;var H_=e.shouldAttemptEagerTransition,eu=e.detachDeletedInstance;e.requestPostPaintCallback;var Ta=e.maySuspendCommit,Cy=e.maySuspendCommitOnUpdate,Zg=e.maySuspendCommitInSyncRender,Ry=e.preloadInstance,Co=e.startSuspendingCommit,Uo=e.suspendInstance;e.suspendOnActiveViewTransition;var em=e.waitForCommitToBeReady;e.getSuspendedCommitReason;var xl=e.NotPendingTransition,qh=e.HostTransitionContext,Jg=e.resetFormInstance;e.bindToConsole;var Lf=e.supportsMicrotasks,Wu=e.scheduleMicrotask,qu=e.supportsTestSelectors,Yu=e.findFiberRoot,tm=e.getBoundingRect,Fd=e.getTextContent,Yh=e.isHiddenSubtree,Qg=e.matchAccessibilityRole,e0=e.setFocusIfFocusable,nm=e.setupIntersectionObserver,t0=e.appendChild,Q1=e.appendChildToContainer,Ku=e.commitTextUpdate,jd=e.commitMount,eS=e.commitUpdate,tS=e.insertBefore,nS=e.insertInContainerBefore,G_=e.removeChild,rS=e.removeChildFromContainer,ky=e.resetTextContent,iS=e.hideInstance,sS=e.hideTextInstance,vT=e.unhideInstance,oS=e.unhideTextInstance;e.cancelViewTransitionName,e.cancelRootViewTransitionName,e.restoreRootViewTransitionName,e.cloneRootViewTransitionContainer,e.removeRootViewTransitionClone,e.measureClonedInstance,e.hasInstanceChanged,e.hasInstanceAffectedParent,e.startViewTransition,e.startGestureTransition,e.stopViewTransition,e.getCurrentGestureOffset,e.createViewTransitionInstance;var aS=e.clearContainer;e.createFragmentInstance,e.updateFragmentInstanceFiber,e.commitNewChildToFragmentInstance,e.deleteChildFromFragmentInstance;var _o=e.cloneInstance,My=e.createContainerChildSet,W_=e.appendChildToContainerChildSet,yT=e.finalizeContainerChildren,q_=e.replaceContainerChildren,cS=e.cloneHiddenInstance,lS=e.cloneHiddenTextInstance,Iy=e.isSuspenseInstancePending,n0=e.isSuspenseInstanceFallback,uS=e.getSuspenseInstanceFallbackErrorDetails,bT=e.registerSuspenseInstanceRetry,ST=e.canHydrateFormStateMarker,Y_=e.isFormStateMarkerMatching,rm=e.getNextHydratableSibling,im=e.getNextHydratableSiblingAfterSingleton,sm=e.getFirstHydratableChild,Uf=e.getFirstHydratableChildWithinContainer,Kh=e.getFirstHydratableChildWithinActivityInstance,Bf=e.getFirstHydratableChildWithinSuspenseInstance,K_=e.getFirstHydratableChildWithinSingleton,ET=e.canHydrateInstance,xT=e.canHydrateTextInstance,r0=e.canHydrateActivityInstance,hS=e.canHydrateSuspenseInstance,TT=e.hydrateInstance,i0=e.hydrateTextInstance,fS=e.hydrateActivityInstance,Xh=e.hydrateSuspenseInstance,dS=e.getNextHydratableInstanceAfterActivityInstance,pS=e.getNextHydratableInstanceAfterSuspenseInstance,s0=e.commitHydratedInstance,Oy=e.commitHydratedContainer,Ny=e.commitHydratedActivityInstance,X_=e.commitHydratedSuspenseInstance,Z_=e.finalizeHydratedChildren,Py=e.flushHydrationEvents;e.clearActivityBoundary;var Dy=e.clearSuspenseBoundary;e.clearActivityBoundaryFromContainer;var mS=e.clearSuspenseBoundaryFromContainer,o0=e.hideDehydratedBoundary,a0=e.unhideDehydratedBoundary,Bo=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var c0=e.validateHydratableInstance,gS=e.validateHydratableTextInstance,Tl=e.supportsResources,Jc=e.isHostHoistableType,l0=e.getHoistableRoot,Ly=e.getResource,Qc=e.acquireResource,Ur=e.releaseResource,wT=e.hydrateHoistable,Qa=e.mountHoistable,Js=e.unmountHoistable,Ff=e.createHoistableInstance,AT=e.prepareToCommitHoistables,Uy=e.mayResourceSuspendCommit,wl=e.preloadResource,J_=e.suspendResource,Hs=e.supportsSingletons,vs=e.resolveSingletonInstance,Qs=e.acquireSingletonInstance,By=e.releaseSingletonInstance,Fy=e.isHostSingletonType,tu=e.isSingletonScope,u0=[],Xu=-1,Zh={},Es=Math.clz32?Math.clz32:m,Zu=Math.log,Q_=Math.LN2,h0=256,f0=262144,Al=4194304,Br=Ua.unstable_scheduleCallback,ev=Ua.unstable_cancelCallback,Cl=Ua.unstable_shouldYield,_S=Ua.unstable_requestPaint,Fr=Ua.unstable_now,vS=Ua.unstable_ImmediatePriority,yS=Ua.unstable_UserBlockingPriority,zd=Ua.unstable_NormalPriority,CT=Ua.unstable_IdlePriority,RT=Ua.log,kT=Ua.unstable_setDisableYieldValue,d0=null,ec=null,tc=typeof Object.is=="function"?Object.is:P,bS=typeof reportError=="function"?reportError:function(g){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof g=="object"&&g!==null&&typeof g.message=="string"?String(g.message):String(g),error:g});if(!window.dispatchEvent(y))return}else if(typeof Ga=="object"&&typeof Ga.emit=="function"){Ga.emit("uncaughtException",g);return}console.error(g)},MT=Object.prototype.hasOwnProperty,jy,Ro,Fo=!1,nc=new WeakMap,oa=[],Ni=0,tv=null,$d=0,el=[],Cc=0,Rc=null,Ju=1,nu="",aa=f(null),p0=f(null),jf=f(null),nv=f(null),jo=null,li=null,_i=!1,ru=null,tl=!1,zf=Error(i(519)),ca=f(null),Jh=null,Qu=null,SS=typeof AbortController<"u"?AbortController:function(){var g=[],y=this.signal={aborted:!1,addEventListener:function(k,j){g.push(j)}};this.abort=function(){y.aborted=!0,g.forEach(function(k){return k()})}},ys=Ua.unstable_scheduleCallback,rv=Ua.unstable_NormalPriority,Ps={$$typeof:Zs,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},iv=null,xs=null,Qh=!1,m0=!1,sv=!1,Vd=0,om=null,zy=0,eh=0,Ts=null,Hd=dr.S;dr.S=function(g,y){de=Fr(),typeof y=="object"&&y!==null&&typeof y.then=="function"&&Ye(g,y),Hd!==null&&Hd(g,y)};var Ds=f(null),kc=Error(i(460)),$y=Error(i(474)),$f=Error(i(542)),ef={then:function(){}},eo=null,Gs=null,th=0,x=mt(!0),D=mt(!1),Z=[],ge=0,Ie=0,He=!1,ct=!1,ft=f(null),kt=f(0),Wt=f(null),Yt=null,nn=f(0),Gn=0,pn=null,Nn=null,Vt=null,mn=!1,nr=!1,Rn=!1,gr=0,Er=0,si=null,tr=0,jn={readContext:ze,use:Mi,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useLayoutEffect:Cn,useInsertionEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useSyncExternalStore:Cn,useId:Cn,useHostTransitionStatus:Cn,useFormState:Cn,useActionState:Cn,useOptimistic:Cn,useMemoCache:Cn,useCacheRefresh:Cn};jn.useEffectEvent=Cn;var wi={readContext:ze,use:Mi,useCallback:function(g,y){return bi().memoizedState=[g,y===void 0?null:y],g},useContext:ze,useEffect:hr,useImperativeHandle:function(g,y,k){k=k!=null?k.concat([g]):null,Lh(4194308,4,Tg.bind(null,y,g),k)},useLayoutEffect:function(g,y){return Lh(4194308,4,g,y)},useInsertionEffect:function(g,y){Lh(4,2,g,y)},useMemo:function(g,y){var k=bi();y=y===void 0?null:y;var j=g();if(Rn){L(!0);try{g()}finally{L(!1)}}return k.memoizedState=[j,y],j},useReducer:function(g,y,k){var j=bi();if(k!==void 0){var ne=k(y);if(Rn){L(!0);try{k(y)}finally{L(!1)}}}else ne=y;return j.memoizedState=j.baseState=ne,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:ne},j.queue=g,g=g.dispatch=H1.bind(null,pn,g),[j.memoizedState,g]},useRef:function(g){var y=bi();return g={current:g},y.memoizedState=g},useState:function(g){g=Pp(g);var y=g.queue,k=Xl.bind(null,pn,y);return y.dispatch=k,[g.memoizedState,k]},useDebugValue:wg,useDeferredValue:function(g,y){var k=bi();return Nu(k,g,y)},useTransition:function(){var g=Pp(!1);return g=fy.bind(null,pn,g.queue,!0,!1),bi().memoizedState=g,[!1,g]},useSyncExternalStore:function(g,y,k){var j=pn,ne=bi();if(_i){if(k===void 0)throw Error(i(407));k=k()}else{if(k=y(),ws===null)throw Error(i(349));(Ei&127)!==0||Gc(j,y,k)}ne.memoizedState=k;var le={value:k,getSnapshot:y};return ne.queue=le,hr(v_.bind(null,j,le,g),[g]),j.flags|=2048,wf(9,{destroy:void 0},Sg.bind(null,j,le,k,y),null),k},useId:function(){var g=bi(),y=ws.identifierPrefix;if(_i){var k=nu,j=Ju;k=(j&~(1<<32-Es(j)-1)).toString(32)+k,y="_"+y+"R_"+k,k=gr++,0<k&&(y+="H"+k.toString(32)),y+="_"}else k=tr++,y="_"+y+"r_"+k.toString(32)+"_";return g.memoizedState=y},useHostTransitionStatus:gl,useFormState:Ss,useActionState:Ss,useOptimistic:function(g){var y=bi();y.memoizedState=y.baseState=g;var k={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return y.queue=k,y=$s.bind(null,pn,!0,k),k.dispatch=y,[g,y]},useMemoCache:Mn,useCacheRefresh:function(){return bi().memoizedState=dy.bind(null,pn)},useEffectEvent:function(g){var y=bi(),k={impl:g};return y.memoizedState=k,function(){if((Yr&2)!==0)throw Error(i(440));return k.impl.apply(void 0,arguments)}}},Ls={readContext:ze,use:Mi,useCallback:xc,useContext:ze,useEffect:xg,useImperativeHandle:Da,useInsertionEffect:Uh,useLayoutEffect:x_,useMemo:T_,useReducer:Kn,useRef:Ou,useState:function(){return Kn(Li)},useDebugValue:wg,useDeferredValue:function(g,y){var k=ai();return fo(k,Nn.memoizedState,g,y)},useTransition:function(){var g=Kn(Li)[0],y=ai().memoizedState;return[typeof g=="boolean"?g:ho(g),y]},useSyncExternalStore:_s,useId:ks,useHostTransitionStatus:gl,useFormState:bc,useActionState:bc,useOptimistic:function(g,y){var k=ai();return ba(k,Nn,g,y)},useMemoCache:Mn,useCacheRefresh:Qo};Ls.useEffectEvent=E_;var wa={readContext:ze,use:Mi,useCallback:xc,useContext:ze,useEffect:xg,useImperativeHandle:Da,useInsertionEffect:Uh,useLayoutEffect:x_,useMemo:T_,useReducer:pl,useRef:Ou,useState:function(){return pl(Li)},useDebugValue:wg,useDeferredValue:function(g,y){var k=ai();return Nn===null?Nu(k,g,y):fo(k,Nn.memoizedState,g,y)},useTransition:function(){var g=pl(Li)[0],y=ai().memoizedState;return[typeof g=="boolean"?g:ho(g),y]},useSyncExternalStore:_s,useId:ks,useHostTransitionStatus:gl,useFormState:qc,useActionState:qc,useOptimistic:function(g,y){var k=ai();return Nn!==null?ba(k,Nn,g,y):(k.baseState=g,[g,k.queue.dispatch])},useMemoCache:Mn,useCacheRefresh:Qo};wa.useEffectEvent=E_;var cs={enqueueSetState:function(g,y,k){g=g._reactInternals;var j=Xi(),ne=ti(j);ne.payload=y,k!=null&&(ne.callback=k),y=ji(g,ne,j),y!==null&&(Xa(y,g,j),ss(y,g,j))},enqueueReplaceState:function(g,y,k){g=g._reactInternals;var j=Xi(),ne=ti(j);ne.tag=1,ne.payload=y,k!=null&&(ne.callback=k),y=ji(g,ne,j),y!==null&&(Xa(y,g,j),ss(y,g,j))},enqueueForceUpdate:function(g,y){g=g._reactInternals;var k=Xi(),j=ti(k);j.tag=2,y!=null&&(j.callback=y),y=ji(g,j,k),y!==null&&(Xa(y,g,k),ss(y,g,k))}},zo=Error(i(461)),$i=!1,nh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null},nl=!1,Us=!1,Gd=!1,iu=typeof WeakSet=="function"?WeakSet:Set,vo=null,yo=null,Aa=!1,ls=null,su=8192,ou={getCacheForType:function(g){var y=ze(Ps),k=y.data.get(g);return k===void 0&&(k=g(),y.data.set(g,k)),k},cacheSignal:function(){return ze(Ps).controller.signal}},g0=0,Wd=1,Vf=2,Vy=3,ES=4;if(typeof Symbol=="function"&&Symbol.for){var $o=Symbol.for;g0=$o("selector.component"),Wd=$o("selector.has_pseudo_class"),Vf=$o("selector.role"),Vy=$o("selector.test_id"),ES=$o("selector.text")}var Rl=typeof WeakMap=="function"?WeakMap:Map,Yr=0,ws=null,ar=null,Ei=0,us=0,rc=null,qd=!1,ov=!1,am=!1,Yd=0,M=0,E=0,A=0,O=0,F=0,V=0,K=null,ue=null,me=!1,ce=0,de=0,we=1/0,Me=null,nt=null,bt=0,ut=null,dt=null,Qe=0,st=0,It=null,En=null,Dn=0,Xn=null;return Sr.attemptContinuousHydration=function(g){if(g.tag===13||g.tag===31){var y=An(g,67108864);y!==null&&Xa(y,g,67108864),Jt(g,67108864)}},Sr.attemptHydrationAtCurrentPriority=function(g){if(g.tag===13||g.tag===31){var y=Xi();y=$(y);var k=An(g,y);k!==null&&Xa(k,g,y),Jt(g,y)}},Sr.attemptSynchronousHydration=function(g){switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var y=_(g.pendingLanes);if(y!==0){for(g.pendingLanes|=2,g.entangledLanes|=2;y;){var k=1<<31-Es(y);g.entanglements[1]|=k,y&=~k}At(g),(Yr&6)===0&&(we=Fr()+500,Ce(0))}}break;case 31:case 13:y=An(g,2),y!==null&&Xa(y,g,2),gy(),Jt(g,2)}},Sr.batchedUpdates=function(g,y){return g(y)},Sr.createComponentSelector=function(g){return{$$typeof:g0,value:g}},Sr.createContainer=function(g,y,k,j,ne,le,Ne,Ze,St,Dt){return Gg(g,y,!1,null,k,j,le,null,Ne,Ze,St,Dt)},Sr.createHasPseudoClassSelector=function(g){return{$$typeof:Wd,value:g}},Sr.createHydrationContainer=function(g,y,k,j,ne,le,Ne,Ze,St,Dt,Kt,Xt,vn,Zn){var Nr;return g=Gg(k,j,!0,g,ne,le,Ze,Zn,St,Dt,Kt,Xt),g.context=Lo(null),k=g.current,j=Xi(),j=$(j),ne=ti(j),ne.callback=(Nr=y)!=null?Nr:null,ji(k,ne,j),y=j,g.current.lanes=y,R(g,y),At(g),g},Sr.createPortal=function(g,y,k){var j=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:zu,key:j==null?null:""+j,children:g,containerInfo:y,implementation:k}},Sr.createRoleSelector=function(g){return{$$typeof:Vf,value:g}},Sr.createTestNameSelector=function(g){return{$$typeof:Vy,value:g}},Sr.createTextSelector=function(g){return{$$typeof:ES,value:g}},Sr.defaultOnCaughtError=function(g){console.error(g)},Sr.defaultOnRecoverableError=function(g){bS(g)},Sr.defaultOnUncaughtError=function(g){bS(g)},Sr.deferredUpdates=function(g){var y=dr.T,k=sa();try{return go(32),dr.T=null,g()}finally{go(k),dr.T=y}},Sr.discreteUpdates=function(g,y,k,j,ne){var le=dr.T,Ne=sa();try{return go(2),dr.T=null,g(y,k,j,ne)}finally{go(Ne),dr.T=le,Yr===0&&(we=Fr()+500)}},Sr.findAllNodes=Tr,Sr.findBoundingRects=function(g,y){if(!qu)throw Error(i(363));y=Tr(g,y),g=[];for(var k=0;k<y.length;k++)g.push(tm(y[k]));for(y=g.length-1;0<y;y--){k=g[y];for(var j=k.x,ne=j+k.width,le=k.y,Ne=le+k.height,Ze=y-1;0<=Ze;Ze--)if(y!==Ze){var St=g[Ze],Dt=St.x,Kt=Dt+St.width,Xt=St.y,vn=Xt+St.height;if(j>=Dt&&le>=Xt&&ne<=Kt&&Ne<=vn){g.splice(y,1);break}else if(j!==Dt||k.width!==St.width||vn<le||Xt>Ne){if(!(le!==Xt||k.height!==St.height||Kt<j||Dt>ne)){Dt>j&&(St.width+=Dt-j,St.x=j),Kt<ne&&(St.width=ne-Dt),g.splice(y,1);break}}else{Xt>le&&(St.height+=Xt-le,St.y=le),vn<Ne&&(St.height=Ne-Xt),g.splice(y,1);break}}}return g},Sr.findHostInstance=Wh,Sr.findHostInstanceWithNoPortals=function(g){return g=a(g),g=g!==null?l(g):null,g===null?null:Hu(g.stateNode)},Sr.findHostInstanceWithWarning=function(g){return Wh(g)},Sr.flushPassiveEffects=Hh,Sr.flushSyncFromReconciler=function(g){var y=Yr;Yr|=1;var k=dr.T,j=sa();try{if(go(2),dr.T=null,g)return g()}finally{go(j),dr.T=k,Yr=y,(Yr&6)===0&&Ce(0)}},Sr.flushSyncWork=gy,Sr.focusWithin=function(g,y){if(!qu)throw Error(i(363));for(g=Fu(g),y=Md(g,y),y=Array.from(y),g=0;g<y.length;){var k=y[g++],j=k.tag;if(!Yh(k)){if((j===5||j===26||j===27)&&e0(k.stateNode))return!0;for(k=k.child;k!==null;)y.push(k),k=k.sibling}}return!1},Sr.getFindAllNodesFailureDescription=function(g,y){if(!qu)throw Error(i(363));var k=0,j=[];g=[Fu(g),0];for(var ne=0;ne<g.length;){var le=g[ne++],Ne=le.tag,Ze=g[ne++],St=y[Ze];if((Ne!==5&&Ne!==26&&Ne!==27||!Yh(le))&&(Fg(le,St)&&(j.push(jg(St)),Ze++,Ze>k&&(k=Ze)),Ze<y.length))for(le=le.child;le!==null;)g.push(le,Ze),le=le.sibling}if(k<y.length){for(g=[];k<y.length;k++)g.push(jg(y[k]));return`findAllNodes was able to match part of the selector:
  `+(j.join(" > ")+`

No matching component was found for:
  `)+g.join(" > ")}return null},Sr.getPublicRootInstance=function(g){if(g=g.current,!g.child)return null;switch(g.child.tag){case 27:case 5:return Hu(g.child.stateNode);default:return g.child.stateNode}},Sr.injectIntoDevTools=function(){var g={bundleType:0,version:Ty,rendererPackageName:Yg,currentDispatcherRef:dr,reconcilerVersion:"19.2.0"};if(Sl!==null&&(g.rendererConfig=Sl),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")g=!1;else{var y=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(y.isDisabled||!y.supportsFiber)g=!0;else{try{d0=y.inject(g),ec=y}catch{}g=!!y.checkDCE}}return g},Sr.isAlreadyRendering=function(){return(Yr&6)!==0},Sr.observeVisibleRects=function(g,y,k,j){if(!qu)throw Error(i(363));g=Tr(g,y);var ne=nm(g,k,j).disconnect;return{disconnect:function(){ne()}}},Sr.shouldError=function(){return null},Sr.shouldSuspend=function(){return!1},Sr.startHostTransition=function(g,y,k,j){if(g.tag!==5)throw Error(i(476));var ne=w_(g).queue;fy(g,ne,y,xl,k===null?r:function(){var le=w_(g);return le.next===null&&(le=g.alternate.memoizedState),Po(g,le.next.queue,{},Xi()),k(j)})},Sr.updateContainer=function(g,y,k,j){var ne=y.current,le=Xi();return Wg(ne,le,g,y,k,j),le},Sr.updateContainerSync=function(g,y,k,j){return Wg(y.current,2,g,y,k,j),2},Sr},n.exports.default=n.exports,Object.defineProperty(n.exports,"__esModule",{value:!0})})(y7)),y7.exports}var S7;function dpe(){return S7||(S7=1,v7.exports=fpe()),v7.exports}var ppe=dpe();const mpe=hpe(ppe);function gpe(n){const e=mpe(n);return e.injectIntoDevTools(),e}const GW=0,rx={},_pe=/^three(?=[A-Z])/,aO=n=>`${n[0].toUpperCase()}${n.slice(1)}`;let vpe=0;const ype=n=>typeof n=="function";function WW(n){if(ype(n)){const e=`${vpe++}`;return rx[e]=n,e}else Object.assign(rx,n)}function qW(n,e){const t=aO(n),r=rx[t];if(n!=="primitive"&&!r)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(n==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function bpe(n,e,t){var r;return n=aO(n)in rx?n:n.replace(_pe,""),qW(n,e),n==="primitive"&&(r=e.object)!=null&&r.__r3f&&delete e.object.__r3f,EM(e.object,t,n,e)}function Spe(n){if(!n.isHidden){var e;n.props.attach&&(e=n.parent)!=null&&e.object?TM(n.parent,n):hu(n.object)&&(n.object.visible=!1),n.isHidden=!0,$x(n)}}function YW(n){if(n.isHidden){var e;n.props.attach&&(e=n.parent)!=null&&e.object?xM(n.parent,n):hu(n.object)&&n.props.visible!==!1&&(n.object.visible=!0),n.isHidden=!1,$x(n)}}function C5(n,e,t){const r=e.root.getState();if(!(!n.parent&&n.object!==r.scene)){if(!e.object){var i,s;const o=rx[aO(e.type)];e.object=(i=e.props.object)!=null?i:new o(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(Av(e.object,e.props),e.props.attach)xM(n,e);else if(hu(e.object)&&hu(n.object)){const o=n.object.children.indexOf(t?.object);if(t&&o!==-1){const a=n.object.children.indexOf(e.object);if(a!==-1){n.object.children.splice(a,1);const c=a<o?o-1:o;n.object.children.splice(c,0,e.object)}else e.object.parent=n.object,n.object.children.splice(o,0,e.object),e.object.dispatchEvent({type:"added"}),n.object.dispatchEvent({type:"childadded",child:e.object})}else n.object.add(e.object)}for(const o of e.children)C5(e,o);$x(e)}}function CN(n,e){e&&(e.parent=n,n.children.push(e),C5(n,e))}function E7(n,e,t){if(!e||!t)return;e.parent=n;const r=n.children.indexOf(t);r!==-1?n.children.splice(r,0,e):n.children.push(e),C5(n,e,t)}function KW(n){if(typeof n.dispose=="function"){const e=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():mL.unstable_scheduleCallback(mL.unstable_IdlePriority,e)}}function _L(n,e,t){if(!e)return;e.parent=null;const r=n.children.indexOf(e);r!==-1&&n.children.splice(r,1),e.props.attach?TM(n,e):hu(e.object)&&hu(n.object)&&(n.object.remove(e.object),npe(UW(e),e.object));const i=e.props.dispose!==null&&t!==!1;for(let s=e.children.length-1;s>=0;s--){const o=e.children[s];_L(e,o,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&KW(e.object),t===void 0&&$x(e)}function Epe(n,e){for(const t of[n,n.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const r=t.ref(e);typeof r=="function"&&(t.refCleanup=r)}else t.ref&&(t.ref.current=e)}const Ik=[];function xpe(){for(const[t]of Ik){const r=t.parent;if(r){t.props.attach?TM(r,t):hu(t.object)&&hu(r.object)&&r.object.remove(t.object);for(const i of t.children)i.props.attach?TM(t,i):hu(i.object)&&hu(t.object)&&t.object.remove(i.object)}t.isHidden&&YW(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&KW(t.object)}for(const[t,r,i]of Ik){t.props=r;const s=t.parent;if(s){var n,e;const o=rx[aO(t.type)];t.object=(n=t.props.object)!=null?n:new o(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,Epe(i,t.object),Av(t.object,t.props),t.props.attach?xM(s,t):hu(t.object)&&hu(s.object)&&s.object.add(t.object);for(const a of t.children)a.props.attach?xM(t,a):hu(a.object)&&hu(t.object)&&t.object.add(a.object);$x(t)}}Ik.length=0}const RN=()=>{},x7={};let xR=GW;const Tpe=0,wpe=4,wM=gpe({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:bpe,removeChild:_L,appendChild:CN,appendInitialChild:CN,insertBefore:E7,appendChildToContainer(n,e){const t=n.getState().scene.__r3f;!e||!t||CN(t,e)},removeChildFromContainer(n,e){const t=n.getState().scene.__r3f;!e||!t||_L(t,e)},insertInContainerBefore(n,e,t){const r=n.getState().scene.__r3f;!e||!t||!r||E7(r,e,t)},getRootHostContext:()=>x7,getChildHostContext:()=>x7,commitUpdate(n,e,t,r,i){var s,o,a;qW(e,r);let c=!1;if((n.type==="primitive"&&t.object!==r.object||((s=r.args)==null?void 0:s.length)!==((o=t.args)==null?void 0:o.length)||(a=r.args)!=null&&a.some((u,h)=>{var f;return u!==((f=t.args)==null?void 0:f[h])}))&&(c=!0),c)Ik.push([n,{...r},i]);else{const u=Qde(n,r);Object.keys(u).length&&(Object.assign(n.props,u),Av(n.object,u))}(i.sibling===null||(i.flags&wpe)===Tpe)&&xpe()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:n=>n?.object,prepareForCommit:()=>null,preparePortalMount:n=>EM(n.getState().scene,n,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:Spe,unhideInstance:YW,createTextInstance:RN,hideTextInstance:RN,unhideTextInstance:RN,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Ke.createContext(null),setCurrentUpdatePriority(n){xR=n},getCurrentUpdatePriority(){return xR},resolveUpdatePriority(){var n;if(xR!==GW)return xR;switch(typeof window<"u"&&((n=window.event)==null?void 0:n.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return lpe;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ape;default:return cpe}},resetFormInstance(){},rendererPackageName:"@react-three/fiber",rendererVersion:upe.version,applyViewTransitionName(n,e,t){},restoreViewTransitionName(n,e){},cancelViewTransitionName(n,e,t){},cancelRootViewTransitionName(n){},restoreRootViewTransitionName(n){},InstanceMeasurement:null,measureInstance:n=>null,wasInstanceInViewport:n=>!0,hasInstanceChanged:(n,e)=>!1,hasInstanceAffectedParent:(n,e)=>!1,suspendOnActiveViewTransition(n,e){},startGestureTransition:()=>null,startViewTransition:()=>null,stopViewTransition(n){},createViewTransitionInstance:n=>null,getCurrentGestureOffset(n){throw new Error("startGestureTransition is not yet supported in react-three-fiber.")},cloneMutableInstance(n,e){return n},cloneMutableTextInstance(n){return n},cloneRootViewTransitionContainer(n){throw new Error("Not implemented.")},removeRootViewTransitionClone(n,e){throw new Error("Not implemented.")},createFragmentInstance:n=>null,updateFragmentInstanceFiber(n,e){},commitNewChildToFragmentInstance(n,e){},deleteChildFromFragmentInstance(n,e){},measureClonedInstance:n=>null,maySuspendCommitOnUpdate:(n,e,t)=>!1,maySuspendCommitInSyncRender:(n,e)=>!1,startSuspendingCommit:()=>null,getSuspendedCommitReason:(n,e)=>null}),Wb=new Map,GS={objects:"shallow",strict:!1};function Ape(n,e){if(!e&&typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:t,height:r,top:i,left:s}=n.parentElement.getBoundingClientRect();return{width:t,height:r,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function Cpe(n){const e=Wb.get(n),t=e?.fiber,r=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=r||ipe(bL,w7),o=t||wM.createContainer(s,ope,null,!1,null,"",i,i,i,null);e||Wb.set(n,{fiber:o,store:s});let a,c,l=!1,u=null;return{async configure(h={}){let f;u=new Promise(z=>f=z);let{gl:d,size:p,scene:m,events:_,onCreated:v,shadows:S=!1,linear:b=!1,flat:T=!1,legacy:w=!1,orthographic:R=!1,frameloop:C="always",dpr:N=[1,2],performance:U,raycaster:B,camera:$,onPointerMissed:I}=h,L=s.getState(),P=L.gl;if(!L.gl){const z={canvas:n,powerPreference:"high-performance",antialias:!0,alpha:!0},q=typeof d=="function"?await d(z):d;g7(q)?P=q:P=new Ode({...z,...d}),L.set({gl:P})}let H=L.raycaster;H||L.set({raycaster:H=new CW});const{params:X,...G}=B||{};if(Mo.equ(G,H,GS)||Av(H,{...G}),Mo.equ(X,H.params,GS)||Av(H,{params:{...H.params,...X}}),!L.camera||L.camera===c&&!Mo.equ(c,$,GS)){c=$;const z=$?.isCamera,q=z?$:R?new iO(0,0,0,0,.1,1e3):new du(75,0,.1,1e3);z||(q.position.z=5,$&&(Av(q,$),q.manual||("aspect"in $||"left"in $||"right"in $||"bottom"in $||"top"in $)&&(q.manual=!0,q.updateProjectionMatrix())),!L.camera&&!($!=null&&$.rotation)&&q.lookAt(0,0,0)),L.set({camera:q}),H.camera=q}if(!L.scene){let z;m!=null&&m.isScene?(z=m,EM(z,s,"",{})):(z=new SM,EM(z,s,"",{}),m&&Av(z,m)),L.set({scene:z})}_&&!L.events.handlers&&L.set({events:_(s)});const Y=Ape(n,p);if(Mo.equ(Y,L.size,GS)||L.setSize(Y.width,Y.height,Y.top,Y.left),N&&L.viewport.dpr!==jW(N)&&L.setDpr(N),L.frameloop!==C&&L.setFrameloop(C),L.onPointerMissed||L.set({onPointerMissed:I}),U&&!Mo.equ(U,L.performance,GS)&&L.set(z=>({performance:{...z.performance,...U}})),!L.xr){var J;const z=(te,ie)=>{const Ee=s.getState();Ee.frameloop!=="never"&&w7(te,!0,Ee,ie)},q=()=>{const te=s.getState();te.gl.xr.enabled=te.gl.xr.isPresenting,te.gl.xr.setAnimationLoop(te.gl.xr.isPresenting?z:null),te.gl.xr.isPresenting||bL(te)},ee={connect(){const te=s.getState().gl;te.xr.addEventListener("sessionstart",q),te.xr.addEventListener("sessionend",q)},disconnect(){const te=s.getState().gl;te.xr.removeEventListener("sessionstart",q),te.xr.removeEventListener("sessionend",q)}};typeof((J=P.xr)==null?void 0:J.addEventListener)=="function"&&ee.connect(),L.set({xr:ee})}if(P.shadowMap){const z=P.shadowMap.enabled,q=P.shadowMap.type;if(P.shadowMap.enabled=!!S,Mo.boo(S))P.shadowMap.type=xk;else if(Mo.str(S)){var Q;const ee={basic:oae,percentage:u5,soft:xk,variance:Tm};P.shadowMap.type=(Q=ee[S])!=null?Q:xk}else Mo.obj(S)&&Object.assign(P.shadowMap,S);(z!==P.shadowMap.enabled||q!==P.shadowMap.type)&&(P.shadowMap.needsUpdate=!0)}return Zi.enabled=!w,l||(P.outputColorSpace=b?Z0:Fi,P.toneMapping=T?$0:cW),L.legacy!==w&&L.set(()=>({legacy:w})),L.linear!==b&&L.set(()=>({linear:b})),L.flat!==T&&L.set(()=>({flat:T})),d&&!Mo.fun(d)&&!g7(d)&&!Mo.equ(d,P,GS)&&Av(P,d),a=v,l=!0,f(),this},render(h){return!l&&!u&&this.configure(),u.then(()=>{wM.updateContainer(be.jsx(Rpe,{store:s,children:h,onCreated:a,rootElement:n}),o,null,()=>{})}),s},unmount(){kpe(n)}}}function Rpe({store:n,children:e,onCreated:t,rootElement:r}){return x5(()=>{const i=n.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),n.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),be.jsx(T5.Provider,{value:n,children:e})}function kpe(n,e){const t=Wb.get(n),r=t?.fiber;if(r){const i=t?.store.getState();i&&(i.internal.active=!1),wM.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var s,o,a,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),Xde(i.scene),Wb.delete(n)}catch{}},500)})}}function Mpe(n,e,t){return be.jsx(Ipe,{children:n,container:e,state:t})}function Ipe({state:n={},children:e,container:t}){const{events:r,size:i,...s}=n,o=w5(),[a]=Ke.useState(()=>new CW),[c]=Ke.useState(()=>new zn),l=FW((h,f)=>{let d;if(f.camera&&i){const p=f.camera;d=h.viewport.getCurrentViewport(p,new zt,i),p!==h.camera&&$W(p,i)}return{...h,...f,scene:t,raycaster:a,pointer:c,mouse:c,previousRoot:o,events:{...h.events,...f.events,...r},size:{...h.size,...i},viewport:{...h.viewport,...d},setEvents:p=>f.set(m=>({...m,events:{...m.events,...p}}))}}),u=Ke.useMemo(()=>{const h=NW((d,p)=>({...s,set:d,get:p})),f=d=>h.setState(p=>l.current(d,p));return f(o.getState()),o.subscribe(f),h},[o,t]);return be.jsx(be.Fragment,{children:wM.createPortal(be.jsx(T5.Provider,{value:u,children:e}),u,null)})}function XW(n,e){const t={callback:n};return e.add(t),()=>{e.delete(t)}}const ZW=new Set,JW=new Set,Ope=new Set,Npe=n=>XW(n,ZW),Ppe=n=>XW(n,JW);function kN(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function Dw(n,e){switch(n){case"before":return kN(ZW,e);case"after":return kN(JW,e);case"tail":return kN(Ope,e)}}let MN,IN;function vL(n,e,t){let r=e.clock.getDelta();e.frameloop==="never"&&typeof n=="number"&&(r=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),MN=e.internal.subscribers;for(let i=0;i<MN.length;i++)IN=MN[i],IN.ref.current(IN.store.getState(),r,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let AM=!1,yL=!1,ON,T7,WS;function QW(n){T7=requestAnimationFrame(QW),AM=!0,ON=0,Dw("before",n),yL=!0;for(const t of Wb.values()){var e;WS=t.store.getState(),WS.internal.active&&(WS.frameloop==="always"||WS.internal.frames>0)&&!((e=WS.gl.xr)!=null&&e.isPresenting)&&(ON+=vL(n,WS))}if(yL=!1,Dw("after",n),ON===0)return Dw("tail",n),AM=!1,cancelAnimationFrame(T7)}function bL(n,e=1){var t;if(!n)return Wb.forEach(r=>bL(r.store.getState(),e));(t=n.gl.xr)!=null&&t.isPresenting||!n.internal.active||n.frameloop==="never"||(e>1?n.internal.frames=Math.min(60,n.internal.frames+e):yL?n.internal.frames=2:n.internal.frames=1,AM||(AM=!0,requestAnimationFrame(QW)))}function w7(n,e=!0,t,r){if(e&&Dw("before",n),t)vL(n,t,r);else for(const i of Wb.values())vL(n,i.store.getState());e&&Dw("after",n)}const NN={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Dpe(n){const{handlePointer:e}=rpe(n);return{priority:1,enabled:!0,compute(t,r,i){r.pointer.set(t.offsetX/r.size.width*2-1,-(t.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(NN).reduce((t,r)=>({...t,[r]:e(r)}),{}),update:()=>{var t;const{events:r,internal:i}=n.getState();(t=i.lastEvent)!=null&&t.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:r,events:i}=n.getState();if(i.disconnect==null||i.disconnect(),r(s=>({events:{...s.events,connected:t}})),i.handlers)for(const s in i.handlers){const o=i.handlers[s],[a,c]=NN[s];t.addEventListener(a,o,{passive:c})}},disconnect:()=>{const{set:t,events:r}=n.getState();if(r.connected){if(r.handlers)for(const i in r.handlers){const s=r.handlers[i],[o]=NN[i];r.connected.removeEventListener(o,s)}t(i=>({events:{...i.events,connected:void 0}}))}}}}var TR={exports:{}},A7;function Lpe(){if(A7)return TR.exports;A7=1;function n(e,t=100,r={}){if(typeof e!="function")throw new TypeError(`Expected the first parameter to be a function, got \`${typeof e}\`.`);if(t<0)throw new RangeError("`wait` must not be negative.");const{immediate:i}=typeof r=="boolean"?{immediate:r}:r;let s,o,a,c,l;function u(){const d=s,p=o;return s=void 0,o=void 0,l=e.apply(d,p),l}function h(){const d=Date.now()-c;d<t&&d>=0?a=setTimeout(h,t-d):(a=void 0,i||(l=u()))}const f=function(...d){if(s&&this!==s&&Object.getPrototypeOf(this)===Object.getPrototypeOf(s))throw new Error("Debounced method called with different contexts of the same prototype.");s=this,o=d,c=Date.now();const p=i&&!a;return a||(a=setTimeout(h,t)),p&&(l=u()),l};return Object.defineProperty(f,"isPending",{get(){return a!==void 0}}),f.clear=()=>{a&&(clearTimeout(a),a=void 0)},f.flush=()=>{a&&f.trigger()},f.trigger=()=>{l=u(),f.clear()},f}return TR.exports.debounce=n,TR.exports=n,TR.exports}var Upe=Lpe();const Bpe=wu(Upe),bn=60,wr=25,cg=bn*wr;var Jr=(n=>(n[n.ERROR=0]="ERROR",n[n.LOADER=1]="LOADER",n[n.BOARD=2]="BOARD",n[n.OBJECT=3]="OBJECT",n[n.TERRAIN=4]="TERRAIN",n[n.CHARSET=5]="CHARSET",n[n.PALETTE=6]="PALETTE",n))(Jr||{}),ac=(n=>(n.MAIN="main",n.TEMP="temp",n.TITLE="title",n.PLAYER="player",n.GADGETSTORE="gadgetstore",n))(ac||{});var Fpe=(function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),jpe=Object.prototype.hasOwnProperty;function SL(n,e){return jpe.call(n,e)}function EL(n){if(Array.isArray(n)){for(var e=new Array(n.length),t=0;t<e.length;t++)e[t]=""+t;return e}if(Object.keys)return Object.keys(n);var r=[];for(var i in n)SL(n,i)&&r.push(i);return r}function bh(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function xL(n){for(var e=0,t=n.length,r;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function fb(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function eq(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function TL(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(var e=0,t=n.length;e<t;e++)if(TL(n[e]))return!0}else if(typeof n=="object"){for(var r=EL(n),i=r.length,s=0;s<i;s++)if(TL(n[r[s]]))return!0}}return!1}function C7(n,e){var t=[n];for(var r in e){var i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(r+": "+i)}return t.join(`
`)}var tq=(function(n){Fpe(e,n);function e(t,r,i,s,o){var a=this.constructor,c=n.call(this,C7(t,{name:r,index:i,operation:s,tree:o}))||this;return c.name=r,c.index=i,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=C7(t,{name:r,index:i,operation:s,tree:o}),c}return e})(Error),ha=tq,zpe=bh,wE={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){var r=CM(t,this.path);r&&(r=bh(r));var i=Ob(t,{op:"remove",path:this.from}).removed;return Ob(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){var r=CM(t,this.from);return Ob(t,{op:"add",path:this.path,value:bh(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:tA(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},$pe={add:function(n,e,t){return xL(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:wE.move,copy:wE.copy,test:wE.test,_get:wE._get};function CM(n,e){if(e=="")return n;var t={op:"_get",path:e};return Ob(n,t),t.value}function Ob(n,e,t,r,i,s){if(t===void 0&&(t=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),t&&(typeof t=="function"?t(e,0,n,e.path):RM(e,0)),e.path===""){var o={newDocument:n};if(e.op==="add")return o.newDocument=e.value,o;if(e.op==="replace")return o.newDocument=e.value,o.removed=n,o;if(e.op==="move"||e.op==="copy")return o.newDocument=CM(n,e.from),e.op==="move"&&(o.removed=n),o;if(e.op==="test"){if(o.test=tA(n,e.value),o.test===!1)throw new ha("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o.newDocument=n,o}else{if(e.op==="remove")return o.removed=n,o.newDocument=null,o;if(e.op==="_get")return e.value=n,o;if(t)throw new ha("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,n);return o}}else{r||(n=bh(n));var a=e.path||"",c=a.split("/"),l=n,u=1,h=c.length,f=void 0,d=void 0,p=void 0;for(typeof t=="function"?p=t:p=RM;;){if(d=c[u],d&&d.indexOf("~")!=-1&&(d=eq(d)),i&&(d=="__proto__"||d=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&f===void 0&&(l[d]===void 0?f=c.slice(0,u).join("/"):u==h-1&&(f=e.path),f!==void 0&&p(e,0,n,f)),u++,Array.isArray(l)){if(d==="-")d=l.length;else{if(t&&!xL(d))throw new ha("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,n);xL(d)&&(d=~~d)}if(u>=h){if(t&&e.op==="add"&&d>l.length)throw new ha("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,n);var o=$pe[e.op].call(e,l,d,n);if(o.test===!1)throw new ha("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o}}else if(u>=h){var o=wE[e.op].call(e,l,d,n);if(o.test===!1)throw new ha("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return o}if(l=l[d],t&&u<h&&(!l||typeof l!="object"))throw new ha("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,n)}}}function cO(n,e,t,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),t&&!Array.isArray(e))throw new ha("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=bh(n));for(var s=new Array(e.length),o=0,a=e.length;o<a;o++)s[o]=Ob(n,e[o],t,!0,i,o),n=s[o].newDocument;return s.newDocument=n,s}function Vpe(n,e,t){var r=Ob(n,e);if(r.test===!1)throw new ha("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function RM(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new ha("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(wE[n.op]){if(typeof n.path!="string")throw new ha("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new ha('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new ha("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new ha("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&TL(n.value))throw new ha("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ha("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new ha("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var o={op:"_get",path:n.from,value:void 0},a=nq([o],t);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ha("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new ha("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function nq(n,e,t){try{if(!Array.isArray(n))throw new ha("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)cO(bh(e),bh(n),t||!0);else{t=t||RM;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof ha)return i;throw i}}function tA(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,s,o;if(t&&r){if(s=n.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!tA(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var a=Object.keys(n);if(s=a.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!tA(n[o],e[o]))return!1;return!0}return n!==n&&e!==e}const Hpe=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:ha,_areEquals:tA,applyOperation:Ob,applyPatch:cO,applyReducer:Vpe,deepClone:zpe,getValueByPointer:CM,validate:nq,validator:RM},Symbol.toStringTag,{value:"Module"}));var R5=new WeakMap,Gpe=(function(){function n(e){this.observers=new Map,this.obj=e}return n})(),Wpe=(function(){function n(e,t){this.callback=e,this.observer=t}return n})();function qpe(n){return R5.get(n)}function Ype(n,e){return n.observers.get(e)}function Kpe(n,e){n.observers.delete(e.callback)}function Xpe(n,e){e.unobserve()}function Zpe(n,e){var t=[],r,i=qpe(n);if(!i)i=new Gpe(n),R5.set(n,i);else{var s=Ype(i,e);r=s&&s.observer}if(r)return r;if(r={},i.value=bh(n),e){r.callback=e,r.next=null;var o=function(){wL(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=t,r.object=n,r.unobserve=function(){wL(r),clearTimeout(r.next),Kpe(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(e,new Wpe(e,r)),r}function wL(n,e){e===void 0&&(e=!1);var t=R5.get(n.object);k5(t.value,n.object,n.patches,"",e),n.patches.length&&cO(t.value,n.patches);var r=n.patches;return r.length>0&&(n.patches=[],n.callback&&n.callback(r)),r}function k5(n,e,t,r,i){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=EL(e),o=EL(n),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=n[l];if(SL(e,l)&&!(e[l]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?k5(u,h,t,r+"/"+fb(l),i):u!==h&&(i&&t.push({op:"test",path:r+"/"+fb(l),value:bh(u)}),t.push({op:"replace",path:r+"/"+fb(l),value:bh(h)}))}else Array.isArray(n)===Array.isArray(e)?(i&&t.push({op:"test",path:r+"/"+fb(l),value:bh(u)}),t.push({op:"remove",path:r+"/"+fb(l)}),a=!0):(i&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!SL(n,l)&&e[l]!==void 0&&t.push({op:"add",path:r+"/"+fb(l),value:bh(e[l])})}}}function Jpe(n,e,t){t===void 0&&(t=!1);var r=[];return k5(n,e,r,"",t),r}const Qpe=Object.freeze(Object.defineProperty({__proto__:null,compare:Jpe,generate:wL,observe:Zpe,unobserve:Xpe},Symbol.toStringTag,{value:"Module"}));Object.assign({},Hpe,Qpe,{JsonPatchError:tq,deepClone:bh,escapePathComponent:fb,unescapePathComponent:eq});var PN,R7;function eme(){if(R7)return PN;R7=1;var n=typeof Element<"u",e=typeof Map=="function",t=typeof Set=="function",r=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function i(s,o){if(s===o)return!0;if(s&&o&&typeof s=="object"&&typeof o=="object"){if(s.constructor!==o.constructor)return!1;var a,c,l;if(Array.isArray(s)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(!i(s[c],o[c]))return!1;return!0}var u;if(e&&s instanceof Map&&o instanceof Map){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;for(u=s.entries();!(c=u.next()).done;)if(!i(c.value[1],o.get(c.value[0])))return!1;return!0}if(t&&s instanceof Set&&o instanceof Set){if(s.size!==o.size)return!1;for(u=s.entries();!(c=u.next()).done;)if(!o.has(c.value[0]))return!1;return!0}if(r&&ArrayBuffer.isView(s)&&ArrayBuffer.isView(o)){if(a=s.length,a!=o.length)return!1;for(c=a;c--!==0;)if(s[c]!==o[c])return!1;return!0}if(s.constructor===RegExp)return s.source===o.source&&s.flags===o.flags;if(s.valueOf!==Object.prototype.valueOf&&typeof s.valueOf=="function"&&typeof o.valueOf=="function")return s.valueOf()===o.valueOf();if(s.toString!==Object.prototype.toString&&typeof s.toString=="function"&&typeof o.toString=="function")return s.toString()===o.toString();if(l=Object.keys(s),a=l.length,a!==Object.keys(o).length)return!1;for(c=a;c--!==0;)if(!Object.prototype.hasOwnProperty.call(o,l[c]))return!1;if(n&&s instanceof Element)return!1;for(c=a;c--!==0;)if(!((l[c]==="_owner"||l[c]==="__v"||l[c]==="__o")&&s.$$typeof)&&!i(s[l[c]],o[l[c]]))return!1;return!0}return s!==s&&o!==o}return PN=function(o,a){try{return i(o,a)}catch(c){if((c.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw c}},PN}var tme=eme();const Ev=wu(tme);function he(n){return n!=null}const nme=Object.fromEntries,Zm=Object.keys;function Ks(n){return bh(n)}function rme(n){return typeof n=="boolean"}function rn(n){return typeof n=="number"&&isNaN(n)===!1}function un(n){return typeof n=="string"}function sr(n){return Array.isArray(n)}function M5(n){return n}function ime(n){return n!==null&&typeof n=="object"&&un(n.id)&&un(n.name)&&sr(n.pages)&&sr(n.activelist)&&typeof n.flags=="object"}var Ft=(n=>(n[n.BLACK=0]="BLACK",n[n.DKBLUE=1]="DKBLUE",n[n.DKGREEN=2]="DKGREEN",n[n.DKCYAN=3]="DKCYAN",n[n.DKRED=4]="DKRED",n[n.DKPURPLE=5]="DKPURPLE",n[n.DKYELLOW=6]="DKYELLOW",n[n.LTGRAY=7]="LTGRAY",n[n.DKGRAY=8]="DKGRAY",n[n.BLUE=9]="BLUE",n[n.GREEN=10]="GREEN",n[n.CYAN=11]="CYAN",n[n.RED=12]="RED",n[n.PURPLE=13]="PURPLE",n[n.YELLOW=14]="YELLOW",n[n.WHITE=15]="WHITE",n[n.ONBLACK=16]="ONBLACK",n[n.ONDKBLUE=17]="ONDKBLUE",n[n.ONDKGREEN=18]="ONDKGREEN",n[n.ONDKCYAN=19]="ONDKCYAN",n[n.ONDKRED=20]="ONDKRED",n[n.ONDKPURPLE=21]="ONDKPURPLE",n[n.ONDKYELLOW=22]="ONDKYELLOW",n[n.ONLTGRAY=23]="ONLTGRAY",n[n.ONDKGRAY=24]="ONDKGRAY",n[n.ONBLUE=25]="ONBLUE",n[n.ONGREEN=26]="ONGREEN",n[n.ONCYAN=27]="ONCYAN",n[n.ONRED=28]="ONRED",n[n.ONPURPLE=29]="ONPURPLE",n[n.ONYELLOW=30]="ONYELLOW",n[n.ONWHITE=31]="ONWHITE",n[n.ONCLEAR=32]="ONCLEAR",n[n.BLBLACK=33]="BLBLACK",n[n.BLDKBLUE=34]="BLDKBLUE",n[n.BLDKGREEN=35]="BLDKGREEN",n[n.BLDKCYAN=36]="BLDKCYAN",n[n.BLDKRED=37]="BLDKRED",n[n.BLDKPURPLE=38]="BLDKPURPLE",n[n.BLDKYELLOW=39]="BLDKYELLOW",n[n.BLLTGRAY=40]="BLLTGRAY",n[n.BLDKGRAY=41]="BLDKGRAY",n[n.BLBLUE=42]="BLBLUE",n[n.BLGREEN=43]="BLGREEN",n[n.BLCYAN=44]="BLCYAN",n[n.BLRED=45]="BLRED",n[n.BLPURPLE=46]="BLPURPLE",n[n.BLYELLOW=47]="BLYELLOW",n[n.BLWHITE=48]="BLWHITE",n))(Ft||{}),Fn=(n=>(n[n.ISWALK=0]="ISWALK",n[n.ISSOLID=1]="ISSOLID",n[n.ISSWIM=2]="ISSWIM",n[n.ISBULLET=3]="ISBULLET",n[n.ISGHOST=4]="ISGHOST",n))(Fn||{}),qb=(n=>(n[n.ISTERRAIN=0]="ISTERRAIN",n[n.ISOBJECT=1]="ISOBJECT",n))(qb||{}),yn=(n=>(n[n.IDLE=0]="IDLE",n[n.NORTH=1]="NORTH",n[n.SOUTH=2]="SOUTH",n[n.WEST=3]="WEST",n[n.EAST=4]="EAST",n[n.BY=5]="BY",n[n.AT=6]="AT",n[n.FLOW=7]="FLOW",n[n.SEEK=8]="SEEK",n[n.RNDNS=9]="RNDNS",n[n.RNDNE=10]="RNDNE",n[n.RND=11]="RND",n[n.CW=12]="CW",n[n.CCW=13]="CCW",n[n.OPP=14]="OPP",n[n.RNDP=15]="RNDP",n[n.AWAY=16]="AWAY",n[n.TOWARD=17]="TOWARD",n[n.FIND=18]="FIND",n[n.FLEE=19]="FLEE",n[n.TO=20]="TO",n[n.MID=21]="MID",n[n.OVER=22]="OVER",n[n.UNDER=23]="UNDER",n[n.GROUND=24]="GROUND",n[n.WITHIN=25]="WITHIN",n[n.AWAYBY=26]="AWAYBY",n[n.ELEMENTS=27]="ELEMENTS",n))(yn||{}),Vn=(n=>(n[n.LOADER=0]="LOADER",n[n.BOARD=1]="BOARD",n[n.OBJECT=2]="OBJECT",n[n.TERRAIN=3]="TERRAIN",n[n.CHARSET=4]="CHARSET",n[n.PALETTE=5]="PALETTE",n[n.CONST=6]="CONST",n[n.RANGE=7]="RANGE",n[n.SELECT=8]="SELECT",n[n.NUMBER=9]="NUMBER",n[n.TEXT=10]="TEXT",n[n.HOTKEY=11]="HOTKEY",n[n.COPYIT=12]="COPYIT",n[n.OPENIT=13]="OPENIT",n[n.VIEWIT=14]="VIEWIT",n[n.RUNIT=15]="RUNIT",n[n.ZSSEDIT=16]="ZSSEDIT",n[n.CHAREDIT=17]="CHAREDIT",n[n.COLOREDIT=18]="COLOREDIT",n))(Vn||{});function cr(n){return un(n)?n.toLowerCase().trim():""}const Nb=14,nA=3,Zo=8,Oa=14,So=16,k7=16,sme=16;var Qi=(n=>(n[n.BLANK=0]="BLANK",n[n.TILES=1]="TILES",n[n.SPRITES=2]="SPRITES",n[n.DITHER=3]="DITHER",n[n.MEDIA=4]="MEDIA",n[n.CONTROL=5]="CONTROL",n))(Qi||{}),mc=(n=>(n[n.FAR=1]="FAR",n[n.MID=1.5]="MID",n[n.NEAR=3]="NEAR",n))(mc||{});function g1(n){let e=0,t=0,r=bn*.5,i=wr*.5,s=1.5,o="flat",a=0;return n.forEach(c=>{switch(c.type){case 1:e=Math.max(e,c.width),t=Math.max(t,c.height);break;case 3:e=Math.max(e,c.width),t=Math.max(t,c.height);break;case 5:r=c.focusx,i=c.focusy,s=c.viewscale,o=c.graphics,a=c.facing;break}}),{width:e,height:t,focusx:r,focusy:i,viewscale:s,graphics:o,facing:a}}function Jv(n,e){return`${n}:${e}`}const I5=1,O5=16,N5=256;var Ct=(n=>(n[n.NONE=0]="NONE",n[n.ALT=1]="ALT",n[n.CTRL=2]="CTRL",n[n.SHIFT=3]="SHIFT",n[n.MOVE_UP=4]="MOVE_UP",n[n.MOVE_DOWN=5]="MOVE_DOWN",n[n.MOVE_LEFT=6]="MOVE_LEFT",n[n.MOVE_RIGHT=7]="MOVE_RIGHT",n[n.OK_BUTTON=8]="OK_BUTTON",n[n.CANCEL_BUTTON=9]="CANCEL_BUTTON",n[n.MENU_BUTTON=10]="MENU_BUTTON",n))(Ct||{});const Jm=!!JSON.parse("false"),ome=!!JSON.parse("false"),ame=!!JSON.parse("false"),M7=!!JSON.parse("false");JSON.parse("false");JSON.parse("false");JSON.parse("false");JSON.parse("false");const kn={YIELD_AT_COUNT:512,DRAW_CHAR_SCALE:2,DRAW_CHAR_WIDTH(){return Zo*kn.DRAW_CHAR_SCALE},DRAW_CHAR_HEIGHT(){return Oa*kn.DRAW_CHAR_SCALE}};function cme(n){const e=document.createElement("canvas");if(e.width=n?.width||1,e.height=n?.height||1,n){const t=e.getContext("2d"),r=t?.getImageData(0,0,n.width,n.height);if(r&&t){let i=0;const{data:s}=r;for(let o=0;o<s.length;o+=4){const a=n.bits[i];s[o]=a,s[o+1]=a,s[o+2]=a,s[o+3]=255,i+=1}t.putImageData(r,0,0)}}return e}function P5(n,e){return{width:n,height:e,size:n*e,bits:new Uint8Array(n*e).fill(0)}}function DN(n,e,t){return{width:n,height:e,size:n*e,bits:new Uint8Array(t)}}function LN(n,e,t){if(!he(n))return;const r=Math.round(n.height/t),i=Math.round(n.width/e),s=e+2,o=t+2,a=i*e,c=i*s,l=r*o,u=P5(c,l);for(let h=0;h<r;++h)for(let f=0;f<i;++f)for(let d=0;d<t;++d)for(let p=0;p<e;++p){const m=f*e+p,_=h*t+d,v=n.bits[m+_*a],S=f*s+p+1,b=h*o+d+1,T=S+b*c;u.bits[T]=v,p===0&&(u.bits[T-1]=v),p===Zo-1&&(u.bits[T+1]=v),d===0&&(u.bits[T-c]=v),d===Oa-1&&(u.bits[T+c]=v)}return u}function _1(n){const e=Math.floor(n.length/nA);if(e*nA!==n.length)return;const t=P5(3,e);for(let r=0;r<t.bits.length;++r)t.bits[r]=n[r];return t}function lme(n,e){return n&1<<e?255:0}function v1(n){const e=Math.floor(n.length/Nb);if(e*Nb!==n.length)return;const t=Math.ceil(e/So),r=Zo*So,i=P5(r,Oa*t);let s=0,o=0,a=0;for(let c=0;c<n.length;++c){const l=o*Oa+a,u=n[c];for(let h=0;h<Zo;++h){const f=s*Zo+h;i.bits[f+l*r]=lme(u,7-h)}++a,a===Oa&&(a=0,++s,s===So&&(s=0,++o))}return i}function ume(n,e,t){if(!he(e))return;const r=Math.floor(e.bits.length/Nb);if(t<0||t>255||n.length===Nb||r*Nb!==e.bits.length)return;const i=Zo*So,s=t%So*Zo,o=Math.floor(t/So)*Oa,a=0;for(let c=0;c<Oa;++c)for(let l=0;l<Zo;++l){const u=s+l,h=o+c;e.bits[u+h*i]=n[a]?255:0}}function hme(n,e){const t=[];if(!he(n))return Uint8Array.from(t);const r=Math.floor(n.bits.length/Nb);if(e<0||e>255||r*Nb!==n.bits.length)return Uint8Array.from(t);const i=Zo*So,s=e%So*Zo,o=Math.floor(e/So)*Oa;for(let a=0;a<Oa;++a)for(let c=0;c<Zo;++c){const l=s+c,u=o+a;t.push(n.bits[l+u*i])}return Uint8Array.from(t)}const I7="0123456789abcdef",rq=[],kM=[];for(let n=0;n<256;n++)rq[n]=I7[n>>4&15]+I7[n&15],n<16&&(n<10?kM[48+n]=n:kM[87+n]=n);const iq=n=>{const e=n.length;let t="",r=0;for(;r<e;)t+=rq[n[r++]];return t},MM=n=>{const e=n.length>>1,t=e<<1,r=new Uint8Array(e);let i=0,s=0;for(;s<t;)r[i++]=kM[n.charCodeAt(s++)]<<4|kM[n.charCodeAt(s++)];return r};var O7="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fme=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var wR=0;wR<O7.length;wR++)fme[O7.charCodeAt(wR)]=wR;new TextDecoder;new TextEncoder;const N7=typeof window<"u"?window:self,P7=N7.crypto||N7.msCrypto||{};P7.subtle||P7.webkitSubtle;const y1=MM("000000000000000000000000000000007e81a58181bd99817e00000000007effdbffffc3e7ff7e0000000000006cfefefefe7c381000000000000010387cfe7c3810000000000000183c3ce7e7e718183c0000000000183c7effff7e18183c0000000000000000183c3c180000000000ffffffffffe7c3c3e7ffffffffff000000003c664242663c00000000ffffffffc399bdbd99c3ffffffff00001e0e1a3278cccccc7800000000003c6666663c187e181800000000003f333f30303070f0e000000000007f637f63636367e7e6c0000000001818db3ce73cdb1818000000000080c0e0f8fef8e0c080000000000002060e3efe3e0e06020000000000183c7e1818187e3c18000000000066666666666600666600000000007fdbdbdb7b1b1b1b1b000000007cc660386cc6c66c380cc67c000000000000000000fefefe0000000000183c7e1818187e3c187e00000000183c7e18181818181800000000001818181818187e3c1800000000000000180cfe0c180000000000000000003060fe603000000000000000000000c0c0c0fe000000000000000000286cfe6c2800000000000000001038387c7cfefe00000000000000fefe7c7c3838100000000000000000000000000000000000000000183c3c3c1818001818000000006666662400000000000000000000006c6cfe6c6c6cfe6c6c00000018187cc6c2c07c0686c67c18180000000000c2c60c183066c60000000000386c6c3876dccccc76000000003030306000000000000000000000000c183030303030180c000000000030180c0c0c0c0c183000000000000000663cff3c6600000000000000000018187e181800000000000000000000000000181818300000000000000000fe000000000000000000000000000000001818000000000002060c183060c0800000000000007cc6cedef6e6c6c67c000000000018387818181818187e00000000007cc6060c183060c6fe00000000007cc606063c0606c67c00000000000c1c3c6cccfe0c0c1e0000000000fec0c0c0fc0606c67c00000000003860c0c0fcc6c6c67c0000000000fec6060c183030303000000000007cc6c6c67cc6c6c67c00000000007cc6c6c67e06060c78000000000000181800000018180000000000000018180000001818300000000000060c18306030180c0600000000000000007e00007e000000000000006030180c060c18306000000000007cc6c60c181800181800000000007cc6c6dedededcc07c000000000010386cc6c6fec6c6c60000000000fc6666667c666666fc00000000003c66c2c0c0c0c2663c0000000000f86c66666666666cf80000000000fe66626878686266fe0000000000fe66626878686060f000000000003c66c2c0c0dec6663a0000000000c6c6c6c6fec6c6c6c600000000003c181818181818183c00000000001e0c0c0c0c0ccccc780000000000e6666c6c786c6c66e60000000000f060606060606266fe0000000000c6eefefed6c6c6c6c60000000000c6e6f6fedecec6c6c60000000000386cc6c6c6c6c66c380000000000fc6666667c606060f000000000007cc6c6c6c6d6de7c0c0e00000000fc6666667c6c6666e600000000007cc6c660380cc6c67c00000000007e7e5a18181818183c0000000000c6c6c6c6c6c6c6c67c0000000000c6c6c6c6c6c66c38100000000000c6c6c6c6d6d6fe7c6c0000000000c6c66c3838386cc6c60000000000666666663c1818183c0000000000fec68c183060c2c6fe00000000003c303030303030303c000000000080c0e070381c0e060200000000003c0c0c0c0c0c0c0c3c00000010386cc600000000000000000000000000000000000000000000ff0030301800000000000000000000000000000000780c7ccccc760000000000e06060786c6666667c00000000000000007cc6c0c0c67c00000000001c0c0c3c6ccccccc7600000000000000007cc6fec0c67c0000000000386c6460f0606060f0000000000000000076cccccc7c0ccc78000000e060606c76666666e6000000000018180038181818183c00000000000606000e0606060666663c000000e06060666c786c66e6000000000038181818181818183c0000000000000000ecfed6d6d6c60000000000000000dc666666666600000000000000007cc6c6c6c67c0000000000000000dc6666667c6060f000000000000076cccccc7c0c0c1e000000000000dc76666060f000000000000000007cc6701cc67c0000000000103030fc303030361c0000000000000000cccccccccc760000000000000000666666663c180000000000000000c6c6d6d6fe6c0000000000000000c66c38386cc60000000000000000c6c6c6c67e060cf8000000000000fecc183066fe00000000000e181818701818180e00000000001818181800181818180000000000701818180e18181870000000000076dc000000000000000000000000000010386cc6c6fe0000000000003c66c2c0c0c2663c0c067c000000cccc00cccccccccc76000000000c1830007cc6fec0c67c0000000010386c00780c7ccccc760000000000cccc00780c7ccccc760000000060301800780c7ccccc7600000000386c3800780c7ccccc76000000000000003c6660663c0c063c00000010386c007cc6fec0c67c0000000000cccc007cc6fec0c67c00000000603018007cc6fec0c67c000000000066660038181818183c00000000183c660038181818183c000000006030180038181818183c00000000c6c610386cc6c6fec6c6000000386c3800386cc6c6fec6c600000018306000fe66607c6066fe00000000000000cc76367ed8d86e00000000003e6cccccfeccccccce0000000010386c007cc6c6c6c67c0000000000c6c6007cc6c6c6c67c00000000603018007cc6c6c6c67c000000003078cc00cccccccccc760000000060301800cccccccccc760000000000c6c600c6c6c6c67e060c780000c6c6386cc6c6c6c66c3800000000c6c600c6c6c6c6c6c67c0000000018183c666060663c181800000000386c6460f0606060e6fc000000000066663c187e187e181800000000f8ccccf8c4ccdeccccc6000000000e1b1818187e18181818d870000018306000780c7ccccc76000000000c18300038181818183c00000000183060007cc6c6c6c67c0000000018306000cccccccccc76000000000076dc00dc666666666600000076dc00c6e6f6fedecec6c6000000003c6c6c3e007e0000000000000000386c6c38007c000000000000000000303000303060c6c67c000000000000000000fec0c0c000000000000000000000fe0606060000000000c0c0c6ccd83060dc860c183e0000c0c0c6ccd83066ce9e3e060600000018180018183c3c3c1800000000000000366cd86c36000000000000000000d86c366cd80000000000114411441144114411441144114455aa55aa55aa55aa55aa55aa55aadd77dd77dd77dd77dd77dd77dd77181818181818181818181818181818181818181818f81818181818181818181818f818f818181818181836363636363636f636363636363600000000000000fe3636363636360000000000f818f81818181818183636363636f606f636363636363636363636363636363636363636360000000000fe06f63636363636363636363636f606fe00000000000036363636363636fe0000000000001818181818f818f800000000000000000000000000f8181818181818181818181818181f00000000000018181818181818ff00000000000000000000000000ff181818181818181818181818181f18181818181800000000000000ff00000000000018181818181818ff18181818181818181818181f181f1818181818183636363636363637363636363636363636363637303f00000000000000000000003f30373636363636363636363636f700ff0000000000000000000000ff00f736363636363636363636363730373636363636360000000000ff00ff0000000000003636363636f700f73636363636361818181818ff00ff00000000000036363636363636ff0000000000000000000000ff00ff18181818181800000000000000ff363636363636363636363636363f00000000000018181818181f181f00000000000000000000001f181f181818181818000000000000003f36363636363636363636363636ff3636363636361818181818ff18ff18181818181818181818181818f8000000000000000000000000001f181818181818ffffffffffffffffffffffffffff00000000000000fffffffffffffff0f0f0f0f0f0f0f0f0f0f0f0f0f00f0f0f0f0f0f0f0f0f0f0f0f0f0fffffffffffffff00000000000000000000000076dcd8d8dc76000000000000007cc6fcc6c6fcc0c040000000fec6c6c0c0c0c0c0c000000000000000fe6c6c6c6c6c6c0000000000fec66030183060c6fe00000000000000007ed8d8d8d87000000000000000666666667c6060c000000000000076dc181818181800000000007e183c6666663c187e0000000000386cc6c6fec6c66c380000000000386cc6c6c66c6c6cee00000000001e30180c3e6666663c00000000000000007edbdb7e0000000000000003067edbdbf37e60c000000000001c3060607c6060301c0000000000007cc6c6c6c6c6c6c6000000000000fe0000fe0000fe0000000000000018187e18180000ff000000000030180c060c1830007e00000000000c18306030180c007e00000000000e1b1b1818181818181818181818181818181818d8d8700000000000001818007e001818000000000000000076dc0076dc000000000000386c6c3800000000000000000000000000000018180000000000000000000000000018000000000000000f0c0c0c0c0cec6c3c1c00000000d86c6c6c6c6c000000000000000070d83060c8f800000000000000000000007c7c7c7c7c7c000000000000000000000000000000000000"),b1=MM("00000000002a002a00002a2a2a00002a002a2a15002a2a2a15151515153f153f15153f3f3f15153f153f3f3f153f3f3f"),z0=globalThis||void 0||self;var sq=typeof z0=="object"&&z0&&z0.Object===Object&&z0,dme=typeof self=="object"&&self&&self.Object===Object&&self,lg=sq||dme||Function("return this")(),pd=lg.Symbol,oq=Object.prototype,pme=oq.hasOwnProperty,mme=oq.toString,VT=pd?pd.toStringTag:void 0;function gme(n){var e=pme.call(n,VT),t=n[VT];try{n[VT]=void 0;var r=!0}catch{}var i=mme.call(n);return r&&(e?n[VT]=t:delete n[VT]),i}var _me=Object.prototype,vme=_me.toString;function yme(n){return vme.call(n)}var bme="[object Null]",Sme="[object Undefined]",D7=pd?pd.toStringTag:void 0;function Qv(n){return n==null?n===void 0?Sme:bme:D7&&D7 in Object(n)?gme(n):yme(n)}function yp(n){return n!=null&&typeof n=="object"}var Eme="[object Symbol]";function lO(n){return typeof n=="symbol"||yp(n)&&Qv(n)==Eme}function uO(n,e){for(var t=-1,r=n==null?0:n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}var qi=Array.isArray,L7=pd?pd.prototype:void 0,U7=L7?L7.toString:void 0;function aq(n){if(typeof n=="string")return n;if(qi(n))return uO(n,aq)+"";if(lO(n))return U7?U7.call(n):"";var e=n+"";return e=="0"&&1/n==-1/0?"-0":e}var xme=/\s/;function Tme(n){for(var e=n.length;e--&&xme.test(n.charAt(e)););return e}var wme=/^\s+/;function Ame(n){return n&&n.slice(0,Tme(n)+1).replace(wme,"")}function md(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}var B7=NaN,Cme=/^[-+]0x[0-9a-f]+$/i,Rme=/^0b[01]+$/i,kme=/^0o[0-7]+$/i,Mme=parseInt;function Ime(n){if(typeof n=="number")return n;if(lO(n))return B7;if(md(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=md(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=Ame(n);var t=Rme.test(n);return t||kme.test(n)?Mme(n.slice(2),t?2:8):Cme.test(n)?B7:+n}var F7=1/0,Ome=17976931348623157e292;function Nme(n){if(!n)return n===0?n:0;if(n=Ime(n),n===F7||n===-F7){var e=n<0?-1:1;return e*Ome}return n===n?n:0}function hO(n){var e=Nme(n),t=e%1;return e===e?t?e-t:e:0}function ix(n){return n}var Pme="[object AsyncFunction]",Dme="[object Function]",Lme="[object GeneratorFunction]",Ume="[object Proxy]";function o_(n){if(!md(n))return!1;var e=Qv(n);return e==Dme||e==Lme||e==Pme||e==Ume}var UN=lg["__core-js_shared__"],j7=(function(){var n=/[^.]+$/.exec(UN&&UN.keys&&UN.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function Bme(n){return!!j7&&j7 in n}var Fme=Function.prototype,jme=Fme.toString;function S1(n){if(n!=null){try{return jme.call(n)}catch{}try{return n+""}catch{}}return""}var zme=/[\\^$.*+?()[\]{}|]/g,$me=/^\[object .+?Constructor\]$/,Vme=Function.prototype,Hme=Object.prototype,Gme=Vme.toString,Wme=Hme.hasOwnProperty,qme=RegExp("^"+Gme.call(Wme).replace(zme,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Yme(n){if(!md(n)||Bme(n))return!1;var e=o_(n)?qme:$me;return e.test(S1(n))}function Kme(n,e){return n?.[e]}function E1(n,e){var t=Kme(n,e);return Yme(t)?t:void 0}var AL=E1(lg,"WeakMap"),z7=Object.create,Xme=(function(){function n(){}return function(e){if(!md(e))return{};if(z7)return z7(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}})();function Zme(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function sc(){}function Jme(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var Qme=800,ege=16,tge=Date.now;function nge(n){var e=0,t=0;return function(){var r=tge(),i=ege-(r-t);if(t=r,i>0){if(++e>=Qme)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}function rge(n){return function(){return n}}var IM=(function(){try{var n=E1(Object,"defineProperty");return n({},"",{}),n}catch{}})(),ige=IM?function(n,e){return IM(n,"toString",{configurable:!0,enumerable:!1,value:rge(e),writable:!0})}:ix,sge=nge(ige);function cq(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}function lq(n,e,t,r){for(var i=n.length,s=t+-1;++s<i;)if(e(n[s],s,n))return s;return-1}function oge(n){return n!==n}function age(n,e,t){for(var r=t-1,i=n.length;++r<i;)if(n[r]===e)return r;return-1}function D5(n,e,t){return e===e?age(n,e,t):lq(n,oge,t)}function uq(n,e){var t=n==null?0:n.length;return!!t&&D5(n,e,0)>-1}var cge=9007199254740991,lge=/^(?:0|[1-9]\d*)$/;function fO(n,e){var t=typeof n;return e=e??cge,!!e&&(t=="number"||t!="symbol"&&lge.test(n))&&n>-1&&n%1==0&&n<e}function L5(n,e,t){e=="__proto__"&&IM?IM(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function JA(n,e){return n===e||n!==n&&e!==e}var uge=Object.prototype,hge=uge.hasOwnProperty;function dO(n,e,t){var r=n[e];(!(hge.call(n,e)&&JA(r,t))||t===void 0&&!(e in n))&&L5(n,e,t)}function U5(n,e,t,r){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=n[a]),i?L5(t,a,c):dO(t,a,c)}return t}var $7=Math.max;function fge(n,e,t){return e=$7(e===void 0?n.length-1:e,0),function(){for(var r=arguments,i=-1,s=$7(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=t(o),Zme(n,this,a)}}function B5(n,e){return sge(fge(n,e,ix),n+"")}var dge=9007199254740991;function F5(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=dge}function ug(n){return n!=null&&F5(n.length)&&!o_(n)}function hq(n,e,t){if(!md(t))return!1;var r=typeof e;return(r=="number"?ug(t)&&fO(e,t.length):r=="string"&&e in t)?JA(t[e],n):!1}function pge(n){return B5(function(e,t){var r=-1,i=t.length,s=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&hq(t[0],t[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=t[r];a&&n(e,a,r,s)}return e})}var mge=Object.prototype;function QA(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||mge;return n===t}function gge(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var _ge="[object Arguments]";function V7(n){return yp(n)&&Qv(n)==_ge}var fq=Object.prototype,vge=fq.hasOwnProperty,yge=fq.propertyIsEnumerable,pO=V7((function(){return arguments})())?V7:function(n){return yp(n)&&vge.call(n,"callee")&&!yge.call(n,"callee")};function bge(){return!1}var dq=typeof mf=="object"&&mf&&!mf.nodeType&&mf,H7=dq&&typeof gf=="object"&&gf&&!gf.nodeType&&gf,Sge=H7&&H7.exports===dq,G7=Sge?lg.Buffer:void 0,Ege=G7?G7.isBuffer:void 0,rA=Ege||bge,xge="[object Arguments]",Tge="[object Array]",wge="[object Boolean]",Age="[object Date]",Cge="[object Error]",Rge="[object Function]",kge="[object Map]",Mge="[object Number]",Ige="[object Object]",Oge="[object RegExp]",Nge="[object Set]",Pge="[object String]",Dge="[object WeakMap]",Lge="[object ArrayBuffer]",Uge="[object DataView]",Bge="[object Float32Array]",Fge="[object Float64Array]",jge="[object Int8Array]",zge="[object Int16Array]",$ge="[object Int32Array]",Vge="[object Uint8Array]",Hge="[object Uint8ClampedArray]",Gge="[object Uint16Array]",Wge="[object Uint32Array]",bo={};bo[Bge]=bo[Fge]=bo[jge]=bo[zge]=bo[$ge]=bo[Vge]=bo[Hge]=bo[Gge]=bo[Wge]=!0;bo[xge]=bo[Tge]=bo[Lge]=bo[wge]=bo[Uge]=bo[Age]=bo[Cge]=bo[Rge]=bo[kge]=bo[Mge]=bo[Ige]=bo[Oge]=bo[Nge]=bo[Pge]=bo[Dge]=!1;function qge(n){return yp(n)&&F5(n.length)&&!!bo[Qv(n)]}function mO(n){return function(e){return n(e)}}var pq=typeof mf=="object"&&mf&&!mf.nodeType&&mf,Lw=pq&&typeof gf=="object"&&gf&&!gf.nodeType&&gf,Yge=Lw&&Lw.exports===pq,BN=Yge&&sq.process,zv=(function(){try{var n=Lw&&Lw.require&&Lw.require("util").types;return n||BN&&BN.binding&&BN.binding("util")}catch{}})(),W7=zv&&zv.isTypedArray,j5=W7?mO(W7):qge,Kge=Object.prototype,Xge=Kge.hasOwnProperty;function mq(n,e){var t=qi(n),r=!t&&pO(n),i=!t&&!r&&rA(n),s=!t&&!r&&!i&&j5(n),o=t||r||i||s,a=o?gge(n.length,String):[],c=a.length;for(var l in n)(e||Xge.call(n,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||fO(l,c)))&&a.push(l);return a}function gq(n,e){return function(t){return n(e(t))}}var Zge=gq(Object.keys,Object),Jge=Object.prototype,Qge=Jge.hasOwnProperty;function _q(n){if(!QA(n))return Zge(n);var e=[];for(var t in Object(n))Qge.call(n,t)&&t!="constructor"&&e.push(t);return e}function gd(n){return ug(n)?mq(n):_q(n)}var e0e=Object.prototype,t0e=e0e.hasOwnProperty,Ch=pge(function(n,e){if(QA(e)||ug(e)){U5(e,gd(e),n);return}for(var t in e)t0e.call(e,t)&&dO(n,t,e[t])});function n0e(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var r0e=Object.prototype,i0e=r0e.hasOwnProperty;function s0e(n){if(!md(n))return n0e(n);var e=QA(n),t=[];for(var r in n)r=="constructor"&&(e||!i0e.call(n,r))||t.push(r);return t}function vq(n){return ug(n)?mq(n,!0):s0e(n)}var o0e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a0e=/^\w*$/;function z5(n,e){if(qi(n))return!1;var t=typeof n;return t=="number"||t=="symbol"||t=="boolean"||n==null||lO(n)?!0:a0e.test(n)||!o0e.test(n)||e!=null&&n in Object(e)}var iA=E1(Object,"create");function c0e(){this.__data__=iA?iA(null):{},this.size=0}function l0e(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var u0e="__lodash_hash_undefined__",h0e=Object.prototype,f0e=h0e.hasOwnProperty;function d0e(n){var e=this.__data__;if(iA){var t=e[n];return t===u0e?void 0:t}return f0e.call(e,n)?e[n]:void 0}var p0e=Object.prototype,m0e=p0e.hasOwnProperty;function g0e(n){var e=this.__data__;return iA?e[n]!==void 0:m0e.call(e,n)}var _0e="__lodash_hash_undefined__";function v0e(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=iA&&e===void 0?_0e:e,this}function Yb(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Yb.prototype.clear=c0e;Yb.prototype.delete=l0e;Yb.prototype.get=d0e;Yb.prototype.has=g0e;Yb.prototype.set=v0e;function y0e(){this.__data__=[],this.size=0}function gO(n,e){for(var t=n.length;t--;)if(JA(n[t][0],e))return t;return-1}var b0e=Array.prototype,S0e=b0e.splice;function E0e(n){var e=this.__data__,t=gO(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():S0e.call(e,t,1),--this.size,!0}function x0e(n){var e=this.__data__,t=gO(e,n);return t<0?void 0:e[t][1]}function T0e(n){return gO(this.__data__,n)>-1}function w0e(n,e){var t=this.__data__,r=gO(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}function a_(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}a_.prototype.clear=y0e;a_.prototype.delete=E0e;a_.prototype.get=x0e;a_.prototype.has=T0e;a_.prototype.set=w0e;var sA=E1(lg,"Map");function A0e(){this.size=0,this.__data__={hash:new Yb,map:new(sA||a_),string:new Yb}}function C0e(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function _O(n,e){var t=n.__data__;return C0e(e)?t[typeof e=="string"?"string":"hash"]:t.map}function R0e(n){var e=_O(this,n).delete(n);return this.size-=e?1:0,e}function k0e(n){return _O(this,n).get(n)}function M0e(n){return _O(this,n).has(n)}function I0e(n,e){var t=_O(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}function c_(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}c_.prototype.clear=A0e;c_.prototype.delete=R0e;c_.prototype.get=k0e;c_.prototype.has=M0e;c_.prototype.set=I0e;var O0e="Expected a function";function $5(n,e){if(typeof n!="function"||e!=null&&typeof e!="function")throw new TypeError(O0e);var t=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=t.cache;if(s.has(i))return s.get(i);var o=n.apply(this,r);return t.cache=s.set(i,o)||s,o};return t.cache=new($5.Cache||c_),t}$5.Cache=c_;var N0e=500;function P0e(n){var e=$5(n,function(r){return t.size===N0e&&t.clear(),r}),t=e.cache;return e}var D0e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,L0e=/\\(\\)?/g,U0e=P0e(function(n){var e=[];return n.charCodeAt(0)===46&&e.push(""),n.replace(D0e,function(t,r,i,s){e.push(i?s.replace(L0e,"$1"):r||t)}),e});function yq(n){return n==null?"":aq(n)}function vO(n,e){return qi(n)?n:z5(n,e)?[n]:U0e(yq(n))}function eC(n){if(typeof n=="string"||lO(n))return n;var e=n+"";return e=="0"&&1/n==-1/0?"-0":e}function V5(n,e){e=vO(e,n);for(var t=0,r=e.length;n!=null&&t<r;)n=n[eC(e[t++])];return t&&t==r?n:void 0}function B0e(n,e,t){var r=n==null?void 0:V5(n,e);return r===void 0?t:r}function H5(n,e){for(var t=-1,r=e.length,i=n.length;++t<r;)n[i+t]=e[t];return n}var q7=pd?pd.isConcatSpreadable:void 0;function F0e(n){return qi(n)||pO(n)||!!(q7&&n&&n[q7])}function G5(n,e,t,r,i){var s=-1,o=n.length;for(t||(t=F0e),i||(i=[]);++s<o;){var a=n[s];t(a)?H5(i,a):r||(i[i.length]=a)}return i}function _f(n){var e=n==null?0:n.length;return e?G5(n):[]}var bq=gq(Object.getPrototypeOf,Object);function W5(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function j0e(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:W5(n,e,t)}var z0e="\\ud800-\\udfff",$0e="\\u0300-\\u036f",V0e="\\ufe20-\\ufe2f",H0e="\\u20d0-\\u20ff",G0e=$0e+V0e+H0e,W0e="\\ufe0e\\ufe0f",q0e="\\u200d",Y0e=RegExp("["+q0e+z0e+G0e+W0e+"]");function Sq(n){return Y0e.test(n)}function K0e(n){return n.split("")}var Eq="\\ud800-\\udfff",X0e="\\u0300-\\u036f",Z0e="\\ufe20-\\ufe2f",J0e="\\u20d0-\\u20ff",Q0e=X0e+Z0e+J0e,e_e="\\ufe0e\\ufe0f",t_e="["+Eq+"]",CL="["+Q0e+"]",RL="\\ud83c[\\udffb-\\udfff]",n_e="(?:"+CL+"|"+RL+")",xq="[^"+Eq+"]",Tq="(?:\\ud83c[\\udde6-\\uddff]){2}",wq="[\\ud800-\\udbff][\\udc00-\\udfff]",r_e="\\u200d",Aq=n_e+"?",Cq="["+e_e+"]?",i_e="(?:"+r_e+"(?:"+[xq,Tq,wq].join("|")+")"+Cq+Aq+")*",s_e=Cq+Aq+i_e,o_e="(?:"+[xq+CL+"?",CL,Tq,wq,t_e].join("|")+")",a_e=RegExp(RL+"(?="+RL+")|"+o_e+s_e,"g");function c_e(n){return n.match(a_e)||[]}function l_e(n){return Sq(n)?c_e(n):K0e(n)}function u_e(n){return function(e){e=yq(e);var t=Sq(e)?l_e(e):void 0,r=t?t[0]:e.charAt(0),i=t?j0e(t,1).join(""):e.slice(1);return r[n]()+i}}var Rq=u_e("toUpperCase");function h_e(n,e,t,r){var i=-1,s=n==null?0:n.length;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function f_e(){this.__data__=new a_,this.size=0}function d_e(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}function p_e(n){return this.__data__.get(n)}function m_e(n){return this.__data__.has(n)}var g_e=200;function __e(n,e){var t=this.__data__;if(t instanceof a_){var r=t.__data__;if(!sA||r.length<g_e-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new c_(r)}return t.set(n,e),this.size=t.size,this}function Wm(n){var e=this.__data__=new a_(n);this.size=e.size}Wm.prototype.clear=f_e;Wm.prototype.delete=d_e;Wm.prototype.get=p_e;Wm.prototype.has=m_e;Wm.prototype.set=__e;function v_e(n,e){return n&&U5(e,gd(e),n)}var kq=typeof mf=="object"&&mf&&!mf.nodeType&&mf,Y7=kq&&typeof gf=="object"&&gf&&!gf.nodeType&&gf,y_e=Y7&&Y7.exports===kq,K7=y_e?lg.Buffer:void 0,X7=K7?K7.allocUnsafe:void 0;function b_e(n,e){var t=n.length,r=X7?X7(t):new n.constructor(t);return n.copy(r),r}function q5(n,e){for(var t=-1,r=n==null?0:n.length,i=0,s=[];++t<r;){var o=n[t];e(o,t,n)&&(s[i++]=o)}return s}function Mq(){return[]}var S_e=Object.prototype,E_e=S_e.propertyIsEnumerable,Z7=Object.getOwnPropertySymbols,Y5=Z7?function(n){return n==null?[]:(n=Object(n),q5(Z7(n),function(e){return E_e.call(n,e)}))}:Mq;function x_e(n,e){return U5(n,Y5(n),e)}var T_e=Object.getOwnPropertySymbols,w_e=T_e?function(n){for(var e=[];n;)H5(e,Y5(n)),n=bq(n);return e}:Mq;function Iq(n,e,t){var r=e(n);return qi(n)?r:H5(r,t(n))}function kL(n){return Iq(n,gd,Y5)}function A_e(n){return Iq(n,vq,w_e)}var ML=E1(lg,"DataView"),IL=E1(lg,"Promise"),jE=E1(lg,"Set"),J7="[object Map]",C_e="[object Object]",Q7="[object Promise]",e9="[object Set]",t9="[object WeakMap]",n9="[object DataView]",R_e=S1(ML),k_e=S1(sA),M_e=S1(IL),I_e=S1(jE),O_e=S1(AL),Qf=Qv;(ML&&Qf(new ML(new ArrayBuffer(1)))!=n9||sA&&Qf(new sA)!=J7||IL&&Qf(IL.resolve())!=Q7||jE&&Qf(new jE)!=e9||AL&&Qf(new AL)!=t9)&&(Qf=function(n){var e=Qv(n),t=e==C_e?n.constructor:void 0,r=t?S1(t):"";if(r)switch(r){case R_e:return n9;case k_e:return J7;case M_e:return Q7;case I_e:return e9;case O_e:return t9}return e});var N_e=Object.prototype,P_e=N_e.hasOwnProperty;function D_e(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&P_e.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var OM=lg.Uint8Array;function L_e(n){var e=new n.constructor(n.byteLength);return new OM(e).set(new OM(n)),e}function U_e(n,e){var t=n.buffer;return new n.constructor(t,n.byteOffset,n.byteLength)}var B_e=/\w*$/;function F_e(n){var e=new n.constructor(n.source,B_e.exec(n));return e.lastIndex=n.lastIndex,e}var r9=pd?pd.prototype:void 0,i9=r9?r9.valueOf:void 0;function j_e(n){return i9?Object(i9.call(n)):{}}function z_e(n,e){var t=n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var $_e="[object Boolean]",V_e="[object Date]",H_e="[object Map]",G_e="[object Number]",W_e="[object RegExp]",q_e="[object Set]",Y_e="[object String]",K_e="[object Symbol]",X_e="[object ArrayBuffer]",Z_e="[object DataView]",J_e="[object Float32Array]",Q_e="[object Float64Array]",eve="[object Int8Array]",tve="[object Int16Array]",nve="[object Int32Array]",rve="[object Uint8Array]",ive="[object Uint8ClampedArray]",sve="[object Uint16Array]",ove="[object Uint32Array]";function ave(n,e,t){var r=n.constructor;switch(e){case X_e:return L_e(n);case $_e:case V_e:return new r(+n);case Z_e:return U_e(n);case J_e:case Q_e:case eve:case tve:case nve:case rve:case ive:case sve:case ove:return z_e(n);case H_e:return new r;case G_e:case Y_e:return new r(n);case W_e:return F_e(n);case q_e:return new r;case K_e:return j_e(n)}}function cve(n){return typeof n.constructor=="function"&&!QA(n)?Xme(bq(n)):{}}var lve="[object Map]";function uve(n){return yp(n)&&Qf(n)==lve}var s9=zv&&zv.isMap,hve=s9?mO(s9):uve,fve="[object Set]";function dve(n){return yp(n)&&Qf(n)==fve}var o9=zv&&zv.isSet,pve=o9?mO(o9):dve,Oq="[object Arguments]",mve="[object Array]",gve="[object Boolean]",_ve="[object Date]",vve="[object Error]",Nq="[object Function]",yve="[object GeneratorFunction]",bve="[object Map]",Sve="[object Number]",Pq="[object Object]",Eve="[object RegExp]",xve="[object Set]",Tve="[object String]",wve="[object Symbol]",Ave="[object WeakMap]",Cve="[object ArrayBuffer]",Rve="[object DataView]",kve="[object Float32Array]",Mve="[object Float64Array]",Ive="[object Int8Array]",Ove="[object Int16Array]",Nve="[object Int32Array]",Pve="[object Uint8Array]",Dve="[object Uint8ClampedArray]",Lve="[object Uint16Array]",Uve="[object Uint32Array]",to={};to[Oq]=to[mve]=to[Cve]=to[Rve]=to[gve]=to[_ve]=to[kve]=to[Mve]=to[Ive]=to[Ove]=to[Nve]=to[bve]=to[Sve]=to[Pq]=to[Eve]=to[xve]=to[Tve]=to[wve]=to[Pve]=to[Dve]=to[Lve]=to[Uve]=!0;to[vve]=to[Nq]=to[Ave]=!1;function Ok(n,e,t,r,i,s){var o;if(o!==void 0)return o;if(!md(n))return n;var a=qi(n);if(a)return o=D_e(n),Jme(n,o);var c=Qf(n),l=c==Nq||c==yve;if(rA(n))return b_e(n);if(c==Pq||c==Oq||l&&!i)return o=l?{}:cve(n),x_e(n,v_e(o,n));if(!to[c])return i?n:{};o=ave(n,c),s||(s=new Wm);var u=s.get(n);if(u)return u;s.set(n,o),pve(n)?n.forEach(function(d){o.add(Ok(d,e,t,d,n,s))}):hve(n)&&n.forEach(function(d,p){o.set(p,Ok(d,e,t,p,n,s))});var h=kL,f=a?void 0:h(n);return cq(f||n,function(d,p){f&&(p=d,d=n[p]),dO(o,p,Ok(d,e,t,p,n,s))}),o}var Bve=4;function fl(n){return Ok(n,Bve)}function tC(n){for(var e=-1,t=n==null?0:n.length,r=0,i=[];++e<t;){var s=n[e];s&&(i[r++]=s)}return i}var Fve="__lodash_hash_undefined__";function jve(n){return this.__data__.set(n,Fve),this}function zve(n){return this.__data__.has(n)}function sx(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new c_;++e<t;)this.add(n[e])}sx.prototype.add=sx.prototype.push=jve;sx.prototype.has=zve;function Dq(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function K5(n,e){return n.has(e)}var $ve=1,Vve=2;function Lq(n,e,t,r,i,s){var o=t&$ve,a=n.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(n),u=s.get(e);if(l&&u)return l==e&&u==n;var h=-1,f=!0,d=t&Vve?new sx:void 0;for(s.set(n,e),s.set(e,n);++h<a;){var p=n[h],m=e[h];if(r)var _=o?r(m,p,h,e,n,s):r(p,m,h,n,e,s);if(_!==void 0){if(_)continue;f=!1;break}if(d){if(!Dq(e,function(v,S){if(!K5(d,S)&&(p===v||i(p,v,t,r,s)))return d.push(S)})){f=!1;break}}else if(!(p===m||i(p,m,t,r,s))){f=!1;break}}return s.delete(n),s.delete(e),f}function Hve(n){var e=-1,t=Array(n.size);return n.forEach(function(r,i){t[++e]=[i,r]}),t}function X5(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var Gve=1,Wve=2,qve="[object Boolean]",Yve="[object Date]",Kve="[object Error]",Xve="[object Map]",Zve="[object Number]",Jve="[object RegExp]",Qve="[object Set]",eye="[object String]",tye="[object Symbol]",nye="[object ArrayBuffer]",rye="[object DataView]",a9=pd?pd.prototype:void 0,FN=a9?a9.valueOf:void 0;function iye(n,e,t,r,i,s,o){switch(t){case rye:if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case nye:return!(n.byteLength!=e.byteLength||!s(new OM(n),new OM(e)));case qve:case Yve:case Zve:return JA(+n,+e);case Kve:return n.name==e.name&&n.message==e.message;case Jve:case eye:return n==e+"";case Xve:var a=Hve;case Qve:var c=r&Gve;if(a||(a=X5),n.size!=e.size&&!c)return!1;var l=o.get(n);if(l)return l==e;r|=Wve,o.set(n,e);var u=Lq(a(n),a(e),r,i,s,o);return o.delete(n),u;case tye:if(FN)return FN.call(n)==FN.call(e)}return!1}var sye=1,oye=Object.prototype,aye=oye.hasOwnProperty;function cye(n,e,t,r,i,s){var o=t&sye,a=kL(n),c=a.length,l=kL(e),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var f=a[h];if(!(o?f in e:aye.call(e,f)))return!1}var d=s.get(n),p=s.get(e);if(d&&p)return d==e&&p==n;var m=!0;s.set(n,e),s.set(e,n);for(var _=o;++h<c;){f=a[h];var v=n[f],S=e[f];if(r)var b=o?r(S,v,f,e,n,s):r(v,S,f,n,e,s);if(!(b===void 0?v===S||i(v,S,t,r,s):b)){m=!1;break}_||(_=f=="constructor")}if(m&&!_){var T=n.constructor,w=e.constructor;T!=w&&"constructor"in n&&"constructor"in e&&!(typeof T=="function"&&T instanceof T&&typeof w=="function"&&w instanceof w)&&(m=!1)}return s.delete(n),s.delete(e),m}var lye=1,c9="[object Arguments]",l9="[object Array]",AR="[object Object]",uye=Object.prototype,u9=uye.hasOwnProperty;function hye(n,e,t,r,i,s){var o=qi(n),a=qi(e),c=o?l9:Qf(n),l=a?l9:Qf(e);c=c==c9?AR:c,l=l==c9?AR:l;var u=c==AR,h=l==AR,f=c==l;if(f&&rA(n)){if(!rA(e))return!1;o=!0,u=!1}if(f&&!u)return s||(s=new Wm),o||j5(n)?Lq(n,e,t,r,i,s):iye(n,e,c,t,r,i,s);if(!(t&lye)){var d=u&&u9.call(n,"__wrapped__"),p=h&&u9.call(e,"__wrapped__");if(d||p){var m=d?n.value():n,_=p?e.value():e;return s||(s=new Wm),i(m,_,t,r,s)}}return f?(s||(s=new Wm),cye(n,e,t,r,i,s)):!1}function Z5(n,e,t,r,i){return n===e?!0:n==null||e==null||!yp(n)&&!yp(e)?n!==n&&e!==e:hye(n,e,t,r,Z5,i)}var fye=1,dye=2;function pye(n,e,t,r){var i=t.length,s=i;if(n==null)return!s;for(n=Object(n);i--;){var o=t[i];if(o[2]?o[1]!==n[o[0]]:!(o[0]in n))return!1}for(;++i<s;){o=t[i];var a=o[0],c=n[a],l=o[1];if(o[2]){if(c===void 0&&!(a in n))return!1}else{var u=new Wm,h;if(!(h===void 0?Z5(l,c,fye|dye,r,u):h))return!1}}return!0}function Uq(n){return n===n&&!md(n)}function mye(n){for(var e=gd(n),t=e.length;t--;){var r=e[t],i=n[r];e[t]=[r,i,Uq(i)]}return e}function Bq(n,e){return function(t){return t==null?!1:t[n]===e&&(e!==void 0||n in Object(t))}}function gye(n){var e=mye(n);return e.length==1&&e[0][2]?Bq(e[0][0],e[0][1]):function(t){return t===n||pye(t,n,e)}}function _ye(n,e){return n!=null&&e in Object(n)}function Fq(n,e,t){e=vO(e,n);for(var r=-1,i=e.length,s=!1;++r<i;){var o=eC(e[r]);if(!(s=n!=null&&t(n,o)))break;n=n[o]}return s||++r!=i?s:(i=n==null?0:n.length,!!i&&F5(i)&&fO(o,i)&&(qi(n)||pO(n)))}function vye(n,e){return n!=null&&Fq(n,e,_ye)}var yye=1,bye=2;function Sye(n,e){return z5(n)&&Uq(e)?Bq(eC(n),e):function(t){var r=B0e(t,n);return r===void 0&&r===e?vye(t,n):Z5(e,r,yye|bye)}}function Eye(n){return function(e){return e?.[n]}}function xye(n){return function(e){return V5(e,n)}}function Tye(n){return z5(n)?Eye(eC(n)):xye(n)}function hg(n){return typeof n=="function"?n:n==null?ix:typeof n=="object"?qi(n)?Sye(n[0],n[1]):gye(n):Tye(n)}function wye(n,e,t,r){for(var i=-1,s=n==null?0:n.length;++i<s;){var o=n[i];e(r,o,t(o),n)}return r}function Aye(n){return function(e,t,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(t(s[c],c,s)===!1)break}return e}}var Cye=Aye();function Rye(n,e){return n&&Cye(n,e,gd)}function kye(n,e){return function(t,r){if(t==null)return t;if(!ug(t))return n(t,r);for(var i=t.length,s=-1,o=Object(t);++s<i&&r(o[s],s,o)!==!1;);return t}}var x1=kye(Rye);function Mye(n,e,t,r){return x1(n,function(i,s,o){e(r,i,t(i),o)}),r}function Iye(n,e){return function(t,r){var i=qi(t)?wye:Mye,s=e?e():{};return i(t,n,hg(r),s)}}var jq=Object.prototype,Oye=jq.hasOwnProperty,J5=B5(function(n,e){n=Object(n);var t=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&hq(e[0],e[1],i)&&(r=1);++t<r;)for(var s=e[t],o=vq(s),a=-1,c=o.length;++a<c;){var l=o[a],u=n[l];(u===void 0||JA(u,jq[l])&&!Oye.call(n,l))&&(n[l]=s[l])}return n});function h9(n){return yp(n)&&ug(n)}var Nye=200;function Pye(n,e,t,r){var i=-1,s=uq,o=!0,a=n.length,c=[],l=e.length;if(!a)return c;e.length>=Nye&&(s=K5,o=!1,e=new sx(e));e:for(;++i<a;){var u=n[i],h=u;if(u=u!==0?u:0,o&&h===h){for(var f=l;f--;)if(e[f]===h)continue e;c.push(u)}else s(e,h,r)||c.push(u)}return c}var yO=B5(function(n,e){return h9(n)?Pye(n,G5(e,1,h9,!0)):[]});function Kb(n){var e=n==null?0:n.length;return e?n[e-1]:void 0}function ol(n,e,t){var r=n==null?0:n.length;return r?(e=e===void 0?1:hO(e),W5(n,e<0?0:e,r)):[]}function oA(n,e,t){var r=n==null?0:n.length;return r?(e=e===void 0?1:hO(e),e=r-e,W5(n,0,e<0?0:e)):[]}function Dye(n){return typeof n=="function"?n:ix}function Dr(n,e){var t=qi(n)?cq:x1;return t(n,Dye(e))}function Lye(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(!e(n[t],t,n))return!1;return!0}function Uye(n,e){var t=!0;return x1(n,function(r,i,s){return t=!!e(r,i,s),t}),t}function pp(n,e,t){var r=qi(n)?Lye:Uye;return r(n,hg(e))}function zq(n,e){var t=[];return x1(n,function(r,i,s){e(r,i,s)&&t.push(r)}),t}function Sd(n,e){var t=qi(n)?q5:zq;return t(n,hg(e))}function Bye(n){return function(e,t,r){var i=Object(e);if(!ug(e)){var s=hg(t);e=gd(e),t=function(a){return s(i[a],a,i)}}var o=n(e,t,r);return o>-1?i[s?e[o]:o]:void 0}}var Fye=Math.max;function jye(n,e,t){var r=n==null?0:n.length;if(!r)return-1;var i=t==null?0:hO(t);return i<0&&(i=Fye(r+i,0)),lq(n,hg(e),i)}var ox=Bye(jye);function bp(n){return n&&n.length?n[0]:void 0}function zye(n,e){var t=-1,r=ug(n)?Array(n.length):[];return x1(n,function(i,s,o){r[++t]=e(i,s,o)}),r}function ir(n,e){var t=qi(n)?uO:zye;return t(n,hg(e))}function ud(n,e){return G5(ir(n,e))}var $ye=Object.prototype,Vye=$ye.hasOwnProperty,$q=Iye(function(n,e,t){Vye.call(n,t)?n[t].push(e):L5(n,t,[e])}),Hye=Object.prototype,Gye=Hye.hasOwnProperty;function Wye(n,e){return n!=null&&Gye.call(n,e)}function Mr(n,e){return n!=null&&Fq(n,e,Wye)}var qye="[object String]";function Rh(n){return typeof n=="string"||!qi(n)&&yp(n)&&Qv(n)==qye}function Yye(n,e){return uO(e,function(t){return n[t]})}function Ha(n){return n==null?[]:Yye(n,gd(n))}var Kye=Math.max;function Au(n,e,t,r){n=ug(n)?n:Ha(n),t=t?hO(t):0;var i=n.length;return t<0&&(t=Kye(i+t,0)),Rh(n)?t<=i&&n.indexOf(e,t)>-1:!!i&&D5(n,e,t)>-1}function f9(n,e,t){var r=n==null?0:n.length;if(!r)return-1;var i=0;return D5(n,e,i)}var Xye="[object Map]",Zye="[object Set]",Jye=Object.prototype,Qye=Jye.hasOwnProperty;function ao(n){if(n==null)return!0;if(ug(n)&&(qi(n)||typeof n=="string"||typeof n.splice=="function"||rA(n)||j5(n)||pO(n)))return!n.length;var e=Qf(n);if(e==Xye||e==Zye)return!n.size;if(QA(n))return!_q(n).length;for(var t in n)if(Qye.call(n,t))return!1;return!0}var ebe="[object RegExp]";function tbe(n){return yp(n)&&Qv(n)==ebe}var d9=zv&&zv.isRegExp,J0=d9?mO(d9):tbe;function Q0(n){return n===void 0}var nbe="Expected a function";function rbe(n){if(typeof n!="function")throw new TypeError(nbe);return function(){var e=arguments;switch(e.length){case 0:return!n.call(this);case 1:return!n.call(this,e[0]);case 2:return!n.call(this,e[0],e[1]);case 3:return!n.call(this,e[0],e[1],e[2])}return!n.apply(this,e)}}function ibe(n,e,t,r){if(!md(n))return n;e=vO(e,n);for(var i=-1,s=e.length,o=s-1,a=n;a!=null&&++i<s;){var c=eC(e[i]),l=t;if(c==="__proto__"||c==="constructor"||c==="prototype")return n;if(i!=o){var u=a[c];l=void 0,l===void 0&&(l=md(u)?u:fO(e[i+1])?[]:{})}dO(a,c,l),a=a[c]}return n}function sbe(n,e,t){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=V5(n,o);t(a,o)&&ibe(s,vO(o,n),a)}return s}function Cp(n,e){if(n==null)return{};var t=uO(A_e(n),function(r){return[r]});return e=hg(e),sbe(n,t,function(r,i){return e(r,i[0])})}function obe(n,e,t,r,i){return i(n,function(s,o,a){t=r?(r=!1,s):e(t,s,o,a)}),t}function kh(n,e,t){var r=qi(n)?h_e:obe,i=arguments.length<3;return r(n,hg(e),t,i,x1)}function bO(n,e){var t=qi(n)?q5:zq;return t(n,rbe(hg(e)))}function abe(n,e){var t;return x1(n,function(r,i,s){return t=e(r,i,s),!t}),!!t}function Q5(n,e,t){var r=qi(n)?Dq:abe;return r(n,hg(e))}var cbe=1/0,lbe=jE&&1/X5(new jE([,-0]))[1]==cbe?function(n){return new jE(n)}:sc,ube=200;function hbe(n,e,t){var r=-1,i=uq,s=n.length,o=!0,a=[],c=a;if(s>=ube){var l=lbe(n);if(l)return X5(l);o=!1,i=K5,c=new sx}else c=a;e:for(;++r<s;){var u=n[r],h=u;if(u=u!==0?u:0,o&&h===h){for(var f=c.length;f--;)if(c[f]===h)continue e;a.push(u)}else i(c,h,t)||(c!==a&&c.push(h),a.push(u))}return a}function SO(n){return n&&n.length?hbe(n):[]}function OL(n){console&&console.error&&console.error(`Error: ${n}`)}function Vq(n){console&&console.warn&&console.warn(`Warning: ${n}`)}function Hq(n){const e=new Date().getTime(),t=n();return{time:new Date().getTime()-e,value:t}}function Gq(n){function e(){}e.prototype=n;const t=new e;function r(){return typeof t.bar}return r(),r(),n}function fbe(n){return dbe(n)?n.LABEL:n.name}function dbe(n){return Rh(n.LABEL)&&n.LABEL!==""}class fg{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),Dr(this.definition,t=>{t.accept(e)})}}class Mh extends fg{constructor(e){super([]),this.idx=1,Ch(this,Cp(e,t=>t!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Vx extends fg{constructor(e){super(e.definition),this.orgText="",Ch(this,Cp(e,t=>t!==void 0))}}class Ih extends fg{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Ch(this,Cp(e,t=>t!==void 0))}}class xh extends fg{constructor(e){super(e.definition),this.idx=1,Ch(this,Cp(e,t=>t!==void 0))}}class dg extends fg{constructor(e){super(e.definition),this.idx=1,Ch(this,Cp(e,t=>t!==void 0))}}class pg extends fg{constructor(e){super(e.definition),this.idx=1,Ch(this,Cp(e,t=>t!==void 0))}}class uc extends fg{constructor(e){super(e.definition),this.idx=1,Ch(this,Cp(e,t=>t!==void 0))}}class Rp extends fg{constructor(e){super(e.definition),this.idx=1,Ch(this,Cp(e,t=>t!==void 0))}}class kp extends fg{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Ch(this,Cp(e,t=>t!==void 0))}}class Jo{constructor(e){this.idx=1,Ch(this,Cp(e,t=>t!==void 0))}accept(e){e.visit(this)}}function pbe(n){return ir(n,Nk)}function Nk(n){function e(t){return ir(t,Nk)}if(n instanceof Mh){const t={type:"NonTerminal",name:n.nonTerminalName,idx:n.idx};return Rh(n.label)&&(t.label=n.label),t}else{if(n instanceof Ih)return{type:"Alternative",definition:e(n.definition)};if(n instanceof xh)return{type:"Option",idx:n.idx,definition:e(n.definition)};if(n instanceof dg)return{type:"RepetitionMandatory",idx:n.idx,definition:e(n.definition)};if(n instanceof pg)return{type:"RepetitionMandatoryWithSeparator",idx:n.idx,separator:Nk(new Jo({terminalType:n.separator})),definition:e(n.definition)};if(n instanceof Rp)return{type:"RepetitionWithSeparator",idx:n.idx,separator:Nk(new Jo({terminalType:n.separator})),definition:e(n.definition)};if(n instanceof uc)return{type:"Repetition",idx:n.idx,definition:e(n.definition)};if(n instanceof kp)return{type:"Alternation",idx:n.idx,definition:e(n.definition)};if(n instanceof Jo){const t={type:"Terminal",name:n.terminalType.name,label:fbe(n.terminalType),idx:n.idx};Rh(n.label)&&(t.terminalLabel=n.label);const r=n.terminalType.PATTERN;return n.terminalType.PATTERN&&(t.pattern=J0(r)?r.source:r),t}else{if(n instanceof Vx)return{type:"Rule",name:n.name,orgText:n.orgText,definition:e(n.definition)};throw Error("non exhaustive match")}}}class T1{visit(e){const t=e;switch(t.constructor){case Mh:return this.visitNonTerminal(t);case Ih:return this.visitAlternative(t);case xh:return this.visitOption(t);case dg:return this.visitRepetitionMandatory(t);case pg:return this.visitRepetitionMandatoryWithSeparator(t);case Rp:return this.visitRepetitionWithSeparator(t);case uc:return this.visitRepetition(t);case kp:return this.visitAlternation(t);case Jo:return this.visitTerminal(t);case Vx:return this.visitRule(t);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function mbe(n){return n instanceof Ih||n instanceof xh||n instanceof uc||n instanceof dg||n instanceof pg||n instanceof Rp||n instanceof Jo||n instanceof Vx}function NM(n,e=[]){return n instanceof xh||n instanceof uc||n instanceof Rp?!0:n instanceof kp?Q5(n.definition,r=>NM(r,e)):n instanceof Mh&&Au(e,n)?!1:n instanceof fg?(n instanceof Mh&&e.push(n),pp(n.definition,r=>NM(r,e))):!1}function gbe(n){return n instanceof kp}function km(n){if(n instanceof Mh)return"SUBRULE";if(n instanceof xh)return"OPTION";if(n instanceof kp)return"OR";if(n instanceof dg)return"AT_LEAST_ONE";if(n instanceof pg)return"AT_LEAST_ONE_SEP";if(n instanceof Rp)return"MANY_SEP";if(n instanceof uc)return"MANY";if(n instanceof Jo)return"CONSUME";throw Error("non exhaustive match")}class EO{walk(e,t=[]){Dr(e.definition,(r,i)=>{const s=ol(e.definition,i+1);if(r instanceof Mh)this.walkProdRef(r,s,t);else if(r instanceof Jo)this.walkTerminal(r,s,t);else if(r instanceof Ih)this.walkFlat(r,s,t);else if(r instanceof xh)this.walkOption(r,s,t);else if(r instanceof dg)this.walkAtLeastOne(r,s,t);else if(r instanceof pg)this.walkAtLeastOneSep(r,s,t);else if(r instanceof Rp)this.walkManySep(r,s,t);else if(r instanceof uc)this.walkMany(r,s,t);else if(r instanceof kp)this.walkOr(r,s,t);else throw Error("non exhaustive match")})}walkTerminal(e,t,r){}walkProdRef(e,t,r){}walkFlat(e,t,r){const i=t.concat(r);this.walk(e,i)}walkOption(e,t,r){const i=t.concat(r);this.walk(e,i)}walkAtLeastOne(e,t,r){const i=[new xh({definition:e.definition})].concat(t,r);this.walk(e,i)}walkAtLeastOneSep(e,t,r){const i=p9(e,t,r);this.walk(e,i)}walkMany(e,t,r){const i=[new xh({definition:e.definition})].concat(t,r);this.walk(e,i)}walkManySep(e,t,r){const i=p9(e,t,r);this.walk(e,i)}walkOr(e,t,r){const i=t.concat(r);Dr(e.definition,s=>{const o=new Ih({definition:[s]});this.walk(o,i)})}}function p9(n,e,t){return[new xh({definition:[new Jo({terminalType:n.separator})].concat(n.definition)})].concat(e,t)}function nC(n){if(n instanceof Mh)return nC(n.referencedRule);if(n instanceof Jo)return ybe(n);if(mbe(n))return _be(n);if(gbe(n))return vbe(n);throw Error("non exhaustive match")}function _be(n){let e=[];const t=n.definition;let r=0,i=t.length>r,s,o=!0;for(;i&&o;)s=t[r],o=NM(s),e=e.concat(nC(s)),r=r+1,i=t.length>r;return SO(e)}function vbe(n){const e=ir(n.definition,t=>nC(t));return SO(_f(e))}function ybe(n){return[n.terminalType]}const Wq="_~IN~_";class bbe extends EO{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,t,r){}walkProdRef(e,t,r){const i=Ebe(e.referencedRule,e.idx)+this.topProd.name,s=t.concat(r),o=new Ih({definition:s}),a=nC(o);this.follows[i]=a}}function Sbe(n){const e={};return Dr(n,t=>{const r=new bbe(t).startWalking();Ch(e,r)}),e}function Ebe(n,e){return n.name+e+Wq}function jr(n){return n.charCodeAt(0)}function jN(n,e){Array.isArray(n)?n.forEach(function(t){e.push(t)}):e.push(n)}function HT(n,e){if(n[e]===!0)throw"duplicate flag "+e;n[e],n[e]=!0}function qS(n){if(n===void 0)throw Error("Internal Error - Should never get here!");return!0}function xbe(){throw Error("Internal Error - Should never get here!")}function m9(n){return n.type==="Character"}const PM=[];for(let n=jr("0");n<=jr("9");n++)PM.push(n);const DM=[jr("_")].concat(PM);for(let n=jr("a");n<=jr("z");n++)DM.push(n);for(let n=jr("A");n<=jr("Z");n++)DM.push(n);const g9=[jr(" "),jr("\f"),jr(`
`),jr("\r"),jr("	"),jr("\v"),jr("	"),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr(""),jr("\u2028"),jr("\u2029"),jr(""),jr(""),jr(""),jr("\uFEFF")],Tbe=/[0-9a-fA-F]/,CR=/[0-9]/,wbe=/[1-9]/;class Abe{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const t=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":HT(r,"global");break;case"i":HT(r,"ignoreCase");break;case"m":HT(r,"multiLine");break;case"u":HT(r,"unicode");break;case"y":HT(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:t,loc:this.loc(0)}}disjunction(){const e=[],t=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(t)}}alternative(){const e=[],t=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let t;switch(this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead";break;case"<":{switch(this.popChar()){case"=":t="Lookbehind";break;case"!":t="NegativeLookbehind"}break}}qS(t);const r=this.disjunction();return this.consumeChar(")"),{type:t,value:r,loc:this.loc(e)}}return xbe()}quantifier(e=!1){let t;const r=this.idx;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),t={atLeast:i,atMost:s}):t={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&t===void 0)return;qS(t);break}if(!(e===!0&&t===void 0)&&qS(t))return this.peekChar(0)==="?"?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t.loc=this.loc(r),t}atom(){let e;const t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),qS(e))return e.loc=this.loc(t),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[jr(`
`),jr("\r"),jr("\u2028"),jr("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,t=!1;switch(this.popChar()){case"d":e=PM;break;case"D":e=PM,t=!0;break;case"s":e=g9;break;case"S":e=g9,t=!0;break;case"w":e=DM;break;case"W":e=DM,t=!0;break}if(qS(e))return{type:"Set",value:e,complement:t}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=jr("\f");break;case"n":e=jr(`
`);break;case"r":e=jr("\r");break;case"t":e=jr("	");break;case"v":e=jr("\v");break}if(qS(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:jr("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:jr(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:jr(e)}}}characterClass(){const e=[];let t=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),t=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,m9(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,m9(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else jN(r.value,e),e.push(jr("-")),jN(i.value,e)}else jN(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:jr("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;this.consumeChar("("),this.peekChar(0)==="?"?(this.consumeChar("?"),this.consumeChar(":"),e=!1):this.groupIdx++;const t=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:t};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(wbe.test(e)===!1)throw Error("Expecting a positive integer");for(;CR.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(CR.test(e)===!1)throw Error("Expecting an integer");for(;CR.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:jr(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return CR.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!"||this.peekChar(2)==="<"&&(this.peekChar(3)==="="||this.peekChar(3)==="!"));default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let t="";for(let i=0;i<e;i++){const s=this.popChar();if(Tbe.test(s)===!1)throw Error("Expecting a HexDecimal digits");t+=s}return{type:"Character",value:parseInt(t,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class e6{visitChildren(e){for(const t in e){const r=e[t];e.hasOwnProperty(t)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Lookbehind":this.visitLookbehind(e);break;case"NegativeLookbehind":this.visitNegativeLookbehind(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitLookbehind(e){}visitNegativeLookbehind(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let Pk={};const Cbe=new Abe;function xO(n){const e=n.toString();if(Pk.hasOwnProperty(e))return Pk[e];{const t=Cbe.pattern(e);return Pk[e]=t,t}}function Rbe(){Pk={}}const qq="Complement Sets are not supported for first char optimization",LM=`Unable to use "first char" lexer optimizations:
`;function kbe(n,e=!1){try{const t=xO(n);return NL(t.value,{},t.flags.ignoreCase)}catch(t){if(t.message===qq)e&&Vq(`${LM}	Unable to optimize: < ${n.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),OL(`${LM}
	Failed parsing: < ${n.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function NL(n,e,t){switch(n.type){case"Disjunction":for(let i=0;i<n.value.length;i++)NL(n.value[i],e,t);break;case"Alternative":const r=n.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"Lookbehind":case"NegativeLookbehind":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":RR(o.value,e,t);break;case"Set":if(o.complement===!0)throw Error(qq);Dr(o.value,c=>{if(typeof c=="number")RR(c,e,t);else{const l=c;if(t===!0)for(let u=l.from;u<=l.to;u++)RR(u,e,t);else{for(let u=l.from;u<=l.to&&u<ww;u++)RR(u,e,t);if(l.to>=ww){const u=l.from>=ww?l.from:ww,h=l.to,f=$v(u),d=$v(h);for(let p=f;p<=d;p++)e[p]=p}}}});break;case"Group":NL(o.value,e,t);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&PL(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Ha(e)}function RR(n,e,t){const r=$v(n);e[r]=r,t===!0&&Mbe(n,e)}function Mbe(n,e){const t=String.fromCharCode(n),r=t.toUpperCase();if(r!==t){const i=$v(r.charCodeAt(0));e[i]=i}else{const i=t.toLowerCase();if(i!==t){const s=$v(i.charCodeAt(0));e[s]=s}}}function _9(n,e){return ox(n.value,t=>{if(typeof t=="number")return Au(e,t);{const r=t;return ox(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function PL(n){const e=n.quantifier;return e&&e.atLeast===0?!0:n.value?qi(n.value)?pp(n.value,PL):PL(n.value):!1}class Ibe extends e6{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return;case"Lookbehind":this.visitLookbehind(e);return;case"NegativeLookbehind":this.visitNegativeLookbehind(e);return}super.visitChildren(e)}}visitCharacter(e){Au(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?_9(e,this.targetCharCodes)===void 0&&(this.found=!0):_9(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function t6(n,e){if(e instanceof RegExp){const t=xO(e),r=new Ibe(n);return r.visit(t),r.found}else return ox(e,t=>Au(n,t.charCodeAt(0)))!==void 0}const Xb="PATTERN",Tw="defaultMode",kR="modes";let Yq=typeof new RegExp("(?:)").sticky=="boolean";function Obe(n,e){e=J5(e,{useSticky:Yq,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(S,b)=>b()});const t=e.tracer;t("initCharCodeToOptimizedIndexMap",()=>{n1e()});let r;t("Reject Lexer.NA",()=>{r=bO(n,S=>S[Xb]===zc.NA)});let i=!1,s;t("Transform Patterns",()=>{i=!1,s=ir(r,S=>{const b=S[Xb];if(J0(b)){const T=b.source;return T.length===1&&T!=="^"&&T!=="$"&&T!=="."&&!b.ignoreCase?T:T.length===2&&T[0]==="\\"&&!Au(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],T[1])?T[1]:e.useSticky?y9(b):v9(b)}else{if(o_(b))return i=!0,{exec:b};if(typeof b=="object")return i=!0,b;if(typeof b=="string"){if(b.length===1)return b;{const T=b.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),w=new RegExp(T);return e.useSticky?y9(w):v9(w)}}else throw Error("non exhaustive match")}})});let o,a,c,l,u;t("misc mapping",()=>{o=ir(r,S=>S.tokenTypeIdx),a=ir(r,S=>{const b=S.GROUP;if(b!==zc.SKIPPED){if(Rh(b))return b;if(Q0(b))return!1;throw Error("non exhaustive match")}}),c=ir(r,S=>{const b=S.LONGER_ALT;if(b)return qi(b)?ir(b,w=>f9(r,w)):[f9(r,b)]}),l=ir(r,S=>S.PUSH_MODE),u=ir(r,S=>Mr(S,"POP_MODE"))});let h;t("Line Terminator Handling",()=>{const S=Zq(e.lineTerminatorCharacters);h=ir(r,b=>!1),e.positionTracking!=="onlyOffset"&&(h=ir(r,b=>Mr(b,"LINE_BREAKS")?!!b.LINE_BREAKS:Xq(b,S)===!1&&t6(S,b.PATTERN)))});let f,d,p,m;t("Misc Mapping #2",()=>{f=ir(r,Kq),d=ir(s,Qbe),p=kh(r,(S,b)=>{const T=b.GROUP;return Rh(T)&&T!==zc.SKIPPED&&(S[T]=[]),S},{}),m=ir(s,(S,b)=>({pattern:s[b],longerAlt:c[b],canLineTerminator:h[b],isCustom:f[b],short:d[b],group:a[b],push:l[b],pop:u[b],tokenTypeIdx:o[b],tokenType:r[b]}))});let _=!0,v=[];return e.safeMode||t("First Char Optimization",()=>{v=kh(r,(S,b,T)=>{if(typeof b.PATTERN=="string"){const w=b.PATTERN.charCodeAt(0),R=$v(w);zN(S,R,m[T])}else if(qi(b.START_CHARS_HINT)){let w;Dr(b.START_CHARS_HINT,R=>{const C=typeof R=="string"?R.charCodeAt(0):R,N=$v(C);w!==N&&(w=N,zN(S,N,m[T]))})}else if(J0(b.PATTERN))if(b.PATTERN.unicode)_=!1,e.ensureOptimizations&&OL(`${LM}	Unable to analyze < ${b.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const w=kbe(b.PATTERN,e.ensureOptimizations);ao(w)&&(_=!1),Dr(w,R=>{zN(S,R,m[T])})}else e.ensureOptimizations&&OL(`${LM}	TokenType: <${b.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),_=!1;return S},[])}),{emptyGroups:p,patternIdxToConfig:m,charCodeToPatternIdxToConfig:v,hasCustom:i,canBeOptimized:_}}function Nbe(n,e){let t=[];const r=Dbe(n);t=t.concat(r.errors);const i=Lbe(r.valid),s=i.valid;return t=t.concat(i.errors),t=t.concat(Pbe(s)),t=t.concat(Hbe(s)),t=t.concat(Gbe(s,e)),t=t.concat(Wbe(s)),t}function Pbe(n){let e=[];const t=Sd(n,r=>J0(r[Xb]));return e=e.concat(Bbe(t)),e=e.concat(zbe(t)),e=e.concat($be(t)),e=e.concat(Vbe(t)),e=e.concat(Fbe(t)),e}function Dbe(n){const e=Sd(n,i=>!Mr(i,Xb)),t=ir(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:ma.MISSING_PATTERN,tokenTypes:[i]})),r=yO(n,e);return{errors:t,valid:r}}function Lbe(n){const e=Sd(n,i=>{const s=i[Xb];return!J0(s)&&!o_(s)&&!Mr(s,"exec")&&!Rh(s)}),t=ir(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ma.INVALID_PATTERN,tokenTypes:[i]})),r=yO(n,e);return{errors:t,valid:r}}const Ube=/[^\\][$]/;function Bbe(n){class e extends e6{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const t=Sd(n,i=>{const s=i.PATTERN;try{const o=xO(s),a=new e;return a.visit(o),a.found}catch{return Ube.test(s.source)}});return ir(t,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ma.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Fbe(n){const e=Sd(n,r=>r.PATTERN.test(""));return ir(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:ma.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const jbe=/[^\\[][\^]|^\^/;function zbe(n){class e extends e6{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const t=Sd(n,i=>{const s=i.PATTERN;try{const o=xO(s),a=new e;return a.visit(o),a.found}catch{return jbe.test(s.source)}});return ir(t,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ma.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function $be(n){const e=Sd(n,r=>{const i=r[Xb];return i instanceof RegExp&&(i.multiline||i.global)});return ir(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ma.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function Vbe(n){const e=[];let t=ir(n,s=>kh(n,(o,a)=>(s.PATTERN.source===a.PATTERN.source&&!Au(e,a)&&a.PATTERN!==zc.NA&&(e.push(a),o.push(a)),o),[]));t=tC(t);const r=Sd(t,s=>s.length>1);return ir(r,s=>{const o=ir(s,c=>c.name);return{message:`The same RegExp pattern ->${bp(s).PATTERN}<-has been used in all of the following Token Types: ${o.join(", ")} <-`,type:ma.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function Hbe(n){const e=Sd(n,r=>{if(!Mr(r,"GROUP"))return!1;const i=r.GROUP;return i!==zc.SKIPPED&&i!==zc.NA&&!Rh(i)});return ir(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ma.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function Gbe(n,e){const t=Sd(n,i=>i.PUSH_MODE!==void 0&&!Au(e,i.PUSH_MODE));return ir(t,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:ma.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function Wbe(n){const e=[],t=kh(n,(r,i,s)=>{const o=i.PATTERN;return o===zc.NA||(Rh(o)?r.push({str:o,idx:s,tokenType:i}):J0(o)&&Ybe(o)&&r.push({str:o.source,idx:s,tokenType:i})),r},[]);return Dr(n,(r,i)=>{Dr(t,({str:s,idx:o,tokenType:a})=>{if(i<o&&qbe(s,r.PATTERN)){const c=`Token: ->${a.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:c,type:ma.UNREACHABLE_PATTERN,tokenTypes:[r,a]})}})}),e}function qbe(n,e){if(J0(e)){if(Kbe(e))return!1;const t=e.exec(n);return t!==null&&t.index===0}else{if(o_(e))return e(n,0,[],{});if(Mr(e,"exec"))return e.exec(n,0,[],{});if(typeof e=="string")return e===n;throw Error("non exhaustive match")}}function Ybe(n){return ox([".","\\","[","]","|","^","$","(",")","?","*","+","{"],t=>n.source.indexOf(t)!==-1)===void 0}function Kbe(n){return/(\(\?=)|(\(\?!)|(\(\?<=)|(\(\?<!)/.test(n.source)}function v9(n){const e=n.ignoreCase?"i":"";return new RegExp(`^(?:${n.source})`,e)}function y9(n){const e=n.ignoreCase?"iy":"y";return new RegExp(`${n.source}`,e)}function Xbe(n,e,t){const r=[];return Mr(n,Tw)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Tw+`> property in its definition
`,type:ma.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Mr(n,kR)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+kR+`> property in its definition
`,type:ma.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Mr(n,kR)&&Mr(n,Tw)&&!Mr(n.modes,n.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${Tw}: <${n.defaultMode}>which does not exist
`,type:ma.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Mr(n,kR)&&Dr(n.modes,(i,s)=>{Dr(i,(o,a)=>{if(Q0(o))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${a}>
`,type:ma.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(Mr(o,"LONGER_ALT")){const c=qi(o.LONGER_ALT)?o.LONGER_ALT:[o.LONGER_ALT];Dr(c,l=>{!Q0(l)&&!Au(i,l)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${l.name}> on token <${o.name}> outside of mode <${s}>
`,type:ma.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function Zbe(n,e,t){const r=[];let i=!1;const s=tC(_f(Ha(n.modes))),o=bO(s,c=>c[Xb]===zc.NA),a=Zq(t);return e&&Dr(o,c=>{const l=Xq(c,a);if(l!==!1){const h={message:t1e(c,l),type:l.issue,tokenType:c};r.push(h)}else Mr(c,"LINE_BREAKS")?c.LINE_BREAKS===!0&&(i=!0):t6(a,c.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:ma.NO_LINE_BREAKS_FLAGS}),r}function Jbe(n){const e={},t=gd(n);return Dr(t,r=>{const i=n[r];if(qi(i))e[r]=[];else throw Error("non exhaustive match")}),e}function Kq(n){const e=n.PATTERN;if(J0(e))return!1;if(o_(e))return!0;if(Mr(e,"exec"))return!0;if(Rh(e))return!1;throw Error("non exhaustive match")}function Qbe(n){return Rh(n)&&n.length===1?n.charCodeAt(0):!1}const e1e={test:function(n){const e=n.length;for(let t=this.lastIndex;t<e;t++){const r=n.charCodeAt(t);if(r===10)return this.lastIndex=t+1,!0;if(r===13)return n.charCodeAt(t+1)===10?this.lastIndex=t+2:this.lastIndex=t+1,!0}return!1},lastIndex:0};function Xq(n,e){if(Mr(n,"LINE_BREAKS"))return!1;if(J0(n.PATTERN)){try{t6(e,n.PATTERN)}catch(t){return{issue:ma.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}else{if(Rh(n.PATTERN))return!1;if(Kq(n))return{issue:ma.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function t1e(n,e){if(e.issue===ma.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${n.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===ma.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${n.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function Zq(n){return ir(n,t=>Rh(t)?t.charCodeAt(0):t)}function zN(n,e,t){n[e]===void 0?n[e]=[t]:n[e].push(t)}const ww=256;let Dk=[];function $v(n){return n<ww?n:Dk[n]}function n1e(){if(ao(Dk)){Dk=new Array(65536);for(let n=0;n<65536;n++)Dk[n]=n>255?255+~~(n/255):n}}function rC(n,e){const t=n.tokenTypeIdx;return t===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[t]===!0}function UM(n,e){return n.tokenTypeIdx===e.tokenTypeIdx}let b9=1;const Jq={};function iC(n){const e=r1e(n);i1e(e),o1e(e),s1e(e),Dr(e,t=>{t.isParent=t.categoryMatches.length>0})}function r1e(n){let e=fl(n),t=n,r=!0;for(;r;){t=tC(_f(ir(t,s=>s.CATEGORIES)));const i=yO(t,e);e=e.concat(i),ao(i)?r=!1:t=i}return e}function i1e(n){Dr(n,e=>{eY(e)||(Jq[b9]=e,e.tokenTypeIdx=b9++),S9(e)&&!qi(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),S9(e)||(e.CATEGORIES=[]),a1e(e)||(e.categoryMatches=[]),c1e(e)||(e.categoryMatchesMap={})})}function s1e(n){Dr(n,e=>{e.categoryMatches=[],Dr(e.categoryMatchesMap,(t,r)=>{e.categoryMatches.push(Jq[r].tokenTypeIdx)})})}function o1e(n){Dr(n,e=>{Qq([],e)})}function Qq(n,e){Dr(n,t=>{e.categoryMatchesMap[t.tokenTypeIdx]=!0}),Dr(e.CATEGORIES,t=>{const r=n.concat(e);Au(r,t)||Qq(r,t)})}function eY(n){return Mr(n,"tokenTypeIdx")}function S9(n){return Mr(n,"CATEGORIES")}function a1e(n){return Mr(n,"categoryMatches")}function c1e(n){return Mr(n,"categoryMatchesMap")}function l1e(n){return Mr(n,"tokenTypeIdx")}const u1e={buildUnableToPopLexerModeMessage(n){return`Unable to pop Lexer Mode after encountering Token ->${n.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(n,e,t,r,i,s){return`unexpected character: ->${n.charAt(e)}<- at offset: ${e}, skipped ${t} characters.`}};var ma;(function(n){n[n.MISSING_PATTERN=0]="MISSING_PATTERN",n[n.INVALID_PATTERN=1]="INVALID_PATTERN",n[n.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",n[n.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",n[n.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",n[n.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",n[n.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",n[n.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",n[n.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",n[n.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",n[n.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",n[n.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",n[n.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",n[n.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",n[n.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",n[n.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",n[n.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",n[n.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(ma||(ma={}));const Aw={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:u1e,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Aw);let zc=class{constructor(e,t=Aw){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=Hq(s),l=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&l(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}else return s()},typeof t=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Ch({},Aw,t);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Aw.lineTerminatorsPattern)this.config.lineTerminatorsPattern=e1e;else if(this.config.lineTerminatorCharacters===Aw.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),qi(e)?i={modes:{defaultMode:fl(e)},defaultMode:Tw}:(s=!1,i=fl(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Xbe(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(Zbe(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},Dr(i.modes,(a,c)=>{i.modes[c]=bO(a,l=>Q0(l))});const o=gd(i.modes);if(Dr(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Nbe(a,o))}),ao(this.lexerDefinitionErrors)){iC(a);let l;this.TRACE_INIT("analyzeTokenTypes",()=>{l=Obe(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=l.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=l.charCodeToPatternIdxToConfig,this.emptyGroups=Ch({},this.emptyGroups,l.emptyGroups),this.hasCustom=l.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=l.canBeOptimized}})}),this.defaultMode=i.defaultMode,!ao(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const c=ir(this.lexerDefinitionErrors,l=>l.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+c)}Dr(this.lexerDefinitionWarning,a=>{Vq(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Yq?(this.chopInput=ix,this.match=this.matchWithTest):(this.updateLastIndex=sc,this.match=this.matchWithExec),s&&(this.handleModes=sc),this.trackStartLines===!1&&(this.computeNewColumn=ix),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=sc),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=kh(this.canModeBeOptimized,(c,l,u)=>(l===!1&&c.push(u),c),[]);if(t.ensureOptimizations&&!ao(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{Rbe()}),this.TRACE_INIT("toFastProperties",()=>{Gq(this)})})}tokenize(e,t=this.defaultMode){if(!ao(this.lexerDefinitionErrors)){const i=ir(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,t)}tokenizeInternal(e,t){let r,i,s,o,a,c,l,u,h,f,d,p,m,_,v;const S=e,b=S.length;let T=0,w=0;const R=this.hasCustom?0:Math.floor(e.length/10),C=new Array(R),N=[];let U=this.trackStartLines?1:void 0,B=this.trackStartLines?1:void 0;const $=Jbe(this.emptyGroups),I=this.trackStartLines,L=this.config.lineTerminatorsPattern;let P=0,H=[],X=[];const G=[],Y=[];Object.freeze(Y);let J;function Q(){return H}function z(Ee){const Re=$v(Ee),Te=X[Re];return Te===void 0?Y:Te}const q=Ee=>{if(G.length===1&&Ee.tokenType.PUSH_MODE===void 0){const Re=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(Ee);N.push({offset:Ee.startOffset,line:Ee.startLine,column:Ee.startColumn,length:Ee.image.length,message:Re})}else{G.pop();const Re=Kb(G);H=this.patternIdxToConfig[Re],X=this.charCodeToPatternIdxToConfig[Re],P=H.length;const Te=this.canModeBeOptimized[Re]&&this.config.safeMode===!1;X&&Te?J=z:J=Q}};function ee(Ee){G.push(Ee),X=this.charCodeToPatternIdxToConfig[Ee],H=this.patternIdxToConfig[Ee],P=H.length,P=H.length;const Re=this.canModeBeOptimized[Ee]&&this.config.safeMode===!1;X&&Re?J=z:J=Q}ee.call(this,t);let te;const ie=this.config.recoveryEnabled;for(;T<b;){c=null;const Ee=S.charCodeAt(T),Re=J(Ee),Te=Re.length;for(r=0;r<Te;r++){te=Re[r];const Pe=te.pattern;l=null;const We=te.short;if(We!==!1?Ee===We&&(c=Pe):te.isCustom===!0?(v=Pe.exec(S,T,C,$),v!==null?(c=v[0],v.payload!==void 0&&(l=v.payload)):c=null):(this.updateLastIndex(Pe,T),c=this.match(Pe,e,T)),c!==null){if(a=te.longerAlt,a!==void 0){const it=a.length;for(s=0;s<it;s++){const ht=H[a[s]],vt=ht.pattern;if(u=null,ht.isCustom===!0?(v=vt.exec(S,T,C,$),v!==null?(o=v[0],v.payload!==void 0&&(u=v.payload)):o=null):(this.updateLastIndex(vt,T),o=this.match(vt,e,T)),o&&o.length>c.length){c=o,l=u,te=ht;break}}}break}}if(c!==null){if(h=c.length,f=te.group,f!==void 0&&(d=te.tokenTypeIdx,p=this.createTokenInstance(c,T,d,te.tokenType,U,B,h),this.handlePayload(p,l),f===!1?w=this.addToken(C,w,p):$[f].push(p)),e=this.chopInput(e,h),T=T+h,B=this.computeNewColumn(B,h),I===!0&&te.canLineTerminator===!0){let Pe=0,We,it;L.lastIndex=0;do We=L.test(c),We===!0&&(it=L.lastIndex-1,Pe++);while(We===!0);Pe!==0&&(U=U+Pe,B=h-it,this.updateTokenEndLineColumnLocation(p,f,it,Pe,U,B,h))}this.handleModes(te,q,ee,p)}else{const Pe=T,We=U,it=B;let ht=ie===!1;for(;ht===!1&&T<b;)for(e=this.chopInput(e,1),T++,i=0;i<P;i++){const vt=H[i],re=vt.pattern,Le=vt.short;if(Le!==!1?S.charCodeAt(T)===Le&&(ht=!0):vt.isCustom===!0?ht=re.exec(S,T,C,$)!==null:(this.updateLastIndex(re,T),ht=re.exec(e)!==null),ht===!0)break}if(m=T-Pe,B=this.computeNewColumn(B,m),_=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(S,Pe,m,We,it,Kb(G)),N.push({offset:Pe,line:We,column:it,length:m,message:_}),ie===!1)break}}return this.hasCustom||(C.length=w),{tokens:C,groups:$,errors:N}}handleModes(e,t,r,i){if(e.pop===!0){const s=e.push;t(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,t){return e.substring(t)}updateLastIndex(e,t){e.lastIndex=t}updateTokenEndLineColumnLocation(e,t,r,i,s,o,a){let c,l;t!==void 0&&(c=r===a-1,l=c?-1:0,i===1&&c===!0||(e.endLine=s+l,e.endColumn=o-1+-l))}computeNewColumn(e,t){return e+t}createOffsetOnlyToken(e,t,r,i){return{image:e,startOffset:t,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,t,r,i,s,o){return{image:e,startOffset:t,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(e,t,r,i,s,o,a){return{image:e,startOffset:t,endOffset:t+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,t,r){return e.push(r),t}addTokenUsingMemberAccess(e,t,r){return e[t]=r,t++,t}handlePayloadNoCustom(e,t){}handlePayloadWithCustom(e,t){t!==null&&(e.payload=t)}matchWithTest(e,t,r){return e.test(t)===!0?t.substring(r,e.lastIndex):null}matchWithExec(e,t){const r=e.exec(t);return r!==null?r[0]:null}};zc.SKIPPED="This marks a skipped Token pattern, this means each token identified by it will be consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";zc.NA=/NOT_APPLICABLE/;function Uw(n){return tY(n)?n.LABEL:n.name}function tY(n){return Rh(n.LABEL)&&n.LABEL!==""}const h1e="parent",E9="categories",x9="label",T9="group",w9="push_mode",A9="pop_mode",C9="longer_alt",R9="line_breaks",k9="start_chars_hint";function Cu(n){return f1e(n)}function f1e(n){const e=n.pattern,t={};if(t.name=n.name,Q0(e)||(t.PATTERN=e),Mr(n,h1e))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return Mr(n,E9)&&(t.CATEGORIES=n[E9]),iC([t]),Mr(n,x9)&&(t.LABEL=n[x9]),Mr(n,T9)&&(t.GROUP=n[T9]),Mr(n,A9)&&(t.POP_MODE=n[A9]),Mr(n,w9)&&(t.PUSH_MODE=n[w9]),Mr(n,C9)&&(t.LONGER_ALT=n[C9]),Mr(n,R9)&&(t.LINE_BREAKS=n[R9]),Mr(n,k9)&&(t.START_CHARS_HINT=n[k9]),t}const Zb=Cu({name:"EOF",pattern:zc.NA});iC([Zb]);function sC(n,e,t,r,i,s,o,a){return{image:e,startOffset:t,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:n.tokenTypeIdx,tokenType:n}}function d1e(n,e){return rC(n,e)}const nY={buildMismatchTokenMessage({expected:n,actual:e,previous:t,ruleName:r}){return`Expecting ${tY(n)?`--> ${Uw(n)} <--`:`token of type --> ${n.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:n,ruleName:e}){return"Redundant input, expecting EOF but found: "+n.image},buildNoViableAltMessage({expectedPathsPerAlt:n,actual:e,previous:t,customUserDescription:r,ruleName:i}){const s="Expecting: ",a=`
but found: '`+bp(e).image+"'";if(r)return s+r+a;{const c=kh(n,(f,d)=>f.concat(d),[]),l=ir(c,f=>`[${ir(f,d=>Uw(d)).join(", ")}]`),h=`one of these possible Token sequences:
${ir(l,(f,d)=>`  ${d+1}. ${f}`).join(`
`)}`;return s+h+a}},buildEarlyExitMessage({expectedIterationPaths:n,actual:e,customUserDescription:t,ruleName:r}){const i="Expecting: ",o=`
but found: '`+bp(e).image+"'";if(t)return i+t+o;{const c=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${ir(n,l=>`[${ir(l,u=>Uw(u)).join(",")}]`).join(" ,")}>`;return i+c+o}}};Object.freeze(nY);const p1e={buildRuleNotFoundError(n,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+n.name+"<-"}},Ab={buildDuplicateFoundError(n,e){function t(u){return u instanceof Jo?u.terminalType.name:u instanceof Mh?u.nonTerminalName:""}const r=n.name,i=bp(e),s=i.idx,o=km(i),a=t(i),c=s>0;let l=`->${o}${c?s:""}<- ${a?`with argument: ->${a}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return l=l.replace(/[ \t]+/g," "),l=l.replace(/\s\s+/g,`
`),l},buildNamespaceConflictError(n){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${n.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(n){const e=ir(n.prefixPath,i=>Uw(i)).join(", "),t=n.alternation.idx===0?"":n.alternation.idx;return`Ambiguous alternatives: <${n.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${t}> inside <${n.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(n){const e=ir(n.prefixPath,i=>Uw(i)).join(", "),t=n.alternation.idx===0?"":n.alternation.idx;let r=`Ambiguous Alternatives Detected: <${n.ambiguityIndices.join(" ,")}> in <OR${t}> inside <${n.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(n){let e=km(n.repetition);return n.repetition.idx!==0&&(e+=n.repetition.idx),`The repetition <${e}> within Rule <${n.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(n){return"deprecated"},buildEmptyAlternationError(n){return`Ambiguous empty alternative: <${n.emptyChoiceIdx+1}> in <OR${n.alternation.idx}> inside <${n.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(n){return`An Alternation cannot have more than 256 alternatives:
<OR${n.alternation.idx}> inside <${n.topLevelRule.name}> Rule.
 has ${n.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(n){const e=n.topLevelRule.name,t=ir(n.leftRecursionPath,s=>s.name),r=`${e} --> ${t.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(n){return"deprecated"},buildDuplicateRuleNameError(n){let e;return n.topLevelRule instanceof Vx?e=n.topLevelRule.name:e=n.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${n.grammarName}<-`}};function m1e(n,e){const t=new g1e(n,e);return t.resolveRefs(),t.errors}class g1e extends T1{constructor(e,t){super(),this.nameToTopRule=e,this.errMsgProvider=t,this.errors=[]}resolveRefs(){Dr(Ha(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const t=this.nameToTopRule[e.nonTerminalName];if(t)e.referencedRule=t;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:Eu.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class _1e extends EO{constructor(e,t){super(),this.topProd=e,this.path=t,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=fl(this.path.ruleStack).reverse(),this.occurrenceStack=fl(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,t=[]){this.found||super.walk(e,t)}walkProdRef(e,t,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=t.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){ao(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class v1e extends _1e{constructor(e,t){super(e,t),this.path=t,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,t,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=t.concat(r),s=new Ih({definition:i});this.possibleTokTypes=nC(s),this.found=!0}}}class TO extends EO{constructor(e,t){super(),this.topRule=e,this.occurrence=t,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class y1e extends TO{walkMany(e,t,r){if(e.idx===this.occurrence){const i=bp(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Jo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,t,r)}}class M9 extends TO{walkManySep(e,t,r){if(e.idx===this.occurrence){const i=bp(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Jo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,t,r)}}class b1e extends TO{walkAtLeastOne(e,t,r){if(e.idx===this.occurrence){const i=bp(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Jo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,t,r)}}class I9 extends TO{walkAtLeastOneSep(e,t,r){if(e.idx===this.occurrence){const i=bp(t.concat(r));this.result.isEndOfRule=i===void 0,i instanceof Jo&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,t,r)}}function DL(n,e,t=[]){t=fl(t);let r=[],i=0;function s(a){return a.concat(ol(n,i+1))}function o(a){const c=DL(s(a),e,t);return r.concat(c)}for(;t.length<e&&i<n.length;){const a=n[i];if(a instanceof Ih)return o(a.definition);if(a instanceof Mh)return o(a.definition);if(a instanceof xh)r=o(a.definition);else if(a instanceof dg){const c=a.definition.concat([new uc({definition:a.definition})]);return o(c)}else if(a instanceof pg){const c=[new Ih({definition:a.definition}),new uc({definition:[new Jo({terminalType:a.separator})].concat(a.definition)})];return o(c)}else if(a instanceof Rp){const c=a.definition.concat([new uc({definition:[new Jo({terminalType:a.separator})].concat(a.definition)})]);r=o(c)}else if(a instanceof uc){const c=a.definition.concat([new uc({definition:a.definition})]);r=o(c)}else{if(a instanceof kp)return Dr(a.definition,c=>{ao(c.definition)===!1&&(r=o(c.definition))}),r;if(a instanceof Jo)t.push(a.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:t,suffixDef:ol(n,i)}),r}function rY(n,e,t,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=e.length,l=c-r-1,u=[],h=[];for(h.push({idx:-1,def:n,ruleStack:[],occurrenceStack:[]});!ao(h);){const f=h.pop();if(f===o){a&&Kb(h).idx<=l&&h.pop();continue}const d=f.def,p=f.idx,m=f.ruleStack,_=f.occurrenceStack;if(ao(d))continue;const v=d[0];if(v===i){const S={idx:p,def:ol(d),ruleStack:oA(m),occurrenceStack:oA(_)};h.push(S)}else if(v instanceof Jo)if(p<c-1){const S=p+1,b=e[S];if(t(b,v.terminalType)){const T={idx:S,def:ol(d),ruleStack:m,occurrenceStack:_};h.push(T)}}else if(p===c-1)u.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:m,occurrenceStack:_}),a=!0;else throw Error("non exhaustive match");else if(v instanceof Mh){const S=fl(m);S.push(v.nonTerminalName);const b=fl(_);b.push(v.idx);const T={idx:p,def:v.definition.concat(s,ol(d)),ruleStack:S,occurrenceStack:b};h.push(T)}else if(v instanceof xh){const S={idx:p,def:ol(d),ruleStack:m,occurrenceStack:_};h.push(S),h.push(o);const b={idx:p,def:v.definition.concat(ol(d)),ruleStack:m,occurrenceStack:_};h.push(b)}else if(v instanceof dg){const S=new uc({definition:v.definition,idx:v.idx}),b=v.definition.concat([S],ol(d)),T={idx:p,def:b,ruleStack:m,occurrenceStack:_};h.push(T)}else if(v instanceof pg){const S=new Jo({terminalType:v.separator}),b=new uc({definition:[S].concat(v.definition),idx:v.idx}),T=v.definition.concat([b],ol(d)),w={idx:p,def:T,ruleStack:m,occurrenceStack:_};h.push(w)}else if(v instanceof Rp){const S={idx:p,def:ol(d),ruleStack:m,occurrenceStack:_};h.push(S),h.push(o);const b=new Jo({terminalType:v.separator}),T=new uc({definition:[b].concat(v.definition),idx:v.idx}),w=v.definition.concat([T],ol(d)),R={idx:p,def:w,ruleStack:m,occurrenceStack:_};h.push(R)}else if(v instanceof uc){const S={idx:p,def:ol(d),ruleStack:m,occurrenceStack:_};h.push(S),h.push(o);const b=new uc({definition:v.definition,idx:v.idx}),T=v.definition.concat([b],ol(d)),w={idx:p,def:T,ruleStack:m,occurrenceStack:_};h.push(w)}else if(v instanceof kp)for(let S=v.definition.length-1;S>=0;S--){const b=v.definition[S],T={idx:p,def:b.definition.concat(ol(d)),ruleStack:m,occurrenceStack:_};h.push(T),h.push(o)}else if(v instanceof Ih)h.push({idx:p,def:v.definition.concat(ol(d)),ruleStack:m,occurrenceStack:_});else if(v instanceof Vx)h.push(S1e(v,p,m,_));else throw Error("non exhaustive match")}return u}function S1e(n,e,t,r){const i=fl(t);i.push(n.name);const s=fl(r);return s.push(1),{idx:e,def:n.definition,ruleStack:i,occurrenceStack:s}}var fa;(function(n){n[n.OPTION=0]="OPTION",n[n.REPETITION=1]="REPETITION",n[n.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",n[n.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",n[n.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",n[n.ALTERNATION=5]="ALTERNATION"})(fa||(fa={}));function iY(n){if(n instanceof xh||n==="Option")return fa.OPTION;if(n instanceof uc||n==="Repetition")return fa.REPETITION;if(n instanceof dg||n==="RepetitionMandatory")return fa.REPETITION_MANDATORY;if(n instanceof pg||n==="RepetitionMandatoryWithSeparator")return fa.REPETITION_MANDATORY_WITH_SEPARATOR;if(n instanceof Rp||n==="RepetitionWithSeparator")return fa.REPETITION_WITH_SEPARATOR;if(n instanceof kp||n==="Alternation")return fa.ALTERNATION;throw Error("non exhaustive match")}function E1e(n,e,t,r,i,s){const o=n6(n,e,t),a=aY(o)?UM:rC;return s(o,r,a,i)}function x1e(n,e,t,r,i,s){const o=r6(n,e,i,t),a=aY(o)?UM:rC;return s(o[0],a,r)}function T1e(n,e,t,r){const i=n.length,s=pp(n,o=>pp(o,a=>a.length===1));if(e)return function(o){const a=ir(o,c=>c.GATE);for(let c=0;c<i;c++){const l=n[c],u=l.length,h=a[c];if(!(h!==void 0&&h.call(this)===!1))e:for(let f=0;f<u;f++){const d=l[f],p=d.length;for(let m=0;m<p;m++){const _=this.LA(m+1);if(t(_,d[m])===!1)continue e}return c}}};if(s&&!r){const o=ir(n,c=>_f(c)),a=kh(o,(c,l,u)=>(Dr(l,h=>{Mr(c,h.tokenTypeIdx)||(c[h.tokenTypeIdx]=u),Dr(h.categoryMatches,f=>{Mr(c,f)||(c[f]=u)})}),c),{});return function(){const c=this.LA(1);return a[c.tokenTypeIdx]}}else return function(){for(let o=0;o<i;o++){const a=n[o],c=a.length;e:for(let l=0;l<c;l++){const u=a[l],h=u.length;for(let f=0;f<h;f++){const d=this.LA(f+1);if(t(d,u[f])===!1)continue e}return o}}}}function w1e(n,e,t){const r=pp(n,s=>s.length===1),i=n.length;if(r&&!t){const s=_f(n);if(s.length===1&&ao(s[0].categoryMatches)){const a=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===a}}else{const o=kh(s,(a,c,l)=>(a[c.tokenTypeIdx]=!0,Dr(c.categoryMatches,u=>{a[u]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const o=n[s],a=o.length;for(let c=0;c<a;c++){const l=this.LA(c+1);if(e(l,o[c])===!1)continue e}return!0}return!1}}class A1e extends EO{constructor(e,t,r){super(),this.topProd=e,this.targetOccurrence=t,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,t,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===t?(this.restDef=r.concat(i),!0):!1}walkOption(e,t,r){this.checkIsTarget(e,fa.OPTION,t,r)||super.walkOption(e,t,r)}walkAtLeastOne(e,t,r){this.checkIsTarget(e,fa.REPETITION_MANDATORY,t,r)||super.walkOption(e,t,r)}walkAtLeastOneSep(e,t,r){this.checkIsTarget(e,fa.REPETITION_MANDATORY_WITH_SEPARATOR,t,r)||super.walkOption(e,t,r)}walkMany(e,t,r){this.checkIsTarget(e,fa.REPETITION,t,r)||super.walkOption(e,t,r)}walkManySep(e,t,r){this.checkIsTarget(e,fa.REPETITION_WITH_SEPARATOR,t,r)||super.walkOption(e,t,r)}}class sY extends T1{constructor(e,t,r){super(),this.targetOccurrence=e,this.targetProdType=t,this.targetRef=r,this.result=[]}checkIsTarget(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,fa.OPTION)}visitRepetition(e){this.checkIsTarget(e,fa.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,fa.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,fa.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,fa.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,fa.ALTERNATION)}}function O9(n){const e=new Array(n);for(let t=0;t<n;t++)e[t]=[];return e}function $N(n){let e=[""];for(let t=0;t<n.length;t++){const r=n[t],i=[];for(let s=0;s<e.length;s++){const o=e[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}e=i}return e}function C1e(n,e,t){for(let r=0;r<n.length;r++){if(r===t)continue;const i=n[r];for(let s=0;s<e.length;s++){const o=e[s];if(i[o]===!0)return!1}}return!0}function oY(n,e){const t=ir(n,o=>DL([o],1)),r=O9(t.length),i=ir(t,o=>{const a={};return Dr(o,c=>{const l=$N(c.partialPath);Dr(l,u=>{a[u]=!0})}),a});let s=t;for(let o=1;o<=e;o++){const a=s;s=O9(a.length);for(let c=0;c<a.length;c++){const l=a[c];for(let u=0;u<l.length;u++){const h=l[u].partialPath,f=l[u].suffixDef,d=$N(h);if(C1e(i,d,c)||ao(f)||h.length===e){const m=r[c];if(LL(m,h)===!1){m.push(h);for(let _=0;_<d.length;_++){const v=d[_];i[c][v]=!0}}}else{const m=DL(f,o+1,h);s[c]=s[c].concat(m),Dr(m,_=>{const v=$N(_.partialPath);Dr(v,S=>{i[c][S]=!0})})}}}}return r}function n6(n,e,t,r){const i=new sY(n,fa.ALTERNATION,r);return e.accept(i),oY(i.result,t)}function r6(n,e,t,r){const i=new sY(n,t);e.accept(i);const s=i.result,a=new A1e(e,n,t).startWalking(),c=new Ih({definition:s}),l=new Ih({definition:a});return oY([c,l],r)}function LL(n,e){e:for(let t=0;t<n.length;t++){const r=n[t];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],o=r[i];if((s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function R1e(n,e){return n.length<e.length&&pp(n,(t,r)=>{const i=e[r];return t===i||i.categoryMatchesMap[t.tokenTypeIdx]})}function aY(n){return pp(n,e=>pp(e,t=>pp(t,r=>ao(r.categoryMatches))))}function k1e(n){const e=n.lookaheadStrategy.validate({rules:n.rules,tokenTypes:n.tokenTypes,grammarName:n.grammarName});return ir(e,t=>Object.assign({type:Eu.CUSTOM_LOOKAHEAD_VALIDATION},t))}function M1e(n,e,t,r){const i=ud(n,c=>I1e(c,t)),s=V1e(n,e,t),o=ud(n,c=>F1e(c,t)),a=ud(n,c=>P1e(c,n,r,t));return i.concat(s,o,a)}function I1e(n,e){const t=new N1e;n.accept(t);const r=t.allProductions,i=$q(r,O1e),s=Cp(i,a=>a.length>1);return ir(Ha(s),a=>{const c=bp(a),l=e.buildDuplicateFoundError(n,a),u=km(c),h={message:l,type:Eu.DUPLICATE_PRODUCTIONS,ruleName:n.name,dslName:u,occurrence:c.idx},f=cY(c);return f&&(h.parameter=f),h})}function O1e(n){return`${km(n)}_#_${n.idx}_#_${cY(n)}`}function cY(n){return n instanceof Jo?n.terminalType.name:n instanceof Mh?n.nonTerminalName:""}class N1e extends T1{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function P1e(n,e,t,r){const i=[];if(kh(e,(o,a)=>a.name===n.name?o+1:o,0)>1){const o=r.buildDuplicateRuleNameError({topLevelRule:n,grammarName:t});i.push({message:o,type:Eu.DUPLICATE_RULE_NAME,ruleName:n.name})}return i}function D1e(n,e,t){const r=[];let i;return Au(e,n)||(i=`Invalid rule override, rule: ->${n}<- cannot be overridden in the grammar: ->${t}<-as it is not defined in any of the super grammars `,r.push({message:i,type:Eu.INVALID_RULE_OVERRIDE,ruleName:n})),r}function lY(n,e,t,r=[]){const i=[],s=Lk(e.definition);if(ao(s))return[];{const o=n.name;Au(s,n)&&i.push({message:t.buildLeftRecursionError({topLevelRule:n,leftRecursionPath:r}),type:Eu.LEFT_RECURSION,ruleName:o});const c=yO(s,r.concat([n])),l=ud(c,u=>{const h=fl(r);return h.push(u),lY(n,u,t,h)});return i.concat(l)}}function Lk(n){let e=[];if(ao(n))return e;const t=bp(n);if(t instanceof Mh)e.push(t.referencedRule);else if(t instanceof Ih||t instanceof xh||t instanceof dg||t instanceof pg||t instanceof Rp||t instanceof uc)e=e.concat(Lk(t.definition));else if(t instanceof kp)e=_f(ir(t.definition,s=>Lk(s.definition)));else if(!(t instanceof Jo))throw Error("non exhaustive match");const r=NM(t),i=n.length>1;if(r&&i){const s=ol(n);return e.concat(Lk(s))}else return e}class i6 extends T1{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function L1e(n,e){const t=new i6;n.accept(t);const r=t.alternations;return ud(r,s=>{const o=oA(s.definition);return ud(o,(a,c)=>{const l=rY([a],[],rC,1);return ao(l)?[{message:e.buildEmptyAlternationError({topLevelRule:n,alternation:s,emptyChoiceIdx:c}),type:Eu.NONE_LAST_EMPTY_ALT,ruleName:n.name,occurrence:s.idx,alternative:c+1}]:[]})})}function U1e(n,e,t){const r=new i6;n.accept(r);let i=r.alternations;return i=bO(i,o=>o.ignoreAmbiguities===!0),ud(i,o=>{const a=o.idx,c=o.maxLookahead||e,l=n6(a,n,c,o),u=z1e(l,o,n,t),h=$1e(l,o,n,t);return u.concat(h)})}class B1e extends T1{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function F1e(n,e){const t=new i6;n.accept(t);const r=t.alternations;return ud(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:n,alternation:s}),type:Eu.TOO_MANY_ALTS,ruleName:n.name,occurrence:s.idx}]:[])}function j1e(n,e,t){const r=[];return Dr(n,i=>{const s=new B1e;i.accept(s);const o=s.allProductions;Dr(o,a=>{const c=iY(a),l=a.maxLookahead||e,u=a.idx,f=r6(u,i,c,l)[0];if(ao(_f(f))){const d=t.buildEmptyRepetitionError({topLevelRule:i,repetition:a});r.push({message:d,type:Eu.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function z1e(n,e,t,r){const i=[],s=kh(n,(a,c,l)=>(e.definition[l].ignoreAmbiguities===!0||Dr(c,u=>{const h=[l];Dr(n,(f,d)=>{l!==d&&LL(f,u)&&e.definition[d].ignoreAmbiguities!==!0&&h.push(d)}),h.length>1&&!LL(i,u)&&(i.push(u),a.push({alts:h,path:u}))}),a),[]);return ir(s,a=>{const c=ir(a.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:c,prefixPath:a.path}),type:Eu.AMBIGUOUS_ALTS,ruleName:t.name,occurrence:e.idx,alternatives:a.alts}})}function $1e(n,e,t,r){const i=kh(n,(o,a,c)=>{const l=ir(a,u=>({idx:c,path:u}));return o.concat(l)},[]);return tC(ud(i,o=>{if(e.definition[o.idx].ignoreAmbiguities===!0)return[];const c=o.idx,l=o.path,u=Sd(i,f=>e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<c&&R1e(f.path,l));return ir(u,f=>{const d=[f.idx+1,c+1],p=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:t,alternation:e,ambiguityIndices:d,prefixPath:f.path}),type:Eu.AMBIGUOUS_PREFIX_ALTS,ruleName:t.name,occurrence:p,alternatives:d}})}))}function V1e(n,e,t){const r=[],i=ir(e,s=>s.name);return Dr(n,s=>{const o=s.name;if(Au(i,o)){const a=t.buildNamespaceConflictError(s);r.push({message:a,type:Eu.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:o})}}),r}function H1e(n){const e=J5(n,{errMsgProvider:p1e}),t={};return Dr(n.rules,r=>{t[r.name]=r}),m1e(t,e.errMsgProvider)}function G1e(n){return n=J5(n,{errMsgProvider:Ab}),M1e(n.rules,n.tokenTypes,n.errMsgProvider,n.grammarName)}const uY="MismatchedTokenException",hY="NoViableAltException",fY="EarlyExitException",dY="NotAllInputParsedException",pY=[uY,hY,fY,dY];Object.freeze(pY);function BM(n){return Au(pY,n.name)}class wO extends Error{constructor(e,t){super(e),this.token=t,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class mY extends wO{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=uY}}class W1e extends wO{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=hY}}class q1e extends wO{constructor(e,t){super(e,t),this.name=dY}}class Y1e extends wO{constructor(e,t,r){super(e,t),this.previousToken=r,this.name=fY}}const VN={},gY="InRuleRecoveryException";class K1e extends Error{constructor(e){super(e),this.name=gY}}class X1e{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Mr(e,"recoveryEnabled")?e.recoveryEnabled:e_.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=Z1e)}getTokenToInsert(e){const t=sC(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,t,r,i){const s=this.findReSyncTokenType(),o=this.exportLexerState(),a=[];let c=!1;const l=this.LA(1);let u=this.LA(1);const h=()=>{const f=this.LA(0),d=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:l,previous:f,ruleName:this.getCurrRuleFullName()}),p=new mY(d,l,this.LA(0));p.resyncedTokens=oA(a),this.SAVE_ERROR(p)};for(;!c;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,t);return}else this.tokenMatcher(u,s)?c=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,a));this.importLexerState(o)}shouldInRepetitionRecoveryBeTried(e,t,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))}getFollowsForInRuleRecovery(e,t){const r=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new K1e("sad sad panda")}canPerformInRuleRecovery(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,t){if(!this.canTokenTypeBeInsertedInRecovery(e)||ao(t))return!1;const r=this.LA(1);return ox(t,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return Au(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let t=this.LA(1),r=2;for(;;){const i=ox(e,s=>d1e(t,s));if(i!==void 0)return i;t=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return VN;const e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,t=this.RULE_OCCURRENCE_STACK;return ir(e,(r,i)=>i===0?VN:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:t[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=ir(this.buildFullFollowKeyStack(),t=>this.getFollowSetFromFollowKey(t));return _f(e)}getFollowSetFromFollowKey(e){if(e===VN)return[Zb];const t=e.ruleName+e.idxInCallingRule+Wq+e.inRule;return this.resyncFollows[t]}addToResyncTokens(e,t){return this.tokenMatcher(e,Zb)||t.push(e),t}reSyncTo(e){const t=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return oA(t)}attemptInRepetitionRecovery(e,t,r,i,s,o,a){}getCurrentGrammarPath(e,t){const r=this.getHumanReadableRuleStack(),i=fl(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:t}}getHumanReadableRuleStack(){return ir(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function Z1e(n,e,t,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const f=this.getCurrRuleFullName(),d=this.getGAstProductions()[f];c=new s(d,i).startWalking(),this.firstAfterRepMap[a]=c}let l=c.token,u=c.occurrence;const h=c.isEndOfRule;this.RULE_STACK.length===1&&h&&l===void 0&&(l=Zb,u=1),!(l===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(l,u,o)&&this.tryInRepetitionRecovery(n,e,t,l)}const J1e=4,ey=8,_Y=1<<ey,vY=2<<ey,UL=3<<ey,BL=4<<ey,FL=5<<ey,Uk=6<<ey;function HN(n,e,t){return t|e|n}class Q1e{constructor(e){var t;this.maxLookahead=(t=e?.maxLookahead)!==null&&t!==void 0?t:e_.maxLookahead}validate(e){const t=this.validateNoLeftRecursion(e.rules);if(ao(t)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...t,...r,...i,...s]}return t}validateNoLeftRecursion(e){return ud(e,t=>lY(t,t,Ab))}validateEmptyOrAlternatives(e){return ud(e,t=>L1e(t,Ab))}validateAmbiguousAlternationAlternatives(e,t){return ud(e,r=>U1e(r,t,Ab))}validateSomeNonEmptyLookaheadPath(e,t){return j1e(e,t,Ab)}buildLookaheadForAlternation(e){return E1e(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,T1e)}buildLookaheadForOptional(e){return x1e(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,iY(e.prodType),w1e)}}class eSe{initLooksAhead(e){this.dynamicTokensEnabled=Mr(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:e_.dynamicTokensEnabled,this.maxLookahead=Mr(e,"maxLookahead")?e.maxLookahead:e_.maxLookahead,this.lookaheadStrategy=Mr(e,"lookaheadStrategy")?e.lookaheadStrategy:new Q1e({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){Dr(e,t=>{this.TRACE_INIT(`${t.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:o,repetitionMandatoryWithSeparator:a,repetitionWithSeparator:c}=nSe(t);Dr(r,l=>{const u=l.idx===0?"":l.idx;this.TRACE_INIT(`${km(l)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:l.idx,rule:t,maxLookahead:l.maxLookahead||this.maxLookahead,hasPredicates:l.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=HN(this.fullRuleNameToShort[t.name],_Y,l.idx);this.setLaFuncCache(f,h)})}),Dr(i,l=>{this.computeLookaheadFunc(t,l.idx,UL,"Repetition",l.maxLookahead,km(l))}),Dr(s,l=>{this.computeLookaheadFunc(t,l.idx,vY,"Option",l.maxLookahead,km(l))}),Dr(o,l=>{this.computeLookaheadFunc(t,l.idx,BL,"RepetitionMandatory",l.maxLookahead,km(l))}),Dr(a,l=>{this.computeLookaheadFunc(t,l.idx,Uk,"RepetitionMandatoryWithSeparator",l.maxLookahead,km(l))}),Dr(c,l=>{this.computeLookaheadFunc(t,l.idx,FL,"RepetitionWithSeparator",l.maxLookahead,km(l))})})})}computeLookaheadFunc(e,t,r,i,s,o){this.TRACE_INIT(`${o}${t===0?"":t}`,()=>{const a=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:t,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),c=HN(this.fullRuleNameToShort[e.name],r,t);this.setLaFuncCache(c,a)})}getKeyForAutomaticLookahead(e,t){const r=this.getLastExplicitRuleShortName();return HN(r,e,t)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,t){this.lookAheadFuncsCache.set(e,t)}}class tSe extends T1{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const MR=new tSe;function nSe(n){MR.reset(),n.accept(MR);const e=MR.dslMethods;return MR.reset(),e}function N9(n,e){isNaN(n.startOffset)===!0?(n.startOffset=e.startOffset,n.endOffset=e.endOffset):n.endOffset<e.endOffset&&(n.endOffset=e.endOffset)}function P9(n,e){isNaN(n.startOffset)===!0?(n.startOffset=e.startOffset,n.startColumn=e.startColumn,n.startLine=e.startLine,n.endOffset=e.endOffset,n.endColumn=e.endColumn,n.endLine=e.endLine):n.endOffset<e.endOffset&&(n.endOffset=e.endOffset,n.endColumn=e.endColumn,n.endLine=e.endLine)}function rSe(n,e,t){n.children[t]===void 0?n.children[t]=[e]:n.children[t].push(e)}function iSe(n,e,t){n.children[e]===void 0?n.children[e]=[t]:n.children[e].push(t)}const sSe="name";function yY(n,e){Object.defineProperty(n,sSe,{enumerable:!1,configurable:!0,writable:!1,value:e})}function oSe(n,e){const t=gd(n),r=t.length;for(let i=0;i<r;i++){const s=t[i],o=n[s],a=o.length;for(let c=0;c<a;c++){const l=o[c];l.tokenTypeIdx===void 0&&this[l.name](l.children,e)}}}function aSe(n,e){const t=function(){};yY(t,n+"BaseSemantics");const r={visit:function(i,s){if(qi(i)&&(i=i[0]),!Q0(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=lSe(this,e);if(!ao(i)){const s=ir(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return t.prototype=r,t.prototype.constructor=t,t._RULE_NAMES=e,t}function cSe(n,e,t){const r=function(){};yY(r,n+"BaseSemanticsWithDefaults");const i=Object.create(t.prototype);return Dr(e,s=>{i[s]=oSe}),r.prototype=i,r.prototype.constructor=r,r}var jL;(function(n){n[n.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",n[n.MISSING_METHOD=1]="MISSING_METHOD"})(jL||(jL={}));function lSe(n,e){return uSe(n,e)}function uSe(n,e){const t=Sd(e,i=>o_(n[i])===!1),r=ir(t,i=>({msg:`Missing visitor method: <${i}> on ${n.constructor.name} CST Visitor.`,type:jL.MISSING_METHOD,methodName:i}));return tC(r)}class hSe{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=Mr(e,"nodeLocationTracking")?e.nodeLocationTracking:e_.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=sc,this.cstFinallyStateUpdate=sc,this.cstPostTerminal=sc,this.cstPostNonTerminal=sc,this.cstPostRule=sc;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=P9,this.setNodeLocationFromNode=P9,this.cstPostRule=sc,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=sc,this.setNodeLocationFromNode=sc,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=N9,this.setNodeLocationFromNode=N9,this.cstPostRule=sc,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=sc,this.setNodeLocationFromNode=sc,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=sc,this.setNodeLocationFromNode=sc,this.cstPostRule=sc,this.setInitialNodeLocation=sc;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const t={name:e,children:Object.create(null)};this.setInitialNodeLocation(t),this.CST_STACK.push(t)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?(r.endOffset=t.endOffset,r.endLine=t.endLine,r.endColumn=t.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const t=this.LA(0),r=e.location;r.startOffset<=t.startOffset?r.endOffset=t.endOffset:r.startOffset=NaN}cstPostTerminal(e,t){const r=this.CST_STACK[this.CST_STACK.length-1];rSe(r,t,e),this.setNodeLocationFromToken(r.location,t)}cstPostNonTerminal(e,t){const r=this.CST_STACK[this.CST_STACK.length-1];iSe(r,t,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Q0(this.baseCstVisitorConstructor)){const e=aSe(this.className,gd(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Q0(this.baseCstVisitorWithDefaultsConstructor)){const e=cSe(this.className,gd(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class fSe{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):jM}LA(e){const t=this.currIdx+e;return t<0||this.tokVectorLength<=t?jM:this.tokVector[t]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class dSe{ACTION(e){return e.call(this)}consume(e,t,r){return this.consumeInternal(t,e,r)}subrule(e,t,r){return this.subruleInternal(t,e,r)}option(e,t){return this.optionInternal(t,e)}or(e,t){return this.orInternal(t,e)}many(e,t){return this.manyInternal(e,t)}atLeastOne(e,t){return this.atLeastOneInternal(e,t)}CONSUME(e,t){return this.consumeInternal(e,0,t)}CONSUME1(e,t){return this.consumeInternal(e,1,t)}CONSUME2(e,t){return this.consumeInternal(e,2,t)}CONSUME3(e,t){return this.consumeInternal(e,3,t)}CONSUME4(e,t){return this.consumeInternal(e,4,t)}CONSUME5(e,t){return this.consumeInternal(e,5,t)}CONSUME6(e,t){return this.consumeInternal(e,6,t)}CONSUME7(e,t){return this.consumeInternal(e,7,t)}CONSUME8(e,t){return this.consumeInternal(e,8,t)}CONSUME9(e,t){return this.consumeInternal(e,9,t)}SUBRULE(e,t){return this.subruleInternal(e,0,t)}SUBRULE1(e,t){return this.subruleInternal(e,1,t)}SUBRULE2(e,t){return this.subruleInternal(e,2,t)}SUBRULE3(e,t){return this.subruleInternal(e,3,t)}SUBRULE4(e,t){return this.subruleInternal(e,4,t)}SUBRULE5(e,t){return this.subruleInternal(e,5,t)}SUBRULE6(e,t){return this.subruleInternal(e,6,t)}SUBRULE7(e,t){return this.subruleInternal(e,7,t)}SUBRULE8(e,t){return this.subruleInternal(e,8,t)}SUBRULE9(e,t){return this.subruleInternal(e,9,t)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,t,r=zM){if(Au(this.definedRulesNames,e)){const o={message:Ab.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:Eu.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);const i=this.defineRule(e,t,r);return this[e]=i,i}OVERRIDE_RULE(e,t,r=zM){const i=D1e(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,t,r);return this[e]=s,s}BACKTRACK(e,t){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,t),!0}catch(i){if(BM(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return pbe(Ha(this.gastProductionsCache))}}class pSe{initRecognizerEngine(e,t){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=UM,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Mr(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(qi(e)){if(ao(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(qi(e))this.tokensMap=kh(e,(s,o)=>(s[o.name]=o,s),{});else if(Mr(e,"modes")&&pp(_f(Ha(e.modes)),l1e)){const s=_f(Ha(e.modes)),o=SO(s);this.tokensMap=kh(o,(a,c)=>(a[c.name]=c,a),{})}else if(md(e))this.tokensMap=fl(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=Zb;const r=Mr(e,"modes")?_f(Ha(e.modes)):Ha(e),i=pp(r,s=>ao(s.categoryMatches));this.tokenMatcher=i?UM:rC,iC(Ha(this.tokensMap))}defineRule(e,t,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=Mr(r,"resyncEnabled")?r.resyncEnabled:zM.resyncEnabled,s=Mr(r,"recoveryValueFunc")?r.recoveryValueFunc:zM.recoveryValueFunc,o=this.ruleShortNameIdx<<J1e+ey;this.ruleShortNameIdx++,this.shortRuleNameToFull[o]=e,this.fullRuleNameToShort[e]=o;let a;return this.outputCst===!0?a=function(...u){try{this.ruleInvocationStateUpdate(o,e,this.subruleIdx),t.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:a=function(...u){try{return this.ruleInvocationStateUpdate(o,e,this.subruleIdx),t.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(a,{ruleName:e,originalGrammarAction:t})}invokeRuleCatch(e,t,r){const i=this.RULE_STACK.length===1,s=t&&!this.isBackTracking()&&this.recoveryEnabled;if(BM(e)){const o=e;if(s){const a=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(a))if(o.resyncedTokens=this.reSyncTo(a),this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];return c.recoveredNode=!0,c}else return r(e);else{if(this.outputCst){const c=this.CST_STACK[this.CST_STACK.length-1];c.recoveredNode=!0,o.partialCstResult=c}throw o}}else{if(i)return this.moveToTerminatedState(),r(e);throw o}}else throw e}optionInternal(e,t){const r=this.getKeyForAutomaticLookahead(vY,t);return this.optionInternalLogic(e,t,r)}optionInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const o=e.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,t){const r=this.getKeyForAutomaticLookahead(BL,e);return this.atLeastOneInternalLogic(e,t,r)}atLeastOneInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else s=t;if(i.call(this)===!0){let o=this.doSingleRepetition(s);for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,fa.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,BL,e,b1e)}atLeastOneSepFirstInternal(e,t){const r=this.getKeyForAutomaticLookahead(Uk,e);this.atLeastOneSepFirstInternalLogic(e,t,r)}atLeastOneSepFirstInternalLogic(e,t,r){const i=t.DEF,s=t.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,I9],a,Uk,e,I9)}else throw this.raiseEarlyExitException(e,fa.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)}manyInternal(e,t){const r=this.getKeyForAutomaticLookahead(UL,e);return this.manyInternalLogic(e,t,r)}manyInternalLogic(e,t,r){let i=this.getLaFuncFromCache(r),s;if(typeof t!="function"){s=t.DEF;const a=t.GATE;if(a!==void 0){const c=i;i=()=>a.call(this)&&c.call(this)}}else s=t;let o=!0;for(;i.call(this)===!0&&o===!0;)o=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,UL,e,y1e,o)}manySepFirstInternal(e,t){const r=this.getKeyForAutomaticLookahead(FL,e);this.manySepFirstInternalLogic(e,t,r)}manySepFirstInternalLogic(e,t,r){const i=t.DEF,s=t.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const a=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,a,i,M9],a,FL,e,M9)}}repetitionSepSecondInternal(e,t,r,i,s){for(;r();)this.CONSUME(t),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,i,s],r,Uk,e,s)}doSingleRepetition(e){const t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t}orInternal(e,t){const r=this.getKeyForAutomaticLookahead(_Y,t),i=qi(e)?e:e.DEF,o=this.getLaFuncFromCache(r).call(this,i);if(o!==void 0)return i[o].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new q1e(t,e))}}subruleInternal(e,t,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=t,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,t,r){throw BM(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,t,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,t,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,t,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new mY(i,t,s))}consumeInternalRecovery(e,t,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===gY?r:s}}else throw r}saveRecogState(){const e=this.errors,t=fl(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,t,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),Zb)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class mSe{initErrorHandler(e){this._errors=[],this.errorMessageProvider=Mr(e,"errorMessageProvider")?e.errorMessageProvider:e_.errorMessageProvider}SAVE_ERROR(e){if(BM(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:fl(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return fl(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,t,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],a=r6(e,s,t,this.maxLookahead)[0],c=[];for(let u=1;u<=this.maxLookahead;u++)c.push(this.LA(u));const l=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:a,actual:c,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new Y1e(l,this.LA(1),this.LA(0)))}raiseNoAltException(e,t){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=n6(e,i,this.maxLookahead),o=[];for(let l=1;l<=this.maxLookahead;l++)o.push(this.LA(l));const a=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:o,previous:a,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new W1e(c,this.LA(1),a))}}class gSe{initContentAssist(){}computeContentAssist(e,t){const r=this.gastProductionsCache[e];if(Q0(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return rY([r],t,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const t=bp(e.ruleStack),i=this.getGAstProductions()[t];return new v1e(i,e).startWalking()}}const AO={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(AO);const D9=!0,L9=Math.pow(2,ey)-1,bY=Cu({name:"RECORDING_PHASE_TOKEN",pattern:zc.NA});iC([bY]);const SY=sC(bY,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(SY);const _Se={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class vSe{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const t=e>0?e:"";this[`CONSUME${t}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${t}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${t}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${t}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${t}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${t}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${t}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${t}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,t,r){return this.consumeInternalRecord(t,e,r)},this.subrule=function(e,t,r){return this.subruleInternalRecord(t,e,r)},this.option=function(e,t){return this.optionInternalRecord(t,e)},this.or=function(e,t){return this.orInternalRecord(t,e)},this.many=function(e,t){this.manyInternalRecord(e,t)},this.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let t=0;t<10;t++){const r=t>0?t:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,t){return()=>!0}LA_RECORD(e){return jM}topLevelRuleRecord(e,t){try{const r=new Vx({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,t){return GT.call(this,xh,e,t)}atLeastOneInternalRecord(e,t){GT.call(this,dg,t,e)}atLeastOneSepFirstInternalRecord(e,t){GT.call(this,pg,t,e,D9)}manyInternalRecord(e,t){GT.call(this,uc,t,e)}manySepFirstInternalRecord(e,t){GT.call(this,Rp,t,e,D9)}orInternalRecord(e,t){return ySe.call(this,e,t)}subruleInternalRecord(e,t,r){if(FM(t),!e||Mr(e,"ruleName")===!1){const a=new Error(`<SUBRULE${U9(t)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Kb(this.recordingProdStack),s=e.ruleName,o=new Mh({idx:t,nonTerminalName:s,label:r?.LABEL,referencedRule:void 0});return i.definition.push(o),this.outputCst?_Se:AO}consumeInternalRecord(e,t,r){if(FM(t),!eY(e)){const o=new Error(`<CONSUME${U9(t)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Kb(this.recordingProdStack),s=new Jo({idx:t,terminalType:e,label:r?.LABEL});return i.definition.push(s),SY}}function GT(n,e,t,r=!1){FM(t);const i=Kb(this.recordingProdStack),s=o_(e)?e:e.DEF,o=new n({definition:[],idx:t});return r&&(o.separator=e.SEP),Mr(e,"MAX_LOOKAHEAD")&&(o.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),AO}function ySe(n,e){FM(e);const t=Kb(this.recordingProdStack),r=qi(n)===!1,i=r===!1?n:n.DEF,s=new kp({definition:[],idx:e,ignoreAmbiguities:r&&n.IGNORE_AMBIGUITIES===!0});Mr(n,"MAX_LOOKAHEAD")&&(s.maxLookahead=n.MAX_LOOKAHEAD);const o=Q5(i,a=>o_(a.GATE));return s.hasPredicates=o,t.definition.push(s),Dr(i,a=>{const c=new Ih({definition:[]});s.definition.push(c),Mr(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:Mr(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),AO}function U9(n){return n===0?"":`${n}`}function FM(n){if(n<0||n>L9){const e=new Error(`Invalid DSL Method idx value: <${n}>
	Idx value must be a none negative value smaller than ${L9+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class bSe{initPerformanceTracer(e){if(Mr(e,"traceInitPerf")){const t=e.traceInitPerf,r=typeof t=="number";this.traceInitMaxIdent=r?t:1/0,this.traceInitPerf=r?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=e_.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=Hq(t),o=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&o(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return t()}}function SSe(n,e){e.forEach(t=>{const r=t.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(n.prototype,i,s):n.prototype[i]=t.prototype[i]})})}const jM=sC(Zb,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(jM);const e_=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:nY,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),zM=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var Eu;(function(n){n[n.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",n[n.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",n[n.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",n[n.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",n[n.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",n[n.LEFT_RECURSION=5]="LEFT_RECURSION",n[n.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",n[n.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",n[n.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",n[n.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",n[n.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",n[n.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",n[n.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",n[n.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(Eu||(Eu={}));let s6=class EY{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const t=this.className;this.TRACE_INIT("toFastProps",()=>{Gq(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),Dr(this.definedRulesNames,i=>{const o=this[i].originalGrammarAction;let a;this.TRACE_INIT(`${i} Rule`,()=>{a=this.topLevelRuleRecord(i,o)}),this.gastProductionsCache[i]=a})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=H1e({rules:Ha(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(ao(r)&&this.skipValidations===!1){const i=G1e({rules:Ha(this.gastProductionsCache),tokenTypes:Ha(this.tokensMap),errMsgProvider:Ab,grammarName:t}),s=k1e({lookaheadStrategy:this.lookaheadStrategy,rules:Ha(this.gastProductionsCache),tokenTypes:Ha(this.tokensMap),grammarName:t});this.definitionErrors=this.definitionErrors.concat(i,s)}}),ao(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=Sbe(Ha(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ha(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ha(this.gastProductionsCache))})),!EY.DEFER_DEFINITION_ERRORS_HANDLING&&!ao(this.definitionErrors))throw e=ir(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,t){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(t),r.initLexerAdapter(),r.initLooksAhead(t),r.initRecognizerEngine(e,t),r.initRecoverable(t),r.initTreeBuilder(t),r.initContentAssist(),r.initGastRecorder(t),r.initPerformanceTracer(t),Mr(t,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=Mr(t,"skipValidations")?t.skipValidations:e_.skipValidations}};s6.DEFER_DEFINITION_ERRORS_HANDLING=!1;SSe(s6,[X1e,eSe,hSe,fSe,pSe,dSe,mSe,gSe,vSe,bSe]);class ESe extends s6{constructor(e,t=e_){const r=fl(t);r.outputCst=!0,super(e,r)}}function xSe(n){const e=new TSe,t=Ha(n);return ir(t,r=>e.visitRule(r))}class TSe extends T1{visitRule(e){const t=this.visitEach(e.definition),r=$q(t,s=>s.propertyName),i=ir(r,(s,o)=>{const a=!Q5(s,l=>!l.canBeNull);let c=s[0].type;return s.length>1&&(c=ir(s,l=>l.type)),{name:o,type:c,optional:a}});return{name:e.name,properties:i}}visitAlternative(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitOption(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetition(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitRepetitionMandatory(e){return this.visitEach(e.definition)}visitRepetitionMandatoryWithSeparator(e){return this.visitEach(e.definition).concat({propertyName:e.separator.name,canBeNull:!0,type:IR(e.separator)})}visitRepetitionWithSeparator(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0}).concat({propertyName:e.separator.name,canBeNull:!0,type:IR(e.separator)})}visitAlternation(e){return this.visitEachAndOverrideWith(e.definition,{canBeNull:!0})}visitTerminal(e){return[{propertyName:e.label||e.terminalType.name,canBeNull:!1,type:IR(e)}]}visitNonTerminal(e){return[{propertyName:e.label||e.nonTerminalName,canBeNull:!1,type:IR(e)}]}visitEachAndOverrideWith(e,t){return ir(this.visitEach(e),r=>Ch({},r,t))}visitEach(e){return _f(ir(e,t=>this.visit(t)))}}function IR(n){return n instanceof Mh?{kind:"rule",name:n.referencedRule.name}:{kind:"token"}}function wSe(n,e){let t=[];return t=t.concat('import type { CstNode, ICstVisitor, IToken } from "chevrotain";'),t=t.concat(_f(ir(n,r=>ASe(r)))),e.includeVisitorInterface&&(t=t.concat(MSe(e.visitorInterfaceName,n))),t.join(`

`)+`
`}function ASe(n){const e=CSe(n),t=RSe(n);return[e,t]}function CSe(n){const e=xY(n.name),t=o6(n.name);return`export interface ${e} extends CstNode {
  name: "${n.name}";
  children: ${t};
}`}function RSe(n){return`export type ${o6(n.name)} = {
  ${ir(n.properties,t=>kSe(t)).join(`
  `)}
};`}function kSe(n){const e=OSe(n.type);return`${n.name}${n.optional?"?":""}: ${e}[];`}function MSe(n,e){return`export interface ${n}<IN, OUT> extends ICstVisitor<IN, OUT> {
  ${ir(e,t=>ISe(t)).join(`
  `)}
}`}function ISe(n){const e=o6(n.name);return`${n.name}(children: ${e}, param?: IN): OUT;`}function OSe(n){if(qi(n)){const e=SO(ir(n,r=>B9(r)));return"("+kh(e,(r,i)=>r+" | "+i)+")"}else return B9(n)}function B9(n){return n.kind==="token"?"IToken":xY(n.name)}function xY(n){return Rq(n)+"CstNode"}function o6(n){return Rq(n)+"CstChildren"}const NSe={includeVisitorInterface:!0,visitorInterfaceName:"ICstNodeVisitor"};function PSe(n,e){const t=Object.assign(Object.assign({},NSe),e),r=xSe(n);return wSe(r,t)}var Bk={exports:{}},DSe=Bk.exports,F9;function LSe(){return F9||(F9=1,(function(n,e){(function(t,r){n.exports=r()})(DSe,function(){return t.importState=function(i){var s=new t;return s.importState(i),s},t;function t(){return(function(i){var s=0,o=0,a=0,c=1;i.length==0&&(i=[+new Date]);var l=r();s=l(" "),o=l(" "),a=l(" ");for(var u=0;u<i.length;u++)s-=l(i[u]),s<0&&(s+=1),o-=l(i[u]),o<0&&(o+=1),a-=l(i[u]),a<0&&(a+=1);l=null;var h=function(){var f=2091639*s+c*23283064365386963e-26;return s=o,o=a,a=f-(c=f|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=i,h.exportState=function(){return[s,o,a,c]},h.importState=function(f){s=+f[0]||0,o=+f[1]||0,a=+f[2]||0,c=+f[3]||0},h})(Array.prototype.slice.call(arguments))}function r(){var i=4022871197,s=function(o){o=o.toString();for(var a=0;a<o.length;a++){i+=o.charCodeAt(a);var c=.02519603282416938*i;i=c>>>0,c-=i,c*=i,i=c>>>0,c-=i,i+=c*4294967296}return(i>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})})(Bk)),Bk.exports}var USe=LSe();const a6=wu(USe);new zn;new zn;function Ri(n,e,t){return Math.max(e,Math.min(t,n))}function BSe(n,e){return Ri(n-Math.floor(n/e)*e,0,e)}function FSe(n,e){var t=BSe(e-n,Math.PI*2);return t>Math.PI&&(t-=Math.PI*2),t}function TY(n){return n/180*Math.PI}function wY(n){return n*180/Math.PI}const jSe=a6("089fad0j9awfem09wavefc09uwaef");function j9(n){return 2*Math.floor(n/2)}function c6(n,e){return Math.round(n/e)*e}function zSe(){return jSe()}function $Se(n){return a6(n)()}function mu(n,e){const t=Math.min(n,e),i=Math.max(n,e)-t+1;return t+Math.floor(zSe()*i)}function AY(n,e,t){const r=Math.min(e,t),s=Math.max(e,t)-r+1;return r+Math.floor($Se(n)*s)}function ax(n,e,t){typeof n!="number"&&(n=0,e=0,t=1),typeof e!="number"&&(e=n,n=0,t=1),typeof t!="number"&&(t=1);const r=[],i=Math.min(n,e),s=Math.max(n,e);for(let o=i;o<=s;o+=t)r.push(o);return r}function VSe(n){return n[mu(0,n.length-1)]}function HSe(n,e){return e[AY(n,0,e.length-1)]}function td(...n){return VSe(n.flat())}function GSe(n,...e){return HSe(n,e.flat())}function WSe(n){return[...new Set(n)].filter(he)}var CY={},CO={};CO.byteLength=KSe;CO.toByteArray=ZSe;CO.fromByteArray=eEe;var Dm=[],Zf=[],qSe=typeof Uint8Array<"u"?Uint8Array:Array,GN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var YS=0,YSe=GN.length;YS<YSe;++YS)Dm[YS]=GN[YS],Zf[GN.charCodeAt(YS)]=YS;Zf[45]=62;Zf[95]=63;function RY(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function KSe(n){var e=RY(n),t=e[0],r=e[1];return(t+r)*3/4-r}function XSe(n,e,t){return(e+t)*3/4-t}function ZSe(n){var e,t=RY(n),r=t[0],i=t[1],s=new qSe(XSe(n,r,i)),o=0,a=i>0?r-4:r,c;for(c=0;c<a;c+=4)e=Zf[n.charCodeAt(c)]<<18|Zf[n.charCodeAt(c+1)]<<12|Zf[n.charCodeAt(c+2)]<<6|Zf[n.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Zf[n.charCodeAt(c)]<<2|Zf[n.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=Zf[n.charCodeAt(c)]<<10|Zf[n.charCodeAt(c+1)]<<4|Zf[n.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function JSe(n){return Dm[n>>18&63]+Dm[n>>12&63]+Dm[n>>6&63]+Dm[n&63]}function QSe(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(JSe(r));return i.join("")}function eEe(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,a=t-r;o<a;o+=s)i.push(QSe(n,o,o+s>a?a:o+s));return r===1?(e=n[t-1],i.push(Dm[e>>2]+Dm[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Dm[e>>10]+Dm[e>>4&63]+Dm[e<<2&63]+"=")),i.join("")}var l6={};l6.read=function(n,e,t,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=t?i-1:0,f=t?-1:1,d=n[e+h];for(h+=f,s=d&(1<<-u)-1,d>>=-u,u+=a;u>0;s=s*256+n[e+h],h+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=o*256+n[e+h],h+=f,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(d?-1:1)*o*Math.pow(2,s-r)};l6.write=function(n,e,t,r,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,h=u>>1,f=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=f/c:e+=f*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;n[t+d]=a&255,d+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;n[t+d]=o&255,d+=p,o/=256,l-=8);n[t+d-p]|=m*128};(function(n){const e=CO,t=l6,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=u,n.SlowBuffer=w,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:o,SharedArrayBuffer:a}=globalThis;u.TYPED_ARRAY_SUPPORT=c(),!u.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function c(){try{const Ce=new s(1),se={foo:function(){return 42}};return Object.setPrototypeOf(se,s.prototype),Object.setPrototypeOf(Ce,se),Ce.foo()===42}catch{return!1}}Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}});function l(Ce){if(Ce>i)throw new RangeError('The value "'+Ce+'" is invalid for option "size"');const se=new s(Ce);return Object.setPrototypeOf(se,u.prototype),se}function u(Ce,se,W){if(typeof Ce=="number"){if(typeof se=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return p(Ce)}return h(Ce,se,W)}u.poolSize=8192;function h(Ce,se,W){if(typeof Ce=="string")return m(Ce,se);if(o.isView(Ce))return v(Ce);if(Ce==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ce);if(Xe(Ce,o)||Ce&&Xe(Ce.buffer,o)||typeof a<"u"&&(Xe(Ce,a)||Ce&&Xe(Ce.buffer,a)))return S(Ce,se,W);if(typeof Ce=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const oe=Ce.valueOf&&Ce.valueOf();if(oe!=null&&oe!==Ce)return u.from(oe,se,W);const Se=b(Ce);if(Se)return Se;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Ce[Symbol.toPrimitive]=="function")return u.from(Ce[Symbol.toPrimitive]("string"),se,W);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ce)}u.from=function(Ce,se,W){return h(Ce,se,W)},Object.setPrototypeOf(u.prototype,s.prototype),Object.setPrototypeOf(u,s);function f(Ce){if(typeof Ce!="number")throw new TypeError('"size" argument must be of type number');if(Ce<0)throw new RangeError('The value "'+Ce+'" is invalid for option "size"')}function d(Ce,se,W){return f(Ce),Ce<=0?l(Ce):se!==void 0?typeof W=="string"?l(Ce).fill(se,W):l(Ce).fill(se):l(Ce)}u.alloc=function(Ce,se,W){return d(Ce,se,W)};function p(Ce){return f(Ce),l(Ce<0?0:T(Ce)|0)}u.allocUnsafe=function(Ce){return p(Ce)},u.allocUnsafeSlow=function(Ce){return p(Ce)};function m(Ce,se){if((typeof se!="string"||se==="")&&(se="utf8"),!u.isEncoding(se))throw new TypeError("Unknown encoding: "+se);const W=R(Ce,se)|0;let oe=l(W);const Se=oe.write(Ce,se);return Se!==W&&(oe=oe.slice(0,Se)),oe}function _(Ce){const se=Ce.length<0?0:T(Ce.length)|0,W=l(se);for(let oe=0;oe<se;oe+=1)W[oe]=Ce[oe]&255;return W}function v(Ce){if(Xe(Ce,s)){const se=new s(Ce);return S(se.buffer,se.byteOffset,se.byteLength)}return _(Ce)}function S(Ce,se,W){if(se<0||Ce.byteLength<se)throw new RangeError('"offset" is outside of buffer bounds');if(Ce.byteLength<se+(W||0))throw new RangeError('"length" is outside of buffer bounds');let oe;return se===void 0&&W===void 0?oe=new s(Ce):W===void 0?oe=new s(Ce,se):oe=new s(Ce,se,W),Object.setPrototypeOf(oe,u.prototype),oe}function b(Ce){if(u.isBuffer(Ce)){const se=T(Ce.length)|0,W=l(se);return W.length===0||Ce.copy(W,0,0,se),W}if(Ce.length!==void 0)return typeof Ce.length!="number"||et(Ce.length)?l(0):_(Ce);if(Ce.type==="Buffer"&&Array.isArray(Ce.data))return _(Ce.data)}function T(Ce){if(Ce>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return Ce|0}function w(Ce){return+Ce!=Ce&&(Ce=0),u.alloc(+Ce)}u.isBuffer=function(se){return se!=null&&se._isBuffer===!0&&se!==u.prototype},u.compare=function(se,W){if(Xe(se,s)&&(se=u.from(se,se.offset,se.byteLength)),Xe(W,s)&&(W=u.from(W,W.offset,W.byteLength)),!u.isBuffer(se)||!u.isBuffer(W))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(se===W)return 0;let oe=se.length,Se=W.length;for(let Ae=0,ye=Math.min(oe,Se);Ae<ye;++Ae)if(se[Ae]!==W[Ae]){oe=se[Ae],Se=W[Ae];break}return oe<Se?-1:Se<oe?1:0},u.isEncoding=function(se){switch(String(se).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(se,W){if(!Array.isArray(se))throw new TypeError('"list" argument must be an Array of Buffers');if(se.length===0)return u.alloc(0);let oe;if(W===void 0)for(W=0,oe=0;oe<se.length;++oe)W+=se[oe].length;const Se=u.allocUnsafe(W);let Ae=0;for(oe=0;oe<se.length;++oe){let ye=se[oe];if(Xe(ye,s))Ae+ye.length>Se.length?(u.isBuffer(ye)||(ye=u.from(ye)),ye.copy(Se,Ae)):s.prototype.set.call(Se,ye,Ae);else if(u.isBuffer(ye))ye.copy(Se,Ae);else throw new TypeError('"list" argument must be an Array of Buffers');Ae+=ye.length}return Se};function R(Ce,se){if(u.isBuffer(Ce))return Ce.length;if(o.isView(Ce)||Xe(Ce,o))return Ce.byteLength;if(typeof Ce!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Ce);const W=Ce.length,oe=arguments.length>2&&arguments[2]===!0;if(!oe&&W===0)return 0;let Se=!1;for(;;)switch(se){case"ascii":case"latin1":case"binary":return W;case"utf8":case"utf-8":return ve(Ce).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W*2;case"hex":return W>>>1;case"base64":return ze(Ce).length;default:if(Se)return oe?-1:ve(Ce).length;se=(""+se).toLowerCase(),Se=!0}}u.byteLength=R;function C(Ce,se,W){let oe=!1;if((se===void 0||se<0)&&(se=0),se>this.length||((W===void 0||W>this.length)&&(W=this.length),W<=0)||(W>>>=0,se>>>=0,W<=se))return"";for(Ce||(Ce="utf8");;)switch(Ce){case"hex":return q(this,se,W);case"utf8":case"utf-8":return G(this,se,W);case"ascii":return Q(this,se,W);case"latin1":case"binary":return z(this,se,W);case"base64":return X(this,se,W);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ee(this,se,W);default:if(oe)throw new TypeError("Unknown encoding: "+Ce);Ce=(Ce+"").toLowerCase(),oe=!0}}u.prototype._isBuffer=!0;function N(Ce,se,W){const oe=Ce[se];Ce[se]=Ce[W],Ce[W]=oe}u.prototype.swap16=function(){const se=this.length;if(se%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let W=0;W<se;W+=2)N(this,W,W+1);return this},u.prototype.swap32=function(){const se=this.length;if(se%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let W=0;W<se;W+=4)N(this,W,W+3),N(this,W+1,W+2);return this},u.prototype.swap64=function(){const se=this.length;if(se%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let W=0;W<se;W+=8)N(this,W,W+7),N(this,W+1,W+6),N(this,W+2,W+5),N(this,W+3,W+4);return this},u.prototype.toString=function(){const se=this.length;return se===0?"":arguments.length===0?G(this,0,se):C.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(se){if(!u.isBuffer(se))throw new TypeError("Argument must be a Buffer");return this===se?!0:u.compare(this,se)===0},u.prototype.inspect=function(){let se="";const W=n.INSPECT_MAX_BYTES;return se=this.toString("hex",0,W).replace(/(.{2})/g,"$1 ").trim(),this.length>W&&(se+=" ... "),"<Buffer "+se+">"},r&&(u.prototype[r]=u.prototype.inspect),u.prototype.compare=function(se,W,oe,Se,Ae){if(Xe(se,s)&&(se=u.from(se,se.offset,se.byteLength)),!u.isBuffer(se))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof se);if(W===void 0&&(W=0),oe===void 0&&(oe=se?se.length:0),Se===void 0&&(Se=0),Ae===void 0&&(Ae=this.length),W<0||oe>se.length||Se<0||Ae>this.length)throw new RangeError("out of range index");if(Se>=Ae&&W>=oe)return 0;if(Se>=Ae)return-1;if(W>=oe)return 1;if(W>>>=0,oe>>>=0,Se>>>=0,Ae>>>=0,this===se)return 0;let ye=Ae-Se,_e=oe-W;const Ye=Math.min(ye,_e),ke=this.slice(Se,Ae),Ve=se.slice(W,oe);for(let Fe=0;Fe<Ye;++Fe)if(ke[Fe]!==Ve[Fe]){ye=ke[Fe],_e=Ve[Fe];break}return ye<_e?-1:_e<ye?1:0};function U(Ce,se,W,oe,Se){if(Ce.length===0)return-1;if(typeof W=="string"?(oe=W,W=0):W>2147483647?W=2147483647:W<-2147483648&&(W=-2147483648),W=+W,et(W)&&(W=Se?0:Ce.length-1),W<0&&(W=Ce.length+W),W>=Ce.length){if(Se)return-1;W=Ce.length-1}else if(W<0)if(Se)W=0;else return-1;if(typeof se=="string"&&(se=u.from(se,oe)),u.isBuffer(se))return se.length===0?-1:B(Ce,se,W,oe,Se);if(typeof se=="number")return se=se&255,typeof s.prototype.indexOf=="function"?Se?s.prototype.indexOf.call(Ce,se,W):s.prototype.lastIndexOf.call(Ce,se,W):B(Ce,[se],W,oe,Se);throw new TypeError("val must be string, number or Buffer")}function B(Ce,se,W,oe,Se){let Ae=1,ye=Ce.length,_e=se.length;if(oe!==void 0&&(oe=String(oe).toLowerCase(),oe==="ucs2"||oe==="ucs-2"||oe==="utf16le"||oe==="utf-16le")){if(Ce.length<2||se.length<2)return-1;Ae=2,ye/=2,_e/=2,W/=2}function Ye(Ve,Fe){return Ae===1?Ve[Fe]:Ve.readUInt16BE(Fe*Ae)}let ke;if(Se){let Ve=-1;for(ke=W;ke<ye;ke++)if(Ye(Ce,ke)===Ye(se,Ve===-1?0:ke-Ve)){if(Ve===-1&&(Ve=ke),ke-Ve+1===_e)return Ve*Ae}else Ve!==-1&&(ke-=ke-Ve),Ve=-1}else for(W+_e>ye&&(W=ye-_e),ke=W;ke>=0;ke--){let Ve=!0;for(let Fe=0;Fe<_e;Fe++)if(Ye(Ce,ke+Fe)!==Ye(se,Fe)){Ve=!1;break}if(Ve)return ke}return-1}u.prototype.includes=function(se,W,oe){return this.indexOf(se,W,oe)!==-1},u.prototype.indexOf=function(se,W,oe){return U(this,se,W,oe,!0)},u.prototype.lastIndexOf=function(se,W,oe){return U(this,se,W,oe,!1)};function $(Ce,se,W,oe){W=Number(W)||0;const Se=Ce.length-W;oe?(oe=Number(oe),oe>Se&&(oe=Se)):oe=Se;const Ae=se.length;oe>Ae/2&&(oe=Ae/2);let ye;for(ye=0;ye<oe;++ye){const _e=parseInt(se.substr(ye*2,2),16);if(et(_e))return ye;Ce[W+ye]=_e}return ye}function I(Ce,se,W,oe){return Je(ve(se,Ce.length-W),Ce,W,oe)}function L(Ce,se,W,oe){return Je(xe(se),Ce,W,oe)}function P(Ce,se,W,oe){return Je(ze(se),Ce,W,oe)}function H(Ce,se,W,oe){return Je(pe(se,Ce.length-W),Ce,W,oe)}u.prototype.write=function(se,W,oe,Se){if(W===void 0)Se="utf8",oe=this.length,W=0;else if(oe===void 0&&typeof W=="string")Se=W,oe=this.length,W=0;else if(isFinite(W))W=W>>>0,isFinite(oe)?(oe=oe>>>0,Se===void 0&&(Se="utf8")):(Se=oe,oe=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Ae=this.length-W;if((oe===void 0||oe>Ae)&&(oe=Ae),se.length>0&&(oe<0||W<0)||W>this.length)throw new RangeError("Attempt to write outside buffer bounds");Se||(Se="utf8");let ye=!1;for(;;)switch(Se){case"hex":return $(this,se,W,oe);case"utf8":case"utf-8":return I(this,se,W,oe);case"ascii":case"latin1":case"binary":return L(this,se,W,oe);case"base64":return P(this,se,W,oe);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,se,W,oe);default:if(ye)throw new TypeError("Unknown encoding: "+Se);Se=(""+Se).toLowerCase(),ye=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function X(Ce,se,W){return se===0&&W===Ce.length?e.fromByteArray(Ce):e.fromByteArray(Ce.slice(se,W))}function G(Ce,se,W){W=Math.min(Ce.length,W);const oe=[];let Se=se;for(;Se<W;){const Ae=Ce[Se];let ye=null,_e=Ae>239?4:Ae>223?3:Ae>191?2:1;if(Se+_e<=W){let Ye,ke,Ve,Fe;switch(_e){case 1:Ae<128&&(ye=Ae);break;case 2:Ye=Ce[Se+1],(Ye&192)===128&&(Fe=(Ae&31)<<6|Ye&63,Fe>127&&(ye=Fe));break;case 3:Ye=Ce[Se+1],ke=Ce[Se+2],(Ye&192)===128&&(ke&192)===128&&(Fe=(Ae&15)<<12|(Ye&63)<<6|ke&63,Fe>2047&&(Fe<55296||Fe>57343)&&(ye=Fe));break;case 4:Ye=Ce[Se+1],ke=Ce[Se+2],Ve=Ce[Se+3],(Ye&192)===128&&(ke&192)===128&&(Ve&192)===128&&(Fe=(Ae&15)<<18|(Ye&63)<<12|(ke&63)<<6|Ve&63,Fe>65535&&Fe<1114112&&(ye=Fe))}}ye===null?(ye=65533,_e=1):ye>65535&&(ye-=65536,oe.push(ye>>>10&1023|55296),ye=56320|ye&1023),oe.push(ye),Se+=_e}return J(oe)}const Y=4096;function J(Ce){const se=Ce.length;if(se<=Y)return String.fromCharCode.apply(String,Ce);let W="",oe=0;for(;oe<se;)W+=String.fromCharCode.apply(String,Ce.slice(oe,oe+=Y));return W}function Q(Ce,se,W){let oe="";W=Math.min(Ce.length,W);for(let Se=se;Se<W;++Se)oe+=String.fromCharCode(Ce[Se]&127);return oe}function z(Ce,se,W){let oe="";W=Math.min(Ce.length,W);for(let Se=se;Se<W;++Se)oe+=String.fromCharCode(Ce[Se]);return oe}function q(Ce,se,W){const oe=Ce.length;(!se||se<0)&&(se=0),(!W||W<0||W>oe)&&(W=oe);let Se="";for(let Ae=se;Ae<W;++Ae)Se+=Ut[Ce[Ae]];return Se}function ee(Ce,se,W){const oe=Ce.slice(se,W);let Se="";for(let Ae=0;Ae<oe.length-1;Ae+=2)Se+=String.fromCharCode(oe[Ae]+oe[Ae+1]*256);return Se}u.prototype.slice=function(se,W){const oe=this.length;se=~~se,W=W===void 0?oe:~~W,se<0?(se+=oe,se<0&&(se=0)):se>oe&&(se=oe),W<0?(W+=oe,W<0&&(W=0)):W>oe&&(W=oe),W<se&&(W=se);const Se=this.subarray(se,W);return Object.setPrototypeOf(Se,u.prototype),Se};function te(Ce,se,W){if(Ce%1!==0||Ce<0)throw new RangeError("offset is not uint");if(Ce+se>W)throw new RangeError("Trying to access beyond buffer length")}u.prototype.readUintLE=u.prototype.readUIntLE=function(se,W,oe){se=se>>>0,W=W>>>0,oe||te(se,W,this.length);let Se=this[se],Ae=1,ye=0;for(;++ye<W&&(Ae*=256);)Se+=this[se+ye]*Ae;return Se},u.prototype.readUintBE=u.prototype.readUIntBE=function(se,W,oe){se=se>>>0,W=W>>>0,oe||te(se,W,this.length);let Se=this[se+--W],Ae=1;for(;W>0&&(Ae*=256);)Se+=this[se+--W]*Ae;return Se},u.prototype.readUint8=u.prototype.readUInt8=function(se,W){return se=se>>>0,W||te(se,1,this.length),this[se]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(se,W){return se=se>>>0,W||te(se,2,this.length),this[se]|this[se+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(se,W){return se=se>>>0,W||te(se,2,this.length),this[se]<<8|this[se+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(se,W){return se=se>>>0,W||te(se,4,this.length),(this[se]|this[se+1]<<8|this[se+2]<<16)+this[se+3]*16777216},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(se,W){return se=se>>>0,W||te(se,4,this.length),this[se]*16777216+(this[se+1]<<16|this[se+2]<<8|this[se+3])},u.prototype.readBigUInt64LE=gt(function(se){se=se>>>0,$e(se,"offset");const W=this[se],oe=this[se+7];(W===void 0||oe===void 0)&&De(se,this.length-8);const Se=W+this[++se]*2**8+this[++se]*2**16+this[++se]*2**24,Ae=this[++se]+this[++se]*2**8+this[++se]*2**16+oe*2**24;return BigInt(Se)+(BigInt(Ae)<<BigInt(32))}),u.prototype.readBigUInt64BE=gt(function(se){se=se>>>0,$e(se,"offset");const W=this[se],oe=this[se+7];(W===void 0||oe===void 0)&&De(se,this.length-8);const Se=W*2**24+this[++se]*2**16+this[++se]*2**8+this[++se],Ae=this[++se]*2**24+this[++se]*2**16+this[++se]*2**8+oe;return(BigInt(Se)<<BigInt(32))+BigInt(Ae)}),u.prototype.readIntLE=function(se,W,oe){se=se>>>0,W=W>>>0,oe||te(se,W,this.length);let Se=this[se],Ae=1,ye=0;for(;++ye<W&&(Ae*=256);)Se+=this[se+ye]*Ae;return Ae*=128,Se>=Ae&&(Se-=Math.pow(2,8*W)),Se},u.prototype.readIntBE=function(se,W,oe){se=se>>>0,W=W>>>0,oe||te(se,W,this.length);let Se=W,Ae=1,ye=this[se+--Se];for(;Se>0&&(Ae*=256);)ye+=this[se+--Se]*Ae;return Ae*=128,ye>=Ae&&(ye-=Math.pow(2,8*W)),ye},u.prototype.readInt8=function(se,W){return se=se>>>0,W||te(se,1,this.length),this[se]&128?(255-this[se]+1)*-1:this[se]},u.prototype.readInt16LE=function(se,W){se=se>>>0,W||te(se,2,this.length);const oe=this[se]|this[se+1]<<8;return oe&32768?oe|4294901760:oe},u.prototype.readInt16BE=function(se,W){se=se>>>0,W||te(se,2,this.length);const oe=this[se+1]|this[se]<<8;return oe&32768?oe|4294901760:oe},u.prototype.readInt32LE=function(se,W){return se=se>>>0,W||te(se,4,this.length),this[se]|this[se+1]<<8|this[se+2]<<16|this[se+3]<<24},u.prototype.readInt32BE=function(se,W){return se=se>>>0,W||te(se,4,this.length),this[se]<<24|this[se+1]<<16|this[se+2]<<8|this[se+3]},u.prototype.readBigInt64LE=gt(function(se){se=se>>>0,$e(se,"offset");const W=this[se],oe=this[se+7];(W===void 0||oe===void 0)&&De(se,this.length-8);const Se=this[se+4]+this[se+5]*2**8+this[se+6]*2**16+(oe<<24);return(BigInt(Se)<<BigInt(32))+BigInt(W+this[++se]*2**8+this[++se]*2**16+this[++se]*2**24)}),u.prototype.readBigInt64BE=gt(function(se){se=se>>>0,$e(se,"offset");const W=this[se],oe=this[se+7];(W===void 0||oe===void 0)&&De(se,this.length-8);const Se=(W<<24)+this[++se]*2**16+this[++se]*2**8+this[++se];return(BigInt(Se)<<BigInt(32))+BigInt(this[++se]*2**24+this[++se]*2**16+this[++se]*2**8+oe)}),u.prototype.readFloatLE=function(se,W){return se=se>>>0,W||te(se,4,this.length),t.read(this,se,!0,23,4)},u.prototype.readFloatBE=function(se,W){return se=se>>>0,W||te(se,4,this.length),t.read(this,se,!1,23,4)},u.prototype.readDoubleLE=function(se,W){return se=se>>>0,W||te(se,8,this.length),t.read(this,se,!0,52,8)},u.prototype.readDoubleBE=function(se,W){return se=se>>>0,W||te(se,8,this.length),t.read(this,se,!1,52,8)};function ie(Ce,se,W,oe,Se,Ae){if(!u.isBuffer(Ce))throw new TypeError('"buffer" argument must be a Buffer instance');if(se>Se||se<Ae)throw new RangeError('"value" argument is out of bounds');if(W+oe>Ce.length)throw new RangeError("Index out of range")}u.prototype.writeUintLE=u.prototype.writeUIntLE=function(se,W,oe,Se){if(se=+se,W=W>>>0,oe=oe>>>0,!Se){const _e=Math.pow(2,8*oe)-1;ie(this,se,W,oe,_e,0)}let Ae=1,ye=0;for(this[W]=se&255;++ye<oe&&(Ae*=256);)this[W+ye]=se/Ae&255;return W+oe},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(se,W,oe,Se){if(se=+se,W=W>>>0,oe=oe>>>0,!Se){const _e=Math.pow(2,8*oe)-1;ie(this,se,W,oe,_e,0)}let Ae=oe-1,ye=1;for(this[W+Ae]=se&255;--Ae>=0&&(ye*=256);)this[W+Ae]=se/ye&255;return W+oe},u.prototype.writeUint8=u.prototype.writeUInt8=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,1,255,0),this[W]=se&255,W+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,2,65535,0),this[W]=se&255,this[W+1]=se>>>8,W+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,2,65535,0),this[W]=se>>>8,this[W+1]=se&255,W+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,4,4294967295,0),this[W+3]=se>>>24,this[W+2]=se>>>16,this[W+1]=se>>>8,this[W]=se&255,W+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,4,4294967295,0),this[W]=se>>>24,this[W+1]=se>>>16,this[W+2]=se>>>8,this[W+3]=se&255,W+4};function Ee(Ce,se,W,oe,Se){Le(se,oe,Se,Ce,W,7);let Ae=Number(se&BigInt(4294967295));Ce[W++]=Ae,Ae=Ae>>8,Ce[W++]=Ae,Ae=Ae>>8,Ce[W++]=Ae,Ae=Ae>>8,Ce[W++]=Ae;let ye=Number(se>>BigInt(32)&BigInt(4294967295));return Ce[W++]=ye,ye=ye>>8,Ce[W++]=ye,ye=ye>>8,Ce[W++]=ye,ye=ye>>8,Ce[W++]=ye,W}function Re(Ce,se,W,oe,Se){Le(se,oe,Se,Ce,W,7);let Ae=Number(se&BigInt(4294967295));Ce[W+7]=Ae,Ae=Ae>>8,Ce[W+6]=Ae,Ae=Ae>>8,Ce[W+5]=Ae,Ae=Ae>>8,Ce[W+4]=Ae;let ye=Number(se>>BigInt(32)&BigInt(4294967295));return Ce[W+3]=ye,ye=ye>>8,Ce[W+2]=ye,ye=ye>>8,Ce[W+1]=ye,ye=ye>>8,Ce[W]=ye,W+8}u.prototype.writeBigUInt64LE=gt(function(se,W=0){return Ee(this,se,W,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeBigUInt64BE=gt(function(se,W=0){return Re(this,se,W,BigInt(0),BigInt("0xffffffffffffffff"))}),u.prototype.writeIntLE=function(se,W,oe,Se){if(se=+se,W=W>>>0,!Se){const Ye=Math.pow(2,8*oe-1);ie(this,se,W,oe,Ye-1,-Ye)}let Ae=0,ye=1,_e=0;for(this[W]=se&255;++Ae<oe&&(ye*=256);)se<0&&_e===0&&this[W+Ae-1]!==0&&(_e=1),this[W+Ae]=(se/ye>>0)-_e&255;return W+oe},u.prototype.writeIntBE=function(se,W,oe,Se){if(se=+se,W=W>>>0,!Se){const Ye=Math.pow(2,8*oe-1);ie(this,se,W,oe,Ye-1,-Ye)}let Ae=oe-1,ye=1,_e=0;for(this[W+Ae]=se&255;--Ae>=0&&(ye*=256);)se<0&&_e===0&&this[W+Ae+1]!==0&&(_e=1),this[W+Ae]=(se/ye>>0)-_e&255;return W+oe},u.prototype.writeInt8=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,1,127,-128),se<0&&(se=255+se+1),this[W]=se&255,W+1},u.prototype.writeInt16LE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,2,32767,-32768),this[W]=se&255,this[W+1]=se>>>8,W+2},u.prototype.writeInt16BE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,2,32767,-32768),this[W]=se>>>8,this[W+1]=se&255,W+2},u.prototype.writeInt32LE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,4,2147483647,-2147483648),this[W]=se&255,this[W+1]=se>>>8,this[W+2]=se>>>16,this[W+3]=se>>>24,W+4},u.prototype.writeInt32BE=function(se,W,oe){return se=+se,W=W>>>0,oe||ie(this,se,W,4,2147483647,-2147483648),se<0&&(se=4294967295+se+1),this[W]=se>>>24,this[W+1]=se>>>16,this[W+2]=se>>>8,this[W+3]=se&255,W+4},u.prototype.writeBigInt64LE=gt(function(se,W=0){return Ee(this,se,W,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),u.prototype.writeBigInt64BE=gt(function(se,W=0){return Re(this,se,W,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Te(Ce,se,W,oe,Se,Ae){if(W+oe>Ce.length)throw new RangeError("Index out of range");if(W<0)throw new RangeError("Index out of range")}function Pe(Ce,se,W,oe,Se){return se=+se,W=W>>>0,Se||Te(Ce,se,W,4),t.write(Ce,se,W,oe,23,4),W+4}u.prototype.writeFloatLE=function(se,W,oe){return Pe(this,se,W,!0,oe)},u.prototype.writeFloatBE=function(se,W,oe){return Pe(this,se,W,!1,oe)};function We(Ce,se,W,oe,Se){return se=+se,W=W>>>0,Se||Te(Ce,se,W,8),t.write(Ce,se,W,oe,52,8),W+8}u.prototype.writeDoubleLE=function(se,W,oe){return We(this,se,W,!0,oe)},u.prototype.writeDoubleBE=function(se,W,oe){return We(this,se,W,!1,oe)},u.prototype.copy=function(se,W,oe,Se){if(!u.isBuffer(se))throw new TypeError("argument should be a Buffer");if(oe||(oe=0),!Se&&Se!==0&&(Se=this.length),W>=se.length&&(W=se.length),W||(W=0),Se>0&&Se<oe&&(Se=oe),Se===oe||se.length===0||this.length===0)return 0;if(W<0)throw new RangeError("targetStart out of bounds");if(oe<0||oe>=this.length)throw new RangeError("Index out of range");if(Se<0)throw new RangeError("sourceEnd out of bounds");Se>this.length&&(Se=this.length),se.length-W<Se-oe&&(Se=se.length-W+oe);const Ae=Se-oe;return this===se&&typeof s.prototype.copyWithin=="function"?this.copyWithin(W,oe,Se):s.prototype.set.call(se,this.subarray(oe,Se),W),Ae},u.prototype.fill=function(se,W,oe,Se){if(typeof se=="string"){if(typeof W=="string"?(Se=W,W=0,oe=this.length):typeof oe=="string"&&(Se=oe,oe=this.length),Se!==void 0&&typeof Se!="string")throw new TypeError("encoding must be a string");if(typeof Se=="string"&&!u.isEncoding(Se))throw new TypeError("Unknown encoding: "+Se);if(se.length===1){const ye=se.charCodeAt(0);(Se==="utf8"&&ye<128||Se==="latin1")&&(se=ye)}}else typeof se=="number"?se=se&255:typeof se=="boolean"&&(se=Number(se));if(W<0||this.length<W||this.length<oe)throw new RangeError("Out of range index");if(oe<=W)return this;W=W>>>0,oe=oe===void 0?this.length:oe>>>0,se||(se=0);let Ae;if(typeof se=="number")for(Ae=W;Ae<oe;++Ae)this[Ae]=se;else{const ye=u.isBuffer(se)?se:u.from(se,Se),_e=ye.length;if(_e===0)throw new TypeError('The value "'+se+'" is invalid for argument "value"');for(Ae=0;Ae<oe-W;++Ae)this[Ae+W]=ye[Ae%_e]}return this};const it={};function ht(Ce,se,W){it[Ce]=class extends W{constructor(){super(),Object.defineProperty(this,"message",{value:se.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Ce}]`,this.stack,delete this.name}get code(){return Ce}set code(Se){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:Se,writable:!0})}toString(){return`${this.name} [${Ce}]: ${this.message}`}}}ht("ERR_BUFFER_OUT_OF_BOUNDS",function(Ce){return Ce?`${Ce} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ht("ERR_INVALID_ARG_TYPE",function(Ce,se){return`The "${Ce}" argument must be of type number. Received type ${typeof se}`},TypeError),ht("ERR_OUT_OF_RANGE",function(Ce,se,W){let oe=`The value of "${Ce}" is out of range.`,Se=W;return Number.isInteger(W)&&Math.abs(W)>2**32?Se=vt(String(W)):typeof W=="bigint"&&(Se=String(W),(W>BigInt(2)**BigInt(32)||W<-(BigInt(2)**BigInt(32)))&&(Se=vt(Se)),Se+="n"),oe+=` It must be ${se}. Received ${Se}`,oe},RangeError);function vt(Ce){let se="",W=Ce.length;const oe=Ce[0]==="-"?1:0;for(;W>=oe+4;W-=3)se=`_${Ce.slice(W-3,W)}${se}`;return`${Ce.slice(0,W)}${se}`}function re(Ce,se,W){$e(se,"offset"),(Ce[se]===void 0||Ce[se+W]===void 0)&&De(se,Ce.length-(W+1))}function Le(Ce,se,W,oe,Se,Ae){if(Ce>W||Ce<se){const ye=typeof se=="bigint"?"n":"";let _e;throw se===0||se===BigInt(0)?_e=`>= 0${ye} and < 2${ye} ** ${(Ae+1)*8}${ye}`:_e=`>= -(2${ye} ** ${(Ae+1)*8-1}${ye}) and < 2 ** ${(Ae+1)*8-1}${ye}`,new it.ERR_OUT_OF_RANGE("value",_e,Ce)}re(oe,Se,Ae)}function $e(Ce,se){if(typeof Ce!="number")throw new it.ERR_INVALID_ARG_TYPE(se,"number",Ce)}function De(Ce,se,W){throw Math.floor(Ce)!==Ce?($e(Ce,W),new it.ERR_OUT_OF_RANGE("offset","an integer",Ce)):se<0?new it.ERR_BUFFER_OUT_OF_BOUNDS:new it.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${se}`,Ce)}const Oe=/[^+/0-9A-Za-z-_]/g;function ae(Ce){if(Ce=Ce.split("=")[0],Ce=Ce.trim().replace(Oe,""),Ce.length<2)return"";for(;Ce.length%4!==0;)Ce=Ce+"=";return Ce}function ve(Ce,se){se=se||1/0;let W;const oe=Ce.length;let Se=null;const Ae=[];for(let ye=0;ye<oe;++ye){if(W=Ce.charCodeAt(ye),W>55295&&W<57344){if(!Se){if(W>56319){(se-=3)>-1&&Ae.push(239,191,189);continue}else if(ye+1===oe){(se-=3)>-1&&Ae.push(239,191,189);continue}Se=W;continue}if(W<56320){(se-=3)>-1&&Ae.push(239,191,189),Se=W;continue}W=(Se-55296<<10|W-56320)+65536}else Se&&(se-=3)>-1&&Ae.push(239,191,189);if(Se=null,W<128){if((se-=1)<0)break;Ae.push(W)}else if(W<2048){if((se-=2)<0)break;Ae.push(W>>6|192,W&63|128)}else if(W<65536){if((se-=3)<0)break;Ae.push(W>>12|224,W>>6&63|128,W&63|128)}else if(W<1114112){if((se-=4)<0)break;Ae.push(W>>18|240,W>>12&63|128,W>>6&63|128,W&63|128)}else throw new Error("Invalid code point")}return Ae}function xe(Ce){const se=[];for(let W=0;W<Ce.length;++W)se.push(Ce.charCodeAt(W)&255);return se}function pe(Ce,se){let W,oe,Se;const Ae=[];for(let ye=0;ye<Ce.length&&!((se-=2)<0);++ye)W=Ce.charCodeAt(ye),oe=W>>8,Se=W%256,Ae.push(Se),Ae.push(oe);return Ae}function ze(Ce){return e.toByteArray(ae(Ce))}function Je(Ce,se,W,oe){let Se;for(Se=0;Se<oe&&!(Se+W>=se.length||Se>=Ce.length);++Se)se[Se+W]=Ce[Se];return Se}function Xe(Ce,se){return Ce instanceof se||Ce!=null&&Ce.constructor!=null&&Ce.constructor.name!=null&&Ce.constructor.name===se.name}function et(Ce){return Ce!==Ce}const Ut=(function(){const Ce="0123456789abcdef",se=new Array(256);for(let W=0;W<16;++W){const oe=W*16;for(let Se=0;Se<16;++Se)se[oe+Se]=Ce[W]+Ce[Se]}return se})();function gt(Ce){return typeof BigInt>"u"?At:Ce}function At(){throw new Error("BigInt not supported")}})(CY);const io=CY.Buffer;var zL;try{zL=new TextDecoder}catch{}var Wn,qm,Et=0,so={},Bi,kv,Jf=0,Lm=0,Dc,H0,Oh=[],Pi,z9={useRecords:!1,mapsAsObjects:!0};class kY{}const MY=new kY;MY.name="MessagePack 0xC1";var Pv=!1,IY=2,tEe;try{new Function("")}catch{IY=1/0}class aA{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.sequential&&e.trusted!==!1&&(e.trusted=!0,!e.structures&&e.useRecords!=!1&&(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(Wn)return UY(()=>(VL(),this?this.unpack(e,t):aA.prototype.unpack.call(z9,e,t)));!e.buffer&&e.constructor===ArrayBuffer&&(e=typeof io<"u"?io.from(e):new Uint8Array(e)),typeof t=="object"?(qm=t.end||e.length,Et=t.start||0):(Et=0,qm=t>-1?t:e.length),Lm=0,kv=null,Dc=null,Wn=e;try{Pi=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw Wn=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof aA){if(so=this,this.structures)return Bi=this.structures,OR(t);(!Bi||Bi.length>0)&&(Bi=[])}else so=z9,(!Bi||Bi.length>0)&&(Bi=[]);return OR(t)}unpackMultiple(e,t){let r,i=0;try{Pv=!0;let s=e.length,o=this?this.unpack(e,s):RO.unpack(e,s);if(t){if(t(o,i,Et)===!1)return;for(;Et<s;)if(i=Et,t(OR(),i,Et)===!1)return}else{for(r=[o];Et<s;)i=Et,r.push(OR());return r}}catch(s){throw s.lastPosition=i,s.values=r,s}finally{Pv=!1,VL()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map(r=>r.slice(0)));for(let r=0,i=e.length;r<i;r++){let s=e[r];s&&(s.isShared=!0,r>=32&&(s.highByte=r-32>>5))}e.sharedLength=e.length;for(let r in t||[])if(r>=0){let i=e[r],s=t[r];s&&(i&&((e.restoreStructures||(e.restoreStructures=[]))[r]=i),e[r]=s)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function OR(n){try{if(!so.trusted&&!Pv){let t=Bi.sharedLength||0;t<Bi.length&&(Bi.length=t)}let e;if(so.randomAccessStructure&&Wn[Et]<64&&Wn[Et]>=32&&tEe||(e=ka()),Dc&&(Et=Dc.postBundlePosition,Dc=null),Pv&&(Bi.restoreStructures=null),Et==qm)Bi&&Bi.restoreStructures&&$9(),Bi=null,Wn=null,H0&&(H0=null);else{if(Et>qm)throw new Error("Unexpected end of MessagePack data");if(!Pv){let t;try{t=JSON.stringify(e,(r,i)=>typeof i=="bigint"?`${i}n`:i).slice(0,100)}catch(r){t="(JSON view not available "+r+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw Bi&&Bi.restoreStructures&&$9(),VL(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||Et>qm)&&(e.incomplete=!0),e}}function $9(){for(let n in Bi.restoreStructures)Bi[n]=Bi.restoreStructures[n];Bi.restoreStructures=null}function ka(){let n=Wn[Et++];if(n<160)if(n<128){if(n<64)return n;{let e=Bi[n&63]||so.getStructures&&OY()[n&63];return e?(e.read||(e.read=u6(e,n&63)),e.read()):n}}else if(n<144)if(n-=128,so.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=PY();r==="__proto__"&&(r="__proto_"),e[r]=ka()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(ka(),ka());return e}else{n-=144;let e=new Array(n);for(let t=0;t<n;t++)e[t]=ka();return so.freezeData?Object.freeze(e):e}else if(n<192){let e=n-160;if(Lm>=Et)return kv.slice(Et-Jf,(Et+=e)-Jf);if(Lm==0&&qm<140){let t=e<16?h6(e):NY(e);if(t!=null)return t}return $L(e)}else{let e;switch(n){case 192:return null;case 193:return Dc?(e=ka(),e>0?Dc[1].slice(Dc.position1,Dc.position1+=e):Dc[0].slice(Dc.position0,Dc.position0-=e)):MY;case 194:return!1;case 195:return!0;case 196:if(e=Wn[Et++],e===void 0)throw new Error("Unexpected end of buffer");return WN(e);case 197:return e=Pi.getUint16(Et),Et+=2,WN(e);case 198:return e=Pi.getUint32(Et),Et+=4,WN(e);case 199:return Zy(Wn[Et++]);case 200:return e=Pi.getUint16(Et),Et+=2,Zy(e);case 201:return e=Pi.getUint32(Et),Et+=4,Zy(e);case 202:if(e=Pi.getFloat32(Et),so.useFloat32>2){let t=f6[(Wn[Et]&127)<<1|Wn[Et+1]>>7];return Et+=4,(t*e+(e>0?.5:-.5)>>0)/t}return Et+=4,e;case 203:return e=Pi.getFloat64(Et),Et+=8,e;case 204:return Wn[Et++];case 205:return e=Pi.getUint16(Et),Et+=2,e;case 206:return e=Pi.getUint32(Et),Et+=4,e;case 207:return so.int64AsType==="number"?(e=Pi.getUint32(Et)*4294967296,e+=Pi.getUint32(Et+4)):so.int64AsType==="string"?e=Pi.getBigUint64(Et).toString():so.int64AsType==="auto"?(e=Pi.getBigUint64(Et),e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Pi.getBigUint64(Et),Et+=8,e;case 208:return Pi.getInt8(Et++);case 209:return e=Pi.getInt16(Et),Et+=2,e;case 210:return e=Pi.getInt32(Et),Et+=4,e;case 211:return so.int64AsType==="number"?(e=Pi.getInt32(Et)*4294967296,e+=Pi.getUint32(Et+4)):so.int64AsType==="string"?e=Pi.getBigInt64(Et).toString():so.int64AsType==="auto"?(e=Pi.getBigInt64(Et),e>=BigInt(-2)<<BigInt(52)&&e<=BigInt(2)<<BigInt(52)&&(e=Number(e))):e=Pi.getBigInt64(Et),Et+=8,e;case 212:if(e=Wn[Et++],e==114)return Y9(Wn[Et++]&63);{let t=Oh[e];if(t)return t.read?(Et++,t.read(ka())):t.noBuffer?(Et++,t()):t(Wn.subarray(Et,++Et));throw new Error("Unknown extension "+e)}case 213:return e=Wn[Et],e==114?(Et++,Y9(Wn[Et++]&63,Wn[Et++])):Zy(2);case 214:return Zy(4);case 215:return Zy(8);case 216:return Zy(16);case 217:return e=Wn[Et++],Lm>=Et?kv.slice(Et-Jf,(Et+=e)-Jf):rEe(e);case 218:return e=Pi.getUint16(Et),Et+=2,Lm>=Et?kv.slice(Et-Jf,(Et+=e)-Jf):iEe(e);case 219:return e=Pi.getUint32(Et),Et+=4,Lm>=Et?kv.slice(Et-Jf,(Et+=e)-Jf):sEe(e);case 220:return e=Pi.getUint16(Et),Et+=2,H9(e);case 221:return e=Pi.getUint32(Et),Et+=4,H9(e);case 222:return e=Pi.getUint16(Et),Et+=2,G9(e);case 223:return e=Pi.getUint32(Et),Et+=4,G9(e);default:if(n>=224)return n-256;if(n===void 0){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}throw new Error("Unknown MessagePack token "+n)}}}const nEe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function u6(n,e){function t(){if(t.count++>IY){let i=n.read=new Function("r","return function(){return "+(so.freezeData?"Object.freeze":"")+"({"+n.map(s=>s==="__proto__"?"__proto_:r()":nEe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"})}")(ka);return n.highByte===0&&(n.read=V9(e,n.read)),i()}let r={};for(let i=0,s=n.length;i<s;i++){let o=n[i];o==="__proto__"&&(o="__proto_"),r[o]=ka()}return so.freezeData?Object.freeze(r):r}return t.count=0,n.highByte===0?V9(e,t):t}const V9=(n,e)=>function(){let t=Wn[Et++];if(t===0)return e();let r=n<32?-(n+(t<<5)):n+(t<<5),i=Bi[r]||OY()[r];if(!i)throw new Error("Record id is not defined for "+r);return i.read||(i.read=u6(i,n)),i.read()};function OY(){let n=UY(()=>(Wn=null,so.getStructures()));return Bi=so._mergeStructures(n,Bi)}var $L=oC,rEe=oC,iEe=oC,sEe=oC;function oC(n){let e;if(n<16&&(e=h6(n)))return e;if(n>64&&zL)return zL.decode(Wn.subarray(Et,Et+=n));const t=Et+n,r=[];for(e="";Et<t;){const i=Wn[Et++];if((i&128)===0)r.push(i);else if((i&224)===192){const s=Wn[Et++]&63;r.push((i&31)<<6|s)}else if((i&240)===224){const s=Wn[Et++]&63,o=Wn[Et++]&63;r.push((i&31)<<12|s<<6|o)}else if((i&248)===240){const s=Wn[Et++]&63,o=Wn[Et++]&63,a=Wn[Et++]&63;let c=(i&7)<<18|s<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(i);r.length>=4096&&(e+=Oc.apply(String,r),r.length=0)}return r.length>0&&(e+=Oc.apply(String,r)),e}function H9(n){let e=new Array(n);for(let t=0;t<n;t++)e[t]=ka();return so.freezeData?Object.freeze(e):e}function G9(n){if(so.mapsAsObjects){let e={};for(let t=0;t<n;t++){let r=PY();r==="__proto__"&&(r="__proto_"),e[r]=ka()}return e}else{let e=new Map;for(let t=0;t<n;t++)e.set(ka(),ka());return e}}var Oc=String.fromCharCode;function NY(n){let e=Et,t=new Array(n);for(let r=0;r<n;r++){const i=Wn[Et++];if((i&128)>0){Et=e;return}t[r]=i}return Oc.apply(String,t)}function h6(n){if(n<4)if(n<2){if(n===0)return"";{let e=Wn[Et++];if((e&128)>1){Et-=1;return}return Oc(e)}}else{let e=Wn[Et++],t=Wn[Et++];if((e&128)>0||(t&128)>0){Et-=2;return}if(n<3)return Oc(e,t);let r=Wn[Et++];if((r&128)>0){Et-=3;return}return Oc(e,t,r)}else{let e=Wn[Et++],t=Wn[Et++],r=Wn[Et++],i=Wn[Et++];if((e&128)>0||(t&128)>0||(r&128)>0||(i&128)>0){Et-=4;return}if(n<6){if(n===4)return Oc(e,t,r,i);{let s=Wn[Et++];if((s&128)>0){Et-=5;return}return Oc(e,t,r,i,s)}}else if(n<8){let s=Wn[Et++],o=Wn[Et++];if((s&128)>0||(o&128)>0){Et-=6;return}if(n<7)return Oc(e,t,r,i,s,o);let a=Wn[Et++];if((a&128)>0){Et-=7;return}return Oc(e,t,r,i,s,o,a)}else{let s=Wn[Et++],o=Wn[Et++],a=Wn[Et++],c=Wn[Et++];if((s&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){Et-=8;return}if(n<10){if(n===8)return Oc(e,t,r,i,s,o,a,c);{let l=Wn[Et++];if((l&128)>0){Et-=9;return}return Oc(e,t,r,i,s,o,a,c,l)}}else if(n<12){let l=Wn[Et++],u=Wn[Et++];if((l&128)>0||(u&128)>0){Et-=10;return}if(n<11)return Oc(e,t,r,i,s,o,a,c,l,u);let h=Wn[Et++];if((h&128)>0){Et-=11;return}return Oc(e,t,r,i,s,o,a,c,l,u,h)}else{let l=Wn[Et++],u=Wn[Et++],h=Wn[Et++],f=Wn[Et++];if((l&128)>0||(u&128)>0||(h&128)>0||(f&128)>0){Et-=12;return}if(n<14){if(n===12)return Oc(e,t,r,i,s,o,a,c,l,u,h,f);{let d=Wn[Et++];if((d&128)>0){Et-=13;return}return Oc(e,t,r,i,s,o,a,c,l,u,h,f,d)}}else{let d=Wn[Et++],p=Wn[Et++];if((d&128)>0||(p&128)>0){Et-=14;return}if(n<15)return Oc(e,t,r,i,s,o,a,c,l,u,h,f,d,p);let m=Wn[Et++];if((m&128)>0){Et-=15;return}return Oc(e,t,r,i,s,o,a,c,l,u,h,f,d,p,m)}}}}}function W9(){let n=Wn[Et++],e;if(n<192)e=n-160;else switch(n){case 217:e=Wn[Et++];break;case 218:e=Pi.getUint16(Et),Et+=2;break;case 219:e=Pi.getUint32(Et),Et+=4;break;default:throw new Error("Expected string")}return oC(e)}function WN(n){return so.copyBuffers?Uint8Array.prototype.slice.call(Wn,Et,Et+=n):Wn.subarray(Et,Et+=n)}function Zy(n){let e=Wn[Et++];if(Oh[e]){let t;return Oh[e](Wn.subarray(Et,t=Et+=n),r=>{Et=r;try{return ka()}finally{Et=t}})}else throw new Error("Unknown extension type "+e)}var q9=new Array(4096);function PY(){let n=Wn[Et++];if(n>=160&&n<192){if(n=n-160,Lm>=Et)return kv.slice(Et-Jf,(Et+=n)-Jf);if(!(Lm==0&&qm<180))return $L(n)}else return Et--,DY(ka());let e=(n<<5^(n>1?Pi.getUint16(Et):n>0?Wn[Et]:0))&4095,t=q9[e],r=Et,i=Et+n-3,s,o=0;if(t&&t.bytes==n){for(;r<i;){if(s=Pi.getUint32(r),s!=t[o++]){r=1879048192;break}r+=4}for(i+=3;r<i;)if(s=Wn[r++],s!=t[o++]){r=1879048192;break}if(r===i)return Et=r,t.string;i-=3,r=Et}for(t=[],q9[e]=t,t.bytes=n;r<i;)s=Pi.getUint32(r),t.push(s),r+=4;for(i+=3;r<i;)s=Wn[r++],t.push(s);let a=n<16?h6(n):NY(n);return a!=null?t.string=a:t.string=$L(n)}function DY(n){if(typeof n=="string")return n;if(typeof n=="number"||typeof n=="boolean"||typeof n=="bigint")return n.toString();if(n==null)return n+"";if(so.allowArraysInMapKeys&&Array.isArray(n)&&n.flat().every(e=>["string","number","boolean","bigint"].includes(typeof e)))return n.flat().toString();throw new Error(`Invalid property type for record: ${typeof n}`)}const Y9=(n,e)=>{let t=ka().map(DY),r=n;e!==void 0&&(n=n<32?-((e<<5)+n):(e<<5)+n,t.highByte=e);let i=Bi[n];return i&&(i.isShared||Pv)&&((Bi.restoreStructures||(Bi.restoreStructures=[]))[n]=i),Bi[n]=t,t.read=u6(t,r),t.read()};Oh[0]=()=>{};Oh[0].noBuffer=!0;Oh[66]=n=>{let e=n.byteLength%8||8,t=BigInt(n[0]&128?n[0]-256:n[0]);for(let r=1;r<e;r++)t<<=BigInt(8),t+=BigInt(n[r]);if(n.byteLength!==e){let r=new DataView(n.buffer,n.byteOffset,n.byteLength),i=(s,o)=>{let a=o-s;if(a<=40){let h=r.getBigUint64(s);for(let f=s+8;f<o;f+=8)h<<=64n,h|=r.getBigUint64(f);return h}let c=s+(a>>4<<3),l=i(s,c),u=i(c,o);return l<<BigInt((o-c)*8)|u};t=t<<BigInt((r.byteLength-e)*8)|i(e,r.byteLength)}return t};let K9={Error,EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,AggregateError:typeof AggregateError=="function"?AggregateError:null};Oh[101]=()=>{let n=ka();if(!K9[n[0]]){let e=Error(n[1],{cause:n[2]});return e.name=n[0],e}return K9[n[0]](n[1],{cause:n[2]})};Oh[105]=n=>{if(so.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Pi.getUint32(Et-4);H0||(H0=new Map);let t=Wn[Et],r;t>=144&&t<160||t==220||t==221?r=[]:t>=128&&t<144||t==222||t==223?r=new Map:(t>=199&&t<=201||t>=212&&t<=216)&&Wn[Et+1]===115?r=new Set:r={};let i={target:r};H0.set(e,i);let s=ka();if(i.used)Object.assign(r,s);else return i.target=s;if(r instanceof Map)for(let[o,a]of s.entries())r.set(o,a);if(r instanceof Set)for(let o of Array.from(s))r.add(o);return r};Oh[112]=n=>{if(so.structuredClone===!1)throw new Error("Structured clone extension is disabled");let e=Pi.getUint32(Et-4),t=H0.get(e);return t.used=!0,t.target};Oh[115]=()=>new Set(ka());const LY=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(n=>n+"Array");let oEe=typeof globalThis=="object"?globalThis:window;Oh[116]=n=>{let e=n[0],t=Uint8Array.prototype.slice.call(n,1).buffer,r=LY[e];if(!r){if(e===16)return t;if(e===17)return new DataView(t);throw new Error("Could not find typed array for code "+e)}return new oEe[r](t)};Oh[120]=()=>{let n=ka();return new RegExp(n[0],n[1])};const aEe=[];Oh[98]=n=>{let e=(n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3],t=Et;return Et+=e-n.length,Dc=aEe,Dc=[W9(),W9()],Dc.position0=0,Dc.position1=0,Dc.postBundlePosition=Et,Et=t,ka()};Oh[255]=n=>n.length==4?new Date((n[0]*16777216+(n[1]<<16)+(n[2]<<8)+n[3])*1e3):n.length==8?new Date(((n[0]<<22)+(n[1]<<14)+(n[2]<<6)+(n[3]>>2))/1e6+((n[3]&3)*4294967296+n[4]*16777216+(n[5]<<16)+(n[6]<<8)+n[7])*1e3):n.length==12?new Date(((n[0]<<24)+(n[1]<<16)+(n[2]<<8)+n[3])/1e6+((n[4]&128?-281474976710656:0)+n[6]*1099511627776+n[7]*4294967296+n[8]*16777216+(n[9]<<16)+(n[10]<<8)+n[11])*1e3):new Date("invalid");function UY(n){let e=qm,t=Et,r=Jf,i=Lm,s=kv,o=H0,a=Dc,c=new Uint8Array(Wn.slice(0,qm)),l=Bi,u=Bi.slice(0,Bi.length),h=so,f=Pv,d=n();return qm=e,Et=t,Jf=r,Lm=i,kv=s,H0=o,Dc=a,Wn=c,Pv=f,Bi=l,Bi.splice(0,Bi.length,...u),so=h,Pi=new DataView(Wn.buffer,Wn.byteOffset,Wn.byteLength),d}function VL(){Wn=null,H0=null,Bi=null}const f6=new Array(147);for(let n=0;n<256;n++)f6[n]=+("1e"+Math.floor(45.15-n*.30103));var RO=new aA({useRecords:!1});RO.unpack;RO.unpackMultiple;RO.unpack;let cEe=new Float32Array(1);new Uint8Array(cEe.buffer,0,4);let Fk;try{Fk=new TextEncoder}catch{}let HL,GL;const cx=typeof io<"u",NR=cx?function(n){return io.allocUnsafeSlow(n)}:Uint8Array,BY=cx?io:Uint8Array,X9=cx?4294967296:2144337920;let jt,WT,Ys,wt=0,Ol,Go=null,lEe;const uEe=21760,hEe=/[\u0080-\uFFFF]/,KS=Symbol("record-id");class fEe extends aA{constructor(e){super(e),this.offset=0;let t,r,i,s,o=BY.prototype.utf8Write?function(L,P){return jt.utf8Write(L,P,jt.byteLength-P)}:Fk&&Fk.encodeInto?function(L,P){return Fk.encodeInto(L,jt.subarray(P)).written}:!1,a=this;e||(e={});let c=e&&e.sequential,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=l?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&e.moreTypes==null&&(this.moreTypes=!0);let h=e.maxOwnStructures;h==null&&(h=l?32:64),!this.structures&&e.useRecords!=!1&&(this.structures=[]);let f=u>32||h+u>64,d=u+64,p=u+h+64;if(p>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],_=0,v=0;this.pack=this.encode=function(L,P){if(jt||(jt=new NR(8192),Ys=jt.dataView||(jt.dataView=new DataView(jt.buffer,0,8192)),wt=0),Ol=jt.length-10,Ol-wt<2048?(jt=new NR(jt.length),Ys=jt.dataView||(jt.dataView=new DataView(jt.buffer,0,jt.length)),Ol=jt.length-10,wt=0):wt=wt+7&2147483640,t=wt,P&_Ee&&(wt+=P&255),s=a.structuredClone?new Map:null,a.bundleStrings&&typeof L!="string"?(Go=[],Go.size=1/0):Go=null,i=a.structures,i){i.uninitialized&&(i=a._mergeStructures(a.getStructures()));let X=i.sharedLength||0;if(X>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let G=0;G<X;G++){let Y=i[G];if(!Y)continue;let J,Q=i.transitions;for(let z=0,q=Y.length;z<q;z++){let ee=Y[z];J=Q[ee],J||(J=Q[ee]=Object.create(null)),Q=J}Q[KS]=G+64}this.lastNamedStructuresLength=X}c||(i.nextId=X+64)}r&&(r=!1);let H;try{a.randomAccessStructure&&L&&typeof L=="object"?L.constructor===Object?I(L):L.constructor!==Map&&!Array.isArray(L)&&!GL.some(G=>L instanceof G)?I(L.toJSON?L.toJSON():L):T(L):T(L);let X=Go;if(Go&&J9(t,T,0),s&&s.idsToInsert){let G=s.idsToInsert.sort((z,q)=>z.offset>q.offset?1:-1),Y=G.length,J=-1;for(;X&&Y>0;){let z=G[--Y].offset+t;z<X.stringsPosition+t&&J===-1&&(J=0),z>X.position+t?J>=0&&(J+=6):(J>=0&&(Ys.setUint32(X.position+t,Ys.getUint32(X.position+t)+J),J=-1),X=X.previous,Y++)}J>=0&&X&&Ys.setUint32(X.position+t,Ys.getUint32(X.position+t)+J),wt+=G.length*6,wt>Ol&&U(wt),a.offset=wt;let Q=dEe(jt.subarray(t,wt),G);return s=null,Q}return a.offset=wt,P&mEe?(jt.start=t,jt.end=wt,jt):jt.subarray(t,wt)}catch(X){throw H=X,X}finally{if(i&&(S(),r&&a.saveStructures)){let X=i.sharedLength||0,G=jt.subarray(t,wt),Y=pEe(i,a);if(!H)return a.saveStructures(Y,Y.isCompatible)===!1?a.pack(L,P):(a.lastNamedStructuresLength=X,jt.length>1073741824&&(jt=null),G)}jt.length>1073741824&&(jt=null),P&gEe&&(wt=t)}};const S=()=>{v<10&&v++;let L=i.sharedLength||0;if(i.length>L&&!c&&(i.length=L),_>1e4)i.transitions=null,v=0,_=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let P=0,H=m.length;P<H;P++)m[P][KS]=0;m=[]}},b=L=>{var P=L.length;P<16?jt[wt++]=144|P:P<65536?(jt[wt++]=220,jt[wt++]=P>>8,jt[wt++]=P&255):(jt[wt++]=221,Ys.setUint32(wt,P),wt+=4);for(let H=0;H<P;H++)T(L[H])},T=L=>{wt>Ol&&(jt=U(wt));var P=typeof L,H;if(P==="string"){let X=L.length;if(Go&&X>=4&&X<4096){if((Go.size+=X)>uEe){let Q,z=(Go[0]?Go[0].length*3+Go[1].length:0)+10;wt+z>Ol&&(jt=U(wt+z));let q;Go.position?(q=Go,jt[wt]=200,wt+=3,jt[wt++]=98,Q=wt-t,wt+=4,J9(t,T,0),Ys.setUint16(Q+t-3,wt-t-Q)):(jt[wt++]=214,jt[wt++]=98,Q=wt-t,wt+=4),Go=["",""],Go.previous=q,Go.size=0,Go.position=Q}let J=hEe.test(L);Go[J?0:1]+=L,jt[wt++]=193,T(J?-X:X);return}let G;X<32?G=1:X<256?G=2:X<65536?G=3:G=5;let Y=X*3;if(wt+Y>Ol&&(jt=U(wt+Y)),X<64||!o){let J,Q,z,q=wt+G;for(J=0;J<X;J++)Q=L.charCodeAt(J),Q<128?jt[q++]=Q:Q<2048?(jt[q++]=Q>>6|192,jt[q++]=Q&63|128):(Q&64512)===55296&&((z=L.charCodeAt(J+1))&64512)===56320?(Q=65536+((Q&1023)<<10)+(z&1023),J++,jt[q++]=Q>>18|240,jt[q++]=Q>>12&63|128,jt[q++]=Q>>6&63|128,jt[q++]=Q&63|128):(jt[q++]=Q>>12|224,jt[q++]=Q>>6&63|128,jt[q++]=Q&63|128);H=q-wt-G}else H=o(L,wt+G);H<32?jt[wt++]=160|H:H<256?(G<2&&jt.copyWithin(wt+2,wt+1,wt+1+H),jt[wt++]=217,jt[wt++]=H):H<65536?(G<3&&jt.copyWithin(wt+3,wt+2,wt+2+H),jt[wt++]=218,jt[wt++]=H>>8,jt[wt++]=H&255):(G<5&&jt.copyWithin(wt+5,wt+3,wt+3+H),jt[wt++]=219,Ys.setUint32(wt,H),wt+=4),wt+=H}else if(P==="number")if(L>>>0===L)L<32||L<128&&this.useRecords===!1||L<64&&!this.randomAccessStructure?jt[wt++]=L:L<256?(jt[wt++]=204,jt[wt++]=L):L<65536?(jt[wt++]=205,jt[wt++]=L>>8,jt[wt++]=L&255):(jt[wt++]=206,Ys.setUint32(wt,L),wt+=4);else if(L>>0===L)L>=-32?jt[wt++]=256+L:L>=-128?(jt[wt++]=208,jt[wt++]=L+256):L>=-32768?(jt[wt++]=209,Ys.setInt16(wt,L),wt+=2):(jt[wt++]=210,Ys.setInt32(wt,L),wt+=4);else{let X;if((X=this.useFloat32)>0&&L<4294967296&&L>=-2147483648){jt[wt++]=202,Ys.setFloat32(wt,L);let G;if(X<4||(G=L*f6[(jt[wt]&127)<<1|jt[wt+1]>>7])>>0===G){wt+=4;return}else wt--}jt[wt++]=203,Ys.setFloat64(wt,L),wt+=8}else if(P==="object"||P==="function")if(!L)jt[wt++]=192;else{if(s){let G=s.get(L);if(G){if(!G.id){let Y=s.idsToInsert||(s.idsToInsert=[]);G.id=Y.push(G)}jt[wt++]=214,jt[wt++]=112,Ys.setUint32(wt,G.id),wt+=4;return}else s.set(L,{offset:wt-t})}let X=L.constructor;if(X===Object)N(L);else if(X===Array)b(L);else if(X===Map)if(this.mapAsEmptyObject)jt[wt++]=128;else{H=L.size,H<16?jt[wt++]=128|H:H<65536?(jt[wt++]=222,jt[wt++]=H>>8,jt[wt++]=H&255):(jt[wt++]=223,Ys.setUint32(wt,H),wt+=4);for(let[G,Y]of L)T(G),T(Y)}else{for(let G=0,Y=HL.length;G<Y;G++){let J=GL[G];if(L instanceof J){let Q=HL[G];if(Q.write){Q.type&&(jt[wt++]=212,jt[wt++]=Q.type,jt[wt++]=0);let ie=Q.write.call(this,L);ie===L?Array.isArray(L)?b(L):N(L):T(ie);return}let z=jt,q=Ys,ee=wt;jt=null;let te;try{te=Q.pack.call(this,L,ie=>(jt=z,z=null,wt+=ie,wt>Ol&&U(wt),{target:jt,targetView:Ys,position:wt-ie}),T)}finally{z&&(jt=z,Ys=q,wt=ee,Ol=jt.length-10)}te&&(te.length+wt>Ol&&U(te.length+wt),wt=Z9(te,jt,wt,Q.type));return}}if(Array.isArray(L))b(L);else{if(L.toJSON){const G=L.toJSON();if(G!==L)return T(G)}if(P==="function")return T(this.writeFunction&&this.writeFunction(L));N(L)}}}else if(P==="boolean")jt[wt++]=L?195:194;else if(P==="bigint"){if(L<9223372036854776e3&&L>=-9223372036854776e3)jt[wt++]=211,Ys.setBigInt64(wt,L);else if(L<18446744073709552e3&&L>0)jt[wt++]=207,Ys.setBigUint64(wt,L);else if(this.largeBigIntToFloat)jt[wt++]=203,Ys.setFloat64(wt,Number(L));else{if(this.largeBigIntToString)return T(L.toString());if(this.useBigIntExtension||this.moreTypes){let X=L<0?BigInt(-1):BigInt(0),G;if(L>>BigInt(65536)===X){let Y=BigInt(18446744073709552e3)-BigInt(1),J=[];for(;J.push(L&Y),L>>BigInt(63)!==X;)L>>=BigInt(64);G=new Uint8Array(new BigUint64Array(J).buffer),G.reverse()}else{let Y=L<0,J=(Y?~L:L).toString(16);if(J.length%2?J="0"+J:parseInt(J.charAt(0),16)>=8&&(J="00"+J),cx)G=io.from(J,"hex");else{G=new Uint8Array(J.length/2);for(let Q=0;Q<G.length;Q++)G[Q]=parseInt(J.slice(Q*2,Q*2+2),16)}if(Y)for(let Q=0;Q<G.length;Q++)G[Q]=~G[Q]}G.length+wt>Ol&&U(G.length+wt),wt=Z9(G,jt,wt,66);return}else throw new RangeError(L+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}wt+=8}else if(P==="undefined")this.encodeUndefinedAsNil?jt[wt++]=192:(jt[wt++]=212,jt[wt++]=0,jt[wt++]=0);else throw new Error("Unknown type: "+P)},w=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?L=>{let P;if(this.skipValues){P=[];for(let G in L)(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(G))&&!this.skipValues.includes(L[G])&&P.push(G)}else P=Object.keys(L);let H=P.length;H<16?jt[wt++]=128|H:H<65536?(jt[wt++]=222,jt[wt++]=H>>8,jt[wt++]=H&255):(jt[wt++]=223,Ys.setUint32(wt,H),wt+=4);let X;if(this.coercibleKeyAsNumber)for(let G=0;G<H;G++){X=P[G];let Y=Number(X);T(isNaN(Y)?X:Y),T(L[X])}else for(let G=0;G<H;G++)T(X=P[G]),T(L[X])}:L=>{jt[wt++]=222;let P=wt-t;wt+=2;let H=0;for(let X in L)(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(X))&&(T(X),T(L[X]),H++);if(H>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');jt[P+++t]=H>>8,jt[P+t]=H&255},R=this.useRecords===!1?w:e.progressiveRecords&&!f?L=>{let P,H=i.transitions||(i.transitions=Object.create(null)),X=wt++-t,G;for(let Y in L)if(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(Y)){if(P=H[Y],P)H=P;else{let J=Object.keys(L),Q=H;H=i.transitions;let z=0;for(let q=0,ee=J.length;q<ee;q++){let te=J[q];P=H[te],P||(P=H[te]=Object.create(null),z++),H=P}X+t+1==wt?(wt--,B(H,J,z)):$(H,J,X,z),G=!0,H=Q[Y]}T(L[Y])}if(!G){let Y=H[KS];Y?jt[X+t]=Y:$(H,Object.keys(L),X,0)}}:L=>{let P,H=i.transitions||(i.transitions=Object.create(null)),X=0;for(let Y in L)(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(Y))&&(P=H[Y],P||(P=H[Y]=Object.create(null),X++),H=P);let G=H[KS];G?G>=96&&f?(jt[wt++]=((G-=96)&31)+96,jt[wt++]=G>>5):jt[wt++]=G:B(H,H.__keys__||Object.keys(L),X);for(let Y in L)(typeof L.hasOwnProperty!="function"||L.hasOwnProperty(Y))&&T(L[Y])},C=typeof this.useRecords=="function"&&this.useRecords,N=C?L=>{C(L)?R(L):w(L)}:R,U=L=>{let P;if(L>16777216){if(L-t>X9)throw new Error("Packed buffer would be larger than maximum buffer size");P=Math.min(X9,Math.round(Math.max((L-t)*(L>67108864?1.25:2),4194304)/4096)*4096)}else P=(Math.max(L-t<<2,jt.length-1)>>12)+1<<12;let H=new NR(P);return Ys=H.dataView||(H.dataView=new DataView(H.buffer,0,P)),L=Math.min(L,jt.length),jt.copy?jt.copy(H,0,t,L):H.set(jt.slice(t,L)),wt-=t,t=0,Ol=H.length-10,jt=H},B=(L,P,H)=>{let X=i.nextId;X||(X=64),X<d&&this.shouldShareStructure&&!this.shouldShareStructure(P)?(X=i.nextOwnId,X<p||(X=d),i.nextOwnId=X+1):(X>=p&&(X=d),i.nextId=X+1);let G=P.highByte=X>=96&&f?X-96>>5:-1;L[KS]=X,L.__keys__=P,i[X-64]=P,X<d?(P.isShared=!0,i.sharedLength=X-63,r=!0,G>=0?(jt[wt++]=(X&31)+96,jt[wt++]=G):jt[wt++]=X):(G>=0?(jt[wt++]=213,jt[wt++]=114,jt[wt++]=(X&31)+96,jt[wt++]=G):(jt[wt++]=212,jt[wt++]=114,jt[wt++]=X),H&&(_+=v*H),m.length>=h&&(m.shift()[KS]=0),m.push(L),T(P))},$=(L,P,H,X)=>{let G=jt,Y=wt,J=Ol,Q=t;jt=WT,wt=0,t=0,jt||(WT=jt=new NR(8192)),Ol=jt.length-10,B(L,P,X),WT=jt;let z=wt;if(jt=G,wt=Y,Ol=J,t=Q,z>1){let q=wt+z-1;q>Ol&&U(q);let ee=H+t;jt.copyWithin(ee+z,ee+1,wt),jt.set(WT.slice(0,z),ee),wt=q}else jt[H+t]=WT[0]},I=L=>{let P=lEe(L,jt,t,wt,i,U,(H,X,G)=>{if(G)return r=!0;wt=X;let Y=jt;return T(H),S(),Y!==jt?{position:wt,targetView:Ys,target:jt}:wt},this);if(P===0)return N(L);wt=P}}useBuffer(e){jt=e,jt.dataView||(jt.dataView=new DataView(jt.buffer,jt.byteOffset,jt.byteLength)),Ys=jt.dataView,wt=0}set position(e){wt=e}get position(){return wt}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}GL=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,kY];HL=[{pack(n,e,t){let r=n.getTime()/1e3;if((this.useTimestamp32||n.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:i,targetView:s,position:o}=e(6);i[o++]=214,i[o++]=255,s.setUint32(o,r)}else if(r>0&&r<4294967296){let{target:i,targetView:s,position:o}=e(10);i[o++]=215,i[o++]=255,s.setUint32(o,n.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(o+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),t(this.onInvalidDate());let{target:i,targetView:s,position:o}=e(3);i[o++]=212,i[o++]=255,i[o++]=255}else{let{target:i,targetView:s,position:o}=e(15);i[o++]=199,i[o++]=12,i[o++]=255,s.setUint32(o,n.getMilliseconds()*1e6),s.setBigInt64(o+4,BigInt(Math.floor(r)))}}},{pack(n,e,t){if(this.setAsEmptyObject)return e(0),t({});let r=Array.from(n),{target:i,position:s}=e(this.moreTypes?3:0);this.moreTypes&&(i[s++]=212,i[s++]=115,i[s++]=0),t(r)}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=101,r[i++]=0),t([n.name,n.message,n.cause])}},{pack(n,e,t){let{target:r,position:i}=e(this.moreTypes?3:0);this.moreTypes&&(r[i++]=212,r[i++]=120,r[i++]=0),t([n.source,n.flags])}},{pack(n,e){this.moreTypes?qN(n,16,e):YN(cx?io.from(n):new Uint8Array(n),e)}},{pack(n,e){let t=n.constructor;t!==BY&&this.moreTypes?qN(n,LY.indexOf(t.name),e):YN(n,e)}},{pack(n,e){this.moreTypes?qN(n,17,e):YN(cx?io.from(n):new Uint8Array(n),e)}},{pack(n,e){let{target:t,position:r}=e(1);t[r]=193}}];function qN(n,e,t,r){let i=n.byteLength;if(i+1<256){var{target:s,position:o}=t(4+i);s[o++]=199,s[o++]=i+1}else if(i+1<65536){var{target:s,position:o}=t(5+i);s[o++]=200,s[o++]=i+1>>8,s[o++]=i+1&255}else{var{target:s,position:o,targetView:a}=t(7+i);s[o++]=201,a.setUint32(o,i+1),o+=4}s[o++]=116,s[o++]=e,n.buffer||(n=new Uint8Array(n)),s.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o)}function YN(n,e){let t=n.byteLength;var r,i;if(t<256){var{target:r,position:i}=e(t+2);r[i++]=196,r[i++]=t}else if(t<65536){var{target:r,position:i}=e(t+3);r[i++]=197,r[i++]=t>>8,r[i++]=t&255}else{var{target:r,position:i,targetView:s}=e(t+5);r[i++]=198,s.setUint32(i,t),i+=4}r.set(n,i)}function Z9(n,e,t,r){let i=n.length;switch(i){case 1:e[t++]=212;break;case 2:e[t++]=213;break;case 4:e[t++]=214;break;case 8:e[t++]=215;break;case 16:e[t++]=216;break;default:i<256?(e[t++]=199,e[t++]=i):i<65536?(e[t++]=200,e[t++]=i>>8,e[t++]=i&255):(e[t++]=201,e[t++]=i>>24,e[t++]=i>>16&255,e[t++]=i>>8&255,e[t++]=i&255)}return e[t++]=r,e.set(n,t),t+=i,t}function dEe(n,e){let t,r=e.length*6,i=n.length-r;for(;t=e.pop();){let s=t.offset,o=t.id;n.copyWithin(s+r,s,i),r-=6;let a=s+r;n[a++]=214,n[a++]=105,n[a++]=o>>24,n[a++]=o>>16&255,n[a++]=o>>8&255,n[a++]=o&255,i=s}return n}function J9(n,e,t){if(Go.length>0){Ys.setUint32(Go.position+n,wt+t-Go.position-n),Go.stringsPosition=wt-n;let r=Go;Go=null,e(r[0]),e(r[1])}}function pEe(n,e){return n.isCompatible=t=>{let r=!t||(e.lastNamedStructuresLength||0)===t.length;return r||e._mergeStructures(t),r},n}let FY=new fEe({useRecords:!1});FY.pack;FY.pack;const mEe=512,gEe=1024,_Ee=2048;function vEe(n){return typeof n=="object"&&un(n.session)&&un(n.player)&&un(n.id)&&un(n.sender)&&un(n.target)}function yEe(n){n.emit("","sessionreset")}function _r(n,e,t,...r){return n.emit(e,"log",[`$red${t}$blue>>`,...r]),!1}function fs(n,e,...t){return n.emit(e,"log",t),!0}function WL(n,e,...t){return n.emit(e,"chat",t),!0}function jY(n,e,t){n.emit(e,"toast",t)}function bEe(n,e,t){n.emit(e,"bridge:streamstart",t)}function SEe(n,e){n.emit(e,"bridge:streamstop",void 0)}function EEe(n,e,t){n.emit(e,"bridge:chatstart",t)}function xEe(n,e){n.emit(e,"bridge:chatstop")}function TEe(n,e,t,r,i,s,o){n.emit(e,"bridge:fetch",[t,r,i,s,o])}function wEe(n,e,t){n.emit(e,"bridge:join",t)}function AEe(n,e,t){n.emit(e,"bridge:start",t)}function CEe(n,e,t){n.emit(e,"bridge:tab",t)}function REe(n,e){n.emit(e,"bridge:tabopen")}function kEe(n,e,t){n.emit(e,"bridge:showjoincode",t)}function MEe(n,e){n.emit(e,"gadgetserver:desync")}function IEe(n,e){n.emit(e,"gadgetserver:clearscroll")}function OEe(n,e,t,r){n.emit(e,"heavy:ttsinfo",[t,r])}function NEe(n,e,t,r,i,s){n.emit(e,"heavy:ttsrequest",[t,r,i,s])}function gm(n,e,t,r){n.emit(e,"register:input",[t,r])}function lx(n,e,t){n.emit(e,"register:copy",t)}function PEe(n,e){n.emit(e,"register:screenshot")}function Q9(n,e,t,r){n.emit(e,"register:downloadjsonfile",[t,r])}function DEe(n,e){n.emit(e,"register:share",void 0)}function LEe(n,e){n.emit(e,"register:nuke",void 0)}function UEe(n,e){n.emit(e,"synth:audioenabled",void 0)}function BEe(n,e){n.emit(e,"synth:restart",void 0)}function zY(n,e,t){n.emit(e,"synth:audiobuffer",t)}function FEe(n,e,t,r){n.emit(e,"synth:play",[t,r])}function jEe(n,e,t,r,i){n.emit(e,"synth:bgplay",[t,r,i])}function zEe(n,e,t){n.emit(e,"synth:bpm",t)}function $Ee(n,e,t){n.emit(e,"synth:playvolume",t)}function VEe(n,e,t){n.emit(e,"synth:bgplayvolume",t)}function HEe(n,e,t){n.emit(e,"synth:ttsvolume",t)}function GEe(n,e,t,r){n.emit(e,"synth:ttsengine",[t,r])}function WEe(n,e,t,r,i){n.emit(e,"synth:tts",[t,r,i])}function qEe(n,e,t){n.emit(e,"synth:ttsinfo",t)}function YEe(n,e,t,r,i){n.emit(e,"synth:ttsqueue",[t,r,i])}function KEe(n,e){n.emit(e,"synth:ttsclearqueue")}function KN(n,e,t,r,i){n.emit(e,"synth:voice",[t,r,i])}function $Y(n,e,t,r,i,s){n.emit(e,"synth:voicefx",[t,r,i,s])}function XEe(n,e,t){n.emit(e,"synth:record",t)}function ZEe(n,e){n.emit(e,"synth:flush")}function JEe(n,e,t,r){n.emit(e,"register:store",[t,r])}function QEe(n,e,t){n.emit(e,"register:inspector",t)}function ej(n,e,t){n.emit(e,"register:findany",t)}function Jb(n,e,t){n.emit(e,"register:terminal:open",t)}function d6(n,e,t){n.emit(e,"register:terminal:quickopen",t)}function Bw(n,e){n.emit(e,"register:terminal:close")}function VY(n,e,t){n.emit(e,"register:terminal:inclayout",t)}function p6(n,e){n.emit(e,"register:terminal:full")}function exe(n,e,t,r,i,s){n.emit(e,"register:editor:open",[t,r,i,s])}function txe(n,e){n.emit(e,"register:editor:close")}function nxe(n,e){n.emit(e,"vm:operator")}function rxe(n,e){n.emit(e,"vm:admin")}function ixe(n,e,t,r){n.emit(e,"vm:zztsearch",[t,r])}function sxe(n,e){n.emit(e,"vm:zztrandom")}function HY(n,e){n.emit(e,"vm:zsswords")}function oxe(n,e){n.emit(e,"vm:halt")}function axe(n,e,t){n.emit(e,"vm:topic",t)}function GY(n,e,t){n.emit(e,"vm:books",t)}function cxe(n,e){n.emit(e,"vm:search")}function lxe(n,e,t){n.emit(e,"vm:login",t)}function uxe(n,e){n.emit(e,"vm:local")}function WY(n,e,t){n.emit(e,"vm:logout",t)}function qY(n,e){n.emit(e,"vm:doot")}function YY(n,e,t,r){n.emit(e,"vm:input",[t,r])}function hxe(n,e){n.emit(e,"vm:agentstart")}function fxe(n,e,t){n.emit(e,"vm:agentstop",t)}function dxe(n,e){n.emit(e,"vm:agentlist")}function pxe(n,e,t,r){n.emit(e,"vm:agentprompt",[t,r])}function mxe(n,e,t){n.emit(e,"vm:makeitscroll",t)}function m6(n,e){n.emit(e,"vm:refscroll")}function gxe(n,e,t,r){n.emit(e,"vm:inspect",[t,r])}function _xe(n,e){n.emit(e,"vm:findany")}function KY(n,e){const[t,r]=e;return`${n}:${[t,r].filter(he).join(":")}`}function vxe(n,e,t,r){n.emit(e,"vm:codewatch",[t,r])}function yxe(n,e,t,r){n.emit(e,"vm:coderelease",[t,r])}function zm(n,e,t){n.emit(e,"vm:cli",t)}function g6(n,e){n.emit(e,"vm:clirepeatlast")}function bxe(n,e){n.emit(e,"vm:restart")}function Sxe(n,e){n.emit(e,"vm:flush")}function Exe(n,e,t){n.emit(e,"vm:fork",t)}function tj(n,e,t,...r){n.emit(e,"vm:publish",[t,...r])}function xxe(n,e){return{filename:n,cursor:0,lines:e.split(`
`)}}function Txe(n,e){return{filename:n,json:e}}function wxe(n,e){return{filename:n,cursor:0,bytes:e,dataview:new DataView(e.buffer)}}function Th(n,e,t,r,i,s){let o;switch(r){case"file":o=s;break;case"text":o=xxe(i,s);break;case"json":o=Txe(i,s);break;case"binary":o=wxe(i,s);break}setTimeout(()=>{n.emit(e,"vm:loader",[t,r,i,o])},1)}const XN=new Set,Fw={emit(n,e,t,r,i){Fw.invoke($xe(n,e,t,r,i))},invoke(n){XN.forEach(e=>e.handle(n))},connect(n){XN.add(n)},disconnect(n){XN.delete(n)}};var qT={},nj;function Axe(){return nj||(nj=1,(function(n){var e=qT&&qT.__spreadArray||function(l,u,h){if(h||arguments.length===2)for(var f=0,d=u.length,p;f<d;f++)(p||!(f in u))&&(p||(p=Array.prototype.slice.call(u,0,f)),p[f]=u[f]);return l.concat(p||Array.prototype.slice.call(u))};Object.defineProperty(n,"__esModule",{value:!0}),n.minLength=n.maxLength=n.poolSize=n.humanId=n.adverbs=n.verbs=n.nouns=n.adjectives=void 0,n.adjectives=["afraid","all","beige","better","big","blue","bold","brave","breezy","bright","brown","bumpy","busy","calm","chatty","chilly","chubby","clean","clear","clever","cold","common","cool","cozy","crisp","cuddly","curly","curvy","cute","cyan","dark","deep","dirty","dry","dull","eager","early","easy","eight","eighty","eleven","empty","every","fair","famous","fancy","fast","few","fiery","fifty","fine","five","flat","floppy","fluffy","forty","four","frank","free","fresh","fruity","full","funky","funny","fuzzy","gentle","giant","gold","good","goofy","great","green","grumpy","happy","heavy","hip","honest","hot","huge","humble","hungry","icy","itchy","jolly","khaki","kind","large","late","lazy","legal","lemon","light","little","long","loose","loud","lovely","lucky","major","many","metal","mighty","modern","moody","neat","new","nice","nine","ninety","odd","old","olive","open","orange","perky","petite","pink","plain","plenty","polite","pretty","proud","public","puny","purple","quick","quiet","rare","ready","real","red","rich","ripe","salty","seven","shaggy","shaky","sharp","shiny","short","shy","silent","silly","silver","six","sixty","slick","slimy","slow","small","smart","smooth","social","soft","solid","some","sour","sparkly","spicy","spotty","stale","strict","strong","sunny","sweet","swift","tall","tame","tangy","tasty","ten","tender","thick","thin","thirty","three","tidy","tiny","tired","tough","tricky","true","twelve","twenty","two","upset","vast","violet","wacky","warm","wet","whole","wicked","wide","wild","wise","witty","yellow","young","yummy"],n.nouns=["actors","ads","adults","aliens","animals","ants","apes","apples","areas","baboons","badgers","bags","balloons","bananas","banks","bars","baths","bats","beans","bears","beds","beers","bees","berries","bikes","birds","boats","bobcats","books","bottles","boxes","breads","brooms","buckets","bugs","buses","bushes","buttons","camels","cameras","candies","candles","canyons","carpets","carrots","cars","cases","cats","chairs","chefs","chicken","cities","clocks","cloths","clouds","clowns","clubs","coats","cobras","coins","colts","comics","cooks","corners","cougars","cows","crabs","crews","cups","cycles","dancers","days","deer","deserts","dingos","dodos","dogs","dolls","donkeys","donuts","doodles","doors","dots","dragons","drinks","dryers","ducks","eagles","ears","eels","eggs","emus","ends","experts","eyes","facts","falcons","fans","feet","files","flies","flowers","forks","foxes","friends","frogs","games","garlics","geckos","geese","ghosts","gifts","glasses","goats","grapes","groups","guests","hairs","hands","hats","heads","hoops","hornets","horses","hotels","hounds","houses","humans","icons","ideas","impalas","insects","islands","items","jars","jeans","jobs","jokes","keys","kids","kings","kiwis","knives","lamps","lands","laws","lemons","lies","lights","lilies","lines","lions","lizards","llamas","loops","mails","mammals","mangos","maps","masks","meals","melons","memes","meteors","mice","mirrors","moles","moments","monkeys","months","moons","moose","mugs","nails","needles","news","nights","numbers","olives","onions","oranges","otters","owls","pandas","pans","pants","papayas","papers","parents","parks","parrots","parts","paths","paws","peaches","pears","peas","pens","pets","phones","pianos","pigs","pillows","places","planes","planets","plants","plums","poems","poets","points","pots","pugs","pumas","queens","rabbits","radios","rats","ravens","readers","regions","results","rice","rings","rivers","rockets","rocks","rooms","roses","rules","sails","schools","seals","seas","sheep","shirts","shoes","showers","shrimps","sides","signs","singers","sites","sloths","snails","snakes","socks","spiders","spies","spoons","squids","stamps","stars","states","steaks","streets","suits","suns","swans","symbols","tables","taxes","taxis","teams","teeth","terms","things","ties","tigers","times","tips","tires","toes","tools","towns","toys","trains","trams","trees","turkeys","turtles","vans","views","walls","wasps","waves","ways","webs","weeks","windows","wings","wolves","wombats","words","worlds","worms","yaks","years","zebras","zoos"],n.verbs=["accept","act","add","admire","agree","allow","appear","argue","arrive","ask","attack","attend","bake","bathe","battle","beam","beg","begin","behave","bet","boil","bow","brake","brush","build","burn","buy","call","camp","care","carry","change","cheat","check","cheer","chew","clap","clean","cough","count","cover","crash","create","cross","cry","cut","dance","decide","deny","design","dig","divide","do","double","doubt","draw","dream","dress","drive","drop","drum","eat","end","enjoy","enter","exist","fail","fall","feel","fetch","film","find","fix","flash","float","flow","fly","fold","follow","fry","give","glow","go","grab","greet","grin","grow","guess","hammer","hang","happen","heal","hear","help","hide","hope","hug","hunt","invent","invite","itch","jam","jog","join","joke","judge","juggle","jump","kick","kiss","kneel","knock","know","laugh","lay","lead","learn","leave","lick","lie","like","listen","live","look","lose","love","make","march","marry","mate","matter","melt","mix","move","nail","notice","obey","occur","open","own","pay","peel","pick","play","poke","post","press","prove","pull","pump","punch","push","raise","read","refuse","relate","relax","remain","repair","repeat","reply","report","rescue","rest","retire","return","rhyme","ring","roll","rule","run","rush","say","scream","search","see","sell","send","serve","shake","share","shave","shine","shop","shout","show","sin","sing","sink","sip","sit","sleep","slide","smash","smell","smile","smoke","sneeze","sniff","sort","speak","spend","stand","stare","start","stay","stick","stop","strive","study","swim","switch","take","talk","tan","tap","taste","teach","tease","tell","thank","think","throw","tickle","tie","trade","train","travel","try","turn","type","unite","vanish","visit","wait","walk","warn","wash","watch","wave","wear","win","wink","wish","wonder","work","worry","write","yawn","yell"],n.adverbs=["bravely","brightly","busily","daily","freely","hungrily","joyously","knowingly","lazily","noisily","oddly","politely","quickly","quietly","rapidly","safely","sleepily","slowly","truly","yearly"];function t(l){return l[Math.floor(Math.random()*l.length)]}function r(l){return l.reduce(function(u,h){return u.length>h.length?u:h})}function i(l){return l.reduce(function(u,h){return u.length<h.length?u:h})}function s(l){l===void 0&&(l={}),typeof l=="string"&&(l={separator:l}),typeof l=="boolean"&&(l={capitalize:l});var u=l.separator,h=u===void 0?"":u,f=l.capitalize,d=f===void 0?!0:f,p=l.adjectiveCount,m=p===void 0?1:p,_=l.addAdverb,v=_===void 0?!1:_,S=e(e(e([],e([],Array(m),!0).map(function(b){return t(n.adjectives)}),!0),[t(n.nouns),t(n.verbs)],!1),v?[t(n.adverbs)]:[],!0);return d&&(S=S.map(function(b){return b.charAt(0).toUpperCase()+b.substr(1)})),S.join(h)}n.humanId=s;function o(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f;return n.adjectives.length*h*n.nouns.length*n.verbs.length*(d?n.adverbs.length:1)}n.poolSize=o;function a(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f,p=l.separator,m=p===void 0?"":p;return r(n.adjectives).length*h+h*m.length+r(n.nouns).length+m.length+r(n.verbs).length+(d?r(n.adverbs).length+m.length:0)}n.maxLength=a;function c(l){l===void 0&&(l={});var u=l.adjectiveCount,h=u===void 0?1:u,f=l.addAdverb,d=f===void 0?!1:f,p=l.separator,m=p===void 0?"":p;return i(n.adjectives).length*h+h*m.length+i(n.nouns).length+m.length+i(n.verbs).length+(d?i(n.adverbs).length+m.length:0)}n.minLength=c,n.default=s})(qT)),qT}var Cxe=Axe();const _6=wu(Cxe),Rxe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let kxe=n=>crypto.getRandomValues(new Uint8Array(n)),Mxe=(n,e,t)=>{let r=(2<<Math.log2(n.length-1))-1,i=-~(1.6*r*e/n.length);return(s=e)=>{let o="";for(;;){let a=t(i),c=i|0;for(;c--;)if(o+=n[a[c]&r]||"",o.length>=s)return o}}},XY=(n,e=21)=>Mxe(n,e|0,kxe),Ixe=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=Rxe[t[n]&63];return e};var ZN,rj;function ZY(){return rj||(rj=1,ZN="abcdefghijklmnopqrstuvwxyz"),ZN}var JN,ij;function JY(){return ij||(ij=1,JN="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),JN}var QN,sj;function QY(){return sj||(sj=1,QN="0123456789"),QN}var eP,oj;function Oxe(){return oj||(oj=1,eP="346789ABCDEFGHJKLMNPQRTUVWXYabcdefghijkmnpqrtwxyz"),eP}var tP,aj;function Nxe(){return aj||(aj=1,tP="6789BCDFGHJKLMNPQRTWbcdfghjkmnpqrtwz"),tP}var nP,cj;function Pxe(){if(cj)return nP;cj=1;const n=QY(),e=ZY(),t=JY();return nP=n+e+t,nP}var rP,lj;function Dxe(){return lj||(lj=1,rP={lowercase:ZY(),uppercase:JY(),numbers:QY(),nolookalikes:Oxe(),nolookalikesSafe:Nxe(),alphanumeric:Pxe()}),rP}var qL=Dxe();function Yo(){return`sid_${Ixe(12).replaceAll("-",".")}`}const Lxe=XY(qL.numbers,4),Uxe=XY(`${qL.numbers}${qL.lowercase}`,16);function Bxe(){return`pid_${Lxe()}_${Uxe()}`}function zl(n){return n?.startsWith("pid_")??!1}function v6(){return _6({capitalize:!1,adjectiveCount:1})}function Fxe(){return _6({addAdverb:!1,capitalize:!1,adjectiveCount:0})}const jxe=20,uj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function zxe(n){const e=a6(n),t=[];for(let r=0;r<jxe;++r)t.push(uj[Math.floor(e()*uj.length)]);return t.join("")}function $xe(n,e,t,r,i){return{session:n,player:e,id:Yo(),sender:t,target:r,data:i}}function Vv(n){const[e,...t]=n.split(":");return{target:e,path:t.join(":")}}function mg(n,e=[],t=M5,r=""){const i=Yo(),s=cr(n),o=e.map(cr);let a=r;const c={id(){return i},name(){return n},session(l){return he(l)?l.session===a?l.session:"":a},topics(){return e},emit(l,u,h){Fw.emit(a,l,i,u,h)},reply(l,u,h){c.emit(l.player,`${l.sender}:${u}`,h)},replynext(l,u,h){setTimeout(()=>c.emit(l.player,`${l.sender}:${u}`,h),64)},handle(l){const{target:u,path:h}=Vv(l.target),f=cr(u);!a&&f==="ready"&&(a=l.session),f==="sessionreset"&&(a=""),o.findIndex(d=>d==="all"||d===f)!==-1&&t(l),(i===u||f==="all"||s===f)&&t({...l,target:h})},disconnect(){Fw.disconnect(c)}};return Fw.connect(c),c}const qe=mg("SOFTWARE");function y6(n,e,t={}){if(he(n))try{const r={};for(let i=0;i<n.length;i+=2){let s=n[i],o=n[i+1];const a=e[s];he(a)&&(s=a);const c=t[s];he(c)&&(o=c(o)),r[s]=o}return r}catch(r){_r(qe,"","format",r.message)}}function Vxe(n,e){return n%e}function Hxe(n,e){return Math.floor(n/e)}function $M(n,e){return{x:Vxe(n,e),y:Hxe(n,e)}}function hj(n,e){const t=n.x-e.x,r=n.y-e.y;return Math.sqrt(t*t+r*r)}function od(n,e){return n.x+n.y*e}function Gxe(n,e,t,r,i,s){return n>=s&&n<=r&&e>=t&&e<=i}function fj(n,e,t,r){const i=[],s=Math.abs(t-n),o=Math.abs(r-e),a=n<t?1:-1,c=e<r?1:-1;let l=s-o;for(i.push({x:n,y:e});n!==t||e!==r;){const u=2*l;u>-o&&(l-=o,n+=a),u<s&&(l+=s,e+=c),i.push({x:n,y:e})}return i}function Dv(n){return he(n)&&he(n.x)&&he(n.y)}function Ho(n,e){switch(e){case yn.NORTH:--n.y;break;case yn.SOUTH:++n.y;break;case yn.WEST:--n.x;break;case yn.EAST:++n.x;break}return n}function Cb(n,e){return n<0?yn.WEST:n>0?yn.EAST:e<0?yn.NORTH:e>0?yn.SOUTH:yn.IDLE}function cp(n,e){return Cb(e.x-n.x,e.y-n.y)}const eK={idle:"IDLE",up:"NORTH",down:"SOUTH",left:"WEST",right:"EAST",by:"BY",at:"AT",flow:"FLOW",seek:"SEEK",rndns:"RNDNS",rndne:"RNDNE",rnd:"RND",cw:"CW",ccw:"CCW",opp:"OPP",rndp:"RNDP",away:"AWAY",toward:"TOWARD",find:"FIND",flee:"FLEE",to:"TO",i:"IDLE",u:"NORTH",north:"NORTH",n:"NORTH",d:"SOUTH",south:"SOUTH",s:"SOUTH",l:"WEST",west:"WEST",w:"WEST",r:"EAST",east:"EAST",e:"EAST",over:"OVER",under:"UNDER",ground:"GROUND",within:"WITHIN",awayby:"AWAYBY",elements:"ELEMENTS"};function _d(n){return sr(n)&&tK(n[0])}function tK(n){return he(yn[n])&&un(n)}function nK(n){const e=yn[n];return he(e)?e:yn.IDLE}function aC(n){if(un(n))return eK[cr(n)]}function Wxe(n){if(_d(n))return n;if(tK(n))return[n];const e=aC(n);if(he(e))return[e]}function dj(n){const e=fe.words[n],t=Wxe(e);return _d(t)?[t,n+1]:[void 0,n]}function rK(n){const e=[];let[t,r]=dj(n);for(;_d(t);){switch(e.push(...t),t[0]){case"AT":case"BY":case"AWAY":case"TOWARD":{const[a,c,l]=Pt(fe.words,r,[lt.NUMBER,lt.NUMBER]);e.push(a,c),r=l;break}case"FLEE":case"FIND":{const[a,c]=Pt(fe.words,r,[lt.KIND]);console.info("kind",a),r=c;break}case"TO":{const[a,c,l]=Pt(fe.words,r,[lt.DIR,lt.DIR]),u=fe.element?.x??0,h=fe.element?.y??0;a.destpt.x-=u,a.destpt.y-=h,c.destpt.x-=u,c.destpt.y-=h,e.push(u+a.destpt.x+c.destpt.x,h+a.destpt.y+c.destpt.y),r=l;break}case"WITHIN":case"AWAYBY":{const[a,c]=Pt(fe.words,r,[lt.NUMBER]);e.push(a),r=c;break}}const i=r;switch(t[0]){case"CW":case"CCW":case"OPP":case"RNDP":case"OVER":case"UNDER":case"WITHIN":case"AWAYBY":case"ELEMENTS":break;default:return[e,r]}const[s,o]=dj(i);t=s,r=o}return e.length?[e,r]:[void 0,n]}function Pb(n,e){if(!he(n)||!dc(e))return;const{color:t,bg:r}=kE(e);he(t)&&(n.color=t),he(r)&&(n.bg=r)}function As(n){return n?.category===qb.ISOBJECT}function pj(){return{id:Yo()}}const cC=ax(32,126).map(n=>String.fromCharCode(n));function mi(n){return Cu({...n,name:`token_${n.name}`})}function Ht(n){return mi({name:n,pattern:new RegExp(n.toLowerCase(),"i"),longer_alt:va})}const cA=mi({name:"newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),iK=mi({name:"whitespace",pattern:/ +/,group:zc.SKIPPED}),sK=mi({name:"whitespace",pattern:/\s+/,line_breaks:!0,group:zc.SKIPPED}),Qb=mi({name:"stat",pattern:/@.*/,start_chars_hint:["@"]}),U0=mi({name:"command",pattern:/#/,start_chars_hint:["#"]});let oK=!1;const qxe="@#/?':!",Yxe=/^(by|at|away|toward|find|flee|to|cw|ccw|opp|rndp)/i;function Kxe(n,e){if(!oK)return null;let t=e;const r=n[t-1]??"";if(t>0&&r!==" "&&r!==`
`)return null;if(n[t]===" "){for(;n[t]===" ";)t++;if(qxe.includes(n[t]))return null}for(;t>0&&`$"@#':!/?
`.includes(n[t])===!1;)t--;switch(n[t]){case"?":case"/":{const o=n.substring(t+1,e+1).toLowerCase();if(o.indexOf(" ")<1||Yxe.test(o))return null;break}case"#":return null;case'"':{for(t--;t>0&&n[t]===" ";)t--;if(!(t<1||n[t]===`
`))return null;break}case"@":case"'":case":":case"!":return null}let i=e;for(n[i]==='"'&&++i;i<n.length&&n[i]!==`
`;)i++;const s=n.substring(e,i);return s.trim().length===0||s.toLowerCase()==="do"?null:[s]}const lA=mi({name:"text",pattern:Kxe,line_breaks:!1,start_chars_hint:cC}),uA=mi({name:"comment",pattern:/'.*/,start_chars_hint:["'"]}),ux=mi({name:"label",pattern:/:[^;:\n]*/,start_chars_hint:[":"]}),hA=mi({name:"hyperlink",pattern:/![^;\n]*/,start_chars_hint:["!"]}),b6=mi({name:"hyperlinktext",pattern:/;[^;\n]*/,start_chars_hint:[";"]}),va=mi({name:"stringliteral",pattern:/[^-0-9"!:;@#/?()\s]+[^-"!:;@#/?()\s]*/,start_chars_hint:cC}),jw=mi({name:"stringliteraldouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),AE=mi({name:"numberliteral",pattern:/-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?/}),aK=Ht("isterrain"),cK=Ht("isobject"),lK=Ht("issolid"),uK=Ht("iswalk"),hK=Ht("isswim"),fK=Ht("isbullet"),dK=Ht("isghost"),pK=Ht("iswalking"),mK=Ht("iswalkable"),gK=Ht("isswimming"),_K=Ht("isswimmable"),vK=Ht("black"),yK=Ht("dkblue"),bK=Ht("dkgreen"),SK=Ht("dkcyan"),EK=Ht("dkred"),xK=Ht("dkpurple"),TK=Ht("dkyellow"),wK=Ht("ltgray"),AK=Ht("dkgray"),CK=Ht("blue"),RK=Ht("green"),kK=Ht("cyan"),MK=Ht("red"),IK=Ht("purple"),OK=Ht("yellow"),NK=Ht("white"),PK=Ht("brown"),DK=Ht("dkwhite"),LK=Ht("ltgrey"),UK=Ht("gray"),BK=Ht("grey"),FK=Ht("dkgrey"),jK=Ht("ltblack"),zK=Ht("onblack"),$K=Ht("ondkblue"),VK=Ht("ondkgreen"),HK=Ht("ondkcyan"),GK=Ht("ondkred"),WK=Ht("ondkpurple"),qK=Ht("ondkyellow"),YK=Ht("onltgray"),KK=Ht("ondkgray"),XK=Ht("onblue"),ZK=Ht("ongreen"),JK=Ht("oncyan"),QK=Ht("onred"),eX=Ht("onpurple"),tX=Ht("onyellow"),nX=Ht("onwhite"),rX=Ht("onbrown"),iX=Ht("ondkwhite"),sX=Ht("onltgrey"),oX=Ht("ongray"),aX=Ht("ongrey"),cX=Ht("ondkgrey"),lX=Ht("onltblack"),uX=Ht("onclear"),hX=Ht("blblack"),fX=Ht("bldkblue"),dX=Ht("bldkgreen"),pX=Ht("bldkcyan"),mX=Ht("bldkred"),gX=Ht("bldkpurple"),_X=Ht("bldkyellow"),vX=Ht("blltgray"),yX=Ht("bldkgray"),bX=Ht("blblue"),SX=Ht("blgreen"),EX=Ht("blcyan"),xX=Ht("blred"),TX=Ht("blpurple"),wX=Ht("blyellow"),AX=Ht("blwhite"),CX=Ht("blbrown"),RX=Ht("bldkwhite"),kX=Ht("blltgrey"),MX=Ht("blgray"),IX=Ht("blgrey"),OX=Ht("bldkgrey"),NX=Ht("blltblack"),PX=Ht("idle"),DX=Ht("up"),LX=Ht("down"),UX=Ht("left"),BX=Ht("right"),FX=Ht("by"),jX=Ht("at"),zX=Ht("flow"),$X=Ht("seek"),VX=Ht("rndns"),HX=Ht("rndne"),GX=Ht("rnd"),WX=Ht("cw"),qX=Ht("ccw"),YX=Ht("opp"),KX=Ht("rndp"),XX=Ht("away"),ZX=Ht("toward"),JX=Ht("find"),QX=Ht("flee"),eZ=Ht("to"),tZ=Ht("i"),nZ=Ht("u"),rZ=Ht("north"),iZ=Ht("n"),sZ=Ht("d"),oZ=Ht("south"),aZ=Ht("s"),cZ=Ht("l"),lZ=Ht("west"),uZ=Ht("w"),hZ=Ht("r"),fZ=Ht("east"),dZ=Ht("e"),pZ=Ht("over"),mZ=Ht("under"),gZ=Ht("ground"),_Z=Ht("within"),vZ=Ht("awayby"),yZ=Ht("elements"),bZ=mi({name:"expr_aligned",pattern:/aligned|alligned/i,longer_alt:va}),SZ=Ht("contact"),EZ=Ht("blocked"),xZ=Ht("any"),TZ=Ht("countof"),wZ=Ht("abs"),AZ=Ht("intceil"),CZ=Ht("intfloor"),RZ=Ht("intround"),kZ=Ht("clamp"),MZ=Ht("min"),IZ=Ht("max"),OZ=Ht("pick"),NZ=Ht("pickwith"),PZ=Ht("random"),DZ=Ht("randomwith"),LZ=Ht("run"),UZ=Ht("runwith"),BZ=mi({name:"stop",pattern:/\|/,start_chars_hint:["|"]}),S6=mi({name:"iseq",pattern:/=|is|eq|equal/i,longer_alt:va}),E6=mi({name:"isnoteq",pattern:/!=|not ?eq|not ?equal/i,longer_alt:va}),x6=mi({name:"islessthan",pattern:/<|below/i,longer_alt:va}),T6=mi({name:"isgreaterthan",pattern:/>|above/i,longer_alt:va}),w6=mi({name:"islessthanorequal",pattern:/<=|below ?or ?eq|below ?or ?equal/i,longer_alt:va}),A6=mi({name:"isgreaterthanorequal",pattern:/>=|above ?or ?eq|above ?or ?equal/i,longer_alt:va}),VM=mi({name:"or",pattern:/or/i,longer_alt:va}),HM=mi({name:"not",pattern:/not/i,longer_alt:va}),GM=mi({name:"and",pattern:/and/i,longer_alt:va}),WM=mi({name:"plus",pattern:/\+/}),qM=mi({name:"minus",pattern:/-/}),C6=mi({name:"power",pattern:/\*\*/}),R6=mi({name:"multiply",pattern:/\*/}),Db=mi({name:"divide",pattern:/\//}),k6=mi({name:"moddivide",pattern:/%/}),M6=mi({name:"floordivide",pattern:/%%/}),fA=mi({name:"query",pattern:/\?/}),I6=mi({name:"lparen",pattern:/\(/,push_mode:"ignore_newlines"}),O6=mi({name:"rparen",pattern:/\)/,pop_mode:!0}),N6=mi({name:"command_play",pattern:/(play|bgplay|bgplayon64n|bgplayon32n|bgplayon16n|bgplayon8n|bgplayon4n|bgplayon2n|bgplayon1n) .*/i,start_chars_hint:cC,longer_alt:va}),FZ=mi({name:"command_toast",pattern:/toast .*/i,start_chars_hint:cC,longer_alt:va}),jZ=mi({name:"command_ticker",pattern:/ticker .*/i,start_chars_hint:cC,longer_alt:va}),Lb=mi({name:"if",pattern:/if|try|take|give|duplicate/i,longer_alt:va}),Ub=mi({name:"do",pattern:new RegExp("(?<!(zap |send |restore ))(?<=\\s)do","i"),start_chars_hint:["d"],longer_alt:va}),YM=Ht("done"),Bb=Ht("else"),P6=Ht("while"),D6=Ht("repeat"),L6=Ht("waitfor"),U6=mi({name:"foreach",pattern:/foreach|for/i,longer_alt:va}),B6=Ht("break"),F6=Ht("continue");function zZ(n,e){return[...n,LX,...e,AE,aK,cK,lK,mK,pK,uK,_K,gK,hK,fK,dK,vK,yK,bK,SK,EK,xK,TK,wK,AK,CK,RK,kK,MK,IK,OK,NK,PK,DK,LK,UK,BK,FK,jK,zK,$K,VK,HK,GK,WK,qK,YK,KK,XK,ZK,JK,QK,eX,tX,nX,rX,iX,sX,oX,aX,cX,lX,uX,hX,fX,dX,pX,mX,gX,_X,vX,yX,bX,SX,EX,xX,TX,wX,AX,CX,RX,kX,MX,IX,OX,NX,PX,DX,UX,BX,FX,jX,zX,$X,KX,VX,HX,GX,WX,qX,YX,_Z,vZ,yZ,XX,ZX,JX,QX,eZ,rZ,oZ,lZ,fZ,pZ,mZ,gZ,bZ,SZ,EZ,xZ,TZ,wZ,AZ,CZ,RZ,kZ,MZ,IZ,NZ,OZ,DZ,PZ,UZ,LZ,BZ,S6,E6,w6,x6,A6,T6,VM,HM,GM,WM,qM,C6,R6,Db,M6,k6,fA,I6,O6,tZ,nZ,iZ,sZ,aZ,cZ,uZ,hZ,dZ,jw,va]}const $Z=zZ([lA,Qb,N6,FZ,jZ,U0,uA,ux,hA,b6,cA,iK],[B6,F6,YM,Ub,Bb,U6,Lb,D6,L6,P6]),Xxe=new zc({defaultMode:"use_newlines",modes:{use_newlines:$Z,ignore_newlines:zZ([sK],[])}},{skipValidations:!Jm,ensureOptimizations:Jm,positionTracking:"full"});function VZ(n){oK=!0;const e=Xxe.tokenize(n||` 
`),[t]=(sr(e.tokens)?e.tokens:[]).slice(-1);return t&&t.tokenType.name!=="Newline"&&e.tokens.push(sC(cA,`
`,t.startOffset,t.endOffset??NaN,t.startLine??NaN,t.endLine??NaN,t.startColumn??NaN,t.endColumn??NaN)),e}function ro(n){return`${n??""}`}function Rb(n,e){const t=parseFloat(ro(n));return isNaN(t)?e:t}function mp(n,e){return typeof n==typeof e?n:e}function YL(n,e,t=!0){if(t){const[r,...i]=e;switch(cr(r??"")){default:return{type:Vn.OBJECT,values:e};case"loader":return{type:Vn.LOADER,values:i};case"board":return{type:Vn.BOARD,values:i};case"object":return{type:Vn.OBJECT,values:i};case"terrain":return{type:Vn.TERRAIN,values:i};case"charset":return{type:Vn.CHARSET,values:i};case"palette":return{type:Vn.PALETTE,values:i}}}else{const[r,i,...s]=e,o=cr(i??""),a=[r,n,...s];switch(o){default:return{type:Vn.CONST,values:e};case"rn":case"range":return{type:Vn.RANGE,values:a};case"sl":case"select":return{type:Vn.SELECT,values:a};case"nm":case"number":return{type:Vn.NUMBER,values:a};case"tx":case"text":return{type:Vn.TEXT,values:a};case"hk":case"hotkey":return{type:Vn.HOTKEY,values:a};case"copyit":return{type:Vn.COPYIT,values:a};case"openit":return{type:Vn.OPENIT,values:a};case"viewit":return{type:Vn.VIEWIT,values:a};case"runit":return{type:Vn.RUNIT,values:a};case"zssedit":return{type:Vn.ZSSEDIT,values:a};case"charedit":return{type:Vn.CHAREDIT,values:a};case"coloredit":return{type:Vn.COLOREDIT,values:a}}}}function xv(n){switch(n){case Vn.LOADER:return"loader";case Vn.BOARD:return"board";case Vn.OBJECT:return"object";case Vn.TERRAIN:return"terrain";case Vn.CHARSET:return"charset";case Vn.PALETTE:return"palette";case Vn.CONST:return"const";case Vn.RANGE:return"range";case Vn.SELECT:return"select";case Vn.NUMBER:return"number";case Vn.TEXT:return"text";case Vn.HOTKEY:return"hotkey";case Vn.COPYIT:return"copyit";case Vn.OPENIT:return"openit";case Vn.VIEWIT:return"viewit";case Vn.RUNIT:return"runit";case Vn.ZSSEDIT:return"zssedit";case Vn.CHAREDIT:return"charedit";case Vn.COLOREDIT:return"coloredit"}}function KL(n,e){const t=Object.keys(n);for(let r=0;r<t.length;++r){const i=t[r],s=n[i];if(sr(s)){const[o,...a]=s;switch(o){case"text":he(e[i])||(e[i]="");break;case"range":he(e[i])||(e[i]=4);break;case"number":he(e[i])||(e[i]=0);break;case"select":if(!he(e[i])){const[,c]=a;e[i]=c}break}continue}switch(i){case"name":case"char":case"light":case"group":case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"cycle":case"stepx":case"stepy":case"shootx":case"shooty":case"displaychar":e[i]=s;break;case"color":case"bg":case"lightdir":case"displaycolor":case"displaybg":e[i]=HZ(s)??s;break;case"isitem":e.item=1;break;case"notitem":e.item=0;break;case"ispushable":e.pushable=s===""?1:s;break;case"notpushable":e.pushable=0;break;case"iswalk":case"iswalking":case"iswalkable":e.collision=Fn.ISWALK;break;case"isswim":case"isswimming":case"isswimable":e.collision=Fn.ISSWIM;break;case"issolid":e.collision=Fn.ISSOLID;break;case"isbullet":e.collision=Fn.ISBULLET;break;case"isghost":e.collision=Fn.ISGHOST;break;case"isbreakable":e.breakable=1;break;case"notbreakable":e.breakable=0;break}}}function dA(n){if(he(n))switch(Qm(n)){default:return;case Jr.ERROR:return n.code??"";case Jr.LOADER:return n.code??"";case Jr.BOARD:{he(n.board)||(n.board=RU()),n.board.id=n.id,n.board.name=cc(n);const e=YT(n),t=Object.keys(e);for(let r=0;r<t.length;++r){const i=t[r],s=e[i];switch(i){case"isdark":n.board.isdark=1;break;case"notdark":n.board.isdark=0;break;case"restartonzap":n.board.restartonzap=1;break;case"norestartonzap":n.board.restartonzap=0;break;case"startx":case"starty":case"facing":case"timelimit":case"maxplayershots":rn(s)&&(n.board[i]=s);break;case"over":case"under":case"camera":case"graphics":case"charset":case"palette":case"exitnorth":case"exitsouth":case"exitwest":case"exiteast":un(s)&&(cr(s)==="empty"?n.board[i]=void 0:n.board[i]=s);break;case"b1":case"b2":case"b3":case"b4":case"b5":case"b6":case"b7":case"b8":case"b9":case"b10":he(s)&&(n.board[i]=HZ(s)??s);break}}return n.board}case Jr.OBJECT:return he(n.object)||(n.object=pj()),n.object.id=n.id,n.object.code=n.code,n.object.name=cc(n),n.object.category=qb.ISOBJECT,KL(YT(n),n.object),n.object;case Jr.TERRAIN:return he(n.terrain)||(n.terrain=pj()),n.terrain.id=n.id,n.terrain.name=cc(n),n.terrain.category=qb.ISTERRAIN,KL(YT(n),n.terrain),n.terrain;case Jr.PALETTE:{if(he(n.palette)||(n.palette=_1(b1)),he(n.palette?.bits)){const e=YT(n),t=Zm(e);for(let r=0;r<t.length;++r){const i=t[r].toLowerCase(),s=e[i];if(i.startsWith("color")&&un(s)){const o=parseFloat(i.replace("color",""));if(o>=0&&o<=15){PR.set(s);const a=o*nA,c=PR.r*63,l=PR.g*63,u=PR.b*63;n.palette.bits[a+0]=Ri(c,0,63),n.palette.bits[a+1]=Ri(l,0,63),n.palette.bits[a+2]=Ri(u,0,63)}}}}return n.palette}case Jr.CHARSET:{if(he(n.charset)||(n.charset=v1(y1)),he(n.charset?.bits)){const e=YT(n),t=Zm(e);for(let r=0;r<t.length;++r){const i=t[r].toLowerCase(),s=e[i];if(i.startsWith("char")&&un(s)){const o=parseFloat(i.replace("char",""));if(o>=0&&o<=255){const c=[];for(let l=0;l<112;++l)switch(s[l]){case"-":case void 0:c.push(0);break;default:c.push(128);break}ume(Uint8Array.from(c),n.charset,o)}}}}return n.charset}}}function cc(n){return lC(n).name??""}function Zxe(n,e){return lC(n)[e]}const PR=new Ti;function HZ(n){if(!un(n))return;const e=xx(n);if(he(e)&&he(Ft[e]))return Ft[e];const t=cr(n),r=yn[t];if(he(r))return r}function YT(n){const e={...lC(n)};return Object.keys(e).forEach(t=>{switch(t){case"type":case"name":delete e[t];break}}),e}function lC(n){return he(n)?(he(n.stats?.type)||(n.stats=GZ(n.code),he(n.stats.type)||(n.stats.type=Jr.OBJECT)),n.stats):{}}function GZ(n){const e=VZ(n),t={};let r=!0;for(let i=0;i<e.tokens.length;++i){const s=e.tokens[i];if(s.tokenType===Qb){const o=s.image.slice(1),[a,c]=o.split(";").map(f=>f.trim()),l=a.split(" "),u=YL(un(c)?c:"",l,r),h=u.values.join(" ");switch(r=!1,u.type){case Vn.LOADER:t.type=Jr.LOADER,t.name=h;break;case Vn.BOARD:t.type=Jr.BOARD,t.name=h;break;case Vn.OBJECT:t.type=Jr.OBJECT,t.name=h||"object";break;case Vn.TERRAIN:t.type=Jr.TERRAIN,t.name=h;break;case Vn.CHARSET:t.type=Jr.CHARSET,t.name=h;break;case Vn.PALETTE:t.type=Jr.PALETTE,t.name=h;break;case Vn.CONST:{const[f,...d]=u.values;if(un(f)){const p=cr(f),m=d.join(" ");if(un(m)){const _=parseFloat(m);rn(_)?t[p]=_:t[p]=`${ro(t[p])}${m}`}else t[p]=1}break}case Vn.RANGE:case Vn.SELECT:case Vn.NUMBER:case Vn.TEXT:case Vn.HOTKEY:case Vn.ZSSEDIT:case Vn.CHAREDIT:case Vn.COLOREDIT:{const[f,...d]=u.values;if(un(f)){const p=cr(f);t[p]=[xv(u.type),...d]}break}}}}return t}function Qm(n){return lC(n).type??Jr.ERROR}function Jy(n){return WZ(Qm(n))}function WZ(n){switch(n){default:case Jr.ERROR:return"error";case Jr.LOADER:return xv(Vn.LOADER);case Jr.BOARD:return xv(Vn.BOARD);case Jr.OBJECT:return xv(Vn.OBJECT);case Jr.TERRAIN:return xv(Vn.TERRAIN);case Jr.CHARSET:return xv(Vn.CHARSET);case Jr.PALETTE:return xv(Vn.PALETTE)}}function Jxe(n,e){return{id:Yo(),code:n,...e}}function qZ(n,e){const t=pA(n,e);if(he(n)&&he(t)){const r=cr(e);return n.pages=n.pages.filter(i=>i.id!==e&&r!==cc(i)),YZ(n),t}}function Qxe(n,e){n&&delete n.flags[e]}function xu(n,e=1,t=Ft.WHITE,r=Ft.BLACK){const i=n?.kinddata;return{name:cr(n?.name??i?.name),char:n?.displaychar??i?.displaychar??n?.char??i?.char??e,color:n?.displaycolor??i?.displaycolor??n?.color??i?.color??t,bg:n?.displaybg??i?.displaybg??n?.bg??i?.bg??r,light:n?.light??i?.light??0}}function eTe(n,e,t){let r=tTe(n,e,t);if(!he(r)){const i=WZ(e);return r=Jxe(i==="object"?`@${t||"object"}
`:`@${i} ${t}
`,{}),rTe(n,r),[r,!0]}return[r,!1]}function pA(n,e){if(!he(n))return;const t=cr(e);return n.pages.find(i=>i.id===e||t===cc(i))}function XL(n,e,t){if(!he(n))return[];const r=cr(t);return n.pages.filter(s=>Qm(s)===e).filter(s=>{const o=lC(s),a=cr(cc(s));return s.id===t||r===a||he(o[t])})}function tTe(n,e,t){if(!he(n))return;const r=cr(t);return n.pages.find(s=>Qm(s)===e&&(s.id===t||r===cc(s)))}function KM(n,e,t){return j6(n,e)?.[t]}function j6(n,e){return n?(n.flags[e]=n.flags[e]??{},n.flags[e]):{}}function KT(n){return he(n)?Ks(n.pages).sort((t,r)=>{const i=Qm(t),s=Qm(r);return i===s?cc(t).localeCompare(cc(r)):s-i}):[]}function nTe(n){he(n)&&(n.name=v6())}function YZ(n){he(n)&&(n.token=`${Fxe()}${mu(1111,9999)}`)}function rTe(n,e){if(!he(n)||!he(e))return!1;const t=pA(n,e.id);return he(t)?!1:(n.pages.push(e),YZ(n),!0)}function ZL(n,e,t,r){const i=j6(n,e);return i&&(i[t]=r),r}function KZ(n){return{id:Yo(),name:v6(),timestamp:0,activelist:[],pages:n,flags:{}}}const iTe=80,uC=1e3/iTe,sTe=3;function mh(n){return new Promise(e=>setTimeout(e,n))}const Mp={session:Yo(),operator:"",software:{main:"",temp:""},books:new Map};function $m(){return Mp.operator}function Mm(){return[...Mp.books.values()]}function oTe(){const[n]=Mp.books.values();return n}function Mv(n){const e=cr(n);return Mp.books.get(n)??Mm().find(t=>t.name===e)}function XZ(n,e){he(Mv(e))&&(Mp.software[n]=e)}function Um(n){return Mv(Mp.software[n])}function aTe(n){const e=KZ([]);return un(n)&&(e.name=n),ZZ(e),fs(qe,Mp.operator,`created [book] ${e.name}`),e}function cTe(n){let e=Mv(n);return he(e)||(e=KZ([]),e.name=n),ZZ(e),fs(qe,Mp.operator,`created [book] ${e.name}`),e}function Iv(n,e){let t=he(e)?cTe(e):Um(n);return he(t)||(he(t)||(t=oTe()),he(t)||(t=aTe(e)),he(t)&&fs(qe,Mp.operator,`opened [book] ${t.name} for ${n}`)),XZ(n,t.id),t}function lTe(n,e,t){return eTe(Iv(n),t,e)}function vu(n,e){const t=Um(ac.MAIN),r=td(XL(t,n,e));if(he(r))return r;const i=Mm();for(let s=0;s<i.length;++s){const o=i[s];if(o.id!==t?.id){const a=td(XL(o,n,e));if(he(a))return a}}}function Sp(n){if(he(n?.kinddata))return n.kinddata;if(!un(n?.kind)||!n.kind)return;const e=vu(Jr.OBJECT,n.kind);if(he(e))return n.kinddata=dA(e),n.kinddata;const t=vu(Jr.TERRAIN,n.kind);if(he(t))return n.kinddata=dA(t),n.kinddata}function ri(n,e){const t=n?.kinddata,r=t?.id??"",i=n?.[e];if(he(i))return i;const s=t?.[e];if(he(s))return s;const o=vu(Jr.OBJECT,r)??vu(Jr.TERRAIN,r),a=Zxe(o,e);if(he(a))return a;switch(e){case"group":return"";case"cycle":return sTe;case"p1":case"p2":case"p3":case"p4":case"p5":case"p6":case"p7":case"p8":case"p9":case"p10":case"item":case"pushable":case"breakable":return 0;case"collision":return Fn.ISWALK;default:return}}function JL(n,e){const t={x:n?.x??-1,y:n?.y??-1},r={x:e?.x??-1,y:e?.y??-1},i=cp(t,r),s=ri(e,"pushable");return rn(s)?s!==0:un(s)?s.trim().split(" ").map(o=>nK(aC(o))).some(o=>o===i):!1}function hd(n,e,t,r){if(!he(n)||!he(e))return;const[i,s]=e,o=vu(Jr.OBJECT,i);if(he(o)){const c=pee(n,t,i,r);if(he(c))return Pb(c,s),Sp(c),JZ(n,c),QL(n,c),c}const a=vu(Jr.TERRAIN,i);if(he(a)){const c=VLe(n,t,i);if(he(c)){Pb(c,s),Sp(c);const l=od(t,bn);return QL(n,c,l),c}}}function uTe(n,e,t){if(!he(n)||!he(e))return;const[r,i]=e,s=vu(Jr.OBJECT,r);if(he(s)){const o=pee(n,t,r);return Pb(o,i),o}}function Cs(n){const e=vu(Jr.BOARD,n);return dA(e)}function G0(n){const e=Iv(ac.MAIN);return j6(e,n)}function hTe(n){const e=Iv(ac.MAIN);return Qxe(e,n)}function ZZ(n){return Mp.books.set(n.id,n),n.id}function fTe(n){const e=Mv(n);e&&Mp.books.delete(e.id)}function hc(n){if(!he(n))return;for(let t=0;t<n.terrain.length;++t)Sp(n.terrain[t]);const e=Object.keys(n.objects);for(let t=0;t<e.length;++t){const r=e[t];Sp(n.objects[r])}dTe(n)}function QL(n,e,t){if(!he(n)||!he(n.named)||!he(e))return;const r=cr(e.name??e.kinddata?.name??"");n.named[r]||(n.named[r]=new Set),n.named[r].add(e?.id??t??"")}function JZ(n,e){if(!(!he(n)||!he(n.lookup)||!he(e?.id))&&!he(e.removed)&&ri(e,"collision")!==Fn.ISGHOST){const t=e.x??0,r=e.y??0;n.lookup[t+r*bn]=e.id}}function z6(n,e){if(he(n)&&he(e?.id)){if(he(n.lookup)&&he(e.x)&&he(e.y)){const r=e.x+e.y*bn;n.lookup[r]===e.id&&(n.lookup[r]=void 0)}const t=xu(e);he(n.named?.[t.name])&&he(e.id)&&n.named[t.name].delete(e.id)}}function dTe(n){he(n)&&(delete n.named,delete n.lookup,pTe(n))}function pTe(n){if(!he(n)||he(n.lookup)&&he(n.named))return;const e=new Array(bn*wr).fill(void 0),t={},r=Object.values(n.objects);for(let o=0;o<r.length;++o){const a=r[o];if(he(a.x)&&he(a.y)&&he(a.id)&&!he(a.removed)){a.category=qb.ISOBJECT,ri(a,"collision")!==Fn.ISGHOST&&(e[a.x+a.y*bn]=a.id),un(a.code)&&!he(a.name)&&KL(GZ(a.code),a);const c=xu(a);t[c.name]||(t[c.name]=new Set),t[c.name].add(a.id)}}let i=0,s=0;for(let o=0;o<n.terrain.length;++o){const a=n.terrain[o];if(he(a)){a.x=i,a.y=s,a.category=qb.ISTERRAIN;const c=xu(Sp(a));t[c.name]||(t[c.name]=new Set),t[c.name].add(o)}++i,i>=bn&&(i=0,++s)}n.lookup=e,n.named=t}function mTe(n,e){if(he(n)&&he(e?.x)&&he(e.y)){const t=xu(e),r=RA(n,e);he(n.named?.[t.name])&&n.named[t.name].delete(r)}}var jk={exports:{}},zk={exports:{}},gTe=zk.exports,mj;function _Te(){return mj||(mj=1,(function(n,e){(function(t,r){n.exports=r()})(gTe,function(){function t(m){return!isNaN(parseFloat(m))&&isFinite(m)}function r(m){return m.charAt(0).toUpperCase()+m.substring(1)}function i(m){return function(){return this[m]}}var s=["isConstructor","isEval","isNative","isToplevel"],o=["columnNumber","lineNumber"],a=["fileName","functionName","source"],c=["args"],l=["evalOrigin"],u=s.concat(o,a,c,l);function h(m){if(m)for(var _=0;_<u.length;_++)m[u[_]]!==void 0&&this["set"+r(u[_])](m[u[_]])}h.prototype={getArgs:function(){return this.args},setArgs:function(m){if(Object.prototype.toString.call(m)!=="[object Array]")throw new TypeError("Args must be an Array");this.args=m},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(m){if(m instanceof h)this.evalOrigin=m;else if(m instanceof Object)this.evalOrigin=new h(m);else throw new TypeError("Eval Origin must be an Object or StackFrame")},toString:function(){var m=this.getFileName()||"",_=this.getLineNumber()||"",v=this.getColumnNumber()||"",S=this.getFunctionName()||"";return this.getIsEval()?m?"[eval] ("+m+":"+_+":"+v+")":"[eval]:"+_+":"+v:S?S+" ("+m+":"+_+":"+v+")":m+":"+_+":"+v}},h.fromString=function(_){var v=_.indexOf("("),S=_.lastIndexOf(")"),b=_.substring(0,v),T=_.substring(v+1,S).split(","),w=_.substring(S+1);if(w.indexOf("@")===0)var R=/@(.+?)(?::(\d+))?(?::(\d+))?$/.exec(w,""),C=R[1],N=R[2],U=R[3];return new h({functionName:b,args:T||void 0,fileName:C,lineNumber:N||void 0,columnNumber:U||void 0})};for(var f=0;f<s.length;f++)h.prototype["get"+r(s[f])]=i(s[f]),h.prototype["set"+r(s[f])]=(function(m){return function(_){this[m]=!!_}})(s[f]);for(var d=0;d<o.length;d++)h.prototype["get"+r(o[d])]=i(o[d]),h.prototype["set"+r(o[d])]=(function(m){return function(_){if(!t(_))throw new TypeError(m+" must be a Number");this[m]=Number(_)}})(o[d]);for(var p=0;p<a.length;p++)h.prototype["get"+r(a[p])]=i(a[p]),h.prototype["set"+r(a[p])]=(function(m){return function(_){this[m]=String(_)}})(a[p]);return h})})(zk)),zk.exports}var vTe=jk.exports,gj;function yTe(){return gj||(gj=1,(function(n,e){(function(t,r){n.exports=r(_Te())})(vTe,function(r){var i=/(^|@)\S+:\d+/,s=/^\s*at .*(\S+:\d+|\(native\))/m,o=/^(eval@)?(\[native code])?$/;return{parse:function(c){if(typeof c.stacktrace<"u"||typeof c["opera#sourceloc"]<"u")return this.parseOpera(c);if(c.stack&&c.stack.match(s))return this.parseV8OrIE(c);if(c.stack)return this.parseFFOrSafari(c);throw new Error("Cannot parse given Error object")},extractLocation:function(c){if(c.indexOf(":")===-1)return[c];var l=/(.+?)(?::(\d+))?(?::(\d+))?$/,u=l.exec(c.replace(/[()]/g,""));return[u[1],u[2]||void 0,u[3]||void 0]},parseV8OrIE:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(s)},this);return l.map(function(u){u.indexOf("(eval ")>-1&&(u=u.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));var h=u.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,""),f=h.match(/ (\(.+\)$)/);h=f?h.replace(f[0],""):h;var d=this.extractLocation(f?f[1]:h),p=f&&h||void 0,m=["eval","<anonymous>"].indexOf(d[0])>-1?void 0:d[0];return new r({functionName:p,fileName:m,lineNumber:d[1],columnNumber:d[2],source:u})},this)},parseFFOrSafari:function(c){var l=c.stack.split(`
`).filter(function(u){return!u.match(o)},this);return l.map(function(u){if(u.indexOf(" > eval")>-1&&(u=u.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),u.indexOf("@")===-1&&u.indexOf(":")===-1)return new r({functionName:u});var h=/((.*".+"[^@]*)?[^@]*)(?:@)/,f=u.match(h),d=f&&f[1]?f[1]:void 0,p=this.extractLocation(u.replace(h,""));return new r({functionName:d,fileName:p[0],lineNumber:p[1],columnNumber:p[2],source:u})},this)},parseOpera:function(c){return!c.stacktrace||c.message.indexOf(`
`)>-1&&c.message.split(`
`).length>c.stacktrace.split(`
`).length?this.parseOpera9(c):c.stack?this.parseOpera11(c):this.parseOpera10(c)},parseOpera9:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)/i,u=c.message.split(`
`),h=[],f=2,d=u.length;f<d;f+=2){var p=l.exec(u[f]);p&&h.push(new r({fileName:p[2],lineNumber:p[1],source:u[f]}))}return h},parseOpera10:function(c){for(var l=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,u=c.stacktrace.split(`
`),h=[],f=0,d=u.length;f<d;f+=2){var p=l.exec(u[f]);p&&h.push(new r({functionName:p[3]||void 0,fileName:p[2],lineNumber:p[1],source:u[f]}))}return h},parseOpera11:function(c){var l=c.stack.split(`
`).filter(function(u){return!!u.match(i)&&!u.match(/^Error created at/)},this);return l.map(function(u){var h=u.split("@"),f=this.extractLocation(h.pop()),d=h.shift()||"",p=d.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0,m;d.match(/\(([^)]*)\)/)&&(m=d.replace(/^[^(]+\(([^)]*)\)$/,"$1"));var _=m===void 0||m==="[arguments not available]"?void 0:m.split(",");return new r({functionName:p,args:_,fileName:f[0],lineNumber:f[1],columnNumber:f[2],source:u})},this)}}})})(jk)),jk.exports}var bTe=yTe();const STe=wu(bTe);function ty(n){const e={},t={everytick(){},aftertick(){},listcommands(){return Zm(e)},...n,getcommand(r){return e[r]},command(r,i){return e[r]=i,t}};return t}let _j=0;const vj=Jm,ETe=["Command","lines"];class xTe extends ESe{constructor(){super($Z,{traceInitPerf:Jm,skipValidations:!Jm,maxLookahead:2,recoveryEnabled:!0,nodeLocationTracking:"full"}),this.performSelfAnalysis()}PEEK(e,t,...r){console.info(e,r.map(i=>[i.image,i.tokenType]),t)}RULED(e,t,r){const i=ETe.some(s=>e.includes(s));return this.RULE(e,()=>{const o=(_j++).toString().padStart(3),a=i?"font-weight: bold;":"";if(vj&&!this.RECORDING_PHASE){const c=[this.LA(1),this.LA(2),this.LA(3)].map(l=>`[${l.tokenType.name} ${l.image.replaceAll(`
`,"\\n")}]`);console.info(`${o}%c> ${e} ${c.join(" ")}`,a)}t(),vj&&!this.RECORDING_PHASE&&console.info(`${o}%c< ${e} `,a),_j--},r)}program=this.RULED("program",()=>{this.MANY(()=>this.SUBRULE(this.line))});line=this.RULED("line",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt)},{ALT:()=>this.CONSUME(cA)}])});stmt=this.RULED("stmt",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_label)},{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.stmt_command)},{ALT:()=>this.SUBRULE(this.short_go)},{ALT:()=>this.SUBRULE(this.short_try)}])});inline_go=this.RULED("inline_go",()=>{this.SUBRULE(this.short_go),this.OPTION(()=>this.SUBRULE(this.inline))});inline_try=this.RULED("inline_try",()=>{this.SUBRULE(this.short_try),this.OPTION(()=>this.SUBRULE(this.inline))});inline_command=this.RULED("inline_command",()=>{this.SUBRULE(this.stmt_command),this.OPTION(()=>this.SUBRULE(this.inline))});inline=this.RULED("inline",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stmt_stat)},{ALT:()=>this.SUBRULE(this.stmt_text)},{ALT:()=>this.SUBRULE(this.stmt_comment)},{ALT:()=>this.SUBRULE(this.stmt_hyperlink)},{ALT:()=>this.SUBRULE(this.structured_cmd)},{ALT:()=>this.SUBRULE(this.inline_go)},{ALT:()=>this.SUBRULE(this.inline_try)},{ALT:()=>this.SUBRULE(this.inline_command)}])});stmt_label=this.RULED("stmt_label",()=>{this.CONSUME(ux)});stmt_stat=this.RULED("stmt_stat",()=>{this.CONSUME(Qb)});stmt_text=this.RULED("stmt_text",()=>{this.OR([{ALT:()=>this.CONSUME(lA)}])});stmt_comment=this.RULED("stmt_comment",()=>{this.CONSUME(uA)});stmt_hyperlink=this.RULED("stmt_hyperlink",()=>{this.CONSUME(hA),this.CONSUME(b6)});stmt_command=this.RULED("stmt_command",()=>{this.CONSUME(U0),this.OR([{ALT:()=>this.SUBRULE(this.words)},{ALT:()=>this.SUBRULE(this.structured_cmd)}])});structured_cmd=this.RULED("structured_cmd",()=>{this.OR([{ALT:()=>this.SUBRULE(this.command_if)},{ALT:()=>this.SUBRULE(this.command_while)},{ALT:()=>this.SUBRULE(this.command_repeat)},{ALT:()=>this.SUBRULE(this.command_waitfor)},{ALT:()=>this.SUBRULE(this.command_foreach)},{ALT:()=>this.SUBRULE(this.command_break)},{ALT:()=>this.SUBRULE(this.command_continue)}])});short_go=this.RULED("short_go",()=>{this.CONSUME(Db),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});short_try=this.RULED("short_try",()=>{this.CONSUME(fA),this.OR([{ALT:()=>this.SUBRULE(this.string_token)},{ALT:()=>this.SUBRULE(this.dir)}])});command_if=this.RULED("command_if",()=>{this.CONSUME(Lb),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_if_block))});command_if_block=this.RULED("command_if_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ub),this.MANY(()=>this.SUBRULE(this.line)),this.MANY2({GATE:this.BACKTRACK(this.command_else_if),DEF:()=>this.SUBRULE(this.command_else_if)}),this.OPTION(()=>this.SUBRULE(this.command_else)),this.MANY3(()=>this.CONSUME3(cA)),this.CONSUME4(U0),this.CONSUME4(YM)}}])});command_block=this.RULED("command_block",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ub),this.MANY(()=>this.SUBRULE(this.line)),this.CONSUME(U0),this.CONSUME(YM)}}])});command_fork=this.RULED("command_fork",()=>{this.OR([{ALT:()=>this.SUBRULE(this.inline)},{ALT:()=>{this.CONSUME(Ub),this.MANY({GATE:this.BACKTRACK(this.line),DEF:()=>this.SUBRULE(this.line)})}}])});command_else_if=this.RULED("command_else_if",()=>{this.CONSUME(U0),this.CONSUME(Bb),this.CONSUME(Lb),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_fork))});command_else=this.RULED("command_else",()=>{this.CONSUME(U0),this.CONSUME(Bb),this.OPTION1(()=>this.SUBRULE(this.words)),this.OPTION2(()=>this.SUBRULE(this.command_fork))});command_while=this.RULED("command_while",()=>{this.CONSUME(P6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_repeat=this.RULED("command_repeat",()=>{this.CONSUME(D6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_waitfor=this.RULED("command_waitfor",()=>{this.CONSUME(L6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_foreach=this.RULED("command_foreach",()=>{this.CONSUME(U6),this.SUBRULE(this.words),this.OPTION(()=>this.SUBRULE(this.command_block))});command_break=this.RULED("command_break",()=>{this.CONSUME(B6)});command_continue=this.RULED("command_continue",()=>{this.CONSUME(F6)});command_play=this.RULED("command_play",()=>{this.CONSUME(N6)});command_toast=this.RULED("command_toast",()=>{this.CONSUME(FZ)});command_ticker=this.RULED("command_ticker",()=>{this.CONSUME(jZ)});expr=this.RULED("expr",()=>{this.SUBRULE1(this.and_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(VM),this.SUBRULE2(this.and_test,{LABEL:"RHS"})})});and_test=this.RULED("and_test",()=>{this.SUBRULE1(this.not_test,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(GM),this.SUBRULE2(this.not_test,{LABEL:"RHS"})})});not_test=this.RULED("not_test",()=>{this.OR([{ALT:()=>{this.CONSUME(HM),this.SUBRULE1(this.not_test,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.comparison)}])});comparison=this.RULED("comparison",()=>{this.SUBRULE1(this.arith_expr,{LABEL:"LHS"}),this.MANY(()=>{this.SUBRULE(this.comp_op),this.SUBRULE2(this.arith_expr,{LABEL:"RHS"})})});comp_op=this.RULED("comp_op",()=>{this.OR([{ALT:()=>this.CONSUME(S6)},{ALT:()=>this.CONSUME(E6)},{ALT:()=>this.CONSUME(x6)},{ALT:()=>this.CONSUME(T6)},{ALT:()=>this.CONSUME(w6)},{ALT:()=>this.CONSUME(A6)}])});expr_value=this.RULED("expr_value",()=>{this.SUBRULE1(this.and_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(VM),this.SUBRULE2(this.and_test_value,{LABEL:"RHS"})})});and_test_value=this.RULED("and_test_value",()=>{this.SUBRULE1(this.not_test_value,{LABEL:"LHS"}),this.MANY(()=>{this.CONSUME(GM),this.SUBRULE2(this.not_test_value,{LABEL:"RHS"})})});not_test_value=this.RULED("not_test_value",()=>{this.OR([{ALT:()=>{this.CONSUME(HM),this.SUBRULE1(this.not_test_value,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE2(this.arith_expr)}])});arith_expr=this.RULED("arith_expr",()=>{this.OR([{ALT:()=>this.SUBRULE(this.token_expr,{LABEL:"LHS"})},{ALT:()=>{this.SUBRULE1(this.term),this.MANY(()=>this.SUBRULE2(this.arith_expr_item,{LABEL:"RHS"}))}}])});arith_expr_item=this.RULED("arith_expr_item",()=>{this.OR([{ALT:()=>this.CONSUME(WM)},{ALT:()=>this.CONSUME(qM)}]),this.SUBRULE(this.term)});term=this.RULED("term",()=>{this.SUBRULE1(this.factor),this.MANY(()=>this.SUBRULE2(this.term_item))});term_item=this.RULED("term_item",()=>{this.OR([{ALT:()=>this.CONSUME(R6)},{ALT:()=>this.CONSUME(Db)},{ALT:()=>this.CONSUME(k6)},{ALT:()=>this.CONSUME(M6)}]),this.SUBRULE(this.factor)});factor=this.RULED("factor",()=>{this.OR1([{ALT:()=>{this.OR2([{ALT:()=>this.CONSUME(WM)},{ALT:()=>this.CONSUME(qM)}]),this.SUBRULE(this.factor,{LABEL:"LHS"})}},{ALT:()=>this.SUBRULE(this.power)}])});power=this.RULED("power",()=>{this.SUBRULE(this.token),this.OPTION(()=>{this.CONSUME(C6),this.SUBRULE(this.factor)})});words=this.RULED("words",()=>{this.AT_LEAST_ONE(()=>this.SUBRULE(this.expr))});kind=this.RULED("kind",()=>{this.OPTION(()=>this.SUBRULE(this.color)),this.SUBRULE(this.string_token)});category=this.RULED("category",()=>{this.OR([{ALT:()=>this.CONSUME(aK)},{ALT:()=>this.CONSUME(cK)}])});collision=this.RULED("collision",()=>{this.OR([{ALT:()=>this.CONSUME(lK)},{ALT:()=>this.CONSUME(uK)},{ALT:()=>this.CONSUME(hK)},{ALT:()=>this.CONSUME(fK)},{ALT:()=>this.CONSUME(dK)},{ALT:()=>this.CONSUME(pK)},{ALT:()=>this.CONSUME(mK)},{ALT:()=>this.CONSUME(gK)},{ALT:()=>this.CONSUME(_K)}])});color=this.RULED("color",()=>{this.OR([{ALT:()=>this.CONSUME(vK)},{ALT:()=>this.CONSUME(yK)},{ALT:()=>this.CONSUME(bK)},{ALT:()=>this.CONSUME(SK)},{ALT:()=>this.CONSUME(EK)},{ALT:()=>this.CONSUME(xK)},{ALT:()=>this.CONSUME(TK)},{ALT:()=>this.CONSUME(wK)},{ALT:()=>this.CONSUME(AK)},{ALT:()=>this.CONSUME(CK)},{ALT:()=>this.CONSUME(RK)},{ALT:()=>this.CONSUME(kK)},{ALT:()=>this.CONSUME(MK)},{ALT:()=>this.CONSUME(IK)},{ALT:()=>this.CONSUME(OK)},{ALT:()=>this.CONSUME(NK)},{ALT:()=>this.CONSUME(PK)},{ALT:()=>this.CONSUME(DK)},{ALT:()=>this.CONSUME(LK)},{ALT:()=>this.CONSUME(UK)},{ALT:()=>this.CONSUME(BK)},{ALT:()=>this.CONSUME(FK)},{ALT:()=>this.CONSUME(jK)},{ALT:()=>this.CONSUME(zK)},{ALT:()=>this.CONSUME($K)},{ALT:()=>this.CONSUME(VK)},{ALT:()=>this.CONSUME(HK)},{ALT:()=>this.CONSUME(GK)},{ALT:()=>this.CONSUME(WK)},{ALT:()=>this.CONSUME(qK)},{ALT:()=>this.CONSUME(YK)},{ALT:()=>this.CONSUME(KK)},{ALT:()=>this.CONSUME(XK)},{ALT:()=>this.CONSUME(ZK)},{ALT:()=>this.CONSUME(JK)},{ALT:()=>this.CONSUME(QK)},{ALT:()=>this.CONSUME(eX)},{ALT:()=>this.CONSUME(tX)},{ALT:()=>this.CONSUME(nX)},{ALT:()=>this.CONSUME(rX)},{ALT:()=>this.CONSUME(iX)},{ALT:()=>this.CONSUME(sX)},{ALT:()=>this.CONSUME(oX)},{ALT:()=>this.CONSUME(aX)},{ALT:()=>this.CONSUME(cX)},{ALT:()=>this.CONSUME(lX)},{ALT:()=>this.CONSUME(uX)},{ALT:()=>this.CONSUME(hX)},{ALT:()=>this.CONSUME(fX)},{ALT:()=>this.CONSUME(dX)},{ALT:()=>this.CONSUME(pX)},{ALT:()=>this.CONSUME(mX)},{ALT:()=>this.CONSUME(gX)},{ALT:()=>this.CONSUME(_X)},{ALT:()=>this.CONSUME(vX)},{ALT:()=>this.CONSUME(yX)},{ALT:()=>this.CONSUME(bX)},{ALT:()=>this.CONSUME(SX)},{ALT:()=>this.CONSUME(EX)},{ALT:()=>this.CONSUME(xX)},{ALT:()=>this.CONSUME(TX)},{ALT:()=>this.CONSUME(wX)},{ALT:()=>this.CONSUME(AX)},{ALT:()=>this.CONSUME(CX)},{ALT:()=>this.CONSUME(RX)},{ALT:()=>this.CONSUME(kX)},{ALT:()=>this.CONSUME(MX)},{ALT:()=>this.CONSUME(IX)},{ALT:()=>this.CONSUME(OX)},{ALT:()=>this.CONSUME(NX)}])});dir_mod=this.RULED("dir_mod",()=>{this.OR([{ALT:()=>this.CONSUME(WX)},{ALT:()=>this.CONSUME(qX)},{ALT:()=>this.CONSUME(YX)},{ALT:()=>this.CONSUME(KX)},{ALT:()=>this.CONSUME(pZ)},{ALT:()=>this.CONSUME(mZ)},{ALT:()=>this.CONSUME(gZ)},{ALT:()=>this.SUBRULE(this.dir_within)},{ALT:()=>this.SUBRULE(this.dir_awayby)},{ALT:()=>this.CONSUME(yZ)}])});dir_by=this.RULED("dir_by",()=>{this.CONSUME(FX),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_at=this.RULED("dir_at",()=>{this.CONSUME(jX),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_away=this.RULED("dir_away",()=>{this.CONSUME(XX),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_toward=this.RULED("dir_toward",()=>{this.CONSUME(ZX),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token)});dir_find=this.RULED("dir_find",()=>{this.CONSUME(JX),this.OR([{ALT:()=>this.SUBRULE(this.kind)},{ALT:()=>this.CONSUME(AE)}])});dir_flee=this.RULED("dir_flee",()=>{this.CONSUME(QX),this.OR([{ALT:()=>this.SUBRULE(this.kind)},{ALT:()=>this.CONSUME(AE)}])});dir_to=this.RULED("dir_to",()=>{this.CONSUME(eZ),this.SUBRULE1(this.dir),this.SUBRULE2(this.dir)});dir_within=this.RULED("dir_within",()=>{this.CONSUME(_Z),this.SUBRULE1(this.simple_token)});dir_awayby=this.RULED("dir_awayby",()=>{this.CONSUME(vZ),this.SUBRULE1(this.simple_token)});dir=this.RULED("dir",()=>{this.MANY(()=>this.SUBRULE(this.dir_mod)),this.OR([{ALT:()=>this.CONSUME(PX)},{ALT:()=>this.CONSUME(DX)},{ALT:()=>this.CONSUME(LX)},{ALT:()=>this.CONSUME(UX)},{ALT:()=>this.CONSUME(BX)},{ALT:()=>this.SUBRULE(this.dir_by)},{ALT:()=>this.SUBRULE(this.dir_at)},{ALT:()=>this.SUBRULE(this.dir_away)},{ALT:()=>this.SUBRULE(this.dir_toward)},{ALT:()=>this.CONSUME(zX)},{ALT:()=>this.CONSUME($X)},{ALT:()=>this.CONSUME(VX)},{ALT:()=>this.CONSUME(HX)},{ALT:()=>this.CONSUME(GX)},{ALT:()=>this.SUBRULE(this.dir_find)},{ALT:()=>this.SUBRULE(this.dir_flee)},{ALT:()=>this.SUBRULE(this.dir_to)},{ALT:()=>this.CONSUME(tZ)},{ALT:()=>this.CONSUME(nZ)},{ALT:()=>this.CONSUME(rZ)},{ALT:()=>this.CONSUME(iZ)},{ALT:()=>this.CONSUME(sZ)},{ALT:()=>this.CONSUME(oZ)},{ALT:()=>this.CONSUME(aZ)},{ALT:()=>this.CONSUME(cZ)},{ALT:()=>this.CONSUME(lZ)},{ALT:()=>this.CONSUME(uZ)},{ALT:()=>this.CONSUME(hZ)},{ALT:()=>this.CONSUME(fZ)},{ALT:()=>this.CONSUME(dZ)}])});expr_any=this.RULED("expr_any",()=>{this.OR1([{ALT:()=>this.SUBRULE1(this.kind)},{ALT:()=>this.SUBRULE1(this.color)},{ALT:()=>{this.SUBRULE(this.dir),this.OR2([{ALT:()=>this.SUBRULE2(this.kind)},{ALT:()=>this.SUBRULE2(this.color)}])}}])});token_expr_any=this.RULED("token_expr_any",()=>{this.CONSUME(xZ),this.SUBRULE(this.expr_any)});token_expr_count=this.RULED("token_expr_count",()=>{this.CONSUME(TZ),this.SUBRULE(this.expr_any)});token_expr_blocked=this.RULED("token_expr_blocked",()=>{this.CONSUME(EZ),this.SUBRULE(this.dir)});token_expr_abs=this.RULED("token_expr_abs",()=>{this.CONSUME(wZ),this.SUBRULE(this.simple_token)});token_expr_intceil=this.RULED("token_expr_intceil",()=>{this.CONSUME(AZ),this.SUBRULE(this.simple_token)});token_expr_intfloor=this.RULED("token_expr_intfloor",()=>{this.CONSUME(CZ),this.SUBRULE(this.simple_token)});token_expr_intround=this.RULED("token_expr_intround",()=>{this.CONSUME(RZ),this.SUBRULE(this.simple_token)});token_expr_clamp=this.RULED("token_expr_clamp",()=>{this.CONSUME(kZ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.SUBRULE3(this.simple_token)});token_expr_min=this.RULED("token_expr_min",()=>{this.CONSUME(MZ),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_max=this.RULED("token_expr_max",()=>{this.CONSUME(IZ),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pick=this.RULED("token_expr_pick",()=>{this.CONSUME(OZ),this.AT_LEAST_ONE(()=>this.SUBRULE1(this.simple_token))});token_expr_pickwith=this.RULED("token_expr_pickwith",()=>{this.CONSUME(NZ),this.SUBRULE1(this.simple_token),this.AT_LEAST_ONE(()=>this.SUBRULE2(this.simple_token))});token_expr_random=this.RULED("token_expr_random",()=>{this.CONSUME(PZ),this.SUBRULE1(this.simple_token),this.OPTION(()=>this.SUBRULE2(this.simple_token))});token_expr_randomwith=this.RULED("token_expr_randomwith",()=>{this.CONSUME(DZ),this.SUBRULE1(this.simple_token),this.SUBRULE2(this.simple_token),this.OPTION(()=>this.SUBRULE3(this.simple_token))});token_expr_run=this.RULED("token_expr_run",()=>{this.CONSUME(LZ),this.SUBRULE(this.string_token)});token_expr_runwith=this.RULED("token_expr_runwith",()=>{this.CONSUME(UZ),this.SUBRULE(this.simple_token),this.SUBRULE(this.string_token)});token_expr=this.RULED("token_expr",()=>{this.OR([{ALT:()=>this.CONSUME(bZ)},{ALT:()=>this.CONSUME(SZ)},{ALT:()=>this.SUBRULE(this.token_expr_any)},{ALT:()=>this.SUBRULE(this.token_expr_count)},{ALT:()=>this.SUBRULE(this.token_expr_blocked)},{ALT:()=>this.SUBRULE(this.token_expr_abs)},{ALT:()=>this.SUBRULE(this.token_expr_intceil)},{ALT:()=>this.SUBRULE(this.token_expr_intfloor)},{ALT:()=>this.SUBRULE(this.token_expr_intround)},{ALT:()=>this.SUBRULE(this.token_expr_clamp)},{ALT:()=>this.SUBRULE(this.token_expr_min)},{ALT:()=>this.SUBRULE(this.token_expr_max)},{ALT:()=>this.SUBRULE(this.token_expr_pick)},{ALT:()=>this.SUBRULE(this.token_expr_pickwith)},{ALT:()=>this.SUBRULE(this.token_expr_random)},{ALT:()=>this.SUBRULE(this.token_expr_randomwith)},{ALT:()=>this.SUBRULE(this.token_expr_run)},{ALT:()=>this.SUBRULE(this.token_expr_runwith)}])});string_token=this.RULED("string_token",()=>{this.OR([{ALT:()=>this.CONSUME(va)},{ALT:()=>this.CONSUME(jw)}])});simple_token=this.RULED("simple_token",()=>{this.OR([{ALT:()=>this.CONSUME(AE)},{ALT:()=>this.CONSUME(va)},{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.SUBRULE(this.color)}])});token=this.RULED("token",()=>{this.OR([{ALT:()=>this.SUBRULE(this.category)},{ALT:()=>this.SUBRULE(this.collision)},{ALT:()=>this.SUBRULE(this.color)},{ALT:()=>this.SUBRULE(this.dir)},{ALT:()=>this.SUBRULE(this.command_play)},{ALT:()=>this.SUBRULE(this.command_toast)},{ALT:()=>this.SUBRULE(this.command_ticker)},{ALT:()=>this.CONSUME(ux)},{ALT:()=>this.CONSUME(jw)},{ALT:()=>this.CONSUME(va)},{ALT:()=>this.CONSUME(AE)},{ALT:()=>this.CONSUME(BZ)},{ALT:()=>{this.CONSUME(I6),this.SUBRULE(this.expr),this.CONSUME(O6)}}])})}const CE=new xTe;if(ome){const n=CE.getGAstProductions(),e=PSe(n);console.info(e)}const TTe=CE.getBaseCstVisitorConstructor();var Bn=(n=>(n[n.PROGRAM=0]="PROGRAM",n[n.API=1]="API",n[n.LINE=2]="LINE",n[n.MARK=3]="MARK",n[n.GOTO=4]="GOTO",n[n.COUNT=5]="COUNT",n[n.TEXT=6]="TEXT",n[n.LABEL=7]="LABEL",n[n.HYPERLINK=8]="HYPERLINK",n[n.STAT=9]="STAT",n[n.MOVE=10]="MOVE",n[n.COMMAND=11]="COMMAND",n[n.LITERAL=12]="LITERAL",n[n.IF=13]="IF",n[n.IF_CHECK=14]="IF_CHECK",n[n.IF_BLOCK=15]="IF_BLOCK",n[n.ELSE_IF=16]="ELSE_IF",n[n.ELSE=17]="ELSE",n[n.WHILE=18]="WHILE",n[n.BREAK=19]="BREAK",n[n.CONTINUE=20]="CONTINUE",n[n.REPEAT=21]="REPEAT",n[n.WAITFOR=22]="WAITFOR",n[n.FOREACH=23]="FOREACH",n[n.OR=24]="OR",n[n.AND=25]="AND",n[n.NOT=26]="NOT",n[n.COMPARE=27]="COMPARE",n[n.COMPARE_ITEM=28]="COMPARE_ITEM",n[n.OPERATOR=29]="OPERATOR",n[n.OPERATOR_ITEM=30]="OPERATOR_ITEM",n[n.EXPR=31]="EXPR",n))(Bn||{}),db=(n=>(n[n.IS_EQ=0]="IS_EQ",n[n.IS_NOT_EQ=1]="IS_NOT_EQ",n[n.IS_LESS_THAN=2]="IS_LESS_THAN",n[n.IS_GREATER_THAN=3]="IS_GREATER_THAN",n[n.IS_LESS_THAN_OR_EQ=4]="IS_LESS_THAN_OR_EQ",n[n.IS_GREATER_THAN_OR_EQ=5]="IS_GREATER_THAN_OR_EQ",n))(db||{}),Sm=(n=>(n[n.EMPTY=0]="EMPTY",n[n.PLUS=1]="PLUS",n[n.MINUS=2]="MINUS",n[n.POWER=3]="POWER",n[n.MULTIPLY=4]="MULTIPLY",n[n.DIVIDE=5]="DIVIDE",n[n.MOD_DIVIDE=6]="MOD_DIVIDE",n[n.FLOOR_DIVIDE=7]="FLOOR_DIVIDE",n[n.UNI_PLUS=8]="UNI_PLUS",n[n.UNI_MINUS=9]="UNI_MINUS",n))(Sm||{}),$k=(n=>(n[n.NUMBER=0]="NUMBER",n[n.STRING=1]="STRING",n[n.TEMPLATE=2]="TEMPLATE",n))($k||{});function Vo(n,e){const[t]=n??[];return(t?.image??e).trimStart().replaceAll(/^"|"$/g,"")}class wTe extends TTe{unique=0;constructor(){super(),Jm&&this.validateVisitor()}visit(e){if(sr(e)&&(e=e[0]),!!he(e))return this[e.name](e.children,e.location)}createcodenode(e,t){return[{...t,...e,lineindex:0}]}createstringnode(e,t){return this.createcodenode(e,{type:12,literal:1,value:t})}createtemplatenode(e,t){return this.createcodenode(e,{type:12,literal:2,value:t})}createmarknode(e,t,r){return this.createlinenode(e,this.createcodenode(e,{type:3,id:t,comment:r}))}creategotonode(e,t,r){return this.createlinenode(e,this.createcodenode(e,{type:4,id:t,comment:r}))}createlinenode(e,t){return this.createcodenode(e,{type:2,stmts:t})}createapinode(e,t,r){return this.createlinenode(e,this.createcodenode(e,{type:1,words:r,method:t}))}createlogicnode(e,t,r,i){return this.createlinenode(e,this.createcodenode(e,{type:14,skip:r,words:i,method:t}))}createcountnode(e){return this.createcodenode(e,{type:5,index:this.unique++})}createexprnodeondemand(e,t){return e.length===1?e[0]:this.createcodenode(t,{type:31,words:e})[0]}go(e){return Array.isArray(e)?e.map(t=>this.visit(t)).flat():he(e)?[this.visit(e)].flat():[]}program(e,t){return this.unique=0,this.createcodenode(t,{type:0,lines:[this.createlinenode(t,this.createcodenode(t,{type:7,active:!0,name:"restart"})),this.go(e.line)].flat()})}line(e){return e.stmt?this.go(e.stmt):[]}stmt(e){return e.stmt_label?this.go(e.stmt_label):e.stmt_stat?this.go(e.stmt_stat):e.stmt_text?this.go(e.stmt_text):e.stmt_comment?this.go(e.stmt_comment):e.stmt_hyperlink?this.go(e.stmt_hyperlink):e.stmt_command?this.go(e.stmt_command):e.short_go?this.go(e.short_go):e.short_try?this.go(e.short_try):[]}inline_go(e){const t=[];return e.short_go&&t.push(...this.go(e.short_go)),e.inline&&t.push(...this.go(e.inline)),t}inline_try(e){const t=[];return e.short_try&&t.push(...this.go(e.short_try)),e.inline&&t.push(...this.go(e.inline)),t}inline_command(e){const t=[];return e.stmt_command&&t.push(...this.go(e.stmt_command)),e.inline&&t.push(...this.go(e.inline)),t}inline(e){const t=[];return e.stmt_stat&&t.push(...this.go(e.stmt_stat)),e.stmt_text&&t.push(...this.go(e.stmt_text)),e.stmt_comment&&t.push(...this.go(e.stmt_comment)),e.stmt_hyperlink&&t.push(...this.go(e.stmt_hyperlink)),e.inline_go&&t.push(...this.go(e.inline_go)),e.inline_try&&t.push(...this.go(e.inline_try)),e.inline_command&&t.push(...this.go(e.inline_command)),e.structured_cmd&&t.push(...this.go(e.structured_cmd)),t}stmt_label(e,t){return this.createlinenode(t,this.createcodenode(t,{type:7,active:!0,name:Vo(e.token_label,":").slice(1).trim()}))}stmt_stat(e,t){return this.createlinenode(t,this.createcodenode(t,{type:9,value:Vo(e.token_stat,"@").slice(1)}))}stmt_text(e,t){const r=Vo(e.token_text,"");return this.createlinenode(t,this.createcodenode(t,{type:6,value:r}))}stmt_comment(e,t){return this.createlinenode(t,this.createcodenode(t,{type:7,active:!1,name:Vo(e.token_comment,"'").slice(1).trim()}))}stmt_hyperlink(e,t){return this.createlinenode(t,this.createcodenode(t,{type:8,link:Vo(e.token_hyperlink,"!").slice(1),text:Vo(e.token_hyperlinktext,";").slice(1)}))}stmt_command(e,t){return e.structured_cmd?this.go(e.structured_cmd):this.createlinenode(t,this.createcodenode(t,{type:11,words:this.go(e.words)}))}structured_cmd(e){return e.command_if?this.go(e.command_if):e.command_while?this.go(e.command_while):e.command_repeat?this.go(e.command_repeat):e.command_waitfor?this.go(e.command_waitfor):e.command_foreach?this.go(e.command_foreach):e.command_break?this.go(e.command_break):e.command_continue?this.go(e.command_continue):[]}short_go(e,t){return e.token_divide?this.createlinenode(t,this.createcodenode(t,{type:10,wait:!0,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}short_try(e,t){return e.token_query?this.createlinenode(t,this.createcodenode(t,{type:10,wait:!1,words:[this.go(e.string_token),this.go(e.dir)].flat()})):[]}command_if(e,t){const[r]=this.createlogicnode(t,Vo(e.token_if,"if").toLowerCase(),"",this.go(e.words)),[i]=this.go(e.command_if_block)??[];return this.createcodenode(t,{type:13,check:r,block:i})}command_if_block(e,t){const r=Yo(),i=Yo();return this.createcodenode(t,{type:15,skip:r,done:i,lines:[this.go(e.inline),this.go(e.line),this.creategotonode(t,i,"end of if"),this.createmarknode(t,r,"alt logic")].flat(),altlines:[this.go(e.command_else_if),this.go(e.command_else),this.createmarknode(t,i,"end of if")].flat()})}command_block(e){return[this.go(e.inline),this.go(e.line)].flat()}command_fork(e){return[this.go(e.inline),this.go(e.line)].flat()}command_else_if(e,t){const r=Yo(),i=Yo();return this.createcodenode(t,{type:16,done:i,lines:[this.createlogicnode(t,Vo(e.token_if,"if"),r,this.go(e.words)),this.go(e.command_fork),this.creategotonode(t,i,"end of if"),this.createmarknode(t,r,"skip")].flat()})}command_else(e,t){const r=[];return e.words&&r.push(...this.createlinenode(t,this.createcodenode(t,{type:11,words:this.go(e.words)}))),e.command_fork&&r.push(...this.go(e.command_fork)),this.createcodenode(t,{type:17,lines:r})}command_while(e,t){const r=Yo(),i=Yo();return this.createcodenode(t,{type:18,loop:r,done:i,lines:[this.createmarknode(t,r,"start of while"),this.createlogicnode(t,"if",i,this.go(e.words)),this.go(e.command_block),this.creategotonode(t,r,"loop of while"),this.createmarknode(t,i,"end of while")].flat()})}command_repeat(e,t){const r=Yo(),i=Yo(),o=[this.createcountnode(t),this.go(e.words)].flat();return this.createcodenode(t,{type:21,loop:r,done:i,lines:[this.createapinode(t,"repeatstart",o),this.createmarknode(t,r,"start of repeat"),this.createlogicnode(t,"repeat",i,o),this.go(e.command_block),this.creategotonode(t,r,"loop of repeat"),this.createmarknode(t,i,"end of repeat")].flat()})}command_foreach(e,t){const r=Yo(),i=Yo(),o=[this.createcountnode(t),this.go(e.words)].flat();return this.createcodenode(t,{type:23,loop:r,done:i,lines:[this.createapinode(t,"foreachstart",o),this.createmarknode(t,r,"start of foreach"),this.createlogicnode(t,"foreach",i,o),this.go(e.command_block),this.creategotonode(t,r,"loop of foreach"),this.createmarknode(t,i,"end of foreach")].flat()})}command_waitfor(e,t){const r=Yo();return this.createcodenode(t,{type:22,loop:r,lines:[this.createmarknode(t,r,"start of waitfor"),this.createlogicnode(t,"waitfor",r,this.go(e.words))].flat()})}command_break(e,t){return this.createcodenode(t,{type:19,goto:0})}command_continue(e,t){return this.createcodenode(t,{type:20,goto:0})}command_play(e,t){const r=Vo(e.token_command_play,"").trim(),[i,...s]=r.split(" ");return[this.createstringnode(t,i),this.createstringnode(t,s.join(" "))].flat()}command_toast(e,t){const i=Vo(e.token_command_toast,"").replace("toast","").trim();return[this.createstringnode(t,"toast"),this.createtemplatenode(t,i)].flat()}command_ticker(e,t){const i=Vo(e.token_command_ticker,"").replace("ticker","").trim();return[this.createstringnode(t,"ticker"),this.createtemplatenode(t,i)].flat()}expr(e,t){return e.RHS?this.createcodenode(t,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),t),this.createexprnodeondemand(this.go(e.RHS),t)]}):this.go(e.LHS)}and_test(e,t){return e.RHS?this.createcodenode(t,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),t),this.createexprnodeondemand(this.go(e.RHS),t)]}):this.go(e.LHS)}not_test(e,t){return e.comparison?this.go(e.comparison):e.LHS?this.createcodenode(t,{type:26,items:this.go(e.LHS)}):[]}comparison(e,t){if(e.RHS){const[r]=this.go(e.comp_op);return this.createcodenode(t,{type:27,compare:r,lhs:this.createexprnodeondemand(this.go(e.LHS),t),rhs:this.createexprnodeondemand(this.go(e.RHS),t)})}return this.go(e.LHS)}comp_op(e,t){return e.token_iseq?this.createcodenode(t,{type:28,method:0}):e.token_isnoteq?this.createcodenode(t,{type:28,method:1}):e.token_islessthan?this.createcodenode(t,{type:28,method:2}):e.token_isgreaterthan?this.createcodenode(t,{type:28,method:3}):e.token_islessthanorequal?this.createcodenode(t,{type:28,method:4}):e.token_isgreaterthanorequal?this.createcodenode(t,{type:28,method:5}):[]}expr_value(e,t){return e.RHS?this.createcodenode(t,{type:24,items:[this.createexprnodeondemand(this.go(e.LHS),t),this.createexprnodeondemand(this.go(e.RHS),t)]}):this.go(e.LHS)}and_test_value(e,t){return e.RHS?this.createcodenode(t,{type:25,items:[this.createexprnodeondemand(this.go(e.LHS),t),this.createexprnodeondemand(this.go(e.RHS),t)]}):this.go(e.LHS)}not_test_value(e,t){return e.arith_expr?this.go(e.arith_expr):e.LHS?this.createcodenode(t,{type:26,items:this.go(e.LHS)}):[]}arith_expr(e,t){if(e.LHS)return this.go(e.LHS);const r=this.go(e.term);return e.RHS?this.createcodenode(t,{type:29,lhs:r[0],items:this.go(e.RHS)}):r}arith_expr_item(e,t){return this.createcodenode(t,{type:30,operator:e.token_plus?1:2,rhs:this.go(e.term)[0]})}term(e,t){return e.term_item?this.createcodenode(t,{type:29,lhs:this.go(e.factor)[0],items:this.go(e.term_item)}):this.go(e.factor)}term_item(e,t){let r=0;return e.token_multiply&&(r=4),e.token_divide&&(r=5),e.token_moddivide&&(r=6),e.token_floordivide&&(r=7),this.createcodenode(t,{type:30,operator:r,rhs:this.go(e.factor)[0]})}factor(e,t){if(e.power)return this.go(e.power);let r=0;return e.token_plus&&(r=8),e.token_minus&&(r=9),this.createcodenode(t,{type:29,lhs:void 0,items:this.createcodenode(t,{type:30,operator:r,rhs:this.go(e.LHS)[0]})})}power(e,t){const r=this.go(e.token);return e.factor?this.createcodenode(t,{type:29,lhs:r[0],items:this.createcodenode(t,{type:30,operator:3,rhs:this.go(e.factor)[0]})}):r}words(e){return this.go(e.expr)}kind(e){return[this.go(e.color),this.go(e.string_token)].flat()}category(e,t){return e.token_isterrain?this.createcodenode(t,{type:12,literal:1,value:"isterrain"}):e.token_isobject?this.createcodenode(t,{type:12,literal:1,value:"isobject"}):[]}collision(e,t){return e.token_iswalkable?this.createcodenode(t,{type:12,literal:1,value:"iswalkable"}):e.token_iswalking?this.createcodenode(t,{type:12,literal:1,value:"iswalking"}):e.token_iswalk?this.createcodenode(t,{type:12,literal:1,value:"iswalk"}):e.token_isswimmable?this.createcodenode(t,{type:12,literal:1,value:"isswimmable"}):e.token_isswimming?this.createcodenode(t,{type:12,literal:1,value:"isswimming"}):e.token_isswim?this.createcodenode(t,{type:12,literal:1,value:"isswim"}):e.token_issolid?this.createcodenode(t,{type:12,literal:1,value:"issolid"}):e.token_isbullet?this.createcodenode(t,{type:12,literal:1,value:"isbullet"}):e.token_isghost?this.createcodenode(t,{type:12,literal:1,value:"isghost"}):[]}color(e,t){let r="ERROR";return e.token_black&&(r="black"),e.token_dkblue&&(r="dkblue"),e.token_dkgreen&&(r="dkgreen"),e.token_dkcyan&&(r="dkcyan"),e.token_dkred&&(r="dkred"),e.token_dkpurple&&(r="dkpurple"),e.token_dkyellow&&(r="dkyellow"),e.token_ltgray&&(r="ltgray"),e.token_dkgray&&(r="dkgray"),e.token_blue&&(r="blue"),e.token_green&&(r="green"),e.token_cyan&&(r="cyan"),e.token_red&&(r="red"),e.token_purple&&(r="purple"),e.token_yellow&&(r="yellow"),e.token_white&&(r="white"),e.token_brown&&(r="brown"),e.token_dkwhite&&(r="dkwhite"),e.token_ltgrey&&(r="ltgrey"),e.token_gray&&(r="gray"),e.token_grey&&(r="grey"),e.token_dkgrey&&(r="dkgrey"),e.token_ltblack&&(r="ltblack"),e.token_onblack&&(r="onblack"),e.token_ondkblue&&(r="ondkblue"),e.token_ondkgreen&&(r="ondkgreen"),e.token_ondkcyan&&(r="ondkcyan"),e.token_ondkred&&(r="ondkred"),e.token_ondkpurple&&(r="ondkpurple"),e.token_ondkyellow&&(r="ondkyellow"),e.token_onltgray&&(r="onltgray"),e.token_ondkgray&&(r="ondkgray"),e.token_onblue&&(r="onblue"),e.token_ongreen&&(r="ongreen"),e.token_oncyan&&(r="oncyan"),e.token_onred&&(r="onred"),e.token_onpurple&&(r="onpurple"),e.token_onyellow&&(r="onyellow"),e.token_onwhite&&(r="onwhite"),e.token_onbrown&&(r="onbrown"),e.token_ondkwhite&&(r="ondkwhite"),e.token_onltgrey&&(r="onltgrey"),e.token_ongray&&(r="ongray"),e.token_ongrey&&(r="ongrey"),e.token_ondkgrey&&(r="ondkgrey"),e.token_onltblack&&(r="onltblack"),e.token_onclear&&(r="onclear"),e.token_blblack&&(r="blblack"),e.token_bldkblue&&(r="blblue"),e.token_bldkgreen&&(r="blgreen"),e.token_bldkcyan&&(r="bldkcyan"),e.token_bldkred&&(r="bldkred"),e.token_bldkpurple&&(r="bldkpurple"),e.token_bldkyellow&&(r="bldkyellow"),e.token_blltgray&&(r="blltgray"),e.token_bldkgray&&(r="bldkgray"),e.token_blblue&&(r="blblue"),e.token_blgreen&&(r="blgreen"),e.token_blcyan&&(r="blcyan"),e.token_blred&&(r="blred"),e.token_blpurple&&(r="blpurple"),e.token_blyellow&&(r="blyellow"),e.token_blwhite&&(r="blwhite"),e.token_blbrown&&(r="blbrown"),e.token_bldkwhite&&(r="bldkwhite"),e.token_blltgrey&&(r="blltgrey"),e.token_blgray&&(r="blgray"),e.token_blgrey&&(r="blgrey"),e.token_bldkgrey&&(r="bldkgrey"),e.token_blltblack&&(r="blltblack"),this.createcodenode(t,{type:12,literal:1,value:r})}dir_mod(e,t){if(e.dir_within)return this.go(e.dir_within);if(e.dir_awayby)return this.go(e.dir_awayby);let r="ERROR";return e.token_cw&&(r="cw"),e.token_ccw&&(r="ccw"),e.token_opp&&(r="opp"),e.token_rndp&&(r="rndp"),e.token_over&&(r="over"),e.token_under&&(r="under"),e.token_ground&&(r="ground"),e.token_elements&&(r="elements"),this.createcodenode(t,{type:12,literal:1,value:r})}dir_by(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"by"}),...this.go(e.simple_token)]}dir_at(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"at"}),...this.go(e.simple_token)]}dir_away(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"away"}),...this.go(e.simple_token)]}dir_toward(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"toward"}),...this.go(e.simple_token)]}dir_find(e,t){const r=this.go(e.kind);if(e.token_numberliteral){const i=parseFloat(Vo(e.token_numberliteral,"0"));r.push(...this.createcodenode(t,{type:12,literal:0,value:i}))}return[...this.createcodenode(t,{type:12,literal:1,value:"find"}),...r]}dir_flee(e,t){const r=this.go(e.kind);if(e.token_numberliteral){const i=parseFloat(Vo(e.token_numberliteral,"0"));r.push(...this.createcodenode(t,{type:12,literal:0,value:i}))}return[...this.createcodenode(t,{type:12,literal:1,value:"flee"}),...r]}dir_to(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"to"}),...this.go(e.dir)]}dir_within(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"within"}),...this.go(e.simple_token)]}dir_awayby(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"awayby"}),...this.go(e.simple_token)]}dir(e,t){const r=this.go(e.dir_mod)??[];return e.token_i&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"i"})),e.token_idle&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"idle"})),e.token_n&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"n"})),e.token_u&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"u"})),e.token_north&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"north"})),e.token_up&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"up"})),e.token_s&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"s"})),e.token_d&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"d"})),e.token_south&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"south"})),e.token_down&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"down"})),e.token_w&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"w"})),e.token_l&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"l"})),e.token_west&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"west"})),e.token_left&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"left"})),e.token_e&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"e"})),e.token_r&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"r"})),e.token_east&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"east"})),e.token_right&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"right"})),e.token_rnd&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"rnd"})),e.token_rndne&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"rndne"})),e.token_rndns&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"rndns"})),e.token_flow&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"flow"})),e.token_seek&&r.push(...this.createcodenode(t,{type:12,literal:1,value:"seek"})),e.dir_by&&r.push(...this.go(e.dir_by)),e.dir_at&&r.push(...this.go(e.dir_at)),e.dir_away&&r.push(...this.go(e.dir_away)),e.dir_toward&&r.push(...this.go(e.dir_toward)),e.dir_find&&r.push(...this.go(e.dir_find)),e.dir_flee&&r.push(...this.go(e.dir_flee)),e.dir_to&&r.push(...this.go(e.dir_to)),r.flat()}expr_any(e){return[this.go(e.dir),this.go(e.kind),this.go(e.color)].flat()}token_expr_any(e,t){return[this.createcodenode(t,{type:12,literal:1,value:"any"}),this.go(e.expr_any)].flat()}token_expr_count(e,t){return[this.createcodenode(t,{type:12,literal:1,value:"countof"}),this.go(e.expr_any)].flat()}token_expr_blocked(e,t){return[this.createcodenode(t,{type:12,literal:1,value:"blocked"}),this.go(e.dir)].flat()}token_expr_abs(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"abs"}),...this.go(e.simple_token)]}token_expr_intceil(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"intceil"}),...this.go(e.simple_token)]}token_expr_intfloor(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"intfloor"}),...this.go(e.simple_token)]}token_expr_intround(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"intround"}),...this.go(e.simple_token)]}token_expr_clamp(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"clamp"}),...this.go(e.simple_token)]}token_expr_min(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"min"}),...this.go(e.simple_token)]}token_expr_max(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"max"}),...this.go(e.simple_token)]}token_expr_pick(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"pick"}),...this.go(e.simple_token)]}token_expr_pickwith(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"pickwith"}),...this.go(e.simple_token)]}token_expr_random(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"random"}),...this.go(e.simple_token)]}token_expr_randomwith(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"randomwith"}),...this.go(e.simple_token)]}token_expr_run(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"run"}),...this.go(e.string_token)]}token_expr_runwith(e,t){return[...this.createcodenode(t,{type:12,literal:1,value:"runwith"}),...this.go(e.simple_token),...this.go(e.string_token)]}token_expr(e,t){return e.token_expr_aligned?this.createcodenode(t,{type:12,literal:1,value:"aligned"}):e.token_contact?this.createcodenode(t,{type:12,literal:1,value:"contact"}):e.token_expr_any?this.go(e.token_expr_any):e.token_expr_count?this.go(e.token_expr_count):e.token_expr_blocked?this.go(e.token_expr_blocked):e.token_expr_abs?this.go(e.token_expr_abs):e.token_expr_intceil?this.go(e.token_expr_intceil):e.token_expr_intfloor?this.go(e.token_expr_intfloor):e.token_expr_intround?this.go(e.token_expr_intround):e.token_expr_clamp?this.go(e.token_expr_clamp):e.token_expr_min?this.go(e.token_expr_min):e.token_expr_max?this.go(e.token_expr_max):e.token_expr_pick?this.go(e.token_expr_pick):e.token_expr_pickwith?this.go(e.token_expr_pickwith):e.token_expr_random?this.go(e.token_expr_random):e.token_expr_randomwith?this.go(e.token_expr_randomwith):e.token_expr_run?this.go(e.token_expr_run):e.token_expr_runwith?this.go(e.token_expr_runwith):[]}string_token(e,t){if(e.token_stringliteraldouble){const r=Vo(e.token_stringliteraldouble,"");return this.createcodenode(t,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Vo(e.token_stringliteral,"");return this.createcodenode(t,{type:12,literal:1,value:r})}return[]}simple_token(e,t){if(e.token_stringliteraldouble){const r=Vo(e.token_stringliteraldouble,"");return this.createcodenode(t,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Vo(e.token_stringliteral,"");return this.createcodenode(t,{type:12,literal:1,value:r})}if(e.token_numberliteral){const r=parseFloat(Vo(e.token_numberliteral,"0"));return this.createcodenode(t,{type:12,literal:0,value:r})}return e.color?this.go(e.color):[]}token(e,t){if(e.category)return this.go(e.category);if(e.collision)return this.go(e.collision);if(e.color)return this.go(e.color);if(e.dir)return this.go(e.dir);if(e.command_play)return this.go(e.command_play);if(e.command_toast)return this.go(e.command_toast);if(e.command_ticker)return this.go(e.command_ticker);if(e.token_label){const r=Vo(e.token_label,"");return this.createcodenode(t,{type:12,literal:1,value:r})}if(e.token_stringliteraldouble){const r=Vo(e.token_stringliteraldouble,"");return this.createcodenode(t,{type:12,literal:2,value:r})}if(e.token_stringliteral){const r=Vo(e.token_stringliteral,"");return this.createcodenode(t,{type:12,literal:1,value:r})}if(e.token_numberliteral){const r=parseFloat(Vo(e.token_numberliteral,"0"));return this.createcodenode(t,{type:12,literal:0,value:r})}if(e.token_lparen)return[this.createexprnodeondemand(this.go(e.expr),t)];if(e.token_stop){const r=Vo(e.token_stop,"");return this.createcodenode(t,{type:12,literal:1,value:r})}return[]}}const ATe=new wTe;function e4(n){if(!n||n.type===void 0)return;const e=[{start:n.startOffset,end:n.endOffset??0}];return Object.keys(n).forEach(t=>{if(t!=="parent"){const r=n[t];sr(r)?r.forEach(i=>{e.push(e4(i))}):e.push(e4(r))}}),n.range={start:Math.min(...e.filter(t=>t).map(t=>t?.start??0)),end:Math.max(...e.filter(t=>t).map(t=>t?.end??0))},n.range}function QZ(n){const e=VZ(`${n}
`);if(e.errors.length>0)return e;CE.input=e.tokens;const t=CE.program();if(CE.errors.length>0)return{tokens:e.tokens,errors:CE.errors.map(i=>({offset:i.token.startOffset,line:i.token.startLine,column:i.token.startColumn,length:i.token.image.length,message:i.message}))};const[r]=ATe.go(t);return r?(e4(r),{tokens:e.tokens,cst:t,ast:r}):{tokens:e.tokens,cst:t,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]}}var XT={},iP={},sP={},oP={},yj;function CTe(){if(yj)return oP;yj=1;const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return oP.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},oP}var bj;function eJ(){if(bj)return sP;bj=1;const n=CTe(),e=5,t=1<<e,r=t-1,i=t;function s(o){return o<0?(-o<<1)+1:(o<<1)+0}return sP.encode=function(a){let c="",l,u=s(a);do l=u&r,u>>>=e,u>0&&(l|=i),c+=n.encode(l);while(u>0);return c},sP}var Qd={},Qy={},Cw={exports:{}};var RTe=Cw.exports,Sj;function kTe(){return Sj||(Sj=1,(function(n,e){(function(t){var r=e&&!e.nodeType&&e,i=n&&!n.nodeType&&n,s=typeof sd=="object"&&sd;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,c=36,l=1,u=26,h=38,f=700,d=72,p=128,m="-",_=/^xn--/,v=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},T=c-l,w=Math.floor,R=String.fromCharCode,C;function N(Q){throw new RangeError(b[Q])}function U(Q,z){for(var q=Q.length,ee=[];q--;)ee[q]=z(Q[q]);return ee}function B(Q,z){var q=Q.split("@"),ee="";q.length>1&&(ee=q[0]+"@",Q=q[1]),Q=Q.replace(S,".");var te=Q.split("."),ie=U(te,z).join(".");return ee+ie}function $(Q){for(var z=[],q=0,ee=Q.length,te,ie;q<ee;)te=Q.charCodeAt(q++),te>=55296&&te<=56319&&q<ee?(ie=Q.charCodeAt(q++),(ie&64512)==56320?z.push(((te&1023)<<10)+(ie&1023)+65536):(z.push(te),q--)):z.push(te);return z}function I(Q){return U(Q,function(z){var q="";return z>65535&&(z-=65536,q+=R(z>>>10&1023|55296),z=56320|z&1023),q+=R(z),q}).join("")}function L(Q){return Q-48<10?Q-22:Q-65<26?Q-65:Q-97<26?Q-97:c}function P(Q,z){return Q+22+75*(Q<26)-((z!=0)<<5)}function H(Q,z,q){var ee=0;for(Q=q?w(Q/f):Q>>1,Q+=w(Q/z);Q>T*u>>1;ee+=c)Q=w(Q/T);return w(ee+(T+1)*Q/(Q+h))}function X(Q){var z=[],q=Q.length,ee,te=0,ie=p,Ee=d,Re,Te,Pe,We,it,ht,vt,re,Le;for(Re=Q.lastIndexOf(m),Re<0&&(Re=0),Te=0;Te<Re;++Te)Q.charCodeAt(Te)>=128&&N("not-basic"),z.push(Q.charCodeAt(Te));for(Pe=Re>0?Re+1:0;Pe<q;){for(We=te,it=1,ht=c;Pe>=q&&N("invalid-input"),vt=L(Q.charCodeAt(Pe++)),(vt>=c||vt>w((a-te)/it))&&N("overflow"),te+=vt*it,re=ht<=Ee?l:ht>=Ee+u?u:ht-Ee,!(vt<re);ht+=c)Le=c-re,it>w(a/Le)&&N("overflow"),it*=Le;ee=z.length+1,Ee=H(te-We,ee,We==0),w(te/ee)>a-ie&&N("overflow"),ie+=w(te/ee),te%=ee,z.splice(te++,0,ie)}return I(z)}function G(Q){var z,q,ee,te,ie,Ee,Re,Te,Pe,We,it,ht=[],vt,re,Le,$e;for(Q=$(Q),vt=Q.length,z=p,q=0,ie=d,Ee=0;Ee<vt;++Ee)it=Q[Ee],it<128&&ht.push(R(it));for(ee=te=ht.length,te&&ht.push(m);ee<vt;){for(Re=a,Ee=0;Ee<vt;++Ee)it=Q[Ee],it>=z&&it<Re&&(Re=it);for(re=ee+1,Re-z>w((a-q)/re)&&N("overflow"),q+=(Re-z)*re,z=Re,Ee=0;Ee<vt;++Ee)if(it=Q[Ee],it<z&&++q>a&&N("overflow"),it==z){for(Te=q,Pe=c;We=Pe<=ie?l:Pe>=ie+u?u:Pe-ie,!(Te<We);Pe+=c)$e=Te-We,Le=c-We,ht.push(R(P(We+$e%Le,0))),Te=w($e/Le);ht.push(R(P(Te,0))),ie=H(q,re,ee==te),q=0,++ee}++q,++z}return ht.join("")}function Y(Q){return B(Q,function(z){return _.test(z)?X(z.slice(4).toLowerCase()):z})}function J(Q){return B(Q,function(z){return v.test(z)?"xn--"+G(z):z})}if(o={version:"1.4.1",ucs2:{decode:$,encode:I},decode:X,encode:G,toASCII:J,toUnicode:Y},r&&i)if(n.exports==r)i.exports=o;else for(C in o)o.hasOwnProperty(C)&&(r[C]=o[C]);else t.punycode=o})(RTe)})(Cw,Cw.exports)),Cw.exports}var aP,Ej;function Hx(){return Ej||(Ej=1,aP=TypeError),aP}const MTe={},ITe=Object.freeze(Object.defineProperty({__proto__:null,default:MTe},Symbol.toStringTag,{value:"Module"})),OTe=nW(ITe);var cP,xj;function kO(){if(xj)return cP;xj=1;var n=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=n&&e&&typeof e.get=="function"?e.get:null,r=n&&Map.prototype.forEach,i=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=i&&s&&typeof s.get=="function"?s.get:null,a=i&&Set.prototype.forEach,c=typeof WeakMap=="function"&&WeakMap.prototype,l=c?WeakMap.prototype.has:null,u=typeof WeakSet=="function"&&WeakSet.prototype,h=u?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,d=f?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,m=Object.prototype.toString,_=Function.prototype.toString,v=String.prototype.match,S=String.prototype.slice,b=String.prototype.replace,T=String.prototype.toUpperCase,w=String.prototype.toLowerCase,R=RegExp.prototype.test,C=Array.prototype.concat,N=Array.prototype.join,U=Array.prototype.slice,B=Math.floor,$=typeof BigInt=="function"?BigInt.prototype.valueOf:null,I=Object.getOwnPropertySymbols,L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,P=typeof Symbol=="function"&&typeof Symbol.iterator=="object",H=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||!0)?Symbol.toStringTag:null,X=Object.prototype.propertyIsEnumerable,G=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(ye){return ye.__proto__}:null);function Y(ye,_e){if(ye===1/0||ye===-1/0||ye!==ye||ye&&ye>-1e3&&ye<1e3||R.call(/e/,_e))return _e;var Ye=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof ye=="number"){var ke=ye<0?-B(-ye):B(ye);if(ke!==ye){var Ve=String(ke),Fe=S.call(_e,Ve.length+1);return b.call(Ve,Ye,"$&_")+"."+b.call(b.call(Fe,/([0-9]{3})/g,"$&_"),/_$/,"")}}return b.call(_e,Ye,"$&_")}var J=OTe,Q=J.custom,z=re(Q)?Q:null,q={__proto__:null,double:'"',single:"'"},ee={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};cP=function ye(_e,Ye,ke,Ve){var Fe=Ye||{};if(De(Fe,"quoteStyle")&&!De(q,Fe.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(De(Fe,"maxStringLength")&&(typeof Fe.maxStringLength=="number"?Fe.maxStringLength<0&&Fe.maxStringLength!==1/0:Fe.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Ge=De(Fe,"customInspect")?Fe.customInspect:!0;if(typeof Ge!="boolean"&&Ge!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(De(Fe,"indent")&&Fe.indent!==null&&Fe.indent!=="	"&&!(parseInt(Fe.indent,10)===Fe.indent&&Fe.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(De(Fe,"numericSeparator")&&typeof Fe.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var at=Fe.numericSeparator;if(typeof _e>"u")return"undefined";if(_e===null)return"null";if(typeof _e=="boolean")return _e?"true":"false";if(typeof _e=="string")return Ut(_e,Fe);if(typeof _e=="number"){if(_e===0)return 1/0/_e>0?"0":"-0";var Be=String(_e);return at?Y(_e,Be):Be}if(typeof _e=="bigint"){var tt=String(_e)+"n";return at?Y(_e,tt):tt}var rt=typeof Fe.depth>"u"?5:Fe.depth;if(typeof ke>"u"&&(ke=0),ke>=rt&&rt>0&&typeof _e=="object")return Re(_e)?"[Array]":"[Object]";var xt=oe(Fe,ke);if(typeof Ve>"u")Ve=[];else if(ve(Ve,_e)>=0)return"[Circular]";function ot(Yi,os,as){if(os&&(Ve=U.call(Ve),Ve.push(os)),as){var je={depth:Fe.depth};return De(Fe,"quoteStyle")&&(je.quoteStyle=Fe.quoteStyle),ye(Yi,je,ke+1,Ve)}return ye(Yi,Fe,ke+1,Ve)}if(typeof _e=="function"&&!Pe(_e)){var tn=ae(_e),ln=Ae(_e,ot);return"[Function"+(tn?": "+tn:" (anonymous)")+"]"+(ln.length>0?" { "+N.call(ln,", ")+" }":"")}if(re(_e)){var Rt=P?b.call(String(_e),/^(Symbol\(.*\))_[^)]*$/,"$1"):L.call(_e);return typeof _e=="object"&&!P?At(Rt):Rt}if(et(_e)){for(var $t="<"+w.call(String(_e.nodeName)),mt=_e.attributes||[],Zt=0;Zt<mt.length;Zt++)$t+=" "+mt[Zt].name+"="+te(ie(mt[Zt].value),"double",Fe);return $t+=">",_e.childNodes&&_e.childNodes.length&&($t+="..."),$t+="</"+w.call(String(_e.nodeName))+">",$t}if(Re(_e)){if(_e.length===0)return"[]";var wn=Ae(_e,ot);return xt&&!W(wn)?"["+Se(wn,xt)+"]":"[ "+N.call(wn,", ")+" ]"}if(We(_e)){var qt=Ae(_e,ot);return!("cause"in Error.prototype)&&"cause"in _e&&!X.call(_e,"cause")?"{ ["+String(_e)+"] "+N.call(C.call("[cause]: "+ot(_e.cause),qt),", ")+" }":qt.length===0?"["+String(_e)+"]":"{ ["+String(_e)+"] "+N.call(qt,", ")+" }"}if(typeof _e=="object"&&Ge){if(z&&typeof _e[z]=="function"&&J)return J(_e,{depth:rt-ke});if(Ge!=="symbol"&&typeof _e.inspect=="function")return _e.inspect()}if(xe(_e)){var An=[];return r&&r.call(_e,function(Yi,os){An.push(ot(os,_e,!0)+" => "+ot(Yi,_e))}),se("Map",t.call(_e),An,xt)}if(Je(_e)){var Ln=[];return a&&a.call(_e,function(Yi){Ln.push(ot(Yi,_e))}),se("Set",o.call(_e),Ln,xt)}if(pe(_e))return Ce("WeakMap");if(Xe(_e))return Ce("WeakSet");if(ze(_e))return Ce("WeakRef");if(ht(_e))return At(ot(Number(_e)));if(Le(_e))return At(ot($.call(_e)));if(vt(_e))return At(p.call(_e));if(it(_e))return At(ot(String(_e)));if(typeof window<"u"&&_e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&_e===globalThis||typeof sd<"u"&&_e===sd)return"{ [object globalThis] }";if(!Te(_e)&&!Pe(_e)){var mr=Ae(_e,ot),is=G?G(_e)===Object.prototype:_e instanceof Object||_e.constructor===Object,hi=_e instanceof Object?"":"null prototype",ti=!is&&H&&Object(_e)===_e&&H in _e?S.call(Oe(_e),8,-1):hi?"Object":"",ji=is||typeof _e.constructor!="function"?"":_e.constructor.name?_e.constructor.name+" ":"",ss=ji+(ti||hi?"["+N.call(C.call([],ti||[],hi||[]),": ")+"] ":"");return mr.length===0?ss+"{}":xt?ss+"{"+Se(mr,xt)+"}":ss+"{ "+N.call(mr,", ")+" }"}return String(_e)};function te(ye,_e,Ye){var ke=Ye.quoteStyle||_e,Ve=q[ke];return Ve+ye+Ve}function ie(ye){return b.call(String(ye),/"/g,"&quot;")}function Ee(ye){return!H||!(typeof ye=="object"&&(H in ye||typeof ye[H]<"u"))}function Re(ye){return Oe(ye)==="[object Array]"&&Ee(ye)}function Te(ye){return Oe(ye)==="[object Date]"&&Ee(ye)}function Pe(ye){return Oe(ye)==="[object RegExp]"&&Ee(ye)}function We(ye){return Oe(ye)==="[object Error]"&&Ee(ye)}function it(ye){return Oe(ye)==="[object String]"&&Ee(ye)}function ht(ye){return Oe(ye)==="[object Number]"&&Ee(ye)}function vt(ye){return Oe(ye)==="[object Boolean]"&&Ee(ye)}function re(ye){if(P)return ye&&typeof ye=="object"&&ye instanceof Symbol;if(typeof ye=="symbol")return!0;if(!ye||typeof ye!="object"||!L)return!1;try{return L.call(ye),!0}catch{}return!1}function Le(ye){if(!ye||typeof ye!="object"||!$)return!1;try{return $.call(ye),!0}catch{}return!1}var $e=Object.prototype.hasOwnProperty||function(ye){return ye in this};function De(ye,_e){return $e.call(ye,_e)}function Oe(ye){return m.call(ye)}function ae(ye){if(ye.name)return ye.name;var _e=v.call(_.call(ye),/^function\s*([\w$]+)/);return _e?_e[1]:null}function ve(ye,_e){if(ye.indexOf)return ye.indexOf(_e);for(var Ye=0,ke=ye.length;Ye<ke;Ye++)if(ye[Ye]===_e)return Ye;return-1}function xe(ye){if(!t||!ye||typeof ye!="object")return!1;try{t.call(ye);try{o.call(ye)}catch{return!0}return ye instanceof Map}catch{}return!1}function pe(ye){if(!l||!ye||typeof ye!="object")return!1;try{l.call(ye,l);try{h.call(ye,h)}catch{return!0}return ye instanceof WeakMap}catch{}return!1}function ze(ye){if(!d||!ye||typeof ye!="object")return!1;try{return d.call(ye),!0}catch{}return!1}function Je(ye){if(!o||!ye||typeof ye!="object")return!1;try{o.call(ye);try{t.call(ye)}catch{return!0}return ye instanceof Set}catch{}return!1}function Xe(ye){if(!h||!ye||typeof ye!="object")return!1;try{h.call(ye,h);try{l.call(ye,l)}catch{return!0}return ye instanceof WeakSet}catch{}return!1}function et(ye){return!ye||typeof ye!="object"?!1:typeof HTMLElement<"u"&&ye instanceof HTMLElement?!0:typeof ye.nodeName=="string"&&typeof ye.getAttribute=="function"}function Ut(ye,_e){if(ye.length>_e.maxStringLength){var Ye=ye.length-_e.maxStringLength,ke="... "+Ye+" more character"+(Ye>1?"s":"");return Ut(S.call(ye,0,_e.maxStringLength),_e)+ke}var Ve=ee[_e.quoteStyle||"single"];Ve.lastIndex=0;var Fe=b.call(b.call(ye,Ve,"\\$1"),/[\x00-\x1f]/g,gt);return te(Fe,"single",_e)}function gt(ye){var _e=ye.charCodeAt(0),Ye={8:"b",9:"t",10:"n",12:"f",13:"r"}[_e];return Ye?"\\"+Ye:"\\x"+(_e<16?"0":"")+T.call(_e.toString(16))}function At(ye){return"Object("+ye+")"}function Ce(ye){return ye+" { ? }"}function se(ye,_e,Ye,ke){var Ve=ke?Se(Ye,ke):N.call(Ye,", ");return ye+" ("+_e+") {"+Ve+"}"}function W(ye){for(var _e=0;_e<ye.length;_e++)if(ve(ye[_e],`
`)>=0)return!1;return!0}function oe(ye,_e){var Ye;if(ye.indent==="	")Ye="	";else if(typeof ye.indent=="number"&&ye.indent>0)Ye=N.call(Array(ye.indent+1)," ");else return null;return{base:Ye,prev:N.call(Array(_e+1),Ye)}}function Se(ye,_e){if(ye.length===0)return"";var Ye=`
`+_e.prev+_e.base;return Ye+N.call(ye,","+Ye)+`
`+_e.prev}function Ae(ye,_e){var Ye=Re(ye),ke=[];if(Ye){ke.length=ye.length;for(var Ve=0;Ve<ye.length;Ve++)ke[Ve]=De(ye,Ve)?_e(ye[Ve],ye):""}var Fe=typeof I=="function"?I(ye):[],Ge;if(P){Ge={};for(var at=0;at<Fe.length;at++)Ge["$"+Fe[at]]=Fe[at]}for(var Be in ye)De(ye,Be)&&(Ye&&String(Number(Be))===Be&&Be<ye.length||P&&Ge["$"+Be]instanceof Symbol||(R.call(/[^\w$]/,Be)?ke.push(_e(Be,ye)+": "+_e(ye[Be],ye)):ke.push(Be+": "+_e(ye[Be],ye))));if(typeof I=="function")for(var tt=0;tt<Fe.length;tt++)X.call(ye,Fe[tt])&&ke.push("["+_e(Fe[tt])+"]: "+_e(ye[Fe[tt]],ye));return ke}return cP}var lP,Tj;function NTe(){if(Tj)return lP;Tj=1;var n=kO(),e=Hx(),t=function(a,c,l){for(var u=a,h;(h=u.next)!=null;u=h)if(h.key===c)return u.next=h.next,l||(h.next=a.next,a.next=h),h},r=function(a,c){if(a){var l=t(a,c);return l&&l.value}},i=function(a,c,l){var u=t(a,c);u?u.value=l:a.next={key:c,next:a.next,value:l}},s=function(a,c){return a?!!t(a,c):!1},o=function(a,c){if(a)return t(a,c,!0)};return lP=function(){var c,l={assert:function(u){if(!l.has(u))throw new e("Side channel does not contain "+n(u))},delete:function(u){var h=c&&c.next,f=o(c,u);return f&&h&&h===f&&(c=void 0),!!f},get:function(u){return r(c,u)},has:function(u){return s(c,u)},set:function(u,h){c||(c={next:void 0}),i(c,u,h)}};return l},lP}var uP,wj;function tJ(){return wj||(wj=1,uP=Object),uP}var hP,Aj;function PTe(){return Aj||(Aj=1,hP=Error),hP}var fP,Cj;function DTe(){return Cj||(Cj=1,fP=EvalError),fP}var dP,Rj;function LTe(){return Rj||(Rj=1,dP=RangeError),dP}var pP,kj;function UTe(){return kj||(kj=1,pP=ReferenceError),pP}var mP,Mj;function BTe(){return Mj||(Mj=1,mP=SyntaxError),mP}var gP,Ij;function FTe(){return Ij||(Ij=1,gP=URIError),gP}var _P,Oj;function jTe(){return Oj||(Oj=1,_P=Math.abs),_P}var vP,Nj;function zTe(){return Nj||(Nj=1,vP=Math.floor),vP}var yP,Pj;function $Te(){return Pj||(Pj=1,yP=Math.max),yP}var bP,Dj;function VTe(){return Dj||(Dj=1,bP=Math.min),bP}var SP,Lj;function HTe(){return Lj||(Lj=1,SP=Math.pow),SP}var EP,Uj;function GTe(){return Uj||(Uj=1,EP=Math.round),EP}var xP,Bj;function WTe(){return Bj||(Bj=1,xP=Number.isNaN||function(e){return e!==e}),xP}var TP,Fj;function qTe(){if(Fj)return TP;Fj=1;var n=WTe();return TP=function(t){return n(t)||t===0?t:t<0?-1:1},TP}var wP,jj;function YTe(){return jj||(jj=1,wP=Object.getOwnPropertyDescriptor),wP}var AP,zj;function nJ(){if(zj)return AP;zj=1;var n=YTe();if(n)try{n([],"length")}catch{n=null}return AP=n,AP}var CP,$j;function KTe(){if($j)return CP;$j=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return CP=n,CP}var RP,Vj;function XTe(){return Vj||(Vj=1,RP=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),RP}var kP,Hj;function ZTe(){if(Hj)return kP;Hj=1;var n=typeof Symbol<"u"&&Symbol,e=XTe();return kP=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},kP}var MP,Gj;function rJ(){return Gj||(Gj=1,MP=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),MP}var IP,Wj;function iJ(){if(Wj)return IP;Wj=1;var n=tJ();return IP=n.getPrototypeOf||null,IP}var OP,qj;function JTe(){if(qj)return OP;qj=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",i=function(c,l){for(var u=[],h=0;h<c.length;h+=1)u[h]=c[h];for(var f=0;f<l.length;f+=1)u[f+c.length]=l[f];return u},s=function(c,l){for(var u=[],h=l,f=0;h<c.length;h+=1,f+=1)u[f]=c[h];return u},o=function(a,c){for(var l="",u=0;u<a.length;u+=1)l+=a[u],u+1<a.length&&(l+=c);return l};return OP=function(c){var l=this;if(typeof l!="function"||e.apply(l)!==r)throw new TypeError(n+l);for(var u=s(arguments,1),h,f=function(){if(this instanceof h){var v=l.apply(this,i(u,arguments));return Object(v)===v?v:this}return l.apply(c,i(u,arguments))},d=t(0,l.length-u.length),p=[],m=0;m<d;m++)p[m]="$"+m;if(h=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(f),l.prototype){var _=function(){};_.prototype=l.prototype,h.prototype=new _,_.prototype=null}return h},OP}var NP,Yj;function MO(){if(Yj)return NP;Yj=1;var n=JTe();return NP=Function.prototype.bind||n,NP}var PP,Kj;function $6(){return Kj||(Kj=1,PP=Function.prototype.call),PP}var DP,Xj;function sJ(){return Xj||(Xj=1,DP=Function.prototype.apply),DP}var LP,Zj;function QTe(){return Zj||(Zj=1,LP=typeof Reflect<"u"&&Reflect&&Reflect.apply),LP}var UP,Jj;function ewe(){if(Jj)return UP;Jj=1;var n=MO(),e=sJ(),t=$6(),r=QTe();return UP=r||n.call(t,e),UP}var BP,Qj;function oJ(){if(Qj)return BP;Qj=1;var n=MO(),e=Hx(),t=$6(),r=ewe();return BP=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return r(n,t,s)},BP}var FP,ez;function twe(){if(ez)return FP;ez=1;var n=oJ(),e=nJ(),t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,s=i.getPrototypeOf;return FP=r&&typeof r.get=="function"?n([r.get]):typeof s=="function"?function(a){return s(a==null?a:i(a))}:!1,FP}var jP,tz;function nwe(){if(tz)return jP;tz=1;var n=rJ(),e=iJ(),t=twe();return jP=n?function(i){return n(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,jP}var zP,nz;function rwe(){if(nz)return zP;nz=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=MO();return zP=t.call(n,e),zP}var $P,rz;function V6(){if(rz)return $P;rz=1;var n,e=tJ(),t=PTe(),r=DTe(),i=LTe(),s=UTe(),o=BTe(),a=Hx(),c=FTe(),l=jTe(),u=zTe(),h=$Te(),f=VTe(),d=HTe(),p=GTe(),m=qTe(),_=Function,v=function(Pe){try{return _('"use strict"; return ('+Pe+").constructor;")()}catch{}},S=nJ(),b=KTe(),T=function(){throw new a},w=S?(function(){try{return arguments.callee,T}catch{try{return S(arguments,"callee").get}catch{return T}}})():T,R=ZTe()(),C=nwe(),N=iJ(),U=rJ(),B=sJ(),$=$6(),I={},L=typeof Uint8Array>"u"||!C?n:C(Uint8Array),P={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":R&&C?C([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":I,"%AsyncGenerator%":I,"%AsyncGeneratorFunction%":I,"%AsyncIteratorPrototype%":I,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":_,"%GeneratorFunction%":I,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":R&&C?C(C([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!R||!C?n:C(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":S,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":i,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!R||!C?n:C(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":R&&C?C(""[Symbol.iterator]()):n,"%Symbol%":R?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":w,"%TypedArray%":L,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":$,"%Function.prototype.apply%":B,"%Object.defineProperty%":b,"%Object.getPrototypeOf%":N,"%Math.abs%":l,"%Math.floor%":u,"%Math.max%":h,"%Math.min%":f,"%Math.pow%":d,"%Math.round%":p,"%Math.sign%":m,"%Reflect.getPrototypeOf%":U};if(C)try{null.error}catch(Pe){var H=C(C(Pe));P["%Error.prototype%"]=H}var X=function Pe(We){var it;if(We==="%AsyncFunction%")it=v("async function () {}");else if(We==="%GeneratorFunction%")it=v("function* () {}");else if(We==="%AsyncGeneratorFunction%")it=v("async function* () {}");else if(We==="%AsyncGenerator%"){var ht=Pe("%AsyncGeneratorFunction%");ht&&(it=ht.prototype)}else if(We==="%AsyncIteratorPrototype%"){var vt=Pe("%AsyncGenerator%");vt&&C&&(it=C(vt.prototype))}return P[We]=it,it},G={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Y=MO(),J=rwe(),Q=Y.call($,Array.prototype.concat),z=Y.call(B,Array.prototype.splice),q=Y.call($,String.prototype.replace),ee=Y.call($,String.prototype.slice),te=Y.call($,RegExp.prototype.exec),ie=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ee=/\\(\\)?/g,Re=function(We){var it=ee(We,0,1),ht=ee(We,-1);if(it==="%"&&ht!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(ht==="%"&&it!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var vt=[];return q(We,ie,function(re,Le,$e,De){vt[vt.length]=$e?q(De,Ee,"$1"):Le||re}),vt},Te=function(We,it){var ht=We,vt;if(J(G,ht)&&(vt=G[ht],ht="%"+vt[0]+"%"),J(P,ht)){var re=P[ht];if(re===I&&(re=X(ht)),typeof re>"u"&&!it)throw new a("intrinsic "+We+" exists, but is not available. Please file an issue!");return{alias:vt,name:ht,value:re}}throw new o("intrinsic "+We+" does not exist!")};return $P=function(We,it){if(typeof We!="string"||We.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof it!="boolean")throw new a('"allowMissing" argument must be a boolean');if(te(/^%?[^%]*%?$/,We)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ht=Re(We),vt=ht.length>0?ht[0]:"",re=Te("%"+vt+"%",it),Le=re.name,$e=re.value,De=!1,Oe=re.alias;Oe&&(vt=Oe[0],z(ht,Q([0,1],Oe)));for(var ae=1,ve=!0;ae<ht.length;ae+=1){var xe=ht[ae],pe=ee(xe,0,1),ze=ee(xe,-1);if((pe==='"'||pe==="'"||pe==="`"||ze==='"'||ze==="'"||ze==="`")&&pe!==ze)throw new o("property names with quotes must have matching quotes");if((xe==="constructor"||!ve)&&(De=!0),vt+="."+xe,Le="%"+vt+"%",J(P,Le))$e=P[Le];else if($e!=null){if(!(xe in $e)){if(!it)throw new a("base intrinsic for "+We+" exists, but the property is not available.");return}if(S&&ae+1>=ht.length){var Je=S($e,xe);ve=!!Je,ve&&"get"in Je&&!("originalValue"in Je.get)?$e=Je.get:$e=$e[xe]}else ve=J($e,xe),$e=$e[xe];ve&&!De&&(P[Le]=$e)}}return $e},$P}var VP,iz;function aJ(){if(iz)return VP;iz=1;var n=V6(),e=oJ(),t=e([n("%String.prototype.indexOf%")]);return VP=function(i,s){var o=n(i,!!s);return typeof o=="function"&&t(i,".prototype.")>-1?e([o]):o},VP}var HP,sz;function cJ(){if(sz)return HP;sz=1;var n=V6(),e=aJ(),t=kO(),r=Hx(),i=n("%Map%",!0),s=e("Map.prototype.get",!0),o=e("Map.prototype.set",!0),a=e("Map.prototype.has",!0),c=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return HP=!!i&&function(){var h,f={assert:function(d){if(!f.has(d))throw new r("Side channel does not contain "+t(d))},delete:function(d){if(h){var p=c(h,d);return l(h)===0&&(h=void 0),p}return!1},get:function(d){if(h)return s(h,d)},has:function(d){return h?a(h,d):!1},set:function(d,p){h||(h=new i),o(h,d,p)}};return f},HP}var GP,oz;function iwe(){if(oz)return GP;oz=1;var n=V6(),e=aJ(),t=kO(),r=cJ(),i=Hx(),s=n("%WeakMap%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),c=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return GP=s?function(){var h,f,d={assert:function(p){if(!d.has(p))throw new i("Side channel does not contain "+t(p))},delete:function(p){if(s&&p&&(typeof p=="object"||typeof p=="function")){if(h)return l(h,p)}else if(r&&f)return f.delete(p);return!1},get:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?o(h,p):f&&f.get(p)},has:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?c(h,p):!!f&&f.has(p)},set:function(p,m){s&&p&&(typeof p=="object"||typeof p=="function")?(h||(h=new s),a(h,p,m)):r&&(f||(f=r()),f.set(p,m))}};return d}:r,GP}var WP,az;function lJ(){if(az)return WP;az=1;var n=Hx(),e=kO(),t=NTe(),r=cJ(),i=iwe(),s=i||r||t;return WP=function(){var a,c={assert:function(l){if(!c.has(l))throw new n("Side channel does not contain "+e(l))},delete:function(l){return!!a&&a.delete(l)},get:function(l){return a&&a.get(l)},has:function(l){return!!a&&a.has(l)},set:function(l,u){a||(a=s()),a.set(l,u)}};return c},WP}var qP,cz;function H6(){if(cz)return qP;cz=1;var n=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return qP={default:t.RFC3986,formatters:{RFC1738:function(r){return n.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},qP}var YP,lz;function uJ(){if(lz)return YP;lz=1;var n=H6(),e=lJ(),t=Object.prototype.hasOwnProperty,r=Array.isArray,i=e(),s=function(C,N){return i.set(C,N),C},o=function(C){return i.has(C)},a=function(C){return i.get(C)},c=function(C,N){i.set(C,N)},l=(function(){for(var R=[],C=0;C<256;++C)R.push("%"+((C<16?"0":"")+C.toString(16)).toUpperCase());return R})(),u=function(C){for(;C.length>1;){var N=C.pop(),U=N.obj[N.prop];if(r(U)){for(var B=[],$=0;$<U.length;++$)typeof U[$]<"u"&&B.push(U[$]);N.obj[N.prop]=B}}},h=function(C,N){for(var U=N&&N.plainObjects?{__proto__:null}:{},B=0;B<C.length;++B)typeof C[B]<"u"&&(U[B]=C[B]);return U},f=function R(C,N,U){if(!N)return C;if(typeof N!="object"&&typeof N!="function"){if(r(C))C.push(N);else if(C&&typeof C=="object")if(o(C)){var B=a(C)+1;C[B]=N,c(C,B)}else(U&&(U.plainObjects||U.allowPrototypes)||!t.call(Object.prototype,N))&&(C[N]=!0);else return[C,N];return C}if(!C||typeof C!="object"){if(o(N)){for(var $=Object.keys(N),I=U&&U.plainObjects?{__proto__:null,0:C}:{0:C},L=0;L<$.length;L++){var P=parseInt($[L],10);I[P+1]=N[$[L]]}return s(I,a(N)+1)}return[C].concat(N)}var H=C;return r(C)&&!r(N)&&(H=h(C,U)),r(C)&&r(N)?(N.forEach(function(X,G){if(t.call(C,G)){var Y=C[G];Y&&typeof Y=="object"&&X&&typeof X=="object"?C[G]=R(Y,X,U):C.push(X)}else C[G]=X}),C):Object.keys(N).reduce(function(X,G){var Y=N[G];return t.call(X,G)?X[G]=R(X[G],Y,U):X[G]=Y,X},H)},d=function(C,N){return Object.keys(N).reduce(function(U,B){return U[B]=N[B],U},C)},p=function(R,C,N){var U=R.replace(/\+/g," ");if(N==="iso-8859-1")return U.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(U)}catch{return U}},m=1024,_=function(C,N,U,B,$){if(C.length===0)return C;var I=C;if(typeof C=="symbol"?I=Symbol.prototype.toString.call(C):typeof C!="string"&&(I=String(C)),U==="iso-8859-1")return escape(I).replace(/%u[0-9a-f]{4}/gi,function(J){return"%26%23"+parseInt(J.slice(2),16)+"%3B"});for(var L="",P=0;P<I.length;P+=m){for(var H=I.length>=m?I.slice(P,P+m):I,X=[],G=0;G<H.length;++G){var Y=H.charCodeAt(G);if(Y===45||Y===46||Y===95||Y===126||Y>=48&&Y<=57||Y>=65&&Y<=90||Y>=97&&Y<=122||$===n.RFC1738&&(Y===40||Y===41)){X[X.length]=H.charAt(G);continue}if(Y<128){X[X.length]=l[Y];continue}if(Y<2048){X[X.length]=l[192|Y>>6]+l[128|Y&63];continue}if(Y<55296||Y>=57344){X[X.length]=l[224|Y>>12]+l[128|Y>>6&63]+l[128|Y&63];continue}G+=1,Y=65536+((Y&1023)<<10|H.charCodeAt(G)&1023),X[X.length]=l[240|Y>>18]+l[128|Y>>12&63]+l[128|Y>>6&63]+l[128|Y&63]}L+=X.join("")}return L},v=function(C){for(var N=[{obj:{o:C},prop:"o"}],U=[],B=0;B<N.length;++B)for(var $=N[B],I=$.obj[$.prop],L=Object.keys(I),P=0;P<L.length;++P){var H=L[P],X=I[H];typeof X=="object"&&X!==null&&U.indexOf(X)===-1&&(N.push({obj:I,prop:H}),U.push(X))}return u(N),C},S=function(C){return Object.prototype.toString.call(C)==="[object RegExp]"},b=function(C){return!C||typeof C!="object"?!1:!!(C.constructor&&C.constructor.isBuffer&&C.constructor.isBuffer(C))},T=function(C,N,U,B){if(o(C)){var $=a(C)+1;return C[$]=N,c(C,$),C}var I=[].concat(C,N);return I.length>U?s(h(I,{plainObjects:B}),I.length-1):I},w=function(C,N){if(r(C)){for(var U=[],B=0;B<C.length;B+=1)U.push(N(C[B]));return U}return N(C)};return YP={arrayToObject:h,assign:d,combine:T,compact:v,decode:p,encode:_,isBuffer:b,isOverflow:o,isRegExp:S,maybeMap:w,merge:f},YP}var KP,uz;function swe(){if(uz)return KP;uz=1;var n=lJ(),e=uJ(),t=H6(),r=Object.prototype.hasOwnProperty,i={brackets:function(_){return _+"[]"},comma:"comma",indices:function(_,v){return _+"["+v+"]"},repeat:function(_){return _}},s=Array.isArray,o=Array.prototype.push,a=function(m,_){o.apply(m,s(_)?_:[_])},c=Date.prototype.toISOString,l=t.default,u={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:t.formatters[l],indices:!1,serializeDate:function(_){return c.call(_)},skipNulls:!1,strictNullHandling:!1},h=function(_){return typeof _=="string"||typeof _=="number"||typeof _=="boolean"||typeof _=="symbol"||typeof _=="bigint"},f={},d=function m(_,v,S,b,T,w,R,C,N,U,B,$,I,L,P,H,X,G){for(var Y=_,J=G,Q=0,z=!1;(J=J.get(f))!==void 0&&!z;){var q=J.get(_);if(Q+=1,typeof q<"u"){if(q===Q)throw new RangeError("Cyclic object value");z=!0}typeof J.get(f)>"u"&&(Q=0)}if(typeof U=="function"?Y=U(v,Y):Y instanceof Date?Y=I(Y):S==="comma"&&s(Y)&&(Y=e.maybeMap(Y,function(Le){return Le instanceof Date?I(Le):Le})),Y===null){if(w)return N&&!H?N(v,u.encoder,X,"key",L):v;Y=""}if(h(Y)||e.isBuffer(Y)){if(N){var ee=H?v:N(v,u.encoder,X,"key",L);return[P(ee)+"="+P(N(Y,u.encoder,X,"value",L))]}return[P(v)+"="+P(String(Y))]}var te=[];if(typeof Y>"u")return te;var ie;if(S==="comma"&&s(Y))H&&N&&(Y=e.maybeMap(Y,N)),ie=[{value:Y.length>0?Y.join(",")||null:void 0}];else if(s(U))ie=U;else{var Ee=Object.keys(Y);ie=B?Ee.sort(B):Ee}var Re=C?String(v).replace(/\./g,"%2E"):String(v),Te=b&&s(Y)&&Y.length===1?Re+"[]":Re;if(T&&s(Y)&&Y.length===0)return Te+"[]";for(var Pe=0;Pe<ie.length;++Pe){var We=ie[Pe],it=typeof We=="object"&&We&&typeof We.value<"u"?We.value:Y[We];if(!(R&&it===null)){var ht=$&&C?String(We).replace(/\./g,"%2E"):String(We),vt=s(Y)?typeof S=="function"?S(Te,ht):Te:Te+($?"."+ht:"["+ht+"]");G.set(_,Q);var re=n();re.set(f,G),a(te,m(it,vt,S,b,T,w,R,C,S==="comma"&&H&&s(Y)?null:N,U,B,$,I,L,P,H,X,re))}}return te},p=function(_){if(!_)return u;if(typeof _.allowEmptyArrays<"u"&&typeof _.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof _.encodeDotInKeys<"u"&&typeof _.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(_.encoder!==null&&typeof _.encoder<"u"&&typeof _.encoder!="function")throw new TypeError("Encoder has to be a function.");var v=_.charset||u.charset;if(typeof _.charset<"u"&&_.charset!=="utf-8"&&_.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var S=t.default;if(typeof _.format<"u"){if(!r.call(t.formatters,_.format))throw new TypeError("Unknown format option provided.");S=_.format}var b=t.formatters[S],T=u.filter;(typeof _.filter=="function"||s(_.filter))&&(T=_.filter);var w;if(_.arrayFormat in i?w=_.arrayFormat:"indices"in _?w=_.indices?"indices":"repeat":w=u.arrayFormat,"commaRoundTrip"in _&&typeof _.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var R=typeof _.allowDots>"u"?_.encodeDotInKeys===!0?!0:u.allowDots:!!_.allowDots;return{addQueryPrefix:typeof _.addQueryPrefix=="boolean"?_.addQueryPrefix:u.addQueryPrefix,allowDots:R,allowEmptyArrays:typeof _.allowEmptyArrays=="boolean"?!!_.allowEmptyArrays:u.allowEmptyArrays,arrayFormat:w,charset:v,charsetSentinel:typeof _.charsetSentinel=="boolean"?_.charsetSentinel:u.charsetSentinel,commaRoundTrip:!!_.commaRoundTrip,delimiter:typeof _.delimiter>"u"?u.delimiter:_.delimiter,encode:typeof _.encode=="boolean"?_.encode:u.encode,encodeDotInKeys:typeof _.encodeDotInKeys=="boolean"?_.encodeDotInKeys:u.encodeDotInKeys,encoder:typeof _.encoder=="function"?_.encoder:u.encoder,encodeValuesOnly:typeof _.encodeValuesOnly=="boolean"?_.encodeValuesOnly:u.encodeValuesOnly,filter:T,format:S,formatter:b,serializeDate:typeof _.serializeDate=="function"?_.serializeDate:u.serializeDate,skipNulls:typeof _.skipNulls=="boolean"?_.skipNulls:u.skipNulls,sort:typeof _.sort=="function"?_.sort:null,strictNullHandling:typeof _.strictNullHandling=="boolean"?_.strictNullHandling:u.strictNullHandling}};return KP=function(m,_){var v=m,S=p(_),b,T;typeof S.filter=="function"?(T=S.filter,v=T("",v)):s(S.filter)&&(T=S.filter,b=T);var w=[];if(typeof v!="object"||v===null)return"";var R=i[S.arrayFormat],C=R==="comma"&&S.commaRoundTrip;b||(b=Object.keys(v)),S.sort&&b.sort(S.sort);for(var N=n(),U=0;U<b.length;++U){var B=b[U],$=v[B];S.skipNulls&&$===null||a(w,d($,B,R,C,S.allowEmptyArrays,S.strictNullHandling,S.skipNulls,S.encodeDotInKeys,S.encode?S.encoder:null,S.filter,S.sort,S.allowDots,S.serializeDate,S.format,S.formatter,S.encodeValuesOnly,S.charset,N))}var I=w.join(S.delimiter),L=S.addQueryPrefix===!0?"?":"";return S.charsetSentinel&&(S.charset==="iso-8859-1"?L+="utf8=%26%2310003%3B&":L+="utf8=%E2%9C%93&"),I.length>0?L+I:""},KP}var XP,hz;function owe(){if(hz)return XP;hz=1;var n=uJ(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:n.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},i=function(d){return d.replace(/&#(\d+);/g,function(p,m){return String.fromCharCode(parseInt(m,10))})},s=function(d,p,m){if(d&&typeof d=="string"&&p.comma&&d.indexOf(",")>-1)return d.split(",");if(p.throwOnLimitExceeded&&m>=p.arrayLimit)throw new RangeError("Array limit exceeded. Only "+p.arrayLimit+" element"+(p.arrayLimit===1?"":"s")+" allowed in an array.");return d},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",c=function(p,m){var _={__proto__:null},v=m.ignoreQueryPrefix?p.replace(/^\?/,""):p;v=v.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var S=m.parameterLimit===1/0?void 0:m.parameterLimit,b=v.split(m.delimiter,m.throwOnLimitExceeded?S+1:S);if(m.throwOnLimitExceeded&&b.length>S)throw new RangeError("Parameter limit exceeded. Only "+S+" parameter"+(S===1?"":"s")+" allowed.");var T=-1,w,R=m.charset;if(m.charsetSentinel)for(w=0;w<b.length;++w)b[w].indexOf("utf8=")===0&&(b[w]===a?R="utf-8":b[w]===o&&(R="iso-8859-1"),T=w,w=b.length);for(w=0;w<b.length;++w)if(w!==T){var C=b[w],N=C.indexOf("]="),U=N===-1?C.indexOf("="):N+1,B,$;if(U===-1?(B=m.decoder(C,r.decoder,R,"key"),$=m.strictNullHandling?null:""):(B=m.decoder(C.slice(0,U),r.decoder,R,"key"),B!==null&&($=n.maybeMap(s(C.slice(U+1),m,t(_[B])?_[B].length:0),function(L){return m.decoder(L,r.decoder,R,"value")}))),$&&m.interpretNumericEntities&&R==="iso-8859-1"&&($=i(String($))),C.indexOf("[]=")>-1&&($=t($)?[$]:$),B!==null){var I=e.call(_,B);I&&m.duplicates==="combine"?_[B]=n.combine(_[B],$,m.arrayLimit,m.plainObjects):(!I||m.duplicates==="last")&&(_[B]=$)}}return _},l=function(d,p,m,_){var v=0;if(d.length>0&&d[d.length-1]==="[]"){var S=d.slice(0,-1).join("");v=Array.isArray(p)&&p[S]?p[S].length:0}for(var b=_?p:s(p,m,v),T=d.length-1;T>=0;--T){var w,R=d[T];if(R==="[]"&&m.parseArrays)n.isOverflow(b)?w=b:w=m.allowEmptyArrays&&(b===""||m.strictNullHandling&&b===null)?[]:n.combine([],b,m.arrayLimit,m.plainObjects);else{w=m.plainObjects?{__proto__:null}:{};var C=R.charAt(0)==="["&&R.charAt(R.length-1)==="]"?R.slice(1,-1):R,N=m.decodeDotInKeys?C.replace(/%2E/g,"."):C,U=parseInt(N,10);!m.parseArrays&&N===""?w={0:b}:!isNaN(U)&&R!==N&&String(U)===N&&U>=0&&m.parseArrays&&U<=m.arrayLimit?(w=[],w[U]=b):N!=="__proto__"&&(w[N]=b)}b=w}return b},u=function(p,m){var _=m.allowDots?p.replace(/\.([^.[]+)/g,"[$1]"):p;if(m.depth<=0)return!m.plainObjects&&e.call(Object.prototype,_)&&!m.allowPrototypes?void 0:[_];var v=/(\[[^[\]]*])/,S=/(\[[^[\]]*])/g,b=v.exec(_),T=b?_.slice(0,b.index):_,w=[];if(T){if(!m.plainObjects&&e.call(Object.prototype,T)&&!m.allowPrototypes)return;w.push(T)}for(var R=0;(b=S.exec(_))!==null&&R<m.depth;){R+=1;var C=b[1].slice(1,-1);if(!m.plainObjects&&e.call(Object.prototype,C)&&!m.allowPrototypes)return;w.push(b[1])}if(b){if(m.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+m.depth+" and strictDepth is true");w.push("["+_.slice(b.index)+"]")}return w},h=function(p,m,_,v){if(p){var S=u(p,_);if(S)return l(S,m,_,v)}},f=function(p){if(!p)return r;if(typeof p.allowEmptyArrays<"u"&&typeof p.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof p.decodeDotInKeys<"u"&&typeof p.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(p.decoder!==null&&typeof p.decoder<"u"&&typeof p.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof p.throwOnLimitExceeded<"u"&&typeof p.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var m=typeof p.charset>"u"?r.charset:p.charset,_=typeof p.duplicates>"u"?r.duplicates:p.duplicates;if(_!=="combine"&&_!=="first"&&_!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var v=typeof p.allowDots>"u"?p.decodeDotInKeys===!0?!0:r.allowDots:!!p.allowDots;return{allowDots:v,allowEmptyArrays:typeof p.allowEmptyArrays=="boolean"?!!p.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof p.allowPrototypes=="boolean"?p.allowPrototypes:r.allowPrototypes,allowSparse:typeof p.allowSparse=="boolean"?p.allowSparse:r.allowSparse,arrayLimit:typeof p.arrayLimit=="number"?p.arrayLimit:r.arrayLimit,charset:m,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:r.charsetSentinel,comma:typeof p.comma=="boolean"?p.comma:r.comma,decodeDotInKeys:typeof p.decodeDotInKeys=="boolean"?p.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof p.decoder=="function"?p.decoder:r.decoder,delimiter:typeof p.delimiter=="string"||n.isRegExp(p.delimiter)?p.delimiter:r.delimiter,depth:typeof p.depth=="number"||p.depth===!1?+p.depth:r.depth,duplicates:_,ignoreQueryPrefix:p.ignoreQueryPrefix===!0,interpretNumericEntities:typeof p.interpretNumericEntities=="boolean"?p.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof p.parameterLimit=="number"?p.parameterLimit:r.parameterLimit,parseArrays:p.parseArrays!==!1,plainObjects:typeof p.plainObjects=="boolean"?p.plainObjects:r.plainObjects,strictDepth:typeof p.strictDepth=="boolean"?!!p.strictDepth:r.strictDepth,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof p.throwOnLimitExceeded=="boolean"?p.throwOnLimitExceeded:!1}};return XP=function(d,p){var m=f(p);if(d===""||d===null||typeof d>"u")return m.plainObjects?{__proto__:null}:{};for(var _=typeof d=="string"?c(d,m):d,v=m.plainObjects?{__proto__:null}:{},S=Object.keys(_),b=0;b<S.length;++b){var T=S[b],w=h(T,_[T],m,typeof d=="string");v=n.merge(v,w,m)}return m.allowSparse===!0?v:n.compact(v)},XP}var ZP,fz;function awe(){if(fz)return ZP;fz=1;var n=swe(),e=owe(),t=H6();return ZP={formats:t,parse:e,stringify:n},ZP}var dz;function cwe(){if(dz)return Qy;dz=1;var n=kTe();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,i=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),c=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,d={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=awe();function v(w,R,C){if(w&&typeof w=="object"&&w instanceof e)return w;var N=new e;return N.parse(w,R,C),N}e.prototype.parse=function(w,R,C){if(typeof w!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof w);var N=w.indexOf("?"),U=N!==-1&&N<w.indexOf("#")?"?":"#",B=w.split(U),$=/\\/g;B[0]=B[0].replace($,"/"),w=B.join(U);var I=w;if(I=I.trim(),!C&&w.split("#").length===1){var L=i.exec(I);if(L)return this.path=I,this.href=I,this.pathname=L[1],L[2]?(this.search=L[2],R?this.query=_.parse(this.search.substr(1)):this.query=this.search.substr(1)):R&&(this.search="",this.query={}),this}var P=t.exec(I);if(P){P=P[0];var H=P.toLowerCase();this.protocol=H,I=I.substr(P.length)}if(C||P||I.match(/^\/\/[^@/]+@[^@/]+/)){var X=I.substr(0,2)==="//";X&&!(P&&p[P])&&(I=I.substr(2),this.slashes=!0)}if(!p[P]&&(X||P&&!m[P])){for(var G=-1,Y=0;Y<l.length;Y++){var J=I.indexOf(l[Y]);J!==-1&&(G===-1||J<G)&&(G=J)}var Q,z;G===-1?z=I.lastIndexOf("@"):z=I.lastIndexOf("@",G),z!==-1&&(Q=I.slice(0,z),I=I.slice(z+1),this.auth=decodeURIComponent(Q)),G=-1;for(var Y=0;Y<c.length;Y++){var J=I.indexOf(c[Y]);J!==-1&&(G===-1||J<G)&&(G=J)}G===-1&&(G=I.length),this.host=I.slice(0,G),I=I.slice(G),this.parseHost(),this.hostname=this.hostname||"";var q=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!q)for(var ee=this.hostname.split(/\./),Y=0,te=ee.length;Y<te;Y++){var ie=ee[Y];if(ie&&!ie.match(h)){for(var Ee="",Re=0,Te=ie.length;Re<Te;Re++)ie.charCodeAt(Re)>127?Ee+="x":Ee+=ie[Re];if(!Ee.match(h)){var Pe=ee.slice(0,Y),We=ee.slice(Y+1),it=ie.match(f);it&&(Pe.push(it[1]),We.unshift(it[2])),We.length&&(I="/"+We.join(".")+I),this.hostname=Pe.join(".");break}}}this.hostname.length>u?this.hostname="":this.hostname=this.hostname.toLowerCase(),q||(this.hostname=n.toASCII(this.hostname));var ht=this.port?":"+this.port:"",vt=this.hostname||"";this.host=vt+ht,this.href+=this.host,q&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),I[0]!=="/"&&(I="/"+I))}if(!d[H])for(var Y=0,te=a.length;Y<te;Y++){var re=a[Y];if(I.indexOf(re)!==-1){var Le=encodeURIComponent(re);Le===re&&(Le=escape(re)),I=I.split(re).join(Le)}}var $e=I.indexOf("#");$e!==-1&&(this.hash=I.substr($e),I=I.slice(0,$e));var De=I.indexOf("?");if(De!==-1?(this.search=I.substr(De),this.query=I.substr(De+1),R&&(this.query=_.parse(this.query)),I=I.slice(0,De)):R&&(this.search="",this.query={}),I&&(this.pathname=I),m[H]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ht=this.pathname||"",Oe=this.search||"";this.path=ht+Oe}return this.href=this.format(),this};function S(w){return typeof w=="string"&&(w=v(w)),w instanceof e?w.format():e.prototype.format.call(w)}e.prototype.format=function(){var w=this.auth||"";w&&(w=encodeURIComponent(w),w=w.replace(/%3A/i,":"),w+="@");var R=this.protocol||"",C=this.pathname||"",N=this.hash||"",U=!1,B="";this.host?U=w+this.host:this.hostname&&(U=w+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(U+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(B=_.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var $=this.search||B&&"?"+B||"";return R&&R.substr(-1)!==":"&&(R+=":"),this.slashes||(!R||m[R])&&U!==!1?(U="//"+(U||""),C&&C.charAt(0)!=="/"&&(C="/"+C)):U||(U=""),N&&N.charAt(0)!=="#"&&(N="#"+N),$&&$.charAt(0)!=="?"&&($="?"+$),C=C.replace(/[?#]/g,function(I){return encodeURIComponent(I)}),$=$.replace("#","%23"),R+U+C+$+N};function b(w,R){return v(w,!1,!0).resolve(R)}e.prototype.resolve=function(w){return this.resolveObject(v(w,!1,!0)).format()};function T(w,R){return w?v(w,!1,!0).resolveObject(R):R}return e.prototype.resolveObject=function(w){if(typeof w=="string"){var R=new e;R.parse(w,!1,!0),w=R}for(var C=new e,N=Object.keys(this),U=0;U<N.length;U++){var B=N[U];C[B]=this[B]}if(C.hash=w.hash,w.href==="")return C.href=C.format(),C;if(w.slashes&&!w.protocol){for(var $=Object.keys(w),I=0;I<$.length;I++){var L=$[I];L!=="protocol"&&(C[L]=w[L])}return m[C.protocol]&&C.hostname&&!C.pathname&&(C.pathname="/",C.path=C.pathname),C.href=C.format(),C}if(w.protocol&&w.protocol!==C.protocol){if(!m[w.protocol]){for(var P=Object.keys(w),H=0;H<P.length;H++){var X=P[H];C[X]=w[X]}return C.href=C.format(),C}if(C.protocol=w.protocol,!w.host&&!p[w.protocol]){for(var te=(w.pathname||"").split("/");te.length&&!(w.host=te.shift()););w.host||(w.host=""),w.hostname||(w.hostname=""),te[0]!==""&&te.unshift(""),te.length<2&&te.unshift(""),C.pathname=te.join("/")}else C.pathname=w.pathname;if(C.search=w.search,C.query=w.query,C.host=w.host||"",C.auth=w.auth,C.hostname=w.hostname||w.host,C.port=w.port,C.pathname||C.search){var G=C.pathname||"",Y=C.search||"";C.path=G+Y}return C.slashes=C.slashes||w.slashes,C.href=C.format(),C}var J=C.pathname&&C.pathname.charAt(0)==="/",Q=w.host||w.pathname&&w.pathname.charAt(0)==="/",z=Q||J||C.host&&w.pathname,q=z,ee=C.pathname&&C.pathname.split("/")||[],te=w.pathname&&w.pathname.split("/")||[],ie=C.protocol&&!m[C.protocol];if(ie&&(C.hostname="",C.port=null,C.host&&(ee[0]===""?ee[0]=C.host:ee.unshift(C.host)),C.host="",w.protocol&&(w.hostname=null,w.port=null,w.host&&(te[0]===""?te[0]=w.host:te.unshift(w.host)),w.host=null),z=z&&(te[0]===""||ee[0]==="")),Q)C.host=w.host||w.host===""?w.host:C.host,C.hostname=w.hostname||w.hostname===""?w.hostname:C.hostname,C.search=w.search,C.query=w.query,ee=te;else if(te.length)ee||(ee=[]),ee.pop(),ee=ee.concat(te),C.search=w.search,C.query=w.query;else if(w.search!=null){if(ie){C.host=ee.shift(),C.hostname=C.host;var Ee=C.host&&C.host.indexOf("@")>0?C.host.split("@"):!1;Ee&&(C.auth=Ee.shift(),C.hostname=Ee.shift(),C.host=C.hostname)}return C.search=w.search,C.query=w.query,(C.pathname!==null||C.search!==null)&&(C.path=(C.pathname?C.pathname:"")+(C.search?C.search:"")),C.href=C.format(),C}if(!ee.length)return C.pathname=null,C.search?C.path="/"+C.search:C.path=null,C.href=C.format(),C;for(var Re=ee.slice(-1)[0],Te=(C.host||w.host||ee.length>1)&&(Re==="."||Re==="..")||Re==="",Pe=0,We=ee.length;We>=0;We--)Re=ee[We],Re==="."?ee.splice(We,1):Re===".."?(ee.splice(We,1),Pe++):Pe&&(ee.splice(We,1),Pe--);if(!z&&!q)for(;Pe--;Pe)ee.unshift("..");z&&ee[0]!==""&&(!ee[0]||ee[0].charAt(0)!=="/")&&ee.unshift(""),Te&&ee.join("/").substr(-1)!=="/"&&ee.push("");var it=ee[0]===""||ee[0]&&ee[0].charAt(0)==="/";if(ie){C.hostname=it?"":ee.length?ee.shift():"",C.host=C.hostname;var Ee=C.host&&C.host.indexOf("@")>0?C.host.split("@"):!1;Ee&&(C.auth=Ee.shift(),C.hostname=Ee.shift(),C.host=C.hostname)}return z=z||C.host&&ee.length,z&&!it&&ee.unshift(""),ee.length>0?C.pathname=ee.join("/"):(C.pathname=null,C.path=null),(C.pathname!==null||C.search!==null)&&(C.path=(C.pathname?C.pathname:"")+(C.search?C.search:"")),C.auth=w.auth||C.auth,C.slashes=C.slashes||w.slashes,C.href=C.format(),C},e.prototype.parseHost=function(){var w=this.host,R=r.exec(w);R&&(R=R[0],R!==":"&&(this.port=R.substr(1)),w=w.substr(0,w.length-R.length)),w&&(this.hostname=w)},Qy.parse=v,Qy.resolve=b,Qy.resolveObject=T,Qy.format=S,Qy.Url=e,Qy}var JP,pz;function lwe(){return pz||(pz=1,JP=typeof URL=="function"?URL:cwe().URL),JP}var mz;function IO(){if(mz)return Qd;mz=1;const n=lwe();function e(B,$,I){if($ in B)return B[$];if(arguments.length===3)return I;throw new Error('"'+$+'" is a required argument.')}Qd.getArg=e;const t=(function(){return!("__proto__"in Object.create(null))})();function r(B){return B}function i(B){return o(B)?"$"+B:B}Qd.toSetString=t?r:i;function s(B){return o(B)?B.slice(1):B}Qd.fromSetString=t?r:s;function o(B){if(!B)return!1;const $=B.length;if($<9||B.charCodeAt($-1)!==95||B.charCodeAt($-2)!==95||B.charCodeAt($-3)!==111||B.charCodeAt($-4)!==116||B.charCodeAt($-5)!==111||B.charCodeAt($-6)!==114||B.charCodeAt($-7)!==112||B.charCodeAt($-8)!==95||B.charCodeAt($-9)!==95)return!1;for(let I=$-10;I>=0;I--)if(B.charCodeAt(I)!==36)return!1;return!0}function a(B,$){return B===$?0:B===null?1:$===null?-1:B>$?1:-1}function c(B,$){let I=B.generatedLine-$.generatedLine;return I!==0||(I=B.generatedColumn-$.generatedColumn,I!==0)||(I=a(B.source,$.source),I!==0)||(I=B.originalLine-$.originalLine,I!==0)||(I=B.originalColumn-$.originalColumn,I!==0)?I:a(B.name,$.name)}Qd.compareByGeneratedPositionsInflated=c;function l(B){return JSON.parse(B.replace(/^\)]}'[^\n]*\n/,""))}Qd.parseSourceMapInput=l;const u="http:",h=`${u}//host`;function f(B){return $=>{const I=v($),L=m($),P=new n($,L);B(P);const H=P.toString();return I==="absolute"?H:I==="scheme-relative"?H.slice(u.length):I==="path-absolute"?H.slice(h.length):S(L,H)}}function d(B,$){return new n(B,$).toString()}function p(B,$){let I=0;do{const L=B+I++;if($.indexOf(L)===-1)return L}while(!0)}function m(B){const $=B.split("..").length-1,I=p("p",B);let L=`${h}/`;for(let P=0;P<$;P++)L+=`${I}/`;return L}const _=/^[A-Za-z0-9\+\-\.]+:/;function v(B){return B[0]==="/"?B[1]==="/"?"scheme-relative":"path-absolute":_.test(B)?"absolute":"path-relative"}function S(B,$){typeof B=="string"&&(B=new n(B)),typeof $=="string"&&($=new n($));const I=$.pathname.split("/"),L=B.pathname.split("/");for(L.length>0&&!L[L.length-1]&&L.pop();I.length>0&&L.length>0&&I[0]===L[0];)I.shift(),L.shift();return L.map(()=>"..").concat(I).join("/")+$.search+$.hash}const b=f(B=>{B.pathname=B.pathname.replace(/\/?$/,"/")}),T=f(B=>{B.href=new n(".",B.toString()).toString()}),w=f(B=>{});Qd.normalize=w;function R(B,$){const I=v($),L=v(B);if(B=b(B),I==="absolute")return d($,void 0);if(L==="absolute")return d($,B);if(I==="scheme-relative")return w($);if(L==="scheme-relative")return d($,d(B,h)).slice(u.length);if(I==="path-absolute")return w($);if(L==="path-absolute")return d($,d(B,h)).slice(h.length);const P=m($+B),H=d($,d(B,P));return S(P,H)}Qd.join=R;function C(B,$){const I=N(B,$);return typeof I=="string"?I:w($)}Qd.relative=C;function N(B,$){if(v(B)!==v($))return null;const L=m(B+$),P=new n(B,L),H=new n($,L);try{new n("",H.toString())}catch{return null}return H.protocol!==P.protocol||H.user!==P.user||H.password!==P.password||H.hostname!==P.hostname||H.port!==P.port?null:S(P,H)}function U(B,$,I){B&&v($)==="path-absolute"&&($=$.replace(/^\//,""));let L=w($||"");return B&&(L=R(B,L)),I&&(L=R(T(I),L)),L}return Qd.computeSourceURL=U,Qd}var QP={},gz;function hJ(){if(gz)return QP;gz=1;class n{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const i=new n;for(let s=0,o=t.length;s<o;s++)i.add(t[s],r);return i}size(){return this._set.size}add(t,r){const i=this.has(t),s=this._array.length;(!i||r)&&this._array.push(t),i||this._set.set(t,s)}has(t){return this._set.has(t)}indexOf(t){const r=this._set.get(t);if(r>=0)return r;throw new Error('"'+t+'" is not in the set.')}at(t){if(t>=0&&t<this._array.length)return this._array[t];throw new Error("No element indexed by "+t)}toArray(){return this._array.slice()}}return QP.ArraySet=n,QP}var e2={},_z;function uwe(){if(_z)return e2;_z=1;const n=IO();function e(r,i){const s=r.generatedLine,o=i.generatedLine,a=r.generatedColumn,c=i.generatedColumn;return o>s||o==s&&c>=a||n.compareByGeneratedPositionsInflated(r,i)<=0}class t{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(i,s){this._array.forEach(i,s)}add(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))}toArray(){return this._sorted||(this._array.sort(n.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}return e2.MappingList=t,e2}var vz;function fJ(){if(vz)return iP;vz=1;const n=eJ(),e=IO(),t=hJ().ArraySet,r=uwe().MappingList;class i{constructor(o){o||(o={}),this._file=e.getArg(o,"file",null),this._sourceRoot=e.getArg(o,"sourceRoot",null),this._skipValidation=e.getArg(o,"skipValidation",!1),this._sources=new t,this._names=new t,this._mappings=new r,this._sourcesContents=null}static fromSourceMap(o){const a=o.sourceRoot,c=new i({file:o.file,sourceRoot:a});return o.eachMapping(function(l){const u={generated:{line:l.generatedLine,column:l.generatedColumn}};l.source!=null&&(u.source=l.source,a!=null&&(u.source=e.relative(a,u.source)),u.original={line:l.originalLine,column:l.originalColumn},l.name!=null&&(u.name=l.name)),c.addMapping(u)}),o.sources.forEach(function(l){let u=l;a!=null&&(u=e.relative(a,l)),c._sources.has(u)||c._sources.add(u);const h=o.sourceContentFor(l);h!=null&&c.setSourceContent(l,h)}),c}addMapping(o){const a=e.getArg(o,"generated"),c=e.getArg(o,"original",null);let l=e.getArg(o,"source",null),u=e.getArg(o,"name",null);this._skipValidation||this._validateMapping(a,c,l,u),l!=null&&(l=String(l),this._sources.has(l)||this._sources.add(l)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:a.line,generatedColumn:a.column,originalLine:c&&c.line,originalColumn:c&&c.column,source:l,name:u})}setSourceContent(o,a){let c=o;this._sourceRoot!=null&&(c=e.relative(this._sourceRoot,c)),a!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(c)]=a):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(c)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))}applySourceMap(o,a,c){let l=a;if(a==null){if(o.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);l=o.file}const u=this._sourceRoot;u!=null&&(l=e.relative(u,l));const h=this._mappings.toArray().length>0?new t:this._sources,f=new t;this._mappings.unsortedForEach(function(d){if(d.source===l&&d.originalLine!=null){const _=o.originalPositionFor({line:d.originalLine,column:d.originalColumn});_.source!=null&&(d.source=_.source,c!=null&&(d.source=e.join(c,d.source)),u!=null&&(d.source=e.relative(u,d.source)),d.originalLine=_.line,d.originalColumn=_.column,_.name!=null&&(d.name=_.name))}const p=d.source;p!=null&&!h.has(p)&&h.add(p);const m=d.name;m!=null&&!f.has(m)&&f.add(m)},this),this._sources=h,this._names=f,o.sources.forEach(function(d){const p=o.sourceContentFor(d);p!=null&&(c!=null&&(d=e.join(c,d)),u!=null&&(d=e.relative(u,d)),this.setSourceContent(d,p))},this)}_validateMapping(o,a,c,l){if(a&&typeof a.line!="number"&&typeof a.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(o&&"line"in o&&"column"in o&&o.line>0&&o.column>=0&&!a&&!c&&!l)){if(!(o&&"line"in o&&"column"in o&&a&&"line"in a&&"column"in a&&o.line>0&&o.column>=0&&a.line>0&&a.column>=0&&c))throw new Error("Invalid mapping: "+JSON.stringify({generated:o,source:c,original:a,name:l}))}}_serializeMappings(){let o=0,a=1,c=0,l=0,u=0,h=0,f="",d,p,m,_;const v=this._mappings.toArray();for(let S=0,b=v.length;S<b;S++){if(p=v[S],d="",p.generatedLine!==a)for(o=0;p.generatedLine!==a;)d+=";",a++;else if(S>0){if(!e.compareByGeneratedPositionsInflated(p,v[S-1]))continue;d+=","}d+=n.encode(p.generatedColumn-o),o=p.generatedColumn,p.source!=null&&(_=this._sources.indexOf(p.source),d+=n.encode(_-h),h=_,d+=n.encode(p.originalLine-1-l),l=p.originalLine-1,d+=n.encode(p.originalColumn-c),c=p.originalColumn,p.name!=null&&(m=this._names.indexOf(p.name),d+=n.encode(m-u),u=m)),f+=d}return f}_generateSourcesContent(o,a){return o.map(function(c){if(!this._sourcesContents)return null;a!=null&&(c=e.relative(a,c));const l=e.toSetString(c);return Object.prototype.hasOwnProperty.call(this._sourcesContents,l)?this._sourcesContents[l]:null},this)}toJSON(){const o={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(o.file=this._file),this._sourceRoot!=null&&(o.sourceRoot=this._sourceRoot),this._sourcesContents&&(o.sourcesContent=this._generateSourcesContent(o.sources,o.sourceRoot)),o}toString(){return JSON.stringify(this.toJSON())}}return i.prototype._version=3,iP.SourceMapGenerator=i,iP}var ZT={},t2={},yz;function hwe(){return yz||(yz=1,(function(n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2;function e(t,r,i,s,o,a){const c=Math.floor((r-t)/2)+t,l=o(i,s[c],!0);return l===0?c:l>0?r-c>1?e(c,r,i,s,o,a):a===n.LEAST_UPPER_BOUND?r<s.length?r:-1:c:c-t>1?e(t,c,i,s,o,a):a==n.LEAST_UPPER_BOUND?c:t<0?-1:t}n.search=function(r,i,s,o){if(i.length===0)return-1;let a=e(-1,i.length,r,i,s,o||n.GREATEST_LOWER_BOUND);if(a<0)return-1;for(;a-1>=0&&s(i[a],i[a-1],!0)===0;)--a;return a}})(t2)),t2}var DR={exports:{}},bz;function dJ(){if(bz)return DR.exports;bz=1;let n=null;return DR.exports=function(){if(typeof n=="string")return fetch(n).then(t=>t.arrayBuffer());if(n instanceof ArrayBuffer)return Promise.resolve(n);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},DR.exports.initialize=e=>{n=e},DR.exports}var n2,Sz;function fwe(){if(Sz)return n2;Sz=1;const n=dJ();function e(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let t=null;return n2=function(){if(t)return t;const i=[];return t=n().then(s=>WebAssembly.instantiate(s,{env:{mapping_callback(o,a,c,l,u,h,f,d,p,m){const _=new e;_.generatedLine=o+1,_.generatedColumn=a,c&&(_.lastGeneratedColumn=l-1),u&&(_.source=h,_.originalLine=f+1,_.originalColumn=d,p&&(_.name=m)),i[i.length-1](_)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}})).then(s=>({exports:s.instance.exports,withMappingCallback:(o,a)=>{i.push(o);try{a()}finally{i.pop()}}})).then(null,s=>{throw t=null,s}),t},n2}var Ez;function dwe(){if(Ez)return ZT;Ez=1;const n=IO(),e=hwe(),t=hJ().ArraySet;eJ();const r=dJ(),i=fwe(),s=Symbol("smcInternal");class o{constructor(f,d){return f==s?Promise.resolve(this):l(f,d)}static initialize(f){r.initialize(f["lib/mappings.wasm"])}static fromSourceMap(f,d){return u(f,d)}static async with(f,d,p){const m=await new o(f,d);try{return await p(m)}finally{m.destroy()}}eachMapping(f,d,p){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(f){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}o.prototype._version=3,o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,ZT.SourceMapConsumer=o;class a extends o{constructor(f,d){return super(s).then(p=>{let m=f;typeof f=="string"&&(m=n.parseSourceMapInput(f));const _=n.getArg(m,"version"),v=n.getArg(m,"sources").map(String),S=n.getArg(m,"names",[]),b=n.getArg(m,"sourceRoot",null),T=n.getArg(m,"sourcesContent",null),w=n.getArg(m,"mappings"),R=n.getArg(m,"file",null),C=n.getArg(m,"x_google_ignoreList",null);if(_!=p._version)throw new Error("Unsupported version: "+_);return p._sourceLookupCache=new Map,p._names=t.fromArray(S.map(String),!0),p._sources=t.fromArray(v,!0),p._absoluteSources=t.fromArray(p._sources.toArray().map(function(N){return n.computeSourceURL(b,N,d)}),!0),p.sourceRoot=b,p.sourcesContent=T,p._mappings=w,p._sourceMapURL=d,p.file=R,p.x_google_ignoreList=C,p._computedColumnSpans=!1,p._mappingsPtr=0,p._wasm=null,i().then(N=>(p._wasm=N,p))})}_findSourceIndex(f){const d=this._sourceLookupCache.get(f);if(typeof d=="number")return d;const p=n.computeSourceURL(null,f,this._sourceMapURL);if(this._absoluteSources.has(p)){const _=this._absoluteSources.indexOf(p);return this._sourceLookupCache.set(f,_),_}const m=n.computeSourceURL(this.sourceRoot,f,this._sourceMapURL);if(this._absoluteSources.has(m)){const _=this._absoluteSources.indexOf(m);return this._sourceLookupCache.set(f,_),_}return-1}static fromSourceMap(f,d){return new a(f.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return this._mappingsPtr===0&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const f=this._mappings,d=f.length,p=this._wasm.exports.allocate_mappings(d)>>>0,m=new Uint8Array(this._wasm.exports.memory.buffer,p,d);for(let v=0;v<d;v++)m[v]=f.charCodeAt(v);const _=this._wasm.exports.parse_mappings(p);if(!_){const v=this._wasm.exports.get_last_error();let S=`Error parsing mappings (code ${v}): `;switch(v){case 1:S+="the mappings contained a negative line, column, source index, or name index";break;case 2:S+="the mappings contained a number larger than 2**32";break;case 3:S+="reached EOF while in the middle of parsing a VLQ";break;case 4:S+="invalid base 64 character while parsing a VLQ";break;default:S+="unknown error code";break}throw new Error(S)}this._mappingsPtr=_}eachMapping(f,d,p){const m=d||null,_=p||o.GENERATED_ORDER;this._wasm.withMappingCallback(v=>{v.source!==null&&(v.source=this._absoluteSources.at(v.source),v.name!==null&&(v.name=this._names.at(v.name))),this._computedColumnSpans&&v.lastGeneratedColumn===null&&(v.lastGeneratedColumn=1/0),f.call(m,v)},()=>{switch(_){case o.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case o.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}})}allGeneratedPositionsFor(f){let d=n.getArg(f,"source");const p=n.getArg(f,"line"),m=f.column||0;if(d=this._findSourceIndex(d),d<0)return[];if(p<1)throw new Error("Line numbers must be >= 1");if(m<0)throw new Error("Column numbers must be >= 0");const _=[];return this._wasm.withMappingCallback(v=>{let S=v.lastGeneratedColumn;this._computedColumnSpans&&S===null&&(S=1/0),_.push({line:v.generatedLine,column:v.generatedColumn,lastColumn:S})},()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),d,p-1,"column"in f,m)}),_}destroy(){this._mappingsPtr!==0&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(f){const d={generatedLine:n.getArg(f,"line"),generatedColumn:n.getArg(f,"column")};if(d.generatedLine<1)throw new Error("Line numbers must be >= 1");if(d.generatedColumn<0)throw new Error("Column numbers must be >= 0");let p=n.getArg(f,"bias",o.GREATEST_LOWER_BOUND);p==null&&(p=o.GREATEST_LOWER_BOUND);let m;if(this._wasm.withMappingCallback(_=>m=_,()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),d.generatedLine-1,d.generatedColumn,p)}),m&&m.generatedLine===d.generatedLine){let _=n.getArg(m,"source",null);_!==null&&(_=this._absoluteSources.at(_));let v=n.getArg(m,"name",null);return v!==null&&(v=this._names.at(v)),{source:_,line:n.getArg(m,"originalLine",null),column:n.getArg(m,"originalColumn",null),name:v}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(f){return f==null}):!1}sourceContentFor(f,d){if(!this.sourcesContent)return null;const p=this._findSourceIndex(f);if(p>=0)return this.sourcesContent[p];if(d)return null;throw new Error('"'+f+'" is not in the SourceMap.')}generatedPositionFor(f){let d=n.getArg(f,"source");if(d=this._findSourceIndex(d),d<0)return{line:null,column:null,lastColumn:null};const p={source:d,originalLine:n.getArg(f,"line"),originalColumn:n.getArg(f,"column")};if(p.originalLine<1)throw new Error("Line numbers must be >= 1");if(p.originalColumn<0)throw new Error("Column numbers must be >= 0");let m=n.getArg(f,"bias",o.GREATEST_LOWER_BOUND);m==null&&(m=o.GREATEST_LOWER_BOUND);let _;if(this._wasm.withMappingCallback(v=>_=v,()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),p.source,p.originalLine-1,p.originalColumn,m)}),_&&_.source===p.source){let v=_.lastGeneratedColumn;return this._computedColumnSpans&&v===null&&(v=1/0),{line:n.getArg(_,"generatedLine",null),column:n.getArg(_,"generatedColumn",null),lastColumn:v}}return{line:null,column:null,lastColumn:null}}}a.prototype.consumer=o,ZT.BasicSourceMapConsumer=a;class c extends o{constructor(f,d){return super(s).then(p=>{let m=f;typeof f=="string"&&(m=n.parseSourceMapInput(f));const _=n.getArg(m,"version"),v=n.getArg(m,"sections");if(_!=p._version)throw new Error("Unsupported version: "+_);let S={line:-1,column:0};return Promise.all(v.map(b=>{if(b.url)throw new Error("Support for url field in sections not implemented.");const T=n.getArg(b,"offset"),w=n.getArg(T,"line"),R=n.getArg(T,"column");if(w<S.line||w===S.line&&R<S.column)throw new Error("Section offsets must be ordered and non-overlapping.");return S=T,new o(n.getArg(b,"map"),d).then(N=>({generatedOffset:{generatedLine:w+1,generatedColumn:R+1},consumer:N}))})).then(b=>(p._sections=b,p))})}get sources(){const f=[];for(let d=0;d<this._sections.length;d++)for(let p=0;p<this._sections[d].consumer.sources.length;p++)f.push(this._sections[d].consumer.sources[p]);return f}originalPositionFor(f){const d={generatedLine:n.getArg(f,"line"),generatedColumn:n.getArg(f,"column")},p=e.search(d,this._sections,function(_,v){const S=_.generatedLine-v.generatedOffset.generatedLine;return S||_.generatedColumn-(v.generatedOffset.generatedColumn-1)}),m=this._sections[p];return m?m.consumer.originalPositionFor({line:d.generatedLine-(m.generatedOffset.generatedLine-1),column:d.generatedColumn-(m.generatedOffset.generatedLine===d.generatedLine?m.generatedOffset.generatedColumn-1:0),bias:f.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every(function(f){return f.consumer.hasContentsOfAllSources()})}sourceContentFor(f,d){for(let p=0;p<this._sections.length;p++){const _=this._sections[p].consumer.sourceContentFor(f,!0);if(_)return _}if(d)return null;throw new Error('"'+f+'" is not in the SourceMap.')}_findSectionIndex(f){for(let d=0;d<this._sections.length;d++){const{consumer:p}=this._sections[d];if(p._findSourceIndex(f)!==-1)return d}return-1}generatedPositionFor(f){const d=this._findSectionIndex(n.getArg(f,"source")),p=d>=0?this._sections[d]:null,m=d>=0&&d+1<this._sections.length?this._sections[d+1]:null,_=p&&p.consumer.generatedPositionFor(f);if(_&&_.line!==null){const v=p.generatedOffset.generatedLine-1,S=p.generatedOffset.generatedColumn-1;return _.line===1&&(_.column+=S,typeof _.lastColumn=="number"&&(_.lastColumn+=S)),_.lastColumn===1/0&&m&&_.line===m.generatedOffset.generatedLine&&(_.lastColumn=m.generatedOffset.generatedColumn-2),_.line+=v,_}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(f){const d=this._findSectionIndex(n.getArg(f,"source")),p=d>=0?this._sections[d]:null,m=d>=0&&d+1<this._sections.length?this._sections[d+1]:null;return p?p.consumer.allGeneratedPositionsFor(f).map(_=>{const v=p.generatedOffset.generatedLine-1,S=p.generatedOffset.generatedColumn-1;return _.line===1&&(_.column+=S,typeof _.lastColumn=="number"&&(_.lastColumn+=S)),_.lastColumn===1/0&&m&&_.line===m.generatedOffset.generatedLine&&(_.lastColumn=m.generatedOffset.generatedColumn-2),_.line+=v,_}):[]}eachMapping(f,d,p){this._sections.forEach((m,_)=>{const v=_+1<this._sections.length?this._sections[_+1]:null,{generatedOffset:S}=m,b=S.generatedLine-1,T=S.generatedColumn-1;m.consumer.eachMapping(function(w){w.generatedLine===1&&(w.generatedColumn+=T,typeof w.lastGeneratedColumn=="number"&&(w.lastGeneratedColumn+=T)),w.lastGeneratedColumn===1/0&&v&&w.generatedLine===v.generatedOffset.generatedLine&&(w.lastGeneratedColumn=v.generatedOffset.generatedColumn-2),w.generatedLine+=b,f.call(this,w)},d,p)})}computeColumnSpans(){for(let f=0;f<this._sections.length;f++)this._sections[f].consumer.computeColumnSpans()}destroy(){for(let f=0;f<this._sections.length;f++)this._sections[f].consumer.destroy()}}ZT.IndexedSourceMapConsumer=c;function l(h,f){let d=h;typeof h=="string"&&(d=n.parseSourceMapInput(h));const p=d.sections!=null?new c(d,f):new a(d,f);return Promise.resolve(p)}function u(h,f){return a.fromSourceMap(h,f)}return ZT}var r2={},xz;function pwe(){if(xz)return r2;xz=1;const n=fJ().SourceMapGenerator,e=IO(),t=/(\r?\n)/,r=10,i="$$$isSourceNode$$$";class s{constructor(a,c,l,u,h){this.children=[],this.sourceContents={},this.line=a??null,this.column=c??null,this.source=l??null,this.name=h??null,this[i]=!0,u!=null&&this.add(u)}static fromStringWithSourceMap(a,c,l){const u=new s,h=a.split(t);let f=0;const d=function(){const b=w(),T=w()||"";return b+T;function w(){return f<h.length?h[f++]:void 0}};let p=1,m=0,_=null,v;return c.eachMapping(function(b){if(_!==null)if(p<b.generatedLine)S(_,d()),p++,m=0;else{v=h[f]||"";const T=v.substr(0,b.generatedColumn-m);h[f]=v.substr(b.generatedColumn-m),m=b.generatedColumn,S(_,T),_=b;return}for(;p<b.generatedLine;)u.add(d()),p++;m<b.generatedColumn&&(v=h[f]||"",u.add(v.substr(0,b.generatedColumn)),h[f]=v.substr(b.generatedColumn),m=b.generatedColumn),_=b},this),f<h.length&&(_&&S(_,d()),u.add(h.splice(f).join(""))),c.sources.forEach(function(b){const T=c.sourceContentFor(b);T!=null&&(l!=null&&(b=e.join(l,b)),u.setSourceContent(b,T))}),u;function S(b,T){if(b===null||b.source===void 0)u.add(T);else{const w=l?e.join(l,b.source):b.source;u.add(new s(b.originalLine,b.originalColumn,w,T,b.name))}}}add(a){if(Array.isArray(a))a.forEach(function(c){this.add(c)},this);else if(a[i]||typeof a=="string")a&&this.children.push(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}prepend(a){if(Array.isArray(a))for(let c=a.length-1;c>=0;c--)this.prepend(a[c]);else if(a[i]||typeof a=="string")this.children.unshift(a);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+a);return this}walk(a){let c;for(let l=0,u=this.children.length;l<u;l++)c=this.children[l],c[i]?c.walk(a):c!==""&&a(c,{source:this.source,line:this.line,column:this.column,name:this.name})}join(a){let c,l;const u=this.children.length;if(u>0){for(c=[],l=0;l<u-1;l++)c.push(this.children[l]),c.push(a);c.push(this.children[l]),this.children=c}return this}replaceRight(a,c){const l=this.children[this.children.length-1];return l[i]?l.replaceRight(a,c):typeof l=="string"?this.children[this.children.length-1]=l.replace(a,c):this.children.push("".replace(a,c)),this}setSourceContent(a,c){this.sourceContents[e.toSetString(a)]=c}walkSourceContents(a){for(let l=0,u=this.children.length;l<u;l++)this.children[l][i]&&this.children[l].walkSourceContents(a);const c=Object.keys(this.sourceContents);for(let l=0,u=c.length;l<u;l++)a(e.fromSetString(c[l]),this.sourceContents[c[l]])}toString(){let a="";return this.walk(function(c){a+=c}),a}toStringWithSourceMap(a){const c={code:"",line:1,column:0},l=new n(a);let u=!1,h=null,f=null,d=null,p=null;return this.walk(function(m,_){c.code+=m,_.source!==null&&_.line!==null&&_.column!==null?((h!==_.source||f!==_.line||d!==_.column||p!==_.name)&&l.addMapping({source:_.source,original:{line:_.line,column:_.column},generated:{line:c.line,column:c.column},name:_.name}),h=_.source,f=_.line,d=_.column,p=_.name,u=!0):u&&(l.addMapping({generated:{line:c.line,column:c.column}}),h=null,u=!1);for(let v=0,S=m.length;v<S;v++)m.charCodeAt(v)===r?(c.line++,c.column=0,v+1===S?(h=null,u=!1):u&&l.addMapping({source:_.source,original:{line:_.line,column:_.column},generated:{line:c.line,column:c.column},name:_.name})):c.column++}),this.walkSourceContents(function(m,_){l.setSourceContent(m,_)}),{code:c.code,map:l}}}return r2.SourceNode=s,r2}var Tz;function mwe(){return Tz||(Tz=1,XT.SourceMapGenerator=fJ().SourceMapGenerator,XT.SourceMapConsumer=dwe().SourceMapConsumer,XT.SourceNode=pwe().SourceNode),XT}var gwe=mwe();const gh={labels:{},internal:0,lineindex:0,linelookup:{},isfirststat:!1},OO="zss.js";function Ui(n,e){return new gwe.SourceNode(n.startLine??1,n.startColumn??1,OO,e)}function t4(n){return n.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}function LR(n){return`'${t4(n)}'`}function i2(n){const e=Jx(n);return e.errors.length?n:`['${e.tokens.map(r=>{if(r.tokenType===yC){const i=t4(r.image.substring(1));return cr(i)==="center"?"$CENTER":`', api.print(api.get('${i}')), '`}return t4(r.image)}).join("")}'].join('')`}function JT(n){return n.filter(e=>e!==void 0).map(es)}function wz(n){return Ui(n,"")}function _we(n,e){const t=[];return n.forEach(r=>{t.push(r,e)}),t.pop(),t}function oc(n,e,t){return Ui(n,[`api.${e}(`,..._we(t,", "),")"])}function vwe(n){if(n.type===Bn.COMPARE&&n.compare.type===Bn.COMPARE_ITEM)switch(n.compare.method){case db.IS_EQ:return oc(n,"isEq",[es(n.lhs),es(n.rhs)]);case db.IS_NOT_EQ:return oc(n,"isNotEq",[es(n.lhs),es(n.rhs)]);case db.IS_LESS_THAN:return oc(n,"isLessThan",[es(n.lhs),es(n.rhs)]);case db.IS_GREATER_THAN:return oc(n,"isGreaterThan",[es(n.lhs),es(n.rhs)]);case db.IS_LESS_THAN_OR_EQ:return oc(n,"isLessThanOrEq",[es(n.lhs),es(n.rhs)]);case db.IS_GREATER_THAN_OR_EQ:return oc(n,"isGreaterThanOrEq",[es(n.lhs),es(n.rhs)])}return Ui(n,"")}function eb(n,e,t){return n.prepend(`api.${e}(`),n.add([", ",es(t),")"])}function Az(n,e,t){return n.prepend(`api.${e}(`),n.add([es(t),")"])}function ywe(n,e){if(n.type===Bn.OPERATOR_ITEM)switch(n.operator){case Sm.PLUS:return eb(e,"opPlus",n.rhs);case Sm.MINUS:return eb(e,"opMinus",n.rhs);case Sm.POWER:return eb(e,"opPower",n.rhs);case Sm.MULTIPLY:return eb(e,"opMultiply",n.rhs);case Sm.DIVIDE:return eb(e,"opDivide",n.rhs);case Sm.MOD_DIVIDE:return eb(e,"opModDivide",n.rhs);case Sm.FLOOR_DIVIDE:return eb(e,"opFloorDivide",n.rhs);case Sm.UNI_PLUS:return Az(e,"opUniPlus",n.rhs);case Sm.UNI_MINUS:return Az(e,"opUniMinus",n.rhs)}return Ui(n,"")}function bwe(n){if(n.type===Bn.OPERATOR){const e=n.lhs?es(n.lhs):Ui(n,"");return n.items.forEach(t=>ywe(t,e)),e}return Ui(n,"")}function UR(n,e){return Ui(n,[oc(n,"jump",[`${e}`]),"; continue;"])}function w0(n){return gh.linelookup[n??""]??-1}function n4(n,e){gh.linelookup[n]=e}function pE(n,e,t){for(let r=0;r<n.length;++r){const i=n[r];switch(i.type){case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.ELSE_IF:i.type===e&&(i.done=t);break;case Bn.IF_BLOCK:case Bn.IF_CHECK:i.type===e&&(i.skip=t);break;case Bn.LINE:pE(i.stmts,e,t);break}}}function pJ(n,e,t){for(let r=0;r<n.length;++r){const i=n[r];switch(i.type){case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.ELSE_IF:i.type===e&&n4(i.done,t);break;case Bn.IF_BLOCK:case Bn.IF_CHECK:i.type===e&&n4(i.skip,t);break;case Bn.LINE:pJ(i.stmts,e,t);break}}}function es(n){switch(n.type){case Bn.PROGRAM:return Ui(n,[`try { // first-line
`,`while (true) {
`,`if (api.sy()) { return 1; }
`,`switch (api.getcase()) {
`,...n.lines.map(es).flat(),`default:
`,`  return 0;
`,`}
`,`api.nextcase();
`,`} // end of logic
`,`} catch (e) {
`,`console.error(e);
`,`const source = api.stacktrace(e);
`,`const err = new Error(e.message);
`,`err.name = 'GameError';
`,`err.meta = { line: source.line, column: source.column };
`,`throw err;
`,`}
`,`//# sourceURL=${OO}`]);case Bn.API:return Ui(n,["  ",oc(n,n.method,JT(n.words)),`;
`]);case Bn.LINE:return Ui(n,[`case ${n.lineindex}:
`,...n.stmts.map(es).flat(),`  break;
`]);case Bn.MARK:return Ui(n,`  // ${n.comment}
`);case Bn.GOTO:{const e=w0(n.id);return Ui(n,["  ",UR(n,e),`
`])}case Bn.COUNT:return Ui(n,`${n.index}`);case Bn.LITERAL:switch(n.literal){case $k.NUMBER:return Ui(n,`${n.value}`);case $k.STRING:return Ui(n,LR(n.value));case $k.TEMPLATE:return Ui(n,i2(n.value))}return wz(n);case Bn.TEXT:return Ui(n,["  ",oc(n,"text",[i2(n.value)]),`;
`]);case Bn.STAT:if(gh.isfirststat){gh.isfirststat=!1;const e=n.value.trim().split(" ").map(LR);return Ui(n,["  ",oc(n,"stat",e),`;
`])}return Ui(n,`  // skipped ${n.value}
`);case Bn.LABEL:{const e=cr(n.name),t=n.active?"label":"comment";gh.labels[e]||(gh.labels[e]=[]);const r=(n.active?1:-1)*n.lineindex;return gh.labels[e].push(r),Ui(n,`  // ${r} '${e}' ${t}
`)}case Bn.HYPERLINK:return Ui(n,["  ",oc(n,"hyperlink",[i2(n.text),...n.link.split(" ").filter(e=>e.length>0).map(LR)]),`;
`]);case Bn.MOVE:{const e=oc(n,"command",[LR("go"),JT(n.words)].flat());return n.wait?Ui(n,["  if (",e,`) { continue; };
`]):Ui(n,["  ",e,`;
`])}case Bn.COMMAND:return Ui(n,["  if (",oc(n,"command",JT(n.words)),`) { continue; };
`]);case Bn.IF:{const e=n.block?.type===Bn.IF_BLOCK?n.block:void 0;if(he(e)){pE([n.check],Bn.IF_CHECK,e.skip);const t=Ui(n,es(n.check));return e.lines.forEach(r=>t.add(es(r))),pJ(e.altlines,Bn.ELSE_IF,w0(e.done)),e.altlines.forEach(r=>t.add(es(r))),t}return Ui(n,es(n.check))}case Bn.IF_CHECK:{const e=w0(n.skip);return e===-1?Ui(n,["  ",oc(n,n.method,JT(n.words)),`;
`]):Ui(n,["  if (!",oc(n,n.method,JT(n.words)),") { ",UR(n,e),` }
`])}case Bn.ELSE_IF:case Bn.ELSE:{const e=Ui(n,"");return n.lines.forEach(t=>e.add(es(t))),e}case Bn.WHILE:{const e=w0(n.loop),t=w0(n.done),r=Ui(n,"");return pE(n.lines,Bn.IF_CHECK,n.done),n.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=t;break;case Bn.CONTINUE:i.goto=e;break}r.add(es(i))}),r}case Bn.REPEAT:{const e=w0(n.loop),t=w0(n.done),r=Ui(n,"");return pE(n.lines,Bn.IF_CHECK,n.done),n.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=t;break;case Bn.CONTINUE:i.goto=e;break}r.add(es(i))}),r}case Bn.WAITFOR:{const e=Ui(n,"");return pE(n.lines,Bn.IF_CHECK,n.loop),n.lines.forEach(t=>{e.add(es(t))}),e}case Bn.FOREACH:{const e=w0(n.loop),t=w0(n.done),r=Ui(n,"");return pE(n.lines,Bn.IF_CHECK,n.done),n.lines.forEach(i=>{switch(i.type){case Bn.BREAK:i.goto=t;break;case Bn.CONTINUE:i.goto=e;break}r.add(es(i))}),r}case Bn.BREAK:return Ui(n,["  ",UR(n,n.goto),`
`]);case Bn.CONTINUE:return Ui(n,["  ",UR(n,n.goto),`
`]);case Bn.OR:return oc(n,"or",n.items.map(es));case Bn.AND:return oc(n,"and",n.items.map(es));case Bn.NOT:return oc(n,"not",n.items.map(es));case Bn.COMPARE:return vwe(n);case Bn.OPERATOR:return bwe(n);case Bn.EXPR:return oc(n,"expr",n.words.map(es));default:return console.error("<unsupported node>",n.type,n),wz(n)}}function Em(n){if(he(n))switch(n.type===Bn.LINE&&++gh.lineindex,n.lineindex=gh.lineindex,n.type){case Bn.PROGRAM:n.lines.forEach(Em);break;case Bn.LINE:n.stmts.forEach(Em);break;case Bn.MARK:n4(n.id,n.lineindex);break;case Bn.IF:Em(n.check),Em(n.block);break;case Bn.IF_BLOCK:n.lines.forEach(Em),n.altlines.forEach(Em);break;case Bn.ELSE_IF:n.lines.forEach(Em);break;case Bn.ELSE:case Bn.WHILE:case Bn.REPEAT:case Bn.FOREACH:case Bn.WAITFOR:n.lines.forEach(Em);break;case Bn.MOVE:case Bn.COMMAND:case Bn.IF_CHECK:n.words.forEach(Em);break}}function mJ(n){gh.labels={},gh.internal=1,gh.lineindex=0,gh.isfirststat=!0,Em(n)}function Swe(n){return mJ(n),{...es(n).toStringWithSourceMap({file:`${OO}.map`}),...gh}}function Ewe(n,e){const t=`compile-${n}`;console.time(t);const r=QZ(e);if(console.timeEnd(t),M7&&console.info(e,r.errors),r.errors&&r.errors.length>0)return console.info(e,r.tokens,r.errors),r;if(!r.ast)return{...r,errors:[{message:"no ast output",offset:0,line:0,column:0,length:0}]};const i=Swe(r.ast);if(i.code){M7&&console.info(i.code);try{return{...r,...i,source:i.code,code:new Function("api",i.code)}}catch(s){return{errors:[{message:`unexpected error ${s.message}`,offset:0,line:0,column:0,length:0}],source:"",code:new Function("api"," ")}}}return{...r,...i,source:"",code:new Function("api"," ")}}function xwe(){const n={},e={};function t(i,s){const o=n[s];if(o)return o;const a=Ewe(i,s);return n[s]=a,a}const r={ids(){return Object.keys(e)},isended(i){const s=e[i];return he(s)?s.isended():!0},scrollunlock(i,s){const o=e[i];he(o)&&o.scrollunlock(s)},halt(i){const s=e[i];return he(s)&&(s.halt(),delete e[i]),!!s},gc(){const i=r.ids();for(let s=0;s<i.length;++s)r.isended(i[s])&&r.halt(i[s])},arg(i,s){const o=e[i];he(o)&&o.set("arg",s)},boot(i,s,o,a){let c=e[i];if(!he(e[i])){const l=t(o,a);if(c=e[i]=LLe(i,s,l),l.errors?.length){const[u]=l.errors,h=(u?.line??2)-1,f=a.replaceAll(`\r
`,"").split(`
`).map((S,b)=>[S,b]),d=f.slice(h-2,h);for(let S=0;S<d.length;++S){const[b,T]=d[S];_r(qe,$m(),"build",`$grey${T+1} $grey${b}`)}const[p,m]=f[h]??[];if(un(p)&&he(m)){const S=(u.column??1)-1,b=S+u.length,T=S<p.length?p:`${p}*`,w=T.substring(0,S),R=T.substring(S,b),C=T.substring(b);_r(qe,$m(),"build",`$red${m+1} $grey${w}$red${R}$grey${C}`)}const _=f.slice(h+1,h+3);for(let S=0;S<_.length;++S){const[b,T]=_[S];_r(qe,$m(),"build",`$grey${T+1} $grey${b}`)}const v=u.message.split(`
`).slice(0,4).join(" ");_r(qe,$m(),"build",v);return}}return c},tick(i,s,o,a,c){return!!r.boot(i,s,a,c)?.tick(o)},once(i,s,o,a){r.boot(i,s,o,a)?.once(),r.halt(i)},message(i){const{target:s,path:o}=Vv(i.target),a=e[s];if(he(a)){const c={...i,target:o};a.message(c)}}};return r}const gJ={};function zE(n){return gJ[n]?.content}function Twe(n){return gJ[n]?.format}function Fb(n){return sr(n)&&typeof n[0]=="string"}function wwe(n){const e=fe.words[n];return un(e)?[e,n+1]:[void 0,n]}function s2(n){const e=fe.words[n];if(Fb(e))return[e,n+1];const[t,r]=gI(n),[i,s]=wwe(r);return un(i)&&(i==="empty"||Sp({kind:i}))?[[i,t],s]:[void 0,n]}function mA(n){if(!Fb(n))return;const[e]=n;return e}function XM(n){if(!Fb(n))return;const[,e]=n,t=he(e)?pI(e):void 0;return he(t)?t:void 0}function _J(n){if(!Fb(n))return;const[,e]=n,t=he(e)?mI(e):void 0;return he(t)?kU(t):void 0}function r4(n,e,t,r){if(!he(n))return!1;const i=xu(n);return!(he(e)&&e!==i.name||he(t)&&t!==i.color||he(r)&&r!==i.bg)}function Gx(n,e){const t=n??Fn.ISWALK,r=e??Fn.ISWALK;if(t===Fn.ISGHOST||r===Fn.ISGHOST)return!1;switch(t){case Fn.ISWALK:return r!==Fn.ISWALK;case Fn.ISSWIM:return r!==Fn.ISSWIM;case Fn.ISSOLID:return!0;case Fn.ISBULLET:return r!==Fn.ISWALK&&r!==Fn.ISSWIM}}function zw(n,e,t){const r=n?.objects[t];if(he(r))return r;const i=Wx(n,"player");return he(e)?(e.x<0&&(e.x=mu(0,bn-1)),e.y<0&&(e.y=mu(0,wr-1)),yJ(e,i)):td(...i)}function Cz(n,e){const t=he(e)?pI(e):void 0,r=he(e)?mI(e):void 0,i=[];if(he(n)){for(let o=0;o<n.terrain.length;++o){const a=n.terrain[o];he(a)&&r4(a,void 0,t,r)&&i.push(a)}const s=Object.values(n.objects);for(let o=0;o<s.length;++o){const a=s[o];r4(a,void 0,t,r)&&i.push(a)}}return i}function vJ(n,e){return he(n)?e.map(t=>{if(typeof t=="string"){const r=n.objects[t];if(he(r))return r;const i=Wx(n,cr(t));if(i.length)return i}else if(Dv(t)&&t.x>=0&&t.x<bn&&t.y>=0&&t.y<wr){const r=t.x+t.y*bn,i=n.lookup?.[r];return he(i)?n.objects[i]:n.terrain[r]}}).flat().filter(he):[]}function Awe(n,e,t,r){if(!he(n))return;he(n.distmaps)||(n.distmaps={});const i=`${e}.${t.x}.${t.y}.${r.x}.${r.y}`;let s=n.distmaps[i];if(!he(s)){s=new Array(cg).fill(-2);const o=[{...r}];let a=0;for(;o.length;){const c=o.shift();if(he(c)&&zb(c)){const l=od(c,bn);if(s[l]===-2){const u=Gv(n,c.x,c.y);Gx(e,ri(u,"collision"))||(s[l]=a,o.push({x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y})),++a}}}n.distmaps[i]=s}return s}function Rz(n,e){return zb(n)?e[od(n,bn)]:-1}function ZM(n,e){const t=mA(e),r=XM(e),i=_J(e);return Wx(n,t??"").filter(s=>r4(s,t,r,i))}function Wx(n,e){const t=n?.named?.[e];return he(t)?[...t.values()].map(i=>typeof i=="string"?n?.objects[i]:n?.terrain[i]).filter(he):[]}function Cwe(n){const e=[];for(let t=0;t<wr;++t)for(let r=0;r<bn;++r){const i={x:r,y:t},s=ds(n,i);!s?.name&&!s?.kind&&e.push(i)}return e}function yJ(n,e){let t=0,r;for(let i=0;i<e.length;++i){const s=e[i];if(s){const o=n.x-(s.x??0),a=n.y-(s.y??0),c=Math.sqrt(o*o+a*a);(r===void 0||c<t)&&(t=c,r=s)}}return r}function kz(n,e,t,r,i){if(!he(n))return;const s=Awe(n,e,t,r);if(!he(s))return;const o=[{x:t.x,y:t.y-1},{x:t.x,y:t.y+1},{x:t.x-1,y:t.y},{x:t.x+1,y:t.y}];let a;if(i){let c=i?0:1e4;for(let l=0;l<o.length;++l){const u=Rz(o[l],s);u>=0&&u>c&&(c=u,a=o[l])}}else{let c=1e5;for(let l=0;l<o.length;++l){const u=Rz(o[l],s);u>=0&&u<c&&(c=u,a=o[l])}}return a}function RE(n,e,t,r){const i=bJ(e);if(!he(n)||!he(i))return!1;const s=wh(i,e);if(!As(s)||!s?.id)return!1;const o=Cs(t);if(!he(o))return!1;hc(o);const a=CU(o,Fn.ISWALK,r,!0);if(!he(a)&&!As(a)){const c=ri(a,"collision");if(Gx(Fn.ISWALK,c))return!1}return z6(i,s),delete i.objects[s.id],s.x=r.x,s.y=r.y,o.objects[s.id]=s,QL(o,s),JZ(o,s),ZL(n,e,"enterx",r.x),ZL(n,e,"entery",r.y),Mwe(n,e,o.id),!0}function Rwe(n){const t=(n?.activelist??[]).map(r=>{const i=KM(n,r,"board");return un(i)?i:""});return WSe(t)}function kwe(n){const e=Rwe(n),t=new Set,r=[];for(let i=0;i<e.length;++i){const s=Cs(e[i]);if(he(s)&&!t.has(s.id)){HLe(s);const o=Cs(s.overboard??"");he(o)&&(t.has(o.id)||r.push(o)),r.push(s)}}return r}function Mwe(n,e,t){if(!he(n))return;ZL(n,e,"board",t);const r=Cs(t);he(r)?n.activelist.includes(e)||n.activelist.push(e):n.activelist=n.activelist.filter(i=>i!==e)}function bJ(n){const e=Um(ac.MAIN),t=KM(e,n,"board"),r=vu(Jr.BOARD,t);return dA(r)}const NO=xwe();function o2(n){NO.halt(n)}function Iwe(n){NO.message(n)}function Owe(n,e,t,r){if(!he(n)||!he(e)||!he(t))return;const i={...fe};fe.book=n,fe.board=e,fe.element=t,fe.elementid=t.id??"",fe.elementisplayer=zl(fe.elementid);const s=fe.element.player??$m();fe.elementfocus=fe.elementisplayer?fe.elementid:s;const o=ri(t,"cycle"),a=t.id??"",c=cr(t.name??t.kinddata?.name??"");if(NO.tick(a,wU.RUNTIME,o,c,r),rn(t?.tickertime)&&fe.timestamp-t.tickertime>uC*5&&(t.tickertime=0,t.tickertext=""),fe.elementisplayer){const l=G0(fe.elementid);rn(l.inputcurrent)&&(l.inputcurrent=0)}Zm(i).forEach(l=>{fe[l]=i[l]})}function JM(n){const e=Iv(ac.MAIN),t=pA(e,n);if(!he(e)||!he(t))return;const r={...fe},i=`${n}_run`,s=fe.element?.name??fe.element?.kinddata?.name??"",o=t?.code??"";NO.once(i,wU.RUNTIME,cr(s),o),Zm(r).forEach(a=>{fe[a]=r[a]})}const SJ={issolid:"ISSOLID",iswalk:"ISWALK",isswim:"ISSWIM",isbullet:"ISBULLET",isghost:"ISGHOST",iswalking:"ISWALK",iswalkable:"ISWALK",isswimming:"ISSWIM",isswimmable:"ISSWIM"};Fn.ISSOLID,Fn.ISWALK,Fn.ISSWIM,Fn.ISBULLET,Fn.ISGHOST,Fn.ISWALK,Fn.ISSWIM;function QM(n){return sr(n)&&i4(n[0])}function i4(n){return he(Fn[n])&&un(n)}function EJ(n){if(un(n))return SJ[cr(n)]}function Nwe(n){const e=fe.words[n];if(QM(e))return[e,n+1];if(i4(e))return[[e],n+1];const[t,r]=uu(n);return QM(t)?[t,r]:i4(t)?[[t],r]:[void 0,n]}function XS(n,e=0){const t=[];let r=n;for(;r<fe.words.length;){const[i,s]=uu(r);if(sr(i)&&!_d(i)&&!gA(i)&&!QM(i)&&!dc(i)&&t.push(...i),i==="|")return[t,s];if(r=s,t.push(i),e>0&&t.length>=e)return[t,r]}return[t,r]}function uu(n){const e=fe.words[n],t=n+1;if(G6(e)){const[r,i]=Pwe(n);if(he(r))return[r,i]}if(EJ(e)){const[r,i]=Nwe(n);if(he(r))return[r,i]}if(xx(e)){const[r,i]=gI(n);if(he(r))return[r,i]}if(un(e)&&cr(e)==="rnd"){const[r,i]=uu(t),[s,o]=uu(i);return rn(r)&&rn(s)?[mu(r,s),o]:rn(r)?[mu(0,r),i]:[mu(0,1),t]}if(aC(e)){const[r,i]=rK(n);if(he(r))return[r,i]}if(!he(e))return[void 0,n];if(rn(e)||sr(e))return[e,t];if(un(e)){const r=cr(e),i=fe.get?.(e);if(he(i))return[i,t];switch(r){case"aligned":case"alligned":{const s=zw(fe.board,{x:fe.element?.x??-1,y:fe.element?.y??-1},fe.elementfocus);return!he(fe.element)||!he(s)?[0,t]:[fe.element.x===s.x||fe.element.y===s.y?1:0,t]}case"contact":{const s=zw(fe.board,{x:fe.element?.x??-1,y:fe.element?.y??-1},fe.elementfocus);if(!he(fe.element)||!he(s))return[0,t];const o=(s.x??0)-(fe.element?.x??0),a=(s.y??0)-(fe.element?.y??0);return[o===0&&Math.abs(a)<2||a===0&&Math.abs(o)<2?1:0,t]}case"blocked":{const[s,o]=Pt(fe.words,t,[lt.DIR]);return[BLe(fe.board,fe.element,s.destpt)?1:0,o]}case"any":{const[s]=Pt(fe.words,t,[lt.ANY]);if(_d(s)){const[l,u,h]=Pt(fe.words,t,[lt.DIR,lt.COLOR_OR_KIND]);if(l.targets.length){const[d,p]=u,m=[];for(let _=0;_<l.targets.length;++_){const v=l.targets[_],S=["any","at",v.x,v.y,...sr(p)?p:[],d].filter(T=>T!==void 0),[b]=Pt(S,0,[lt.ANY]);sr(b)&&b.length&&m.push(...b)}return[m,h]}let f;switch(l.layer){default:case yn.MID:f=ds(fe.board,l.destpt);break;case yn.GROUND:f=Gv(fe.board,l.destpt.x,l.destpt.y);break}if(he(f)){const d=xu(f);if(dc(u))return[pI(u)===d.color||mI(u)===d.bg?[f]:[],h];const p=cr(mA(u)),m=XM(u);if((p.length&&p!==d.name||he(m)&&m!==d.color)===!1)return[[f],h]}return[[],h]}const[o,a]=Pt(fe.words,t,[lt.COLOR_OR_KIND]);return dc(o)?[Cz(fe.board,o),a]:[ZM(fe.board,o),a]}case"countof":{const[s]=Pt(fe.words,t,[lt.ANY]);if(_d(s)){const[l,u,h]=Pt(fe.words,t,[lt.DIR,lt.COLOR_OR_KIND]);if(l.targets.length){let d=0;const[p,m]=u;for(let _=0;_<l.targets.length;++_){const v=l.targets[_],S=["countof","at",v.x,v.y,...sr(m)?m:[],p].filter(T=>T!==void 0),[b]=Pt(S,0,[lt.ANY]);rn(b)&&(d+=b)}return[d,h]}let f;switch(l.layer){default:case yn.MID:f=ds(fe.board,l.destpt);break;case yn.GROUND:f=Gv(fe.board,l.destpt.x,l.destpt.y);break}if(he(f)){const d=xu(f);if(dc(u))return[pI(u)===d.color||mI(u)===d.bg?1:0,h];const p=cr(mA(u)),m=XM(u),_=p.length?p===d.name:!0,v=he(m)?m===d.color:!0;if(_&&v)return[1,h]}return[0,h]}const[o,a]=Pt(fe.words,t,[lt.COLOR_OR_KIND]);return dc(o)?[Cz(fe.board,o).length,a]:[ZM(fe.board,o).length,a]}case"rnd":return[mu(0,1),t];case"abs":{const[s,o]=Pt(fe.words,t,[lt.NUMBER]);return[Math.abs(s),o]}case"intceil":{const[s,o]=Pt(fe.words,t,[lt.NUMBER]);return[Math.ceil(s),o]}case"intfloor":{const[s,o]=Pt(fe.words,t,[lt.NUMBER]);return[Math.floor(s),o]}case"intround":{const[s,o]=Pt(fe.words,t,[lt.NUMBER]);return[Math.round(s),o]}case"clamp":{const[s,o,a,c]=Pt(fe.words,t,[lt.NUMBER,lt.NUMBER,lt.NUMBER]);return[Ri(s,o,a),c]}case"min":{const[s,o]=XS(t);return[Math.min(...s),o]}case"max":{const[s,o]=XS(t);return[Math.max(...s),o]}case"pick":{const[s,o]=XS(t);return[td(s),o]}case"pickwith":{const[s,o]=Pt(fe.words,t,[lt.NUMBER_OR_STRING]),[a,c]=XS(o);return[GSe(`${s}`,a),c]}case"random":{const[s,o]=XS(t,2),[a,c]=s;return[mu(a,c??0),o]}case"randomwith":{const[s,o]=Pt(fe.words,t,[lt.NUMBER_OR_STRING]),[a,c]=XS(o,2),[l,u]=a;return[AY(`${s}`,l,u??0),c]}case"run":{const[s,o]=Pt(fe.words,t,[lt.NAME]);return JM(s),[fe.get?.("arg"),o]}case"runwith":{const[s,o,a]=Pt(fe.words,t,[lt.ANY,lt.NAME]);return he(fe.element)&&(fe.element.arg=s),JM(o),[fe.get?.("arg"),a]}}}return[e,t]}const xJ={isterrain:"ISTERRAIN",isobject:"ISOBJECT"};function gA(n){return sr(n)&&TJ(n[0])}function TJ(n){return he(qb[n])&&un(n)}function G6(n){if(un(n))return xJ[cr(n)]}function Mz(n){if(gA(n))return n;if(TJ(n))return[n];const e=G6(n);if(he(e))return[e]}function Pwe(n){const e=fe.words[n],t=Mz(e);if(gA(t))return[t,n+1];const[r,i]=uu(n),s=Mz(r);return gA(s)?[s,i]:[void 0,n]}function fh(n,e,t,r){const[i,s]=Pt(r,0,[lt.NUMBER_OR_STRING,lt.MAYBE_NUMBER_OR_STRING]);$Y(qe,n,e,t,i,s)}const Dwe=["echo","reverb","autofilter","distortion","vibrato","fc","fcrush","autowah"];function W6(n,e,t){const[r,i]=Pt(t,0,[lt.NUMBER_OR_STRING]);if(rn(r))KN(qe,n,e,"volume",r);else if(Dwe.includes(cr(r))){const[s,o]=Pt(t,i,[lt.NUMBER_OR_STRING,lt.MAYBE_NUMBER_OR_STRING]);$Y(qe,n,e,r,s,o)}else{const[s]=Pt(t,i,[lt.MAYBE_NUMBER_OR_STRING]);if(rn(s)){const o=t.length-i,a=new Array(o).fill(lt.NUMBER),c=Pt(t,i,a).slice(0,o),l=c.length===1?c[0]:c;KN(qe,n,e,r,l)}else{const[o]=Pt(t,i,[lt.MAYBE_NUMBER_OR_STRING]);KN(qe,n,e,r,o)}}}function wJ(n,e){const[t]=Pt(e,0,[lt.MAYBE_NAME]);let r="";if(un(t)){const i=n.get(t);r=un(i)&&!he(G6(i))&&!he(EJ(i))&&!he(xx(i))&&!he(aC(i))?i:t}return r}function dv(n,e,t){jEe(qe,fe.elementfocus,fe.board?.id??"",wJ(n,e),t)}const PO=ty().command("ttsengine",(n,e)=>{const[t,r]=Pt(e,0,[lt.STRING,lt.MAYBE_STRING]);return GEe(qe,fe.elementfocus,t,r??""),0}).command("tts",(n,e)=>{const[t,r]=Pt(e,0,[lt.MAYBE_NUMBER_OR_STRING,lt.MAYBE_STRING]);return he(t)&&he(r)?WEe(qe,fe.elementfocus,fe.board?.id??"",t,r):un(t)?qEe(qe,fe.elementfocus,t):KEe(qe,fe.elementfocus),0}).command("ttsqueue",(n,e)=>{const[t,r]=Pt(e,0,[lt.NUMBER_OR_STRING,lt.STRING]);return YEe(qe,fe.elementfocus,fe.board?.id??"",t,r),0}).command("bpm",(n,e)=>{const[t]=Pt(e,0,[lt.NUMBER]);return zEe(qe,fe.elementfocus,t),0}).command("vol",(n,e)=>{const[t]=Pt(e,0,[lt.NUMBER]);return $Ee(qe,fe.elementfocus,t),0}).command("bgvol",(n,e)=>{const[t]=Pt(e,0,[lt.NUMBER]);return VEe(qe,fe.elementfocus,t),0}).command("ttsvol",(n,e)=>{const[t]=Pt(e,0,[lt.NUMBER]);return HEe(qe,fe.elementfocus,t),0}).command("play",(n,e)=>(FEe(qe,fe.elementfocus,fe.board?.id??"",wJ(n,e)),0)).command("bgplay",(n,e)=>(dv(n,e,""),0)).command("bgplayon64n",(n,e)=>(dv(n,e,"@64n"),0)).command("bgplayon32n",(n,e)=>(dv(n,e,"@32n"),0)).command("bgplayon16n",(n,e)=>(dv(n,e,"@16n"),0)).command("bgplayon8n",(n,e)=>(dv(n,e,"@8n"),0)).command("bgplayon4n",(n,e)=>(dv(n,e,"@4n"),0)).command("bgplayon2n",(n,e)=>(dv(n,e,"@2n"),0)).command("bgplayon1n",(n,e)=>(dv(n,e,"@1m"),0)).command("synth",(n,e)=>{if(e.length===0)return BEe(qe,fe.elementfocus),0;for(let t=0;t<4;++t)W6(fe.elementfocus,t,e);return 0}).command("synthrecord",(n,e)=>{const[t]=Pt(e,0,[lt.MAYBE_STRING]);return XEe(qe,fe.elementfocus,t??""),0}).command("synthflush",()=>(ZEe(qe,fe.elementfocus),0)).command("echo",(n,e)=>{for(let t=0;t<2;++t)fh(fe.elementfocus,t,"echo",e);return 0}).command("fcrush",(n,e)=>{for(let t=0;t<2;++t)fh(fe.elementfocus,t,"fc",e);return 0}).command("autofilter",(n,e)=>{for(let t=0;t<2;++t)fh(fe.elementfocus,t,"autofilter",e);return 0}).command("reverb",(n,e)=>{for(let t=0;t<2;++t)fh(fe.elementfocus,t,"reverb",e);return 0}).command("distort",(n,e)=>{for(let t=0;t<2;++t)fh(fe.elementfocus,t,"distort",e);return 0}).command("vibrato",(n,e)=>{for(let t=0;t<2;++t)fh(fe.elementfocus,t,"vibrato",e);return 0}).command("autowah",(n,e)=>{for(let t=0;t<2;++t)fh(fe.elementfocus,t,"autowah",e);return 0});for(let n=0;n<4;++n)PO.command(`synth${n+1}`,(e,t)=>(W6(fe.elementfocus,n,t),0));PO.command("synth5",(n,e)=>{for(let t=4;t<8;++t)W6(fe.elementfocus,t,e);return 0});for(let n=0;n<4;++n){const e=n+1;PO.command(`echo${e}`,(t,r)=>(fh(fe.elementfocus,n,"echo",r),0)).command(`fcrush${e}`,(t,r)=>(fh(fe.elementfocus,n,"fcrush",r),0)).command(`autofilter${e}`,(t,r)=>(fh(fe.elementfocus,n,"autofilter",r),0)).command(`reverb${e}`,(t,r)=>(fh(fe.elementfocus,n,"reverb",r),0)).command(`distort${e}`,(t,r)=>(fh(fe.elementfocus,n,"distort",r),0)).command(`vibrato${e}`,(t,r)=>(fh(fe.elementfocus,n,"vibrato",r),0)).command(`autowah${e}`,(t,r)=>(fh(fe.elementfocus,n,"autowah",r),0))}function Iz(n,e,t,r){for(let i=t.y;i<=r.y;++i)for(let s=t.x;s<=r.x;++s){const o=ds(e,{x:s,y:i});As(o)&&fd(e,o,n.timestamp),Fl(e,{x:s,y:i})}}function Lwe(n,e,t){for(let r=e.y;r<=t.y;++r)for(let i=e.x;i<=t.x;++i)Fl(n,{x:i,y:r})}function Oz(n,e,t,r){for(let i=t.y;i<=r.y;++i)for(let s=t.x;s<=r.x;++s){const o=ds(e,{x:s,y:i});As(o)&&fd(e,o,n.timestamp),Fl(e,{x:s,y:i})}}function e1(n,e){he(n)&&(n.name=e.name,n.char=e.char,n.color=e.color,n.bg=e.bg,n.displaychar=e.displaychar,n.displaycolor=e.displaycolor,n.displaybg=e.displaybg,n.p1=e.p1,n.p2=e.p2,n.p3=e.p3,n.p4=e.p4,n.p5=e.p5,n.p6=e.p6,n.p7=e.p7,n.p8=e.p8,n.p9=e.p9,n.p10=e.p10,n.code=e.code,n.item=e.item,n.group=e.group,n.party=e.party,n.cycle=e.cycle,n.light=e.light,n.lightdir=e.lightdir,n.stepx=e.stepx,n.stepy=e.stepy,n.shootx=e.shootx,n.shooty=e.shooty,n.pushable=e.pushable,n.collision=e.collision,n.breakable=e.breakable,n.tickertext=e.tickertext,n.tickertime=e.tickertime)}function DO(n,e,t,r,i){switch(i){case"all":case"object":case"terrain":break;default:return Uwe(n,e,t,"",i)}if(!he(fe.book))return;const s=fe.book,o=Cs(n);if(!he(o))return;const a=Cs(e);if(!he(a))return;hc(o),hc(a);let c=!1;if(he(o)&&he(a)){switch(i){case"all":Iz(s,a,t,r);break;case"object":Oz(s,a,t,r);break;case"terrain":Lwe(a,t,r);break;default:c=!0;break}for(let l=t.y;l<=r.y;++l)for(let u=t.x;u<=r.x;++u){let h=!1,f=!1;switch(i){case"all":h=!0,f=!0;break;case"object":h=!0;break;case"terrain":f=!0;break}const d={x:u,y:l};let p,m=ds(o,d);if(As(m)?(p=Gv(o,u,l),zl(m?.id)&&(m=void 0)):(p=m,m=void 0),he(p)&&(f||c&&ri(p,"group")===i)){c&&Iz(s,a,d,d);const _=hd(a,[p.kind??""],d);e1(_,p)}if(he(m)&&(h||c&&ri(m,"group")===i)){c&&Oz(s,a,d,d);const _=hd(a,[m.kind??""],d);e1(_,m)}}hc(a)}}function Uwe(n,e,t,r,i){if(!he(fe.book))return;const s=fe.book,o=Cs(n);if(!he(o))return;const a=Cs(e);if(he(a)&&(hc(o),hc(a),he(o)&&he(a))){const{terrainelements:c,objectelements:l}=mee(o,r,i);if(c.length===0&&l.length===0)return;const u={x:bn,y:wr};for(let h=0;h<c.length;++h){const f=c[h];rn(f.x)&&(u.x=Math.min(u.x,f.x)),rn(f.y)&&(u.y=Math.min(u.y,f.y))}for(let h=0;h<l.length;++h){const f=l[h];rn(f.x)&&(u.x=Math.min(u.x,f.x)),rn(f.y)&&(u.y=Math.min(u.y,f.y))}for(let h=0;h<c.length;++h){const f=c[h],d={x:t.x+(f.x??0)-u.x,y:t.y+(f.y??0)-u.y},p=ds(a,d);he(p)&&(As(p)&&fd(a,p,s.timestamp),Fl(a,d));const m=hd(a,[f.kind??""],d);e1(m,f)}for(let h=0;h<l.length;++h){const f=l[h],d={x:t.x+(f.x??0)-u.x,y:t.y+(f.y??0)-u.y},p=hd(a,[f.kind??""],d);e1(p,f)}hc(a)}}function BR(n,e,t){if(!he(fe.element?.x)||!he(fe.element.y))return 0;if(fe.elementisplayer){const c=fe.board?.maxplayershots??0;if(c>0&&$Le(fe.board).filter(u=>!u.removed&&zl(u.party)&&ri(u,"collision")===Fn.ISBULLET).length>=c)return n.set("didshoot",0),n.yield(),0}const[r,i]=Pt(e,0,[lt.DIR,lt.MAYBE_KIND]),[s]=i??[];if(cr(s)==="player")return n.set("didshoot",0),n.yield(),0;fe.element.shootx=Ri(r.destpt.x-r.startpt.x,-1,1),fe.element.shooty=Ri(r.destpt.y-r.startpt.y,-1,1);const o=i??["bullet"],a=uTe(fe.board,o,{x:fe.element.x,y:fe.element.y});if(he(a)){he(t)&&(a.arg=t),a.cycle=1,a.party=fe.element.party??fe.element.id??"",a.collision=Fn.ISBULLET,a.breakable=1,a.stepx=r.destpt.x-fe.element.x,a.stepy=r.destpt.y-fe.element.y,a.bg=Ft.ONCLEAR;const c=Sp(a),l=a.code??c?.code??"";Owe(fe.book,fe.board,a,l)}return fe.elementisplayer&&n.set("didshoot",he(a)?1:0),n.yield(),0}function Rw(n,e,t){if(!Dv(fe.element)||!he(fe.book)||!he(fe.board)||!he(fe.element))return 0;const[r,i]=Pt(n,0,[lt.DIR,lt.KIND]),[s]=i;if(cr(s)==="player")return 0;if(r.targets.length){for(let f=0;f<r.targets.length;++f){const d=r.targets[f];Rw(["at",d.x,d.y,...i],e,t)}return 0}const{destpt:o}=r;if(o.x<0||o.x>=bn||o.y<0||o.y>=wr)return 0;const[a]=i,c={x:fe.element?.x??0,y:fe.element?.y??0},l=Sp({kind:a});if(ri(l,"collision")===Fn.ISGHOST)return hd(fe.board,i,r.destpt,e),0;let h=ds(fe.board,r.destpt);if(As(h)&&ri(h,"pushable")){const f=Ks(r.destpt),d=Ho(f,cp(c,f));ff(fe.book,fe.board,h,d),h=ds(fe.board,r.destpt)}if(a==="empty")return fd(fe.board,h,fe.timestamp),0;if(h?.kind===a){const[,f]=i;return Pb(h,f),0}if(As(h)&&fd(fe.board,h,fe.timestamp),As(l)||hd(fe.board,i,r.destpt,e),As(l)){const f=hd(fe.board,i,r.destpt,e);he(f)&&he(t)&&(f.arg=t)}return 0}function FR(n,e,t){if(!he(fe.book)||!he(fe.board))return 1;const[r,i]=Pt(e,0,[lt.DIR,lt.DIR]),s=ds(fe.board,r.destpt);if(he(s)&&he(s.kind)){const[o]=s.kind;if(cr(o)==="player")return 1;const a=ri(s,"collision"),c=CU(fe.board,a,i.destpt);if(he(c))return 1;const l=hd(fe.board,[s.kind],i.destpt);if(!he(l))return 1;e1(l,s),he(t)&&(l.arg=t)}else return 1;return 0}const Bwe={x:0,y:0},Fwe={x:bn-1,y:wr-1},jwe="all",zwe=ty().command("build",(n,e)=>{if(!he(fe.book)||!he(fe.board)||!he(fe.element))return 0;const[t,r]=Pt(e,0,[lt.NAME,lt.MAYBE_STRING]),[i]=lTe(ac.TEMP,Yo(),Jr.BOARD);if(!he(i))return 0;const s=dA(i);if(!he(s))return 0;if(un(r)){const o=Cs(r);if(he(o))switch(DO(o.id,s.id,Bwe,Fwe,jwe),s.isdark=o.isdark,s.startx=o.startx,s.starty=o.starty,s.over=o.over,s.under=o.under,s.camera=o.camera,s.graphics=o.graphics,s.facing=o.facing,s.charset=o.charset,s.palette=o.palette,s.timelimit=o.timelimit,s.restartonzap=o.restartonzap,s.maxplayershots=o.maxplayershots,s.b1=o.b1,s.b2=o.b2,s.b3=o.b3,s.b4=o.b4,s.b5=o.b5,s.b6=o.b6,s.b7=o.b7,s.b8=o.b8,s.b9=o.b9,s.b10=o.b10,cr(t)){case"exitwest":s.exiteast=fe.board.id;break;case"exiteast":s.exitwest=fe.board.id;break;case"exitnorth":s.exitsouth=fe.board.id;break;case"exitsouth":s.exitnorth=fe.board.id;break}}return n.set(t,s.id),0}).command("goto",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r]=Pt(e,0,[lt.STRING]),[i,s]=Pt(e,r,[lt.MAYBE_NUMBER,lt.MAYBE_NUMBER]),o=Cs(t);if(!he(o))return 0;hc(o);const a={x:i??o.startx??Math.round(bn*.5),y:s??o.starty??Math.round(wr*.5)},c=xu(fe.element);if(c.name!=="player"){const l=ri(fe.element,"color"),u=ri(fe.element,"bg"),h=XO(l,u),f=ZM(o,[c.name,h]),[d]=f.sort((p,m)=>{const _=p.y??1e4,v=m.y??1e4,S=_-v;if(S!==0)return S;const b=p.x??1e4,T=m.x??1e4;return b-T});he(d)&&rn(d.x)&&rn(d.y)&&(a.x=d.x,a.y=d.y)}return RE(fe.book,fe.elementfocus,o.id,a),0}).command("transport",(n,e)=>{if(!he(fe.book)||!he(fe.board)||!he(fe.element))return 0;const[t]=Pt(e,0,[lt.STRING]),r=wh(fe.board,t);if(he(fe.element?.x)&&he(fe.element.y)&&he(r?.x)&&he(r.y)){let i=!0;const s={x:fe.element.x,y:fe.element.y},o=s.x-r.x,a=s.y-r.y;if(ri(fe.element,"shootx")!==o||ri(fe.element,"shooty")!==a)return 0;for(;i&&(s.x+=o,s.y+=a,!(s.x<0||s.x>=bn||s.y<0||s.y>=wr));){const c=ds(fe.board,s);c?.kind===fe.element.kind&&ri(c,"shootx")===-o&&ri(c,"shooty")===-a&&ff(fe.book,fe.board,r,{x:s.x+o,y:s.y+a})&&(i=!1)}i&&ff(fe.book,fe.board,r,{x:fe.element.x+o,y:fe.element.y+a})}return 0}).command("shove",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r]=Pt(e,0,[lt.DIR,lt.DIR]),i=ds(fe.board,t.destpt);if(As(i)){const s=t.destpt.x+(r.destpt.x-r.startpt.x),o=t.destpt.y+(r.destpt.y-r.startpt.y);ff(fe.book,fe.board,i,{x:s,y:o})}return 0}).command("push",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r]=Pt(e,0,[lt.DIR,lt.DIR]),i=ds(fe.board,t.destpt);if(As(i)&&ri(i,"pushable")){const s=t.destpt.x+(r.destpt.x-r.startpt.x),o=t.destpt.y+(r.destpt.y-r.startpt.y);ff(fe.book,fe.board,i,{x:s,y:o})}return 0}).command("duplicate",FR).command("duplicatewith",(n,e)=>{const[t,r]=Pt(e,0,[lt.ANY]);return FR(e.slice(r),t)}).command("dupe",FR).command("dupewith",(n,e)=>{const[t,r]=Pt(e,0,[lt.ANY]);return FR(e.slice(r),t)}).command("write",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r,i]=Pt(e,0,[lt.DIR,lt.COLOR]),s=e.slice(i).map(ro).join(" "),{color:o,bg:a}=kE(r),c=f_(s,256,1)?.measuredwidth??1,l=h_(256,1,o??Ft.WHITE,a??Ft.BLACK);ei(s,l,!1);const u=c-1;switch(cp(t.startpt,t.destpt)){case yn.EAST:for(let f=0;f<c;++f)Fl(fe.board,{x:t.destpt.x+f,y:t.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case yn.WEST:for(let f=0;f<c;++f)Fl(fe.board,{x:t.destpt.x+f-u,y:t.destpt.y,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case yn.NORTH:for(let f=0;f<c;++f)Fl(fe.board,{x:t.destpt.x,y:t.destpt.y+f-u,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break;case yn.SOUTH:for(let f=0;f<c;++f)Fl(fe.board,{x:t.destpt.x,y:t.destpt.y+f,name:"text",char:l.char[f],color:l.color[f],bg:l.bg[f]});break}return 0}).command("change",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r]=Pt(e,0,[lt.KIND,lt.KIND]),[i]=t,[s]=r;if(cr(i)==="player"||cr(s)==="player")return 0;(mA(t)??"")==="empty"&&Cwe(fe.board).forEach(u=>{hd(fe.board,r,u)});const a=mA(r),c=XM(r),l=_J(r);return ZM(fe.board,t).forEach(u=>{if(he(c)&&(u.color=c),he(l)&&(u.bg=l),xu(u).name!==a){const f=ri(u,"color"),d=ri(u,"bg");if(fd(fe.board,u,fe.timestamp),a!=="empty"){const p={x:u.x??0,y:u.y??0},m=hd(fe.board,r,p);he(m)&&(m.color=f,m.bg=d)}}}),0}).command("put",(n,e)=>Rw(e)).command("putwith",(n,e)=>{const[t,r]=Pt(e,0,[lt.ANY]);return Rw(e.slice(r),void 0,t)}).command("oneof",(n,e)=>{const[t,r]=Pt(e,0,[lt.ANY]);return he(fe.board)&&wh(fe.board,t)?0:Rw(e.slice(r),t)}).command("oneofwith",(n,e)=>{const[t,r,i]=Pt(e,0,[lt.ANY,lt.ANY]);return he(fe.board)&&wh(fe.board,r)?0:Rw(e.slice(i),r,t)}).command("shoot",BR).command("shootwith",(n,e)=>{const[t,r]=Pt(e,0,[lt.ANY]);return BR(n,e.slice(r),t)}).command("throwstar",(n,e)=>BR(n,[...e,"star"])).command("throwstarwith",(n,e)=>{const[t,r]=Pt(e,0,[lt.ANY]);return BR(n,[...e.slice(r),"star"],t)}),gp=()=>new Map,s4=n=>{const e=gp();return n.forEach((t,r)=>{e.set(r,t)}),e},ny=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},$we=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},Vwe=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},hx=()=>new Set,a2=n=>n[n.length-1],Hwe=(n,e)=>{for(let t=0;t<e.length;t++)n.push(e[t])},t1=Array.from,q6=(n,e)=>{for(let t=0;t<n.length;t++)if(!e(n[t],t,n))return!1;return!0},Y6=(n,e)=>{for(let t=0;t<n.length;t++)if(e(n[t],t,n))return!0;return!1},Gwe=(n,e)=>{const t=new Array(n);for(let r=0;r<n;r++)t[r]=e(r,t);return t},fx=Array.isArray;class AJ{constructor(){this._observers=gp()}on(e,t){return ny(this._observers,e,hx).add(t),t}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return t1((this._observers.get(e)||gp()).values()).forEach(r=>r(...t))}destroy(){this._observers=gp()}}const eg=Math.floor,Vk=Math.abs,CJ=(n,e)=>n<e?n:e,w1=(n,e)=>n>e?n:e,RJ=n=>n!==0?n<0:1/n<0,Nz=1,Pz=2,c2=4,l2=8,_A=32,W0=64,vf=128,LO=31,o4=63,jb=127,Wwe=2147483647,eI=Number.MAX_SAFE_INTEGER,Dz=Number.MIN_SAFE_INTEGER,qwe=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&eg(n)===n),Ywe=String.fromCharCode,Kwe=n=>n.toLowerCase(),Xwe=/^\s*/g,Zwe=n=>n.replace(Xwe,""),Jwe=/([A-Z])/g,Lz=(n,e)=>Zwe(n.replace(Jwe,t=>`${e}${Kwe(t)}`)),Qwe=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},vA=typeof TextEncoder<"u"?new TextEncoder:null,eAe=n=>vA.encode(n),tAe=vA?eAe:Qwe;let $w=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});$w&&$w.decode(new Uint8Array).length===1&&($w=null);const nAe=(n,e)=>Gwe(e,()=>n).join("");class hC{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const UO=()=>new hC,rAe=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},Vm=n=>{const e=new Uint8Array(rAe(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},iAe=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(w1(t,e)*2),n.cpos=0)},Nc=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},a4=Nc,Ji=(n,e)=>{for(;e>jb;)Nc(n,vf|jb&e),e=eg(e/128);Nc(n,jb&e)},K6=(n,e)=>{const t=RJ(e);for(t&&(e=-e),Nc(n,(e>o4?vf:0)|(t?W0:0)|o4&e),e=eg(e/64);e>0;)Nc(n,(e>jb?vf:0)|jb&e),e=eg(e/128)},c4=new Uint8Array(3e4),sAe=c4.length/3,oAe=(n,e)=>{if(e.length<sAe){const t=vA.encodeInto(e,c4).written||0;Ji(n,t);for(let r=0;r<t;r++)Nc(n,c4[r])}else af(n,tAe(e))},aAe=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Ji(n,r);for(let i=0;i<r;i++)Nc(n,t.codePointAt(i))},$E=vA&&vA.encodeInto?oAe:aAe,BO=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=CJ(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(w1(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},af=(n,e)=>{Ji(n,e.byteLength),BO(n,e)},X6=(n,e)=>{iAe(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},cAe=(n,e)=>X6(n,4).setFloat32(0,e,!1),lAe=(n,e)=>X6(n,8).setFloat64(0,e,!1),uAe=(n,e)=>X6(n,8).setBigInt64(0,e,!1),Uz=new DataView(new ArrayBuffer(4)),hAe=n=>(Uz.setFloat32(0,n),Uz.getFloat32(0)===n),yA=(n,e)=>{switch(typeof e){case"string":Nc(n,119),$E(n,e);break;case"number":qwe(e)&&Vk(e)<=Wwe?(Nc(n,125),K6(n,e)):hAe(e)?(Nc(n,124),cAe(n,e)):(Nc(n,123),lAe(n,e));break;case"bigint":Nc(n,122),uAe(n,e);break;case"object":if(e===null)Nc(n,126);else if(fx(e)){Nc(n,117),Ji(n,e.length);for(let t=0;t<e.length;t++)yA(n,e[t])}else if(e instanceof Uint8Array)Nc(n,116),af(n,e);else{Nc(n,118);const t=Object.keys(e);Ji(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];$E(n,i),yA(n,e[i])}}break;case"boolean":Nc(n,e?120:121);break;default:Nc(n,127)}};class Bz extends hC{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ji(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Fz=n=>{n.count>0&&(K6(n.encoder,n.count===1?n.s:-n.s),n.count>1&&Ji(n.encoder,n.count-2))};class Hk{constructor(){this.encoder=new hC,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Fz(this),this.count=1,this.s=e)}toUint8Array(){return Fz(this),Vm(this.encoder)}}const jz=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);K6(n.encoder,e),n.count>1&&Ji(n.encoder,n.count-2)}};class u2{constructor(){this.encoder=new hC,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(jz(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return jz(this),Vm(this.encoder)}}class fAe{constructor(){this.sarr=[],this.s="",this.lensE=new Hk}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new hC;return this.sarr.push(this.s),this.s="",$E(e,this.sarr.join("")),BO(e,this.lensE.toUint8Array()),Vm(e)}}const tg=n=>new Error(n),_p=()=>{throw tg("Method unimplemented")},vd=()=>{throw tg("Unexpected case")},kJ=tg("Unexpected end of array"),MJ=tg("Integer out of Range");let FO=class{constructor(e){this.arr=e,this.pos=0}};const qx=n=>new FO(n),dAe=n=>n.pos!==n.arr.length,pAe=(n,e)=>{const t=new Uint8Array(n.arr.buffer,n.pos+n.arr.byteOffset,e);return n.pos+=e,t},cf=n=>pAe(n,Ci(n)),dx=n=>n.arr[n.pos++],Ci=n=>{let e=0,t=1;const r=n.arr.length;for(;n.pos<r;){const i=n.arr[n.pos++];if(e=e+(i&jb)*t,t*=128,i<vf)return e;if(e>eI)throw MJ}throw kJ},Z6=n=>{let e=n.arr[n.pos++],t=e&o4,r=64;const i=(e&W0)>0?-1:1;if((e&vf)===0)return i*t;const s=n.arr.length;for(;n.pos<s;){if(e=n.arr[n.pos++],t=t+(e&jb)*r,r*=128,e<vf)return i*t;if(t>eI)throw MJ}throw kJ},mAe=n=>{let e=Ci(n);if(e===0)return"";{let t=String.fromCodePoint(dx(n));if(--e<100)for(;e--;)t+=String.fromCodePoint(dx(n));else for(;e>0;){const r=e<1e4?e:1e4,i=n.arr.subarray(n.pos,n.pos+r);n.pos+=r,t+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(t))}},gAe=n=>$w.decode(cf(n)),VE=$w?gAe:mAe,J6=(n,e)=>{const t=new DataView(n.arr.buffer,n.arr.byteOffset+n.pos,e);return n.pos+=e,t},_Ae=n=>J6(n,4).getFloat32(0,!1),vAe=n=>J6(n,8).getFloat64(0,!1),yAe=n=>J6(n,8).getBigInt64(0,!1),bAe=[n=>{},n=>null,Z6,_Ae,vAe,yAe,n=>!1,n=>!0,VE,n=>{const e=Ci(n),t={};for(let r=0;r<e;r++){const i=VE(n);t[i]=bA(n)}return t},n=>{const e=Ci(n),t=[];for(let r=0;r<e;r++)t.push(bA(n));return t},cf],bA=n=>bAe[127-dx(n)](n);class zz extends FO{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),dAe(this)?this.count=Ci(this)+1:this.count=-1),this.count--,this.s}}class Gk extends FO{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Z6(this);const e=RJ(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ci(this)+2)}return this.count--,this.s}}class h2 extends FO{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Z6(this),t=e&1;this.diff=eg(e/2),this.count=1,t&&(this.count=Ci(this)+2)}return this.s+=this.diff,this.count--,this.s}}class SAe{constructor(e){this.decoder=new Gk(e),this.str=VE(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const EAe=crypto.getRandomValues.bind(crypto),IJ=()=>EAe(new Uint32Array(1))[0],xAe="10000000-1000-4000-8000"+-1e11,TAe=()=>xAe.replace(/[018]/g,n=>(n^IJ()&15>>n/4).toString(16)),wAe=Date.now,$z=n=>new Promise(n);Promise.all.bind(Promise);const Vz=n=>n===void 0?null:n;class AAe{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let OJ=new AAe,CAe=!0;try{typeof localStorage<"u"&&localStorage&&(OJ=localStorage,CAe=!1)}catch{}const RAe=OJ,SA=Symbol("Equality"),NJ=(n,e)=>n===e||!!n?.[SA]?.(e)||!1,kAe=n=>typeof n=="object",MAe=Object.assign,IAe=Object.keys,OAe=(n,e)=>{for(const t in n)e(n[t],t)},tI=n=>IAe(n).length,NAe=n=>{for(const e in n)return!1;return!0},fC=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},Q6=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),PAe=(n,e)=>n===e||tI(n)===tI(e)&&fC(n,(t,r)=>(t!==void 0||Q6(e,r))&&NJ(e[r],t)),DAe=Object.freeze,PJ=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&PJ(n[e])}return DAe(n)},eU=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&eU(n,e,t+1)}},LAe=n=>n,Wk=(n,e)=>{if(n===e)return!0;if(n==null||e==null||n.constructor!==e.constructor&&(n.constructor||Object)!==(e.constructor||Object))return!1;if(n[SA]!=null)return n[SA](e);switch(n.constructor){case ArrayBuffer:n=new Uint8Array(n),e=new Uint8Array(e);case Uint8Array:{if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;break}case Set:{if(n.size!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;break}case Map:{if(n.size!==e.size)return!1;for(const t of n.keys())if(!e.has(t)||!Wk(n.get(t),e.get(t)))return!1;break}case void 0:case Object:if(tI(n)!==tI(e))return!1;for(const t in n)if(!Q6(n,t)||!Wk(n[t],e[t]))return!1;break;case Array:if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Wk(n[t],e[t]))return!1;break;default:return!1}return!0},UAe=(n,e)=>e.includes(n);var DJ={};const EA=typeof Ga<"u"&&Ga.release&&/node|io\.js/.test(Ga.release.name)&&Object.prototype.toString.call(typeof Ga<"u"?Ga:0)==="[object process]";let _m;const BAe=()=>{if(_m===void 0)if(EA){_m=gp();const n=Ga.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&_m.set(e,""),e=r):e!==null&&(_m.set(e,r),e=null)}e!==null&&_m.set(e,"")}else typeof location=="object"?(_m=gp(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");_m.set(`--${Lz(e,"-")}`,t),_m.set(`-${Lz(e,"-")}`,t)}})):_m=gp();return _m},l4=n=>BAe().has(n),nI=n=>Vz(EA?DJ[n.toUpperCase().replaceAll("-","_")]:RAe.getItem(n)),LJ=n=>l4("--"+n)||nI(n)!==null,FAe=LJ("production"),jAe=EA&&UAe(DJ.FORCE_COLOR,["true","1","2"]),zAe=jAe||!l4("--no-colors")&&!LJ("no-color")&&(!EA||Ga.stdout.isTTY)&&(!EA||l4("--color")||nI("COLORTERM")!==null||(nI("TERM")||"").includes("color")),$Ae=n=>new Uint8Array(n),VAe=n=>{const e=$Ae(n.byteLength);return e.set(n),e};class HAe{constructor(e,t){this.left=e,this.right=t}}const A0=(n,e)=>new HAe(n,e),Hz=n=>n.next()>=.5,f2=(n,e,t)=>eg(n.next()*(t+1-e)+e),UJ=(n,e,t)=>eg(n.next()*(t+1-e)+e),tU=(n,e,t)=>UJ(n,e,t),GAe=n=>Ywe(tU(n,97,122)),WAe=(n,e=0,t=20)=>{const r=tU(n,e,t);let i="";for(let s=0;s<r;s++)i+=GAe(n);return i},d2=(n,e)=>e[tU(n,0,e.length-1)],qAe=Symbol("0schema");class YAe{constructor(){this._rerrs=[]}extend(e,t,r,i=null){this._rerrs.push({path:e,expected:t,has:r,message:i})}toString(){const e=[];for(let t=this._rerrs.length-1;t>0;t--){const r=this._rerrs[t];e.push(nAe(" ",(this._rerrs.length-t)*2)+`${r.path!=null?`[${r.path}] `:""}${r.has} doesn't match ${r.expected}. ${r.message}`)}return e.join(`
`)}}const u4=(n,e)=>n===e?!0:n==null||e==null||n.constructor!==e.constructor?!1:n[SA]?NJ(n,e):fx(n)?q6(n,t=>Y6(e,r=>u4(t,r))):kAe(n)?fC(n,(t,r)=>u4(t,e[r])):!1;class Ru{static _dilutes=!1;extends(e){let[t,r]=[this.shape,e.shape];return this.constructor._dilutes&&([r,t]=[t,r]),u4(t,r)}equals(e){return this.constructor===e.constructor&&Wk(this.shape,e.shape)}[qAe](){return!0}[SA](e){return this.equals(e)}validate(e){return this.check(e)}check(e,t){_p()}get nullable(){return Yx(this,HO)}get optional(){return new jJ(this)}cast(e){return Gz(e,this),e}expect(e){return Gz(e,this),e}}class nU extends Ru{constructor(e,t){super(),this.shape=e,this._c=t}check(e,t=void 0){const r=e?.constructor===this.shape&&(this._c==null||this._c(e));return!r&&t?.extend(null,this.shape.name,e?.constructor.name,e?.constructor!==this.shape?"Constructor match failed":"Check failed"),r}}const qa=(n,e=null)=>new nU(n,e);qa(nU);class rU extends Ru{constructor(e){super(),this.shape=e}check(e,t){const r=this.shape(e);return!r&&t?.extend(null,"custom prop",e?.constructor.name,"failed to check custom prop"),r}}const Hc=n=>new rU(n);qa(rU);class jO extends Ru{constructor(e){super(),this.shape=e}check(e,t){const r=this.shape.some(i=>i===e);return!r&&t?.extend(null,this.shape.join(" | "),e.toString()),r}}const zO=(...n)=>new jO(n),BJ=qa(jO),KAe=RegExp.escape||(n=>n.replace(/[().|&,$^[\]]/g,e=>"\\"+e)),FJ=n=>{if(px.check(n))return[KAe(n)];if(BJ.check(n))return n.shape.map(e=>e+"");if(KJ.check(n))return["[+-]?\\d+.?\\d*"];if(XJ.check(n))return[".*"];if(rI.check(n))return n.shape.map(FJ).flat(1);vd()};class XAe extends Ru{constructor(e){super(),this.shape=e,this._r=new RegExp("^"+e.map(FJ).map(t=>`(${t.join("|")})`).join("")+"$")}check(e,t){const r=this._r.exec(e)!=null;return!r&&t?.extend(null,this._r.toString(),e.toString(),"String doesn't match string template."),r}}qa(XAe);const ZAe=Symbol("optional");class jJ extends Ru{constructor(e){super(),this.shape=e}check(e,t){const r=e===void 0||this.shape.check(e);return!r&&t?.extend(null,"undefined (optional)","()"),r}get[ZAe](){return!0}}const JAe=qa(jJ);class QAe extends Ru{check(e,t){return t?.extend(null,"never",typeof e),!1}}qa(QAe);class $O extends Ru{constructor(e,t=!1){super(),this.shape=e,this._isPartial=t}static _dilutes=!0;get partial(){return new $O(this.shape,!0)}check(e,t){return e==null?(t?.extend(null,"object","null"),!1):fC(this.shape,(r,i)=>{const s=this._isPartial&&!Q6(e,i)||r.check(e[i],t);return!s&&t?.extend(i.toString(),r.toString(),typeof e[i],"Object property does not match"),s})}}const eCe=n=>new $O(n),tCe=qa($O),nCe=Hc(n=>n!=null&&(n.constructor===Object||n.constructor==null));class zJ extends Ru{constructor(e,t){super(),this.shape={keys:e,values:t}}check(e,t){return e!=null&&fC(e,(r,i)=>{const s=this.shape.keys.check(i,t);return!s&&t?.extend(i+"","Record",typeof e,s?"Key doesn't match schema":"Value doesn't match value"),s&&this.shape.values.check(r,t)})}}const $J=(n,e)=>new zJ(n,e),rCe=qa(zJ);class VJ extends Ru{constructor(e){super(),this.shape=e}check(e,t){return e!=null&&fC(this.shape,(r,i)=>{const s=r.check(e[i],t);return!s&&t?.extend(i.toString(),"Tuple",typeof r),s})}}const iCe=(...n)=>new VJ(n);qa(VJ);class HJ extends Ru{constructor(e){super(),this.shape=e.length===1?e[0]:new iU(e)}check(e,t){const r=fx(e)&&q6(e,i=>this.shape.check(i));return!r&&t?.extend(null,"Array",""),r}}const GJ=(...n)=>new HJ(n),sCe=qa(HJ),oCe=Hc(n=>fx(n));class WJ extends Ru{constructor(e,t){super(),this.shape=e,this._c=t}check(e,t){const r=e instanceof this.shape&&(this._c==null||this._c(e));return!r&&t?.extend(null,this.shape.name,e?.constructor.name),r}}const aCe=(n,e=null)=>new WJ(n,e);qa(WJ);const cCe=aCe(Ru);class lCe extends Ru{constructor(e){super(),this.len=e.length-1,this.args=iCe(...e.slice(-1)),this.res=e[this.len]}check(e,t){const r=e.constructor===Function&&e.length<=this.len;return!r&&t?.extend(null,"function",typeof e),r}}const uCe=qa(lCe),hCe=Hc(n=>typeof n=="function");class fCe extends Ru{constructor(e){super(),this.shape=e}check(e,t){const r=q6(this.shape,i=>i.check(e,t));return!r&&t?.extend(null,"Intersectinon",typeof e),r}}qa(fCe,n=>n.shape.length>0);class iU extends Ru{static _dilutes=!0;constructor(e){super(),this.shape=e}check(e,t){const r=Y6(this.shape,i=>i.check(e,t));return t?.extend(null,"Union",typeof e),r}}const Yx=(...n)=>n.findIndex(e=>rI.check(e))>=0?Yx(...n.map(e=>xA(e)).map(e=>rI.check(e)?e.shape:[e]).flat(1)):n.length===1?n[0]:new iU(n),rI=qa(iU),qJ=()=>!0,iI=Hc(qJ),dCe=qa(rU,n=>n.shape===qJ),sU=Hc(n=>typeof n=="bigint"),pCe=Hc(n=>n===sU),YJ=Hc(n=>typeof n=="symbol");Hc(n=>n===YJ);const HE=Hc(n=>typeof n=="number"),KJ=Hc(n=>n===HE),px=Hc(n=>typeof n=="string"),XJ=Hc(n=>n===px),VO=Hc(n=>typeof n=="boolean"),mCe=Hc(n=>n===VO),ZJ=zO(void 0);qa(jO,n=>n.shape.length===1&&n.shape[0]===void 0);zO(void 0);const HO=zO(null),gCe=qa(jO,n=>n.shape.length===1&&n.shape[0]===null);qa(Uint8Array);qa(nU,n=>n.shape===Uint8Array);const _Ce=Yx(HE,px,HO,ZJ,sU,VO,YJ);(()=>{const n=GJ(iI),e=$J(px,iI),t=Yx(HE,px,HO,VO,n,e);return n.shape=t,e.shape.values=t,t})();const xA=n=>{if(cCe.check(n))return n;if(nCe.check(n)){const e={};for(const t in n)e[t]=xA(n[t]);return eCe(e)}else{if(oCe.check(n))return Yx(...n.map(xA));if(_Ce.check(n))return zO(n);if(hCe.check(n))return qa(n)}vd()},Gz=FAe?()=>{}:(n,e)=>{const t=new YAe;if(!e.check(n,t))throw tg(`Expected value to be of type ${e.constructor.name}.
${t.toString()}`)};class vCe{constructor(e){this.patterns=[],this.$state=e}if(e,t){return this.patterns.push({if:xA(e),h:t}),this}else(e){return this.if(iI,e)}done(){return(e,t)=>{for(let r=0;r<this.patterns.length;r++){const i=this.patterns[r];if(i.if.check(e))return i.h(e,t)}throw tg("Unhandled pattern")}}}const yCe=n=>new vCe(n),JJ=yCe(iI).if(KJ,(n,e)=>f2(e,Dz,eI)).if(XJ,(n,e)=>WAe(e)).if(mCe,(n,e)=>Hz(e)).if(pCe,(n,e)=>BigInt(f2(e,Dz,eI))).if(rI,(n,e)=>ZS(e,d2(e,n.shape))).if(tCe,(n,e)=>{const t={};for(const r in n.shape){let i=n.shape[r];if(JAe.check(i)){if(Hz(e))continue;i=i.shape}t[r]=JJ(i,e)}return t}).if(sCe,(n,e)=>{const t=[],r=UJ(e,0,42);for(let i=0;i<r;i++)t.push(ZS(e,n.shape));return t}).if(BJ,(n,e)=>d2(e,n.shape)).if(gCe,(n,e)=>null).if(uCe,(n,e)=>{const t=ZS(e,n.res);return()=>t}).if(dCe,(n,e)=>ZS(e,d2(e,[HE,px,HO,ZJ,sU,VO,GJ(HE),$J(Yx("a","b","c"),HE)]))).if(rCe,(n,e)=>{const t={},r=f2(e,0,3);for(let i=0;i<r;i++){const s=ZS(e,n.shape.keys),o=ZS(e,n.shape.values);t[s]=o}return t}).done(),ZS=(n,e)=>JJ(xA(e),n),GO=typeof document<"u"?document:{};Hc(n=>n.nodeType===TCe);typeof DOMParser<"u"&&new DOMParser;Hc(n=>n.nodeType===SCe);Hc(n=>n.nodeType===ECe);const bCe=n=>$we(n,(e,t)=>`${t}:${e};`).join(""),SCe=GO.ELEMENT_NODE,ECe=GO.TEXT_NODE,xCe=GO.DOCUMENT_NODE,TCe=GO.DOCUMENT_FRAGMENT_NODE;Hc(n=>n.nodeType===xCe);const l_=Symbol,QJ=l_(),eQ=l_(),wCe=l_(),ACe=l_(),CCe=l_(),tQ=l_(),RCe=l_(),oU=l_(),kCe=l_(),MCe=n=>{n.length===1&&n[0]?.constructor===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const i=n[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const i=n[r];i instanceof Symbol||t.push(i)}return t},ICe={[QJ]:A0("font-weight","bold"),[eQ]:A0("font-weight","normal"),[wCe]:A0("color","blue"),[CCe]:A0("color","green"),[ACe]:A0("color","grey"),[tQ]:A0("color","red"),[RCe]:A0("color","purple"),[oU]:A0("color","orange"),[kCe]:A0("color","black")},OCe=n=>{n.length===1&&n[0]?.constructor===Function&&(n=n[0]());const e=[],t=[],r=gp();let i=[],s=0;for(;s<n.length;s++){const o=n[s],a=ICe[o];if(a!==void 0)r.set(a.left,a.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const c=bCe(r);s>0||c.length>0?(e.push("%c"+o),t.push(c)):e.push(o)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){const o=n[s];o instanceof Symbol||i.push(o)}return i},nQ=zAe?OCe:MCe,NCe=(...n)=>{console.log(...nQ(n)),iQ.forEach(e=>e.print(n))},rQ=(...n)=>{console.warn(...nQ(n)),n.unshift(oU),iQ.forEach(e=>e.print(n))},iQ=hx(),sQ=n=>({[Symbol.iterator](){return this},next:n}),PCe=(n,e)=>sQ(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),p2=(n,e)=>sQ(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class aU{constructor(e,t){this.clock=e,this.len=t}}class Kx{constructor(){this.clients=new Map}}const mx=(n,e,t)=>e.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let c=0,l=r[c];c<r.length&&l.clock<a;l=r[++c])pQ(n,s,l.clock,l.len,t)}}),DCe=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=eg((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},dC=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&DCe(t,e.clock)!==null},cU=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=w1(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},h4=n=>{const e=new Kx;for(let t=0;t<n.length;t++)n[t].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let o=t+1;o<n.length;o++)Hwe(s,n[o].clients.get(i)||[]);e.clients.set(i,s)}});return cU(e),e},TA=(n,e,t,r)=>{ny(n.clients,e,()=>[]).push(new aU(t,r))},LCe=()=>new Kx,UCe=n=>{const e=LCe();return n.clients.forEach((t,r)=>{const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(o.deleted){const a=o.id.clock;let c=o.length;if(s+1<t.length)for(let l=t[s+1];s+1<t.length&&l.deleted;l=t[++s+1])c+=l.length;i.push(new aU(a,c))}}i.length>0&&e.clients.set(r,i)}),e},Xx=(n,e)=>{Ji(n.restEncoder,e.clients.size),t1(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),Ji(n.restEncoder,t);const i=r.length;Ji(n.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},lU=n=>{const e=new Kx,t=Ci(n.restDecoder);for(let r=0;r<t;r++){n.resetDsCurVal();const i=Ci(n.restDecoder),s=Ci(n.restDecoder);if(s>0){const o=ny(e.clients,i,()=>[]);for(let a=0;a<s;a++)o.push(new aU(n.readDsClock(),n.readDsLen()))}}return e},Wz=(n,e,t)=>{const r=new Kx,i=Ci(n.restDecoder);for(let s=0;s<i;s++){n.resetDsCurVal();const o=Ci(n.restDecoder),a=Ci(n.restDecoder),c=t.clients.get(o)||[],l=fc(t,o);for(let u=0;u<a;u++){const h=n.readDsClock(),f=h+n.readDsLen();if(h<l){l<f&&TA(r,o,l,f-l);let d=ng(c,h),p=c[d];for(!p.deleted&&p.id.clock<h&&(c.splice(d+1,0,fI(e,p,h-p.id.clock)),d++);d<c.length&&(p=c[d++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&c.splice(d,0,fI(e,p,f-p.id.clock)),p.delete(e))}else TA(r,o,h,f-h)}}if(r.clients.size>0){const s=new n1;return Ji(s.restEncoder,0),Xx(s,r),s.toUint8Array()}return null},oQ=IJ;class A1 extends AJ{constructor({guid:e=TAe(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=oQ(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new fQ,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=$z(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>$z(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Xs(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(t1(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Xs(this,e,t)}get(e,t=$c){const r=ny(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==$c&&i!==t)if(i===$c){const s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,WE)}getText(e=""){return this.get(e,rg)}getMap(e=""){return this.get(e,_x)}getXmlElement(e=""){return this.get(e,vx)}getXmlFragment(e=""){return this.get(e,r1)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,t1(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new A1({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Xs(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class aQ{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ci(this.restDecoder)}readDsLen(){return Ci(this.restDecoder)}}class cQ extends aQ{readLeftID(){return ki(Ci(this.restDecoder),Ci(this.restDecoder))}readRightID(){return ki(Ci(this.restDecoder),Ci(this.restDecoder))}readClient(){return Ci(this.restDecoder)}readInfo(){return dx(this.restDecoder)}readString(){return VE(this.restDecoder)}readParentInfo(){return Ci(this.restDecoder)===1}readTypeRef(){return Ci(this.restDecoder)}readLen(){return Ci(this.restDecoder)}readAny(){return bA(this.restDecoder)}readBuf(){return VAe(cf(this.restDecoder))}readJSON(){return JSON.parse(VE(this.restDecoder))}readKey(){return VE(this.restDecoder)}}class BCe{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ci(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ci(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class gx extends BCe{constructor(e){super(e),this.keys=[],Ci(e),this.keyClockDecoder=new h2(cf(e)),this.clientDecoder=new Gk(cf(e)),this.leftClockDecoder=new h2(cf(e)),this.rightClockDecoder=new h2(cf(e)),this.infoDecoder=new zz(cf(e),dx),this.stringDecoder=new SAe(cf(e)),this.parentInfoDecoder=new zz(cf(e),dx),this.typeRefDecoder=new Gk(cf(e)),this.lenDecoder=new Gk(cf(e))}readLeftID(){return new GE(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new GE(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return bA(this.restDecoder)}readBuf(){return cf(this.restDecoder)}readJSON(){return bA(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class FCe{constructor(){this.restEncoder=UO()}toUint8Array(){return Vm(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ji(this.restEncoder,e)}writeDsLen(e){Ji(this.restEncoder,e)}}class pC extends FCe{writeLeftID(e){Ji(this.restEncoder,e.client),Ji(this.restEncoder,e.clock)}writeRightID(e){Ji(this.restEncoder,e.client),Ji(this.restEncoder,e.clock)}writeClient(e){Ji(this.restEncoder,e)}writeInfo(e){a4(this.restEncoder,e)}writeString(e){$E(this.restEncoder,e)}writeParentInfo(e){Ji(this.restEncoder,e?1:0)}writeTypeRef(e){Ji(this.restEncoder,e)}writeLen(e){Ji(this.restEncoder,e)}writeAny(e){yA(this.restEncoder,e)}writeBuf(e){af(this.restEncoder,e)}writeJSON(e){$E(this.restEncoder,JSON.stringify(e))}writeKey(e){$E(this.restEncoder,e)}}class jCe{constructor(){this.restEncoder=UO(),this.dsCurrVal=0}toUint8Array(){return Vm(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Ji(this.restEncoder,t)}writeDsLen(e){e===0&&vd(),Ji(this.restEncoder,e-1),this.dsCurrVal+=e}}class n1 extends jCe{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new u2,this.clientEncoder=new Hk,this.leftClockEncoder=new u2,this.rightClockEncoder=new u2,this.infoEncoder=new Bz(a4),this.stringEncoder=new fAe,this.parentInfoEncoder=new Bz(a4),this.typeRefEncoder=new Hk,this.lenEncoder=new Hk}toUint8Array(){const e=UO();return Ji(e,0),af(e,this.keyClockEncoder.toUint8Array()),af(e,this.clientEncoder.toUint8Array()),af(e,this.leftClockEncoder.toUint8Array()),af(e,this.rightClockEncoder.toUint8Array()),af(e,Vm(this.infoEncoder)),af(e,this.stringEncoder.toUint8Array()),af(e,Vm(this.parentInfoEncoder)),af(e,this.typeRefEncoder.toUint8Array()),af(e,this.lenEncoder.toUint8Array()),BO(e,Vm(this.restEncoder)),Vm(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){yA(this.restEncoder,e)}writeBuf(e){af(this.restEncoder,e)}writeJSON(e){yA(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const zCe=(n,e,t,r)=>{r=w1(r,e[0].id.clock);const i=ng(e,r);Ji(n.restEncoder,e.length-i),n.writeClient(t),Ji(n.restEncoder,r);const s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},uU=(n,e,t)=>{const r=new Map;t.forEach((i,s)=>{fc(e,s)>i&&r.set(s,i)}),hU(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),Ji(n.restEncoder,r.size),t1(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{zCe(n,e.clients.get(i),i,s)})},$Ce=(n,e)=>{const t=gp(),r=Ci(n.restDecoder);for(let i=0;i<r;i++){const s=Ci(n.restDecoder),o=new Array(s),a=n.readClient();let c=Ci(n.restDecoder);t.set(a,{i:0,refs:o});for(let l=0;l<s;l++){const u=n.readInfo();switch(LO&u){case 0:{const h=n.readLen();o[l]=new nd(ki(a,c),h),c+=h;break}case 10:{const h=Ci(n.restDecoder);o[l]=new rd(ki(a,c),h),c+=h;break}default:{const h=(u&(W0|vf))===0,f=new Eo(ki(a,c),null,(u&vf)===vf?n.readLeftID():null,null,(u&W0)===W0?n.readRightID():null,h?n.readParentInfo()?e.get(n.readString()):n.readLeftID():null,h&&(u&_A)===_A?n.readString():null,DQ(n,u));o[l]=f,c+=f.length}}}}return t},VCe=(n,e,t)=>{const r=[];let i=t1(t.keys()).sort((d,p)=>d-p);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let d=t.get(i[i.length-1]);for(;d.refs.length===d.i;)if(i.pop(),i.length>0)d=t.get(i[i.length-1]);else return null;return d};let o=s();if(o===null)return null;const a=new fQ,c=new Map,l=(d,p)=>{const m=c.get(d);(m==null||m>p)&&c.set(d,p)};let u=o.refs[o.i++];const h=new Map,f=()=>{for(const d of r){const p=d.id.client,m=t.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),t.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[d]),i=i.filter(_=>_!==p)}r.length=0};for(;;){if(u.constructor!==rd){const p=ny(h,u.id.client,()=>fc(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),f();else{const m=u.getMissing(n,e);if(m!==null){r.push(u);const _=t.get(m)||{refs:[],i:0};if(_.refs.length===_.i)l(m,fc(e,m)),f();else{u=_.refs[_.i++];continue}}else(p===0||p<u.length)&&(u.integrate(n,p),h.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=s(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const d=new n1;return uU(d,a,new Map),Ji(d.restEncoder,0),{missing:c,update:d.toUint8Array()}}return null},HCe=(n,e)=>uU(n,e.doc.store,e.beforeState),GCe=(n,e,t,r=new gx(n))=>Xs(e,i=>{i.local=!1;let s=!1;const o=i.doc,a=o.store,c=$Ce(r,o),l=VCe(i,a,c),u=a.pendingStructs;if(u){for(const[f,d]of u.missing)if(d<fc(a,f)){s=!0;break}if(l){for(const[f,d]of l.missing){const p=u.missing.get(f);(p==null||p>d)&&u.missing.set(f,d)}u.update=oI([u.update,l.update])}}else a.pendingStructs=l;const h=Wz(r,i,a);if(a.pendingDs){const f=new gx(qx(a.pendingDs));Ci(f.restDecoder);const d=Wz(f,i,a);h&&d?a.pendingDs=oI([h,d]):a.pendingDs=h||d}else a.pendingDs=h;if(s){const f=a.pendingStructs.update;a.pendingStructs=null,lQ(i.doc,f)}},t,!1),lQ=(n,e,t,r=gx)=>{const i=qx(e);GCe(i,n,t,new r(i))},qz=(n,e,t)=>lQ(n,e,t,cQ),WCe=(n,e,t=new Map)=>{uU(n,e.store,t),Xx(n,UCe(e.store))},qCe=(n,e=new Uint8Array([0]),t=new n1)=>{const r=uQ(e);WCe(t,n,r);const i=[t.toUint8Array()];if(n.store.pendingDs&&i.push(n.store.pendingDs),n.store.pendingStructs&&i.push(cRe(n.store.pendingStructs.update,e)),i.length>1){if(t.constructor===pC)return oRe(i.map((s,o)=>o===0?s:uRe(s)));if(t.constructor===n1)return oI(i)}return i[0]},YCe=(n,e)=>qCe(n,e,new pC),KCe=n=>{const e=new Map,t=Ci(n.restDecoder);for(let r=0;r<t;r++){const i=Ci(n.restDecoder),s=Ci(n.restDecoder);e.set(i,s)}return e},uQ=n=>KCe(new aQ(qx(n)));class XCe{constructor(){this.l=[]}}const Yz=()=>new XCe,Kz=(n,e)=>n.l.push(e),Xz=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},hQ=(n,e,t)=>eU(n.l,[e,t]);class GE{constructor(e,t){this.client=e,this.clock=t}}const jR=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,ki=(n,e)=>new GE(n,e),ZCe=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw vd()},sI=(n,e)=>{for(;e!==null;){if(e.parent===n)return!0;e=e.parent._item}return!1},mE=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!dC(e.ds,n.id),f4=(n,e)=>{const t=ny(n.meta,f4,hx),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<fc(r,s)&&_h(n,ki(s,i))}),mx(n,e.ds,i=>{}),t.add(e))};class fQ{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const hU=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},fc=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},dQ=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw vd()}t.push(e)},ng=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=eg(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=eg((t+r)/2)}throw vd()},JCe=(n,e)=>{const t=n.clients.get(e.client);return t[ng(t,e.clock)]},qk=JCe,d4=(n,e,t)=>{const r=ng(e,t),i=e[r];return i.id.clock<t&&i instanceof Eo?(e.splice(r+1,0,fI(n,i,t-i.id.clock)),r+1):r},_h=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[d4(n,t,e.clock)]},Zz=(n,e,t)=>{const r=e.clients.get(t.client),i=ng(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==nd&&r.splice(i+1,0,fI(n,s,t.clock-s.id.clock+1)),s},QCe=(n,e,t)=>{const r=n.clients.get(e.id.client);r[ng(r,e.id.clock)]=t},pQ=(n,e,t,r,i)=>{if(r===0)return;const s=t+r;let o=d4(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&d4(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class eRe{constructor(e,t,r){this.doc=e,this.deleteSet=new Kx,this.beforeState=hU(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Jz=(n,e)=>e.deleteSet.clients.size===0&&!Vwe(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(cU(e.deleteSet),HCe(n,e),Xx(n,e.deleteSet),!0),Qz=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&ny(n.changed,e,hx).add(t)},Yk=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof Eo&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const s=e-i;return s&&n.splice(e+1-s,s),s},tRe=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],c=a.clock+a.len;for(let l=ng(s,a.clock),u=s[l];l<s.length&&u.id.clock<c;u=s[++l]){const h=s[l];if(a.clock+a.len<=h.id.clock)break;h instanceof Eo&&h.deleted&&!h.keep&&t(h)&&h.gc(e,!1)}}}},nRe=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){const o=t[s],a=CJ(i.length-1,1+ng(i,o.clock+o.len-1));for(let c=a,l=i[c];c>0&&l.id.clock>=o.clock;l=i[c])c-=1+Yk(i,c)}})},mQ=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{cU(s),t.afterState=hU(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(t,c)})),a.push(()=>{t.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),a.push(()=>{hQ(l._dEH,c,t)}))}),a.push(()=>r.emit("afterTransaction",[t,r])),a.push(()=>{t._needFormattingCleanup&&TRe(t)})}),eU(a,[])}finally{r.gc&&tRe(s,i,r.gcFilter),nRe(s,i),t.afterState.forEach((u,h)=>{const f=t.beforeState.get(h)||0;if(f!==u){const d=i.clients.get(h),p=w1(ng(d,f),1);for(let m=d.length-1;m>=p;)m-=1+Yk(d,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:f}=o[u].id,d=i.clients.get(h),p=ng(d,f);p+1<d.length&&Yk(d,p+1)>1||p>0&&Yk(d,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(NCe(oU,QJ,"[yjs] ",eQ,tQ,"Changed the client-id because another client seems to be using it."),r.clientID=oQ()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new pC;Jz(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new n1;Jz(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=t;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,t]),l.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):mQ(n,e+1)}}},Xs=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new eRe(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){const a=n._transaction===i[0];n._transaction=null,a&&mQ(i,0)}}return o};class rRe{constructor(e,t){this.insertions=t,this.deletions=e,this.meta=new Map}}const e$=(n,e,t)=>{mx(n,t.deletions,r=>{r instanceof Eo&&e.scope.some(i=>i===n.doc||sI(i,r))&&yU(r,!1)})},t$=(n,e,t)=>{let r=null;const i=n.doc,s=n.scope;Xs(i,a=>{for(;e.length>0&&n.currStackItem===null;){const c=i.store,l=e.pop(),u=new Set,h=[];let f=!1;mx(a,l.insertions,d=>{if(d instanceof Eo){if(d.redone!==null){let{item:p,diff:m}=ZRe(c,d.id);m>0&&(p=_h(a,ki(p.id.client,p.id.clock+m))),d=p}!d.deleted&&s.some(p=>p===a.doc||sI(p,d))&&h.push(d)}}),mx(a,l.deletions,d=>{d instanceof Eo&&s.some(p=>p===a.doc||sI(p,d))&&!dC(l.insertions,d.id)&&u.add(d)}),u.forEach(d=>{f=PQ(a,d,u,l.insertions,n.ignoreRemoteMapChanges,n)!==null||f});for(let d=h.length-1;d>=0;d--){const p=h[d];n.deleteFilter(p)&&(p.delete(a),f=!0)}n.currStackItem=f?l:null}a.changed.forEach((c,l)=>{c.has(null)&&l._searchMarker&&(l._searchMarker.length=0)}),r=a},n);const o=n.currStackItem;if(o!=null){const a=r.changedParentTypes;n.emit("stack-item-popped",[{stackItem:o,type:t,changedParentTypes:a,origin:n},n]),n.currStackItem=null}return o};class iRe extends AJ{constructor(e,{captureTimeout:t=500,captureTransaction:r=c=>!0,deleteFilter:i=()=>!0,trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:o=!1,doc:a=fx(e)?e[0].doc:e instanceof A1?e:e.doc}={}){super(),this.scope=[],this.doc=a,this.addToScope(e),this.deleteFilter=i,s.add(this),this.trackedOrigins=s,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=o,this.captureTimeout=t,this.afterTransactionHandler=c=>{if(!this.captureTransaction(c)||!this.scope.some(_=>c.changedParentTypes.has(_)||_===this.doc)||!this.trackedOrigins.has(c.origin)&&(!c.origin||!this.trackedOrigins.has(c.origin.constructor)))return;const l=this.undoing,u=this.redoing,h=l?this.redoStack:this.undoStack;l?this.stopCapturing():u||this.clear(!1,!0);const f=new Kx;c.afterState.forEach((_,v)=>{const S=c.beforeState.get(v)||0,b=_-S;b>0&&TA(f,v,S,b)});const d=wAe();let p=!1;if(this.lastChange>0&&d-this.lastChange<this.captureTimeout&&h.length>0&&!l&&!u){const _=h[h.length-1];_.deletions=h4([_.deletions,c.deleteSet]),_.insertions=h4([_.insertions,f])}else h.push(new rRe(c.deleteSet,f)),p=!0;!l&&!u&&(this.lastChange=d),mx(c,c.deleteSet,_=>{_ instanceof Eo&&this.scope.some(v=>v===c.doc||sI(v,_))&&yU(_,!0)});const m=[{stackItem:h[h.length-1],origin:c.origin,type:l?"redo":"undo",changedParentTypes:c.changedParentTypes},this];p?this.emit("stack-item-added",m):this.emit("stack-item-updated",m)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(e){const t=new Set(this.scope);e=fx(e)?e:[e],e.forEach(r=>{t.has(r)||(t.add(r),(r instanceof $c?r.doc!==this.doc:r!==this.doc)&&rQ("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}clear(e=!0,t=!0){(e&&this.canUndo()||t&&this.canRedo())&&this.doc.transact(r=>{e&&(this.undoStack.forEach(i=>e$(r,this,i)),this.undoStack=[]),t&&(this.redoStack.forEach(i=>e$(r,this,i)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:t}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let e;try{e=t$(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){this.redoing=!0;let e;try{e=t$(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*sRe(n){const e=Ci(n.restDecoder);for(let t=0;t<e;t++){const r=Ci(n.restDecoder),i=n.readClient();let s=Ci(n.restDecoder);for(let o=0;o<r;o++){const a=n.readInfo();if(a===10){const c=Ci(n.restDecoder);yield new rd(ki(i,s),c),s+=c}else if((LO&a)!==0){const c=(a&(W0|vf))===0,l=new Eo(ki(i,s),null,(a&vf)===vf?n.readLeftID():null,null,(a&W0)===W0?n.readRightID():null,c?n.readParentInfo()?n.readString():n.readLeftID():null,c&&(a&_A)===_A?n.readString():null,DQ(n,a));yield l,s+=l.length}else{const c=n.readLen();yield new nd(ki(i,s),c),s+=c}}}}class fU{constructor(e,t){this.gen=sRe(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===rd);return this.curr}}class dU{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const oRe=n=>oI(n,cQ,pC),aRe=(n,e)=>{if(n.constructor===nd){const{client:t,clock:r}=n.id;return new nd(ki(t,r+e),n.length-e)}else if(n.constructor===rd){const{client:t,clock:r}=n.id;return new rd(ki(t,r+e),n.length-e)}else{const t=n,{client:r,clock:i}=t.id;return new Eo(ki(r,i+e),null,ki(r,i+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},oI=(n,e=gx,t=n1)=>{if(n.length===1)return n[0];const r=n.map(u=>new e(qx(u)));let i=r.map(u=>new fU(u,!0)),s=null;const o=new t,a=new dU(o);for(;i=i.filter(f=>f.curr!==null),i.sort((f,d)=>{if(f.curr.id.client===d.curr.id.client){const p=f.curr.id.clock-d.curr.id.clock;return p===0?f.curr.constructor===d.curr.constructor?0:f.curr.constructor===rd?1:-1:p}else return d.curr.id.client-f.curr.id.client}),i.length!==0;){const u=i[0],h=u.curr.id.client;if(s!==null){let f=u.curr,d=!1;for(;f!==null&&f.id.clock+f.length<=s.struct.id.clock+s.struct.length&&f.id.client>=s.struct.id.client;)f=u.next(),d=!0;if(f===null||f.id.client!==h||d&&f.id.clock>s.struct.id.clock+s.struct.length)continue;if(h!==s.struct.id.client)Cv(a,s.struct,s.offset),s={struct:f,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<f.id.clock)if(s.struct.constructor===rd)s.struct.length=f.id.clock+f.length-s.struct.id.clock;else{Cv(a,s.struct,s.offset);const p=f.id.clock-s.struct.id.clock-s.struct.length;s={struct:new rd(ki(h,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-f.id.clock;p>0&&(s.struct.constructor===rd?s.struct.length-=p:f=aRe(f,p)),s.struct.mergeWith(f)||(Cv(a,s.struct,s.offset),s={struct:f,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let f=u.curr;f!==null&&f.id.client===h&&f.id.clock===s.struct.id.clock+s.struct.length&&f.constructor!==rd;f=u.next())Cv(a,s.struct,s.offset),s={struct:f,offset:0}}s!==null&&(Cv(a,s.struct,s.offset),s=null),pU(a);const c=r.map(u=>lU(u)),l=h4(c);return Xx(o,l),o.toUint8Array()},cRe=(n,e,t=gx,r=n1)=>{const i=uQ(e),s=new r,o=new dU(s),a=new t(qx(n)),c=new fU(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,f=i.get(h)||0;if(c.curr.constructor===rd){c.next();continue}if(u.id.clock+u.length>f)for(Cv(o,u,w1(f-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Cv(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=f;)c.next()}pU(o);const l=lU(a);return Xx(s,l),s.toUint8Array()},gQ=n=>{n.written>0&&(n.clientStructs.push({written:n.written,restEncoder:Vm(n.encoder.restEncoder)}),n.encoder.restEncoder=UO(),n.written=0)},Cv=(n,e,t)=>{n.written>0&&n.currClient!==e.id.client&&gQ(n),n.written===0&&(n.currClient=e.id.client,n.encoder.writeClient(e.id.client),Ji(n.encoder.restEncoder,e.id.clock+t)),e.write(n.encoder,t),n.written++},pU=n=>{gQ(n);const e=n.encoder.restEncoder;Ji(e,n.clientStructs.length);for(let t=0;t<n.clientStructs.length;t++){const r=n.clientStructs[t];Ji(e,r.written),BO(e,r.restEncoder)}},lRe=(n,e,t,r)=>{const i=new t(qx(n)),s=new fU(i,!1),o=new r,a=new dU(o);for(let l=s.curr;l!==null;l=s.next())Cv(a,e(l),0);pU(a);const c=lU(i);return Xx(o,c),o.toUint8Array()},uRe=n=>lRe(n,LAe,gx,pC),n$="You must not compute changes after the event-handler fired.";class WO{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=hRe(this.currentTarget,this.target))}deletes(e){return dC(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw tg(n$);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,a;if(this.adds(s)){let c=s.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(s))if(c!==null&&this.deletes(c))o="delete",a=a2(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=a2(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=a2(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw tg(n$);const t=this.target,r=hx(),i=hx(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const c=()=>{a&&s.push(a)};for(let l=t._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,i.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const hRe=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},$l=()=>{rQ("Invalid access: Add Yjs type to a document before reading data.")},_Q=80;let mU=0;class fRe{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=mU++}}const dRe=n=>{n.timestamp=mU++},vQ=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=mU++},pRe=(n,e,t)=>{if(n.length>=_Q){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return vQ(r,e,t),r}else{const r=new fRe(e,t);return n.push(r),r}},qO=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>Vk(e-s.index)<Vk(e-o.index)?s:o);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,dRe(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&Vk(t.index-i)<r.parent.length/_Q?(vQ(t,r,i),t):pRe(n._searchMarker,r,i)},wA=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=w1(e,i.index+t))}},YO=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;ny(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;hQ(r._eH,t,e)};class $c{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Yz(),this._dEH=Yz(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw _p()}clone(){throw _p()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Kz(this._eH,e)}observeDeep(e){Kz(this._dEH,e)}unobserve(e){Xz(this._eH,e)}unobserveDeep(e){Xz(this._dEH,e)}toJSON(){}}const yQ=(n,e,t)=>{n.doc??$l(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},bQ=n=>{n.doc??$l();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},AA=(n,e)=>{let t=0,r=n._start;for(n.doc??$l();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},SQ=(n,e)=>{const t=[];return AA(n,(r,i)=>{t.push(e(r,i,n))}),t},mRe=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},xQ=(n,e)=>{n.doc??$l();const t=qO(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},aI=(n,e,t,r)=>{let i=t;const s=n.doc,o=s.clientID,a=s.store,c=t===null?e._start:t.right;let l=[];const u=()=>{l.length>0&&(i=new Eo(ki(o,fc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new i1(l)),i.integrate(n,0),l=[])};r.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:i=new Eo(ki(o,fc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new mC(new Uint8Array(h))),i.integrate(n,0);break;case A1:i=new Eo(ki(o,fc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new gC(h)),i.integrate(n,0);break;default:if(h instanceof $c)i=new Eo(ki(o,fc(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new u_(h)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},TQ=()=>tg("Length exceeded!"),wQ=(n,e,t,r)=>{if(t>e._length)throw TQ();if(t===0)return e._searchMarker&&wA(e._searchMarker,t,r.length),aI(n,e,null,r);const i=t,s=qO(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&_h(n,ki(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&wA(e._searchMarker,i,r.length),aI(n,e,o,r)},gRe=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return aI(n,e,i,t)},AQ=(n,e,t,r)=>{if(r===0)return;const i=t,s=r,o=qO(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&_h(n,ki(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&_h(n,ki(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw TQ();e._searchMarker&&wA(e._searchMarker,i,-s+r)},cI=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},gU=(n,e,t,r)=>{const i=e._map.get(t)||null,s=n.doc,o=s.clientID;let a;if(r==null)a=new i1([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new i1([r]);break;case Uint8Array:a=new mC(r);break;case A1:a=new gC(r);break;default:if(r instanceof $c)a=new u_(r);else throw new Error("Unexpected content type")}new Eo(ki(o,fc(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},_U=(n,e)=>{n.doc??$l();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},CQ=n=>{const e={};return n.doc??$l(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},RQ=(n,e)=>{n.doc??$l();const t=n._map.get(e);return t!==void 0&&!t.deleted},_Re=(n,e)=>{const t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&mE(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},zR=n=>(n.doc??$l(),PCe(n._map.entries(),e=>!e[1].deleted));class vRe extends WO{}class WE extends $c{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new WE;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new WE}clone(){const e=new WE;return e.insert(0,this.toArray().map(t=>t instanceof $c?t.clone():t)),e}get length(){return this.doc??$l(),this._length}_callObserver(e,t){super._callObserver(e,t),YO(this,e,new vRe(this,e))}insert(e,t){this.doc!==null?Xs(this.doc,r=>{wQ(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Xs(this.doc,t=>{gRe(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Xs(this.doc,r=>{AQ(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return xQ(this,e)}toArray(){return bQ(this)}slice(e=0,t=this.length){return yQ(this,e,t)}toJSON(){return this.map(e=>e instanceof $c?e.toJSON():e)}map(e){return SQ(this,e)}forEach(e){AA(this,e)}[Symbol.iterator](){return mRe(this)}_write(e){e.writeTypeRef(VRe)}}const yRe=n=>new WE;class bRe extends WO{constructor(e,t,r){super(e,t),this.keysChanged=r}}class _x extends $c{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new _x}clone(){const e=new _x;return this.forEach((t,r)=>{e.set(r,t instanceof $c?t.clone():t)}),e}_callObserver(e,t){YO(this,e,new bRe(this,e,t))}toJSON(){this.doc??$l();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof $c?i.toJSON():i}}),e}get size(){return[...zR(this)].length}keys(){return p2(zR(this),e=>e[0])}values(){return p2(zR(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return p2(zR(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??$l(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Xs(this.doc,t=>{cI(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Xs(this.doc,r=>{gU(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return _U(this,e)}has(e){return RQ(this,e)}clear(){this.doc!==null?Xs(this.doc,e=>{this.forEach(function(t,r,i){cI(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(HRe)}}const SRe=n=>new _x,Ov=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&PAe(n,e);class p4{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){this.right===null&&vd(),this.right.content.constructor===vc?this.right.deleted||Zx(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}const r$=(n,e,t)=>{for(;e.right!==null&&t>0;)e.right.content.constructor===vc?e.right.deleted||Zx(e.currentAttributes,e.right.content):e.right.deleted||(t<e.right.length&&_h(n,ki(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length),e.left=e.right,e.right=e.right.right;return e},$R=(n,e,t,r)=>{const i=new Map,s=r?qO(e,t):null;if(s){const o=new p4(s.p.left,s.p,s.index,i);return r$(n,o,t-s.index)}else{const o=new p4(null,e._start,0,i);return r$(n,o,t)}},kQ=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===vc&&Ov(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,s=i.clientID;r.forEach((o,a)=>{const c=t.left,l=t.right,u=new Eo(ki(s,fc(i.store,s)),c,c&&c.lastId,l,l&&l.id,e,null,new vc(a,o));u.integrate(n,0),t.right=u,t.forward()})},Zx=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},MQ=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===vc&&Ov(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},IQ=(n,e,t,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=t.currentAttributes.get(a)??null;if(!Ov(l,c)){o.set(a,l);const{left:u,right:h}=t;t.right=new Eo(ki(s,fc(i.store,s)),u,u&&u.lastId,h,h&&h.id,e,null,new vc(a,c)),t.right.integrate(n,0),t.forward()}}return o},m2=(n,e,t,r,i)=>{t.currentAttributes.forEach((f,d)=>{i[d]===void 0&&(i[d]=null)});const s=n.doc,o=s.clientID;MQ(t,i);const a=IQ(n,e,t,i),c=r.constructor===String?new ig(r):r instanceof $c?new u_(r):new C1(r);let{left:l,right:u,index:h}=t;e._searchMarker&&wA(e._searchMarker,t.index,c.getLength()),u=new Eo(ki(o,fc(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(n,0),t.right=u,t.index=h,t.forward(),kQ(n,e,t,a)},i$=(n,e,t,r,i)=>{const s=n.doc,o=s.clientID;MQ(t,i);const a=IQ(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===vc));){if(!t.right.deleted)switch(t.right.content.constructor){case vc:{const{key:c,value:l}=t.right.content,u=i[c];if(u!==void 0){if(Ov(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}t.right.delete(n)}else t.currentAttributes.set(c,l);break}default:r<t.right.length&&_h(n,ki(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;t.right=new Eo(ki(o,fc(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new ig(c)),t.right.integrate(n,0),t.forward()}kQ(n,e,t,a)},OQ=(n,e,t,r,i)=>{let s=e;const o=gp();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===vc){const l=s.content;o.set(l.key,l)}s=s.right}let a=0,c=!1;for(;e!==s;){if(t===e&&(c=!0),!e.deleted){const l=e.content;if(l.constructor===vc){const{key:u,value:h}=l,f=r.get(u)??null;(o.get(u)!==l||f===h)&&(e.delete(n),a++,!c&&(i.get(u)??null)===h&&f!==h&&(f===null?i.delete(u):i.set(u,f))),!c&&!e.deleted&&Zx(i,l)}}e=e.right}return a},ERe=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===vc){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},xRe=n=>{let e=0;return Xs(n.doc,t=>{let r=n._start,i=n._start,s=gp();const o=s4(s);for(;i;)i.deleted===!1&&(i.content.constructor===vc?Zx(o,i.content):(e+=OQ(t,r,i,s,o),s=s4(o),r=i)),i=i.right}),e},TRe=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const s=n.beforeState.get(r)||0;i!==s&&pQ(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===vc&&o.constructor!==nd&&e.add(o.parent)})}Xs(t,r=>{mx(n,n.deleteSet,i=>{if(i instanceof nd||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===vc?e.add(s):ERe(r,i)});for(const i of e)xRe(i)})},s$=(n,e,t)=>{const r=t,i=s4(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case u_:case C1:case ig:t<e.right.length&&_h(n,ki(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&OQ(n,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&wA(o._searchMarker,e.index,-r+t),e};class wRe extends WO{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];Xs(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const f=()=>{if(a!==null){let d=null;switch(a){case"delete":h>0&&(d={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(d={insert:l},i.size>0&&(d.attributes={},i.forEach((p,m)=>{p!==null&&(d.attributes[m]=p)}))),l="";break;case"retain":u>0&&(d={retain:u},NAe(c)||(d.attributes=MAe({},c))),u=0;break}d&&t.push(d),a=null}};for(;o!==null;){switch(o.content.constructor){case u_:case C1:this.adds(o)?this.deletes(o)||(f(),a="insert",l=o.content.getContent()[0],f()):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(f(),a="retain"),u+=1);break;case ig:this.adds(o)?this.deletes(o)||(a!=="insert"&&(f(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(f(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(f(),a="retain"),u+=o.length);break;case vc:{const{key:d,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(d)??null;Ov(m,p)?p!==null&&o.delete(r):(a==="retain"&&f(),Ov(p,s.get(d)??null)?delete c[d]:c[d]=p)}}else if(this.deletes(o)){s.set(d,p);const m=i.get(d)??null;Ov(m,p)||(a==="retain"&&f(),c[d]=m)}else if(!o.deleted){s.set(d,p);const m=c[d];m!==void 0&&(Ov(m,p)?m!==null&&o.delete(r):(a==="retain"&&f(),p===null?delete c[d]:c[d]=p))}o.deleted||(a==="insert"&&f(),Zx(i,o.content));break}}o=o.right}for(f();t.length>0;){const d=t[t.length-1];if(d.retain!==void 0&&d.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class rg extends $c{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??$l(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new rg}clone(){const e=new rg;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new wRe(this,e,t);YO(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??$l();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===ig&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Xs(this.doc,r=>{const i=new p4(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&m2(r,this,i,a,o.attributes||{})}else o.retain!==void 0?i$(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&s$(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??$l();const i=[],s=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let f=!1;s.forEach((p,m)=>{f=!0,h[m]=p});const d={insert:a};f&&(d.attributes=h),i.push(d),a=""}}const u=()=>{for(;c!==null;){if(mE(c,e)||t!==void 0&&mE(c,t))switch(c.content.constructor){case ig:{const h=s.get("ychange");e!==void 0&&!mE(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),s.set("ychange",r?r("removed",c.id):{type:"removed"})):t!==void 0&&!mE(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),s.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(l(),s.delete("ychange")),a+=c.content.str;break}case u_:case C1:{l();const h={insert:c.content.getContent()[0]};if(s.size>0){const f={};h.attributes=f,s.forEach((d,p)=>{f[p]=d})}i.push(h);break}case vc:mE(c,e)&&(l(),Zx(s,c.content));break}c=c.right}l()};return e||t?Xs(o,h=>{e&&f4(h,e),t&&f4(h,t),u()},"cleanup"):u(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?Xs(i,s=>{const o=$R(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,c)=>{r[c]=a})),m2(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const i=this.doc;i!==null?Xs(i,s=>{const o=$R(s,this,e,!r);m2(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?Xs(r,i=>{s$(i,$R(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?Xs(i,s=>{const o=$R(s,this,e,!1);o.right!==null&&i$(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Xs(this.doc,t=>{cI(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Xs(this.doc,r=>{gU(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return _U(this,e)}getAttributes(){return CQ(this)}_write(e){e.writeTypeRef(GRe)}}const ARe=n=>new rg;class g2{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??$l()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===vx||t.constructor===r1)&&t._start!==null)e=t._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class r1 extends $c{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new r1}clone(){const e=new r1;return e.insert(0,this.toArray().map(t=>t instanceof $c?t.clone():t)),e}get length(){return this.doc??$l(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new g2(this,e)}querySelector(e){e=e.toUpperCase();const r=new g2(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),t1(new g2(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){YO(this,e,new kRe(this,t,e))}toString(){return SQ(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),AA(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?Xs(this.doc,r=>{wQ(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Xs(this.doc,r=>{const i=e&&e instanceof $c?e._item:e;aI(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw tg("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?Xs(this.doc,r=>{AQ(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return bQ(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return xQ(this,e)}slice(e=0,t=this.length){return yQ(this,e,t)}forEach(e){AA(this,e)}_write(e){e.writeTypeRef(qRe)}}const CRe=n=>new r1;class vx extends r1{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new vx(this.nodeName)}clone(){const e=new vx(this.nodeName),t=this.getAttributes();return OAe(t,(r,i)=>{e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof $c?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const c=r[a];t.push(c+'="'+e[c]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Xs(this.doc,t=>{cI(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Xs(this.doc,r=>{gU(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return _U(this,e)}hasAttribute(e){return RQ(this,e)}getAttributes(e){return e?_Re(this,e):CQ(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return AA(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(WRe),e.writeKey(this.nodeName)}}const RRe=n=>new vx(n.readKey());class kRe extends WO{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class lI extends _x{constructor(e){super(),this.hookName=e}_copy(){return new lI(this.hookName)}clone(){const e=new lI(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){const i=t[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(YRe),e.writeKey(this.hookName)}}const MRe=n=>new lI(n.readKey());class uI extends rg{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new uI}clone(){const e=new uI;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const t=[];for(const i in e.attributes){const s=[];for(const o in e.attributes[i])s.push({key:o,value:e.attributes[i][o]});s.sort((o,a)=>o.key<a.key?-1:1),t.push({nodeName:i,attrs:s})}t.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<t.length;i++){const s=t[i];r+=`<${s.nodeName}`;for(let o=0;o<s.attrs.length;o++){const a=s.attrs[o];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let i=t.length-1;i>=0;i--)r+=`</${t[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(KRe)}}const IRe=n=>new uI;class vU{constructor(e,t){this.id=e,this.length=t}get deleted(){throw _p()}mergeWith(e){return!1}write(e,t,r){throw _p()}integrate(e,t){throw _p()}}const ORe=0;class nd extends vU{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),dQ(e.doc.store,this)}write(e,t){e.writeInfo(ORe),e.writeLen(this.length-t)}getMissing(e,t){return null}}class mC{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new mC(this.content)}splice(e){throw _p()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const NRe=n=>new mC(n.readBuf());class CA{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new CA(this.len)}splice(e){const t=new CA(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){TA(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const PRe=n=>new CA(n.readLen()),NQ=(n,e)=>new A1({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class gC{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new gC(NQ(this.doc.guid,this.opts))}splice(e){throw _p()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const DRe=n=>new gC(NQ(n.readString(),n.readAny()));class C1{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new C1(this.embed)}splice(e){throw _p()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const LRe=n=>new C1(n.readJSON());class vc{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new vc(this.key,this.value)}splice(e){throw _p()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const URe=n=>new vc(n.readKey(),n.readJSON());class hI{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new hI(this.arr)}splice(e){const t=new hI(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const BRe=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++){const i=n.readString();i==="undefined"?t.push(void 0):t.push(JSON.parse(i))}return new hI(t)},FRe=nI("node_env")==="development";class i1{constructor(e){this.arr=e,FRe&&PJ(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new i1(this.arr)}splice(e){const t=new i1(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const jRe=n=>{const e=n.readLen(),t=[];for(let r=0;r<e;r++)t.push(n.readAny());return new i1(t)};class ig{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ig(this.str)}splice(e){const t=new ig(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",t.str=""+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const zRe=n=>new ig(n.readString()),$Re=[yRe,SRe,ARe,RRe,CRe,MRe,IRe],VRe=0,HRe=1,GRe=2,WRe=3,qRe=4,YRe=5,KRe=6;class u_{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new u_(this.type._copy())}splice(e){throw _p()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const XRe=n=>new u_($Re[n.readTypeRef()](n)),ZRe=(n,e)=>{let t=e,r=0,i;do r>0&&(t=ki(t.client,t.clock+r)),i=qk(n,t),r=t.clock-i.id.clock,t=i.redone;while(t!==null&&i instanceof Eo);return{item:i,diff:r}},yU=(n,e)=>{for(;n!==null&&n.keep!==e;)n.keep=e,n=n.parent._item},fI=(n,e,t)=>{const{client:r,clock:i}=e.id,s=new Eo(ki(r,i+t),e,ki(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=ki(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s},o$=(n,e)=>Y6(n,t=>dC(t.deletions,e)),PQ=(n,e,t,r,i,s)=>{const o=n.doc,a=o.store,c=o.clientID,l=e.redone;if(l!==null)return _h(n,l);let u=e.parent._item,h=null,f;if(u!==null&&u.deleted===!0){if(u.redone===null&&(!t.has(u)||PQ(n,u,t,r,i,s)===null))return null;for(;u.redone!==null;)u=_h(n,u.redone)}const d=u===null?e.parent:u.content.type;if(e.parentSub===null){for(h=e.left,f=e;h!==null;){let v=h;for(;v!==null&&v.parent._item!==u;)v=v.redone===null?null:_h(n,v.redone);if(v!==null&&v.parent._item===u){h=v;break}h=h.left}for(;f!==null;){let v=f;for(;v!==null&&v.parent._item!==u;)v=v.redone===null?null:_h(n,v.redone);if(v!==null&&v.parent._item===u){f=v;break}f=f.right}}else if(f=null,e.right&&!i){for(h=e;h!==null&&h.right!==null&&(h.right.redone||dC(r,h.right.id)||o$(s.undoStack,h.right.id)||o$(s.redoStack,h.right.id));)for(h=h.right;h.redone;)h=_h(n,h.redone);if(h&&h.right!==null)return null}else h=d._map.get(e.parentSub)||null;const p=fc(a,c),m=ki(c,p),_=new Eo(m,h,h&&h.lastId,f,f&&f.id,d,e.parentSub,e.content.copy());return e.redone=m,yU(_,!0),_.integrate(n,0),_};class Eo extends vU{constructor(e,t,r,i,s,o,a,c){super(e,c.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?Pz:0}set marker(e){(this.info&l2)>0!==e&&(this.info^=l2)}get marker(){return(this.info&l2)>0}get keep(){return(this.info&Nz)>0}set keep(e){this.keep!==e&&(this.info^=Nz)}get countable(){return(this.info&Pz)>0}get deleted(){return(this.info&c2)>0}set deleted(e){this.deleted!==e&&(this.info^=c2)}markDeleted(){this.info|=c2}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=fc(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=fc(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===GE&&this.id.client!==this.parent.client&&this.parent.clock>=fc(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Zz(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=_h(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===nd||this.right&&this.right.constructor===nd)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Eo?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Eo&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===GE){const r=qk(t,this.parent);r.constructor===nd?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Zz(e,e.doc.store,ki(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),jR(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(jR(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(qk(e.doc.store,i.origin)))s.has(qk(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),dQ(e.doc.store,this),this.content.integrate(e,this),Qz(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new nd(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:ki(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&jR(e.origin,this.lastId)&&this.right===e&&jR(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),TA(e.deleteSet,this.id.client,this.id.clock,this.length),Qz(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw vd();this.content.gc(e),t?QCe(e,this,new nd(this.id,this.length)):this.content=new CA(this.length)}write(e,t){const r=t>0?ki(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&LO|(r===null?0:vf)|(i===null?0:W0)|(s===null?0:_A);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=ZCe(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===GE?(e.writeParentInfo(!1),e.writeLeftID(a)):vd();s!==null&&e.writeString(s)}this.content.write(e,t)}}const DQ=(n,e)=>JRe[e&LO](n),JRe=[()=>{vd()},PRe,BRe,NRe,zRe,LRe,URe,XRe,jRe,DRe,()=>{vd()}],QRe=10;class rd extends vU{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){vd()}write(e,t){e.writeInfo(QRe),Ji(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const LQ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof z0<"u"?z0:{},UQ="__ $YJS$ __";LQ[UQ]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");LQ[UQ]=!0;let a$=!1;const vh=new A1;function BQ(n){const e=vh.getMap(),[,t]=Ke.useState(0);if(Ke.useEffect(()=>{function r(){t(i=>1-i)}return e.observe(r),()=>{e.unobserve(r)}},[e,t]),e.has(n))return e.get(n)}function _C(n){const e=BQ(n);if(rn(e))return e}function FQ(n){const e=BQ(n);if(!(!he(e)||!(e instanceof rg)))return e}function jQ(n,e,t){const r=vh.getMap();if(!r.has(n))switch(e){case 0:case 1:r.set(n,t);break}}function eke(n,e){jQ(n,0,e)}function zQ(n,e){const t=new rg(e);jQ(n,1,t)}function gu(n,e){vh.getMap().set(n,e)}function tke(n,e){const t=vh.getMap(),r=new rg(e);t.set(n,r)}function $Q(n,e){const t=vh.getMap();function r(i){const s=t.get(n);for(let o=0;o<i.length;++o)(i[o].target===t||i[o].target===s)&&e(s)}return t.has(n)&&e(t.get(n)),t.observeDeep(r),()=>{t.observeDeep(r)}}function nke(n,e){return $Q(n,t=>{rn(t)&&e(t)})}function rke(n,e){return $Q(n,t=>{t instanceof rg&&e(t.toJSON())})}const pb=mg("modem",["second"],n=>{if(pb.session(n))switch(n.target){case"second":!a$&&n.data%2===0&&pb.emit(n.player,"modem:join");break;case"join":n.sender!==pb.id()&&pb.reply(n,"joinack",iq(YCe(vh)));break;case"joinack":n.sender!==pb.id()&&(a$=!0,qz(vh,MM(n.data),vh));break;case"sync":{n.sender!==pb.id()&&he(n.data)&&qz(vh,MM(n.data),vh);break}}});function VQ(n,e){e!==vh&&pb.emit("","modem:sync",iq(n))}vh.on("update",VQ);vh.on("destroy",()=>{vh.off("update",VQ)});const ike=`desc;$DKGRAYname and type of codepage
`,ske=Object.freeze(Object.defineProperty({__proto__:null,default:ike},Symbol.toStringTag,{value:"Module"})),oke=`desc;$DKGRAYShow admin scroll
`,ake=Object.freeze(Object.defineProperty({__proto__:null,default:oke},Symbol.toStringTag,{value:"Module"})),cke=`desc;$DKGRAYCreate array variable
`,lke=Object.freeze(Object.defineProperty({__proto__:null,default:cke},Symbol.toStringTag,{value:"Module"})),uke=`desc;$DKGRAYApply autofilter to fx 0-1
`,hke=Object.freeze(Object.defineProperty({__proto__:null,default:uke},Symbol.toStringTag,{value:"Module"})),fke=`desc;$DKGRAYAutofilter for fx 0
`,dke=Object.freeze(Object.defineProperty({__proto__:null,default:fke},Symbol.toStringTag,{value:"Module"})),pke=`desc;$DKGRAYAutofilter for fx 1
`,mke=Object.freeze(Object.defineProperty({__proto__:null,default:pke},Symbol.toStringTag,{value:"Module"})),gke=`desc;$DKGRAYAutofilter for fx 2
`,_ke=Object.freeze(Object.defineProperty({__proto__:null,default:gke},Symbol.toStringTag,{value:"Module"})),vke=`desc;$DKGRAYApply autowah to fx 0-1
`,yke=Object.freeze(Object.defineProperty({__proto__:null,default:vke},Symbol.toStringTag,{value:"Module"})),bke=`desc;$DKGRAYAutowah for fx 0
`,Ske=Object.freeze(Object.defineProperty({__proto__:null,default:bke},Symbol.toStringTag,{value:"Module"})),Eke=`desc;$DKGRAYAutowah for fx 1
`,xke=Object.freeze(Object.defineProperty({__proto__:null,default:Eke},Symbol.toStringTag,{value:"Module"})),Tke=`desc;$DKGRAYAutowah for fx 2
`,wke=Object.freeze(Object.defineProperty({__proto__:null,default:Tke},Symbol.toStringTag,{value:"Module"})),Ake=`desc;$DKGRAYBBS login/publish actions
`,Cke=Object.freeze(Object.defineProperty({__proto__:null,default:Ake},Symbol.toStringTag,{value:"Module"})),Rke="desc;$DKGRAYchanges object into specified element",kke=Object.freeze(Object.defineProperty({__proto__:null,default:Rke},Symbol.toStringTag,{value:"Module"})),Mke="desc;$DKGRAYlike #play but for sound effects",Ike=Object.freeze(Object.defineProperty({__proto__:null,default:Mke},Symbol.toStringTag,{value:"Module"})),Oke=`desc;$DKGRAYQuantized bgplay on 16n
`,Nke=Object.freeze(Object.defineProperty({__proto__:null,default:Oke},Symbol.toStringTag,{value:"Module"})),Pke=`desc;$DKGRAYQuantized bgplay on 1m
`,Dke=Object.freeze(Object.defineProperty({__proto__:null,default:Pke},Symbol.toStringTag,{value:"Module"})),Lke=`desc;$DKGRAYQuantized bgplay on 2n
`,Uke=Object.freeze(Object.defineProperty({__proto__:null,default:Lke},Symbol.toStringTag,{value:"Module"})),Bke=`desc;$DKGRAYQuantized bgplay on 32n
`,Fke=Object.freeze(Object.defineProperty({__proto__:null,default:Bke},Symbol.toStringTag,{value:"Module"})),jke=`desc;$DKGRAYQuantized bgplay on 4n
`,zke=Object.freeze(Object.defineProperty({__proto__:null,default:jke},Symbol.toStringTag,{value:"Module"})),$ke=`desc;$DKGRAYQuantized bgplay on 64n
`,Vke=Object.freeze(Object.defineProperty({__proto__:null,default:$ke},Symbol.toStringTag,{value:"Module"})),Hke=`desc;$DKGRAYQuantized bgplay on 8n
`,Gke=Object.freeze(Object.defineProperty({__proto__:null,default:Hke},Symbol.toStringTag,{value:"Module"})),Wke=`desc;$DKGRAYSet bgplay volume
`,qke=Object.freeze(Object.defineProperty({__proto__:null,default:Wke},Symbol.toStringTag,{value:"Module"})),Yke=`desc;$DKGRAYCopy code from named element
`,Kke=Object.freeze(Object.defineProperty({__proto__:null,default:Yke},Symbol.toStringTag,{value:"Module"})),Xke=`desc;$DKGRAY
`,Zke=Object.freeze(Object.defineProperty({__proto__:null,default:Xke},Symbol.toStringTag,{value:"Module"})),Jke=`desc;$DKGRAYUsed to move player to board
`,Qke=Object.freeze(Object.defineProperty({__proto__:null,default:Jke},Symbol.toStringTag,{value:"Module"})),eMe=`desc;$DKGRAYList all boards as goto hyperlinks
`,tMe=Object.freeze(Object.defineProperty({__proto__:null,default:eMe},Symbol.toStringTag,{value:"Module"})),nMe=`desc;$DKGRAYExport entire book as JSON (operator only)
`,rMe=Object.freeze(Object.defineProperty({__proto__:null,default:nMe},Symbol.toStringTag,{value:"Module"})),iMe=`desc;$DKGRAYShow book export options (operator only)
`,sMe=Object.freeze(Object.defineProperty({__proto__:null,default:iMe},Symbol.toStringTag,{value:"Module"})),oMe=`desc;$DKGRAYRename the main book (operator only)
`,aMe=Object.freeze(Object.defineProperty({__proto__:null,default:oMe},Symbol.toStringTag,{value:"Module"})),cMe=`desc;$DKGRAYList all books
`,lMe=Object.freeze(Object.defineProperty({__proto__:null,default:cMe},Symbol.toStringTag,{value:"Module"})),uMe=`desc;$DKGRAYTrash a book by address (operator only)
`,hMe=Object.freeze(Object.defineProperty({__proto__:null,default:uMe},Symbol.toStringTag,{value:"Module"})),fMe=`desc;$DKGRAYSet BPM
`,dMe=Object.freeze(Object.defineProperty({__proto__:null,default:fMe},Symbol.toStringTag,{value:"Module"})),pMe=`desc;$DKGRAY
`,mMe=Object.freeze(Object.defineProperty({__proto__:null,default:pMe},Symbol.toStringTag,{value:"Module"})),gMe=`desc;$DKGRAYStart/stop stream broadcast (operator only)
`,_Me=Object.freeze(Object.defineProperty({__proto__:null,default:gMe},Symbol.toStringTag,{value:"Module"})),vMe=`desc;$DKGRAYCreate new board and write id to stat
`,yMe=Object.freeze(Object.defineProperty({__proto__:null,default:vMe},Symbol.toStringTag,{value:"Module"})),bMe=`desc;$DKGRAYChange elements of one kind to another
`,SMe=Object.freeze(Object.defineProperty({__proto__:null,default:bMe},Symbol.toStringTag,{value:"Module"})),EMe=`desc;$DKGRAYSet character (self or at direction)
`,xMe=Object.freeze(Object.defineProperty({__proto__:null,default:EMe},Symbol.toStringTag,{value:"Module"})),TMe=`desc;$DKGRAY
`,wMe=Object.freeze(Object.defineProperty({__proto__:null,default:TMe},Symbol.toStringTag,{value:"Module"})),AMe=`desc;$DKGRAYStart/stop twitch chat integration (operator only)
`,CMe=Object.freeze(Object.defineProperty({__proto__:null,default:AMe},Symbol.toStringTag,{value:"Module"})),RMe="desc;$DKGRAYClear variables (set to 0)",kMe=Object.freeze(Object.defineProperty({__proto__:null,default:RMe},Symbol.toStringTag,{value:"Module"})),MMe=`desc;$DKGRAYSet color (self or at direction)
`,IMe=Object.freeze(Object.defineProperty({__proto__:null,default:MMe},Symbol.toStringTag,{value:"Module"})),OMe=`desc;$DKGRAY
`,NMe=Object.freeze(Object.defineProperty({__proto__:null,default:OMe},Symbol.toStringTag,{value:"Module"})),PMe=`desc;$DKGRAYCopy region from source to current board
`,DMe=Object.freeze(Object.defineProperty({__proto__:null,default:PMe},Symbol.toStringTag,{value:"Module"})),LMe=`desc;$DKGRAYSet element cycle value (1-255)
`,UMe=Object.freeze(Object.defineProperty({__proto__:null,default:LMe},Symbol.toStringTag,{value:"Module"})),BMe=`desc;$DKGRAYEnter dev mode / halt execution (operator only)
`,FMe=Object.freeze(Object.defineProperty({__proto__:null,default:BMe},Symbol.toStringTag,{value:"Module"})),jMe=`desc;$DKGRAYDelete element (halt execution unless @isitem)
`,zMe=Object.freeze(Object.defineProperty({__proto__:null,default:jMe},Symbol.toStringTag,{value:"Module"})),$Me=`desc;$DKGRAYApply distortion to fx 0-1
`,VMe=Object.freeze(Object.defineProperty({__proto__:null,default:$Me},Symbol.toStringTag,{value:"Module"})),HMe=`desc;$DKGRAYDistortion for fx 0
`,GMe=Object.freeze(Object.defineProperty({__proto__:null,default:HMe},Symbol.toStringTag,{value:"Module"})),WMe=`desc;$DKGRAYDistortion for fx 1
`,qMe=Object.freeze(Object.defineProperty({__proto__:null,default:WMe},Symbol.toStringTag,{value:"Module"})),YMe=`desc;$DKGRAYDistortion for fx 2
`,KMe=Object.freeze(Object.defineProperty({__proto__:null,default:YMe},Symbol.toStringTag,{value:"Module"})),XMe=`desc;$DKGRAYstarts a do-done block
`,ZMe=Object.freeze(Object.defineProperty({__proto__:null,default:XMe},Symbol.toStringTag,{value:"Module"})),JMe=`desc;$DKGRAYcompletes an if-do-done block
`,QMe=Object.freeze(Object.defineProperty({__proto__:null,default:JMe},Symbol.toStringTag,{value:"Module"})),eIe=`desc;$DKGRAYDuplicate element at direction in given direction
`,tIe=Object.freeze(Object.defineProperty({__proto__:null,default:eIe},Symbol.toStringTag,{value:"Module"})),nIe=`desc;$DKGRAYDuplicate element with argument
`,rIe=Object.freeze(Object.defineProperty({__proto__:null,default:nIe},Symbol.toStringTag,{value:"Module"})),iIe="desc;$DKGRAYDuplicate element at direction in given direction",sIe=Object.freeze(Object.defineProperty({__proto__:null,default:iIe},Symbol.toStringTag,{value:"Module"})),oIe=`desc;$DKGRAYDuplicate element with argument
`,aIe=Object.freeze(Object.defineProperty({__proto__:null,default:oIe},Symbol.toStringTag,{value:"Module"})),cIe="desc;$DKGRAYApply echo effect to fx 0-1",lIe=Object.freeze(Object.defineProperty({__proto__:null,default:cIe},Symbol.toStringTag,{value:"Module"})),uIe=`desc;$DKGRAYEcho for fx 0
`,hIe=Object.freeze(Object.defineProperty({__proto__:null,default:uIe},Symbol.toStringTag,{value:"Module"})),fIe=`desc;$DKGRAYEcho for fx 1
`,dIe=Object.freeze(Object.defineProperty({__proto__:null,default:fIe},Symbol.toStringTag,{value:"Module"})),pIe=`desc;$DKGRAYEcho for fx 2
`,mIe=Object.freeze(Object.defineProperty({__proto__:null,default:pIe},Symbol.toStringTag,{value:"Module"})),gIe=`desc;$DKGRAYelse logic in an if-do-done block
`,_Ie=Object.freeze(Object.defineProperty({__proto__:null,default:gIe},Symbol.toStringTag,{value:"Module"})),vIe=`desc;$DKGRAYconditional else logic in an if-do-done block
`,yIe=Object.freeze(Object.defineProperty({__proto__:null,default:vIe},Symbol.toStringTag,{value:"Module"})),bIe="desc;$DKGRAYEnd program (optionally set 'arg' variable)",SIe=Object.freeze(Object.defineProperty({__proto__:null,default:bIe},Symbol.toStringTag,{value:"Module"})),EIe="desc;$DKGRAYSet health to 0",xIe=Object.freeze(Object.defineProperty({__proto__:null,default:EIe},Symbol.toStringTag,{value:"Module"})),TIe=`desc;$DKGRAY
`,wIe=Object.freeze(Object.defineProperty({__proto__:null,default:TIe},Symbol.toStringTag,{value:"Module"})),AIe=`desc;$DKGRAYShow export menu (operator only)
`,CIe=Object.freeze(Object.defineProperty({__proto__:null,default:AIe},Symbol.toStringTag,{value:"Module"})),RIe=`desc;$DKGRAYApply frequency crush to fx 0-1
`,kIe=Object.freeze(Object.defineProperty({__proto__:null,default:RIe},Symbol.toStringTag,{value:"Module"})),MIe=`desc;$DKGRAYFrequency crush for fx 0
`,IIe=Object.freeze(Object.defineProperty({__proto__:null,default:MIe},Symbol.toStringTag,{value:"Module"})),OIe=`desc;$DKGRAYFrequency crush for fx 1
`,NIe=Object.freeze(Object.defineProperty({__proto__:null,default:OIe},Symbol.toStringTag,{value:"Module"})),PIe=`desc;$DKGRAYFrequency crush for fx 2
`,DIe=Object.freeze(Object.defineProperty({__proto__:null,default:PIe},Symbol.toStringTag,{value:"Module"})),LIe=`desc;$DKGRAYFetch URL with label, method, and optional data
`,UIe=Object.freeze(Object.defineProperty({__proto__:null,default:LIe},Symbol.toStringTag,{value:"Module"})),BIe=`desc;$DKGRAYFetch URL with argument, label, method, and optional data
`,FIe=Object.freeze(Object.defineProperty({__proto__:null,default:BIe},Symbol.toStringTag,{value:"Module"})),jIe=`desc;$DKGRAYHighlight matched elements
`,zIe=Object.freeze(Object.defineProperty({__proto__:null,default:jIe},Symbol.toStringTag,{value:"Module"})),$Ie=`desc;$DKGRAY
`,VIe=Object.freeze(Object.defineProperty({__proto__:null,default:$Ie},Symbol.toStringTag,{value:"Module"})),HIe=`desc;$DKGRAYOpen tab with copy of state (operator only)
`,GIe=Object.freeze(Object.defineProperty({__proto__:null,default:HIe},Symbol.toStringTag,{value:"Module"})),WIe=`desc;$DKGRAYToggle built-in inspector
`,qIe=Object.freeze(Object.defineProperty({__proto__:null,default:WIe},Symbol.toStringTag,{value:"Module"})),YIe=`desc;$DKGRAYMove element in direction
`,KIe=Object.freeze(Object.defineProperty({__proto__:null,default:YIe},Symbol.toStringTag,{value:"Module"})),XIe=`desc;$DKGRAYTeleport player to board by stat with optional x, y
`,ZIe=Object.freeze(Object.defineProperty({__proto__:null,default:XIe},Symbol.toStringTag,{value:"Module"})),JIe=`desc;$DKGRAYShow help scroll
`,QIe=Object.freeze(Object.defineProperty({__proto__:null,default:JIe},Symbol.toStringTag,{value:"Module"})),eOe=`desc;$DKGRAYhyperlink
`,tOe=Object.freeze(Object.defineProperty({__proto__:null,default:eOe},Symbol.toStringTag,{value:"Module"})),nOe=`desc;$DKGRAYYield execution until next tick
`,rOe=Object.freeze(Object.defineProperty({__proto__:null,default:nOe},Symbol.toStringTag,{value:"Module"})),iOe=`desc;$DKGRAYevals condition for true or false
`,sOe=Object.freeze(Object.defineProperty({__proto__:null,default:iOe},Symbol.toStringTag,{value:"Module"})),oOe=`desc;$DKGRAYExport zip file for itch.io (operator only)
`,aOe=Object.freeze(Object.defineProperty({__proto__:null,default:oOe},Symbol.toStringTag,{value:"Module"})),cOe=`desc;$DKGRAYStart multiplayer session (operator only)
`,lOe=Object.freeze(Object.defineProperty({__proto__:null,default:cOe},Symbol.toStringTag,{value:"Module"})),uOe=`desc;$DKGRAYOpen new tab with the join url (operator only)
`,hOe=Object.freeze(Object.defineProperty({__proto__:null,default:uOe},Symbol.toStringTag,{value:"Module"})),fOe=`desc;$DKGRAYLoad code from object codepage into object at given direction
`,dOe=Object.freeze(Object.defineProperty({__proto__:null,default:fOe},Symbol.toStringTag,{value:"Module"})),pOe=`desc;$DKGRAYLock against external messages
`,mOe=Object.freeze(Object.defineProperty({__proto__:null,default:pOe},Symbol.toStringTag,{value:"Module"})),gOe=`desc;$DKGRAYDoes a countdown and reloads into an empty state (operator only)
`,_Oe=Object.freeze(Object.defineProperty({__proto__:null,default:gOe},Symbol.toStringTag,{value:"Module"})),vOe=`desc;$DKGRAYUses given id to ensure only one element of given kind is made
`,yOe=Object.freeze(Object.defineProperty({__proto__:null,default:vOe},Symbol.toStringTag,{value:"Module"})),bOe=`desc;$DKGRAYPut element with argument and oneof logic
`,SOe=Object.freeze(Object.defineProperty({__proto__:null,default:bOe},Symbol.toStringTag,{value:"Module"})),EOe=`desc;$DKGRAYExport code page as JSON (operator only)
`,xOe=Object.freeze(Object.defineProperty({__proto__:null,default:EOe},Symbol.toStringTag,{value:"Module"})),TOe=`desc;$DKGRAYOpen a code page editor
`,wOe=Object.freeze(Object.defineProperty({__proto__:null,default:TOe},Symbol.toStringTag,{value:"Module"})),AOe=`desc;$DKGRAYList all pages in main book
`,COe=Object.freeze(Object.defineProperty({__proto__:null,default:AOe},Symbol.toStringTag,{value:"Module"})),ROe=`desc;$DKGRAYTrash a code page (operator only)
`,kOe=Object.freeze(Object.defineProperty({__proto__:null,default:ROe},Symbol.toStringTag,{value:"Module"})),MOe=`desc;$DKGRAY
`,IOe=Object.freeze(Object.defineProperty({__proto__:null,default:MOe},Symbol.toStringTag,{value:"Module"})),OOe=`desc;$DKGRAYRotate board elements by degrees
`,NOe=Object.freeze(Object.defineProperty({__proto__:null,default:OOe},Symbol.toStringTag,{value:"Module"})),POe="desc;$DKGRAYPlay music notes",DOe=Object.freeze(Object.defineProperty({__proto__:null,default:POe},Symbol.toStringTag,{value:"Module"})),LOe=`desc;$DKGRAYShove target object in direction ONLY if pushable
`,UOe=Object.freeze(Object.defineProperty({__proto__:null,default:LOe},Symbol.toStringTag,{value:"Module"})),BOe="desc;$DKGRAYPut element in direction",FOe=Object.freeze(Object.defineProperty({__proto__:null,default:BOe},Symbol.toStringTag,{value:"Module"})),jOe=`desc;$DKGRAYPut element with argument
`,zOe=Object.freeze(Object.defineProperty({__proto__:null,default:jOe},Symbol.toStringTag,{value:"Module"})),$Oe=`desc;$DKGRAYRead property from object into variable
`,VOe=Object.freeze(Object.defineProperty({__proto__:null,default:$Oe},Symbol.toStringTag,{value:"Module"})),HOe=`desc;$DKGRAYParse binary data
`,GOe=Object.freeze(Object.defineProperty({__proto__:null,default:HOe},Symbol.toStringTag,{value:"Module"})),WOe=`desc;$DKGRAYParse JSON data
`,qOe=Object.freeze(Object.defineProperty({__proto__:null,default:WOe},Symbol.toStringTag,{value:"Module"})),YOe=`desc;$DKGRAYParse text data
`,KOe=Object.freeze(Object.defineProperty({__proto__:null,default:YOe},Symbol.toStringTag,{value:"Module"})),XOe=`desc;$DKGRAY
`,ZOe=Object.freeze(Object.defineProperty({__proto__:null,default:XOe},Symbol.toStringTag,{value:"Module"})),JOe=`desc;$DKGRAYRemix from source with pattern size and mirror to current board
`,QOe=Object.freeze(Object.defineProperty({__proto__:null,default:JOe},Symbol.toStringTag,{value:"Module"})),e3e=`desc;$DKGRAY
`,t3e=Object.freeze(Object.defineProperty({__proto__:null,default:e3e},Symbol.toStringTag,{value:"Module"})),n3e=`desc;$DKGRAYRestart software, deletes all chip and player state (operator only)
`,r3e=Object.freeze(Object.defineProperty({__proto__:null,default:n3e},Symbol.toStringTag,{value:"Module"})),i3e=`desc;$DKGRAYRestore all labels of given name
`,s3e=Object.freeze(Object.defineProperty({__proto__:null,default:i3e},Symbol.toStringTag,{value:"Module"})),o3e=`desc;$DKGRAYApply reverb to fx 0-1
`,a3e=Object.freeze(Object.defineProperty({__proto__:null,default:o3e},Symbol.toStringTag,{value:"Module"})),c3e=`desc;$DKGRAYReverb for fx 0
`,l3e=Object.freeze(Object.defineProperty({__proto__:null,default:c3e},Symbol.toStringTag,{value:"Module"})),u3e=`desc;$DKGRAYReverb for fx 1
`,h3e=Object.freeze(Object.defineProperty({__proto__:null,default:u3e},Symbol.toStringTag,{value:"Module"})),f3e=`desc;$DKGRAYReverb for fx 2
`,d3e=Object.freeze(Object.defineProperty({__proto__:null,default:f3e},Symbol.toStringTag,{value:"Module"})),p3e=`desc;$DKGRAYRevert board to snapshot state
`,m3e=Object.freeze(Object.defineProperty({__proto__:null,default:p3e},Symbol.toStringTag,{value:"Module"})),g3e=`desc;$DKGRAYRun object codepage of given name
`,_3e=Object.freeze(Object.defineProperty({__proto__:null,default:g3e},Symbol.toStringTag,{value:"Module"})),v3e=`desc;$DKGRAYRun function with argument
`,y3e=Object.freeze(Object.defineProperty({__proto__:null,default:v3e},Symbol.toStringTag,{value:"Module"})),b3e=`desc;$DKGRAYSave state to url (operator only)
`,S3e=Object.freeze(Object.defineProperty({__proto__:null,default:b3e},Symbol.toStringTag,{value:"Module"})),E3e=`desc;$DKGRAYsend
`,x3e=Object.freeze(Object.defineProperty({__proto__:null,default:E3e},Symbol.toStringTag,{value:"Module"})),T3e="desc;$DKGRAYSet variable to value",w3e=Object.freeze(Object.defineProperty({__proto__:null,default:T3e},Symbol.toStringTag,{value:"Module"})),A3e=`desc;$DKGRAYget share url (operator only)
`,C3e=Object.freeze(Object.defineProperty({__proto__:null,default:A3e},Symbol.toStringTag,{value:"Module"})),R3e=`desc;$DKGRAYShoot projectile, with optional kind
`,k3e=Object.freeze(Object.defineProperty({__proto__:null,default:R3e},Symbol.toStringTag,{value:"Module"})),M3e=`desc;$DKGRAYShoot projectile with argument
`,I3e=Object.freeze(Object.defineProperty({__proto__:null,default:M3e},Symbol.toStringTag,{value:"Module"})),O3e=`desc;$DKGRAYshortsend
`,N3e=Object.freeze(Object.defineProperty({__proto__:null,default:O3e},Symbol.toStringTag,{value:"Module"})),P3e=`desc;$DKGRAYShove target object in direction
`,D3e=Object.freeze(Object.defineProperty({__proto__:null,default:P3e},Symbol.toStringTag,{value:"Module"})),L3e=`desc;$DKGRAYCreate board snapshot
`,U3e=Object.freeze(Object.defineProperty({__proto__:null,default:L3e},Symbol.toStringTag,{value:"Module"})),B3e=`desc;$DKGRAYstat
`,F3e=Object.freeze(Object.defineProperty({__proto__:null,default:B3e},Symbol.toStringTag,{value:"Module"})),j3e=`desc;$DKGRAYConfigure or restart 8track synth
`,z3e=Object.freeze(Object.defineProperty({__proto__:null,default:j3e},Symbol.toStringTag,{value:"Module"})),$3e=`desc;$DKGRAYConfigure synth voice 1
`,V3e=Object.freeze(Object.defineProperty({__proto__:null,default:$3e},Symbol.toStringTag,{value:"Module"})),H3e=`desc;$DKGRAYConfigure synth voice 2
`,G3e=Object.freeze(Object.defineProperty({__proto__:null,default:H3e},Symbol.toStringTag,{value:"Module"})),W3e=`desc;$DKGRAYConfigure synth voice 3
`,q3e=Object.freeze(Object.defineProperty({__proto__:null,default:W3e},Symbol.toStringTag,{value:"Module"})),Y3e=`desc;$DKGRAYConfigure synth voice 4
`,K3e=Object.freeze(Object.defineProperty({__proto__:null,default:Y3e},Symbol.toStringTag,{value:"Module"})),X3e=`desc;$DKGRAYConfigure bgplay synth (voices 4-8)
`,Z3e=Object.freeze(Object.defineProperty({__proto__:null,default:X3e},Symbol.toStringTag,{value:"Module"})),J3e=`desc;$DKGRAYClear buffer of played notes
`,Q3e=Object.freeze(Object.defineProperty({__proto__:null,default:J3e},Symbol.toStringTag,{value:"Module"})),eNe=`desc;$DKGRAYRecord played note buffer to an mp3 file
`,tNe=Object.freeze(Object.defineProperty({__proto__:null,default:eNe},Symbol.toStringTag,{value:"Module"})),nNe=`desc;$DKGRAYtext
`,rNe=Object.freeze(Object.defineProperty({__proto__:null,default:nNe},Symbol.toStringTag,{value:"Module"})),iNe="desc;$DKGRAYThrow star projectile, shorthand for `#shoot <dir> star`\n",sNe=Object.freeze(Object.defineProperty({__proto__:null,default:iNe},Symbol.toStringTag,{value:"Module"})),oNe=`desc;$DKGRAYThrow star with argument
`,aNe=Object.freeze(Object.defineProperty({__proto__:null,default:oNe},Symbol.toStringTag,{value:"Module"})),cNe=`desc;$DKGRAYSets element ticker text
`,lNe=Object.freeze(Object.defineProperty({__proto__:null,default:cNe},Symbol.toStringTag,{value:"Module"})),uNe=`desc;$DKGRAYShow toast notification
`,hNe=Object.freeze(Object.defineProperty({__proto__:null,default:uNe},Symbol.toStringTag,{value:"Module"})),fNe=`desc;$DKGRAYMove element across board with transporter logic
`,dNe=Object.freeze(Object.defineProperty({__proto__:null,default:fNe},Symbol.toStringTag,{value:"Module"})),pNe=`desc;$DKGRAYList books/codepages to delete (operator only)
`,mNe=Object.freeze(Object.defineProperty({__proto__:null,default:pNe},Symbol.toStringTag,{value:"Module"})),gNe=`desc;$DKGRAYSpeak text with voice (or clear queue)
`,_Ne=Object.freeze(Object.defineProperty({__proto__:null,default:gNe},Symbol.toStringTag,{value:"Module"})),vNe=`desc;$DKGRAYSet TTS engine and config
`,yNe=Object.freeze(Object.defineProperty({__proto__:null,default:vNe},Symbol.toStringTag,{value:"Module"})),bNe=`desc;$DKGRAYQueue TTS phrase
`,SNe=Object.freeze(Object.defineProperty({__proto__:null,default:bNe},Symbol.toStringTag,{value:"Module"})),ENe=`desc;$DKGRAYSet TTS volume
`,xNe=Object.freeze(Object.defineProperty({__proto__:null,default:ENe},Symbol.toStringTag,{value:"Module"})),TNe=`desc;$DKGRAY
`,wNe=Object.freeze(Object.defineProperty({__proto__:null,default:TNe},Symbol.toStringTag,{value:"Module"})),ANe=`desc;$DKGRAY
`,CNe=Object.freeze(Object.defineProperty({__proto__:null,default:ANe},Symbol.toStringTag,{value:"Module"})),RNe=`desc;$DKGRAYUnlock against messages from others
`,kNe=Object.freeze(Object.defineProperty({__proto__:null,default:RNe},Symbol.toStringTag,{value:"Module"})),MNe=`desc;$DKGRAYAutomate user input actions (up/down/left/right/etc)
`,INe=Object.freeze(Object.defineProperty({__proto__:null,default:MNe},Symbol.toStringTag,{value:"Module"})),ONe=`desc;$DKGRAYApply vibrato to fx 0-1
`,NNe=Object.freeze(Object.defineProperty({__proto__:null,default:ONe},Symbol.toStringTag,{value:"Module"})),PNe=`desc;$DKGRAYVibrato for fx 0
`,DNe=Object.freeze(Object.defineProperty({__proto__:null,default:PNe},Symbol.toStringTag,{value:"Module"})),LNe=`desc;$DKGRAYVibrato for fx 1
`,UNe=Object.freeze(Object.defineProperty({__proto__:null,default:LNe},Symbol.toStringTag,{value:"Module"})),BNe=`desc;$DKGRAYVibrato for fx 2
`,FNe=Object.freeze(Object.defineProperty({__proto__:null,default:BNe},Symbol.toStringTag,{value:"Module"})),jNe="desc;$DKGRAYSet main volume",zNe=Object.freeze(Object.defineProperty({__proto__:null,default:jNe},Symbol.toStringTag,{value:"Module"})),$Ne="desc;$DKGRAY",VNe=Object.freeze(Object.defineProperty({__proto__:null,default:$Ne},Symbol.toStringTag,{value:"Module"})),HNe="desc;$DKGRAYWill cause element to move in direction each tick",GNe=Object.freeze(Object.defineProperty({__proto__:null,default:HNe},Symbol.toStringTag,{value:"Module"})),WNe="desc;$DKGRAYWeave board elements in direction",qNe=Object.freeze(Object.defineProperty({__proto__:null,default:WNe},Symbol.toStringTag,{value:"Module"})),YNe="desc;$DKGRAYlooping do-done block",KNe=Object.freeze(Object.defineProperty({__proto__:null,default:YNe},Symbol.toStringTag,{value:"Module"})),XNe="desc;$DKGRAYSwitch to target board by id, name, or stat",ZNe=Object.freeze(Object.defineProperty({__proto__:null,default:XNe},Symbol.toStringTag,{value:"Module"})),JNe="desc;$DKGRAYSwitch to target object id",QNe=Object.freeze(Object.defineProperty({__proto__:null,default:JNe},Symbol.toStringTag,{value:"Module"})),ePe="desc;$DKGRAYWrite text to board at direction",tPe=Object.freeze(Object.defineProperty({__proto__:null,default:ePe},Symbol.toStringTag,{value:"Module"})),nPe="desc;$DKGRAYDe-activate first label of given name",rPe=Object.freeze(Object.defineProperty({__proto__:null,default:nPe},Symbol.toStringTag,{value:"Module"})),iPe=`desc;$DKGRAYGet random ZZT content
`,sPe=Object.freeze(Object.defineProperty({__proto__:null,default:iPe},Symbol.toStringTag,{value:"Module"})),oPe=`desc;$DKGRAYSearch ZZT content by field and text
`,aPe=Object.freeze(Object.defineProperty({__proto__:null,default:oPe},Symbol.toStringTag,{value:"Module"})),cPe=`desc;$DKGRAYdesignates an inactive label or comment
`,lPe=Object.freeze(Object.defineProperty({__proto__:null,default:cPe},Symbol.toStringTag,{value:"Module"})),uPe=`desc;$DKGRAYadds hyperlink text

`,hPe=Object.freeze(Object.defineProperty({__proto__:null,default:uPe},Symbol.toStringTag,{value:"Module"})),fPe=`desc;$DKGRAYsends the given message when hotkey is pressed

`,dPe=Object.freeze(Object.defineProperty({__proto__:null,default:fPe},Symbol.toStringTag,{value:"Module"})),pPe=`desc;$DKGRAYread number input into given stat/flag
`,mPe=Object.freeze(Object.defineProperty({__proto__:null,default:pPe},Symbol.toStringTag,{value:"Module"})),gPe=`desc;$DKGRAYa slider input from 1 to 9 

`,_Pe=Object.freeze(Object.defineProperty({__proto__:null,default:gPe},Symbol.toStringTag,{value:"Module"})),vPe=`desc;$DKGRAYlist with label value pairs to pick from
`,yPe=Object.freeze(Object.defineProperty({__proto__:null,default:vPe},Symbol.toStringTag,{value:"Module"})),bPe=`desc;$DKGRAYread text input into given stat/flag
`,SPe=Object.freeze(Object.defineProperty({__proto__:null,default:bPe},Symbol.toStringTag,{value:"Module"})),EPe=`desc;$DKGRAYdesignates a starting point for running code
`,xPe=Object.freeze(Object.defineProperty({__proto__:null,default:EPe},Symbol.toStringTag,{value:"Module"})),TPe=`desc;$DKGRAYwaits until the object can move in the given direction and moves
`,wPe=Object.freeze(Object.defineProperty({__proto__:null,default:TPe},Symbol.toStringTag,{value:"Module"})),APe=`desc;$DKGRAYwill move the object in the given direction
`,CPe=Object.freeze(Object.defineProperty({__proto__:null,default:APe},Symbol.toStringTag,{value:"Module"})),RPe=`desc;$DKGRAYcreates a 60x25 space for terrain and object elements
`,kPe=Object.freeze(Object.defineProperty({__proto__:null,default:RPe},Symbol.toStringTag,{value:"Module"})),MPe=`desc;$DKGRAYcustom 8x14 charset
`,IPe=Object.freeze(Object.defineProperty({__proto__:null,default:MPe},Symbol.toStringTag,{value:"Module"})),OPe=`desc;$DKGRAYsets stat to given value

`,NPe=Object.freeze(Object.defineProperty({__proto__:null,default:OPe},Symbol.toStringTag,{value:"Module"})),PPe=`desc;$DKGRAYsends the given message when hotkey is pressed

`,DPe=Object.freeze(Object.defineProperty({__proto__:null,default:PPe},Symbol.toStringTag,{value:"Module"})),LPe=`desc;$DKGRAYread external content and/or handle events
`,UPe=Object.freeze(Object.defineProperty({__proto__:null,default:LPe},Symbol.toStringTag,{value:"Module"})),BPe=`desc;$DKGRAYread number input into given stat/flag
`,FPe=Object.freeze(Object.defineProperty({__proto__:null,default:BPe},Symbol.toStringTag,{value:"Module"})),jPe=`desc;$DKGRAYelements that can walk, swim, or be used with #shoot

`,zPe=Object.freeze(Object.defineProperty({__proto__:null,default:jPe},Symbol.toStringTag,{value:"Module"})),$Pe=`desc;$DKGRAYcustom palette colors
`,VPe=Object.freeze(Object.defineProperty({__proto__:null,default:$Pe},Symbol.toStringTag,{value:"Module"})),HPe=`desc;$DKGRAYa slider input from 1 to 9 

`,GPe=Object.freeze(Object.defineProperty({__proto__:null,default:HPe},Symbol.toStringTag,{value:"Module"})),WPe=`desc;$DKGRAYlist with label value pairs to pick from
`,qPe=Object.freeze(Object.defineProperty({__proto__:null,default:WPe},Symbol.toStringTag,{value:"Module"})),YPe=`desc;$DKGRAYterrain for solid, walkable, swimable board elements
`,KPe=Object.freeze(Object.defineProperty({__proto__:null,default:YPe},Symbol.toStringTag,{value:"Module"})),XPe=`desc;$DKGRAYread text input into given stat/flag
`,ZPe=Object.freeze(Object.defineProperty({__proto__:null,default:XPe},Symbol.toStringTag,{value:"Module"})),JPe=`desc;$DKGRAYadds text
`,QPe=Object.freeze(Object.defineProperty({__proto__:null,default:JPe},Symbol.toStringTag,{value:"Module"})),e2e=`$white no pages found
$white use @ to create a page
$white @board name of board
$white @object name of object
$white @terrain name of terrain
$white You can omit the type and it will default to object
$white @object name of object
$white @name of object`,t2e=Object.freeze(Object.defineProperty({__proto__:null,default:e2e},Symbol.toStringTag,{value:"Module"})),n2e=`section;legend
s1, s2, s3, s4 = sound sources/operators
m = modulator
c = carrier
--> = signal flow
section;algo0
S1 --> M --> S2 --> M --> S3 --> M --> S4 --> C
`,r2e=Object.freeze(Object.defineProperty({__proto__:null,default:n2e},Symbol.toStringTag,{value:"Module"})),i2e=`section;#autofilter on
#autofilter <number>
$white 0-100, 0 is off, 100 is full volume
#autofilter depth <number>
$white Controls the intensity of the filter.
#autofilter frequency <number>
$white The rate of oscilation of the effect.
#autofilter octaves <number>
$white Controls the range of the effect.
#autofilter q <number>
$white Sets the intensity of the effect.
#autofilter type <lowpass, highpass, ...>
$white Sets the behavior of the filter.
!openit https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode/type;filter types`,s2e=Object.freeze(Object.defineProperty({__proto__:null,default:i2e},Symbol.toStringTag,{value:"Module"})),o2e=`section;#autowah on
#autowah <number>
$white 0-100, 0 is off, 100 is full volume
#autowah basefrequency <frequency>
$white The frequency the filter is set to at the
$white low point of the wah.
#autowah octaves <number>
$white The number of octaves above the baseFrequency 
$white the filter will sweep to when fully open.
#autowah sensitivity <number>
$white The decibel threshold sensitivity for 
$white the incoming signal.
$white Normal range of -40 to 0.
#autowah gain <number>
$white Controls the loudness of the effect.
#autowah follower <seconds>
$white Sets the smoothing time for the effect.`,a2e=Object.freeze(Object.defineProperty({__proto__:null,default:o2e},Symbol.toStringTag,{value:"Module"})),c2e=`press$white C$yellow to chat
press$white #$yellow to run a quick command
section;dev-tools
#gadget
$white toggles inspector tool on/off
#zztrandom
$white downloads random from the museumofzzt api
#zztsearch <field> <value>
$white searches the museumofzzt api for zzt games
section;multi-player
#set user <name>
$white sets your display name when talking to others
#joincode OR $meta+O 
$white starts a multi-player session showing a
$white QR code. It also provides are sharable link
$white you can give to other to join the game.`,l2e=Object.freeze(Object.defineProperty({__proto__:null,default:c2e},Symbol.toStringTag,{value:"Module"})),u2e=`section;#distort on
#distort <number>
$white 0-100, 0 is off, 100 is full volume
#distort distortion <number>
$white 0 or higher, controls strength of effect.
#distort oversample <2x|4x|none>
$white oversample improves quality.`,h2e=Object.freeze(Object.defineProperty({__proto__:null,default:u2e},Symbol.toStringTag,{value:"Module"})),f2e=`section;#echo on
#echo <number>
$white 0-100, 0 is off, 100 is full volume
#echo delaytime <seconds>
$white duration between echos.
#echo feedback <number>
$white A number that is between [0, 1]
$white 1 is forever feedback and 0 is none.`,d2e=Object.freeze(Object.defineProperty({__proto__:null,default:f2e},Symbol.toStringTag,{value:"Module"})),p2e=`!fcrushscroll hk c C next;#fcrush on
!echoscroll hk e E next;#echo on
!reverbscroll hk r R next;#reverb on
!autofilterscroll hk f F next;#autofilter on
!distortscroll hk d D next;#distort on
!vibratoscroll hk v V next;#vibrato on
!autowahscroll hk w W next;#autowah on`,m2e=Object.freeze(Object.defineProperty({__proto__:null,default:p2e},Symbol.toStringTag,{value:"Module"})),g2e=`section;#fcrush on
#fcrush <number>
$white 0-100, 0 is off, 100 is full volume
#fcrush rate <number>
$white 1 or higher, more rate, more crush`,_2e=Object.freeze(Object.defineProperty({__proto__:null,default:g2e},Symbol.toStringTag,{value:"Module"})),v2e=`section;keyboard input
option;arrow keys;$greenmove
option;shift + arrow keys;$greenshoot
option;enter;$greenok / accept
option;escape;$greencancel / close
option;tab;$greenmenu / layout
section;controller input
option;left stick;$greenmove
option;right stick;$greenshoot
option;left trigger;$greenalt
option;right trigger;$green$meta
option;left shoulder;$greencancel / close
option;right shoulder;$greenok / accept
option;d-pad;$greenmove
option;a X;$greenshoot down
option;b $9;$greenshoot right
option;x $254;$greenshoot left
option;y $30;$greenshoot up
option;menu;$greenmenu / change layout
`,y2e=Object.freeze(Object.defineProperty({__proto__:null,default:v2e},Symbol.toStringTag,{value:"Module"})),b2e=`option;#books;list books in memory
option;#pages;list pages in opened book
option;@[pagetype:]page name;create & edit a new codepage in the currently opened book
option;#trash;list books and pages from open book you can delete
option;#save;flush state to register
option;#share;creates a click to copy share url and QR code
`,S2e=Object.freeze(Object.defineProperty({__proto__:null,default:b2e},Symbol.toStringTag,{value:"Module"})),E2e=`!helpcontrols hk c C next;read help on controls
!helptext hk t T next;read help on text and inputs
"
keyboard input
option;? or /;$greenopen cli
option;esc;$greenclose cli, scroll, or editor
option;tab;$greenchange layout
option;up or down arrow keys;$greennavigate cli lines
option;left or right arrow keys;$greenchange cli lines
option;enter;$greenaction on selected line
option;alt + arrow keys;$greenskip words and cli lines
option;$meta + up / down arrow keys;$greeninput history`,x2e=Object.freeze(Object.defineProperty({__proto__:null,default:E2e},Symbol.toStringTag,{value:"Module"})),T2e=`player settings
$white#set user "name goes here"
`,w2e=Object.freeze(Object.defineProperty({__proto__:null,default:T2e},Symbol.toStringTag,{value:"Module"})),A2e=`section;typography
plain text
use $34@quoted strings for special chars$34
$$0-255 for ascii chars $159$176$240
use color names like $RED$$red$yellow to change
 foreground color
use color names like $black$ONGREEN$$ongreen$ONCLEAR$yellow to change
 background color
use onclear $WHITE$$onclear$yellow to change
 background to transparent
section;hyperlinks
"
option;!message$59 Label;
send the given #message when the
<hyperlink> is pressed
"
option;!message hotkey <shortcut>$59 Label;
option;!message hk <shortcut>$59 Label;
send the given #message when the <shortcut>
is pressed. is-hotkey listens for <shortcut>
!openit https://github.com/ianstormtaylor/is-hotkey;$whiteis-hotkey on https://github.com/
"
option;!flagorstat range [minword] [maxword]$59 Label;
option;!flagorstat rn [minword] [maxword]$59 Label;
uses the standard 1 to 9 values input range
[minword] is the label for value 1
[maxword] is the label for value 9
write user range input into a flagorstat
"
option;!flagorstat select <choices>$59 Label;
option;!flagorstat sl <choices>$59 Label;
<choices> is a list of <word> <value> pairs
select gives a user a way to cycle through
preset choices
write user select input into a flagorstat
"
option;!flagorstat number$59 Label;
option;!flagorstat nm$59 Label;
write user number input into a flagorstat
"
option;!flagorstat text$59 Label;
option;!flagorstat tx$59 Label;
write user text input into a flagorstat
"
option;!copyit content goes here$59 Label;
copies given content into the clipboard
"
option;!openit url$59 Label;
opens the given url in a new browser tab
"
option;!runit content goes here$59 Label;
opens the cli, with the input filled out with 
the given content`,C2e=Object.freeze(Object.defineProperty({__proto__:null,default:A2e},Symbol.toStringTag,{value:"Module"})),R2e=`!helpmenu hk 1 1 next;controls and $greenstart here
!objectlistscroll hk 2 2 next;list object elements
!terrainlistscroll hk 3 3 next;list terrain elements
!adminscroll hk 4 4 next;cpu #admin
!cliscroll hk t T next;cli commands
!dictionary hk d D next;dictionary of commands
!charscroll hk a A next;char
!colorscroll hk c C next;color
!bgscroll hk b B next;bg
!notesscroll hk n N next;notes
!synthscroll hk s S next;synth
!effectsscroll hk e E next;effects
!voicescroll hk v V next;tts voices
`,k2e=Object.freeze(Object.defineProperty({__proto__:null,default:R2e},Symbol.toStringTag,{value:"Module"})),M2e=`"duration             cdefgab = notes 
"y = 64th note        x = rest
"t = 32nd note        
"s = 16th note        drums
"i = eight note       0 = hihat
"q = quarter note     1 = open hihat
"h = half note        2 = cowbell
"w = whole note       p = clap
"mods                 4 = high snare
"3 = triplet          5 = high woodblock
". = time and a half  6 = low snare
"# = sharp            7 = low tom
"! = flat             8 = low woodblock
"+ = increase octave  9 = bass drum
"- = decrease octave
helpful resource on scales
!openit https://www.pianoscales.org/;https://www.pianoscales.org/`,I2e=Object.freeze(Object.defineProperty({__proto__:null,default:M2e},Symbol.toStringTag,{value:"Module"})),O2e=`section;sine, square, triangle, sawtooth
#synth phase <degrees>
$white The phase is the starting position within 
$white the oscillator's cycle. For example a phase 
$white of 180 would start halfway through the
$white oscillator's cycle.
section;amsine, amsquare, amtriangle, amsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
section;fmsine, fmsquare, fmtriangle, fmsawtooth
#synth harmonicity <number>
$white Harmonicity is the frequency ratio between 
$white the carrier and the modulator oscillators.
$white A harmonicity of 1 gives both oscillators 
$white the same frequency. Harmonicity = 2 
$white means a change of an octave.
#synth modtype <sine, square, triangle, sawtooth>
#synth modenv <a> <d> <s> <r> - in seconds
#synth modindex <degrees>
$white The modulation index which is in essence
$white the depth or amount of the modulation.
$white In other terms it is the ratio of the 
$white frequency of the modulating signal (mf) 
$white to the amplitude of the modulating signal 
$white (ma) -- as in ma/mf
section;fatsine, fatsquare, fattriangle, fatsawtooth
#synth phase <degrees>
#synth count <number>
$white This sets the number of oscillators to 
$white spread along the given range.
#synth spread <cents>
$white This signals the number of cents between
$white oscillators.`,N2e=Object.freeze(Object.defineProperty({__proto__:null,default:O2e},Symbol.toStringTag,{value:"Module"})),P2e=`section;pulse
#synth width <range>
$white A number that is between [-1, 1] altering
$white this value changes the shape of the square
$white wave`,D2e=Object.freeze(Object.defineProperty({__proto__:null,default:P2e},Symbol.toStringTag,{value:"Module"})),L2e=`section;pwm
#synth modfreq <frequency>
$white This sets the frequency of change for the 
$white pulse width of this oscillator.`,U2e=Object.freeze(Object.defineProperty({__proto__:null,default:L2e},Symbol.toStringTag,{value:"Module"})),B2e=`section;#reverb on
#reverb <number>
$white 0-100, 0 is off, 100 is full volume
#reverb predelay <seconds>
$white The amount of time before the reverb
$white is fully ramped in.
#reverb decay <seconds>
$white The duration of the reverb.
`,F2e=Object.freeze(Object.defineProperty({__proto__:null,default:B2e},Symbol.toStringTag,{value:"Module"})),j2e=`switching voices
#synth <sine, square, triangle, sawtooth> 
#synth <pwm, pulse, bells, doot>
#synth <retro, buzz, clang, metallic>
#synth <retro, buzz, clang, metallic>
#synth <algo0, algo1, ... ,algo7> 
voice settings
#synth restart - resets voice to default
#synth vol <db> - control volume
#synth port <seconds>
#synth env <attack> <delay> <sustain> <release>
voice specific 
!oscscroll hk o O next;sine, square, triangle, sawtooth
!pwmscroll hk m M next;pwm
!pulsescroll hk p P next;pulse
!algoscroll hk a A next;algo0 -> algo7
`,z2e=Object.freeze(Object.defineProperty({__proto__:null,default:j2e},Symbol.toStringTag,{value:"Module"})),$2e=`section;#vibrato on
#vibrato <number>
$white 0-100, 0 is off, 100 is full volume
#vibrato maxdelay <seconds>
$white longer delay increases the vibrato`,V2e=Object.freeze(Object.defineProperty({__proto__:null,default:$2e},Symbol.toStringTag,{value:"Module"})),H2e=`update this to explain

#tts
#ttsqueue
#ttsengine
`,G2e=Object.freeze(Object.defineProperty({__proto__:null,default:H2e},Symbol.toStringTag,{value:"Module"}));var yb=(n=>(n[n.Border=-1]="Border",n[n.Data=0]="Data",n[n.Function=1]="Function",n[n.Position=2]="Position",n[n.Timing=3]="Timing",n[n.Alignment=4]="Alignment",n))(yb||{}),W2e=Object.defineProperty,q2e=(n,e,t)=>e in n?W2e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,VR=(n,e,t)=>(q2e(n,typeof e!="symbol"?e+"":e,t),t);const Y2e=[0,1],HQ=[1,0],GQ=[2,3],WQ=[3,2],K2e={L:Y2e,M:HQ,Q:GQ,H:WQ},X2e=/^[0-9]*$/,Z2e=/^[A-Z0-9 $%*+.\/:-]*$/,_2="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",bU=1,SU=40,c$=3,J2e=3,HR=40,Q2e=10,qQ=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],YQ=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]];class eDe{constructor(e,t,r,i){if(this.version=e,this.ecc=t,VR(this,"size"),VR(this,"mask"),VR(this,"modules",[]),VR(this,"types",[]),e<bU||e>SU)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=e*4+17;const s=Array.from({length:this.size},()=>!1);for(let a=0;a<this.size;a++)this.modules.push(s.slice()),this.types.push(s.map(()=>0));this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),i===-1){let a=1e9;for(let c=0;c<8;c++){this.applyMask(c),this.drawFormatBits(c);const l=this.getPenaltyScore();l<a&&(i=c,a=l),this.applyMask(c)}}this.mask=i,this.applyMask(i),this.drawFormatBits(i)}getModule(e,t){return e>=0&&e<this.size&&t>=0&&t<this.size&&this.modules[t][e]}drawFunctionPatterns(){for(let r=0;r<this.size;r++)this.setFunctionModule(6,r,r%2===0,yb.Timing),this.setFunctionModule(r,6,r%2===0,yb.Timing);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let r=0;r<t;r++)for(let i=0;i<t;i++)r===0&&i===0||r===0&&i===t-1||r===t-1&&i===0||this.drawAlignmentPattern(e[r],e[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const t=this.ecc[1]<<3|e;let r=t;for(let s=0;s<10;s++)r=r<<1^(r>>>9)*1335;const i=(t<<10|r)^21522;for(let s=0;s<=5;s++)this.setFunctionModule(8,s,C0(i,s));this.setFunctionModule(8,7,C0(i,6)),this.setFunctionModule(8,8,C0(i,7)),this.setFunctionModule(7,8,C0(i,8));for(let s=9;s<15;s++)this.setFunctionModule(14-s,8,C0(i,s));for(let s=0;s<8;s++)this.setFunctionModule(this.size-1-s,8,C0(i,s));for(let s=8;s<15;s++)this.setFunctionModule(8,this.size-15+s,C0(i,s));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let r=0;r<12;r++)e=e<<1^(e>>>11)*7973;const t=this.version<<12|e;for(let r=0;r<18;r++){const i=C0(t,r),s=this.size-11+r%3,o=Math.floor(r/3);this.setFunctionModule(s,o,i),this.setFunctionModule(o,s,i)}}drawFinderPattern(e,t){for(let r=-4;r<=4;r++)for(let i=-4;i<=4;i++){const s=Math.max(Math.abs(i),Math.abs(r)),o=e+i,a=t+r;o>=0&&o<this.size&&a>=0&&a<this.size&&this.setFunctionModule(o,a,s!==2&&s!==4,yb.Position)}}drawAlignmentPattern(e,t){for(let r=-2;r<=2;r++)for(let i=-2;i<=2;i++)this.setFunctionModule(e+i,t+r,Math.max(Math.abs(i),Math.abs(r))!==1,yb.Alignment)}setFunctionModule(e,t,r,i=yb.Function){this.modules[t][e]=r,this.types[t][e]=i}addEccAndInterleave(e){const t=this.version,r=this.ecc;if(e.length!==Kk(t,r))throw new RangeError("Invalid argument");const i=YQ[r[0]][t],s=qQ[r[0]][t],o=Math.floor(m4(t)/8),a=i-o%i,c=Math.floor(o/i),l=[],u=lDe(s);for(let f=0,d=0;f<i;f++){const p=e.slice(d,d+c-s+(f<a?0:1));d+=p.length;const m=uDe(p,u);f<a&&p.push(0),l.push(p.concat(m))}const h=[];for(let f=0;f<l[0].length;f++)l.forEach((d,p)=>{(f!==c-s||p>=a)&&h.push(d[f])});return h}drawCodewords(e){if(e.length!==Math.floor(m4(this.version)/8))throw new RangeError("Invalid argument");let t=0;for(let r=this.size-1;r>=1;r-=2){r===6&&(r=5);for(let i=0;i<this.size;i++)for(let s=0;s<2;s++){const o=r-s,c=(r+1&2)===0?this.size-1-i:i;!this.types[c][o]&&t<e.length*8&&(this.modules[c][o]=C0(e[t>>>3],7-(t&7)),t++)}}}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let r=0;r<this.size;r++){let i;switch(e){case 0:i=(r+t)%2===0;break;case 1:i=t%2===0;break;case 2:i=r%3===0;break;case 3:i=(r+t)%3===0;break;case 4:i=(Math.floor(r/3)+Math.floor(t/2))%2===0;break;case 5:i=r*t%2+r*t%3===0;break;case 6:i=(r*t%2+r*t%3)%2===0;break;case 7:i=((r+t)%2+r*t%3)%2===0;break;default:throw new Error("Unreachable")}!this.types[t][r]&&i&&(this.modules[t][r]=!this.modules[t][r])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[s][l]===o?(a++,a===5?e+=c$:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*HR),o=this.modules[s][l],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*HR}for(let s=0;s<this.size;s++){let o=!1,a=0;const c=[0,0,0,0,0,0,0];for(let l=0;l<this.size;l++)this.modules[l][s]===o?(a++,a===5?e+=c$:a>5&&e++):(this.finderPenaltyAddHistory(a,c),o||(e+=this.finderPenaltyCountPatterns(c)*HR),o=this.modules[l][s],a=1);e+=this.finderPenaltyTerminateAndCount(o,a,c)*HR}for(let s=0;s<this.size-1;s++)for(let o=0;o<this.size-1;o++){const a=this.modules[s][o];a===this.modules[s][o+1]&&a===this.modules[s+1][o]&&a===this.modules[s+1][o+1]&&(e+=J2e)}let t=0;for(const s of this.modules)t=s.reduce((o,a)=>o+(a?1:0),t);const r=this.size*this.size,i=Math.ceil(Math.abs(t*20-r*10)/r)-1;return e+=i*Q2e,e}getAlignmentPatternPositions(){if(this.version===1)return[];{const e=Math.floor(this.version/7)+2,t=this.version===32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,r=[6];for(let i=this.size-7;r.length<e;i-=t)r.splice(1,0,i);return r}}finderPenaltyCountPatterns(e){const t=e[1],r=t>0&&e[2]===t&&e[3]===t*3&&e[4]===t&&e[5]===t;return(r&&e[0]>=t*4&&e[6]>=t?1:0)+(r&&e[6]>=t*4&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,r){return e&&(this.finderPenaltyAddHistory(t,r),t=0),t+=this.size,this.finderPenaltyAddHistory(t,r),this.finderPenaltyCountPatterns(r)}finderPenaltyAddHistory(e,t){t[0]===0&&(e+=this.size),t.pop(),t.unshift(e)}}function B0(n,e,t){if(e<0||e>31||n>>>e)throw new RangeError("Value out of range");for(let r=e-1;r>=0;r--)t.push(n>>>r&1)}function C0(n,e){return(n>>>e&1)!==0}class EU{constructor(e,t,r){if(this.mode=e,this.numChars=t,this.bitData=r,t<0)throw new RangeError("Invalid argument");this.bitData=r.slice()}getData(){return this.bitData.slice()}}const tDe=[1,10,12,14],nDe=[2,9,11,13],rDe=[4,8,16,16];function KQ(n,e){return n[Math.floor((e+7)/17)+1]}function XQ(n){const e=[];for(const t of n)B0(t,8,e);return new EU(rDe,n.length,e)}function iDe(n){if(!ZQ(n))throw new RangeError("String contains non-numeric characters");const e=[];for(let t=0;t<n.length;){const r=Math.min(n.length-t,3);B0(Number.parseInt(n.substring(t,t+r),10),r*3+1,e),t+=r}return new EU(tDe,n.length,e)}function sDe(n){if(!JQ(n))throw new RangeError("String contains unencodable characters in alphanumeric mode");const e=[];let t;for(t=0;t+2<=n.length;t+=2){let r=_2.indexOf(n.charAt(t))*45;r+=_2.indexOf(n.charAt(t+1)),B0(r,11,e)}return t<n.length&&B0(_2.indexOf(n.charAt(t)),6,e),new EU(nDe,n.length,e)}function oDe(n){return n===""?[]:ZQ(n)?[iDe(n)]:JQ(n)?[sDe(n)]:[XQ(cDe(n))]}function ZQ(n){return X2e.test(n)}function JQ(n){return Z2e.test(n)}function aDe(n,e){let t=0;for(const r of n){const i=KQ(r.mode,e);if(r.numChars>=1<<i)return Number.POSITIVE_INFINITY;t+=4+i+r.bitData.length}return t}function cDe(n){n=encodeURI(n);const e=[];for(let t=0;t<n.length;t++)n.charAt(t)!=="%"?e.push(n.charCodeAt(t)):(e.push(Number.parseInt(n.substring(t+1,t+3),16)),t+=2);return e}function m4(n){if(n<bU||n>SU)throw new RangeError("Version number out of range");let e=(16*n+128)*n+64;if(n>=2){const t=Math.floor(n/7)+2;e-=(25*t-10)*t-55,n>=7&&(e-=36)}return e}function Kk(n,e){return Math.floor(m4(n)/8)-qQ[e[0]][n]*YQ[e[0]][n]}function lDe(n){if(n<1||n>255)throw new RangeError("Degree out of range");const e=[];for(let r=0;r<n-1;r++)e.push(0);e.push(1);let t=1;for(let r=0;r<n;r++){for(let i=0;i<e.length;i++)e[i]=g4(e[i],t),i+1<e.length&&(e[i]^=e[i+1]);t=g4(t,2)}return e}function uDe(n,e){const t=e.map(r=>0);for(const r of n){const i=r^t.shift();t.push(0),e.forEach((s,o)=>t[o]^=g4(s,i))}return t}function g4(n,e){if(n>>>8||e>>>8)throw new RangeError("Byte out of range");let t=0;for(let r=7;r>=0;r--)t=t<<1^(t>>>7)*285,t^=(e>>>r&1)*n;return t}function hDe(n,e,t=1,r=40,i=-1,s=!0){if(!(bU<=t&&t<=r&&r<=SU)||i<-1||i>7)throw new RangeError("Invalid value");let o,a;for(o=t;;o++){const h=Kk(o,e)*8,f=aDe(n,o);if(f<=h){a=f;break}if(o>=r)throw new RangeError("Data too long")}for(const h of[HQ,GQ,WQ])s&&a<=Kk(o,h)*8&&(e=h);const c=[];for(const h of n){B0(h.mode[0],4,c),B0(h.numChars,KQ(h.mode,o),c);for(const f of h.getData())c.push(f)}const l=Kk(o,e)*8;B0(0,Math.min(4,l-c.length),c),B0(0,(8-c.length%8)%8,c);for(let h=236;c.length<l;h^=253)B0(h,8,c);const u=Array.from({length:Math.ceil(c.length/8)},()=>0);return c.forEach((h,f)=>u[f>>>3]|=h<<7-(f&7)),new eDe(o,e,u,i)}function fDe(n,e){const{ecc:t="L",boostEcc:r=!1,minVersion:i=1,maxVersion:s=40,maskPattern:o=-1,border:a=1}=e||{},c=typeof n=="string"?oDe(n):Array.isArray(n)?[XQ(n)]:void 0;if(!c)throw new Error(`uqr only supports encoding string and binary data, but got: ${typeof n}`);const l=hDe(c,K2e[t],i,s,o,r),u=dDe({version:l.version,maskPattern:l.mask,size:l.size,data:l.modules,types:l.types},a);return e?.invert&&(u.data=u.data.map(h=>h.map(f=>!f))),e?.onEncoded?.(u),u}function dDe(n,e=1){if(!e)return n;const{size:t}=n,r=t+e*2;n.size=r,n.data.forEach(s=>{for(let o=0;o<e;o++)s.unshift(!1),s.push(!1)});for(let s=0;s<e;s++)n.data.unshift(Array.from({length:r},o=>!1)),n.data.push(Array.from({length:r},o=>!1));const i=yb.Border;n.types.forEach(s=>{for(let o=0;o<e;o++)s.unshift(i),s.push(i)});for(let s=0;s<e;s++)n.types.unshift(Array.from({length:r},o=>i)),n.types.push(Array.from({length:r},o=>i));return n}function pDe(n,e,t,r=!1){return e<0||t<0||e>=n.length||t>=n.length?r:n[t][e]}function mDe(n,e={}){const t={WHITE_ALL:"",WHITE_BLACK:"",BLACK_WHITE:"",BLACK_ALL:" "},r=fDe(n,e),i=!1,s=!0,o=(l,u)=>pDe(r.data,l,u,!0),a=[];let c="";for(let l=0;l<r.size;l+=2){for(let u=0;u<r.size;u++)o(u,l)===i&&o(u,l+1)===i?c+=t.WHITE_ALL:o(u,l)===i&&o(u,l+1)===s?c+=t.WHITE_BLACK:o(u,l)===s&&o(u,l+1)===i?c+=t.BLACK_WHITE:c+=t.BLACK_ALL;a.push(c),c=""}return a.join(`
`)}function gDe(n){const e=[],t=mDe(n).split(`
`),r={32:32,9600:223,9604:220,9608:219};for(let i=0;i<t.length;i++){const s=[...t[i]].map(o=>`$${r[o.charCodeAt(0)]}`).join("");e.push(s)}return e}const s1="$dkpurple",_De="$196",vDe="$205";function zr(n,e,t){fs(n,e,t)}function QQ(n,e,t){const r=_De.repeat(t);zr(n,e,`${s1}${r}`)}function xU(n,e,t){const r=vDe.repeat(t);zr(n,e,`${s1}${r}`)}function Hv(n,e,t){QQ(n,e,t.length+2),zr(n,e,`${s1} $white${t} `),xU(n,e,t.length+2)}function mb(n,e,t){zr(n,e,`${s1} ${" ".repeat(t.length)} `),zr(n,e,`${s1} $gray${t} `),xU(n,e,t.length+2)}function dh(n,e,t,r){zr(n,e,`${s1} $white${t} $blue${r}`)}function no(n,e,t){zr(n,e,`${s1}$blue${t}`)}function _4(n,e,t,r){zr(n,e,`!${t};${r}`)}function yDe(n,e,t){const r=gDe(t);for(let i=0;i<r.length;i++)zr(n,e,r[i])}function v4(n,e,t,r,i=!0){i&&(yDe(n,e,t),setTimeout(()=>p6(n,e),200)),zr(n,e,`!copyit ${t};${r}`)}function bDe(n,e,t,r){zr(n,e,`!openit ${t};${r}`)}const Xk={},gE={};function SDe(){return{id:Yo(),board:"",layers:[],scroll:[],sidebar:[],exiteast:"",exitwest:"",exitnorth:"",exitsouth:""}}const EDe=new Set(["rn","range","sl","select","nm","number","tx","text","zssedit","charedit","coloredit","bgedit"]),xDe=new Set(["tx","text"]),TDe={rn:1,range:1,sl:0,select:0,nm:0,number:0,tx:"",text:"",zssedit:"",charedit:"",coloredit:""},l$={};let wDe=n=>{let e=l$[n];return he(e)||(l$[n]=e=SDe()),e};function v2(n){return wDe(n)}function TU(n){return he(Xk[n])||(Xk[n]=[]),Xk[n]}function ADe(n,e,t){Object.values(gE).forEach(r=>{if(r[e]!==void 0){const i=Jv(n.id(),e);rn(t)&&gu(i,t),un(t)&&tke(i,t)}})}function CDe(n){const e=TU(n);return Xk[n]=[],e}function u$(n){const e=[];let t;for(let r=0;r<n.length;++r){const i=n[r],s=un(i)&&he(OU(i));he(t)&&t!==s&&e.push(" "),e.push(i),t=s}return e}function RDe(n,e){TU(n).push(e)}function kDe(n,e,t,r,i=()=>0,s=M5){switch(cr(ro(r[0]))){case"copyit":case"openit":case"viewit":case"runit":r.unshift("istargetless");break}const a=[e,t,...r],c=cr(`${a[3]}`),l={...fe};function u(h,f){he(f)&&f!==i(h)&&(fe.board=l.board,fe.element=l.element,fe.elementfocus=l.elementfocus,s(h,f))}if(EDe.has(c)){const h=`${a[2]}`;gE[e]=gE[e]??{};const f=i(h)??TDe[c];if(gE[e][h]===void 0){const d=Jv(e,h);xDe.has(c)?(un(f)&&zQ(d,f),gE[e][h]=rke(d,p=>{u(h,p)})):(rn(f)&&eke(d,f),gE[e][h]=nke(d,p=>{u(h,p)}))}}TU(n).push(a)}const h$=Object.assign({"./editor/codepagename.txt":ske,"./editor/command/admin.txt":ake,"./editor/command/array.txt":lke,"./editor/command/autofilter.txt":hke,"./editor/command/autofilter1.txt":dke,"./editor/command/autofilter2.txt":mke,"./editor/command/autofilter3.txt":_ke,"./editor/command/autowah.txt":yke,"./editor/command/autowah1.txt":Ske,"./editor/command/autowah2.txt":xke,"./editor/command/autowah3.txt":wke,"./editor/command/bbs.txt":Cke,"./editor/command/become.txt":kke,"./editor/command/bgplay.txt":Ike,"./editor/command/bgplayon16n.txt":Nke,"./editor/command/bgplayon1n.txt":Dke,"./editor/command/bgplayon2n.txt":Uke,"./editor/command/bgplayon32n.txt":Fke,"./editor/command/bgplayon4n.txt":zke,"./editor/command/bgplayon64n.txt":Vke,"./editor/command/bgplayon8n.txt":Gke,"./editor/command/bgvol.txt":qke,"./editor/command/bind.txt":Kke,"./editor/command/board.txt":Zke,"./editor/command/boardopen.txt":Qke,"./editor/command/boards.txt":tMe,"./editor/command/bookallexport.txt":rMe,"./editor/command/bookexport.txt":sMe,"./editor/command/bookrename.txt":aMe,"./editor/command/books.txt":lMe,"./editor/command/booktrash.txt":hMe,"./editor/command/bpm.txt":dMe,"./editor/command/break.txt":mMe,"./editor/command/broadcast.txt":_Me,"./editor/command/build.txt":yMe,"./editor/command/change.txt":SMe,"./editor/command/char.txt":xMe,"./editor/command/charset.txt":wMe,"./editor/command/chat.txt":CMe,"./editor/command/clear.txt":kMe,"./editor/command/color.txt":IMe,"./editor/command/continue.txt":NMe,"./editor/command/copy.txt":DMe,"./editor/command/cycle.txt":UMe,"./editor/command/dev.txt":FMe,"./editor/command/die.txt":zMe,"./editor/command/distort.txt":VMe,"./editor/command/distort1.txt":GMe,"./editor/command/distort2.txt":qMe,"./editor/command/distort3.txt":KMe,"./editor/command/do.txt":ZMe,"./editor/command/done.txt":QMe,"./editor/command/dupe.txt":tIe,"./editor/command/dupewith.txt":rIe,"./editor/command/duplicate.txt":sIe,"./editor/command/duplicatewith.txt":aIe,"./editor/command/echo.txt":lIe,"./editor/command/echo1.txt":hIe,"./editor/command/echo2.txt":dIe,"./editor/command/echo3.txt":mIe,"./editor/command/else.txt":_Ie,"./editor/command/elseif.txt":yIe,"./editor/command/end.txt":SIe,"./editor/command/endgame.txt":xIe,"./editor/command/endwith.txt":wIe,"./editor/command/export.txt":CIe,"./editor/command/fcrush.txt":kIe,"./editor/command/fcrush1.txt":IIe,"./editor/command/fcrush2.txt":NIe,"./editor/command/fcrush3.txt":DIe,"./editor/command/fetch.txt":UIe,"./editor/command/fetchwith.txt":FIe,"./editor/command/findany.txt":zIe,"./editor/command/foreach.txt":VIe,"./editor/command/fork.txt":GIe,"./editor/command/gadget.txt":qIe,"./editor/command/go.txt":KIe,"./editor/command/goto.txt":ZIe,"./editor/command/help.txt":QIe,"./editor/command/hyperlink.txt":tOe,"./editor/command/idle.txt":rOe,"./editor/command/if.txt":sOe,"./editor/command/itchiopublish.txt":aOe,"./editor/command/joincode.txt":lOe,"./editor/command/jointab.txt":hOe,"./editor/command/load.txt":dOe,"./editor/command/lock.txt":mOe,"./editor/command/nuke.txt":_Oe,"./editor/command/oneof.txt":yOe,"./editor/command/oneofwith.txt":SOe,"./editor/command/pageexport.txt":xOe,"./editor/command/pageopen.txt":wOe,"./editor/command/pages.txt":COe,"./editor/command/pagetrash.txt":kOe,"./editor/command/palette.txt":IOe,"./editor/command/pivot.txt":NOe,"./editor/command/play.txt":DOe,"./editor/command/push.txt":UOe,"./editor/command/put.txt":FOe,"./editor/command/putwith.txt":zOe,"./editor/command/read.txt":VOe,"./editor/command/readbin.txt":GOe,"./editor/command/readjson.txt":qOe,"./editor/command/readline.txt":KOe,"./editor/command/readrexpaint.txt":ZOe,"./editor/command/remix.txt":QOe,"./editor/command/repeat.txt":t3e,"./editor/command/restart.txt":r3e,"./editor/command/restore.txt":s3e,"./editor/command/reverb.txt":a3e,"./editor/command/reverb1.txt":l3e,"./editor/command/reverb2.txt":h3e,"./editor/command/reverb3.txt":d3e,"./editor/command/revert.txt":m3e,"./editor/command/run.txt":_3e,"./editor/command/runwith.txt":y3e,"./editor/command/save.txt":S3e,"./editor/command/send.txt":x3e,"./editor/command/set.txt":w3e,"./editor/command/share.txt":C3e,"./editor/command/shoot.txt":k3e,"./editor/command/shootwith.txt":I3e,"./editor/command/shortsend.txt":N3e,"./editor/command/shove.txt":D3e,"./editor/command/snapshot.txt":U3e,"./editor/command/stat.txt":F3e,"./editor/command/synth.txt":z3e,"./editor/command/synth1.txt":V3e,"./editor/command/synth2.txt":G3e,"./editor/command/synth3.txt":q3e,"./editor/command/synth4.txt":K3e,"./editor/command/synth5.txt":Z3e,"./editor/command/synthflush.txt":Q3e,"./editor/command/synthrecord.txt":tNe,"./editor/command/text.txt":rNe,"./editor/command/throwstar.txt":sNe,"./editor/command/throwstarwith.txt":aNe,"./editor/command/ticker.txt":lNe,"./editor/command/toast.txt":hNe,"./editor/command/transport.txt":dNe,"./editor/command/trash.txt":mNe,"./editor/command/tts.txt":_Ne,"./editor/command/ttsengine.txt":yNe,"./editor/command/ttsqueue.txt":SNe,"./editor/command/ttsvol.txt":xNe,"./editor/command/twitchbroadcast.txt":wNe,"./editor/command/twitchchat.txt":CNe,"./editor/command/unlock.txt":kNe,"./editor/command/userinput.txt":INe,"./editor/command/vibrato.txt":NNe,"./editor/command/vibrato1.txt":DNe,"./editor/command/vibrato2.txt":UNe,"./editor/command/vibrato3.txt":FNe,"./editor/command/vol.txt":zNe,"./editor/command/waitfor.txt":VNe,"./editor/command/walk.txt":GNe,"./editor/command/weave.txt":qNe,"./editor/command/while.txt":KNe,"./editor/command/withboard.txt":ZNe,"./editor/command/withobject.txt":QNe,"./editor/command/write.txt":tPe,"./editor/command/zap.txt":rPe,"./editor/command/zztrandom.txt":sPe,"./editor/command/zztsearch.txt":aPe,"./editor/comment.txt":lPe,"./editor/hyperlink.txt":hPe,"./editor/hyperlink/hotkey.txt":dPe,"./editor/hyperlink/number.txt":mPe,"./editor/hyperlink/range.txt":_Pe,"./editor/hyperlink/select.txt":yPe,"./editor/hyperlink/text.txt":SPe,"./editor/label.txt":xPe,"./editor/shortgo.txt":wPe,"./editor/shorttry.txt":CPe,"./editor/stat/board.txt":kPe,"./editor/stat/charset.txt":IPe,"./editor/stat/const.txt":NPe,"./editor/stat/hotkey.txt":DPe,"./editor/stat/loader.txt":UPe,"./editor/stat/number.txt":FPe,"./editor/stat/object.txt":zPe,"./editor/stat/palette.txt":VPe,"./editor/stat/range.txt":GPe,"./editor/stat/select.txt":qPe,"./editor/stat/terrain.txt":KPe,"./editor/stat/text.txt":ZPe,"./editor/text.txt":QPe,"./help/nopages.txt":t2e,"./refscroll/algoscroll.txt":r2e,"./refscroll/autofilterscroll.txt":s2e,"./refscroll/autowahscroll.txt":a2e,"./refscroll/cliscroll.txt":l2e,"./refscroll/distortscroll.txt":h2e,"./refscroll/echoscroll.txt":d2e,"./refscroll/effectsscroll.txt":m2e,"./refscroll/fcrushscroll.txt":_2e,"./refscroll/helpcontrols.txt":y2e,"./refscroll/helpdeveloper.txt":S2e,"./refscroll/helpmenu.txt":x2e,"./refscroll/helpplayer.txt":w2e,"./refscroll/helptext.txt":C2e,"./refscroll/menu.txt":k2e,"./refscroll/notesscroll.txt":I2e,"./refscroll/oscscroll.txt":N2e,"./refscroll/pulsescroll.txt":D2e,"./refscroll/pwmscroll.txt":U2e,"./refscroll/reverbscroll.txt":F2e,"./refscroll/synthscroll.txt":z2e,"./refscroll/vibratoscroll.txt":V2e,"./refscroll/voicescroll.txt":G2e}),eee={};Zm(h$).forEach(n=>{const e=n.replace(".txt","").replace("./","").replaceAll("/",":");eee[e]=h$[n].default});function tee(n){const e=cr(n.trim().replaceAll(`
`,"").replace(/:+$/,"")),t=eee[e];if(he(t))return t;const{target:r,path:i}=Vv(e);switch(r){case"editor":{const s=Vv(i);switch(s.target){case"command":if(s.path.length)return`desc;$DKGRAYsends the message ${s.path}`}break}}}function nee(n,e){const t=(n??"").split(`
`);for(let r=0;r<t.length;++r)e(t[r].split(";"))}function MDe(n,e){const[t,...r]=e,i=r[0]??"",s=r[1]??"";switch(cr(t.trim())){case"header":Hv(qe,n,i);break;case"section":mb(qe,n,i);break;case"option":dh(qe,n,i,s);break;default:t.trimStart().startsWith("!")?_4(qe,n,t.trimStart().slice(1),i):zr(qe,n,t);break}}function IDe(n){const e={};return nee(n,t=>{const[r,...i]=t,s=i[0]??"";e[r]=s}),e}function GR(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var y2={exports:{}},f$;function ODe(){return f$||(f$=1,(function(n,e){(function(t){n.exports=t()})(function(){return(function t(r,i,s){function o(l,u){if(!i[l]){if(!r[l]){var h=typeof GR=="function"&&GR;if(!u&&h)return h(l,!0);if(a)return a(l,!0);var f=new Error("Cannot find module '"+l+"'");throw f.code="MODULE_NOT_FOUND",f}var d=i[l]={exports:{}};r[l][0].call(d.exports,function(p){var m=r[l][1][p];return o(m||p)},d,d.exports,t,r,i,s)}return i[l].exports}for(var a=typeof GR=="function"&&GR,c=0;c<s.length;c++)o(s[c]);return o})({1:[function(t,r,i){var s=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var l,u,h,f,d,p,m,_=[],v=0,S=c.length,b=S,T=s.getTypeOf(c)!=="string";v<c.length;)b=S-v,h=T?(l=c[v++],u=v<S?c[v++]:0,v<S?c[v++]:0):(l=c.charCodeAt(v++),u=v<S?c.charCodeAt(v++):0,v<S?c.charCodeAt(v++):0),f=l>>2,d=(3&l)<<4|u>>4,p=1<b?(15&u)<<2|h>>6:64,m=2<b?63&h:64,_.push(a.charAt(f)+a.charAt(d)+a.charAt(p)+a.charAt(m));return _.join("")},i.decode=function(c){var l,u,h,f,d,p,m=0,_=0,v="data:";if(c.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var S,b=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&b--,c.charAt(c.length-2)===a.charAt(64)&&b--,b%1!=0)throw new Error("Invalid base64 input, bad content length.");for(S=o.uint8array?new Uint8Array(0|b):new Array(0|b);m<c.length;)l=a.indexOf(c.charAt(m++))<<2|(f=a.indexOf(c.charAt(m++)))>>4,u=(15&f)<<4|(d=a.indexOf(c.charAt(m++)))>>2,h=(3&d)<<6|(p=a.indexOf(c.charAt(m++))),S[_++]=l,d!==64&&(S[_++]=u),p!==64&&(S[_++]=h);return S}},{"./support":30,"./utils":32}],2:[function(t,r,i){var s=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),c=t("./stream/DataLengthProbe");function l(u,h,f,d,p){this.compressedSize=u,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=p}l.prototype={getContentWorker:function(){var u=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,h,f){return u.pipe(new a).pipe(new c("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,r,i){var s=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,r,i){var s=t("./utils"),o=(function(){for(var a,c=[],l=0;l<256;l++){a=l;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;c[l]=a}return c})();r.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?(function(l,u,h,f){var d=o,p=f+h;l^=-1;for(var m=f;m<p;m++)l=l>>>8^d[255&(l^u[m])];return-1^l})(0|c,a,a.length,0):(function(l,u,h,f){var d=o,p=f+h;l^=-1;for(var m=f;m<p;m++)l=l>>>8^d[255&(l^u.charCodeAt(m))];return-1^l})(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(t,r,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,r,i){var s=null;s=typeof Promise<"u"?Promise:t("lie"),r.exports={Promise:s}},{lie:37}],7:[function(t,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),a=t("./utils"),c=t("./stream/GenericWorker"),l=s?"uint8array":"array";function u(h,f){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}i.magic="\b\0",a.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(l,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},i.compressWorker=function(h){return new u("Deflate",h)},i.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,r,i){function s(d,p){var m,_="";for(m=0;m<p;m++)_+=String.fromCharCode(255&d),d>>>=8;return _}function o(d,p,m,_,v,S){var b,T,w=d.file,R=d.compression,C=S!==l.utf8encode,N=a.transformTo("string",S(w.name)),U=a.transformTo("string",l.utf8encode(w.name)),B=w.comment,$=a.transformTo("string",S(B)),I=a.transformTo("string",l.utf8encode(B)),L=U.length!==w.name.length,P=I.length!==B.length,H="",X="",G="",Y=w.dir,J=w.date,Q={crc32:0,compressedSize:0,uncompressedSize:0};p&&!m||(Q.crc32=d.crc32,Q.compressedSize=d.compressedSize,Q.uncompressedSize=d.uncompressedSize);var z=0;p&&(z|=8),C||!L&&!P||(z|=2048);var q=0,ee=0;Y&&(q|=16),v==="UNIX"?(ee=798,q|=(function(ie,Ee){var Re=ie;return ie||(Re=Ee?16893:33204),(65535&Re)<<16})(w.unixPermissions,Y)):(ee=20,q|=(function(ie){return 63&(ie||0)})(w.dosPermissions)),b=J.getUTCHours(),b<<=6,b|=J.getUTCMinutes(),b<<=5,b|=J.getUTCSeconds()/2,T=J.getUTCFullYear()-1980,T<<=4,T|=J.getUTCMonth()+1,T<<=5,T|=J.getUTCDate(),L&&(X=s(1,1)+s(u(N),4)+U,H+="up"+s(X.length,2)+X),P&&(G=s(1,1)+s(u($),4)+I,H+="uc"+s(G.length,2)+G);var te="";return te+=`
\0`,te+=s(z,2),te+=R.magic,te+=s(b,2),te+=s(T,2),te+=s(Q.crc32,4),te+=s(Q.compressedSize,4),te+=s(Q.uncompressedSize,4),te+=s(N.length,2),te+=s(H.length,2),{fileRecord:h.LOCAL_FILE_HEADER+te+N+H,dirRecord:h.CENTRAL_FILE_HEADER+s(ee,2)+te+s($.length,2)+"\0\0\0\0"+s(q,4)+s(_,4)+N+H+$}}var a=t("../utils"),c=t("../stream/GenericWorker"),l=t("../utf8"),u=t("../crc32"),h=t("../signature");function f(d,p,m,_){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=m,this.encodeFileName=_,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,c),f.prototype.push=function(d){var p=d.meta.percent||0,m=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(p+100*(m-_-1))/m:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var p=this.streamFiles&&!d.file.dir;if(p){var m=o(d,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var p=this.streamFiles&&!d.file.dir,m=o(d,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),p)this.push({data:(function(_){return h.DATA_DESCRIPTOR+s(_.crc32,4)+s(_.compressedSize,4)+s(_.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var m=this.bytesWritten-d,_=(function(v,S,b,T,w){var R=a.transformTo("string",w(T));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(v,2)+s(v,2)+s(S,4)+s(b,4)+s(R.length,2)+R})(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var p=this;return d.on("data",function(m){p.processChunk(m)}),d.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),d.on("error",function(m){p.error(m)}),this},f.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var p=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var m=0;m<p.length;m++)try{p[m].error(d)}catch{}return!0},f.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,p=0;p<d.length;p++)d[p].lock()},r.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,r,i){var s=t("../compressions"),o=t("./ZipFileWorker");i.generateWorker=function(a,c,l){var u=new o(c.streamFiles,l,c.platform,c.encodeFileName),h=0;try{a.forEach(function(f,d){h++;var p=(function(S,b){var T=S||b,w=s[T];if(!w)throw new Error(T+" is not a valid compression method !");return w})(d.options.compression,c.compression),m=d.options.compressionOptions||c.compressionOptions||{},_=d.dir,v=d.date;d._compressWorker(p,m).withStreamInfo("file",{name:f,dir:_,date:v,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r,i){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.1",s.loadAsync=function(o,a){return new s().loadAsync(o,a)},s.external=t("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,r,i){var s=t("./utils"),o=t("./external"),a=t("./utf8"),c=t("./zipEntries"),l=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function h(f){return new o.Promise(function(d,p){var m=f.decompressed.getContentWorker().pipe(new l);m.on("error",function(_){p(_)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}r.exports=function(f,d){var p=this;return d=s.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(m){var _=new c(d);return _.load(m),_}).then(function(m){var _=[o.Promise.resolve(m)],v=m.files;if(d.checkCRC32)for(var S=0;S<v.length;S++)_.push(h(v[S]));return o.Promise.all(_)}).then(function(m){for(var _=m.shift(),v=_.files,S=0;S<v.length;S++){var b=v[S],T=b.fileNameStr,w=s.resolve(b.fileNameStr);p.file(w,b.decompressed,{binary:!0,optimizedBinaryString:!0,date:b.date,dir:b.dir,comment:b.fileCommentStr.length?b.fileCommentStr:null,unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions,createFolders:d.createFolders}),b.dir||(p.file(w).unsafeOriginalName=T)}return _.zipComment.length&&(p.comment=_.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,r,i){var s=t("../utils"),o=t("../stream/GenericWorker");function a(c,l){o.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}s.inherits(a,o),a.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,r,i){var s=t("readable-stream").Readable;function o(a,c,l){s.call(this,c),this._helper=a;var u=this;a.on("data",function(h,f){u.push(h)||u._helper.pause(),l&&l(f)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}t("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},r.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,r,i){r.exports={isNode:typeof io<"u",newBufferFrom:function(s,o){if(io.from&&io.from!==Uint8Array.from)return io.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new io(s,o)},allocBuffer:function(s){if(io.alloc)return io.alloc(s);var o=new io(s);return o.fill(0),o},isBuffer:function(s){return io.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(t,r,i){function s(w,R,C){var N,U=a.getTypeOf(R),B=a.extend(C||{},u);B.date=B.date||new Date,B.compression!==null&&(B.compression=B.compression.toUpperCase()),typeof B.unixPermissions=="string"&&(B.unixPermissions=parseInt(B.unixPermissions,8)),B.unixPermissions&&16384&B.unixPermissions&&(B.dir=!0),B.dosPermissions&&16&B.dosPermissions&&(B.dir=!0),B.dir&&(w=v(w)),B.createFolders&&(N=_(w))&&S.call(this,N,!0);var $=U==="string"&&B.binary===!1&&B.base64===!1;C&&C.binary!==void 0||(B.binary=!$),(R instanceof h&&R.uncompressedSize===0||B.dir||!R||R.length===0)&&(B.base64=!1,B.binary=!0,R="",B.compression="STORE",U="string");var I=null;I=R instanceof h||R instanceof c?R:p.isNode&&p.isStream(R)?new m(w,R):a.prepareContent(w,R,B.binary,B.optimizedBinaryString,B.base64);var L=new f(w,I,B);this.files[w]=L}var o=t("./utf8"),a=t("./utils"),c=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),u=t("./defaults"),h=t("./compressedObject"),f=t("./zipObject"),d=t("./generate"),p=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),_=function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var R=w.lastIndexOf("/");return 0<R?w.substring(0,R):""},v=function(w){return w.slice(-1)!=="/"&&(w+="/"),w},S=function(w,R){return R=R!==void 0?R:u.createFolders,w=v(w),this.files[w]||s.call(this,w,null,{dir:!0,createFolders:R}),this.files[w]};function b(w){return Object.prototype.toString.call(w)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var R,C,N;for(R in this.files)N=this.files[R],(C=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&w(C,N)},filter:function(w){var R=[];return this.forEach(function(C,N){w(C,N)&&R.push(N)}),R},file:function(w,R,C){if(arguments.length!==1)return w=this.root+w,s.call(this,w,R,C),this;if(b(w)){var N=w;return this.filter(function(B,$){return!$.dir&&N.test(B)})}var U=this.files[this.root+w];return U&&!U.dir?U:null},folder:function(w){if(!w)return this;if(b(w))return this.filter(function(U,B){return B.dir&&w.test(U)});var R=this.root+w,C=S.call(this,R),N=this.clone();return N.root=C.name,N},remove:function(w){w=this.root+w;var R=this.files[w];if(R||(w.slice(-1)!=="/"&&(w+="/"),R=this.files[w]),R&&!R.dir)delete this.files[w];else for(var C=this.filter(function(U,B){return B.name.slice(0,w.length)===w}),N=0;N<C.length;N++)delete this.files[C[N].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var R,C={};try{if((C=a.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var N=C.comment||this.comment||"";R=d.generateWorker(this,C,N)}catch(U){(R=new c("error")).error(U)}return new l(R,C.type||"string",C.mimeType)},generateAsync:function(w,R){return this.generateInternalStream(w).accumulate(R)},generateNodeStream:function(w,R){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(R)}};r.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,r,i){r.exports=t("stream")},{stream:void 0}],17:[function(t,r,i){var s=t("./DataReader");function o(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}t("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===c&&this.data[f+1]===l&&this.data[f+2]===u&&this.data[f+3]===h)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),l=a.charCodeAt(1),u=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return c===f[0]&&l===f[1]&&u===f[2]&&h===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,r,i){var s=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,l=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=a,l},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},r.exports=o},{"../utils":32}],19:[function(t,r,i){var s=t("./Uint8ArrayReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,r,i){var s=t("./DataReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,r,i){var s=t("./ArrayReader");function o(a){s.call(this,a)}t("../utils").inherits(o,s),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},r.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,r,i){var s=t("../utils"),o=t("../support"),a=t("./ArrayReader"),c=t("./StringReader"),l=t("./NodeBufferReader"),u=t("./Uint8ArrayReader");r.exports=function(h){var f=s.getTypeOf(h);return s.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new l(h):o.uint8array?new u(s.transformTo("uint8array",h)):new a(s.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,r,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,r,i){var s=t("./GenericWorker"),o=t("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}o.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:o.transformTo(this.destType,c.data),meta:c.meta})},r.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,r,i){var s=t("./GenericWorker"),o=t("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=o(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,r,i){var s=t("../utils"),o=t("./GenericWorker");function a(c){o.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,o),a.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}o.prototype.processChunk.call(this,c)},r.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,r,i){var s=t("../utils"),o=t("./GenericWorker");function a(c){o.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=s.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}s.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,r,i){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var c=0;c<this._listeners[o].length;c++)this._listeners[o][c].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(c){a.processChunk(c)}),o.on("end",function(){a.end()}),o.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},r.exports=s},{}],29:[function(t,r,i){var s=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),c=t("../base64"),l=t("../support"),u=t("../external"),h=null;if(l.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(p,m){return new u.Promise(function(_,v){var S=[],b=p._internalType,T=p._outputType,w=p._mimeType;p.on("data",function(R,C){S.push(R),m&&m(C)}).on("error",function(R){S=[],v(R)}).on("end",function(){try{var R=(function(C,N,U){switch(C){case"blob":return s.newBlob(s.transformTo("arraybuffer",N),U);case"base64":return c.encode(N);default:return s.transformTo(C,N)}})(T,(function(C,N){var U,B=0,$=null,I=0;for(U=0;U<N.length;U++)I+=N[U].length;switch(C){case"string":return N.join("");case"array":return Array.prototype.concat.apply([],N);case"uint8array":for($=new Uint8Array(I),U=0;U<N.length;U++)$.set(N[U],B),B+=N[U].length;return $;case"nodebuffer":return io.concat(N);default:throw new Error("concat : unsupported type '"+C+"'")}})(b,S),w);_(R)}catch(C){v(C)}S=[]}).resume()})}function d(p,m,_){var v=m;switch(m){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=m,this._mimeType=_,s.checkSupport(v),this._worker=p.pipe(new o(v)),p.lock()}catch(S){this._worker=new a("error"),this._worker.error(S)}}d.prototype={accumulate:function(p){return f(this,p)},on:function(p,m){var _=this;return p==="data"?this._worker.on(p,function(v){m.call(_,v.data,v.meta)}):this._worker.on(p,function(){s.delay(m,arguments,_)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},p)}},r.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,r,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof io<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,r,i){for(var s=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),c=t("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function f(){c.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):(function(p){var m,_,v,S,b,T=p.length,w=0;for(S=0;S<T;S++)(64512&(_=p.charCodeAt(S)))==55296&&S+1<T&&(64512&(v=p.charCodeAt(S+1)))==56320&&(_=65536+(_-55296<<10)+(v-56320),S++),w+=_<128?1:_<2048?2:_<65536?3:4;for(m=o.uint8array?new Uint8Array(w):new Array(w),S=b=0;b<w;S++)(64512&(_=p.charCodeAt(S)))==55296&&S+1<T&&(64512&(v=p.charCodeAt(S+1)))==56320&&(_=65536+(_-55296<<10)+(v-56320),S++),_<128?m[b++]=_:(_<2048?m[b++]=192|_>>>6:(_<65536?m[b++]=224|_>>>12:(m[b++]=240|_>>>18,m[b++]=128|_>>>12&63),m[b++]=128|_>>>6&63),m[b++]=128|63&_);return m})(d)},i.utf8decode=function(d){return o.nodebuffer?s.transformTo("nodebuffer",d).toString("utf-8"):(function(p){var m,_,v,S,b=p.length,T=new Array(2*b);for(m=_=0;m<b;)if((v=p[m++])<128)T[_++]=v;else if(4<(S=l[v]))T[_++]=65533,m+=S-1;else{for(v&=S===2?31:S===3?15:7;1<S&&m<b;)v=v<<6|63&p[m++],S--;1<S?T[_++]=65533:v<65536?T[_++]=v:(v-=65536,T[_++]=55296|v>>10&1023,T[_++]=56320|1023&v)}return T.length!==_&&(T.subarray?T=T.subarray(0,_):T.length=_),s.applyFromCharCode(T)})(d=s.transformTo(o.uint8array?"uint8array":"array",d))},s.inherits(h,c),h.prototype.processChunk=function(d){var p=s.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=p;(p=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),p.set(m,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var _=(function(S,b){var T;for((b=b||S.length)>S.length&&(b=S.length),T=b-1;0<=T&&(192&S[T])==128;)T--;return T<0||T===0?b:T+l[S[T]]>b?T:b})(p),v=p;_!==p.length&&(o.uint8array?(v=p.subarray(0,_),this.leftOver=p.subarray(_,p.length)):(v=p.slice(0,_),this.leftOver=p.slice(_,p.length))),this.push({data:i.utf8decode(v),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=h,s.inherits(f,c),f.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,r,i){var s=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),c=t("./external");function l(m){return m}function u(m,_){for(var v=0;v<m.length;++v)_[v]=255&m.charCodeAt(v);return _}t("setimmediate"),i.newBlob=function(m,_){i.checkSupport("blob");try{return new Blob([m],{type:_})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(m),v.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,_,v){var S=[],b=0,T=m.length;if(T<=v)return String.fromCharCode.apply(null,m);for(;b<T;)_==="array"||_==="nodebuffer"?S.push(String.fromCharCode.apply(null,m.slice(b,Math.min(b+v,T)))):S.push(String.fromCharCode.apply(null,m.subarray(b,Math.min(b+v,T)))),b+=v;return S.join("")},stringifyByChar:function(m){for(var _="",v=0;v<m.length;v++)_+=String.fromCharCode(m[v]);return _},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function f(m){var _=65536,v=i.getTypeOf(m),S=!0;if(v==="uint8array"?S=h.applyCanBeUsed.uint8array:v==="nodebuffer"&&(S=h.applyCanBeUsed.nodebuffer),S)for(;1<_;)try{return h.stringifyByChunk(m,v,_)}catch{_=Math.floor(_/2)}return h.stringifyByChar(m)}function d(m,_){for(var v=0;v<m.length;v++)_[v]=m[v];return _}i.applyFromCharCode=f;var p={};p.string={string:l,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return p.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},p.array={string:f,array:l,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},p.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:l,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},p.uint8array={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:l,nodebuffer:function(m){return a.newBufferFrom(m)}},p.nodebuffer={string:f,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return p.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:l},i.transformTo=function(m,_){if(_=_||"",!m)return _;i.checkSupport(m);var v=i.getTypeOf(_);return p[v][m](_)},i.resolve=function(m){for(var _=m.split("/"),v=[],S=0;S<_.length;S++){var b=_[S];b==="."||b===""&&S!==0&&S!==_.length-1||(b===".."?v.pop():v.push(b))}return v.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(m)?"nodebuffer":s.uint8array&&m instanceof Uint8Array?"uint8array":s.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!s[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var _,v,S="";for(v=0;v<(m||"").length;v++)S+="\\x"+((_=m.charCodeAt(v))<16?"0":"")+_.toString(16).toUpperCase();return S},i.delay=function(m,_,v){setImmediate(function(){m.apply(v||null,_||[])})},i.inherits=function(m,_){function v(){}v.prototype=_.prototype,m.prototype=new v},i.extend=function(){var m,_,v={};for(m=0;m<arguments.length;m++)for(_ in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],_)&&v[_]===void 0&&(v[_]=arguments[m][_]);return v},i.prepareContent=function(m,_,v,S,b){return c.Promise.resolve(_).then(function(T){return s.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new c.Promise(function(w,R){var C=new FileReader;C.onload=function(N){w(N.target.result)},C.onerror=function(N){R(N.target.error)},C.readAsArrayBuffer(T)}):T}).then(function(T){var w=i.getTypeOf(T);return w?(w==="arraybuffer"?T=i.transformTo("uint8array",T):w==="string"&&(b?T=o.decode(T):v&&S!==!0&&(T=(function(R){return u(R,s.uint8array?new Uint8Array(R.length):new Array(R.length))})(T))),T):c.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,r,i){var s=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),c=t("./zipEntry"),l=t("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var p=this.reader.readString(4)===f;return this.reader.setIndex(d),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=l.uint8array?"uint8array":"array",d=o.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,p=this.zip64EndOfCentralSize-44;0<p;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var p=f-d;if(0<p)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(h){this.reader=s(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,r,i){var s=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),c=t("./crc32"),l=t("./utf8"),u=t("./compressions"),h=t("./support");function f(d,p){this.options=d,this.loadOptions=p}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var p,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=(function(_){for(var v in u)if(Object.prototype.hasOwnProperty.call(u,v)&&u[v].magic===_)return u[v];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var p=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(p),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var p,m,_,v=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<v;)p=d.readInt(2),m=d.readInt(2),_=d.readData(m),this.extraFields[p]={id:p,length:m,value:_};d.setIndex(v)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var v=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileName)!==p.readInt(4)?null:l.utf8decode(p.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var p=s(d.value);return p.readInt(1)!==1||c(this.fileComment)!==p.readInt(4)?null:l.utf8decode(p.readData(d.length-5))}return null}},r.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,r,i){function s(p,m,_){this.name=p,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=m,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),c=t("./utf8"),l=t("./compressedObject"),u=t("./stream/GenericWorker");s.prototype={internalStream:function(p){var m=null,_="string";try{if(!p)throw new Error("No output type specified.");var v=(_=p.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),m=this._decompressWorker();var S=!this._dataBinary;S&&!v&&(m=m.pipe(new c.Utf8EncodeWorker)),!S&&v&&(m=m.pipe(new c.Utf8DecodeWorker))}catch(b){(m=new u("error")).error(b)}return new o(m,_,"")},async:function(p,m){return this.internalStream(p).accumulate(m)},nodeStream:function(p,m){return this.internalStream(p||"nodebuffer").toNodejsStream(m)},_compressWorker:function(p,m){if(this._data instanceof l&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(_,p,m)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)s.prototype[h[d]]=f;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,r,i){(function(s){var o,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var l=0,u=new c(p),h=s.document.createTextNode("");u.observe(h,{characterData:!0}),o=function(){h.data=l=++l%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var m=s.document.createElement("script");m.onreadystatechange=function(){p(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},s.document.documentElement.appendChild(m)}:function(){setTimeout(p,0)};else{var f=new s.MessageChannel;f.port1.onmessage=p,o=function(){f.port2.postMessage(0)}}var d=[];function p(){var m,_;a=!0;for(var v=d.length;v;){for(_=d,d=[],m=-1;++m<v;)_[m]();v=d.length}a=!1}r.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof sd<"u"?sd:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,r,i){var s=t("immediate");function o(){}var a={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function h(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,v!==o&&m(this,v)}function f(v,S,b){this.promise=v,typeof S=="function"&&(this.onFulfilled=S,this.callFulfilled=this.otherCallFulfilled),typeof b=="function"&&(this.onRejected=b,this.callRejected=this.otherCallRejected)}function d(v,S,b){s(function(){var T;try{T=S(b)}catch(w){return a.reject(v,w)}T===v?a.reject(v,new TypeError("Cannot resolve promise with itself")):a.resolve(v,T)})}function p(v){var S=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof S=="function")return function(){S.apply(v,arguments)}}function m(v,S){var b=!1;function T(C){b||(b=!0,a.reject(v,C))}function w(C){b||(b=!0,a.resolve(v,C))}var R=_(function(){S(w,T)});R.status==="error"&&T(R.value)}function _(v,S){var b={};try{b.value=v(S),b.status="success"}catch(T){b.status="error",b.value=T}return b}(r.exports=h).prototype.finally=function(v){if(typeof v!="function")return this;var S=this.constructor;return this.then(function(b){return S.resolve(v()).then(function(){return b})},function(b){return S.resolve(v()).then(function(){throw b})})},h.prototype.catch=function(v){return this.then(null,v)},h.prototype.then=function(v,S){if(typeof v!="function"&&this.state===l||typeof S!="function"&&this.state===c)return this;var b=new this.constructor(o);return this.state!==u?d(b,this.state===l?v:S,this.outcome):this.queue.push(new f(b,v,S)),b},f.prototype.callFulfilled=function(v){a.resolve(this.promise,v)},f.prototype.otherCallFulfilled=function(v){d(this.promise,this.onFulfilled,v)},f.prototype.callRejected=function(v){a.reject(this.promise,v)},f.prototype.otherCallRejected=function(v){d(this.promise,this.onRejected,v)},a.resolve=function(v,S){var b=_(p,S);if(b.status==="error")return a.reject(v,b.value);var T=b.value;if(T)m(v,T);else{v.state=l,v.outcome=S;for(var w=-1,R=v.queue.length;++w<R;)v.queue[w].callFulfilled(S)}return v},a.reject=function(v,S){v.state=c,v.outcome=S;for(var b=-1,T=v.queue.length;++b<T;)v.queue[b].callRejected(S);return v},h.resolve=function(v){return v instanceof this?v:a.resolve(new this(o),v)},h.reject=function(v){var S=new this(o);return a.reject(S,v)},h.all=function(v){var S=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=v.length,T=!1;if(!b)return this.resolve([]);for(var w=new Array(b),R=0,C=-1,N=new this(o);++C<b;)U(v[C],C);return N;function U(B,$){S.resolve(B).then(function(I){w[$]=I,++R!==b||T||(T=!0,a.resolve(N,w))},function(I){T||(T=!0,a.reject(N,I))})}},h.race=function(v){var S=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=v.length,T=!1;if(!b)return this.resolve([]);for(var w=-1,R=new this(o);++w<b;)C=v[w],S.resolve(C).then(function(N){T||(T=!0,a.resolve(R,N))},function(N){T||(T=!0,a.reject(R,N))});var C;return R}},{immediate:36}],38:[function(t,r,i){var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,r,i){var s=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),c=t("./zlib/messages"),l=t("./zlib/zstream"),u=Object.prototype.toString,h=0,f=-1,d=0,p=8;function m(v){if(!(this instanceof m))return new m(v);this.options=o.assign({level:f,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},v||{});var S=this.options;S.raw&&0<S.windowBits?S.windowBits=-S.windowBits:S.gzip&&0<S.windowBits&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var b=s.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(b!==h)throw new Error(c[b]);if(S.header&&s.deflateSetHeader(this.strm,S.header),S.dictionary){var T;if(T=typeof S.dictionary=="string"?a.string2buf(S.dictionary):u.call(S.dictionary)==="[object ArrayBuffer]"?new Uint8Array(S.dictionary):S.dictionary,(b=s.deflateSetDictionary(this.strm,T))!==h)throw new Error(c[b]);this._dict_set=!0}}function _(v,S){var b=new m(S);if(b.push(v,!0),b.err)throw b.msg||c[b.err];return b.result}m.prototype.push=function(v,S){var b,T,w=this.strm,R=this.options.chunkSize;if(this.ended)return!1;T=S===~~S?S:S===!0?4:0,typeof v=="string"?w.input=a.string2buf(v):u.call(v)==="[object ArrayBuffer]"?w.input=new Uint8Array(v):w.input=v,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new o.Buf8(R),w.next_out=0,w.avail_out=R),(b=s.deflate(w,T))!==1&&b!==h)return this.onEnd(b),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(w.output,w.next_out))):this.onData(o.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&b!==1);return T===4?(b=s.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===h):T!==2||(this.onEnd(h),!(w.avail_out=0))},m.prototype.onData=function(v){this.chunks.push(v)},m.prototype.onEnd=function(v){v===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},i.Deflate=m,i.deflate=_,i.deflateRaw=function(v,S){return(S=S||{}).raw=!0,_(v,S)},i.gzip=function(v,S){return(S=S||{}).gzip=!0,_(v,S)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,r,i){var s=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),c=t("./zlib/constants"),l=t("./zlib/messages"),u=t("./zlib/zstream"),h=t("./zlib/gzheader"),f=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||m&&m.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&(15&_.windowBits)==0&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var v=s.inflateInit2(this.strm,_.windowBits);if(v!==c.Z_OK)throw new Error(l[v]);this.header=new h,s.inflateGetHeader(this.strm,this.header)}function p(m,_){var v=new d(_);if(v.push(m,!0),v.err)throw v.msg||l[v.err];return v.result}d.prototype.push=function(m,_){var v,S,b,T,w,R,C=this.strm,N=this.options.chunkSize,U=this.options.dictionary,B=!1;if(this.ended)return!1;S=_===~~_?_:_===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof m=="string"?C.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?C.input=new Uint8Array(m):C.input=m,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(N),C.next_out=0,C.avail_out=N),(v=s.inflate(C,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&U&&(R=typeof U=="string"?a.string2buf(U):f.call(U)==="[object ArrayBuffer]"?new Uint8Array(U):U,v=s.inflateSetDictionary(this.strm,R)),v===c.Z_BUF_ERROR&&B===!0&&(v=c.Z_OK,B=!1),v!==c.Z_STREAM_END&&v!==c.Z_OK)return this.onEnd(v),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&v!==c.Z_STREAM_END&&(C.avail_in!==0||S!==c.Z_FINISH&&S!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(b=a.utf8border(C.output,C.next_out),T=C.next_out-b,w=a.buf2string(C.output,b),C.next_out=T,C.avail_out=N-T,T&&o.arraySet(C.output,C.output,b,T,0),this.onData(w)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(B=!0)}while((0<C.avail_in||C.avail_out===0)&&v!==c.Z_STREAM_END);return v===c.Z_STREAM_END&&(S=c.Z_FINISH),S===c.Z_FINISH?(v=s.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===c.Z_OK):S!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(C.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=p,i.inflateRaw=function(m,_){return(_=_||{}).raw=!0,p(m,_)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,r,i){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},i.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var o={arraySet:function(c,l,u,h,f){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+h),f);else for(var d=0;d<h;d++)c[f+d]=l[u+d]},flattenChunks:function(c){var l,u,h,f,d,p;for(l=h=0,u=c.length;l<u;l++)h+=c[l].length;for(p=new Uint8Array(h),l=f=0,u=c.length;l<u;l++)d=c[l],p.set(d,f),f+=d.length;return p}},a={arraySet:function(c,l,u,h,f){for(var d=0;d<h;d++)c[f+d]=l[u+d]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(s)},{}],42:[function(t,r,i){var s=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(h,f));for(var d="",p=0;p<f;p++)d+=String.fromCharCode(h[p]);return d}c[254]=c[254]=1,i.string2buf=function(h){var f,d,p,m,_,v=h.length,S=0;for(m=0;m<v;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<v&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),S+=d<128?1:d<2048?2:d<65536?3:4;for(f=new s.Buf8(S),m=_=0;_<S;m++)(64512&(d=h.charCodeAt(m)))==55296&&m+1<v&&(64512&(p=h.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(p-56320),m++),d<128?f[_++]=d:(d<2048?f[_++]=192|d>>>6:(d<65536?f[_++]=224|d>>>12:(f[_++]=240|d>>>18,f[_++]=128|d>>>12&63),f[_++]=128|d>>>6&63),f[_++]=128|63&d);return f},i.buf2binstring=function(h){return u(h,h.length)},i.binstring2buf=function(h){for(var f=new s.Buf8(h.length),d=0,p=f.length;d<p;d++)f[d]=h.charCodeAt(d);return f},i.buf2string=function(h,f){var d,p,m,_,v=f||h.length,S=new Array(2*v);for(d=p=0;d<v;)if((m=h[d++])<128)S[p++]=m;else if(4<(_=c[m]))S[p++]=65533,d+=_-1;else{for(m&=_===2?31:_===3?15:7;1<_&&d<v;)m=m<<6|63&h[d++],_--;1<_?S[p++]=65533:m<65536?S[p++]=m:(m-=65536,S[p++]=55296|m>>10&1023,S[p++]=56320|1023&m)}return u(S,p)},i.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+c[h[d]]>f?d:f}},{"./common":41}],43:[function(t,r,i){r.exports=function(s,o,a,c){for(var l=65535&s|0,u=s>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;u=u+(l=l+o[c++]|0)|0,--h;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(t,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,r,i){var s=(function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var l=0;l<8;l++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a})();r.exports=function(o,a,c,l){var u=s,h=l+c;o^=-1;for(var f=l;f<h;f++)o=o>>>8^u[255&(o^a[f])];return-1^o}},{}],46:[function(t,r,i){var s,o=t("../utils/common"),a=t("./trees"),c=t("./adler32"),l=t("./crc32"),u=t("./messages"),h=0,f=4,d=0,p=-2,m=-1,_=4,v=2,S=8,b=9,T=286,w=30,R=19,C=2*T+1,N=15,U=3,B=258,$=B+U+1,I=42,L=113,P=1,H=2,X=3,G=4;function Y(re,Le){return re.msg=u[Le],Le}function J(re){return(re<<1)-(4<re?9:0)}function Q(re){for(var Le=re.length;0<=--Le;)re[Le]=0}function z(re){var Le=re.state,$e=Le.pending;$e>re.avail_out&&($e=re.avail_out),$e!==0&&(o.arraySet(re.output,Le.pending_buf,Le.pending_out,$e,re.next_out),re.next_out+=$e,Le.pending_out+=$e,re.total_out+=$e,re.avail_out-=$e,Le.pending-=$e,Le.pending===0&&(Le.pending_out=0))}function q(re,Le){a._tr_flush_block(re,0<=re.block_start?re.block_start:-1,re.strstart-re.block_start,Le),re.block_start=re.strstart,z(re.strm)}function ee(re,Le){re.pending_buf[re.pending++]=Le}function te(re,Le){re.pending_buf[re.pending++]=Le>>>8&255,re.pending_buf[re.pending++]=255&Le}function ie(re,Le){var $e,De,Oe=re.max_chain_length,ae=re.strstart,ve=re.prev_length,xe=re.nice_match,pe=re.strstart>re.w_size-$?re.strstart-(re.w_size-$):0,ze=re.window,Je=re.w_mask,Xe=re.prev,et=re.strstart+B,Ut=ze[ae+ve-1],gt=ze[ae+ve];re.prev_length>=re.good_match&&(Oe>>=2),xe>re.lookahead&&(xe=re.lookahead);do if(ze[($e=Le)+ve]===gt&&ze[$e+ve-1]===Ut&&ze[$e]===ze[ae]&&ze[++$e]===ze[ae+1]){ae+=2,$e++;do;while(ze[++ae]===ze[++$e]&&ze[++ae]===ze[++$e]&&ze[++ae]===ze[++$e]&&ze[++ae]===ze[++$e]&&ze[++ae]===ze[++$e]&&ze[++ae]===ze[++$e]&&ze[++ae]===ze[++$e]&&ze[++ae]===ze[++$e]&&ae<et);if(De=B-(et-ae),ae=et-B,ve<De){if(re.match_start=Le,xe<=(ve=De))break;Ut=ze[ae+ve-1],gt=ze[ae+ve]}}while((Le=Xe[Le&Je])>pe&&--Oe!=0);return ve<=re.lookahead?ve:re.lookahead}function Ee(re){var Le,$e,De,Oe,ae,ve,xe,pe,ze,Je,Xe=re.w_size;do{if(Oe=re.window_size-re.lookahead-re.strstart,re.strstart>=Xe+(Xe-$)){for(o.arraySet(re.window,re.window,Xe,Xe,0),re.match_start-=Xe,re.strstart-=Xe,re.block_start-=Xe,Le=$e=re.hash_size;De=re.head[--Le],re.head[Le]=Xe<=De?De-Xe:0,--$e;);for(Le=$e=Xe;De=re.prev[--Le],re.prev[Le]=Xe<=De?De-Xe:0,--$e;);Oe+=Xe}if(re.strm.avail_in===0)break;if(ve=re.strm,xe=re.window,pe=re.strstart+re.lookahead,ze=Oe,Je=void 0,Je=ve.avail_in,ze<Je&&(Je=ze),$e=Je===0?0:(ve.avail_in-=Je,o.arraySet(xe,ve.input,ve.next_in,Je,pe),ve.state.wrap===1?ve.adler=c(ve.adler,xe,Je,pe):ve.state.wrap===2&&(ve.adler=l(ve.adler,xe,Je,pe)),ve.next_in+=Je,ve.total_in+=Je,Je),re.lookahead+=$e,re.lookahead+re.insert>=U)for(ae=re.strstart-re.insert,re.ins_h=re.window[ae],re.ins_h=(re.ins_h<<re.hash_shift^re.window[ae+1])&re.hash_mask;re.insert&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[ae+U-1])&re.hash_mask,re.prev[ae&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=ae,ae++,re.insert--,!(re.lookahead+re.insert<U)););}while(re.lookahead<$&&re.strm.avail_in!==0)}function Re(re,Le){for(var $e,De;;){if(re.lookahead<$){if(Ee(re),re.lookahead<$&&Le===h)return P;if(re.lookahead===0)break}if($e=0,re.lookahead>=U&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+U-1])&re.hash_mask,$e=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),$e!==0&&re.strstart-$e<=re.w_size-$&&(re.match_length=ie(re,$e)),re.match_length>=U)if(De=a._tr_tally(re,re.strstart-re.match_start,re.match_length-U),re.lookahead-=re.match_length,re.match_length<=re.max_lazy_match&&re.lookahead>=U){for(re.match_length--;re.strstart++,re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+U-1])&re.hash_mask,$e=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart,--re.match_length!=0;);re.strstart++}else re.strstart+=re.match_length,re.match_length=0,re.ins_h=re.window[re.strstart],re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+1])&re.hash_mask;else De=a._tr_tally(re,0,re.window[re.strstart]),re.lookahead--,re.strstart++;if(De&&(q(re,!1),re.strm.avail_out===0))return P}return re.insert=re.strstart<U-1?re.strstart:U-1,Le===f?(q(re,!0),re.strm.avail_out===0?X:G):re.last_lit&&(q(re,!1),re.strm.avail_out===0)?P:H}function Te(re,Le){for(var $e,De,Oe;;){if(re.lookahead<$){if(Ee(re),re.lookahead<$&&Le===h)return P;if(re.lookahead===0)break}if($e=0,re.lookahead>=U&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+U-1])&re.hash_mask,$e=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),re.prev_length=re.match_length,re.prev_match=re.match_start,re.match_length=U-1,$e!==0&&re.prev_length<re.max_lazy_match&&re.strstart-$e<=re.w_size-$&&(re.match_length=ie(re,$e),re.match_length<=5&&(re.strategy===1||re.match_length===U&&4096<re.strstart-re.match_start)&&(re.match_length=U-1)),re.prev_length>=U&&re.match_length<=re.prev_length){for(Oe=re.strstart+re.lookahead-U,De=a._tr_tally(re,re.strstart-1-re.prev_match,re.prev_length-U),re.lookahead-=re.prev_length-1,re.prev_length-=2;++re.strstart<=Oe&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+U-1])&re.hash_mask,$e=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),--re.prev_length!=0;);if(re.match_available=0,re.match_length=U-1,re.strstart++,De&&(q(re,!1),re.strm.avail_out===0))return P}else if(re.match_available){if((De=a._tr_tally(re,0,re.window[re.strstart-1]))&&q(re,!1),re.strstart++,re.lookahead--,re.strm.avail_out===0)return P}else re.match_available=1,re.strstart++,re.lookahead--}return re.match_available&&(De=a._tr_tally(re,0,re.window[re.strstart-1]),re.match_available=0),re.insert=re.strstart<U-1?re.strstart:U-1,Le===f?(q(re,!0),re.strm.avail_out===0?X:G):re.last_lit&&(q(re,!1),re.strm.avail_out===0)?P:H}function Pe(re,Le,$e,De,Oe){this.good_length=re,this.max_lazy=Le,this.nice_length=$e,this.max_chain=De,this.func=Oe}function We(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*w+1)),this.bl_tree=new o.Buf16(2*(2*R+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(N+1),this.heap=new o.Buf16(2*T+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*T+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function it(re){var Le;return re&&re.state?(re.total_in=re.total_out=0,re.data_type=v,(Le=re.state).pending=0,Le.pending_out=0,Le.wrap<0&&(Le.wrap=-Le.wrap),Le.status=Le.wrap?I:L,re.adler=Le.wrap===2?0:1,Le.last_flush=h,a._tr_init(Le),d):Y(re,p)}function ht(re){var Le=it(re);return Le===d&&(function($e){$e.window_size=2*$e.w_size,Q($e.head),$e.max_lazy_match=s[$e.level].max_lazy,$e.good_match=s[$e.level].good_length,$e.nice_match=s[$e.level].nice_length,$e.max_chain_length=s[$e.level].max_chain,$e.strstart=0,$e.block_start=0,$e.lookahead=0,$e.insert=0,$e.match_length=$e.prev_length=U-1,$e.match_available=0,$e.ins_h=0})(re.state),Le}function vt(re,Le,$e,De,Oe,ae){if(!re)return p;var ve=1;if(Le===m&&(Le=6),De<0?(ve=0,De=-De):15<De&&(ve=2,De-=16),Oe<1||b<Oe||$e!==S||De<8||15<De||Le<0||9<Le||ae<0||_<ae)return Y(re,p);De===8&&(De=9);var xe=new We;return(re.state=xe).strm=re,xe.wrap=ve,xe.gzhead=null,xe.w_bits=De,xe.w_size=1<<xe.w_bits,xe.w_mask=xe.w_size-1,xe.hash_bits=Oe+7,xe.hash_size=1<<xe.hash_bits,xe.hash_mask=xe.hash_size-1,xe.hash_shift=~~((xe.hash_bits+U-1)/U),xe.window=new o.Buf8(2*xe.w_size),xe.head=new o.Buf16(xe.hash_size),xe.prev=new o.Buf16(xe.w_size),xe.lit_bufsize=1<<Oe+6,xe.pending_buf_size=4*xe.lit_bufsize,xe.pending_buf=new o.Buf8(xe.pending_buf_size),xe.d_buf=1*xe.lit_bufsize,xe.l_buf=3*xe.lit_bufsize,xe.level=Le,xe.strategy=ae,xe.method=$e,ht(re)}s=[new Pe(0,0,0,0,function(re,Le){var $e=65535;for($e>re.pending_buf_size-5&&($e=re.pending_buf_size-5);;){if(re.lookahead<=1){if(Ee(re),re.lookahead===0&&Le===h)return P;if(re.lookahead===0)break}re.strstart+=re.lookahead,re.lookahead=0;var De=re.block_start+$e;if((re.strstart===0||re.strstart>=De)&&(re.lookahead=re.strstart-De,re.strstart=De,q(re,!1),re.strm.avail_out===0)||re.strstart-re.block_start>=re.w_size-$&&(q(re,!1),re.strm.avail_out===0))return P}return re.insert=0,Le===f?(q(re,!0),re.strm.avail_out===0?X:G):(re.strstart>re.block_start&&(q(re,!1),re.strm.avail_out),P)}),new Pe(4,4,8,4,Re),new Pe(4,5,16,8,Re),new Pe(4,6,32,32,Re),new Pe(4,4,16,16,Te),new Pe(8,16,32,32,Te),new Pe(8,16,128,128,Te),new Pe(8,32,128,256,Te),new Pe(32,128,258,1024,Te),new Pe(32,258,258,4096,Te)],i.deflateInit=function(re,Le){return vt(re,Le,S,15,8,0)},i.deflateInit2=vt,i.deflateReset=ht,i.deflateResetKeep=it,i.deflateSetHeader=function(re,Le){return re&&re.state?re.state.wrap!==2?p:(re.state.gzhead=Le,d):p},i.deflate=function(re,Le){var $e,De,Oe,ae;if(!re||!re.state||5<Le||Le<0)return re?Y(re,p):p;if(De=re.state,!re.output||!re.input&&re.avail_in!==0||De.status===666&&Le!==f)return Y(re,re.avail_out===0?-5:p);if(De.strm=re,$e=De.last_flush,De.last_flush=Le,De.status===I)if(De.wrap===2)re.adler=0,ee(De,31),ee(De,139),ee(De,8),De.gzhead?(ee(De,(De.gzhead.text?1:0)+(De.gzhead.hcrc?2:0)+(De.gzhead.extra?4:0)+(De.gzhead.name?8:0)+(De.gzhead.comment?16:0)),ee(De,255&De.gzhead.time),ee(De,De.gzhead.time>>8&255),ee(De,De.gzhead.time>>16&255),ee(De,De.gzhead.time>>24&255),ee(De,De.level===9?2:2<=De.strategy||De.level<2?4:0),ee(De,255&De.gzhead.os),De.gzhead.extra&&De.gzhead.extra.length&&(ee(De,255&De.gzhead.extra.length),ee(De,De.gzhead.extra.length>>8&255)),De.gzhead.hcrc&&(re.adler=l(re.adler,De.pending_buf,De.pending,0)),De.gzindex=0,De.status=69):(ee(De,0),ee(De,0),ee(De,0),ee(De,0),ee(De,0),ee(De,De.level===9?2:2<=De.strategy||De.level<2?4:0),ee(De,3),De.status=L);else{var ve=S+(De.w_bits-8<<4)<<8;ve|=(2<=De.strategy||De.level<2?0:De.level<6?1:De.level===6?2:3)<<6,De.strstart!==0&&(ve|=32),ve+=31-ve%31,De.status=L,te(De,ve),De.strstart!==0&&(te(De,re.adler>>>16),te(De,65535&re.adler)),re.adler=1}if(De.status===69)if(De.gzhead.extra){for(Oe=De.pending;De.gzindex<(65535&De.gzhead.extra.length)&&(De.pending!==De.pending_buf_size||(De.gzhead.hcrc&&De.pending>Oe&&(re.adler=l(re.adler,De.pending_buf,De.pending-Oe,Oe)),z(re),Oe=De.pending,De.pending!==De.pending_buf_size));)ee(De,255&De.gzhead.extra[De.gzindex]),De.gzindex++;De.gzhead.hcrc&&De.pending>Oe&&(re.adler=l(re.adler,De.pending_buf,De.pending-Oe,Oe)),De.gzindex===De.gzhead.extra.length&&(De.gzindex=0,De.status=73)}else De.status=73;if(De.status===73)if(De.gzhead.name){Oe=De.pending;do{if(De.pending===De.pending_buf_size&&(De.gzhead.hcrc&&De.pending>Oe&&(re.adler=l(re.adler,De.pending_buf,De.pending-Oe,Oe)),z(re),Oe=De.pending,De.pending===De.pending_buf_size)){ae=1;break}ae=De.gzindex<De.gzhead.name.length?255&De.gzhead.name.charCodeAt(De.gzindex++):0,ee(De,ae)}while(ae!==0);De.gzhead.hcrc&&De.pending>Oe&&(re.adler=l(re.adler,De.pending_buf,De.pending-Oe,Oe)),ae===0&&(De.gzindex=0,De.status=91)}else De.status=91;if(De.status===91)if(De.gzhead.comment){Oe=De.pending;do{if(De.pending===De.pending_buf_size&&(De.gzhead.hcrc&&De.pending>Oe&&(re.adler=l(re.adler,De.pending_buf,De.pending-Oe,Oe)),z(re),Oe=De.pending,De.pending===De.pending_buf_size)){ae=1;break}ae=De.gzindex<De.gzhead.comment.length?255&De.gzhead.comment.charCodeAt(De.gzindex++):0,ee(De,ae)}while(ae!==0);De.gzhead.hcrc&&De.pending>Oe&&(re.adler=l(re.adler,De.pending_buf,De.pending-Oe,Oe)),ae===0&&(De.status=103)}else De.status=103;if(De.status===103&&(De.gzhead.hcrc?(De.pending+2>De.pending_buf_size&&z(re),De.pending+2<=De.pending_buf_size&&(ee(De,255&re.adler),ee(De,re.adler>>8&255),re.adler=0,De.status=L)):De.status=L),De.pending!==0){if(z(re),re.avail_out===0)return De.last_flush=-1,d}else if(re.avail_in===0&&J(Le)<=J($e)&&Le!==f)return Y(re,-5);if(De.status===666&&re.avail_in!==0)return Y(re,-5);if(re.avail_in!==0||De.lookahead!==0||Le!==h&&De.status!==666){var xe=De.strategy===2?(function(pe,ze){for(var Je;;){if(pe.lookahead===0&&(Ee(pe),pe.lookahead===0)){if(ze===h)return P;break}if(pe.match_length=0,Je=a._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++,Je&&(q(pe,!1),pe.strm.avail_out===0))return P}return pe.insert=0,ze===f?(q(pe,!0),pe.strm.avail_out===0?X:G):pe.last_lit&&(q(pe,!1),pe.strm.avail_out===0)?P:H})(De,Le):De.strategy===3?(function(pe,ze){for(var Je,Xe,et,Ut,gt=pe.window;;){if(pe.lookahead<=B){if(Ee(pe),pe.lookahead<=B&&ze===h)return P;if(pe.lookahead===0)break}if(pe.match_length=0,pe.lookahead>=U&&0<pe.strstart&&(Xe=gt[et=pe.strstart-1])===gt[++et]&&Xe===gt[++et]&&Xe===gt[++et]){Ut=pe.strstart+B;do;while(Xe===gt[++et]&&Xe===gt[++et]&&Xe===gt[++et]&&Xe===gt[++et]&&Xe===gt[++et]&&Xe===gt[++et]&&Xe===gt[++et]&&Xe===gt[++et]&&et<Ut);pe.match_length=B-(Ut-et),pe.match_length>pe.lookahead&&(pe.match_length=pe.lookahead)}if(pe.match_length>=U?(Je=a._tr_tally(pe,1,pe.match_length-U),pe.lookahead-=pe.match_length,pe.strstart+=pe.match_length,pe.match_length=0):(Je=a._tr_tally(pe,0,pe.window[pe.strstart]),pe.lookahead--,pe.strstart++),Je&&(q(pe,!1),pe.strm.avail_out===0))return P}return pe.insert=0,ze===f?(q(pe,!0),pe.strm.avail_out===0?X:G):pe.last_lit&&(q(pe,!1),pe.strm.avail_out===0)?P:H})(De,Le):s[De.level].func(De,Le);if(xe!==X&&xe!==G||(De.status=666),xe===P||xe===X)return re.avail_out===0&&(De.last_flush=-1),d;if(xe===H&&(Le===1?a._tr_align(De):Le!==5&&(a._tr_stored_block(De,0,0,!1),Le===3&&(Q(De.head),De.lookahead===0&&(De.strstart=0,De.block_start=0,De.insert=0))),z(re),re.avail_out===0))return De.last_flush=-1,d}return Le!==f?d:De.wrap<=0?1:(De.wrap===2?(ee(De,255&re.adler),ee(De,re.adler>>8&255),ee(De,re.adler>>16&255),ee(De,re.adler>>24&255),ee(De,255&re.total_in),ee(De,re.total_in>>8&255),ee(De,re.total_in>>16&255),ee(De,re.total_in>>24&255)):(te(De,re.adler>>>16),te(De,65535&re.adler)),z(re),0<De.wrap&&(De.wrap=-De.wrap),De.pending!==0?d:1)},i.deflateEnd=function(re){var Le;return re&&re.state?(Le=re.state.status)!==I&&Le!==69&&Le!==73&&Le!==91&&Le!==103&&Le!==L&&Le!==666?Y(re,p):(re.state=null,Le===L?Y(re,-3):d):p},i.deflateSetDictionary=function(re,Le){var $e,De,Oe,ae,ve,xe,pe,ze,Je=Le.length;if(!re||!re.state||(ae=($e=re.state).wrap)===2||ae===1&&$e.status!==I||$e.lookahead)return p;for(ae===1&&(re.adler=c(re.adler,Le,Je,0)),$e.wrap=0,Je>=$e.w_size&&(ae===0&&(Q($e.head),$e.strstart=0,$e.block_start=0,$e.insert=0),ze=new o.Buf8($e.w_size),o.arraySet(ze,Le,Je-$e.w_size,$e.w_size,0),Le=ze,Je=$e.w_size),ve=re.avail_in,xe=re.next_in,pe=re.input,re.avail_in=Je,re.next_in=0,re.input=Le,Ee($e);$e.lookahead>=U;){for(De=$e.strstart,Oe=$e.lookahead-(U-1);$e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[De+U-1])&$e.hash_mask,$e.prev[De&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=De,De++,--Oe;);$e.strstart=De,$e.lookahead=U-1,Ee($e)}return $e.strstart+=$e.lookahead,$e.block_start=$e.strstart,$e.insert=$e.lookahead,$e.lookahead=0,$e.match_length=$e.prev_length=U-1,$e.match_available=0,re.next_in=xe,re.input=pe,re.avail_in=ve,$e.wrap=ae,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,r,i){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,r,i){r.exports=function(s,o){var a,c,l,u,h,f,d,p,m,_,v,S,b,T,w,R,C,N,U,B,$,I,L,P,H;a=s.state,c=s.next_in,P=s.input,l=c+(s.avail_in-5),u=s.next_out,H=s.output,h=u-(o-s.avail_out),f=u+(s.avail_out-257),d=a.dmax,p=a.wsize,m=a.whave,_=a.wnext,v=a.window,S=a.hold,b=a.bits,T=a.lencode,w=a.distcode,R=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;e:do{b<15&&(S+=P[c++]<<b,b+=8,S+=P[c++]<<b,b+=8),N=T[S&R];t:for(;;){if(S>>>=U=N>>>24,b-=U,(U=N>>>16&255)===0)H[u++]=65535&N;else{if(!(16&U)){if((64&U)==0){N=T[(65535&N)+(S&(1<<U)-1)];continue t}if(32&U){a.mode=12;break e}s.msg="invalid literal/length code",a.mode=30;break e}B=65535&N,(U&=15)&&(b<U&&(S+=P[c++]<<b,b+=8),B+=S&(1<<U)-1,S>>>=U,b-=U),b<15&&(S+=P[c++]<<b,b+=8,S+=P[c++]<<b,b+=8),N=w[S&C];n:for(;;){if(S>>>=U=N>>>24,b-=U,!(16&(U=N>>>16&255))){if((64&U)==0){N=w[(65535&N)+(S&(1<<U)-1)];continue n}s.msg="invalid distance code",a.mode=30;break e}if($=65535&N,b<(U&=15)&&(S+=P[c++]<<b,(b+=8)<U&&(S+=P[c++]<<b,b+=8)),d<($+=S&(1<<U)-1)){s.msg="invalid distance too far back",a.mode=30;break e}if(S>>>=U,b-=U,(U=u-h)<$){if(m<(U=$-U)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break e}if(L=v,(I=0)===_){if(I+=p-U,U<B){for(B-=U;H[u++]=v[I++],--U;);I=u-$,L=H}}else if(_<U){if(I+=p+_-U,(U-=_)<B){for(B-=U;H[u++]=v[I++],--U;);if(I=0,_<B){for(B-=U=_;H[u++]=v[I++],--U;);I=u-$,L=H}}}else if(I+=_-U,U<B){for(B-=U;H[u++]=v[I++],--U;);I=u-$,L=H}for(;2<B;)H[u++]=L[I++],H[u++]=L[I++],H[u++]=L[I++],B-=3;B&&(H[u++]=L[I++],1<B&&(H[u++]=L[I++]))}else{for(I=u-$;H[u++]=H[I++],H[u++]=H[I++],H[u++]=H[I++],2<(B-=3););B&&(H[u++]=H[I++],1<B&&(H[u++]=H[I++]))}break}}break}}while(c<l&&u<f);c-=B=b>>3,S&=(1<<(b-=B<<3))-1,s.next_in=c,s.next_out=u,s.avail_in=c<l?l-c+5:5-(c-l),s.avail_out=u<f?f-u+257:257-(u-f),a.hold=S,a.bits=b}},{}],49:[function(t,r,i){var s=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),c=t("./inffast"),l=t("./inftrees"),u=1,h=2,f=0,d=-2,p=1,m=852,_=592;function v(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function b(I){var L;return I&&I.state?(L=I.state,I.total_in=I.total_out=L.total=0,I.msg="",L.wrap&&(I.adler=1&L.wrap),L.mode=p,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new s.Buf32(m),L.distcode=L.distdyn=new s.Buf32(_),L.sane=1,L.back=-1,f):d}function T(I){var L;return I&&I.state?((L=I.state).wsize=0,L.whave=0,L.wnext=0,b(I)):d}function w(I,L){var P,H;return I&&I.state?(H=I.state,L<0?(P=0,L=-L):(P=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?d:(H.window!==null&&H.wbits!==L&&(H.window=null),H.wrap=P,H.wbits=L,T(I))):d}function R(I,L){var P,H;return I?(H=new S,(I.state=H).window=null,(P=w(I,L))!==f&&(I.state=null),P):d}var C,N,U=!0;function B(I){if(U){var L;for(C=new s.Buf32(512),N=new s.Buf32(32),L=0;L<144;)I.lens[L++]=8;for(;L<256;)I.lens[L++]=9;for(;L<280;)I.lens[L++]=7;for(;L<288;)I.lens[L++]=8;for(l(u,I.lens,0,288,C,0,I.work,{bits:9}),L=0;L<32;)I.lens[L++]=5;l(h,I.lens,0,32,N,0,I.work,{bits:5}),U=!1}I.lencode=C,I.lenbits=9,I.distcode=N,I.distbits=5}function $(I,L,P,H){var X,G=I.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new s.Buf8(G.wsize)),H>=G.wsize?(s.arraySet(G.window,L,P-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(H<(X=G.wsize-G.wnext)&&(X=H),s.arraySet(G.window,L,P-H,X,G.wnext),(H-=X)?(s.arraySet(G.window,L,P-H,H,0),G.wnext=H,G.whave=G.wsize):(G.wnext+=X,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=X))),0}i.inflateReset=T,i.inflateReset2=w,i.inflateResetKeep=b,i.inflateInit=function(I){return R(I,15)},i.inflateInit2=R,i.inflate=function(I,L){var P,H,X,G,Y,J,Q,z,q,ee,te,ie,Ee,Re,Te,Pe,We,it,ht,vt,re,Le,$e,De,Oe=0,ae=new s.Buf8(4),ve=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return d;(P=I.state).mode===12&&(P.mode=13),Y=I.next_out,X=I.output,Q=I.avail_out,G=I.next_in,H=I.input,J=I.avail_in,z=P.hold,q=P.bits,ee=J,te=Q,Le=f;e:for(;;)switch(P.mode){case p:if(P.wrap===0){P.mode=13;break}for(;q<16;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if(2&P.wrap&&z===35615){ae[P.check=0]=255&z,ae[1]=z>>>8&255,P.check=a(P.check,ae,2,0),q=z=0,P.mode=2;break}if(P.flags=0,P.head&&(P.head.done=!1),!(1&P.wrap)||(((255&z)<<8)+(z>>8))%31){I.msg="incorrect header check",P.mode=30;break}if((15&z)!=8){I.msg="unknown compression method",P.mode=30;break}if(q-=4,re=8+(15&(z>>>=4)),P.wbits===0)P.wbits=re;else if(re>P.wbits){I.msg="invalid window size",P.mode=30;break}P.dmax=1<<re,I.adler=P.check=1,P.mode=512&z?10:12,q=z=0;break;case 2:for(;q<16;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if(P.flags=z,(255&P.flags)!=8){I.msg="unknown compression method",P.mode=30;break}if(57344&P.flags){I.msg="unknown header flags set",P.mode=30;break}P.head&&(P.head.text=z>>8&1),512&P.flags&&(ae[0]=255&z,ae[1]=z>>>8&255,P.check=a(P.check,ae,2,0)),q=z=0,P.mode=3;case 3:for(;q<32;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}P.head&&(P.head.time=z),512&P.flags&&(ae[0]=255&z,ae[1]=z>>>8&255,ae[2]=z>>>16&255,ae[3]=z>>>24&255,P.check=a(P.check,ae,4,0)),q=z=0,P.mode=4;case 4:for(;q<16;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}P.head&&(P.head.xflags=255&z,P.head.os=z>>8),512&P.flags&&(ae[0]=255&z,ae[1]=z>>>8&255,P.check=a(P.check,ae,2,0)),q=z=0,P.mode=5;case 5:if(1024&P.flags){for(;q<16;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}P.length=z,P.head&&(P.head.extra_len=z),512&P.flags&&(ae[0]=255&z,ae[1]=z>>>8&255,P.check=a(P.check,ae,2,0)),q=z=0}else P.head&&(P.head.extra=null);P.mode=6;case 6:if(1024&P.flags&&(J<(ie=P.length)&&(ie=J),ie&&(P.head&&(re=P.head.extra_len-P.length,P.head.extra||(P.head.extra=new Array(P.head.extra_len)),s.arraySet(P.head.extra,H,G,ie,re)),512&P.flags&&(P.check=a(P.check,H,ie,G)),J-=ie,G+=ie,P.length-=ie),P.length))break e;P.length=0,P.mode=7;case 7:if(2048&P.flags){if(J===0)break e;for(ie=0;re=H[G+ie++],P.head&&re&&P.length<65536&&(P.head.name+=String.fromCharCode(re)),re&&ie<J;);if(512&P.flags&&(P.check=a(P.check,H,ie,G)),J-=ie,G+=ie,re)break e}else P.head&&(P.head.name=null);P.length=0,P.mode=8;case 8:if(4096&P.flags){if(J===0)break e;for(ie=0;re=H[G+ie++],P.head&&re&&P.length<65536&&(P.head.comment+=String.fromCharCode(re)),re&&ie<J;);if(512&P.flags&&(P.check=a(P.check,H,ie,G)),J-=ie,G+=ie,re)break e}else P.head&&(P.head.comment=null);P.mode=9;case 9:if(512&P.flags){for(;q<16;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if(z!==(65535&P.check)){I.msg="header crc mismatch",P.mode=30;break}q=z=0}P.head&&(P.head.hcrc=P.flags>>9&1,P.head.done=!0),I.adler=P.check=0,P.mode=12;break;case 10:for(;q<32;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}I.adler=P.check=v(z),q=z=0,P.mode=11;case 11:if(P.havedict===0)return I.next_out=Y,I.avail_out=Q,I.next_in=G,I.avail_in=J,P.hold=z,P.bits=q,2;I.adler=P.check=1,P.mode=12;case 12:if(L===5||L===6)break e;case 13:if(P.last){z>>>=7&q,q-=7&q,P.mode=27;break}for(;q<3;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}switch(P.last=1&z,q-=1,3&(z>>>=1)){case 0:P.mode=14;break;case 1:if(B(P),P.mode=20,L!==6)break;z>>>=2,q-=2;break e;case 2:P.mode=17;break;case 3:I.msg="invalid block type",P.mode=30}z>>>=2,q-=2;break;case 14:for(z>>>=7&q,q-=7&q;q<32;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if((65535&z)!=(z>>>16^65535)){I.msg="invalid stored block lengths",P.mode=30;break}if(P.length=65535&z,q=z=0,P.mode=15,L===6)break e;case 15:P.mode=16;case 16:if(ie=P.length){if(J<ie&&(ie=J),Q<ie&&(ie=Q),ie===0)break e;s.arraySet(X,H,G,ie,Y),J-=ie,G+=ie,Q-=ie,Y+=ie,P.length-=ie;break}P.mode=12;break;case 17:for(;q<14;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if(P.nlen=257+(31&z),z>>>=5,q-=5,P.ndist=1+(31&z),z>>>=5,q-=5,P.ncode=4+(15&z),z>>>=4,q-=4,286<P.nlen||30<P.ndist){I.msg="too many length or distance symbols",P.mode=30;break}P.have=0,P.mode=18;case 18:for(;P.have<P.ncode;){for(;q<3;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}P.lens[ve[P.have++]]=7&z,z>>>=3,q-=3}for(;P.have<19;)P.lens[ve[P.have++]]=0;if(P.lencode=P.lendyn,P.lenbits=7,$e={bits:P.lenbits},Le=l(0,P.lens,0,19,P.lencode,0,P.work,$e),P.lenbits=$e.bits,Le){I.msg="invalid code lengths set",P.mode=30;break}P.have=0,P.mode=19;case 19:for(;P.have<P.nlen+P.ndist;){for(;Pe=(Oe=P.lencode[z&(1<<P.lenbits)-1])>>>16&255,We=65535&Oe,!((Te=Oe>>>24)<=q);){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if(We<16)z>>>=Te,q-=Te,P.lens[P.have++]=We;else{if(We===16){for(De=Te+2;q<De;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if(z>>>=Te,q-=Te,P.have===0){I.msg="invalid bit length repeat",P.mode=30;break}re=P.lens[P.have-1],ie=3+(3&z),z>>>=2,q-=2}else if(We===17){for(De=Te+3;q<De;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}q-=Te,re=0,ie=3+(7&(z>>>=Te)),z>>>=3,q-=3}else{for(De=Te+7;q<De;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}q-=Te,re=0,ie=11+(127&(z>>>=Te)),z>>>=7,q-=7}if(P.have+ie>P.nlen+P.ndist){I.msg="invalid bit length repeat",P.mode=30;break}for(;ie--;)P.lens[P.have++]=re}}if(P.mode===30)break;if(P.lens[256]===0){I.msg="invalid code -- missing end-of-block",P.mode=30;break}if(P.lenbits=9,$e={bits:P.lenbits},Le=l(u,P.lens,0,P.nlen,P.lencode,0,P.work,$e),P.lenbits=$e.bits,Le){I.msg="invalid literal/lengths set",P.mode=30;break}if(P.distbits=6,P.distcode=P.distdyn,$e={bits:P.distbits},Le=l(h,P.lens,P.nlen,P.ndist,P.distcode,0,P.work,$e),P.distbits=$e.bits,Le){I.msg="invalid distances set",P.mode=30;break}if(P.mode=20,L===6)break e;case 20:P.mode=21;case 21:if(6<=J&&258<=Q){I.next_out=Y,I.avail_out=Q,I.next_in=G,I.avail_in=J,P.hold=z,P.bits=q,c(I,te),Y=I.next_out,X=I.output,Q=I.avail_out,G=I.next_in,H=I.input,J=I.avail_in,z=P.hold,q=P.bits,P.mode===12&&(P.back=-1);break}for(P.back=0;Pe=(Oe=P.lencode[z&(1<<P.lenbits)-1])>>>16&255,We=65535&Oe,!((Te=Oe>>>24)<=q);){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if(Pe&&(240&Pe)==0){for(it=Te,ht=Pe,vt=We;Pe=(Oe=P.lencode[vt+((z&(1<<it+ht)-1)>>it)])>>>16&255,We=65535&Oe,!(it+(Te=Oe>>>24)<=q);){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}z>>>=it,q-=it,P.back+=it}if(z>>>=Te,q-=Te,P.back+=Te,P.length=We,Pe===0){P.mode=26;break}if(32&Pe){P.back=-1,P.mode=12;break}if(64&Pe){I.msg="invalid literal/length code",P.mode=30;break}P.extra=15&Pe,P.mode=22;case 22:if(P.extra){for(De=P.extra;q<De;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}P.length+=z&(1<<P.extra)-1,z>>>=P.extra,q-=P.extra,P.back+=P.extra}P.was=P.length,P.mode=23;case 23:for(;Pe=(Oe=P.distcode[z&(1<<P.distbits)-1])>>>16&255,We=65535&Oe,!((Te=Oe>>>24)<=q);){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if((240&Pe)==0){for(it=Te,ht=Pe,vt=We;Pe=(Oe=P.distcode[vt+((z&(1<<it+ht)-1)>>it)])>>>16&255,We=65535&Oe,!(it+(Te=Oe>>>24)<=q);){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}z>>>=it,q-=it,P.back+=it}if(z>>>=Te,q-=Te,P.back+=Te,64&Pe){I.msg="invalid distance code",P.mode=30;break}P.offset=We,P.extra=15&Pe,P.mode=24;case 24:if(P.extra){for(De=P.extra;q<De;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}P.offset+=z&(1<<P.extra)-1,z>>>=P.extra,q-=P.extra,P.back+=P.extra}if(P.offset>P.dmax){I.msg="invalid distance too far back",P.mode=30;break}P.mode=25;case 25:if(Q===0)break e;if(ie=te-Q,P.offset>ie){if((ie=P.offset-ie)>P.whave&&P.sane){I.msg="invalid distance too far back",P.mode=30;break}Ee=ie>P.wnext?(ie-=P.wnext,P.wsize-ie):P.wnext-ie,ie>P.length&&(ie=P.length),Re=P.window}else Re=X,Ee=Y-P.offset,ie=P.length;for(Q<ie&&(ie=Q),Q-=ie,P.length-=ie;X[Y++]=Re[Ee++],--ie;);P.length===0&&(P.mode=21);break;case 26:if(Q===0)break e;X[Y++]=P.length,Q--,P.mode=21;break;case 27:if(P.wrap){for(;q<32;){if(J===0)break e;J--,z|=H[G++]<<q,q+=8}if(te-=Q,I.total_out+=te,P.total+=te,te&&(I.adler=P.check=P.flags?a(P.check,X,te,Y-te):o(P.check,X,te,Y-te)),te=Q,(P.flags?z:v(z))!==P.check){I.msg="incorrect data check",P.mode=30;break}q=z=0}P.mode=28;case 28:if(P.wrap&&P.flags){for(;q<32;){if(J===0)break e;J--,z+=H[G++]<<q,q+=8}if(z!==(4294967295&P.total)){I.msg="incorrect length check",P.mode=30;break}q=z=0}P.mode=29;case 29:Le=1;break e;case 30:Le=-3;break e;case 31:return-4;default:return d}return I.next_out=Y,I.avail_out=Q,I.next_in=G,I.avail_in=J,P.hold=z,P.bits=q,(P.wsize||te!==I.avail_out&&P.mode<30&&(P.mode<27||L!==4))&&$(I,I.output,I.next_out,te-I.avail_out)?(P.mode=31,-4):(ee-=I.avail_in,te-=I.avail_out,I.total_in+=ee,I.total_out+=te,P.total+=te,P.wrap&&te&&(I.adler=P.check=P.flags?a(P.check,X,te,I.next_out-te):o(P.check,X,te,I.next_out-te)),I.data_type=P.bits+(P.last?64:0)+(P.mode===12?128:0)+(P.mode===20||P.mode===15?256:0),(ee==0&&te===0||L===4)&&Le===f&&(Le=-5),Le)},i.inflateEnd=function(I){if(!I||!I.state)return d;var L=I.state;return L.window&&(L.window=null),I.state=null,f},i.inflateGetHeader=function(I,L){var P;return I&&I.state?(2&(P=I.state).wrap)==0?d:((P.head=L).done=!1,f):d},i.inflateSetDictionary=function(I,L){var P,H=L.length;return I&&I.state?(P=I.state).wrap!==0&&P.mode!==11?d:P.mode===11&&o(1,L,H,0)!==P.check?-3:$(I,L,H,H)?(P.mode=31,-4):(P.havedict=1,f):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,r,i){var s=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,f,d,p,m,_,v){var S,b,T,w,R,C,N,U,B,$=v.bits,I=0,L=0,P=0,H=0,X=0,G=0,Y=0,J=0,Q=0,z=0,q=null,ee=0,te=new s.Buf16(16),ie=new s.Buf16(16),Ee=null,Re=0;for(I=0;I<=15;I++)te[I]=0;for(L=0;L<d;L++)te[h[f+L]]++;for(X=$,H=15;1<=H&&te[H]===0;H--);if(H<X&&(X=H),H===0)return p[m++]=20971520,p[m++]=20971520,v.bits=1,0;for(P=1;P<H&&te[P]===0;P++);for(X<P&&(X=P),I=J=1;I<=15;I++)if(J<<=1,(J-=te[I])<0)return-1;if(0<J&&(u===0||H!==1))return-1;for(ie[1]=0,I=1;I<15;I++)ie[I+1]=ie[I]+te[I];for(L=0;L<d;L++)h[f+L]!==0&&(_[ie[h[f+L]]++]=L);if(C=u===0?(q=Ee=_,19):u===1?(q=o,ee-=257,Ee=a,Re-=257,256):(q=c,Ee=l,-1),I=P,R=m,Y=L=z=0,T=-1,w=(Q=1<<(G=X))-1,u===1&&852<Q||u===2&&592<Q)return 1;for(;;){for(N=I-Y,B=_[L]<C?(U=0,_[L]):_[L]>C?(U=Ee[Re+_[L]],q[ee+_[L]]):(U=96,0),S=1<<I-Y,P=b=1<<G;p[R+(z>>Y)+(b-=S)]=N<<24|U<<16|B|0,b!==0;);for(S=1<<I-1;z&S;)S>>=1;if(S!==0?(z&=S-1,z+=S):z=0,L++,--te[I]==0){if(I===H)break;I=h[f+_[L]]}if(X<I&&(z&w)!==T){for(Y===0&&(Y=X),R+=P,J=1<<(G=I-Y);G+Y<H&&!((J-=te[G+Y])<=0);)G++,J<<=1;if(Q+=1<<G,u===1&&852<Q||u===2&&592<Q)return 1;p[T=z&w]=X<<24|G<<16|R-m|0}}return z!==0&&(p[R+z]=I-Y<<24|64<<16|0),v.bits=X,0}},{"../utils/common":41}],51:[function(t,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,r,i){var s=t("../utils/common"),o=0,a=1;function c(Oe){for(var ae=Oe.length;0<=--ae;)Oe[ae]=0}var l=0,u=29,h=256,f=h+1+u,d=30,p=19,m=2*f+1,_=15,v=16,S=7,b=256,T=16,w=17,R=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],U=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],$=new Array(2*(f+2));c($);var I=new Array(2*d);c(I);var L=new Array(512);c(L);var P=new Array(256);c(P);var H=new Array(u);c(H);var X,G,Y,J=new Array(d);function Q(Oe,ae,ve,xe,pe){this.static_tree=Oe,this.extra_bits=ae,this.extra_base=ve,this.elems=xe,this.max_length=pe,this.has_stree=Oe&&Oe.length}function z(Oe,ae){this.dyn_tree=Oe,this.max_code=0,this.stat_desc=ae}function q(Oe){return Oe<256?L[Oe]:L[256+(Oe>>>7)]}function ee(Oe,ae){Oe.pending_buf[Oe.pending++]=255&ae,Oe.pending_buf[Oe.pending++]=ae>>>8&255}function te(Oe,ae,ve){Oe.bi_valid>v-ve?(Oe.bi_buf|=ae<<Oe.bi_valid&65535,ee(Oe,Oe.bi_buf),Oe.bi_buf=ae>>v-Oe.bi_valid,Oe.bi_valid+=ve-v):(Oe.bi_buf|=ae<<Oe.bi_valid&65535,Oe.bi_valid+=ve)}function ie(Oe,ae,ve){te(Oe,ve[2*ae],ve[2*ae+1])}function Ee(Oe,ae){for(var ve=0;ve|=1&Oe,Oe>>>=1,ve<<=1,0<--ae;);return ve>>>1}function Re(Oe,ae,ve){var xe,pe,ze=new Array(_+1),Je=0;for(xe=1;xe<=_;xe++)ze[xe]=Je=Je+ve[xe-1]<<1;for(pe=0;pe<=ae;pe++){var Xe=Oe[2*pe+1];Xe!==0&&(Oe[2*pe]=Ee(ze[Xe]++,Xe))}}function Te(Oe){var ae;for(ae=0;ae<f;ae++)Oe.dyn_ltree[2*ae]=0;for(ae=0;ae<d;ae++)Oe.dyn_dtree[2*ae]=0;for(ae=0;ae<p;ae++)Oe.bl_tree[2*ae]=0;Oe.dyn_ltree[2*b]=1,Oe.opt_len=Oe.static_len=0,Oe.last_lit=Oe.matches=0}function Pe(Oe){8<Oe.bi_valid?ee(Oe,Oe.bi_buf):0<Oe.bi_valid&&(Oe.pending_buf[Oe.pending++]=Oe.bi_buf),Oe.bi_buf=0,Oe.bi_valid=0}function We(Oe,ae,ve,xe){var pe=2*ae,ze=2*ve;return Oe[pe]<Oe[ze]||Oe[pe]===Oe[ze]&&xe[ae]<=xe[ve]}function it(Oe,ae,ve){for(var xe=Oe.heap[ve],pe=ve<<1;pe<=Oe.heap_len&&(pe<Oe.heap_len&&We(ae,Oe.heap[pe+1],Oe.heap[pe],Oe.depth)&&pe++,!We(ae,xe,Oe.heap[pe],Oe.depth));)Oe.heap[ve]=Oe.heap[pe],ve=pe,pe<<=1;Oe.heap[ve]=xe}function ht(Oe,ae,ve){var xe,pe,ze,Je,Xe=0;if(Oe.last_lit!==0)for(;xe=Oe.pending_buf[Oe.d_buf+2*Xe]<<8|Oe.pending_buf[Oe.d_buf+2*Xe+1],pe=Oe.pending_buf[Oe.l_buf+Xe],Xe++,xe===0?ie(Oe,pe,ae):(ie(Oe,(ze=P[pe])+h+1,ae),(Je=C[ze])!==0&&te(Oe,pe-=H[ze],Je),ie(Oe,ze=q(--xe),ve),(Je=N[ze])!==0&&te(Oe,xe-=J[ze],Je)),Xe<Oe.last_lit;);ie(Oe,b,ae)}function vt(Oe,ae){var ve,xe,pe,ze=ae.dyn_tree,Je=ae.stat_desc.static_tree,Xe=ae.stat_desc.has_stree,et=ae.stat_desc.elems,Ut=-1;for(Oe.heap_len=0,Oe.heap_max=m,ve=0;ve<et;ve++)ze[2*ve]!==0?(Oe.heap[++Oe.heap_len]=Ut=ve,Oe.depth[ve]=0):ze[2*ve+1]=0;for(;Oe.heap_len<2;)ze[2*(pe=Oe.heap[++Oe.heap_len]=Ut<2?++Ut:0)]=1,Oe.depth[pe]=0,Oe.opt_len--,Xe&&(Oe.static_len-=Je[2*pe+1]);for(ae.max_code=Ut,ve=Oe.heap_len>>1;1<=ve;ve--)it(Oe,ze,ve);for(pe=et;ve=Oe.heap[1],Oe.heap[1]=Oe.heap[Oe.heap_len--],it(Oe,ze,1),xe=Oe.heap[1],Oe.heap[--Oe.heap_max]=ve,Oe.heap[--Oe.heap_max]=xe,ze[2*pe]=ze[2*ve]+ze[2*xe],Oe.depth[pe]=(Oe.depth[ve]>=Oe.depth[xe]?Oe.depth[ve]:Oe.depth[xe])+1,ze[2*ve+1]=ze[2*xe+1]=pe,Oe.heap[1]=pe++,it(Oe,ze,1),2<=Oe.heap_len;);Oe.heap[--Oe.heap_max]=Oe.heap[1],(function(gt,At){var Ce,se,W,oe,Se,Ae,ye=At.dyn_tree,_e=At.max_code,Ye=At.stat_desc.static_tree,ke=At.stat_desc.has_stree,Ve=At.stat_desc.extra_bits,Fe=At.stat_desc.extra_base,Ge=At.stat_desc.max_length,at=0;for(oe=0;oe<=_;oe++)gt.bl_count[oe]=0;for(ye[2*gt.heap[gt.heap_max]+1]=0,Ce=gt.heap_max+1;Ce<m;Ce++)Ge<(oe=ye[2*ye[2*(se=gt.heap[Ce])+1]+1]+1)&&(oe=Ge,at++),ye[2*se+1]=oe,_e<se||(gt.bl_count[oe]++,Se=0,Fe<=se&&(Se=Ve[se-Fe]),Ae=ye[2*se],gt.opt_len+=Ae*(oe+Se),ke&&(gt.static_len+=Ae*(Ye[2*se+1]+Se)));if(at!==0){do{for(oe=Ge-1;gt.bl_count[oe]===0;)oe--;gt.bl_count[oe]--,gt.bl_count[oe+1]+=2,gt.bl_count[Ge]--,at-=2}while(0<at);for(oe=Ge;oe!==0;oe--)for(se=gt.bl_count[oe];se!==0;)_e<(W=gt.heap[--Ce])||(ye[2*W+1]!==oe&&(gt.opt_len+=(oe-ye[2*W+1])*ye[2*W],ye[2*W+1]=oe),se--)}})(Oe,ae),Re(ze,Ut,Oe.bl_count)}function re(Oe,ae,ve){var xe,pe,ze=-1,Je=ae[1],Xe=0,et=7,Ut=4;for(Je===0&&(et=138,Ut=3),ae[2*(ve+1)+1]=65535,xe=0;xe<=ve;xe++)pe=Je,Je=ae[2*(xe+1)+1],++Xe<et&&pe===Je||(Xe<Ut?Oe.bl_tree[2*pe]+=Xe:pe!==0?(pe!==ze&&Oe.bl_tree[2*pe]++,Oe.bl_tree[2*T]++):Xe<=10?Oe.bl_tree[2*w]++:Oe.bl_tree[2*R]++,ze=pe,Ut=(Xe=0)===Je?(et=138,3):pe===Je?(et=6,3):(et=7,4))}function Le(Oe,ae,ve){var xe,pe,ze=-1,Je=ae[1],Xe=0,et=7,Ut=4;for(Je===0&&(et=138,Ut=3),xe=0;xe<=ve;xe++)if(pe=Je,Je=ae[2*(xe+1)+1],!(++Xe<et&&pe===Je)){if(Xe<Ut)for(;ie(Oe,pe,Oe.bl_tree),--Xe!=0;);else pe!==0?(pe!==ze&&(ie(Oe,pe,Oe.bl_tree),Xe--),ie(Oe,T,Oe.bl_tree),te(Oe,Xe-3,2)):Xe<=10?(ie(Oe,w,Oe.bl_tree),te(Oe,Xe-3,3)):(ie(Oe,R,Oe.bl_tree),te(Oe,Xe-11,7));ze=pe,Ut=(Xe=0)===Je?(et=138,3):pe===Je?(et=6,3):(et=7,4)}}c(J);var $e=!1;function De(Oe,ae,ve,xe){te(Oe,(l<<1)+(xe?1:0),3),(function(pe,ze,Je,Xe){Pe(pe),ee(pe,Je),ee(pe,~Je),s.arraySet(pe.pending_buf,pe.window,ze,Je,pe.pending),pe.pending+=Je})(Oe,ae,ve)}i._tr_init=function(Oe){$e||((function(){var ae,ve,xe,pe,ze,Je=new Array(_+1);for(pe=xe=0;pe<u-1;pe++)for(H[pe]=xe,ae=0;ae<1<<C[pe];ae++)P[xe++]=pe;for(P[xe-1]=pe,pe=ze=0;pe<16;pe++)for(J[pe]=ze,ae=0;ae<1<<N[pe];ae++)L[ze++]=pe;for(ze>>=7;pe<d;pe++)for(J[pe]=ze<<7,ae=0;ae<1<<N[pe]-7;ae++)L[256+ze++]=pe;for(ve=0;ve<=_;ve++)Je[ve]=0;for(ae=0;ae<=143;)$[2*ae+1]=8,ae++,Je[8]++;for(;ae<=255;)$[2*ae+1]=9,ae++,Je[9]++;for(;ae<=279;)$[2*ae+1]=7,ae++,Je[7]++;for(;ae<=287;)$[2*ae+1]=8,ae++,Je[8]++;for(Re($,f+1,Je),ae=0;ae<d;ae++)I[2*ae+1]=5,I[2*ae]=Ee(ae,5);X=new Q($,C,h+1,f,_),G=new Q(I,N,0,d,_),Y=new Q(new Array(0),U,0,p,S)})(),$e=!0),Oe.l_desc=new z(Oe.dyn_ltree,X),Oe.d_desc=new z(Oe.dyn_dtree,G),Oe.bl_desc=new z(Oe.bl_tree,Y),Oe.bi_buf=0,Oe.bi_valid=0,Te(Oe)},i._tr_stored_block=De,i._tr_flush_block=function(Oe,ae,ve,xe){var pe,ze,Je=0;0<Oe.level?(Oe.strm.data_type===2&&(Oe.strm.data_type=(function(Xe){var et,Ut=4093624447;for(et=0;et<=31;et++,Ut>>>=1)if(1&Ut&&Xe.dyn_ltree[2*et]!==0)return o;if(Xe.dyn_ltree[18]!==0||Xe.dyn_ltree[20]!==0||Xe.dyn_ltree[26]!==0)return a;for(et=32;et<h;et++)if(Xe.dyn_ltree[2*et]!==0)return a;return o})(Oe)),vt(Oe,Oe.l_desc),vt(Oe,Oe.d_desc),Je=(function(Xe){var et;for(re(Xe,Xe.dyn_ltree,Xe.l_desc.max_code),re(Xe,Xe.dyn_dtree,Xe.d_desc.max_code),vt(Xe,Xe.bl_desc),et=p-1;3<=et&&Xe.bl_tree[2*B[et]+1]===0;et--);return Xe.opt_len+=3*(et+1)+5+5+4,et})(Oe),pe=Oe.opt_len+3+7>>>3,(ze=Oe.static_len+3+7>>>3)<=pe&&(pe=ze)):pe=ze=ve+5,ve+4<=pe&&ae!==-1?De(Oe,ae,ve,xe):Oe.strategy===4||ze===pe?(te(Oe,2+(xe?1:0),3),ht(Oe,$,I)):(te(Oe,4+(xe?1:0),3),(function(Xe,et,Ut,gt){var At;for(te(Xe,et-257,5),te(Xe,Ut-1,5),te(Xe,gt-4,4),At=0;At<gt;At++)te(Xe,Xe.bl_tree[2*B[At]+1],3);Le(Xe,Xe.dyn_ltree,et-1),Le(Xe,Xe.dyn_dtree,Ut-1)})(Oe,Oe.l_desc.max_code+1,Oe.d_desc.max_code+1,Je+1),ht(Oe,Oe.dyn_ltree,Oe.dyn_dtree)),Te(Oe),xe&&Pe(Oe)},i._tr_tally=function(Oe,ae,ve){return Oe.pending_buf[Oe.d_buf+2*Oe.last_lit]=ae>>>8&255,Oe.pending_buf[Oe.d_buf+2*Oe.last_lit+1]=255&ae,Oe.pending_buf[Oe.l_buf+Oe.last_lit]=255&ve,Oe.last_lit++,ae===0?Oe.dyn_ltree[2*ve]++:(Oe.matches++,ae--,Oe.dyn_ltree[2*(P[ve]+h+1)]++,Oe.dyn_dtree[2*q(ae)]++),Oe.last_lit===Oe.lit_bufsize-1},i._tr_align=function(Oe){te(Oe,2,3),ie(Oe,b,$),(function(ae){ae.bi_valid===16?(ee(ae,ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0):8<=ae.bi_valid&&(ae.pending_buf[ae.pending++]=255&ae.bi_buf,ae.bi_buf>>=8,ae.bi_valid-=8)})(Oe)}},{"../utils/common":41}],53:[function(t,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,r,i){(function(s){(function(o,a){if(!o.setImmediate){var c,l,u,h,f=1,d={},p=!1,m=o.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(o);_=_&&_.setTimeout?_:o,c={}.toString.call(o.process)==="[object process]"?function(T){Ga.nextTick(function(){S(T)})}:(function(){if(o.postMessage&&!o.importScripts){var T=!0,w=o.onmessage;return o.onmessage=function(){T=!1},o.postMessage("","*"),o.onmessage=w,T}})()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",b,!1):o.attachEvent("onmessage",b),function(T){o.postMessage(h+T,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(T){S(T.data)},function(T){u.port2.postMessage(T)}):m&&"onreadystatechange"in m.createElement("script")?(l=m.documentElement,function(T){var w=m.createElement("script");w.onreadystatechange=function(){S(T),w.onreadystatechange=null,l.removeChild(w),w=null},l.appendChild(w)}):function(T){setTimeout(S,0,T)},_.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var w=new Array(arguments.length-1),R=0;R<w.length;R++)w[R]=arguments[R+1];var C={callback:T,args:w};return d[f]=C,c(f),f++},_.clearImmediate=v}function v(T){delete d[T]}function S(T){if(p)setTimeout(S,0,T);else{var w=d[T];if(w){p=!0;try{(function(R){var C=R.callback,N=R.args;switch(N.length){case 0:C();break;case 1:C(N[0]);break;case 2:C(N[0],N[1]);break;case 3:C(N[0],N[1],N[2]);break;default:C.apply(a,N)}})(w)}finally{v(T),p=!1}}}}function b(T){T.source===o&&typeof T.data=="string"&&T.data.indexOf(h)===0&&S(+T.data.slice(h.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof sd<"u"?sd:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(y2)),y2.exports}var NDe=ODe();const PDe=wu(NDe),ree={"application/andrew-inset":["ez"],"application/appinstaller":["appinstaller"],"application/applixware":["aw"],"application/appx":["appx"],"application/appxbundle":["appxbundle"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/automationml-aml+xml":["aml"],"application/automationml-amlx+zip":["amlx"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cpl+xml":["cpl"],"application/cu-seeme":["cu"],"application/cwl":["cwl"],"application/dash+xml":["mpd"],"application/dash-patch+xml":["mpp"],"application/davmount+xml":["davmount"],"application/dicom":["dcm"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdf":["fdf"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["*js"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/media-policy-dataset+xml":["mpf"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["*mp4","*mpg4","mp4s","m4p"],"application/msix":["msix"],"application/msixbundle":["msixbundle"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg","one","onea"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-keys":["asc"],"application/pgp-signature":["sig","*asc"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/sql":["sql"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/watcherinfo+xml":["wif"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xfdf":["xfdf"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"application/zip+dotlottie":["lottie"],"audio/3gpp":["*3gpp"],"audio/aac":["adts","aac"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a","m4b"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avci":["avci"],"image/avcs":["avcs"],"image/avif":["avif"],"image/bmp":["bmp","dib"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/dpx":["dpx"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/ief":["ief"],"image/jaii":["jaii"],"image/jais":["jais"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpg","jpeg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm","jpgm"],"image/jpx":["jpx","jpf"],"image/jxl":["jxl"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/pjpeg":["jfif"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime","mht","mhtml"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/jt":["jt"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/prc":["prc"],"model/step":["step","stp","stpnc","p21","210"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/u3d":["u3d"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/javascript":["js","mjs"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["md","markdown"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/wgsl":["wgsl"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","*jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts","m2t","m2ts","mts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};Object.freeze(ree);var Wf=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},_E,kw,gb;class DDe{constructor(...e){_E.set(this,new Map),kw.set(this,new Map),gb.set(this,new Map);for(const t of e)this.define(t)}define(e,t=!1){for(let[r,i]of Object.entries(e)){r=r.toLowerCase(),i=i.map(a=>a.toLowerCase()),Wf(this,gb,"f").has(r)||Wf(this,gb,"f").set(r,new Set);const s=Wf(this,gb,"f").get(r);let o=!0;for(let a of i){const c=a.startsWith("*");if(a=c?a.slice(1):a,s?.add(a),o&&Wf(this,kw,"f").set(r,a),o=!1,c)continue;const l=Wf(this,_E,"f").get(a);if(l&&l!=r&&!t)throw new Error(`"${r} -> ${a}" conflicts with "${l} -> ${a}". Pass \`force=true\` to override this definition.`);Wf(this,_E,"f").set(a,r)}}return this}getType(e){if(typeof e!="string")return null;const t=e.replace(/^.*[/\\]/s,"").toLowerCase(),r=t.replace(/^.*\./s,"").toLowerCase(),i=t.length<e.length;return!(r.length<t.length-1)&&i?null:Wf(this,_E,"f").get(r)??null}getExtension(e){return typeof e!="string"?null:(e=e?.split?.(";")[0],(e&&Wf(this,kw,"f").get(e.trim().toLowerCase()))??null)}getAllExtensions(e){return typeof e!="string"?null:Wf(this,gb,"f").get(e.toLowerCase())??null}_freeze(){this.define=()=>{throw new Error("define() not allowed for built-in Mime objects. See https://github.com/broofa/mime/blob/main/README.md#custom-mime-instances")},Object.freeze(this);for(const e of Wf(this,gb,"f").values())Object.freeze(e);return this}_getTestState(){return{types:Wf(this,_E,"f"),extensions:Wf(this,kw,"f")}}}_E=new WeakMap,kw=new WeakMap,gb=new WeakMap;new DDe(ree)._freeze();var WR={},d$;function LDe(){if(d$)return WR;d$=1,Object.defineProperty(WR,"__esModule",{value:!0});function n(a){return typeof a=="string"?a.startsWith("#")?"hex":null:"r"in a&&"g"in a&&"b"in a?"rgb":"h"in a&&"s"in a&&"l"in a?"hsl":"h"in a&&"s"in a&&"v"in a?"hsv":null}function e(a){const c=a.replace("#",""),l=parseInt(c.substring(0,2),16),u=parseInt(c.substring(2,4),16),h=parseInt(c.substring(4,6),16);return{r:l,g:u,b:h}}function t(a){const{r:c,g:l,b:u}=a;return`#${(c<<16|l<<8|u).toString(16).padStart(6,"0")}`}function r(a,c,l){c/=100,l/=100;const u=d=>(d+a/30)%12,h=c*Math.min(l,1-l),f=d=>l-h*Math.max(-1,Math.min(u(d)-3,Math.min(9-u(d),1)));return{r:Math.round(f(0)*255),g:Math.round(f(8)*255),b:Math.round(f(4)*255)}}function i(a,c,l){c/=100,l/=100;const u=f=>(f+a/60)%6,h=f=>l-l*c*Math.max(0,Math.min(u(f),4-u(f),1));return{r:Math.round(h(5)*255),g:Math.round(h(3)*255),b:Math.round(h(1)*255)}}function s(a,c){const l=Math.abs(a.r-c.r),u=Math.abs(a.g-c.g),h=Math.abs(a.b-c.b),f=1-l/255,d=1-u/255,p=1-h/255;return(f+d+p)/3}function o(a){let c=Math.min(Math.max(a.similarityThreshold||.8,.01),1);const{targetColor:l,colorArray:u}=a,h=n(l);if(h===null)return null;let f;if(h==="hex")f=e(l);else if(h==="rgb")f=l;else if(h==="hsl"){const{h:m,s:_,l:v}=l;f=r(m,_,v)}else if(h==="hsv"){const{h:m,s:_,v}=l;f=i(m,_,v)}else return null;let d=null,p=0;for(const m of u){n(m.hex?m.hex:m.rgb),m.hex?m.rgb||(m.rgb=e(m.hex)):m.hex=t(m.rgb);const _=Math.round(s(f,m.rgb)*100)/100;_>=c&&_>p&&(p=_,d={name:m.name,hex:m.hex,rgb:m.rgb,similarity:_})}return d}return WR.default=o,WR}LDe();function yx(n,e=16){return n?ax(e-1).map(t=>{const r=t*nA;return new Ti(n.bits[r]/63,n.bits[r+1]/63,n.bits[r+2]/63)}):[]}async function iee(n){const e=new FormData;e.append("url",n);const t=new Request("https://bytes.zed.cafe",{method:"POST",body:e});return await(await fetch(t)).text()}function see(){return location.href.includes("/join/")}async function UDe(n,e){const t=new FormData;t.append("email",n),t.append("tag",e);const r=new Request("https://bbs.zed.cafe/api/login",{method:"POST",body:t});return await(await fetch(r)).json()}async function BDe(n,e){const t=new FormData;t.append("email",n),t.append("code",e);const r=new Request("https://bbs.zed.cafe/api/code",{method:"POST",body:t});return await(await fetch(r)).json()}async function FDe(n,e){const t=new FormData;t.append("email",n),t.append("code",e);const r=new Request("https://bbs.zed.cafe/api/list",{method:"POST",body:t});return await(await fetch(r)).json()}async function jDe(n,e,t,r,i){const s=new FormData;s.append("email",n),s.append("code",e),s.append("filename",t),s.append("url",r),s.append("tags",i.join(","));const o=new Request("https://bbs.zed.cafe/api/publish",{method:"POST",body:s});return await(await fetch(o)).json()}async function zDe(n,e,t){const r=new FormData;r.append("email",n),r.append("code",e),r.append("filename",t);const i=new Request("https://bbs.zed.cafe/api/delete",{method:"POST",body:r});return await(await fetch(i)).json()}function oo(n,e,t){t().catch(r=>{console.error(r),_r(n,e,"crash",r?.message)})}function qR(n){if(Qm(n)!==Jr.TERRAIN&&Qm(n)!==Jr.OBJECT)return"";const t={kind:cc(n)};return Sp(t),`${oee(t)}$ONCLEAR$BLUE `}function oee(n){const e=xu(n),t=`${Ft[e.color]}`,r=`${Ft[e.bg>Ft.WHITE?Ft.BLACK:e.bg]}`;return`$${t}$ON${r}$${e.char}`}function $De(n){if(!he(n?.id))return"";let e=xu(n).name;if(n.kind==="player"){const{user:r}=G0(n.id);e=un(r)?r:"player"}return`${oee(n)}$ONCLEAR$CYAN ${e}:$WHITE `}new zn;function bx(n,e=!1){const[t,r]=Pt(n,0,[lt.ANY]);if(e&&_d(t)){const[i,s,o]=Pt(n,0,[lt.DIR,lt.NAME]);return s.startsWith(":")?{targetdir:i,label:s.substring(1).trim(),args:n.slice(o)}:{targetdir:i,label:s,args:n.slice(o)}}else{const[i,s,o]=Pt(n,0,[lt.NAME,lt.ANY]);return un(s)&&s.startsWith(":")?{targetname:i,label:s.substring(1).trim(),args:n.slice(o)}:{targetname:"self",label:i,args:n.slice(r)}}}let R0="",ep="";function VDe(n){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.exec(String(n).toLowerCase())}function ja(n){return n===$m()}function JS(){Sxe(qe,$m())}const HDe=ty().command("shortsend",(n,e)=>{const t=bx(e);return t.targetname==="self"?Th(qe,fe.elementfocus,void 0,"text",`cli:${t.label}`,t.args.join(" ")):Ex(n,fe.element,t),0}).command("send",(n,e)=>{const t=bx(e,!0);return Ex(n,fe.element,t),0}).command("stat",(n,e)=>(mxe(qe,fe.elementfocus,e.map(ro).join(" ")),0)).command("text",(n,e)=>{const t=e.map(ro).join(" ");if(he(fe.element)&&fe.elementisplayer){fe.element.tickertext=t,fe.element.tickertime=fe.timestamp,AU("",fe.element,t);const{user:r}=G0(fe.elementid),i=un(r)?r:"player";Th(qe,fe.elementid,void 0,"text",`chat:message:${fe.board?.id??""}`,`${i}:${t}`)}return 0}).command("hyperlink",(n,e)=>{const[t,...r]=e,{user:i}=G0(fe.elementid),s=un(i)?i:"player",o=xu(fe.element),a=`$${Ft[o.color]}$ON${Ft[o.bg]}$${o.char}$ONCLEAR $WHITE${s}$BLUE `,c=n.template(ro(t).split(" "));return fs(qe,fe.elementid,`!${n.template(r)};${a}${c}`),0}).command("bookrename",()=>{if(!ja(fe.elementfocus))return 0;const n=Iv(ac.MAIN);return nTe(n),he(n)&&dh(qe,fe.elementfocus,"main",`${n?.name??"empty"} $GREEN${n?.id??""}`),0}).command("booktrash",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.NAME]),r=Um(ac.MAIN),i=Mv(t);return he(i)&&(r===i&&XZ(ac.MAIN,""),fTe(t),fs(qe,fe.elementfocus,`trashed [book] ${i.name}`),JS(),n.command("pages")),0}).command("boardopen",(n,e)=>{const[t]=Pt(e,0,[lt.NAME]),r=Cs(t);return he(r)&&RE(fe.book,fe.elementfocus,r.id,{x:mu(0,bn-1),y:mu(0,wr-1)}),0}).command("pageopen",(n,e)=>{const[t,r]=Pt(e,0,[lt.NAME,lt.MAYBE_NAME]);let i,s;const o=Mm();for(let a=0;a<o.length&&(s=o[a],i=pA(s,t),!he(i));++a);if(he(i)&&he(s)){const a=cc(i),c=[i.id,r];zQ(KY(s.id,c),i.code);const l=Jy(i),u=`${qR(i)}$ONCLEAR$GREEN ${a} - ${s.name}`;exe(qe,fe.elementfocus,s.id,c,l,u)}else _r(qe,"pageopen",`page ${t} not found`,fe.elementfocus);return 0}).command("pagetrash",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.NAME]),r=Iv(ac.MAIN),i=qZ(r,t);if(he(t)){const s=cc(i),o=Jy(i);fs(qe,fe.elementfocus,`trashed [${o}] ${s}`),JS(),n.command("pages")}return 0}).command("help",()=>(m6(qe,fe.elementfocus),0)).command("books",()=>{if(!ja(fe.elementfocus))return 0;mb(qe,fe.elementfocus,"books");const n=Um(ac.MAIN);dh(qe,fe.elementfocus,"main",`${n?.name??"empty"} $GREEN${n?.id??""}`);const e=Um(ac.MAIN);dh(qe,fe.elementfocus,"content",`${e?.name??"empty"} ${e?.id??""}`),xU(qe,fe.elementfocus,7);const t=Mm();return t.length?t.forEach(r=>{zr(qe,fe.elementfocus,`!bookopen ${r.id};${r.name}`)}):no(qe,fe.elementfocus,"no books found"),zr(qe,fe.elementfocus,"!bookcreate;create a new book"),0}).command("pages",()=>{const n=Iv(ac.MAIN);if(!he(n))return 0;mb(qe,fe.elementfocus,"pages"),dh(qe,fe.elementfocus,"main",`${n.name} $GREEN${n.id}`),n.pages.length?KT(n).forEach(r=>{const i=cc(r),s=Jy(r),o=qR(r);zr(qe,fe.elementfocus,`!pageopen ${r.id};$blue[${s}] ${o}$white${i}`)}):(zr(qe,fe.elementfocus,""),nee(tee("help:nopages"),t=>MDe(fe.elementfocus,t)));const e=Mm();for(let t=0;t<e.length;++t){const r=e[t];r.id!==n.id&&(dh(qe,fe.elementfocus,"content",`${r.name} $GREEN${r.id}`),KT(r).forEach(s=>{const o=cc(s),a=Jy(s);zr(qe,fe.elementfocus,`!pageopen ${s.id};$blue[${a}]$white ${o}`)}))}return 0}).command("boards",()=>{mb(qe,fe.elementfocus,"boards");const n=Iv(ac.MAIN);if(he(n)){dh(qe,fe.elementfocus,"main",`${n.name} $GREEN${n.id}`);const t=KT(n);t.filter(r=>Qm(r)===Jr.BOARD).forEach(r=>{const i=cc(r);zr(qe,fe.elementfocus,`!boardopen ${r.id};$blue[#goto]$white ${i}`)}),t.length===0&&(zr(qe,fe.elementfocus,""),no(qe,fe.elementfocus,"$white no boards found"),no(qe,fe.elementfocus,"$white use @ to create a board"),no(qe,fe.elementfocus,"$white @board name of board"))}const e=Mm();for(let t=0;t<e.length;++t){const r=e[t];r.id!==n.id&&(dh(qe,fe.elementfocus,"content",`${r.name} $GREEN${r.id}`),KT(r).filter(s=>Qm(s)===Jr.BOARD).forEach(s=>{const o=cc(s);zr(qe,fe.elementfocus,`!boardopen ${s.id};$blue[#goto]$white ${o}`)}))}return 0}).command("trash",()=>{if(!ja(fe.elementfocus))return 0;mb(qe,fe.elementfocus,"$REDTRASH"),no(qe,fe.elementfocus,"books");const n=Mm();n.length&&(n.forEach(t=>{zr(qe,fe.elementfocus,`!booktrash ${t.id};$REDTRASH ${t.name}`)}),zr(qe,fe.elementfocus,""));const e=Um(ac.MAIN);return he(e)&&(no(qe,fe.elementfocus,`pages in open ${e.name} book`),e.pages.forEach(t=>{const r=cc(t),i=Jy(t),s=qR(t);zr(qe,fe.elementfocus,`!pagetrash ${t.id};$REDTRASH [${i}] ${s}${r}`)}),zr(qe,fe.elementfocus,"")),0}).command("dev",()=>(ja(fe.elementfocus)&&(JS(),oxe(qe,fe.elementfocus)),0)).command("share",()=>(ja(fe.elementfocus)&&(JS(),DEe(qe,fe.elementfocus)),0)).command("save",()=>(ja(fe.elementfocus)&&JS(),0)).command("fork",(n,e)=>{if(ja(fe.elementfocus)){const[t]=Pt(e,0,[lt.MAYBE_NAME]);Exe(qe,fe.elementfocus,t??"")}return 0}).command("nuke",()=>(ja(fe.elementfocus)&&LEe(qe,fe.elementfocus),0)).command("endgame",()=>(WY(qe,fe.elementfocus,!1),0)).command("restart",()=>(ja(fe.elementfocus)&&(bxe(qe,fe.elementfocus),JS()),0)).command("export",()=>{if(!ja(fe.elementfocus))return 0;Hv(qe,fe.elementfocus,"E X P O R T"),mb(qe,fe.elementfocus,"books");const n=Mm();return n.length&&n.forEach(e=>zr(qe,fe.elementfocus,`!bookexport ${e.id};${e.name}`)),0}).command("bookexport",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.NAME]),r=Mv(t);return he(r)&&(Hv(qe,fe.elementfocus,"E X P O R T"),mb(qe,fe.elementfocus,"pages"),setTimeout(()=>{if(r.pages.length){const i=KT(r);zr(qe,fe.elementfocus,`!bookallexport ${t};$blue[all] $whiteexport book`),i.forEach(s=>{const o=cc(s),a=Jy(s),c=qR(s);zr(qe,fe.elementfocus,`!pageexport ${t}:${s.id};$blue[${a}] ${c}$white${o}`)})}},1e3)),0}).command("bookallexport",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.NAME]),r=Mv(t);return he(r)&&Q9(qe,fe.elementfocus,Ks(r),`${r.name}.book.json`),0}).command("pageexport",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.NAME]),{target:r,path:i}=Vv(t),s=Mv(r),o=pA(s,i);return he(o)&&Q9(qe,fe.elementfocus,Ks(o),`${cc(o)}.${Jy(o)}.json`),0}).command("itchiopublish",()=>{if(!ja(fe.elementfocus))return 0;const n=Um(ac.MAIN);return tj(qe,fe.elementfocus,"itchio",n?.name??""),0}).command("gadget",()=>(QEe(qe,fe.elementfocus,void 0),0)).command("findany",(n,e)=>{const[t]=Pt(e,0,[lt.ANY]);if(sr(t)){const r=t.filter(Dv);ej(qe,fe.elementfocus,r)}else ej(qe,fe.elementfocus,[]);return 0}).command("zztsearch",(n,e)=>{const[t,r]=Pt(e,0,[lt.NAME,lt.MAYBE_NAME]),i=he(r)?t:"title",s=he(r)?r:t;return ixe(qe,fe.elementfocus,i,s),0}).command("zztrandom",()=>(sxe(qe,fe.elementfocus),0)).command("admin",()=>(rxe(qe,fe.elementfocus),0)).command("joincode",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.MAYBE_NAME]),r=bJ(fe.elementfocus);return he(r)?AEe(qe,fe.elementfocus,!!t):_r(qe,fe.elementfocus,"multiplayer","need to have an active player on a board in order to start multiplayer"),0}).command("jointab",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.MAYBE_NAME]);return CEe(qe,fe.elementfocus,!!t),0}).command("chat",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.MAYBE_NAME]);return t?EEe(qe,fe.elementfocus,t):xEe(qe,fe.elementfocus),0}).command("broadcast",(n,e)=>{if(!ja(fe.elementfocus))return 0;const[t]=Pt(e,0,[lt.MAYBE_NAME]);return t?bEe(qe,fe.elementfocus,t):SEe(qe,fe.elementfocus),0}).command("agent",(n,e)=>{const[t,r]=Pt(e,0,[lt.MAYBE_NAME]);switch(cr(t)){case"start":hxe(qe,fe.elementfocus);break;case"stop":{const[i]=Pt(e,1,[lt.NAME]);he(i)?fxe(qe,fe.elementfocus,i):_r(qe,fe.elementfocus,"agent","#agent stop <id>");break}case"":case"list":dxe(qe,fe.elementfocus);break;default:{if(un(t)){let i=r;const s=[];for(;i<e.length;){const[o,a]=Pt(e,i,[lt.ANY]);s.push(o),i=a}pxe(qe,fe.elementfocus,t,s.map(ro).join(" "))}else _r(qe,fe.elementfocus,"agent","#agent <id> <prompt>");break}}return 0}).command("screenshot",()=>(PEe(qe,fe.elementfocus),0)).command("bbs",(n,e)=>{const[t,r]=Pt(e,0,[lt.ANY]);switch(cr(t)){default:if(ep)R0?no(qe,fe.elementfocus,"you are already logged in, use #bbs restart to login again"):oo(qe,fe.elementfocus,async()=>{no(qe,fe.elementfocus,`confirming login with $green${t}`),(await BDe(ep,t)).success&&(R0=`${t}`,no(qe,fe.elementfocus,`$green${ep} has been logged in`))});else{const[i,s]=Pt(e,0,[lt.NAME,lt.NAME]);VDe(i)&&s?oo(qe,fe.elementfocus,async()=>{no(qe,fe.elementfocus,`starting login with $green${i} ${s}`),(await UDe(i,s)).success&&(ep=i,no(qe,fe.elementfocus,"check your email for #bbs <code>"))}):no(qe,fe.elementfocus,"please login with $green#bbs <email> <tag>")}break;case"restart":ep="",R0="",no(qe,fe.elementfocus,"bbs restarted"),no(qe,fe.elementfocus,"please login with $green#bbs <email> <tag>");break;case"list":!ep||!R0?no(qe,fe.elementfocus,"please login with $green#bbs <email> <tag>$blue first"):oo(qe,fe.elementfocus,async()=>{no(qe,fe.elementfocus,"listing files");const i=await FDe(ep,R0);if(i.success)for(let s=0;s<i.list.length;++s){const{metadata:o}=i.list[s];bDe(qe,fe.elementfocus,o.url,o.filename),no(qe,fe.elementfocus,o.tags)}});break;case"pub":case"publish":if(!ep||!R0)no(qe,fe.elementfocus,"please login with $green#bbs <email> <tag>$blue first");else{const[i,s]=Pt(e,r,[lt.NAME]),o=[];for(let a=s;a<e.length;){const[c,l]=Pt(e,a,[lt.NAME]);a=l,o.push(c)}tj(qe,fe.elementfocus,"bbs",ep,R0,i,...o)}break;case"del":case"delete":if(!ep||!R0)no(qe,fe.elementfocus,"please login with $green#bbs <email> <tag>$blue first");else{const[i]=Pt(e,r,[lt.NAME]);oo(qe,fe.elementfocus,async()=>{no(qe,fe.elementfocus,`deleting ${i}`),(await zDe(ep,R0,i)).success&&no(qe,fe.elementfocus,`$red${i} has been deleted`)})}break}return 0}),GDe=new Set(["inputmove","inputalt","inputctrl","inputshift","inputok","inputcancel","inputmenu"]),p$=new Set(["char","color","bg","displaychar","displaycolor","displaybg","item","group","party","player","pushable","collision","breakable","p1","p2","p3","p4","p5","p6","p7","p8","p9","p10","cycle","stepx","stepy","shootx","shooty","light","lightdir","arg"]),WDe=["NORTH","SOUTH","WEST","EAST"];function qDe(n,e,t){const r=G0(n);if(rn(r.inputcurrent)||(r.inputcurrent=0),sr(r.inputqueue)||(r.inputqueue=[]),r.inputcurrent>0)return r;const[i]=r.inputqueue,[s=Ct.NONE,o=0]=i??[Ct.NONE,0];switch(r.inputmove=[],r.inputok=0,r.inputcancel=0,r.inputmenu=0,r.inputalt=o&I5?1:0,r.inputctrl=o&O5?1:0,r.inputshift=o&N5?1:0,s){case Ct.MOVE_UP:case Ct.MOVE_DOWN:case Ct.MOVE_LEFT:case Ct.MOVE_RIGHT:{const a=WDe[s-Ct.MOVE_UP];if(un(e)&&e==="fpv"&&rn(t))switch(Math.round(t/90)){default:case 0:r.inputmove=[a];break;case 1:switch(a){default:case"NORTH":r.inputmove=["EAST"];break;case"EAST":r.inputmove=["SOUTH"];break;case"SOUTH":r.inputmove=["WEST"];break;case"WEST":r.inputmove=["NORTH"];break}break;case 2:switch(a){default:case"NORTH":r.inputmove=["SOUTH"];break;case"EAST":r.inputmove=["WEST"];break;case"SOUTH":r.inputmove=["NORTH"];break;case"WEST":r.inputmove=["EAST"];break}break;case 3:switch(a){default:case"NORTH":r.inputmove=["WEST"];break;case"EAST":r.inputmove=["NORTH"];break;case"SOUTH":r.inputmove=["EAST"];break;case"WEST":r.inputmove=["SOUTH"];break}break}else r.inputmove=[a];break}case Ct.OK_BUTTON:r.inputok=1;break;case Ct.CANCEL_BUTTON:r.inputcancel=1;break;case Ct.MENU_BUTTON:r.inputmenu=1;break}return r.inputcurrent=s,r.inputqueue=r.inputqueue.filter(a=>{const[c]=a;return c!==Ct.NONE&&c!==s}),r}function YDe(n){const e=xJ[n];if(he(e))return e;const t=SJ[n];if(he(t))return t;const r=KO[n];if(he(r))return r;const i=eK[n];if(he(i))return i}const KDe=ty({get(n,e){const t=YDe(e);if(he(t))return[!0,t];if(fe.elementisplayer&&GDe.has(e)){const c=n.get("graphics"),l=n.get("facing"),u=qDe(fe.elementid,c,l)[e];return[he(u),u]}const r=zw(fe.board,{x:fe.element?.x??-1,y:fe.element?.y??-1},fe.elementfocus),i=r?.id??fe.elementfocus??$m(),s=fe.element?.sender,o=dee(fe.board,un(s)?s:"");switch(e){case"camera":case"graphics":case"facing":{const c=G0(i)[e];return[!0,he(c)?c:fe.board?.[e]??0]}case"isdark":return[!0,fe.board?.isdark?1:0];case"startx":return[!0,fe.board?.startx??0];case"starty":return[!0,fe.board?.starty??0];case"over":return[!0,fe.board?.over??""];case"under":return[!0,fe.board?.under??""];case"palette":return[!0,fe.board?.palette??""];case"charset":return[!0,fe.board?.charset??""];case"exitnorth":return[!0,fe.board?.exitnorth??""];case"exitsouth":return[!0,fe.board?.exitsouth??""];case"exitwest":return[!0,fe.board?.exitwest??""];case"exiteast":return[!0,fe.board?.exiteast??""];case"timelimit":return[!0,fe.board?.timelimit??0];case"restartonzap":return[!0,fe.board?.restartonzap??0];case"maxplayershots":return[!0,fe.board?.maxplayershots??0];case"b1":return[!0,fe.board?.b1??0];case"b2":return[!0,fe.board?.b2??0];case"b3":return[!0,fe.board?.b3??0];case"b4":return[!0,fe.board?.b4??0];case"b5":return[!0,fe.board?.b5??0];case"b6":return[!0,fe.board?.b6??0];case"b7":return[!0,fe.board?.b7??0];case"b8":return[!0,fe.board?.b8??0];case"b9":return[!0,fe.board?.b9??0];case"b10":return[!0,fe.board?.b10??0];case"currenttick":return[!0,fe.timestamp];case"boardid":return[!0,fe.board?.id??""];case"playerid":return[!0,i];case"playerx":return[!0,r?.x??-1];case"playery":return[!0,r?.y??-1];case"thisid":return[!0,fe.element?.id??""];case"thisx":return[!0,fe.element?.x??-1];case"thisy":return[!0,fe.element?.y??-1];case"senderid":return[!0,o?.id??""];case"senderx":return[!0,o?.x??-1];case"sendery":return[!0,o?.y??-1];default:{if(p$.has(e))return[!0,ri(fe.element,e)??0];break}}const a=G0(i)[e];return[he(a),a]},set(n,e,t){const r={x:fe.element?.x??-1,y:fe.element?.y??-1},s=zw(fe.board,r,fe.elementfocus)?.id??fe.elementfocus;switch(e){case"camera":case"graphics":break;case"facing":t=_W.euclideanModulo(t,360);break;case"isdark":if(he(fe.board))return fe.board.isdark=t?1:0,[!0,fe.board.isdark];break;case"startx":if(he(fe.board))return fe.board.startx=Rb(t,0),[!0,fe.board.startx];break;case"starty":if(he(fe.board))return fe.board.starty=Rb(t,0),[!0,fe.board.starty];break;case"over":if(he(fe.board)){const a=ro(t);return fe.board.over!==a&&(fe.board.overboard=void 0),fe.board.over=a,[!0,a]}break;case"under":if(he(fe.board)){const a=ro(t);return fe.board.under!==a&&(fe.board.underboard=void 0),fe.board.under=a,[!0,a]}break;case"palette":if(he(fe.board)){const a=ro(t);return fe.board.palette!==a&&(fe.board.palettepage=void 0),fe.board.palette=a,[!0,a]}break;case"charset":if(he(fe.board)){const a=ro(t);return fe.board.charset!==a&&(fe.board.charsetpage=void 0),fe.board.charset=a,[!0,a]}break;case"exitnorth":if(he(fe.board))return[!0,fe.board.exitnorth=ro(t)];break;case"exitsouth":if(he(fe.board))return[!0,fe.board.exitsouth=ro(t)];break;case"exitwest":if(he(fe.board))return[!0,fe.board.exitwest=ro(t)];break;case"exiteast":if(he(fe.board))return[!0,fe.board.exiteast=ro(t)];break;case"timelimit":if(he(fe.board))return[!0,fe.board.timelimit=Rb(t,0)];break;case"restartonzap":if(he(fe.board))return[!0,fe.board.restartonzap=t?1:0];break;case"maxplayershots":if(he(fe.board))return[!0,fe.board.maxplayershots=Rb(t,0)];break;case"b1":if(he(fe.board))return[!0,fe.board.b1=t];break;case"b2":if(he(fe.board))return[!0,fe.board.b2=t];break;case"b3":if(he(fe.board))return[!0,fe.board.b3=t];break;case"b4":if(he(fe.board))return[!0,fe.board.b4=t];break;case"b5":if(he(fe.board))return[!0,fe.board.b5=t];break;case"b6":if(he(fe.board))return[!0,fe.board.b6=t];break;case"b7":if(he(fe.board))return[!0,fe.board.b7=t];break;case"b8":if(he(fe.board))return[!0,fe.board.b8=t];break;case"b9":if(he(fe.board))return[!0,fe.board.b9=t];break;case"b10":if(he(fe.board))return[!0,fe.board.b10=t];break;case"currenttick":case"boardid":return[!0,t];case"playerid":case"playerx":case"playery":return[!0,t];case"thisid":case"thisx":case"thisy":return[!0,t];case"senderid":return he(fe.element)&&(fe.element.sender=t),[!0,t];case"senderx":case"sendery":return[!0,t];default:{if(p$.has(e)){if(he(fe.element))switch(e){case"color":if(dc(t)){const{color:a,bg:c}=kE(t);he(a)&&(fe.element.color=a),he(c)&&(fe.element.bg=c)}else rn(t)&&(fe.element.color=t);break;case"bg":if(dc(t)){const{color:a,bg:c}=kE(t);fe.element.bg=a??c??Ft.PURPLE}else rn(t)&&(fe.element.bg=t);break;case"displaycolor":if(dc(t)){const{color:a,bg:c}=kE(t);he(a)&&(fe.element.displaycolor=a),he(c)&&(fe.element.displaybg=c)}else rn(t)&&(fe.element.displaycolor=t);break;case"displaybg":{if(dc(t)){const{color:a,bg:c}=kE(t);fe.element.displaybg=a??c??Ft.PURPLE}else rn(t)&&(fe.element.displaybg=t);break}default:fe.element[e]=t;break}return[!0,t]}break}}const o=G0(s);return he(o)?(o[e]=t,e==="user"&&JEe(qe,s,e,t),[!0,t]):[!1,t]},everytick(n){if(fe.elementisplayer){const e=n.get("health");rn(e)&&e<=0&&(n.endofprogram(),WY(qe,fe.elementid,!0))}!fe.element?.removed&&he(fe.element?.x)&&he(fe.element.y)&&he(fe.element.stepx)&&he(fe.element.stepy)&&(fe.element.stepx||fe.element.stepy)&&ff(fe.book,fe.board,fe.element,{x:fe.element.x+fe.element.stepx,y:fe.element.y+fe.element.stepy})}}).command("clear",(n,e)=>{for(let t=0;t<e.length;++t)n.set(ro(e[t]),0);return 0}).command("set",(n,e)=>{const[t,r]=Pt(e,0,[lt.NAME,lt.ANY]);return n.set(t,r??1),0}).command("become",(n,e)=>{const[t]=Pt(e,0,[lt.KIND]),r=xu(fe.element),[i,s]=t,o=[...XO(r.color,r.bg),...s??[]],a=[i,o];if(z6(fe.board,fe.element),fd(fe.board,fe.element,fe.timestamp)){const c={x:fe.element?.x??0,y:fe.element?.y??0};hd(fe.board,a,c)}return n.endofprogram(),0}).command("bind",(n,e)=>{const[t]=Pt(e,0,[lt.NAME]),r=Wx(fe.board,t);return he(fe.element)&&r.length>0&&(fe.element.code=td(...r).code??"",o2(fe.elementid)),0}).command("char",(n,e)=>{const[t]=Pt(e,0,[lt.ANY]);if(_d(t)){const[r,i]=Pt(e,0,[lt.DIR,lt.NUMBER]);if(r.targets.length){for(let o=0;o<r.targets.length;++o){const a=r.targets[o],c=ds(fe.board,a);he(c)&&(c.char=i)}return 0}const s=ds(fe.board,r.destpt);he(s)&&(s.char=i)}else he(fe.element)&&rn(t)&&(fe.element.char=t);return 0}).command("color",(n,e)=>{const[t]=Pt(e,0,[lt.ANY]);if(_d(t)){const[r,i]=Pt(e,0,[lt.DIR,lt.COLOR]);if(r.targets.length){for(let o=0;o<r.targets.length;++o){const a=r.targets[o],c=ds(fe.board,a);he(c)&&Pb(c,i??Ft.PURPLE)}return 0}const s=ds(fe.board,r.destpt);he(s)&&Pb(s,i??Ft.PURPLE)}else{const[r]=Pt(e,0,[lt.COLOR]);he(fe.element)&&he(r)&&Pb(fe.element,r)}return 0}).command("go",(n,e)=>{if(he(fe.element)){const[t]=Pt(e,0,[lt.DIR]);if(ff(fe.book,fe.board,fe.element,t.destpt),n.yield(),fe.element.x===t.destpt.x&&fe.element.y===t.destpt.y)return 0}return 1}).command("walk",(n,e)=>{if(!he(fe.element))return 0;const[t]=Pt(e,0,[lt.DIR]),r=fe.element.x??0,i=fe.element.y??0;return fe.element.stepx=t.destpt.x-r,fe.element.stepy=t.destpt.y-i,0}).command("idle",n=>(n.yield(),0)).command("end",(n,e)=>{const[t]=Pt(e,0,[lt.ANY]);return he(t)&&n.set("arg",t),n.endofprogram(),0}).command("lock",n=>(n.lock(n.id()),0)).command("restore",(n,e)=>(n.restore(ro(e[0])),0)).command("unlock",n=>(n.unlock(),0)).command("zap",(n,e)=>(n.zap(ro(e[0])),0)).command("cycle",(n,e)=>{if(he(fe.element)){const[t]=Pt(e,0,[lt.NUMBER]);fe.element.cycle=Ri(Math.round(t),1,255)}return 0}).command("die",n=>{if(fd(fe.board,fe.element,fe.timestamp),ri(fe.element,"item")){const e={x:fe.element?.x??-1,y:fe.element?.y??-1},t=zw(fe.board,e,fe.elementfocus);he(t?.x)&&he(t.y)&&Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<2&&(t.x=e.x,t.y=e.y)}else n.endofprogram();return 0}).command("run",(n,e)=>{const[t]=Pt(e,0,[lt.NAME]);return JM(t),0}).command("runwith",(n,e)=>{const[t,r]=Pt(e,0,[lt.ANY,lt.NAME]);return n.set("arg",t),JM(r),0}).command("array",(n,e)=>{const t=[],[r,i]=Pt(e,0,[lt.NAME]);for(let s=i;s<e.length;){const[o,a]=Pt(e,s,[lt.ANY]);t.push(o),s=a}return n.set(r,t),0}).command("read",(n,e)=>{const[t,r,i]=Pt(e,0,[lt.ANY,lt.NUMBER_OR_STRING,lt.NAME]);if(he(t)){const s=t[r];n.set(i,s)}return 0}).command("load",(n,e)=>{const[t,r,i]=Pt(e,0,[lt.DIR,lt.NAME]),s=ds(fe.board,t.destpt);if(he(s)&&As(s))if(cr(r)==="append"){const[o]=Pt(e,i,[lt.NAME]),a=vu(Jr.OBJECT,o);he(a)&&(s.code+=a.code,o2(s.id??""))}else{const o=vu(Jr.OBJECT,r);he(o)&&(s.code=o.code,o2(s.id??""))}return 0}).command("toast",(n,e)=>{const t=e.map(ro).join("");return jY(qe,fe.elementfocus,t),0}).command("ticker",(n,e)=>{const t=e.map(ro).join("");return he(fe.element)&&(fe.element.tickertext=t,fe.element.tickertime=fe.timestamp,AU(fe.board?.id,fe.element,t)),0});function m$(n,e){if(!he(n))return;const t=cr(e),r=t.endsWith("le");switch(t){case"float32":case"float32le":{const i=n.dataview.getFloat32(n.cursor,r);return n.cursor+=4,i}case"float64":case"float64le":{const i=n.dataview.getFloat64(n.cursor,r);return n.cursor+=8,i}case"int8":case"int8le":{const i=n.dataview.getInt8(n.cursor);return n.cursor+=1,i}case"int16":case"int16le":{const i=n.dataview.getInt16(n.cursor,r);return n.cursor+=2,i}case"int32":case"int32le":{const i=n.dataview.getInt32(n.cursor,r);return n.cursor+=4,i}case"int64":case"int64le":{const i=n.dataview.getBigInt64(n.cursor,r);return n.cursor+=8,i}case"uint8":case"uint8le":{const i=n.dataview.getUint8(n.cursor);return n.cursor+=1,i}case"uint16":case"uint16le":{const i=n.dataview.getUint16(n.cursor,r);return n.cursor+=2,i}case"uint32":case"uint32le":{const i=n.dataview.getUint32(n.cursor,r);return n.cursor+=4,i}case"uint64":case"uint64le":{const i=n.dataview.getBigUint64(n.cursor,r);return n.cursor+=8,i}}}const XDe=(n,e)=>{const t=zE(n.id());if(!he(t))return 0;const[r,i]=Pt(e,0,[lt.NAME]),s=cr(r);switch(s){case"seek":{const[o]=Pt(e,i,[lt.NUMBER]);t.cursor=o;break}case"float32":case"float32le":case"float64":case"float64le":case"int8":case"int8le":case"int16":case"int16le":case"int32":case"int32le":case"int64":case"int64le":case"uint8":case"uint8le":case"uint16":case"uint16le":case"uint32":case"uint32le":case"uint64":case"uint64le":{const[o]=Pt(e,i,[lt.NAME]);n.set(o,m$(t,s));break}case"text":{const[o,a]=Pt(e,i,[lt.NAME,lt.NAME]),c=m$(t,o);if(rn(c)&&un(a)){const l=new Uint8Array(t.bytes.buffer,t.cursor,c),h=new TextDecoder("utf-8").decode(l);n.set(a,h),t.cursor+=c}break}}return 0},Sx=n=>n!==null&&Object.prototype.toString.call(n)==="[object Object]",dI=(n,e)=>{if(n===e)return!0;if(typeof n!=typeof e)return!1;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t+=1)if(!dI(n[t],e[t]))return!1;return!0}if(Sx(n)&&Sx(e)){const t=Object.entries(n),r=new Set(Object.keys(e));if(t.length!==r.size)return!1;for(const[i,s]of t){if(!dI(s,e[i]))return!1;r.delete(i)}return r.size===0}return!1},YR=n=>{if(n===""||n===!1||n===null||n===void 0||Array.isArray(n)&&n.length===0)return!0;if(Sx(n)){for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}return!1},ZDe=n=>n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="_",g$=n=>n>="0"&&n<="9"||n==="-",JDe=n=>n>="a"&&n<="z"||n>="A"&&n<="Z"||n>="0"&&n<="9"||n==="_";var Nt;(function(n){n.TOK_EOF="EOF",n.TOK_UNQUOTEDIDENTIFIER="UnquotedIdentifier",n.TOK_QUOTEDIDENTIFIER="QuotedIdentifier",n.TOK_RBRACKET="Rbracket",n.TOK_RPAREN="Rparen",n.TOK_COMMA="Comma",n.TOK_COLON="Colon",n.TOK_RBRACE="Rbrace",n.TOK_NUMBER="Number",n.TOK_CURRENT="Current",n.TOK_ROOT="Root",n.TOK_EXPREF="Expref",n.TOK_PIPE="Pipe",n.TOK_OR="Or",n.TOK_AND="And",n.TOK_EQ="EQ",n.TOK_GT="GT",n.TOK_LT="LT",n.TOK_GTE="GTE",n.TOK_LTE="LTE",n.TOK_NE="NE",n.TOK_FLATTEN="Flatten",n.TOK_STAR="Star",n.TOK_FILTER="Filter",n.TOK_DOT="Dot",n.TOK_NOT="Not",n.TOK_LBRACE="Lbrace",n.TOK_LBRACKET="Lbracket",n.TOK_LPAREN="Lparen",n.TOK_LITERAL="Literal"})(Nt||(Nt={}));const _$={"(":Nt.TOK_LPAREN,")":Nt.TOK_RPAREN,"*":Nt.TOK_STAR,",":Nt.TOK_COMMA,".":Nt.TOK_DOT,":":Nt.TOK_COLON,"@":Nt.TOK_CURRENT,$:Nt.TOK_ROOT,"]":Nt.TOK_RBRACKET,"{":Nt.TOK_LBRACE,"}":Nt.TOK_RBRACE},QDe={"!":!0,"<":!0,"=":!0,">":!0},eLe={"	":!0,"\n":!0,"\r":!0," ":!0};class tLe{constructor(){this._current=0}tokenize(e){const t=[];this._current=0;let r,i,s;for(;this._current<e.length;)if(ZDe(e[this._current]))r=this._current,i=this.consumeUnquotedIdentifier(e),t.push({start:r,type:Nt.TOK_UNQUOTEDIDENTIFIER,value:i});else if(_$[e[this._current]]!==void 0)t.push({start:this._current,type:_$[e[this._current]],value:e[this._current]}),this._current+=1;else if(g$(e[this._current]))s=this.consumeNumber(e),t.push(s);else if(e[this._current]==="[")s=this.consumeLBracket(e),t.push(s);else if(e[this._current]==='"')r=this._current,i=this.consumeQuotedIdentifier(e),t.push({start:r,type:Nt.TOK_QUOTEDIDENTIFIER,value:i});else if(e[this._current]==="'")r=this._current,i=this.consumeRawStringLiteral(e),t.push({start:r,type:Nt.TOK_LITERAL,value:i});else if(e[this._current]==="`"){r=this._current;const o=this.consumeLiteral(e);t.push({start:r,type:Nt.TOK_LITERAL,value:o})}else if(QDe[e[this._current]]!==void 0)s=this.consumeOperator(e),s&&t.push(s);else if(eLe[e[this._current]]!==void 0)this._current+=1;else if(e[this._current]==="&")r=this._current,this._current+=1,e[this._current]==="&"?(this._current+=1,t.push({start:r,type:Nt.TOK_AND,value:"&&"})):t.push({start:r,type:Nt.TOK_EXPREF,value:"&"});else if(e[this._current]==="|")r=this._current,this._current+=1,e[this._current]==="|"?(this._current+=1,t.push({start:r,type:Nt.TOK_OR,value:"||"})):t.push({start:r,type:Nt.TOK_PIPE,value:"|"});else{const o=new Error(`Unknown character: ${e[this._current]}`);throw o.name="LexerError",o}return t}consumeUnquotedIdentifier(e){const t=this._current;for(this._current+=1;this._current<e.length&&JDe(e[this._current]);)this._current+=1;return e.slice(t,this._current)}consumeQuotedIdentifier(e){const t=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=='"'&&this._current<r;){let i=this._current;e[i]==="\\"&&(e[i+1]==="\\"||e[i+1]==='"')?i+=2:i+=1,this._current=i}return this._current+=1,JSON.parse(e.slice(t,this._current))}consumeRawStringLiteral(e){const t=this._current;this._current+=1;const r=e.length;for(;e[this._current]!=="'"&&this._current<r;){let s=this._current;e[s]==="\\"&&(e[s+1]==="\\"||e[s+1]==="'")?s+=2:s+=1,this._current=s}return this._current+=1,e.slice(t+1,this._current-1).replace("\\'","'")}consumeNumber(e){const t=this._current;this._current+=1;const r=e.length;for(;g$(e[this._current])&&this._current<r;)this._current+=1;const i=parseInt(e.slice(t,this._current),10);return{start:t,value:i,type:Nt.TOK_NUMBER}}consumeLBracket(e){const t=this._current;return this._current+=1,e[this._current]==="?"?(this._current+=1,{start:t,type:Nt.TOK_FILTER,value:"[?"}):e[this._current]==="]"?(this._current+=1,{start:t,type:Nt.TOK_FLATTEN,value:"[]"}):{start:t,type:Nt.TOK_LBRACKET,value:"["}}consumeOperator(e){const t=this._current,r=e[t];if(this._current+=1,r==="!")return e[this._current]==="="?(this._current+=1,{start:t,type:Nt.TOK_NE,value:"!="}):{start:t,type:Nt.TOK_NOT,value:"!"};if(r==="<")return e[this._current]==="="?(this._current+=1,{start:t,type:Nt.TOK_LTE,value:"<="}):{start:t,type:Nt.TOK_LT,value:"<"};if(r===">")return e[this._current]==="="?(this._current+=1,{start:t,type:Nt.TOK_GTE,value:">="}):{start:t,type:Nt.TOK_GT,value:">"};if(r==="="&&e[this._current]==="=")return this._current+=1,{start:t,type:Nt.TOK_EQ,value:"=="}}consumeLiteral(e){this._current+=1;const t=this._current,r=e.length;for(;e[this._current]!=="`"&&this._current<r;){let o=this._current;e[o]==="\\"&&(e[o+1]==="\\"||e[o+1]==="`")?o+=2:o+=1,this._current=o}let i=e.slice(t,this._current).trimLeft();i=i.replace("\\`","`");const s=this.looksLikeJSON(i)?JSON.parse(i):JSON.parse(`"${i}"`);return this._current+=1,s}looksLikeJSON(e){const r=["true","false","null"],i="-0123456789";if(e==="")return!1;if('[{"'.includes(e[0])||r.includes(e))return!0;if(i.includes(e[0]))try{return JSON.parse(e),!0}catch{return!1}return!1}}const nLe=new tLe,Nl={[Nt.TOK_EOF]:0,[Nt.TOK_UNQUOTEDIDENTIFIER]:0,[Nt.TOK_QUOTEDIDENTIFIER]:0,[Nt.TOK_RBRACKET]:0,[Nt.TOK_RPAREN]:0,[Nt.TOK_COMMA]:0,[Nt.TOK_RBRACE]:0,[Nt.TOK_NUMBER]:0,[Nt.TOK_CURRENT]:0,[Nt.TOK_EXPREF]:0,[Nt.TOK_ROOT]:0,[Nt.TOK_PIPE]:1,[Nt.TOK_OR]:2,[Nt.TOK_AND]:3,[Nt.TOK_EQ]:5,[Nt.TOK_GT]:5,[Nt.TOK_LT]:5,[Nt.TOK_GTE]:5,[Nt.TOK_LTE]:5,[Nt.TOK_NE]:5,[Nt.TOK_FLATTEN]:9,[Nt.TOK_STAR]:20,[Nt.TOK_FILTER]:21,[Nt.TOK_DOT]:40,[Nt.TOK_NOT]:45,[Nt.TOK_LBRACE]:50,[Nt.TOK_LBRACKET]:55,[Nt.TOK_LPAREN]:60};class rLe{constructor(){this.index=0,this.tokens=[]}parse(e){this.loadTokens(e),this.index=0;const t=this.expression(0);if(this.lookahead(0)!==Nt.TOK_EOF){const r=this.lookaheadToken(0);this.errorToken(r,`Unexpected token type: ${r.type}, value: ${r.value}`)}return t}loadTokens(e){this.tokens=[...nLe.tokenize(e),{type:Nt.TOK_EOF,value:"",start:e.length}]}expression(e){const t=this.lookaheadToken(0);this.advance();let r=this.nud(t),i=this.lookahead(0);for(;e<Nl[i];)this.advance(),r=this.led(i,r),i=this.lookahead(0);return r}lookahead(e){return this.tokens[this.index+e].type}lookaheadToken(e){return this.tokens[this.index+e]}advance(){this.index+=1}nud(e){let t,r,i;switch(e.type){case Nt.TOK_LITERAL:return{type:"Literal",value:e.value};case Nt.TOK_UNQUOTEDIDENTIFIER:return{type:"Field",name:e.value};case Nt.TOK_QUOTEDIDENTIFIER:const s={type:"Field",name:e.value};if(this.lookahead(0)===Nt.TOK_LPAREN)throw new Error("Quoted identifier not allowed for function names.");return s;case Nt.TOK_NOT:return r=this.expression(Nl.Not),{type:"NotExpression",children:[r]};case Nt.TOK_STAR:return t={type:"Identity"},r=this.lookahead(0)===Nt.TOK_RBRACKET&&{type:"Identity"}||this.parseProjectionRHS(Nl.Star),{type:"ValueProjection",children:[t,r]};case Nt.TOK_FILTER:return this.led(e.type,{type:"Identity"});case Nt.TOK_LBRACE:return this.parseMultiselectHash();case Nt.TOK_FLATTEN:return t={type:Nt.TOK_FLATTEN,children:[{type:"Identity"}]},r=this.parseProjectionRHS(Nl.Flatten),{type:"Projection",children:[t,r]};case Nt.TOK_LBRACKET:return this.lookahead(0)===Nt.TOK_NUMBER||this.lookahead(0)===Nt.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice({type:"Identity"},r)):this.lookahead(0)===Nt.TOK_STAR&&this.lookahead(1)===Nt.TOK_RBRACKET?(this.advance(),this.advance(),r=this.parseProjectionRHS(Nl.Star),{children:[{type:"Identity"},r],type:"Projection"}):this.parseMultiselectList();case Nt.TOK_CURRENT:return{type:Nt.TOK_CURRENT};case Nt.TOK_ROOT:return{type:Nt.TOK_ROOT};case Nt.TOK_EXPREF:return i=this.expression(Nl.Expref),{type:"ExpressionReference",children:[i]};case Nt.TOK_LPAREN:const o=[];for(;this.lookahead(0)!==Nt.TOK_RPAREN;)this.lookahead(0)===Nt.TOK_CURRENT?(i={type:Nt.TOK_CURRENT},this.advance()):i=this.expression(0),o.push(i);return this.match(Nt.TOK_RPAREN),o[0];default:this.errorToken(e)}}led(e,t){let r;switch(e){case Nt.TOK_DOT:const i=Nl.Dot;return this.lookahead(0)!==Nt.TOK_STAR?(r=this.parseDotRHS(i),{type:"Subexpression",children:[t,r]}):(this.advance(),r=this.parseProjectionRHS(i),{type:"ValueProjection",children:[t,r]});case Nt.TOK_PIPE:return r=this.expression(Nl.Pipe),{type:Nt.TOK_PIPE,children:[t,r]};case Nt.TOK_OR:return r=this.expression(Nl.Or),{type:"OrExpression",children:[t,r]};case Nt.TOK_AND:return r=this.expression(Nl.And),{type:"AndExpression",children:[t,r]};case Nt.TOK_LPAREN:const s=t.name,o=[];let a;for(;this.lookahead(0)!==Nt.TOK_RPAREN;)this.lookahead(0)===Nt.TOK_CURRENT?(a={type:Nt.TOK_CURRENT},this.advance()):a=this.expression(0),this.lookahead(0)===Nt.TOK_COMMA&&this.match(Nt.TOK_COMMA),o.push(a);return this.match(Nt.TOK_RPAREN),{name:s,type:"Function",children:o};case Nt.TOK_FILTER:const l=this.expression(0);return this.match(Nt.TOK_RBRACKET),r=this.lookahead(0)===Nt.TOK_FLATTEN&&{type:"Identity"}||this.parseProjectionRHS(Nl.Filter),{type:"FilterProjection",children:[t,r,l]};case Nt.TOK_FLATTEN:const u={type:Nt.TOK_FLATTEN,children:[t]},h=this.parseProjectionRHS(Nl.Flatten);return{type:"Projection",children:[u,h]};case Nt.TOK_EQ:case Nt.TOK_NE:case Nt.TOK_GT:case Nt.TOK_GTE:case Nt.TOK_LT:case Nt.TOK_LTE:return this.parseComparator(t,e);case Nt.TOK_LBRACKET:const f=this.lookaheadToken(0);return f.type===Nt.TOK_NUMBER||f.type===Nt.TOK_COLON?(r=this.parseIndexExpression(),this.projectIfSlice(t,r)):(this.match(Nt.TOK_STAR),this.match(Nt.TOK_RBRACKET),r=this.parseProjectionRHS(Nl.Star),{type:"Projection",children:[t,r]});default:return this.errorToken(this.lookaheadToken(0))}}match(e){if(this.lookahead(0)===e){this.advance();return}else{const t=this.lookaheadToken(0);this.errorToken(t,`Expected ${e}, got: ${t.type}`)}}errorToken(e,t=""){const r=new Error(t||`Invalid token (${e.type}): "${e.value}"`);throw r.name="ParserError",r}parseIndexExpression(){if(this.lookahead(0)===Nt.TOK_COLON||this.lookahead(1)===Nt.TOK_COLON)return this.parseSliceExpression();const e={type:"Index",value:this.lookaheadToken(0).value};return this.advance(),this.match(Nt.TOK_RBRACKET),e}projectIfSlice(e,t){const r={type:"IndexExpression",children:[e,t]};return t.type==="Slice"?{children:[r,this.parseProjectionRHS(Nl.Star)],type:"Projection"}:r}parseSliceExpression(){const e=[null,null,null];let t=0,r=this.lookahead(0);for(;r!==Nt.TOK_RBRACKET&&t<3;){if(r===Nt.TOK_COLON)t+=1,this.advance();else if(r===Nt.TOK_NUMBER)e[t]=this.lookaheadToken(0).value,this.advance();else{const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}r=this.lookahead(0)}return this.match(Nt.TOK_RBRACKET),{children:e,type:"Slice"}}parseComparator(e,t){const r=this.expression(Nl[t]);return{type:"Comparator",name:t,children:[e,r]}}parseDotRHS(e){const t=this.lookahead(0);if([Nt.TOK_UNQUOTEDIDENTIFIER,Nt.TOK_QUOTEDIDENTIFIER,Nt.TOK_STAR].includes(t))return this.expression(e);if(t===Nt.TOK_LBRACKET)return this.match(Nt.TOK_LBRACKET),this.parseMultiselectList();if(t===Nt.TOK_LBRACE)return this.match(Nt.TOK_LBRACE),this.parseMultiselectHash();const i=this.lookaheadToken(0);this.errorToken(i,`Syntax error, unexpected token: ${i.value}(${i.type})`)}parseProjectionRHS(e){if(Nl[this.lookahead(0)]<10)return{type:"Identity"};if(this.lookahead(0)===Nt.TOK_LBRACKET)return this.expression(e);if(this.lookahead(0)===Nt.TOK_FILTER)return this.expression(e);if(this.lookahead(0)===Nt.TOK_DOT)return this.match(Nt.TOK_DOT),this.parseDotRHS(e);const t=this.lookaheadToken(0);this.errorToken(t,`Syntax error, unexpected token: ${t.value}(${t.type})`)}parseMultiselectList(){const e=[];for(;this.lookahead(0)!==Nt.TOK_RBRACKET;){const t=this.expression(0);if(e.push(t),this.lookahead(0)===Nt.TOK_COMMA&&(this.match(Nt.TOK_COMMA),this.lookahead(0)===Nt.TOK_RBRACKET))throw new Error("Unexpected token Rbracket")}return this.match(Nt.TOK_RBRACKET),{type:"MultiSelectList",children:e}}parseMultiselectHash(){const e=[],t=[Nt.TOK_UNQUOTEDIDENTIFIER,Nt.TOK_QUOTEDIDENTIFIER];let r,i,s;for(;;){if(r=this.lookaheadToken(0),!t.includes(r.type))throw new Error(`Expecting an identifier token, got: ${r.type}`);if(i=r.value,this.advance(),this.match(Nt.TOK_COLON),s=this.expression(0),e.push({value:s,type:"KeyValuePair",name:i}),this.lookahead(0)===Nt.TOK_COMMA)this.match(Nt.TOK_COMMA);else if(this.lookahead(0)===Nt.TOK_RBRACE){this.match(Nt.TOK_RBRACE);break}}return{type:"MultiSelectHash",children:e}}}const iLe=new rLe;var gn;(function(n){n[n.TYPE_NUMBER=0]="TYPE_NUMBER",n[n.TYPE_ANY=1]="TYPE_ANY",n[n.TYPE_STRING=2]="TYPE_STRING",n[n.TYPE_ARRAY=3]="TYPE_ARRAY",n[n.TYPE_OBJECT=4]="TYPE_OBJECT",n[n.TYPE_BOOLEAN=5]="TYPE_BOOLEAN",n[n.TYPE_EXPREF=6]="TYPE_EXPREF",n[n.TYPE_NULL=7]="TYPE_NULL",n[n.TYPE_ARRAY_NUMBER=8]="TYPE_ARRAY_NUMBER",n[n.TYPE_ARRAY_STRING=9]="TYPE_ARRAY_STRING"})(gn||(gn={}));class sLe{constructor(e){this.TYPE_NAME_TABLE={[gn.TYPE_NUMBER]:"number",[gn.TYPE_ANY]:"any",[gn.TYPE_STRING]:"string",[gn.TYPE_ARRAY]:"array",[gn.TYPE_OBJECT]:"object",[gn.TYPE_BOOLEAN]:"boolean",[gn.TYPE_EXPREF]:"expression",[gn.TYPE_NULL]:"null",[gn.TYPE_ARRAY_NUMBER]:"Array<number>",[gn.TYPE_ARRAY_STRING]:"Array<string>"},this.functionAbs=([t])=>Math.abs(t),this.functionAvg=([t])=>{let r=0;for(let i=0;i<t.length;i+=1)r+=t[i];return r/t.length},this.functionCeil=([t])=>Math.ceil(t),this.functionContains=t=>{const[r,i]=t;return r.includes(i)},this.functionEndsWith=t=>{const[r,i]=t;return r.includes(i,r.length-i.length)},this.functionFloor=([t])=>Math.floor(t),this.functionJoin=t=>{const[r,i]=t;return i.join(r)},this.functionKeys=([t])=>Object.keys(t),this.functionLength=([t])=>Sx(t)?Object.keys(t).length:t.length,this.functionMap=t=>{if(!this._interpreter)return[];const r=[],i=this._interpreter,s=t[0],o=t[1];for(let a=0;a<o.length;a+=1)r.push(i.visit(s,o[a]));return r},this.functionMax=([t])=>{if(!t.length)return null;if(this.getTypeName(t[0])===gn.TYPE_NUMBER)return Math.max(...t);const i=t;let s=i[0];for(let o=1;o<i.length;o+=1)s.localeCompare(i[o])<0&&(s=i[o]);return s},this.functionMaxBy=t=>{const r=t[1],i=t[0],s=this.createKeyFunction(r,[gn.TYPE_NUMBER,gn.TYPE_STRING]);let o=-1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c>o&&(o=c,a=i[l]);return a},this.functionMerge=t=>{let r={};for(let i=0;i<t.length;i+=1){const s=t[i];r=Object.assign(r,s)}return r},this.functionMin=([t])=>{if(!t.length)return null;if(this.getTypeName(t[0])===gn.TYPE_NUMBER)return Math.min(...t);const i=t;let s=i[0];for(let o=1;o<i.length;o+=1)i[o].localeCompare(s)<0&&(s=i[o]);return s},this.functionMinBy=t=>{const r=t[1],i=t[0],s=this.createKeyFunction(r,[gn.TYPE_NUMBER,gn.TYPE_STRING]);let o=1/0,a,c;for(let l=0;l<i.length;l+=1)c=s&&s(i[l]),c!==void 0&&c<o&&(o=c,a=i[l]);return a},this.functionNotNull=t=>{for(let r=0;r<t.length;r+=1)if(this.getTypeName(t[r])!==gn.TYPE_NULL)return t[r];return null},this.functionReverse=([t])=>{if(this.getTypeName(t)===gn.TYPE_STRING){const s=t;let o="";for(let a=s.length-1;a>=0;a-=1)o+=s[a];return o}const i=t.slice(0);return i.reverse(),i},this.functionSort=([t])=>[...t].sort(),this.functionSortBy=t=>{if(!this._interpreter)return[];const r=t[0].slice(0);if(r.length===0)return r;const i=this._interpreter,s=t[1],o=this.getTypeName(i.visit(s,r[0]));if(o!==void 0&&![gn.TYPE_NUMBER,gn.TYPE_STRING].includes(o))throw new Error(`TypeError: unexpected type (${this.TYPE_NAME_TABLE[o]})`);const a=[];for(let c=0;c<r.length;c+=1)a.push([c,r[c]]);a.sort((c,l)=>{const u=i.visit(s,c[1]),h=i.visit(s,l[1]);if(this.getTypeName(u)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(u)]}`);if(this.getTypeName(h)!==o)throw new Error(`TypeError: expected (${this.TYPE_NAME_TABLE[o]}), received ${this.TYPE_NAME_TABLE[this.getTypeName(h)]}`);return u>h?1:u<h?-1:c[0]-l[0]});for(let c=0;c<a.length;c+=1)r[c]=a[c][1];return r},this.functionStartsWith=([t,r])=>t.startsWith(r),this.functionSum=([t])=>t.reduce((r,i)=>r+i,0),this.functionToArray=([t])=>this.getTypeName(t)===gn.TYPE_ARRAY?t:[t],this.functionToNumber=([t])=>{const r=this.getTypeName(t);let i;return r===gn.TYPE_NUMBER?t:r===gn.TYPE_STRING&&(i=+t,!isNaN(i))?i:null},this.functionToString=([t])=>this.getTypeName(t)===gn.TYPE_STRING?t:JSON.stringify(t),this.functionType=([t])=>{switch(this.getTypeName(t)){case gn.TYPE_NUMBER:return"number";case gn.TYPE_STRING:return"string";case gn.TYPE_ARRAY:return"array";case gn.TYPE_OBJECT:return"object";case gn.TYPE_BOOLEAN:return"boolean";case gn.TYPE_EXPREF:return"expref";case gn.TYPE_NULL:return"null";default:return}},this.functionValues=([t])=>Object.values(t),this.functionTable={abs:{_func:this.functionAbs,_signature:[{types:[gn.TYPE_NUMBER]}]},avg:{_func:this.functionAvg,_signature:[{types:[gn.TYPE_ARRAY_NUMBER]}]},ceil:{_func:this.functionCeil,_signature:[{types:[gn.TYPE_NUMBER]}]},contains:{_func:this.functionContains,_signature:[{types:[gn.TYPE_STRING,gn.TYPE_ARRAY]},{types:[gn.TYPE_ANY]}]},ends_with:{_func:this.functionEndsWith,_signature:[{types:[gn.TYPE_STRING]},{types:[gn.TYPE_STRING]}]},floor:{_func:this.functionFloor,_signature:[{types:[gn.TYPE_NUMBER]}]},join:{_func:this.functionJoin,_signature:[{types:[gn.TYPE_STRING]},{types:[gn.TYPE_ARRAY_STRING]}]},keys:{_func:this.functionKeys,_signature:[{types:[gn.TYPE_OBJECT]}]},length:{_func:this.functionLength,_signature:[{types:[gn.TYPE_STRING,gn.TYPE_ARRAY,gn.TYPE_OBJECT]}]},map:{_func:this.functionMap,_signature:[{types:[gn.TYPE_EXPREF]},{types:[gn.TYPE_ARRAY]}]},max:{_func:this.functionMax,_signature:[{types:[gn.TYPE_ARRAY_NUMBER,gn.TYPE_ARRAY_STRING]}]},max_by:{_func:this.functionMaxBy,_signature:[{types:[gn.TYPE_ARRAY]},{types:[gn.TYPE_EXPREF]}]},merge:{_func:this.functionMerge,_signature:[{types:[gn.TYPE_OBJECT],variadic:!0}]},min:{_func:this.functionMin,_signature:[{types:[gn.TYPE_ARRAY_NUMBER,gn.TYPE_ARRAY_STRING]}]},min_by:{_func:this.functionMinBy,_signature:[{types:[gn.TYPE_ARRAY]},{types:[gn.TYPE_EXPREF]}]},not_null:{_func:this.functionNotNull,_signature:[{types:[gn.TYPE_ANY],variadic:!0}]},reverse:{_func:this.functionReverse,_signature:[{types:[gn.TYPE_STRING,gn.TYPE_ARRAY]}]},sort:{_func:this.functionSort,_signature:[{types:[gn.TYPE_ARRAY_STRING,gn.TYPE_ARRAY_NUMBER]}]},sort_by:{_func:this.functionSortBy,_signature:[{types:[gn.TYPE_ARRAY]},{types:[gn.TYPE_EXPREF]}]},starts_with:{_func:this.functionStartsWith,_signature:[{types:[gn.TYPE_STRING]},{types:[gn.TYPE_STRING]}]},sum:{_func:this.functionSum,_signature:[{types:[gn.TYPE_ARRAY_NUMBER]}]},to_array:{_func:this.functionToArray,_signature:[{types:[gn.TYPE_ANY]}]},to_number:{_func:this.functionToNumber,_signature:[{types:[gn.TYPE_ANY]}]},to_string:{_func:this.functionToString,_signature:[{types:[gn.TYPE_ANY]}]},type:{_func:this.functionType,_signature:[{types:[gn.TYPE_ANY]}]},values:{_func:this.functionValues,_signature:[{types:[gn.TYPE_OBJECT]}]}},this._interpreter=e}registerFunction(e,t,r){if(e in this.functionTable)throw new Error(`Function already defined: ${e}()`);this.functionTable[e]={_func:t.bind(this),_signature:r}}callFunction(e,t){const r=this.functionTable[e];if(r===void 0)throw new Error(`Unknown function: ${e}()`);return this.validateArgs(e,t,r._signature),r._func.call(this,t)}validateInputSignatures(e,t){for(let r=0;r<t.length;r+=1)if("variadic"in t[r]&&r!==t.length-1)throw new Error(`ArgumentError: ${e}() 'variadic' argument ${r+1} must occur last`)}validateArgs(e,t,r){var i,s;let o;this.validateInputSignatures(e,r);const a=r.filter(m=>{var _;return(_=!m.optional)!==null&&_!==void 0?_:!1}).length,c=(s=(i=r[r.length-1])===null||i===void 0?void 0:i.variadic)!==null&&s!==void 0?s:!1,l=t.length<a,u=t.length>r.length,h=l&&(!c&&a>1||c)?"at least ":"";if(c&&l||!c&&(l||u))throw o=r.length>1,new Error(`ArgumentError: ${e}() takes ${h}${a} argument${o&&"s"||""} but received ${t.length}`);let f,d,p;for(let m=0;m<r.length;m+=1){p=!1,f=r[m].types,d=this.getTypeName(t[m]);let _;for(_=0;_<f.length;_+=1)if(d!==void 0&&this.typeMatches(d,f[_],t[m])){p=!0;break}if(!p&&d!==void 0){const v=f.map(S=>this.TYPE_NAME_TABLE[S]).join(" | ");throw new Error(`TypeError: ${e}() expected argument ${m+1} to be type (${v}) but received type ${this.TYPE_NAME_TABLE[d]} instead.`)}}}typeMatches(e,t,r){if(t===gn.TYPE_ANY)return!0;if(t===gn.TYPE_ARRAY_STRING||t===gn.TYPE_ARRAY_NUMBER||t===gn.TYPE_ARRAY){if(t===gn.TYPE_ARRAY)return e===gn.TYPE_ARRAY;if(e===gn.TYPE_ARRAY){let i;t===gn.TYPE_ARRAY_NUMBER?i=gn.TYPE_NUMBER:t===gn.TYPE_ARRAY_STRING&&(i=gn.TYPE_STRING);for(let s=0;s<r.length;s+=1){const o=this.getTypeName(r[s]);if(o!==void 0&&i!==void 0&&!this.typeMatches(o,i,r[s]))return!1}return!0}}else return e===t;return!1}getTypeName(e){switch(Object.prototype.toString.call(e)){case"[object String]":return gn.TYPE_STRING;case"[object Number]":return gn.TYPE_NUMBER;case"[object Array]":return gn.TYPE_ARRAY;case"[object Boolean]":return gn.TYPE_BOOLEAN;case"[object Null]":return gn.TYPE_NULL;case"[object Object]":return e.jmespathType===Nt.TOK_EXPREF?gn.TYPE_EXPREF:gn.TYPE_OBJECT;default:return}}createKeyFunction(e,t){if(!this._interpreter)return;const r=this._interpreter;return s=>{const o=r.visit(e,s);if(!t.includes(this.getTypeName(o))){const a=`TypeError: expected one of (${t.map(c=>this.TYPE_NAME_TABLE[c]).join(" | ")}), received ${this.TYPE_NAME_TABLE[this.getTypeName(o)]}`;throw new Error(a)}return o}}}class oLe{constructor(){this._rootValue=null,this.runtime=new sLe(this)}search(e,t){return this._rootValue=t,this.visit(e,t)}visit(e,t){let r,i,s,o,a,c,l,u,h,f,d;switch(e.type){case"Field":return t===null?null:Sx(t)?(c=t[e.name],c===void 0?null:c):null;case"Subexpression":for(s=this.visit(e.children[0],t),f=1;f<e.children.length;f+=1)if(s=this.visit(e.children[1],s),s===null)return null;return s;case"IndexExpression":return l=this.visit(e.children[0],t),u=this.visit(e.children[1],l),u;case"Index":if(!Array.isArray(t))return null;let p=e.value;return p<0&&(p=t.length+p),s=t[p],s===void 0&&(s=null),s;case"Slice":if(!Array.isArray(t))return null;const m=[...e.children],_=this.computeSliceParams(t.length,m),[v,S,b]=_;if(s=[],b>0)for(f=v;f<S;f+=b)s.push(t[f]);else for(f=v;f>S;f+=b)s.push(t[f]);return s;case"Projection":if(d=this.visit(e.children[0],t),!Array.isArray(d))return null;for(h=[],f=0;f<d.length;f+=1)i=this.visit(e.children[1],d[f]),i!==null&&h.push(i);return h;case"ValueProjection":if(d=this.visit(e.children[0],t),!Sx(d))return null;h=[];const T=Object.values(d);for(f=0;f<T.length;f+=1)i=this.visit(e.children[1],T[f]),i!==null&&h.push(i);return h;case"FilterProjection":if(d=this.visit(e.children[0],t),!Array.isArray(d))return null;const w=[],R=[];for(f=0;f<d.length;f+=1)r=this.visit(e.children[2],d[f]),YR(r)||w.push(d[f]);for(let I=0;I<w.length;I+=1)i=this.visit(e.children[1],w[I]),i!==null&&R.push(i);return R;case"Comparator":switch(o=this.visit(e.children[0],t),a=this.visit(e.children[1],t),e.name){case Nt.TOK_EQ:s=dI(o,a);break;case Nt.TOK_NE:s=!dI(o,a);break;case Nt.TOK_GT:s=o>a;break;case Nt.TOK_GTE:s=o>=a;break;case Nt.TOK_LT:s=o<a;break;case Nt.TOK_LTE:s=o<=a;break;default:throw new Error(`Unknown comparator: ${e.name}`)}return s;case Nt.TOK_FLATTEN:const C=this.visit(e.children[0],t);if(!Array.isArray(C))return null;let N=[];for(f=0;f<C.length;f+=1)i=C[f],Array.isArray(i)?N=[...N,...i]:N.push(i);return N;case"Identity":return t;case"MultiSelectList":if(t===null)return null;for(h=[],f=0;f<e.children.length;f+=1)h.push(this.visit(e.children[f],t));return h;case"MultiSelectHash":if(t===null)return null;h={};let U;for(f=0;f<e.children.length;f+=1)U=e.children[f],h[U.name]=this.visit(U.value,t);return h;case"OrExpression":return r=this.visit(e.children[0],t),YR(r)&&(r=this.visit(e.children[1],t)),r;case"AndExpression":return o=this.visit(e.children[0],t),YR(o)?o:this.visit(e.children[1],t);case"NotExpression":return o=this.visit(e.children[0],t),YR(o);case"Literal":return e.value;case Nt.TOK_PIPE:return l=this.visit(e.children[0],t),this.visit(e.children[1],l);case Nt.TOK_CURRENT:return t;case Nt.TOK_ROOT:return this._rootValue;case"Function":const B=[];for(let I=0;I<e.children.length;I+=1)B.push(this.visit(e.children[I],t));return this.runtime.callFunction(e.name,B);case"ExpressionReference":const $=e.children[0];return $.jmespathType=Nt.TOK_EXPREF,$;default:throw new Error(`Unknown node type: ${e.type}`)}}computeSliceParams(e,t){let[r,i,s]=t;if(s===null)s=1;else if(s===0){const a=new Error("Invalid slice, step cannot be 0");throw a.name="RuntimeError",a}const o=s<0;return r=r===null?o?e-1:0:this.capSliceRange(e,r,s),i=i===null?o?-1:e:this.capSliceRange(e,i,s),[r,i,s]}capSliceRange(e,t,r){let i=t;return i<0?(i+=e,i<0&&(i=r<0?-1:0)):i>=e&&(i=r<0?e-1:e),i}}const aLe=new oLe;gn.TYPE_ANY;gn.TYPE_ARRAY;gn.TYPE_ARRAY_NUMBER;gn.TYPE_ARRAY_STRING;gn.TYPE_BOOLEAN;gn.TYPE_EXPREF;gn.TYPE_NULL;gn.TYPE_NUMBER;gn.TYPE_OBJECT;gn.TYPE_STRING;function cLe(n,e){const t=iLe.parse(e);return aLe.search(t,n)}const lLe=(n,e)=>{const t=zE(n.id());if(!he(t))return 0;const[r,i]=Pt(e,0,[lt.NAME,lt.NAME]),s=cLe(t.json,r);return n.set(i,s),0},uLe=(n,e)=>{const t=zE(n.id());if(!he(t))return 0;const[r,i]=Pt(e,0,[lt.NAME]);switch(cr(r)){case"seek":{const[o]=Pt(e,i,[lt.NUMBER]);t.cursor=Ri(o,0,t.lines.length-1);break}case"line":t.cursor=Ri(t.cursor+1,0,t.lines.length-1);break;default:{const o=t.lines[t.cursor]??"",c=new RegExp(r,"i").exec(o)??[];let l=1;for(let u=i;u<e.length;){const[h,f]=Pt(e,u,[lt.NAME]);n.set(h,c[l]??0),++l,u=f}break}}return 0},hLe=ty({get(n,e){const t=Twe(n.id());if(e==="format")return[!0,t];switch(t){case"text":{const r=zE(n.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"lines":return[!0,r.lines.length]}break}case"json":{const r=zE(n.id());if(e==="filename")return[!0,r.filename];break}case"binary":{const r=zE(n.id());switch(e){case"filename":return[!0,r.filename];case"cursor":return[!0,r.cursor];case"bytes":return[!0,r.bytes.length]}break}}return[!1,void 0]}}).command("endgame",()=>0).command("shortsend",(n,e)=>{const t=bx(e);return Ex(n,fe.element,t),0}).command("send",(n,e)=>{const t=bx(e,!0);return Ex(n,fe.element,t),0}).command("stat",()=>0).command("text",(n,e)=>{const t=e.map(ro).join(" ");return WL(qe,"","$GREEN",t),0}).command("hyperlink",(n,e)=>{const[t,...r]=e,i=n.template(ro(t).split(" "));return WL(qe,"",`!${n.template(r)};${i}`),0}).command("readline",uLe).command("readjson",lLe).command("readbin",XDe).command("withboard",(n,e)=>{const[t]=Pt(e,0,[lt.STRING]),r=Cs(t);return he(r)&&(fe.board=r,fe.element={x:mu(0,bn-1),y:mu(0,wr-1)}),0}).command("withobject",(n,e)=>{const[t]=Pt(e,0,[lt.STRING]),r=wh(fe.board,t);return he(r)&&(fe.element=r,fe.elementid=r.id??"",fe.elementisplayer=zl(fe.elementid),fe.elementfocus=fe.elementisplayer?fe.elementid:fe.element?.player??$m()),0}).command("userinput",(n,e)=>{const[t]=Pt(e,0,[lt.NAME]),r=$m();switch(cr(t)){case"up":gm(qe,r,Ct.MOVE_UP,!1);break;case"down":gm(qe,r,Ct.MOVE_DOWN,!1);break;case"left":gm(qe,r,Ct.MOVE_RIGHT,!1);break;case"right":gm(qe,r,Ct.MOVE_RIGHT,!1);break;case"shootup":gm(qe,r,Ct.MOVE_UP,!0);break;case"shootdown":gm(qe,r,Ct.MOVE_DOWN,!0);break;case"shootleft":gm(qe,r,Ct.MOVE_RIGHT,!0);break;case"shootright":gm(qe,r,Ct.MOVE_RIGHT,!0);break;case"ok":gm(qe,r,Ct.OK_BUTTON,!1);break;case"cancel":gm(qe,r,Ct.CANCEL_BUTTON,!1);break}return 0});function v$(n,e,t,r,i,s){const o=[];for(let a=s;a<i.length;){const[c,l]=Pt(i,a,[lt.ANY]);sr(c)&&!_d(c)&&!gA(c)&&!QM(c)&&!dc(c)?o.push(...c):o.push(c),a=l}switch(cr(r)){case"get":case"post:json":TEe(qe,fe.elementfocus,n,e,t,r,o);break}return 0}const fLe=ty().command("fetch",(n,e)=>{const[t,r,i="get",s]=Pt(e,0,[lt.NAME,lt.NAME,lt.MAYBE_STRING]);return v$(void 0,t,r,i,e,s),0}).command("fetchwith",(n,e)=>{const[t,r,i,s="get",o]=Pt(e,0,[lt.ANY,lt.NAME,lt.NAME,lt.MAYBE_STRING]);return v$(t,r,i,s,e,o),0}),dLe=ty({set(n,e,t){return ADe(n,e,t),[!1,void 0]},aftertick(n){const e=CDe(fe.elementid),[t]=e;if(e.length===1&&un(t)){if(he(fe.element))if(t.trim().length===0){const r=v2(fe.elementid);r.sidebar=[]}else fe.element.tickertext=t,fe.element.tickertime=fe.timestamp,AU(fe.board?.id,fe.element,t)}else if(e.length>1)if(fe.elementisplayer){const r=v2(fe.elementid);r.sidebar=u$(e)}else{const r=fe.elementfocus;n.scrolllock(r);const i=v2(r);i.scrollname=fe.element?.name??fe.element?.kinddata?.name??"",i.scroll=u$(e)}}}).command("endgame",n=>(n.set("health",0),0)).command("shortsend",(n,e)=>{const t=bx(e);return Ex(n,fe.element,t),0}).command("send",(n,e)=>{const t=bx(e,!0);return Ex(n,fe.element,t),0}).command("stat",()=>0).command("text",(n,e)=>{const t=e.map(ro).join("");return RDe(fe.elementid,t),0}).command("hyperlink",(n,e)=>{const[t,...r]=e,i=n.template(ro(t).split(" ")),s=n.template(r);return kDe(fe.elementid,n.id(),i,s.split(" "),n.get,n.set),0}).command("help",()=>(m6(qe,fe.elementfocus),0));function pLe(n,e,t,r,i){if(!he(fe.book))return;const s=Cs(n);if(!he(s))return;const o=RU(),a=i==="all"||i==="object",c=i==="all"||i==="terrain";hc(s),hc(o);const l=-Math.tan(e*.5),u=Math.sin(e),h=Math.round(12.5*l),f=Math.round(12.5*u),d=new Array(wr).fill(0);fj(h,0,-h,wr-1).forEach(S=>{S.x<0?d[S.y]=Math.min(d[S.y],S.x):d[S.y]=Math.max(d[S.y],S.x)});const m=new Array(bn).fill(0);fj(0,f,bn-1,-f).forEach(S=>{S.y<0?m[S.x]=Math.min(m[S.x],S.y):m[S.x]=Math.max(m[S.x],S.y)});const v=[d,m,d];for(let S=0;S<v.length;++S){const b=v[S];if(S!==1){for(let T=0;T<wr;++T){const w=b[T],R=T*bn;for(let C=0;C<bn;C++){const N=(C+w+bn)%bn;c&&(o.terrain[N+R]=s.terrain[C+R])}}if(a){const T=Object.keys(s.objects);for(let w=0;w<T.length;++w){const R=T[w],{x:C,y:N}=s.objects[R];if(he(C)&&he(N)){const U=b[N];s.objects[R].x=(C+U+bn)%bn,s.objects[R].lx=s.objects[R].x}}}}if(S===1){for(let T=0;T<bn;++T){const w=b[T];for(let R=0;R<wr;++R){const C=(R+w+wr)%wr;c&&(o.terrain[T+C*bn]=s.terrain[T+R*bn])}}if(a){const T=Object.keys(s.objects);for(let w=0;w<T.length;++w){const R=T[w],{x:C,y:N}=s.objects[R];if(he(C)&&he(N)){const U=b[C];s.objects[R].y=(N+U+wr)%wr,s.objects[R].ly=s.objects[R].y}}}}c&&(s.terrain=[...o.terrain]),hc(o),hc(s)}}var b2,y$;function mLe(){if(y$)return b2;y$=1;function n(e,t){let r=0,i=0,s=0;for(;s<e.length;s++)r+=e[s];for(s=0,t*=r;t&&s<e.length;){if(i+=e[s],t<=i)return s;s++}return 0}return b2=n,b2}var S2,b$;function aee(){if(b$)return S2;b$=1;const n=mLe(),e=function(){};return e.prototype.FMX=0,e.prototype.FMY=0,e.prototype.FMXxFMY=0,e.prototype.T=0,e.prototype.N=0,e.prototype.initiliazedField=!1,e.prototype.generationComplete=!1,e.prototype.wave=null,e.prototype.compatible=null,e.prototype.weightLogWeights=null,e.prototype.sumOfWeights=0,e.prototype.sumOfWeightLogWeights=0,e.prototype.startingEntropy=0,e.prototype.sumsOfOnes=null,e.prototype.sumsOfWeights=null,e.prototype.sumsOfWeightLogWeights=null,e.prototype.entropies=null,e.prototype.propagator=null,e.prototype.observed=null,e.prototype.distribution=null,e.prototype.stack=null,e.prototype.stackSize=0,e.prototype.DX=[-1,0,1,0],e.prototype.DY=[0,1,0,-1],e.prototype.opposite=[2,3,0,1],e.prototype.initialize=function(){this.distribution=new Array(this.T),this.wave=new Array(this.FMXxFMY),this.compatible=new Array(this.FMXxFMY);for(let t=0;t<this.FMXxFMY;t++){this.wave[t]=new Array(this.T),this.compatible[t]=new Array(this.T);for(let r=0;r<this.T;r++)this.compatible[t][r]=[0,0,0,0]}this.weightLogWeights=new Array(this.T),this.sumOfWeights=0,this.sumOfWeightLogWeights=0;for(let t=0;t<this.T;t++)this.weightLogWeights[t]=this.weights[t]*Math.log(this.weights[t]),this.sumOfWeights+=this.weights[t],this.sumOfWeightLogWeights+=this.weightLogWeights[t];this.startingEntropy=Math.log(this.sumOfWeights)-this.sumOfWeightLogWeights/this.sumOfWeights,this.sumsOfOnes=new Array(this.FMXxFMY),this.sumsOfWeights=new Array(this.FMXxFMY),this.sumsOfWeightLogWeights=new Array(this.FMXxFMY),this.entropies=new Array(this.FMXxFMY),this.stack=new Array(this.FMXxFMY*this.T),this.stackSize=0},e.prototype.observe=function(t){let r=1e3,i=-1;for(let a=0;a<this.FMXxFMY;a++){if(this.onBoundary(a%this.FMX,a/this.FMX|0))continue;const c=this.sumsOfOnes[a];if(c===0)return!1;const l=this.entropies[a];if(c>1&&l<=r){const u=1e-6*t();l+u<r&&(r=l+u,i=a)}}if(i===-1){this.observed=new Array(this.FMXxFMY);for(let a=0;a<this.FMXxFMY;a++)for(let c=0;c<this.T;c++)if(this.wave[a][c]){this.observed[a]=c;break}return!0}for(let a=0;a<this.T;a++)this.distribution[a]=this.wave[i][a]?this.weights[a]:0;const s=n(this.distribution,t()),o=this.wave[i];for(let a=0;a<this.T;a++)o[a]!==(a===s)&&this.ban(i,a);return null},e.prototype.propagate=function(){for(;this.stackSize>0;){const t=this.stack[this.stackSize-1];this.stackSize--;const r=t[0],i=r%this.FMX,s=r/this.FMX|0;for(let o=0;o<4;o++){const a=this.DX[o],c=this.DY[o];let l=i+a,u=s+c;if(this.onBoundary(l,u))continue;l<0?l+=this.FMX:l>=this.FMX&&(l-=this.FMX),u<0?u+=this.FMY:u>=this.FMY&&(u-=this.FMY);const h=l+u*this.FMX,f=this.propagator[o][t[1]],d=this.compatible[h];for(let p=0;p<f.length;p++){const m=f[p],_=d[m];_[o]--,_[o]==0&&this.ban(h,m)}}}},e.prototype.singleIteration=function(t){const r=this.observe(t);return r!==null?(this.generationComplete=r,!!r):(this.propagate(),null)},e.prototype.iterate=function(t,r){this.wave||this.initialize(),this.initiliazedField||this.clear(),t=t||0,r=r||Math.random;for(let i=0;i<t||t===0;i++){const s=this.singleIteration(r);if(s!==null)return!!s}return!0},e.prototype.generate=function(t){for(t=t||Math.random,this.wave||this.initialize(),this.clear();;){const r=this.singleIteration(t);if(r!==null)return!!r}},e.prototype.isGenerationComplete=function(){return this.generationComplete},e.prototype.ban=function(t,r){const i=this.compatible[t][r];for(let o=0;o<4;o++)i[o]=0;this.wave[t][r]=!1,this.stack[this.stackSize]=[t,r],this.stackSize++,this.sumsOfOnes[t]-=1,this.sumsOfWeights[t]-=this.weights[r],this.sumsOfWeightLogWeights[t]-=this.weightLogWeights[r];const s=this.sumsOfWeights[t];this.entropies[t]=Math.log(s)-this.sumsOfWeightLogWeights[t]/s},e.prototype.clear=function(){for(let t=0;t<this.FMXxFMY;t++){for(let r=0;r<this.T;r++){this.wave[t][r]=!0;for(let i=0;i<4;i++)this.compatible[t][r][i]=this.propagator[this.opposite[i]][r].length}this.sumsOfOnes[t]=this.weights.length,this.sumsOfWeights[t]=this.sumOfWeights,this.sumsOfWeightLogWeights[t]=this.sumOfWeightLogWeights,this.entropies[t]=this.startingEntropy}this.initiliazedField=!0,this.generationComplete=!1},S2=e,S2}var E2,S$;function gLe(){if(S$)return E2;S$=1;const n=aee(),e=function(r,i,s,o,a,c,l,u,h,f){f=f||0,this.N=o,this.FMX=a,this.FMY=c,this.FMXxFMY=a*c,this.periodic=u;const d=i,p=new Array(d);for(let $=0;$<d;$++)p[$]=new Array(s);this.colors=[];const m={};for(let $=0;$<s;$++)for(let I=0;I<i;I++){const L=($*i+I)*4,P=[r[L],r[L+1],r[L+2],r[L+3]],H=P.join("-");m.hasOwnProperty(H)||(m[H]=this.colors.length,this.colors.push(P)),p[I][$]=m[H]}const _=this.colors.length,v=Math.pow(_,o*o),S=function(I){let L=new Array(o*o);for(let P=0;P<o;P++)for(let H=0;H<o;H++)L[H+P*o]=I(H,P);return L},b=function(I,L){return S(function(P,H){return p[(I+P)%i][(L+H)%s]})},T=function(I){return S(function(L,P){return I[o-1-P+L*o]})},w=function(I){return S(function(L,P){return I[o-1-L+P*o]})},R=function(I){let L=0,P=1;for(let H=0;H<I.length;H++)L+=I[I.length-1-H]*P,P*=_;return L},C=function(I){let L=I,P=v;const H=new Array(o*o);for(let X=0;X<H.length;X++){P/=_;let G=0;for(;L>=P;)L-=P,G++;H[X]=G}return H},N={},U=[];for(let $=0;$<(l?s:s-o+1);$++)for(let I=0;I<(l?i:i-o+1);I++){const L=new Array(8);L[0]=b(I,$),L[1]=w(L[0]),L[2]=T(L[0]),L[3]=w(L[2]),L[4]=T(L[2]),L[5]=w(L[4]),L[6]=T(L[4]),L[7]=w(L[6]);for(let P=0;P<h;P++){const H=R(L[P]);N[H]?N[H]++:(U.push(H),N[H]=1)}}this.T=U.length,this.ground=(f+this.T)%this.T,this.patterns=new Array(this.T),this.weights=new Array(this.T);for(let $=0;$<this.T;$++){const I=parseInt(U[$],10);this.patterns[$]=C(I),this.weights[$]=N[I]}const B=function(I,L,P,H){const X=P<0?0:P,G=P<0?P+o:o,Y=H<0?0:H,J=H<0?H+o:o;for(let Q=Y;Q<J;Q++)for(let z=X;z<G;z++)if(I[z+o*Q]!=L[z-P+o*(Q-H)])return!1;return!0};this.propagator=new Array(4);for(let $=0;$<4;$++){this.propagator[$]=new Array(this.T);for(let I=0;I<this.T;I++){const L=[];for(let P=0;P<this.T;P++)B(this.patterns[I],this.patterns[P],this.DX[$],this.DY[$])&&L.push(P);this.propagator[$][I]=L}}};return e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(t,r){return!this.periodic&&(t+this.N>this.FMX||r+this.N>this.FMY||t<0||r<0)},e.prototype.clear=function(){if(n.prototype.clear.call(this),this.ground!==0){for(let t=0;t<this.FMX;t++){for(let r=0;r<this.T;r++)r!==this.ground&&this.ban(t+(this.FMY-1)*this.FMX,r);for(let r=0;r<this.FMY-1;r++)this.ban(t+r*this.FMX,this.ground)}this.propagate()}},e.prototype.graphics=function(t){return t=t||new Uint8Array(this.FMXxFMY*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t),t},e.prototype.graphicsComplete=function(t){for(let r=0;r<this.FMY;r++){const i=r<this.FMY-this.N+1?0:this.N-1;for(let s=0;s<this.FMX;s++){const o=s<this.FMX-this.N+1?0:this.N-1,a=(r*this.FMX+s)*4,c=this.colors[this.patterns[this.observed[s-o+(r-i)*this.FMX]][o+i*this.N]];t[a]=c[0],t[a+1]=c[1],t[a+2]=c[2],t[a+3]=c[3]}}},e.prototype.graphicsIncomplete=function(t){for(let r=0;r<this.FMXxFMY;r++){const i=r%this.FMX,s=r/this.FMX|0;let o=0,a=0,c=0,l=0,u=0;for(let f=0;f<this.N;f++)for(let d=0;d<this.N;d++){let p=i-d;p<0&&(p+=this.FMX);let m=s-f;if(m<0&&(m+=this.FMY),this.onBoundary(p,m))continue;const _=p+m*this.FMX;for(let v=0;v<this.T;v++)if(this.wave[_][v]){o++;const S=this.colors[this.patterns[v][d+f*this.N]];a+=S[0],c+=S[1],l+=S[2],u+=S[3]}}const h=r*4;t[h]=a/o,t[h+1]=c/o,t[h+2]=l/o,t[h+3]=u/o}},E2=e,E2}var x2,E$;function _Le(){if(E$)return x2;E$=1;const n=aee(),e=function(r,i,s,o,a){const c=r.tilesize||16;this.FMX=s,this.FMY=o,this.FMXxFMY=s*o,this.periodic=a,this.tilesize=c;const l=!!r.unique;let u=null;i&&r.subsets&&r.subsets[i]&&(u=r.subsets[i]);const h=function(R){const C=new Array(c*c);for(let N=0;N<c;N++)for(let U=0;U<c;U++)C[U+N*c]=R(U,N);return C},f=function(R){return h(function(C,N){return R[c-1-N+C*c]})},d=function(R){return h(function(C,N){return R[c-1-C+N*c]})};this.tiles=[];const p=[],m=[],_={};let v,S,b;for(let w=0;w<r.tiles.length;w++){const R=r.tiles[w];if(u!==null&&u.indexOf(R.name)===-1)continue;switch(R.symmetry){case"L":b=4,v=function(N){return(N+1)%4},S=function(N){return N%2===0?N+1:N-1};break;case"T":b=4,v=function(N){return(N+1)%4},S=function(N){return N%2===0?N:4-N};break;case"I":b=2,v=function(N){return 1-N},S=function(N){return N};break;case"\\":b=2,v=function(N){return 1-N},S=function(N){return 1-N};break;case"F":b=8,v=function(N){return N<4?(N+1)%4:4+(N-1)%4},S=function(N){return N<4?N+4:N-4};break;default:b=1,v=function(N){return N},S=function(N){return N};break}this.T=m.length,_[R.name]=this.T;for(let N=0;N<b;N++)m.push([this.T+N,this.T+v(N),this.T+v(v(N)),this.T+v(v(v(N))),this.T+S(N),this.T+S(v(N)),this.T+S(v(v(N))),this.T+S(v(v(v(N))))]);let C;if(l)for(let N=0;N<b;N++)C=R.bitmap[N],this.tiles.push(h(function(U,B){return[C[(c*B+U)*4],C[(c*B+U)*4+1],C[(c*B+U)*4+2],C[(c*B+U)*4+3]]}));else{C=R.bitmap,this.tiles.push(h(function(N,U){return[C[(c*U+N)*4],C[(c*U+N)*4+1],C[(c*U+N)*4+2],C[(c*U+N)*4+3]]}));for(let N=1;N<b;N++)this.tiles.push(N<4?f(this.tiles[this.T+N-1]):d(this.tiles[this.T+N-4]))}for(let N=0;N<b;N++)p.push(R.weight||1)}this.T=m.length,this.weights=p,this.propagator=new Array(4);const T=new Array(4);for(let w=0;w<4;w++){this.propagator[w]=new Array(this.T),T[w]=new Array(this.T);for(let R=0;R<this.T;R++){T[w][R]=new Array(this.T);for(let C=0;C<this.T;C++)T[w][R][C]=!1}}for(let w=0;w<r.neighbors.length;w++){const R=r.neighbors[w],C=R.left.split(" ").filter(function(L){return L.length}),N=R.right.split(" ").filter(function(L){return L.length});if(u!==null&&(u.indexOf(C[0])===-1||u.indexOf(N[0])===-1))continue;const U=m[_[C[0]]][C.length==1?0:parseInt(C[1],10)],B=m[U][1],$=m[_[N[0]]][N.length==1?0:parseInt(N[1],10)],I=m[$][1];T[0][$][U]=!0,T[0][m[$][6]][m[U][6]]=!0,T[0][m[U][4]][m[$][4]]=!0,T[0][m[U][2]][m[$][2]]=!0,T[1][I][B]=!0,T[1][m[B][6]][m[I][6]]=!0,T[1][m[I][4]][m[B][4]]=!0,T[1][m[B][2]][m[I][2]]=!0}for(let w=0;w<this.T;w++)for(let R=0;R<this.T;R++)T[2][w][R]=T[0][R][w],T[3][w][R]=T[1][R][w];for(let w=0;w<4;w++)for(let R=0;R<this.T;R++){const C=[],N=T[w][R];for(let U=0;U<this.T;U++)N[U]&&C.push(U);this.propagator[w][R]=C}};return e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.onBoundary=function(t,r){return!this.periodic&&(t<0||r<0||t>=this.FMX||r>=this.FMY)},e.prototype.graphics=function(t,r){return t=t||new Uint8Array(this.FMXxFMY*this.tilesize*this.tilesize*4),this.isGenerationComplete()?this.graphicsComplete(t):this.graphicsIncomplete(t,r),t},e.prototype.graphicsComplete=function(t){for(let r=0;r<this.FMX;r++)for(let i=0;i<this.FMY;i++){const s=this.tiles[this.observed[r+i*this.FMX]];for(let o=0;o<this.tilesize;o++)for(let a=0;a<this.tilesize;a++){const c=(r*this.tilesize+a+(i*this.tilesize+o)*this.FMX*this.tilesize)*4,l=s[a+o*this.tilesize];t[c]=l[0],t[c+1]=l[1],t[c+2]=l[2],t[c+3]=l[3]}}},e.prototype.graphicsIncomplete=function(t,r){(!r||r.length!==4)&&(r=!1);for(let i=0;i<this.FMX;i++)for(let s=0;s<this.FMY;s++){const o=this.wave[i+s*this.FMX];let a=0,c=0;for(let u=0;u<this.T;u++)o[u]&&(a++,c+=this.weights[u]);const l=1/c;for(let u=0;u<this.tilesize;u++)for(let h=0;h<this.tilesize;h++){const f=(i*this.tilesize+h+(s*this.tilesize+u)*this.FMX*this.tilesize)*4;if(r&&a===this.T)t[f]=r[0],t[f+1]=r[1],t[f+2]=r[2],t[f+3]=r[3];else{let d=0,p=0,m=0,_=0;for(let v=0;v<this.T;v++)if(o[v]){const S=this.tiles[v][h+u*this.tilesize],b=this.weights[v]*l;d+=S[0]*b,p+=S[1]*b,m+=S[2]*b,_+=S[3]*b}t[f]=d,t[f+1]=p,t[f+2]=m,t[f+3]=_}}}},x2=e,x2}var T2,x$;function vLe(){return x$||(x$=1,T2={OverlappingModel:gLe(),SimpleTiledModel:_Le()}),T2}var yLe=vLe();const bLe=wu(yLe);function SLe(n,e,t,r,i,s,o){if(!he(fe.book))return!1;const a=fe.book,c=Cs(n);if(!he(c))return!1;const l=Cs(e);if(!he(l))return!1;hc(c),hc(l);let u=0;const h=new Map,f=new Map;let d=0;const p=32,m=new Uint8Array(cg*4);for(let T=0;T<wr;++T)for(let w=0;w<bn;++w){const R=ds(l,{x:w,y:T}),C=R?.char??0,N=R?.color??p,U=R?.bg??p;let B=0;const $=Sp(R),I=cr($?.name??"empty"),L=h.get(I);rn(L)?B=L:(B=u,h.set(I,u),f.set(u,I),u++),m[d++]=C,m[d++]=N,m[d++]=U,m[d++]=B}const _=s.x-i.x+1,v=s.y-i.y+1,S=new bLe.OverlappingModel(m,bn,wr,t,_,v,!0,!1,r);if(!S.generate())return!1;d=0;const b=S.graphics();for(let T=i.y;T<=s.y;++T)for(let w=i.x;w<=s.x;++w){const R={x:w,y:T},C=b[d++],N=b[d++],U=b[d++],B=b[d++];switch(o){case"all":{const P=ds(c,{x:w,y:T});As(P)&&fd(c,P,a.timestamp),Fl(c,{x:w,y:T});break}case"object":{const P=ds(c,{x:w,y:T});As(P)&&fd(c,P,a.timestamp);break}case"terrain":Fl(c,{x:w,y:T});break}let $=f.get(B)??"";const I=Sp({kind:$});switch(o){case"all":break;case"object":As(I)||($="");break;case"terrain":As(I)&&($="");break;default:if(ri(I,"group")!==o&&($=""),$){const P=ds(c,{x:w,y:T});As(P)&&fd(c,P,a.timestamp),Fl(c,{x:w,y:T})}break}const L=$?hd(c,[$],R):void 0;if(!(!he(L)||!he(I))&&(e1(L,I),C>0&&(L.char=C),N<p&&(L.color=N),U<p&&(L.bg=U),As(L))){const P=td(Wx(l,$));he(P)&&(Fl(c,{...Gv(l,P.x??0,P.y??0),x:w,y:T}),e1(L,P))}}return!0}function cee(n){return`zss_snapshot_${n}`}const lee={x:0,y:0},uee={x:bn-1,y:wr-1},hee="all";function ELe(n){const e=Cs(n);if(!he(e))return;const t=Mm(),r=cee(e.id);for(let s=0;s<t.length;++s)qZ(t[s],r);const i=Cs(r);if(he(i))return DO(n,i.id,lee,uee,hee),i}function xLe(n){const e=Cs(n);if(!he(e))return;const t=cee(e.id),r=Cs(t);if(he(r))return DO(r.id,n,lee,uee,hee),r}function TLe(n,e,t,r,i,s){switch(s){case"all":case"object":case"terrain":break;default:return wLe(n,e,i,s)}if(!he(fe.book))return;const o=Cs(n);if(!he(o))return;const a=RU();hc(o);for(let c=t.y;c<=r.y;++c)for(let l=t.x;l<=r.x;++l){let u=!1,h=!1;switch(s){case"all":u=!0,h=!0;break;case"object":u=!0;break;case"terrain":h=!0;break}const f=(l+e.x+bn)%bn,d=(c+e.y+wr)%wr;if(u){const p=ds(o,{x:l,y:c});As(p)&&he(p?.x)&&he(p?.y)&&(p.x=f,p.lx=f,p.y=d,p.ly=d)}h&&(a.terrain[f+d*bn]=o.terrain[l+c*bn])}(s==="all"||s==="terrain")&&(o.terrain=[...a.terrain]),hc(o)}function wLe(n,e,t,r){if(!he(fe.book))return;const i=fe.book,s=Cs(n);if(!he(s))return;hc(s);const{terrainelements:o,objectelements:a}=mee(s,t,r);if(o.length===0&&a.length===0)return;e.x<0&&(o.sort((d,p)=>{const m=d.x??0,_=p.x??0;return m-_}),a.sort((d,p)=>{const m=d.x??0,_=p.x??0;return m-_})),e.x>0&&(o.sort((d,p)=>{const m=d.x??0;return(p.x??0)-m}),a.sort((d,p)=>{const m=d.x??0;return(p.x??0)-m})),e.y<0&&(o.sort((d,p)=>{const m=d.y??0,_=p.y??0;return m-_}),a.sort((d,p)=>{const m=d.y??0,_=p.y??0;return m-_})),e.y>0&&(o.sort((d,p)=>{const m=d.y??0;return(p.y??0)-m}),a.sort((d,p)=>{const m=d.y??0;return(p.y??0)-m}));const c=a.map(d=>d.id??""),l=o.map(d=>od({x:d.x??0,y:d.y??0},bn)),u=[],h=[];for(let d=0;d<o.length;++d){const p=o[d],m={x:p.x??-1,y:p.y??-1},_=ds(s,m);he(_)&&As(_)&&(u.push(_.id??""),u.push(_.id??""),h.push(od({x:_.x??0,y:_.y??0},bn)))}let f=!1;for(let d=0;d<o.length;++d){const p=o[d],m=ri(p,"collision"),_={x:p.x??-1,y:p.y??-1},v=od(_,bn),S={x:_.x+e.x,y:_.y+e.y};if(zb(S)){const b=ds(s,S),T=b?.id??"",w=od({x:b?.x??0,y:b?.y??0},bn),R=ri(b,"collision");if(he(b)&&As(b)&&u.includes(T)!==!0&&c.includes(T)!==!0){let C=!1;const N=h.includes(v),U=N?ds(s,_):void 0,B=N?ri(U,"pushable"):!1,$=N&&B;if(JL(p,b)&&(m!==Fn.ISWALK||N)){let I=N;he(U)&&B&&(f=ff(i,s,U,{x:(U.x??0)-e.x,y:(U.y??0)-e.y})!==!0,f||(I=!1)),(I||m!==Fn.ISWALK)&&(f=ff(i,s,b,{x:(b.x??0)+e.x,y:(b.y??0)+e.y})!==!0,f&&(C=$))}else(m!==Fn.ISWALK||$)&&(f=!0,C=$);C&&he(U)&&(f=ff(i,s,U,{x:(U.x??0)-e.x,y:(U.y??0)-e.y})!==!0)}else R===Fn.ISSOLID&&l.includes(w)===!1&&(f=!0)}else f=!0}if(!f){for(let d=0;d<a.length;++d){const p=a[d],m=ri(p,"collision"),_={x:p.x??0,y:p.y??0},v={x:_.x+e.x,y:_.y+e.y};if(zb(v)){const S=ds(s,v),b=S?.id??"",T=ri(S,"collision"),w=ri(S,"group");he(S)&&As(S)&&u.includes(b)&&c.includes(b)!==!0?JL(p,S)?f=ff(i,s,S,v)!==!0:f=!0:Gx(m,T)&&r!==w&&(f=!0)}else f=!0}if(!f){for(let d=0;d<o.length;++d){const p=o[d],m={x:p.x??-1,y:p.y??-1},_={x:m.x+e.x,y:m.y+e.y},v=Gv(s,_.x,_.y);if(he(p)&&he(v)){Fl(s,{...p,x:_.x,y:_.y}),Fl(s,{...v,x:m.x,y:m.y});const S=ds(s,m);As(S)&&he(S)&&(S.x=(S.x??0)+e.x,S.y=(S.y??0)+e.y,S.lx=(S.lx??0)+e.x,S.ly=(S.ly??0)+e.y)}}hc(s);for(let d=0;d<a.length;++d){const p=a[d],m={x:p.x??-1,y:p.y??-1},_={x:m.x+e.x,y:m.y+e.y};if(!ff(i,s,p,_))break}hc(s)}}}function KR(n,e){let t="all";const r={x:0,y:0},i={x:bn-1,y:wr-1};for(let s=e;s<n.length;){const[o,a]=Pt(n,s,[lt.MAYBE_NUMBER_OR_STRING]);if(un(o))t=cr(o),s=a;else if(rn(o)){const[c,l,u,h]=Pt(n,a,[lt.NUMBER,lt.MAYBE_NUMBER,lt.MAYBE_NUMBER]);r.x=Math.min(o,l??o),r.y=Math.min(c,u??c),i.x=Math.max(o,l??o),i.y=Math.max(c,u??c),s=h}else break}return{targetset:t,pt1:r,pt2:i}}function T$(n,e){const t=Mm();for(let r=0;r<t.length;++r){const i=t[r],s=td(XL(i,n,e));if(he(s))return s}}const ALe=ty().command("snapshot",()=>(!he(fe.book)||!he(fe.board)||ELe(fe.board.id),0)).command("revert",()=>(!he(fe.book)||!he(fe.board)||xLe(fe.board.id),0)).command("copy",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r]=Pt(e,0,[lt.STRING]),i=T$(Jr.BOARD,t);if(he(i)){const s=KR(e,r);DO(i.id,fe.board.id,s.pt1,s.pt2,s.targetset)}return 0}).command("remix",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r,i,s]=Pt(e,0,[lt.STRING,lt.NUMBER,lt.NUMBER]),o=T$(Jr.BOARD,t);if(he(o)){const a=KR(e,s);SLe(fe.board.id,o.id,r,i,a.pt1,a.pt2,a.targetset)}return 0}).command("weave",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r]=Pt(e,0,[lt.DIR]),i={x:t.destpt.x-(fe.element?.x??0),y:t.destpt.y-(fe.element?.y??0)},s=KR(e,r);return TLe(fe.board.id,i,s.pt1,s.pt2,fe.elementid,s.targetset),0}).command("pivot",(n,e)=>{if(!he(fe.book)||!he(fe.board))return 0;const[t,r]=Pt(e,0,[lt.NUMBER]),i=KR(e,r);return pLe(fe.board.id,TY(t),i.pt1,i.pt2,i.targetset),0});var wU=(n=>(n[n.ERROR=0]="ERROR",n[n.CLI=1]="CLI",n[n.LOADER=2]="LOADER",n[n.RUNTIME=3]="RUNTIME",n))(wU||{});const CLe={audio:PO,board:zwe,cli:HDe,element:KDe,runtime:dLe,loader:hLe,network:fLe,transform:ALe},w2=["audio","board","network","transform","element"],RLe={0:[],1:["cli",...w2],2:["loader",...w2],3:["runtime",...w2]},kLe={0:new Map,1:new Map,2:new Map,3:new Map};function vC(n){return(RLe[n]??[]).map(t=>CLe[t]).filter(he)}function MLe(n,e){const t=kLe[n];if(!t.has(e)){let r;const i=vC(n);for(let s=0;s<i.length&&(r=i[s].getcommand(e),!he(r));++s);t.set(e,r)}return t.get(e)}function ILe(n,e,t){const r=vC(n);for(let i=0;i<r.length;++i){const s=r[i];if(s.get!==void 0){const[o,a]=s.get(e,t);if(o)return[o,a]}}return[!1,void 0]}function OLe(n,e,t,r){const i=vC(n);for(let s=0;s<i.length;++s){const o=i[s];if(o.set!==void 0){const[a]=o.set(e,t,r);if(a)return[a,r]}}return[!1,void 0]}function NLe(n,e){const t=vC(n);for(let r=0;r<t.length;++r)t[r].everytick(e)}function PLe(n,e){const t=vC(n);for(let r=0;r<t.length;++r)t[r].aftertick(e)}function A2(n){return sr(n)?n.length>0?1:0:n??0}function DLe(n){return`${n}_chip`}function fee(n=""){return`vm:${n??""}`}function LLe(n,e,t){const r=DLe(n),i=G0(r);let s;const o=Ks(Object.entries(t.labels??{}));(!sr(i.lb)||i.lb.length!==o.length)&&(i.lb=o,i.lk="",i.sk="",i.mg=void 0,i.ec=1,i.lc=0,i.ys=0,i.ps=0,i.es=(t.errors?.length??0)!==0?1:0);function a(l,u){fe.words=u;const h=MLe(e,l);return he(h)?h(c,u):l!=="send"?a("shortsend",[l,...u]):0}const c={halt(){hTe(r)},id(){return n},set(l,u){const[h,f]=OLe(e,c,l,u);if(h)return f},get(l){const[u,h]=ILe(e,c,l);if(u)return h},once(){i.lc=0,i.ys=0,fe.get=c.get;try{s?.(c)||(i.es=1)}catch(l){_r(qe,fe.elementfocus,"crash",l.message),i.es=1}},tick(l){const u=rn(i.ps)?i.ps:0,h=u%l===0;if(i.ps=u+1,h===!1)return!1;NLe(e,c);const f=c.shouldtick();return f&&c.once(),PLe(e,c),f},isended(){return i.es===1},isfirstpulse(){return i.ps===1},shouldtick(){return!i.sk&&(i.es===0||c.hm()!==0)},checkcount(){return rn(i.lc)?++i.lc>kn.YIELD_AT_COUNT:!0},haslabel(l){if(sr(i.lb))for(let u=0;u<i.lb.length;++u){const[h,f]=i.lb[u];if(h===l)return(f.find(p=>rn(p)&&p>0)??0)>0}return!1},hm(){if(sr(i.mg)&&sr(i.lb)){const[l]=i.mg;if(he(l))for(let u=0;u<i.lb.length;++u){const[h,f]=i.lb[u];if(h===l)return f.find(d=>rn(d)&&d>0)??0}}return 0},yield(){i.ys=1},jump(l){i.ec=l},sy(){return!!i.ys||c.checkcount()},send(l,u,h,f){qe.emit(l,`${fee(u)}:${h}`,f)},lock(l){i.lk=l},unlock(){i.lk=""},scrolllock(l){i.sk=l},scrollunlock(l){i.sk===l&&(i.sk="")},message(l){i.sk&&l.player!==i.sk||i.lk&&l.sender!==i.lk||c.haslabel(l.target)&&(i.mg=[l.target,l.data,l.sender,l.player])},zap(l){if(sr(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l){const f=h[1].findIndex(d=>d>0);if(f>=0&&he(h[1])){h[1][f]*=-1;break}}}},restore(l){if(sr(i.lb))for(let u=0;u<i.lb.length;++u){const h=i.lb[u];if(h[0]===l)for(let f=0;f<h[1].length;f++)h[1][f]=Math.abs(h[1][f])}},getcase(){i.ec=rn(i.ec)?i.ec:1;const l=c.hm();if(l&&sr(i.mg)){const[,u,h,f]=i.mg;c.set("senderid",h),he(u)&&c.set("arg",u),f&&(c.set("player",f),fe.elementfocus=f),i.mg=void 0,i.ys=0,i.es=0,i.ec=l}return i.ec},nextcase(){const l=rn(i.ec)?i.ec:1;return i.ec=l+1,i.ec},endofprogram(){c.yield(),i.es=1},stacktrace(l){const u=STe.parse(l),[h]=u.filter(f=>f.fileName===OO);return{line:h?.lineNumber??0,column:h?.columnNumber??0}},text(l){return a("text",[l])},stat(...l){return a("stat",l)},hyperlink(...l){return a("hyperlink",l)},print(l){return sr(l)?`array ${l.length} ${l.length===1?"item":"items"}`:typeof l=="object"?`obj ${Object.keys(l).join(", ")}`:l},template(l){return Jx(l.join(" "),!0).tokens.map(h=>{if(h.tokenType===yC){const f=c.get(h.image.substring(1));if(he(f))return f}return h.image}).join(" ")},command(...l){if(l.length===0)return 0;const[u,...h]=l;return a(cr(ro(u)),h)},if(...l){const[u,h]=Pt(l,0,[lt.ANY]),f=A2(u);return f&&h<l.length&&c.command(...l.slice(h)),f?1:0},try(...l){const[,u]=Pt(l,0,[lt.DIR]),h=c.command("go",...l);return h&&u<l.length&&c.command(...l.slice(u)),h?1:0},take(...l){const[u,h,f]=Pt(l,0,[lt.NAME,lt.ANY]),d=rn(h),p=d?f:1,m=c.get(u),_=d?h:1;if(!rn(m))return p<l.length&&c.command(...l.slice(p)),1;const v=m-_;return v<0?(p<l.length&&c.command(...l.slice(p)),1):(c.set(u,v),0)},give(...l){const[u,h,f]=Pt(l,0,[lt.NAME,lt.ANY]),d=rn(h),p=d?f:1,m=c.get(u),_=d?h:1,v=m===void 0?1:0;return v&&p<l.length&&c.command(...l.slice(p)),c.set(u,Rb(m,0)+_),v},duplicate(...l){return c.command("duplicate",...l)},repeatstart(l,...u){const[h,f]=Pt(u,0,[lt.NUMBER]),d=`repeatcount${l}`,p=`repeatwords${l}`;i[d]=h,i[p]=f<u.length?u.slice(f):void 0},repeat(l){const u=`repeatcount${l}`,h=`repeatwords${l}`;if(!rn(i[u]))return 0;const f=i[u];i[u]=f-1;const d=f>0,p=i[h];return d&&sr(p)&&c.command(...p),d?1:0},foreachstart(l,...u){const[h,f]=Pt(u,0,[lt.NAME,lt.ANY]);if(sr(f)){const d=`${h}_values`,p=Ks(f);c.set(h,p.shift()),c.set(d,p)}else{const[,d,p,m]=Pt(u,0,[lt.NAME,lt.NUMBER,lt.NUMBER,lt.MAYBE_NUMBER]);let _=Math.min(d,p),v=Math.max(d,p);const S=(m??0)||1;if(S<0){const b=_;_=v,v=b}c.set(h,_-S)}return 0},foreach(l,...u){const[h,f]=Pt(u,0,[lt.NAME,lt.ANY]);if(sr(f)){const R=`${h}_values`,C=c.get(R),N=C.shift();return c.set(h,N),C.length>0?1:0}const[,d,p,m,_]=Pt(u,0,[lt.NAME,lt.NUMBER,lt.NUMBER,lt.MAYBE_NUMBER]);let v=Math.min(d,p),S=Math.max(d,p);const b=(m??0)||1;if(b<0){const R=v;v=S,S=R}let T=c.get(h);!rn(T)||T<v||T>S?T=v:T+=b;const w=T<=S?1:0;return w&&(c.set(h,T),_<u.length&&c.command(...u.slice(_))),w},waitfor(...l){const[u]=Pt(l,0,[lt.ANY]),h=A2(u);return h||c.yield(),h?1:0},or(...l){let u=0;for(let h=0;h<l.length;){const[f,d]=Pt(l,h,[lt.ANY]);if(u=f,u)break;h=d}return u},and(...l){let u=0;for(let h=0;h<l.length;){const[f,d]=Pt(l,h,[lt.ANY]);if(u=f,!u)break;h=d}return u},not(...l){const[u]=Pt(l,0,[lt.ANY]);return A2(u)?0:1},expr(...l){const[u]=Pt(l,0,[lt.ANY]);return u},isEq(l,u){const[h]=Pt([l],0,[lt.ANY]),[f]=Pt([u],0,[lt.ANY]);return typeof h=="object"||typeof f=="object"?Ev(h,f)?1:0:h===f?1:0},isNotEq(l,u){return this.isEq(l,u)?0:1},isLessThan(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return h<f?1:0},isGreaterThan(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return h>f?1:0},isLessThanOrEq(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return h<=f?1:0},isGreaterThanOrEq(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return h>=f?1:0},opPlus(l,u){const[h]=Pt([l],0,[lt.ANY]),[f]=Pt([u],0,[lt.ANY]);return h+f},opMinus(l,u){const[h]=Pt([l],0,[lt.ANY]),[f]=Pt([u],0,[lt.ANY]);return h-f},opPower(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return Math.pow(h,f)},opMultiply(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return h*f},opDivide(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return h/f},opModDivide(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return h%f},opFloorDivide(l,u){const[h]=Pt([l],0,[lt.NUMBER]),[f]=Pt([u],0,[lt.NUMBER]);return Math.floor(h/f)},opUniPlus(l){const[u]=Pt([l],0,[lt.NUMBER]);return+u},opUniMinus(l){const[u]=Pt([l],0,[lt.NUMBER]);return-u}};return s=t.code,c}function w$(n,e){const t=zl(n.id),r=zl(n.party??n.id),i=n.kind==="object"||n.kind==="scroll";let s="";n.party&&r&&(s=n.party),t&&(s=n.id??"");const o=zl(e.party??e.id),a=e.kind==="object"||e.kind==="scroll";return{sameparty:r===o&&!a&&!i,fromelementplayer:s}}function ULe(n,e,t,r){const i=Um(ac.MAIN);if(!he(i))return;function s(o){for(let a=0;a<o.length;++a){const c=o[a];if(he(c.id)){const l=`${fee(c.id)}:${e}`;qe.emit("",l,t)}}}if(Dv(n)){for(let o=0;o<r.length;++o){const a=r[o],c=ds(a,n);he(c)&&s([c])}return}for(let o=0;o<r.length;++o){const a=r[o];switch(cr(n)){case"all":case"self":case"others":{s(Object.values(a.objects));break}default:{s(vJ(a,[n]));break}}}}function Wo(n,e,t){if(!he(fe.board)||!he(n))return;const r=zl(n.id),i=zl(e.id);let s=t,o=r&&!i?n.id??"":"";switch(t){case"shot":{const{sameparty:a,fromelementplayer:c}=w$(n,e);a&&As(e)?s="partyshot":o=c;break}case"touch":{const{sameparty:a,fromelementplayer:c}=w$(n,e);a?s="bump":o=c;break}}if(s==="shot"&&ri(e,"breakable")&&fd(fe.board,e,fe.timestamp),he(e?.id)){let a="";he(n?.id)?a=n.id:a=`${od({x:n.x??0,y:n.y??0},bn)}`,Iwe({id:Yo(),session:qe.session(),player:o,sender:a,target:`${e.id}:${s}`,data:void 0})}}function Ex(n,e,t){if(he(t.targetname)){const r=Object.keys(fe.board?.objects??{});switch(t.targetname){case"all":for(let i=0;i<r.length;++i){const s=r[i],o=wh(fe.board,s);he(o)&&Wo(e,o,t.label)}break;case"others":for(let i=0;i<r.length;++i){const s=r[i],o=wh(fe.board,s);s!==n.id()&&he(o)&&Wo(e,o,t.label)}break;case"sender":{const i=dee(fe.board,fe.element?.sender??"");he(i)&&As(i)&&Wo(e,i,t.label);break}case"self":fe.elementid!==n.id()?n.send(fe.elementfocus,fe.elementid,t.label):he(fe.element)&&Wo(e,fe.element,t.label);break;case"ping":{const i=Um(ac.MAIN),s=kwe(i);ULe("all",t.label,void 0,s);break}default:{const i=vJ(fe.board,[t.targetname]);for(let s=0;s<i.length;++s){const o=i[s];he(o)&&Wo(e,o,t.label)}break}}}else if(he(t.targetdir))if(t.targetdir.targets.length)for(let r=0;r<t.targetdir.targets.length;++r){const i=ds(fe.board,t.targetdir.targets[r]);he(i)&&Wo(e,i,t.label)}else{const r=ds(fe.board,t.targetdir.destpt);he(r)&&Wo(e,r,t.label)}}function AU(n,e,t){!he(n)||!he(e?.id)||WL(qe,n,`${$De(e)}${t}`)}function CU(n,e,t,r=!1){if(!he(n)||!he(n.lookup)||t.x<0||t.x>=bn||t.y<0||t.y>=wr)return{name:"edge",kind:"edge",collision:Fn.ISSOLID,x:t.x,y:t.y};const i=t.x+t.y*bn,s=wh(n,n.lookup[i]??"404");if(he(s))return r&&zl(s.id)?void 0:s;const o=n.terrain[i];if(he(o)&&Gx(e,ri(o,"collision")))return o}function BLe(n,e,t){const r=wh(n,e?.id??""),i=r?.x??-1,s=r?.y??-1;if(i-t.x===0&&s-t.y===0)return!0;const o=ri(r,"collision"),a=CU(n,o,t);return he(a)}function y4(n,e,t){const r=wh(n,e?.id??"");if(!he(n)||!he(r)||!he(r.x)||!he(r.y)||!he(n.lookup)||t.x<0||t.x>=bn||t.y<0||t.y>=wr)return{name:"edge",kind:"edge",collision:Fn.ISSOLID,x:t.x,y:t.y};if(r.x-t.x===0&&r.y-t.y===0)return;const i=RA(n,r),s=RA(n,t),o=ri(r,"collision");if(o===Fn.ISGHOST){r.x=t.x,r.y=t.y;return}const a=zl(r?.id),c=wh(n,n.lookup[s]??"");if(ri(c,"collision")===Fn.ISGHOST)return;const l=zl(c?.id??"");if(he(c)&&(!a||!l))return{...c};const u=n.terrain[s],h=ri(u,"collision");if(Gx(o,h))return{...u,x:t.x,y:t.y};r.x=t.x,r.y=t.y,he(r.removed)||(n.lookup[i]=void 0,n.lookup[s]=r.id??"")}function ff(n,e,t,r,i={}){if(!he(t?.id))return!1;let s=y4(e,t,r);const o=ri(t,"collision"),a=zl(t.id),c=o===Fn.ISBULLET;if(o!==Fn.ISBULLET&&he(s)&&As(s)){const l=Gv(e,s.x??-1,s.y??-1),u=ri(l,"collision");if(!Gx(o,u)){const h=zl(t?.id),f=!!ri(s,"item"),d=JL(t,s),p=s.id??"";if(d&&(!h||!f)&&!i[p]){i[p]=!0;const m=cp({x:t.x??0,y:t.y??0},r),_=Ho({x:s.x??0,y:s.y??0},m);!ff(n,e,s,_)&&h&&Wo(t,s,"touch")}s=y4(e,t,r)}}if(he(s)){const l=zl(s.id),u=ri(s,"collision")===Fn.ISBULLET,h=s.kind==="edge";return a?h?GLe(n,e,t,r)||Wo(s,t,"thud"):u?(e?.restartonzap&&C$(n,e,t,t.id??""),Wo(s,t,"shot"),Wo(t,s,"thud")):(Wo(s,t,"touch"),Wo(t,s,"touch")):c?u?(Wo(s,t,"thud"),Wo(t,s,"thud")):(l&&e?.restartonzap&&C$(n,e,s,s.id??""),Wo(s,t,"thud"),Wo(t,s,"shot")):l?(Wo(s,t,"touch"),Wo(t,s,"touch")):u?(Wo(s,t,"shot"),Wo(t,s,"thud")):(Wo(s,t,"thud"),Wo(t,s,"bump")),!1}return!0}function FLe(){return new Array(bn*wr).map(()=>{})}function RA(n,e){return!he(n)||!he(e?.x)||!he(e?.y)||e.x<0||e.x>=bn||e.y<0||e.y>=wr?-1:e.x+e.y*bn}function ds(n,e){const t=RA(n,e);if(t<0||!he(n?.lookup))return;const r=wh(n,n.lookup[t]??"");return he(r)?r:n.terrain[t]}function dee(n,e){const t=wh(n,e);if(he(t))return t;const r=parseFloat(e),i=$M(isNaN(r)?-1:r,bn);return Gv(n,i.x,i.y)}function vE(n,e,t,r,i){const s=yn.MID;if(!he(n)||!he(e))return{dir:r,startpt:i,destpt:i,layer:s,targets:[]};const o={x:e.x??0,y:e.y??0},a={x:o.x+(e.stepx??0),y:o.y+(e.stepy??0)},c=cp(o,a);for(let l=0;l<r.length;++l){const u=nK(r[l]);switch(u){case yn.IDLE:break;case yn.NORTH:case yn.SOUTH:case yn.WEST:case yn.EAST:Ho(o,u);break;case yn.BY:{const[h,f]=r.slice(l+1);rn(h)&&rn(f)&&(o.x+=h,o.y+=f),l+=2;break}case yn.TO:{const[h,f]=r.slice(l+1);rn(h)&&rn(f)&&(o.x=h,o.y=f),l+=2;break}case yn.AT:{const[h,f]=r.slice(l+1);rn(h)&&rn(f)&&(o.x=h,o.y=f),l+=2;break}case yn.FLOW:Ho(o,c);break;case yn.SEEK:{const h=jLe(n,e,t);Dv(h)&&Ho(o,cp(i,h));break}case yn.RNDNS:Ho(o,td(yn.NORTH,yn.SOUTH));break;case yn.RNDNE:Ho(o,td(yn.NORTH,yn.EAST));break;case yn.RND:Ho(o,td(yn.NORTH,yn.SOUTH,yn.WEST,yn.EAST));break;case yn.CW:case yn.CCW:case yn.OPP:case yn.RNDP:{const h=vE(n,e,t,r.slice(l+1),i);switch(o.x=i.x,o.y=i.y,u){case yn.CW:switch(cp(i,h.destpt)){case yn.NORTH:Ho(o,yn.EAST);break;case yn.SOUTH:Ho(o,yn.WEST);break;case yn.EAST:Ho(o,yn.SOUTH);break;case yn.WEST:Ho(o,yn.NORTH);break}break;case yn.CCW:switch(cp(i,h.destpt)){case yn.NORTH:Ho(o,yn.WEST);break;case yn.SOUTH:Ho(o,yn.EAST);break;case yn.EAST:Ho(o,yn.NORTH);break;case yn.WEST:Ho(o,yn.SOUTH);break}break;case yn.OPP:switch(cp(i,h.destpt)){case yn.NORTH:Ho(o,yn.SOUTH);break;case yn.SOUTH:Ho(o,yn.NORTH);break;case yn.EAST:Ho(o,yn.WEST);break;case yn.WEST:Ho(o,yn.EAST);break}break;case yn.RNDP:switch(cp(i,h.destpt)){case yn.NORTH:case yn.SOUTH:o.x+=td(-1,1);break;case yn.WEST:case yn.EAST:o.y+=td(-1,1);break}break}return{dir:r,startpt:i,destpt:o,layer:s,targets:[]}}case yn.FLEE:break;case yn.FIND:break;case yn.AWAY:{const[h,f]=r.slice(l+1);if(rn(h)&&rn(f)){const d={x:h,y:f},p=d.x-o.x,m=d.y-o.y;if(Math.abs(p)>1||Math.abs(m)>1){const _=ri(e,"collision"),v=kz(n,_,o,d,!0);if(he(v)&&(v.x!==h||v.y!==f)){const S=A$(n,v);he(S)||(o.x=v.x,o.y=v.y)}}else{const _=Cb(-p,-m);Ho(o,_)}}l+=2;break}case yn.TOWARD:{const[h,f]=r.slice(l+1);if(rn(h)&&rn(f)){const d={x:h,y:f},p=d.x-o.x,m=d.y-o.y;if(Math.abs(p)>1||Math.abs(m)>1){const _=ri(e,"collision"),v=kz(n,_,o,d,!1);if(he(v)&&(v.x!==h||v.y!==f)){const S=A$(n,v);he(S)||(o.x=v.x,o.y=v.y)}}else{const _=Cb(p,m);Ho(o,_)}}l+=2;break}case yn.MID:case yn.OVER:case yn.UNDER:case yn.GROUND:{const h=vE(n,e,t,r.slice(l+1),i);return h.layer=u,h}case yn.WITHIN:{const[h]=r.slice(l+1),f=vE(n,e,t,r.slice(l+2),i);if(f.targets.length===0&&rn(h)&&h>0)for(let d=-h;d<=h;++d)for(let p=-h;p<=h;++p){const m={x:f.destpt.x+p,y:f.destpt.y+d};zb(m)&&f.targets.push(m)}return rn(h)&&h>0?{...f,targets:f.targets.filter(d=>Dv(d)?hj(d,f.destpt)<=h:!1)}:f}case yn.AWAYBY:{const[h]=r.slice(l+1),f=vE(n,e,t,r.slice(l+2),i);if(f.targets.length===0)for(let d=-bn;d<=bn;++d)for(let p=-bn;p<=bn;++p){const m={x:f.destpt.x+p,y:f.destpt.y+d};zb(m)&&f.targets.push(m)}return rn(h)&&h>0?{...f,targets:f.targets.filter(d=>Dv(d)?hj(d,f.destpt)>=h:!1)}:f}case yn.ELEMENTS:{const h=vE(n,e,t,r.slice(l+1),i);o.x=i.x,o.y=i.y,h.targets=[];const f=cp(h.startpt,h.destpt);for(let d=0;d<bn&&(Ho(o,f),!!zb(o));++d)h.targets.push({x:o.x,y:o.y});return h}}}return{dir:r,startpt:i,destpt:o,layer:s,targets:[]}}function jLe(n,e,t){if(!he(n)||!he(e))return;const r=n.objects[t];if(he(r))return r;if(Dv(e))return yJ(e,Wx(n,"player"))}function Gv(n,e,t){return(e>=0&&e<bn)??(t>=0&&t<wr)?n?.terrain[e+t*bn]:void 0}function zLe(n,e){if(!he(n)||!he(e))return;const t=Ks(e);return t.id=t.id??Yo(),n.objects[t.id]=t,n.objects[t.id]}function pee(n,e,t,r){return zLe(n,{...e,kind:t,id:r})}function wh(n,e){if(n)return n.objects[e]}function A$(n,e){const t=RA(n,e);if(t<0||!he(n?.lookup))return;const r=wh(n,n.lookup[t]??"");if(he(r))return r}function $Le(n){return he(n)?[...Object.values(n.objects)]:[]}function mee(n,e,t){const r=[],i=[];if(!he(n))return{objectelements:r,terrainelements:i};function s(o,a){if(o.removed)return!1;switch(t){case"all":return!0;case"self":return o?.id===e;case"others":return o?.id!==e;case"terrain":return a===!0;case"object":return a===!1}const c=ri(o,t);return he(c)||xu(o).name===t||ri(o,"group")===t}for(let o=0;o<cg;++o){const a=n.terrain[o],c=n.objects[n.lookup?.[o]??""];if(he(a)&&s(a,!0)){i.push(a);const l=n.objects[n.lookup?.[o]??""];he(l)&&As(l)&&r.push(l)}else As(c)&&s(c,!1)&&r.push(c)}return{objectelements:r,terrainelements:i}}function fd(n,e,t){return!he(e)||xu(e).name==="player"?!1:(e.id?(e.removed=t,z6(n,e)):(Fl(n,{x:e?.x??0,y:e?.y??0}),mTe(n,e)),!0)}function Fl(n,e){if(!he(n)||!he(e)||!he(e.x)||!he(e.y)||e.x<0||e.x>=bn||e.y<0||e.y>=wr)return;const t=Ks(e),r=e.x+e.y*bn;return n.terrain[r]=t,delete n.distmaps,n.terrain[r]}function VLe(n,e,t){return Fl(n,{...e,kind:t})}function HLe(n){if(he(n)){if(un(n.over))if(un(n.overboard)){const e=Cs(n.overboard);he(e)||delete n.overboard}else{const e=Cs(n.over);he(e)&&(n.overboard=e.id)}else un(n.overboard)&&delete n.overboard;if(un(n.under))if(un(n.underboard)){const e=Cs(n.underboard);he(e)||delete n.underboard}else{const e=Cs(n.under);he(e)&&(n.underboard=e.id)}else un(n.underboard)&&delete n.underboard;if(un(n.charset))if(un(n.charsetpage)){const e=vu(Jr.CHARSET,n.charset);he(e)||delete n.charsetpage}else{const e=vu(Jr.CHARSET,n.charset);he(e)&&(n.charsetpage=e.id)}else un(n.charsetpage)&&delete n.charsetpage;if(un(n.palette))if(un(n.palettepage)){const e=vu(Jr.PALETTE,n.palette);he(e)||delete n.palettepage}else{const e=vu(Jr.PALETTE,n.palette);he(e)&&(n.palettepage=e.id)}else un(n.palettepage)&&delete n.palettepage}}function RU(n=M5){const e={terrain:FLe(),objects:{},id:"",name:""};return n(e)}function GLe(n,e,t,r){const i=t.id??"";if(r.x<0){const s=Cs(e?.exitwest??"");if(he(s))return RE(n,i,s.id,{x:bn-1,y:r.y})}else if(r.x>=bn){const s=Cs(e?.exiteast??"");if(he(s))return RE(n,i,s.id,{x:0,y:r.y})}else if(r.y<0){const s=Cs(e?.exitnorth??"");if(he(s))return RE(n,i,s.id,{x:r.x,y:wr-1})}else if(r.y>=wr){const s=Cs(e?.exitsouth??"");if(he(s))return RE(n,i,s.id,{x:r.x,y:0})}return!1}function C$(n,e,t,r){const i=KM(n,r,"enterx"),s=KM(n,r,"entery");rn(i)&&rn(s)&&he(t)&&y4(e,t,{x:i,y:s})}function zb(n){return Gxe(n.x,n.y,0,bn-1,wr-1,0)}const fe={timestamp:0,book:void 0,board:void 0,element:void 0,elementid:"",elementisplayer:!1,elementfocus:"",words:[],get:void 0};var lt=(n=>(n[n.COLOR=0]="COLOR",n[n.KIND=1]="KIND",n[n.DIR=2]="DIR",n[n.NAME=3]="NAME",n[n.NUMBER=4]="NUMBER",n[n.STRING=5]="STRING",n[n.NUMBER_OR_STRING=6]="NUMBER_OR_STRING",n[n.COLOR_OR_KIND=7]="COLOR_OR_KIND",n[n.MAYBE_KIND=8]="MAYBE_KIND",n[n.MAYBE_NAME=9]="MAYBE_NAME",n[n.MAYBE_NUMBER=10]="MAYBE_NUMBER",n[n.MAYBE_STRING=11]="MAYBE_STRING",n[n.MAYBE_NUMBER_OR_STRING=12]="MAYBE_NUMBER_OR_STRING",n[n.ANY=13]="ANY",n))(lt||{});function Ic(n,e,t){throw console.info(t,fe.element,fe.elementid,fe.elementfocus),new Error(`Invalid arg, expected: ${n} but got ${JSON.stringify(e)}`)}function R$(n){const e={x:fe.element?.x??0,y:fe.element?.y??0};return vE(fe.board,fe.element,fe.elementfocus,n,e)}function Pt(n,e,t){const r=fe.words;fe.words=n;const i=[];let s=e;for(let o=0;o<t.length;++o)switch(t[o]){case 1:{const[a,c]=s2(s);Fb(a)?(s=c,i.push(a)):Ic("kind",a,n);break}case 0:{if(xx(n[s])===void 0){const[a,c]=uu(s);dc(a)?(s=c,i.push(a)):rn(a)?(s=c,i.push(XO(a,void 0))):Ic("color",a,n)}else{const[a,c]=gI(s);dc(a)?(s=c,i.push(a)):Ic("color",a,n)}break}case 2:{if(aC(n[s])===void 0){const[a,c]=uu(s);_d(a)?(s=c,i.push(R$(a))):Ic("direction",a,n)}else{const[a,c]=rK(s);_d(a)?(s=c,i.push(R$(a))):Ic("direction",a,n)}break}case 3:{const a=fe.words[s];un(a)||Ic("string",a,n),++s,i.push(a);break}case 4:{const[a,c]=uu(s);if(un(a)){const l=parseFloat(a);rn(l)?i.push(l):Ic("number",a,n)}else rn(a)?i.push(a):Ic("number",a,n);s=c;break}case 5:{const[a,c]=uu(s);un(a)||Ic("string",a,n),s=c,i.push(a);break}case 6:{const[a,c]=uu(s);let l=a;if(un(l)){const u=parseFloat(l);rn(u)&&(l=u)}else rn(l)||Ic("number or string",l,n);s=c,i.push(l);break}case 7:{const[a,c]=s2(s);if(Fb(a))s=c,i.push(a);else if(xx(n[s])===void 0){const[l,u]=uu(s);dc(l)?(s=u,i.push(l)):Ic("color",l,n)}else{const[l,u]=gI(s);dc(l)?(s=u,i.push(l)):Ic("color or kind",l,n)}break}case 8:{const[a,c]=s2(s);a!==void 0&&!Fb(a)&&Ic("optional kind",a,n),s=c,i.push(a);break}case 9:{const a=fe.words[s];a!==void 0&&!un(a)&&Ic("optional string",a,n),++s,i.push(a);break}case 10:{const[a,c]=uu(s);if(un(a)){const l=parseFloat(a);rn(l)?i.push(l):Ic("optional number",a,n)}else rn(a)||a===void 0?i.push(a):Ic("optional number",a,n);s=c;break}case 11:{const[a,c]=uu(s);a!==void 0&&!un(a)&&Ic("optional string",a,n),s=c,i.push(a);break}case 12:{const[a,c]=uu(s);let l=a;if(un(l)){const u=parseFloat(l);rn(u)&&(l=u)}else l!==void 0&&!rn(l)&&Ic("number or string",l,n);s=c,i.push(l);break}case 13:{const[a,c]=uu(s);s=c,i.push(a);break}}return fe.words=r,[...i,s]}function WLe(n){if(he(n)&&(n<Ft.ONBLACK||n>Ft.ONCLEAR))return n}function kU(n){return he(n)&&n>Ft.WHITE&&n<Ft.ONCLEAR?n-Ft.ONBLACK:void 0}const KO={black:"BLACK",dkblue:"DKBLUE",dkgreen:"DKGREEN",dkcyan:"DKCYAN",dkred:"DKRED",dkpurple:"DKPURPLE",dkyellow:"DKYELLOW",ltgray:"LTGRAY",dkgray:"DKGRAY",blue:"BLUE",green:"GREEN",cyan:"CYAN",red:"RED",purple:"PURPLE",yellow:"YELLOW",white:"WHITE",brown:"DKYELLOW",dkwhite:"LTGRAY",ltgrey:"LTGRAY",gray:"LTGRAY",grey:"LTGRAY",dkgrey:"DKGRAY",ltblack:"DKGRAY",onblack:"ONBLACK",ondkblue:"ONDKBLUE",ondkgreen:"ONDKGREEN",ondkcyan:"ONDKCYAN",ondkred:"ONDKRED",ondkpurple:"ONDKPURPLE",ondkyellow:"ONDKYELLOW",onltgray:"ONLTGRAY",ondkgray:"ONDKGRAY",onblue:"ONBLUE",ongreen:"ONGREEN",oncyan:"ONCYAN",onred:"ONRED",onpurple:"ONPURPLE",onyellow:"ONYELLOW",onwhite:"ONWHITE",onbrown:"ONDKYELLOW",ondkwhite:"ONLTGRAY",onltgrey:"ONLTGRAY",ongray:"ONLTGRAY",ongrey:"ONLTGRAY",ondkgrey:"ONDKGRAY",onltblack:"ONDKGRAY",onclear:"ONCLEAR",blblack:"BLBLACK",bldkblue:"BLDKBLUE",bldkgreen:"BLDKGREEN",bldkcyan:"BLDKCYAN",bldkred:"BLDKRED",bldkpurple:"BLDKPURPLE",bldkyellow:"BLDKYELLOW",blltgray:"BLLTGRAY",bldkgray:"BLDKGRAY",blblue:"BLBLUE",blgreen:"BLGREEN",blcyan:"BLCYAN",blred:"BLRED",blpurple:"BLPURPLE",blyellow:"BLYELLOW",blwhite:"BLWHITE",blbrown:"BLDKYELLOW",bldkwhite:"BLLTGRAY",blltgrey:"BLLTGRAY",blgray:"BLLTGRAY",blgrey:"BLLTGRAY",bldkgrey:"BLDKGRAY",blltblack:"BLDKGRAY"};function dc(n){return sr(n)&&gee(n[0])}function qLe(n){return dc(n)&&n[0].startsWith("ON")}function gee(n){return he(Ft[n])&&un(n)}function xx(n){if(un(n))return KO[cr(n)]}function XO(n,e){return[he(n)?`${Ft[n]}`:void 0,he(e)?`ON${Ft[e]}`:void 0].filter(he)}function pI(n){return n.map(e=>Ft[e]).find(e=>he(e)&&e<Ft.ONBLACK)}function mI(n){return n.map(e=>Ft[e]).find(e=>he(e)&&e>=Ft.ONBLACK)}function YLe(n){if(dc(n))return n;if(gee(n))return[n];const e=xx(n);if(he(e))return[e]}function k$(n){const e=fe.words[n],t=YLe(e);return dc(t)?[t,n+1]:[void 0,n]}function gI(n){const e=[];let t=n;const r=parseFloat(fe.words[n]);if(rn(r))return[XO(r,void 0),n+1];const[i,s]=k$(n);dc(i)&&(e.push(...i),t=s);const[o,a]=k$(s);return qLe(o)&&(e.push(...o),t=a),e.length?[e,t]:[void 0,n]}function kE(n){const e={};for(let t=0;t<n.length;++t){const r=n[t],i=Ft[r];he(i)&&(i<Ft.ONBLACK||i>Ft.ONCLEAR?e.color=i:e.bg=kU(i))}return e}const o1=navigator.userAgent.includes("Mac");navigator.userAgent.includes("Linux");const _ee=navigator.userAgent.includes("Firefox")||navigator.userAgent.includes("FxiOS"),kA=o1?"cmd":"ctrl",KLe=ax(32,126).map(n=>String.fromCharCode(n)),vee=Cu({name:"Whitespace",pattern:/ +/}),XLe=Cu({name:"WhitespaceSkipped",pattern:/ +/,group:zc.SKIPPED}),ZO=Cu({name:"Newline",line_breaks:!0,start_chars_hint:[`
`,"\r"],pattern:/\n|\r\n?/}),JO=Cu({name:"StringLiteral",pattern:/[^ $;\r\n]+/,start_chars_hint:KLe}),QO=Cu({name:"StringLiteralDouble",pattern:/"(?:[^\\"]|\\(?:[^\n\r]|u[0-9a-fA-F]{4}))*"/}),e3=Cu({name:"EscapedDollar",pattern:"$$",start_chars_hint:["$"]}),yC=Cu({name:"MaybeFlag",pattern:/\$[^-0-9"!;@#/?\s]+[^-"!;@#/?\s]*/,start_chars_hint:["$"]}),MU=Cu({name:"Center",pattern:/\$CENTER/i,start_chars_hint:["$"]}),IU=Cu({name:"MetaKey",pattern:/\$META/i,start_chars_hint:["$"]}),t3=Cu({name:"NumberLiteral",pattern:/\$-?(\d*\.)?\d+([eE][+-]?\d+)?[jJ]?[lL]?\+?/}),n3=Cu({name:"HyperLinkText",pattern:/;[^;\r\n]*/,start_chars_hint:[";"]});function ZLe(n,e=""){return Cu({name:e||n,pattern:new RegExp(n.toLowerCase(),"i")})}const JLe=Object.keys(KO),yee=JLe.map(n=>ZLe(`\\$(${n})`,n)),QLe=[vee,ZO,...yee,QO,JO,t3,e3,n3,MU,IU,yC],e4e=new zc(QLe,{skipValidations:!Jm,ensureOptimizations:Jm}),t4e=new zc([XLe,ZO,...yee,QO,JO,t3,e3,n3,MU,IU,yC],{skipValidations:!Jm,ensureOptimizations:Jm}),M$=/\$CENTER/i;function OU(n){if(M$.test(n))return n.replace(M$,"")}function Jx(n,e=!1){return e?t4e.tokenize(n):e4e.tokenize(n)}function h_(n,e,t,r,i,s,o,a){return{disablewrap:!1,measureonly:!1,measuredwidth:0,writefullwidth:void 0,x:0,y:0,iseven:!0,active:{color:t,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},reset:{color:t,bg:r,topedge:i,leftedge:s,rightedge:o,bottomedge:a},width:n,height:e,char:[],color:[],bg:[],changed(){}}}function NU(n){n.active={...n.reset}}function PU(n,e){const t=e.y;function r(){++e.x;const a=e.active.rightedge??e.width-1;!e.disablewrap&&e.x>a&&(e.x=e.active.leftedge??0,++e.y),e.x>e.measuredwidth&&(e.measuredwidth=e.x)}function i(){return e.x>=(e.active.leftedge??0)&&e.x<=(e.active.rightedge??e.width-1)&&e.y>=(e.active.topedge??0)&&e.y<=(e.active.bottomedge??e.height-1)}function s(a){for(let c=0;c<a.length;++c){if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=a.charCodeAt(c),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r()}}for(let a=0;a<n.length;++a){const c=n[a];switch(c.tokenType){case e3:s("$");break;case t3:if(e.measureonly!==!0&&i()){const l=e.x+e.y*e.width;e.char[l]=parseFloat(c.image.replace("$","")),e.active.color!==void 0&&(e.color[l]=e.active.color),e.active.bg!==void 0&&(e.bg[l]=e.active.bg)}r();break;case QO:s(c.image.substring(1,c.image.length-1).replaceAll('\\"','"'));break;case ZO:{e.x=e.active.leftedge??0,++e.y;break}case MU:break;case IU:{s(kA);break}default:{const l=c.tokenType.name,u=KO[l],h=WLe(Ft[u]),f=kU(Ft[u]);u==="ONCLEAR"?(e.active.color=e.reset.color,e.active.bg=e.reset.bg):he(h)?e.active.color=h:he(f)?e.active.bg=f:s(c.image);break}}}e.x>e.measuredwidth&&(e.measuredwidth=e.x+1);const o=e.active.leftedge??0;if(he(e.writefullwidth)&&(e.x>o||e.y===t)){const c=(e.active.rightedge??e.width-1)-e.x;if(c>0){NU(e);const l=String.fromCharCode(e.writefullwidth).repeat(c),u=e.x+e.y*e.width;Tx(u,u+l.length,e.active.color,e.active.bg,e),r3(u,l,e)}}}function ei(n,e,t){const r=Jx(n);r.tokens&&(PU(r.tokens,e),t&&NU(e),e.changed())}function I$(n){const e=Jx(n);if(!e.tokens)return"";const t=e.tokens.filter(r=>{switch(r.tokenType){case vee:case ZO:case QO:case JO:case t3:case e3:case n3:case yC:return!0;default:return!1}}).map(r=>r.image).join("");return t.trim().length===0?"":t}function f_(n,e,t){const r=Jx(n);if(!r.tokens)return;const i=h_(e,t,Ft.WHITE,Ft.BLACK);return i.measureonly=!0,PU(r.tokens,i),i.x>0&&++i.y,i}function r3(n,e,t){let r=0;const i=n+e.length;for(let s=n;s<i;++s)t.char[s]=e.charCodeAt(r++);t.changed()}function Tx(n,e,t,r,i){const s=Math.min(n,e),o=Math.max(n,e);for(let a=s;a<=o;++a)i.color[a]=t,i.bg[a]=r;i.changed()}function n4e(n,e,t,r){const i=Math.min(n,e),s=Math.max(n,e);for(let o=i;o<=s;++o)r.bg[o]=t;r.changed()}function qf(n,e,t,r,i,s,o){const a=Math.min(t,r),c=Math.max(t,r);if(a>e||c<0)return;const l=Math.max(0,a),u=Math.min(e,c);Tx(n+l,n+u,i,s,o)}function QT(n,e,t,r,i,s){const o=Math.min(t,r),a=Math.max(t,r);if(o>e||a<0)return;const c=Math.max(0,o),l=Math.min(e,a);n4e(n+c,n+l,i,s)}function b4(n,e,t){const r=sC(JO,n,0,0,0,0,0,0);PU([r],e),t&&NU(e),e.changed()}function Ip(n){const e=n.reset.leftedge??0,t=n.reset.rightedge??n.width-1,r=n.reset.topedge??0,i=n.reset.bottomedge??n.height-1,s=t-e+1,o=i-r+1;return{left:e,right:t,top:r,bottom:i,width:s,height:o}}const r4e=n=>n;function DU(n,e=r4e){const t=yh.useSyncExternalStore(n.subscribe,yh.useCallback(()=>e(n.getState()),[n,e]),yh.useCallback(()=>e(n.getInitialState()),[n,e]));return yh.useDebugValue(t),t}const O$=n=>{const e=oO(n),t=r=>DU(e,r);return Object.assign(t,e),t},ry=(n=>n?O$(n):O$);function bee(n){return n.generateMipmaps=!1,n.minFilter=jl,n.magFilter=jl,n.needsUpdate=!0,n}function Im(n){if(he(n))return bee(new jce(cme(n)))}const bC=Ke.createContext(h_(1,1,15,1));function Wl(){return Ke.useContext(bC)}const See=ry(()=>({blink:!1}));setInterval(()=>{See.setState(n=>({blink:!n.blink}))},333);function Ef(){return See(n=>n.blink)}function Eee(){return oO(n=>{function e(){n(t=>({render:t.render+1}))}return{dither:[],render:0,changed(){queueMicrotask(e)}}})}function i4e(n){n.fill(0)}function C2(n,e,t,r,i,s){if(r<0||r>=e||i<0||i>=t)return-1;n[r+i*e]=s}const xee=Ke.createContext(Eee());function s4e(n,e,t){const[r]=Ke.useState(()=>Eee()),i=n*e,s=r.getState();return s.dither.length!==i&&(s.dither=new Array(i).fill(t),s.render=0),r}function Tee(){return oO(n=>{function e(){n(t=>({render:t.render+1}))}return{width:0,height:0,char:[],color:[],bg:[],render:0,changed(){queueMicrotask(e)}}})}function i3(n,e,t,r){n.char.fill(e),n.color.fill(t),n.bg.fill(r)}function qo(n,e,t,r,i,s){if(r<0||r>=e||i<0||i>=t)return;const o=r+i*e;Zm(s).forEach(a=>{const c=s[a];he(c)&&(n[a][o]=c)})}const LU=Ke.createContext(Tee());function R1(n,e,t,r,i){const[s]=Ke.useState(()=>Tee()),o=n*e,a=s.getState();return a.char.length!==o&&(a.width=n,a.height=e,a.char=new Array(o).fill(t),a.color=new Array(o).fill(r),a.bg=new Array(o).fill(i),a.render=0),s}function wee(){return Ke.useContext(LU).getState()}const R2=_1(b1),ew=v1(y1),ya=ry(n=>({palette:R2,charset:ew,mood:"",viewimage:"",screen:{},reset(){const e=he(ew)?LN(ew,Zo,Oa):void 0;n({palette:R2,mood:"",viewimage:"",screen:{},palettedata:yx(R2),charset:ew,charsetdata:Im(ew),spritecharset:e,spritecharsetdata:Im(e)})},setmood(e){n(t=>Ev(t.mood,e)?t:{...t,mood:e})},setviewimage(e){n(t=>Ev(t.viewimage,e)?t:{...t,viewimage:e})},setpalette(e){n(t=>Ev(t.palette,e)?t:{...t,palette:e,palettedata:yx(e)})},setcharset(e){n(t=>{if(Ev(t.charset,e))return t;const r=he(e)?LN(e,Zo,Oa):void 0;return{...t,charset:e,charsetdata:Im(e),spritecharset:r,spritecharsetdata:Im(r)}})},setaltcharset(e){n(t=>{if(Ev(t.altcharset,e))return t;const r=he(e)?LN(e,Zo,Oa):void 0;return{...t,altcharset:e,altcharsetdata:Im(e),spritealtcharset:r,spritealtcharsetdata:Im(r)}})},setscreen(e,t){n(r=>Ev(r.screen,t)?r:{...r,screen:{...r.screen,[e]:t}})}}));ya.getState().reset();const ad=ry(()=>({active:!0,saferows:1,insetcols:1,insetrows:1,islowrez:!1,islandscape:!0,sidebaropen:!0,keyboardalt:!1,keyboardctrl:!1,keyboardshift:!1,showtouchcontrols:!1,checknumbers:"",wordlist:[],wordlistflag:""}));async function UU(n){const e=mu(1111111,9999999),t=cr(n.replace(/[^a-zA-Z/]/g,""));return await(await fetch(`https://raw.githubusercontent.com/wiki/goldbuick/zed-software-system/${t}.md?q=${e}`)).text()}var Zk={exports:{}},o4e=Zk.exports,N$;function a4e(){return N$||(N$=1,(function(n,e){(function(t,r){r()})(o4e,function(){function t(l,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(l.type)?new Blob(["\uFEFF",l],{type:l.type}):l}function r(l,u,h){var f=new XMLHttpRequest;f.open("GET",l),f.responseType="blob",f.onload=function(){c(f.response,u,h)},f.onerror=function(){console.error("could not download file")},f.send()}function i(l){var u=new XMLHttpRequest;u.open("HEAD",l,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function s(l){try{l.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),l.dispatchEvent(u)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof sd=="object"&&sd.global===sd?sd:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(l,u,h){var f=o.URL||o.webkitURL,d=document.createElement("a");u=u||l.name||"download",d.download=u,d.rel="noopener",typeof l=="string"?(d.href=l,d.origin===location.origin?s(d):i(d.href)?r(l,u,h):s(d,d.target="_blank")):(d.href=f.createObjectURL(l),setTimeout(function(){f.revokeObjectURL(d.href)},4e4),setTimeout(function(){s(d)},0))}:"msSaveOrOpenBlob"in navigator?function(l,u,h){if(u=u||l.name||"download",typeof l!="string")navigator.msSaveOrOpenBlob(t(l,h),u);else if(i(l))r(l,u,h);else{var f=document.createElement("a");f.href=l,f.target="_blank",setTimeout(function(){s(f)})}}:function(l,u,h,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof l=="string")return r(l,u,h);var d=l.type==="application/octet-stream",p=/constructor/i.test(o.HTMLElement)||o.safari,m=/CriOS\/[\d]+/.test(navigator.userAgent);if((m||d&&p||a)&&typeof FileReader<"u"){var _=new FileReader;_.onloadend=function(){var b=_.result;b=m?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=b:location=b,f=null},_.readAsDataURL(l)}else{var v=o.URL||o.webkitURL,S=v.createObjectURL(l);f?f.location=S:location.href=S,f=null,setTimeout(function(){v.revokeObjectURL(S)},4e4)}});o.saveAs=c.saveAs=c,n.exports=c})})(Zk)),Zk.exports}var c4e=a4e();async function l4e(n,e){const t=new PDe;t.file("index.html",`<!doctype html>
      <html lang=en>
      <head>
      <meta charset=utf-8>
      <title>...adding bytes</title>
      </head>
      <body>
      <script>location = 'https://zed.cafe/#${e}';<\/script>
      </body>
    </html>`);const r=await t.generateAsync({type:"blob"});c4e.saveAs(r,`${n}.zip`)}function da(){return navigator.clipboard}function BU(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var k1=BU();function Aee(n){k1=n}var Vw={exec:()=>null};function ns(n,e=""){let t=typeof n=="string"?n:n.source,r={replace:(i,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(yu.caret,"$1"),t=t.replace(i,o),r},getRegex:()=>new RegExp(t,e)};return r}var u4e=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),yu={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},h4e=/^(?:[ \t]*(?:\n|$))+/,f4e=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,d4e=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,SC=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,p4e=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,FU=/(?:[*+-]|\d{1,9}[.)])/,Cee=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ree=ns(Cee).replace(/bull/g,FU).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),m4e=ns(Cee).replace(/bull/g,FU).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),jU=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,g4e=/^[^\n]+/,zU=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,_4e=ns(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",zU).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),v4e=ns(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,FU).getRegex(),s3="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",$U=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,y4e=ns("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",$U).replace("tag",s3).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),kee=ns(jU).replace("hr",SC).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s3).getRegex(),b4e=ns(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",kee).getRegex(),VU={blockquote:b4e,code:f4e,def:_4e,fences:d4e,heading:p4e,hr:SC,html:y4e,lheading:Ree,list:v4e,newline:h4e,paragraph:kee,table:Vw,text:g4e},P$=ns("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",SC).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s3).getRegex(),S4e={...VU,lheading:m4e,table:P$,paragraph:ns(jU).replace("hr",SC).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",P$).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s3).getRegex()},E4e={...VU,html:ns(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",$U).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Vw,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:ns(jU).replace("hr",SC).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ree).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},x4e=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,T4e=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Mee=/^( {2,}|\\)\n(?!\s*$)/,w4e=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,o3=/[\p{P}\p{S}]/u,HU=/[\s\p{P}\p{S}]/u,Iee=/[^\s\p{P}\p{S}]/u,A4e=ns(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,HU).getRegex(),Oee=/(?!~)[\p{P}\p{S}]/u,C4e=/(?!~)[\s\p{P}\p{S}]/u,R4e=/(?:[^\s\p{P}\p{S}]|~)/u,k4e=ns(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",u4e?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Nee=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,M4e=ns(Nee,"u").replace(/punct/g,o3).getRegex(),I4e=ns(Nee,"u").replace(/punct/g,Oee).getRegex(),Pee="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",O4e=ns(Pee,"gu").replace(/notPunctSpace/g,Iee).replace(/punctSpace/g,HU).replace(/punct/g,o3).getRegex(),N4e=ns(Pee,"gu").replace(/notPunctSpace/g,R4e).replace(/punctSpace/g,C4e).replace(/punct/g,Oee).getRegex(),P4e=ns("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Iee).replace(/punctSpace/g,HU).replace(/punct/g,o3).getRegex(),D4e=ns(/\\(punct)/,"gu").replace(/punct/g,o3).getRegex(),L4e=ns(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),U4e=ns($U).replace("(?:-->|$)","-->").getRegex(),B4e=ns("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",U4e).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),_I=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,F4e=ns(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",_I).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Dee=ns(/^!?\[(label)\]\[(ref)\]/).replace("label",_I).replace("ref",zU).getRegex(),Lee=ns(/^!?\[(ref)\](?:\[\])?/).replace("ref",zU).getRegex(),j4e=ns("reflink|nolink(?!\\()","g").replace("reflink",Dee).replace("nolink",Lee).getRegex(),D$=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,GU={_backpedal:Vw,anyPunctuation:D4e,autolink:L4e,blockSkip:k4e,br:Mee,code:T4e,del:Vw,emStrongLDelim:M4e,emStrongRDelimAst:O4e,emStrongRDelimUnd:P4e,escape:x4e,link:F4e,nolink:Lee,punctuation:A4e,reflink:Dee,reflinkSearch:j4e,tag:B4e,text:w4e,url:Vw},z4e={...GU,link:ns(/^!?\[(label)\]\((.*?)\)/).replace("label",_I).getRegex(),reflink:ns(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",_I).getRegex()},S4={...GU,emStrongRDelimAst:N4e,emStrongLDelim:I4e,url:ns(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",D$).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:ns(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",D$).getRegex()},$4e={...S4,br:ns(Mee).replace("{2,}","*").getRegex(),text:ns(S4.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},XR={normal:VU,gfm:S4e,pedantic:E4e},tw={normal:GU,gfm:S4,breaks:$4e,pedantic:z4e},V4e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},L$=n=>V4e[n];function xm(n,e){if(e){if(yu.escapeTest.test(n))return n.replace(yu.escapeReplace,L$)}else if(yu.escapeTestNoEncode.test(n))return n.replace(yu.escapeReplaceNoEncode,L$);return n}function U$(n){try{n=encodeURI(n).replace(yu.percentDecode,"%")}catch{return null}return n}function B$(n,e){let t=n.replace(yu.findPipe,(s,o,a)=>{let c=!1,l=o;for(;--l>=0&&a[l]==="\\";)c=!c;return c?"|":" |"}),r=t.split(yu.splitPipe),i=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;i<r.length;i++)r[i]=r[i].trim().replace(yu.slashPipe,"|");return r}function nw(n,e,t){let r=n.length;if(r===0)return"";let i=0;for(;i<r&&n.charAt(r-i-1)===e;)i++;return n.slice(0,r-i)}function H4e(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])t++;else if(n[r]===e[1]&&(t--,t<0))return r;return t>0?-2:-1}function F$(n,e,t,r,i){let s=e.href,o=e.title||null,a=n[1].replace(i.other.outputLinkReplace,"$1");r.state.inLink=!0;let c={type:n[0].charAt(0)==="!"?"image":"link",raw:t,href:s,title:o,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,c}function G4e(n,e,t){let r=n.match(t.other.indentCodeCompensation);if(r===null)return e;let i=r[1];return e.split(`
`).map(s=>{let o=s.match(t.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=i.length?s.slice(i.length):s}).join(`
`)}var vI=class{options;rules;lexer;constructor(n){this.options=n||k1}space(n){let e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(n){let e=this.rules.block.code.exec(n);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:nw(t,`
`)}}}fences(n){let e=this.rules.block.fences.exec(n);if(e){let t=e[0],r=G4e(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(n){let e=this.rules.block.heading.exec(n);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let r=nw(t,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(t=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(n){let e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:nw(e[0],`
`)}}blockquote(n){let e=this.rules.block.blockquote.exec(n);if(e){let t=nw(e[0],`
`).split(`
`),r="",i="",s=[];for(;t.length>0;){let o=!1,a=[],c;for(c=0;c<t.length;c++)if(this.rules.other.blockquoteStart.test(t[c]))a.push(t[c]),o=!0;else if(!o)a.push(t[c]);else break;t=t.slice(c);let l=a.join(`
`),u=l.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${l}`:l,i=i?`${i}
${u}`:u;let h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,s,!0),this.lexer.state.top=h,t.length===0)break;let f=s.at(-1);if(f?.type==="code")break;if(f?.type==="blockquote"){let d=f,p=d.raw+`
`+t.join(`
`),m=this.blockquote(p);s[s.length-1]=m,r=r.substring(0,r.length-d.raw.length)+m.raw,i=i.substring(0,i.length-d.text.length)+m.text;break}else if(f?.type==="list"){let d=f,p=d.raw+`
`+t.join(`
`),m=this.list(p);s[s.length-1]=m,r=r.substring(0,r.length-f.raw.length)+m.raw,i=i.substring(0,i.length-d.raw.length)+m.raw,t=p.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:s,text:i}}}list(n){let e=this.rules.block.list.exec(n);if(e){let t=e[1].trim(),r=t.length>1,i={type:"list",raw:"",ordered:r,start:r?+t.slice(0,-1):"",loose:!1,items:[]};t=r?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=r?t:"[*+-]");let s=this.rules.other.listItemRegex(t),o=!1;for(;n;){let c=!1,l="",u="";if(!(e=s.exec(n))||this.rules.block.hr.test(n))break;l=e[0],n=n.substring(l.length);let h=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,v=>" ".repeat(3*v.length)),f=n.split(`
`,1)[0],d=!h.trim(),p=0;if(this.options.pedantic?(p=2,u=h.trimStart()):d?p=e[1].length+1:(p=e[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,u=h.slice(p),p+=e[1].length),d&&this.rules.other.blankLine.test(f)&&(l+=f+`
`,n=n.substring(f.length+1),c=!0),!c){let v=this.rules.other.nextBulletRegex(p),S=this.rules.other.hrRegex(p),b=this.rules.other.fencesBeginRegex(p),T=this.rules.other.headingBeginRegex(p),w=this.rules.other.htmlBeginRegex(p);for(;n;){let R=n.split(`
`,1)[0],C;if(f=R,this.options.pedantic?(f=f.replace(this.rules.other.listReplaceNesting,"  "),C=f):C=f.replace(this.rules.other.tabCharGlobal,"    "),b.test(f)||T.test(f)||w.test(f)||v.test(f)||S.test(f))break;if(C.search(this.rules.other.nonSpaceChar)>=p||!f.trim())u+=`
`+C.slice(p);else{if(d||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||b.test(h)||T.test(h)||S.test(h))break;u+=`
`+f}!d&&!f.trim()&&(d=!0),l+=R+`
`,n=n.substring(R.length+1),h=C.slice(p)}}i.loose||(o?i.loose=!0:this.rules.other.doubleBlankLine.test(l)&&(o=!0));let m=null,_;this.options.gfm&&(m=this.rules.other.listIsTask.exec(u),m&&(_=m[0]!=="[ ] ",u=u.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:l,task:!!m,checked:_,loose:!1,text:u,tokens:[]}),i.raw+=l}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let l=i.items[c].tokens.filter(h=>h.type==="space"),u=l.length>0&&l.some(h=>this.rules.other.anyLine.test(h.raw));i.loose=u}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(n){let e=this.rules.block.html.exec(n);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(n){let e=this.rules.block.def.exec(n);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:r,title:i}}}table(n){let e=this.rules.block.table.exec(n);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=B$(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===r.length){for(let o of r)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<t.length;o++)s.header.push({text:t[o],tokens:this.lexer.inline(t[o]),header:!0,align:s.align[o]});for(let o of i)s.rows.push(B$(o,s.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:s.align[c]})));return s}}lheading(n){let e=this.rules.block.lheading.exec(n);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(n){let e=this.rules.block.paragraph.exec(n);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(n){let e=this.rules.block.text.exec(n);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(n){let e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(n){let e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(n){let e=this.rules.inline.link.exec(n);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let s=nw(t.slice(0,-1),"\\");if((t.length-s.length)%2===0)return}else{let s=H4e(e[2],"()");if(s===-2)return;if(s>-1){let o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let r=e[2],i="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(r);s&&(r=s[1],i=s[3])}else i=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?r=r.slice(1):r=r.slice(1,-1)),F$(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(n,e){let t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){let r=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=e[r.toLowerCase()];if(!i){let s=t[0].charAt(0);return{type:"text",raw:s,text:s}}return F$(t,i,t[0],this.lexer,this.rules)}}emStrong(n,e,t=""){let r=this.rules.inline.emStrongLDelim.exec(n);if(!(!r||r[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!t||this.rules.inline.punctuation.exec(t))){let i=[...r[0]].length-1,s,o,a=i,c=0,l=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,e=e.slice(-1*n.length+i);(r=l.exec(e))!=null;){if(s=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!s)continue;if(o=[...s].length,r[3]||r[4]){a+=o;continue}else if((r[5]||r[6])&&i%3&&!((i+o)%3)){c+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+c);let u=[...r[0]][0].length,h=n.slice(0,i+r.index+u+o);if(Math.min(i,o)%2){let d=h.slice(1,-1);return{type:"em",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}let f=h.slice(2,-2);return{type:"strong",raw:h,text:f,tokens:this.lexer.inlineTokens(f)}}}}codespan(n){let e=this.rules.inline.code.exec(n);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(t),i=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return r&&i&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(n){let e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}}del(n){let e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(n){let e=this.rules.inline.autolink.exec(n);if(e){let t,r;return e[2]==="@"?(t=e[1],r="mailto:"+t):(t=e[1],r=t),{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}url(n){let e;if(e=this.rules.inline.url.exec(n)){let t,r;if(e[2]==="@")t=e[0],r="mailto:"+t;else{let i;do i=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(i!==e[0]);t=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(n){let e=this.rules.inline.text.exec(n);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},lp=class E4{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||k1,this.options.tokenizer=this.options.tokenizer||new vI,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:yu,block:XR.normal,inline:tw.normal};this.options.pedantic?(t.block=XR.pedantic,t.inline=tw.pedantic):this.options.gfm&&(t.block=XR.gfm,this.options.breaks?t.inline=tw.breaks:t.inline=tw.gfm),this.tokenizer.rules=t}static get rules(){return{block:XR,inline:tw}}static lex(e,t){return new E4(t).lex(e)}static lexInline(e,t){return new E4(t).inlineTokens(e)}lex(e){e=e.replace(yu.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let r=this.inlineQueue[t];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(yu.tabCharGlobal,"    ").replace(yu.spaceLine,""));e;){let i;if(this.options.extensions?.block?.some(o=>(i=o.call({lexer:this},e,t))?(e=e.substring(i.raw.length),t.push(i),!0):!1))continue;if(i=this.tokenizer.space(e)){e=e.substring(i.raw.length);let o=t.at(-1);i.raw.length===1&&o!==void 0?o.raw+=`
`:t.push(i);continue}if(i=this.tokenizer.code(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.at(-1).src=o.text):t.push(i);continue}if(i=this.tokenizer.fences(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.heading(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.hr(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.blockquote(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.list(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.html(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.def(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},t.push(i));continue}if(i=this.tokenizer.table(e)){e=e.substring(i.raw.length),t.push(i);continue}if(i=this.tokenizer.lheading(e)){e=e.substring(i.raw.length),t.push(i);continue}let s=e;if(this.options.extensions?.startBlock){let o=1/0,a=e.slice(1),c;this.options.extensions.startBlock.forEach(l=>{c=l.call({lexer:this},a),typeof c=="number"&&c>=0&&(o=Math.min(o,c))}),o<1/0&&o>=0&&(s=e.substring(0,o+1))}if(this.state.top&&(i=this.tokenizer.paragraph(s))){let o=t.at(-1);r&&o?.type==="paragraph"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(i),r=s.length!==e.length,e=e.substring(i.raw.length);continue}if(i=this.tokenizer.text(e)){e=e.substring(i.raw.length);let o=t.at(-1);o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+i.raw,o.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(i);continue}if(e){let o="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,i=null;if(this.tokens.links){let c=Object.keys(this.tokens.links);if(c.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)c.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,i.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(i=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)s=i[2]?i[2].length:0,r=r.slice(0,i.index+s)+"["+"a".repeat(i[0].length-s-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=this.options.hooks?.emStrongMask?.call({lexer:this},r)??r;let o=!1,a="";for(;e;){o||(a=""),o=!1;let c;if(this.options.extensions?.inline?.some(u=>(c=u.call({lexer:this},e,t))?(e=e.substring(c.raw.length),t.push(c),!0):!1))continue;if(c=this.tokenizer.escape(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.tag(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.link(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(c.raw.length);let u=t.at(-1);c.type==="text"&&u?.type==="text"?(u.raw+=c.raw,u.text+=c.text):t.push(c);continue}if(c=this.tokenizer.emStrong(e,r,a)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.codespan(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.br(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.del(e)){e=e.substring(c.raw.length),t.push(c);continue}if(c=this.tokenizer.autolink(e)){e=e.substring(c.raw.length),t.push(c);continue}if(!this.state.inLink&&(c=this.tokenizer.url(e))){e=e.substring(c.raw.length),t.push(c);continue}let l=e;if(this.options.extensions?.startInline){let u=1/0,h=e.slice(1),f;this.options.extensions.startInline.forEach(d=>{f=d.call({lexer:this},h),typeof f=="number"&&f>=0&&(u=Math.min(u,f))}),u<1/0&&u>=0&&(l=e.substring(0,u+1))}if(c=this.tokenizer.inlineText(l)){e=e.substring(c.raw.length),c.raw.slice(-1)!=="_"&&(a=c.raw.slice(-1)),o=!0;let u=t.at(-1);u?.type==="text"?(u.raw+=c.raw,u.text+=c.text):t.push(c);continue}if(e){let u="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return t}},yI=class{options;parser;constructor(e){this.options=e||k1}space(e){return""}code({text:e,lang:t,escaped:r}){let i=(t||"").match(yu.notSpaceStart)?.[0],s=e.replace(yu.endingNewline,"")+`
`;return i?'<pre><code class="language-'+xm(i)+'">'+(r?s:xm(s,!0))+`</code></pre>
`:"<pre><code>"+(r?s:xm(s,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,r=e.start,i="";for(let a=0;a<e.items.length;a++){let c=e.items[a];i+=this.listitem(c)}let s=t?"ol":"ul",o=t&&r!==1?' start="'+r+'"':"";return"<"+s+o+`>
`+i+"</"+s+`>
`}listitem(e){let t="";if(e.task){let r=this.checkbox({checked:!!e.checked});e.loose?e.tokens[0]?.type==="paragraph"?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&e.tokens[0].tokens[0].type==="text"&&(e.tokens[0].tokens[0].text=r+" "+xm(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",r="";for(let s=0;s<e.header.length;s++)r+=this.tablecell(e.header[s]);t+=this.tablerow({text:r});let i="";for(let s=0;s<e.rows.length;s++){let o=e.rows[s];r="";for(let a=0;a<o.length;a++)r+=this.tablecell(o[a]);i+=this.tablerow({text:r})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+t+`</${r}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${xm(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:r}){let i=this.parser.parseInline(r),s=U$(e);if(s===null)return i;e=s;let o='<a href="'+e+'"';return t&&(o+=' title="'+xm(t)+'"'),o+=">"+i+"</a>",o}image({href:e,title:t,text:r,tokens:i}){i&&(r=this.parser.parseInline(i,this.parser.textRenderer));let s=U$(e);if(s===null)return xm(r);e=s;let o=`<img src="${e}" alt="${r}"`;return t&&(o+=` title="${xm(t)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:xm(e.text)}},WU=class{strong({text:n}){return n}em({text:n}){return n}codespan({text:n}){return n}del({text:n}){return n}html({text:n}){return n}text({text:n}){return n}link({text:n}){return""+n}image({text:n}){return""+n}br(){return""}},up=class x4{options;renderer;textRenderer;constructor(e){this.options=e||k1,this.options.renderer=this.options.renderer||new yI,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new WU}static parse(e,t){return new x4(t).parse(e)}static parseInline(e,t){return new x4(t).parseInline(e)}parse(e,t=!0){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=s,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){r+=c||"";continue}}let o=s;switch(o.type){case"space":{r+=this.renderer.space(o);continue}case"hr":{r+=this.renderer.hr(o);continue}case"heading":{r+=this.renderer.heading(o);continue}case"code":{r+=this.renderer.code(o);continue}case"table":{r+=this.renderer.table(o);continue}case"blockquote":{r+=this.renderer.blockquote(o);continue}case"list":{r+=this.renderer.list(o);continue}case"html":{r+=this.renderer.html(o);continue}case"def":{r+=this.renderer.def(o);continue}case"paragraph":{r+=this.renderer.paragraph(o);continue}case"text":{let a=o,c=this.renderer.text(a);for(;i+1<e.length&&e[i+1].type==="text";)a=e[++i],c+=`
`+this.renderer.text(a);t?r+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):r+=c;continue}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}parseInline(e,t=this.renderer){let r="";for(let i=0;i<e.length;i++){let s=e[i];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){r+=a||"";continue}}let o=s;switch(o.type){case"escape":{r+=t.text(o);break}case"html":{r+=t.html(o);break}case"link":{r+=t.link(o);break}case"image":{r+=t.image(o);break}case"strong":{r+=t.strong(o);break}case"em":{r+=t.em(o);break}case"codespan":{r+=t.codespan(o);break}case"br":{r+=t.br(o);break}case"del":{r+=t.del(o);break}case"text":{r+=t.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return r}},Mw=class{options;block;constructor(n){this.options=n||k1}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(n){return n}postprocess(n){return n}processAllTokens(n){return n}emStrongMask(n){return n}provideLexer(){return this.block?lp.lex:lp.lexInline}provideParser(){return this.block?up.parse:up.parseInline}},W4e=class{defaults=BU();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=up;Renderer=yI;TextRenderer=WU;Lexer=lp;Tokenizer=vI;Hooks=Mw;constructor(...n){this.use(...n)}walkTokens(n,e){let t=[];for(let r of n)switch(t=t.concat(e.call(this,r)),r.type){case"table":{let i=r;for(let s of i.header)t=t.concat(this.walkTokens(s.tokens,e));for(let s of i.rows)for(let o of s)t=t.concat(this.walkTokens(o.tokens,e));break}case"list":{let i=r;t=t.concat(this.walkTokens(i.items,e));break}default:{let i=r;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(s=>{let o=i[s].flat(1/0);t=t.concat(this.walkTokens(o,e))}):i.tokens&&(t=t.concat(this.walkTokens(i.tokens,e)))}}return t}use(...n){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{let r={...t};if(r.async=this.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let s=e.renderers[i.name];s?e.renderers[i.name]=function(...o){let a=i.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:e.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[i.level];s?s.unshift(i.tokenizer):e[i.level]=[i.tokenizer],i.start&&(i.level==="block"?e.startBlock?e.startBlock.push(i.start):e.startBlock=[i.start]:i.level==="inline"&&(e.startInline?e.startInline.push(i.start):e.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(e.childTokens[i.name]=i.childTokens)}),r.extensions=e),t.renderer){let i=this.defaults.renderer||new yI(this.defaults);for(let s in t.renderer){if(!(s in i))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=t.renderer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u||""}}r.renderer=i}if(t.tokenizer){let i=this.defaults.tokenizer||new vI(this.defaults);for(let s in t.tokenizer){if(!(s in i))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=t.tokenizer[o],c=i[o];i[o]=(...l)=>{let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}r.tokenizer=i}if(t.hooks){let i=this.defaults.hooks||new Mw;for(let s in t.hooks){if(!(s in i))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=t.hooks[o],c=i[o];Mw.passThroughHooks.has(s)?i[o]=l=>{if(this.defaults.async&&Mw.passThroughHooksRespectAsync.has(s))return(async()=>{let h=await a.call(i,l);return c.call(i,h)})();let u=a.call(i,l);return c.call(i,u)}:i[o]=(...l)=>{if(this.defaults.async)return(async()=>{let h=await a.apply(i,l);return h===!1&&(h=await c.apply(i,l)),h})();let u=a.apply(i,l);return u===!1&&(u=c.apply(i,l)),u}}r.hooks=i}if(t.walkTokens){let i=this.defaults.walkTokens,s=t.walkTokens;r.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),i&&(a=a.concat(i.call(this,o))),a}}this.defaults={...this.defaults,...r}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return lp.lex(n,e??this.defaults)}parser(n,e){return up.parse(n,e??this.defaults)}parseMarkdown(n){return(e,t)=>{let r={...t},i={...this.defaults,...r},s=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&r.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(i.hooks&&(i.hooks.options=i,i.hooks.block=n),i.async)return(async()=>{let o=i.hooks?await i.hooks.preprocess(e):e,a=await(i.hooks?await i.hooks.provideLexer():n?lp.lex:lp.lexInline)(o,i),c=i.hooks?await i.hooks.processAllTokens(a):a;i.walkTokens&&await Promise.all(this.walkTokens(c,i.walkTokens));let l=await(i.hooks?await i.hooks.provideParser():n?up.parse:up.parseInline)(c,i);return i.hooks?await i.hooks.postprocess(l):l})().catch(s);try{i.hooks&&(e=i.hooks.preprocess(e));let o=(i.hooks?i.hooks.provideLexer():n?lp.lex:lp.lexInline)(e,i);i.hooks&&(o=i.hooks.processAllTokens(o)),i.walkTokens&&this.walkTokens(o,i.walkTokens);let a=(i.hooks?i.hooks.provideParser():n?up.parse:up.parseInline)(o,i);return i.hooks&&(a=i.hooks.postprocess(a)),a}catch(o){return s(o)}}}onError(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){let r="<p>An error occurred:</p><pre>"+xm(t.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(t);throw t}}},a1=new W4e;function bs(n,e){return a1.parse(n,e)}bs.options=bs.setOptions=function(n){return a1.setOptions(n),bs.defaults=a1.defaults,Aee(bs.defaults),bs};bs.getDefaults=BU;bs.defaults=k1;bs.use=function(...n){return a1.use(...n),bs.defaults=a1.defaults,Aee(bs.defaults),bs};bs.walkTokens=function(n,e){return a1.walkTokens(n,e)};bs.parseInline=a1.parseInline;bs.Parser=up;bs.parser=up.parse;bs.Renderer=yI;bs.TextRenderer=WU;bs.Lexer=lp;bs.lexer=lp.lex;bs.Tokenizer=vI;bs.Hooks=Mw;bs.parse=bs;bs.options;bs.setOptions;bs.use;bs.walkTokens;bs.parseInline;up.parse;lp.lex;function N0(n,e){switch(e.type){default:console.info("unknown",e);break;case"heading":Hv(qe,n,e.text),zr(qe,n," ");break;case"hr":zr(qe,n," "),QQ(qe,n,10),zr(qe,n," ");break;case"paragraph":for(let t=0;t<(e.tokens?.length??0);++t)he(e.tokens?.[t])&&N0(n,e.tokens[t]);break;case"code":e.text.split(`
`).forEach(t=>zr(qe,n,t.replace(/\s+/g," ").trim()));break;case"text":zr(qe,n,e.text);break;case"link":{const[t,...r]=e.text.split("|").map(s=>s.trim()),i=[...r,e.href??""];_4(qe,n,i.join(" "),t);break}case"image":_4(qe,n,`openit ${e.href}`,`show ${e.title??e.href}`);break;case"blockquote":e.text.split(`
`).forEach(t=>{zr(qe,n,`$dkpurple$221$white  ${t}`)}),zr(qe,n," ");break;case"list":for(let t=0;t<(e.items?.length??0);++t)he(e.items?.[t])&&N0(n,e.items[t]);zr(qe,n," ");break;case"list_item":zr(qe,n,` $grey$7 ${e.text}`);break}}function qU(n,e){bs.use({pedantic:!1,gfm:!0,breaks:!1,renderer:{heading(t){return N0(n,t),""},code(t){return N0(n,t),""},blockquote(t){return N0(n,t),""},hr(t){return N0(n,t),""},list(t){return N0(n,t),""},listitem(t){return N0(n,t),""},paragraph(t){return N0(n,t),""}}}),bs.parse(e)}async function Qx(n,e={},t){return window.__TAURI_INTERNALS__.invoke(n,e,t)}var wx;(function(n){n[n.Audio=1]="Audio",n[n.Cache=2]="Cache",n[n.Config=3]="Config",n[n.Data=4]="Data",n[n.LocalData=5]="LocalData",n[n.Document=6]="Document",n[n.Download=7]="Download",n[n.Picture=8]="Picture",n[n.Public=9]="Public",n[n.Video=10]="Video",n[n.Resource=11]="Resource",n[n.Temp=12]="Temp",n[n.AppConfig=13]="AppConfig",n[n.AppData=14]="AppData",n[n.AppLocalData=15]="AppLocalData",n[n.AppCache=16]="AppCache",n[n.AppLog=17]="AppLog",n[n.Desktop=18]="Desktop",n[n.Executable=19]="Executable",n[n.Font=20]="Font",n[n.Home=21]="Home",n[n.Runtime=22]="Runtime",n[n.Template=23]="Template"})(wx||(wx={}));async function q4e(){return Qx("plugin:path|resolve_directory",{directory:wx.AppData})}async function Y4e(...n){return Qx("plugin:path|join",{paths:n})}var j$;(function(n){n[n.Start=0]="Start",n[n.Current=1]="Current",n[n.End=2]="End"})(j$||(j$={}));async function K4e(n,e){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");await Qx("plugin:fs|mkdir",{path:n instanceof URL?n.toString():n,options:e})}async function X4e(n,e){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");const t=await Qx("plugin:fs|read_text_file",{path:n instanceof URL?n.toString():n,options:e}),r=t instanceof ArrayBuffer?t:Uint8Array.from(t);return new TextDecoder().decode(r)}async function Z4e(n,e,t){if(n instanceof URL&&n.protocol!=="file:")throw new TypeError("Must be a file URL.");const r=new TextEncoder;await Qx("plugin:fs|write_text_file",r.encode(e),{headers:{path:encodeURIComponent(n instanceof URL?n.toString():n),options:JSON.stringify(t)}})}async function J4e(n){return Qx("plugin:opener|reveal_item_in_dir",{paths:typeof n=="string"?[n]:n})}function YU(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function Q4e(n,e){let t;const r=()=>{if(t)return t;const i=indexedDB.open(n);return i.onupgradeneeded=()=>i.result.createObjectStore(e),t=YU(i),t.then(s=>{s.onclose=()=>t=void 0},()=>{}),t};return(i,s)=>r().then(o=>s(o.transaction(e,i).objectStore(e)))}let k2;function Uee(){return k2||(k2=Q4e("keyval-store","keyval")),k2}function Bee(n,e=Uee()){return e("readonly",t=>YU(t.get(n)))}function Fee(n,e,t=Uee()){return t("readwrite",r=>new Promise((i,s)=>{r.get(n).onsuccess=function(){try{r.put(e(this.result),n),i(YU(r.transaction))}catch(o){s(o)}}}))}const a3=typeof window<"u"&&("__TAURI__"in window||"__TAURI_INTERNALS__"in window),MA="zss-content.json";async function Ax(n){return Bee(n)}async function bI(n,e){return Fee(n,e)}function e5e(n){return n==="crt"?"on":"off"}async function Jk(n){const e=await Ax(`config_${n}`);return e?e&&e!=="off"?"on":"off":e5e(n)}async function t5e(){return Ax("HISTORYBUFFER")}async function z$(n){return bI("HISTORYBUFFER",()=>n)}async function n5e(n){let e=await Ax(n);if(e===void 0){for(;e===void 0;){const t=_6({addAdverb:!0,capitalize:!1,adjectiveCount:2});await Ax(t)===void 0&&(e=t)}await bI(n,()=>e),await bI(e,()=>n)}return e}async function r5e(n){return await Ax(n)}function jee(n){try{const e=location.hash.slice(1);if(e.length)return e}catch(e){_r(qe,n,"crash",e.message)}return""}async function KU(n){const e=jee(n);if(a3){if(e.length)return zr(qe,n,"reading url content, make sure to save"),location.hash="",e;try{zr(qe,n,`reading ${MA}`);const t=await X4e(MA,{baseDir:wx.AppData});return JSON.parse(t)}catch(t){return _r(qe,n,"readcontent",t.toString()),[]}}if(e.length){const t=await r5e(e);return he(t)&&t.length>e.length?t:e}return""}async function zee(n,e,t,r,i){if(a3){try{zr(qe,n,`writing ${MA}`),await Z4e(MA,JSON.stringify(i,null,2),{baseDir:wx.AppData,create:!0})}catch(o){_r(qe,n,"writecontent",o.toString())}return}if(r.length>2048){const o=await n5e(r);return zee(n,e,t,o,i)}const s=`#${r}`;if(location.hash!==s){IA=r,location.hash=s;const o=`wrote ${t.length} chars [${t.slice(0,8)}...${t.slice(-8)}]`;e.includes("autosave")||fs(qe,n,o),document.title=e}}async function $ee(){return await Ax("storage")??{}}async function i5e(n,e){const t=await $ee();return t[n]=e,bI("storage",()=>t)}let IA="";async function s5e(n){if(a3){await K4e("",{baseDir:wx.AppData,recursive:!0});try{const e=await q4e(),t=await Y4e(e,MA);await J4e(t)}catch(e){_r(qe,n,"storage",e.toString())}return}window.addEventListener("hashchange",()=>{oo(qe,n,async()=>{const e=jee(n);if(IA!==e){IA=e;const t=await KU(n);GY(qe,n,t)}})})}async function o5e(n){const e=await KU(n);if(sr(e)){_r(qe,n,"storage","#share not supported in server mode");return}const t=`#${e}`;IA=e,location.hash=t;const r=await iee(location.href);v4(qe,n,r,r)}function a5e(n){if(a3){_r(qe,n,"storage","#nuke not supported in server mode");return}location.hash="",IA=location.hash,location.reload()}function $$(n){const e=Ke.useRef(null);return t=>{const r=n(t);return(e.current===void 0||r===void 0?e.current===r:Ev(e.current,r))?e.current:e.current=r}}const Qr=ry(()=>({desync:!1,zsswords:{cli:[],loader:[],runtime:[],flags:[],stats:[],kinds:[],altkinds:[],colors:[],dirs:[],dirmods:[],exprs:[]},gadget:{id:"",board:"",exiteast:"",exitwest:"",exitnorth:"",exitsouth:"",layers:[],tickers:[],scrollname:"",scroll:[],sidebar:[]},gadgetlayercache:{},slim:[]})),c5e=256;var id=(n=>(n[n.TOP=0]="TOP",n[n.FULL=1]="FULL",n[n.BOTTOM=2]="BOTTOM",n[n.SPLIT_X=3]="SPLIT_X",n[n.MAX=4]="MAX",n))(id||{});const hs=ry(n=>({layout:0,inspector:!1,quickterminal:!1,toast:"",terminal:{open:!0,info:[],logs:[]},editor:{open:!1,book:"",path:[],type:"",title:""},reset(){n({layout:0,inspector:!1,quickterminal:!1,toast:"",terminal:{open:!0,logs:[]},editor:{open:!1,book:"",path:[],type:"",title:""}})}})),Ai=ry(n=>({pan:0,scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""],reset(){n({pan:0,scroll:0,xcursor:0,ycursor:0,xselect:void 0,yselect:void 0,bufferindex:0,buffer:[""]})}})),Dl=ry(n=>({xscroll:0,yscroll:0,cursor:0,select:void 0,reset(){n({xscroll:0,yscroll:0,cursor:0,select:void 0})}})),Tv=ry(n=>({pts:[],cursor:void 0,select:void 0,reset(){n({pts:[],cursor:void 0,select:void 0})}}));function l5e(n){return n.type===Qi.TILES}function u5e(n){return n.type===Qi.SPRITES}function h5e(n,e,t){const r=e*t,i=new Array(r).fill(0),s=new Array(r).fill(0),o=new Array(r).fill(Ft.ONCLEAR),a=[...n].filter(l5e).reverse();for(let c=0;c<r;c++){const l=c%e,u=Math.floor(c/e);for(let h=0;h<a.length;h++){const f=a[h];if(l>=f.width||u>=f.height)continue;const d=l+u*f.width,p=f.char[d]??0,m=f.color[d]??0,_=f.bg[d]??Ft.ONCLEAR;if(p!==0||_<Ft.ONCLEAR){i[c]=p,s[c]=m,o[c]=_;break}}}return{char:i,color:s,bg:o}}function f5e(n){const e=[];for(const t of n)if(u5e(t))for(const r of t.sprites)r.pid||e.push({x:r.x,y:r.y,char:r.char,color:r.color,bg:r.bg});return e}function d5e(n){return n.replace(/[^a-zA-Z0-9._-]/g,"_")||"board"}function p5e(){const{charsetdata:n,palettedata:e}=ya.getState(),{board:t,layers:r=[]}=Qr.getState().gadget;if(!he(n)||!he(e))throw new Error("charsetdata or palettedata not loaded");const{width:i,height:s}=g1(r);if(i===0||s===0)throw new Error("No tile layers to capture");const{char:o,color:a,bg:c}=h5e(r,i,s),l=f5e(r),u=kn.DRAW_CHAR_WIDTH(),h=kn.DRAW_CHAR_HEIGHT(),f=document.createElement("canvas");f.width=i*u,f.height=s*h;const d=f.getContext("2d");if(!d)throw new Error("Could not get canvas 2d context");const p=n.image,m=p.getContext("2d");if(!m)throw new Error("Could not get charset canvas context");const v=m.getImageData(0,0,p.width,p.height).data,S=d.createImageData(f.width,f.height),b=S.data;for(let C=0;C<s;C++)for(let N=0;N<i;N++){const U=N+C*i,B=o[U]??0,$=a[U]??0,I=c[U]??Ft.ONCLEAR,L=B%So,P=Math.floor(B/So),H=L*Zo,X=P*Oa,G=$>31?($-33)%16:$%16,Y=I<Ft.ONCLEAR?I-16:-1,J=e[G],Q=Y>=0?e[Y]:null;for(let z=0;z<h;z++)for(let q=0;q<u;q++){const ee=H+Math.floor(q/kn.DRAW_CHAR_SCALE),te=X+Math.floor(z/kn.DRAW_CHAR_SCALE),ie=(ee+te*p.width)*4,Ee=v[ie],Re=N*u+q,Te=C*h+z,Pe=(Re+Te*f.width)*4;Ee===0?(Q&&(b[Pe]=Math.round(Q.r*255),b[Pe+1]=Math.round(Q.g*255),b[Pe+2]=Math.round(Q.b*255)),b[Pe+3]=Q?255:0):(b[Pe]=Math.round(J.r*255),b[Pe+1]=Math.round(J.g*255),b[Pe+2]=Math.round(J.b*255),b[Pe+3]=255)}}for(const C of l){const N=Math.floor(C.x),U=Math.floor(C.y);if(N<0||N>=i||U<0||U>=s)continue;const B=C.char,$=C.color,I=C.bg,L=B%So,P=Math.floor(B/So),H=L*Zo,X=P*Oa,G=$>31?($-33)%16:$%16,Y=I<Ft.ONCLEAR?I-16:-1,J=e[G],Q=Y>=0?e[Y]:null;for(let z=0;z<h;z++)for(let q=0;q<u;q++){const ee=H+Math.floor(q/kn.DRAW_CHAR_SCALE),te=X+Math.floor(z/kn.DRAW_CHAR_SCALE),ie=(ee+te*p.width)*4,Ee=v[ie],Re=N*u+q,Te=U*h+z,Pe=(Re+Te*f.width)*4;Ee===0?(Q&&(b[Pe]=Math.round(Q.r*255),b[Pe+1]=Math.round(Q.g*255),b[Pe+2]=Math.round(Q.b*255)),b[Pe+3]=Q?255:0):(b[Pe]=Math.round(J.r*255),b[Pe+1]=Math.round(J.g*255),b[Pe+2]=Math.round(J.b*255),b[Pe+3]=255)}}d.putImageData(S,0,0);const T=f.toDataURL("image/png"),w=`${d5e(t)}.png`,R=document.createElement("a");R.href=T,R.download=w,R.click()}var Qk={exports:{}},m5e=Qk.exports,V$;function g5e(){return V$||(V$=1,(function(n,e){(function(t,r){n.exports=r()})(m5e,(()=>(()=>{var t={944:function(o){var a;a=()=>(()=>{var c={d:(v,S)=>{for(var b in S)c.o(S,b)&&!c.o(v,b)&&Object.defineProperty(v,b,{enumerable:!0,get:S[b]})},o:(v,S)=>Object.prototype.hasOwnProperty.call(v,S)},l={};function u(v){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},u(v)}function h(v,S){var b=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(!b){if(Array.isArray(v)||(b=d(v))||S){b&&(v=b);var T=0,w=function(){};return{s:w,n:function(){return T>=v.length?{done:!0}:{done:!1,value:v[T++]}},e:function(U){throw U},f:w}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var R,C=!0,N=!1;return{s:function(){b=b.call(v)},n:function(){var U=b.next();return C=U.done,U},e:function(U){N=!0,R=U},f:function(){try{C||b.return==null||b.return()}finally{if(N)throw R}}}}function f(v,S){return(function(b){if(Array.isArray(b))return b})(v)||(function(b,T){var w=b==null?null:typeof Symbol<"u"&&b[Symbol.iterator]||b["@@iterator"];if(w!=null){var R,C,N,U,B=[],$=!0,I=!1;try{if(N=(w=w.call(b)).next,T!==0)for(;!($=(R=N.call(w)).done)&&(B.push(R.value),B.length!==T);$=!0);}catch(L){I=!0,C=L}finally{try{if(!$&&w.return!=null&&(U=w.return(),Object(U)!==U))return}finally{if(I)throw C}}return B}})(v,S)||d(v,S)||(function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function d(v,S){if(v){if(typeof v=="string")return p(v,S);var b=Object.prototype.toString.call(v).slice(8,-1);return b==="Object"&&v.constructor&&(b=v.constructor.name),b==="Map"||b==="Set"?Array.from(v):b==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(b)?p(v,S):void 0}}function p(v,S){(S==null||S>v.length)&&(S=v.length);for(var b=0,T=new Array(S);b<S;b++)T[b]=v[b];return T}function m(v,S){if(!(v instanceof S))throw new TypeError("Cannot call a class as a function")}c.d(l,{default:()=>_});var _=(function(){function v(){var T=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];m(this,v),this.strict=T,this.defaults=new Map,this.validators=new Map,this.types=new Map,this.optional=new Set,this.required=new Set}var S,b;return S=v,(b=[{key:"allowExtra",value:function(){return this.strict=!1,this}},{key:"setDefaults",value:function(T){var w=this;return Object.entries(T).forEach((function(R){var C=f(R,2),N=C[0],U=C[1];return w.defaults.set(N,U)})),this}},{key:"setValidators",value:function(T){var w=this;return Object.entries(T).forEach((function(R){var C=f(R,2),N=C[0],U=C[1];return w.validators.set(N,U)})),this}},{key:"setTypes",value:function(T){var w=this;return Object.entries(T).forEach((function(R){var C=f(R,2),N=C[0],U=C[1];return w.types.set(N,U)})),this}},{key:"setOptional",value:function(T){var w=this;return T.forEach((function(R){return w.optional.add(R)})),this}},{key:"setRequired",value:function(T){var w=this;return T.forEach((function(R){return w.required.add(R)})),this}},{key:"resolve",value:function(T){return this.validate(Object.assign(this.getDefaults(),T))}},{key:"getDefaults",value:function(){var T,w={},R=h(this.defaults);try{for(R.s();!(T=R.n()).done;){var C=f(T.value,2),N=C[0],U=C[1];w[N]=U}}catch(B){R.e(B)}finally{R.f()}return w}},{key:"validate",value:function(T){for(var w in T)this.validators.has(w)&&(T[w]=this.validators.get(w)(T[w]));for(var R in T){if(!this.optionExists(R))throw new Error('Unkown option "'.concat(R,'".'));this.checkType(R,T[R])}var C,N=h(this.required.values());try{for(N.s();!(C=N.n()).done;){var U=C.value;if(T[U]===void 0)throw new Error('Option "'.concat(U,'" is required.'))}}catch(B){N.e(B)}finally{N.f()}return T}},{key:"checkType",value:function(T,w){if(this.types.has(T)){var R=this.types.get(T),C=u(w);if(C!==R)throw new Error('Wrong value for option "'.concat(T,'": expected type "').concat(R,'", got "').concat(C,'".'))}}},{key:"optionExists",value:function(T){return!this.strict||this.defaults.has(T)||this.validators.has(T)||this.optional.has(T)||this.required.has(T)||this.types.has(T)}}])&&(function(T,w){for(var R=0;R<w.length;R++){var C=w[R];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(T,(N=(function(U,B){if(u(U)!=="object"||U===null)return U;var $=U[Symbol.toPrimitive];if($!==void 0){var I=$.call(U,"string");if(u(I)!=="object")return I;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(U)})(C.key),u(N)==="symbol"?N:String(N)),C)}var N})(S.prototype,b),Object.defineProperty(S,"prototype",{writable:!1}),v})();return l.default})(),o.exports=a()},162:function(o){o.exports=(()=>{var a={d:(u,h)=>{for(var f in h)a.o(h,f)&&!a.o(u,f)&&Object.defineProperty(u,f,{enumerable:!0,get:h[f]})},o:(u,h)=>Object.prototype.hasOwnProperty.call(u,h)},c={};a.d(c,{default:()=>l});var l=(function(){function u(){(function(f,d){if(!(f instanceof d))throw new TypeError("Cannot call a class as a function")})(this,u),this._events={},this.on=this.addEventListener,this.off=this.removeEventListener}var h;return(h=[{key:"emit",value:function(f,d){if(Object.prototype.hasOwnProperty.call(this._events,f))for(var p=this._events[f],m={type:f,detail:d},_=p.length,v=0;v<_;v++)this.handle(p[v],m)}},{key:"handle",value:function(f,d){f(d)}},{key:"addEventListener",value:function(f,d){Object.prototype.hasOwnProperty.call(this._events,f)||(this._events[f]=[]),this._events[f].indexOf(d)<0&&this._events[f].push(d)}},{key:"removeEventListener",value:function(f,d){if(Object.prototype.hasOwnProperty.call(this._events,f)){var p=this._events[f],m=p.indexOf(d);m>=0&&p.splice(m,1),p.length===0&&delete this._events[f]}}}])&&(function(f,d){for(var p=0;p<d.length;p++){var m=d[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(f,m.key,m)}})(u.prototype,h),u})();return c.default})()}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={exports:{}};return t[o].call(c.exports,c,c.exports,i),c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{GamepadHandler:()=>T,GamepadListener:()=>G});var o=i(162),a=i.n(o),c=i(944),l=i.n(c);function u(Y){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(J){return typeof J}:function(J){return J&&typeof Symbol=="function"&&J.constructor===Symbol&&J!==Symbol.prototype?"symbol":typeof J},u(Y)}function h(Y,J){if(!(Y instanceof J))throw new TypeError("Cannot call a class as a function")}function f(Y,J){for(var Q=0;Q<J.length;Q++){var z=J[Q];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(Y,_(z.key),z)}}function d(Y,J){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Q,z){return Q.__proto__=z,Q},d(Y,J)}function p(Y,J){if(J&&(u(J)==="object"||typeof J=="function"))return J;if(J!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(Q){if(Q===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Q})(Y)}function m(Y){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(J){return J.__proto__||Object.getPrototypeOf(J)},m(Y)}function _(Y){var J=(function(Q,z){if(u(Q)!=="object"||Q===null)return Q;var q=Q[Symbol.toPrimitive];if(q!==void 0){var ee=q.call(Q,"string");if(u(ee)!=="object")return ee;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Q)})(Y);return u(J)==="symbol"?J:String(J)}var v,S,b,T=(function(Y){(function(Ee,Re){if(typeof Re!="function"&&Re!==null)throw new TypeError("Super expression must either be null or a function");Ee.prototype=Object.create(Re&&Re.prototype,{constructor:{value:Ee,writable:!0,configurable:!0}}),Object.defineProperty(Ee,"prototype",{writable:!1}),Re&&d(Ee,Re)})(ie,Y);var J,Q,z,q,ee,te=(q=ie,ee=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var Ee,Re=m(q);if(ee){var Te=m(this).constructor;Ee=Reflect.construct(Re,arguments,Te)}else Ee=Re.apply(this,arguments);return p(this,Ee)});function ie(Ee,Re){var Te,Pe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return h(this,ie),(Te=te.call(this)).index=Ee,Te.gamepad=Re,Te.options=Te.constructor.resolveOptions(Pe),Te.axes=new Array(Re.axes.length).fill(null),Te.buttons=new Array(Re.buttons.length).fill(null),Te.initAxes(),Te.initButtons(),Te}return J=ie,z=[{key:"resolveOptions",value:function(Ee){var Re,Te,Pe,We,it=Ee.axis,ht=Ee.button;return{axis:this.optionResolver.resolve((Re=(Te=it??ht)!==null&&Te!==void 0?Te:Ee)!==null&&Re!==void 0?Re:{}),button:this.optionResolver.resolve((Pe=(We=ht??it)!==null&&We!==void 0?We:Ee)!==null&&Pe!==void 0?Pe:{})}}}],(Q=[{key:"initAxes",value:function(){for(var Ee=this.axes.length,Re=0;Re<Ee;Re++)this.axes[Re]=this.resolveAxisValue(Re)}},{key:"initButtons",value:function(){for(var Ee=this.buttons.length,Re=0;Re<Ee;Re++)this.buttons[Re]=this.resolveButtonValue(Re)}},{key:"update",value:function(Ee){this.gamepad=Ee,this.updateAxis(),this.updateButtons()}},{key:"updateAxis",value:function(){for(var Ee=this.axes.length,Re=0;Re<Ee;Re++)this.setAxisValue(Re,this.resolveAxisValue(Re))}},{key:"updateButtons",value:function(){for(var Ee=this.buttons.length,Re=0;Re<Ee;Re++)this.setButtonValue(Re,this.resolveButtonValue(Re))}},{key:"setAxisValue",value:function(Ee,Re){this.axes[Ee]!==Re&&(this.axes[Ee]=Re,this.emit("axis",{gamepad:this.gamepad,index:this.index,axis:Ee,value:Re}))}},{key:"setButtonValue",value:function(Ee,Re){this.buttons[Ee]!==Re&&(this.buttons[Ee]=Re,this.emit("button",{gamepad:this.gamepad,index:this.index,button:Ee,pressed:this.gamepad.buttons[Ee].pressed,value:Re}))}},{key:"resolveAxisValue",value:function(Ee){var Re=this.options.axis,Te=Re.deadZone,Pe=Re.analog,We=Re.precision,it=this.gamepad.axes[Ee];return Te&&it<Te&&it>-Te?0:Pe?We?Math.round(it*We)/We:it:it>0?1:it<0?-1:0}},{key:"resolveButtonValue",value:function(Ee){var Re=this.options.button,Te=Re.deadZone,Pe=Re.analog,We=Re.precision,it=this.gamepad.buttons[Ee].value;return Te>0&&it<Te&&it>-Te?0:Pe?We?Math.round(it*We)/We:it:it===0?0:1}}])&&f(J.prototype,Q),z&&f(J,z),Object.defineProperty(J,"prototype",{writable:!1}),ie})(a());function w(Y){return w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(J){return typeof J}:function(J){return J&&typeof Symbol=="function"&&J.constructor===Symbol&&J!==Symbol.prototype?"symbol":typeof J},w(Y)}function R(Y,J){for(var Q=0;Q<J.length;Q++){var z=J[Q];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(Y,C(z.key),z)}}function C(Y){var J=(function(Q,z){if(w(Q)!=="object"||Q===null)return Q;var q=Q[Symbol.toPrimitive];if(q!==void 0){var ee=q.call(Q,"string");if(w(ee)!=="object")return ee;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Q)})(Y);return w(J)==="symbol"?J:String(J)}v=T,S="optionResolver",b=new(l())().setDefaults({analog:!0,deadZone:0,precision:0}).setTypes({analog:"boolean",deadZone:"number",precision:"number"}).setValidators({deadZone:function(Y){return Math.max(Math.min(Y,1),0)},precision:function(Y){return Y>0?Math.pow(10,Y):0}}),(S=_(S))in v?Object.defineProperty(v,S,{value:b,enumerable:!0,configurable:!0,writable:!0}):v[S]=b;var N=(function(){function Y(z){(function(q,ee){if(!(q instanceof ee))throw new TypeError("Cannot call a class as a function")})(this,Y),this.callback=z,this.frame=null,this.update=this.update.bind(this)}var J,Q;return J=Y,(Q=[{key:"setCallback",value:function(z){this.callback=z}},{key:"start",value:function(){this.frame||(this.frame=window.requestAnimationFrame(this.update))}},{key:"stop",value:function(){this.frame&&(window.cancelAnimationFrame(this.frame),this.frame=null)}},{key:"update",value:function(){this.frame=window.requestAnimationFrame(this.update),this.callback()}}])&&R(J.prototype,Q),Object.defineProperty(J,"prototype",{writable:!1}),Y})();function U(Y){return U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(J){return typeof J}:function(J){return J&&typeof Symbol=="function"&&J.constructor===Symbol&&J!==Symbol.prototype?"symbol":typeof J},U(Y)}function B(Y,J){if(!(Y instanceof J))throw new TypeError("Cannot call a class as a function")}function $(Y,J){for(var Q=0;Q<J.length;Q++){var z=J[Q];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(Y,I(z.key),z)}}function I(Y){var J=(function(Q,z){if(U(Q)!=="object"||Q===null)return Q;var q=Q[Symbol.toPrimitive];if(q!==void 0){var ee=q.call(Q,"string");if(U(ee)!=="object")return ee;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Q)})(Y);return U(J)==="symbol"?J:String(J)}function L(Y,J){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(Q,z){return Q.__proto__=z,Q},L(Y,J)}function P(Y,J){if(J&&(U(J)==="object"||typeof J=="function"))return J;if(J!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return H(Y)}function H(Y){if(Y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Y}function X(Y){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(J){return J.__proto__||Object.getPrototypeOf(J)},X(Y)}var G=(function(Y){(function(ie,Ee){if(typeof Ee!="function"&&Ee!==null)throw new TypeError("Super expression must either be null or a function");ie.prototype=Object.create(Ee&&Ee.prototype,{constructor:{value:ie,writable:!0,configurable:!0}}),Object.defineProperty(ie,"prototype",{writable:!1}),Ee&&L(ie,Ee)})(te,Y);var J,Q,z,q,ee=(z=te,q=(function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch{return!1}})(),function(){var ie,Ee=X(z);if(q){var Re=X(this).constructor;ie=Reflect.construct(Ee,arguments,Re)}else ie=Ee.apply(this,arguments);return P(this,ie)});function te(){var ie,Ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(B(this,te),ie=ee.call(this),typeof navigator.getGamepads!="function")throw new Error("This browser does not support gamepad API.");return ie.options=Ee,ie.onAxis=ie.onAxis.bind(H(ie)),ie.update=ie.update.bind(H(ie)),ie.start=ie.start.bind(H(ie)),ie.stop=ie.stop.bind(H(ie)),ie.discover=ie.discover.bind(H(ie)),ie.onButton=ie.onButton.bind(H(ie)),ie.handlers=new Array(4).fill(null),ie.loop=new N(ie.update),window.addEventListener("error",ie.stop),ie}return J=te,(Q=[{key:"start",value:function(){this.loop.start()}},{key:"stop",value:function(){this.loop.stop()}},{key:"update",value:function(){var ie=navigator.getGamepads();this.discover(ie[0],0),this.discover(ie[1],1),this.discover(ie[2],2),this.discover(ie[3],3)}},{key:"discover",value:function(ie,Ee){ie?(this.handlers[Ee]===null&&this.registerHandler(Ee,ie),this.handlers[Ee].update(ie)):this.handlers[Ee]&&this.removeGamepad(Ee)}},{key:"registerHandler",value:function(ie,Ee){var Re=new T(ie,Ee,this.options);this.handlers[ie]=Re,Re.addEventListener("axis",this.onAxis),Re.addEventListener("button",this.onButton),this.emit("gamepad:connected",{index:ie,gamepad:Ee}),this.emit("gamepad:".concat(ie,":connected"),{index:ie,gamepad:Ee})}},{key:"removeGamepad",value:function(ie){var Ee=this.handlers[ie];Ee.removeEventListener("axis",this.onAxis),Ee.removeEventListener("button",this.onButton),this.handlers[ie]=null,this.emit("gamepad:disconnected",{index:ie}),this.emit("gamepad:".concat(ie,":disconnected"),{index:ie})}},{key:"onAxis",value:function(ie){var Ee=ie.detail.index;this.emit("gamepad:axis",ie.detail),this.emit("gamepad:".concat(Ee,":axis"),ie.detail),this.emit("gamepad:".concat(Ee,":axis:").concat(ie.detail.axis),ie.detail)}},{key:"onButton",value:function(ie){var Ee=ie.detail.index;this.emit("gamepad:button",ie.detail),this.emit("gamepad:".concat(Ee,":button"),ie.detail),this.emit("gamepad:".concat(Ee,":button:").concat(ie.detail.button),ie.detail)}}])&&$(J.prototype,Q),Object.defineProperty(J,"prototype",{writable:!1}),te})(a())})(),s})()))})(Qk)),Qk.exports}var _5e=g5e(),tp={},H$;function v5e(){if(H$)return tp;H$=1,Object.defineProperty(tp,"__esModule",{value:!0});for(var n=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),e={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},t={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:n?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},r={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},i=1;i<20;i++)r["f"+i]=111+i;function s(f,d,p){d&&!("byKey"in d)&&(p=d,d=null),Array.isArray(f)||(f=[f]);var m=f.map(function(S){return c(S,d)}),_=function(b){return m.some(function(T){return l(T,b)})},v=p==null?_:_(p);return v}function o(f,d){return s(f,d)}function a(f,d){return s(f,{byKey:!0},d)}function c(f,d){var p=d&&d.byKey,m={};f=f.replace("++","+add");var _=f.split("+"),v=_.length;for(var S in e)m[e[S]]=!1;var b=!0,T=!1,w=void 0;try{for(var R=_[Symbol.iterator](),C;!(b=(C=R.next()).done);b=!0){var N=C.value,U=N.endsWith("?")&&N.length>1;U&&(N=N.slice(0,-1));var B=h(N),$=e[B];if(N.length>1&&!$&&!t[N]&&!r[B])throw new TypeError('Unknown modifier: "'+N+'"');(v===1||!$)&&(p?m.key=B:m.which=u(N)),$&&(m[$]=U?null:!0)}}catch(I){T=!0,w=I}finally{try{!b&&R.return&&R.return()}finally{if(T)throw w}}return m}function l(f,d){for(var p in f){var m=f[p],_=void 0;if(m!=null&&(p==="key"&&d.key!=null?_=d.key.toLowerCase():p==="which"?_=m===91&&d.which===93?91:d.which:_=d[p],!(_==null&&m===!1)&&_!==m))return!1}return!0}function u(f){f=h(f);var d=r[f]||f.toUpperCase().charCodeAt(0);return d}function h(f){return f=f.toLowerCase(),f=t[f]||f,f}return tp.default=s,tp.isHotkey=s,tp.isCodeHotkey=o,tp.isKeyHotkey=a,tp.parseHotkey=c,tp.compareHotkey=l,tp.toKeyCode=u,tp.toKeyName=h,tp}var y5e=v5e();const G$=wu(y5e);function Vee(n){return{all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map(function(i){i(t)}),(r=n.get("*"))&&r.slice().map(function(i){i(e,t)})}}}const $b={};function XU(n){return`${ii()}local${n}`}const b5e=1e3,yE={};let M2=0,W$=performance.now();const Cx=100,q$=[Ct.MOVE_UP,Ct.MOVE_DOWN,Ct.MOVE_LEFT,Ct.MOVE_RIGHT,Ct.OK_BUTTON,Ct.CANCEL_BUTTON,Ct.MENU_BUTTON];function Hee(){const n=performance.now(),e=n-W$,t=Zm($b);for(let r=0;r<t.length;++r){const i=parseFloat(t[r]);if(yE[i]=yE[i]??0,yE[i]+=e,yE[i]>=Cx){yE[i]-=Cx;const s=$b[i],o={alt:!!s[Ct.ALT],ctrl:!!s[Ct.CTRL],shift:!!s[Ct.SHIFT]};for(let a=0;a<q$.length;++a){const c=q$[a];s[c]&&Wee(i,c,o)}}}if(++M2,W$=n,setTimeout(Hee,10),M2>b5e){M2=0;const r=Zm($b);for(let i=1;i<r.length;++i){const s=parseFloat(r[i]);qY(qe,XU(s))}}}Hee();function ZU(n){return $b[n]=$b[n]??{[Ct.NONE]:!1,[Ct.ALT]:!1,[Ct.CTRL]:!1,[Ct.SHIFT]:!1,[Ct.MOVE_UP]:!1,[Ct.MOVE_DOWN]:!1,[Ct.MOVE_LEFT]:!1,[Ct.MOVE_RIGHT]:!1,[Ct.OK_BUTTON]:!1,[Ct.CANCEL_BUTTON]:!1,[Ct.MENU_BUTTON]:!1},$b[n]}function xr(n,e){const t=ZU(n);t[e]||(yE[n]=Cx*-2,Wee(n,e,{alt:t[Ct.ALT],ctrl:t[Ct.CTRL],shift:t[Ct.SHIFT]})),t[e]=!0}function ur(n,e){const t=ZU(n);t[e]=!1}const Om={root:Vee(),ignorehotkeys:!1},Gee=Ke.createContext(Om.root);function EC(n){return{alt:n.altKey,ctrl:o1?n.metaKey:n.ctrlKey,shift:n.shiftKey}}function Wee(n,e,t){if(n===0)Om.root.emit(Ct[e],t);else{let r=0;const i=XU(n);t.alt&&(r|=I5),t.ctrl&&(r|=O5),t.shift&&(r|=N5),YY(qe,i,e,r)}}window.addEventListener("wheel",n=>{n.preventDefault()},{passive:!1});window.addEventListener("keydown",n=>{const e=cr(n.key),t=EC(n),r=ii();switch(e){case"s":case"j":case"o":case"f":case"z":case"y":case"a":case"p":case"h":case"n":case"k":case"[":case"]":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"delete":case"backspace":(t.alt||t.ctrl||t.shift)&&n.preventDefault();break;case"tab":case"arrowleft":case"arrowright":case"arrowup":case"arrowdown":case"'":case'"':case"/":n.preventDefault();break}switch(t.alt?xr(0,Ct.ALT):ur(0,Ct.ALT),t.ctrl?xr(0,Ct.CTRL):ur(0,Ct.CTRL),t.shift?xr(0,Ct.SHIFT):ur(0,Ct.SHIFT),e){case"arrowleft":xr(0,Ct.MOVE_LEFT),n.metaKey&&ur(0,Ct.MOVE_LEFT);break;case"arrowright":xr(0,Ct.MOVE_RIGHT),n.metaKey&&ur(0,Ct.MOVE_RIGHT);break;case"arrowup":xr(0,Ct.MOVE_UP),n.metaKey&&ur(0,Ct.MOVE_UP);break;case"arrowdown":xr(0,Ct.MOVE_DOWN),n.metaKey&&ur(0,Ct.MOVE_DOWN);break;case"enter":xr(0,Ct.OK_BUTTON);break;case"esc":case"escape":xr(0,Ct.CANCEL_BUTTON);break;case"tab":xr(0,Ct.MENU_BUTTON);break;case"s":t.ctrl&&zm(qe,r,"#save");break;case"j":t.ctrl&&zm(qe,r,t.shift?"#jointab hush":"#jointab");break;case"o":t.ctrl&&zm(qe,r,t.shift?"#joincode hush":"#joincode");break;case"l":break;case"f":t.ctrl&&zm(qe,r,"#fork");break;case"h":t.ctrl&&m6(qe,r)}Om.root.emit("keydown",n)},{capture:!0});window.addEventListener("keyup",n=>{const e=cr(n.key),t=EC(n);switch(t.alt?xr(0,Ct.ALT):ur(0,Ct.ALT),t.ctrl?xr(0,Ct.CTRL):ur(0,Ct.CTRL),t.shift?xr(0,Ct.SHIFT):ur(0,Ct.SHIFT),e){case"meta":break;case"arrowleft":ur(0,Ct.MOVE_LEFT);break;case"arrowright":ur(0,Ct.MOVE_RIGHT);break;case"arrowup":ur(0,Ct.MOVE_UP);break;case"arrowdown":ur(0,Ct.MOVE_DOWN);break;case"enter":ur(0,Ct.OK_BUTTON);break;case"esc":case"escape":ur(0,Ct.CANCEL_BUTTON);break;case"tab":ur(0,Ct.MENU_BUTTON);break}},{capture:!0});window.addEventListener("blur",()=>{ur(0,Ct.ALT),ur(0,Ct.CTRL),ur(0,Ct.SHIFT),ur(0,Ct.MOVE_UP),ur(0,Ct.MOVE_DOWN),ur(0,Ct.MOVE_LEFT),ur(0,Ct.MOVE_RIGHT),ur(0,Ct.OK_BUTTON),ur(0,Ct.CANCEL_BUTTON),ur(0,Ct.MENU_BUTTON)});mg("userinput",[],n=>{switch(n.target){case"up":rn(n.data)&&ur(0,n.data);break;case"down":rn(n.data)&&xr(0,n.data);break}});const qee=0,Yee=1,Kee=2,Xee=3,S5e=4,E5e=5,x5e=6,T5e=7,w5e=9,A5e=12,C5e=13,R5e=14,k5e=15,I2={[Xee]:Ct.MOVE_UP,[qee]:Ct.MOVE_DOWN,[Kee]:Ct.MOVE_LEFT,[Yee]:Ct.MOVE_RIGHT,[S5e]:Ct.CANCEL_BUTTON,[E5e]:Ct.OK_BUTTON,[x5e]:Ct.ALT,[T5e]:Ct.CTRL,[w5e]:Ct.MENU_BUTTON,[A5e]:Ct.MOVE_UP,[C5e]:Ct.MOVE_DOWN,[R5e]:Ct.MOVE_LEFT,[k5e]:Ct.MOVE_RIGHT},O2={};function M5e(n){return O2[n]=O2[n]??{},O2[n]}function I5e(n,e,t){const r=M5e(n),i=Cb(r[0]??0,r[1]??0),s=Cb(r[2]??0,r[3]??0);r[e]=t;const o=Cb(r[0]??0,r[1]??0),a=Cb(r[2]??0,r[3]??0);if(i!==o)switch(ur(n,Ct.MOVE_LEFT),ur(n,Ct.MOVE_RIGHT),ur(n,Ct.MOVE_UP),ur(n,Ct.MOVE_DOWN),o){case yn.NORTH:xr(n,Ct.MOVE_UP);break;case yn.SOUTH:xr(n,Ct.MOVE_DOWN);break;case yn.WEST:xr(n,Ct.MOVE_LEFT);break;case yn.EAST:xr(n,Ct.MOVE_RIGHT);break}if(s!==a)switch(a===yn.IDLE?ur(n,Ct.SHIFT):xr(n,Ct.SHIFT),ur(n,Ct.MOVE_LEFT),ur(n,Ct.MOVE_RIGHT),ur(n,Ct.MOVE_UP),ur(n,Ct.MOVE_DOWN),a){case yn.NORTH:xr(n,Ct.MOVE_UP);break;case yn.SOUTH:xr(n,Ct.MOVE_DOWN);break;case yn.WEST:xr(n,Ct.MOVE_LEFT);break;case yn.EAST:xr(n,Ct.MOVE_RIGHT);break}}const xC=new _5e.GamepadListener({analog:!1,deadZone:.3});xC.on("gamepad:connected",n=>{const e=ii();fs(qe,e,`connected ${n.detail.gamepad.id}`),ZU(n.detail.index),n.detail.index>0&&uxe(qe,XU(n.detail.index))});xC.on("gamepad:disconnected",n=>{const e=ii();fs(qe,e,`disconnected gamepad ${n.detail.index}`),delete $b[n.detail.index]});xC.on("gamepad:axis",n=>{I5e(n.detail.index,n.detail.axis,n.detail.value)});xC.on("gamepad:button",n=>{const e=n.detail.index;switch(n.detail.button){case Kee:case Yee:case Xee:case qee:ur(e,Ct.MOVE_UP),ur(e,Ct.MOVE_DOWN),ur(e,Ct.MOVE_LEFT),ur(e,Ct.MOVE_RIGHT),n.detail.value?(xr(e,Ct.SHIFT),xr(e,I2[n.detail.button])):ur(e,Ct.SHIFT);break;default:n.detail.value?xr(e,I2[n.detail.button]):ur(e,I2[n.detail.button]);break}});xC.start();const Y$="keyup";function Vb({hotkey:n,althotkey:e,children:t}){return Ke.useEffect(()=>{const r=G$(n,{byKey:!0}),i=he(e)?G$(e,{byKey:!0}):void 0;function s(o){Om.ignorehotkeys===!1&&(r(o)||i?.(o))&&t()}return document.addEventListener(Y$,s,!1),()=>document.removeEventListener(Y$,s,!1)},[n,e,t]),null}function Ao(n){const e=Ke.useContext(Gee);return Ke.useEffect(()=>{const t=Object.entries(n);return t.forEach(([r,i])=>e.on(r,i)),()=>{t.forEach(([r,i])=>e.off(r,i))}},[e,n]),null}function iy({blockhotkeys:n,children:e}){const[t]=Ke.useState(()=>Vee());return Ke.useEffect(()=>{const r=Om.root,i=Om.ignorehotkeys;return Om.root=t,Om.ignorehotkeys=!!n,()=>{Om.root=r,Om.ignorehotkeys=i}},[t,n]),be.jsx(Gee.Provider,{value:t,children:e})}function O5e(n){try{return sessionStorage.getItem(n)??void 0}catch(e){_r(ui,ko,`readsession ${n}`,e.message)}}function N5e(n,e){try{he(e)?sessionStorage.setItem(n,e):sessionStorage.removeItem(n)}catch(t){_r(ui,ko,`writesession ${n} <- ${e}`,t.message)}}async function Zee(){const n=await UU("cli");qU(ko,n)}async function Jee(){await mh(1e3),no(ui,ko,"try typing $green#help$blue and pressing enter!")}function P5e(){zm(ui,ko,"#pages")}function D5e(n){const e=n.map(r=>`${r}`).join(" ");return e.startsWith("!")?`!${e}`:`$onclear$blue${e}`}const K$=/\((\d+)\)/;function X$(n){const{terminal:e}=hs.getState(),t=D5e(n.data),[r=""]=e.logs,i=[...e.logs],s=I$(r).replace(K$,""),o=I$(t),a=s.indexOf(o);if(o.length&&s.length&&a===0){const c=K$.exec(r);if(he(c)){const l=parseFloat(c[1])+1;i.shift(),i.unshift(`(${l})${t}`)}else i.shift(),i.unshift(`(2)${t}`)}else{for(;i.length>=c5e;)i.pop();i.unshift(t),Ai.getState().ycursor>0&&Ai.setState(c=>({ycursor:c.ycursor+1,yselect:c.yselect?c.yselect+1:void 0}))}hs.setState(c=>({terminal:{...c.terminal,logs:i}}))}function L5e(n){const{layout:e,editor:t}=hs.getState();let i=e+(n?1:-1);i<0&&(i+=id.MAX),i>=id.MAX&&(i-=id.MAX),t.open||i===id.SPLIT_X&&(i=id.TOP),hs.setState({layout:i})}async function U5e(n){if(n.length===0){_r(ui,ko,"content","no content found"),await Zee(),HY(ui,ko),p6(ui,ko),await Jee();return}GY(ui,ko,n)}let N2=0;const Z$=10,ko=O5e("PLAYER")??Bxe();N5e("PLAYER",ko);let J$;function ii(){return ko}const ui=mg("register",["ready","second","log","chat","toast"],function(n){if(!ui.session(n))return;switch(n.target){case"ready":case"chat":case"toast":case"second":break;default:if(n.player!==ko)return;break}const e=Qr.getState().gadget.board;switch(n.target){case"ready":{oo(ui,n.player,async()=>{await s5e(ko);const t=await t5e();he(t)&&Ai.setState({buffer:t.filter(r=>r.includes("#broadcast")===!1)}),await mh(256),fs(ui,ko,`myplayerid ${ko}`),nxe(ui,ko)});break}case"ackoperator":MEe(ui,ko),oo(ui,n.player,async()=>{const t=await KU(ko);see()&&un(t)?wEe(ui,ko,t):await U5e(t)});break;case"loginready":oo(ui,n.player,async()=>{const t=await $ee();lxe(ui,ko,t),HY(ui,ko)});break;case"acklogin":n.data?(Bw(ui,ko),Th(ui,n.player,void 0,"text","sim:load","")):oo(ui,n.player,async()=>{await Zee(),P5e(),p6(ui,ko),Th(ui,n.player,void 0,"text","sim:load",""),await Jee()});break;case"ackzsswords":{Qr.setState({zsswords:n.data});const t=[],r=Object.values(n.data);for(let i=0;i<r.length;++i)t.push(...r[i]);break}case"input":if(sr(n.data)){const[t,r]=n.data;r?(xr(0,Ct.SHIFT),xr(0,t),ur(0,t),ur(0,Ct.SHIFT)):(xr(0,t),ur(0,t))}break;case"store":oo(ui,n.player,async()=>{if(sr(n.data)){const[t,r]=n.data;await i5e(t,r)}});break;case"copy":un(n.data)&&he(da())&&da().writeText(n.data).then(()=>jY(ui,n.player,`copied! ${n.data.slice(0,200)}`)).catch(t=>console.error(t));break;case"downloadjsonfile":if(sr(n.data)){const[t,r]=n.data;try{const i=new Blob([JSON.stringify({exported:r,data:t},null,2)],{type:"application/json;charset=utf-8"}),s=URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=r,o.click(),URL.revokeObjectURL(s)}catch(i){console.error(i)}}break;case"share":oo(ui,n.player,async function(){await o5e(n.player)});break;case"screenshot":p5e();break;case"nuke":oo(ui,n.player,async function(){Hv(ui,n.player,"nuke in"),dh(ui,n.player,"3","..."),await mh(1e3),dh(ui,n.player,"2","..."),await mh(1e3),dh(ui,n.player,"1","..."),await mh(1e3),Hv(ui,n.player,"BYE"),await mh(100),a5e(n.player)});break;case"savemem":oo(ui,n.player,async function(){if(sr(n.data)){const[t,r,i]=n.data;un(t)&&un(r)&&sr(i)&&i.every(ime)&&await zee(n.player,t,r,r,i)}});break;case"forkmem":if(sr(n.data)){const[t,r]=n.data;if(un(t)&&un(r)){const i=r?`https://${r}/#${t}`:location.href.replace(/#.*/,`#${t}`);window.open(i,"_blank")}}break;case"publishmem":oo(ui,n.player,async()=>{if(sr(n.data)){const[t,r]=n.data;switch(r){case"itchio":{const[,,i]=n.data;un(t)&&un(i)&&(no(ui,n.player,`publishing ${i}`),await l4e(i,t),no(ui,n.player,`$green${i} has been exported for upload to itch.io`));break}case"bbs":{const[,,i,s,o,...a]=n.data;if(un(t)&&un(i)&&un(s)&&un(o)){no(ui,n.player,`publishing ${o}`);const c=await iee(`${location.origin}/#${t}`);(await jDe(i,s,o,c,a)).success&&no(ui,n.player,`$green${o} has been published to bbs`)}break}default:_r(ui,n.player,"publish",`unknown publish method ${r}`);break}}});break;case"second":++N2,N2>=Z$&&(N2-=Z$,qY(ui,ko));break;case"inspector":hs.setState(t=>{const r=he(n.data)?!!n.data:!t.inspector;return fs(ui,n.player,`gadget inspector ${r?"$greenon":"$redoff"}`),r&&fs(ui,n.player,"mouse click or tap elements to inspect"),{inspector:r}});break;case"findany":sr(n.data)&&Tv.setState({pts:n.data});break;case"log":X$(n);break;case"chat":{(n.player===""||n.player===e)&&X$(n);break}case"toast":if(he(n.data)){clearTimeout(J$),hs.setState({toast:n.data});const t=Math.max(n.data.length*150,3e3),r=Math.min(t,14e3);J$=setTimeout(()=>hs.setState({toast:""}),r)}break;case"terminal:full":hs.setState(t=>({layout:id.FULL,terminal:{...t.terminal,open:!0}}));break;case"terminal:open":if(un(n.data)){const t=Ai.getState().buffer;t[0]=n.data,Ai.setState({buffer:t,bufferindex:0,xcursor:n.data.length,ycursor:0,xselect:void 0,yselect:void 0})}hs.setState(t=>({terminal:{...t.terminal,open:!0}}));break;case"terminal:quickopen":if(un(n.data)){const t=Ai.getState().buffer;t[0]=n.data,Ai.setState({buffer:t,bufferindex:0,xcursor:n.data.length,ycursor:0,xselect:void 0,yselect:void 0})}hs.setState({quickterminal:!0,layout:id.TOP});break;case"terminal:close":hs.setState(t=>({quickterminal:!1,terminal:{...t.terminal,open:!1}}));break;case"terminal:toggle":hs.setState(t=>({terminal:{...t.terminal,open:!t.terminal.open}}));break;case"terminal:inclayout":rme(n.data)&&L5e(n.data);break;case"editor:open":if(sr(n.data)){const[t,r,i,s]=n.data;hs.setState(()=>({editor:{open:!0,player:n.player,book:t,path:r,type:i,title:s}}))}break;case"editor:close":hs.setState(t=>({editor:{...t.editor,open:!1}}));break}}),Qee="15.1.22",Q$=(n,e,t)=>({endTime:e,insertTime:t,type:"exponentialRampToValue",value:n}),eV=(n,e,t)=>({endTime:e,insertTime:t,type:"linearRampToValue",value:n}),T4=(n,e)=>({startTime:e,type:"setValue",value:n}),ete=(n,e,t)=>({duration:t,startTime:e,type:"setValueCurve",values:n}),tte=(n,e,{startTime:t,target:r,timeConstant:i})=>r+(e-r)*Math.exp((t-n)/i),ME=n=>n.type==="exponentialRampToValue",SI=n=>n.type==="linearRampToValue",wv=n=>ME(n)||SI(n),JU=n=>n.type==="setValue",P0=n=>n.type==="setValueCurve",EI=(n,e,t,r)=>{const i=n[e];return i===void 0?r:wv(i)||JU(i)?i.value:P0(i)?i.values[i.values.length-1]:tte(t,EI(n,e-1,i.startTime,r),i)},tV=(n,e,t,r,i)=>t===void 0?[r.insertTime,i]:wv(t)?[t.endTime,t.value]:JU(t)?[t.startTime,t.value]:P0(t)?[t.startTime+t.duration,t.values[t.values.length-1]]:[t.startTime,EI(n,e-1,t.startTime,i)],w4=n=>n.type==="cancelAndHold",A4=n=>n.type==="cancelScheduledValues",pv=n=>w4(n)||A4(n)?n.cancelTime:ME(n)||SI(n)?n.endTime:n.startTime,nV=(n,e,t,{endTime:r,value:i})=>t===i?i:0<t&&0<i||t<0&&i<0?t*(i/t)**((n-e)/(r-e)):0,rV=(n,e,t,{endTime:r,value:i})=>t+(n-e)/(r-e)*(i-t),B5e=(n,e)=>{const t=Math.floor(e),r=Math.ceil(e);return t===r?n[t]:(1-(e-t))*n[t]+(1-(r-e))*n[r]},F5e=(n,{duration:e,startTime:t,values:r})=>{const i=(n-t)/e*(r.length-1);return B5e(r,i)},ZR=n=>n.type==="setTarget";class j5e{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=pv(e);if(w4(e)||A4(e)){const r=this._automationEvents.findIndex(s=>A4(e)&&P0(s)?s.startTime+s.duration>=t:pv(s)>=t),i=this._automationEvents[r];if(r!==-1&&(this._automationEvents=this._automationEvents.slice(0,r)),w4(e)){const s=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&wv(i)){if(s!==void 0&&ZR(s))throw new Error("The internal list is malformed.");const o=s===void 0?i.insertTime:P0(s)?s.startTime+s.duration:pv(s),a=s===void 0?this._defaultValue:P0(s)?s.values[s.values.length-1]:s.value,c=ME(i)?nV(t,o,a,i):rV(t,o,a,i),l=ME(i)?Q$(c,t,this._currenTime):eV(c,t,this._currenTime);this._automationEvents.push(l)}if(s!==void 0&&ZR(s)&&this._automationEvents.push(T4(this.getValue(t),t)),s!==void 0&&P0(s)&&s.startTime+s.duration>t){const o=t-s.startTime,a=(s.values.length-1)/s.duration,c=Math.max(2,1+Math.ceil(o*a)),l=o/(c-1)*a,u=s.values.slice(0,c);if(l<1)for(let h=1;h<c;h+=1){const f=l*h%1;u[h]=s.values[h-1]*(1-f)+s.values[h]*f}this._automationEvents[this._automationEvents.length-1]=ete(u,s.startTime,o)}}}else{const r=this._automationEvents.findIndex(o=>pv(o)>t),i=r===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[r-1];if(i!==void 0&&P0(i)&&pv(i)+i.duration>t)return!1;const s=ME(e)?Q$(e.value,e.endTime,this._currenTime):SI(e)?eV(e.value,t,this._currenTime):e;if(r===-1)this._automationEvents.push(s);else{if(P0(e)&&t+e.duration>pv(this._automationEvents[r]))return!1;this._automationEvents.splice(r,0,s)}}return!0}flush(e){const t=this._automationEvents.findIndex(r=>pv(r)>e);if(t>1){const r=this._automationEvents.slice(t-1),i=r[0];ZR(i)&&r.unshift(T4(EI(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=r}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const t=this._automationEvents.findIndex(o=>pv(o)>e),r=this._automationEvents[t],i=(t===-1?this._automationEvents.length:t)-1,s=this._automationEvents[i];if(s!==void 0&&ZR(s)&&(r===void 0||!wv(r)||r.insertTime>e))return tte(e,EI(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(s!==void 0&&JU(s)&&(r===void 0||!wv(r)))return s.value;if(s!==void 0&&P0(s)&&(r===void 0||!wv(r)||s.startTime+s.duration>e))return e<s.startTime+s.duration?F5e(e,s):s.values[s.values.length-1];if(s!==void 0&&wv(s)&&(r===void 0||!wv(r)))return s.value;if(r!==void 0&&ME(r)){const[o,a]=tV(this._automationEvents,i,s,r,this._defaultValue);return nV(e,o,a,r)}if(r!==void 0&&SI(r)){const[o,a]=tV(this._automationEvents,i,s,r,this._defaultValue);return rV(e,o,a,r)}return this._defaultValue}}const z5e=n=>({cancelTime:n,type:"cancelAndHold"}),$5e=n=>({cancelTime:n,type:"cancelScheduledValues"}),V5e=(n,e)=>({endTime:e,type:"exponentialRampToValue",value:n}),H5e=(n,e)=>({endTime:e,type:"linearRampToValue",value:n}),G5e=(n,e,t)=>({startTime:e,target:n,timeConstant:t,type:"setTarget"}),W5e=()=>new DOMException("","AbortError"),q5e=n=>(e,t,[r,i,s],o)=>{n(e[i],[t,r,s],a=>a[0]===t&&a[1]===r,o)},Y5e=n=>(e,t,r)=>{const i=[];for(let s=0;s<r.numberOfInputs;s+=1)i.push(new Set);n.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:t})},K5e=n=>(e,t)=>{n.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})},Rx=new WeakSet,nte=new WeakMap,QU=new WeakMap,rte=new WeakMap,e8=new WeakMap,c3=new WeakMap,ite=new WeakMap,C4=new WeakMap,R4=new WeakMap,k4=new WeakMap,ste={construct(){return ste}},X5e=n=>{try{const e=new Proxy(n,ste);new e}catch{return!1}return!0},iV=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,sV=(n,e)=>{const t=[];let r=n.replace(/^[\s]+/,""),i=r.match(iV);for(;i!==null;){const s=i[1].slice(1,-1),o=i[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());t.push(o),r=r.slice(i[0].length).replace(/^[\s]+/,""),i=r.match(iV)}return[t.join(";"),r]},oV=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},aV=n=>{if(!X5e(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Z5e=(n,e,t,r,i,s,o,a,c,l,u,h,f)=>{let d=0;return(p,m,_={credentials:"omit"})=>{const v=u.get(p);if(v!==void 0&&v.has(m))return Promise.resolve();const S=l.get(p);if(S!==void 0){const w=S.get(m);if(w!==void 0)return w}const b=s(p),T=b.audioWorklet===void 0?i(m).then(([w,R])=>{const[C,N]=sV(w,R),U=`${C};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${N}
})})(window,'_AWGS')`;return t(U)}).then(()=>{const w=f._AWGS.pop();if(w===void 0)throw new SyntaxError;r(b.currentTime,b.sampleRate,()=>w(class{},void 0,(R,C)=>{if(R.trim()==="")throw e();const N=R4.get(b);if(N!==void 0){if(N.has(R))throw e();aV(C),oV(C.parameterDescriptors),N.set(R,C)}else aV(C),oV(C.parameterDescriptors),R4.set(b,new Map([[R,C]]))},b.sampleRate,void 0,void 0))}):Promise.all([i(m),Promise.resolve(n(h,h))]).then(([[w,R],C])=>{const N=d+1;d=N;const[U,B]=sV(w,R),P=`${U};((AudioWorkletProcessor,registerProcessor)=>{${B}
})(${C?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${C?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${C?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${N}',class extends AudioWorkletProcessor{process(){return !1}})`,H=new Blob([P],{type:"application/javascript; charset=utf-8"}),X=URL.createObjectURL(H);return b.audioWorklet.addModule(X,_).then(()=>{if(a(b))return b;const G=o(b);return G.audioWorklet.addModule(X,_).then(()=>G)}).then(G=>{if(c===null)throw new SyntaxError;try{new c(G,`__sac${N}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(X))});return S===void 0?l.set(p,new Map([[m,T]])):S.set(m,T),T.then(()=>{const w=u.get(p);w===void 0?u.set(p,new Set([m])):w.add(m)}).finally(()=>{const w=l.get(p);w!==void 0&&w.delete(m)}),T}},Ep=(n,e)=>{const t=n.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t},l3=(n,e)=>{const t=Array.from(n).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");const[r]=t;return n.delete(r),r},ote=(n,e,t,r)=>{const i=Ep(n,e),s=l3(i,o=>o[0]===t&&o[1]===r);return i.size===0&&n.delete(e),s},TC=n=>Ep(ite,n),kx=n=>{if(Rx.has(n))throw new Error("The AudioNode is already stored.");Rx.add(n),TC(n).forEach(e=>e(!0))},ate=n=>"port"in n,wC=n=>{if(!Rx.has(n))throw new Error("The AudioNode is not stored.");Rx.delete(n),TC(n).forEach(e=>e(!1))},M4=(n,e)=>{!ate(n)&&e.every(t=>t.size===0)&&wC(n)},J5e=(n,e,t,r,i,s,o,a,c,l,u,h,f)=>{const d=new WeakMap;return(p,m,_,v,S)=>{const{activeInputs:b,passiveInputs:T}=s(m),{outputs:w}=s(p),R=a(p),C=N=>{const U=c(m),B=c(p);if(N){const $=ote(T,p,_,v);n(b,p,$,!1),!S&&!h(p)&&t(B,U,_,v),f(m)&&kx(m)}else{const $=r(b,p,_,v);e(T,v,$,!1),!S&&!h(p)&&i(B,U,_,v);const I=o(m);if(I===0)u(m)&&M4(m,b);else{const L=d.get(m);L!==void 0&&clearTimeout(L),d.set(m,setTimeout(()=>{u(m)&&M4(m,b)},I*1e3))}}};return l(w,[m,_,v],N=>N[0]===m&&N[1]===_&&N[2]===v,!0)?(R.add(C),u(p)?n(b,p,[_,v,C],!0):e(T,v,[p,_,C],!0),!0):!1}},Q5e=n=>(e,t,[r,i,s],o)=>{const a=e.get(r);a===void 0?e.set(r,new Set([[i,t,s]])):n(a,[i,t,s],c=>c[0]===i&&c[1]===t,o)},e6e=n=>(e,t)=>{const r=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(r).connect(e.destination);const i=()=>{t.removeEventListener("ended",i),t.disconnect(r),r.disconnect()};t.addEventListener("ended",i)},t6e=n=>(e,t)=>{n(e).add(t)},n6e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},r6e=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...n6e,...c},h=r(l,u),f=s(l)?e():null;super(a,!1,h,f),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}},ql=(n,e)=>n.context===e,i6e=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!ql(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},xI=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},gg=()=>new DOMException("","IndexSizeError"),t8=n=>{n.getChannelData=(e=>t=>{try{return e.call(n,t)}catch(r){throw r.code===12?gg():r}})(n.getChannelData)},s6e={numberOfChannels:1},o6e=(n,e,t,r,i,s,o,a)=>{let c=null;return class cte{constructor(u){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:f,sampleRate:d}={...s6e,...u};c===null&&(c=new i(1,1,44100));const p=r!==null&&e(s,s)?new r({length:h,numberOfChannels:f,sampleRate:d}):c.createBuffer(f,h,d);if(p.numberOfChannels===0)throw t();return typeof p.copyFromChannel!="function"?(o(p),t8(p)):e(xI,()=>xI(p))||a(p),n.add(p),p}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===cte.prototype||n.has(u)}}},ph=-34028234663852886e22,pu=-ph,q0=n=>Rx.has(n),a6e={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},c6e=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),f={...a6e,...u},d=i(h,f),p=o(h),m=p?e():null;super(l,!1,d,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=f.buffer!==null,this._nativeAudioBufferSourceNode=d,this._onended=null,this._playbackRate=t(this,p,d.playbackRate,pu,ph)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw r();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){const u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){kx(this);const f=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",f),q0(this)&&wC(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",f)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}},l6e=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const f=ql(h,u);if(!f){const d={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(u,d),o!==null&&h.start(...o),a!==null&&h.stop(a)}return s.set(u,h),f?await n(u,l.playbackRate,h.playbackRate):await r(u,l.playbackRate,h.playbackRate),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},u6e=n=>"playbackRate"in n,h6e=n=>"frequency"in n&&"gain"in n,f6e=n=>"offset"in n,d6e=n=>!("frequency"in n)&&"gain"in n,p6e=n=>"detune"in n&&"frequency"in n&&!("gain"in n),m6e=n=>"pan"in n,bu=n=>Ep(nte,n),AC=n=>Ep(rte,n),I4=(n,e)=>{const{activeInputs:t}=bu(n);t.forEach(i=>i.forEach(([s])=>{e.includes(n)||I4(s,[...e,n])}));const r=u6e(n)?[n.playbackRate]:ate(n)?Array.from(n.parameters.values()):h6e(n)?[n.Q,n.detune,n.frequency,n.gain]:f6e(n)?[n.offset]:d6e(n)?[n.gain]:p6e(n)?[n.detune,n.frequency]:m6e(n)?[n.pan]:[];for(const i of r){const s=AC(i);s!==void 0&&s.activeInputs.forEach(([o])=>I4(o,e))}q0(n)&&wC(n)},lte=n=>{I4(n.destination,[])},g6e=n=>n===void 0||typeof n=="number"||typeof n=="string"&&(n==="balanced"||n==="interactive"||n==="playback"),_6e=(n,e,t,r,i,s,o,a,c)=>class extends n{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(p){throw p.code===12&&p.message==="sampleRate is not in range"?t():p}if(h===null)throw r();if(!g6e(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw t();super(h,2);const{latencyHint:f}=u,{sampleRate:d}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:f==="balanced"?512/d:f==="interactive"||f===void 0?256/d:f==="playback"?1024/d:Math.max(2,Math.min(128,Math.round(f*d/128)))*128/d,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const p=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",p)};h.addEventListener("statechange",p)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),lte(this)}))}createMediaElementSource(u){return new i(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new o(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{const f=()=>{this._nativeAudioContext.removeEventListener("statechange",f),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",f)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}},v6e=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),f=o(h),d=i(h,u,f),p=f?e(a):null;super(l,!1,d,p),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=d}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},y6e=n=>{const e=new WeakMap,t=async(r,i)=>{const s=i.destination;return e.set(i,s),await n(r,i,s),s};return{render(r,i){const s=e.get(i);return s!==void 0?Promise.resolve(s):t(r,i)}}},b6e=(n,e,t,r,i,s,o,a)=>(c,l)=>{const u=l.listener,h=()=>{const w=new Float32Array(1),R=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),C=o(l);let N=!1,U=[0,0,-1,0,1,0],B=[0,0,0];const $=()=>{if(N)return;N=!0;const H=r(l,256,9,0);H.onaudioprocess=({inputBuffer:X})=>{const G=[s(X,w,0),s(X,w,1),s(X,w,2),s(X,w,3),s(X,w,4),s(X,w,5)];G.some((J,Q)=>J!==U[Q])&&(u.setOrientation(...G),U=G);const Y=[s(X,w,6),s(X,w,7),s(X,w,8)];Y.some((J,Q)=>J!==B[Q])&&(u.setPosition(...Y),B=Y)},R.connect(H)},I=H=>X=>{X!==U[H]&&(U[H]=X,u.setOrientation(...U))},L=H=>X=>{X!==B[H]&&(B[H]=X,u.setPosition(...B))},P=(H,X,G)=>{const Y=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:X});Y.connect(R,0,H),Y.start(),Object.defineProperty(Y.offset,"defaultValue",{get(){return X}});const J=n({context:c},C,Y.offset,pu,ph);return a(J,"value",Q=>()=>Q.call(J),Q=>z=>{try{Q.call(J,z)}catch(q){if(q.code!==9)throw q}$(),C&&G(z)}),J.cancelAndHoldAtTime=(Q=>C?()=>{throw i()}:(...z)=>{const q=Q.apply(J,z);return $(),q})(J.cancelAndHoldAtTime),J.cancelScheduledValues=(Q=>C?()=>{throw i()}:(...z)=>{const q=Q.apply(J,z);return $(),q})(J.cancelScheduledValues),J.exponentialRampToValueAtTime=(Q=>C?()=>{throw i()}:(...z)=>{const q=Q.apply(J,z);return $(),q})(J.exponentialRampToValueAtTime),J.linearRampToValueAtTime=(Q=>C?()=>{throw i()}:(...z)=>{const q=Q.apply(J,z);return $(),q})(J.linearRampToValueAtTime),J.setTargetAtTime=(Q=>C?()=>{throw i()}:(...z)=>{const q=Q.apply(J,z);return $(),q})(J.setTargetAtTime),J.setValueAtTime=(Q=>C?()=>{throw i()}:(...z)=>{const q=Q.apply(J,z);return $(),q})(J.setValueAtTime),J.setValueCurveAtTime=(Q=>C?()=>{throw i()}:(...z)=>{const q=Q.apply(J,z);return $(),q})(J.setValueCurveAtTime),J};return{forwardX:P(0,0,I(0)),forwardY:P(1,0,I(1)),forwardZ:P(2,-1,I(2)),positionX:P(6,0,L(0)),positionY:P(7,0,L(1)),positionZ:P(8,0,L(2)),upX:P(3,0,I(3)),upY:P(4,1,I(4)),upZ:P(5,0,I(5))}},{forwardX:f,forwardY:d,forwardZ:p,positionX:m,positionY:_,positionZ:v,upX:S,upY:b,upZ:T}=u.forwardX===void 0?h():u;return{get forwardX(){return f},get forwardY(){return d},get forwardZ(){return p},get positionX(){return m},get positionY(){return _},get positionZ(){return v},get upX(){return S},get upY(){return b},get upZ(){return T}}},TI=n=>"context"in n,CC=n=>TI(n[0]),M1=(n,e,t,r)=>{for(const i of n)if(t(i)){if(r)return!1;throw Error("The set contains at least one similar element.")}return n.add(e),!0},cV=(n,e,[t,r],i)=>{M1(n,[e,t,r],s=>s[0]===e&&s[1]===t,i)},lV=(n,[e,t,r],i)=>{const s=n.get(e);s===void 0?n.set(e,new Set([[t,r]])):M1(s,[t,r],o=>o[0]===t,i)},eT=n=>"inputs"in n,wI=(n,e,t,r)=>{if(eT(e)){const i=e.inputs[r];return n.connect(i,t,0),[i,t,0]}return n.connect(e,t,r),[e,t,r]},ute=(n,e,t)=>{for(const r of n)if(r[0]===e&&r[1]===t)return n.delete(r),r;return null},S6e=(n,e,t)=>l3(n,r=>r[0]===e&&r[1]===t),hte=(n,e)=>{if(!TC(n).delete(e))throw new Error("Missing the expected event listener.")},fte=(n,e,t)=>{const r=Ep(n,e),i=l3(r,s=>s[0]===t);return r.size===0&&n.delete(e),i},AI=(n,e,t,r)=>{eT(e)?n.disconnect(e.inputs[r],t,0):n.disconnect(e,t,r)},wo=n=>Ep(QU,n),OA=n=>Ep(e8,n),c1=n=>C4.has(n),eM=n=>!Rx.has(n),uV=(n,e)=>new Promise(t=>{if(e!==null)t(!0);else{const r=n.createScriptProcessor(256,1,1),i=n.createGain(),s=n.createBuffer(1,2,44100),o=s.getChannelData(0);o[0]=1,o[1]=1;const a=n.createBufferSource();a.buffer=s,a.loop=!0,a.connect(r).connect(n.destination),a.connect(i),a.disconnect(i),r.onaudioprocess=c=>{const l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),r.onaudioprocess=null,a.disconnect(r),r.disconnect(n.destination)},a.start()}}),P2=(n,e)=>{const t=new Map;for(const r of n)for(const i of r){const s=t.get(i);t.set(i,s===void 0?1:s+1)}t.forEach((r,i)=>e(i,r))},CI=n=>"context"in n,E6e=n=>{const e=new Map;n.connect=(t=>(r,i=0,s=0)=>{const o=CI(r)?t(r,i,s):t(r,i),a=e.get(r);return a===void 0?e.set(r,[{input:s,output:i}]):a.every(c=>c.input!==s||c.output!==i)&&a.push({input:s,output:i}),o})(n.connect.bind(n)),n.disconnect=(t=>(r,i,s)=>{if(t.apply(n),r===void 0)e.clear();else if(typeof r=="number")for(const[o,a]of e){const c=a.filter(l=>l.output!==r);c.length===0?e.delete(o):e.set(o,c)}else if(e.has(r))if(i===void 0)e.delete(r);else{const o=e.get(r);if(o!==void 0){const a=o.filter(c=>c.output!==i&&(c.input!==s||s===void 0));a.length===0?e.delete(r):e.set(r,a)}}for(const[o,a]of e)a.forEach(c=>{CI(o)?n.connect(o,c.output,c.input):n.connect(o,c.output)})})(n.disconnect)},x6e=(n,e,t,r)=>{const{activeInputs:i,passiveInputs:s}=AC(e),{outputs:o}=bu(n),a=TC(n),c=l=>{const u=wo(n),h=OA(e);if(l){const f=fte(s,n,t);cV(i,n,f,!1),!r&&!c1(n)&&u.connect(h,t)}else{const f=S6e(i,n,t);lV(s,f,!1),!r&&!c1(n)&&u.disconnect(h,t)}};return M1(o,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),q0(n)?cV(i,n,[t,c],!0):lV(s,[n,t,c],!0),!0):!1},T6e=(n,e,t,r)=>{const{activeInputs:i,passiveInputs:s}=bu(e),o=ute(i[r],n,t);return o===null?[ote(s,n,t,r)[2],!1]:[o[2],!0]},w6e=(n,e,t)=>{const{activeInputs:r,passiveInputs:i}=AC(e),s=ute(r,n,t);return s===null?[fte(i,n,t)[1],!1]:[s[2],!0]},n8=(n,e,t,r,i)=>{const[s,o]=T6e(n,t,r,i);if(s!==null&&(hte(n,s),o&&!e&&!c1(n)&&AI(wo(n),wo(t),r,i)),q0(t)){const{activeInputs:a}=bu(t);M4(t,a)}},r8=(n,e,t,r)=>{const[i,s]=w6e(n,t,r);i!==null&&(hte(n,i),s&&!e&&!c1(n)&&wo(n).disconnect(OA(t),r))},A6e=(n,e)=>{const t=bu(n),r=[];for(const i of t.outputs)CC(i)?n8(n,e,...i):r8(n,e,...i),r.push(i[0]);return t.outputs.clear(),r},C6e=(n,e,t)=>{const r=bu(n),i=[];for(const s of r.outputs)s[1]===t&&(CC(s)?n8(n,e,...s):r8(n,e,...s),i.push(s[0]),r.outputs.delete(s));return i},R6e=(n,e,t,r,i)=>{const s=bu(n);return Array.from(s.outputs).filter(o=>o[0]===t&&(r===void 0||o[1]===r)&&(i===void 0||o[2]===i)).map(o=>(CC(o)?n8(n,e,...o):r8(n,e,...o),s.outputs.delete(o),o[0]))},k6e=(n,e,t,r,i,s,o,a,c,l,u,h,f,d,p,m)=>class extends l{constructor(v,S,b,T){super(b),this._context=v,this._nativeAudioNode=b;const w=u(v);h(w)&&t(uV,()=>uV(w,m))!==!0&&E6e(b),QU.set(this,b),ite.set(this,new Set),v.state!=="closed"&&S&&kx(this),n(this,T,b)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(v){this._nativeAudioNode.channelCount=v}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(v){this._nativeAudioNode.channelCountMode=v}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(v){this._nativeAudioNode.channelInterpretation=v}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(v,S=0,b=0){if(S<0||S>=this._nativeAudioNode.numberOfOutputs)throw i();const T=u(this._context),w=p(T);if(f(v)||d(v))throw s();if(TI(v)){const N=wo(v);try{const B=wI(this._nativeAudioNode,N,S,b),$=eM(this);(w||$)&&this._nativeAudioNode.disconnect(...B),this.context.state!=="closed"&&!$&&eM(v)&&kx(v)}catch(B){throw B.code===12?s():B}if(e(this,v,S,b,w)){const B=c([this],v);P2(B,r(w))}return v}const R=OA(v);if(R.name==="playbackRate"&&R.maxValue===1024)throw o();try{this._nativeAudioNode.connect(R,S),(w||eM(this))&&this._nativeAudioNode.disconnect(R,S)}catch(N){throw N.code===12?s():N}if(x6e(this,v,S,w)){const N=c([this],v);P2(N,r(w))}}disconnect(v,S,b){let T;const w=u(this._context),R=p(w);if(v===void 0)T=A6e(this,R);else if(typeof v=="number"){if(v<0||v>=this.numberOfOutputs)throw i();T=C6e(this,R,v)}else{if(S!==void 0&&(S<0||S>=this.numberOfOutputs)||TI(v)&&b!==void 0&&(b<0||b>=v.numberOfInputs))throw i();if(T=R6e(this,R,v,S,b),T.length===0)throw s()}for(const C of T){const N=c([this],C);P2(N,a)}}},M6e=(n,e,t,r,i,s,o,a,c,l,u,h,f)=>(d,p,m,_=null,v=null)=>{const S=m.value,b=new j5e(S),T=p?r(b):null,w={get defaultValue(){return S},get maxValue(){return _===null?m.maxValue:_},get minValue(){return v===null?m.minValue:v},get value(){return m.value},set value(R){m.value=R,w.setValueAtTime(R,d.context.currentTime)},cancelAndHoldAtTime(R){if(typeof m.cancelAndHoldAtTime=="function")T===null&&b.flush(d.context.currentTime),b.add(i(R)),m.cancelAndHoldAtTime(R);else{const C=Array.from(b).pop();T===null&&b.flush(d.context.currentTime),b.add(i(R));const N=Array.from(b).pop();m.cancelScheduledValues(R),C!==N&&N!==void 0&&(N.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(N.value,N.endTime):N.type==="linearRampToValue"?m.linearRampToValueAtTime(N.value,N.endTime):N.type==="setValue"?m.setValueAtTime(N.value,N.startTime):N.type==="setValueCurve"&&m.setValueCurveAtTime(N.values,N.startTime,N.duration))}return w},cancelScheduledValues(R){return T===null&&b.flush(d.context.currentTime),b.add(s(R)),m.cancelScheduledValues(R),w},exponentialRampToValueAtTime(R,C){if(R===0)throw new RangeError;if(!Number.isFinite(C)||C<0)throw new RangeError;const N=d.context.currentTime;return T===null&&b.flush(N),Array.from(b).length===0&&(b.add(l(S,N)),m.setValueAtTime(S,N)),b.add(o(R,C)),m.exponentialRampToValueAtTime(R,C),w},linearRampToValueAtTime(R,C){const N=d.context.currentTime;return T===null&&b.flush(N),Array.from(b).length===0&&(b.add(l(S,N)),m.setValueAtTime(S,N)),b.add(a(R,C)),m.linearRampToValueAtTime(R,C),w},setTargetAtTime(R,C,N){return T===null&&b.flush(d.context.currentTime),b.add(c(R,C,N)),m.setTargetAtTime(R,C,N),w},setValueAtTime(R,C){return T===null&&b.flush(d.context.currentTime),b.add(l(R,C)),m.setValueAtTime(R,C),w},setValueCurveAtTime(R,C,N){const U=R instanceof Float32Array?R:new Float32Array(R);if(h!==null&&h.name==="webkitAudioContext"){const B=C+N,$=d.context.sampleRate,I=Math.ceil(C*$),L=Math.floor(B*$),P=L-I,H=new Float32Array(P);for(let G=0;G<P;G+=1){const Y=(U.length-1)/N*((I+G)/$-C),J=Math.floor(Y),Q=Math.ceil(Y);H[G]=J===Q?U[J]:(1-(Y-J))*U[J]+(1-(Q-Y))*U[Q]}T===null&&b.flush(d.context.currentTime),b.add(u(H,C,N)),m.setValueCurveAtTime(H,C,N);const X=L/$;X<B&&f(w,H[H.length-1],X),f(w,U[U.length-1],B)}else T===null&&b.flush(d.context.currentTime),b.add(u(U,C,N)),m.setValueCurveAtTime(U,C,N);return w}};return t.set(w,m),e.set(w,d),n(w,T),w},I6e=n=>({replay(e){for(const t of n)if(t.type==="exponentialRampToValue"){const{endTime:r,value:i}=t;e.exponentialRampToValueAtTime(i,r)}else if(t.type==="linearRampToValue"){const{endTime:r,value:i}=t;e.linearRampToValueAtTime(i,r)}else if(t.type==="setTarget"){const{startTime:r,target:i,timeConstant:s}=t;e.setTargetAtTime(i,r,s)}else if(t.type==="setValue"){const{startTime:r,value:i}=t;e.setValueAtTime(i,r)}else if(t.type==="setValueCurve"){const{duration:r,startTime:i,values:s}=t;e.setValueCurveAtTime(s,i,r)}else throw new Error("Can't apply an unknown automation.")}});class dte{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((r,i)=>e.call(t,r,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const O6e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},N6e=(n,e,t,r,i,s,o,a,c,l,u,h,f,d)=>class extends e{constructor(m,_,v){var S;const b=a(m),T=c(b),w=u({...O6e,...v});f(w);const R=R4.get(b),C=R?.get(_),N=T||b.state!=="closed"?b:(S=o(b))!==null&&S!==void 0?S:b,U=i(N,T?null:m.baseLatency,l,_,C,w),B=T?r(_,w,C):null;super(m,!0,U,B);const $=[];U.parameters.forEach((L,P)=>{const H=t(this,T,L);$.push([P,H])}),this._nativeAudioWorkletNode=U,this._onprocessorerror=null,this._parameters=new dte($),T&&n(b,this);const{activeInputs:I}=s(this);h(U,I)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){const _=typeof m=="function"?d(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=_;const v=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=v!==null&&v===_?m:v}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function RI(n,e,t,r,i){if(typeof n.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),n.copyFromChannel(e[t],r,i);else{const s=n.getChannelData(r);if(e[t].byteLength===0)e[t]=s.slice(i,i+128);else{const o=new Float32Array(s.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(o)}}}const pte=(n,e,t,r,i)=>{typeof n.copyToChannel=="function"?e[t].byteLength!==0&&n.copyToChannel(e[t],r,i):e[t].byteLength!==0&&n.getChannelData(r).set(e[t],i)},kI=(n,e)=>{const t=[];for(let r=0;r<n;r+=1){const i=[],s=typeof e=="number"?e:e[r];for(let o=0;o<s;o+=1)i.push(new Float32Array(128));t.push(i)}return t},P6e=(n,e)=>{const t=Ep(k4,n),r=wo(e);return Ep(t,r)},D6e=async(n,e,t,r,i,s,o)=>{const a=e===null?Math.ceil(n.context.length/128)*128:e.length,c=r.channelCount*r.numberOfInputs,l=i.reduce((_,v)=>_+v,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");const h=bu(n),f=await P6e(t,n),d=kI(r.numberOfInputs,r.channelCount),p=kI(r.numberOfOutputs,i),m=Array.from(n.parameters.keys()).reduce((_,v)=>({..._,[v]:new Float32Array(128)}),{});for(let _=0;_<a;_+=128){if(r.numberOfInputs>0&&e!==null)for(let v=0;v<r.numberOfInputs;v+=1)for(let S=0;S<r.channelCount;S+=1)RI(e,d[v],S,S,_);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:v},S)=>{RI(e,m,v,c+S,_)});for(let v=0;v<r.numberOfInputs;v+=1)for(let S=0;S<i[v];S+=1)p[v][S].byteLength===0&&(p[v][S]=new Float32Array(128));try{const v=d.map((b,T)=>h.activeInputs[T].size===0?[]:b),S=o(_/t.sampleRate,t.sampleRate,()=>f.process(v,p,m));if(u!==null)for(let b=0,T=0;b<r.numberOfOutputs;b+=1){for(let w=0;w<i[b];w+=1)pte(u,p[b],w,T+w,_);T+=i[b]}if(!S)break}catch(v){n.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return u},L6e=(n,e,t,r,i,s,o,a,c,l,u,h,f,d,p,m)=>(_,v,S)=>{const b=new WeakMap;let T=null;const w=async(R,C)=>{let N=u(R),U=null;const B=ql(N,C),$=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(h===null){const I=$.reduce((X,G)=>X+G,0),L=i(C,{channelCount:Math.max(1,I),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,I)}),P=[];for(let X=0;X<R.numberOfOutputs;X+=1)P.push(r(C,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:$[X]}));const H=o(C,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});H.connect=e.bind(null,P),H.disconnect=c.bind(null,P),U=[L,P,H]}else B||(N=new h(C,_));if(b.set(C,U===null?N:U[2]),U!==null){if(T===null){if(S===void 0)throw new Error("Missing the processor constructor.");if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const G=R.channelCount*R.numberOfInputs,Y=S.parameterDescriptors===void 0?0:S.parameterDescriptors.length,J=G+Y;T=D6e(R,J===0?null:await(async()=>{const z=new f(J,Math.ceil(R.context.length/128)*128,C.sampleRate),q=[],ee=[];for(let Ee=0;Ee<v.numberOfInputs;Ee+=1)q.push(o(z,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),ee.push(i(z,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const te=await Promise.all(Array.from(R.parameters.values()).map(async Ee=>{const Re=s(z,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Ee.value});return await d(z,Ee,Re.offset),Re})),ie=r(z,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,G+Y)});for(let Ee=0;Ee<v.numberOfInputs;Ee+=1){q[Ee].connect(ee[Ee]);for(let Re=0;Re<v.channelCount;Re+=1)ee[Ee].connect(ie,Re,Ee*v.channelCount+Re)}for(const[Ee,Re]of te.entries())Re.connect(ie,0,G+Ee),Re.start(0);return ie.connect(z.destination),await Promise.all(q.map(Ee=>p(R,z,Ee))),m(z)})(),C,v,$,S,l)}const I=await T,L=t(C,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[P,H,X]=U;I!==null&&(L.buffer=I,L.start(0)),L.connect(P);for(let G=0,Y=0;G<R.numberOfOutputs;G+=1){const J=H[G];for(let Q=0;Q<$[G];Q+=1)P.connect(J,Y+Q,Q);Y+=$[G]}return X}if(B)for(const[I,L]of R.parameters.entries())await n(C,L,N.parameters.get(I));else for(const[I,L]of R.parameters.entries())await d(C,L,N.parameters.get(I));return await p(R,C,N),N};return{render(R,C){a(C,R);const N=b.get(C);return N!==void 0?Promise.resolve(N):w(R,C)}}},U6e=(n,e,t,r,i,s,o,a,c,l,u,h,f,d,p,m,_,v,S,b)=>class extends p{constructor(w,R){super(w,R),this._nativeContext=w,this._audioWorklet=n===void 0?void 0:{addModule:(C,N)=>n(this,C,N)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(w,R,C){return new t({length:R,numberOfChannels:w,sampleRate:C})}createBufferSource(){return new r(this)}createChannelMerger(w=6){return new s(this,{numberOfInputs:w})}createChannelSplitter(w=6){return new o(this,{numberOfOutputs:w})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(w=1){return new u(this,{maxDelayTime:w})}createDynamicsCompressor(){return new h(this)}createGain(){return new f(this)}createIIRFilter(w,R){return new d(this,{feedback:R,feedforward:w})}createOscillator(){return new m(this)}createPanner(){return new _(this)}createPeriodicWave(w,R,C={disableNormalization:!1}){return new v(this,{...C,imag:R,real:w})}createStereoPanner(){return new S(this)}createWaveShaper(){return new b(this)}decodeAudioData(w,R,C){return l(this._nativeContext,w).then(N=>(typeof R=="function"&&R(N),N),N=>{throw typeof C=="function"&&C(N),N})}},B6e={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},F6e=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),f={...B6e,...u},d=i(h,f),p=o(h),m=p?t():null;super(l,!1,d,m),this._Q=e(this,p,d.Q,pu,ph),this._detune=e(this,p,d.detune,1200*Math.log2(pu),-1200*Math.log2(pu)),this._frequency=e(this,p,d.frequency,l.sampleRate/2,0),this._gain=e(this,p,d.gain,40*Math.log10(pu),ph),this._nativeBiquadFilterNode=d,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(f){throw f.code===11?r():f}if(l.length!==u.length||u.length!==h.length)throw r()}},j6e=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=ql(l,c);if(!u){const h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,h)}return s.set(c,l),u?(await n(c,a.Q,l.Q),await n(c,a.detune,l.detune),await n(c,a.frequency,l.frequency),await n(c,a.gain,l.gain)):(await r(c,a.Q,l.Q),await r(c,a.detune,l.detune),await r(c,a.frequency,l.frequency),await r(c,a.gain,l.gain)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},z6e=(n,e)=>(t,r)=>{const i=e.get(t);if(i!==void 0)return i;const s=n.get(t);if(s!==void 0)return s;try{const o=r();return o instanceof Promise?(n.set(t,o),o.catch(()=>!1).then(a=>(n.delete(t),e.set(t,a),a))):(e.set(t,o),o)}catch{return e.set(t,!1),!1}},$6e={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},V6e=(n,e,t,r,i)=>class extends n{constructor(o,a){const c=r(o),l={...$6e,...a},u=t(c,l),h=i(c)?e():null;super(o,!1,u,h)}},H6e=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!ql(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},G6e={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},W6e=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u=s({...G6e,...c}),h=t(l,u),f=i(l)?e():null;super(a,!1,h,f)}},q6e=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!ql(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=n(o,l)}return r.set(o,a),await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},Y6e=n=>(e,t,r)=>n(t,e,r),K6e=n=>(e,t,r=0,i=0)=>{const s=e[r];if(s===void 0)throw n();return CI(t)?s.connect(t,0,i):s.connect(t,0)},X6e=n=>(e,t)=>{const r=n(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return r.buffer=i,r.loop=!0,r.connect(t),r.start(),()=>{r.stop(),r.disconnect(t)}},Z6e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},J6e=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...Z6e,...l},f=r(u,h),d=s(u),p=d?t():null;super(c,!1,f,p),this._constantSourceNodeRenderer=p,this._nativeConstantSourceNode=f,this._offset=e(this,d,f.offset,pu,ph),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeConstantSourceNode.onended=l;const u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){kx(this);const l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),q0(this)&&wC(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},Q6e=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null;const c=async(l,u)=>{let h=t(l);const f=ql(h,u);if(!f){const d={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(u,d),o!==null&&h.start(o),a!==null&&h.stop(a)}return s.set(u,h),f?await n(u,l.offset,h.offset):await r(u,l.offset,h.offset),await i(l,u,h),h};return{set start(l){o=l},set stop(l){a=l},render(l,u){const h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}},eUe=n=>e=>(n[0]=e,n[0]),tUe={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},nUe=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u={...tUe,...c},h=t(l,u),d=i(l)?e():null;super(a,!1,h,d),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}},rUe=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!ql(a,o)){const l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=n(o,l)}return r.set(o,a),eT(a)?await t(s,o,a.inputs[0]):await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},iUe=(n,e)=>(t,r,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,r,i)}catch(s){throw s.name==="SyntaxError"?n():s}},sUe=()=>new DOMException("","DataCloneError"),hV=n=>{const{port1:e,port2:t}=new MessageChannel;return new Promise(r=>{const i=()=>{t.onmessage=null,e.close(),t.close(),r()};t.onmessage=()=>i();try{e.postMessage(n,[n])}catch{}finally{i()}})},oUe=(n,e,t,r,i,s,o,a,c,l,u)=>(h,f)=>{const d=o(h)?h:s(h);if(i.has(f)){const p=t();return Promise.reject(p)}try{i.add(f)}catch{}return e(c,()=>c(d))?d.decodeAudioData(f).then(p=>(hV(f).catch(()=>{}),e(a,()=>a(p))||u(p),n.add(p),p)):new Promise((p,m)=>{const _=async()=>{try{await hV(f)}catch{}},v=S=>{m(S),_()};try{d.decodeAudioData(f,S=>{typeof S.copyFromChannel!="function"&&(l(S),t8(S)),n.add(S),_().then(()=>p(S))},S=>{v(S===null?r():S)})}catch(S){v(S)}})},aUe=(n,e,t,r,i,s,o,a)=>(c,l)=>{const u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");const h=s(c.context),f=a(h);if(u===l){if(e.delete(c),!f&&o(c)){const d=r(c),{outputs:p}=t(c);for(const m of p)if(CC(m)){const _=r(m[0]);n(d,_,m[1],m[2])}else{const _=i(m[0]);d.connect(_,m[1])}}}else e.set(c,u-l)},cUe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},lUe=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...cUe,...l},f=r(u,h),d=s(u),p=d?t(h.maxDelayTime):null;super(c,!1,f,p),this._delayTime=e(this,d,f.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},uUe=(n,e,t,r,i)=>s=>{const o=new WeakMap,a=async(c,l)=>{let u=t(c);const h=ql(u,l);if(!h){const f={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,f)}return o.set(l,u),h?await n(l,c.delayTime,u.delayTime):await r(l,c.delayTime,u.delayTime),await i(c,l,u),u};return{render(c,l){const u=o.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}},hUe=n=>(e,t,r,i)=>n(e[i],s=>s[0]===t&&s[1]===r),fUe=n=>(e,t)=>{n(e).delete(t)},dUe=n=>"delayTime"in n,pUe=(n,e,t)=>function r(i,s){const o=TI(s)?s:t(n,s);if(dUe(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(c=>r([...i,o],c[0])).reduce((c,l)=>c.concat(l),[])},JR=(n,e,t)=>{const r=e[t];if(r===void 0)throw n();return r},mUe=n=>(e,t=void 0,r=void 0,i=0)=>t===void 0?e.forEach(s=>s.disconnect()):typeof t=="number"?JR(n,e,t).disconnect():CI(t)?r===void 0?e.forEach(s=>s.disconnect(t)):i===void 0?JR(n,e,r).disconnect(t,0):JR(n,e,r).disconnect(t,0,i):r===void 0?e.forEach(s=>s.disconnect(t)):JR(n,e,r).disconnect(t,0),gUe={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},_Ue=(n,e,t,r,i,s,o,a)=>class extends n{constructor(l,u){const h=s(l),f={...gUe,...u},d=r(h,f),p=o(h),m=p?t():null;super(l,!1,d,m),this._attack=e(this,p,d.attack),this._knee=e(this,p,d.knee),this._nativeDynamicsCompressorNode=d,this._ratio=e(this,p,d.ratio),this._release=e(this,p,d.release),this._threshold=e(this,p,d.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){const u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){const u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},vUe=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=ql(l,c);if(!u){const h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,h)}return s.set(c,l),u?(await n(c,a.attack,l.attack),await n(c,a.knee,l.knee),await n(c,a.ratio,l.ratio),await n(c,a.release,l.release),await n(c,a.threshold,l.threshold)):(await r(c,a.attack,l.attack),await r(c,a.knee,l.knee),await r(c,a.ratio,l.ratio),await r(c,a.release,l.release),await r(c,a.threshold,l.threshold)),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},yUe=()=>new DOMException("","EncodingError"),bUe=n=>e=>new Promise((t,r)=>{if(n===null){r(new SyntaxError);return}const i=n.document.head;if(i===null)r(new SyntaxError);else{const s=n.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=n.onerror,l=()=>{n.onerror=c,URL.revokeObjectURL(a)};n.onerror=(u,h,f,d,p)=>{if(h===a||h===n.location.href&&f===1&&d===1)return l(),r(p),!1;if(c!==null)return c(u,h,f,d,p)},s.onerror=()=>{l(),r(new SyntaxError)},s.onload=()=>{l(),t()},s.src=a,s.type="module",i.appendChild(s)}}),SUe=n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,r,i){if(r!==null){let s=this._listeners.get(r);s===void 0&&(s=n(this,r),typeof r=="function"&&this._listeners.set(r,s)),this._nativeEventTarget.addEventListener(t,s,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,r,i){const s=r===null?void 0:this._listeners.get(r);this._nativeEventTarget.removeEventListener(t,s===void 0?null:s,i)}},EUe=n=>(e,t,r)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return r()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}},xUe=n=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw n()},TUe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},wUe=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...TUe,...c},h=r(l,u),f=s(l),d=f?t():null;super(a,!1,h,d),this._gain=e(this,f,h.gain,pu,ph)}get gain(){return this._gain}},AUe=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=ql(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,h)}return s.set(c,l),u?await n(c,a.gain,l.gain):await r(c,a.gain,l.gain),await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},CUe=(n,e)=>t=>e(n,t),RUe=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer},kUe=n=>e=>{var t;return(t=n.get(e))!==null&&t!==void 0?t:0},MUe=n=>e=>{const t=n(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer},IUe=n=>e=>n.get(e),Vc=()=>new DOMException("","InvalidStateError"),OUe=n=>e=>{const t=n.get(e);if(t===void 0)throw Vc();return t},NUe=(n,e)=>t=>{let r=n.get(t);if(r!==void 0)return r;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new e(1,1,44100),n.set(t,r),r},PUe=n=>e=>{const t=n.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t},u3=()=>new DOMException("","InvalidAccessError"),DUe=n=>{n.getFrequencyResponse=(e=>(t,r,i)=>{if(t.length!==r.length||r.length!==i.length)throw u3();return e.call(n,t,r,i)})(n.getFrequencyResponse)},LUe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},UUe=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=r(a),u=i(l),h={...LUe,...c},f=e(l,u?null:a.baseLatency,h),d=u?t(h.feedback,h.feedforward):null;super(a,!1,f,d),DUe(f),this._nativeIIRFilterNode=f,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}},mte=(n,e,t,r,i,s,o,a,c,l,u)=>{const h=l.length;let f=a;for(let d=0;d<h;d+=1){let p=t[0]*l[d];for(let m=1;m<i;m+=1){const _=f-m&c-1;p+=t[m]*s[_],p-=n[m]*o[_]}for(let m=i;m<r;m+=1)p+=t[m]*s[f-m&c-1];for(let m=i;m<e;m+=1)p-=n[m]*o[f-m&c-1];s[f]=l[d],o[f]=p,f=f+1&c-1,u[d]=p}return f},BUe=(n,e,t,r)=>{const i=t instanceof Float64Array?t:new Float64Array(t),s=r instanceof Float64Array?r:new Float64Array(r),o=i.length,a=s.length,c=Math.min(o,a);if(i[0]!==1){for(let p=0;p<o;p+=1)s[p]/=i[0];for(let p=1;p<a;p+=1)i[p]/=i[0]}const l=32,u=new Float32Array(l),h=new Float32Array(l),f=e.createBuffer(n.numberOfChannels,n.length,n.sampleRate),d=n.numberOfChannels;for(let p=0;p<d;p+=1){const m=n.getChannelData(p),_=f.getChannelData(p);u.fill(0),h.fill(0),mte(i,o,s,a,c,u,h,0,l,m,_)}return f},FUe=(n,e,t,r,i)=>(s,o)=>{const a=new WeakMap;let c=null;const l=async(u,h)=>{let f=null,d=e(u);const p=ql(d,h);if(h.createIIRFilter===void 0?f=n(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=h.createIIRFilter(o,s)),a.set(h,f===null?d:f),f!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");const _=new t(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await r(u,_,_.destination);const v=await i(_);return BUe(v,h,s,o)})()}const m=await c;return f.buffer=m,f.start(0),f}return await r(u,h,d),d};return{render(u,h){const f=a.get(h);return f!==void 0?Promise.resolve(f):l(u,h)}}},jUe=(n,e,t,r,i,s)=>o=>(a,c)=>{const l=n.get(a);if(l===void 0){if(!o&&s(a)){const u=r(a),{outputs:h}=t(a);for(const f of h)if(CC(f)){const d=r(f[0]);e(u,d,f[1],f[2])}else{const d=i(f[0]);u.disconnect(d,f[1])}}n.set(a,c)}else n.set(a,l+c)},zUe=(n,e)=>t=>{const r=n.get(t);return e(r)||e(t)},$Ue=(n,e)=>t=>n.has(t)||e(t),VUe=(n,e)=>t=>n.has(t)||e(t),HUe=(n,e)=>t=>{const r=n.get(t);return e(r)||e(t)},GUe=n=>e=>n!==null&&e instanceof n,WUe=n=>e=>n!==null&&typeof n.AudioNode=="function"&&e instanceof n.AudioNode,qUe=n=>e=>n!==null&&typeof n.AudioParam=="function"&&e instanceof n.AudioParam,YUe=(n,e)=>t=>n(t)||e(t),KUe=n=>e=>n!==null&&e instanceof n,XUe=n=>n!==null&&n.isSecureContext,ZUe=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s),c=e(a,o);if(r(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},JUe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},QUe=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s);if(r(a))throw new TypeError;const c={...JUe,...o},l=e(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},e8e=(n,e,t,r)=>class extends n{constructor(s,o){const a=t(s),c=e(a,o);if(r(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},t8e=(n,e,t)=>class extends n{constructor(i,s){const o=t(i),a=e(o,s);super(i,!0,a,null)}},n8e=(n,e,t,r,i,s)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,c3.set(this,a),r(a)&&i.set(a,new Set),this._destination=new n(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){const c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;const l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},NA=n=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const t=n.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1},r8e=(n,e)=>(t,r,i)=>{const s=new Set;return t.connect=(o=>(a,c=0,l=0)=>{const u=s.size===0;if(e(a))return o.call(t,a,c,l),n(s,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&r(),a;o.call(t,a,c),n(s,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&r()})(t.connect),t.disconnect=(o=>(a,c,l)=>{const u=s.size>0;if(a===void 0)o.apply(t),s.clear();else if(typeof a=="number"){o.call(t,a);for(const f of s)f[1]===a&&s.delete(f)}else{e(a)?o.call(t,a,c,l):o.call(t,a,c);for(const f of s)f[0]===a&&(c===void 0||f[1]===c)&&(l===void 0||f[2]===l)&&s.delete(f)}const h=s.size===0;u&&h&&i()})(t.disconnect),t},Io=(n,e,t)=>{const r=e[t];r!==void 0&&r!==n[t]&&(n[t]=r)},yc=(n,e)=>{Io(n,e,"channelCount"),Io(n,e,"channelCountMode"),Io(n,e,"channelInterpretation")},fV=n=>typeof n.getFloatTimeDomainData=="function",i8e=n=>{n.getFloatTimeDomainData=e=>{const t=new Uint8Array(e.length);n.getByteTimeDomainData(t);const r=Math.max(t.length,n.fftSize);for(let i=0;i<r;i+=1)e[i]=(t[i]-128)*.0078125;return e}},s8e=(n,e)=>(t,r)=>{const i=t.createAnalyser();if(yc(i,r),!(r.maxDecibels>r.minDecibels))throw e();return Io(i,r,"fftSize"),Io(i,r,"maxDecibels"),Io(i,r,"minDecibels"),Io(i,r,"smoothingTimeConstant"),n(fV,()=>fV(i))||i8e(i),i},o8e=n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null,pa=(n,e,t)=>{const r=e[t];r!==void 0&&r!==n[t].value&&(n[t].value=r)},a8e=n=>{n.start=(e=>{let t=!1;return(r=0,i=0,s)=>{if(t)throw Vc();e.call(n,r,i,s),t=!0}})(n.start)},i8=n=>{n.start=(e=>(t=0,r=0,i)=>{if(typeof i=="number"&&i<0||r<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(n,t,r,i)})(n.start)},s8=n=>{n.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(n,t)})(n.stop)},c8e=(n,e,t,r,i,s,o,a,c,l,u)=>(h,f)=>{const d=h.createBufferSource();return yc(d,f),pa(d,f,"playbackRate"),Io(d,f,"buffer"),Io(d,f,"loop"),Io(d,f,"loopEnd"),Io(d,f,"loopStart"),e(t,()=>t(h))||a8e(d),e(r,()=>r(h))||c(d),e(i,()=>i(h))||l(d,h),e(s,()=>s(h))||i8(d),e(o,()=>o(h))||u(d,h),e(a,()=>a(h))||s8(d),n(h,d),d},l8e=n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null,u8e=(n,e)=>(t,r,i)=>{const s=t.destination;if(s.channelCount!==r)try{s.channelCount=r}catch{}i&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:r});const o=n(t,{channelCount:r,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",a=>()=>a.call(o),a=>c=>{a.call(o,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(o,"channelCountMode",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelCountMode=c}),e(o,"channelInterpretation",a=>()=>a.call(o),a=>c=>{a.call(o,c),s.channelInterpretation=c}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o},h8e=n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null,f8e=n=>{const{port1:e}=new MessageChannel;try{e.postMessage(n)}finally{e.close()}},d8e=(n,e,t,r,i)=>(s,o,a,c,l,u)=>{if(a!==null)try{const h=new a(s,c,u),f=new Map;let d=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>d,set:p=>{typeof d=="function"&&h.removeEventListener("processorerror",d),d=typeof p=="function"?p:null,typeof d=="function"&&h.addEventListener("processorerror",d)}}}),h.addEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const _=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(_!==null){const v=f.get(m[1]);v!==void 0?m[1]=v:(m[1]=S=>{S.type==="error"?(Object.defineProperties(S,{type:{value:"processorerror"}}),_(S)):_(new ErrorEvent(m[0],{...S}))},f.set(_,m[1]))}}return p.call(h,"error",m[1],m[2]),p.call(h,...m)})(h.addEventListener),h.removeEventListener=(p=>(...m)=>{if(m[0]==="processorerror"){const _=f.get(m[1]);_!==void 0&&(f.delete(m[1]),m[1]=_)}return p.call(h,"error",m[1],m[2]),p.call(h,m[0],m[1],m[2])})(h.removeEventListener),u.numberOfOutputs!==0){const p=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(s.destination),i(h,()=>p.disconnect(),()=>p.connect(s.destination))}return h}catch(h){throw h.code===11?r():h}if(l===void 0)throw r();return f8e(u),e(s,o,l,u)},gte=(n,e)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*e))))),p8e=n=>new Promise((e,t)=>{const{port1:r,port2:i}=new MessageChannel;r.onmessage=({data:s})=>{r.close(),i.close(),e(s)},r.onmessageerror=({data:s})=>{r.close(),i.close(),t(s)},i.postMessage(n)}),m8e=async(n,e)=>{const t=await p8e(e);return new n(t)},g8e=(n,e,t,r)=>{let i=k4.get(n);i===void 0&&(i=new WeakMap,k4.set(n,i));const s=m8e(t,r);return i.set(e,s),s},_8e=(n,e,t,r,i,s,o,a,c,l,u,h,f)=>(d,p,m,_)=>{if(_.numberOfInputs===0&&_.numberOfOutputs===0)throw c();const v=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(v.some(Le=>Le<1))throw c();if(v.length!==_.numberOfOutputs)throw e();if(_.channelCountMode!=="explicit")throw c();const S=_.channelCount*_.numberOfInputs,b=v.reduce((Le,$e)=>Le+$e,0),T=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(S+T>6||b>6)throw c();const w=new MessageChannel,R=[],C=[];for(let Le=0;Le<_.numberOfInputs;Le+=1)R.push(o(d,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),C.push(i(d,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const N=[];if(m.parameterDescriptors!==void 0)for(const{defaultValue:Le,maxValue:$e,minValue:De,name:Oe}of m.parameterDescriptors){const ae=s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_.parameterData[Oe]!==void 0?_.parameterData[Oe]:Le===void 0?0:Le});Object.defineProperties(ae.offset,{defaultValue:{get:()=>Le===void 0?0:Le},maxValue:{get:()=>$e===void 0?pu:$e},minValue:{get:()=>De===void 0?ph:De}}),N.push(ae)}const U=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,S+T)}),B=gte(p,d.sampleRate),$=a(d,B,S+T,Math.max(1,b)),I=i(d,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),L=[];for(let Le=0;Le<_.numberOfOutputs;Le+=1)L.push(r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[Le]}));for(let Le=0;Le<_.numberOfInputs;Le+=1){R[Le].connect(C[Le]);for(let $e=0;$e<_.channelCount;$e+=1)C[Le].connect(U,$e,Le*_.channelCount+$e)}const P=new dte(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:Le},$e)=>{const De=N[$e];return De.connect(U,0,S+$e),De.start(0),[Le,De.offset]}));U.connect($);let H=_.channelInterpretation,X=null;const G=_.numberOfOutputs===0?[$]:L,Y={get bufferSize(){return B},get channelCount(){return _.channelCount},set channelCount(Le){throw t()},get channelCountMode(){return _.channelCountMode},set channelCountMode(Le){throw t()},get channelInterpretation(){return H},set channelInterpretation(Le){for(const $e of R)$e.channelInterpretation=Le;H=Le},get context(){return $.context},get inputs(){return R},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return X},set onprocessorerror(Le){typeof X=="function"&&Y.removeEventListener("processorerror",X),X=typeof Le=="function"?Le:null,typeof X=="function"&&Y.addEventListener("processorerror",X)},get parameters(){return P},get port(){return w.port2},addEventListener(...Le){return $.addEventListener(Le[0],Le[1],Le[2])},connect:n.bind(null,G),disconnect:l.bind(null,G),dispatchEvent(...Le){return $.dispatchEvent(Le[0])},removeEventListener(...Le){return $.removeEventListener(Le[0],Le[1],Le[2])}},J=new Map;w.port1.addEventListener=(Le=>(...$e)=>{if($e[0]==="message"){const De=typeof $e[1]=="function"?$e[1]:typeof $e[1]=="object"&&$e[1]!==null&&typeof $e[1].handleEvent=="function"?$e[1].handleEvent:null;if(De!==null){const Oe=J.get($e[1]);Oe!==void 0?$e[1]=Oe:($e[1]=ae=>{u(d.currentTime,d.sampleRate,()=>De(ae))},J.set(De,$e[1]))}}return Le.call(w.port1,$e[0],$e[1],$e[2])})(w.port1.addEventListener),w.port1.removeEventListener=(Le=>(...$e)=>{if($e[0]==="message"){const De=J.get($e[1]);De!==void 0&&(J.delete($e[1]),$e[1]=De)}return Le.call(w.port1,$e[0],$e[1],$e[2])})(w.port1.removeEventListener);let Q=null;Object.defineProperty(w.port1,"onmessage",{get:()=>Q,set:Le=>{typeof Q=="function"&&w.port1.removeEventListener("message",Q),Q=typeof Le=="function"?Le:null,typeof Q=="function"&&(w.port1.addEventListener("message",Q),w.port1.start())}}),m.prototype.port=w.port1;let z=null;g8e(d,Y,m,_).then(Le=>z=Le);const ee=kI(_.numberOfInputs,_.channelCount),te=kI(_.numberOfOutputs,v),ie=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((Le,{name:$e})=>({...Le,[$e]:new Float32Array(128)}),{});let Ee=!0;const Re=()=>{_.numberOfOutputs>0&&$.disconnect(I);for(let Le=0,$e=0;Le<_.numberOfOutputs;Le+=1){const De=L[Le];for(let Oe=0;Oe<v[Le];Oe+=1)I.disconnect(De,$e+Oe,Oe);$e+=v[Le]}},Te=new Map;$.onaudioprocess=({inputBuffer:Le,outputBuffer:$e})=>{if(z!==null){const De=h(Y);for(let Oe=0;Oe<B;Oe+=128){for(let ae=0;ae<_.numberOfInputs;ae+=1)for(let ve=0;ve<_.channelCount;ve+=1)RI(Le,ee[ae],ve,ve,Oe);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:ae},ve)=>{RI(Le,ie,ae,S+ve,Oe)});for(let ae=0;ae<_.numberOfInputs;ae+=1)for(let ve=0;ve<v[ae];ve+=1)te[ae][ve].byteLength===0&&(te[ae][ve]=new Float32Array(128));try{const ae=ee.map((xe,pe)=>{if(De[pe].size>0)return Te.set(pe,B/128),xe;const Je=Te.get(pe);return Je===void 0?[]:(xe.every(Xe=>Xe.every(et=>et===0))&&(Je===1?Te.delete(pe):Te.set(pe,Je-1)),xe)});Ee=u(d.currentTime+Oe/d.sampleRate,d.sampleRate,()=>z.process(ae,te,ie));for(let xe=0,pe=0;xe<_.numberOfOutputs;xe+=1){for(let ze=0;ze<v[xe];ze+=1)pte($e,te[xe],ze,pe+ze,Oe);pe+=v[xe]}}catch(ae){Ee=!1,Y.dispatchEvent(new ErrorEvent("processorerror",{colno:ae.colno,filename:ae.filename,lineno:ae.lineno,message:ae.message}))}if(!Ee){for(let ae=0;ae<_.numberOfInputs;ae+=1){R[ae].disconnect(C[ae]);for(let ve=0;ve<_.channelCount;ve+=1)C[Oe].disconnect(U,ve,ae*_.channelCount+ve)}if(m.parameterDescriptors!==void 0){const ae=m.parameterDescriptors.length;for(let ve=0;ve<ae;ve+=1){const xe=N[ve];xe.disconnect(U,0,S+ve),xe.stop()}}U.disconnect($),$.onaudioprocess=null,Pe?Re():ht();break}}}};let Pe=!1;const We=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),it=()=>$.connect(We).connect(d.destination),ht=()=>{$.disconnect(We),We.disconnect()},vt=()=>{if(Ee){ht(),_.numberOfOutputs>0&&$.connect(I);for(let Le=0,$e=0;Le<_.numberOfOutputs;Le+=1){const De=L[Le];for(let Oe=0;Oe<v[Le];Oe+=1)I.connect(De,$e+Oe,Oe);$e+=v[Le]}}Pe=!0},re=()=>{Ee&&(it(),Re()),Pe=!1};return it(),f(Y,vt,re)},_te=(n,e)=>{const t=n.createBiquadFilter();return yc(t,e),pa(t,e,"Q"),pa(t,e,"detune"),pa(t,e,"frequency"),pa(t,e,"gain"),Io(t,e,"type"),t},v8e=(n,e)=>(t,r)=>{const i=t.createChannelMerger(r.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&e(t,i),yc(i,r),i},y8e=n=>{const e=n.numberOfOutputs;Object.defineProperty(n,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Vc()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw Vc()}}),Object.defineProperty(n,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw Vc()}})},RC=(n,e)=>{const t=n.createChannelSplitter(e.numberOfOutputs);return yc(t,e),y8e(t),t},b8e=(n,e,t,r,i)=>(s,o)=>{if(s.createConstantSource===void 0)return t(s,o);const a=s.createConstantSource();return yc(a,o),pa(a,o,"offset"),e(r,()=>r(s))||i8(a),e(i,()=>i(s))||s8(a),n(s,a),a},tT=(n,e)=>(n.connect=e.connect.bind(e),n.disconnect=e.disconnect.bind(e),n),S8e=(n,e,t,r)=>(i,{offset:s,...o})=>{const a=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=t(i,{...o,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;const h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(p){l.channelCount=p},get channelCountMode(){return l.channelCountMode},set channelCountMode(p){l.channelCountMode=p},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(p){l.channelInterpretation=p},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(p){c.onended=p},addEventListener(...p){return c.addEventListener(p[0],p[1],p[2])},dispatchEvent(...p){return c.dispatchEvent(p[0])},removeEventListener(...p){return c.removeEventListener(p[0],p[1],p[2])},start(p=0){c.start.call(c,p)},stop(p=0){c.stop.call(c,p)}},f=()=>c.connect(l),d=()=>c.disconnect(l);return n(i,c),r(tT(h,l),f,d)},E8e=(n,e)=>(t,r)=>{const i=t.createConvolver();if(yc(i,r),r.disableNormalization===i.normalize&&(i.normalize=!r.disableNormalization),Io(i,r,"buffer"),r.channelCount>2||(e(i,"channelCount",s=>()=>s.call(i),s=>o=>{if(o>2)throw n();return s.call(i,o)}),r.channelCountMode==="max"))throw n();return e(i,"channelCountMode",s=>()=>s.call(i),s=>o=>{if(o==="max")throw n();return s.call(i,o)}),i},vte=(n,e)=>{const t=n.createDelay(e.maxDelayTime);return yc(t,e),pa(t,e,"delayTime"),t},x8e=n=>(e,t)=>{const r=e.createDynamicsCompressor();if(yc(r,t),t.channelCount>2||t.channelCountMode==="max")throw n();return pa(r,t,"attack"),pa(r,t,"knee"),pa(r,t,"ratio"),pa(r,t,"release"),pa(r,t,"threshold"),r},Nh=(n,e)=>{const t=n.createGain();return yc(t,e),pa(t,e,"gain"),t},T8e=n=>(e,t,r)=>{if(e.createIIRFilter===void 0)return n(e,t,r);const i=e.createIIRFilter(r.feedforward,r.feedback);return yc(i,r),i};function w8e(n,e){const t=e[0]*e[0]+e[1]*e[1];return[(n[0]*e[0]+n[1]*e[1])/t,(n[1]*e[0]-n[0]*e[1])/t]}function A8e(n,e){return[n[0]*e[0]-n[1]*e[1],n[0]*e[1]+n[1]*e[0]]}function dV(n,e){let t=[0,0];for(let r=n.length-1;r>=0;r-=1)t=A8e(t,e),t[0]+=n[r];return t}const C8e=(n,e,t,r)=>(i,s,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{const h=gte(s,i.sampleRate),f=l instanceof Float64Array?l:new Float64Array(l),d=u instanceof Float64Array?u:new Float64Array(u),p=f.length,m=d.length,_=Math.min(p,m);if(p===0||p>20)throw r();if(f[0]===0)throw e();if(m===0||m>20)throw r();if(d[0]===0)throw e();if(f[0]!==1){for(let N=0;N<m;N+=1)d[N]/=f[0];for(let N=1;N<p;N+=1)f[N]/=f[0]}const v=t(i,h,o,o);v.channelCount=o,v.channelCountMode=a,v.channelInterpretation=c;const S=32,b=[],T=[],w=[];for(let N=0;N<o;N+=1){b.push(0);const U=new Float32Array(S),B=new Float32Array(S);U.fill(0),B.fill(0),T.push(U),w.push(B)}v.onaudioprocess=N=>{const U=N.inputBuffer,B=N.outputBuffer,$=U.numberOfChannels;for(let I=0;I<$;I+=1){const L=U.getChannelData(I),P=B.getChannelData(I);b[I]=mte(f,p,d,m,_,T[I],w[I],b[I],S,L,P)}};const R=i.sampleRate/2;return tT({get bufferSize(){return h},get channelCount(){return v.channelCount},set channelCount(N){v.channelCount=N},get channelCountMode(){return v.channelCountMode},set channelCountMode(N){v.channelCountMode=N},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(N){v.channelInterpretation=N},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener(...N){return v.addEventListener(N[0],N[1],N[2])},dispatchEvent(...N){return v.dispatchEvent(N[0])},getFrequencyResponse(N,U,B){if(N.length!==U.length||U.length!==B.length)throw n();const $=N.length;for(let I=0;I<$;I+=1){const L=-Math.PI*(N[I]/R),P=[Math.cos(L),Math.sin(L)],H=dV(d,P),X=dV(f,P),G=w8e(H,X);U[I]=Math.sqrt(G[0]*G[0]+G[1]*G[1]),B[I]=Math.atan2(G[1],G[0])}},removeEventListener(...N){return v.removeEventListener(N[0],N[1],N[2])}},v)},R8e=(n,e)=>n.createMediaElementSource(e.mediaElement),k8e=(n,e)=>{const t=n.createMediaStreamDestination();return yc(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t},M8e=(n,{mediaStream:e})=>{const t=e.getAudioTracks();t.sort((s,o)=>s.id<o.id?-1:s.id>o.id?1:0);const r=t.slice(0,1),i=n.createMediaStreamSource(new MediaStream(r));return Object.defineProperty(i,"mediaStream",{value:e}),i},I8e=(n,e)=>(t,{mediaStreamTrack:r})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(r);const i=new MediaStream([r]),s=t.createMediaStreamSource(i);if(r.kind!=="audio")throw n();if(e(t))throw new TypeError;return s},O8e=n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null,N8e=(n,e,t,r,i,s)=>(o,a)=>{const c=o.createOscillator();return yc(c,a),pa(c,a,"detune"),pa(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Io(c,a,"type"),e(t,()=>t(o))||i8(c),e(r,()=>r(o))||s(c,o),e(i,()=>i(o))||s8(c),n(o,c),c},P8e=n=>(e,t)=>{const r=e.createPanner();return r.orientationX===void 0?n(e,t):(yc(r,t),pa(r,t,"orientationX"),pa(r,t,"orientationY"),pa(r,t,"orientationZ"),pa(r,t,"positionX"),pa(r,t,"positionY"),pa(r,t,"positionZ"),Io(r,t,"coneInnerAngle"),Io(r,t,"coneOuterAngle"),Io(r,t,"coneOuterGain"),Io(r,t,"distanceModel"),Io(r,t,"maxDistance"),Io(r,t,"panningModel"),Io(r,t,"refDistance"),Io(r,t,"rolloffFactor"),r)},D8e=(n,e,t,r,i,s,o,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:f,coneOuterGain:d,distanceModel:p,maxDistance:m,orientationX:_,orientationY:v,orientationZ:S,panningModel:b,positionX:T,positionY:w,positionZ:R,refDistance:C,rolloffFactor:N,...U})=>{const B=u.createPanner();if(U.channelCount>2||U.channelCountMode==="max")throw o();yc(B,U);const $={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},I=t(u,{...$,channelInterpretation:"speakers",numberOfInputs:6}),L=r(u,{...U,gain:1}),P=r(u,{...$,gain:1}),H=r(u,{...$,gain:0}),X=r(u,{...$,gain:0}),G=r(u,{...$,gain:0}),Y=r(u,{...$,gain:0}),J=r(u,{...$,gain:0}),Q=i(u,256,6,1),z=s(u,{...$,curve:new Float32Array([1,1]),oversample:"none"});let q=[_,v,S],ee=[T,w,R];const te=new Float32Array(1);Q.onaudioprocess=({inputBuffer:Te})=>{const Pe=[c(Te,te,0),c(Te,te,1),c(Te,te,2)];Pe.some((it,ht)=>it!==q[ht])&&(B.setOrientation(...Pe),q=Pe);const We=[c(Te,te,3),c(Te,te,4),c(Te,te,5)];We.some((it,ht)=>it!==ee[ht])&&(B.setPosition(...We),ee=We)},Object.defineProperty(H.gain,"defaultValue",{get:()=>0}),Object.defineProperty(X.gain,"defaultValue",{get:()=>0}),Object.defineProperty(G.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Y.gain,"defaultValue",{get:()=>0}),Object.defineProperty(J.gain,"defaultValue",{get:()=>0});const ie={get bufferSize(){},get channelCount(){return B.channelCount},set channelCount(Te){if(Te>2)throw o();L.channelCount=Te,B.channelCount=Te},get channelCountMode(){return B.channelCountMode},set channelCountMode(Te){if(Te==="max")throw o();L.channelCountMode=Te,B.channelCountMode=Te},get channelInterpretation(){return B.channelInterpretation},set channelInterpretation(Te){L.channelInterpretation=Te,B.channelInterpretation=Te},get coneInnerAngle(){return B.coneInnerAngle},set coneInnerAngle(Te){B.coneInnerAngle=Te},get coneOuterAngle(){return B.coneOuterAngle},set coneOuterAngle(Te){B.coneOuterAngle=Te},get coneOuterGain(){return B.coneOuterGain},set coneOuterGain(Te){if(Te<0||Te>1)throw e();B.coneOuterGain=Te},get context(){return B.context},get distanceModel(){return B.distanceModel},set distanceModel(Te){B.distanceModel=Te},get inputs(){return[L]},get maxDistance(){return B.maxDistance},set maxDistance(Te){if(Te<0)throw new RangeError;B.maxDistance=Te},get numberOfInputs(){return B.numberOfInputs},get numberOfOutputs(){return B.numberOfOutputs},get orientationX(){return P.gain},get orientationY(){return H.gain},get orientationZ(){return X.gain},get panningModel(){return B.panningModel},set panningModel(Te){B.panningModel=Te},get positionX(){return G.gain},get positionY(){return Y.gain},get positionZ(){return J.gain},get refDistance(){return B.refDistance},set refDistance(Te){if(Te<0)throw new RangeError;B.refDistance=Te},get rolloffFactor(){return B.rolloffFactor},set rolloffFactor(Te){if(Te<0)throw new RangeError;B.rolloffFactor=Te},addEventListener(...Te){return L.addEventListener(Te[0],Te[1],Te[2])},dispatchEvent(...Te){return L.dispatchEvent(Te[0])},removeEventListener(...Te){return L.removeEventListener(Te[0],Te[1],Te[2])}};h!==ie.coneInnerAngle&&(ie.coneInnerAngle=h),f!==ie.coneOuterAngle&&(ie.coneOuterAngle=f),d!==ie.coneOuterGain&&(ie.coneOuterGain=d),p!==ie.distanceModel&&(ie.distanceModel=p),m!==ie.maxDistance&&(ie.maxDistance=m),_!==ie.orientationX.value&&(ie.orientationX.value=_),v!==ie.orientationY.value&&(ie.orientationY.value=v),S!==ie.orientationZ.value&&(ie.orientationZ.value=S),b!==ie.panningModel&&(ie.panningModel=b),T!==ie.positionX.value&&(ie.positionX.value=T),w!==ie.positionY.value&&(ie.positionY.value=w),R!==ie.positionZ.value&&(ie.positionZ.value=R),C!==ie.refDistance&&(ie.refDistance=C),N!==ie.rolloffFactor&&(ie.rolloffFactor=N),(q[0]!==1||q[1]!==0||q[2]!==0)&&B.setOrientation(...q),(ee[0]!==0||ee[1]!==0||ee[2]!==0)&&B.setPosition(...ee);const Ee=()=>{L.connect(B),n(L,z,0,0),z.connect(P).connect(I,0,0),z.connect(H).connect(I,0,1),z.connect(X).connect(I,0,2),z.connect(G).connect(I,0,3),z.connect(Y).connect(I,0,4),z.connect(J).connect(I,0,5),I.connect(Q).connect(u.destination)},Re=()=>{L.disconnect(B),a(L,z,0,0),z.disconnect(P),P.disconnect(I),z.disconnect(H),H.disconnect(I),z.disconnect(X),X.disconnect(I),z.disconnect(G),G.disconnect(I),z.disconnect(Y),Y.disconnect(I),z.disconnect(J),J.disconnect(I),I.disconnect(Q),Q.disconnect(u.destination)};return l(tT(ie,B),Ee,Re)},L8e=n=>(e,{disableNormalization:t,imag:r,real:i})=>{const s=r instanceof Float32Array?r:new Float32Array(r),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,s,{disableNormalization:t});if(Array.from(r).length<2)throw n();return a},kC=(n,e,t,r)=>n.createScriptProcessor(e,t,r),U8e=(n,e)=>(t,r)=>{const i=r.channelCountMode;if(i==="clamped-max")throw e();if(t.createStereoPanner===void 0)return n(t,r);const s=t.createStereoPanner();return yc(s,r),pa(s,r,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>i,set:o=>{if(o!==i)throw e()}}),s},B8e=(n,e,t,r,i,s)=>{const a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(p,m,_,v)=>{const S=new Float32Array(16385),b=new Float32Array(16385);for(let U=0;U<16385;U+=1){const B=U/16384*c;S[U]=Math.cos(B),b[U]=Math.sin(B)}const T=t(p,{...l,gain:0}),w=r(p,{...u,curve:S}),R=r(p,{...u,curve:a}),C=t(p,{...l,gain:0}),N=r(p,{...u,curve:b});return{connectGraph(){m.connect(T),m.connect(R.inputs===void 0?R:R.inputs[0]),m.connect(C),R.connect(_),_.connect(w.inputs===void 0?w:w.inputs[0]),_.connect(N.inputs===void 0?N:N.inputs[0]),w.connect(T.gain),N.connect(C.gain),T.connect(v,0,0),C.connect(v,0,1)},disconnectGraph(){m.disconnect(T),m.disconnect(R.inputs===void 0?R:R.inputs[0]),m.disconnect(C),R.disconnect(_),_.disconnect(w.inputs===void 0?w:w.inputs[0]),_.disconnect(N.inputs===void 0?N:N.inputs[0]),w.disconnect(T.gain),N.disconnect(C.gain),T.disconnect(v,0,0),C.disconnect(v,0,1)}}},f=(p,m,_,v)=>{const S=new Float32Array(16385),b=new Float32Array(16385),T=new Float32Array(16385),w=new Float32Array(16385),R=Math.floor(16385/2);for(let G=0;G<16385;G+=1)if(G>R){const Y=(G-R)/(16384-R)*c;S[G]=Math.cos(Y),b[G]=Math.sin(Y),T[G]=0,w[G]=1}else{const Y=G/(16384-R)*c;S[G]=1,b[G]=0,T[G]=Math.cos(Y),w[G]=Math.sin(Y)}const C=e(p,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),N=t(p,{...l,gain:0}),U=r(p,{...u,curve:S}),B=t(p,{...l,gain:0}),$=r(p,{...u,curve:b}),I=r(p,{...u,curve:a}),L=t(p,{...l,gain:0}),P=r(p,{...u,curve:T}),H=t(p,{...l,gain:0}),X=r(p,{...u,curve:w});return{connectGraph(){m.connect(C),m.connect(I.inputs===void 0?I:I.inputs[0]),C.connect(N,0),C.connect(B,0),C.connect(L,1),C.connect(H,1),I.connect(_),_.connect(U.inputs===void 0?U:U.inputs[0]),_.connect($.inputs===void 0?$:$.inputs[0]),_.connect(P.inputs===void 0?P:P.inputs[0]),_.connect(X.inputs===void 0?X:X.inputs[0]),U.connect(N.gain),$.connect(B.gain),P.connect(L.gain),X.connect(H.gain),N.connect(v,0,0),L.connect(v,0,0),B.connect(v,0,1),H.connect(v,0,1)},disconnectGraph(){m.disconnect(C),m.disconnect(I.inputs===void 0?I:I.inputs[0]),C.disconnect(N,0),C.disconnect(B,0),C.disconnect(L,1),C.disconnect(H,1),I.disconnect(_),_.disconnect(U.inputs===void 0?U:U.inputs[0]),_.disconnect($.inputs===void 0?$:$.inputs[0]),_.disconnect(P.inputs===void 0?P:P.inputs[0]),_.disconnect(X.inputs===void 0?X:X.inputs[0]),U.disconnect(N.gain),$.disconnect(B.gain),P.disconnect(L.gain),X.disconnect(H.gain),N.disconnect(v,0,0),L.disconnect(v,0,0),B.disconnect(v,0,1),H.disconnect(v,0,1)}}},d=(p,m,_,v,S)=>{if(m===1)return h(p,_,v,S);if(m===2)return f(p,_,v,S);throw i()};return(p,{channelCount:m,channelCountMode:_,pan:v,...S})=>{if(_==="max")throw i();const b=n(p,{...S,channelCount:1,channelCountMode:_,numberOfInputs:2}),T=t(p,{...S,channelCount:m,channelCountMode:_,gain:1}),w=t(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:v});let{connectGraph:R,disconnectGraph:C}=d(p,m,T,w,b);Object.defineProperty(w.gain,"defaultValue",{get:()=>0}),Object.defineProperty(w.gain,"maxValue",{get:()=>1}),Object.defineProperty(w.gain,"minValue",{get:()=>-1});const N={get bufferSize(){},get channelCount(){return T.channelCount},set channelCount(I){T.channelCount!==I&&(U&&C(),{connectGraph:R,disconnectGraph:C}=d(p,I,T,w,b),U&&R()),T.channelCount=I},get channelCountMode(){return T.channelCountMode},set channelCountMode(I){if(I==="clamped-max"||I==="max")throw i();T.channelCountMode=I},get channelInterpretation(){return T.channelInterpretation},set channelInterpretation(I){T.channelInterpretation=I},get context(){return T.context},get inputs(){return[T]},get numberOfInputs(){return T.numberOfInputs},get numberOfOutputs(){return T.numberOfOutputs},get pan(){return w.gain},addEventListener(...I){return T.addEventListener(I[0],I[1],I[2])},dispatchEvent(...I){return T.dispatchEvent(I[0])},removeEventListener(...I){return T.removeEventListener(I[0],I[1],I[2])}};let U=!1;const B=()=>{R(),U=!0},$=()=>{C(),U=!1};return s(tT(N,b),B,$)}},F8e=(n,e,t,r,i,s,o)=>(a,c)=>{const l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);yc(l,c);const u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Io(l,{curve:u},"curve"),Io(l,c,"oversample");let h=null,f=!1;return o(l,"curve",m=>()=>m.call(l),m=>_=>(m.call(l,_),f&&(r(_)&&h===null?h=n(a,l):!r(_)&&h!==null&&(h(),h=null)),_)),i(l,()=>{f=!0,r(l.curve)&&(h=n(a,l))},()=>{f=!1,h!==null&&(h(),h=null)})},j8e=(n,e,t,r,i)=>(s,{curve:o,oversample:a,...c})=>{const l=s.createWaveShaper(),u=s.createWaveShaper();yc(l,c),yc(u,c);const h=t(s,{...c,gain:1}),f=t(s,{...c,gain:-1}),d=t(s,{...c,gain:1}),p=t(s,{...c,gain:-1});let m=null,_=!1,v=null;const S={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(w){h.channelCount=w,f.channelCount=w,l.channelCount=w,d.channelCount=w,u.channelCount=w,p.channelCount=w},get channelCountMode(){return l.channelCountMode},set channelCountMode(w){h.channelCountMode=w,f.channelCountMode=w,l.channelCountMode=w,d.channelCountMode=w,u.channelCountMode=w,p.channelCountMode=w},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(w){h.channelInterpretation=w,f.channelInterpretation=w,l.channelInterpretation=w,d.channelInterpretation=w,u.channelInterpretation=w,p.channelInterpretation=w},get context(){return l.context},get curve(){return v},set curve(w){if(w!==null&&w.length<2)throw e();if(w===null)l.curve=w,u.curve=w;else{const R=w.length,C=new Float32Array(R+2-R%2),N=new Float32Array(R+2-R%2);C[0]=w[0],N[0]=-w[R-1];const U=Math.ceil((R+1)/2),B=(R+1)/2-1;for(let $=1;$<U;$+=1){const I=$/U*B,L=Math.floor(I),P=Math.ceil(I);C[$]=L===P?w[L]:(1-(I-L))*w[L]+(1-(P-I))*w[P],N[$]=L===P?-w[R-1-L]:-((1-(I-L))*w[R-1-L])-(1-(P-I))*w[R-1-P]}C[U]=R%2===1?w[U-1]:(w[U-2]+w[U-1])/2,l.curve=C,u.curve=N}v=w,_&&(r(v)&&m===null?m=n(s,h):m!==null&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(w){l.oversample=w,u.oversample=w},addEventListener(...w){return h.addEventListener(w[0],w[1],w[2])},dispatchEvent(...w){return h.dispatchEvent(w[0])},removeEventListener(...w){return h.removeEventListener(w[0],w[1],w[2])}};o!==null&&(S.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==S.oversample&&(S.oversample=a);const b=()=>{h.connect(l).connect(d),h.connect(f).connect(u).connect(p).connect(d),_=!0,r(v)&&(m=n(s,h))},T=()=>{h.disconnect(l),l.disconnect(d),h.disconnect(f),f.disconnect(u),u.disconnect(p),p.disconnect(d),_=!1,m!==null&&(m(),m=null)};return i(tT(S,d),b,T)},ku=()=>new DOMException("","NotSupportedError"),z8e={numberOfChannels:1},$8e=(n,e,t,r,i)=>class extends n{constructor(o,a,c){let l;if(typeof o=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:o,sampleRate:c};else if(typeof o=="object")l=o;else throw new Error("The given parameters are not valid.");const{length:u,numberOfChannels:h,sampleRate:f}={...z8e,...l},d=r(h,u,f);e(NA,()=>NA(d))||d.addEventListener("statechange",(()=>{let p=0;const m=_=>{this._state==="running"&&(p>0?(d.removeEventListener("statechange",m),_.stopImmediatePropagation(),this._waitForThePromiseToSettle(_)):p+=1)};return m})()),super(d,h),this._length=u,this._nativeOfflineAudioContext=d,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,lte(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}},V8e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},H8e=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...V8e,...l},f=t(u,h),d=s(u),p=d?r():null,m=c.sampleRate/2;super(c,!1,f,p),this._detune=e(this,d,f.detune,153600,-153600),this._frequency=e(this,d,f.frequency,m,-m),this._nativeOscillatorNode=f,this._onended=null,this._oscillatorNodeRenderer=p,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const l=typeof c=="function"?o(this,c):null;this._nativeOscillatorNode.onended=l;const u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){kx(this);const l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),q0(this)&&wC(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},G8e=(n,e,t,r,i)=>()=>{const s=new WeakMap;let o=null,a=null,c=null;const l=async(u,h)=>{let f=t(u);const d=ql(f,h);if(!d){const p={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:o===null?void 0:o,type:f.type};f=e(h,p),a!==null&&f.start(a),c!==null&&f.stop(c)}return s.set(h,f),d?(await n(h,u.detune,f.detune),await n(h,u.frequency,f.frequency)):(await r(h,u.detune,f.detune),await r(h,u.frequency,f.frequency)),await i(u,h,f),f};return{set periodicWave(u){o=u},set start(u){a=u},set stop(u){c=u},render(u,h){const f=s.get(h);return f!==void 0?Promise.resolve(f):l(u,h)}}},W8e={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},q8e=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...W8e,...l},f=t(u,h),d=s(u),p=d?r():null;super(c,!1,f,p),this._nativePannerNode=f,this._orientationX=e(this,d,f.orientationX,pu,ph),this._orientationY=e(this,d,f.orientationY,pu,ph),this._orientationZ=e(this,d,f.orientationZ,pu,ph),this._positionX=e(this,d,f.positionX,pu,ph),this._positionY=e(this,d,f.positionY,pu,ph),this._positionZ=e(this,d,f.positionZ,pu,ph),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},Y8e=(n,e,t,r,i,s,o,a,c,l)=>()=>{const u=new WeakMap;let h=null;const f=async(d,p)=>{let m=null,_=s(d);const v={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},S={...v,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},b=ql(_,p);if("bufferSize"in _)m=r(p,{...v,gain:1});else if(!b){const T={...S,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=i(p,T)}if(u.set(p,m===null?_:m),m!==null){if(h===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const $=new o(6,d.context.length,p.sampleRate),I=e($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});I.connect($.destination),h=(async()=>{const L=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(async(P,H)=>{const X=t($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:H===0?1:0});return await a($,P,X.offset),X}));for(let P=0;P<6;P+=1)L[P].connect(I,0,P),L[P].start(0);return l($)})()}const T=await h,w=r(p,{...v,gain:1});await c(d,p,w);const R=[];for(let $=0;$<T.numberOfChannels;$+=1)R.push(T.getChannelData($));let C=[R[0][0],R[1][0],R[2][0]],N=[R[3][0],R[4][0],R[5][0]],U=r(p,{...v,gain:1}),B=i(p,{...S,orientationX:C[0],orientationY:C[1],orientationZ:C[2],positionX:N[0],positionY:N[1],positionZ:N[2]});w.connect(U).connect(B.inputs[0]),B.connect(m);for(let $=128;$<T.length;$+=128){const I=[R[0][$],R[1][$],R[2][$]],L=[R[3][$],R[4][$],R[5][$]];if(I.some((P,H)=>P!==C[H])||L.some((P,H)=>P!==N[H])){C=I,N=L;const P=$/p.sampleRate;U.gain.setValueAtTime(0,P),U=r(p,{...v,gain:0}),B=i(p,{...S,orientationX:C[0],orientationY:C[1],orientationZ:C[2],positionX:N[0],positionY:N[1],positionZ:N[2]}),U.gain.setValueAtTime(1,P),w.connect(U).connect(B.inputs[0]),B.connect(m)}}return m}return b?(await n(p,d.orientationX,_.orientationX),await n(p,d.orientationY,_.orientationY),await n(p,d.orientationZ,_.orientationZ),await n(p,d.positionX,_.positionX),await n(p,d.positionY,_.positionY),await n(p,d.positionZ,_.positionZ)):(await a(p,d.orientationX,_.orientationX),await a(p,d.orientationY,_.orientationY),await a(p,d.orientationZ,_.orientationZ),await a(p,d.positionX,_.positionX),await a(p,d.positionY,_.positionY),await a(p,d.positionZ,_.positionZ)),eT(_)?await c(d,p,_.inputs[0]):await c(d,p,_),_};return{render(d,p){const m=u.get(p);return m!==void 0?Promise.resolve(m):f(d,p)}}},K8e={disableNormalization:!1},X8e=(n,e,t,r)=>class yte{constructor(s,o){const a=e(s),c=r({...K8e,...o}),l=n(a,c);return t.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===yte.prototype||t.has(s)}},Z8e=(n,e)=>(t,r,i)=>(n(r).replay(i),e(r,t,i)),J8e=(n,e,t)=>async(r,i,s)=>{const o=n(r);await Promise.all(o.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{const f=await e(l).render(l,i),d=r.context.destination;!t(l)&&(r!==d||!t(r))&&f.connect(s,u,c)})).reduce((a,c)=>[...a,...c],[]))},Q8e=(n,e,t)=>async(r,i,s)=>{const o=e(r);await Promise.all(Array.from(o.activeInputs).map(async([a,c])=>{const u=await n(a).render(a,i);t(a)||u.connect(s,c)}))},eBe=(n,e,t,r)=>i=>n(NA,()=>NA(i))?Promise.resolve(n(r,r)).then(s=>{if(!s){const o=t(i,512,0,1);i.oncomplete=()=>{o.onaudioprocess=null,o.disconnect()},o.onaudioprocess=()=>i.currentTime,o.connect(i.destination)}return i.startRendering()}):new Promise(s=>{const o=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=a=>{o.disconnect(),s(a.renderedBuffer)},o.connect(i.destination),i.startRendering()}),tBe=n=>(e,t)=>{n.set(e,t)},nBe=n=>(e,t)=>n.set(e,t),rBe=(n,e,t,r,i,s,o,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(r(l)).map(u=>t(u).render(u,l)))).then(()=>i(l)).then(u=>(typeof u.copyFromChannel!="function"?(o(u),t8(u)):e(s,()=>s(u))||a(u),n.add(u),u)),iBe={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},sBe=(n,e,t,r,i,s)=>class extends n{constructor(a,c){const l=i(a),u={...iBe,...c},h=t(l,u),f=s(l),d=f?r():null;super(a,!1,h,d),this._pan=e(this,f,h.pan)}get pan(){return this._pan}},oBe=(n,e,t,r,i)=>()=>{const s=new WeakMap,o=async(a,c)=>{let l=t(a);const u=ql(l,c);if(!u){const h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,h)}return s.set(c,l),u?await n(c,a.pan,l.pan):await r(c,a.pan,l.pan),eT(l)?await i(a,c,l.inputs[0]):await i(a,c,l),l};return{render(a,c){const l=s.get(c);return l!==void 0?Promise.resolve(l):o(a,c)}}},aBe=n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0},cBe=(n,e)=>async()=>{if(n===null)return!0;if(e===null)return!1;const t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),r=new e(1,128,44100),i=URL.createObjectURL(t);let s=!1,o=!1;try{await r.audioWorklet.addModule(i);const a=new n(r,"a",{numberOfOutputs:0}),c=r.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>o=!0,c.connect(a),c.start(0),await r.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(i)}return s&&!o},lBe=(n,e)=>()=>{if(e===null)return Promise.resolve(!1);const t=new e(1,1,44100),r=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{t.oncomplete=()=>{r.disconnect(),i(t.currentTime!==0)},t.startRendering()})},uBe=()=>new DOMException("","UnknownError"),hBe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},fBe=(n,e,t,r,i,s,o)=>class extends n{constructor(c,l){const u=i(c),h={...hBe,...l},f=t(u,h),p=s(u)?r():null;super(c,!0,f,p),this._isCurveNullified=!1,this._nativeWaveShaperNode=f,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},dBe=(n,e,t)=>()=>{const r=new WeakMap,i=async(s,o)=>{let a=e(s);if(!ql(a,o)){const l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=n(o,l)}return r.set(o,a),eT(a)?await t(s,o,a.inputs[0]):await t(s,o,a),a};return{render(s,o){const a=r.get(o);return a!==void 0?Promise.resolve(a):i(s,o)}}},pBe=()=>typeof window>"u"?null:window,mBe=(n,e)=>t=>{t.copyFromChannel=(r,i,s=0)=>{const o=n(s),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)r[h]=l[h+o]},t.copyToChannel=(r,i,s=0)=>{const o=n(s),a=n(i);if(a>=t.numberOfChannels)throw e();const c=t.length,l=t.getChannelData(a),u=r.length;for(let h=o<0?-o:0;h+o<c&&h<u;h+=1)l[h+o]=r[h]}},gBe=n=>e=>{e.copyFromChannel=(t=>(r,i,s=0)=>{const o=n(s),a=n(i);if(o<e.length)return t.call(e,r,a,o)})(e.copyFromChannel),e.copyToChannel=(t=>(r,i,s=0)=>{const o=n(s),a=n(i);if(o<e.length)return t.call(e,r,a,o)})(e.copyToChannel)},_Be=n=>(e,t)=>{const r=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=r),n(e,"buffer",i=>()=>{const s=i.call(e);return s===r?null:s},i=>s=>i.call(e,s===null?r:s))},vBe=(n,e)=>(t,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=t.createBufferSource();e(r,()=>{const a=r.numberOfInputs;for(let c=0;c<a;c+=1)i.connect(r,0,c)},()=>i.disconnect(r))},bte=(n,e,t)=>n.copyFromChannel===void 0?n.getChannelData(t)[0]:(n.copyFromChannel(e,t),e[0]),Ste=n=>{if(n===null)return!1;const e=n.length;return e%2!==0?n[Math.floor(e/2)]!==0:n[e/2-1]+n[e/2]!==0},MC=(n,e,t,r)=>{let i=n;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,{get:t(s),set:r(o)})},yBe=n=>({...n,outputChannelCount:n.outputChannelCount!==void 0?n.outputChannelCount:n.numberOfInputs===1&&n.numberOfOutputs===1?[n.channelCount]:Array.from({length:n.numberOfOutputs},()=>1)}),bBe=n=>({...n,channelCount:n.numberOfOutputs}),SBe=n=>{const{imag:e,real:t}=n;return e===void 0?t===void 0?{...n,imag:[0,0],real:[0,0]}:{...n,imag:Array.from(t,()=>0),real:t}:t===void 0?{...n,imag:e,real:Array.from(e,()=>0)}:{...n,imag:e,real:t}},Ete=(n,e,t)=>{try{n.setValueAtTime(e,t)}catch(r){if(r.code!==9)throw r;Ete(n,e,t+1e-7)}},EBe=n=>{const e=n.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},xBe=n=>{const e=n.createBufferSource(),t=n.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0},TBe=n=>{const e=n.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},o8=n=>{const e=n.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1},xte=n=>{const e=n.createBuffer(1,1,44100),t=n.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}},a8=n=>{const e=n.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1},wBe=n=>{const{port1:e,port2:t}=new MessageChannel;try{e.postMessage(n)}finally{e.close(),t.close()}},ABe=n=>{n.start=(e=>(t=0,r=0,i)=>{const s=n.buffer,o=s===null?r:Math.min(s.duration,r);s!==null&&o>s.duration-.5/n.context.sampleRate?e.call(n,t,0,0):e.call(n,t,o,i)})(n.start)},Tte=(n,e)=>{const t=e.createGain();n.connect(t);const r=(i=>()=>{i.call(n,t),n.removeEventListener("ended",r)})(n.disconnect);n.addEventListener("ended",r),tT(n,t),n.stop=(i=>{let s=!1;return(o=0)=>{if(s)try{i.call(n,o)}catch{t.gain.setValueAtTime(0,o)}else i.call(n,o),s=!0}})(n.stop)},nT=(n,e)=>t=>{const r={value:n};return Object.defineProperties(t,{currentTarget:r,target:r}),typeof e=="function"?e.call(n,t):e.handleEvent.call(n,t)},CBe=q5e(M1),RBe=Q5e(M1),kBe=hUe(l3),wte=new WeakMap,MBe=kUe(wte),Op=z6e(new Map,new WeakMap),sg=pBe(),Ate=s8e(Op,gg),c8=RUe(bu),dl=J8e(bu,c8,c1),IBe=i6e(Ate,wo,dl),uo=OUe(c3),d_=O8e(sg),js=KUe(d_),Cte=new WeakMap,Rte=SUe(nT),IC=l8e(sg),l8=GUe(IC),u8=WUe(sg),kte=qUe(sg),PA=h8e(sg),Pa=k6e(Y5e(nte),J5e(CBe,RBe,wI,kBe,AI,bu,MBe,TC,wo,M1,q0,c1,eM),Op,jUe(C4,AI,bu,wo,OA,q0),gg,u3,ku,aUe(wI,C4,bu,wo,OA,uo,q0,js),pUe(Cte,bu,Ep),Rte,uo,l8,u8,kte,js,PA),OBe=r6e(Pa,IBe,gg,Ate,uo,js),h8=new WeakSet,pV=o8e(sg),Mte=eUe(new Uint32Array(1)),f8=mBe(Mte,gg),d8=gBe(Mte),Ite=o6e(h8,Op,ku,pV,d_,aBe(pV),f8,d8),h3=e6e(Nh),Ote=Q8e(c8,AC,c1),_g=Y6e(Ote),rT=c8e(h3,Op,EBe,xBe,TBe,o8,xte,a8,ABe,_Be(MC),Tte),vg=Z8e(MUe(AC),Ote),NBe=l6e(_g,rT,wo,vg,dl),Np=M6e(K5e(rte),Cte,e8,I6e,z5e,$5e,V5e,H5e,G5e,T4,ete,IC,Ete),PBe=c6e(Pa,NBe,Np,Vc,rT,uo,js,nT),DBe=v6e(Pa,y6e,gg,Vc,u8e(Nh,MC),uo,js,dl),LBe=j6e(_g,_te,wo,vg,dl),I1=nBe(wte),UBe=F6e(Pa,Np,LBe,u3,_te,uo,js,I1),sy=r8e(M1,u8),BBe=vBe(Vc,sy),oy=v8e(IC,BBe),FBe=H6e(oy,wo,dl),jBe=V6e(Pa,FBe,oy,uo,js),zBe=q6e(RC,wo,dl),$Be=W6e(Pa,zBe,RC,uo,js,bBe),VBe=S8e(h3,rT,Nh,sy),iT=b8e(h3,Op,VBe,o8,a8),HBe=Q6e(_g,iT,wo,vg,dl),GBe=J6e(Pa,Np,HBe,iT,uo,js,nT),Nte=E8e(ku,MC),WBe=rUe(Nte,wo,dl),qBe=nUe(Pa,WBe,Nte,uo,js,I1),YBe=uUe(_g,vte,wo,vg,dl),KBe=lUe(Pa,Np,YBe,vte,uo,js,I1),Pte=x8e(ku),XBe=vUe(_g,Pte,wo,vg,dl),ZBe=_Ue(Pa,Np,XBe,Pte,ku,uo,js,I1),JBe=AUe(_g,Nh,wo,vg,dl),QBe=wUe(Pa,Np,JBe,Nh,uo,js),eFe=C8e(u3,Vc,kC,ku),f3=eBe(Op,Nh,kC,lBe(Nh,d_)),tFe=FUe(rT,wo,d_,dl,f3),nFe=T8e(eFe),rFe=UUe(Pa,nFe,tFe,uo,js,I1),iFe=b6e(Np,oy,iT,kC,ku,bte,js,MC),Dte=new WeakMap,sFe=n8e(DBe,iFe,Rte,js,Dte,nT),Lte=N8e(h3,Op,o8,xte,a8,Tte),oFe=G8e(_g,Lte,wo,vg,dl),aFe=H8e(Pa,Np,Lte,oFe,uo,js,nT),Ute=X6e(rT),cFe=j8e(Ute,Vc,Nh,Ste,sy),d3=F8e(Ute,Vc,cFe,Ste,sy,IC,MC),lFe=D8e(wI,Vc,oy,Nh,kC,d3,ku,AI,bte,sy),Bte=P8e(lFe),uFe=Y8e(_g,oy,iT,Nh,Bte,wo,d_,vg,dl,f3),hFe=q8e(Pa,Np,Bte,uFe,uo,js,I1),fFe=L8e(gg),dFe=X8e(fFe,uo,new WeakSet,SBe),pFe=B8e(oy,RC,Nh,d3,ku,sy),Fte=U8e(pFe,ku),mFe=oBe(_g,Fte,wo,vg,dl),gFe=sBe(Pa,Np,Fte,mFe,uo,js),_Fe=dBe(d3,wo,dl),vFe=fBe(Pa,Vc,d3,_Fe,uo,js,I1),jte=XUe(sg),p8=EUe(sg),zte=new WeakMap,yFe=NUe(zte,d_),bFe=jte?Z5e(Op,ku,bUe(sg),p8,xUe(W5e),uo,yFe,js,PA,new WeakMap,new WeakMap,cBe(PA,d_),sg):void 0,SFe=YUe(l8,js),EFe=oUe(h8,Op,sUe,yUe,new WeakSet,uo,SFe,xI,NA,f8,d8),$te=U6e(bFe,OBe,Ite,PBe,UBe,jBe,$Be,GBe,qBe,EFe,KBe,ZBe,QBe,rFe,sFe,aFe,hFe,dFe,gFe,vFe),xFe=ZUe(Pa,R8e,uo,js),TFe=QUe(Pa,k8e,uo,js),wFe=e8e(Pa,M8e,uo,js),AFe=I8e(Vc,js),CFe=t8e(Pa,AFe,uo),RFe=_6e($te,Vc,ku,uBe,xFe,TFe,wFe,CFe,IC),m8=PUe(Dte),kFe=t6e(m8),Vte=K6e(gg),MFe=fUe(m8),Hte=mUe(gg),Gte=new WeakMap,IFe=CUe(Gte,Ep),OFe=_8e(Vte,gg,Vc,oy,RC,iT,Nh,kC,ku,Hte,p8,IFe,sy),NFe=d8e(Vc,OFe,Nh,ku,sy),PFe=L6e(_g,Vte,rT,oy,RC,iT,Nh,MFe,Hte,p8,wo,PA,d_,vg,dl,f3),DFe=IUe(zte),LFe=tBe(Gte),mV=jte?N6e(kFe,Pa,Np,PFe,NFe,bu,DFe,uo,js,PA,yBe,LFe,wBe,nT):void 0,UFe=iUe(ku,d_),BFe=rBe(h8,Op,c8,m8,f3,xI,f8,d8),FFe=$8e($te,Op,Vc,UFe,BFe),jFe=zUe(c3,l8),zFe=$Ue(QU,u8),$Fe=VUe(e8,kte),VFe=HUe(c3,js);function yf(n){return n===void 0}function xi(n){return n!==void 0}function HFe(n){return typeof n=="function"}function xp(n){return typeof n=="number"}function Lv(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function Wte(n){return typeof n=="boolean"}function Ah(n){return Array.isArray(n)}function t_(n){return typeof n=="string"}function QR(n){return t_(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function Or(n,e){if(!n)throw new Error(e)}function cd(n,e,t=1/0){if(!(e<=n&&n<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${n}`)}function qte(n){!n.isOffline&&n.state!=="running"&&p3('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Yte=!1,gV=!1;function _V(n){Yte=n}function GFe(n){yf(n)&&Yte&&!gV&&(gV=!0,p3("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let Kte=console;function WFe(...n){Kte.log(...n)}function p3(...n){Kte.warn(...n)}function qFe(n){return new RFe(n)}function YFe(n,e,t){return new FFe(n,e,t)}const hf=typeof self=="object"?self:null,KFe=hf&&(hf.hasOwnProperty("AudioContext")||hf.hasOwnProperty("webkitAudioContext"));function XFe(n,e,t){return Or(xi(mV),"AudioWorkletNode only works in a secure context (https or localhost)"),new(n instanceof hf?.BaseAudioContext?hf?.AudioWorkletNode:mV)(n,e,t)}var O4=function(n,e){return O4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])},O4(n,e)};function m3(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");O4(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var MI=function(){return MI=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},MI.apply(this,arguments)};function Xte(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function zs(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function Zte(n,e){return function(t,r){e(t,r,n)}}function Jte(n,e,t,r,i,s){function o(v){if(v!==void 0&&typeof v!="function")throw new TypeError("Function expected");return v}for(var a=r.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,u=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,d=t.length-1;d>=0;d--){var p={};for(var m in r)p[m]=m==="access"?{}:r[m];for(var m in r.access)p.access[m]=r.access[m];p.addInitializer=function(v){if(f)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(v||null))};var _=(0,t[d])(a==="accessor"?{get:u.get,set:u.set}:u[c],p);if(a==="accessor"){if(_===void 0)continue;if(_===null||typeof _!="object")throw new TypeError("Object expected");(h=o(_.get))&&(u.get=h),(h=o(_.set))&&(u.set=h),(h=o(_.init))&&i.unshift(h)}else(h=o(_))&&(a==="field"?i.unshift(h):u[c]=h)}l&&Object.defineProperty(l,r.name,u),f=!0}function Qte(n,e,t){for(var r=arguments.length>2,i=0;i<e.length;i++)t=r?e[i].call(n,t):e[i].call(n);return r?t:void 0}function ene(n){return typeof n=="symbol"?n:"".concat(n)}function tne(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})}function nne(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function co(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function OC(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(t=0)),t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var g3=Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]});function rne(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&g3(e,n,t)}function II(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function O1(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return s}function ine(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(O1(arguments[e]));return n}function sne(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function DA(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}function Mx(n){return this instanceof Mx?(this.v=n,this):new Mx(n)}function one(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(d){return function(p){return Promise.resolve(p).then(d,h)}}function a(d,p){r[d]&&(i[d]=function(m){return new Promise(function(_,v){s.push([d,m,_,v])>1||c(d,m)})},p&&(i[d]=p(i[d])))}function c(d,p){try{l(r[d](p))}catch(m){f(s[0][3],m)}}function l(d){d.value instanceof Mx?Promise.resolve(d.value.v).then(u,h):f(s[0][2],d)}function u(d){c("next",d)}function h(d){c("throw",d)}function f(d,p){d(p),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ane(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(o){return(t=!t)?{value:Mx(n[i](o)),done:!1}:s?s(o):o}:s}}function cne(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof II=="function"?II(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,c){o=n[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function lne(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}var ZFe=Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e},N4=function(n){return N4=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},N4(n)};function une(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t=N4(n),r=0;r<t.length;r++)t[r]!=="default"&&g3(e,n,t[r]);return ZFe(e,n),e}function hne(n){return n&&n.__esModule?n:{default:n}}function fne(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function dne(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t}function pne(n,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?e===n:n.has(e)}function mne(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e}var JFe=typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r};function gne(n){function e(s){n.error=n.hasError?new JFe(s,n.error,"An error was suppressed during disposal."):s,n.hasError=!0}var t,r=0;function i(){for(;t=n.stack.pop();)try{if(!t.async&&r===1)return r=0,n.stack.push(t),Promise.resolve().then(i);if(t.dispose){var s=t.dispose.call(t.value);if(t.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return n.hasError?Promise.reject(n.error):Promise.resolve();if(n.hasError)throw n.error}return i()}function _ne(n,e){return typeof n=="string"&&/^\.\.?\//.test(n)?n.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(t,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?t:i+s+"."+o.toLowerCase()+"js"}):n}const QFe={__extends:m3,__assign:MI,__rest:Xte,__decorate:zs,__param:Zte,__esDecorate:Jte,__runInitializers:Qte,__propKey:ene,__setFunctionName:tne,__metadata:nne,__awaiter:co,__generator:OC,__createBinding:g3,__exportStar:rne,__values:II,__read:O1,__spread:ine,__spreadArrays:sne,__spreadArray:DA,__await:Mx,__asyncGenerator:one,__asyncDelegator:ane,__asyncValues:cne,__makeTemplateObject:lne,__importStar:une,__importDefault:hne,__classPrivateFieldGet:fne,__classPrivateFieldSet:dne,__classPrivateFieldIn:pne,__addDisposableResource:mne,__disposeResources:gne,__rewriteRelativeImportExtension:_ne},e7e=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:mne,get __assign(){return MI},__asyncDelegator:ane,__asyncGenerator:one,__asyncValues:cne,__await:Mx,__awaiter:co,__classPrivateFieldGet:fne,__classPrivateFieldIn:pne,__classPrivateFieldSet:dne,__createBinding:g3,__decorate:zs,__disposeResources:gne,__esDecorate:Jte,__exportStar:rne,__extends:m3,__generator:OC,__importDefault:hne,__importStar:une,__makeTemplateObject:lne,__metadata:nne,__param:Zte,__propKey:ene,__read:O1,__rest:Xte,__rewriteRelativeImportExtension:_ne,__runInitializers:Qte,__setFunctionName:tne,__spread:ine,__spreadArray:DA,__spreadArrays:sne,__values:II,default:QFe},Symbol.toStringTag,{value:"Module"}));class t7e{constructor(e,t,r,i){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=r,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),r=new Worker(t);r.onmessage=this._callback.bind(this),this._worker=r}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function l1(n){return $Fe(n)}function Uv(n){return zFe(n)}function tM(n){return VFe(n)}function bE(n){return jFe(n)}function n7e(n){return n instanceof Ite}function r7e(n,e){return n==="value"||l1(e)||Uv(e)||n7e(e)}function Bv(n,...e){if(!e.length)return n;const t=e.shift();if(Lv(n)&&Lv(t))for(const r in t)r7e(r,t[r])?n[r]=t[r]:Lv(t[r])?(n[r]||Object.assign(n,{[r]:{}}),Bv(n[r],t[r])):Object.assign(n,{[r]:t[r]});return Bv(n,...e)}function i7e(n,e){return n.length===e.length&&n.every((t,r)=>e[r]===t)}function Yn(n,e,t=[],r){const i={},s=Array.from(e);if(Lv(s[0])&&r&&!Reflect.has(s[0],r)&&(Object.keys(s[0]).some(a=>Reflect.has(n,a))||(Bv(i,{[r]:s[0]}),t.splice(t.indexOf(r),1),s.shift())),s.length===1&&Lv(s[0]))Bv(i,s[0]);else for(let o=0;o<t.length;o++)xi(s[o])&&(i[t[o]]=s[o]);return Bv(n,i)}function s7e(n){return n.constructor.getDefaults()}function Ym(n,e){return yf(n)?e:n}function Pc(n,e){return e.forEach(t=>{Reflect.has(n,t)&&delete n[t]}),n}class p_{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||hf&&this.toString()===hf.TONE_DEBUG_CLASS)&&WFe(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}p_.version=Qee;const g8=1e-6;function Ix(n,e){return n>e+g8}function P4(n,e){return Ix(n,e)||hp(n,e)}function OI(n,e){return n+g8<e}function hp(n,e){return Math.abs(n-e)<g8}function o7e(n,e,t){return Math.max(Math.min(n,t),e)}class dd extends p_{constructor(){super(),this.name="Timeline",this._timeline=[];const e=Yn(dd.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(Or(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];Or(P4(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){const t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){const r=this._search(e,t);return r!==-1?this._timeline[r]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const r=this._search(e,t);return r+1<this._timeline.length?this._timeline[r+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const r=this._search(e);return r-1>=0?this._timeline[r-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(hp(this._timeline[t].time,e)){for(let r=t;r>=0&&hp(this._timeline[r].time,e);r--)t=r;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&P4(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let r=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][t]<=e)return i-1;for(;r<s;){let o=Math.floor(r+(s-r)/2);const a=this._timeline[o],c=this._timeline[o+1];if(hp(a[t],e)){for(let l=o;l<this._timeline.length;l++){const u=this._timeline[l];if(hp(u[t],e))o=l;else break}return o}else{if(OI(a[t],e)&&Ix(c[t],e))return o;Ix(a[t],e)?s=o:r=o+1}}return-1}_iterate(e,t=0,r=this._timeline.length-1){this._timeline.slice(t,r+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const r=this._search(e);return r!==-1&&this._iterate(t,0,r),this}forEachAfter(e,t){const r=this._search(e);return this._iterate(t,r+1),this}forEachBetween(e,t,r){let i=this._search(e),s=this._search(t);return i!==-1&&s!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[s].time===t&&(s-=1),this._iterate(r,i,s)):i===-1&&this._iterate(r,0,s),this}forEachFrom(e,t){let r=this._search(e);for(;r>=0&&this._timeline[r].time>=e;)r--;return this._iterate(t,r+1),this}forEachAtTime(e,t){const r=this._search(e);if(r!==-1&&hp(this._timeline[r].time,e)){let i=r;for(let s=r;s>=0&&hp(this._timeline[s].time,e);s--)i=s;this._iterate(s=>{t(s)},i,r)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const vne=[];function _3(n){vne.push(n)}function a7e(n){vne.forEach(e=>e(n))}const yne=[];function v3(n){yne.push(n)}function c7e(n){yne.forEach(e=>e(n))}class NC extends p_{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(i=>{yf(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}),this}once(e,t){const r=(...i)=>{t(...i),this.off(e,r)};return this.on(e,r),this}off(e,t){return e.split(/\W+/).forEach(i=>{if(yf(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(yf(t))this._events[i]=[];else{const s=this._events[i];for(let o=s.length-1;o>=0;o--)s[o]===t&&s.splice(o,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const r=this._events[e].slice(0);for(let i=0,s=r.length;i<s;i++)r[i].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{const r=Object.getOwnPropertyDescriptor(NC.prototype,t);Object.defineProperty(e.prototype,t,r)})}dispose(){return super.dispose(),this._events=void 0,this}}class bne extends NC{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class sT extends bne{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new dd,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const r=Yn(sT.getDefaults(),arguments,["context"]);r.context?(this._context=r.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=qFe({latencyHint:r.latencyHint}),this._latencyHint=r.latencyHint),this._ticker=new t7e(this.emit.bind(this,"tick"),r.clockSource,r.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=r.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(a7e(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,r){return this._context.createBuffer(e,t,r)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,r){return this._context.createPeriodicWave(e,t,r)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return Or(bE(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return Or(bE(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return Or(bE(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){Or(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){Or(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){Or(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){Or(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return XFe(this.rawContext,e,t)}addAudioWorkletModule(e){return co(this,void 0,void 0,function*(){Or(xi(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return co(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return bE(this._context)?this._context.resume():Promise.resolve()}close(){return co(this,void 0,void 0,function*(){bE(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&c7e(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),r=t.getChannelData(0);for(let s=0;s<r.length;s++)r[s]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,t=>{t.callback(),this._timeouts.remove(t)})}setTimeout(e,t){this._timeoutIds++;const r=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:r+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const r=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),i()},id:r,time:s+t})};return i(),r}}class l7e extends bne{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,r){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,r){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return co(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function yi(n,e){Ah(e)?e.forEach(t=>yi(n,t)):Object.defineProperty(n,e,{enumerable:!0,writable:!1})}function PC(n,e){Ah(e)?e.forEach(t=>PC(n,t)):Object.defineProperty(n,e,{writable:!0})}const ps=()=>{};class Fs extends p_{constructor(){super(),this.name="ToneAudioBuffer",this.onload=ps;const e=Yn(Fs.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,t_(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:ps,onload:ps,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:xo().sampleRate}set(e){return e instanceof Fs?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return co(this,void 0,void 0,function*(){const t=Fs.load(e).then(r=>{this.set(r),this.onload(this)});Fs.downloads.push(t);try{yield t}finally{const r=Fs.downloads.indexOf(t);Fs.downloads.splice(r,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Ah(e)&&e[0].length>0,r=t?e.length:1,i=t?e[0].length:e.length,s=xo(),o=s.createBuffer(r,i,s.sampleRate),a=!t&&r===1?[e]:e;for(let c=0;c<r;c++)o.copyToChannel(a[c],c);return this._buffer=o,this}toMono(e){if(xp(e))this.fromArray(this.toArray(e));else{let t=new Float32Array(this.length);const r=this.numberOfChannels;for(let i=0;i<r;i++){const s=this.toArray(i);for(let o=0;o<s.length;o++)t[o]+=s[o]}t=t.map(i=>i/r),this.fromArray(t)}return this}toArray(e){if(xp(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const t=[];for(let r=0;r<this.numberOfChannels;r++)t[r]=this.getChannelData(r);return t}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){Or(this.loaded,"Buffer is not loaded");const r=Math.floor(e*this.sampleRate),i=Math.floor(t*this.sampleRate);Or(r<i,"The start time must be less than the end time");const s=i-r,o=xo().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)o.copyToChannel(this.getChannelData(a).subarray(r,i),a);return new Fs(o)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Fs().fromArray(e)}static fromUrl(e){return co(this,void 0,void 0,function*(){return yield new Fs().load(e)})}static load(e){return co(this,void 0,void 0,function*(){const t=Fs.baseUrl===""||Fs.baseUrl.endsWith("/")?Fs.baseUrl:Fs.baseUrl+"/",r=yield fetch(t+e);if(!r.ok)throw new Error(`could not load url: ${e}`);const i=yield r.arrayBuffer();return yield xo().decodeAudioData(i)})}static supportsType(e){const t=e.split("."),r=t[t.length-1];return document.createElement("audio").canPlayType("audio/"+r)!==""}static loaded(){return co(this,void 0,void 0,function*(){for(yield Promise.resolve();Fs.downloads.length;)yield Fs.downloads[0]})}}Fs.baseUrl="";Fs.downloads=[];class DC extends sT{constructor(){super({clockSource:"offline",context:tM(arguments[0])?arguments[0]:YFe(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:tM(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=tM(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return co(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const r=Math.floor(this.sampleRate/128);e&&t%r===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return co(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new Fs(t)})}close(){return Promise.resolve()}}const Sne=new l7e;let kb=Sne;function xo(){return kb===Sne&&KFe&&NI(new sT),kb}function NI(n,e=!1){e&&kb.dispose(),bE(n)?kb=new sT(n):tM(n)?kb=new DC(n):kb=n}function u7e(){return kb.resume()}if(hf&&!hf.TONE_SILENCE_LOGGING){const e=` * Tone.js v${Qee} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function Ene(n){return Math.pow(10,n/20)}function xne(n){return 20*(Math.log(n)/Math.LN10)}function Tne(n){return Math.pow(2,n/12)}let y3=440;function h7e(){return y3}function f7e(n){y3=n}function Mb(n){return Math.round(wne(n))}function wne(n){return 69+12*Math.log2(n/y3)}function Ane(n){return y3*Math.pow(2,(n-69)/12)}class _8 extends p_{constructor(e,t,r){super(),this.defaultUnits="s",this._val=t,this._units=r,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const r=parseInt(e,10),i=t==="."?1.5:1;return r===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/r)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,r)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i+=this._beatsToUnits(parseFloat(t))),r&&r!=="0"&&(i+=this._beatsToUnits(parseFloat(r)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof _8&&this.fromType(this._val),yf(this._val))return this._noArg();if(t_(this._val)&&yf(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Lv(this._val)){let e=0;for(const t in this._val)if(xi(this._val[t])){const r=this._val[t],i=new this.constructor(this.context,t).valueOf()*r;e+=i}return e}if(xi(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return t_(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class ld extends _8{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new ld(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const r=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),a=Math.round(i/r)*r-i;return i+a*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let s=1;s<9;s++){const o=Math.pow(2,s);t.push(o+"n."),t.push(o+"n"),t.push(o+"t")}t.push("0");let r=t[0],i=new ld(this.context,t[0]).toSeconds();return t.forEach(s=>{const o=new ld(this.context,s).toSeconds();Math.abs(o-e)<Math.abs(i-e)&&(r=s,i=o)}),r}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const r=Math.floor(t/this._getTimeSignature());let i=t%1*4;t=Math.floor(t)%this._getTimeSignature();const s=i.toString();return s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3))),[r,t,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Mb(this.toFrequency())}_now(){return this.context.now()}}function Lc(n,e){return new ld(xo(),n,e)}class Sh extends ld{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return h7e()}static set A4(e){f7e(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Sh.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){const i=d7e[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?i:Sh.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,r){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(i*=this._beatsToUnits(parseFloat(t))),r&&r!=="0"&&(i*=this._beatsToUnits(parseFloat(r)/4)),i}}})}transpose(e){return new Sh(this.context,this.valueOf()*Tne(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return Mb(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Sh.A4);let r=Math.round(12*t)+57;const i=Math.floor(r/12);return i<0&&(r+=-12*i),p7e[r%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return Ane(e)}static ftom(e){return Mb(e)}}const d7e={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},p7e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function vV(n,e){return new Sh(xo(),n,e)}class qE extends ld{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Vl extends p_{constructor(){super();const e=Yn(Vl.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:xo()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return GFe(e),new ld(this.context,e).toSeconds()}toFrequency(e){return new Sh(this.context,e).toFrequency()}toTicks(e){return new qE(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach(r=>{yf(e[r])&&delete t[r]}),t}get(){const e=s7e(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){const r=this[t];xi(r)&&xi(r.value)&&xi(r.setValueAtTime)?e[t]=r.value:r instanceof Vl?e[t]=r._getPartialProperties(e[t]):Ah(r)||xp(r)||t_(r)||Wte(r)?e[t]=r:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&xi(this[t])&&(this[t]&&xi(this[t].value)&&xi(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof Vl?this[t].set(e[t]):this[t]=e[t])}),this}}class LC extends dd{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,r){return cd(t,0),this.add(Object.assign({},r,{state:e,time:t})),this}getLastState(e,t){const r=this._search(t);for(let i=r;i>=0;i--){const s=this._timeline[i];if(s.state===e)return s}}getNextState(e,t){const r=this._search(t);if(r!==-1)for(let i=r;i<this._timeline.length;i++){const s=this._timeline[i];if(s.state===e)return s}}}class Zr extends Vl{constructor(){const e=Yn(Zr.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Or(xi(e.param)&&(l1(e.param)||e.param instanceof Zr),"param must be an AudioParam");!l1(e.param);)e.param=e.param._param;this._swappable=xi(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new dd(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,xi(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Vl.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return xi(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return xi(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return xi(this.maxValue)&&xi(this.minValue)&&cd(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?Ene(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?xne(e):e}setValueAtTime(e,t){const r=this.toSeconds(t),i=this._fromType(e);return Or(isFinite(i)&&isFinite(r),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,r),this._events.add({time:r,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,r),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),r=this._events.getAfter(t),i=this._events.get(t);let s=this._initialValue;if(i===null)s=this._initialValue;else if(i.type==="setTargetAtTime"&&(r===null||r.type==="setValueAtTime")){const o=this._events.getBefore(i.time);let a;o===null?a=this._initialValue:a=o.value,i.type==="setTargetAtTime"&&(s=this._exponentialApproach(i.time,a,i.value,i.constant,t))}else if(r===null)s=i.value;else if(r.type==="linearRampToValueAtTime"||r.type==="exponentialRampToValueAtTime"){let o=i.value;if(i.type==="setTargetAtTime"){const a=this._events.getBefore(i.time);a===null?o=this._initialValue:o=a.value}r.type==="linearRampToValueAtTime"?s=this._linearInterpolate(i.time,o,r.time,r.value,t):s=this._exponentialInterpolate(i.time,o,r.time,r.value,t)}else s=i.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const r=this._fromType(e),i=this.toSeconds(t);return Or(isFinite(r)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(r),this._events.add({time:i,type:"linearRampToValueAtTime",value:r}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(r,i),this}exponentialRampToValueAtTime(e,t){let r=this._fromType(e);r=hp(r,0)?this._minOutput:r,this._assertRange(r);const i=this.toSeconds(t);return Or(isFinite(r)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:r}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(r,i),this}exponentialRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialRampToValueAtTime(e,r+this.toSeconds(t)),this}linearRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.linearRampToValueAtTime(e,r+this.toSeconds(t)),this}targetRampTo(e,t,r){return r=this.toSeconds(r),this.setRampPoint(r),this.exponentialApproachValueAtTime(e,r,t),this}exponentialApproachValueAtTime(e,t,r){t=this.toSeconds(t),r=this.toSeconds(r);const i=Math.log(r+1)/Math.log(200);return this.setTargetAtTime(e,t,i),this.cancelAndHoldAtTime(t+r*.9),this.linearRampToValueAtTime(e,t+r),this}setTargetAtTime(e,t,r){const i=this._fromType(e);Or(isFinite(r)&&r>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(t);return this._assertRange(i),Or(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:r,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,s,r),this._param.setTargetAtTime(i,s,r),this}setValueCurveAtTime(e,t,r,i=1){r=this.toSeconds(r),t=this.toSeconds(t);const s=this._fromType(e[0])*i;this.setValueAtTime(this._toType(s),t);const o=r/(e.length-1);for(let a=1;a<e.length;a++){const c=this._fromType(e[a])*i;this.linearRampToValueAtTime(this._toType(c),t+a*o)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return Or(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),r=this._fromType(this.getValueAtTime(t));Or(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+r);const i=this._events.get(t),s=this._events.getAfter(t);return i&&hp(i.time,t)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(r),t):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(r),t)),this._events.add({time:t,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,t),this}rampTo(e,t=.1,r){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,r):this.linearRampTo(e,t,r),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const r=this._events.get(t);if(r&&r.type==="setTargetAtTime"){const i=this._events.getAfter(r.time),s=i?i.time:t+2,o=(s-t)/10;for(let a=t;a<s;a+=o)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){Or(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,r,i,s){return r+(t-r)*Math.exp(-(s-e)/i)}_linearInterpolate(e,t,r,i,s){return t+(i-t)*((s-e)/(r-e))}_exponentialInterpolate(e,t,r,i,s){return t*Math.pow(i/t,(s-e)/(r-e))}}class Jn extends Vl{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return xi(this.input)?l1(this.input)||this.input instanceof Zr?1:this.input.numberOfInputs:0}get numberOfOutputs(){return xi(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return xi(e)&&(e instanceof Jn||Uv(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(r=>{r.channelCount=e.channelCount,r.channelCountMode=e.channelCountMode,r.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();Or(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,r=0){return Tp(this,e,t,r),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return p3("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,r=0){return Cne(this,e,t,r),this}chain(...e){return u1(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),xi(this.input)&&(this.input instanceof Jn?this.input.dispose():Uv(this.input)&&this.input.disconnect()),xi(this.output)&&(this.output instanceof Jn?this.output.dispose():Uv(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function u1(...n){const e=n.shift();n.reduce((t,r)=>(t instanceof Jn?t.connect(r):Uv(t)&&Tp(t,r),r),e)}function Tp(n,e,t=0,r=0){for(Or(xi(n),"Cannot connect from undefined node"),Or(xi(e),"Cannot connect to undefined node"),(e instanceof Jn||Uv(e))&&Or(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Or(n.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Jn||e instanceof Zr;)xi(e.input)&&(e=e.input);for(;n instanceof Jn;)xi(n.output)&&(n=n.output);l1(e)?n.connect(e,t):n.connect(e,t,r)}function Cne(n,e,t=0,r=0){if(xi(e))for(;e instanceof Jn;)e=e.input;for(;!Uv(n);)xi(n.output)&&(n=n.output);l1(e)?n.disconnect(e,t):Uv(e)?n.disconnect(e,t,r):n.disconnect()}class $r extends Jn{constructor(){const e=Yn($r.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Zr({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),yi(this,"gain")}static getDefaults(){return Object.assign(Jn.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Ox extends Jn{constructor(e){super(e),this.onended=ps,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new $r({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const r=this.toSeconds(t);return this._startTime!==-1&&r>=this._startTime&&(this._stopTime===-1||r<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Jn.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:ps})}_startGain(e,t=1){Or(this._startTime===-1,"Source cannot be started more than once");const r=this.toSeconds(this._fadeIn);return this._startTime=e+r,this._startTime=Math.max(this._startTime,this.context.currentTime),r>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+r):this._gainNode.gain.exponentialApproachValueAtTime(t,e,r)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){Or(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const r=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+r),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==ps&&(this.onended(this),this.onended=ps,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Or(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=ps,this}}class v8 extends Ox{constructor(){const e=Yn(v8.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Tp(this._source,this._gainNode),this.offset=new Zr({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Ox.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Oi extends Jn{constructor(){const e=Yn(Oi.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new v8({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Jn.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,r=0){return b3(this,e,t,r),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,r){return this._param.exponentialRampTo(e,t,r),this}linearRampTo(e,t,r){return this._param.linearRampTo(e,t,r),this}targetRampTo(e,t,r){return this._param.targetRampTo(e,t,r),this}exponentialApproachValueAtTime(e,t,r){return this._param.exponentialApproachValueAtTime(e,t,r),this}setTargetAtTime(e,t,r){return this._param.setTargetAtTime(e,t,r),this}setValueCurveAtTime(e,t,r,i){return this._param.setValueCurveAtTime(e,t,r,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,r){return this._param.rampTo(e,t,r),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function b3(n,e,t,r){(e instanceof Zr||l1(e)||e instanceof Oi&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Oi&&(e.overridden=!0)),Tp(n,e,t,r)}class y8 extends Zr{constructor(){const e=Yn(y8.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new dd(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Zr.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,r){t=this.toSeconds(t),this.setRampPoint(t);const i=this._fromType(e),s=this._events.get(t),o=Math.round(Math.max(1/r,1));for(let a=0;a<=o;a++){const c=r*a+t,l=this._exponentialApproach(s.time,s.value,i,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){const r=this.toSeconds(t);super.setValueAtTime(e,t);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}linearRampToValueAtTime(e,t){const r=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const i=this._events.get(r),s=this._events.previousEvent(i),o=this._getTicksUntilEvent(s,r);return i.ticks=Math.max(o,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const r=this._fromType(e),i=this._events.get(t),s=Math.round(Math.max((t-i.time)*10,1)),o=(t-i.time)/s;for(let a=0;a<=s;a++){const c=o*a+i.time,l=this._exponentialInterpolate(i.time,i.value,t,r,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(yf(e.ticks)){const o=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(o,e.time)}const r=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(t));const s=this._events.get(t);return s&&s.time===t&&s.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(r+i)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),r=this._events.get(t);return Math.max(this._getTicksUntilEvent(r,t),0)}getDurationOfTicks(e,t){const r=this.toSeconds(t),i=this.getTicksAtTime(t);return this.getTimeOfTick(i+e)-r}getTimeOfTick(e){const t=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&r&&r.type==="linearRampToValueAtTime"&&t.value!==r.value){const i=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(r.time))-i)/(r.time-t.time),a=Math.sqrt(Math.pow(i,2)-2*o*(t.ticks-e)),c=(-i+a)/o,l=(-i-a)/o;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const r=this.toSeconds(t),i=this.toSeconds(e),s=this.getTicksAtTime(r);return this.getTicksAtTime(r+i)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class b8 extends Oi{constructor(){const e=Yn(b8.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new y8({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Oi.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class S8 extends Vl{constructor(){const e=Yn(S8.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new LC,this._tickOffset=new dd,this._ticksAtTime=new dd,this._secondsAtTime=new dd,this.frequency=new b8({context:this.context,units:e.units,value:e.frequency}),yi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Vl.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const r=this.toSeconds(e);return this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),xi(t)&&this.setTicksAtTime(t,r),this._ticksAtTime.cancel(r),this._secondsAtTime.cancel(r)),this}stop(e){const t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){const r=this._state.get(t);r&&r.time>0&&(this._tickOffset.cancel(r.time),this._state.cancel(r.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),r=this._state.getLastState("stopped",t),i=this._ticksAtTime.get(t),s={state:"paused",time:t};this._state.add(s);let o=i||r,a=i?i.ticks:0,c=null;return this._state.forEachBetween(o.time,t+this.sampleTime,l=>{let u=o.time;const h=this._tickOffset.get(l.time);h&&h.time>=o.time&&(a=h.ticks,u=h.time),o.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:a})),o=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),r=this.frequency.timeToTicks(e,t);this.setTicksAtTime(r,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);const i=this._secondsAtTime.get(e);let s=i||t,o=i?i.seconds:0,a=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time;const u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(o=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(o+=c.time-l,c.time!==r.time&&(a={state:c.state,time:c.time,seconds:o})),s=c}),this._state.remove(r),a&&this._secondsAtTime.add(a),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const r=this._tickOffset.get(t),i=this._state.get(t),s=Math.max(r.time,i.time),o=this.frequency.getTicksAtTime(s)+e-r.ticks;return this.frequency.getTimeOfTick(o)}forEachTickBetween(e,t,r){let i=this._state.get(e);this._state.forEachBetween(e,t,o=>{i&&i.state==="started"&&o.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),o.time-this.sampleTime,r),i=o});let s=null;if(i&&i.state==="started"){const o=Math.max(i.time,e),a=this.frequency.getTicksAtTime(o),c=this.frequency.getTicksAtTime(i.time),l=a-c;let u=Math.ceil(l)-l;u=hp(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<t;){try{r(h,Math.round(this.getTicksAtTime(h)))}catch(f){s=f;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class S3 extends Vl{constructor(){const e=Yn(S3.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=ps,this._lastUpdate=0,this._state=new LC("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new S8({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,yi(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Vl.getDefaults(),{callback:ps,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){qte(this.context);const r=this.toSeconds(e);return this.log("start",r),this._state.getValueAtTime(r)!=="started"&&(this._state.setStateAtTime("started",r),this._tickSource.start(r,t),r<this._lastUpdate&&this.emit("start",r,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const r=this.toSeconds(t),i=this.getTicksAtTime(r);return this._tickSource.getTimeOfTick(i+e,r)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,r=>{switch(r.state){case"started":const i=this._tickSource.getTicksAtTime(r.time);this.emit("start",r.time,i);break;case"stopped":r.time!==0&&this.emit("stop",r.time);break;case"paused":this.emit("pause",r.time);break}}),this._tickSource.forEachTickBetween(e,t,(r,i)=>{this.callback(r,i)}))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}NC.mixin(S3);class Nx extends Jn{constructor(){const e=Yn(Nx.getDefaults(),arguments,["delayTime","maxDelay"]);super(e),this.name="Delay";const t=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(t,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(t),this.delayTime=new Zr({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),yi(this,"delayTime")}static getDefaults(){return Object.assign(Jn.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class uh extends Jn{constructor(){const e=Yn(uh.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new $r({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,yi(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Jn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class E8 extends Jn{constructor(){const e=Yn(E8.getDefaults(),arguments);super(e),this.name="Destination",this.input=new uh({context:this.context}),this.output=new $r({context:this.context}),this.volume=this.input.volume,u1(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Jn.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),u1(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}_3(n=>{n.destination=new E8({context:n})});v3(n=>{n.destination.dispose()});class m7e extends Jn{constructor(){super(...arguments),this.name="Listener",this.positionX=new Zr({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Zr({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Zr({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Zr({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Zr({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Zr({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Zr({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Zr({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Zr({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Jn.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}_3(n=>{n.listener=new m7e({context:n})});v3(n=>{n.listener.dispose()});function g7e(n,e){return co(this,arguments,void 0,function*(t,r,i=2,s=xo().sampleRate){const o=xo(),a=new DC(i,r,s);NI(a),yield t(a);const c=a.render();NI(o);const l=yield c;return new Fs(l)})}class x8 extends p_{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=Yn(x8.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const r=e.urls[t];this.add(t,r,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:ps,onload:ps,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return Or(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,r=ps,i=ps){return t_(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new Fs(this.baseUrl+t,r,i))):this._buffers.set(e.toString(),new Fs(t,r,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class PI extends Sh{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return Mb(super._frequencyToUnits(e))}_ticksToUnits(e){return Mb(super._ticksToUnits(e))}_beatsToUnits(e){return Mb(super._beatsToUnits(e))}_secondsToUnits(e){return Mb(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return Ane(this.toMidi())}transpose(e){return new PI(this.context,this.toMidi()+e)}}class lc extends qE{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class _7e extends Vl{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new dd,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,t=>{e-t.time<=this.expiration&&t.callback(),this._events.remove(t)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}_3(n=>{n.draw=new _7e({context:n})});v3(n=>{n.draw.dispose()});class v7e extends p_{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){Or(xi(e.time),"Events must have a time property"),Or(xi(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new y7e(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){const t=[];this._root.search(e.time,t);for(const r of t)if(r.event===e){this._removeNode(r),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const t=e.getBalance();let r,i=null;if(t>0)if(e.left.right===null)r=e.left,r.right=e.right,i=r;else{for(r=e.left.right;r.right!==null;)r=r.right;r.parent&&(r.parent.right=r.left,i=r.parent,r.left=e.left,r.right=e.right)}else if(e.right.left===null)r=e.right,r.left=e.left,i=r;else{for(r=e.right.left;r.left!==null;)r=r.left;r.parent&&(r.parent.left=r.right,i=r.parent,r.left=e.left,r.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=r:e.parent.right=r:this._setRoot(r),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,r=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),t!==null?r?t.left=i:t.right=i:this._setRoot(i)}_rotateRight(e){const t=e.parent,r=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),t!==null?r?t.left=i:t.right=i:this._setRoot(i)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const t=[];if(this._root.search(e,t),t.length>0){let r=t[0];for(let i=1;i<t.length;i++)t[i].low>r.low&&(r=t[i]);return r.event}}return null}forEach(e){if(this._root!==null){const t=[];this._root.traverse(r=>t.push(r)),t.forEach(r=>{r.event&&e(r.event)})}return this}forEachAtTime(e,t){if(this._root!==null){const r=[];this._root.search(e,r),r.forEach(i=>{i.event&&t(i.event)})}return this}forEachFrom(e,t){if(this._root!==null){const r=[];this._root.searchAfter(e,r),r.forEach(i=>{i.event&&t(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class y7e{constructor(e,t,r){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class b7e extends p_{constructor(e){super(),this.name="TimelineValue",this._timeline=new dd({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class wp extends Jn{constructor(){super(Yn(wp.getDefaults(),arguments,["context"]))}connect(e,t=0,r=0){return b3(this,e,t,r),this}}class ay extends wp{constructor(){const e=Yn(ay.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,Ah(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):HFe(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Oi.getDefaults(),{length:1024})}setMap(e,t=1024){const r=new Float32Array(t);for(let i=0,s=t;i<s;i++){const o=i/(s-1)*2-1;r[i]=e(o,i)}return this.curve=r,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const t=["none","2x","4x"].some(r=>r.includes(e));Or(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class E3 extends wp{constructor(){const e=Yn(E3.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new ay({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(wp.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Wv{constructor(e,t){this.id=Wv._eventId++,this._remainderTime=0;const r=Object.assign(Wv.getDefaults(),t);this.transport=e,this.callback=r.callback,this._once=r.once,this.time=Math.floor(r.time),this._remainderTime=r.time-this.time}static getDefaults(){return{callback:ps,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const t=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*t),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Wv._eventId=0;class T8 extends Wv{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const r=Object.assign(T8.getDefaults(),t);this.duration=r.duration,this._interval=r.interval,this._nextTick=r.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Wv.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return OI(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new lc(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){OI(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new lc(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const t=this.transport.getTicksAtTime(e);Ix(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class x3 extends Vl{constructor(){const e=Yn(x3.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new b7e(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new dd,this._repeatedEvents=new v7e,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new S3({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),yi(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Vl.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){const r=t%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(r*Math.PI)*this._swingAmount;e+=new lc(this.context,this._swingTicks*2/3).toSeconds()*i}_V(!0),this._timeline.forEachAtTime(t,r=>r.invoke(e)),_V(!1)}schedule(e,t){const r=new Wv(this,{callback:e,time:new qE(this.context,t).toTicks()});return this._addEvent(r,this._timeline)}scheduleRepeat(e,t,r,i=1/0){const s=new T8(this,{callback:e,duration:new ld(this.context,i).toTicks(),interval:new ld(this.context,t).toTicks(),time:new qE(this.context,r).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,t){const r=new Wv(this,{callback:e,once:!0,time:new qE(this.context,t).toTicks()});return this._addEvent(r,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,r=>this.clear(r.id)),this._repeatedEvents.forEachFrom(t,r=>this.clear(r.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new lc(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let r;return xi(t)&&(r=this.toTicks(t)),this._clock.start(e,r),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Ah(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new ld(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new ld(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new lc(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new lc(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),r=this._clock.frequency.timeToTicks(e,t);this.ticks=r}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if(this.state==="started"){const r=this._clock.getTicksAtTime(t),i=this._clock.frequency.getDurationOfTicks(Math.ceil(r)-r,t),s=t+i;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const t=this.now(),r=this.getTicksAtTime(t),i=e-r%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){const r=this.now();let i=this.bpm,s=1/(60/i.getValueAtTime(r)/this.PPQ),o=[];if(e.units==="time"){const c=.015625/s,l=new $r(c),u=new E3(-1),h=new $r(c);i.chain(l,u,h),i=h,s=1/s,o=[l,u,h]}t||(e.getValueAtTime(r)!==0?t=e.getValueAtTime(r)/s:t=0);const a=new $r(t);return i.connect(a),a.connect(e._param),o.push(a),this._syncedSignals.push({initial:e.value,nodes:o,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const r=this._syncedSignals[t];r.signal===e&&(r.nodes.forEach(i=>i.dispose()),r.signal.value=r.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),PC(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}NC.mixin(x3);_3(n=>{n.transport=new x3({context:n})});v3(n=>{n.transport.dispose()});class ga extends Jn{constructor(e){super(e),this.input=void 0,this._state=new LC("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=ps,this._syncedStop=ps,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new uh({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,yi(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Jn.getDefaults(),{mute:!1,onstop:ps,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,r){let i=yf(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")Or(Ix(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,t,r);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const s=this._state.get(i);s&&(s.offset=this.toSeconds(Ym(t,0)),s.duration=r?this.toSeconds(r):void 0);const o=this.context.transport.schedule(a=>{this._start(a,t,r)},i);this._scheduled.push(o),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else qte(this.context),this._start(i,t,r);return this}stop(e){let t=yf(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||xi(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{const r=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(r)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,r){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,r)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(Ix(t,0)){const r=this._state.get(t);if(r&&r.state==="started"&&r.time!==t){const i=t-this.toSeconds(r.time);let s;r.duration&&(s=this.toSeconds(r.duration)-i),this._start(e,this.toSeconds(r.offset)+i,s)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=ps,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class UC extends Ox{constructor(){const e=Yn(UC.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Tp(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Zr({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Fs(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Ox.getDefaults(),{url:new Fs,loop:!1,loopEnd:0,loopStart:0,onload:ps,onerror:ps,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,r,i=1){Or(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,i),this.loop?t=Ym(t,this.loopStart):t=Ym(t,0);let o=Math.max(this.toSeconds(t),0);if(this.loop){const a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;P4(o,a)&&(o=(o-c)%l+c),hp(o,this.buffer.duration)&&(o=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,OI(o,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,o)),xi(r)){let a=this.toSeconds(r);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class h1 extends ga{constructor(){const e=Yn(h1.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ga.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(Or(e in yV,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=yV[this._type];this._source=new UC({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const QS=44100*5,D2=2,k0={brown:null,pink:null,white:null},yV={get brown(){if(!k0.brown){const n=[];for(let e=0;e<D2;e++){const t=new Float32Array(QS);n[e]=t;let r=0;for(let i=0;i<QS;i++){const s=Math.random()*2-1;t[i]=(r+.02*s)/1.02,r=t[i],t[i]*=3.5}}k0.brown=new Fs().fromArray(n)}return k0.brown},get pink(){if(!k0.pink){const n=[];for(let e=0;e<D2;e++){const t=new Float32Array(QS);n[e]=t;let r,i,s,o,a,c,l;r=i=s=o=a=c=l=0;for(let u=0;u<QS;u++){const h=Math.random()*2-1;r=.99886*r+h*.0555179,i=.99332*i+h*.0750759,s=.969*s+h*.153852,o=.8665*o+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,t[u]=r+i+s+o+a+c+l+h*.5362,t[u]*=.11,l=h*.115926}}k0.pink=new Fs().fromArray(n)}return k0.pink},get white(){if(!k0.white){const n=[];for(let e=0;e<D2;e++){const t=new Float32Array(QS);n[e]=t;for(let r=0;r<QS;r++)t[r]=Math.random()*2-1}k0.white=new Fs().fromArray(n)}return k0.white}};function N1(n,e){return co(this,void 0,void 0,function*(){const t=e/n.context.sampleRate,r=new DC(1,t,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/t,detune:0,context:r})).toDestination().start(0),(yield r.render()).getChannelData(0)})}class w8 extends Ox{constructor(){const e=Yn(w8.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Tp(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Zr({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Zr({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),yi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ox.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Ko extends ga{constructor(){const e=Yn(Ko.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new Oi({context:this.context,units:"frequency",value:e.frequency}),yi(this,"frequency"),this.detune=new Oi({context:this.context,units:"cents",value:e.detune}),yi(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(ga.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),r=new w8({context:this.context,onended:()=>this.onstop(this)});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Ko._periodicWaveCache.find(t=>t.phase===this._phase&&i7e(t.partials,this._partials));{const e=Ko._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&t)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const r=this._getCachedPeriodicWave();if(xi(r)){const{partials:i,wave:s}=r;this._wave=s,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,s]=this._getRealImaginary(e,this._phase),o=this.context.createPeriodicWave(i,s);this._wave=o,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Ko._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Ko._periodicWaveCache.length>100&&Ko._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){cd(e,0);let t=this._type;const r=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(r&&(t=r[1]),this._type!=="custom")e===0?this.type=t:this.type=t+e.toString();else{const i=new Float32Array(e);this._partials.forEach((s,o)=>i[o]=s),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const s=new Float32Array(i),o=new Float32Array(i);let a=1;if(e==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,i=a,this._partials.length===0)return[s,o]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],a=Math.max(a,2),i=a):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const l=2/(c*Math.PI);let u;switch(e){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}u!==0?(s[c]=-u*Math.sin(t*c),o[c]=u*Math.cos(t*c)):(s[c]=0,o[c]=0)}return[s,o]}_inverseFFT(e,t,r){let i=0;const s=e.length;for(let o=0;o<s;o++)i+=e[o]*Math.cos(o*r)+t[o]*Math.sin(o*r);return i}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let r=0;const i=Math.PI*2,s=32;for(let o=0;o<s;o++)r=Math.max(this._inverseFFT(e,t,o/s*i),r);return o7e(-this._inverseFFT(e,t,this._phase)/r,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return co(this,arguments,void 0,function*(e=1024){return N1(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Ko._periodicWaveCache=[];class A8 extends wp{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ay({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ul extends Oi{constructor(){const e=Yn(Ul.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new $r({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Oi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class T3 extends ga{constructor(){const e=Yn(T3.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new A8({context:this.context}),this._modulationNode=new $r({context:this.context}),this._carrier=new Ko({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Ko({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Ul({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),yi(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ko.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return co(this,arguments,void 0,function*(e=1024){return N1(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class BC extends ga{constructor(){const e=Yn(BC.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new $r({context:this.context,gain:0}),this._carrier=new Ko({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Oi({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Ko({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Ul({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Ul({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),yi(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ko.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return co(this,arguments,void 0,function*(e=1024){return N1(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class FC extends ga{constructor(){const e=Yn(FC.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new $r({context:this.context,gain:0}),this._thresh=new ay({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new Oi({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Ko({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),yi(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(ga.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return co(this,arguments,void 0,function*(e=1024){return N1(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class w3 extends ga{constructor(){const e=Yn(w3.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new Oi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Oi({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,yi(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ko.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,r=e/(this._oscillators.length-1);this._forEach((i,s)=>i.detune.value=t+r*s)}}get count(){return this._oscillators.length}set count(e){if(cd(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){const r=new Ko({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):ps});this.type==="custom"&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[t]=r}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,r)=>t.phase=this._phase+r/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return co(this,arguments,void 0,function*(e=1024){return N1(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class A3 extends ga{constructor(){const e=Yn(A3.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Ul({context:this.context,value:2}),this._pulse=new FC({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Ko({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),yi(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(ga.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return co(this,arguments,void 0,function*(e=1024){return N1(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const bV={am:T3,fat:w3,fm:BC,oscillator:Ko,pulse:FC,pwm:A3};class Hm extends ga{constructor(){const e=Yn(Hm.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new Oi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Oi({context:this.context,units:"cents",value:e.detune}),yi(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Ko.getDefaults(),BC.getDefaults(),T3.getDefaults(),w3.getDefaults(),FC.getDefaults(),A3.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=bV[e],r=this.now();if(this._oscillator){const i=this._oscillator;i.stop(r),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(r)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof bV[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&xp(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&xp(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&t_(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return co(this,arguments,void 0,function*(e=1024){return N1(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class C8 extends Oi{constructor(){super(Yn(C8.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new $r({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,u1(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Oi.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Px extends wp{constructor(){const e=Yn(Px.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new Ul({context:this.context,value:e.max-e.min}),this._add=this.output=new C8({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(wp.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class R8 extends wp{constructor(){super(Yn(R8.getDefaults(),arguments)),this.name="Zero",this._gain=new $r({context:this.context}),this.output=this._gain,this.input=void 0,Tp(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),Cne(this.context.getConstant(0),this._gain),this}}class Dx extends Jn{constructor(){const e=Yn(Dx.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Zr.prototype._fromType,this._toType=Zr.prototype._toType,this._is=Zr.prototype._is,this._clampValue=Zr.prototype._clampValue,this._oscillator=new Ko(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new $r({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Oi({context:this.context,units:"audioRange",value:0}),this._zeros=new R8({context:this.context}),this._a2g=new A8({context:this.context}),this._scaler=this.output=new Px({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),yi(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(Ko.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const t=this.min,r=this.max;this._units=e,this.min=t,this.max=r}get state(){return this._oscillator.state}connect(e,t,r){return(e instanceof Zr||e instanceof Oi)&&(this.convert=e.convert,this.units=e.units),b3(this,e,t,r),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Rne(n,e=1/0){const t=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(s){cd(s,n,e),t.set(this,s)}})}}function m_(n,e=1/0){const t=new WeakMap;return function(r,i){Reflect.defineProperty(r,i,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(s){cd(this.toSeconds(s),n,e),t.set(this,s)}})}}class jC extends ga{constructor(){const e=Yn(jC.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new Fs({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ga.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:ps,onerror:ps,playbackRate:1,reverse:!1})}load(e){return co(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=ps){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,r){return super.start(e,t,r),this}_start(e,t,r){this._loop?t=Ym(t,this._loopStart):t=Ym(t,0);const i=this.toSeconds(t),s=r;r=Ym(r,Math.max(this._buffer.duration-i,0));let o=this.toSeconds(r);o=o/this._playbackRate,e=this.toSeconds(e);const a=new UC({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+o),this._state.setStateAtTime("stopped",e+o,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&yf(s)?a.start(e,i):a.start(e,i,o-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach(r=>r.stop(t))}restart(e,t,r){return super.restart(e,t,r),this}_restart(e,t,r){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,t,r)}seek(e,t){const r=this.toSeconds(t);if(this._state.getValueAtTime(r)==="started"){const i=this.toSeconds(e);this._stop(r),this._start(r,i)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&cd(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&cd(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),r=this._state.getNextState("stopped",t);r&&r.implicitEnd&&(this._state.cancel(r.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}zs([m_(0)],jC.prototype,"fadeIn",void 0);zs([m_(0)],jC.prototype,"fadeOut",void 0);class S7e extends wp{constructor(){super(...arguments),this.name="Abs",this._abs=new ay({context:this.context,mapping:e=>Math.abs(e)<.001?0:Math.abs(e)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class E7e extends wp{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new ay({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class k8 extends Px{constructor(){const e=Yn(k8.getDefaults(),arguments,["min","max","exponent"]);super(e),this.name="ScaleExp",this.input=this._exp=new E3({context:this.context,value:e.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(Px.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(e){this._exp.value=e}dispose(){return super.dispose(),this._exp.dispose(),this}}class ll extends Jn{constructor(){const e=Yn(ll.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new Oi({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(Jn.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(t_(e))return e;{let r;for(r in ek)if(ek[r][t]===e)return r;return e}}_setCurve(e,t,r){if(t_(r)&&Reflect.has(ek,r)){const i=ek[r];Lv(i)?e!=="_decayCurve"&&(this[e]=i[t]):this[e]=i}else if(Ah(r)&&e!=="_decayCurve")this[e]=r;else throw new Error("Envelope: invalid curve: "+r)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){const a=1/i;i=(1-o)/a}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=o&&o<=a[c]){a=this._attackCurve.slice(c),a[0]=o;break}this._sig.setValueCurveAtTime(a,e,i,t)}if(s&&this.sustain<1){const a=t*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const r=this.toSeconds(this.release);r<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,r,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,r,e):(Or(Ah(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,r,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,r=1){return t=this.toSeconds(t),this.triggerAttack(t,r),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,r=0){return b3(this,e,t,r),this}asArray(){return co(this,arguments,void 0,function*(e=1024){const t=e/this.context.sampleRate,r=new DC(1,t,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),o=s*.1,a=s+o,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:r}));return c._sig.toDestination(),c.triggerAttackRelease(t*(i+o)/a,0),(yield r.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}zs([m_(0)],ll.prototype,"attack",void 0);zs([m_(0)],ll.prototype,"decay",void 0);zs([Rne(0,1)],ll.prototype,"sustain",void 0);zs([m_(0)],ll.prototype,"release",void 0);const ek=(()=>{let e,t;const r=[];for(e=0;e<128;e++)r[e]=Math.sin(e/127*(Math.PI/2));const i=[],s=6.4;for(e=0;e<127;e++){t=e/127;const f=Math.sin(t*(Math.PI*2)*s-Math.PI/2)+1;i[e]=f/10+t*.83}i[127]=1;const o=[],a=5;for(e=0;e<128;e++)o[e]=Math.ceil(e/127*a)/a;const c=[];for(e=0;e<128;e++)t=e/127,c[e]=.5*(1-Math.cos(Math.PI*t));const l=[];for(e=0;e<128;e++){t=e/127;const f=Math.pow(t,3)*4+.2,d=Math.cos(f*Math.PI*2*t);l[e]=Math.abs(d*(1-t))}function u(f){const d=new Array(f.length);for(let p=0;p<f.length;p++)d[p]=1-f[p];return d}function h(f){return f.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:r,Out:h(r)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:u(i)},sine:{In:c,Out:u(c)},step:{In:o,Out:u(o)}}})();class og extends Jn{constructor(){const e=Yn(og.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new uh({context:this.context,volume:e.volume}),this.volume=this._volume.volume,yi(this,"volume")}static getDefaults(){return Object.assign(Jn.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const r=this["_original_"+e]=this[e];this[e]=(...i)=>{const s=i[t],o=this.context.transport.schedule(a=>{i[t]=a,r.apply(this,i)},s);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,r,i){const s=this.toSeconds(r),o=this.toSeconds(t);return this.triggerAttack(e,s,i),this.triggerRelease(s+o),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class bf extends og{constructor(){const e=Yn(bf.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(og.getDefaults(),{detune:0,onsilence:ps,portamento:0})}triggerAttack(e,t,r=1){this.log("triggerAttack",e,t,r);const i=this.toSeconds(t);return this._triggerEnvelopeAttack(i,r),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const r=this.toSeconds(t),i=e instanceof Sh?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(r)>.05){const s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,s,r)}else this.frequency.setValueAtTime(i,r);return this}}zs([m_(0)],bf.prototype,"portamento",void 0);class C3 extends ll{constructor(){super(Yn(C3.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new $r({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Wa extends bf{constructor(){const e=Yn(Wa.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Hm(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new C3(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),yi(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(bf.getDefaults(),{envelope:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Pc(Hm.getDefaults(),[...Object.keys(ga.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){const r=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+r+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class DI extends bf{constructor(){const e=Yn(DI.getDefaults(),arguments);super(e),this.name="ModulationSynth",this._carrier=new Wa({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Wa({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Oi({context:this.context,units:"frequency"}),this.detune=new Oi({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new Ul({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new $r({context:this.context,gain:0}),yi(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(bf.getDefaults(),{harmonicity:3,oscillator:Object.assign(Pc(Hm.getDefaults(),[...Object.keys(ga.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(Pc(Hm.getDefaults(),[...Object.keys(ga.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,t){this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e,t)}_triggerEnvelopeRelease(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Lx extends Jn{constructor(){const e=Yn(Lx.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Zr({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new Zr({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new Zr({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new Zr({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(Jn.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){Or(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let o=0;o<e;o++){const c=Math.pow(o/e,2)*19980+20;t[o]=c}const r=new Float32Array(e),i=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(t,r,i),r}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Bc extends Jn{constructor(){const e=Yn(Bc.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new $r({context:this.context}),this.output=new $r({context:this.context}),this._filters=[],this._filters=[],this.Q=new Oi({context:this.context,units:"positive",value:e.Q}),this.frequency=new Oi({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Oi({context:this.context,units:"cents",value:e.detune}),this.gain=new Oi({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,yi(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){Or(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(r=>r.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const t=xp(e)?e:parseInt(e,10),r=[-12,-24,-48,-96];let i=r.indexOf(t);Or(i!==-1,`rolloff can only be ${r.join(", ")}`),i+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach(s=>s.disconnect()),this._filters=new Array(i);for(let s=0;s<i;s++){const o=new Lx({context:this.context});o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[s]=o}this._internalChannels=this._filters,u1(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new Lx({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),r=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{t.getFrequencyResponse(e).forEach((s,o)=>r[o]*=s)}),t.dispose(),r}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),PC(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class M8 extends DI{constructor(){const e=Yn(M8.getDefaults(),arguments);super(e),this.name="FMSynth",this.modulationIndex=new Ul({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(DI.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const SV=[1,1.483,1.932,2.546,2.63,3.897];class I8 extends bf{constructor(){const e=Yn(I8.getDefaults(),arguments);super(e),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[],this.detune=new Oi({context:this.context,units:"cents",value:e.detune}),this.frequency=new Oi({context:this.context,units:"frequency"}),this._amplitude=new $r({context:this.context,gain:0}).connect(this.output),this._highpass=new Bc({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let t=0;t<SV.length;t++){const r=new BC({context:this.context,harmonicity:e.harmonicity,modulationIndex:e.modulationIndex,modulationType:"square",onstop:t===0?()=>this.onsilence(this):ps,type:"square"});r.connect(this._highpass),this._oscillators[t]=r;const i=new Ul({context:this.context,value:SV[t]});this._freqMultipliers[t]=i,this.frequency.chain(i,r.frequency),this.detune.connect(r.detune)}this._filterFreqScaler=new Px({context:this.context,max:7e3,min:this.toFrequency(e.resonance)}),this.envelope=new ll({attack:e.envelope.attack,attackCurve:"linear",context:this.context,decay:e.envelope.decay,release:e.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=e.octaves,this.octaves=e.octaves}static getDefaults(){return Bv(bf.getDefaults(),{envelope:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(e,t=1){return this.envelope.triggerAttack(e,t),this._oscillators.forEach(r=>r.start(e)),this.envelope.sustain===0&&this._oscillators.forEach(r=>{r.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(e){return this.envelope.triggerRelease(e),this._oscillators.forEach(t=>t.stop(e+this.toSeconds(this.envelope.release))),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(e){this._oscillators.forEach(t=>t.modulationIndex.value=e)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(e){this._oscillators.forEach(t=>t.harmonicity.value=e)}get resonance(){return this._filterFreqScaler.min}set resonance(e){this._filterFreqScaler.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}dispose(){return super.dispose(),this._oscillators.forEach(e=>e.dispose()),this._freqMultipliers.forEach(e=>e.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class oT extends Wa{constructor(){const e=Yn(oT.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,yi(this,["oscillator","envelope"])}static getDefaults(){return Bv(bf.getDefaults(),Wa.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const r=this.toSeconds(t),i=this.toFrequency(e instanceof Sh?e.toFrequency():e),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,r),this.oscillator.frequency.exponentialRampToValueAtTime(i,r+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}zs([Rne(0)],oT.prototype,"octaves",void 0);zs([m_(0)],oT.prototype,"pitchDecay",void 0);class qv extends og{constructor(){const e=Yn(qv.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new h1(Object.assign({context:this.context},e.noise)),this.envelope=new C3(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(og.getDefaults(),{envelope:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(Pc(h1.getDefaults(),Object.keys(ga.getDefaults())),{type:"white"})})}triggerAttack(e,t=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,t,r=1){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,r),this.triggerRelease(t+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const kne=new Set;function O8(n){kne.add(n)}function Mne(n,e){const t=`registerProcessor("${n}", ${e})`;kne.add(t)}const x7e=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;O8(x7e);const T7e=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;O8(T7e);const w7e=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;O8(w7e);const A7e="feedback-comb-filter",C7e=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;Mne(A7e,C7e);class N8 extends Jn{constructor(){const e=Yn(N8.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OnePoleFilter",this._frequency=e.frequency,this._type=e.type,this.input=new $r({context:this.context}),this.output=new $r({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(Jn.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const e=this._filter,t=this.toFrequency(this._frequency),r=1/(2*Math.PI*t);if(this._type==="lowpass"){const i=1/(r*this.context.sampleRate),s=i-1;this._filter=this.context.createIIRFilter([i,0],[1,s])}else{const i=1/(r*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,i])}this.input.chain(this._filter,this.output),e&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(e),e.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(e){this._frequency=e,this._createFilter()}get type(){return this._type}set type(e){this._type=e,this._createFilter()}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let s=0;s<e;s++){const a=Math.pow(s/e,2)*19980+20;t[s]=a}const r=new Float32Array(e),i=new Float32Array(e);return this._filter.getFrequencyResponse(t,r,i),r}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class P8 extends og{constructor(){const e=Yn(P8.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),Or(!xp(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const t=e.voice.getDefaults();this.options=Object.assign(t,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const r=this._voices.indexOf(this._dummyVoice);this._voices.splice(r,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(og.getDefaults(),{maxPolyphony:32,options:{},voice:Wa})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const t=this._activeVoices.findIndex(r=>r.voice===e);this._activeVoices.splice(t,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Or(e instanceof bf,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else p3("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),t=this._voices.indexOf(e);this._voices.splice(t,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,t,r){e.forEach(i=>{const s=new PI(this.context,i).toMidi(),o=this._getNextAvailableVoice();o&&(o.triggerAttack(i,t,r),this._activeVoices.push({midi:s,voice:o,released:!1}),this.log("triggerAttack",i,t))})}_triggerRelease(e,t){e.forEach(r=>{const i=new PI(this.context,r).toMidi(),s=this._activeVoices.find(({midi:o,released:a})=>o===i&&!a);s&&(s.voice.triggerRelease(t),s.released=!0,this.log("triggerRelease",r,t))})}_scheduleEvent(e,t,r,i){Or(!this.disposed,"Synth was already disposed"),r<=this.now()?e==="attack"?this._triggerAttack(t,r,i):this._triggerRelease(t,r):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,t,r,i)},r-this.now())}triggerAttack(e,t,r){Array.isArray(e)||(e=[e]);const i=this.toSeconds(t);return this._scheduleEvent("attack",e,i,r),this}triggerRelease(e,t){Array.isArray(e)||(e=[e]);const r=this.toSeconds(t);return this._scheduleEvent("release",e,r),this}triggerAttackRelease(e,t,r,i){const s=this.toSeconds(r);if(this.triggerAttack(e,s,i),Ah(t)){Or(Ah(e),"If the duration is an array, the notes must also be an array"),e=e;for(let o=0;o<e.length;o++){const a=t[Math.min(o,t.length-1)],c=this.toSeconds(a);Or(c>0,"The duration must be greater than 0"),this.triggerRelease(e[o],s+c)}}else{const o=this.toSeconds(t);Or(o>0,"The duration must be greater than 0"),this.triggerRelease(e,s+o)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const t=Pc(e,["onsilence","context"]);return this.options=Bv(this.options,t),this._voices.forEach(r=>r.set(t)),this._dummyVoice.set(t),this}get(){return this._dummyVoice.get()}releaseAll(e){const t=this.toSeconds(e);return this._activeVoices.forEach(({voice:r})=>{r.triggerRelease(t)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class zC extends og{constructor(){const e=Yn(zC.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const t={};Object.keys(e.urls).forEach(r=>{const i=parseInt(r,10);if(Or(QR(r)||xp(i)&&isFinite(i),`url key is neither a note or midi pitch: ${r}`),QR(r)){const s=new Sh(this.context,r).toMidi();t[s]=e.urls[r]}else xp(i)&&isFinite(i)&&(t[i]=e.urls[i])}),this._buffers=new x8({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(og.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:ps,onerror:ps,release:.1,urls:{}})}_findClosest(e){let r=0;for(;r<96;){if(this._buffers.has(e+r))return-r;if(this._buffers.has(e-r))return r;r++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,r=1){return this.log("triggerAttack",e,t,r),Array.isArray(e)||(e=[e]),e.forEach(i=>{const s=wne(new Sh(this.context,i).toFrequency()),o=Math.round(s),a=s-o,c=this._findClosest(o),l=o-c,u=this._buffers.get(l),h=Tne(c+a),f=new UC({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);f.start(t,0,u.duration/h,r),Ah(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(f),f.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const d=this._activeSources.get(o),p=d.indexOf(f);p!==-1&&d.splice(p,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(r=>{const i=new Sh(this.context,r).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const s=this._activeSources.get(i);t=this.toSeconds(t),s.forEach(o=>{o.stop(t)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach(r=>{for(;r.length;)r.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,r,i=1){const s=this.toSeconds(r);return this.triggerAttack(e,s,i),Ah(t)?(Or(Ah(e),"notes must be an array when duration is array"),e.forEach((o,a)=>{const c=t[Math.min(a,t.length-1)];this.triggerRelease(o,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(t)),this}add(e,t,r){if(Or(QR(e)||isFinite(e),`note must be a pitch or midi: ${e}`),QR(e)){const i=new Sh(this.context,e).toMidi();this._buffers.add(i,t,r)}else this._buffers.add(e,t,r);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}}zs([m_(0)],zC.prototype,"attack",void 0);zs([m_(0)],zC.prototype,"release",void 0);class IE extends Vl{constructor(){const e=Yn(IE.getDefaults(),arguments,["callback","value"]);super(e),this.name="ToneEvent",this._state=new LC("stopped"),this._startOffset=0,this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(Vl.getDefaults(),{callback:ps,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,t=>{let r;if(t.state==="started"){t.id!==-1&&this.context.transport.clear(t.id);const i=t.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||xp(this._loop)&&this._loop>1){r=1/0,xp(this._loop)&&(r=this._loop*this._getLoopDuration());const s=this._state.getAfter(i);s!==null&&(r=Math.min(r,s.time-i)),r!==1/0&&(r=new lc(this.context,r));const o=new lc(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),o,new lc(this.context,i),r)}else t.id=this.context.transport.schedule(this._tick.bind(this),new lc(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){const t=this.toTicks(e);return this._state.getValueAtTime(t)==="stopped"&&(this._state.add({id:-1,state:"started",time:t}),this._rescheduleEvents(t)),this}stop(e){this.cancel(e);const t=this.toTicks(e);if(this._state.getValueAtTime(t)==="started"){this._state.setStateAtTime("stopped",t,{id:-1});const r=this._state.getBefore(t);let i=t;r!==null&&(i=r.time),this._rescheduleEvents(i)}return this}cancel(e){e=Ym(e,-1/0);const t=this.toTicks(e);return this._state.forEachFrom(t,r=>{this.context.transport.clear(r.id)}),this._state.cancel(t),this}_tick(e){const t=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(t)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let r=.02;Wte(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(Math.random()*2-1)*r}this.callback(e,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new lc(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new lc(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const e=this.context.transport.ticks,t=this._state.get(e);if(t!==null&&t.state==="started"){const r=this._getLoopDuration();return(e-t.time)%r/r}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class LA extends IE{constructor(){const e=Yn(LA.getDefaults(),arguments,["callback","events"]);super(e),this.name="Part",this._state=new LC("stopped"),this._events=new Set,this._state.increasing=!0,e.events.forEach(t=>{Ah(t)?this.add(t[0],t[1]):this.add(t)})}static getDefaults(){return Object.assign(IE.getDefaults(),{events:[]})}start(e,t){const r=this.toTicks(e);if(this._state.getValueAtTime(r)!=="started"){t=Ym(t,this._loop?this._loopStart:0),this._loop?t=Ym(t,this._loopStart):t=Ym(t,0);const i=this.toTicks(t);this._state.add({id:-1,offset:i,state:"started",time:r}),this._forEach(s=>{this._startNote(s,r,i)})}return this}_startNote(e,t,r){t-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(t+=this._getLoopDuration()),e.start(new lc(this.context,t))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(new lc(this.context,t))):e.startOffset>=r&&e.start(new lc(this.context,t))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(t=>{t.startOffset+=this._startOffset})}stop(e){const t=this.toTicks(e);return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._forEach(r=>{r.stop(e)}),this}at(e,t){const r=new qE(this.context,e).toTicks(),i=new lc(this.context,1).toSeconds(),s=this._events.values();let o=s.next();for(;!o.done;){const a=o.value;if(Math.abs(r-a.startOffset)<i)return xi(t)&&(a.value=t),a;o=s.next()}return xi(t)?(this.add(e,t),this.at(e)):null}add(e,t){e instanceof Object&&Reflect.has(e,"time")&&(t=e,e=t.time);const r=this.toTicks(e);let i;return t instanceof IE?(i=t,i.callback=this._tick.bind(this)):i=new IE({callback:this._tick.bind(this),context:this.context,value:t}),i.startOffset=r,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(e){this._state.forEach(t=>{t.state==="started"?this._startNote(e,t.time,t.offset):e.stop(new lc(this.context,t.time))})}remove(e,t){return Lv(e)&&e.hasOwnProperty("time")&&(t=e,e=t.time),e=this.toTicks(e),this._events.forEach(r=>{r.startOffset===e&&(yf(t)||xi(t)&&r.value===t)&&(this._events.delete(r),r.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(t=>t.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(t=>{t instanceof LA?t._forEach(e):e(t)}),this}_setAll(e,t){this._forEach(r=>{r[e]=t})}_tick(e,t){this.mute||this.callback(e,t)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(t=>{t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.loop=e,this._testLoopBoundries(t)})}get loopEnd(){return new lc(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(t=>{t.loopEnd=e,this._testLoopBoundries(t)})}get loopStart(){return new lc(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class R3 extends Jn{constructor(){const e=Yn(R3.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new E7e({context:this.context}),this.a=new $r({context:this.context,gain:0}),this.b=new $r({context:this.context,gain:0}),this.output=new $r({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new Oi({context:this.context,units:"normalRange",value:e.fade}),yi(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Tp(this._split,this.a.gain,0),Tp(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Jn.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}let Hl=class extends Jn{constructor(e){super(e),this.name="Effect",this._dryWet=new R3({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new $r({context:this.context}),this.effectReturn=new $r({context:this.context}),this.input=new $r({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],yi(this,"wet")}static getDefaults(){return Object.assign(Jn.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};class EV extends Hl{constructor(e){super(e),this.name="LFOEffect",this._lfo=new Dx({context:this.context,frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=e.type,yi(this,["frequency","depth"])}static getDefaults(){return Object.assign(Hl.getDefaults(),{frequency:1,type:"sine",depth:1})}start(e){return this._lfo.start(e),this}stop(e){return this._lfo.stop(e),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class D8 extends EV{constructor(){const e=Yn(D8.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(e),this.name="AutoFilter",this.filter=new Bc(Object.assign(e.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency}static getDefaults(){return Object.assign(EV.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}dispose(){return super.dispose(),this.filter.dispose(),this}}class L8 extends Jn{constructor(){const e=Yn(L8.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Zr({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",yi(this,"pan")}static getDefaults(){return Object.assign(Jn.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class U8 extends Jn{constructor(){const e=Yn(U8.getDefaults(),arguments,["smoothing"]);super(e),this.name="Follower",this._abs=this.input=new S7e({context:this.context}),this._lowpass=this.output=new N8({context:this.context,frequency:1/this.toSeconds(e.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=e.smoothing}static getDefaults(){return Object.assign(Jn.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class B8 extends Hl{constructor(){const e=Yn(B8.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);super(e),this.name="AutoWah",this._follower=new U8({context:this.context,smoothing:e.follower}),this._sweepRange=new k8({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this._inputBoost=new $r({context:this.context}),this._bandpass=new Bc({context:this.context,rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new Bc({context:this.context,type:"peaking"}),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,yi(this,["gain","Q"])}static getDefaults(){return Object.assign(Hl.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(e){this._follower.smoothing=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._setSweepRange()}get sensitivity(){return xne(1/this._inputBoost.gain.value)}set sensitivity(e){this._inputBoost.gain.value=1/Ene(e)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const R7e="bit-crusher",k7e=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;Mne(R7e,k7e);class k3 extends Jn{constructor(){const e=Yn(k3.getDefaults(),arguments,["channels"]);super(e),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Jn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class $C extends Jn{constructor(){const e=Yn($C.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(Jn.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class xV extends Jn{constructor(e){super(e),this.name="StereoEffect",this.input=new $r({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new R3({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new k3({context:this.context,channels:2}),this._merge=new $C({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),yi(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),u1(...e),Tp(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),u1(...e),Tp(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Jn.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class TV extends xV{constructor(e){super(e),this.feedback=new Oi({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new $r({context:this.context}),this._feedbackR=new $r({context:this.context}),this._feedbackSplit=new k3({context:this.context,channels:2}),this._feedbackMerge=new $C({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),yi(this,["feedback"])}static getDefaults(){return Object.assign(xV.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class F8 extends TV{constructor(){const e=Yn(F8.getDefaults(),arguments,["frequency","delayTime","depth"]);super(e),this.name="Chorus",this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new Dx({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new Dx({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Nx({context:this.context}),this._delayNodeR=new Nx({context:this.context}),this.frequency=this._lfoL.frequency,yi(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(TV.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;const t=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-t,0),this._lfoL.max=this._delayTime+t,this._lfoR.min=Math.max(this._delayTime-t,0),this._lfoR.max=this._delayTime+t}get delayTime(){return this._delayTime*1e3}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class UA extends Hl{constructor(){const e=Yn(UA.getDefaults(),arguments,["distortion"]);super(e),this.name="Distortion",this._shaper=new ay({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(Hl.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;const t=e*100,r=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+t)*i*20*r/(Math.PI+t*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class wV extends Hl{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new $r({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,yi(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Hl.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class j8 extends wV{constructor(){const e=Yn(j8.getDefaults(),arguments,["delayTime","feedback"]);super(e),this.name="FeedbackDelay",this._delayNode=new Nx({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),yi(this,"delayTime")}static getDefaults(){return Object.assign(wV.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class z8 extends Hl{constructor(){const e=Yn(z8.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const t=this.toSeconds(e.decay);cd(t,.001),this._decay=t;const r=this.toSeconds(e.preDelay);cd(r,0),this._preDelay=r,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Hl.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),cd(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),cd(e,0),this._preDelay=e,this.generate()}generate(){return co(this,void 0,void 0,function*(){const e=this.ready,t=new DC(2,this._decay+this._preDelay,this.context.sampleRate),r=new h1({context:t}),i=new h1({context:t}),s=new $C({context:t});r.connect(s,0,0),i.connect(s,0,1);const o=new $r({context:t}).toDestination();s.connect(o),r.start(0),i.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const a=t.render();return this.ready=a.then(ps),yield e,this._convolver.buffer=(yield a).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class M3 extends Hl{constructor(){const e=Yn(M3.getDefaults(),arguments,["frequency","depth"]);super(e),this.name="Vibrato",this._delayNode=new Nx({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new Dx({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,yi(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(Hl.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class $a extends Jn{constructor(){const e=Yn($a.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new $r({context:this.context}),$a._allSolos.has(this.context)||$a._allSolos.set(this.context,new Set),$a._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Jn.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),$a._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){$a._soloed.has(this.context)||$a._soloed.set(this.context,new Set),$a._soloed.get(this.context).add(this)}_removeSolo(){$a._soloed.has(this.context)&&$a._soloed.get(this.context).delete(this)}_isSoloed(){return $a._soloed.has(this.context)&&$a._soloed.get(this.context).has(this)}_noSolos(){return!$a._soloed.has(this.context)||$a._soloed.has(this.context)&&$a._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),$a._allSolos.get(this.context).delete(this),this._removeSolo(),this}}$a._allSolos=new Map;$a._soloed=new Map;class $8 extends Jn{constructor(){const e=Yn($8.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new L8({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new uh({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,yi(this,["pan","volume"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class hh extends Jn{constructor(){const e=Yn(hh.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new $a({solo:e.solo,context:this.context}),this._panVol=this.output=new $8({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),yi(this,["pan","volume"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return hh.buses.has(e)||hh.buses.set(e,new $r({context:this.context})),hh.buses.get(e)}send(e,t=0){const r=this._getBus(e),i=new $r({context:this.context,units:"decibels",gain:t});return this.connect(i),i.connect(r),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}hh.buses=new Map;class V8 extends Jn{constructor(){const e=Yn(V8.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(e),this.name="MultibandSplit",this.input=new $r({context:this.context}),this.output=void 0,this.low=new Bc({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Bc({context:this.context,frequency:0,type:"highpass"}),this.mid=new Bc({context:this.context,frequency:0,type:"lowpass"}),this.high=new Bc({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new Oi({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new Oi({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new Oi({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),yi(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),PC(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class H8 extends Jn{constructor(){const e=Yn(H8.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new Zr({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new Zr({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new Zr({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new Zr({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new Zr({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),yi(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(Jn.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class BA extends Jn{constructor(){const e=Yn(BA.getDefaults(),arguments,["low","mid","high"]);super(e),this.name="EQ3",this.output=new $r({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new V8({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new $r({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new $r({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new $r({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),yi(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(Jn.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),PC(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}xo().transport;function D4(){return xo().transport}xo().destination;xo().destination;function M7e(){return xo().destination}xo().listener;xo().draw;xo();function I7e(n,e){const t=new oT().connect(n);return t.set({octaves:8,volume:8,pitchDecay:.125}),t.connect(e),{basstrigger(r){t.triggerAttackRelease("C1","8n",r)}}}function O7e(n){const e=new BA(-6,6,10).connect(n),t=new Bc(8e3,"highpass",-12);t.connect(e);const r=new qv;r.set({envelope:{attack:.001,decay:.05,sustain:.001,release:.05}}),r.connect(t);const i=new BA(-6,3,8).connect(n),s=new Bc(6e3,"highpass",-12);s.connect(i);const o=new qv;return o.set({envelope:{attack:.001,decay:.2,sustain:.1,release:.3}}),o.connect(s),{ticktrigger(a){r.triggerAttackRelease("16n",a)},tweettrigger(a){o.triggerAttackRelease("8n",a)}}}function N7e(n,e){const t=new Bc(350,"bandpass").connect(n),r=new $r().connect(t);r.gain.value=0;const i=new P8().connect(r);i.volume.value=16,i.maxPolyphony=8,i.set({envelope:{attack:.001,decay:.01,sustain:.1,release:.1},oscillator:{type:"square"}});const s=new BA(-10,10,-1).connect(n);s.connect(e);const o=new Bc(800,"highpass",-12);o.connect(s);const a=new qv;return a.set({envelope:{attack:.01,decay:.1,sustain:.1,release:.1}}),a.connect(o),{cowbelltrigger(c,l){const u=Lc("64n").toSeconds()+Lc(c).toSeconds();r.gain.setValueAtTime(.5,l),r.gain.exponentialRampToValueAtTime(.01,u+l),i.triggerAttackRelease([800,540],c,l)},claptrigger(c,l){a.triggerAttackRelease(c,l)}}}function P7e(n){const e=new UA().connect(n);e.set({distortion:.666});const t=new Wa;t.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),t.connect(e);const r=new Bc;r.set({type:"highpass",frequency:1e4}),r.connect(e);const i=new qv;i.set({envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),i.connect(r);const s=new UA().connect(n);s.set({distortion:.876});const o=new Wa;o.set({envelope:{attack:0,decay:.1,sustain:0,release:1},oscillator:{type:"triangle"}}),o.connect(s);const a=new Bc;a.set({type:"highpass",frequency:1e4}),a.connect(s);const c=new qv;return c.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),c.connect(a),{hisnaretrigger(l,u){const h=Lc("512n").toSeconds(),f=Lc("32n").toSeconds();t.triggerAttackRelease(1e4,l,u,1),t.frequency.exponentialRampToValueAtTime(300,u+h),t.frequency.exponentialRampToValueAtTime(100,u+f),i.triggerAttackRelease("8n",u,.333),i.volume.setValueAtTime(1,u),i.volume.exponentialRampToValueAtTime(0,u+Lc("32n").toSeconds())},lowsnaretrigger(l,u){const h=Lc("512n").toSeconds(),f=Lc("32n").toSeconds();o.triggerAttackRelease(1e4,l,u,1),o.frequency.exponentialRampToValueAtTime(150,u+h),o.frequency.exponentialRampToValueAtTime(100,u+f),c.triggerAttackRelease("8n",u,.25),c.volume.setValueAtTime(1,u),c.volume.exponentialRampToValueAtTime(0,u+Lc("32n").toSeconds())}}}function D7e(n){const e=new Wa().connect(n);e.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"sawtooth"}});const t=new Wa().connect(n);t.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1},oscillator:{type:"triangle"}});const r=new qv().connect(n);return r.set({envelope:{attack:.01,decay:.1,sustain:.001,release:.1}}),{lowtomtrigger(i,s){const o=Lc("256n").toSeconds(),a=Lc(i).toSeconds()-o;e.triggerAttackRelease("C4",a,s,1),e.frequency.exponentialRampToValueAtTime(vV("C0").toFrequency(),s+a),t.triggerAttackRelease("C5",a,s,.5),t.frequency.exponentialRampToValueAtTime(vV("C0").toFrequency(),s+a);const c=Lc("4n").toSeconds();r.triggerAttackRelease("8n",s),r.volume.setValueAtTime(1,s),r.volume.exponentialRampToValueAtTime(0,s+c)}}}function L7e(n){const e=new Bc;e.set({type:"bandpass",frequency:256,Q:.17}),e.connect(n);const t=new Wa;t.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),t.connect(e);const r=new Wa;r.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),r.connect(e);const i=new Bc;i.set({type:"bandpass",frequency:256,Q:.17}),i.connect(n);const s=new Wa;s.set({envelope:{attack:.001,decay:.001,sustain:.001,release:.1},oscillator:{type:"sawtooth"}}),s.connect(i);const o=new Wa;return o.set({envelope:{attack:.001,decay:.1,sustain:.001,release:.1},oscillator:{type:"sine"}}),o.connect(i),{hiwoodblocktrigger(a,c){t.triggerAttackRelease(2e3,a,c),t.frequency.exponentialRampToValueAtTime(1e3,c+Lc("32n").toSeconds()),r.triggerAttackRelease(999,a,c),r.frequency.exponentialRampToValueAtTime(888,c+Lc("256n").toSeconds())},lowwoodblocktrigger(a,c){s.triggerAttackRelease(2e3,a,c),s.frequency.exponentialRampToValueAtTime(100,c+Lc("32n").toSeconds()),o.triggerAttackRelease(699,a,c),o.frequency.exponentialRampToValueAtTime(399,c+Lc("256n").toSeconds())}}}function U7e(n,e){const t=O7e(n),r=N7e(n,e),i=P7e(n),s=L7e(n),o=D7e(n),a=I7e(n,e);return{ticktrigger:t.ticktrigger,tweettrigger:t.tweettrigger,cowbelltrigger:r.cowbelltrigger,claptrigger:r.claptrigger,hisnaretrigger:i.hisnaretrigger,hiwoodblocktrigger:s.hiwoodblocktrigger,lowsnaretrigger:i.lowsnaretrigger,lowtomtrigger:o.lowtomtrigger,lowwoodblocktrigger:s.lowwoodblocktrigger,basstrigger:a.basstrigger}}const B7e="data:text/javascript;base64,Ly8gQSBkb3duc2FtcGxpbmcvZGVncmFkaW5nIHByb2Nlc3NpbmcgZWZmZWN0Ci8vIFNhbXBsZSBhbmQgaG9sZHMgdGhlIHNpZ25hbCBiYXNlZCBvbiBhbiBpbmNyZW1lbnRpbmcgY291bnRlcgovLyB3cml0dGVuIGJ5IFRpbW8gSG9vZ2xhbmQsIChjKSAyMDIzLCB3d3cudGltb2hvb2dsYW5kLmNvbQovLwoKY2xhc3MgU3ludGhGQ3J1c2hXb3JrbGV0UHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFsKICAgICAgewogICAgICAgIG5hbWU6ICdyYXRlJywKICAgICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgICAgbWluVmFsdWU6IDEsCiAgICAgICAgbWF4VmFsdWU6IDUxMiwKICAgICAgfSwKICAgIF0KICB9CgogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoKQogICAgLy8gdGhlIGZyYW1lIGNvdW50ZXIKICAgIHRoaXMuY291bnQgPSAwCiAgICAvLyBzYW1wbGUgYW5kIGhvbGQgdmFyaWFibGUgYXJyYXkKICAgIHRoaXMuc2FoID0gW10KICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXQogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXQoKICAgIC8vIGNoZWNrIGZvciBkYXRhCiAgICBpZiAoIWlucHV0WzBdIHx8ICFpbnB1dFsxXSB8fCAhb3V0cHV0WzBdIHx8ICFvdXRwdXRbMV0pIHsKICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICAvLyBmb3IgdGhlIGxlbmd0aCBvZiB0aGUgc2FtcGxlIGFycmF5IChnZW5lcmFsbHkgMTI4KQogICAgY29uc3QgcmF0ZSA9IHBhcmFtZXRlcnMucmF0ZVswXQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dFswXS5sZW5ndGg7IGkrKykgewogICAgICAvLyBmb3IgZXZlcnkgY2hhbm5lbAogICAgICBmb3IgKGxldCBjaGFubmVsID0gMDsgY2hhbm5lbCA8IGlucHV0Lmxlbmd0aDsgKytjaGFubmVsKSB7CiAgICAgICAgLy8gaWYgY291bnRlciBlcXVhbHMgMCwgc2FtcGxlIGFuZCBob2xkCiAgICAgICAgaWYgKHRoaXMuY291bnQgJSByYXRlID09PSAwKSB7CiAgICAgICAgICB0aGlzLnNhaFtjaGFubmVsXSA9IGlucHV0W2NoYW5uZWxdW2ldCiAgICAgICAgfQogICAgICAgIC8vIG91dHB1dCB0aGUgY3VycmVudGx5IGhlbGQgc2FtcGxlCiAgICAgICAgb3V0cHV0W2NoYW5uZWxdW2ldID0gdGhpcy5zYWhbY2hhbm5lbF0KICAgICAgfQogICAgICAvLyBpbmNyZW1lbnQgc2FtcGxlIGNvdW50ZXIKICAgICAgdGhpcy5jb3VudCsrCiAgICB9CiAgICByZXR1cm4gdHJ1ZQogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2ZjcnVzaHByb2Nlc3NvcicsIFN5bnRoRkNydXNoV29ya2xldFByb2Nlc3NvcikK";class G8 extends Hl{name="FrequencyCrusher";rate;_audioworkletnode=this.context.createAudioWorkletNode("fcrushprocessor");constructor(){const e=Yn(G8.getDefaults(),arguments,["rate"]);super(e),this.rate=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("rate"),value:e.rate,minValue:1,maxValue:512}),this.connectEffect(this._audioworkletnode)}static getDefaults(){return Object.assign(Hl.getDefaults(),{rate:64})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}function F7e(){return xo().rawContext.audioWorklet.addModule(B7e)}function tk(n){const e=xo().isOffline?"offline":"",t=new hh(ua(0)),r=new hh(ua(0)),i=new hh(ua(0)),s=new hh(ua(0)),o=new hh(ua(0)),a=new hh(ua(0)),c=new hh(ua(0));t.receive(`${e}fc${n}`),r.receive(`${e}echo${n}`),i.receive(`${e}reverb${n}`),s.receive(`${e}autofilter${n}`),o.receive(`${e}vibrato${n}`),a.receive(`${e}distortion${n}`),c.receive(`${e}autowah${n}`);const l=new hh;l.send(`${e}fc${n}`),l.send(`${e}echo${n}`),l.send(`${e}reverb${n}`),l.send(`${e}autofilter${n}`),l.send(`${e}vibrato${n}`),l.send(`${e}distortion${n}`),l.send(`${e}autowah${n}`);function u(){return{fc:t.volume.value,echo:r.volume.value,reverb:i.volume.value,autofilter:s.volume.value,vibrato:o.volume.value,distortion:a.volume.value,autowah:c.volume.value}}function h(p){t.volume.value=p.fc,r.volume.value=p.echo,i.volume.value=p.reverb,s.volume.value=p.autofilter,o.volume.value=p.vibrato,a.volume.value=p.distortion,c.volume.value=p.autowah}function f(){t.volume.value=ua(0),r.volume.value=ua(0),i.volume.value=ua(0),s.volume.value=ua(0),o.volume.value=ua(0),a.volume.value=ua(0),c.volume.value=ua(0)}function d(){t.dispose(),r.dispose(),i.dispose(),s.dispose(),o.dispose(),a.dispose(),c.dispose(),l.dispose()}return{sendtofx:l,fc:t,echo:r,reverb:i,autofilter:s,vibrato:o,distortion:a,autowah:c,fcrush:t,distort:a,getreplay:u,setreplay:h,applyreset:f,destroy:d}}function ua(n){return 20*Math.log10(n)-35}function j7e(){const n=new z8,e=Ks(n.get()),t=new j8,r=Ks(t.get()),i=new D8,s=Ks(i.get()),o=new UA,a=Ks(o.get()),c=new M3,l=Ks(c.get()),u=new G8,h=Ks(u.get()),f=new B8,d=Ks(f.get());function p(){n.set({...e,wet:1}),t.set({...r,wet:1,delayTime:"8n",maxDelay:"8n",feedback:.666}),i.set({...s,wet:1,depth:.5,frequency:3,octaves:5}),o.set({...a,wet:1,oversample:"4x"}),c.set({...l,wet:1,depth:0,maxDelay:.5}),u.set({...h,wet:1,rate:32}),f.set({...d,wet:1})}function m(){return{fc:Ks(u.get()),echo:Ks(t.get()),reverb:Ks(n.get()),autofilter:Ks(i.get()),vibrato:Ks(c.get()),distortion:Ks(o.get())}}function _(S){u.set(S.fc),t.set(S.echo),n.set(S.reverb),i.set(S.autofilter),c.set(S.vibrato),o.set(S.distortion)}function v(){u.dispose(),t.dispose(),n.dispose(),i.dispose(),c.dispose(),o.dispose()}return p(),{fc:u,echo:t,reverb:n,autofilter:i,vibrato:c,distortion:o,applyreset:p,getreplay:m,setreplay:_,autowah:f,fcrush:u,distort:o,destroy:v}}const z7e="/assets/sidechainworklet-4DrJ3CKW.js";class W8 extends Hl{name="SidechainCompressor";threshold;ratio;attack;release;mix;makeupGain;sidechain=new $r;_audioworkletnode=this.context.createAudioWorkletNode("sidechaincompressorprocessor",{numberOfInputs:2,outputChannelCount:[2]});constructor(){const e=Yn(W8.getDefaults(),arguments,["threshold","ratio","attack","release","mix","makeupGain"]);super(e),this.threshold=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("threshold"),value:e.threshold,minValue:-128,maxValue:0}),this.ratio=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("ratio"),value:e.ratio,minValue:1,maxValue:128}),this.attack=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("attack"),value:e.attack,minValue:1e-4,maxValue:128}),this.release=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("release"),value:e.release,minValue:1e-4,maxValue:128}),this.mix=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("mix"),value:e.mix,minValue:0,maxValue:1}),this.makeupGain=new Zr({context:this.context,param:this._audioworkletnode.parameters.get("makeupGain"),value:e.makeupGain,minValue:-128,maxValue:60}),this.connectEffect(this._audioworkletnode),this.sidechain.connect(this._audioworkletnode,0,1)}static getDefaults(){return Object.assign(Hl.getDefaults(),{threshold:-28,ratio:4,attack:.005,release:.005,mix:1,makeupGain:0})}dispose(){return super.dispose(),this._audioworkletnode.disconnect(),this}}function $7e(){return xo().rawContext.audioWorklet.addModule(z7e)}function V7e(){const n=M7e(),e=new uh;e.connect(n);let t;xo().isOffline||(t=xo().createMediaStreamDestination(),e.connect(t));const r=new $r,i=new M3({maxDelay:.005,frequency:.125,depth:.3,type:"square",wet:.1}),s=new F8({frequency:.01,delayTime:7,depth:.7,type:"sawtooth",spread:128,wet:.5});s.start();const o=new h1({type:"pink",volume:-50}),a=new uh,c=new A8,l=new Ko(Math.PI*.25,"sine");l.chain(c,a.volume),l.start(),o.start(),o.chain(a,s),i.chain(s,e);const u=new H8({threshold:-28,ratio:4,attack:.003,release:.15,knee:30});r.chain(u,i);const h=new W8({threshold:-42,ratio:4,attack:.005,release:.005,mix:.777,makeupGain:24});h.connect(r);const f=new uh(-12),d=new uh(-32),p=new uh(ua(20));p.connect(h);const m=new uh(ua(100));m.connect(r);const _=new uh;_.connect(r),_.connect(f);const v=new uh;v.connect(r),v.connect(f),f.connect(h.sidechain),d.connect(h.sidechain);const S=U7e(m,d);return{mainvolume:e,broadcastdestination:t,razzlegain:r,playvolume:p,drumvolume:m,bgplayvolume:_,ttsvolume:v,drum:S}}const AV=4,H7e={a:1,b:2,c:3,d:4,e:5,f:6,g:7,x:8,A:1,B:2,C:3,D:4,E:5,F:6,G:7,X:8,"#":9,"!":10,y:13,t:14,s:15,i:16,q:17,h:18,w:19,Y:13,T:14,S:15,I:16,Q:17,H:18,W:19,3:20,".":21,"+":11,"-":12,0:22,1:23,2:24,p:25,4:26,5:27,6:29,7:28,8:30,9:31},Ine="64n";function G7e(n){return Lc({[Ine]:n}).toNotation()}function W7e(n){return Lc({[Ine]:n}).toSeconds()}function q7e(n,e,t,r=!0){let i=e,s=4,o=2,a="",c="";const l=[];function u(){c="",a="",i+=W7e(o)}function h(){const f=G7e(o);c===null?(l.push([i,[n,f,c]]),u()):rn(c)?(l.push([i,[n,f,c]]),u()):c.startsWith("#")?(l.push([i,[n,f,c]]),u()):c!==""&&(l.push([i,[n,f,`${c}${a}${s}`]]),u())}if(un(t))c=t;else for(let f=0;f<t.length;++f){switch(t[f]){case 9:case 10:break;default:h();break}switch(t[f]){case 1:c="A";break;case 2:c="B";break;case 3:c="C";break;case 4:c="D";break;case 5:c="E";break;case 6:c="F";break;case 7:c="G";break;case 8:c=null;break;case 9:a+="#";break;case 10:a+="b";break;case 11:s<8&&++s;break;case 12:s>0&&--s;break;case 13:o=1;break;case 14:o=2;break;case 15:o=4;break;case 16:o=8;break;case 17:o=16;break;case 18:o=32;break;case 19:o=64;break;case 20:o=Math.round(o/3);break;case 21:o=Math.round(o*3/2);break;case 22:c=0;break;case 23:c=1;break;case 24:c=2;break;case 25:c=3;break;case 26:c=4;break;case 27:c=5;break;case 29:c=6;break;case 28:c=7;break;case 30:c=8;break;case 31:c=9;break}}return h(),r&&l.push([i,[n,"8n",-1]]),l}function CV(n){const e=[],t=n.split(";");for(let r=0;r<t.length;++r){const i=[],s=t[r];for(let o=0;o<s.length;++o){const a=H7e[s[o]];he(a)&&i.push(a)}e.push(i)}return e}function Y7e(n){return new Int8Array(n)}function K7e(n){return new Int16Array(n)}function One(n){return new Int32Array(n)}function Nne(n){return new Float32Array(n)}function X7e(n){return new Float64Array(n)}function Pne(n){if(n.length==1)return Nne(n[0]);var e=n[0];n=n.slice(1);for(var t=[],r=0;r<e;r++)t.push(Pne(n));return t}function Dne(n){if(n.length==1)return One(n[0]);var e=n[0];n=n.slice(1);for(var t=[],r=0;r<e;r++)t.push(Dne(n));return t}function Lne(n){if(n.length==1)return K7e(n[0]);var e=n[0];n=n.slice(1);for(var t=[],r=0;r<e;r++)t.push(Lne(n));return t}function Une(n){if(n.length==1)return new Array(n[0]);var e=n[0];n=n.slice(1);for(var t=[],r=0;r<e;r++)t.push(Une(n));return t}var Bne={};Bne.fill=function(n,e,t,r){if(arguments.length==2)for(var i=0;i<n.length;i++)n[i]=arguments[1];else for(var i=e;i<t;i++)n[i]=r};var VC={};VC.arraycopy=function(n,e,t,r,i){for(var s=e+i;e<s;)t[r++]=n[e++]};VC.out={};VC.out.println=function(n){console.log(n)};VC.out.printf=function(){console.log.apply(console,arguments)};var I3={};I3.SQRT2=1.4142135623730951;I3.FAST_LOG10=function(n){return Math.log10(n)};I3.FAST_LOG10_X=function(n,e){return Math.log10(n)*e};function n_(n){this.ordinal=n}n_.short_block_allowed=new n_(0);n_.short_block_coupled=new n_(1);n_.short_block_dispensed=new n_(2);n_.short_block_forced=new n_(3);var Fne={};Fne.MAX_VALUE=34028235e31;function Sf(n){this.ordinal=n}Sf.vbr_off=new Sf(0);Sf.vbr_mt=new Sf(1);Sf.vbr_rh=new Sf(2);Sf.vbr_abr=new Sf(3);Sf.vbr_mtrh=new Sf(4);Sf.vbr_default=Sf.vbr_mtrh;var Z7e=function(n){},No={System:VC,VbrMode:Sf,Float:Fne,ShortBlock:n_,Util:I3,Arrays:Bne,new_array_n:Une,new_byte:Y7e,new_double:X7e,new_float:Nne,new_float_n:Pne,new_int:One,new_int_n:Dne,new_short_n:Lne,assert:Z7e},L2,RV;function J7e(){if(RV)return L2;RV=1;var n=No,e=n.System,t=n.Util,r=n.Arrays,i=n.new_float,s=Yl();function o(){var a=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*t.SQRT2*.5/2384e-9,.017876148*t.SQRT2*.5/2384e-9,.003134727*t.SQRT2*.5/2384e-9,.002457142*t.SQRT2*.5/2384e-9,971317e-9*t.SQRT2*.5/2384e-9,218868e-9*t.SQRT2*.5/2384e-9,101566e-9*t.SQRT2*.5/2384e-9,13828e-9*t.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],c=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],l=c[s.SHORT_TYPE],u=c[s.SHORT_TYPE],h=c[s.SHORT_TYPE],f=c[s.SHORT_TYPE],d=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function p(v,S,b){for(var T=10,w=S+238-14-286,R=-15;R<0;R++){var C,N,U;C=a[T+-10],N=v[w+-224]*C,U=v[S+224]*C,C=a[T+-9],N+=v[w+-160]*C,U+=v[S+160]*C,C=a[T+-8],N+=v[w+-96]*C,U+=v[S+96]*C,C=a[T+-7],N+=v[w+-32]*C,U+=v[S+32]*C,C=a[T+-6],N+=v[w+32]*C,U+=v[S+-32]*C,C=a[T+-5],N+=v[w+96]*C,U+=v[S+-96]*C,C=a[T+-4],N+=v[w+160]*C,U+=v[S+-160]*C,C=a[T+-3],N+=v[w+224]*C,U+=v[S+-224]*C,C=a[T+-2],N+=v[S+-256]*C,U-=v[w+256]*C,C=a[T+-1],N+=v[S+-192]*C,U-=v[w+192]*C,C=a[T+0],N+=v[S+-128]*C,U-=v[w+128]*C,C=a[T+1],N+=v[S+-64]*C,U-=v[w+64]*C,C=a[T+2],N+=v[S+0]*C,U-=v[w+0]*C,C=a[T+3],N+=v[S+64]*C,U-=v[w+-64]*C,C=a[T+4],N+=v[S+128]*C,U-=v[w+-128]*C,C=a[T+5],N+=v[S+192]*C,U-=v[w+-192]*C,N*=a[T+6],C=U-N,b[30+R*2]=U+N,b[31+R*2]=a[T+7]*C,T+=18,S--,w++}{var N,U,B,$;U=v[S+-16]*a[T+-10],N=v[S+-32]*a[T+-2],U+=(v[S+-48]-v[S+16])*a[T+-9],N+=v[S+-96]*a[T+-1],U+=(v[S+-80]+v[S+48])*a[T+-8],N+=v[S+-160]*a[T+0],U+=(v[S+-112]-v[S+80])*a[T+-7],N+=v[S+-224]*a[T+1],U+=(v[S+-144]+v[S+112])*a[T+-6],N-=v[S+32]*a[T+2],U+=(v[S+-176]-v[S+144])*a[T+-5],N-=v[S+96]*a[T+3],U+=(v[S+-208]+v[S+176])*a[T+-4],N-=v[S+160]*a[T+4],U+=(v[S+-240]-v[S+208])*a[T+-3],N-=v[S+224],B=N-U,$=N+U,U=b[14],N=b[15]-U,b[31]=$+U,b[30]=B+N,b[15]=B-N,b[14]=$-U}{var I;I=b[28]-b[0],b[0]+=b[28],b[28]=I*a[T+-36+7],I=b[29]-b[1],b[1]+=b[29],b[29]=I*a[T+-36+7],I=b[26]-b[2],b[2]+=b[26],b[26]=I*a[T+-72+7],I=b[27]-b[3],b[3]+=b[27],b[27]=I*a[T+-72+7],I=b[24]-b[4],b[4]+=b[24],b[24]=I*a[T+-108+7],I=b[25]-b[5],b[5]+=b[25],b[25]=I*a[T+-108+7],I=b[22]-b[6],b[6]+=b[22],b[22]=I*t.SQRT2,I=b[23]-b[7],b[7]+=b[23],b[23]=I*t.SQRT2-b[7],b[7]-=b[6],b[22]-=b[7],b[23]-=b[22],I=b[6],b[6]=b[31]-I,b[31]=b[31]+I,I=b[7],b[7]=b[30]-I,b[30]=b[30]+I,I=b[22],b[22]=b[15]-I,b[15]=b[15]+I,I=b[23],b[23]=b[14]-I,b[14]=b[14]+I,I=b[20]-b[8],b[8]+=b[20],b[20]=I*a[T+-180+7],I=b[21]-b[9],b[9]+=b[21],b[21]=I*a[T+-180+7],I=b[18]-b[10],b[10]+=b[18],b[18]=I*a[T+-216+7],I=b[19]-b[11],b[11]+=b[19],b[19]=I*a[T+-216+7],I=b[16]-b[12],b[12]+=b[16],b[16]=I*a[T+-252+7],I=b[17]-b[13],b[13]+=b[17],b[17]=I*a[T+-252+7],I=-b[20]+b[24],b[20]+=b[24],b[24]=I*a[T+-216+7],I=-b[21]+b[25],b[21]+=b[25],b[25]=I*a[T+-216+7],I=b[4]-b[8],b[4]+=b[8],b[8]=I*a[T+-216+7],I=b[5]-b[9],b[5]+=b[9],b[9]=I*a[T+-216+7],I=b[0]-b[12],b[0]+=b[12],b[12]=I*a[T+-72+7],I=b[1]-b[13],b[1]+=b[13],b[13]=I*a[T+-72+7],I=b[16]-b[28],b[16]+=b[28],b[28]=I*a[T+-72+7],I=-b[17]+b[29],b[17]+=b[29],b[29]=I*a[T+-72+7],I=t.SQRT2*(b[2]-b[10]),b[2]+=b[10],b[10]=I,I=t.SQRT2*(b[3]-b[11]),b[3]+=b[11],b[11]=I,I=t.SQRT2*(-b[18]+b[26]),b[18]+=b[26],b[26]=I-b[18],I=t.SQRT2*(-b[19]+b[27]),b[19]+=b[27],b[27]=I-b[19],I=b[2],b[19]-=b[3],b[3]-=I,b[2]=b[31]-I,b[31]+=I,I=b[3],b[11]-=b[19],b[18]-=I,b[3]=b[30]-I,b[30]+=I,I=b[18],b[27]-=b[11],b[19]-=I,b[18]=b[15]-I,b[15]+=I,I=b[19],b[10]-=I,b[19]=b[14]-I,b[14]+=I,I=b[10],b[11]-=I,b[10]=b[23]-I,b[23]+=I,I=b[11],b[26]-=I,b[11]=b[22]-I,b[22]+=I,I=b[26],b[27]-=I,b[26]=b[7]-I,b[7]+=I,I=b[27],b[27]=b[6]-I,b[6]+=I,I=t.SQRT2*(b[0]-b[4]),b[0]+=b[4],b[4]=I,I=t.SQRT2*(b[1]-b[5]),b[1]+=b[5],b[5]=I,I=t.SQRT2*(b[16]-b[20]),b[16]+=b[20],b[20]=I,I=t.SQRT2*(b[17]-b[21]),b[17]+=b[21],b[21]=I,I=-t.SQRT2*(b[8]-b[12]),b[8]+=b[12],b[12]=I-b[8],I=-t.SQRT2*(b[9]-b[13]),b[9]+=b[13],b[13]=I-b[9],I=-t.SQRT2*(b[25]-b[29]),b[25]+=b[29],b[29]=I-b[25],I=-t.SQRT2*(b[24]+b[28]),b[24]-=b[28],b[28]=I-b[24],I=b[24]-b[16],b[24]=I,I=b[20]-I,b[20]=I,I=b[28]-I,b[28]=I,I=b[25]-b[17],b[25]=I,I=b[21]-I,b[21]=I,I=b[29]-I,b[29]=I,I=b[17]-b[1],b[17]=I,I=b[9]-I,b[9]=I,I=b[25]-I,b[25]=I,I=b[5]-I,b[5]=I,I=b[21]-I,b[21]=I,I=b[13]-I,b[13]=I,I=b[29]-I,b[29]=I,I=b[1]-b[0],b[1]=I,I=b[16]-I,b[16]=I,I=b[17]-I,b[17]=I,I=b[8]-I,b[8]=I,I=b[9]-I,b[9]=I,I=b[24]-I,b[24]=I,I=b[25]-I,b[25]=I,I=b[4]-I,b[4]=I,I=b[5]-I,b[5]=I,I=b[20]-I,b[20]=I,I=b[21]-I,b[21]=I,I=b[12]-I,b[12]=I,I=b[13]-I,b[13]=I,I=b[28]-I,b[28]=I,I=b[29]-I,b[29]=I,I=b[0],b[0]+=b[31],b[31]-=I,I=b[1],b[1]+=b[30],b[30]-=I,I=b[16],b[16]+=b[15],b[15]-=I,I=b[17],b[17]+=b[14],b[14]-=I,I=b[8],b[8]+=b[23],b[23]-=I,I=b[9],b[9]+=b[22],b[22]-=I,I=b[24],b[24]+=b[7],b[7]-=I,I=b[25],b[25]+=b[6],b[6]-=I,I=b[4],b[4]+=b[27],b[27]-=I,I=b[5],b[5]+=b[26],b[26]-=I,I=b[20],b[20]+=b[11],b[11]-=I,I=b[21],b[21]+=b[10],b[10]-=I,I=b[12],b[12]+=b[19],b[19]-=I,I=b[13],b[13]+=b[18],b[18]-=I,I=b[28],b[28]+=b[3],b[3]-=I,I=b[29],b[29]+=b[2],b[2]-=I}}function m(v,S){for(var b=0;b<3;b++){var T,w,R,C,N,U;C=v[S+6]*c[s.SHORT_TYPE][0]-v[S+15],T=v[S+0]*c[s.SHORT_TYPE][2]-v[S+9],w=C+T,R=C-T,C=v[S+15]*c[s.SHORT_TYPE][0]+v[S+6],T=v[S+9]*c[s.SHORT_TYPE][2]+v[S+0],N=C+T,U=-C+T,T=(v[S+3]*c[s.SHORT_TYPE][1]-v[S+12])*2069978111953089e-26,C=(v[S+12]*c[s.SHORT_TYPE][1]+v[S+3])*2069978111953089e-26,v[S+0]=w*190752519173728e-25+T,v[S+15]=-N*190752519173728e-25+C,R=R*.8660254037844387*1907525191737281e-26,N=N*.5*1907525191737281e-26+C,v[S+3]=R-N,v[S+6]=R+N,w=w*.5*1907525191737281e-26-T,U=U*.8660254037844387*1907525191737281e-26,v[S+9]=w+U,v[S+12]=w-U,S++}}function _(v,S,b){var T,w;{var R,C,N,U,B,$,I,L;R=b[17]-b[9],N=b[15]-b[11],U=b[14]-b[12],B=b[0]+b[8],$=b[1]+b[7],I=b[2]+b[6],L=b[3]+b[5],v[S+17]=B+I-L-($-b[4]),w=(B+I-L)*u[19]+($-b[4]),T=(R-N-U)*u[18],v[S+5]=T+w,v[S+6]=T-w,C=(b[16]-b[10])*u[18],$=$*u[19]+b[4],T=R*u[12]+C+N*u[13]+U*u[14],w=-B*u[16]+$-I*u[17]+L*u[15],v[S+1]=T+w,v[S+2]=T-w,T=R*u[13]-C-N*u[14]+U*u[12],w=-B*u[17]+$-I*u[15]+L*u[16],v[S+9]=T+w,v[S+10]=T-w,T=R*u[14]-C+N*u[12]-U*u[13],w=B*u[15]-$+I*u[16]-L*u[17],v[S+13]=T+w,v[S+14]=T-w}{var P,H,X,G,Y,J,Q,z;P=b[8]-b[0],X=b[6]-b[2],G=b[5]-b[3],Y=b[17]+b[9],J=b[16]+b[10],Q=b[15]+b[11],z=b[14]+b[12],v[S+0]=Y+Q+z+(J+b[13]),T=(Y+Q+z)*u[19]-(J+b[13]),w=(P-X+G)*u[18],v[S+11]=T+w,v[S+12]=T-w,H=(b[7]-b[1])*u[18],J=b[13]-J*u[19],T=Y*u[15]-J+Q*u[16]+z*u[17],w=P*u[14]+H+X*u[12]+G*u[13],v[S+3]=T+w,v[S+4]=T-w,T=-Y*u[17]+J-Q*u[15]-z*u[16],w=P*u[13]+H-X*u[14]-G*u[12],v[S+7]=T+w,v[S+8]=T-w,T=-Y*u[16]+J-Q*u[17]-z*u[15],w=P*u[12]-H+X*u[13]-G*u[14],v[S+15]=T+w,v[S+16]=T-w}}this.mdct_sub48=function(v,S,b){for(var T=S,w=286,R=0;R<v.channels_out;R++){for(var C=0;C<v.mode_gr;C++){for(var N,U=v.l3_side.tt[C][R],B=U.xr,$=0,I=v.sb_sample[R][1-C],L=0,P=0;P<18/2;P++)for(p(T,w,I[L]),p(T,w+32,I[L+1]),L+=2,w+=64,N=1;N<32;N+=2)I[L-1][N]*=-1;for(N=0;N<32;N++,$+=18){var H=U.block_type,X=v.sb_sample[R][C],G=v.sb_sample[R][1-C];if(U.mixed_block_flag!=0&&N<2&&(H=0),v.amp_filter[N]<1e-12)r.fill(B,$+0,$+18,0);else{if(v.amp_filter[N]<1)for(var P=0;P<18;P++)G[P][d[N]]*=v.amp_filter[N];if(H==s.SHORT_TYPE){for(var P=-12/4;P<0;P++){var Y=c[s.SHORT_TYPE][P+3];B[$+P*3+9]=X[9+P][d[N]]*Y-X[8-P][d[N]],B[$+P*3+18]=X[14-P][d[N]]*Y+X[15+P][d[N]],B[$+P*3+10]=X[15+P][d[N]]*Y-X[14-P][d[N]],B[$+P*3+19]=G[2-P][d[N]]*Y+G[3+P][d[N]],B[$+P*3+11]=G[3+P][d[N]]*Y-G[2-P][d[N]],B[$+P*3+20]=G[8-P][d[N]]*Y+G[9+P][d[N]]}m(B,$)}else{for(var J=i(18),P=-36/4;P<0;P++){var Q,z;Q=c[H][P+27]*G[P+9][d[N]]+c[H][P+36]*G[8-P][d[N]],z=c[H][P+9]*X[P+9][d[N]]-c[H][P+18]*X[8-P][d[N]],J[P+9]=Q-z*l[3+P+9],J[P+18]=Q*l[3+P+9]+z}_(B,$,J)}}if(H!=s.SHORT_TYPE&&N!=0)for(var P=7;P>=0;--P){var q,ee;q=B[$+P]*h[20+P]+B[$+-1-P]*f[28+P],ee=B[$+P]*f[28+P]-B[$+-1-P]*h[20+P],B[$+-1-P]=q,B[$+P]=ee}}}if(T=b,w=286,v.mode_gr==1)for(var te=0;te<18;te++)e.arraycopy(v.sb_sample[R][1][te],0,v.sb_sample[R][0][te],0,32)}}}return L2=o,L2}var U2,kV;function jne(){if(kV)return U2;kV=1;var n=Yl(),e=No,t=e.System,r=e.new_float,i=e.new_float_n;function s(){this.l=r(n.SBMAX_l),this.s=i([n.SBMAX_s,3]);var o=this;this.assign=function(a){t.arraycopy(a.l,0,o.l,0,n.SBMAX_l);for(var c=0;c<n.SBMAX_s;c++)for(var l=0;l<3;l++)o.s[c][l]=a.s[c][l]}}return U2=s,U2}var B2,MV;function Q7e(){if(MV)return B2;MV=1;var n=jne();function e(){this.thm=new n,this.en=new n}return B2=e,B2}function Ap(n){var e=n;this.ordinal=function(){return e}}Ap.STEREO=new Ap(0);Ap.JOINT_STEREO=new Ap(1);Ap.DUAL_CHANNEL=new Ap(2);Ap.MONO=new Ap(3);Ap.NOT_SET=new Ap(4);var HC=Ap,F2,IV;function Yl(){if(IV)return F2;IV=1;var n=No,e=n.System,t=n.VbrMode,r=n.new_array_n,i=n.new_float,s=n.new_float_n,o=n.new_int,a=n.assert;c.ENCDELAY=576,c.POSTDELAY=1152,c.MDCTDELAY=48,c.FFTOFFSET=224+c.MDCTDELAY,c.DECDELAY=528,c.SBLIMIT=32,c.CBANDS=64,c.SBPSY_l=21,c.SBPSY_s=12,c.SBMAX_l=22,c.SBMAX_s=13,c.PSFB21=6,c.PSFB12=6,c.BLKSIZE=1024,c.HBLKSIZE=c.BLKSIZE/2+1,c.BLKSIZE_s=256,c.HBLKSIZE_s=c.BLKSIZE_s/2+1,c.NORM_TYPE=0,c.START_TYPE=1,c.SHORT_TYPE=2,c.STOP_TYPE=3,c.MPG_MD_LR_LR=0,c.MPG_MD_LR_I=1,c.MPG_MD_MS_LR=2,c.MPG_MD_MS_I=3,c.fircoef=[-.0207887*5,-.0378413*5,-.0432472*5,-.031183*5,779609e-23*5,.0467745*5,.10091*5,.151365*5,.187098*5];function c(){var l=J7e(),u=Q7e(),h=HC,f=c.FFTOFFSET,d=c.MPG_MD_MS_LR,p=null;this.psy=null;var m=null,_=null,v=null;this.setModules=function(R,C,N,U){p=R,this.psy=C,m=C,_=U,v=N};var S=new l;function b(R){var C,N;if(R.ATH.useAdjust==0){R.ATH.adjust=1;return}if(N=R.loudness_sq[0][0],C=R.loudness_sq[1][0],R.channels_out==2?(N+=R.loudness_sq[0][1],C+=R.loudness_sq[1][1]):(N+=N,C+=C),R.mode_gr==2&&(N=Math.max(N,C)),N*=.5,N*=R.ATH.aaSensitivityP,N>.03125)R.ATH.adjust>=1?R.ATH.adjust=1:R.ATH.adjust<R.ATH.adjustLimit&&(R.ATH.adjust=R.ATH.adjustLimit),R.ATH.adjustLimit=1;else{var U=31.98*N+625e-6;R.ATH.adjust>=U?(R.ATH.adjust*=U*.075+.925,R.ATH.adjust<U&&(R.ATH.adjust=U)):R.ATH.adjustLimit>=U?R.ATH.adjust=U:R.ATH.adjust<R.ATH.adjustLimit&&(R.ATH.adjust=R.ATH.adjustLimit),R.ATH.adjustLimit=U}}function T(R){var C,N;for(a(0<=R.bitrate_index&&R.bitrate_index<16),a(0<=R.mode_ext&&R.mode_ext<4),R.bitrate_stereoMode_Hist[R.bitrate_index][4]++,R.bitrate_stereoMode_Hist[15][4]++,R.channels_out==2&&(R.bitrate_stereoMode_Hist[R.bitrate_index][R.mode_ext]++,R.bitrate_stereoMode_Hist[15][R.mode_ext]++),C=0;C<R.mode_gr;++C)for(N=0;N<R.channels_out;++N){var U=R.l3_side.tt[C][N].block_type|0;R.l3_side.tt[C][N].mixed_block_flag!=0&&(U=4),R.bitrate_blockType_Hist[R.bitrate_index][U]++,R.bitrate_blockType_Hist[R.bitrate_index][5]++,R.bitrate_blockType_Hist[15][U]++,R.bitrate_blockType_Hist[15][5]++}}function w(R,C){var N=R.internal_flags,U,B;if(N.lame_encode_frame_init==0){var $,I,L=i(2014),P=i(2014);for(N.lame_encode_frame_init=1,$=0,I=0;$<286+576*(1+N.mode_gr);++$)$<576*N.mode_gr?(L[$]=0,N.channels_out==2&&(P[$]=0)):(L[$]=C[0][I],N.channels_out==2&&(P[$]=C[1][I]),++I);for(B=0;B<N.mode_gr;B++)for(U=0;U<N.channels_out;U++)N.l3_side.tt[B][U].block_type=c.SHORT_TYPE;S.mdct_sub48(N,L,P),a(576>=c.FFTOFFSET),a(N.mf_size>=c.BLKSIZE+R.framesize-c.FFTOFFSET),a(N.mf_size>=512+R.framesize-32)}}this.lame_encode_mp3_frame=function(R,C,N,U,B,$){var I,L=r([2,2]);L[0][0]=new u,L[0][1]=new u,L[1][0]=new u,L[1][1]=new u;var P=r([2,2]);P[0][0]=new u,P[0][1]=new u,P[1][0]=new u,P[1][1]=new u;var H,X=[null,null],G=R.internal_flags,Y=s([2,4]),J=[.5,.5],Q=[[0,0],[0,0]],z=[[0,0],[0,0]],q,ee,te;if(X[0]=C,X[1]=N,G.lame_encode_frame_init==0&&w(R,X),G.padding=0,(G.slot_lag-=G.frac_SpF)<0&&(G.slot_lag+=R.out_samplerate,G.padding=1),G.psymodel!=0){var ie,Ee=[null,null],Re=0,Te=o(2);for(te=0;te<G.mode_gr;te++){for(ee=0;ee<G.channels_out;ee++)Ee[ee]=X[ee],Re=576+te*576-c.FFTOFFSET;if(R.VBR==t.vbr_mtrh||R.VBR==t.vbr_mt?ie=m.L3psycho_anal_vbr(R,Ee,Re,te,L,P,Q[te],z[te],Y[te],Te):ie=m.L3psycho_anal_ns(R,Ee,Re,te,L,P,Q[te],z[te],Y[te],Te),ie!=0)return-4;for(R.mode==h.JOINT_STEREO&&(J[te]=Y[te][2]+Y[te][3],J[te]>0&&(J[te]=Y[te][3]/J[te])),ee=0;ee<G.channels_out;ee++){var Pe=G.l3_side.tt[te][ee];Pe.block_type=Te[ee],Pe.mixed_block_flag=0}}}else for(te=0;te<G.mode_gr;te++)for(ee=0;ee<G.channels_out;ee++)G.l3_side.tt[te][ee].block_type=c.NORM_TYPE,G.l3_side.tt[te][ee].mixed_block_flag=0,z[te][ee]=Q[te][ee]=700;if(b(G),S.mdct_sub48(G,X[0],X[1]),G.mode_ext=c.MPG_MD_LR_LR,R.force_ms)G.mode_ext=c.MPG_MD_MS_LR;else if(R.mode==h.JOINT_STEREO){var We=0,it=0;for(te=0;te<G.mode_gr;te++)for(ee=0;ee<G.channels_out;ee++)We+=z[te][ee],it+=Q[te][ee];if(We<=1*it){var ht=G.l3_side.tt[0],vt=G.l3_side.tt[G.mode_gr-1];ht[0].block_type==ht[1].block_type&&vt[0].block_type==vt[1].block_type&&(G.mode_ext=c.MPG_MD_MS_LR)}}if(G.mode_ext==d?(H=P,q=z):(H=L,q=Q),R.analysis&&G.pinfo!=null)for(te=0;te<G.mode_gr;te++)for(ee=0;ee<G.channels_out;ee++)G.pinfo.ms_ratio[te]=G.ms_ratio[te],G.pinfo.ms_ener_ratio[te]=J[te],G.pinfo.blocktype[te][ee]=G.l3_side.tt[te][ee].block_type,G.pinfo.pe[te][ee]=q[te][ee],e.arraycopy(G.l3_side.tt[te][ee].xr,0,G.pinfo.xr[te][ee],0,576),G.mode_ext==d&&(G.pinfo.ers[te][ee]=G.pinfo.ers[te][ee+2],e.arraycopy(G.pinfo.energy[te][ee+2],0,G.pinfo.energy[te][ee],0,G.pinfo.energy[te][ee].length));if(R.VBR==t.vbr_off||R.VBR==t.vbr_abr){var re,Le;for(re=0;re<18;re++)G.nsPsy.pefirbuf[re]=G.nsPsy.pefirbuf[re+1];for(Le=0,te=0;te<G.mode_gr;te++)for(ee=0;ee<G.channels_out;ee++)Le+=q[te][ee];for(G.nsPsy.pefirbuf[18]=Le,Le=G.nsPsy.pefirbuf[9],re=0;re<9;re++)Le+=(G.nsPsy.pefirbuf[re]+G.nsPsy.pefirbuf[18-re])*c.fircoef[re];for(Le=670*5*G.mode_gr*G.channels_out/Le,te=0;te<G.mode_gr;te++)for(ee=0;ee<G.channels_out;ee++)q[te][ee]*=Le}if(G.iteration_loop.iteration_loop(R,q,J,H),p.format_bitstream(R),I=p.copy_buffer(G,U,B,$,1),R.bWriteVbrTag&&_.addVbrFrame(R),R.analysis&&G.pinfo!=null){for(ee=0;ee<G.channels_out;ee++){var $e;for($e=0;$e<f;$e++)G.pinfo.pcmdata[ee][$e]=G.pinfo.pcmdata[ee][$e+R.framesize];for($e=f;$e<1600;$e++)G.pinfo.pcmdata[ee][$e]=X[ee][$e-f]}v.set_frame_pinfo(R,H)}return T(G),I}}return F2=c,F2}var zne=No,OV=zne.Util,NV=zne.new_float,Ca=Yl();function e9e(){var n=NV(Ca.BLKSIZE),e=NV(Ca.BLKSIZE_s/2),t=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function r(s,o,a){var c=0,l,u,h;a<<=1;var f=o+a;l=4;do{var d,p,m,_,v,S,b;b=l>>1,_=l,v=l<<1,S=v+_,l=v<<1,u=o,h=u+b;do{var T,w,R,C;w=s[u+0]-s[u+_],T=s[u+0]+s[u+_],C=s[u+v]-s[u+S],R=s[u+v]+s[u+S],s[u+v]=T-R,s[u+0]=T+R,s[u+S]=w-C,s[u+_]=w+C,w=s[h+0]-s[h+_],T=s[h+0]+s[h+_],C=OV.SQRT2*s[h+S],R=OV.SQRT2*s[h+v],s[h+v]=T-R,s[h+0]=T+R,s[h+S]=w-C,s[h+_]=w+C,h+=l,u+=l}while(u<f);for(p=t[c+0],d=t[c+1],m=1;m<b;m++){var N,U;N=1-2*d*d,U=2*d*p,u=o+m,h=o+_-m;do{var B,$,I,T,w,L,R,P,C,H;$=U*s[u+_]-N*s[h+_],B=N*s[u+_]+U*s[h+_],w=s[u+0]-B,T=s[u+0]+B,L=s[h+0]-$,I=s[h+0]+$,$=U*s[u+S]-N*s[h+S],B=N*s[u+S]+U*s[h+S],C=s[u+v]-B,R=s[u+v]+B,H=s[h+v]-$,P=s[h+v]+$,$=d*R-p*H,B=p*R+d*H,s[u+v]=T-B,s[u+0]=T+B,s[h+S]=L-$,s[h+_]=L+$,$=p*P-d*C,B=d*P+p*C,s[h+v]=I-B,s[h+0]=I+B,s[u+S]=w-$,s[u+_]=w+$,h+=l,u+=l}while(u<f);N=p,p=N*t[c+0]-d*t[c+1],d=N*t[c+1]+d*t[c+0]}c+=2}while(l<a)}var i=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(s,o,a,c,l){for(var u=0;u<3;u++){var h=Ca.BLKSIZE_s/2,f=65535&576/3*(u+1),d=Ca.BLKSIZE_s/8-1;do{var p,m,_,v,S,b=i[d<<2]&255;p=e[b]*c[a][l+b+f],S=e[127-b]*c[a][l+b+f+128],m=p-S,p=p+S,_=e[b+64]*c[a][l+b+f+64],S=e[63-b]*c[a][l+b+f+192],v=_-S,_=_+S,h-=4,o[u][h+0]=p+_,o[u][h+2]=p-_,o[u][h+1]=m+v,o[u][h+3]=m-v,p=e[b+1]*c[a][l+b+f+1],S=e[126-b]*c[a][l+b+f+129],m=p-S,p=p+S,_=e[b+65]*c[a][l+b+f+65],S=e[62-b]*c[a][l+b+f+193],v=_-S,_=_+S,o[u][h+Ca.BLKSIZE_s/2+0]=p+_,o[u][h+Ca.BLKSIZE_s/2+2]=p-_,o[u][h+Ca.BLKSIZE_s/2+1]=m+v,o[u][h+Ca.BLKSIZE_s/2+3]=m-v}while(--d>=0);r(o[u],h,Ca.BLKSIZE_s/2)}},this.fft_long=function(s,o,a,c,l){var u=Ca.BLKSIZE/8-1,h=Ca.BLKSIZE/2;do{var f,d,p,m,_,v=i[u]&255;f=n[v]*c[a][l+v],_=n[v+512]*c[a][l+v+512],d=f-_,f=f+_,p=n[v+256]*c[a][l+v+256],_=n[v+768]*c[a][l+v+768],m=p-_,p=p+_,h-=4,o[h+0]=f+p,o[h+2]=f-p,o[h+1]=d+m,o[h+3]=d-m,f=n[v+1]*c[a][l+v+1],_=n[v+513]*c[a][l+v+513],d=f-_,f=f+_,p=n[v+257]*c[a][l+v+257],_=n[v+769]*c[a][l+v+769],m=p-_,p=p+_,o[h+Ca.BLKSIZE/2+0]=f+p,o[h+Ca.BLKSIZE/2+2]=f-p,o[h+Ca.BLKSIZE/2+1]=d+m,o[h+Ca.BLKSIZE/2+3]=d-m}while(--u>=0);r(o,h,Ca.BLKSIZE/2)},this.init_fft=function(s){for(var o=0;o<Ca.BLKSIZE;o++)n[o]=.42-.5*Math.cos(2*Math.PI*(o+.5)/Ca.BLKSIZE)+.08*Math.cos(4*Math.PI*(o+.5)/Ca.BLKSIZE);for(var o=0;o<Ca.BLKSIZE_s/2;o++)e[o]=.5*(1-Math.cos(2*Math.PI*(o+.5)/Ca.BLKSIZE_s))}}var t9e=e9e,g_=No,eE=g_.VbrMode,PV=g_.Float,tE=g_.ShortBlock,ih=g_.Util,n9e=g_.Arrays,za=g_.new_float,Yf=g_.new_float_n,tb=g_.new_int,Xr=g_.assert,r9e=t9e,Gt=Yl();function i9e(){var n=HC,e=new r9e,t=2.302585092994046,r=2,i=16,s=2,o=16,a=.34,c=1/(14752*14752)/(Gt.BLKSIZE/2),l=.01,u=.8,h=.6,f=.3,d=3.5,p=21,m=.2302585093;function _(W,oe){for(var Se=0,Ae=0;Ae<Gt.BLKSIZE/2;++Ae)Se+=W[Ae]*oe.ATH.eql_w[Ae];return Se*=c,Se}function v(W,oe,Se,Ae,ye,_e,Ye,ke,Ve,Fe,Ge){var at=W.internal_flags;if(Ve<2)e.fft_long(at,Ae[ye],Ve,Fe,Ge),e.fft_short(at,_e[Ye],Ve,Fe,Ge);else if(Ve==2){for(var Be=Gt.BLKSIZE-1;Be>=0;--Be){var tt=Ae[ye+0][Be],rt=Ae[ye+1][Be];Ae[ye+0][Be]=(tt+rt)*ih.SQRT2*.5,Ae[ye+1][Be]=(tt-rt)*ih.SQRT2*.5}for(var xt=2;xt>=0;--xt)for(var Be=Gt.BLKSIZE_s-1;Be>=0;--Be){var tt=_e[Ye+0][xt][Be],rt=_e[Ye+1][xt][Be];_e[Ye+0][xt][Be]=(tt+rt)*ih.SQRT2*.5,_e[Ye+1][xt][Be]=(tt-rt)*ih.SQRT2*.5}}oe[0]=Ae[ye+0][0],oe[0]*=oe[0];for(var Be=Gt.BLKSIZE/2-1;Be>=0;--Be){var ot=Ae[ye+0][Gt.BLKSIZE/2-Be],tn=Ae[ye+0][Gt.BLKSIZE/2+Be];oe[Gt.BLKSIZE/2-Be]=(ot*ot+tn*tn)*.5}for(var xt=2;xt>=0;--xt){Se[xt][0]=_e[Ye+0][xt][0],Se[xt][0]*=Se[xt][0];for(var Be=Gt.BLKSIZE_s/2-1;Be>=0;--Be){var ot=_e[Ye+0][xt][Gt.BLKSIZE_s/2-Be],tn=_e[Ye+0][xt][Gt.BLKSIZE_s/2+Be];Se[xt][Gt.BLKSIZE_s/2-Be]=(ot*ot+tn*tn)*.5}}{for(var ln=0,Be=11;Be<Gt.HBLKSIZE;Be++)ln+=oe[Be];at.tot_ener[Ve]=ln}if(W.analysis){for(var Be=0;Be<Gt.HBLKSIZE;Be++)at.pinfo.energy[ke][Ve][Be]=at.pinfo.energy_save[Ve][Be],at.pinfo.energy_save[Ve][Be]=oe[Be];at.pinfo.pe[ke][Ve]=at.pe[Ve]}W.athaa_loudapprox==2&&Ve<2&&(at.loudness_sq[ke][Ve]=at.loudness_sq_save[Ve],at.loudness_sq_save[Ve]=_(oe,at))}var S=8,b=23,T=15,w,R,C,N=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749];function U(){w=Math.pow(10,(S+1)/16),R=Math.pow(10,(b+1)/16),C=Math.pow(10,T/10)}var B=[3.3246*3.3246,3.23837*3.23837,3.15437*3.15437,3.00412*3.00412,2.86103*2.86103,2.65407*2.65407,2.46209*2.46209,2.284*2.284,2.11879*2.11879,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,1.56911*1.56911,1.46658*1.46658,1.37074*1.37074,1.31036*1.31036,1.25264*1.25264,1.20648*1.20648,1.16203*1.16203,1.12765*1.12765,1.09428*1.09428,1.0659*1.0659,1.03826*1.03826,1.01895*1.01895,1],$=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1],I=[2.35364*2.35364,2.29259*2.29259,2.23313*2.23313,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,1.49999*1.49999,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.11084*1.11084,1.03826*1.03826];function L(W,oe,Se,Ae,ye,_e){var Ye;if(oe>W)if(oe<W*R)Ye=oe/W;else return W+oe;else{if(W>=oe*R)return W+oe;Ye=W/oe}if(W+=oe,Ae+3<=6){if(Ye>=w)return W;var ke=0|ih.FAST_LOG10_X(Ye,16);return W*$[ke]}var ke=0|ih.FAST_LOG10_X(Ye,16);if(oe=ye.ATH.cb_l[Se]*ye.ATH.adjust,W<C*oe){if(W>oe){var Ve,Fe;return Ve=1,ke<=13&&(Ve=I[ke]),Fe=ih.FAST_LOG10_X(W/oe,10/15),W*((B[ke]-Ve)*Fe+Ve)}return ke>13?W:W*I[ke]}return W*B[ke]}var P=[1.33352*1.33352,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.30382*1.30382,1.22321*1.22321,1.14758*1.14758,1];function H(W,oe,Se){var Ae;if(W<0&&(W=0),oe<0&&(oe=0),W<=0)return oe;if(oe<=0)return W;if(oe>W?Ae=oe/W:Ae=W/oe,-2<=Se&&Se<=2){if(Ae>=w)return W+oe;var ye=0|ih.FAST_LOG10_X(Ae,16);return(W+oe)*P[ye]}return Ae<R?W+oe:(W<oe&&(W=oe),W)}function X(W,oe){var Se=W.internal_flags;if(Se.channels_out>1){for(var Ae=0;Ae<Gt.SBMAX_l;Ae++){var ye=Se.thm[0].l[Ae],_e=Se.thm[1].l[Ae];Se.thm[0].l[Ae]+=_e*oe,Se.thm[1].l[Ae]+=ye*oe}for(var Ae=0;Ae<Gt.SBMAX_s;Ae++)for(var Ye=0;Ye<3;Ye++){var ye=Se.thm[0].s[Ae][Ye],_e=Se.thm[1].s[Ae][Ye];Se.thm[0].s[Ae][Ye]+=_e*oe,Se.thm[1].s[Ae][Ye]+=ye*oe}}}function G(W){for(var oe=0;oe<Gt.SBMAX_l;oe++)if(!(W.thm[0].l[oe]>1.58*W.thm[1].l[oe]||W.thm[1].l[oe]>1.58*W.thm[0].l[oe])){var Se=W.mld_l[oe]*W.en[3].l[oe],Ae=Math.max(W.thm[2].l[oe],Math.min(W.thm[3].l[oe],Se));Se=W.mld_l[oe]*W.en[2].l[oe];var ye=Math.max(W.thm[3].l[oe],Math.min(W.thm[2].l[oe],Se));W.thm[2].l[oe]=Ae,W.thm[3].l[oe]=ye}for(var oe=0;oe<Gt.SBMAX_s;oe++)for(var _e=0;_e<3;_e++)if(!(W.thm[0].s[oe][_e]>1.58*W.thm[1].s[oe][_e]||W.thm[1].s[oe][_e]>1.58*W.thm[0].s[oe][_e])){var Se=W.mld_s[oe]*W.en[3].s[oe][_e],Ae=Math.max(W.thm[2].s[oe][_e],Math.min(W.thm[3].s[oe][_e],Se));Se=W.mld_s[oe]*W.en[2].s[oe][_e];var ye=Math.max(W.thm[3].s[oe][_e],Math.min(W.thm[2].s[oe][_e],Se));W.thm[2].s[oe][_e]=Ae,W.thm[3].s[oe][_e]=ye}}function Y(W,oe,Se){var Ae=oe,ye=Math.pow(10,Se);oe*=2,Ae*=2;for(var _e=0;_e<Gt.SBMAX_l;_e++){var Ye,ke,Ve,Fe;if(Fe=W.ATH.cb_l[W.bm_l[_e]]*ye,Ye=Math.min(Math.max(W.thm[0].l[_e],Fe),Math.max(W.thm[1].l[_e],Fe)),ke=Math.max(W.thm[2].l[_e],Fe),Ve=Math.max(W.thm[3].l[_e],Fe),Ye*oe<ke+Ve){var Ge=Ye*Ae/(ke+Ve);ke*=Ge,Ve*=Ge}W.thm[2].l[_e]=Math.min(ke,W.thm[2].l[_e]),W.thm[3].l[_e]=Math.min(Ve,W.thm[3].l[_e])}ye*=Gt.BLKSIZE_s/Gt.BLKSIZE;for(var _e=0;_e<Gt.SBMAX_s;_e++)for(var at=0;at<3;at++){var Ye,ke,Ve,Fe;if(Fe=W.ATH.cb_s[W.bm_s[_e]]*ye,Ye=Math.min(Math.max(W.thm[0].s[_e][at],Fe),Math.max(W.thm[1].s[_e][at],Fe)),ke=Math.max(W.thm[2].s[_e][at],Fe),Ve=Math.max(W.thm[3].s[_e][at],Fe),Ye*oe<ke+Ve){var Ge=Ye*oe/(ke+Ve);ke*=Ge,Ve*=Ge}W.thm[2].s[_e][at]=Math.min(W.thm[2].s[_e][at],ke),W.thm[3].s[_e][at]=Math.min(W.thm[3].s[_e][at],Ve)}}function J(W,oe,Se,Ae,ye){var _e,Ye,ke=0,Ve=0;for(_e=Ye=0;_e<Gt.SBMAX_s;++Ye,++_e){for(var Fe=W.bo_s[_e],Ge=W.npart_s,at=Fe<Ge?Fe:Ge;Ye<at;)Xr(oe[Ye]>=0),Xr(Se[Ye]>=0),ke+=oe[Ye],Ve+=Se[Ye],Ye++;if(W.en[Ae].s[_e][ye]=ke,W.thm[Ae].s[_e][ye]=Ve,Ye>=Ge){++_e;break}Xr(oe[Ye]>=0),Xr(Se[Ye]>=0);{var Be=W.PSY.bo_s_weight[_e],tt=1-Be;ke=Be*oe[Ye],Ve=Be*Se[Ye],W.en[Ae].s[_e][ye]+=ke,W.thm[Ae].s[_e][ye]+=Ve,ke=tt*oe[Ye],Ve=tt*Se[Ye]}}for(;_e<Gt.SBMAX_s;++_e)W.en[Ae].s[_e][ye]=0,W.thm[Ae].s[_e][ye]=0}function Q(W,oe,Se,Ae){var ye,_e,Ye=0,ke=0;for(ye=_e=0;ye<Gt.SBMAX_l;++_e,++ye){for(var Ve=W.bo_l[ye],Fe=W.npart_l,Ge=Ve<Fe?Ve:Fe;_e<Ge;)Xr(oe[_e]>=0),Xr(Se[_e]>=0),Ye+=oe[_e],ke+=Se[_e],_e++;if(W.en[Ae].l[ye]=Ye,W.thm[Ae].l[ye]=ke,_e>=Fe){++ye;break}Xr(oe[_e]>=0),Xr(Se[_e]>=0);{var at=W.PSY.bo_l_weight[ye],Be=1-at;Ye=at*oe[_e],ke=at*Se[_e],W.en[Ae].l[ye]+=Ye,W.thm[Ae].l[ye]+=ke,Ye=Be*oe[_e],ke=Be*Se[_e]}}for(;ye<Gt.SBMAX_l;++ye)W.en[Ae].l[ye]=0,W.thm[Ae].l[ye]=0}function z(W,oe,Se,Ae,ye,_e){var Ye=W.internal_flags,ke,Ve;for(Ve=ke=0;Ve<Ye.npart_s;++Ve){for(var Fe=0,Ge=Ye.numlines_s[Ve],at=0;at<Ge;++at,++ke){var Be=oe[_e][ke];Fe+=Be}Se[Ve]=Fe}for(Xr(Ve==Ye.npart_s),ke=Ve=0;Ve<Ye.npart_s;Ve++){var tt=Ye.s3ind_s[Ve][0],rt=Ye.s3_ss[ke++]*Se[tt];for(++tt;tt<=Ye.s3ind_s[Ve][1];)rt+=Ye.s3_ss[ke]*Se[tt],++ke,++tt;{var xt=s*Ye.nb_s1[ye][Ve];Ae[Ve]=Math.min(rt,xt)}if(Ye.blocktype_old[ye&1]==Gt.SHORT_TYPE){var xt=o*Ye.nb_s2[ye][Ve],ot=Ae[Ve];Ae[Ve]=Math.min(xt,ot)}Ye.nb_s2[ye][Ve]=Ye.nb_s1[ye][Ve],Ye.nb_s1[ye][Ve]=rt,Xr(Ae[Ve]>=0)}for(;Ve<=Gt.CBANDS;++Ve)Se[Ve]=0,Ae[Ve]=0}function q(W,oe,Se,Ae){var ye=W.internal_flags;W.short_blocks==tE.short_block_coupled&&!(oe[0]!=0&&oe[1]!=0)&&(oe[0]=oe[1]=0);for(var _e=0;_e<ye.channels_out;_e++)Ae[_e]=Gt.NORM_TYPE,W.short_blocks==tE.short_block_dispensed&&(oe[_e]=1),W.short_blocks==tE.short_block_forced&&(oe[_e]=0),oe[_e]!=0?(Xr(ye.blocktype_old[_e]!=Gt.START_TYPE),ye.blocktype_old[_e]==Gt.SHORT_TYPE&&(Ae[_e]=Gt.STOP_TYPE)):(Ae[_e]=Gt.SHORT_TYPE,ye.blocktype_old[_e]==Gt.NORM_TYPE&&(ye.blocktype_old[_e]=Gt.START_TYPE),ye.blocktype_old[_e]==Gt.STOP_TYPE&&(ye.blocktype_old[_e]=Gt.SHORT_TYPE)),Se[_e]=ye.blocktype_old[_e],ye.blocktype_old[_e]=Ae[_e]}function ee(W,oe,Se){return Se>=1?W:Se<=0?oe:oe>0?Math.pow(W/oe,Se)*oe:0}var te=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function ie(W,oe){for(var Se=309.07,Ae=0;Ae<Gt.SBMAX_s-1;Ae++)for(var ye=0;ye<3;ye++){var _e=W.thm.s[Ae][ye];if(_e>0){var Ye=_e*oe,ke=W.en.s[Ae][ye];ke>Ye&&(ke>Ye*1e10?Se+=te[Ae]*(10*t):Se+=te[Ae]*ih.FAST_LOG10(ke/Ye))}}return Se}var Ee=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function Re(W,oe){for(var Se=281.0575,Ae=0;Ae<Gt.SBMAX_l-1;Ae++){var ye=W.thm.l[Ae];if(ye>0){var _e=ye*oe,Ye=W.en.l[Ae];Ye>_e&&(Ye>_e*1e10?Se+=Ee[Ae]*(10*t):Se+=Ee[Ae]*ih.FAST_LOG10(Ye/_e))}}return Se}function Te(W,oe,Se,Ae,ye){var _e,Ye;for(_e=Ye=0;_e<W.npart_l;++_e){var ke=0,Ve=0,Fe;for(Fe=0;Fe<W.numlines_l[_e];++Fe,++Ye){var Ge=oe[Ye];ke+=Ge,Ve<Ge&&(Ve=Ge)}Se[_e]=ke,Ae[_e]=Ve,ye[_e]=ke*W.rnumlines_l[_e],Xr(W.rnumlines_l[_e]>=0),Xr(Se[_e]>=0),Xr(Ae[_e]>=0),Xr(ye[_e]>=0)}}function Pe(W,oe,Se,Ae){var ye=N.length-1,_e=0,Ye=Se[_e]+Se[_e+1];if(Ye>0){var ke=oe[_e];ke<oe[_e+1]&&(ke=oe[_e+1]),Xr(W.numlines_l[_e]+W.numlines_l[_e+1]-1>0),Ye=20*(ke*2-Ye)/(Ye*(W.numlines_l[_e]+W.numlines_l[_e+1]-1));var Ve=0|Ye;Ve>ye&&(Ve=ye),Ae[_e]=Ve}else Ae[_e]=0;for(_e=1;_e<W.npart_l-1;_e++)if(Ye=Se[_e-1]+Se[_e]+Se[_e+1],Ye>0){var ke=oe[_e-1];ke<oe[_e]&&(ke=oe[_e]),ke<oe[_e+1]&&(ke=oe[_e+1]),Xr(W.numlines_l[_e-1]+W.numlines_l[_e]+W.numlines_l[_e+1]-1>0),Ye=20*(ke*3-Ye)/(Ye*(W.numlines_l[_e-1]+W.numlines_l[_e]+W.numlines_l[_e+1]-1));var Ve=0|Ye;Ve>ye&&(Ve=ye),Ae[_e]=Ve}else Ae[_e]=0;if(Xr(_e==W.npart_l-1),Ye=Se[_e-1]+Se[_e],Ye>0){var ke=oe[_e-1];ke<oe[_e]&&(ke=oe[_e]),Xr(W.numlines_l[_e-1]+W.numlines_l[_e]-1>0),Ye=20*(ke*2-Ye)/(Ye*(W.numlines_l[_e-1]+W.numlines_l[_e]-1));var Ve=0|Ye;Ve>ye&&(Ve=ye),Ae[_e]=Ve}else Ae[_e]=0;Xr(_e==W.npart_l-1)}var We=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];this.L3psycho_anal_ns=function(W,oe,Se,Ae,ye,_e,Ye,ke,Ve,Fe){var Ge=W.internal_flags,at=Yf([2,Gt.BLKSIZE]),Be=Yf([2,3,Gt.BLKSIZE_s]),tt=za(Gt.CBANDS+1),rt=za(Gt.CBANDS+1),xt=za(Gt.CBANDS+2),ot=tb(2),tn=tb(2),ln,Rt,$t,mt,Zt,wn,qt,An,Ln=Yf([2,576]),mr,is=tb(Gt.CBANDS+2),hi=tb(Gt.CBANDS+2);for(n9e.fill(hi,0),ln=Ge.channels_out,W.mode==n.JOINT_STEREO&&(ln=4),W.VBR==eE.vbr_off?mr=Ge.ResvMax==0?0:Ge.ResvSize/Ge.ResvMax*.5:W.VBR==eE.vbr_rh||W.VBR==eE.vbr_mtrh||W.VBR==eE.vbr_mt?mr=.6:mr=1,Rt=0;Rt<Ge.channels_out;Rt++){var ti=oe[Rt],ji=Se+576-350-p+192;for(mt=0;mt<576;mt++){var ss,Yi;for(ss=ti[ji+mt+10],Yi=0,Zt=0;Zt<(p-1)/2-1;Zt+=2)ss+=We[Zt]*(ti[ji+mt+Zt]+ti[ji+mt+p-Zt]),Yi+=We[Zt+1]*(ti[ji+mt+Zt+1]+ti[ji+mt+p-Zt-1]);Ln[Rt][mt]=ss+Yi}ye[Ae][Rt].en.assign(Ge.en[Rt]),ye[Ae][Rt].thm.assign(Ge.thm[Rt]),ln>2&&(_e[Ae][Rt].en.assign(Ge.en[Rt+2]),_e[Ae][Rt].thm.assign(Ge.thm[Rt+2]))}for(Rt=0;Rt<ln;Rt++){var os,as,je=za(12),_t=[0,0,0,0],Ot=za(12),Lt=1,yt,an=za(Gt.CBANDS),On=za(Gt.CBANDS),_n=[0,0,0,0],Pn=za(Gt.HBLKSIZE),er=Yf([3,Gt.HBLKSIZE_s]);for(Xr(Ge.npart_s<=Gt.CBANDS),Xr(Ge.npart_l<=Gt.CBANDS),mt=0;mt<3;mt++)je[mt]=Ge.nsPsy.last_en_subshort[Rt][mt+6],Xr(Ge.nsPsy.last_en_subshort[Rt][mt+4]>0),Ot[mt]=je[mt]/Ge.nsPsy.last_en_subshort[Rt][mt+4],_t[0]+=je[mt];if(Rt==2)for(mt=0;mt<576;mt++){var fr,Cn;fr=Ln[0][mt],Cn=Ln[1][mt],Ln[0][mt]=fr+Cn,Ln[1][mt]=fr-Cn}{var yr=Ln[Rt&1],Vr=0;for(mt=0;mt<9;mt++){for(var ms=Vr+64,Lr=1;Vr<ms;Vr++)Lr<Math.abs(yr[Vr])&&(Lr=Math.abs(yr[Vr]));Ge.nsPsy.last_en_subshort[Rt][mt]=je[mt+3]=Lr,_t[1+mt/3]+=Lr,Lr>je[mt+3-2]?(Xr(je[mt+3-2]>0),Lr=Lr/je[mt+3-2]):je[mt+3-2]>Lr*10?Lr=je[mt+3-2]/(Lr*10):Lr=0,Ot[mt+3]=Lr}}if(W.analysis){var Gr=Ot[0];for(mt=1;mt<12;mt++)Gr<Ot[mt]&&(Gr=Ot[mt]);Ge.pinfo.ers[Ae][Rt]=Ge.pinfo.ers_save[Rt],Ge.pinfo.ers_save[Rt]=Gr}for(yt=Rt==3?Ge.nsPsy.attackthre_s:Ge.nsPsy.attackthre,mt=0;mt<12;mt++)_n[mt/3]==0&&Ot[mt]>yt&&(_n[mt/3]=mt%3+1);for(mt=1;mt<4;mt++){var or;_t[mt-1]>_t[mt]?(Xr(_t[mt]>0),or=_t[mt-1]/_t[mt]):(Xr(_t[mt-1]>0),or=_t[mt]/_t[mt-1]),or<1.7&&(_n[mt]=0,mt==1&&(_n[0]=0))}for(_n[0]!=0&&Ge.nsPsy.lastAttacks[Rt]!=0&&(_n[0]=0),(Ge.nsPsy.lastAttacks[Rt]==3||_n[0]+_n[1]+_n[2]+_n[3]!=0)&&(Lt=0,_n[1]!=0&&_n[0]!=0&&(_n[1]=0),_n[2]!=0&&_n[1]!=0&&(_n[2]=0),_n[3]!=0&&_n[2]!=0&&(_n[3]=0)),Rt<2?tn[Rt]=Lt:Lt==0&&(tn[0]=tn[1]=0),Ve[Rt]=Ge.tot_ener[Rt],as=Be,os=at,v(W,Pn,er,os,Rt&1,as,Rt&1,Ae,Rt,oe,Se),Te(Ge,Pn,tt,an,On),Pe(Ge,an,On,is),An=0;An<3;An++){var br,Un;for(z(W,er,rt,xt,Rt,An),J(Ge,rt,xt,Rt,An),qt=0;qt<Gt.SBMAX_s;qt++){if(Un=Ge.thm[Rt].s[qt][An],Un*=u,_n[An]>=2||_n[An+1]==1){var bi=An!=0?An-1:2,Lr=ee(Ge.thm[Rt].s[qt][bi],Un,h*mr);Un=Math.min(Un,Lr)}if(_n[An]==1){var bi=An!=0?An-1:2,Lr=ee(Ge.thm[Rt].s[qt][bi],Un,f*mr);Un=Math.min(Un,Lr)}else if(An!=0&&_n[An-1]==3||An==0&&Ge.nsPsy.lastAttacks[Rt]==3){var bi=An!=2?An+1:0,Lr=ee(Ge.thm[Rt].s[qt][bi],Un,f*mr);Un=Math.min(Un,Lr)}br=je[An*3+3]+je[An*3+4]+je[An*3+5],je[An*3+5]*6<br&&(Un*=.5,je[An*3+4]*6<br&&(Un*=.5)),Ge.thm[Rt].s[qt][An]=Un}}for(Ge.nsPsy.lastAttacks[Rt]=_n[2],wn=0,$t=0;$t<Ge.npart_l;$t++){for(var ai=Ge.s3ind[$t][0],Rs=tt[ai]*N[is[ai]],ho=Ge.s3_ll[wn++]*Rs;++ai<=Ge.s3ind[$t][1];)Rs=tt[ai]*N[is[ai]],ho=L(ho,Ge.s3_ll[wn++]*Rs,ai,ai-$t,Ge);ho*=.158489319246111,Ge.blocktype_old[Rt&1]==Gt.SHORT_TYPE?xt[$t]=ho:xt[$t]=ee(Math.min(ho,Math.min(r*Ge.nb_1[Rt][$t],i*Ge.nb_2[Rt][$t])),ho,mr),Ge.nb_2[Rt][$t]=Ge.nb_1[Rt][$t],Ge.nb_1[Rt][$t]=ho}for(;$t<=Gt.CBANDS;++$t)tt[$t]=0,xt[$t]=0;Q(Ge,tt,xt,Rt)}if((W.mode==n.STEREO||W.mode==n.JOINT_STEREO)&&W.interChRatio>0&&X(W,W.interChRatio),W.mode==n.JOINT_STEREO){var Mi;G(Ge),Mi=W.msfix,Math.abs(Mi)>0&&Y(Ge,Mi,W.ATHlower*Ge.ATH.adjust)}for(q(W,tn,Fe,ot),Rt=0;Rt<ln;Rt++){var Mn,Li=0,Kn,gs;Rt>1?(Mn=ke,Li=-2,Kn=Gt.NORM_TYPE,(Fe[0]==Gt.SHORT_TYPE||Fe[1]==Gt.SHORT_TYPE)&&(Kn=Gt.SHORT_TYPE),gs=_e[Ae][Rt-2]):(Mn=Ye,Li=0,Kn=Fe[Rt],gs=ye[Ae][Rt]),Kn==Gt.SHORT_TYPE?Mn[Li+Rt]=ie(gs,Ge.masking_lower):Mn[Li+Rt]=Re(gs,Ge.masking_lower),W.analysis&&(Ge.pinfo.pe[Ae][Rt]=Mn[Li+Rt])}return 0};function it(W,oe,Se,Ae,ye,_e,Ye,ke){var Ve=W.internal_flags;if(Ae<2)e.fft_long(Ve,Ye[ke],Ae,oe,Se);else if(Ae==2)for(var Fe=Gt.BLKSIZE-1;Fe>=0;--Fe){var Ge=Ye[ke+0][Fe],at=Ye[ke+1][Fe];Ye[ke+0][Fe]=(Ge+at)*ih.SQRT2*.5,Ye[ke+1][Fe]=(Ge-at)*ih.SQRT2*.5}_e[0]=Ye[ke+0][0],_e[0]*=_e[0];for(var Fe=Gt.BLKSIZE/2-1;Fe>=0;--Fe){var Be=Ye[ke+0][Gt.BLKSIZE/2-Fe],tt=Ye[ke+0][Gt.BLKSIZE/2+Fe];_e[Gt.BLKSIZE/2-Fe]=(Be*Be+tt*tt)*.5}{for(var rt=0,Fe=11;Fe<Gt.HBLKSIZE;Fe++)rt+=_e[Fe];Ve.tot_ener[Ae]=rt}if(W.analysis){for(var Fe=0;Fe<Gt.HBLKSIZE;Fe++)Ve.pinfo.energy[ye][Ae][Fe]=Ve.pinfo.energy_save[Ae][Fe],Ve.pinfo.energy_save[Ae][Fe]=_e[Fe];Ve.pinfo.pe[ye][Ae]=Ve.pe[Ae]}}function ht(W,oe,Se,Ae,ye,_e,Ye,ke){var Ve=W.internal_flags;if(ye==0&&Ae<2&&e.fft_short(Ve,Ye[ke],Ae,oe,Se),Ae==2)for(var Fe=Gt.BLKSIZE_s-1;Fe>=0;--Fe){var Ge=Ye[ke+0][ye][Fe],at=Ye[ke+1][ye][Fe];Ye[ke+0][ye][Fe]=(Ge+at)*ih.SQRT2*.5,Ye[ke+1][ye][Fe]=(Ge-at)*ih.SQRT2*.5}_e[ye][0]=Ye[ke+0][ye][0],_e[ye][0]*=_e[ye][0];for(var Fe=Gt.BLKSIZE_s/2-1;Fe>=0;--Fe){var Be=Ye[ke+0][ye][Gt.BLKSIZE_s/2-Fe],tt=Ye[ke+0][ye][Gt.BLKSIZE_s/2+Fe];_e[ye][Gt.BLKSIZE_s/2-Fe]=(Be*Be+tt*tt)*.5}}function vt(W,oe,Se,Ae){var ye=W.internal_flags;W.athaa_loudapprox==2&&Se<2&&(ye.loudness_sq[oe][Se]=ye.loudness_sq_save[Se],ye.loudness_sq_save[Se]=_(Ae,ye))}var re=[-865163e-23*2,-.00851586*2,-674764e-23*2,.0209036*2,-336639e-22*2,-.0438162*2,-154175e-22*2,.0931738*2,-552212e-22*2,-.313819*2];function Le(W,oe,Se,Ae,ye,_e,Ye,ke,Ve,Fe){for(var Ge=Yf([2,576]),at=W.internal_flags,Be=at.channels_out,tt=W.mode==n.JOINT_STEREO?4:Be,rt=0;rt<Be;rt++){firbuf=oe[rt];for(var xt=Se+576-350-p+192,ot=0;ot<576;ot++){var tn,ln;tn=firbuf[xt+ot+10],ln=0;for(var Rt=0;Rt<(p-1)/2-1;Rt+=2)tn+=re[Rt]*(firbuf[xt+ot+Rt]+firbuf[xt+ot+p-Rt]),ln+=re[Rt+1]*(firbuf[xt+ot+Rt+1]+firbuf[xt+ot+p-Rt-1]);Ge[rt][ot]=tn+ln}ye[Ae][rt].en.assign(at.en[rt]),ye[Ae][rt].thm.assign(at.thm[rt]),tt>2&&(_e[Ae][rt].en.assign(at.en[rt+2]),_e[Ae][rt].thm.assign(at.thm[rt+2]))}for(var rt=0;rt<tt;rt++){var $t=za(12),mt=za(12),Zt=[0,0,0,0],wn=Ge[rt&1],qt=0,An=rt==3?at.nsPsy.attackthre_s:at.nsPsy.attackthre,Ln=1;if(rt==2)for(var ot=0,Rt=576;Rt>0;++ot,--Rt){var mr=Ge[0][ot],is=Ge[1][ot];Ge[0][ot]=mr+is,Ge[1][ot]=mr-is}for(var ot=0;ot<3;ot++)mt[ot]=at.nsPsy.last_en_subshort[rt][ot+6],Xr(at.nsPsy.last_en_subshort[rt][ot+4]>0),$t[ot]=mt[ot]/at.nsPsy.last_en_subshort[rt][ot+4],Zt[0]+=mt[ot];for(var ot=0;ot<9;ot++){for(var hi=qt+64,ti=1;qt<hi;qt++)ti<Math.abs(wn[qt])&&(ti=Math.abs(wn[qt]));at.nsPsy.last_en_subshort[rt][ot]=mt[ot+3]=ti,Zt[1+ot/3]+=ti,ti>mt[ot+3-2]?(Xr(mt[ot+3-2]>0),ti=ti/mt[ot+3-2]):mt[ot+3-2]>ti*10?ti=mt[ot+3-2]/(ti*10):ti=0,$t[ot+3]=ti}for(var ot=0;ot<3;++ot){var ji=mt[ot*3+3]+mt[ot*3+4]+mt[ot*3+5],ss=1;mt[ot*3+5]*6<ji&&(ss*=.5,mt[ot*3+4]*6<ji&&(ss*=.5)),ke[rt][ot]=ss}if(W.analysis){for(var Yi=$t[0],ot=1;ot<12;ot++)Yi<$t[ot]&&(Yi=$t[ot]);at.pinfo.ers[Ae][rt]=at.pinfo.ers_save[rt],at.pinfo.ers_save[rt]=Yi}for(var ot=0;ot<12;ot++)Ve[rt][ot/3]==0&&$t[ot]>An&&(Ve[rt][ot/3]=ot%3+1);for(var ot=1;ot<4;ot++){var os=Zt[ot-1],as=Zt[ot],je=Math.max(os,as);je<4e4&&os<1.7*as&&as<1.7*os&&(ot==1&&Ve[rt][0]<=Ve[rt][ot]&&(Ve[rt][0]=0),Ve[rt][ot]=0)}Ve[rt][0]<=at.nsPsy.lastAttacks[rt]&&(Ve[rt][0]=0),(at.nsPsy.lastAttacks[rt]==3||Ve[rt][0]+Ve[rt][1]+Ve[rt][2]+Ve[rt][3]!=0)&&(Ln=0,Ve[rt][1]!=0&&Ve[rt][0]!=0&&(Ve[rt][1]=0),Ve[rt][2]!=0&&Ve[rt][1]!=0&&(Ve[rt][2]=0),Ve[rt][3]!=0&&Ve[rt][2]!=0&&(Ve[rt][3]=0)),rt<2?Fe[rt]=Ln:Ln==0&&(Fe[0]=Fe[1]=0),Ye[rt]=at.tot_ener[rt]}}function $e(W,oe,Se){if(Se==0)for(var Ae=0;Ae<W.npart_s;Ae++)W.nb_s2[oe][Ae]=W.nb_s1[oe][Ae],W.nb_s1[oe][Ae]=0}function De(W,oe){for(var Se=0;Se<W.npart_l;Se++)W.nb_2[oe][Se]=W.nb_1[oe][Se],W.nb_1[oe][Se]=0}function Oe(W,oe,Se,Ae){var ye=N.length-1,_e=0,Ye=Se[_e]+Se[_e+1];if(Ye>0){var ke=oe[_e];ke<oe[_e+1]&&(ke=oe[_e+1]),Xr(W.numlines_s[_e]+W.numlines_s[_e+1]-1>0),Ye=20*(ke*2-Ye)/(Ye*(W.numlines_s[_e]+W.numlines_s[_e+1]-1));var Ve=0|Ye;Ve>ye&&(Ve=ye),Ae[_e]=Ve}else Ae[_e]=0;for(_e=1;_e<W.npart_s-1;_e++)if(Ye=Se[_e-1]+Se[_e]+Se[_e+1],Xr(_e+1<W.npart_s),Ye>0){var ke=oe[_e-1];ke<oe[_e]&&(ke=oe[_e]),ke<oe[_e+1]&&(ke=oe[_e+1]),Xr(W.numlines_s[_e-1]+W.numlines_s[_e]+W.numlines_s[_e+1]-1>0),Ye=20*(ke*3-Ye)/(Ye*(W.numlines_s[_e-1]+W.numlines_s[_e]+W.numlines_s[_e+1]-1));var Ve=0|Ye;Ve>ye&&(Ve=ye),Ae[_e]=Ve}else Ae[_e]=0;if(Xr(_e==W.npart_s-1),Ye=Se[_e-1]+Se[_e],Ye>0){var ke=oe[_e-1];ke<oe[_e]&&(ke=oe[_e]),Xr(W.numlines_s[_e-1]+W.numlines_s[_e]-1>0),Ye=20*(ke*2-Ye)/(Ye*(W.numlines_s[_e-1]+W.numlines_s[_e]-1));var Ve=0|Ye;Ve>ye&&(Ve=ye),Ae[_e]=Ve}else Ae[_e]=0;Xr(_e==W.npart_s-1)}function ae(W,oe,Se,Ae,ye,_e){var Ye=W.internal_flags,ke=new float[Gt.CBANDS],Ve=za(Gt.CBANDS),Fe,Ge,at,Be=new int[Gt.CBANDS];for(at=Ge=0;at<Ye.npart_s;++at){var tt=0,rt=0,xt=Ye.numlines_s[at];for(Fe=0;Fe<xt;++Fe,++Ge){var ot=oe[_e][Ge];tt+=ot,rt<ot&&(rt=ot)}Se[at]=tt,ke[at]=rt,Ve[at]=tt/xt,Xr(Ve[at]>=0)}for(Xr(at==Ye.npart_s);at<Gt.CBANDS;++at)ke[at]=0,Ve[at]=0;for(Oe(Ye,ke,Ve,Be),Ge=at=0;at<Ye.npart_s;at++){var tn=Ye.s3ind_s[at][0],ln=Ye.s3ind_s[at][1],Rt,$t,mt,Zt,wn;for(Rt=Be[tn],$t=1,Zt=Ye.s3_ss[Ge]*Se[tn]*N[Be[tn]],++Ge,++tn;tn<=ln;)Rt+=Be[tn],$t+=1,mt=Ye.s3_ss[Ge]*Se[tn]*N[Be[tn]],Zt=H(Zt,mt,tn-at),++Ge,++tn;Rt=(1+2*Rt)/(2*$t),wn=N[Rt]*.5,Zt*=wn,Ae[at]=Zt,Ye.nb_s2[ye][at]=Ye.nb_s1[ye][at],Ye.nb_s1[ye][at]=Zt,mt=ke[at],mt*=Ye.minval_s[at],mt*=wn,Ae[at]>mt&&(Ae[at]=mt),Ye.masking_lower>1&&(Ae[at]*=Ye.masking_lower),Ae[at]>Se[at]&&(Ae[at]=Se[at]),Ye.masking_lower<1&&(Ae[at]*=Ye.masking_lower),Xr(Ae[at]>=0)}for(;at<Gt.CBANDS;++at)Se[at]=0,Ae[at]=0}function ve(W,oe,Se,Ae,ye){var _e=za(Gt.CBANDS),Ye=za(Gt.CBANDS),ke=tb(Gt.CBANDS+2),Ve;Te(W,oe,Se,_e,Ye),Pe(W,_e,Ye,ke);var Fe=0;for(Ve=0;Ve<W.npart_l;Ve++){var Ge,at,Be,tt,rt=W.s3ind[Ve][0],xt=W.s3ind[Ve][1],ot=0,tn=0;for(ot=ke[rt],tn+=1,at=W.s3_ll[Fe]*Se[rt]*N[ke[rt]],++Fe,++rt;rt<=xt;)ot+=ke[rt],tn+=1,Ge=W.s3_ll[Fe]*Se[rt]*N[ke[rt]],tt=H(at,Ge,rt-Ve),at=tt,++Fe,++rt;if(ot=(1+2*ot)/(2*tn),Be=N[ot]*.5,at*=Be,W.blocktype_old[ye&1]==Gt.SHORT_TYPE){var ln=r*W.nb_1[ye][Ve];ln>0?Ae[Ve]=Math.min(at,ln):Ae[Ve]=Math.min(at,Se[Ve]*f)}else{var Rt=i*W.nb_2[ye][Ve],$t=r*W.nb_1[ye][Ve],ln;Rt<=0&&(Rt=at),$t<=0&&($t=at),W.blocktype_old[ye&1]==Gt.NORM_TYPE?ln=Math.min($t,Rt):ln=$t,Ae[Ve]=Math.min(at,ln)}W.nb_2[ye][Ve]=W.nb_1[ye][Ve],W.nb_1[ye][Ve]=at,Ge=_e[Ve],Ge*=W.minval_l[Ve],Ge*=Be,Ae[Ve]>Ge&&(Ae[Ve]=Ge),W.masking_lower>1&&(Ae[Ve]*=W.masking_lower),Ae[Ve]>Se[Ve]&&(Ae[Ve]=Se[Ve]),W.masking_lower<1&&(Ae[Ve]*=W.masking_lower),Xr(Ae[Ve]>=0)}for(;Ve<Gt.CBANDS;++Ve)Se[Ve]=0,Ae[Ve]=0}function xe(W,oe){var Se=W.internal_flags;W.short_blocks==tE.short_block_coupled&&!(oe[0]!=0&&oe[1]!=0)&&(oe[0]=oe[1]=0);for(var Ae=0;Ae<Se.channels_out;Ae++)W.short_blocks==tE.short_block_dispensed&&(oe[Ae]=1),W.short_blocks==tE.short_block_forced&&(oe[Ae]=0)}function pe(W,oe,Se){for(var Ae=W.internal_flags,ye=0;ye<Ae.channels_out;ye++){var _e=Gt.NORM_TYPE;oe[ye]!=0?(Xr(Ae.blocktype_old[ye]!=Gt.START_TYPE),Ae.blocktype_old[ye]==Gt.SHORT_TYPE&&(_e=Gt.STOP_TYPE)):(_e=Gt.SHORT_TYPE,Ae.blocktype_old[ye]==Gt.NORM_TYPE&&(Ae.blocktype_old[ye]=Gt.START_TYPE),Ae.blocktype_old[ye]==Gt.STOP_TYPE&&(Ae.blocktype_old[ye]=Gt.SHORT_TYPE)),Se[ye]=Ae.blocktype_old[ye],Ae.blocktype_old[ye]=_e}}function ze(W,oe,Se,Ae,ye,_e,Ye){for(var ke=_e*2,Ve=_e>0?Math.pow(10,ye):1,Fe,Ge,at=0;at<Ye;++at){var Be=W[2][at],tt=W[3][at],rt=oe[0][at],xt=oe[1][at],ot=oe[2][at],tn=oe[3][at];if(rt<=1.58*xt&&xt<=1.58*rt){var ln=Se[at]*tt,Rt=Se[at]*Be;Ge=Math.max(ot,Math.min(tn,ln)),Fe=Math.max(tn,Math.min(ot,Rt))}else Ge=ot,Fe=tn;if(_e>0){var $t,mt,Zt=Ae[at]*Ve;if($t=Math.min(Math.max(rt,Zt),Math.max(xt,Zt)),ot=Math.max(Ge,Zt),tn=Math.max(Fe,Zt),mt=ot+tn,mt>0&&$t*ke<mt){var wn=$t*ke/mt;ot*=wn,tn*=wn}Ge=Math.min(ot,Ge),Fe=Math.min(tn,Fe)}Ge>Be&&(Ge=Be),Fe>tt&&(Fe=tt),oe[2][at]=Ge,oe[3][at]=Fe}}this.L3psycho_anal_vbr=function(W,oe,Se,Ae,ye,_e,Ye,ke,Ve,Fe){var Ge=W.internal_flags,at,Be,tt=za(Gt.HBLKSIZE),rt=Yf([3,Gt.HBLKSIZE_s]),xt=Yf([2,Gt.BLKSIZE]),ot=Yf([2,3,Gt.BLKSIZE_s]),tn=Yf([4,Gt.CBANDS]),ln=Yf([4,Gt.CBANDS]),Rt=Yf([4,3]),$t=.6,mt=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Zt=tb(2),wn=W.mode==n.JOINT_STEREO?4:Ge.channels_out;Le(W,oe,Se,Ae,ye,_e,Ve,Rt,mt,Zt),xe(W,Zt);{for(var qt=0;qt<wn;qt++){var An=qt&1;at=xt,it(W,oe,Se,qt,Ae,tt,at,An),vt(W,Ae,qt,tt),Zt[An]!=0?ve(Ge,tt,tn[qt],ln[qt],qt):De(Ge,qt)}Zt[0]+Zt[1]==2&&W.mode==n.JOINT_STEREO&&ze(tn,ln,Ge.mld_cb_l,Ge.ATH.cb_l,W.ATHlower*Ge.ATH.adjust,W.msfix,Ge.npart_l);for(var qt=0;qt<wn;qt++){var An=qt&1;Zt[An]!=0&&Q(Ge,tn[qt],ln[qt],qt)}}{for(var Ln=0;Ln<3;Ln++){for(var qt=0;qt<wn;++qt){var An=qt&1;Zt[An]!=0?$e(Ge,qt,Ln):(Be=ot,ht(W,oe,Se,qt,Ln,rt,Be,An),ae(W,rt,tn[qt],ln[qt],qt,Ln))}Zt[0]+Zt[1]==0&&W.mode==n.JOINT_STEREO&&ze(tn,ln,Ge.mld_cb_s,Ge.ATH.cb_s,W.ATHlower*Ge.ATH.adjust,W.msfix,Ge.npart_s);for(var qt=0;qt<wn;++qt){var An=qt&1;Zt[An]==0&&J(Ge,tn[qt],ln[qt],qt,Ln)}}for(var qt=0;qt<wn;qt++){var An=qt&1;if(Zt[An]==0)for(var mr=0;mr<Gt.SBMAX_s;mr++){for(var is=za(3),Ln=0;Ln<3;Ln++){var hi=Ge.thm[qt].s[mr][Ln];if(hi*=u,mt[qt][Ln]>=2||mt[qt][Ln+1]==1){var ti=Ln!=0?Ln-1:2,ji=ee(Ge.thm[qt].s[mr][ti],hi,h*$t);hi=Math.min(hi,ji)}else if(mt[qt][Ln]==1){var ti=Ln!=0?Ln-1:2,ji=ee(Ge.thm[qt].s[mr][ti],hi,f*$t);hi=Math.min(hi,ji)}else if(Ln!=0&&mt[qt][Ln-1]==3||Ln==0&&Ge.nsPsy.lastAttacks[qt]==3){var ti=Ln!=2?Ln+1:0,ji=ee(Ge.thm[qt].s[mr][ti],hi,f*$t);hi=Math.min(hi,ji)}hi*=Rt[qt][Ln],is[Ln]=hi}for(var Ln=0;Ln<3;Ln++)Ge.thm[qt].s[mr][Ln]=is[Ln]}}}for(var qt=0;qt<wn;qt++)Ge.nsPsy.lastAttacks[qt]=mt[qt][2];pe(W,Zt,Fe);for(var qt=0;qt<wn;qt++){var ss,Yi,os,as;qt>1?(ss=ke,Yi=-2,os=Gt.NORM_TYPE,(Fe[0]==Gt.SHORT_TYPE||Fe[1]==Gt.SHORT_TYPE)&&(os=Gt.SHORT_TYPE),as=_e[Ae][qt-2]):(ss=Ye,Yi=0,os=Fe[qt],as=ye[Ae][qt]),os==Gt.SHORT_TYPE?ss[Yi+qt]=ie(as,Ge.masking_lower):ss[Yi+qt]=Re(as,Ge.masking_lower),W.analysis&&(Ge.pinfo.pe[Ae][qt]=ss[Yi+qt])}return 0};function Je(W,oe){var Se=W,Ae;return Se>=0?Ae=-Se*27:Ae=Se*oe,Ae<=-72?0:Math.exp(Ae*m)}function Xe(W){var oe=0,Se=0;{var Ae=0,ye,_e;for(Ae=0;Je(Ae,W)>1e-20;Ae-=1);for(ye=Ae,_e=0;Math.abs(_e-ye)>1e-12;)Ae=(_e+ye)/2,Je(Ae,W)>0?_e=Ae:ye=Ae;oe=ye}{var Ae=0,ye,_e;for(Ae=0;Je(Ae,W)>1e-20;Ae+=1);for(ye=0,_e=Ae;Math.abs(_e-ye)>1e-12;)Ae=(_e+ye)/2,Je(Ae,W)>0?ye=Ae:_e=Ae;Se=_e}{var Ye=0,ke=1e3,Ve;for(Ve=0;Ve<=ke;++Ve){var Ae=oe+Ve*(Se-oe)/ke,Fe=Je(Ae,W);Ye+=Fe}{var Ge=(ke+1)/(Ye*(Se-oe));return Ge}}}function et(W){var oe,Se,Ae,ye;return oe=W,oe>=0?oe*=3:oe*=1.5,oe>=.5&&oe<=2.5?(ye=oe-.5,Se=8*(ye*ye-2*ye)):Se=0,oe+=.474,Ae=15.811389+7.5*oe-17.5*Math.sqrt(1+oe*oe),Ae<=-60?0:(oe=Math.exp((Se+Ae)*m),oe/=.6609193,oe)}function Ut(W){return W<0&&(W=0),W=W*.001,13*Math.atan(.76*W)+3.5*Math.atan(W*W/(7.5*7.5))}function gt(W,oe,Se,Ae,ye,_e,Ye,ke,Ve,Fe,Ge,at){var Be=za(Gt.CBANDS+1),tt=ke/(at>15?2*576:384),rt=tb(Gt.HBLKSIZE),xt;ke/=Ve;var ot=0,tn=0;for(xt=0;xt<Gt.CBANDS;xt++){var ln,Rt;for(ln=Ut(ke*ot),Be[xt]=ke*ot,Rt=ot;Ut(ke*Rt)-ln<a&&Rt<=Ve/2;Rt++);for(W[xt]=Rt-ot,tn=xt+1;ot<Rt;)Xr(ot<Gt.HBLKSIZE),rt[ot++]=xt;if(ot>Ve/2){ot=Ve/2,++xt;break}}Xr(xt<Gt.CBANDS),Be[xt]=ke*ot;for(var $t=0;$t<at;$t++){var mt,Zt,wn,qt,An;wn=Fe[$t],qt=Fe[$t+1],mt=0|Math.floor(.5+Ge*(wn-.5)),mt<0&&(mt=0),Zt=0|Math.floor(.5+Ge*(qt-.5)),Zt>Ve/2&&(Zt=Ve/2),Se[$t]=(rt[mt]+rt[Zt])/2,oe[$t]=rt[Zt];var Ln=tt*qt;Ye[$t]=(Ln-Be[oe[$t]])/(Be[oe[$t]+1]-Be[oe[$t]]),Ye[$t]<0?Ye[$t]=0:Ye[$t]>1&&(Ye[$t]=1),An=Ut(ke*Fe[$t]*Ge),An=Math.min(An,15.5)/15.5,_e[$t]=Math.pow(10,1.25*(1-Math.cos(Math.PI*An))-2.5)}ot=0;for(var mr=0;mr<tn;mr++){var is=W[mr],ln,hi;ln=Ut(ke*ot),hi=Ut(ke*(ot+is-1)),Ae[mr]=.5*(ln+hi),ln=Ut(ke*(ot-.5)),hi=Ut(ke*(ot+is-.5)),ye[mr]=hi-ln,ot+=is}return tn}function At(W,oe,Se,Ae,ye,_e){var Ye=Yf([Gt.CBANDS,Gt.CBANDS]),ke,Ve=0;if(_e)for(var Fe=0;Fe<oe;Fe++)for(ke=0;ke<oe;ke++){var Ge=et(Se[Fe]-Se[ke])*Ae[ke];Ye[Fe][ke]=Ge*ye[Fe]}else for(ke=0;ke<oe;ke++)for(var at=15+Math.min(21/Se[ke],12),Be=Xe(at),Fe=0;Fe<oe;Fe++){var Ge=Be*Je(Se[Fe]-Se[ke],at)*Ae[ke];Ye[Fe][ke]=Ge*ye[Fe]}for(var Fe=0;Fe<oe;Fe++){for(ke=0;ke<oe&&!(Ye[Fe][ke]>0);ke++);for(W[Fe][0]=ke,ke=oe-1;ke>0&&!(Ye[Fe][ke]>0);ke--);W[Fe][1]=ke,Ve+=W[Fe][1]-W[Fe][0]+1}for(var tt=za(Ve),rt=0,Fe=0;Fe<oe;Fe++)for(ke=W[Fe][0];ke<=W[Fe][1];ke++)tt[rt++]=Ye[Fe][ke];return tt}function Ce(W){var oe=Ut(W);return oe=Math.min(oe,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*oe))-2.5)}this.psymodel_init=function(W){var oe=W.internal_flags,Se,Ae=!0,ye=13,_e=24,Ye=0,ke=0,Ve=-8.25,Fe=-4.5,Ge=za(Gt.CBANDS),at=za(Gt.CBANDS),Be=za(Gt.CBANDS),tt=W.out_samplerate;switch(W.experimentalZ){default:case 0:Ae=!0;break;case 1:Ae=!(W.VBR==eE.vbr_mtrh||W.VBR==eE.vbr_mt);break;case 2:Ae=!1;break;case 3:ye=8,Ye=-1.75,ke=-.0125,Ve=-8.25,Fe=-2.25;break}for(oe.ms_ener_ratio_old=.25,oe.blocktype_old[0]=oe.blocktype_old[1]=Gt.NORM_TYPE,Se=0;Se<4;++Se){for(var ot=0;ot<Gt.CBANDS;++ot)oe.nb_1[Se][ot]=1e20,oe.nb_2[Se][ot]=1e20,oe.nb_s1[Se][ot]=oe.nb_s2[Se][ot]=1;for(var rt=0;rt<Gt.SBMAX_l;rt++)oe.en[Se].l[rt]=1e20,oe.thm[Se].l[rt]=1e20;for(var ot=0;ot<3;++ot){for(var rt=0;rt<Gt.SBMAX_s;rt++)oe.en[Se].s[rt][ot]=1e20,oe.thm[Se].s[rt][ot]=1e20;oe.nsPsy.lastAttacks[Se]=0}for(var ot=0;ot<9;ot++)oe.nsPsy.last_en_subshort[Se][ot]=10}for(oe.loudness_sq_save[0]=oe.loudness_sq_save[1]=0,oe.npart_l=gt(oe.numlines_l,oe.bo_l,oe.bm_l,Ge,at,oe.mld_l,oe.PSY.bo_l_weight,tt,Gt.BLKSIZE,oe.scalefac_band.l,Gt.BLKSIZE/(2*576),Gt.SBMAX_l),Xr(oe.npart_l<Gt.CBANDS),Se=0;Se<oe.npart_l;Se++){var xt=Ye;Ge[Se]>=ye&&(xt=ke*(Ge[Se]-ye)/(_e-ye)+Ye*(_e-Ge[Se])/(_e-ye)),Be[Se]=Math.pow(10,xt/10),oe.numlines_l[Se]>0?oe.rnumlines_l[Se]=1/oe.numlines_l[Se]:oe.rnumlines_l[Se]=0}oe.s3_ll=At(oe.s3ind,oe.npart_l,Ge,at,Be,Ae);var ot=0;for(Se=0;Se<oe.npart_l;Se++){var tn;tn=PV.MAX_VALUE;for(var ln=0;ln<oe.numlines_l[Se];ln++,ot++){var Rt=tt*ot/(1e3*Gt.BLKSIZE),$t;$t=this.ATHformula(Rt*1e3,W)-20,$t=Math.pow(10,.1*$t),$t*=oe.numlines_l[Se],tn>$t&&(tn=$t)}oe.ATH.cb_l[Se]=tn,tn=-20+Ge[Se]*20/10,tn>6&&(tn=100),tn<-15&&(tn=-15),tn-=8,oe.minval_l[Se]=Math.pow(10,tn/10)*oe.numlines_l[Se]}for(oe.npart_s=gt(oe.numlines_s,oe.bo_s,oe.bm_s,Ge,at,oe.mld_s,oe.PSY.bo_s_weight,tt,Gt.BLKSIZE_s,oe.scalefac_band.s,Gt.BLKSIZE_s/384,Gt.SBMAX_s),Xr(oe.npart_s<Gt.CBANDS),ot=0,Se=0;Se<oe.npart_s;Se++){var tn,xt=Ve;Ge[Se]>=ye&&(xt=Fe*(Ge[Se]-ye)/(_e-ye)+Ve*(_e-Ge[Se])/(_e-ye)),Be[Se]=Math.pow(10,xt/10),tn=PV.MAX_VALUE;for(var ln=0;ln<oe.numlines_s[Se];ln++,ot++){var Rt=tt*ot/(1e3*Gt.BLKSIZE_s),$t;$t=this.ATHformula(Rt*1e3,W)-20,$t=Math.pow(10,.1*$t),$t*=oe.numlines_s[Se],tn>$t&&(tn=$t)}oe.ATH.cb_s[Se]=tn,tn=-7+Ge[Se]*7/12,Ge[Se]>12&&(tn*=1+Math.log(1+tn)*3.1),Ge[Se]<12&&(tn*=1+Math.log(1-tn)*2.3),tn<-15&&(tn=-15),tn-=8,oe.minval_s[Se]=Math.pow(10,tn/10)*oe.numlines_s[Se]}oe.s3_ss=At(oe.s3ind_s,oe.npart_s,Ge,at,Be,Ae),U(),e.init_fft(oe),oe.decay=Math.exp(-1*t/(l*tt/192));{var mt;mt=d,W.exp_nspsytune&2&&(mt=1),Math.abs(W.msfix)>0&&(mt=W.msfix),W.msfix=mt;for(var Zt=0;Zt<oe.npart_l;Zt++)oe.s3ind[Zt][1]>oe.npart_l-1&&(oe.s3ind[Zt][1]=oe.npart_l-1)}var wn=576*oe.mode_gr/tt;if(oe.ATH.decay=Math.pow(10,-12/10*wn),oe.ATH.adjust=.01,oe.ATH.adjustLimit=1,Xr(oe.bo_l[Gt.SBMAX_l-1]<=oe.npart_l),Xr(oe.bo_s[Gt.SBMAX_s-1]<=oe.npart_s),W.ATHtype!=-1){var Rt,qt=W.out_samplerate/Gt.BLKSIZE,An=0;for(Rt=0,Se=0;Se<Gt.BLKSIZE/2;++Se)Rt+=qt,oe.ATH.eql_w[Se]=1/Math.pow(10,this.ATHformula(Rt,W)/10),An+=oe.ATH.eql_w[Se];for(An=1/An,Se=Gt.BLKSIZE/2;--Se>=0;)oe.ATH.eql_w[Se]*=An}{for(var Zt=ot=0;Zt<oe.npart_s;++Zt)for(Se=0;Se<oe.numlines_s[Zt];++Se)++ot;for(var Zt=ot=0;Zt<oe.npart_l;++Zt)for(Se=0;Se<oe.numlines_l[Zt];++Se)++ot}for(ot=0,Se=0;Se<oe.npart_l;Se++){var Rt=tt*(ot+oe.numlines_l[Se]/2)/(1*Gt.BLKSIZE);oe.mld_cb_l[Se]=Ce(Rt),ot+=oe.numlines_l[Se]}for(;Se<Gt.CBANDS;++Se)oe.mld_cb_l[Se]=1;for(ot=0,Se=0;Se<oe.npart_s;Se++){var Rt=tt*(ot+oe.numlines_s[Se]/2)/(1*Gt.BLKSIZE_s);oe.mld_cb_s[Se]=Ce(Rt),ot+=oe.numlines_s[Se]}for(;Se<Gt.CBANDS;++Se)oe.mld_cb_s[Se]=1;return 0};function se(W,oe){W<-.3&&(W=3410),W/=1e3,W=Math.max(.1,W);var Se=3.64*Math.pow(W,-.8)-6.8*Math.exp(-.6*Math.pow(W-3.4,2))+6*Math.exp(-.15*Math.pow(W-8.7,2))+(.6+.04*oe)*.001*Math.pow(W,4);return Se}this.ATHformula=function(W,oe){var Se;switch(oe.ATHtype){case 0:Se=se(W,9);break;case 1:Se=se(W,-1);break;case 2:Se=se(W,0);break;case 3:Se=se(W,1)+6;break;case 4:Se=se(W,oe.ATHcurve);break;default:Se=se(W,0);break}return Se}}var s9e=i9e,o9e=HC;function a9e(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=o9e.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var c9e=a9e,l9e=Yl(),$ne={};$ne.SFBMAX=l9e.SBMAX_s*3;var O3=$ne,Vne=No,u9e=Vne.new_float,nb=Vne.new_int,j2=O3;function h9e(){this.xr=u9e(576),this.l3_enc=nb(576),this.scalefac=nb(j2.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=nb(3),this.subblock_gain=nb(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=nb(j2.SFBMAX),this.window=nb(j2.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=nb(4),this.max_nonzero_coeff=0;var n=this;function e(r){return new Int32Array(r)}function t(r){return new Float32Array(r)}this.assign=function(r){n.xr=t(r.xr),n.l3_enc=e(r.l3_enc),n.scalefac=e(r.scalefac),n.xrpow_max=r.xrpow_max,n.part2_3_length=r.part2_3_length,n.big_values=r.big_values,n.count1=r.count1,n.global_gain=r.global_gain,n.scalefac_compress=r.scalefac_compress,n.block_type=r.block_type,n.mixed_block_flag=r.mixed_block_flag,n.table_select=e(r.table_select),n.subblock_gain=e(r.subblock_gain),n.region0_count=r.region0_count,n.region1_count=r.region1_count,n.preflag=r.preflag,n.scalefac_scale=r.scalefac_scale,n.count1table_select=r.count1table_select,n.part2_length=r.part2_length,n.sfb_lmax=r.sfb_lmax,n.sfb_smin=r.sfb_smin,n.psy_lmax=r.psy_lmax,n.sfbmax=r.sfbmax,n.psymax=r.psymax,n.sfbdivide=r.sfbdivide,n.width=e(r.width),n.window=e(r.window),n.count1bits=r.count1bits,n.sfb_partition_table=r.sfb_partition_table.slice(0),n.slen=e(r.slen),n.max_nonzero_coeff=r.max_nonzero_coeff}}var q8=h9e,f9e=No,DV=f9e.new_int,d9e=q8;function p9e(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[DV(4),DV(4)];for(var n=0;n<2;n++)for(var e=0;e<2;e++)this.tt[n][e]=new d9e}var m9e=p9e,Hne=No,nk=Hne.System,rk=Hne.new_int,ik=Yl();function g9e(n,e,t,r){this.l=rk(1+ik.SBMAX_l),this.s=rk(1+ik.SBMAX_s),this.psfb21=rk(1+ik.PSFB21),this.psfb12=rk(1+ik.PSFB12);var i=this.l,s=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],nk.arraycopy(this.arrL,0,i,0,Math.min(this.arrL.length,this.l.length)),nk.arraycopy(this.arrS,0,s,0,Math.min(this.arrS.length,this.s.length)),nk.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),nk.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var Gne=g9e,Y8=No,z2=Y8.new_float,_9e=Y8.new_float_n,v9e=Y8.new_int,LV=Yl();function y9e(){this.last_en_subshort=_9e([4,9]),this.lastAttacks=v9e(4),this.pefirbuf=z2(19),this.longfact=z2(LV.SBMAX_l),this.shortfact=z2(LV.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var b9e=y9e;function S9e(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var E9e=S9e,aT=No,x9e=aT.new_byte,T9e=aT.new_double,Kf=aT.new_float,rb=aT.new_float_n,np=aT.new_int,sk=aT.new_int_n,w9e=m9e,A9e=Gne,C9e=b9e,R9e=E9e,UV=jne(),la=Yl(),k9e=O3;Y0.MFSIZE=3*1152+la.ENCDELAY-la.MDCTDELAY;Y0.MAX_HEADER_BUF=256;Y0.MAX_BITS_PER_CHANNEL=4095;Y0.MAX_BITS_PER_GRANULE=7680;Y0.BPC=320;function Y0(){var n=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=rb([2,Y0.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new w9e,this.ms_ratio=Kf(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=np(2),this.CurrentStep=np(2),this.masking_lower=0,this.bv_scf=np(576),this.pseudohalf=np(k9e.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Y0.BPC+1),this.itime=T9e(2),this.sideinfo_len=0,this.sb_sample=rb([2,2,18,la.SBLIMIT]),this.amp_filter=Kf(32);function e(){this.write_timing=0,this.ptr=0,this.buf=x9e(n)}this.header=new Array(Y0.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new A9e,this.minval_l=Kf(la.CBANDS),this.minval_s=Kf(la.CBANDS),this.nb_1=rb([4,la.CBANDS]),this.nb_2=rb([4,la.CBANDS]),this.nb_s1=rb([4,la.CBANDS]),this.nb_s2=rb([4,la.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Kf(4),this.loudness_sq=rb([2,2]),this.loudness_sq_save=Kf(2),this.mld_l=Kf(la.SBMAX_l),this.mld_s=Kf(la.SBMAX_s),this.bm_l=np(la.SBMAX_l),this.bo_l=np(la.SBMAX_l),this.bm_s=np(la.SBMAX_s),this.bo_s=np(la.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=sk([la.CBANDS,2]),this.s3ind_s=sk([la.CBANDS,2]),this.numlines_s=np(la.CBANDS),this.numlines_l=np(la.CBANDS),this.rnumlines_l=Kf(la.CBANDS),this.mld_cb_l=Kf(la.CBANDS),this.mld_cb_s=Kf(la.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Kf(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=np(2),this.nsPsy=new C9e,this.VBR_seek_table=new R9e,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=sk([16,5]),this.bitrate_blockType_Hist=sk([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var t=0;t<this.en.length;t++)this.en[t]=new UV;for(var t=0;t<this.thm.length;t++)this.thm[t]=new UV;for(var t=0;t<this.header.length;t++)this.header[t]=new e}var N3=Y0,M9e=No,ib=M9e.new_float,sb=Yl();function I9e(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=ib(sb.SBMAX_l),this.s=ib(sb.SBMAX_s),this.psfb21=ib(sb.PSFB21),this.psfb12=ib(sb.PSFB12),this.cb_l=ib(sb.CBANDS),this.cb_s=ib(sb.CBANDS),this.eql_w=ib(sb.BLKSIZE/2)}var O9e=I9e,Wne=No,sh=Wne.System,BV=Wne.Arrays;_a.STEPS_per_dB=100;_a.MAX_dB=120;_a.GAIN_NOT_ENOUGH_SAMPLES=-24601;_a.GAIN_ANALYSIS_ERROR=0;_a.GAIN_ANALYSIS_OK=1;_a.INIT_GAIN_ANALYSIS_ERROR=0;_a.INIT_GAIN_ANALYSIS_OK=1;_a.YULE_ORDER=10;_a.MAX_ORDER=_a.YULE_ORDER;_a.MAX_SAMP_FREQ=48e3;_a.RMS_WINDOW_TIME_NUMERATOR=1;_a.RMS_WINDOW_TIME_DENOMINATOR=20;_a.MAX_SAMPLES_PER_WINDOW=_a.MAX_SAMP_FREQ*_a.RMS_WINDOW_TIME_NUMERATOR/_a.RMS_WINDOW_TIME_DENOMINATOR+1;function _a(){var n=64.82,e=.95,t=_a.RMS_WINDOW_TIME_NUMERATOR,r=_a.RMS_WINDOW_TIME_DENOMINATOR,i=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function o(h,f,d,p,m,_){for(;m--!=0;)d[p]=1e-10+h[f+0]*_[0]-d[p-1]*_[1]+h[f-1]*_[2]-d[p-2]*_[3]+h[f-2]*_[4]-d[p-3]*_[5]+h[f-3]*_[6]-d[p-4]*_[7]+h[f-4]*_[8]-d[p-5]*_[9]+h[f-5]*_[10]-d[p-6]*_[11]+h[f-6]*_[12]-d[p-7]*_[13]+h[f-7]*_[14]-d[p-8]*_[15]+h[f-8]*_[16]-d[p-9]*_[17]+h[f-9]*_[18]-d[p-10]*_[19]+h[f-10]*_[20],++p,++f}function a(h,f,d,p,m,_){for(;m--!=0;)d[p]=h[f+0]*_[0]-d[p-1]*_[1]+h[f-1]*_[2]-d[p-2]*_[3]+h[f-2]*_[4],++p,++f}function c(h,f){for(var d=0;d<MAX_ORDER;d++)h.linprebuf[d]=h.lstepbuf[d]=h.loutbuf[d]=h.rinprebuf[d]=h.rstepbuf[d]=h.routbuf[d]=0;switch(0|f){case 48e3:h.reqindex=0;break;case 44100:h.reqindex=1;break;case 32e3:h.reqindex=2;break;case 24e3:h.reqindex=3;break;case 22050:h.reqindex=4;break;case 16e3:h.reqindex=5;break;case 12e3:h.reqindex=6;break;case 11025:h.reqindex=7;break;case 8e3:h.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return h.sampleWindow=0|(f*t+r-1)/r,h.lsum=0,h.rsum=0,h.totsamp=0,BV.ill(h.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(h,f){return c(h,f)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(h.linpre=MAX_ORDER,h.rinpre=MAX_ORDER,h.lstep=MAX_ORDER,h.rstep=MAX_ORDER,h.lout=MAX_ORDER,h.rout=MAX_ORDER,BV.fill(h.B,0),INIT_GAIN_ANALYSIS_OK)};function l(h){return h*h}this.AnalyzeSamples=function(h,f,d,p,m,_,v){var S,b,T,w,R,C,N;if(_==0)return GAIN_ANALYSIS_OK;switch(N=0,R=_,v){case 1:p=f,m=d;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(_<MAX_ORDER?(sh.arraycopy(f,d,h.linprebuf,MAX_ORDER,_),sh.arraycopy(p,m,h.rinprebuf,MAX_ORDER,_)):(sh.arraycopy(f,d,h.linprebuf,MAX_ORDER,MAX_ORDER),sh.arraycopy(p,m,h.rinprebuf,MAX_ORDER,MAX_ORDER));R>0;){C=R>h.sampleWindow-h.totsamp?h.sampleWindow-h.totsamp:R,N<MAX_ORDER?(S=h.linpre+N,b=h.linprebuf,T=h.rinpre+N,w=h.rinprebuf,C>MAX_ORDER-N&&(C=MAX_ORDER-N)):(S=d+N,b=f,T=m+N,w=p),o(b,S,h.lstepbuf,h.lstep+h.totsamp,C,i[h.reqindex]),o(w,T,h.rstepbuf,h.rstep+h.totsamp,C,i[h.reqindex]),a(h.lstepbuf,h.lstep+h.totsamp,h.loutbuf,h.lout+h.totsamp,C,s[h.reqindex]),a(h.rstepbuf,h.rstep+h.totsamp,h.routbuf,h.rout+h.totsamp,C,s[h.reqindex]),S=h.lout+h.totsamp,b=h.loutbuf,T=h.rout+h.totsamp,w=h.routbuf;for(var U=C%8;U--!=0;)h.lsum+=l(b[S++]),h.rsum+=l(w[T++]);for(U=C/8;U--!=0;)h.lsum+=l(b[S+0])+l(b[S+1])+l(b[S+2])+l(b[S+3])+l(b[S+4])+l(b[S+5])+l(b[S+6])+l(b[S+7]),S+=8,h.rsum+=l(w[T+0])+l(w[T+1])+l(w[T+2])+l(w[T+3])+l(w[T+4])+l(w[T+5])+l(w[T+6])+l(w[T+7]),T+=8;if(R-=C,N+=C,h.totsamp+=C,h.totsamp==h.sampleWindow){var B=_a.STEPS_per_dB*10*Math.log10((h.lsum+h.rsum)/h.totsamp*.5+1e-37),$=B<=0?0:0|B;$>=h.A.length&&($=h.A.length-1),h.A[$]++,h.lsum=h.rsum=0,sh.arraycopy(h.loutbuf,h.totsamp,h.loutbuf,0,MAX_ORDER),sh.arraycopy(h.routbuf,h.totsamp,h.routbuf,0,MAX_ORDER),sh.arraycopy(h.lstepbuf,h.totsamp,h.lstepbuf,0,MAX_ORDER),sh.arraycopy(h.rstepbuf,h.totsamp,h.rstepbuf,0,MAX_ORDER),h.totsamp=0}if(h.totsamp>h.sampleWindow)return GAIN_ANALYSIS_ERROR}return _<MAX_ORDER?(sh.arraycopy(h.linprebuf,_,h.linprebuf,0,MAX_ORDER-_),sh.arraycopy(h.rinprebuf,_,h.rinprebuf,0,MAX_ORDER-_),sh.arraycopy(f,d,h.linprebuf,MAX_ORDER-_,_),sh.arraycopy(p,m,h.rinprebuf,MAX_ORDER-_,_)):(sh.arraycopy(f,d+_-MAX_ORDER,h.linprebuf,0,MAX_ORDER),sh.arraycopy(p,m+_-MAX_ORDER,h.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function u(h,f){var d,p=0;for(d=0;d<f;d++)p+=h[d];if(p==0)return GAIN_NOT_ENOUGH_SAMPLES;var m=0|Math.ceil(p*(1-e));for(d=f;d-- >0&&!((m-=h[d])<=0););return n-d/_a.STEPS_per_dB}this.GetTitleGain=function(h){for(var f=u(h.A,h.A.length),d=0;d<h.A.length;d++)h.B[d]+=h.A[d],h.A[d]=0;for(var d=0;d<MAX_ORDER;d++)h.linprebuf[d]=h.lstepbuf[d]=h.loutbuf[d]=h.rinprebuf[d]=h.rstepbuf[d]=h.routbuf[d]=0;return h.totsamp=0,h.lsum=h.rsum=0,f}}var qne=_a,Yne=No,nE=Yne.new_float,FV=Yne.new_int,oh=qne;function N9e(){this.linprebuf=nE(oh.MAX_ORDER*2),this.linpre=0,this.lstepbuf=nE(oh.MAX_SAMPLES_PER_WINDOW+oh.MAX_ORDER),this.lstep=0,this.loutbuf=nE(oh.MAX_SAMPLES_PER_WINDOW+oh.MAX_ORDER),this.lout=0,this.rinprebuf=nE(oh.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=nE(oh.MAX_SAMPLES_PER_WINDOW+oh.MAX_ORDER),this.rstep=0,this.routbuf=nE(oh.MAX_SAMPLES_PER_WINDOW+oh.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=FV(0|oh.STEPS_per_dB*oh.MAX_dB),this.B=FV(0|oh.STEPS_per_dB*oh.MAX_dB)}var P9e=N9e;function D9e(n){this.bits=n}var Kne=D9e,K8=No,jV=K8.new_float,L9e=K8.new_int,zV=K8.assert,U9e=Kne,$V=Yl(),B9e=O3,F9e=N3;function j9e(n){var e=n;this.quantize=e,this.iteration_loop=function(t,r,i,s){var o=t.internal_flags,a=jV(B9e.SFBMAX),c=jV(576),l=L9e(2),u=0,h,f=o.l3_side,d=new U9e(u);this.quantize.rv.ResvFrameBegin(t,d),u=d.bits;for(var p=0;p<o.mode_gr;p++){h=this.quantize.qupvt.on_pe(t,r,l,u,p,p),o.mode_ext==$V.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,p),this.quantize.qupvt.reduce_side(l,i[p],u,h));for(var m=0;m<o.channels_out;m++){var _,v,S=f.tt[p][m];S.block_type!=$V.SHORT_TYPE?(_=0,v=o.PSY.mask_adjust-_):(_=0,v=o.PSY.mask_adjust_short-_),o.masking_lower=Math.pow(10,v*.1),this.quantize.init_outer_loop(o,S),this.quantize.init_xrpow(o,S,c)&&(this.quantize.qupvt.calc_xmin(t,s[p][m],S,a),this.quantize.outer_loop(t,S,a,c,m,l[m])),this.quantize.iteration_finish_one(o,p,m),zV(S.part2_3_length<=F9e.MAX_BITS_PER_CHANNEL),zV(S.part2_3_length<=l[m])}}this.quantize.rv.ResvFrameEnd(o,u)}}var z9e=j9e;function Gi(n,e,t,r){this.xlen=n,this.linmax=e,this.table=t,this.hlen=r}var dn={};dn.t1HB=[1,1,1,0];dn.t2HB=[1,2,1,3,1,1,3,2,0];dn.t3HB=[3,2,1,1,1,1,3,2,0];dn.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];dn.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];dn.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];dn.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];dn.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];dn.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];dn.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];dn.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];dn.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];dn.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];dn.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];dn.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];dn.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];dn.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];dn.t1l=[1,4,3,5];dn.t2l=[1,4,7,4,5,7,6,7,8];dn.t3l=[2,3,7,4,4,7,6,7,8];dn.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];dn.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];dn.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];dn.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];dn.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];dn.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];dn.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];dn.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];dn.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];dn.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];dn.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];dn.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];dn.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];dn.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];dn.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];dn.ht=[new Gi(0,0,null,null),new Gi(2,0,dn.t1HB,dn.t1l),new Gi(3,0,dn.t2HB,dn.t2l),new Gi(3,0,dn.t3HB,dn.t3l),new Gi(0,0,null,null),new Gi(4,0,dn.t5HB,dn.t5l),new Gi(4,0,dn.t6HB,dn.t6l),new Gi(6,0,dn.t7HB,dn.t7l),new Gi(6,0,dn.t8HB,dn.t8l),new Gi(6,0,dn.t9HB,dn.t9l),new Gi(8,0,dn.t10HB,dn.t10l),new Gi(8,0,dn.t11HB,dn.t11l),new Gi(8,0,dn.t12HB,dn.t12l),new Gi(16,0,dn.t13HB,dn.t13l),new Gi(0,0,null,dn.t16_5l),new Gi(16,0,dn.t15HB,dn.t15l),new Gi(1,1,dn.t16HB,dn.t16l),new Gi(2,3,dn.t16HB,dn.t16l),new Gi(3,7,dn.t16HB,dn.t16l),new Gi(4,15,dn.t16HB,dn.t16l),new Gi(6,63,dn.t16HB,dn.t16l),new Gi(8,255,dn.t16HB,dn.t16l),new Gi(10,1023,dn.t16HB,dn.t16l),new Gi(13,8191,dn.t16HB,dn.t16l),new Gi(4,15,dn.t24HB,dn.t24l),new Gi(5,31,dn.t24HB,dn.t24l),new Gi(6,63,dn.t24HB,dn.t24l),new Gi(7,127,dn.t24HB,dn.t24l),new Gi(8,255,dn.t24HB,dn.t24l),new Gi(9,511,dn.t24HB,dn.t24l),new Gi(11,2047,dn.t24HB,dn.t24l),new Gi(13,8191,dn.t24HB,dn.t24l),new Gi(0,0,dn.t32HB,dn.t32l),new Gi(0,0,dn.t33HB,dn.t33l)];dn.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];dn.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];dn.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];dn.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];dn.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]];dn.scfsi_band=[0,6,11,16,21];var X8=dn,$2,VV;function Xne(){if(VV)return $2;VV=1;var n=Gne,e=No,t=e.VbrMode,r=e.Float,i=e.Util,s=e.new_float,o=e.new_int,a=e.assert,c=Yl(),l=Kne,u=N3;h.Q_MAX=257,h.Q_MAX2=116,h.LARGE_BITS=1e5,h.IXMAX_VAL=8206;function h(){var f=Z8(),d=null,p=null,m=null;this.setModules=function(H,X,G){d=H,p=X,m=G};function _(H){return a(0<=H+h.Q_MAX2&&H<h.Q_MAX),N[H+h.Q_MAX2]}this.IPOW20=function(H){return a(0<=H&&H<h.Q_MAX),U[H]};var v=2220446049250313e-31,S=h.IXMAX_VAL,b=S+2,T=h.Q_MAX,w=h.Q_MAX2;h.LARGE_BITS;var R=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var C=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=C,this.sfBandIndex=[new n([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0/3,12/3,24/3,36/3,54/3,78/3,108/3,144/3,186/3,240/3,312/3,402/3,522/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new n([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0/3,24/3,48/3,72/3,108/3,156/3,216/3,288/3,372/3,480/3,486/3,492/3,498/3,576/3],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var N=s(T+w+1),U=s(T),B=s(b),$=s(b);this.adj43=$;function I(H,X){var G=m.ATHformula(X,H);return G-=R,G=Math.pow(10,G/10+H.ATHlower),G}function L(H){for(var X=H.internal_flags.ATH.l,G=H.internal_flags.ATH.psfb21,Y=H.internal_flags.ATH.s,J=H.internal_flags.ATH.psfb12,Q=H.internal_flags,z=H.out_samplerate,q=0;q<c.SBMAX_l;q++){var ee=Q.scalefac_band.l[q],te=Q.scalefac_band.l[q+1];X[q]=r.MAX_VALUE;for(var ie=ee;ie<te;ie++){var Ee=ie*z/1152,Re=I(H,Ee);X[q]=Math.min(X[q],Re)}}for(var q=0;q<c.PSFB21;q++){var ee=Q.scalefac_band.psfb21[q],te=Q.scalefac_band.psfb21[q+1];G[q]=r.MAX_VALUE;for(var ie=ee;ie<te;ie++){var Ee=ie*z/1152,Re=I(H,Ee);G[q]=Math.min(G[q],Re)}}for(var q=0;q<c.SBMAX_s;q++){var ee=Q.scalefac_band.s[q],te=Q.scalefac_band.s[q+1];Y[q]=r.MAX_VALUE;for(var ie=ee;ie<te;ie++){var Ee=ie*z/384,Re=I(H,Ee);Y[q]=Math.min(Y[q],Re)}Y[q]*=Q.scalefac_band.s[q+1]-Q.scalefac_band.s[q]}for(var q=0;q<c.PSFB12;q++){var ee=Q.scalefac_band.psfb12[q],te=Q.scalefac_band.psfb12[q+1];J[q]=r.MAX_VALUE;for(var ie=ee;ie<te;ie++){var Ee=ie*z/384,Re=I(H,Ee);J[q]=Math.min(J[q],Re)}J[q]*=Q.scalefac_band.s[13]-Q.scalefac_band.s[12]}if(H.noATH){for(var q=0;q<c.SBMAX_l;q++)X[q]=1e-20;for(var q=0;q<c.PSFB21;q++)G[q]=1e-20;for(var q=0;q<c.SBMAX_s;q++)Y[q]=1e-20;for(var q=0;q<c.PSFB12;q++)J[q]=1e-20}Q.ATH.floor=10*Math.log10(I(H,-1))}this.iteration_init=function(H){var X=H.internal_flags,G=X.l3_side,Y;if(X.iteration_init_init==0){for(X.iteration_init_init=1,G.main_data_begin=0,L(H),B[0]=0,Y=1;Y<b;Y++)B[Y]=Math.pow(Y,4/3);for(Y=0;Y<b-1;Y++)$[Y]=Y+1-Math.pow(.5*(B[Y]+B[Y+1]),.75);for($[Y]=.5,Y=0;Y<T;Y++)U[Y]=Math.pow(2,(Y-210)*-.1875);for(Y=0;Y<=T+w;Y++)N[Y]=Math.pow(2,(Y-210-w)*.25);d.huffman_init(X);{var J,Q,z,q;for(Y=H.exp_nspsytune>>2&63,Y>=32&&(Y-=64),J=Math.pow(10,Y/4/10),Y=H.exp_nspsytune>>8&63,Y>=32&&(Y-=64),Q=Math.pow(10,Y/4/10),Y=H.exp_nspsytune>>14&63,Y>=32&&(Y-=64),z=Math.pow(10,Y/4/10),Y=H.exp_nspsytune>>20&63,Y>=32&&(Y-=64),q=z*Math.pow(10,Y/4/10),Y=0;Y<c.SBMAX_l;Y++){var ee;Y<=6?ee=J:Y<=13?ee=Q:Y<=20?ee=z:ee=q,X.nsPsy.longfact[Y]=ee}for(Y=0;Y<c.SBMAX_s;Y++){var ee;Y<=5?ee=J:Y<=10?ee=Q:Y<=11?ee=z:ee=q,X.nsPsy.shortfact[Y]=ee}}}},this.on_pe=function(H,X,G,Y,J,Q){var z=H.internal_flags,q=0,ee,te=o(2),ie,Ee=new l(q),Re=p.ResvMaxBits(H,Y,Ee,Q);q=Ee.bits;var Te=q+Re;for(Te>u.MAX_BITS_PER_GRANULE&&(Te=u.MAX_BITS_PER_GRANULE),ee=0,ie=0;ie<z.channels_out;++ie)G[ie]=Math.min(u.MAX_BITS_PER_CHANNEL,q/z.channels_out),te[ie]=0|G[ie]*X[J][ie]/700-G[ie],te[ie]>Y*3/4&&(te[ie]=Y*3/4),te[ie]<0&&(te[ie]=0),te[ie]+G[ie]>u.MAX_BITS_PER_CHANNEL&&(te[ie]=Math.max(0,u.MAX_BITS_PER_CHANNEL-G[ie])),ee+=te[ie];if(ee>Re)for(ie=0;ie<z.channels_out;++ie)te[ie]=Re*te[ie]/ee;for(ie=0;ie<z.channels_out;++ie)G[ie]+=te[ie],Re-=te[ie];for(ee=0,ie=0;ie<z.channels_out;++ie)ee+=G[ie];if(ee>u.MAX_BITS_PER_GRANULE){var Pe=0;for(ie=0;ie<z.channels_out;++ie)G[ie]*=u.MAX_BITS_PER_GRANULE,G[ie]/=ee,Pe+=G[ie]}return Te},this.reduce_side=function(H,X,G,Y){a(H[0]+H[1]<=u.MAX_BITS_PER_GRANULE);var J=.33*(.5-X)/.5;J<0&&(J=0),J>.5&&(J=.5);var Q=0|J*.5*(H[0]+H[1]);Q>u.MAX_BITS_PER_CHANNEL-H[0]&&(Q=u.MAX_BITS_PER_CHANNEL-H[0]),Q<0&&(Q=0),H[1]>=125&&(H[1]-Q>125?(H[0]<G&&(H[0]+=Q),H[1]-=Q):(H[0]+=H[1]-125,H[1]=125)),Q=H[0]+H[1],Q>Y&&(H[0]=Y*H[0]/Q,H[1]=Y*H[1]/Q),a(H[0]<=u.MAX_BITS_PER_CHANNEL),a(H[1]<=u.MAX_BITS_PER_CHANNEL),a(H[0]+H[1]<=u.MAX_BITS_PER_GRANULE)},this.athAdjust=function(H,X,G){var Y=90.30873362,J=94.82444863,Q=i.FAST_LOG10_X(X,10),z=H*H,q=0;return Q-=G,z>1e-20&&(q=1+i.FAST_LOG10_X(z,10/Y)),q<0&&(q=0),Q*=q,Q+=G+Y-J,Math.pow(10,.1*Q)},this.calc_xmin=function(H,X,G,Y){var J=0,Q=H.internal_flags,z,q=0,ee=0,te=Q.ATH,ie=G.xr,Ee=H.VBR==t.vbr_mtrh?1:0,Re=Q.masking_lower;for((H.VBR==t.vbr_mtrh||H.VBR==t.vbr_mt)&&(Re=1),z=0;z<G.psy_lmax;z++){var Te,Pe,We,it,ht,vt;H.VBR==t.vbr_rh||H.VBR==t.vbr_mtrh?Pe=athAdjust(te.adjust,te.l[z],te.floor):Pe=te.adjust*te.l[z],ht=G.width[z],We=Pe/ht,it=v,vt=ht>>1,Te=0;do{var re,Le;re=ie[q]*ie[q],Te+=re,it+=re<We?re:We,q++,Le=ie[q]*ie[q],Te+=Le,it+=Le<We?Le:We,q++}while(--vt>0);if(Te>Pe&&ee++,z==c.SBPSY_l){var $e=Pe*Q.nsPsy.longfact[z];it<$e&&(it=$e)}if(Ee!=0&&(Pe=it),!H.ATHonly){var De=X.en.l[z];if(De>0){var $e;$e=Te*X.thm.l[z]*Re/De,Ee!=0&&($e*=Q.nsPsy.longfact[z]),Pe<$e&&(Pe=$e)}}Ee!=0?Y[J++]=Pe:Y[J++]=Pe*Q.nsPsy.longfact[z]}var Oe=575;if(G.block_type!=c.SHORT_TYPE)for(var ae=576;ae--!=0&&f.EQ(ie[ae],0);)Oe=ae;G.max_nonzero_coeff=Oe;for(var ve=G.sfb_smin;z<G.psymax;ve++,z+=3){var ht,xe,pe;for(H.VBR==t.vbr_rh||H.VBR==t.vbr_mtrh?pe=athAdjust(te.adjust,te.s[ve],te.floor):pe=te.adjust*te.s[ve],ht=G.width[z],xe=0;xe<3;xe++){var Te=0,Pe,We,it,vt=ht>>1;We=pe/ht,it=v;do{var re,Le;re=ie[q]*ie[q],Te+=re,it+=re<We?re:We,q++,Le=ie[q]*ie[q],Te+=Le,it+=Le<We?Le:We,q++}while(--vt>0);if(Te>pe&&ee++,ve==c.SBPSY_s){var $e=pe*Q.nsPsy.shortfact[ve];it<$e&&(it=$e)}if(Ee!=0?Pe=it:Pe=pe,!H.ATHonly&&!H.ATHshort){var De=X.en.s[ve][xe];if(De>0){var $e;$e=Te*X.thm.s[ve][xe]*Re/De,Ee!=0&&($e*=Q.nsPsy.shortfact[ve]),Pe<$e&&(Pe=$e)}}Ee!=0?Y[J++]=Pe:Y[J++]=Pe*Q.nsPsy.shortfact[ve]}H.useTemporal&&(Y[J-3]>Y[J-3+1]&&(Y[J-3+1]+=(Y[J-3]-Y[J-3+1])*Q.decay),Y[J-3+1]>Y[J-3+2]&&(Y[J-3+2]+=(Y[J-3+1]-Y[J-3+2])*Q.decay))}return ee};function P(H){this.s=H}this.calc_noise_core=function(H,X,G,Y){var J=0,Q=X.s,z=H.l3_enc;if(Q>H.count1)for(;G--!=0;){var q;q=H.xr[Q],Q++,J+=q*q,q=H.xr[Q],Q++,J+=q*q}else if(Q>H.big_values){var ee=s(2);for(ee[0]=0,ee[1]=Y;G--!=0;){var q;q=Math.abs(H.xr[Q])-ee[z[Q]],Q++,J+=q*q,q=Math.abs(H.xr[Q])-ee[z[Q]],Q++,J+=q*q}}else for(;G--!=0;){var q;q=Math.abs(H.xr[Q])-B[z[Q]]*Y,Q++,J+=q*q,q=Math.abs(H.xr[Q])-B[z[Q]]*Y,Q++,J+=q*q}return X.s=Q,J},this.calc_noise=function(H,X,G,Y,J){var Q=0,z=0,q,ee,te=0,ie=0,Ee=0,Re=-20,Te=0,Pe=H.scalefac,We=0;for(Y.over_SSD=0,q=0;q<H.psymax;q++){var it=H.global_gain-(Pe[We++]+(H.preflag!=0?C[q]:0)<<H.scalefac_scale+1)-H.subblock_gain[H.window[q]]*8,ht=0;if(J!=null&&J.step[q]==it)ht=J.noise[q],Te+=H.width[q],G[Q++]=ht/X[z++],ht=J.noise_log[q];else{var vt=_(it);if(ee=H.width[q]>>1,Te+H.width[q]>H.max_nonzero_coeff){var re;re=H.max_nonzero_coeff-Te+1,re>0?ee=re>>1:ee=0}var Le=new P(Te);ht=this.calc_noise_core(H,Le,ee,vt),Te=Le.s,J!=null&&(J.step[q]=it,J.noise[q]=ht),ht=G[Q++]=ht/X[z++],ht=i.FAST_LOG10(Math.max(ht,1e-20)),J!=null&&(J.noise_log[q]=ht)}if(J!=null&&(J.global_gain=H.global_gain),Ee+=ht,ht>0){var $e;$e=Math.max(0|ht*10+.5,1),Y.over_SSD+=$e*$e,te++,ie+=ht}Re=Math.max(Re,ht)}return Y.over_count=te,Y.tot_noise=Ee,Y.over_noise=ie,Y.max_noise=Re,te},this.set_pinfo=function(H,X,G,Y,J){var Q=H.internal_flags,z,q,ee,te,ie,Ee=X.scalefac_scale==0?.5:1,Re=X.scalefac,Te=s(L3Side.SFBMAX),Pe=s(L3Side.SFBMAX),We=new CalcNoiseResult;calc_xmin(H,G,X,Te),calc_noise(X,Te,Pe,We,null);var it=0;for(q=X.sfb_lmax,X.block_type!=c.SHORT_TYPE&&X.mixed_block_flag==0&&(q=22),z=0;z<q;z++){var ht=Q.scalefac_band.l[z],vt=Q.scalefac_band.l[z+1],re=vt-ht;for(te=0;it<vt;it++)te+=X.xr[it]*X.xr[it];te/=re,ie=1e15,Q.pinfo.en[Y][J][z]=ie*te,Q.pinfo.xfsf[Y][J][z]=ie*Te[z]*Pe[z]/re,G.en.l[z]>0&&!H.ATHonly?te=te/G.en.l[z]:te=0,Q.pinfo.thr[Y][J][z]=ie*Math.max(te*G.thm.l[z],Q.ATH.l[z]),Q.pinfo.LAMEsfb[Y][J][z]=0,X.preflag!=0&&z>=11&&(Q.pinfo.LAMEsfb[Y][J][z]=-Ee*C[z]),z<c.SBPSY_l&&(a(Re[z]>=0),Q.pinfo.LAMEsfb[Y][J][z]-=Ee*Re[z])}if(X.block_type==c.SHORT_TYPE)for(q=z,z=X.sfb_smin;z<c.SBMAX_s;z++)for(var ht=Q.scalefac_band.s[z],vt=Q.scalefac_band.s[z+1],re=vt-ht,Le=0;Le<3;Le++){for(te=0,ee=ht;ee<vt;ee++)te+=X.xr[it]*X.xr[it],it++;te=Math.max(te/re,1e-20),ie=1e15,Q.pinfo.en_s[Y][J][3*z+Le]=ie*te,Q.pinfo.xfsf_s[Y][J][3*z+Le]=ie*Te[q]*Pe[q]/re,G.en.s[z][Le]>0?te=te/G.en.s[z][Le]:te=0,(H.ATHonly||H.ATHshort)&&(te=0),Q.pinfo.thr_s[Y][J][3*z+Le]=ie*Math.max(te*G.thm.s[z][Le],Q.ATH.s[z]),Q.pinfo.LAMEsfb_s[Y][J][3*z+Le]=-2*X.subblock_gain[Le],z<c.SBPSY_s&&(Q.pinfo.LAMEsfb_s[Y][J][3*z+Le]-=Ee*Re[q]),q++}Q.pinfo.LAMEqss[Y][J]=X.global_gain,Q.pinfo.LAMEmainbits[Y][J]=X.part2_3_length+X.part2_length,Q.pinfo.LAMEsfbits[Y][J]=X.part2_length,Q.pinfo.over[Y][J]=We.over_count,Q.pinfo.max_noise[Y][J]=We.max_noise*10,Q.pinfo.over_noise[Y][J]=We.over_noise*10,Q.pinfo.tot_noise[Y][J]=We.tot_noise*10,Q.pinfo.over_SSD[Y][J]=We.over_SSD}}return $2=h,$2}var V2,HV;function Zne(){if(HV)return V2;HV=1;var n=No,e=n.System,t=n.Arrays,r=n.new_int,i=n.assert,s=Yl(),o=X8,a=q8,c=Xne();function l(){var u=null;this.qupvt=null,this.setModules=function(Q){this.qupvt=Q,u=Q};function h(Q){this.bits=0|Q}var f=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function d(Q,z,q,ee,te,ie){var Ee=.5946/z;for(Q=Q>>1;Q--!=0;)te[ie++]=Ee>q[ee++]?0:1,te[ie++]=Ee>q[ee++]?0:1}function p(Q,z,q,ee,te,ie){Q=Q>>1;var Ee=Q%2;for(Q=Q>>1;Q--!=0;){var Re,Te,Pe,We,it,ht,vt,re;Re=q[ee++]*z,Te=q[ee++]*z,it=0|Re,Pe=q[ee++]*z,ht=0|Te,We=q[ee++]*z,vt=0|Pe,Re+=u.adj43[it],re=0|We,Te+=u.adj43[ht],te[ie++]=0|Re,Pe+=u.adj43[vt],te[ie++]=0|Te,We+=u.adj43[re],te[ie++]=0|Pe,te[ie++]=0|We}if(Ee!=0){var Re,Te,it,ht;Re=q[ee++]*z,Te=q[ee++]*z,it=0|Re,ht=0|Te,Re+=u.adj43[it],Te+=u.adj43[ht],te[ie++]=0|Re,te[ie++]=0|Te}}function m(Q,z,q,ee,te){var ie,Ee,Re=0,Te,Pe=0,We=0,it=0,ht=z,vt=0,re=ht,Le=0,$e=Q,De=0;for(Te=te!=null&&ee.global_gain==te.global_gain,ee.block_type==s.SHORT_TYPE?Ee=38:Ee=21,ie=0;ie<=Ee;ie++){var Oe=-1;if((Te||ee.block_type==s.NORM_TYPE)&&(Oe=ee.global_gain-(ee.scalefac[ie]+(ee.preflag!=0?u.pretab[ie]:0)<<ee.scalefac_scale+1)-ee.subblock_gain[ee.window[ie]]*8),i(ee.width[ie]>=0),Te&&te.step[ie]==Oe)Pe!=0&&(p(Pe,q,$e,De,re,Le),Pe=0),We!=0&&(d(We,q,$e,De,re,Le),We=0);else{var ae=ee.width[ie];if(Re+ee.width[ie]>ee.max_nonzero_coeff){var ve;ve=ee.max_nonzero_coeff-Re+1,t.fill(z,ee.max_nonzero_coeff,576,0),ae=ve,ae<0&&(ae=0),ie=Ee+1}if(Pe==0&&We==0&&(re=ht,Le=vt,$e=Q,De=it),te!=null&&te.sfb_count1>0&&ie>=te.sfb_count1&&te.step[ie]>0&&Oe>=te.step[ie]?(Pe!=0&&(p(Pe,q,$e,De,re,Le),Pe=0,re=ht,Le=vt,$e=Q,De=it),We+=ae):(We!=0&&(d(We,q,$e,De,re,Le),We=0,re=ht,Le=vt,$e=Q,De=it),Pe+=ae),ae<=0){We!=0&&(d(We,q,$e,De,re,Le),We=0),Pe!=0&&(p(Pe,q,$e,De,re,Le),Pe=0);break}}ie<=Ee&&(vt+=ee.width[ie],it+=ee.width[ie],Re+=ee.width[ie])}Pe!=0&&(p(Pe,q,$e,De,re,Le),Pe=0),We!=0&&(d(We,q,$e,De,re,Le),We=0)}function _(Q,z,q){var ee=0,te=0;do{var ie=Q[z++],Ee=Q[z++];ee<ie&&(ee=ie),te<Ee&&(te=Ee)}while(z<q);return ee<te&&(ee=te),ee}function v(Q,z,q,ee,te,ie){var Ee=o.ht[ee].xlen*65536+o.ht[te].xlen,Re=0,Te;do{var Pe=Q[z++],We=Q[z++];Pe!=0&&(Pe>14&&(Pe=15,Re+=Ee),Pe*=16),We!=0&&(We>14&&(We=15,Re+=Ee),Pe+=We),Re+=o.largetbl[Pe]}while(z<q);return Te=Re&65535,Re>>=16,Re>Te&&(Re=Te,ee=te),ie.bits+=Re,ee}function S(Q,z,q,ee){var te=0,ie=o.ht[1].hlen;do{var Ee=Q[z+0]*2+Q[z+1];z+=2,te+=ie[Ee]}while(z<q);return ee.bits+=te,1}function b(Q,z,q,ee,te){var ie=0,Ee,Re=o.ht[ee].xlen,Te;ee==2?Te=o.table23:Te=o.table56;do{var Pe=Q[z+0]*Re+Q[z+1];z+=2,ie+=Te[Pe]}while(z<q);return Ee=ie&65535,ie>>=16,ie>Ee&&(ie=Ee,ee++),te.bits+=ie,ee}function T(Q,z,q,ee,te){var ie=0,Ee=0,Re=0,Te=o.ht[ee].xlen,Pe=o.ht[ee].hlen,We=o.ht[ee+1].hlen,it=o.ht[ee+2].hlen;do{var ht=Q[z+0]*Te+Q[z+1];z+=2,ie+=Pe[ht],Ee+=We[ht],Re+=it[ht]}while(z<q);var vt=ee;return ie>Ee&&(ie=Ee,vt++),ie>Re&&(ie=Re,vt=ee+2),te.bits+=ie,vt}var w=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function R(Q,z,q,ee){var te=_(Q,z,q);switch(te){case 0:return te;case 1:return S(Q,z,q,ee);case 2:case 3:return b(Q,z,q,w[te-1],ee);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return T(Q,z,q,w[te-1],ee);default:if(te>c.IXMAX_VAL)return ee.bits=c.LARGE_BITS,-1;te-=15;var ie;for(ie=24;ie<32&&!(o.ht[ie].linmax>=te);ie++);var Ee;for(Ee=ie-8;Ee<24&&!(o.ht[Ee].linmax>=te);Ee++);return v(Q,z,q,Ee,ie,ee)}}this.noquant_count_bits=function(Q,z,q){var ee=z.l3_enc,te=Math.min(576,z.max_nonzero_coeff+2>>1<<1);for(q!=null&&(q.sfb_count1=0);te>1&&!(ee[te-1]|ee[te-2]);te-=2);z.count1=te;for(var ie=0,Ee=0;te>3;te-=4){var Re;if(((ee[te-1]|ee[te-2]|ee[te-3]|ee[te-4])&2147483647)>1)break;Re=((ee[te-4]*2+ee[te-3])*2+ee[te-2])*2+ee[te-1],ie+=o.t32l[Re],Ee+=o.t33l[Re]}var Te=ie;if(z.count1table_select=0,ie>Ee&&(Te=Ee,z.count1table_select=1),z.count1bits=Te,z.big_values=te,te==0)return Te;if(z.block_type==s.SHORT_TYPE)ie=3*Q.scalefac_band.s[3],ie>z.big_values&&(ie=z.big_values),Ee=z.big_values;else if(z.block_type==s.NORM_TYPE){if(ie=z.region0_count=Q.bv_scf[te-2],Ee=z.region1_count=Q.bv_scf[te-1],i(ie+Ee+2<s.SBPSY_l),Ee=Q.scalefac_band.l[ie+Ee+2],ie=Q.scalefac_band.l[ie+1],Ee<te){var Pe=new h(Te);z.table_select[2]=R(ee,Ee,te,Pe),Te=Pe.bits}}else z.region0_count=7,z.region1_count=s.SBMAX_l-1-7-1,ie=Q.scalefac_band.l[8],Ee=te,ie>Ee&&(ie=Ee);if(ie=Math.min(ie,te),Ee=Math.min(Ee,te),0<ie){var Pe=new h(Te);z.table_select[0]=R(ee,0,ie,Pe),Te=Pe.bits}if(ie<Ee){var Pe=new h(Te);z.table_select[1]=R(ee,ie,Ee,Pe),Te=Pe.bits}if(Q.use_best_huffman==2&&(z.part2_3_length=Te,best_huffman_divide(Q,z),Te=z.part2_3_length),q!=null&&z.block_type==s.NORM_TYPE){for(var We=0;Q.scalefac_band.l[We]<z.big_values;)We++;q.sfb_count1=We}return Te},this.count_bits=function(Q,z,q,ee){var te=q.l3_enc,ie=c.IXMAX_VAL/u.IPOW20(q.global_gain);if(q.xrpow_max>ie)return c.LARGE_BITS;if(m(z,te,u.IPOW20(q.global_gain),q,ee),Q.substep_shaping&2)for(var Ee=0,Re=q.global_gain+q.scalefac_scale,Te=.634521682242439/u.IPOW20(Re),Pe=0;Pe<q.sfbmax;Pe++){var We=q.width[Pe];if(Q.pseudohalf[Pe]==0)Ee+=We;else{var it;for(it=Ee,Ee+=We;it<Ee;++it)te[it]=z[it]>=Te?te[it]:0}}return this.noquant_count_bits(Q,q,ee)};function C(Q,z,q,ee,te,ie,Ee){for(var Re=z.big_values,Te=0;Te<=22;Te++)ee[Te]=c.LARGE_BITS;for(var Te=0;Te<16;Te++){var Pe=Q.scalefac_band.l[Te+1];if(Pe>=Re)break;var We=0,it=new h(We),ht=R(q,0,Pe,it);We=it.bits;for(var vt=0;vt<8;vt++){var re=Q.scalefac_band.l[Te+vt+2];if(re>=Re)break;var Le=We;it=new h(Le);var $e=R(q,Pe,re,it);Le=it.bits,ee[Te+vt]>Le&&(ee[Te+vt]=Le,te[Te+vt]=Te,ie[Te+vt]=ht,Ee[Te+vt]=$e)}}}function N(Q,z,q,ee,te,ie,Ee,Re){for(var Te=z.big_values,Pe=2;Pe<s.SBMAX_l+1;Pe++){var We=Q.scalefac_band.l[Pe];if(We>=Te)break;var it=te[Pe-2]+z.count1bits;if(q.part2_3_length<=it)break;var ht=new h(it),vt=R(ee,We,Te,ht);it=ht.bits,!(q.part2_3_length<=it)&&(q.assign(z),q.part2_3_length=it,q.region0_count=ie[Pe-2],q.region1_count=Pe-2-ie[Pe-2],q.table_select[0]=Ee[Pe-2],q.table_select[1]=Re[Pe-2],q.table_select[2]=vt)}}this.best_huffman_divide=function(Q,z){var q=new a,ee=z.l3_enc,te=r(23),ie=r(23),Ee=r(23),Re=r(23);if(!(z.block_type==s.SHORT_TYPE&&Q.mode_gr==1)){q.assign(z),z.block_type==s.NORM_TYPE&&(C(Q,z,ee,te,ie,Ee,Re),N(Q,q,z,ee,te,ie,Ee,Re));var Te=q.big_values;if(!(Te==0||(ee[Te-2]|ee[Te-1])>1)&&(Te=z.count1+2,!(Te>576))){q.assign(z),q.count1=Te;for(var Pe=0,We=0;Te>q.big_values;Te-=4){var it=((ee[Te-4]*2+ee[Te-3])*2+ee[Te-2])*2+ee[Te-1];Pe+=o.t32l[it],We+=o.t33l[it]}if(q.big_values=Te,q.count1table_select=0,Pe>We&&(Pe=We,q.count1table_select=1),q.count1bits=Pe,q.block_type==s.NORM_TYPE)N(Q,q,z,ee,te,ie,Ee,Re);else{if(q.part2_3_length=Pe,Pe=Q.scalefac_band.l[8],Pe>Te&&(Pe=Te),Pe>0){var ht=new h(q.part2_3_length);q.table_select[0]=R(ee,0,Pe,ht),q.part2_3_length=ht.bits}if(Te>Pe){var ht=new h(q.part2_3_length);q.table_select[1]=R(ee,Pe,Te,ht),q.part2_3_length=ht.bits}z.part2_3_length>q.part2_3_length&&z.assign(q)}}}};var U=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],B=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],$=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],I=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];l.slen1_tab=$,l.slen2_tab=I;function L(Q,z){for(var q,ee=z.tt[1][Q],te=z.tt[0][Q],ie=0;ie<o.scfsi_band.length-1;ie++){for(q=o.scfsi_band[ie];q<o.scfsi_band[ie+1]&&!(te.scalefac[q]!=ee.scalefac[q]&&ee.scalefac[q]>=0);q++);if(q==o.scfsi_band[ie+1]){for(q=o.scfsi_band[ie];q<o.scfsi_band[ie+1];q++)ee.scalefac[q]=-1;z.scfsi[Q][ie]=1}}var Ee=0,Re=0;for(q=0;q<11;q++)ee.scalefac[q]!=-1&&(Re++,Ee<ee.scalefac[q]&&(Ee=ee.scalefac[q]));for(var Te=0,Pe=0;q<s.SBPSY_l;q++)ee.scalefac[q]!=-1&&(Pe++,Te<ee.scalefac[q]&&(Te=ee.scalefac[q]));for(var ie=0;ie<16;ie++)if(Ee<U[ie]&&Te<B[ie]){var We=$[ie]*Re+I[ie]*Pe;ee.part2_length>We&&(ee.part2_length=We,ee.scalefac_compress=ie)}}this.best_scalefac_store=function(Q,z,q,ee){var te=ee.tt[z][q],ie,Ee,Re,Te,Pe=0;for(Re=0,ie=0;ie<te.sfbmax;ie++){var We=te.width[ie];for(Re+=We,Te=-We;Te<0&&te.l3_enc[Te+Re]==0;Te++);Te==0&&(te.scalefac[ie]=Pe=-2)}if(te.scalefac_scale==0&&te.preflag==0){var it=0;for(ie=0;ie<te.sfbmax;ie++)te.scalefac[ie]>0&&(it|=te.scalefac[ie]);if(!(it&1)&&it!=0){for(ie=0;ie<te.sfbmax;ie++)te.scalefac[ie]>0&&(te.scalefac[ie]>>=1);te.scalefac_scale=Pe=1}}if(te.preflag==0&&te.block_type!=s.SHORT_TYPE&&Q.mode_gr==2){for(ie=11;ie<s.SBPSY_l&&!(te.scalefac[ie]<u.pretab[ie]&&te.scalefac[ie]!=-2);ie++);if(ie==s.SBPSY_l){for(ie=11;ie<s.SBPSY_l;ie++)te.scalefac[ie]>0&&(te.scalefac[ie]-=u.pretab[ie]);te.preflag=Pe=1}}for(Ee=0;Ee<4;Ee++)ee.scfsi[q][Ee]=0;for(Q.mode_gr==2&&z==1&&ee.tt[0][q].block_type!=s.SHORT_TYPE&&ee.tt[1][q].block_type!=s.SHORT_TYPE&&(L(q,ee),Pe=0),ie=0;ie<te.sfbmax;ie++)te.scalefac[ie]==-2&&(te.scalefac[ie]=0);Pe!=0&&(Q.mode_gr==2?this.scale_bitcount(te):this.scale_bitcount_lsf(Q,te))};function P(Q,z){for(var q=0;q<z;++q)if(Q[q]<0)return!1;return!0}var H=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],X=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],G=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(Q){var z,q,ee=0,te=0,ie,Ee=Q.scalefac;if(i(P(Ee,Q.sfbmax)),Q.block_type==s.SHORT_TYPE)ie=H,Q.mixed_block_flag!=0&&(ie=X);else if(ie=G,Q.preflag==0){for(q=11;q<s.SBPSY_l&&!(Ee[q]<u.pretab[q]);q++);if(q==s.SBPSY_l)for(Q.preflag=1,q=11;q<s.SBPSY_l;q++)Ee[q]-=u.pretab[q]}for(q=0;q<Q.sfbdivide;q++)ee<Ee[q]&&(ee=Ee[q]);for(;q<Q.sfbmax;q++)te<Ee[q]&&(te=Ee[q]);for(Q.part2_length=c.LARGE_BITS,z=0;z<16;z++)ee<U[z]&&te<B[z]&&Q.part2_length>ie[z]&&(Q.part2_length=ie[z],Q.scalefac_compress=z);return Q.part2_length==c.LARGE_BITS};var Y=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(Q,z){var q,ee,te,ie,Ee,Re,Te,Pe,We=r(4),it=z.scalefac;for(z.preflag!=0?q=2:q=0,Te=0;Te<4;Te++)We[Te]=0;if(z.block_type==s.SHORT_TYPE){ee=1;var ht=u.nr_of_sfb_block[q][ee];for(Pe=0,te=0;te<4;te++)for(ie=ht[te]/3,Te=0;Te<ie;Te++,Pe++)for(Ee=0;Ee<3;Ee++)it[Pe*3+Ee]>We[te]&&(We[te]=it[Pe*3+Ee])}else{ee=0;var ht=u.nr_of_sfb_block[q][ee];for(Pe=0,te=0;te<4;te++)for(ie=ht[te],Te=0;Te<ie;Te++,Pe++)it[Pe]>We[te]&&(We[te]=it[Pe])}for(Re=!1,te=0;te<4;te++)We[te]>Y[q][te]&&(Re=!0);if(!Re){var vt,re,Le,$e;for(z.sfb_partition_table=u.nr_of_sfb_block[q][ee],te=0;te<4;te++)z.slen[te]=J[We[te]];switch(vt=z.slen[0],re=z.slen[1],Le=z.slen[2],$e=z.slen[3],q){case 0:z.scalefac_compress=(vt*5+re<<4)+(Le<<2)+$e;break;case 1:z.scalefac_compress=400+(vt*5+re<<2)+Le;break;case 2:z.scalefac_compress=500+vt*3+re;break;default:e.err.printf(`intensity stereo not implemented yet
`);break}}if(!Re)for(i(z.sfb_partition_table!=null),z.part2_length=0,te=0;te<4;te++)z.part2_length+=z.slen[te]*z.sfb_partition_table[te];return Re};var J=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(Q){for(var z=2;z<=576;z+=2){for(var q=0,ee;Q.scalefac_band.l[++q]<z;);for(ee=f[q][0];Q.scalefac_band.l[ee+1]>z;)ee--;for(ee<0&&(ee=f[q][0]),Q.bv_scf[z-2]=ee,ee=f[q][1];Q.scalefac_band.l[ee+Q.bv_scf[z-2]+2]>z;)ee--;ee<0&&(ee=f[q][1]),Q.bv_scf[z-1]=ee}}}return V2=l,V2}var H2,GV;function Z8(){if(GV)return H2;GV=1;var n=No,e=n.System,t=n.Arrays,r=n.new_byte,i=n.new_float_n,s=n.new_int,o=n.assert,a=Zne(),c=X8,l=Yl(),u=N3;h.EQ=function(f,d){return Math.abs(f)>Math.abs(d)?Math.abs(f-d)<=Math.abs(f)*1e-6:Math.abs(f-d)<=Math.abs(d)*1e-6},h.NEQ=function(f,d){return!h.EQ(f,d)};function h(){var f=J8(),d=this,p=32773,m=null,_=null,v=null,S=null;this.setModules=function(z,q,ee,te){m=z,_=q,v=ee,S=te};var b=null,T=0,w=0,R=0;this.getframebits=function(z){var q=z.internal_flags,ee;q.bitrate_index!=0?ee=c.bitrate_table[z.version][q.bitrate_index]:ee=z.brate;var te=0|(z.version+1)*72e3*ee/z.out_samplerate+q.padding;return 8*te};function C(z){e.arraycopy(z.header[z.w_ptr].buf,0,b,w,z.sideinfo_len),w+=z.sideinfo_len,T+=z.sideinfo_len*8,z.w_ptr=z.w_ptr+1&u.MAX_HEADER_BUF-1}function N(z,q,ee){for(;ee>0;){var te;R==0&&(R=8,w++,o(w<f.LAME_MAXMP3BUFFER),o(z.header[z.w_ptr].write_timing>=T),z.header[z.w_ptr].write_timing==T&&C(z),b[w]=0),te=Math.min(ee,R),ee-=te,R-=te,b[w]|=q>>ee<<R,T+=te}}function U(z,q,ee){for(;ee>0;){var te;R==0&&(R=8,w++,o(w<f.LAME_MAXMP3BUFFER),b[w]=0),te=Math.min(ee,R),ee-=te,R-=te,b[w]|=q>>ee<<R,T+=te}}function B(z,q){var ee=z.internal_flags,te;if(q>=8&&(N(ee,76,8),q-=8),q>=8&&(N(ee,65,8),q-=8),q>=8&&(N(ee,77,8),q-=8),q>=8&&(N(ee,69,8),q-=8),q>=32){var ie=v.getLameShortVersion();if(q>=32)for(te=0;te<ie.length&&q>=8;++te)q-=8,N(ee,ie.charAt(te),8)}for(;q>=1;q-=1)N(ee,ee.ancillary_flag,1),ee.ancillary_flag^=z.disable_reservoir?0:1}function $(z,q,ee){for(var te=z.header[z.h_ptr].ptr;ee>0;){var ie=Math.min(ee,8-(te&7));ee-=ie,z.header[z.h_ptr].buf[te>>3]|=q>>ee<<8-(te&7)-ie,te+=ie}z.header[z.h_ptr].ptr=te}function I(z,q){z<<=8;for(var ee=0;ee<8;ee++)z<<=1,q<<=1,(q^z)&65536&&(q^=p);return q}this.CRC_writeheader=function(z,q){var ee=65535;ee=I(q[2]&255,ee),ee=I(q[3]&255,ee);for(var te=6;te<z.sideinfo_len;te++)ee=I(q[te]&255,ee);q[4]=byte(ee>>8),q[5]=byte(ee&255)};function L(z,q){var ee=z.internal_flags,te,ie,Ee;if(te=ee.l3_side,ee.header[ee.h_ptr].ptr=0,t.fill(ee.header[ee.h_ptr].buf,0,ee.sideinfo_len,0),z.out_samplerate<16e3?$(ee,4094,12):$(ee,4095,12),$(ee,z.version,1),$(ee,1,2),$(ee,z.error_protection?0:1,1),$(ee,ee.bitrate_index,4),$(ee,ee.samplerate_index,2),$(ee,ee.padding,1),$(ee,z.extension,1),$(ee,z.mode.ordinal(),2),$(ee,ee.mode_ext,2),$(ee,z.copyright,1),$(ee,z.original,1),$(ee,z.emphasis,2),z.error_protection&&$(ee,0,16),z.version==1){for(o(te.main_data_begin>=0),$(ee,te.main_data_begin,9),ee.channels_out==2?$(ee,te.private_bits,3):$(ee,te.private_bits,5),Ee=0;Ee<ee.channels_out;Ee++){var Re;for(Re=0;Re<4;Re++)$(ee,te.scfsi[Ee][Re],1)}for(ie=0;ie<2;ie++)for(Ee=0;Ee<ee.channels_out;Ee++){var Te=te.tt[ie][Ee];$(ee,Te.part2_3_length+Te.part2_length,12),$(ee,Te.big_values/2,9),$(ee,Te.global_gain,8),$(ee,Te.scalefac_compress,4),Te.block_type!=l.NORM_TYPE?($(ee,1,1),$(ee,Te.block_type,2),$(ee,Te.mixed_block_flag,1),Te.table_select[0]==14&&(Te.table_select[0]=16),$(ee,Te.table_select[0],5),Te.table_select[1]==14&&(Te.table_select[1]=16),$(ee,Te.table_select[1],5),$(ee,Te.subblock_gain[0],3),$(ee,Te.subblock_gain[1],3),$(ee,Te.subblock_gain[2],3)):($(ee,0,1),Te.table_select[0]==14&&(Te.table_select[0]=16),$(ee,Te.table_select[0],5),Te.table_select[1]==14&&(Te.table_select[1]=16),$(ee,Te.table_select[1],5),Te.table_select[2]==14&&(Te.table_select[2]=16),$(ee,Te.table_select[2],5),o(0<=Te.region0_count&&Te.region0_count<16),o(0<=Te.region1_count&&Te.region1_count<8),$(ee,Te.region0_count,4),$(ee,Te.region1_count,3)),$(ee,Te.preflag,1),$(ee,Te.scalefac_scale,1),$(ee,Te.count1table_select,1)}}else for(o(te.main_data_begin>=0),$(ee,te.main_data_begin,8),$(ee,te.private_bits,ee.channels_out),ie=0,Ee=0;Ee<ee.channels_out;Ee++){var Te=te.tt[ie][Ee];$(ee,Te.part2_3_length+Te.part2_length,12),$(ee,Te.big_values/2,9),$(ee,Te.global_gain,8),$(ee,Te.scalefac_compress,9),Te.block_type!=l.NORM_TYPE?($(ee,1,1),$(ee,Te.block_type,2),$(ee,Te.mixed_block_flag,1),Te.table_select[0]==14&&(Te.table_select[0]=16),$(ee,Te.table_select[0],5),Te.table_select[1]==14&&(Te.table_select[1]=16),$(ee,Te.table_select[1],5),$(ee,Te.subblock_gain[0],3),$(ee,Te.subblock_gain[1],3),$(ee,Te.subblock_gain[2],3)):($(ee,0,1),Te.table_select[0]==14&&(Te.table_select[0]=16),$(ee,Te.table_select[0],5),Te.table_select[1]==14&&(Te.table_select[1]=16),$(ee,Te.table_select[1],5),Te.table_select[2]==14&&(Te.table_select[2]=16),$(ee,Te.table_select[2],5),o(0<=Te.region0_count&&Te.region0_count<16),o(0<=Te.region1_count&&Te.region1_count<8),$(ee,Te.region0_count,4),$(ee,Te.region1_count,3)),$(ee,Te.scalefac_scale,1),$(ee,Te.count1table_select,1)}z.error_protection&&CRC_writeheader(ee,ee.header[ee.h_ptr].buf);{var Pe=ee.h_ptr;o(ee.header[Pe].ptr==ee.sideinfo_len*8),ee.h_ptr=Pe+1&u.MAX_HEADER_BUF-1,ee.header[ee.h_ptr].write_timing=ee.header[Pe].write_timing+q,ee.h_ptr==ee.w_ptr&&e.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function P(z,q){var ee=c.ht[q.count1table_select+32],te,ie=0,Ee=q.big_values,Re=q.big_values;for(o(q.count1table_select<2),te=(q.count1-q.big_values)/4;te>0;--te){var Te=0,Pe=0,We;We=q.l3_enc[Ee+0],We!=0&&(Pe+=8,q.xr[Re+0]<0&&Te++),We=q.l3_enc[Ee+1],We!=0&&(Pe+=4,Te*=2,q.xr[Re+1]<0&&Te++),We=q.l3_enc[Ee+2],We!=0&&(Pe+=2,Te*=2,q.xr[Re+2]<0&&Te++),We=q.l3_enc[Ee+3],We!=0&&(Pe++,Te*=2,q.xr[Re+3]<0&&Te++),Ee+=4,Re+=4,N(z,Te+ee.table[Pe],ee.hlen[Pe]),ie+=ee.hlen[Pe]}return ie}function H(z,q,ee,te,ie){var Ee=c.ht[q],Re=0;if(q==0)return Re;for(var Te=ee;Te<te;Te+=2){var Pe=0,We=0,it=Ee.xlen,ht=Ee.xlen,vt=0,re=ie.l3_enc[Te],Le=ie.l3_enc[Te+1];if(re!=0&&(ie.xr[Te]<0&&vt++,Pe--),q>15){if(re>14){var $e=re-15;o($e<=Ee.linmax),vt|=$e<<1,We=it,re=15}if(Le>14){var De=Le-15;o(De<=Ee.linmax),vt<<=it,vt|=De,We+=it,Le=15}ht=16}Le!=0&&(vt<<=1,ie.xr[Te+1]<0&&vt++,Pe--),re=re*ht+Le,We-=Pe,Pe+=Ee.hlen[re],N(z,Ee.table[re],Pe),N(z,vt,We),Re+=Pe+We}return Re}function X(z,q){var ee=3*z.scalefac_band.s[3];ee>q.big_values&&(ee=q.big_values);var te=H(z,q.table_select[0],0,ee,q);return te+=H(z,q.table_select[1],ee,q.big_values,q),te}function G(z,q){var ee,te,ie,Ee;ee=q.big_values;var Re=q.region0_count+1;return o(Re<z.scalefac_band.l.length),ie=z.scalefac_band.l[Re],Re+=q.region1_count+1,o(Re<z.scalefac_band.l.length),Ee=z.scalefac_band.l[Re],ie>ee&&(ie=ee),Ee>ee&&(Ee=ee),te=H(z,q.table_select[0],0,ie,q),te+=H(z,q.table_select[1],ie,Ee,q),te+=H(z,q.table_select[2],Ee,ee,q),te}function Y(z){var q,ee,te,ie,Ee=0,Re=z.internal_flags,Te=Re.l3_side;if(z.version==1)for(q=0;q<2;q++)for(ee=0;ee<Re.channels_out;ee++){var Pe=Te.tt[q][ee],We=a.slen1_tab[Pe.scalefac_compress],it=a.slen2_tab[Pe.scalefac_compress];for(ie=0,te=0;te<Pe.sfbdivide;te++)Pe.scalefac[te]!=-1&&(N(Re,Pe.scalefac[te],We),ie+=We);for(;te<Pe.sfbmax;te++)Pe.scalefac[te]!=-1&&(N(Re,Pe.scalefac[te],it),ie+=it);o(ie==Pe.part2_length),Pe.block_type==l.SHORT_TYPE?ie+=X(Re,Pe):ie+=G(Re,Pe),ie+=P(Re,Pe),o(ie==Pe.part2_3_length+Pe.part2_length),Ee+=ie}else for(q=0,ee=0;ee<Re.channels_out;ee++){var Pe=Te.tt[q][ee],ht,vt,re=0;if(o(Pe.sfb_partition_table!=null),ie=0,te=0,vt=0,Pe.block_type==l.SHORT_TYPE){for(;vt<4;vt++){var Le=Pe.sfb_partition_table[vt]/3,$e=Pe.slen[vt];for(ht=0;ht<Le;ht++,te++)N(Re,Math.max(Pe.scalefac[te*3+0],0),$e),N(Re,Math.max(Pe.scalefac[te*3+1],0),$e),N(Re,Math.max(Pe.scalefac[te*3+2],0),$e),re+=3*$e}ie+=X(Re,Pe)}else{for(;vt<4;vt++){var Le=Pe.sfb_partition_table[vt],$e=Pe.slen[vt];for(ht=0;ht<Le;ht++,te++)N(Re,Math.max(Pe.scalefac[te],0),$e),re+=$e}ie+=G(Re,Pe)}ie+=P(Re,Pe),o(ie==Pe.part2_3_length),o(re==Pe.part2_length),Ee+=re+ie}return Ee}function J(){this.total=0}function Q(z,q){var ee=z.internal_flags,te,ie,Ee,Re,Te;return Te=ee.w_ptr,Re=ee.h_ptr-1,Re==-1&&(Re=u.MAX_HEADER_BUF-1),te=ee.header[Re].write_timing-T,q.total=te,te>=0&&(ie=1+Re-Te,Re<Te&&(ie=1+Re-Te+u.MAX_HEADER_BUF),te-=ie*8*ee.sideinfo_len),Ee=d.getframebits(z),te+=Ee,q.total+=Ee,q.total%8!=0?q.total=1+q.total/8:q.total=q.total/8,q.total+=w+1,te<0&&e.err.println(`strange error flushing buffer ... 
`),te}this.flush_bitstream=function(z){var q=z.internal_flags,ee,te,ie=q.h_ptr-1;if(ie==-1&&(ie=u.MAX_HEADER_BUF-1),ee=q.l3_side,!((te=Q(z,new J))<0)){if(B(z,te),o(q.header[ie].write_timing+this.getframebits(z)==T),q.ResvSize=0,ee.main_data_begin=0,q.findReplayGain){var Ee=m.GetTitleGain(q.rgdata);o(NEQ(Ee,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),q.RadioGain=Math.floor(Ee*10+.5)|0}q.findPeakSample&&(q.noclipGainChange=Math.ceil(Math.log10(q.PeakSample/32767)*20*10)|0,q.noclipGainChange>0&&(EQ(z.scale,1)||EQ(z.scale,0))?q.noclipScale=Math.floor(32767/q.PeakSample*100)/100:q.noclipScale=-1)}},this.add_dummy_byte=function(z,q,ee){for(var te=z.internal_flags,ie;ee-- >0;)for(U(te,q,8),ie=0;ie<u.MAX_HEADER_BUF;++ie)te.header[ie].write_timing+=8},this.format_bitstream=function(z){var q=z.internal_flags,ee;ee=q.l3_side;var te=this.getframebits(z);B(z,ee.resvDrain_pre),L(z,te);var ie=8*q.sideinfo_len;if(ie+=Y(z),B(z,ee.resvDrain_post),ie+=ee.resvDrain_post,ee.main_data_begin+=(te-ie)/8,Q(z,new J)!=q.ResvSize&&e.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),ee.main_data_begin*8!=q.ResvSize&&(e.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*ee.main_data_begin,q.ResvSize,ee.resvDrain_post,ee.resvDrain_pre,8*q.sideinfo_len,ie-ee.resvDrain_post-8*q.sideinfo_len,ie,ie%8,te),e.err.println("This is a fatal error.  It has several possible causes:"),e.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),e.err.println(" 9%%  Your system is overclocked"),e.err.println(" 1%%  bug in LAME encoding library"),q.ResvSize=ee.main_data_begin*8),T>1e9){var Ee;for(Ee=0;Ee<u.MAX_HEADER_BUF;++Ee)q.header[Ee].write_timing-=T;T=0}return 0},this.copy_buffer=function(z,q,ee,te,ie){var Ee=w+1;if(Ee<=0)return 0;if(te!=0&&Ee>te)return-1;if(e.arraycopy(b,0,q,ee,Ee),w=-1,R=0,ie!=0){var Re=s(1);if(Re[0]=z.nMusicCRC,S.updateMusicCRC(Re,q,ee,Ee),z.nMusicCRC=Re[0],Ee>0&&(z.VBR_seek_table.nBytesWritten+=Ee),z.decode_on_the_fly){for(var Te=i([2,1152]),Pe=Ee,We=-1,it;We!=0;)if(We=_.hip_decode1_unclipped(z.hip,q,ee,Pe,Te[0],Te[1]),Pe=0,We==-1&&(We=0),We>0){if(z.findPeakSample){for(it=0;it<We;it++)Te[0][it]>z.PeakSample?z.PeakSample=Te[0][it]:-Te[0][it]>z.PeakSample&&(z.PeakSample=-Te[0][it]);if(z.channels_out>1)for(it=0;it<We;it++)Te[1][it]>z.PeakSample?z.PeakSample=Te[1][it]:-Te[1][it]>z.PeakSample&&(z.PeakSample=-Te[1][it])}if(z.findReplayGain&&m.AnalyzeSamples(z.rgdata,Te[0],0,Te[1],0,We,z.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return Ee},this.init_bit_stream_w=function(z){b=r(f.LAME_MAXMP3BUFFER),z.h_ptr=z.w_ptr=0,z.header[z.h_ptr].write_timing=0,w=-1,R=0,T=0}}return H2=h,H2}var G2,WV;function J8(){if(WV)return G2;WV=1;var n=No,e=n.System,t=n.VbrMode,r=n.ShortBlock,i=n.new_float,s=n.new_int_n,o=n.new_short_n,a=n.assert,c=s9e,l=c9e,u=N3,h=O9e,f=P9e,d=z9e,p=Z8(),m=X8,_=Yl();function v(){var S=HC,b=this,T=128*1024;v.V9=410,v.V8=420,v.V7=430,v.V6=440,v.V5=450,v.V4=460,v.V3=470,v.V2=480,v.V1=490,v.V0=500,v.R3MIX=1e3,v.STANDARD=1001,v.EXTREME=1002,v.INSANE=1003,v.STANDARD_FAST=1004,v.EXTREME_FAST=1005,v.MEDIUM=1006,v.MEDIUM_FAST=1007;var w=16384+T;v.LAME_MAXMP3BUFFER=w;var R,C,N,U,B,$=new c,I,L,P;this.enc=new _,this.setModules=function(ae,ve,xe,pe,ze,Je,Xe,et,Ut){R=ae,C=ve,N=xe,U=pe,B=ze,I=Je,L=et,P=Ut,this.enc.setModules(C,$,U,I)};function H(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=i(_.SBMAX_l),this.bo_s_weight=i(_.SBMAX_s)}function X(){this.lowerlimit=0}function G(ae,ve){this.lowpass=ve}var Y=4294479419;function J(ae){var ve;return ae.class_id=Y,ve=ae.internal_flags=new u,ae.mode=S.NOT_SET,ae.original=1,ae.in_samplerate=44100,ae.num_channels=2,ae.num_samples=-1,ae.bWriteVbrTag=!0,ae.quality=-1,ae.short_blocks=null,ve.subblock_gain=-1,ae.lowpassfreq=0,ae.highpassfreq=0,ae.lowpasswidth=-1,ae.highpasswidth=-1,ae.VBR=t.vbr_off,ae.VBR_q=4,ae.ATHcurve=-1,ae.VBR_mean_bitrate_kbps=128,ae.VBR_min_bitrate_kbps=0,ae.VBR_max_bitrate_kbps=0,ae.VBR_hard_min=0,ve.VBR_min_bitrate=1,ve.VBR_max_bitrate=13,ae.quant_comp=-1,ae.quant_comp_short=-1,ae.msfix=-1,ve.resample_ratio=1,ve.OldValue[0]=180,ve.OldValue[1]=180,ve.CurrentStep[0]=4,ve.CurrentStep[1]=4,ve.masking_lower=1,ve.nsPsy.attackthre=-1,ve.nsPsy.attackthre_s=-1,ae.scale=-1,ae.athaa_type=-1,ae.ATHtype=-1,ae.athaa_loudapprox=-1,ae.athaa_sensitivity=0,ae.useTemporal=null,ae.interChRatio=-1,ve.mf_samples_to_encode=_.ENCDELAY+_.POSTDELAY,ae.encoder_padding=0,ve.mf_size=_.ENCDELAY-_.MDCTDELAY,ae.findReplayGain=!1,ae.decode_on_the_fly=!1,ve.decode_on_the_fly=!1,ve.findReplayGain=!1,ve.findPeakSample=!1,ve.RadioGain=0,ve.AudiophileGain=0,ve.noclipGainChange=0,ve.noclipScale=-1,ae.preset=0,ae.write_id3tag_automatic=!0,0}this.lame_init=function(){var ae=new l;return J(ae),ae.lame_allocated_gfp=1,ae};function Q(ae){return ae>1?0:ae<=0?1:Math.cos(Math.PI/2*ae)}this.nearestBitrateFullIndex=function(ae){var ve=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],xe=0,pe=0,ze=0,Je=0;Je=ve[16],ze=16,pe=ve[16],xe=16;for(var Xe=0;Xe<16;Xe++)if(Math.max(ae,ve[Xe+1])!=ae){Je=ve[Xe+1],ze=Xe+1,pe=ve[Xe],xe=Xe;break}return Je-ae>ae-pe?xe:ze};function z(ae,ve){var xe=44100;return ve>=48e3?xe=48e3:ve>=44100?xe=44100:ve>=32e3?xe=32e3:ve>=24e3?xe=24e3:ve>=22050?xe=22050:ve>=16e3?xe=16e3:ve>=12e3?xe=12e3:ve>=11025?xe=11025:ve>=8e3&&(xe=8e3),ae==-1?xe:(ae<=15960&&(xe=44100),ae<=15250&&(xe=32e3),ae<=11220&&(xe=24e3),ae<=9970&&(xe=22050),ae<=7230&&(xe=16e3),ae<=5420&&(xe=12e3),ae<=4510&&(xe=11025),ae<=3970&&(xe=8e3),ve<xe?ve>44100?48e3:ve>32e3?44100:ve>24e3?32e3:ve>22050?24e3:ve>16e3?22050:ve>12e3?16e3:ve>11025?12e3:ve>8e3?11025:8e3:xe)}function q(ae,ve){switch(ae){case 44100:return ve.version=1,0;case 48e3:return ve.version=1,1;case 32e3:return ve.version=1,2;case 22050:return ve.version=0,0;case 24e3:return ve.version=0,1;case 16e3:return ve.version=0,2;case 11025:return ve.version=0,0;case 12e3:return ve.version=0,1;case 8e3:return ve.version=0,2;default:return ve.version=0,-1}}function ee(ae,ve,xe){xe<16e3&&(ve=2);for(var pe=m.bitrate_table[ve][1],ze=2;ze<=14;ze++)m.bitrate_table[ve][ze]>0&&Math.abs(m.bitrate_table[ve][ze]-ae)<Math.abs(pe-ae)&&(pe=m.bitrate_table[ve][ze]);return pe}function te(ae,ve,xe){xe<16e3&&(ve=2);for(var pe=0;pe<=14;pe++)if(m.bitrate_table[ve][pe]>0&&m.bitrate_table[ve][pe]==ae)return pe;return-1}function ie(ae,ve){var xe=[new G(8,2e3),new G(16,3700),new G(24,3900),new G(32,5500),new G(40,7e3),new G(48,7500),new G(56,1e4),new G(64,11e3),new G(80,13500),new G(96,15100),new G(112,15600),new G(128,17e3),new G(160,17500),new G(192,18600),new G(224,19400),new G(256,19700),new G(320,20500)],pe=b.nearestBitrateFullIndex(ve);ae.lowerlimit=xe[pe].lowpass}function Ee(ae){var ve=ae.internal_flags,xe=32,pe=-1;if(ve.lowpass1>0){for(var ze=999,Je=0;Je<=31;Je++){var Xe=Je/31;Xe>=ve.lowpass2&&(xe=Math.min(xe,Je)),ve.lowpass1<Xe&&Xe<ve.lowpass2&&(ze=Math.min(ze,Je))}ze==999?ve.lowpass1=(xe-.75)/31:ve.lowpass1=(ze-.75)/31,ve.lowpass2=xe/31}if(ve.highpass2>0&&ve.highpass2<.9*(.75/31)&&(ve.highpass1=0,ve.highpass2=0,e.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),ve.highpass2>0){for(var et=-1,Je=0;Je<=31;Je++){var Xe=Je/31;Xe<=ve.highpass1&&(pe=Math.max(pe,Je)),ve.highpass1<Xe&&Xe<ve.highpass2&&(et=Math.max(et,Je))}ve.highpass1=pe/31,et==-1?ve.highpass2=(pe+.75)/31:ve.highpass2=(et+.75)/31}for(var Je=0;Je<32;Je++){var Ut,gt,Xe=Je/31;ve.highpass2>ve.highpass1?Ut=Q((ve.highpass2-Xe)/(ve.highpass2-ve.highpass1+1e-20)):Ut=1,ve.lowpass2>ve.lowpass1?gt=Q((Xe-ve.lowpass1)/(ve.lowpass2-ve.lowpass1+1e-20)):gt=1,ve.amp_filter[Je]=Ut*gt}}function Re(ae){var ve=ae.internal_flags;switch(ae.quality){default:case 9:ve.psymodel=0,ve.noise_shaping=0,ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 8:ae.quality=7;case 7:ve.psymodel=1,ve.noise_shaping=0,ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 6:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 5:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=0,ve.full_outer_loop=0;break;case 4:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=0,ve.noise_shaping_stop=0,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 3:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.noise_shaping_amp=1,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 2:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=1,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 1:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=2,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break;case 0:ve.psymodel=1,ve.noise_shaping==0&&(ve.noise_shaping=1),ve.substep_shaping==0&&(ve.substep_shaping=2),ve.noise_shaping_amp=2,ve.noise_shaping_stop=1,ve.subblock_gain==-1&&(ve.subblock_gain=1),ve.use_best_huffman=1,ve.full_outer_loop=0;break}}function Te(ae){var ve=ae.internal_flags;ae.frameNum=0,ae.write_id3tag_automatic&&L.id3tag_write_v2(ae),ve.bitrate_stereoMode_Hist=s([16,5]),ve.bitrate_blockType_Hist=s([16,6]),ve.PeakSample=0,ae.bWriteVbrTag&&I.InitVbrTag(ae)}this.lame_init_params=function(ae){var ve=ae.internal_flags;if(ve.Class_ID=0,ve.ATH==null&&(ve.ATH=new h),ve.PSY==null&&(ve.PSY=new H),ve.rgdata==null&&(ve.rgdata=new f),ve.channels_in=ae.num_channels,ve.channels_in==1&&(ae.mode=S.MONO),ve.channels_out=ae.mode==S.MONO?1:2,ve.mode_ext=_.MPG_MD_MS_LR,ae.mode==S.MONO&&(ae.force_ms=!1),ae.VBR==t.vbr_off&&ae.VBR_mean_bitrate_kbps!=128&&ae.brate==0&&(ae.brate=ae.VBR_mean_bitrate_kbps),ae.VBR==t.vbr_off||ae.VBR==t.vbr_mtrh||ae.VBR==t.vbr_mt||(ae.free_format=!1),ae.VBR==t.vbr_off&&ae.brate==0&&p.EQ(ae.compression_ratio,0)&&(ae.compression_ratio=11.025),ae.VBR==t.vbr_off&&ae.compression_ratio>0&&(ae.out_samplerate==0&&(ae.out_samplerate=map2MP3Frequency(int(.97*ae.in_samplerate))),ae.brate=0|ae.out_samplerate*16*ve.channels_out/(1e3*ae.compression_ratio),ve.samplerate_index=q(ae.out_samplerate,ae),ae.free_format||(ae.brate=ee(ae.brate,ae.version,ae.out_samplerate))),ae.out_samplerate!=0&&(ae.out_samplerate<16e3?(ae.VBR_mean_bitrate_kbps=Math.max(ae.VBR_mean_bitrate_kbps,8),ae.VBR_mean_bitrate_kbps=Math.min(ae.VBR_mean_bitrate_kbps,64)):ae.out_samplerate<32e3?(ae.VBR_mean_bitrate_kbps=Math.max(ae.VBR_mean_bitrate_kbps,8),ae.VBR_mean_bitrate_kbps=Math.min(ae.VBR_mean_bitrate_kbps,160)):(ae.VBR_mean_bitrate_kbps=Math.max(ae.VBR_mean_bitrate_kbps,32),ae.VBR_mean_bitrate_kbps=Math.min(ae.VBR_mean_bitrate_kbps,320))),ae.lowpassfreq==0){var xe=16e3;switch(ae.VBR){case t.vbr_off:{var pe=new X;ie(pe,ae.brate),xe=pe.lowerlimit;break}case t.vbr_abr:{var pe=new X;ie(pe,ae.VBR_mean_bitrate_kbps),xe=pe.lowerlimit;break}case t.vbr_rh:{var ze=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=ae.VBR_q&&ae.VBR_q<=9){var Je=ze[ae.VBR_q],Xe=ze[ae.VBR_q+1],et=ae.VBR_q_frac;xe=linear_int(Je,Xe,et)}else xe=19500;break}default:{var ze=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=ae.VBR_q&&ae.VBR_q<=9){var Je=ze[ae.VBR_q],Xe=ze[ae.VBR_q+1],et=ae.VBR_q_frac;xe=linear_int(Je,Xe,et)}else xe=19500}}ae.mode==S.MONO&&(ae.VBR==t.vbr_off||ae.VBR==t.vbr_abr)&&(xe*=1.5),ae.lowpassfreq=xe|0}if(ae.out_samplerate==0&&(2*ae.lowpassfreq>ae.in_samplerate&&(ae.lowpassfreq=ae.in_samplerate/2),ae.out_samplerate=z(ae.lowpassfreq|0,ae.in_samplerate)),ae.lowpassfreq=Math.min(20500,ae.lowpassfreq),ae.lowpassfreq=Math.min(ae.out_samplerate/2,ae.lowpassfreq),ae.VBR==t.vbr_off&&(ae.compression_ratio=ae.out_samplerate*16*ve.channels_out/(1e3*ae.brate)),ae.VBR==t.vbr_abr&&(ae.compression_ratio=ae.out_samplerate*16*ve.channels_out/(1e3*ae.VBR_mean_bitrate_kbps)),ae.bWriteVbrTag||(ae.findReplayGain=!1,ae.decode_on_the_fly=!1,ve.findPeakSample=!1),ve.findReplayGain=ae.findReplayGain,ve.decode_on_the_fly=ae.decode_on_the_fly,ve.decode_on_the_fly&&(ve.findPeakSample=!0),ve.findReplayGain&&R.InitGainAnalysis(ve.rgdata,ae.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return ae.internal_flags=null,-6;switch(ve.decode_on_the_fly&&!ae.decode_only&&(ve.hip!=null&&P.hip_decode_exit(ve.hip),ve.hip=P.hip_decode_init()),ve.mode_gr=ae.out_samplerate<=24e3?1:2,ae.framesize=576*ve.mode_gr,ae.encoder_delay=_.ENCDELAY,ve.resample_ratio=ae.in_samplerate/ae.out_samplerate,ae.VBR){case t.vbr_mt:case t.vbr_rh:case t.vbr_mtrh:{var Ut=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];ae.compression_ratio=Ut[ae.VBR_q]}break;case t.vbr_abr:ae.compression_ratio=ae.out_samplerate*16*ve.channels_out/(1e3*ae.VBR_mean_bitrate_kbps);break;default:ae.compression_ratio=ae.out_samplerate*16*ve.channels_out/(1e3*ae.brate);break}if(ae.mode==S.NOT_SET&&(ae.mode=S.JOINT_STEREO),ae.highpassfreq>0?(ve.highpass1=2*ae.highpassfreq,ae.highpasswidth>=0?ve.highpass2=2*(ae.highpassfreq+ae.highpasswidth):ve.highpass2=2*ae.highpassfreq,ve.highpass1/=ae.out_samplerate,ve.highpass2/=ae.out_samplerate):(ve.highpass1=0,ve.highpass2=0),ae.lowpassfreq>0?(ve.lowpass2=2*ae.lowpassfreq,ae.lowpasswidth>=0?(ve.lowpass1=2*(ae.lowpassfreq-ae.lowpasswidth),ve.lowpass1<0&&(ve.lowpass1=0)):ve.lowpass1=2*ae.lowpassfreq,ve.lowpass1/=ae.out_samplerate,ve.lowpass2/=ae.out_samplerate):(ve.lowpass1=0,ve.lowpass2=0),Ee(ae),ve.samplerate_index=q(ae.out_samplerate,ae),ve.samplerate_index<0)return ae.internal_flags=null,-1;if(ae.VBR==t.vbr_off){if(ae.free_format)ve.bitrate_index=0;else if(ae.brate=ee(ae.brate,ae.version,ae.out_samplerate),ve.bitrate_index=te(ae.brate,ae.version,ae.out_samplerate),ve.bitrate_index<=0)return ae.internal_flags=null,-1}else ve.bitrate_index=1;ae.analysis&&(ae.bWriteVbrTag=!1),ve.pinfo!=null&&(ae.bWriteVbrTag=!1),C.init_bit_stream_w(ve);for(var gt=ve.samplerate_index+3*ae.version+6*(ae.out_samplerate<16e3?1:0),At=0;At<_.SBMAX_l+1;At++)ve.scalefac_band.l[At]=U.sfBandIndex[gt].l[At];for(var At=0;At<_.PSFB21+1;At++){var Ce=(ve.scalefac_band.l[22]-ve.scalefac_band.l[21])/_.PSFB21,se=ve.scalefac_band.l[21]+At*Ce;ve.scalefac_band.psfb21[At]=se}ve.scalefac_band.psfb21[_.PSFB21]=576;for(var At=0;At<_.SBMAX_s+1;At++)ve.scalefac_band.s[At]=U.sfBandIndex[gt].s[At];for(var At=0;At<_.PSFB12+1;At++){var Ce=(ve.scalefac_band.s[13]-ve.scalefac_band.s[12])/_.PSFB12,se=ve.scalefac_band.s[12]+At*Ce;ve.scalefac_band.psfb12[At]=se}ve.scalefac_band.psfb12[_.PSFB12]=192,ae.version==1?ve.sideinfo_len=ve.channels_out==1?21:36:ve.sideinfo_len=ve.channels_out==1?13:21,ae.error_protection&&(ve.sideinfo_len+=2),Te(ae),ve.Class_ID=Y;{var W;for(W=0;W<19;W++)ve.nsPsy.pefirbuf[W]=700*ve.mode_gr*ve.channels_out;ae.ATHtype==-1&&(ae.ATHtype=4)}switch(a(ae.VBR_q<=9),a(ae.VBR_q>=0),ae.VBR){case t.vbr_mt:ae.VBR=t.vbr_mtrh;case t.vbr_mtrh:{ae.useTemporal==null&&(ae.useTemporal=!1),N.apply_preset(ae,500-ae.VBR_q*10,0),ae.quality<0&&(ae.quality=LAME_DEFAULT_QUALITY),ae.quality<5&&(ae.quality=0),ae.quality>5&&(ae.quality=5),ve.PSY.mask_adjust=ae.maskingadjust,ve.PSY.mask_adjust_short=ae.maskingadjust_short,ae.experimentalY?ve.sfb21_extra=!1:ve.sfb21_extra=ae.out_samplerate>44e3,ve.iteration_loop=new VBRNewIterationLoop(B);break}case t.vbr_rh:{N.apply_preset(ae,500-ae.VBR_q*10,0),ve.PSY.mask_adjust=ae.maskingadjust,ve.PSY.mask_adjust_short=ae.maskingadjust_short,ae.experimentalY?ve.sfb21_extra=!1:ve.sfb21_extra=ae.out_samplerate>44e3,ae.quality>6&&(ae.quality=6),ae.quality<0&&(ae.quality=LAME_DEFAULT_QUALITY),ve.iteration_loop=new VBROldIterationLoop(B);break}default:{var oe;ve.sfb21_extra=!1,ae.quality<0&&(ae.quality=LAME_DEFAULT_QUALITY),oe=ae.VBR,oe==t.vbr_off&&(ae.VBR_mean_bitrate_kbps=ae.brate),N.apply_preset(ae,ae.VBR_mean_bitrate_kbps,0),ae.VBR=oe,ve.PSY.mask_adjust=ae.maskingadjust,ve.PSY.mask_adjust_short=ae.maskingadjust_short,oe==t.vbr_off?ve.iteration_loop=new d(B):ve.iteration_loop=new ABRIterationLoop(B);break}}if(a(ae.scale>=0),ae.VBR!=t.vbr_off){if(ve.VBR_min_bitrate=1,ve.VBR_max_bitrate=14,ae.out_samplerate<16e3&&(ve.VBR_max_bitrate=8),ae.VBR_min_bitrate_kbps!=0&&(ae.VBR_min_bitrate_kbps=ee(ae.VBR_min_bitrate_kbps,ae.version,ae.out_samplerate),ve.VBR_min_bitrate=te(ae.VBR_min_bitrate_kbps,ae.version,ae.out_samplerate),ve.VBR_min_bitrate<0)||ae.VBR_max_bitrate_kbps!=0&&(ae.VBR_max_bitrate_kbps=ee(ae.VBR_max_bitrate_kbps,ae.version,ae.out_samplerate),ve.VBR_max_bitrate=te(ae.VBR_max_bitrate_kbps,ae.version,ae.out_samplerate),ve.VBR_max_bitrate<0))return-1;ae.VBR_min_bitrate_kbps=m.bitrate_table[ae.version][ve.VBR_min_bitrate],ae.VBR_max_bitrate_kbps=m.bitrate_table[ae.version][ve.VBR_max_bitrate],ae.VBR_mean_bitrate_kbps=Math.min(m.bitrate_table[ae.version][ve.VBR_max_bitrate],ae.VBR_mean_bitrate_kbps),ae.VBR_mean_bitrate_kbps=Math.max(m.bitrate_table[ae.version][ve.VBR_min_bitrate],ae.VBR_mean_bitrate_kbps)}return ae.tune&&(ve.PSY.mask_adjust+=ae.tune_value_a,ve.PSY.mask_adjust_short+=ae.tune_value_a),Re(ae),a(ae.scale>=0),ae.athaa_type<0?ve.ATH.useAdjust=3:ve.ATH.useAdjust=ae.athaa_type,ve.ATH.aaSensitivityP=Math.pow(10,ae.athaa_sensitivity/-10),ae.short_blocks==null&&(ae.short_blocks=r.short_block_allowed),ae.short_blocks==r.short_block_allowed&&(ae.mode==S.JOINT_STEREO||ae.mode==S.STEREO)&&(ae.short_blocks=r.short_block_coupled),ae.quant_comp<0&&(ae.quant_comp=1),ae.quant_comp_short<0&&(ae.quant_comp_short=0),ae.msfix<0&&(ae.msfix=0),ae.exp_nspsytune=ae.exp_nspsytune|1,ae.internal_flags.nsPsy.attackthre<0&&(ae.internal_flags.nsPsy.attackthre=c.NSATTACKTHRE),ae.internal_flags.nsPsy.attackthre_s<0&&(ae.internal_flags.nsPsy.attackthre_s=c.NSATTACKTHRE_S),a(ae.scale>=0),ae.scale<0&&(ae.scale=1),ae.ATHtype<0&&(ae.ATHtype=4),ae.ATHcurve<0&&(ae.ATHcurve=4),ae.athaa_loudapprox<0&&(ae.athaa_loudapprox=2),ae.interChRatio<0&&(ae.interChRatio=0),ae.useTemporal==null&&(ae.useTemporal=!0),ve.slot_lag=ve.frac_SpF=0,ae.VBR==t.vbr_off&&(ve.slot_lag=ve.frac_SpF=(ae.version+1)*72e3*ae.brate%ae.out_samplerate|0),U.iteration_init(ae),$.psymodel_init(ae),a(ae.scale>=0),0};function Pe(ae,ve){(ae.in_buffer_0==null||ae.in_buffer_nsamples<ve)&&(ae.in_buffer_0=i(ve),ae.in_buffer_1=i(ve),ae.in_buffer_nsamples=ve)}this.lame_encode_flush=function(ae,ve,xe,pe){var ze=ae.internal_flags,Je=o([2,1152]),Xe=0,et,Ut,gt,At,Ce=ze.mf_samples_to_encode-_.POSTDELAY,se=We(ae);if(ze.mf_samples_to_encode<1)return 0;for(et=0,ae.in_samplerate!=ae.out_samplerate&&(Ce+=16*ae.out_samplerate/ae.in_samplerate),gt=ae.framesize-Ce%ae.framesize,gt<576&&(gt+=ae.framesize),ae.encoder_padding=gt,At=(Ce+gt)/ae.framesize;At>0&&Xe>=0;){var W=se-ze.mf_size,oe=ae.frameNum;W*=ae.in_samplerate,W/=ae.out_samplerate,W>1152&&(W=1152),W<1&&(W=1),Ut=pe-et,pe==0&&(Ut=0),Xe=this.lame_encode_buffer(ae,Je[0],Je[1],W,ve,xe,Ut),xe+=Xe,et+=Xe,At-=oe!=ae.frameNum?1:0}if(ze.mf_samples_to_encode=0,Xe<0||(Ut=pe-et,pe==0&&(Ut=0),C.flush_bitstream(ae),Xe=C.copy_buffer(ze,ve,xe,Ut,1),Xe<0))return Xe;if(xe+=Xe,et+=Xe,Ut=pe-et,pe==0&&(Ut=0),ae.write_id3tag_automatic){if(L.id3tag_write_v1(ae),Xe=C.copy_buffer(ze,ve,xe,Ut,0),Xe<0)return Xe;et+=Xe}return et},this.lame_encode_buffer=function(ae,ve,xe,pe,ze,Je,Xe){var et=ae.internal_flags,Ut=[null,null];if(et.Class_ID!=Y)return-3;if(pe==0)return 0;Pe(et,pe),Ut[0]=et.in_buffer_0,Ut[1]=et.in_buffer_1;for(var gt=0;gt<pe;gt++)Ut[0][gt]=ve[gt],et.channels_in>1&&(Ut[1][gt]=xe[gt]);return it(ae,Ut[0],Ut[1],pe,ze,Je,Xe)};function We(ae){var ve=_.BLKSIZE+ae.framesize-_.FFTOFFSET;return ve=Math.max(ve,512+ae.framesize-32),ve}function it(ae,ve,xe,pe,ze,Je,Xe){var et=ae.internal_flags,Ut=0,gt,At,Ce,se,W,oe=[null,null],Se=[null,null];if(et.Class_ID!=Y)return-3;if(pe==0)return 0;if(W=C.copy_buffer(et,ze,Je,Xe,0),W<0)return W;if(Je+=W,Ut+=W,Se[0]=ve,Se[1]=xe,p.NEQ(ae.scale,0)&&p.NEQ(ae.scale,1))for(At=0;At<pe;++At)Se[0][At]*=ae.scale,et.channels_out==2&&(Se[1][At]*=ae.scale);if(p.NEQ(ae.scale_left,0)&&p.NEQ(ae.scale_left,1))for(At=0;At<pe;++At)Se[0][At]*=ae.scale_left;if(p.NEQ(ae.scale_right,0)&&p.NEQ(ae.scale_right,1))for(At=0;At<pe;++At)Se[1][At]*=ae.scale_right;if(ae.num_channels==2&&et.channels_out==1)for(At=0;At<pe;++At)Se[0][At]=.5*(Se[0][At]+Se[1][At]),Se[1][At]=0;se=We(ae),oe[0]=et.mfbuf[0],oe[1]=et.mfbuf[1];for(var Ae=0;pe>0;){var ye=[null,null],_e=0,Ye=0;ye[0]=Se[0],ye[1]=Se[1];var ke=new vt;if(Oe(ae,oe,ye,Ae,pe,ke),_e=ke.n_in,Ye=ke.n_out,et.findReplayGain&&!et.decode_on_the_fly&&R.AnalyzeSamples(et.rgdata,oe[0],et.mf_size,oe[1],et.mf_size,Ye,et.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(pe-=_e,Ae+=_e,et.channels_out==2,et.mf_size+=Ye,a(et.mf_size<=u.MFSIZE),et.mf_samples_to_encode<1&&(et.mf_samples_to_encode=_.ENCDELAY+_.POSTDELAY),et.mf_samples_to_encode+=Ye,et.mf_size>=se){var Ve=Xe-Ut;if(Xe==0&&(Ve=0),gt=ht(ae,oe[0],oe[1],ze,Je,Ve),gt<0)return gt;for(Je+=gt,Ut+=gt,et.mf_size-=ae.framesize,et.mf_samples_to_encode-=ae.framesize,Ce=0;Ce<et.channels_out;Ce++)for(At=0;At<et.mf_size;At++)oe[Ce][At]=oe[Ce][At+ae.framesize]}}return Ut}function ht(ae,ve,xe,pe,ze,Je){var Xe=b.enc.lame_encode_mp3_frame(ae,ve,xe,pe,ze,Je);return ae.frameNum++,Xe}function vt(){this.n_in=0,this.n_out=0}function re(){this.num_used=0}function Le(ae,ve){return ve!=0?Le(ve,ae%ve):ae}function $e(ae,ve,xe){var pe=Math.PI*ve;ae/=xe,ae<0&&(ae=0),ae>1&&(ae=1);var ze=ae-.5,Je=.42-.5*Math.cos(2*ae*Math.PI)+.08*Math.cos(4*ae*Math.PI);return Math.abs(ze)<1e-9?pe/Math.PI:Je*Math.sin(xe*pe*ze)/(Math.PI*xe*ze)}function De(ae,ve,xe,pe,ze,Je,Xe,et,Ut){var gt=ae.internal_flags,At,Ce=0,se,W=ae.out_samplerate/Le(ae.out_samplerate,ae.in_samplerate);W>u.BPC&&(W=u.BPC);var oe=Math.abs(gt.resample_ratio-Math.floor(.5+gt.resample_ratio))<1e-4?1:0,Se=1/gt.resample_ratio;Se>1&&(Se=1);var Ae=31;Ae%2==0&&--Ae,Ae+=oe;var ye=Ae+1;if(gt.fill_buffer_resample_init==0){for(gt.inbuf_old[0]=i(ye),gt.inbuf_old[1]=i(ye),At=0;At<=2*W;++At)gt.blackfilt[At]=i(ye);for(gt.itime[0]=0,gt.itime[1]=0,Ce=0;Ce<=2*W;Ce++){var _e=0,Ye=(Ce-W)/(2*W);for(At=0;At<=Ae;At++)_e+=gt.blackfilt[Ce][At]=$e(At-Ye,Se,Ae);for(At=0;At<=Ae;At++)gt.blackfilt[Ce][At]/=_e}gt.fill_buffer_resample_init=1}var ke=gt.inbuf_old[Ut];for(se=0;se<pe;se++){var Ve,Fe;if(Ve=se*gt.resample_ratio,Ce=0|Math.floor(Ve-gt.itime[Ut]),Ae+Ce-Ae/2>=Xe)break;var Ye=Ve-gt.itime[Ut]-(Ce+.5*(Ae%2));Fe=0|Math.floor(Ye*2*W+W+.5);var Ge=0;for(At=0;At<=Ae;++At){var at=0|At+Ce-Ae/2,Be;Be=at<0?ke[ye+at]:ze[Je+at],Ge+=Be*gt.blackfilt[Fe][At]}ve[xe+se]=Ge}if(et.num_used=Math.min(Xe,Ae+Ce-Ae/2),gt.itime[Ut]+=et.num_used-se*gt.resample_ratio,et.num_used>=ye)for(At=0;At<ye;At++)ke[At]=ze[Je+et.num_used+At-ye];else{var tt=ye-et.num_used;for(At=0;At<tt;++At)ke[At]=ke[At+et.num_used];for(Ce=0;At<ye;++At,++Ce)ke[At]=ze[Je+Ce];a(Ce==et.num_used)}return se}function Oe(ae,ve,xe,pe,ze,Je){var Xe=ae.internal_flags;if(Xe.resample_ratio<.9999||Xe.resample_ratio>1.0001)for(var et=0;et<Xe.channels_out;et++){var Ut=new re;Je.n_out=De(ae,ve[et],Xe.mf_size,ae.framesize,xe[et],pe,ze,Ut,et),Je.n_in=Ut.num_used}else{Je.n_out=Math.min(ae.framesize,ze),Je.n_in=Je.n_out;for(var gt=0;gt<Je.n_out;++gt)ve[0][Xe.mf_size+gt]=xe[0][pe+gt],Xe.channels_out==2&&(ve[1][Xe.mf_size+gt]=xe[1][pe+gt])}}}return G2=v,G2}var $9e=No,vm=$9e.VbrMode;function V9e(){var n=J8();function e(u,h,f,d,p,m,_,v,S,b,T,w,R,C,N){this.vbr_q=u,this.quant_comp=h,this.quant_comp_s=f,this.expY=d,this.st_lrm=p,this.st_s=m,this.masking_adj=_,this.masking_adj_short=v,this.ath_lower=S,this.ath_curve=b,this.ath_sensitivity=T,this.interch=w,this.safejoint=R,this.sfb21mod=C,this.msfix=N}function t(u,h,f,d,p,m,_,v,S,b,T,w,R,C){this.quant_comp=h,this.quant_comp_s=f,this.safejoint=d,this.nsmsfix=p,this.st_lrm=m,this.st_s=_,this.nsbass=v,this.scale=S,this.masking_adj=b,this.ath_lower=T,this.ath_curve=w,this.interch=R,this.sfscale=C}var r;this.setModules=function(u){r=u};var i=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],s=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function o(u,h,f){var d=u.VBR==vm.vbr_rh?i:s,p=u.VBR_q_frac,m=d[h],_=d[h+1],v=m;m.st_lrm=m.st_lrm+p*(_.st_lrm-m.st_lrm),m.st_s=m.st_s+p*(_.st_s-m.st_s),m.masking_adj=m.masking_adj+p*(_.masking_adj-m.masking_adj),m.masking_adj_short=m.masking_adj_short+p*(_.masking_adj_short-m.masking_adj_short),m.ath_lower=m.ath_lower+p*(_.ath_lower-m.ath_lower),m.ath_curve=m.ath_curve+p*(_.ath_curve-m.ath_curve),m.ath_sensitivity=m.ath_sensitivity+p*(_.ath_sensitivity-m.ath_sensitivity),m.interch=m.interch+p*(_.interch-m.interch),m.msfix=m.msfix+p*(_.msfix-m.msfix),l(u,v.vbr_q),f!=0?u.quant_comp=v.quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=v.quant_comp),f!=0?u.quant_comp_short=v.quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=v.quant_comp_s),v.expY!=0&&(u.experimentalY=v.expY!=0),f!=0?u.internal_flags.nsPsy.attackthre=v.st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=v.st_lrm),f!=0?u.internal_flags.nsPsy.attackthre_s=v.st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=v.st_s),f!=0?u.maskingadjust=v.masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=v.masking_adj),f!=0?u.maskingadjust_short=v.masking_adj_short:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=v.masking_adj_short),f!=0?u.ATHlower=-v.ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-v.ath_lower/10),f!=0?u.ATHcurve=v.ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=v.ath_curve),f!=0?u.athaa_sensitivity=v.ath_sensitivity:Math.abs(u.athaa_sensitivity- -1)>0||(u.athaa_sensitivity=v.ath_sensitivity),v.interch>0&&(f!=0?u.interChRatio=v.interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=v.interch)),v.safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|v.safejoint),v.sfb21mod>0&&(u.exp_nspsytune=u.exp_nspsytune|v.sfb21mod<<20),f!=0?u.msfix=v.msfix:Math.abs(u.msfix- -1)>0||(u.msfix=v.msfix),f==0&&(u.VBR_q=h,u.VBR_q_frac=p)}var a=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function c(u,h,f){var d=h,p=r.nearestBitrateFullIndex(h);if(u.VBR=vm.vbr_abr,u.VBR_mean_bitrate_kbps=d,u.VBR_mean_bitrate_kbps=Math.min(u.VBR_mean_bitrate_kbps,320),u.VBR_mean_bitrate_kbps=Math.max(u.VBR_mean_bitrate_kbps,8),u.brate=u.VBR_mean_bitrate_kbps,u.VBR_mean_bitrate_kbps>320&&(u.disable_reservoir=!0),a[p].safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|2),a[p].sfscale>0&&(u.internal_flags.noise_shaping=2),Math.abs(a[p].nsbass)>0){var m=int(a[p].nsbass*4);m<0&&(m+=64),u.exp_nspsytune=u.exp_nspsytune|m<<2}return f!=0?u.quant_comp=a[p].quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=a[p].quant_comp),f!=0?u.quant_comp_short=a[p].quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=a[p].quant_comp_s),f!=0?u.msfix=a[p].nsmsfix:Math.abs(u.msfix- -1)>0||(u.msfix=a[p].nsmsfix),f!=0?u.internal_flags.nsPsy.attackthre=a[p].st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=a[p].st_lrm),f!=0?u.internal_flags.nsPsy.attackthre_s=a[p].st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=a[p].st_s),f!=0?u.scale=a[p].scale:Math.abs(u.scale- -1)>0||(u.scale=a[p].scale),f!=0?u.maskingadjust=a[p].masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=a[p].masking_adj),a[p].masking_adj>0?f!=0?u.maskingadjust_short=a[p].masking_adj*.9:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[p].masking_adj*.9):f!=0?u.maskingadjust_short=a[p].masking_adj*1.1:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=a[p].masking_adj*1.1),f!=0?u.ATHlower=-a[p].ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-a[p].ath_lower/10),f!=0?u.ATHcurve=a[p].ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=a[p].ath_curve),f!=0?u.interChRatio=a[p].interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=a[p].interch),h}this.apply_preset=function(u,h,f){switch(h){case n.R3MIX:{h=n.V3,u.VBR=vm.vbr_mtrh;break}case n.MEDIUM:{h=n.V4,u.VBR=vm.vbr_rh;break}case n.MEDIUM_FAST:{h=n.V4,u.VBR=vm.vbr_mtrh;break}case n.STANDARD:{h=n.V2,u.VBR=vm.vbr_rh;break}case n.STANDARD_FAST:{h=n.V2,u.VBR=vm.vbr_mtrh;break}case n.EXTREME:{h=n.V0,u.VBR=vm.vbr_rh;break}case n.EXTREME_FAST:{h=n.V0,u.VBR=vm.vbr_mtrh;break}case n.INSANE:return h=320,u.preset=h,c(u,h,f),u.VBR=vm.vbr_off,h}switch(u.preset=h,h){case n.V9:return o(u,9,f),h;case n.V8:return o(u,8,f),h;case n.V7:return o(u,7,f),h;case n.V6:return o(u,6,f),h;case n.V5:return o(u,5,f),h;case n.V4:return o(u,4,f),h;case n.V3:return o(u,3,f),h;case n.V2:return o(u,2,f),h;case n.V1:return o(u,1,f),h;case n.V0:return o(u,0,f),h}return 8<=h&&h<=320?c(u,h,f):(u.preset=0,h)};function l(u,h){var f=0;return 0>h&&(f=-1,h=0),9<h&&(f=-1,h=9),u.VBR_q=h,u.VBR_q_frac=0,f}}var H9e=V9e;function G9e(){this.setModules=function(n,e){}}var W9e=G9e;function q9e(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Y9e=q9e,Jne=No,qV=Jne.new_float,K9e=Jne.new_int;function X9e(){this.global_gain=0,this.sfb_count1=0,this.step=K9e(39),this.noise=qV(39),this.noise_log=qV(39)}var Z9e=X9e,cT=No,mv=cT.System,YV=cT.VbrMode,W2=cT.Util,rE=cT.Arrays,rw=cT.new_float,iw=cT.assert,J9e=W9e,q2=Y9e,Q9e=Z9e,Wi=Yl(),KV=q8,XV=O3;function eje(){var n;this.rv=null;var e;this.qupvt=null;var t,r=new J9e,i;this.setModules=function(v,S,b,T){n=v,e=S,this.rv=S,t=b,this.qupvt=b,i=T,r.setModules(t,i)},this.ms_convert=function(v,S){for(var b=0;b<576;++b){var T=v.tt[S][0].xr[b],w=v.tt[S][1].xr[b];v.tt[S][0].xr[b]=(T+w)*(W2.SQRT2*.5),v.tt[S][1].xr[b]=(T-w)*(W2.SQRT2*.5)}};function s(v,S,b,T){T=0;for(var w=0;w<=b;++w){var R=Math.abs(v.xr[w]);T+=R,S[w]=Math.sqrt(R*Math.sqrt(R)),S[w]>v.xrpow_max&&(v.xrpow_max=S[w])}return T}this.init_xrpow=function(v,S,b){var T=0,w=0|S.max_nonzero_coeff;if(S.xrpow_max=0,rE.fill(b,w,576,0),T=s(S,b,w,T),T>1e-20){var R=0;v.substep_shaping&2&&(R=1);for(var C=0;C<S.psymax;C++)v.pseudohalf[C]=R;return!0}return rE.fill(S.l3_enc,0,576,0),!1};function o(v,S){var b=v.ATH,T=S.xr;if(S.block_type!=Wi.SHORT_TYPE)for(var w=!1,R=Wi.PSFB21-1;R>=0&&!w;R--){var C=v.scalefac_band.psfb21[R],N=v.scalefac_band.psfb21[R+1],U=t.athAdjust(b.adjust,b.psfb21[R],b.floor);v.nsPsy.longfact[21]>1e-12&&(U*=v.nsPsy.longfact[21]);for(var B=N-1;B>=C;B--)if(Math.abs(T[B])<U)T[B]=0;else{w=!0;break}}else for(var $=0;$<3;$++)for(var w=!1,R=Wi.PSFB12-1;R>=0&&!w;R--){var C=v.scalefac_band.s[12]*3+(v.scalefac_band.s[13]-v.scalefac_band.s[12])*$+(v.scalefac_band.psfb12[R]-v.scalefac_band.psfb12[0]),N=C+(v.scalefac_band.psfb12[R+1]-v.scalefac_band.psfb12[R]),I=t.athAdjust(b.adjust,b.psfb12[R],b.floor);v.nsPsy.shortfact[12]>1e-12&&(I*=v.nsPsy.shortfact[12]);for(var B=N-1;B>=C;B--)if(Math.abs(T[B])<I)T[B]=0;else{w=!0;break}}}this.init_outer_loop=function(v,S){S.part2_3_length=0,S.big_values=0,S.count1=0,S.global_gain=210,S.scalefac_compress=0,S.table_select[0]=0,S.table_select[1]=0,S.table_select[2]=0,S.subblock_gain[0]=0,S.subblock_gain[1]=0,S.subblock_gain[2]=0,S.subblock_gain[3]=0,S.region0_count=0,S.region1_count=0,S.preflag=0,S.scalefac_scale=0,S.count1table_select=0,S.part2_length=0,S.sfb_lmax=Wi.SBPSY_l,S.sfb_smin=Wi.SBPSY_s,S.psy_lmax=v.sfb21_extra?Wi.SBMAX_l:Wi.SBPSY_l,S.psymax=S.psy_lmax,S.sfbmax=S.sfb_lmax,S.sfbdivide=11;for(var b=0;b<Wi.SBMAX_l;b++)S.width[b]=v.scalefac_band.l[b+1]-v.scalefac_band.l[b],S.window[b]=3;if(S.block_type==Wi.SHORT_TYPE){var T=rw(576);S.sfb_smin=0,S.sfb_lmax=0,S.mixed_block_flag!=0&&(S.sfb_smin=3,S.sfb_lmax=v.mode_gr*2+4),S.psymax=S.sfb_lmax+3*((v.sfb21_extra?Wi.SBMAX_s:Wi.SBPSY_s)-S.sfb_smin),S.sfbmax=S.sfb_lmax+3*(Wi.SBPSY_s-S.sfb_smin),S.sfbdivide=S.sfbmax-18,S.psy_lmax=S.sfb_lmax;var w=v.scalefac_band.l[S.sfb_lmax];mv.arraycopy(S.xr,0,T,0,576);for(var b=S.sfb_smin;b<Wi.SBMAX_s;b++)for(var R=v.scalefac_band.s[b],C=v.scalefac_band.s[b+1],N=0;N<3;N++)for(var U=R;U<C;U++)S.xr[w++]=T[3*U+N];for(var B=S.sfb_lmax,b=S.sfb_smin;b<Wi.SBMAX_s;b++)S.width[B]=S.width[B+1]=S.width[B+2]=v.scalefac_band.s[b+1]-v.scalefac_band.s[b],S.window[B]=0,S.window[B+1]=1,S.window[B+2]=2,B+=3}S.count1bits=0,S.sfb_partition_table=t.nr_of_sfb_block[0][0],S.slen[0]=0,S.slen[1]=0,S.slen[2]=0,S.slen[3]=0,S.max_nonzero_coeff=575,rE.fill(S.scalefac,0),o(v,S)};function a(v){this.ordinal=v}a.BINSEARCH_NONE=new a(0),a.BINSEARCH_UP=new a(1),a.BINSEARCH_DOWN=new a(2);function c(v,S,b,T,w){var R,C=v.CurrentStep[T],N=!1,U=v.OldValue[T],B=a.BINSEARCH_NONE;for(S.global_gain=U,b-=S.part2_length;;){var $;if(R=i.count_bits(v,w,S,null),C==1||R==b)break;R>b?(B==a.BINSEARCH_DOWN&&(N=!0),N&&(C/=2),B=a.BINSEARCH_UP,$=C):(B==a.BINSEARCH_UP&&(N=!0),N&&(C/=2),B=a.BINSEARCH_DOWN,$=-C),S.global_gain+=$,S.global_gain<0&&(S.global_gain=0,N=!0),S.global_gain>255&&(S.global_gain=255,N=!0)}for(iw(S.global_gain>=0),iw(S.global_gain<256);R>b&&S.global_gain<255;)S.global_gain++,R=i.count_bits(v,w,S,null);return v.CurrentStep[T]=U-S.global_gain>=4?4:2,v.OldValue[T]=S.global_gain,S.part2_3_length=R,R}this.trancate_smallspectrums=function(v,S,b,T){var w=rw(XV.SFBMAX);if(!(!(v.substep_shaping&4)&&S.block_type==Wi.SHORT_TYPE||v.substep_shaping&128)){t.calc_noise(S,b,w,new q2,null);for(var C=0;C<576;C++){var R=0;S.l3_enc[C]!=0&&(R=Math.abs(S.xr[C])),T[C]=R}var C=0,N=8;S.block_type==Wi.SHORT_TYPE&&(N=6);do{var U,B,$,I,L=S.width[N];if(C+=L,!(w[N]>=1)&&(rE.sort(T,C-L,L),!BitStream.EQ(T[C-1],0))){U=(1-w[N])*b[N],B=0,I=0;do{var P;for($=1;I+$<L&&!BitStream.NEQ(T[I+C-L],T[I+C+$-L]);$++);if(P=T[I+C-L]*T[I+C-L]*$,U<P){I!=0&&(B=T[I+C-L-1]);break}U-=P,I+=$}while(I<L);if(!BitStream.EQ(B,0))do Math.abs(S.xr[C-L])<=B&&(S.l3_enc[C-L]=0);while(--L>0)}}while(++N<S.psymax);S.part2_3_length=i.noquant_count_bits(v,S,null)}};function l(v){for(var S=0;S<v.sfbmax;S++)if(v.scalefac[S]+v.subblock_gain[v.window[S]]==0)return!1;return!0}function u(v){return W2.FAST_LOG10(.368+.632*v*v*v)}function h(v,S){for(var b=1e-37,T=0;T<S.psymax;T++)b+=u(v[T]);return Math.max(1e-20,b)}function f(v,S,b,T,w){var R;switch(v){default:case 9:{S.over_count>0?(R=b.over_SSD<=S.over_SSD,b.over_SSD==S.over_SSD&&(R=b.bits<S.bits)):R=b.max_noise<0&&b.max_noise*10+b.bits<=S.max_noise*10+S.bits;break}case 0:R=b.over_count<S.over_count||b.over_count==S.over_count&&b.over_noise<S.over_noise||b.over_count==S.over_count&&BitStream.EQ(b.over_noise,S.over_noise)&&b.tot_noise<S.tot_noise;break;case 8:b.max_noise=h(w,T);case 1:R=b.max_noise<S.max_noise;break;case 2:R=b.tot_noise<S.tot_noise;break;case 3:R=b.tot_noise<S.tot_noise&&b.max_noise<S.max_noise;break;case 4:R=b.max_noise<=0&&S.max_noise>.2||b.max_noise<=0&&S.max_noise<0&&S.max_noise>b.max_noise-.2&&b.tot_noise<S.tot_noise||b.max_noise<=0&&S.max_noise>0&&S.max_noise>b.max_noise-.2&&b.tot_noise<S.tot_noise+S.over_noise||b.max_noise>0&&S.max_noise>-.05&&S.max_noise>b.max_noise-.1&&b.tot_noise+b.over_noise<S.tot_noise+S.over_noise||b.max_noise>0&&S.max_noise>-.1&&S.max_noise>b.max_noise-.15&&b.tot_noise+b.over_noise+b.over_noise<S.tot_noise+S.over_noise+S.over_noise;break;case 5:R=b.over_noise<S.over_noise||BitStream.EQ(b.over_noise,S.over_noise)&&b.tot_noise<S.tot_noise;break;case 6:R=b.over_noise<S.over_noise||BitStream.EQ(b.over_noise,S.over_noise)&&(b.max_noise<S.max_noise||BitStream.EQ(b.max_noise,S.max_noise)&&b.tot_noise<=S.tot_noise);break;case 7:R=b.over_count<S.over_count||b.over_noise<S.over_noise;break}return S.over_count==0&&(R=R&&b.bits<S.bits),R}function d(v,S,b,T,w){var R=v.internal_flags,C;S.scalefac_scale==0?C=1.2968395546510096:C=1.6817928305074292;for(var N=0,U=0;U<S.sfbmax;U++)N<b[U]&&(N=b[U]);var B=R.noise_shaping_amp;switch(B==3&&(w?B=2:B=1),B){case 2:break;case 1:N>1?N=Math.pow(N,.5):N*=.95;break;default:N>1?N=1:N*=.95;break}for(var $=0,U=0;U<S.sfbmax;U++){var I=S.width[U],L;if($+=I,!(b[U]<N)){if(R.substep_shaping&2&&(R.pseudohalf[U]=R.pseudohalf[U]==0?1:0,R.pseudohalf[U]==0&&R.noise_shaping_amp==2))return;for(S.scalefac[U]++,L=-I;L<0;L++)T[$+L]*=C,T[$+L]>S.xrpow_max&&(S.xrpow_max=T[$+L]);if(R.noise_shaping_amp==2)return}}}function p(v,S){for(var b=1.2968395546510096,T=0,w=0;w<v.sfbmax;w++){var R=v.width[w],C=v.scalefac[w];if(v.preflag!=0&&(C+=t.pretab[w]),T+=R,C&1){C++;for(var N=-R;N<0;N++)S[T+N]*=b,S[T+N]>v.xrpow_max&&(v.xrpow_max=S[T+N])}v.scalefac[w]=C>>1}v.preflag=0,v.scalefac_scale=1}function m(v,S,b){var T,w=S.scalefac;for(T=0;T<S.sfb_lmax;T++)if(w[T]>=16)return!0;for(var R=0;R<3;R++){var C=0,N=0;for(T=S.sfb_lmax+R;T<S.sfbdivide;T+=3)C<w[T]&&(C=w[T]);for(;T<S.sfbmax;T+=3)N<w[T]&&(N=w[T]);if(!(C<16&&N<8)){if(S.subblock_gain[R]>=7)return!0;S.subblock_gain[R]++;var U=v.scalefac_band.l[S.sfb_lmax];for(T=S.sfb_lmax+R;T<S.sfbmax;T+=3){var B,$=S.width[T],I=w[T];if(I=I-(4>>S.scalefac_scale),I>=0){w[T]=I,U+=$*3;continue}w[T]=0;{var L=210+(I<<S.scalefac_scale+1);B=t.IPOW20(L)}U+=$*(R+1);for(var P=-$;P<0;P++)b[U+P]*=B,b[U+P]>S.xrpow_max&&(S.xrpow_max=b[U+P]);U+=$*(3-R-1)}{var B=t.IPOW20(202);U+=S.width[T]*(R+1);for(var P=-S.width[T];P<0;P++)b[U+P]*=B,b[U+P]>S.xrpow_max&&(S.xrpow_max=b[U+P])}}}return!1}function _(v,S,b,T,w){var R=v.internal_flags;d(v,S,b,T,w);var C=l(S);return C?!1:(R.mode_gr==2?C=i.scale_bitcount(S):C=i.scale_bitcount_lsf(R,S),C?(R.noise_shaping>1&&(rE.fill(R.pseudohalf,0),S.scalefac_scale==0?(p(S,T),C=!1):S.block_type==Wi.SHORT_TYPE&&R.subblock_gain>0&&(C=m(R,S,T)||l(S))),C||(R.mode_gr==2?C=i.scale_bitcount(S):C=i.scale_bitcount_lsf(R,S)),!C):!0)}this.outer_loop=function(v,S,b,T,w,R){var C=v.internal_flags,N=new KV,U=rw(576),B=rw(XV.SFBMAX),$=new q2,I,L=new Q9e,P=9999999,H=!1,X=!1,G=0;if(c(C,S,R,w,T),C.noise_shaping==0)return 100;t.calc_noise(S,b,B,$,L),$.bits=S.part2_3_length,N.assign(S);var Y=0;for(mv.arraycopy(T,0,U,0,576);!H;){do{var J=new q2,Q,z=255;if(C.substep_shaping&2?Q=20:Q=3,C.sfb21_extra&&(B[N.sfbmax]>1||N.block_type==Wi.SHORT_TYPE&&(B[N.sfbmax+1]>1||B[N.sfbmax+2]>1))||!_(v,N,B,T,X))break;N.scalefac_scale!=0&&(z=254);var q=R-N.part2_length;if(q<=0)break;for(;(N.part2_3_length=i.count_bits(C,T,N,L))>q&&N.global_gain<=z;)N.global_gain++;if(N.global_gain>z)break;if($.over_count==0){for(;(N.part2_3_length=i.count_bits(C,T,N,L))>P&&N.global_gain<=z;)N.global_gain++;if(N.global_gain>z)break}if(t.calc_noise(N,b,B,J,L),J.bits=N.part2_3_length,S.block_type!=Wi.SHORT_TYPE?I=v.quant_comp:I=v.quant_comp_short,I=f(I,$,J,N,B)?1:0,I!=0)P=S.part2_3_length,$=J,S.assign(N),Y=0,mv.arraycopy(T,0,U,0,576);else if(C.full_outer_loop==0&&(++Y>Q&&$.over_count==0||C.noise_shaping_amp==3&&X&&Y>30||C.noise_shaping_amp==3&&X&&N.global_gain-G>15))break}while(N.global_gain+N.scalefac_scale<255);C.noise_shaping_amp==3?X?H=!0:(N.assign(S),mv.arraycopy(U,0,T,0,576),Y=0,G=N.global_gain,X=!0):H=!0}return iw(S.global_gain+S.scalefac_scale<=255),v.VBR==YV.vbr_rh||v.VBR==YV.vbr_mtrh?mv.arraycopy(U,0,T,0,576):C.substep_shaping&1&&trancate_smallspectrums(C,S,b,T),$.over_count},this.iteration_finish_one=function(v,S,b){var T=v.l3_side,w=T.tt[S][b];i.best_scalefac_store(v,S,b,T),v.use_best_huffman==1&&i.best_huffman_divide(v,w),e.ResvAdjust(v,w)},this.VBR_encode_granule=function(v,S,b,T,w,R,C){var N=v.internal_flags,U=new KV,B=rw(576),$=C,I=C+1,L=(C+R)/2,P,H,X=0,G=N.sfb21_extra;iw($<=LameInternalFlags.MAX_BITS_PER_CHANNEL),rE.fill(U.l3_enc,0);do L>$-42?N.sfb21_extra=!1:N.sfb21_extra=G,H=outer_loop(v,S,b,T,w,L),H<=0?(X=1,I=S.part2_3_length,U.assign(S),mv.arraycopy(T,0,B,0,576),C=I-32,P=C-R,L=(C+R)/2):(R=L+32,P=C-R,L=(C+R)/2,X!=0&&(X=2,S.assign(U),mv.arraycopy(B,0,T,0,576)));while(P>12);N.sfb21_extra=G,X==2&&mv.arraycopy(U.l3_enc,0,S.l3_enc,0,576),iw(S.part2_3_length<=$)},this.get_framebits=function(v,S){var b=v.internal_flags;b.bitrate_index=b.VBR_min_bitrate;var T=n.getframebits(v);b.bitrate_index=1,T=n.getframebits(v);for(var w=1;w<=b.VBR_max_bitrate;w++){b.bitrate_index=w;var R=new MeanBits(T);S[w]=e.ResvFrameBegin(v,R),T=R.bits}},this.VBR_old_prepare=function(v,S,b,T,w,R,C,N,U){var B=v.internal_flags,$,I=0,L=1,P=0;B.bitrate_index=B.VBR_max_bitrate;var H=e.ResvFrameBegin(v,new MeanBits(0))/B.mode_gr;get_framebits(v,R);for(var X=0;X<B.mode_gr;X++){var G=t.on_pe(v,S,N[X],H,X,0);B.mode_ext==Wi.MPG_MD_MS_LR&&(ms_convert(B.l3_side,X),t.reduce_side(N[X],b[X],H,G));for(var Y=0;Y<B.channels_out;++Y){var J=B.l3_side.tt[X][Y];J.block_type!=Wi.SHORT_TYPE?(I=1.28/(1+Math.exp(3.5-S[X][Y]/300))-.05,$=B.PSY.mask_adjust-I):(I=2.56/(1+Math.exp(3.5-S[X][Y]/300))-.14,$=B.PSY.mask_adjust_short-I),B.masking_lower=Math.pow(10,$*.1),init_outer_loop(B,J),U[X][Y]=t.calc_xmin(v,T[X][Y],J,w[X][Y]),U[X][Y]!=0&&(L=0),C[X][Y]=126,P+=N[X][Y]}}for(var X=0;X<B.mode_gr;X++)for(var Y=0;Y<B.channels_out;Y++)P>R[B.VBR_max_bitrate]&&(N[X][Y]*=R[B.VBR_max_bitrate],N[X][Y]/=P),C[X][Y]>N[X][Y]&&(C[X][Y]=N[X][Y]);return L},this.bitpressure_strategy=function(v,S,b,T){for(var w=0;w<v.mode_gr;w++)for(var R=0;R<v.channels_out;R++){for(var C=v.l3_side.tt[w][R],N=S[w][R],U=0,B=0;B<C.psy_lmax;B++)N[U++]*=1+.029*B*B/Wi.SBMAX_l/Wi.SBMAX_l;if(C.block_type==Wi.SHORT_TYPE)for(var B=C.sfb_smin;B<Wi.SBMAX_s;B++)N[U++]*=1+.029*B*B/Wi.SBMAX_s/Wi.SBMAX_s,N[U++]*=1+.029*B*B/Wi.SBMAX_s/Wi.SBMAX_s,N[U++]*=1+.029*B*B/Wi.SBMAX_s/Wi.SBMAX_s;T[w][R]=0|Math.max(b[w][R],.9*T[w][R])}},this.VBR_new_prepare=function(v,S,b,T,w,R){var C=v.internal_flags,N=1,U=0,B=0,$;if(v.free_format){C.bitrate_index=0;var I=new MeanBits(U);$=e.ResvFrameBegin(v,I),U=I.bits,w[0]=$}else{C.bitrate_index=C.VBR_max_bitrate;var I=new MeanBits(U);e.ResvFrameBegin(v,I),U=I.bits,get_framebits(v,w),$=w[C.VBR_max_bitrate]}for(var L=0;L<C.mode_gr;L++){t.on_pe(v,S,R[L],U,L,0),C.mode_ext==Wi.MPG_MD_MS_LR&&ms_convert(C.l3_side,L);for(var P=0;P<C.channels_out;++P){var H=C.l3_side.tt[L][P];C.masking_lower=Math.pow(10,C.PSY.mask_adjust*.1),init_outer_loop(C,H),t.calc_xmin(v,b[L][P],H,T[L][P])!=0&&(N=0),B+=R[L][P]}}for(var L=0;L<C.mode_gr;L++)for(var P=0;P<C.channels_out;P++)B>$&&(R[L][P]*=$,R[L][P]/=B);return N},this.calc_target_bits=function(v,S,b,T,w,R){var C=v.internal_flags,N=C.l3_side,U,B,$,I,L=0;C.bitrate_index=C.VBR_max_bitrate;var P=new MeanBits(L);for(R[0]=e.ResvFrameBegin(v,P),L=P.bits,C.bitrate_index=1,L=n.getframebits(v)-C.sideinfo_len*8,w[0]=L/(C.mode_gr*C.channels_out),L=v.VBR_mean_bitrate_kbps*v.framesize*1e3,C.substep_shaping&1&&(L*=1.09),L/=v.out_samplerate,L-=C.sideinfo_len*8,L/=C.mode_gr*C.channels_out,U=.93+.07*(11-v.compression_ratio)/(11-5.5),U<.9&&(U=.9),U>1&&(U=1),B=0;B<C.mode_gr;B++){var H=0;for($=0;$<C.channels_out;$++){if(T[B][$]=int(U*L),S[B][$]>700){var X=int((S[B][$]-700)/1.4),G=N.tt[B][$];T[B][$]=int(U*L),G.block_type==Wi.SHORT_TYPE&&X<L/2&&(X=L/2),X>L*3/2?X=L*3/2:X<0&&(X=0),T[B][$]+=X}T[B][$]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(T[B][$]=LameInternalFlags.MAX_BITS_PER_CHANNEL),H+=T[B][$]}if(H>LameInternalFlags.MAX_BITS_PER_GRANULE)for($=0;$<C.channels_out;++$)T[B][$]*=LameInternalFlags.MAX_BITS_PER_GRANULE,T[B][$]/=H}if(C.mode_ext==Wi.MPG_MD_MS_LR)for(B=0;B<C.mode_gr;B++)t.reduce_side(T[B],b[B],L*C.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(I=0,B=0;B<C.mode_gr;B++)for($=0;$<C.channels_out;$++)T[B][$]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(T[B][$]=LameInternalFlags.MAX_BITS_PER_CHANNEL),I+=T[B][$];if(I>R[0])for(B=0;B<C.mode_gr;B++)for($=0;$<C.channels_out;$++)T[B][$]*=R[0],T[B][$]/=I}}var tje=eje,nje=No,ZV=nje.assert;function rje(){var n;this.setModules=function(e){n=e},this.ResvFrameBegin=function(e,t){var r=e.internal_flags,i,s=r.l3_side,o=n.getframebits(e);t.bits=(o-r.sideinfo_len*8)/r.mode_gr;var a=8*256*r.mode_gr-8;e.brate>320?i=8*int(e.brate*1e3/(e.out_samplerate/1152)/8+.5):(i=8*1440,e.strict_ISO&&(i=8*int(32e4/(e.out_samplerate/1152)/8+.5))),r.ResvMax=i-o,r.ResvMax>a&&(r.ResvMax=a),(r.ResvMax<0||e.disable_reservoir)&&(r.ResvMax=0);var c=t.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return c>i&&(c=i),ZV(r.ResvMax%8==0),ZV(r.ResvMax>=0),s.resvDrain_pre=0,r.pinfo!=null&&(r.pinfo.mean_bits=t.bits/2,r.pinfo.resvsize=r.ResvSize),c},this.ResvMaxBits=function(e,t,r,i){var s=e.internal_flags,o,a=s.ResvSize,c=s.ResvMax;i!=0&&(a+=t),s.substep_shaping&1&&(c*=.9),r.bits=t,a*10>c*9?(o=a-c*9/10,r.bits+=o,s.substep_shaping|=128):(o=0,s.substep_shaping&=127,!e.disable_reservoir&&!(s.substep_shaping&1)&&(r.bits-=.1*t));var l=a<s.ResvMax*6/10?a:s.ResvMax*6/10;return l-=o,l<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var r,i=e.l3_side;e.ResvSize+=t*e.mode_gr;var s=0;i.resvDrain_post=0,i.resvDrain_pre=0,(r=e.ResvSize%8)!=0&&(s+=r),r=e.ResvSize-s-e.ResvMax,r>0&&(s+=r);{var o=Math.min(i.main_data_begin*8,s)/8;i.resvDrain_pre+=8*o,s-=8*o,e.ResvSize-=8*o,i.main_data_begin-=o}i.resvDrain_post+=s,e.ResvSize-=s}}var ije=rje;function sje(){var n="http://www.mp3dev.org/",e=3,t=98,r=4,i=0,s=93;this.getLameVersion=function(){return e+"."+t+"."+r},this.getLameShortVersion=function(){return e+"."+t+"."+r},this.getLameVeryShortVersion=function(){return"LAME"+e+"."+t+"r"},this.getPsyVersion=function(){return i+"."+s},this.getLameUrl=function(){return n},this.getLameOsBitness=function(){return"32bits"}}var oje=sje,lT=No,aje=lT.System,Y2=lT.VbrMode,JV=lT.ShortBlock,cje=lT.Arrays,ok=lT.new_byte,lje=lT.assert;FA.NUMTOCENTRIES=100;FA.MAXFRAMESIZE=2880;function FA(){var n,e,t;this.setModules=function(L,P,H){n=L,e=P,t=H};var r=1,i=2,s=4,o=8,a=FA.NUMTOCENTRIES,c=FA.MAXFRAMESIZE,l=a+4+4+4+4+4,u=l+9+1+1+8+1+1+3+1+1+2+4+2+2,h=128,f=64,d=32,p=null,m="Xing",_="Info",v=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function S(L,P){if(L.nVbrNumFrames++,L.sum+=P,L.seen++,!(L.seen<L.want)&&(L.pos<L.size&&(L.bag[L.pos]=L.sum,L.pos++,L.seen=0),L.pos==L.size)){for(var H=1;H<L.size;H+=2)L.bag[H/2]=L.bag[H];L.want*=2,L.pos/=2}}function b(L,P){if(!(L.pos<=0))for(var H=1;H<a;++H){var X=H/a,G,Y,J=0|Math.floor(X*L.pos);J>L.pos-1&&(J=L.pos-1),G=L.bag[J],Y=L.sum;var Q=0|256*G/Y;Q>255&&(Q=255),P[H]=255&Q}}this.addVbrFrame=function(L){var P=L.internal_flags,H=Tables.bitrate_table[L.version][P.bitrate_index];lje(P.VBR_seek_table.bag!=null),S(P.VBR_seek_table,H)};function T(L,P){var H=L[P+0]&255;return H<<=8,H|=L[P+1]&255,H<<=8,H|=L[P+2]&255,H<<=8,H|=L[P+3]&255,H}function w(L,P,H){L[P+0]=255&(H>>24&255),L[P+1]=255&(H>>16&255),L[P+2]=255&(H>>8&255),L[P+3]=255&(H&255)}function R(L,P,H){L[P+0]=255&(H>>8&255),L[P+1]=255&(H&255)}function C(L,P){return new String(L,P,m.length(),p).equals(m)||new String(L,P,_.length(),p).equals(_)}function N(L,P,H){return 255&(L<<P|H&~(-1<<P))}function U(L,P){var H=L.internal_flags;P[0]=N(P[0],8,255),P[1]=N(P[1],3,7),P[1]=N(P[1],1,L.out_samplerate<16e3?0:1),P[1]=N(P[1],1,L.version),P[1]=N(P[1],2,1),P[1]=N(P[1],1,L.error_protection?0:1),P[2]=N(P[2],4,H.bitrate_index),P[2]=N(P[2],2,H.samplerate_index),P[2]=N(P[2],1,0),P[2]=N(P[2],1,L.extension),P[3]=N(P[3],2,L.mode.ordinal()),P[3]=N(P[3],2,H.mode_ext),P[3]=N(P[3],1,L.copyright),P[3]=N(P[3],1,L.original),P[3]=N(P[3],2,L.emphasis),P[0]=255;var X=255&(P[1]&241),G;L.version==1?G=h:L.out_samplerate<16e3?G=d:G=f,L.VBR==Y2.vbr_off&&(G=L.brate);var Y;L.free_format?Y=0:Y=255&16*n.BitrateIndex(G,L.version,L.out_samplerate),L.version==1?(P[1]=255&(X|10),X=255&(P[2]&13),P[2]=255&(Y|X)):(P[1]=255&(X|2),X=255&(P[2]&13),P[2]=255&(Y|X))}this.getVbrTag=function(L){var P=new VBRTagData,H=0;P.flags=0;var X=L[H+1]>>3&1,G=L[H+2]>>2&3,Y=L[H+3]>>6&3,J=L[H+2]>>4&15;if(J=Tables.bitrate_table[X][J],L[H+1]>>4==14?P.samprate=Tables.samplerate_table[2][G]:P.samprate=Tables.samplerate_table[X][G],X!=0?Y!=3?H+=36:H+=21:Y!=3?H+=21:H+=13,!C(L,H))return null;H+=4,P.hId=X;var Q=P.flags=T(L,H);if(H+=4,Q&r&&(P.frames=T(L,H),H+=4),Q&i&&(P.bytes=T(L,H),H+=4),Q&s){if(P.toc!=null)for(var z=0;z<a;z++)P.toc[z]=L[H+z];H+=a}P.vbrScale=-1,Q&o&&(P.vbrScale=T(L,H),H+=4),P.headersize=(X+1)*72e3*J/P.samprate,H+=21;var q=L[H+0]<<4;q+=L[H+1]>>4;var ee=(L[H+1]&15)<<8;return ee+=L[H+2]&255,(q<0||q>3e3)&&(q=-1),(ee<0||ee>3e3)&&(ee=-1),P.encDelay=q,P.encPadding=ee,P},this.InitVbrTag=function(L){var P=L.internal_flags,H;L.version==1?H=h:L.out_samplerate<16e3?H=d:H=f,L.VBR==Y2.vbr_off&&(H=L.brate);var X=(L.version+1)*72e3*H/L.out_samplerate,G=P.sideinfo_len+u;if(P.VBR_seek_table.TotalFrameSize=X,X<G||X>c){L.bWriteVbrTag=!1;return}P.VBR_seek_table.nVbrNumFrames=0,P.VBR_seek_table.nBytesWritten=0,P.VBR_seek_table.sum=0,P.VBR_seek_table.seen=0,P.VBR_seek_table.want=1,P.VBR_seek_table.pos=0,P.VBR_seek_table.bag==null&&(P.VBR_seek_table.bag=new int[400],P.VBR_seek_table.size=400);var Y=ok(c);U(L,Y);for(var J=P.VBR_seek_table.TotalFrameSize,Q=0;Q<J;++Q)e.add_dummy_byte(L,Y[Q]&255,1)};function B(L,P){var H=P^L;return P=P>>8^v[H&255],P}this.updateMusicCRC=function(L,P,H,X){for(var G=0;G<X;++G)L[0]=B(P[H+G],L[0])};function $(L,P,H,X,G){var Y=L.internal_flags,J=0,Q=L.encoder_delay,z=L.encoder_padding,q=100-10*L.VBR_q-L.quality,ee=t.getLameVeryShortVersion(),te,ie=0,Ee,Re=[1,5,3,2,4,0,3],Te=0|(L.lowpassfreq/100+.5>255?255:L.lowpassfreq/100+.5),Pe=0,We=0,it=0,ht=L.internal_flags.noise_shaping,vt=0,re=0,Le=0,$e=0,De=0,Oe=(L.exp_nspsytune&1)!=0,ae=(L.exp_nspsytune&2)!=0,ve=!1,xe=!1,pe=L.internal_flags.nogap_total,ze=L.internal_flags.nogap_current,Je=L.ATHtype,Xe=0,et;switch(L.VBR){case vbr_abr:et=L.VBR_mean_bitrate_kbps;break;case vbr_off:et=L.brate;break;default:et=L.VBR_min_bitrate_kbps}switch(L.VBR.ordinal()<Re.length?te=Re[L.VBR.ordinal()]:te=0,Ee=16*ie+te,Y.findReplayGain&&(Y.RadioGain>510&&(Y.RadioGain=510),Y.RadioGain<-510&&(Y.RadioGain=-510),We=8192,We|=3072,Y.RadioGain>=0?We|=Y.RadioGain:(We|=512,We|=-Y.RadioGain)),Y.findPeakSample&&(Pe=Math.abs(0|Y.PeakSample/32767*Math.pow(2,23)+.5)),pe!=-1&&(ze>0&&(xe=!0),ze<pe-1&&(ve=!0)),Xe=Je+((Oe?1:0)<<4)+((ae?1:0)<<5)+((ve?1:0)<<6)+((xe?1:0)<<7),q<0&&(q=0),L.mode){case MONO:vt=0;break;case STEREO:vt=1;break;case DUAL_CHANNEL:vt=2;break;case JOINT_STEREO:L.force_ms?vt=4:vt=3;break;case NOT_SET:default:vt=7;break}L.in_samplerate<=32e3?Le=0:L.in_samplerate==48e3?Le=2:L.in_samplerate>48e3?Le=3:Le=1,(L.short_blocks==JV.short_block_forced||L.short_blocks==JV.short_block_dispensed||L.lowpassfreq==-1&&L.highpassfreq==-1||L.scale_left<L.scale_right||L.scale_left>L.scale_right||L.disable_reservoir&&L.brate<320||L.noATH||L.ATHonly||Je==0||L.in_samplerate<=32e3)&&(re=1),$e=ht+(vt<<2)+(re<<5)+(Le<<6),De=Y.nMusicCRC,w(H,X+J,q),J+=4;for(var Ut=0;Ut<9;Ut++)H[X+J+Ut]=255&ee.charAt(Ut);J+=9,H[X+J]=255&Ee,J++,H[X+J]=255&Te,J++,w(H,X+J,Pe),J+=4,R(H,X+J,We),J+=2,R(H,X+J,it),J+=2,H[X+J]=255&Xe,J++,et>=255?H[X+J]=255:H[X+J]=255&et,J++,H[X+J]=255&Q>>4,H[X+J+1]=255&(Q<<4)+(z>>8),H[X+J+2]=255&z,J+=3,H[X+J]=255&$e,J++,H[X+J++]=0,R(H,X+J,L.preset),J+=2,w(H,X+J,P),J+=4,R(H,X+J,De),J+=2;for(var gt=0;gt<J;gt++)G=B(H[X+gt],G);return R(H,X+J,G),J+=2,J}function I(L){L.seek(0);var P=ok(10);L.readFully(P);var H;return new String(P,"ISO-8859-1").startsWith("ID3")?H=0:H=((P[6]&127)<<21|(P[7]&127)<<14|(P[8]&127)<<7|P[9]&127)+P.length,H}this.getLameTagFrame=function(L,P){var H=L.internal_flags;if(!L.bWriteVbrTag||H.Class_ID!=Lame.LAME_ID||H.VBR_seek_table.pos<=0)return 0;if(P.length<H.VBR_seek_table.TotalFrameSize)return H.VBR_seek_table.TotalFrameSize;cje.fill(P,0,H.VBR_seek_table.TotalFrameSize,0),U(L,P);var X=ok(a);if(L.free_format)for(var G=1;G<a;++G)X[G]=255&255*G/100;else b(H.VBR_seek_table,X);var Y=H.sideinfo_len;L.error_protection&&(Y-=2),L.VBR==Y2.vbr_off?(P[Y++]=255&_.charAt(0),P[Y++]=255&_.charAt(1),P[Y++]=255&_.charAt(2),P[Y++]=255&_.charAt(3)):(P[Y++]=255&m.charAt(0),P[Y++]=255&m.charAt(1),P[Y++]=255&m.charAt(2),P[Y++]=255&m.charAt(3)),w(P,Y,r+i+s+o),Y+=4,w(P,Y,H.VBR_seek_table.nVbrNumFrames),Y+=4;var J=H.VBR_seek_table.nBytesWritten+H.VBR_seek_table.TotalFrameSize;w(P,Y,0|J),Y+=4,aje.arraycopy(X,0,P,Y,X.length),Y+=X.length,L.error_protection&&e.CRC_writeheader(H,P);for(var Q=0,G=0;G<Y;G++)Q=B(P[G],Q);return Y+=$(L,J,P,Y,Q),H.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(L,P){var H=L.internal_flags;if(H.VBR_seek_table.pos<=0||(P.seek(P.length()),P.length()==0))return-1;var X=I(P);P.seek(X);var G=ok(c),Y=getLameTagFrame(L,G);return Y>G.length?-1:(Y<1||P.write(G,0,Y),0)}}var uje=FA,Qne=No,QV=Qne.new_byte,hje=Qne.assert,fje=J8(),dje=H9e,pje=qne,mje=Xne(),gje=tje,_je=Zne(),vje=ije,yje=HC,bje=Z8();Yl();var Sje=oje,Eje=uje;function xje(){this.setModules=function(n,e){}}function Tje(){this.setModules=function(n,e,t){}}function wje(){}function Aje(){this.setModules=function(n,e){}}function Cje(n,e,t){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),n=1,e=44100,t=128);var r=new fje,i=new xje,s=new pje,o=new bje,a=new dje,c=new mje,l=new gje,u=new Eje,h=new Sje,f=new Aje,d=new vje,p=new _je,m=new Tje,_=new wje;r.setModules(s,o,a,c,l,u,h,f,_),o.setModules(s,_,h,u),f.setModules(o,h),a.setModules(r),l.setModules(o,d,c,p),c.setModules(p,d,r.enc.psy),d.setModules(o),p.setModules(c),u.setModules(r,o,h),i.setModules(m,_),m.setModules(h,f,a);var v=r.lame_init();v.num_channels=n,v.in_samplerate=e,v.brate=t,v.mode=yje.STEREO,v.quality=3,v.bWriteVbrTag=!1,v.disable_reservoir=!0,v.write_id3tag_automatic=!1,r.lame_init_params(v);var S=1152,b=0|1.25*S+7200,T=QV(b);this.encodeBuffer=function(w,R){n==1&&(R=w),hje(w.length==R.length),w.length>S&&(S=w.length,b=0|1.25*S+7200,T=QV(b));var C=r.lame_encode_buffer(v,w,R,w.length,T,0,b);return new Int8Array(T.subarray(0,C))},this.flush=function(){var w=r.lame_encode_flush(v,T,0,b);return new Int8Array(T.subarray(0,w))}}function Nm(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function P3(n){return n.charCodeAt(0)<<24|n.charCodeAt(1)<<16|n.charCodeAt(2)<<8|n.charCodeAt(3)}Nm.RIFF=P3("RIFF");Nm.WAVE=P3("WAVE");Nm.fmt_=P3("fmt ");Nm.data=P3("data");Nm.readHeader=function(n){var e=new Nm,t=n.getUint32(0,!1);if(Nm.RIFF==t&&(n.getUint32(4,!0),Nm.WAVE==n.getUint32(8,!1)&&Nm.fmt_==n.getUint32(12,!1))){var r=n.getUint32(16,!0),i=20;switch(r){case 16:case 18:e.channels=n.getUint16(i+2,!0),e.sampleRate=n.getUint32(i+4,!0);break;default:throw"extended fmt chunk not implemented"}i+=r;for(var s=Nm.data,o=0;s!=t&&(t=n.getUint32(i,!1),o=n.getUint32(i+4,!0),s!=t);)i+=o+8;return e.dataLen=o,e.dataOffset=i+8,e}};var Rje=Cje;async function kje(n){const e=ii(),t=n.getChannelData(0),r=n.sampleRate,i=new Rje(1,r,128),s=1152,o=[];for(let c=0;c<t.length;c+=s){o.length%64===0&&zr(qe,e,`encoding chunk (${c}/${t.length})`);const l=new Int16Array(s);for(let h=0;h<s;h++)c+h<t.length&&(l[h]=t[c+h]<0?t[c+h]*32768:t[c+h]*32767);const u=i.encodeBuffer(l);u.length>0&&o.push(u),o.length%16===0&&await mh(10)}const a=i.flush();return a.length>0&&o.push(a),zr(qe,e,`total chunks ${o.length+1}`),await mh(100),new Uint8Array(o.reduce((c,l)=>{const u=new Uint8Array(c.length+l.length);return u.set(c,0),u.set(l,c.length),u},new Uint8Array(0)))}function Mje(n,e,t,r){const{SOURCE:i,FX:s,FXCHAIN:o}=n;function a(){e.recordedticks=[],e.recordlastpercent=0,e.recordisrendering=0}function c(l){if(e.recordedticks.length){const u=ii(),h=e.recordedticks.map(T=>T[0]),f=Math.min(...h),d=Math.max(...h),p=Math.ceil(d-f+5),m=[];for(let T=0;T<e.recordedticks.length;++T){const[w,R]=e.recordedticks[T];m.push([w-f+.1,R])}const _=i.map(T=>T.getreplay()),v=o.getreplay(),S=s.map(T=>T.getreplay());let b;g7e(async({transport:T})=>{zr(qe,u,"create synth"),await t(),b=r(),zr(qe,u,"synth waiting for setup"),await mh(2e3),b.setplayvolume(80),b.applyreplay(_,v,S),b.synthreplay(m,d),zr(qe,u,"rendering audio"),T.start(0)},p).then(T=>(zr(qe,u,"rendering complete, exporting mp3"),kje(T))).then(T=>{const w=document.createElement("a");w.href=URL.createObjectURL(new Blob([T],{type:"audio/mp3"})),w.download=`${l||v6()}.mp3`,zr(qe,u,`saving file ${w.download}`),w.click(),b?.destroy()}).catch(T=>{_r(qe,u,"synthrecord",T)})}a()}return{synthrecord:c,synthflush:a}}class Q8 extends bf{name="AlgoSynth";_operator1;_operator2;_operator3;_operator4;_modulation1;_modulation2;_modulation3;oscillator1;oscillator2;oscillator3;oscillator4;envelope1;envelope2;envelope3;envelope4;frequency;detune;modulationindex1;modulationindex2;modulationindex3;harmonicity1;harmonicity2;harmonicity3;constructor(){const e=Yn(Q8.getDefaults(),arguments);switch(super(e),this._operator1=new Wa({context:this.context,oscillator:e.oscillator1,envelope:e.envelope1,volume:-10}),this.oscillator1=this._operator1.oscillator,this.envelope1=this._operator1.envelope,this._operator2=new Wa({context:this.context,oscillator:e.oscillator2,envelope:e.envelope2,volume:-10}),this.oscillator2=this._operator2.oscillator,this.envelope2=this._operator2.envelope,this._operator3=new Wa({context:this.context,oscillator:e.oscillator3,envelope:e.envelope3,volume:-10}),this.oscillator3=this._operator3.oscillator,this.envelope3=this._operator3.envelope,this._operator4=new Wa({context:this.context,oscillator:e.oscillator4,envelope:e.envelope4,onsilence:()=>this.onsilence(this),volume:-10}),this.oscillator4=this._operator4.oscillator,this.envelope4=this._operator4.envelope,this.frequency=new Oi({context:this.context,units:"frequency"}),this.detune=new Oi({context:this.context,value:e.detune,units:"cents"}),this.harmonicity1=new Ul({context:this.context,value:e.harmonicity1,minValue:0}),this.harmonicity2=new Ul({context:this.context,value:e.harmonicity2,minValue:0}),this.harmonicity3=new Ul({context:this.context,value:e.harmonicity3,minValue:0}),this.modulationindex1=new Ul({context:this.context,value:e.modulationindex1}),this.modulationindex2=new Ul({context:this.context,value:e.modulationindex2}),this.modulationindex3=new Ul({context:this.context,value:e.modulationindex3}),this._modulation1=new $r({context:this.context,gain:0}),this._modulation2=new $r({context:this.context,gain:0}),this._modulation3=new $r({context:this.context,gain:0}),this.frequency.chain(this.harmonicity1,this._operator1.frequency),this.frequency.chain(this.harmonicity2,this._operator2.frequency),this.frequency.chain(this.harmonicity3,this._operator3.frequency),this.frequency.connect(this._operator4.frequency),this.frequency.chain(this.modulationindex1,this._modulation1),this.frequency.chain(this.modulationindex2,this._modulation2),this.frequency.chain(this.modulationindex3,this._modulation3),this.detune.fan(this._operator1.detune,this._operator2.detune,this._operator3.detune,this._operator4.detune),e.algorithm){case 0:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 1:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator3.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 2:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator4.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 3:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator4.frequency),this._operator2.connect(this._modulation2.gain),this._modulation2.connect(this._operator4.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 4:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator3.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 5:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency),this._operator1.connect(this._modulation2.gain),this._modulation2.connect(this._operator3.frequency),this._operator1.connect(this._modulation3.gain),this._modulation3.connect(this._operator4.frequency);break;case 6:this._operator1.connect(this._modulation1.gain),this._modulation1.connect(this._operator2.frequency);break}switch(e.algorithm){case 0:case 1:case 2:case 3:this._operator4.connect(this.output);break;case 4:this._operator2.connect(this.output),this._operator4.connect(this.output);break;case 5:case 6:this._operator2.connect(this.output),this._operator3.connect(this.output),this._operator4.connect(this.output);break;case 7:this._operator1.connect(this.output),this._operator2.connect(this.output),this._operator3.connect(this.output),this._operator4.connect(this.output);break}yi(this,["harmonicity1","harmonicity2","harmonicity3","modulationindex1","modulationindex2","modulationindex3","oscillator1","oscillator2","oscillator3","oscillator4","envelope1","envelope2","envelope3","envelope4","frequency","detune"])}static getDefaults(){return Object.assign(bf.getDefaults(),{algorithm:0,harmonicity1:2,harmonicity2:2,harmonicity3:2,modulationindex1:1,modulationindex2:1,modulationindex3:1,oscillator1:Object.assign(Pc(Hm.getDefaults(),[...Object.keys(ga.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator2:Object.assign(Pc(Hm.getDefaults(),[...Object.keys(ga.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator3:Object.assign(Pc(Hm.getDefaults(),[...Object.keys(ga.getDefaults()),"frequency","detune"]),{type:"sine"}),oscillator4:Object.assign(Pc(Hm.getDefaults(),[...Object.keys(ga.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope1:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope2:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope3:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),envelope4:Object.assign(Pc(ll.getDefaults(),Object.keys(Jn.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,t){this._operator1._triggerEnvelopeAttack(e,t),this._operator2._triggerEnvelopeAttack(e,t),this._operator3._triggerEnvelopeAttack(e,t),this._operator4._triggerEnvelopeAttack(e,t)}_triggerEnvelopeRelease(e){return this._operator1._triggerEnvelopeRelease(e),this._operator2._triggerEnvelopeRelease(e),this._operator3._triggerEnvelopeRelease(e),this._operator4._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope4.getValueAtTime(e)}dispose(){return super.dispose(),this.harmonicity1.dispose(),this.harmonicity2.dispose(),this.harmonicity3.dispose(),this.modulationindex1.dispose(),this.modulationindex2.dispose(),this.modulationindex3.dispose(),this._operator1.dispose(),this._operator2.dispose(),this._operator3.dispose(),this._operator4.dispose(),this._modulation1?.dispose(),this._modulation2?.dispose(),this._modulation3?.dispose(),this.frequency.dispose(),this.detune.dispose(),this}}var oi=(n=>(n[n.SYNTH=0]="SYNTH",n[n.RETRO_NOISE=1]="RETRO_NOISE",n[n.BUZZ_NOISE=2]="BUZZ_NOISE",n[n.CLANG_NOISE=3]="CLANG_NOISE",n[n.METALLIC_NOISE=4]="METALLIC_NOISE",n[n.BELLS=5]="BELLS",n[n.DOOT=6]="DOOT",n[n.ALGO_SYNTH=7]="ALGO_SYNTH",n))(oi||{});const eH=131072;function Ije(n){const e=xo().createBuffer(1,eH,xo().sampleRate);let t=1;const r=e.getChannelData(0);for(let i=0;i<eH;i++){n===4?r[i]=(t&1)*4*(Math.random()*14+1)-8:r[i]=(t&1)*2-1;let s=t>>1;if((t+s&1)==1)switch(n){default:case 1:s+=16384;break;case 3:s+=32768;break;case 2:s+=40;break;case 4:s+=60;break}t=s}return e}function M0(n,e){let t,r;function i(){switch(t?.type){case 0:{t.synth.set({...r,envelope:{...r.envelope,attack:.01,decay:.01,sustain:.5,release:.01},oscillator:{...r.oscillator,type:"square"}});break}case 1:{t.synth.set({...r,attack:.01,decay:.01,sustain:.5,release:.01});break}case 5:{t.synth.set({...r,harmonicity:1.5,modulationIndex:30,oscillator:{type:"sine"},modulation:{type:"square"},envelope:{attack:.01,decay:3,sustain:.3,release:6},modulationEnvelope:{attack:.5,decay:1,sustain:.2,release:4}});break}case 6:{t.synth.set({...r});break}case 7:{t.synth.set({...r});break}}}function s(){return{type:t?.type,synth:t?.synth.get(),algo:t?.type===7?t?.algo:0}}function o(c){t?.synth.set(c.synth)}function a(){t?.synth.dispose()}switch(n){case 0:return t={type:n,synth:new Wa},r=Ks(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 1:case 2:case 3:case 4:return t={type:n,synth:new zC({volume:-44,urls:{C4:Ije(n)}}),filter1:new Lx({type:"lowshelf",gain:-32,frequency:440}),filter2:new Lx({type:"highshelf",gain:32,frequency:440})},r=Ks(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 5:return t={type:5,synth:new M8,sparkle:new I8({volume:-16,envelope:{attack:.001,decay:1.4,release:.321},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5})},r=Ks(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 6:return t={type:n,synth:new oT},r=Ks(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a};case 7:return t={type:n,synth:new Q8({algorithm:e}),algo:e},r=Ks(t.synth.get()),i(),{source:t,applyreset:i,getreplay:s,setreplay:o,destroy:a}}}function Oje(n,e,t){const r=[M0(oi.SYNTH,0),M0(oi.SYNTH,0),M0(oi.SYNTH,0),M0(oi.SYNTH,0),M0(oi.SYNTH,0),M0(oi.SYNTH,0),M0(oi.SYNTH,0),M0(oi.SYNTH,0)],i=j7e(),s=[tk(1),tk(2),tk(3),tk(4)];for(let l=0;l<s.length;++l){const u=s[l],h=l<2?n:l<3?e:t;u.sendtofx.connect(h),u.fc.chain(i.fc,h),u.echo.chain(i.echo,h),u.reverb.chain(i.reverb,h),u.autofilter.chain(i.autofilter,h),u.vibrato.chain(i.vibrato,h),u.distortion.chain(i.distortion,h),u.autowah.chain(i.autowah,h)}function o(l){return l<4?Math.floor(l/2):2}function a(l){const u=o(l);if(he(r[l])){switch(r[l].source.type){case oi.RETRO_NOISE:case oi.BUZZ_NOISE:case oi.CLANG_NOISE:case oi.METALLIC_NOISE:break;default:r[l].source.synth.connect(s[u].sendtofx);break}switch(r[l].source.type){case oi.RETRO_NOISE:case oi.BUZZ_NOISE:case oi.CLANG_NOISE:case oi.METALLIC_NOISE:r[l].source.synth.chain(r[l].source.filter1,r[l].source.filter2,s[u].sendtofx);break;case oi.BELLS:r[l].source.sparkle.connect(s[u].sendtofx);break}}}for(let l=0;l<r.length;++l)a(l);function c(l,u,h){const f=r[l]?.source.type===oi.ALGO_SYNTH?r[l]?.source.algo:0;r[l]?.source.type===u&&f===h||(r[l]?.source.synth.dispose(),r[l]=M0(u,h),a(l))}return{SOURCE:r,FX:s,FXCHAIN:i,mapindextofx:o,connectsource:a,changesource:c}}function ere(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function tre(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var nre=[0,2,4,-1,1,3,5],rre=nre.map(n=>Math.floor(n*7/12));function ire(n){const{step:e,alt:t,oct:r,dir:i=1}=n,s=nre[e]+7*t;if(r===void 0)return[i*s];const o=r-rre[e]-4*t;return[i*s,i*o]}var Nje=[3,0,4,1,5,2,6];function Pje(n){const[e,t,r]=n,i=Nje[Dje(e)],s=Math.floor((e+1)/7);if(t===void 0)return{step:i,alt:s,dir:r};const o=t+4*s+rre[i];return{step:i,alt:s,oct:o,dir:r}}function Dje(n){const e=(n+1)%7;return e<0?7+e:e}var tH=(n,e)=>Array(Math.abs(e)+1).join(n),L4=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),Lje="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Uje="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Bje=new RegExp("^"+Lje+"|"+Uje+"$");function Fje(n){const e=Bje.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var nH={};function LI(n){return typeof n=="string"?nH[n]||(nH[n]=jje(n)):tre(n)?LI($je(n)):ere(n)?LI(n.name):L4}var rH=[0,2,4,5,7,9,11],sre="PMMPPMM";function jje(n){const e=Fje(n);if(e[0]==="")return L4;const t=+e[0],r=e[1],i=(Math.abs(t)-1)%7,s=sre[i];if(s==="M"&&r==="P")return L4;const o=s==="M"?"majorable":"perfectable",a=""+t+r,c=t<0?-1:1,l=t===8||t===-8?t:c*(i+1),u=zje(o,r),h=Math.floor((Math.abs(t)-1)/7),f=c*(rH[i]+u+12*h),d=(c*(rH[i]+u)%12+12)%12,p=ire({step:i,alt:u,oct:h,dir:c});return{empty:!1,name:a,num:t,q:r,step:i,alt:u,dir:c,type:o,simple:l,semitones:f,chroma:d,coord:p,oct:h}}function zje(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function $je(n){const{step:e,alt:t,oct:r=0,dir:i}=n;if(!i)return"";const s=e+1+7*r,o=s===0?e+1:s,a=i<0?"-":"",c=sre[e]==="M"?"majorable":"perfectable";return a+o+Vje(c,t)}function Vje(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?tH("A",e):tH("d",n==="perfectable"?e:e+1)}var iH=(n,e)=>Array(Math.abs(e)+1).join(n),ore=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),sH=new Map,Hje=n=>"CDEFGAB".charAt(n),Gje=n=>n<0?iH("b",-n):iH("#",n),Wje=n=>n[0]==="b"?-n.length:n.length;function jA(n){const e=JSON.stringify(n),t=sH.get(e);if(t)return t;const r=typeof n=="string"?Zje(n):tre(n)?jA(Jje(n)):ere(n)?jA(n.name):ore;return sH.set(e,r),r}var qje=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Yje(n){const e=qje.exec(n);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function Kje(n){return jA(Pje(n))}var Xje=(n,e)=>(n%e+e)%e,K2=[0,2,4,5,7,9,11];function Zje(n){const e=Yje(n);if(e[0]===""||e[3]!=="")return ore;const t=e[0],r=e[1],i=e[2],s=(t.charCodeAt(0)+3)%7,o=Wje(r),a=i.length?+i:void 0,c=ire({step:s,alt:o,oct:a}),l=t+r+i,u=t+r,h=(K2[s]+o+120)%12,f=a===void 0?Xje(K2[s]+o,12)-1188:K2[s]+o+12*(a+1),d=f>=0&&f<=127?f:null,p=a===void 0?null:Math.pow(2,(f-69)/12)*440;return{empty:!1,acc:r,alt:o,chroma:h,coord:c,freq:p,height:f,letter:t,midi:d,name:l,oct:a,pc:u,step:s}}function Jje(n){const{step:e,alt:t,oct:r}=n,i=Hje(e);if(!i)return"";const s=i+Gje(t);return r||r===0?s+r:s}function are(n,e){const t=jA(n),r=Array.isArray(e)?e:LI(e).coord;if(t.empty||!r||r.length<2)return"";const i=t.coord,s=i.length===1?[i[0]+r[0]]:[i[0]+r[0],i[1]+r[1]];return Kje(s).name}function cre(n,e){const t=e.length,r=(n%t+t)%t;return e.slice(r,t).concat(e.slice(0,r))}var f1={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},lre=n=>Number(n).toString(2).padStart(12,"0"),oH=n=>parseInt(n,2),Qje=/^[01]{12}$/;function ure(n){return Qje.test(n)}var eze=n=>typeof n=="number"&&n>=0&&n<=4095,tze=n=>n&&ure(n.chroma),aH={[f1.chroma]:f1};function hre(n){const e=ure(n)?n:eze(n)?lre(n):Array.isArray(n)?oze(n):tze(n)?n.chroma:f1.chroma;return aH[e]=aH[e]||sze(e)}var nze=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function rze(n){const e=[];for(let t=0;t<12;t++)n.charAt(t)==="1"&&e.push(nze[t]);return e}function ize(n){const e=n.split("");return e.map((t,r)=>cre(r,e).join(""))}function sze(n){const e=oH(n),t=ize(n).map(oH).filter(s=>s>=2048).sort()[0],r=lre(t),i=rze(n);return{empty:!1,name:"",setNum:e,chroma:n,normalized:r,intervals:i}}function oze(n){if(n.length===0)return f1.chroma;let e;const t=[0,0,0,0,0,0,0,0,0,0,0,0];for(let r=0;r<n.length;r++)e=jA(n[r]),e.empty&&(e=LI(n[r])),e.empty||(t[e.chroma]=1);return t.join("")}var aze=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],cze=aze;({...f1});var fre=[],nM={};function lze(n,e,t){const r=hze(n),i={...hre(n),name:t||"",quality:r,intervals:n,aliases:e};fre.push(i),i.name&&(nM[i.name]=i),nM[i.setNum]=i,nM[i.chroma]=i,i.aliases.forEach(s=>uze(i,s))}function uze(n,e){nM[e]=n}function hze(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}cze.forEach(([n,e,t])=>lze(n.split(" "),t.split(" "),e));fre.sort((n,e)=>n.setNum-e.setNum);var fze=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neapolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5p pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7m pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neapolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neapolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],dze=fze,pze={...f1,intervals:[],aliases:[]},Hw={};function mze(n){return Hw[n]||pze}function gze(n,e,t=[]){const r={...hre(n),name:e,intervals:n,aliases:t};return Hw[r.name]=r,Hw[r.setNum]=r,Hw[r.chroma]=r,r.aliases.forEach(i=>_ze(r,i)),r}function _ze(n,e){Hw[e]=n}dze.forEach(([n,e,...t])=>gze(n.split(" "),e,t));var vze=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],yze=vze;yze.forEach(([n,e,t])=>void 0);var bze=are;function Sze(n,e){return bze(n,[0,e])}var eB=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],cH={...f1,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},Eze=eB.map(xze),U4={};Eze.forEach(n=>{U4[n.name]=n,n.aliases.forEach(e=>{U4[e]=n})});function dre(n){return typeof n=="string"?U4[n.toLowerCase()]||cH:n&&n.name?dre(n.name):cH}function xze(n){const[e,t,r,i,s,o,a]=n,c=a?[a]:[],l=Number(t).toString(2);return{empty:!1,intervals:mze(i).intervals,modeNum:e,chroma:l,normalized:l,name:i,setNum:t,alt:r,triad:s,seventh:o,aliases:c}}function pre(n){return(e,t)=>{const r=dre(e);if(r.empty)return[];const i=cre(r.modeNum,n),s=r.intervals.map(o=>are(t,o));return i.map((o,a)=>s[a]+o)}}pre(eB.map(n=>n[4]));pre(eB.map(n=>n[5]));function Tze(n,e,t,r){const{SOURCE:i,FX:s,FXCHAIN:o,mapindextofx:a}=n,{drum:c}=e;return function(u,h){if(h===null)return;if(t.recordisrendering>0){const _=Math.round(u/t.recordisrendering*100);_!==t.recordlastpercent&&(t.recordlastpercent=_,zr(qe,ii(),`${_}%`))}else t.recordedticks.push([u,h]);const[f,d,p]=h,m=a(f);if(un(p)&&he(i[f])&&he(s[m])){i[f].source.type===oi.BELLS&&(i[f].source.synth.detune.value=mu(-3,3),i[f].source.sparkle.triggerAttackRelease(Sze(p,2),d,u)),i[f].source.synth.triggerAttackRelease(p,d,u);const _=i[f].source.synth.toSeconds(d),v="128n",S=i[f].source.synth.toSeconds(v);o.vibrato.depth.rampTo(1,"2n",u),o.vibrato.depth.rampTo(0,v,u+_-S),o.vibrato.frequency.rampTo(5,"4n",u),o.vibrato.frequency.rampTo(1,v,u+_-S)}if(rn(p))switch(p){case 0:c.ticktrigger(u);break;case 1:c.tweettrigger(u);break;case 2:c.cowbelltrigger(d,u);break;case 3:c.claptrigger(d,u);break;case 4:c.hisnaretrigger(d,u);break;case 5:c.hiwoodblocktrigger(d,u);break;case 6:c.lowsnaretrigger(d,u);break;case 7:c.lowtomtrigger(d,u);break;case 8:c.lowwoodblocktrigger(d,u);break;case 9:c.basstrigger(u);break;case-1:r.pacercount--,r.pacercount===0&&(r.pacer.clear(),r.pacertime=-1);break}}}async function mre(){await F7e(),await $7e()}function gre(){const n=V7e(),e=Oje(n.playvolume,n.bgplayvolume,n.ttsvolume),{SOURCE:t,FX:r,FXCHAIN:i,changesource:s}=e,o={recordedticks:[],recordlastpercent:0,recordisrendering:0},a={pacertime:-1,pacercount:0,pacer:null},c=Tze(e,n,o,a);a.pacer=new LA(c);const{synthrecord:l,synthflush:u}=Mje(e,o,mre,gre);let h=AV;function f(U,B,$){U.forEach((I,L)=>{s(L,I.type,I.algo),t[L].setreplay(I)}),i.setreplay(B),$.forEach((I,L)=>{r[L].setreplay(I)})}function d(U,B,$,I=!0){let L=B;const P=q7e(U,B,$,I),H=P[P.length-1];he(H)&&(L=Math.max(L,H[0]));for(let X=0;X<P.length;++X){const[G,Y]=P[X];a.pacer.add(G,Y)}return L}function p(U,B){o.recordlastpercent=0,o.recordisrendering=B;for(let $=0;$<U.length;++$){const[I,L]=U[$];a.pacer.add(I,L)}}function m(U){const B=CV(U);a.pacertime===-1&&(a.pacertime=D4().now()),a.pacercount+=B.length;const $=a.pacertime;for(let I=0;I<B.length&&I<t.length;++I){const L=d(I,$,B[I]);a.pacertime=Math.max(a.pacertime,L)}}function _(U,B){const $=CV(U),I=Lc(B||"+0.05").toSeconds();for(let L=0;L<$.length;++L)d(h++,I,$[L],!1),h>=t.length&&(h=AV)}function v(){a.pacer.clear(),a.pacertime=-1,a.pacercount=0}function S(U){v(),D4().bpm.setValueAtTime(U,0),a.pacer=new LA(c),a.pacer.start(0)}function b(U){n.mainvolume.volume.value=ua(U*.25)}function T(U){n.bgplayvolume.volume.value=ua(U)}function w(U){new jC(U).connect(r[3].sendtofx).start(0)}function R(U){n.ttsvolume.volume.value=U}function C(){t.forEach((U,B)=>{const $=U.source.type===oi.ALGO_SYNTH?U.source.algo:0;s(B,oi.SYNTH,$),U.applyreset(),U.source.synth.set({oscillator:{type:"square"}})}),r.forEach(U=>U.applyreset()),i.applyreset()}function N(){t.forEach(U=>U.destroy()),r.forEach(U=>U.destroy()),i.destroy(),n.mainvolume.dispose()}return R(25),b(80),T(100),a.pacer.start(0),i.autofilter.start(),{destroy:N,broadcastdestination:n.broadcastdestination,addplay:m,addbgplay:_,stopplay:v,applyreset:C,applyreplay:f,synthrecord:l,synthflush:u,synthreplay:p,addaudiobuffer:w,setbpm:S,setplayvolume:b,setbgplayvolume:T,setttsvolume:R,SOURCE:t,FX:r,FXCHAIN:i,changesource:s}}function wze(n,e,t,r){if(e.source.type!==oi.ALGO_SYNTH)return!1;switch(t){case"harmonicity":if(rn(r))return e.source.synth.set({harmonicity1:r,harmonicity2:r,harmonicity3:r}),!0;break;case"harmonicity1":if(rn(r))return e.source.synth.set({harmonicity1:r}),!0;break;case"harmonicity2":if(rn(r))return e.source.synth.set({harmonicity2:r}),!0;break;case"harmonicity3":if(rn(r))return e.source.synth.set({harmonicity3:r}),!0;break;case"modindex":if(rn(r))return e.source.synth.set({modulationindex1:r,modulationindex2:r,modulationindex3:r}),!0;break;case"modindex1":if(rn(r))return e.source.synth.set({modulationindex1:r}),!0;break;case"modindex2":if(rn(r))return e.source.synth.set({modulationindex2:r}),!0;break;case"modindex3":if(rn(r))return e.source.synth.set({modulationindex3:r}),!0;break;case"osc1":if(un(r))return e.source.synth.set({oscillator1:{type:r}}),!0;break;case"osc2":if(un(r))return e.source.synth.set({oscillator2:{type:r}}),!0;break;case"osc3":if(un(r))return e.source.synth.set({oscillator3:{type:r}}),!0;break;case"osc4":if(un(r))return e.source.synth.set({oscillator4:{type:r}}),!0;break;case"env1":case"envelope1":if(sr(r)){const[i,s,o,a]=r;return e.source.synth.set({envelope1:{attack:i,decay:s,sustain:o,release:a}}),!0}break;case"env2":case"envelope2":if(sr(r)){const[i,s,o,a]=r;return e.source.synth.set({envelope2:{attack:i,decay:s,sustain:o,release:a}}),!0}break;case"env3":case"envelope3":if(sr(r)){const[i,s,o,a]=r;return e.source.synth.set({envelope3:{attack:i,decay:s,sustain:o,release:a}}),!0}break;case"env4":case"envelope4":if(sr(r)){const[i,s,o,a]=r;return e.source.synth.set({envelope4:{attack:i,decay:s,sustain:o,release:a}}),!0}break}return!1}const Aze=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]+/,Cze=/(am|fm|fat)*(sine|square|triangle|sawtooth|custom)[0-9]*/;function Rze(n,e){if(un(n)){const t=cr(n);if(Aze.test(t))return sr(e);switch(t){case"pwm":case"pulse":case"retro":case"buzz":case"clang":case"metallic":case"bells":case"doot":case"algo0":case"algo1":case"algo2":case"algo3":case"algo4":case"algo5":case"algo6":case"algo7":return!0;default:return Cze.test(t)}}return!1}function kze(n,e,t,r,i){if(!he(e))return;const s=e.SOURCE[t];if(!he(s)){_r(qe,n,"synth",`unknown voice ${t}`);return}switch(r){case"restart":{e.applyreset();return}case"vol":case"volume":rn(i)&&(s.source.synth.volume.value=i);return;case"port":case"portamento":if(rn(i))switch(s.source.type){case oi.SYNTH:s.source.synth.portamento=i;break;case oi.ALGO_SYNTH:s.source.synth.portamento=i;break;case oi.RETRO_NOISE:_r(qe,n,"synth","portamento for retro synth not supported");break}return;case"env":case"envelope":if(sr(i)){const[o,a,c,l]=i;s.source.synth.set({envelope:{attack:o,decay:a,sustain:c,release:l}})}return;default:if(un(r)){if(Rze(r,i)){switch(r){case"retro":e.changesource(t,oi.RETRO_NOISE,0);break;case"buzz":e.changesource(t,oi.BUZZ_NOISE,0);break;case"clang":e.changesource(t,oi.CLANG_NOISE,0);break;case"metallic":e.changesource(t,oi.METALLIC_NOISE,0);break;case"bells":e.changesource(t,oi.BELLS,0);break;case"doot":e.changesource(t,oi.DOOT,0);break;case"algo0":e.changesource(t,oi.ALGO_SYNTH,0);break;case"algo1":e.changesource(t,oi.ALGO_SYNTH,1);break;case"algo2":e.changesource(t,oi.ALGO_SYNTH,2);break;case"algo3":e.changesource(t,oi.ALGO_SYNTH,3);break;case"algo4":e.changesource(t,oi.ALGO_SYNTH,4);break;case"algo5":e.changesource(t,oi.ALGO_SYNTH,5);break;case"algo6":e.changesource(t,oi.ALGO_SYNTH,6);break;case"algo7":e.changesource(t,oi.ALGO_SYNTH,7);break;default:e.changesource(t,oi.SYNTH,0),s.source.synth.set({oscillator:{type:r}}),sr(i)&&s.source.synth.set({oscillator:{type:r,partials:i,partialCount:i.length}}),rn(i)&&s.source.synth.set({oscillator:{type:r,partials:[i],partialCount:1}});break}return}switch(s.source.type){case oi.SYNTH:{switch(s.source.synth.get().oscillator.type){case"pwm":switch(r){case"modfreq":case"modulationfrequency":rn(i)&&s.source.synth.set({oscillator:{modulationFrequency:i}});return}break;case"pulse":if(r==="width"){rn(i)&&s.source.synth.set({oscillator:{width:i}});return}break;case"custom":case"sine":case"square":case"triangle":case"sawtooth":if(r==="phase"){rn(i)&&s.source.synth.set({oscillator:{phase:i}});return}break;case"amcustom":case"amsine":case"amsquare":case"amtriangle":case"amsawtooth":switch(r){case"harmonicity":rn(i)&&s.source.synth.set({oscillator:{harmonicity:i}});return;case"modtype":case"modulationtype":un(i)&&s.source.synth.set({oscillator:{modulationType:i}});return;case"modenv":case"modulationenvelope":if(sr(i)){const[a,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:a,decay:c,sustain:l,release:u}}})}break}break;case"fmcustom":case"fmsine":case"fmsquare":case"fmtriangle":case"fmsawtooth":switch(r){case"harmonicity":rn(i)&&s.source.synth.set({oscillator:{harmonicity:i}});return;case"modindex":rn(i)&&s.source.synth.set({oscillator:{modulationIndex:i}});return;case"modtype":un(i)&&s.source.synth.set({oscillator:{modulationType:i}});return;case"modenv":if(sr(i)){const[a,c,l,u]=i;s.source.synth.set({oscillator:{modulationEnvelope:{attack:a,decay:c,sustain:l,release:u}}})}break}break;case"fatcustom":case"fatsine":case"fatsquare":case"fattriangle":case"fatsawtooth":switch(r){case"count":rn(i)&&s.source.synth.set({oscillator:{count:i}});return;case"phase":rn(i)&&s.source.synth.set({oscillator:{phase:i}});return;case"spread":rn(i)&&s.source.synth.set({oscillator:{spread:i}});return}break}return}case oi.ALGO_SYNTH:if(wze(n,s,r,i))return;break}_r(qe,n,"synth",`unknown config ${r}`)}break}}function Mze(n,e,t,r,i){if(!he(e)||t<0||t>=e.FX.length){_r(qe,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.autofilter;switch(r){case"type":if(un(i)){s.set({filter:{type:i}});return}break;case"q":if(rn(i)){s.set({filter:{Q:i}});return}break;case"depth":if(rn(i)){s.set({depth:i});return}break;case"frequency":if(rn(i)){s.set({frequency:i});return}break;case"octaves":if(rn(i)){s.set({octaves:i});return}break}_r(qe,n,"kind",`unknown autofilter ${r} or ${i}`)}function Ize(n,e,t,r,i){if(!he(e))return;if(t<0||t>=e.FX.length){_r(qe,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.autowah;switch(r){case"basefrequency":if(rn(i)){s.set({baseFrequency:i});return}break;case"octaves":if(rn(i)){s.set({octaves:i});return}break;case"sensitivity":if(rn(i)){s.set({sensitivity:i});return}break;case"gain":if(rn(i)){s.set({gain:i});return}break;case"follower":if(rn(i)){s.set({follower:i});return}break}_r(qe,n,"synth",`unknown autowah config ${r} with ${i}`)}function Oze(n,e,t,r,i){if(!he(e)||t<0||t>=e.FX.length){_r(qe,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.distortion;switch(r){case"distortion":if(rn(i)){s.set({distortion:i});return}break;case"oversample":if(un(i)){s.set({oversample:i});return}break}_r(qe,n,"kind",`unknown distortion ${r} or ${i}`)}function Nze(n,e,t,r,i){if(!he(e)||t<0||t>=e.FX.length){_r(qe,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.echo;switch(r){case"delaytime":if(rn(i)){s.set({delayTime:i});return}break;case"feedback":if(rn(i)){s.set({feedback:i});return}break}_r(qe,n,"kind",`unknown echo ${r} or ${i}`)}function Pze(n,e,t,r,i){if(!he(e)||t<0||t>=e.FX.length){_r(qe,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.fcrush;switch(r){case"rate":if(rn(i)){s.set({rate:i});return}break}_r(qe,n,"kind",`unknown fcrush ${r} or ${i}`)}function Dze(n,e,t,r,i){if(!he(e)||t<0||t>=e.FX.length){_r(qe,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.reverb;switch(r){case"decay":if(rn(i)){s.set({decay:i});return}break;case"predelay":if(rn(i)){s.set({preDelay:i});return}break}_r(qe,n,"kind",`unknown reverb ${r} or ${i}`)}function Lze(n,e,t,r,i){if(!he(e))return;if(t<0||t>=e.FX.length){_r(qe,n,"synth",`index ${t} out of bounds`);return}const s=e.FXCHAIN.vibrato;switch(r){case"maxdelay":if(rn(i)){s.set({maxDelay:i});return}break}_r(qe,n,"synth",`unknown vibrato config ${r} with ${i}`)}function Uze(n,e,t,r,i,s){if(!he(e))return;if(t<0||t>=e.FX.length){_r(qe,n,"synth",`index ${t} out of bounds`);return}const o=e.FX[t][r];if(he(o)){switch(i){case"on":switch(r){case"vibrato":case"autofilter":o.volume.value=ua(80);break;default:o.volume.value=ua(30);break}break;case"off":o.volume.value=ua(0);break;default:if(rn(i))o.volume.value=ua(i);else switch(r){case"fc":case"fcrush":Pze(n,e,t,i,s);break;case"echo":Nze(n,e,t,i,s);break;case"autofilter":Mze(n,e,t,i,s);break;case"reverb":Dze(n,e,t,i,s);break;case"distort":case"distortion":Oze(n,e,t,i,s);break;case"vibrato":Lze(n,e,t,i,s);break;case"autowah":Ize(n,e,t,i,s);break}break}return}_r(qe,n,"synth",`unknown fx ${r}`)}let ak=Promise,_re=n=>{let e=0,t=0,r,i,s,o,a,c=()=>{e--,--t?l():o=s?.()},l=()=>{if(r&&e<n){e++;let u=r;r=r.a,u.p().then(h=>(u.c(h),c()),h=>(u.b(h),c()))}};return a={add(u){let h={p:u},f=new ak((d,p)=>{h.c=d,h.b=p});return r?i=i.a=h:i=r=h,t++,l(),f},done:()=>t?o||(o=new ak(u=>s=u)):ak.resolve(),clear(){for(let u=r;u;u=u.a)u.b(new Error("Queue cleared"));r=i=null,t=e},active:()=>e,size:()=>t,all:u=>ak.all(u.map(h=>a.add(typeof h=="function"?h:()=>h)))}},tB="piper",vre="";function Bze(n,e){tB=n,vre=e}function Fze(n){return xo().decodeAudioData(n)}async function yre(n,e,t){return new Promise(r=>{const i=mg(Yo(),[],s=>{s.target==="heavy:ttsrequest"&&s.data&&Fze(s.data).then(r).catch(console.error),i.disconnect()},qe.session());NEe(i,n,tB,vre,e,t)})}function jze(n,e){return new Promise(t=>{const r=mg(Yo(),[],i=>{i.target==="heavy:ttsinfo"&&i.data&&t(i.data),r.disconnect()},qe.session());OEe(r,n,tB,e)})}async function zze(n,e,t){if(t.trim()==="")return;const r=await yre(n,e,t);he(r)&&zY(qe,n,r)}const bre=_re(1);async function $ze(n,e){zY(qe,n,e);const t=Math.max(1e3,Math.round(e.duration*1e3));await mh(t)}const Sre=_re(1);async function Vze(n,e,t){const r=await yre(n,e,t);bre.add(async()=>{he(r)&&await $ze(n,r)}).catch(console.error)}function Hze(n,e,t){Sre.add(async()=>{await Vze(n,e,t)}).catch(console.error)}function Gze(){bre.clear(),Sre.clear()}const Wze=Date.now(),Ma={get value(){return(Date.now()-Wze)/1e3%1e6}},qze=120;let Ere=0;function xre(n){Ere=qze/n}const Yze=136;xre(Yze);const uT={get value(){return Ere}};function cy(n){const e=n.clone();return e.uniforms.time=Ma,e.uniforms.interval=uT,e}let ck=!1,rM=!1;function GC(){rM||ck||(ck=!0,NI(new sT({latencyHint:"playback"}),!0),u7e().then(()=>{if(!rM){try{const n=navigator;he(n.audioSession)&&(n.audioSession.type="playback")}catch{}return mre().then(()=>{ck=!1,rM=!0,UEe(D0,ii())})}}).catch(n=>{ck=!1,_r(D0,ii(),"audio",n.toString())}))}let sl;function Kze(){return sl?.broadcastdestination}const D0=mg("synth",[],n=>{if(!D0.session(n)||(rM&&!he(sl)&&(sl=gre(),D4().start()),!he(sl)))return;const e=ii();switch(n.target){case"audioenabled":if(n.player!==e)return;break}const t=Qr.getState().gadget.board;switch(n.target){case"audioenabled":fs(D0,n.player,"audio is enabled!"),oo(D0,n.player,async()=>{await mh(2e3),Th(D0,n.player,void 0,"text","audio:enabled","")});break;case"bpm":if(rn(n.data)){const r=Math.round(n.data);sl.setbpm(r),xre(r)}break;case"playvolume":rn(n.data)&&sl.setplayvolume(n.data);break;case"bgplayvolume":rn(n.data)&&sl.setbgplayvolume(n.data);break;case"ttsvolume":rn(n.data)&&sl.setttsvolume(n.data);break;case"audiobuffer":he(n.data)&&sl.addaudiobuffer(n.data);break;case"play":if(sr(n.data)){const[r,i]=n.data;(r===""||r===t)&&(i.trim()===""?sl.stopplay():sl.addplay(i))}break;case"bgplay":if(sr(n.data)){const[r,i,s]=n.data;(r===""||r===t)&&sl.addbgplay(i,s)}break;case"restart":sl?.applyreset();break;case"voice":if(sr(n.data)){const[r,i,s]=n.data;kze(n.player,sl,r,i,s)}break;case"voicefx":if(sr(n.data)){const[r,i,s,o]=n.data;Uze(n.player,sl,r,i,s,o)}break;case"record":un(n.data)&&sl.synthrecord(n.data);break;case"flush":sl.synthflush();break;case"tts":oo(D0,n.player,async()=>{if(sr(n.data)){const[r,i,s]=n.data;s.trim()!==""&&(r===""||r===t)&&await zze(n.player,i,s)}});break;case"ttsinfo":oo(D0,n.player,async()=>{if(un(n.data)){const r=await jze(n.player,n.data);if(sr(r))for(let i=0;i<r.length;i++)zr(D0,n.player,`$WHITE${r[i]}`)}});break;case"ttsengine":if(sr(n.data)){const[r,i]=n.data;Bze(r,i)}break;case"ttsqueue":if(sr(n.data)){const[r,i,s]=n.data;s.trim()!==""&&(r===""||r===t)&&Hze(n.player,i,s)}break;case"ttsclearqueue":Gze();break}});function UI(){return UI=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},UI.apply(null,arguments)}var Xze=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.01,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*i)/t)},Zze=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function cl(n,e,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:.25,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.01,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1/0,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Zze,a=arguments.length>7&&arguments[7]!==void 0?arguments[7]:.001,c="velocity_"+e;if(n.__damp===void 0&&(n.__damp={}),n.__damp[c]===void 0&&(n.__damp[c]=0),Math.abs(n[e]-t)<=a)return n[e]=t,!1;r=Math.max(1e-4,r);var l=2/r,u=o(l*i),h=n[e]-t,f=t,d=s*r;h=Math.min(Math.max(h,-d),d),t=n[e]-h;var p=(n.__damp[c]+l*h)*i;n.__damp[c]=(n.__damp[c]-l*p)*u;var m=t+(h+p)*u;return f-n[e]>0==m>f&&(m=f,n.__damp[c]=(m-f)/i),n[e]=m,!0}function X2(n,e,t,r,i,s,o,a){return cl(n,e,n[e]+FSe(n[e],t),r,i,s,o,a)}var iE=new zt,lH,uH,hH;function Yv(n,e,t,r,i,s,o){return typeof e=="number"?iE.setScalar(e):Array.isArray(e)?iE.set(e[0],e[1],e[2]):iE.copy(e),lH=cl(n,"x",iE.x,t,r,i,s,o),uH=cl(n,"y",iE.y,t,r,i,s,o),hH=cl(n,"z",iE.z,t,r,i,s,o),lH||uH||hH}var sw=new Xm,fH,dH,pH;function B4(n,e,t,r,i,s,o){return Array.isArray(e)?sw.set(e[0],e[1],e[2],e[3]):sw.copy(e),fH=X2(n,"x",sw.x,t,r,i,s,o),dH=X2(n,"y",sw.y,t,r,i,s,o),pH=X2(n,"z",sw.z,t,r,i,s,o),fH||dH||pH}const mH=n=>Symbol.iterator in n,gH=n=>"entries"in n,_H=(n,e)=>{const t=n instanceof Map?n:new Map(n.entries()),r=e instanceof Map?e:new Map(e.entries());if(t.size!==r.size)return!1;for(const[i,s]of t)if(!r.has(i)||!Object.is(s,r.get(i)))return!1;return!0},Jze=(n,e)=>{const t=n[Symbol.iterator](),r=e[Symbol.iterator]();let i=t.next(),s=r.next();for(;!i.done&&!s.done;){if(!Object.is(i.value,s.value))return!1;i=t.next(),s=r.next()}return!!i.done&&!!s.done};function Qze(n,e){return Object.is(n,e)?!0:typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e)?!1:mH(n)&&mH(e)?gH(n)&&gH(e)?_H(n,e):Jze(n,e):_H({entries:()=>Object.entries(n)},{entries:()=>Object.entries(e)})}function Ph(n){const e=yh.useRef(void 0);return t=>{const r=n(t);return Qze(e.current,r)?e.current:e.current=r}}function Tre(n,e,t){const r=jc(d=>d.size),i=jc(d=>d.viewport),s=typeof n=="number"?n:r.width*i.dpr,o=typeof e=="number"?e:r.height*i.dpr,a=(typeof n=="number"?t:n)||{},{samples:c=0,depth:l,...u}=a,h=l??a.depthBuffer,f=Ke.useMemo(()=>{const d=new hl(s,o,{minFilter:Bl,magFilter:Bl,type:Zv,...u});return h&&(d.depthTexture=new rO(s,o,dp)),d.samples=c,d},[]);return Ke.useLayoutEffect(()=>{f.setSize(s,o),c&&(f.samples=c)},[c,f,s,o]),Ke.useEffect(()=>()=>f.dispose(),[]),f}const e$e=n=>typeof n=="function",t$e=Ke.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,children:r,makeDefault:i,...s},o)=>{const a=jc(({set:_})=>_),c=jc(({camera:_})=>_),l=jc(({size:_})=>_),u=Ke.useRef(null);Ke.useImperativeHandle(o,()=>u.current,[]);const h=Ke.useRef(null),f=Tre(e);Ke.useLayoutEffect(()=>{s.manual||u.current.updateProjectionMatrix()},[l,s]),Ke.useLayoutEffect(()=>{u.current.updateProjectionMatrix()}),Ke.useLayoutEffect(()=>{if(i){const _=c;return a(()=>({camera:u.current})),()=>a(()=>({camera:_}))}},[u,i,a]);let d=0,p=null;const m=e$e(r);return s_(_=>{m&&(t===1/0||d<t)&&(h.current.visible=!1,_.gl.setRenderTarget(f),p=_.scene.background,n&&(_.scene.background=n),_.gl.render(_.scene,u.current),_.scene.background=p,_.gl.setRenderTarget(null),h.current.visible=!0,d++)}),Ke.createElement(Ke.Fragment,null,Ke.createElement("orthographicCamera",UI({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:u},s),!m&&r),Ke.createElement("group",{ref:h},m&&r(f.texture)))});var iM={exports:{}},n$e=iM.exports,vH;function r$e(){return vH||(vH=1,(function(n,e){(function(t,r){n.exports=r()})(n$e,function(){var t=function(){function r(d){return o.appendChild(d.dom),d}function i(d){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===d?"block":"none";s=d}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),i(++s%o.children.length)},!1);var a=(performance||Date).now(),c=a,l=0,u=r(new t.Panel("FPS","#0ff","#002")),h=r(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=r(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:r,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){l++;var d=(performance||Date).now();if(h.update(d-a,200),d>c+1e3&&(u.update(1e3*l/(d-c),100),c=d,l=0,f)){var p=performance.memory;f.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:o,setMode:i}};return t.Panel=function(r,i,s){var o=1/0,a=0,c=Math.round,l=c(window.devicePixelRatio||1),u=80*l,h=48*l,f=3*l,d=2*l,p=3*l,m=15*l,_=74*l,v=30*l,S=document.createElement("canvas");S.width=u,S.height=h,S.style.cssText="width:80px;height:48px";var b=S.getContext("2d");return b.font="bold "+9*l+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=s,b.fillRect(0,0,u,h),b.fillStyle=i,b.fillText(r,f,d),b.fillRect(p,m,_,v),b.fillStyle=s,b.globalAlpha=.9,b.fillRect(p,m,_,v),{dom:S,update:function(T,w){o=Math.min(o,T),a=Math.max(a,T),b.fillStyle=s,b.globalAlpha=1,b.fillRect(0,0,u,m),b.fillStyle=i,b.fillText(c(T)+" "+r+" ("+c(o)+"-"+c(a)+")",f,d),b.drawImage(S,p+l,m,_-l,v,p,m,_-l,v),b.fillRect(p+_-l,m,l,v),b.fillStyle=s,b.globalAlpha=.9,b.fillRect(p+_-l,m,l,c((1-T/w)*v))}}},t})})(iM)),iM.exports}var i$e=r$e();const s$e=wu(i$e);function Z2(n,e,t,r){return new(t||(t=Promise))((function(i,s){function o(l){try{c(r.next(l))}catch(u){s(u)}}function a(l){try{c(r.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?i(l.value):(u=l.value,u instanceof t?u:new t((function(h){h(u)}))).then(o,a)}c((r=r.apply(n,[])).next())}))}const o$e=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function yH(n){return n=n.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const wre=typeof window>"u",wm=(()=>{if(wre)return;const{userAgent:n,platform:e,maxTouchPoints:t}=window.navigator,r=/(iphone|ipod|ipad)/i.test(n),i=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(n)||r||i,isSafari12:/Version\/12.+Safari/.test(n),isFirefox:/Firefox/.test(n)}})();function a$e(n,e,t){if(!t)return[e];const r=(function(l){const u=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,h=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,f=l.createShader(35633),d=l.createShader(35632),p=l.createProgram();if(!(d&&f&&p))return;l.shaderSource(f,u),l.shaderSource(d,h),l.compileShader(f),l.compileShader(d),l.attachShader(p,f),l.attachShader(p,d),l.linkProgram(p),l.detachShader(p,f),l.detachShader(p,d),l.deleteShader(f),l.deleteShader(d),l.useProgram(p);const m=l.createBuffer();l.bindBuffer(34962,m),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const _=l.getAttribLocation(p,"aPosition");l.vertexAttribPointer(_,3,5126,!1,0,0),l.enableVertexAttribArray(_),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const v=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,v),l.deleteProgram(p),l.deleteBuffer(m),v.join("")})(n),i="801621810",s="8016218135",o="80162181161",a=wm?.isIpad?[["a7",o,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",i,15],["a12x",i,15],["a12z",i,15],["a14",i,15],["a15",i,15],["m1",i,15],["m2",i,15]]:[["a7",o,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",i,15],["a12",i,15],["a13",i,15],["a14",i,15],["a15",i,15],["a16",i,15],["a17",i,15]];let c;return r==="80162181255"?c=a.filter((([,,l])=>l>=14)):(c=a.filter((([,l])=>l===r)),c.length||(c=a)),c.map((([l])=>`apple ${l} gpu`))}class bH extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const J2=[],SH=[];function c$e(n,e){if(n===e)return 0;const t=n;n.length>e.length&&(n=e,e=t);let r=n.length,i=e.length;for(;r>0&&n.charCodeAt(~-r)===e.charCodeAt(~-i);)r--,i--;let s,o=0;for(;o<r&&n.charCodeAt(o)===e.charCodeAt(o);)o++;if(r-=o,i-=o,r===0)return i;let a,c,l=0,u=0,h=0;for(;u<r;)SH[u]=n.charCodeAt(o+u),J2[u]=++u;for(;h<i;)for(s=e.charCodeAt(o+h),a=h++,l=h,u=0;u<r;u++)c=s===SH[u]?a:a+1,a=J2[u],l=J2[u]=a>l?c>l?l+1:c:c>a?a+1:c;return l}function l$e(n){return n!=null}const u$e=({mobileTiers:n=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:r,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>Z2(void 0,void 0,void 0,(function*(){const o={};if(wre)return{tier:0,type:"SSR"};const{isIpad:a=!!wm?.isIpad,isMobile:c=!!wm?.isMobile,screenSize:l=window.screen,loadBenchmarks:u=(w=>Z2(void 0,void 0,void 0,(function*(){const R=yield fetch(`${s}/${w}`).then((C=>C.json()));if(parseInt(R.shift().split(".")[0],10)<4)throw new bH("Detect GPU benchmark data is out of date. Please update to version 4x");return R})))}=t;let{renderer:h}=t;const f=(w,R,C,N,U)=>({device:U,fps:N,gpu:C,isMobile:c,tier:w,type:R});let d,p="";if(h)h=yH(h),d=[h];else{const w=r||(function(C,N=!1){const U={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:N,powerPreference:"high-performance",stencil:!1};C&&delete U.powerPreference;const B=window.document.createElement("canvas"),$=B.getContext("webgl",U)||B.getContext("experimental-webgl",U);return $??void 0})(wm?.isSafari12,i);if(!w)return f(0,"WEBGL_UNSUPPORTED");const R=wm?.isFirefox?null:w.getExtension("WEBGL_debug_renderer_info");if(h=R?w.getParameter(R.UNMASKED_RENDERER_WEBGL):w.getParameter(w.RENDERER),!h)return f(1,"FALLBACK");p=h,h=yH(h),d=(function(C,N,U){return N==="apple gpu"?a$e(C,N,U):[N]})(w,h,c)}const m=(yield Promise.all(d.map((function(w){var R;return Z2(this,void 0,void 0,(function*(){const C=(ee=>{const te=c?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const ie of te)if(ee.includes(ie))return ie})(w);if(!C)return;const N=`${c?"m":"d"}-${C}${a?"-ipad":""}.json`,U=o[N]=(R=o[N])!==null&&R!==void 0?R:u(N);let B;try{B=yield U}catch(ee){if(ee instanceof bH)throw ee;return}const $=(function(ee){var te;const ie=(ee=ee.replace(/\([^)]+\)/,"")).match(/\d+/)||ee.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(te=ie?.join("").replace(/\W|amd/g,""))!==null&&te!==void 0?te:""})(w);let I=B.filter((([,ee])=>ee===$));I.length||(I=B.filter((([ee])=>ee.includes(w))));const L=I.length;if(L===0)return;const P=w.split(/[.,()\[\]/\s]/g).sort().filter(((ee,te,ie)=>te===0||ee!==ie[te-1])).join(" ");let H,[X,,,,G]=L>1?I.map((ee=>[ee,c$e(P,ee[2])])).sort((([,ee],[,te])=>ee-te))[0][0]:I[0],Y=Number.MAX_VALUE;const{devicePixelRatio:J}=window,Q=l.width*J*l.height*J;for(const ee of G){const[te,ie]=ee,Ee=te*ie,Re=Math.abs(Q-Ee);Re<Y&&(Y=Re,H=ee)}if(!H)return;const[,,z,q]=H;return[Y,z,X,q]}))})))).filter(l$e).sort((([w=Number.MAX_VALUE,R],[C=Number.MAX_VALUE,N])=>w===C?R-N:w-C));if(!m.length){const w=o$e.find((R=>h.includes(R)));return w?f(0,"BLOCKLISTED",w):f(1,"FALLBACK",`${h} (${p})`)}const[,_,v,S]=m[0];if(_===-1)return f(0,"BLOCKLISTED",v,_,S);const b=c?n:e;let T=0;for(let w=0;w<b.length;w++)_>=b[w]&&(T=w);return f(T,"BENCHMARK",v,_,S)})),h$e=n=>LW(()=>u$e(n),["useDetectGPU"]);function f$e(n,e){const t=n+"Geometry";return Ke.forwardRef(({args:r,children:i,...s},o)=>{const a=Ke.useRef(null);return Ke.useImperativeHandle(o,()=>a.current),Ke.useLayoutEffect(()=>{e?.(a.current)}),Ke.createElement("mesh",UI({ref:a},s),Ke.createElement(t,{attach:"geometry",args:r}),i)})}const d$e=f$e("plane");var Q2=1/1e3,p$e=1e3,m$e=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*Q2}get fixedDelta(){return this._fixedDelta*Q2}set fixedDelta(n){this._fixedDelta=n*p$e}get elapsed(){return this._elapsed*Q2}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},g$e=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new ag;return t.setAttribute("position",new Eh(n,3)),t.setAttribute("uv",new Eh(e,2)),t})(),Dh=class F4{static get fullscreenGeometry(){return g$e}constructor(e="Pass",t=new SM,r=new iO){this.name=e,this.renderer=null,this.scene=t,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new df(F4.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new SM),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=d1){}render(e,t,r,i,s){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,r){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof hl||t instanceof m1||t instanceof pc||t instanceof F4)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},_$e=class extends Dh{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,r,i){const s=n.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},v$e=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,WC="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",Are=class extends lo{constructor(){super({name:"CopyMaterial",defines:{COLOR_SPACE_CONVERSION:"1",DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new hn(null),depthBuffer:new hn(null),channelWeights:new hn(null),opacity:new hn(1)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:v$e,vertexShader:WC}),this.depthFunc=_M}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(n){const e=n!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){const e=n!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}get colorSpaceConversion(){return this.defines.COLOR_SPACE_CONVERSION!==void 0}set colorSpaceConversion(n){this.colorSpaceConversion!==n&&(n?this.defines.COLOR_SPACE_CONVERSION=!0:delete this.defines.COLOR_SPACE_CONVERSION,this.needsUpdate=!0)}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(n){n!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=n):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},Cre=class extends Dh{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new Are,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new hl(1,1,{minFilter:Bl,magFilter:Bl,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,r,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==Oo?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Fi&&(this.renderTarget.texture.colorSpace=Fi))}},EH=new Ti,Rre=class extends Dh{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,r,i){const s=this.overrideClearColor,o=this.overrideClearAlpha,a=n.getClearAlpha(),c=s!==null,l=o>=0;c?(n.getClearColor(EH),n.setClearColor(s,l?o:a)):l&&n.setClearAlpha(o),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),c?n.setClearColor(EH,a):l&&n.setClearAlpha(a)}},y$e=class extends Dh{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new Rre(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,r,i){const s=n.getContext(),o=n.state.buffers,a=this.scene,c=this.camera,l=this.clearPass,u=this.inverted?0:1,h=1-u;o.color.setMask(!1),o.depth.setMask(!1),o.color.setLocked(!0),o.depth.setLocked(!0),o.stencil.setTest(!0),o.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),o.stencil.setFunc(s.ALWAYS,u,4294967295),o.stencil.setClear(h),o.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,c)):(n.setRenderTarget(e),n.render(a,c),n.setRenderTarget(t),n.render(a,c)),o.color.setLocked(!1),o.depth.setLocked(!1),o.stencil.setLocked(!1),o.stencil.setFunc(s.EQUAL,1,4294967295),o.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),o.stencil.setLocked(!0)}},kre=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:r=!1,multisampling:i=0,frameBufferType:s}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,r,s,i),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new Cre,this.depthTexture=null,this.passes=[],this.timer=new m$e,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){const t=this.inputBuffer,r=this.multisampling;r>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):r!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){const t=e.getSize(new zn),r=e.getContext().getContextAttributes().alpha,i=this.inputBuffer.texture.type;i===Oo&&e.outputColorSpace===Fi&&(this.inputBuffer.texture.colorSpace=Fi,this.outputBuffer.texture.colorSpace=Fi,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(const s of this.passes)s.initialize(e,r,i)}}replaceRenderer(e,t=!0){const r=this.renderer,i=r.domElement.parentNode;return this.setRenderer(e),t&&i!==null&&(i.removeChild(r.domElement),i.appendChild(e.domElement)),r}createDepthTexture(){const e=this.depthTexture=new rO;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=tx,e.type=ex):e.type=jv,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,r,i){const s=this.renderer,o=s===null?new zn:s.getDrawingBufferSize(new zn),a={minFilter:Bl,magFilter:Bl,stencilBuffer:t,depthBuffer:e,type:r},c=new hl(o.width,o.height,a);return i>0&&(c.samples=i),r===Oo&&s!==null&&s.outputColorSpace===Fi&&(c.texture.colorSpace=Fi),c.texture.name="EffectComposer.Buffer",c.texture.generateMipmaps=!1,c}setMainScene(e){for(const t of this.passes)t.mainScene=e}setMainCamera(e){for(const t of this.passes)t.mainCamera=e}addPass(e,t){const r=this.passes,i=this.renderer,s=i.getDrawingBufferSize(new zn),o=i.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(i),e.setSize(s.width,s.height),e.initialize(i,o,a),this.autoRenderToScreen&&(r.length>0&&(r[r.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?r.splice(t,0,e):r.push(e),this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const c=this.createDepthTexture();for(e of r)e.setDepthTexture(c)}else e.setDepthTexture(this.depthTexture)}removePass(e){const t=this.passes,r=t.indexOf(e);if(r!==-1&&t.splice(r,1).length>0){if(this.depthTexture!==null){const o=(c,l)=>c||l.needsDepthTexture;t.reduce(o,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&r===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){const e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){const t=this.renderer,r=this.copyPass;let i=this.inputBuffer,s=this.outputBuffer,o=!1,a,c,l;e===void 0&&(this.timer.update(),e=this.timer.getDelta());for(const u of this.passes)u.enabled&&(u.render(t,i,s,e,o),u.needsSwap&&(o&&(r.renderToScreen=u.renderToScreen,a=t.getContext(),c=t.state.buffers.stencil,c.setFunc(a.NOTEQUAL,1,4294967295),r.render(t,i,s,e,o),c.setFunc(a.EQUAL,1,4294967295)),l=i,i=s,s=l),u instanceof y$e?o=!0:u instanceof _$e&&(o=!1))}setSize(e,t,r){const i=this.renderer,s=i.getSize(new zn);(e===void 0||t===void 0)&&(e=s.width,t=s.height),(s.width!==e||s.height!==t)&&i.setSize(e,t,r);const o=i.getDrawingBufferSize(new zn);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Dh.fullscreenGeometry.dispose()}},Su={NONE:0,DEPTH:1,CONVOLUTION:2},ts={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},b$e=class{constructor(){this.shaderParts=new Map([[ts.FRAGMENT_HEAD,null],[ts.FRAGMENT_MAIN_UV,null],[ts.FRAGMENT_MAIN_IMAGE,null],[ts.VERTEX_HEAD,null],[ts.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Su.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=Z0}},eD=!1,xH=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Ia:t=this.materialsFlatShadedDoubleSide;break;case Uc:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Ia:t=this.materialsDoubleSide;break;case Uc:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof lo))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const s=e[i].value;s.isRenderTargetTexture&&(e[i].value=null,t.set(i,s))}const r=n.clone();for(const i of t)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=X0;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=Uc,r}),this.materialsDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=Ia,r}),this.materialsFlatShaded=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=Uc,r}),this.materialsFlatShadedDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=Ia,r})}}render(n,e,t){const r=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,eD){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const s of i)s[0].material=s[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return eD}static set workaroundEnabled(n){eD=n}},gv=-1,pf=class extends i_{constructor(n,e=gv,t=gv,r=1){super(),this.resizable=n,this.baseSize=new zn(1,1),this.preferredSize=new zn(e,t),this.target=this.preferredSize,this.s=r,this.effectiveSize=new zn,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,r=this.scale;e.width!==gv?t.width=e.width:e.height!==gv?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*r),e.height!==gv?t.height=e.height:e.width!==gv?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*r)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(gv),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return gv}},di={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},S$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",E$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,src.a*opacity);}",x$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=(dst.rgb+src.rgb)*0.5;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",T$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.xy,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",w$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/max(b,1e-9))),vec3(1.0),step(1.0,a));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",A$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",C$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",R$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=abs(dst.rgb-src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",k$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb/max(src.rgb,1e-9);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",M$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-2.0*dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",I$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb,1.0);vec3 b=min(src.rgb,1.0);vec3 c=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",O$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=step(1.0,dst.rgb+src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",N$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.x,a.yz));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",P$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",D$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=src.rgb*max(1.0-dst.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",L$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",U$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",B$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb+src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",F$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(2.0*src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",j$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.xy,b.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",z$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",$$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-abs(1.0-dst.rgb-src.rgb),0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",V$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,opacity);}",H$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=2.0*src.rgb*dst.rgb;vec3 b=1.0-2.0*(1.0-src.rgb)*(1.0-dst.rgb);vec3 c=mix(a,b,step(0.5,dst.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",G$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 c=mix(mix(src2,dst.rgb,step(0.5*dst.rgb,src.rgb)),max(src2-1.0,vec3(0.0)),step(dst.rgb,src2-1.0));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",W$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb*dst.rgb/max(1.0-src.rgb,1e-9),1.0);vec3 c=mix(a,src.rgb,step(1.0,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",q$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.x,b.y,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Y$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-min(dst.rgb*src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",K$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 d=dst.rgb+(src2-1.0);vec3 w=step(0.5,src.rgb);vec3 a=dst.rgb-(1.0-src2)*dst.rgb*(1.0-dst.rgb);vec3 b=mix(d*(sqrt(dst.rgb)-dst.rgb),d*dst.rgb*((16.0*dst.rgb-12.0)*dst.rgb+3.0),w*(1.0-step(0.25,dst.rgb)));vec3 c=mix(a,b,w);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",X$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return src;}",Z$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",J$e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=mix(max(1.0-min((1.0-dst.rgb)/(2.0*src.rgb),1.0),0.0),min(dst.rgb/(2.0*(1.0-src.rgb)),1.0),step(0.5,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Q$e=new Map([[di.ADD,S$e],[di.ALPHA,E$e],[di.AVERAGE,x$e],[di.COLOR,T$e],[di.COLOR_BURN,w$e],[di.COLOR_DODGE,A$e],[di.DARKEN,C$e],[di.DIFFERENCE,R$e],[di.DIVIDE,k$e],[di.DST,null],[di.EXCLUSION,M$e],[di.HARD_LIGHT,I$e],[di.HARD_MIX,O$e],[di.HUE,N$e],[di.INVERT,P$e],[di.INVERT_RGB,D$e],[di.LIGHTEN,L$e],[di.LINEAR_BURN,U$e],[di.LINEAR_DODGE,B$e],[di.LINEAR_LIGHT,F$e],[di.LUMINOSITY,j$e],[di.MULTIPLY,z$e],[di.NEGATION,$$e],[di.NORMAL,V$e],[di.OVERLAY,H$e],[di.PIN_LIGHT,G$e],[di.REFLECT,W$e],[di.SATURATION,q$e],[di.SCREEN,Y$e],[di.SOFT_LIGHT,K$e],[di.SRC,X$e],[di.SUBTRACT,Z$e],[di.VIVID_LIGHT,J$e]]),eVe=class extends i_{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new hn(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return Q$e.get(this.blendFunction)}},yd=class extends i_{constructor(n,e,{attributes:t=Su.NONE,blendFunction:r=di.NORMAL,defines:i=new Map,uniforms:s=new Map,extensions:o=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=i,this.uniforms=s,this.extensions=o,this.blendMode=new eVe(r),this.blendMode.addEventListener("change",c=>this.setChanged()),this._inputColorSpace=Z0,this._outputColorSpace=Pm}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=d1){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof hl||e instanceof m1||e instanceof pc||e instanceof Dh)&&this[n].dispose()}}},qC={MEDIUM:2,LARGE:3,VERY_LARGE:4},tVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,nVe="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",rVe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],iVe=class extends lo{constructor(n=new Xo){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new hn(null),texelSize:new hn(new Xo),scale:new hn(1),kernel:new hn(0)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:tVe,vertexShader:nVe}),this.setTexelSize(n.x,n.y),this.kernelSize=qC.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return rVe[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,r=1/e;this.uniforms.texelSize.value.set(t,r,t*.5,r*.5)}},Mre=class extends Dh{constructor({kernelSize:n=qC.MEDIUM,resolutionScale:e=.5,width:t=pf.AUTO_SIZE,height:r=pf.AUTO_SIZE,resolutionX:i=t,resolutionY:s=r}={}){super("KawaseBlurPass"),this.renderTargetA=new hl(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const o=this.resolution=new pf(this,i,s,e);o.addEventListener("change",a=>this.setSize(o.baseWidth,o.baseHeight)),this._blurMaterial=new iVe,this._blurMaterial.kernelSize=n,this.copyMaterial=new Are}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,r,i){const s=this.scene,o=this.camera,a=this.renderTargetA,c=this.renderTargetB,l=this.blurMaterial,u=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let f=0,d=u.length;f<d;++f){const p=(f&1)===0?a:c;l.kernel=u[f],l.inputBuffer=h.texture,n.setRenderTarget(p),n.render(s,o),h=p}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(s,o)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const r=t.width,i=t.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==Oo?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===Fi&&(this.renderTargetA.texture.colorSpace=Fi,this.renderTargetB.texture.colorSpace=Fi))}static get AUTO_SIZE(){return pf.AUTO_SIZE}},sVe=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,oVe=class extends lo{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:YA.replace(/\D+/g,"")},uniforms:{inputBuffer:new hn(null),threshold:new hn(0),smoothing:new hn(1),range:new hn(null)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:sVe,vertexShader:WC}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},aVe=class extends Dh{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:r=1,width:i=pf.AUTO_SIZE,height:s=pf.AUTO_SIZE,resolutionX:o=i,resolutionY:a=s}={}){super("LuminancePass"),this.fullscreenMaterial=new oVe(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new hl(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const c=this.resolution=new pf(this,o,a,r);c.addEventListener("change",l=>this.setSize(c.baseWidth,c.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,r,i){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==Oo&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},cVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,lVe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",uVe=class extends lo{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new hn(null),texelSize:new hn(new zn)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:cVe,vertexShader:lVe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},hVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,fVe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",dVe=class extends lo{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new hn(null),supportBuffer:new hn(null),texelSize:new hn(new zn),radius:new hn(.85)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:hVe,vertexShader:fVe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},pVe=class extends Dh{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new hl(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new uVe,this.upsamplingMaterial=new dVe,this.resolution=new zn}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const r=e.clone();r.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(r)}this.upsamplingMipmaps.push(e);for(let t=1,r=n-1;t<r;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,r,i){const{scene:s,camera:o}=this,{downsamplingMaterial:a,upsamplingMaterial:c}=this,{downsamplingMipmaps:l,upsamplingMipmaps:u}=this;let h=e;this.fullscreenMaterial=a;for(let f=0,d=l.length;f<d;++f){const p=l[f];a.setSize(h.width,h.height),a.inputBuffer=h.texture,n.setRenderTarget(p),n.render(s,o),h=p}this.fullscreenMaterial=c;for(let f=u.length-1;f>=0;--f){const d=u[f];c.setSize(h.width,h.height),c.inputBuffer=h.texture,c.supportBuffer=l[f].texture,n.setRenderTarget(d),n.render(s,o),h=d}}setSize(n,e){const t=this.resolution;t.set(n,e);let r=t.width,i=t.height;for(let s=0,o=this.downsamplingMipmaps.length;s<o;++s)r=Math.round(r*.5),i=Math.round(i*.5),this.downsamplingMipmaps[s].setSize(r,i),s<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[s].setSize(r,i)}initialize(n,e,t){if(t!==void 0){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of r)i.texture.type=t;if(t!==Oo)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===Fi)for(const i of r)i.texture.colorSpace=Fi}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},mVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=texture2D(map,uv)*intensity;}`,gVe=class extends yd{constructor({blendFunction:n=di.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:t=.03,mipmapBlur:r=!0,intensity:i=1,radius:s=.85,levels:o=8,kernelSize:a=qC.LARGE,resolutionScale:c=.5,width:l=pf.AUTO_SIZE,height:u=pf.AUTO_SIZE,resolutionX:h=l,resolutionY:f=u}={}){super("BloomEffect",mVe,{blendFunction:n,uniforms:new Map([["map",new hn(null)],["intensity",new hn(i)]])}),this.renderTarget=new hl(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new Mre({kernelSize:a}),this.luminancePass=new aVe({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new pVe,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=s,this.mipmapBlurPass.levels=o,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const d=this.resolution=new pf(this,h,f,c);d.addEventListener("change",p=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const r=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,i.renderTarget):this.blurPass.render(n,i.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,n!==null&&n.outputColorSpace===Fi&&(this.renderTarget.texture.colorSpace=Fi))}},OE={RED:0,GREEN:1,BLUE:2,ALPHA:3},nB={DISCARD:0,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},_Ve=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,lk=class extends lo{constructor(n=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:n?"2":"1"},uniforms:{inputBuffer:new hn(null),cocBuffer:new hn(null),texelSize:new hn(new zn),kernel64:new hn(null),kernel16:new hn(null),scale:new hn(1)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:_Ve,vertexShader:WC}),e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set cocBuffer(n){this.uniforms.cocBuffer.value=n}setCoCBuffer(n){this.uniforms.cocBuffer.value=n}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(n){return this.scale}setScale(n){this.scale=n}generateKernel(){const n=2.39996323,e=new Float64Array(128),t=new Float64Array(32);let r=0,i=0;for(let s=0,o=Math.sqrt(80);s<80;++s){const a=s*n,c=Math.sqrt(s)/o,l=c*Math.cos(a),u=c*Math.sin(a);s%5===0?(t[i++]=l,t[i++]=u):(e[r++]=l,e[r++]=u)}this.uniforms.kernel64.value=e,this.uniforms.kernel16.value=t}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e)}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},vVe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform mat4 projectionMatrix;uniform mat4 projectionMatrixInverse;uniform float cameraNear;uniform float cameraFar;uniform float focusDistance;uniform float focusRange;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}
#ifdef PERSPECTIVE_CAMERA
#define getViewZ(depth) perspectiveDepthToViewZ(depth, cameraNear, cameraFar)
#else
#define getViewZ(depth) orthographicDepthToViewZ(depth, cameraNear, cameraFar)
#endif
vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(projectionMatrixInverse*clipPosition).xyz;}vec3 getViewPosition(const in vec2 screenPosition,const in float depth){return getViewPosition(screenPosition,depth,getViewZ(depth));}
#define getDistance(viewPosition) length(viewPosition)
void main(){float depth=readDepth(vUv);vec3 viewPosition=getViewPosition(vUv,depth);float distance=getDistance(viewPosition);float signedDistance=distance-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,yVe=class extends lo{constructor(n=null){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new hn(null),projectionMatrix:new hn(null),projectionMatrixInverse:new hn(null),cameraNear:new hn(.3),cameraFar:new hn(1e3),focusDistance:new hn(0),focusRange:new hn(0)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:vVe,vertexShader:WC}),this.uniforms.focalLength=this.uniforms.focusRange,n!==null&&this.copyCameraSettings(n)}set depthBuffer(n){this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=d1){this.depthBuffer=n,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(n){this.uniforms.focusDistance.value=n}get worldFocusDistance(){return this.focusDistance}set worldFocusDistance(n){this.focusDistance=n}getFocusDistance(n){this.uniforms.focusDistance.value=n}setFocusDistance(n){this.uniforms.focusDistance.value=n}get focalLength(){return this.focusRange}set focalLength(n){this.focusRange=n}get focusRange(){return this.uniforms.focusRange.value}set focusRange(n){this.uniforms.focusRange.value=n}get worldFocusRange(){return this.focusRange}set worldFocusRange(n){this.focusRange=n}getFocalLength(n){return this.focusRange}setFocalLength(n){this.focusRange=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){this.uniforms.projectionMatrix.value=n.projectionMatrix,this.uniforms.projectionMatrixInverse.value=n.projectionMatrixInverse,this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far;const e=this.defines.PERSPECTIVE_CAMERA!==void 0;n instanceof du?e||(this.defines.PERSPECTIVE_CAMERA=!0,this.needsUpdate=!0):e&&(delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},bVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=(mask>0.0)?0.0:1.0;
#else
mask=(mask>0.0)?1.0:0.0;
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,SVe=class extends lo{constructor(n=null){super({name:"MaskMaterial",uniforms:{maskTexture:new hn(n),inputBuffer:new hn(null),strength:new hn(1)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:bVe,vertexShader:WC}),this.colorChannel=OE.RED,this.maskFunction=nB.DISCARD}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}set maskTexture(n){this.uniforms.maskTexture.value=n,delete this.defines.MASK_PRECISION_HIGH,n.type!==Oo&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(n){this.maskTexture=n}set colorChannel(n){this.defines.COLOR_CHANNEL=n.toFixed(0),this.needsUpdate=!0}setColorChannel(n){this.colorChannel=n}set maskFunction(n){this.defines.MASK_FUNCTION=n.toFixed(0),this.needsUpdate=!0}setMaskFunction(n){this.maskFunction=n}get inverted(){return this.defines.INVERTED!==void 0}set inverted(n){this.inverted&&!n?delete this.defines.INVERTED:n&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(n){this.inverted=n}get strength(){return this.uniforms.strength.value}set strength(n){this.uniforms.strength.value=n}getStrength(){return this.strength}setStrength(n){this.strength=n}},sE=class extends Dh{constructor(n,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=n,this.input=e}setInput(n){this.input=n}render(n,e,t,r,i){const s=this.fullscreenMaterial.uniforms;e!==null&&s!==void 0&&s[this.input]!==void 0&&(s[this.input].value=e.texture),n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}initialize(n,e,t){t!==void 0&&t!==Oo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},EVe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
#if MASK_FUNCTION != 1 && MASK_FUNCTION != 2
uniform lowp sampler2D farCoCBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1 || MASK_FUNCTION == 2
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);colorFar.a*=cocNearFar.y;
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,xVe=new zt,TVe=class extends yd{constructor(n,{blendFunction:e,worldFocusDistance:t,worldFocusRange:r,focalLength:i,focusDistance:s=t||3,focusRange:o=r||i||2,bokehScale:a=1,resolutionScale:c=.5,width:l,height:u,resolutionX:h=l||pf.AUTO_SIZE,resolutionY:f=u||pf.AUTO_SIZE}={}){super("DepthOfFieldEffect",EVe,{blendFunction:e,attributes:Su.DEPTH,uniforms:new Map([["nearColorBuffer",new hn(null)],["farColorBuffer",new hn(null)],["nearCoCBuffer",new hn(null)],["farCoCBuffer",new hn(null)],["scale",new hn(1)]])}),this.camera=n,this.renderTarget=new hl(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new sE(new yVe(n));const d=this.cocMaterial;d.focusDistance=s,d.focusRange=o,this.blurPass=new Mre({resolutionScale:c,resolutionX:h,resolutionY:f,kernelSize:qC.MEDIUM}),this.maskPass=new sE(new SVe(this.renderTargetCoC.texture));const p=this.maskPass.fullscreenMaterial;p.colorChannel=OE.GREEN,this.maskFunction=nB.MULTIPLY_RGB,this.bokehNearBasePass=new sE(new lk(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new sE(new lk(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new sE(new lk(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new sE(new lk(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const m=this.resolution=new pf(this,h,f,c);m.addEventListener("change",_=>this.setSize(m.baseWidth,m.baseHeight)),this.bokehScale=a}set mainCamera(n){this.camera=n,this.cocMaterial.copyCameraSettings(n)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(n){this.maskFunction!==n&&(this.defines.set("MASK_FUNCTION",n.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=n,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(n){this.bokehNearBasePass.fullscreenMaterial.scale=n,this.bokehNearFillPass.fullscreenMaterial.scale=n,this.bokehFarBasePass.fullscreenMaterial.scale=n,this.bokehFarFillPass.fullscreenMaterial.scale=n,this.maskPass.fullscreenMaterial.strength=n,this.uniforms.get("scale").value=n}getBokehScale(){return this.bokehScale}setBokehScale(n){this.bokehScale=n}getTarget(){return this.target}setTarget(n){this.target=n}calculateFocusDistance(n){return this.camera.getWorldPosition(xVe).distanceTo(n)}setDepthTexture(n,e=d1){this.cocMaterial.depthBuffer=n,this.cocMaterial.depthPacking=e}update(n,e,t){const r=this.renderTarget,i=this.renderTargetCoC,s=this.renderTargetCoCBlurred,o=this.renderTargetMasked;if(this.target!==null){const a=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=a}this.cocPass.render(n,null,i),this.blurPass.render(n,i,s),this.maskPass.render(n,e,o),this.bokehFarBasePass.render(n,o,r),this.bokehFarFillPass.render(n,r,this.renderTargetFar),this.bokehNearBasePass.render(n,e,r),this.bokehNearFillPass.render(n,r,this.renderTargetNear)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const r=t.width,i=t.height;this.cocPass.setSize(n,e),this.blurPass.setSize(n,e),this.maskPass.setSize(n,e),this.renderTargetFar.setSize(n,e),this.renderTargetCoC.setSize(n,e),this.renderTargetMasked.setSize(n,e),this.renderTarget.setSize(r,i),this.renderTargetNear.setSize(r,i),this.renderTargetCoCBlurred.setSize(r,i),this.bokehNearBasePass.fullscreenMaterial.setSize(n,e),this.bokehNearFillPass.fullscreenMaterial.setSize(n,e),this.bokehFarBasePass.fullscreenMaterial.setSize(n,e),this.bokehFarFillPass.fullscreenMaterial.setSize(n,e)}initialize(n,e,t){this.cocPass.initialize(n,e,t),this.maskPass.initialize(n,e,t),this.bokehNearBasePass.initialize(n,e,t),this.bokehNearFillPass.initialize(n,e,t),this.bokehFarBasePass.initialize(n,e,t),this.bokehFarFillPass.initialize(n,e,t),this.blurPass.initialize(n,e,Oo),n.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),t!==void 0&&(this.renderTarget.texture.type=t,this.renderTargetNear.texture.type=t,this.renderTargetFar.texture.type=t,this.renderTargetMasked.texture.type=t,n!==null&&n.outputColorSpace===Fi&&(this.renderTarget.texture.colorSpace=Fi,this.renderTargetNear.texture.colorSpace=Fi,this.renderTargetFar.texture.colorSpace=Fi,this.renderTargetMasked.texture.colorSpace=Fi))}},Rv={DISABLED:0,SPORADIC:1,CONSTANT_MILD:2,CONSTANT_WILD:3};function wVe(n,e,t){const r=new Map([[KA,1],[m5,2],[_u,4]]);let i;if(r.has(e)||console.error("Invalid noise texture format"),t===Oo){i=new Uint8Array(n*r.get(e));for(let s=0,o=i.length;s<o;++s)i[s]=Math.random()*255+.5}else{i=new Float32Array(n*r.get(e));for(let s=0,o=i.length;s<o;++s)i[s]=Math.random()}return i}var TH=class extends nO{constructor(n,e,t=KA,r=Oo){super(wVe(n*e,t,r),n,e,t,r),this.needsUpdate=!0}},AVe="uniform lowp sampler2D perturbationMap;uniform bool active;uniform float columns;uniform float random;uniform vec2 seeds;uniform vec2 distortion;void mainUv(inout vec2 uv){if(active){if(uv.y<distortion.x+columns&&uv.y>distortion.x-columns*random){float sx=clamp(ceil(seeds.x),0.0,1.0);uv.y=sx*(1.0-(uv.y+distortion.y))+(1.0-sx)*distortion.y;}if(uv.x<distortion.y+columns&&uv.x>distortion.y-columns*random){float sy=clamp(ceil(seeds.y),0.0,1.0);uv.x=sy*distortion.x+(1.0-sy)*(1.0-(uv.x+distortion.x));}vec2 normal=texture2D(perturbationMap,uv*random*random).rg;uv+=normal*seeds*(random*0.2);}}",uk="Glitch.Generated";function ah(n,e){return n+Math.random()*(e-n)}var CVe=class extends yd{constructor({chromaticAberrationOffset:n=null,delay:e=new zn(1.5,3.5),duration:t=new zn(.6,1),strength:r=new zn(.3,1),columns:i=.05,ratio:s=.85,perturbationMap:o=null,dtSize:a=64}={}){if(super("GlitchEffect",AVe,{uniforms:new Map([["perturbationMap",new hn(null)],["columns",new hn(i)],["active",new hn(!1)],["random",new hn(1)],["seeds",new hn(new zn)],["distortion",new hn(new zn)]])}),o===null){const c=new TH(a,a,_u);c.name=uk,this.perturbationMap=c}else this.perturbationMap=o;this.time=0,this.distortion=this.uniforms.get("distortion").value,this.delay=e,this.duration=t,this.breakPoint=new zn(ah(this.delay.x,this.delay.y),ah(this.duration.x,this.duration.y)),this.strength=r,this.mode=Rv.SPORADIC,this.ratio=s,this.chromaticAberrationOffset=n}get seeds(){return this.uniforms.get("seeds").value}get active(){return this.uniforms.get("active").value}isActive(){return this.active}get minDelay(){return this.delay.x}set minDelay(n){this.delay.x=n}getMinDelay(){return this.delay.x}setMinDelay(n){this.delay.x=n}get maxDelay(){return this.delay.y}set maxDelay(n){this.delay.y=n}getMaxDelay(){return this.delay.y}setMaxDelay(n){this.delay.y=n}get minDuration(){return this.duration.x}set minDuration(n){this.duration.x=n}getMinDuration(){return this.duration.x}setMinDuration(n){this.duration.x=n}get maxDuration(){return this.duration.y}set maxDuration(n){this.duration.y=n}getMaxDuration(){return this.duration.y}setMaxDuration(n){this.duration.y=n}get minStrength(){return this.strength.x}set minStrength(n){this.strength.x=n}getMinStrength(){return this.strength.x}setMinStrength(n){this.strength.x=n}get maxStrength(){return this.strength.y}set maxStrength(n){this.strength.y=n}getMaxStrength(){return this.strength.y}setMaxStrength(n){this.strength.y=n}getMode(){return this.mode}setMode(n){this.mode=n}getGlitchRatio(){return 1-this.ratio}setGlitchRatio(n){this.ratio=Math.min(Math.max(1-n,0),1)}get columns(){return this.uniforms.get("columns").value}set columns(n){this.uniforms.get("columns").value=n}getGlitchColumns(){return this.columns}setGlitchColumns(n){this.columns=n}getChromaticAberrationOffset(){return this.chromaticAberrationOffset}setChromaticAberrationOffset(n){this.chromaticAberrationOffset=n}get perturbationMap(){return this.uniforms.get("perturbationMap").value}set perturbationMap(n){const e=this.perturbationMap;e!==null&&e.name===uk&&e.dispose(),n.minFilter=n.magFilter=jl,n.wrapS=n.wrapT=vM,n.generateMipmaps=!1,this.uniforms.get("perturbationMap").value=n}getPerturbationMap(){return this.perturbationMap}setPerturbationMap(n){this.perturbationMap=n}generatePerturbationMap(n=64){const e=new TH(n,n,_u);return e.name=uk,e}update(n,e,t){const r=this.mode,i=this.breakPoint,s=this.chromaticAberrationOffset,o=this.strength;let a=this.time,c=!1,l=0,u=0,h;r!==Rv.DISABLED&&(r===Rv.SPORADIC&&(a+=t,h=a>i.x,a>=i.x+i.y&&(i.set(ah(this.delay.x,this.delay.y),ah(this.duration.x,this.duration.y)),a=0)),l=Math.random(),this.uniforms.get("random").value=l,h&&l>this.ratio||r===Rv.CONSTANT_WILD?(c=!0,l*=o.y*.03,u=ah(-Math.PI,Math.PI),this.seeds.set(ah(-o.y,o.y),ah(-o.y,o.y)),this.distortion.set(ah(0,1),ah(0,1))):(h||r===Rv.CONSTANT_MILD)&&(c=!0,l*=o.x*.03,u=ah(-Math.PI,Math.PI),this.seeds.set(ah(-o.x,o.x),ah(-o.x,o.x)),this.distortion.set(ah(0,1),ah(0,1))),this.time=a),s!==null&&(c?s.set(Math.cos(u),Math.sin(u)).multiplyScalar(l):s.set(0,0)),this.uniforms.get("active").value=c}dispose(){const n=this.perturbationMap;n!==null&&n.name===uk&&n.dispose()}},Ire=class extends Dh{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new Rre,this.overrideMaterialManager=t===null?null:new xH(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new xH(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,r,i){const s=this.scene,o=this.camera,a=this.selection,c=o.layers.mask,l=s.background,u=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&o.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,s,o):n.render(s,o),o.layers.mask=c,s.background=l,n.shadowMap.autoUpdate=u}},SE={DEFAULT:0,ESKIL:1},RVe=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*(1.0+time)));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,kVe=class extends yd{constructor({blendFunction:n=di.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",RVe,{blendFunction:n}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(n){this.premultiply!==n&&(n?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(n){this.premultiply=n}},MVe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,IVe=class extends yd{constructor({blendFunction:n,eskil:e=!1,technique:t=e?SE.ESKIL:SE.DEFAULT,offset:r=.5,darkness:i=.5}={}){super("VignetteEffect",MVe,{blendFunction:n,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new hn(r)],["darkness",new hn(i)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(n){this.technique!==n&&(this.defines.set("VIGNETTE_TECHNIQUE",n.toFixed(0)),this.setChanged())}get eskil(){return this.technique===SE.ESKIL}set eskil(n){this.technique=n?SE.ESKIL:SE.DEFAULT}getTechnique(){return this.technique}setTechnique(n){this.technique=n}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}get darkness(){return this.uniforms.get("darkness").value}set darkness(n){this.uniforms.get("darkness").value=n}getDarkness(){return this.darkness}setDarkness(n){this.darkness=n}},OVe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,NVe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",PVe=class extends lo{constructor(n,e,t,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:YA.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new hn(null),depthBuffer:new hn(null),resolution:new hn(new zn),texelSize:new hn(new zn),cameraNear:new hn(.3),cameraFar:new hn(1e3),aspect:new hn(1),time:new hn(0)},blending:ul,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(r)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=d1){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=OVe.replace(ts.FRAGMENT_HEAD,n.get(ts.FRAGMENT_HEAD)||"").replace(ts.FRAGMENT_MAIN_UV,n.get(ts.FRAGMENT_MAIN_UV)||"").replace(ts.FRAGMENT_MAIN_IMAGE,n.get(ts.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=NVe.replace(ts.VERTEX_HEAD,n.get(ts.VERTEX_HEAD)||"").replace(ts.VERTEX_MAIN_SUPPORT,n.get(ts.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof du?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return ts}};function wH(n,e,t){for(const r of e){const i="$1"+n+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const o of t.entries())o[1]!==null&&t.set(o[0],o[1].replace(s,i))}}function DVe(n,e,t){let r=e.getFragmentShader(),i=e.getVertexShader();const s=r!==void 0&&/mainImage/.test(r),o=r!==void 0&&/mainUv/.test(r);if(t.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(o&&(t.attributes&Su.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!s&&!o)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,c=t.shaderParts;let l=c.get(ts.FRAGMENT_HEAD)||"",u=c.get(ts.FRAGMENT_MAIN_UV)||"",h=c.get(ts.FRAGMENT_MAIN_IMAGE)||"",f=c.get(ts.VERTEX_HEAD)||"",d=c.get(ts.VERTEX_MAIN_SUPPORT)||"";const p=new Set,m=new Set;if(o&&(u+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const S=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);d+=`	${n}MainSupport(`,d+=S?`vUv);
`:`);
`;for(const b of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const T of b[1].split(/\s*,\s*/))t.varyings.add(T),p.add(T),m.add(T);for(const b of i.matchAll(a))m.add(b[1])}for(const S of r.matchAll(a))m.add(S[1]);for(const S of e.defines.keys())m.add(S.replace(/\([\w\s,]*\)/g,""));for(const S of e.uniforms.keys())m.add(S);m.delete("while"),m.delete("for"),m.delete("if"),e.uniforms.forEach((S,b)=>t.uniforms.set(n+b.charAt(0).toUpperCase()+b.slice(1),S)),e.defines.forEach((S,b)=>t.defines.set(n+b.charAt(0).toUpperCase()+b.slice(1),S));const _=new Map([["fragment",r],["vertex",i]]);wH(n,m,t.defines),wH(n,m,_),r=_.get("fragment"),i=_.get("vertex");const v=e.blendMode;if(t.blendModes.set(v.blendFunction,v),s){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===Fi?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Pm?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const S=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,(t.attributes&Su.DEPTH)!==0&&S.test(r)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const b=n+"BlendOpacity";t.uniforms.set(b,v.opacity),h+=`color0 = blend${v.blendFunction}(color0, color1, ${b});

	`,l+=`uniform float ${b};

`}if(l+=r+`
`,i!==null&&(f+=i+`
`),c.set(ts.FRAGMENT_HEAD,l),c.set(ts.FRAGMENT_MAIN_UV,u),c.set(ts.FRAGMENT_MAIN_IMAGE,h),c.set(ts.VERTEX_HEAD,f),c.set(ts.VERTEX_MAIN_SUPPORT,d),e.extensions!==null)for(const S of e.extensions)t.extensions.add(S)}}var Ore=class extends Dh{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new PVe(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new b$e;let e=0;for(const o of this.effects)if(o.blendMode.blendFunction===di.DST)n.attributes|=o.getAttributes()&Su.DEPTH;else{if((n.attributes&o.getAttributes()&Su.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${o.name})`);DVe("e"+e++,o,n)}let t=n.shaderParts.get(ts.FRAGMENT_HEAD),r=n.shaderParts.get(ts.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get(ts.FRAGMENT_MAIN_UV);const s=/\bblend\b/g;for(const o of n.blendModes.values())t+=o.getShaderCode().replace(s,`blend${o.blendFunction}`)+`
`;(n.attributes&Su.DEPTH)!==0?(n.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Fi&&(r+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(ts.FRAGMENT_HEAD,t),n.shaderParts.set(ts.FRAGMENT_MAIN_IMAGE,r),n.shaderParts.set(ts.FRAGMENT_MAIN_UV,i);for(const[o,a]of n.shaderParts)a!==null&&n.shaderParts.set(o,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=d1){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,r,i){for(const s of this.effects)s.update(n,e,r);if(!this.skipRendering||this.renderToScreen){const s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const r of this.effects)r.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==Oo&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){n.type==="change"&&this.recompile()}};function Gw(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}new zn;new zn;function Nre(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var Xf=function n(e,t,r){var i=this;Nre(this,n),Gw(this,"dot2",function(s,o){return i.x*s+i.y*o}),Gw(this,"dot3",function(s,o,a){return i.x*s+i.y*o+i.z*a}),this.x=e,this.y=t,this.z=r},LVe=[new Xf(1,1,0),new Xf(-1,1,0),new Xf(1,-1,0),new Xf(-1,-1,0),new Xf(1,0,1),new Xf(-1,0,1),new Xf(1,0,-1),new Xf(-1,0,-1),new Xf(0,1,1),new Xf(0,-1,1),new Xf(0,1,-1),new Xf(0,-1,-1)],AH=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],CH=new Array(512),RH=new Array(512),UVe=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var r;t&1?r=AH[t]^e&255:r=AH[t]^e>>8&255,CH[t]=CH[t+256]=r,RH[t]=RH[t+256]=LVe[r%12]}};UVe(0);function BVe(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var e=n;n=0;for(var t=0;t<e.length;t++)n=(n+(t+1)*(e.charCodeAt(t)%96))%2147483647}return n===0&&(n=311),n}function kH(n){var e=BVe(n);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var FVe=function n(e){var t=this;Nre(this,n),Gw(this,"seed",0),Gw(this,"init",function(r){t.seed=r,t.value=kH(r)}),Gw(this,"value",kH(this.seed)),this.init(e)};new FVe(Math.random());const rB=Ke.createContext(null);let jVe=0;const MH=new WeakMap,hT=(n,e)=>function({blendFunction:t=e?.blendFunction,opacity:r=e?.opacity,...i}){let s=MH.get(n);if(!s){const c=`@react-three/postprocessing/${n.name}-${jVe++}`;WW({[c]:n}),MH.set(n,s=c)}const o=jc(c=>c.camera),a=yh.useMemo(()=>[...e?.args??[],...i.args??[{...e,...i}]],[JSON.stringify(i)]);return be.jsx(s,{camera:o,"blendMode-blendFunction":t,"blendMode-opacity-value":r,...i,args:a})},hk=(n,e)=>{const t=n[e];return yh.useMemo(()=>typeof t=="number"?new zn(t,t):t?new zn(...t):new zn,[t])},iB=Ke.forwardRef(function({blendFunction:n,worldFocusDistance:e,worldFocusRange:t,focusDistance:r,focusRange:i,focalLength:s,bokehScale:o,resolutionScale:a,resolutionX:c,resolutionY:l,width:u,height:h,target:f,depthTexture:d,...p},m){const{camera:_}=Ke.useContext(rB),v=f!=null,S=Ke.useMemo(()=>{const b=new TVe(_,{blendFunction:n,worldFocusDistance:e,worldFocusRange:t,focusDistance:r,focusRange:i,focalLength:s,bokehScale:o,resolutionScale:a,resolutionX:c,resolutionY:l,width:u,height:h});v&&(b.target=new zt),d&&b.setDepthTexture(d.texture,d.packing);const T=b.maskPass;return T.maskFunction=nB.MULTIPLY_RGB_SET_ALPHA,b},[_,n,e,t,r,i,s,o,a,c,l,u,h,v,d]);return Ke.useEffect(()=>()=>{S.dispose()},[S]),be.jsx("primitive",{...p,ref:m,object:S,target:f})}),zVe=hT(gVe,{blendFunction:0}),$Ve=Ke.forwardRef(function({active:n=!0,...e},t){const r=jc(l=>l.invalidate),i=hk(e,"delay"),s=hk(e,"duration"),o=hk(e,"strength"),a=hk(e,"chromaticAberrationOffset"),c=Ke.useMemo(()=>new CVe({...e,delay:i,duration:s,strength:o,chromaticAberrationOffset:a}),[i,s,e,o,a]);return Ke.useLayoutEffect(()=>{c.mode=n?e.mode||Rv.SPORADIC:Rv.DISABLED,r()},[n,c,r,e.mode]),Ke.useEffect(()=>()=>{c.dispose?.()},[c]),be.jsx("primitive",{ref:t,object:c,dispose:null})}),VVe=hT(kVe,{blendFunction:5}),HVe=hT(IVe);var bd=typeof window<"u"?window:{screen:{},navigator:{}},Ux=(bd.matchMedia||(function(){return{matches:!1}})).bind(bd),GVe={get passive(){return!0}},Pre=function(){};bd.addEventListener&&bd.addEventListener("p",Pre,GVe);bd.removeEventListener&&bd.removeEventListener("p",Pre,!1);var sB="ontouchstart"in bd,WVe="TouchEvent"in bd,qVe=sB||WVe&&Ux("(any-pointer: coarse)").matches,IH=(bd.navigator.maxTouchPoints||0)>0||qVe,Dre=bd.navigator.userAgent||"",YVe=Ux("(pointer: coarse)").matches&&/iPad|Macintosh/.test(Dre)&&Math.min(bd.screen.width||0,bd.screen.height||0)>=768,Lre=(Ux("(pointer: coarse)").matches||!Ux("(pointer: fine)").matches&&sB)&&!/Windows.*Firefox/.test(Dre),KVe=Ux("(any-pointer: fine)").matches||Ux("(any-hover: hover)").matches||YVe||!sB,j4=IH&&(KVe||!Lre)?"hybrid":IH?"touchOnly":"mouseOnly",XVe=j4==="mouseOnly"?"mouse":j4==="touchOnly"||Lre?"touch":"mouse";const ZVe=`  
vec3 halftone(vec3 texcolor, vec2 st, float frequency) {
  float n = 0.1 * snoise(st * 200.0); // Fractal noise
  n += 0.05 * snoise(st * 400.0);
  n += 0.025 * snoise(st * 800.0);

  // Perform a rough RGB-to-CMYK conversion
  vec4 cmyk;
  // CMY = 1-RGB
  cmyk.xyz = 1.0 - texcolor;
  // Black generation: K = min(C,M,Y)
  cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); 
  // Grey component replacement: subtract K from CMY
  cmyk.xyz -= cmyk.w; 

  // K based modifier
  float flex = pow(cmyk.w, 3.11);

  // Distance to nearest point in a grid of
  // (frequency x frequency) points over the unit square
  
  float t = 0.1 + 0.1 * n + 0.11 * flex + 0.1 * cmyk.y;

  // K component: 45 degrees screen angle
  vec2 Kst = frequency * mat2(0.707, -0.707, 0.707, 0.707) * st;
  vec2 Kuv = 2.0 * fract(Kst) - 1.0; 
  float k = aastep(0.0, sqrt(cmyk.w) + t - length(Kuv) + n);
  
  // C component: 15 degrees screen angle
  vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966) * st;
  vec2 Cuv = 2.0 * fract(Cst) - 1.0;
  float c = aastep(0.0, sqrt(cmyk.x) + t - length(Cuv) + n);
  
  // M component: -15 degrees screen angle
  vec2 Mst = frequency * mat2(0.966, 0.259, -0.259, 0.966) * st;
  vec2 Muv = 2.0 * fract(Mst) - 1.0;
  float m = aastep(0.0, sqrt(cmyk.y) + t - length(Muv) + n);

  // Y component: 0 degrees screen angle
  vec2 Yst = frequency * st; // 0 deg 
  vec2 Yuv = 2.0 * fract(Yst) - 1.0;
  float y = aastep(0.0, sqrt(cmyk.z) + t - length(Yuv) + n);

  // CMY screen in RGB
  vec3 black = vec3(n + 0.01);
  vec3 rgbscreen = 1.0 - vec3(c,m,y) + n;
  
  // Blend in K for final color
  vec3 factor = mix(rgbscreen, black, 1.1 * k + 0.3 * n);

  // Blend with og color
  return mix(factor, texcolor, 0.777);
}

vec3 halftone(vec3 texcolor, vec2 st) {
  return halftone(texcolor, st, 412.321);
}
`,JVe=`
float blendLighten(float base, float blend) {
	return max(blend,base);
}

vec3 blendLighten(vec3 base, vec3 blend) {
	return vec3(blendLighten(base.r,blend.r),blendLighten(base.g,blend.g),blendLighten(base.b,blend.b));
}

vec3 blendLighten(vec3 base, vec3 blend, float opacity) {
	return (blendLighten(base, blend) * opacity + base * (1.0 - opacity));
}

float blendDarken(float base, float blend) {
	return min(blend,base);
}

vec3 blendDarken(vec3 base, vec3 blend) {
	return vec3(blendDarken(base.r,blend.r),blendDarken(base.g,blend.g),blendDarken(base.b,blend.b));
}

vec3 blendDarken(vec3 base, vec3 blend, float opacity) {
	return (blendDarken(base, blend) * opacity + base * (1.0 - opacity));
}
`,QVe=`
float aastep(float threshold, float value) {
  float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;
  return smoothstep(threshold-afwidth, threshold+afwidth, value);
}
`,fT=`
//
// Description : Array and textureless GLSL 2D simplex noise function.
//      Author : Ian McEwan, Ashima Arts.
//  Maintainer : ijm
//     Lastmod : 20110822 (ijm)
//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.
//               Distributed under the MIT License. See LICENSE file.
//               https://github.com/ashima/webgl-noise
//

vec3 mod289(vec3 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec2 mod289(vec2 x) {
  return x - floor(x * (1.0 / 289.0)) * 289.0;
}

vec3 permute(vec3 x) {
  return mod289(((x*34.0)+1.0)*x);
}

float snoise(vec2 v) {
  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0
                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)
                     -0.577350269189626,  // -1.0 + 2.0 * C.x
                      0.024390243902439); // 1.0 / 41.0
// First corner
  vec2 i  = floor(v + dot(v, C.yy) );
  vec2 x0 = v -   i + dot(i, C.xx);

// Other corners
  vec2 i1;
  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0
  //i1.y = 1.0 - i1.x;
  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
  // x0 = x0 - 0.0 + 0.0 * C.xx ;
  // x1 = x0 - i1 + 1.0 * C.xx ;
  // x2 = x0 - 1.0 + 2.0 * C.xx ;
  vec4 x12 = x0.xyxy + C.xxzz;
  x12.xy -= i1;

// Permutations
  i = mod289(i); // Avoid truncation effects in permutation
  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
    + i.x + vec3(0.0, i1.x, 1.0 ));

  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
  m = m*m ;
  m = m*m ;

// Gradients: 41 points uniformly over a line, mapped onto a diamond.
// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)

  vec3 x = 2.0 * fract(p * C.www) - 1.0;
  vec3 h = abs(x) - 0.5;
  vec3 ox = floor(x + 0.5);
  vec3 a0 = x - ox;

// Normalise gradients implicitly by scaling m
// Approximation of: m *= inversesqrt( a0*a0 + h*h );
  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );

// Compute final noise value at P
  vec3 g;
  g.x  = a0.x  * x0.x  + h.x  * x0.y;
  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
  return 130.0 * dot(m, g);
}
`,eHe=`
#ifdef ASPECT_CORRECTION
	uniform float scale;
#else
	uniform mat3 uvTransform;
#endif

varying vec2 vUv2;

void mainSupport(const in vec2 uv) {
	#ifdef ASPECT_CORRECTION
		vUv2 = uv * vec2(aspect, 1.0) * scale;
	#else
		vUv2 = (uvTransform * vec3(uv, 1.0)).xy;
	#endif
}
`,tHe=`
uniform float viewheight;
uniform sampler2D splat;

${JVe}
${QVe}
${fT}
${ZVe}

float rectdistance(vec2 uv) {
  vec2 tl = vec2(-1.0);
  vec2 br = vec2(1.0);
  vec2 d = max(tl - uv, uv - br);
  return abs(length(max(vec2(0.0), d)) + min(0.0, max(d.x, d.y)));
}

vec2 bendy(const in vec2 xn, float dn, float sn) {
  // config
  float distortion = 0.0173 + dn; // 0.0173, 0.511
  float scale = 0.991 + sn; // 1.0, 0.7
  // calc
  vec3 xDistorted = vec3((1.0 + vec2(distortion, distortion) * dot(xn, xn)) * xn, 1.0);
  mat3 kk = mat3(
    vec3(1.0, 0.0, 0.0),
    vec3(0.0, 1.0, 0.0),
    vec3(0.0, 0.0, 1.0)
  );
  return (kk * xDistorted).xy * scale;
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
	#ifdef UV_TRANSFORM
		vec4 bright = texture2D(splat, vUv2);
		vec4 dark = texture2D(splat, 1.0 - vUv2);
	#else
		vec4 bright = texture2D(splat, uv);
		vec4 dark = texture2D(splat, 1.0 - uv);
	#endif
  
  float n = 0.1 * snoise(uv.st * 200.0); // Fractal noise
  n += 0.05 * snoise(uv.st * 400.0);
  n += 0.025 * snoise(uv.st * 800.0);

  vec2 xn = 2.0 * (uv.st - 0.5);
  float fz = 0.005;
  vec2 edge = bendy(xn, fz * n, -fz * n);
  vec2 bent = edge.xy * 0.5 + 0.5;

  float edgetime = time * 0.3;
  float edgetime2 = time * 2.0;
  vec2 edgewiggle = vec2(cos(edgetime) * 0.1, sin(edgetime) * 0.096);
  vec2 edgewiggle2 = vec2(cos(edgetime2) * 0.005, sin(edgetime2) * 0.005);
  vec2 edgeshine = vec2(edge.x * 5.0 + 3.5, edge.y - 0.3) + edgewiggle + edgewiggle2;
  vec2 edgeshine2 = vec2(edge.x, edge.y * 2.0 - 0.5) + edgewiggle + edgewiggle2;
  vec2 edgeshine3 = vec2(edge.x * 3.0 - 2.1, edge.y + 0.3) + edgewiggle + edgewiggle2;
  
  float dx = rectdistance(xn);
  float bx = rectdistance(edge);
  float ex = rectdistance(edgeshine);
  float ex2 = rectdistance(edgeshine2);
  float ex3 = rectdistance(edgeshine3);

  // apply shape
  float doot = max(abs(edge.x), abs(edge.y));
  if (doot < 1.0) {
    // display
    outputColor = texture2D(inputBuffer, bent);

    // apply scratches
    outputColor.rgb = blendLighten(outputColor.rgb, bright.rgb, 0.079);
    outputColor.rgb = blendDarken(outputColor.rgb, dark.rgb, 0.0666);

    // apply halftones
    outputColor.rgb = halftone(outputColor.rgb, uv.st);
  
  } else if (doot > 1.004) {
    // display shell
    // rbgb 205 205 193
    vec3 matte = vec3(205.0 / 255.0, 205.0 / 255.0, 193.0 / 255.0);
    vec3 dkmatte = mix(matte, vec3(0.0), 0.5);
    float mx = pow(1.0 - bx, 16.0) + n;
    outputColor = vec4(mix(matte, dkmatte, mx), inputColor.a);

  } else {
    // border
    outputColor = vec4(mix(vec3(0.0), outputColor.rgb, 0.5), inputColor.a);
  }

  // apply reflection shine
  if (doot < 0.98) {
    float vvv = 0.34;
    if (edge.x > -0.9 && edge.x < -0.5 && edge.y > -0.5) {
      float sh = clamp(0.0, vvv, ex + n * 0.333);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(bx * 3.0)) * (6.0 + sin(edgetime));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
    if (edge.y > -0.3 && edge.y < 0.7) {
      float sh = clamp(0.0, vvv, ex2 + n * 0.15);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(dx * 3.0)) * (4.0 + cos(edgetime * 1.5));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
    if (edge.x > 0.4 && edge.y < 0.8) {
      float sh = clamp(0.0, vvv, ex3 + n * 0.25);
      float ratio = pow(sh, 5.0) * 6.0 * abs(cos(bx * 2.0)) * (3.0 + sin(-edgetime));
      vec3 shade = mix(outputColor.rgb, vec3(1.0), ratio * 0.333);
      outputColor = vec4(shade, inputColor.a);
    }
  }

  // apply inner shade
  if (doot >= 0.5 && doot < 1.0) {
    float sh = clamp(0.0, 1.0, 1.0 - bx - 0.7);
    vec3 shade = mix(outputColor.rgb, vec3(0.0), pow(sh, 4.0));
    outputColor = vec4(shade, inputColor.a);
  }

  // apply outer shade
  if (doot >= 0.97) {
    float sh = clamp(0.0, 1.0, bx * 24.0);
    vec3 dkout = mix(vec3(0.0), outputColor.rgb, 0.81);
    vec3 shade = mix(dkout, outputColor.rgb, sh);
    outputColor = vec4(shade, inputColor.a);
  }
}
`;class nHe extends yd{constructor({splat:e,viewheight:t}={}){super("CRTShapeEffect",tHe,{blendFunction:di.NORMAL,attributes:Su.CONVOLUTION,defines:new Map([["TEXEL","texel"],["TEXTURE_PRECISION_HIGH","1"]]),uniforms:new Map([["splat",new hn(e)],["viewheight",new hn(t??128)]])})}get splat(){return this.uniforms.get("splat")?.value}set splat(e){const{splat:t,uniforms:r,defines:i}=this,s=r.get("splat"),o=r.get("uvTransform");t!==e&&s&&o&&(s.value=e,o.value=e.matrix,i.delete("TEXTURE_PRECISION_HIGH"),e!==null&&(e.matrixAutoUpdate?(i.set("UV_TRANSFORM","1"),this.setVertexShader(eHe)):(i.delete("UV_TRANSFORM"),this.setVertexShader(null)),e.type!==Oo&&i.set("TEXTURE_PRECISION_HIGH","1"),(t===null||t?.type!==e.type)&&this.setChanged()))}getTexture(){return this.splat}setTexture(e){this.splat=e}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(e){this.aspectCorrection!==e&&(e?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){return!!this.splat?.matrixAutoUpdate}set uvTransform(e){const t=this.splat;he(t)&&(t.matrixAutoUpdate=e)}setTextureSwizzleRGBA(e,t=e,r=e,i=e){const s="rgba";let o="";(e!==OE.RED||t!==OE.GREEN||r!==OE.BLUE||i!==OE.ALPHA)&&(o=[".",s[e],s[t],s[r],s[i]].join("")),this.defines.set("TEXEL","texel"+o),this.setChanged()}update(){this.splat?.matrixAutoUpdate&&this.splat.updateMatrix()}}const rHe=hT(nHe);function z4(n){const e=new Set;function t(s){vEe(s)&&s.target!=="tick"&&s.target!=="tock"&&e.has(s.id)===!1&&(e.add(s.id),Fw.invoke(s))}const r=mg("forward",["all"],s=>{e.has(s.id)||(e.add(s.id),n(s))});function i(){r.disconnect()}return{forward:t,disconnect:i}}function iHe(n){switch(n.target){case"tick":case"tock":case"ready":return!0}return!1}function sHe(n){switch(n.target){case"log":case"chat":case"tick":case"tock":case"ready":case"toast":case"second":return!0;default:{const e=Vv(n.target);switch(e.target){case"vm":case"heavy":case"synth":case"modem":case"bridge":case"register":case"gadgetclient":return!0}switch(e.path){case"sync":case"heavy":case"joinack":case"acklook":case"acklogin":case"ackoperator":case"ackzsswords":case"gadgetclient":return!0}break}}return!1}function oHe(n){switch(n.target){case"tick":case"tock":case"second":return!0}return!1}function $4(n){const e=Vv(n.target);switch(e.target){case"vm":case"modem":case"gadgetserver":return!0}switch(e.path){case"sync":case"desync":case"joinack":return!0}return!1}function OH(n){switch(n.target){case"tick":case"tock":return!1;case"second":case"ready":return!0;default:{const e=Vv(n.target);return e.target==="heavy"||e.path==="acklook"}}}function aHe(n){return new Worker("/assets/heavyspace-BhUNig3R.js",{name:n?.name})}function cHe(n){return new Worker("/assets/simspace-C6S7wKhq.js",{name:n?.name})}function lHe(n){return new Worker("/assets/stubspace-7jhWfzVD.js",{name:n?.name})}let ym,rp,V4;function uHe(n=!1){if(he(rp))return;yEe(qe),ym=new aHe,rp=n?new lHe:new cHe;const{forward:e,disconnect:t}=z4(s=>{$4(s)&&he(rp)&&rp.postMessage(s),OH(s)&&he(ym)&&ym.postMessage(s)});function r(s){const o=s.data;return $4(o)&&he(rp)&&rp.postMessage(o),e(o)}ym.addEventListener("message",r);function i(s){const o=s.data;return OH(o)&&he(ym)&&ym.postMessage(o),e(o)}rp.addEventListener("message",i),V4=()=>{t(),he(ym)&&(ym.removeEventListener("message",r),ym.terminate()),ym=void 0,he(rp)&&(rp.removeEventListener("message",i),rp.terminate()),rp=void 0}}function hHe(){V4?.(),V4=void 0}function fHe(n,e,t,r){const i=e*t*4;for(let s=0,o=0;s<i;++o)n.image.data[s]=r[o]*255,s+=4;return n.needsUpdate=!0,n}function dHe(n,e){const t=new Uint8Array(4*n*e);return new nO(t,n,e)}const pHe=new lo({transparent:!1,side:Ia,uniforms:{color:{value:new Ti(0,0,0)},data:{value:null}},vertexShader:`
      precision highp float;
      varying vec2 vUv;
    
      void main() {
        vec4 mvPosition = vec4(position, 1.0);
        #ifdef USE_INSTANCING
        	mvPosition = instanceMatrix * mvPosition;
        #endif        
        mvPosition = modelViewMatrix * mvPosition;
        gl_Position = projectionMatrix * mvPosition;
        
        vUv = uv;
      }
    `,fragmentShader:`
      precision highp float;
      uniform vec3 color;
      uniform sampler2D data;
  
      varying vec2 vUv;

      // adapted from https://www.shadertoy.com/view/Mlt3z8
      float bayerDither2x2( vec2 v ) {
        return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
      }

      float bayerDither4x4( vec2 v ) {
        vec2 P1 = mod( v, 2.0 );
        vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
        return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
      }

      void main() {
        float alpha = texture2D(data, vUv).r;
        if (alpha < 1.0) {
          vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
          if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
            discard;
          }
        }

        gl_FragColor.rgba = vec4(color.xyz, 1.0);
      }
    `});function mHe(){return cy(pHe)}const gHe=new lo({transparent:!1,side:Ia,uniforms:{time:Ma,smoothrate:new hn(uC),color:{value:new Ti(0,0,0)},alpha:{value:1}},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec3 nowposition;
    attribute mat4 lastmatrix;
    
    uniform float smoothrate;
    uniform float time;
  
    varying float vVisible;
  
    void main() {       
      vec4 mvPosition = vec4(position, 1.0);
      
      vec4 mvNowPosition = instanceMatrix * mvPosition;
      vec4 mvLastPosition = lastmatrix * mvPosition;

      float deltaPosition = clamp((time - nowposition.z) * smoothrate, 0.0, 1.0);
      mvPosition = mix(mvLastPosition, mvNowPosition, deltaPosition);

      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
      
      vVisible = visible;
    }
    `,fragmentShader:`
    precision highp float;
    uniform vec3 color;
    uniform float alpha;

    varying float vVisible;

    // adapted from https://www.shadertoy.com/view/Mlt3z8
    float bayerDither2x2( vec2 v ) {
      return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
    }

    float bayerDither4x4( vec2 v ) {
      vec2 P1 = mod( v, 2.0 );
      vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
      return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
    }

    void main() {
      if (vVisible == 0.0) {
        discard;
      }
      if (alpha < 1.0) {
        vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
        if ( bayerDither4x4( ditherCoord ) / 16.0 >= alpha ) {
          discard;
        }
      }

      gl_FragColor.rgba = vec4(color.xyz, 1.0);
    }
    `});function _He(){return cy(gHe)}const fu=[0,1,0],Bm=[1,1,0],uf=[1,0,0],Fm=[0,0,0],vHe=new Float32Array([...fu,...uf,...Bm,...fu,...Fm,...uf]),Ure=new Float32Array([...fu.slice(0,2),...uf.slice(0,2),...Bm.slice(0,2),...fu.slice(0,2),...Fm.slice(0,2),...uf.slice(0,2)]);function yHe(n,e,t,r,i,s){const o=e*t*4;for(let a=0,c=0;a<o;++c){const l=r[c]??0;n.image.data[a++]=l%So,n.image.data[a++]=Math.floor(l/So),n.image.data[a++]=i[c]??16,n.image.data[a++]=s[c]??16}return n.needsUpdate=!0,n}function bHe(n,e){const t=new Uint8Array(4*n*e),r=new nO(t,n,e,tO,Oo);return r.internalFormat="RGBA8UI",r}function oB(n,e){const t=n*kn.DRAW_CHAR_WIDTH(),r=e*kn.DRAW_CHAR_HEIGHT();return{position:vHe.map((s,o)=>{switch(o%3){case 0:return s*t;case 1:return s*r;default:return s}}),uv:Ure}}const NH=[0,1,1],tD=[1,1,1],fk=[1,0,1],nD=[0,0,1],SHe=new Float32Array([...fu,...tD,...Bm,...fu,...NH,...tD,...Fm,...fk,...uf,...Fm,...nD,...fk,...Bm,...fk,...uf,...Bm,...tD,...fk,...fu,...nD,...Fm,...fu,...NH,...nD]),EHe=new Float32Array([...fu.slice(0,2),...uf.slice(0,2),...Bm.slice(0,2),...fu.slice(0,2),...Fm.slice(0,2),...uf.slice(0,2),...fu.slice(0,2),...uf.slice(0,2),...Bm.slice(0,2),...fu.slice(0,2),...Fm.slice(0,2),...uf.slice(0,2),...Bm.slice(0,2),...Fm.slice(0,2),...fu.slice(0,2),...Bm.slice(0,2),...uf.slice(0,2),...Fm.slice(0,2),...fu.slice(0,2),...uf.slice(0,2),...Bm.slice(0,2),...fu.slice(0,2),...Fm.slice(0,2),...uf.slice(0,2)]);function xHe(n,e){const t=n*kn.DRAW_CHAR_WIDTH(),r=e*kn.DRAW_CHAR_HEIGHT();return{position:SHe.map((s,o)=>{switch(o%3){case 0:return s*t;case 1:return s*r;default:return s*r}}),uv:EHe}}const PH=[-.5,0,0],THe=[.5,0,0],DH=[.5,0,1],wHe=[-.5,0,1],AHe=new Float32Array([...PH,...DH,...THe,...PH,...wHe,...DH]);function CHe(){const n=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT();return{position:AHe.map((r,i)=>{switch(i%3){case 0:return r*n;case 1:return r*e;default:return r*e}}),uv:Ure}}const RHe=yx(_1(b1)),LH=Im(v1(y1)),kHe=new lo({transparent:!1,side:Ia,uniforms:{time:Ma,interval:uT,palette:new hn(RHe),map:new hn(LH),alt:new hn(LH),data:new hn(null),size:new hn(new zn),step:new hn(new zn),flip:new hn(!0)},vertexShader:`
    precision highp float;
    varying vec2 vUv;
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
      vUv = uv;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform usampler2D data;
    uniform vec3 palette[16];
    uniform vec2 size;
    uniform vec2 step;
    uniform bool flip;
    varying vec2 vUv;

    ${fT}

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vUv * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      uvec4 tiledata = texture(data, vUv);
      int colori = int(tiledata.z);
      int bgi = int(tiledata.w);

      vec2 charPosition = mod(vUv, size) / size;
      vec2 uv = vec2(charPosition.x * step.x, charPosition.y * step.y);
      
      vec3 color;
      if (colori > 31) {
        vec3 bg = palette[bgi];
        color = palette[colori - 33];
        float cycle = mod(time * 2.5, interval * 2.0) / interval;
        color = mix(bg, color, cyclefromtime());
      } else {
        color = palette[colori % 16];
      }

      uv.x += step.x * float(tiledata.x);
      uv.y += step.y * float(tiledata.y);
      if (flip) {
        uv.y = 1.0 - uv.y;
      }

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Ft.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function MHe(){return cy(kHe)}function D3({width:n,height:e,alphas:t}){const[r]=Ke.useState(()=>mHe());Ke.useEffect(()=>{r.uniforms.data.value=dHe(n,e)},[r.uniforms.data,n,e]),Ke.useEffect(()=>{fHe(r.uniforms.data.value,n,e,t)},[r,r.uniforms.data.value,n,e,t]);const{position:i,uv:s}=Ke.useMemo(()=>oB(n,e),[n,e]);return be.jsxs("mesh",{children:[be.jsx("primitive",{object:r,attach:"material"}),be.jsxs("bufferGeometry",{children:[be.jsx("bufferAttribute",{attach:"attributes-position",args:[i,3]}),be.jsx("bufferAttribute",{attach:"attributes-uv",args:[s,2]})]})]})}function IHe({width:n,height:e,alpha:t}){const r=Ke.useMemo(()=>new Array(n*e).fill(t),[n,e,t]);return be.jsx(D3,{width:n,height:e,alphas:r})}const ow=new Kce,ob=new zn;function L3({width:n,height:e,top:t,left:r,right:i,bottom:s,scale:o=.125,alpha:a=.25}){const c=Ke.useMemo(()=>{const l=new Array(n*e);ow.min.x=r,ow.min.y=t,ow.max.x=i,ow.max.y=s,ob.x=0,ob.y=0;for(let u=0;u<l.length;++u)l[u]=_W.smootherstep(1-ow.distanceToPoint(ob)*o,0,1)*a,++ob.x,ob.x>=n&&(ob.x=0,++ob.y);return l},[n,e,t,r,i,s,o,a]);return be.jsx(D3,{width:n,height:e,alphas:c})}function UH(){}const OHe=yh.forwardRef(function({args:e,children:t,...r},i){const s=yh.useRef(null);return yh.useImperativeHandle(i,()=>s.current),be.jsxs("mesh",{ref:s,...r,children:[be.jsx("planeGeometry",{attach:"geometry",args:e}),t]})}),Km=yh.forwardRef(function({blocking:e=!1,cursor:t="default",x:r=0,y:i=0,z:s=0,width:o=1,height:a=1,opacity:c=1,visible:l=!0,color:u="white",...h},f){const d=o*.5,p=a*.5,m=[(r+d)*kn.DRAW_CHAR_WIDTH(),(i+p)*kn.DRAW_CHAR_HEIGHT(),s];return be.jsx(OHe,{ref:f,args:[o*kn.DRAW_CHAR_WIDTH(),a*kn.DRAW_CHAR_HEIGHT()],userData:{blocking:e,cursor:t},onClick:e?UH:void 0,onPointerMove:e?UH:void 0,position:m,...h,children:be.jsx("meshBasicMaterial",{color:u,opacity:c,visible:l,transparent:c!==1})})}),NHe=yx(_1(b1)),BH=Im(v1(y1));function vp({width:n,height:e,char:t,color:r,bg:i,fliptexture:s=!0,alwaysdefaults:o=!1}){const a=ya(S=>S.palettedata),c=ya(S=>S.charsetdata),l=ya(S=>S.altcharsetdata),u=o?NHe:a,h=o?BH:c,f=o?BH:l,[d]=Ke.useState(()=>MHe()),{width:p=0,height:m=0}=h?.image??{};Ke.useEffect(()=>{n===0||e===0||(d.uniforms.data.value=bHe(n,e))},[d.uniforms.data,n,e]),Ke.useEffect(()=>{n===0||e===0||yHe(d.uniforms.data.value,n,e,t,r,i)},[d.uniforms.data.value,n,e,t,r,i]),Ke.useEffect(()=>{n===0||e===0||!h||(d.uniforms.map.value=h,d.uniforms.alt.value=f??h,d.uniforms.palette.value=u,d.uniforms.size.value.x=1/n,d.uniforms.size.value.y=1/e,d.uniforms.step.value.x=1/Math.round(p/Zo),d.uniforms.step.value.y=1/Math.round(m/Oa),d.uniforms.flip.value=s,d.needsUpdate=!0)},[u,h,f,d,n,e,p,m,s]);const{position:_,uv:v}=Ke.useMemo(()=>oB(n,e),[n,e]);return be.jsxs("mesh",{children:[be.jsxs("bufferGeometry",{children:[be.jsx("bufferAttribute",{attach:"attributes-position",args:[_,3]}),be.jsx("bufferAttribute",{attach:"attributes-uv",args:[v,2]})]}),be.jsx("primitive",{object:d,attach:"material"})]})}function P1({store:n,children:e}){return be.jsx(LU.Provider,{value:n,children:e})}function D1({width:n,height:e}){const t=Ke.useContext(LU),[r,i,s]=DU(t,Ph(o=>[o.char,o.color,o.bg,o.render]));return n>0&&e>0&&be.jsx(vp,{char:r.slice(),color:i.slice(),bg:s.slice(),width:n,height:e})}function aB({x:n,y:e,width:t,height:r,debug:i,...s}){const o=kn.DRAW_CHAR_WIDTH(),a=kn.DRAW_CHAR_HEIGHT();return be.jsx(d$e,{...s,args:[t*o,r*a],position:[(n??0)*o+t*o*.5,(e??0)*a+r*a*.5,0],children:be.jsx("meshBasicMaterial",{transparent:!0,opacity:i?.7:0,color:"red"})})}function ch({x:n,y:e,letters:t,onToggle:r}){const i=Wl(),[s,o]=Ke.useState(!1),a=Ke.useCallback(()=>o(!1),[o]);if(i.x=n,i.y=e,ei(s?"$176$176$176$176$176":"$178$178$178$178$178",i,!1),i.x=n,i.y=e+1,ei(s?"$176$177$177$177$176":"$178$177$177$177$178",i,!1),i.x=n,i.y=e+2,ei(s?"$176$176$176$176$176":"$178$178$178$178$178",i,!1),t){const l=f_(t,1e4,1)?.measuredwidth??t.length;i.x=n+Math.round(2.5-l*.5),i.y=e,ei(t,i,!1)}return be.jsx(aB,{x:n,y:e,width:5,height:3,onPointerDown:()=>{r(),o(!0)},onPointerUp:a,onPointerLeave:a,onPointerCancel:a})}function PHe({width:n,height:e}){const{keyboardalt:t,keyboardctrl:r,keyboardshift:i}=ad(),s=n-18,o=n-12,a=n-6,c=1,l=Math.floor(e*.5)-2,u=e-4,h=Math.round(n*.5)-3,f=ii();return be.jsxs(be.Fragment,{children:[be.jsx(ch,{x:0,y:c,letters:r?kA.toUpperCase():kA.toLowerCase(),onToggle:()=>{r?ur(0,Ct.CTRL):xr(0,Ct.CTRL),ad.setState({keyboardctrl:!r})}}),be.jsx(ch,{x:6,y:c+1,letters:t?"ALT":"alt",onToggle:()=>{t?ur(0,Ct.ALT):xr(0,Ct.ALT),ad.setState({keyboardalt:!t})}}),be.jsx(ch,{x:12,y:c,letters:i?"SHIFT":"shift",onToggle:()=>{i?ur(0,Ct.SHIFT):xr(0,Ct.SHIFT),ad.setState({keyboardshift:!i})}}),be.jsx(ch,{x:s,y:c,letters:"tab",onToggle:()=>{xr(0,Ct.MENU_BUTTON),ur(0,Ct.MENU_BUTTON)}}),be.jsx(ch,{x:o,y:c+1,letters:"enter",onToggle:()=>{xr(0,Ct.OK_BUTTON),ur(0,Ct.OK_BUTTON)}}),be.jsx(ch,{x:a,y:c,letters:"esc",onToggle:()=>{xr(0,Ct.CANCEL_BUTTON),ur(0,Ct.CANCEL_BUTTON)}}),be.jsx(ch,{x:1,y:u-1,letters:"?",onToggle:()=>{Jb(qe,f)}}),be.jsx(ch,{x:7,y:u,letters:"#",onToggle:()=>{Jb(qe,f,"#")}}),be.jsx(ch,{x:13,y:u-1,letters:"c",onToggle:()=>{d6(qe,f,"")}}),be.jsx(ch,{x:a,y:u-1,letters:"$meta+p",onToggle:()=>{g6(qe,f)}}),be.jsx(ch,{x:h,y:c,letters:"$24",onToggle:()=>{xr(0,Ct.MOVE_UP),ur(0,Ct.MOVE_UP)}}),be.jsx(ch,{x:h,y:u,letters:"$25",onToggle:()=>{xr(0,Ct.MOVE_DOWN),ur(0,Ct.MOVE_DOWN)}}),be.jsx(ch,{x:n-5,y:l,letters:"$26",onToggle:()=>{xr(0,Ct.MOVE_RIGHT),ur(0,Ct.MOVE_RIGHT)}}),be.jsx(ch,{x:0,y:l,letters:"$27",onToggle:()=>{xr(0,Ct.MOVE_LEFT),ur(0,Ct.MOVE_LEFT)}})]})}function Bre(){ur(0,Ct.MOVE_UP),ur(0,Ct.MOVE_DOWN),ur(0,Ct.MOVE_LEFT),ur(0,Ct.MOVE_RIGHT)}function DHe(n){const{keyboardshift:e,keyboardctrl:t,keyboardalt:r}=ad.getState();switch(r?xr(0,Ct.ALT):ur(0,Ct.ALT),t?xr(0,Ct.CTRL):ur(0,Ct.CTRL),e?xr(0,Ct.SHIFT):ur(0,Ct.SHIFT),Bre(),n){case 0:xr(0,Ct.MOVE_LEFT);break;case 45:xr(0,Ct.MOVE_UP),xr(0,Ct.MOVE_LEFT);break;case 90:xr(0,Ct.MOVE_UP);break;case 135:xr(0,Ct.MOVE_UP),xr(0,Ct.MOVE_RIGHT);break;case 180:xr(0,Ct.MOVE_RIGHT);break;case 225:xr(0,Ct.MOVE_DOWN),xr(0,Ct.MOVE_RIGHT);break;case 270:xr(0,Ct.MOVE_DOWN);break;case 315:xr(0,Ct.MOVE_DOWN),xr(0,Ct.MOVE_LEFT);break;case 360:xr(0,Ct.MOVE_LEFT);break}}const LHe=Cx/1e3,aw=new zn,BI=new zt;function rD(n,e){const t=kn.DRAW_CHAR_WIDTH(),r=kn.DRAW_CHAR_HEIGHT(),i=BI.x+t*.5,s=BI.y+r*.5;return{cx:Math.floor(n*.5)+Math.floor(i/t),cy:Math.floor(e*.5)+Math.floor(s/r)}}const UHe=4;function BHe({width:n,height:e,onUp:t,onDrawStick:r}){const[i]=Ke.useState({startx:-1,starty:-1,tipx:-1,tipy:-1,pointerid:-1,inputacc:Cx});function s(){i.startx=-1,i.starty=-1,i.tipx=-1,i.tipy=-1,i.pointerid=-1,t(),Bre()}return s_((o,a)=>{if(i.inputacc+=a,i.inputacc>=LHe&&i.pointerid!==-1){i.inputacc=0;const{cx:c,cy:l}=rD(n,e);if(aw.set(i.startx-c,i.starty-l),aw.length()>UHe){const u=c6(wY(aw.angle()),45);DHe(u)}}}),be.jsx(aB,{width:n,height:e,onPointerDown:o=>{if(i.pointerid===-1){o.intersections[0].object.worldToLocal(BI.copy(o.intersections[0].point));const{cx:a,cy:c}=rD(n,e);i.startx=a,i.starty=c,i.tipx=-1,i.tipy=-1,i.pointerid=o.pointerId,i.inputacc=Cx}},onPointerMove:o=>{if(o.pointerId===i.pointerid&&o.intersections[0]){o.intersections[0].object.worldToLocal(BI.copy(o.intersections[0].point));const{cx:a,cy:c}=rD(n,e);aw.set(i.startx-a,i.starty-c),aw.length()>2&&(i.tipx=a,i.tipy=c,r(i.startx,i.starty,i.tipx,i.tipy))}},onPointerUp:s,onPointerLeave:s,onPointerCancel:s})}const ab=new zn,FHe=177,jHe=Ft.WHITE,zHe=Ft.DKPURPLE,FH="tap to toggle ";function $He({width:n,height:e,onReset:t}){const r=Wl();i3(r,FHe,jHe,zHe);const i=Math.floor(n*.333),s=Math.round(n*.666);for(let o=1;o<e;++o)for(let a=i;a<=s;++a)qo(r,n,e,a,o,{char:176});for(let o=0;o<n;++o){const a=o-(n-FH.length);qo(r,n,e,o,0,{char:a<0?32:FH.charCodeAt(a),color:Ft.WHITE,bg:Ft.ONCLEAR})}return be.jsxs(be.Fragment,{children:[be.jsx("group",{position:[0,-4*kn.DRAW_CHAR_HEIGHT(),-1],children:be.jsx(L3,{width:n,height:5,left:0,top:6,right:n-1,bottom:6,alpha:.45})}),be.jsx(aB,{x:0,y:-3,width:n,height:4,onPointerDown:()=>{ad.setState(o=>({...o,sidebaropen:!o.sidebaropen}))}}),be.jsx(PHe,{width:n,height:e}),be.jsx(BHe,{width:n,height:e,onUp:t,onDrawStick:(o,a,c,l)=>{for(let d=0;d<11;++d)r.x=o-5,r.y=a-5+d,ei("$dkblue$177$177$177$177$177$177$177$177$177$177$177",r,!1);const u=4;ab.x=c-o,ab.y=l-a;const h=c6(wY(ab.angle()),45),f=TY(h);ab.x=Math.cos(f)*u,ab.y=Math.sin(f)*u;for(let d=0;d<3;++d)r.x=o+Math.round(ab.x)-1,r.y=a+Math.round(ab.y)-1+d,ei("$dkblue$219$219$219",r,!1)}})]})}function VHe({width:n,height:e}){const[t,r]=Ke.useState(0),i=yg(),s=R1(n,e,32,Ft.WHITE,Ft.DKPURPLE),o={...h_(n,e,Ft.WHITE,Ft.DKPURPLE),...s.getState()};return i.cols<10||i.rows<10?null:be.jsxs(P1,{store:s,children:[be.jsx(bC.Provider,{value:o,children:be.jsx($He,{width:n,height:e,onReset:()=>{r(Math.random())}},t)}),be.jsx(D1,{width:n,height:e})]})}const Fre=Ke.createContext({cols:1,rows:1,marginx:1,marginy:1});function yg(){return Ke.useContext(Fre)}function HHe({children:n}){const{viewport:e}=jc(),{width:t,height:r}=e.getCurrentViewport(),{saferows:i,islandscape:s,showtouchcontrols:o}=ad(),a=t/kn.DRAW_CHAR_WIDTH();let c=Math.floor(a);const l=r/kn.DRAW_CHAR_HEIGHT();let u=Math.floor(l);const h=(t-c*kn.DRAW_CHAR_WIDTH())*.5,f=(r-u*kn.DRAW_CHAR_HEIGHT())*.5;let d=0,p=0;const m=Math.round(a);let _=Math.round(l);if(o)if(s)d=5*kn.DRAW_CHAR_WIDTH(),c-=10;else{i<u?u=i:u=u-20;const v=u-1;_-=u,p=v*kn.DRAW_CHAR_HEIGHT()}return Ke.useEffect(()=>{ad.setState(v=>({...v,insetcols:m,insetrows:_}))},[m,_]),be.jsx(Fre.Provider,{value:{cols:c,rows:u,marginx:h,marginy:f},children:c>=10&&u>=10&&be.jsx("group",{"scale-x":-1,"rotation-z":Math.PI,children:be.jsxs("group",{position:[t*-.5+h,r*-.5+f,0],children:[be.jsx("group",{position:[d,0,0],children:n}),o&&be.jsx("group",{position:[0,p,3],children:be.jsx(VHe,{width:m,height:_},m*_)})]})})})}const __=Ke.createContext({sendmessage(){},sendclose(){},didclose(){}}),jH={input:{color:"$white",active:"$yellow"}};function Kl(n){return n?jH.input.active:jH.input.color}function cB(n,e){return`vm:${n}:${e}`}function Iw(n,e,t=0,r=""){return`${n.substring(0,e)}${r}${n.substring(e+t)}`}function Mu(n,e,t){he(e)&&(t.x=n?1:0,t.y=e,t.disablewrap=!0)}const Sv=32,jre=8,H4=new zt;function GHe(){const n=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),t=Math.floor(H4.x/n),r=Math.floor(H4.y/e);return{x:Math.round(Sv*.5+t),y:Math.round(jre*.5+r)}}function WHe({sidebar:n,chip:e,row:t,label:r,args:i,context:s}){Mu(n,t,s);const[o]=[mp(i[0],"")],a=Jv(e,o),l=_C(a)??0,u=Ef(),[h,f]=Ke.useState(!1);Ke.useLayoutEffect(()=>{f(!0)},[]);const d=`${l}`.padStart(3,"0"),p=r.trim(),m=s.x-1,_=s.y+2,v=[`$green${p} ${d}
$white`];for(let U=0;U<256;++U)if(U%Sv===0&&v.push(`
`),U===l){const B=u?"$green$onwhite":"$white$ongreen";v.push(`${B}$${U}$white$ondkblue`)}else v.push(`$${U}`);v.push(`

`),v.push(`$greenpress C to copy ${d}`),v.push(`

`),v.push(`$greenpress B to copy bits of ${d}`);const S=v.join("");ei(S,s,!0);const b=Ke.useContext(__),T=Ke.useCallback(()=>{l>=Sv&&gu(a,l-Sv)},[a,l]),w=Ke.useCallback(()=>{l>0&&gu(a,l-1)},[a,l]),R=Ke.useCallback(()=>{l<255&&gu(a,l+1)},[a,l]),C=Ke.useCallback(()=>{l<=255-Sv&&gu(a,l+Sv)},[a,l]),N=Ke.useCallback(()=>{b.sendclose()},[b]);return be.jsx("group",{position:[m*kn.DRAW_CHAR_WIDTH(),_*kn.DRAW_CHAR_HEIGHT(),1],children:h&&be.jsxs(iy,{blockhotkeys:!0,children:[be.jsx(Km,{x:1,blocking:!0,visible:!1,cursor:"pointer",width:Sv,height:jre,onClick:U=>{U.intersections[0].object.worldToLocal(H4.copy(U.intersections[0].point));const B=od(GHe(),Sv);B>=0&&B<=255&&(gu(a,B),b.sendclose())}}),be.jsx(Ao,{MOVE_LEFT:w,MOVE_UP:T,MOVE_RIGHT:R,MOVE_DOWN:C,OK_BUTTON:N,CANCEL_BUTTON:N,keydown:U=>{switch(U.key.toLowerCase()){case"c":lx(qe,ii(),`${l}`),b.sendclose();break;case"b":{const{charset:$}=ya.getState();let I="";const L=hme($,l);for(let P=0;P<L.length;++P)P%8===0&&(I+=`@char${l} `),I+=L[P]?"X":"-",P%8===7&&(I+=`
`);lx(qe,ii(),I),b.sendclose();break}}}})]})})}const EE=8,zre=2,G4=new zt;function qHe(){const n=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),t=Math.floor(G4.x/n),r=Math.floor(G4.y/e);return{x:Math.round(EE*.5+t),y:Math.round(zre*.5+r)}}function YHe(n){switch(n){case"dkyellow":return", brown";case"ltgray":return", ltgrey, gray, grey";case"dkgray":return", dkgrey, ltblack";case"ondkyellow":return", onbrown";case"onltgray":return", onltgrey, ongray, ongrey";case"ondkgray":return", ondkgrey, onltblack";case"bldkyellow":return", blbrown";case"blltgray":return", blltgrey, blgray, blgrey";case"bldkgray":return", bldkgrey, blltblack"}return""}const KHe=[...ax(0,15),...ax(33,48)],XHe=[...ax(0,15),32];function zH({sidebar:n,chip:e,row:t,label:r,args:i,context:s,isbg:o=!1}){Mu(n,t,s);const[a]=[mp(i[0],"")],c=Jv(e,a),u=_C(c)??0,h=Ef(),[f,d]=Ke.useState(!1);Ke.useLayoutEffect(()=>{d(!0)},[]);const p=o?XHe:KHe,m=p.indexOf(u),_=`${u}`.padStart(2,"0"),v=r.trim(),S=(Ft[u]||Ft[Ft.BLACK]).toLowerCase(),b=YHe(S).padEnd(32," "),T=s.x-1,w=s.y+2,R=[`$green${v} ${_} ${S}${b}
$white`];for(let P=0;P<p.length;++P){P%EE===0&&R.push(`
`);const H=p[P],X=(Ft[H]||Ft[Ft.BLACK]).toLowerCase();if(H===u)if(h){const G=P%16<8?"white":"black";R.push(H>32?"$onwhite$219":`$${G}$219`)}else R.push(`$onblack$${X}$219`);else R.push(`$onblack$${X}$219`)}R.push("$white"),R.push(`

`),R.push(`$greenpress C to copy ${_}`),R.push(`

`),R.push(`$greenpress B to copy bits of ${_}`),ei(R.join(""),s,!0);const C=Ke.useContext(__),N=Ke.useCallback(P=>{const H=p[Ri(P,0,p.length-1)];gu(c,H)},[p,c]),U=Ke.useCallback(()=>{N(m-EE)},[N,m]),B=Ke.useCallback(()=>{N(m-1)},[N,m]),$=Ke.useCallback(()=>{N(m+1)},[N,m]),I=Ke.useCallback(()=>{N(m+EE)},[N,m]),L=Ke.useCallback(()=>{C.sendclose()},[C]);return be.jsx("group",{position:[T*kn.DRAW_CHAR_WIDTH(),w*kn.DRAW_CHAR_HEIGHT(),1],children:f&&be.jsxs(iy,{blockhotkeys:!0,children:[be.jsx(Km,{x:1,blocking:!0,visible:!1,cursor:"pointer",width:EE,height:zre,onClick:P=>{P.intersections[0].object.worldToLocal(G4.copy(P.intersections[0].point));const H=qHe(),X=od(H,EE);X>=0&&X<=16&&(gu(c,X),C.sendclose())}}),be.jsx(Ao,{MOVE_LEFT:B,MOVE_UP:U,MOVE_RIGHT:$,MOVE_DOWN:I,OK_BUTTON:L,CANCEL_BUTTON:L,keydown:P=>{switch(P.key.toLowerCase()){case"c":lx(qe,ii(),`${u}`),C.sendclose();break;case"b":{if(u!==Ft.ONCLEAR){const X=u<Ft.ONCLEAR?u:u-Ft.BLBLACK,G=ya.getState().palettedata?.[X],Y=Math.round((G?.r??0)*255),J=Math.round((G?.g??0)*255),Q=Math.round((G?.b??0)*255),z=`@color${X} ${Y} ${J} ${Q}`;lx(qe,ii(),z),C.sendclose()}break}}}})]})})}function ZHe({sidebar:n,item:e,row:t,context:r}){Mu(n,t,r);const i=Ip(r),s=OU(e);if(he(s)){const o=i.width-3,c=f_(s,o,3)?.measuredwidth??1,l=Ri(Math.floor(o*.5-c*.5),0,o);ei(`${" ".repeat(l)}$WHITE${s}${he(t)?`
`:""}`,r,!0)}else ei(`${e}${he(t)?`
`:""}`,r,!0);return null}function JHe({sidebar:n,row:e,active:t,label:r,args:i,context:s}){const o=Ke.useContext(__),a=Ke.useCallback(()=>{const[,...l]=i;lx(qe,ii(),l.join(" ")),o.sendclose()},[i,o]),c=Kl(!!t);return Mu(n,e,s),ei(`  $purple$16 $yellowCOPYIT ${c}${r}`,s,!0),t&&be.jsx(Ao,{OK_BUTTON:a})}function QHe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Mu(n,t,o);const[a,c,l,u,...h]=s.map(b=>mp(b,"")),f=l||` ${c.toUpperCase()} `,d=Kl(r),p=o.x-.25,m=o.y-.25,_=`${o.iseven?"$black$onltgray":"$black$ondkcyan"}${f}${d}$onclear ${i}${he(t)?`
`:""}`;ei(_,o,!0);const v=Ke.useContext(__),S=Ke.useCallback(()=>{v.sendmessage(cB(e,a),h),u||v.sendclose()},[e,v,a,u,h]);return be.jsxs("group",{position:[p*kn.DRAW_CHAR_WIDTH(),m*kn.DRAW_CHAR_HEIGHT(),1],children:[be.jsx(Km,{visible:!1,width:f.length+.5,height:1.5,blocking:!0,onClick:S}),r&&be.jsx(Ao,{OK_BUTTON:S}),c&&be.jsx(Vb,{hotkey:c,children:S})]})}function eGe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Mu(n,t,o);const a=s.map(d=>mp(d,"")),[c,...l]=a,u=Kl(r);ei(`  $purple$16 ${u}${i}
`,o,!0);const h=Ke.useContext(__),f=Ke.useCallback(()=>{h.sendmessage(cB(e,c),l),h.sendclose()},[h,e,c,l]);return r&&be.jsx(Ao,{OK_BUTTON:f})}const dk=-111111;function tGe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Mu(n,t,o);const[a,c,l]=[mp(s[0],""),Rb(s[1],dk),Rb(s[2],dk)];let u,h;c===dk?(u=0,h=31):l===dk?(u=0,h=c):(u=c,h=l);const f=Jv(e,a),d=_C(f),p=d??0,m=Ef(),[_,v]=Ke.useState(""),[S,b]=Ke.useState(0),[T,w]=Ke.useState(!1);let R=`${p}`;const C=i.trim(),N=Kl(r);T&&(R=m?Iw(_,S,1,"$219+"):_),o.writefullwidth=32,ei(` # ${N}${C} $green${R}`,o,!1),o.writefullwidth=void 0;const U=Ke.useCallback(I=>{const L=I.alt?10:1;gu(f,Math.min(h,p+L))},[h,p,f]),B=Ke.useCallback(I=>{const L=I.alt?10:1;gu(f,Math.max(u,p-L))},[u,p,f]),$=Ke.useCallback(()=>{w(I=>{const L=!I;if(L){const P=`${d}`;v(P),b(P.length)}else{const P=parseFloat(_),H=isNaN(P)?0:P;gu(a,Math.min(h,Math.max(u,H)))}return L})},[h,u,_,a,d]);return d!==void 0&&be.jsxs(be.Fragment,{children:[r&&!T&&be.jsx(Ao,{MOVE_LEFT:B,MOVE_RIGHT:U,OK_BUTTON:$}),T&&be.jsxs(iy,{blockhotkeys:!0,children:[be.jsx(Vb,{hotkey:"ctrl+c",children:()=>{console.info("copy")}}),be.jsx(Vb,{hotkey:"ctrl+v",children:()=>{console.info("paste")}}),be.jsx(Vb,{hotkey:"ctrl+a",children:()=>{console.info("select all")}}),be.jsx(Ao,{MOVE_LEFT:()=>{b(I=>Math.max(0,I-1))},MOVE_RIGHT:()=>{b(I=>Math.min(_.length,I+1))},CANCEL_BUTTON:$,OK_BUTTON:$,keydown:I=>{switch(cr(I.key)){case"delete":_.length>0&&v(L=>Iw(L,S,1));break;case"backspace":S>0&&(v(L=>Iw(L,S-1,1)),b(L=>Math.max(0,L-1)));break}I.key.length===1&&_.length<o.width*.5&&(v(L=>Iw(L,S,0,I.key)),b(L=>L+1))}})]})]})}function nGe({sidebar:n,row:e,active:t,label:r,args:i,context:s}){const o=Ke.useCallback(()=>{const[,c,...l]=i,u=l.join(" "),h=ii();setTimeout(()=>{switch(c){case"wiki":oo(qe,h,async()=>{const f=await UU(u);qU(h,f)});break;case"inline":window.location.href=u;break;default:window.open(`${c} ${u}`.trim(),"_blank");break}},100)},[i]),a=Kl(!!t);return Mu(n,e,s),ei(`  $purple$16 $yellowOPENIT ${a}${r}`,s,!0),t&&be.jsx(Ao,{OK_BUTTON:o})}function rGe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Mu(n,t,o);const[a,c,l]=[mp(s[0],""),mp(s[1],""),mp(s[2],"")];let u,h;c===""?(u="L ",h=" H"):l===""?(u="L ",h=` ${c}`):(u=`${c} `,h=` ${l}`);const f=0,d=8,p=Jv(e,a),_=_C(p)??0,v=Ef(),S=i.trim(),b=Kl(r);ei(`$red $29 ${b}${S} `,o,!1);const w=Iw("----:----",_,1,`$green${r?v?"$26":"$27":"$4"}${b}`).replaceAll("-","$7").replaceAll(":","$9");ei(`${b}${u}${w}${h} $green${_+1}`,o,!1);const R=Ke.useCallback(N=>{const U=N.alt?10:1;gu(p,Math.min(d,_+U))},[d,_,p]),C=Ke.useCallback(N=>{const U=N.alt?10:1;gu(p,Math.max(f,_-U))},[f,_,p]);return be.jsx(be.Fragment,{children:r&&be.jsx(Ao,{MOVE_LEFT:C,MOVE_RIGHT:R})})}function iGe({sidebar:n,row:e,active:t,label:r,args:i,context:s}){const o=Ke.useContext(__),a=Ke.useCallback(()=>{const[,...l]=i;o.sendclose(),setTimeout(()=>{d6(qe,ii(),l.join(" "))},1e3)},[i,o]),c=Kl(!!t);return Mu(n,e,s),ei(`  $purple$16 $cyanRUNIT ${c}${r}`,s,!0),t&&be.jsx(Ao,{OK_BUTTON:a})}function sGe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Mu(n,t,o);const[a,...c]=[mp(s[0],""),...s.slice(1)],l=[],u=[];for(let w=0;w<c.length;w+=2)l.push(c[w]),u.push(c[w+1]);const h=Jv(e,a),d=`${_C(h)??0}`;let p=u.indexOf(d);p<0&&(p=0);const m=Ef(),_=i.trim(),v=Kl(r);ei(`$dkred ? ${v}${_} `,o,!1);const S=r?m?"$26":"$27":"/";ei(`${p+1}$green${S}${v}${u.length}`,o,!1),o.writefullwidth=32,ei(` $green${l[p]}`,o,!1),o.writefullwidth=void 0;const b=Ke.useCallback(()=>{const w=Math.max(0,p-1),R=parseFloat(u[w]);Number.isInteger(R)&&gu(h,R)},[p,h]),T=Ke.useCallback(()=>{const w=Math.min(u.length-1,p+1),R=parseFloat(u[w]);Number.isInteger(R)&&gu(h,R)},[p,h]);return be.jsx(be.Fragment,{children:r&&be.jsx(Ao,{MOVE_LEFT:b,MOVE_RIGHT:T})})}function oGe({sidebar:n,chip:e,row:t,active:r,label:i,args:s,context:o}){Mu(n,t,o);const a=mp(s[0],""),c=Jv(e,a),l=FQ(c),u=l?.toJSON()??"",h=Ef(),[f,d]=Ke.useState(0),[p,m]=Ke.useState(!1),[_,v]=Ke.useState(void 0),S=`${u} `,b=i.trim(),T=Kl(r);ei(`$green $20 ${T}${b} $green`,o,!1);const w=o.x,C=o.y*o.width;o.writefullwidth=32,ei(`${S}`,o,!1),o.writefullwidth=void 0;const N=he(_),U=o.width-w-2,B=N?Math.min(_,f):f;let $=N?Math.max(_,f):f;N&&($!==B&&$===f&&--$,Tx(w+B+C,w+$+C,15,8,o)),p&&h&&r3(w+f+C,"",o);function I(){he(l)&&(d(B),v(void 0),l.delete(B,$-B+1))}return be.jsxs(be.Fragment,{children:[r&&be.jsx(Ao,{OK_BUTTON:()=>{l&&(m(!0),d(l.length),v(void 0))}}),p&&be.jsx(iy,{blockhotkeys:!0,children:be.jsx(Ao,{MOVE_LEFT:L=>{L.shift?he(_)||v(Ri(f-1,0,u.length)):v(void 0),d(P=>Ri(P-1,0,u.length))},MOVE_RIGHT:L=>{L.shift?he(_)||v(f):v(void 0),d(P=>Ri(P+1,0,u.length))},CANCEL_BUTTON:()=>{m(!1),d(u.length),v(void 0)},OK_BUTTON:()=>m(!1),keydown:L=>{if(!l)return;const{key:P}=L,H=cr(P),X={alt:L.altKey,ctrl:o1?L.metaKey:L.ctrlKey,shift:L.shiftKey},G=l.toJSON();switch(H){case"delete":N?I():G.length>0&&l.delete(f,1);break;case"backspace":N?I():f>0&&(l.delete(f-1,1),d(Y=>Math.max(0,Y-1)));break;default:if(X.ctrl)switch(H){case"a":v(0),d(G.length);break;case"c":he(da())&&da().writeText(l.toJSON()).catch(Y=>console.error(Y));break;case"v":he(da())&&da().readText().then(Y=>{N&&I(),l.insert(f,Y),d(f+Y.length)}).catch(Y=>console.error(Y));break;case"x":he(da())&&da().writeText(l.toJSON()).then(()=>I()).catch(Y=>console.error(Y));break}else X.alt||L.key.length===1&&G.length<U&&(l.insert(f,L.key),d(Y=>Y+1));break}}})})]})}function aGe({sidebar:n,row:e,active:t,label:r,args:i,context:s}){const{setviewimage:o}=ya(),a=Ke.useCallback(()=>{const[,...l]=i,u=l.join(" ");o(u)},[o,i]),c=Kl(!!t);return Mu(n,e,s),ei(`  $purple$16 $cyanVIEWIT ${c}${r}`,s,!0),t&&be.jsx(Ao,{OK_BUTTON:a})}function cGe({chip:n,row:e,active:t,label:r,args:i,context:s}){Mu(!1,e,s);const[o]=[mp(i[0],"")],a="z",c=` ${a.toUpperCase()} `,l=Kl(t),u=s.x-.25,h=s.y-.25;ei(`${s.iseven?"$black$onltgray":"$black$ondkcyan"}${c}${l}$onclear ${r}${he(e)?`
`:""}`,s,!0);const f=Ke.useContext(__),d=Ke.useCallback(()=>{f.sendmessage(cB(n,o),[])},[f,n,o]);return be.jsxs("group",{position:[u*kn.DRAW_CHAR_WIDTH(),h*kn.DRAW_CHAR_HEIGHT(),1],children:[be.jsx(Km,{visible:!1,width:c.length+.5,height:1.5,blocking:!0,onClick:d}),t&&be.jsx(Ao,{OK_BUTTON:d}),be.jsx(Vb,{hotkey:a,children:d})]})}function lGe({sidebar:n,row:e,item:t,active:r}){const i=ii(),s=Wl();if(Mu(n,e,s),s.iseven=s.y%2===0,typeof t=="string")return be.jsx(ZHe,{sidebar:n,player:i,item:t,row:e,context:s});if(sr(t)){const[o,a,c,l,...u]=t;if(typeof o!="string"||typeof a!="string"||typeof c!="string")return null;const h={sidebar:n,player:i,chip:o,row:e,active:r,label:a,args:[c,...u],context:s},f=un(l)?l:"";switch(cr(f)){default:case"hyperlink":return be.jsx(eGe,{...h});case"hk":case"hotkey":return be.jsx(QHe,{...h});case"rn":case"range":return be.jsx(rGe,{...h});case"sl":case"select":return be.jsx(sGe,{...h});case"nm":case"number":return be.jsx(tGe,{...h});case"tx":case"text":return be.jsx(oGe,{...h});case"copyit":return be.jsx(JHe,{...h});case"openit":return be.jsx(nGe,{...h});case"viewit":return be.jsx(aGe,{...h});case"runit":return be.jsx(iGe,{...h});case"zssedit":return be.jsx(cGe,{...h});case"charedit":return be.jsx(WHe,{...h});case"coloredit":return be.jsx(zH,{...h});case"bgedit":return be.jsx(zH,{isbg:!0,...h})}}return null}function $re({inline:n=!1,xmargin:e=1,ymargin:t=1,selected:r=-1,width:i,height:s,color:o,bg:a,text:c}){const l=R1(i,s,0,o,a),u=l.getState(),h={...h_(i,s,o,a,t,e,i-e-1,s-t),...l.getState(),x:e,y:t};return i3(u,0,o,a),be.jsxs(P1,{store:l,children:[be.jsx(D1,{width:i,height:s}),be.jsx(bC.Provider,{value:h,children:c.map((f,d)=>be.jsx(lGe,{row:n?void 0:d,item:f,active:d===r,sidebar:e!==0},d))})]})}const $H=4,uGe=o1?.25:.5;function hGe(n){const e=Ri(n,-$H,$H);return Math.floor(e*uGe)}function lB({debug:n=!1,disabled:e=!1,blocking:t=!0,cursor:r="pointer",x:i=0,y:s=0,width:o=30,height:a=10,children:c,onClick:l,onScroll:u,...h}){return be.jsxs("group",{...h,children:[be.jsx(Km,{blocking:t,cursor:r,visible:n,x:i,y:s,width:o,height:a,onClick:l,onWheel:f=>{e||u?.(hGe(f.deltaY))}}),c]})}const fGe=2,dGe=14,Vre=dGe*fGe;function pGe(n){return c6(n,Vre*.5)}function mGe(n,e,t,r,i=1.235){function s(a){return Xze(a,r)}cl(n.userData,e,t,i,r,Vre*12,s),n.position[e]=pGe(n.userData[e]);const o=t-n.position.y;return Math.abs(o)<.1}function gGe({name:n,width:e,height:t,context:r}){const i=wee();for(let c=1;c<e-1;++c)c>2&&c<e-1&&qo(i,e,t,c,1,{char:205,color:15}),qo(i,e,t,c,t-1,{char:205,color:15});qo(i,e,t,e-2,0,{char:196,color:15}),qo(i,e,t,1,0,{char:205,color:15}),qo(i,e,t,2,0,{char:187,color:15}),qo(i,e,t,2,1,{char:200,color:15});for(let c=1;c<t-1;++c)qo(i,e,t,0,c,{char:179,color:15}),qo(i,e,t,e-1,c,{char:179,color:15});for(let c=2;c<t-1;++c)qo(i,e,t,1,c,{char:0,color:15}),qo(i,e,t,e-2,c,{char:0,color:15});qo(i,e,t,0,0,{char:213,color:15}),qo(i,e,t,e-1,0,{char:191,color:15}),qo(i,e,t,e-1,1,{char:181,color:15}),qo(i,e,t,0,t-1,{char:212,color:15}),qo(i,e,t,e-1,t-1,{char:190,color:15});const s=` ${n} `,a=f_(s,e,t)?.x??s.length;return r.x=Math.round(e*.5),r.x-=Math.round(a*.5),r.y++,ei(s,r,!0),null}function _Ge({store:n,children:e}){return be.jsx(xee.Provider,{value:n,children:e})}function vGe({width:n,height:e}){const t=Ke.useContext(xee),[r]=DU(t,Ph(i=>[i.dither,i.render]));return n>0&&e>0&&be.jsx(D3,{alphas:r.slice(),width:n,height:e})}function VH({x:n,y:e,color:t,on:r=232,off:i=7,alt:s}){const o=Ef(),a=wee(),c=Ke.useRef(0),l=he(s)?c.current%2===0?r:s:r;return qo(a,a.width,a.height,n,e,{char:o?l:i,color:t}),a.changed(),o&&++c.current,null}function yGe({row:n,width:e,height:t,panelwidth:r,panelheight:i,children:s}){const o=s4e(r,i,0),a=[.001,.05,.1,.2],c=.4,{dither:l}=o.getState();i4e(l);for(let u=0;u<r;++u){C2(l,r,i,u,n,c);for(let h=0;h<a.length;++h){const f=a.length-h;C2(l,r,i,u,n-f,a[h]),C2(l,r,i,u,n+f,a[h])}}return be.jsxs(be.Fragment,{children:[be.jsx(D1,{width:e,height:t}),be.jsxs("group",{position:[2*kn.DRAW_CHAR_WIDTH(),2*kn.DRAW_CHAR_HEIGHT(),0],children:[be.jsx(_Ge,{store:o,children:be.jsx(vGe,{width:r,height:i})}),s,be.jsx(VH,{x:1,y:1}),be.jsx(VH,{x:1,y:2+n,on:26,alt:27,off:45,color:12})]})]})}function uB({line:n,color:e,margin:t,y:r,leftedge:i,rightedge:s,context:o}){const a=Ef(),l=`$${(Ft[e]??"").toLowerCase()}${n.replaceAll(`
`,"").trim()}`,h=f_(l,1e4,1)?.measuredwidth??1,[f,d]=Ke.useState(0);Ke.useEffect(()=>{d(p=>a?p:(p-1)%h)},[a,h]),o.disablewrap=!0,o.active.leftedge=t,o.active.rightedge=s-t;for(let p=i+t+f;p<=s;p+=h)o.x=p,o.y=r,ei(l,o,!1);return o.active.leftedge=0,o.active.rightedge=s,o.disablewrap=!1,null}function bGe({width:n,height:e,color:t,bg:r,text:i,shouldclose:s}){const{viewport:o}=jc(),a=n-3,c=e-3,l=R1(n,e,0,t,r),u=Ke.useContext(__),h=i.length-1,f=Qr(N=>N.gadget.scrollname??""),d={...h_(n,e,t,r,0,0,n,e),...l.getState()},[p,m]=Ke.useState(()=>{const N=i.findIndex(U=>sr(U));return N>=0&&N<=8?N:0});let _=p-Math.floor(c*.5);_=Math.min(i.length-c,_),_=Math.max(0,_);const v=i.slice(_,_+c),S=p-_,b=Ke.useRef(null),T=Ke.useCallback(()=>{s&&u.didclose()},[s,u]),w=Ke.useCallback(N=>{const U=N.ctrl?h:N.alt?10:1;m(B=>Math.max(0,B-U))},[m,h]),R=Ke.useCallback(N=>{const U=N.ctrl?h:N.alt?10:1;m(B=>Math.min(h,B+U))},[m,h]),C=Ke.useCallback(N=>{m(U=>Ri(Math.round(U+N),0,h))},[m,h]);return Ke.useEffect(()=>{if(b.current&&!s){const N=o.height;b.current.position.y=N,b.current.userData.y=N,b.current.userData.vy=0}},[s]),s_(Ke.useCallback((N,U)=>{if(he(b.current)){const B=s?e*2*-kn.DRAW_CHAR_HEIGHT():0;mGe(b.current,"y",B,U)&&T()}},[s,T,e])),be.jsxs("group",{ref:b,"position-y":1e6,children:[be.jsx(lB,{blocking:!0,x:0,y:0,width:n,height:e,onScroll:N=>C(N*.5)}),be.jsxs(iy,{children:[be.jsx(Ao,{MOVE_UP:w,MOVE_DOWN:R,CANCEL_BUTTON:u.sendclose}),be.jsxs(P1,{store:l,children:[be.jsx(gGe,{name:f,width:n,height:e,context:d}),be.jsx(uB,{margin:3,color:Ft.BLUE,y:0,leftedge:0,rightedge:n,line:`
keys: $whiteup/down$green.SCROLL UP/DOWN 
$whiteesc/cancel$green.CLOSE SCROLL 
$whiteenter$green.ACTION ON SELECTED LINE 
$whitealt+up/down$green.JUMP 10 LINES 
$white$meta+up/down$green.JUMP TOP/BOTTOM $blue
`,context:d}),be.jsx(yGe,{row:S,width:n,height:e,panelwidth:a,panelheight:c,children:be.jsx($re,{width:a,height:c,xmargin:0,ymargin:0,color:t,bg:Ft.ONCLEAR,text:v,selected:S})})]})]})]})}function SGe(){const n=Tv(Ph(r=>r.pts)),e=R1(bn,wr,0,Ft.BLBLACK,Ft.ONCLEAR),t=e.getState();i3(t,32,Ft.BLBLACK,Ft.ONCLEAR);for(let r=0;r<n.length;++r){const i=n[r];qo(t,bn,wr,i.x,i.y,{char:177})}return be.jsx("group",{"position-z":100,children:be.jsx(P1,{store:e,children:be.jsx(D1,{width:bn,height:wr})})})}const FI=new zt;function HH(){const n=kn.DRAW_CHAR_WIDTH(),e=kn.DRAW_CHAR_HEIGHT(),t=Math.floor(FI.x/n),r=Math.floor((FI.y+e*.5)/e);return{x:t,y:wr*.5+r}}function EGe(){const n=hs(u=>u.inspector),[e,t]=Tv(Ph(u=>[u.cursor,u.select])),r=$M(e??0,bn),i=$M(t??e??0,bn),s={x:Math.min(r.x,i.x),y:Math.min(r.y,i.y)},o={x:Math.max(r.x,i.x),y:Math.max(r.y,i.y)},a=o.x-s.x+1,c=o.y-s.y+1;function l(){rn(Tv.getState().cursor)&&gxe(qe,ii(),s,o),Tv.setState(()=>({cursor:void 0,select:void 0}))}return be.jsxs(be.Fragment,{children:[n&&be.jsx(Km,{visible:!0,opacity:0,color:"black",x:0,y:0,z:-1,width:bn,height:wr,cursor:"pointer",onPointerDown:u=>{u.intersections[0].object.worldToLocal(FI.copy(u.intersections[0].point));const h=HH();Tv.setState(()=>({cursor:od(h,bn)}))},onPointerMove:u=>{if(he(Tv.getState().cursor)){u.intersections[0].object.worldToLocal(FI.copy(u.intersections[0].point));const h=HH();Tv.setState(()=>({select:od(h,bn)}))}},onPointerUp:l,onPointerOut:l,onPointerCancel:l}),he(e)&&be.jsxs(be.Fragment,{children:[be.jsx(Km,{x:s.x+.25,y:s.y+.25,z:100,width:a-.5,height:c-.5,color:"black",opacity:.3}),be.jsx(Km,{x:s.x,y:s.y,z:101,width:a,height:c,color:"white",opacity:.25})]})]})}function xGe(){return hs(e=>e.inspector)&&be.jsxs(be.Fragment,{children:[be.jsx(EGe,{}),be.jsx(SGe,{})]})}function hB(n,e){const t=Ke.useMemo(()=>Array.from({length:e},()=>({id:"",x:0,y:0,char:0,color:0,bg:0,stat:0})),[e]),r=Ke.useMemo(()=>{const i={};for(let c=0;c<n.length;++c)i[n[c].id]=n[c];const s=new Set(t.map(c=>c.id));let o=0,a=0;for(let c=0;c<e;++c)if(t[c].id){const l=i[t[c].id];he(l)?(t[c]={...l},a=Math.max(c,a)):t[c].id=""}else if(o<n.length){for(;s.has(n[o]?.id)===!0;)++o;o<n.length&&(t[c]={...n[o++]},a=Math.max(c,a))}return a},[n,e,t]);return[t,r]}const Hre=yx(_1(b1)),jI=Im(v1(y1)),TGe=new lo({transparent:!1,side:Ia,uniforms:{time:Ma,interval:uT,smoothrate:new hn(uC),palette:new hn(Hre),map:new hn(jI),alt:new hn(jI),dpr:new hn(1),screenwidth:new hn(1),screenheight:new hn(1),pointSize:new hn(new zn),rows:new hn(1),step:new hn(new zn),size:new hn(new zn),pixel:new hn(new zn),flip:new hn(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec4 display;
    attribute vec3 lastposition;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    ${fT}

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = palette[int(index)];
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      vVisible = visible;

      float deltaPosition = animDelta(lastposition.z, smoothrate, 1.0);
      vec2 animPosition = mix(lastposition.xy, position.xy, deltaPosition);

      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = display.xy;

      animPosition *= pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x -= 1.0;

      vec4 mvPosition = vec4(animPosition, 0.0, 1.0);
      #ifdef USE_INSTANCING
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      gl_PointSize = pointSize.y * modelViewMatrix[0][0] * dpr;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 size;
    uniform vec2 pixel;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      float xscale = pointSize.y / pointSize.x;
      float xpadding = (pointSize.y - pointSize.x) / pointSize.y;
      float px = gl_PointCoord.x * xscale - xpadding;      
      if (vVisible == 0.0 || px < 0.0 || px > 1.0) {
        discard;
      }
      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }

      vec2 idx = vec2(px, py) * size * pixel;
      vec2 lookup = vec2(vDisplay.x, rows - vDisplay.y) * step * pixel;
      vec2 uv = lookup + idx + vec2(1.0, 1.0) * pixel;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function wGe(){return cy(TGe)}const AGe=new lo({transparent:!1,side:Ia,uniforms:{time:Ma,interval:uT,smoothrate:new hn(uC),palette:new hn(Hre),map:new hn(jI),alt:new hn(jI),dpr:new hn(1),screenwidth:new hn(1),screenheight:new hn(1),pointSize:{value:new zn(1,1)},rows:new hn(1),step:new hn(new zn),size:new hn(new zn),pixel:new hn(new zn),flip:new hn(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec4 display;
    attribute vec3 lastposition;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec2 pointSize;
    uniform vec3 palette[16];
    uniform float dpr;
    uniform float screenwidth;
    uniform float screenheight;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    ${fT}

    float PI = radians(180.0);

    vec3 colorFromIndex(float index) {
      return palette[int(index)];
    }

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(index) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = colorFromIndex(index);
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }

    void main() {
      vVisible = visible;

      float deltaPosition = animDelta(lastposition.z, smoothrate, 1.0);
      vec2 animPosition = mix(lastposition.xy, position.xy, deltaPosition);

      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = display.xy;

      animPosition *= pointSize;
      animPosition += pointSize * 0.5;
      animPosition.x -= 1.0;

      // model space
      vec4 mvPosition = vec4(animPosition, 0.0, 1.0);
      #ifdef USE_INSTANCING
        mvPosition = instanceMatrix * mvPosition;
      #endif
      mvPosition = modelViewMatrix * mvPosition;
  
      // transform to screenspace 
      gl_Position = projectionMatrix * mvPosition;

      // this handles things being scaled
      float fov = 2.0 * atan(1.0 / projectionMatrix[1][1]) * 180.0 / PI;
      float heightOfNearPlane = screenheight / (2.0 * tan(0.5 * fov * PI / 180.0));
      gl_PointSize = (heightOfNearPlane * pointSize.y) / gl_Position.w;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform float rows;
    uniform vec2 step;
    uniform vec2 size;
    uniform vec2 pixel;
    uniform vec2 pointSize;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;

    void main() {
      float xscale = pointSize.y / pointSize.x;
      float xpadding = (pointSize.y - pointSize.x) / pointSize.y;
      float px = gl_PointCoord.x * xscale - xpadding;      
      
      if (vVisible == 0.0 || px < 0.0 || px > 1.0) {
        discard;
      }
      
      float py = gl_PointCoord.y;
      if (flip) {
        py = 1.0 - py;
      }

      vec2 idx = vec2(px, py) * size * pixel;
      vec2 lookup = vec2(vDisplay.x, rows - vDisplay.y) * step * pixel;
      vec2 uv = lookup + idx + vec2(1.0, 1.0) * pixel;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
        gl_FragColor.a = 1.0;
      }
    }
  `});function CGe(){return cy(AGe)}function zA({sprites:n,scale:e=1,withbillboards:t=!1,limit:r=cg}){const{viewport:i}=jc(),s=ya(G=>G.palettedata),o=ya(G=>G.spritecharsetdata),a=ya(G=>G.spritealtcharsetdata),c=Ke.useMemo(()=>t?CGe():wGe(),[t]),{width:l=0,height:u=0}=o?.image??{};Ke.useEffect(()=>{if(!o)return;const G=Zo+2,Y=Oa+2,J=Math.round(u/Y);c.uniforms.palette.value=s,c.uniforms.map.value=o,c.uniforms.alt.value=a??o,c.uniforms.dpr.value=e,c.uniforms.screenwidth.value=i.width,c.uniforms.screenheight.value=i.height,c.uniforms.rows.value=J-1,c.uniforms.step.value.x=G,c.uniforms.step.value.y=Y,c.uniforms.size.value.x=Zo,c.uniforms.size.value.y=Oa,c.uniforms.pixel.value.x=1/l,c.uniforms.pixel.value.y=1/u,c.uniforms.pointSize.value.x=kn.DRAW_CHAR_WIDTH(),c.uniforms.pointSize.value.y=kn.DRAW_CHAR_HEIGHT(),c.uniforms.flip.value=!1,c.needsUpdate=!0},[s,o,a,c,l,u,i.width,i.height,e]);const[h,f]=Ke.useState(),[d,p]=hB(n,r),m=Ke.useMemo(()=>new Uint8Array(r),[r]),_=Ke.useMemo(()=>new Float32Array(r*3),[r]),v=Ke.useMemo(()=>new Float32Array(r*3),[r]),S=Ke.useMemo(()=>new Float32Array(r*4),[r]),b=Ke.useMemo(()=>new Float32Array(r*2),[r]),T=Ke.useMemo(()=>new Float32Array(r*2),[r]),[w,R]=Ke.useState(),[C,N]=Ke.useState(),[U,B]=Ke.useState(),[$,I]=Ke.useState(),[L,P]=Ke.useState(),[H,X]=Ke.useState();return Ke.useEffect(()=>{if(!(!he(h)||!he(w)||!he(C)||!he(U)||!he($)||!he(L)||!he(H))){for(let G=0;G<d.length;++G){const Y=d[G];if(Y.id)if(w.getX(G)===0)C.setXY(G,Y.x,Y.y),$.setXYZW(G,Y.char%So,Math.floor(Y.char/So),Y.color,Y.bg),U.setXYZ(G,Y.x,Y.y,Ma.value),L.setXY(G,Y.color,Ma.value),H.setXY(G,Y.bg,Ma.value),w.setX(G,1),w.needsUpdate=!0,C.needsUpdate=!0,$.needsUpdate=!0,U.needsUpdate=!0,L.needsUpdate=!0,H.needsUpdate=!0;else{(C.getX(G)!==Y.x||C.getY(G)!==Y.y)&&(U.setXYZ(G,C.getX(G),C.getY(G),Ma.value),C.setXY(G,Y.x,Y.y),U.needsUpdate=!0,C.needsUpdate=!0);const Q=Y.char%So,z=Math.floor(Y.char/So);($.getX(G)!==Q||$.getY(G)!==z)&&($.setXY(G,Q,z),$.needsUpdate=!0),$.getZ(G)!==Y.color&&(L.setXY(G,$.getZ(G),Ma.value),$.setZ(G,Y.color),L.needsUpdate=!0,$.needsUpdate=!0),$.getW(G)!==Y.bg&&(H.setXY(G,$.getW(G),Ma.value),$.setW(G,Y.bg),H.needsUpdate=!0,$.needsUpdate=!0)}else w.getX(G)&&(w.setX(G,0),w.needsUpdate=!0)}h.computeBoundingBox(),h.computeBoundingSphere()}},[h,n,d,p,w,C,$,U,L,H]),be.jsxs("points",{frustumCulled:!1,children:[be.jsxs("bufferGeometry",{ref:f,children:[be.jsx("bufferAttribute",{ref:R,attach:"attributes-visible",name:"visible",args:[m,1]}),be.jsx("bufferAttribute",{ref:N,attach:"attributes-position",name:"position",args:[_,3]}),be.jsx("bufferAttribute",{ref:B,attach:"attributes-lastposition",name:"lastpositiona",args:[v,3]}),be.jsx("bufferAttribute",{ref:I,attach:"attributes-display",name:"display",args:[S,4]}),be.jsx("bufferAttribute",{ref:P,attach:"attributes-lastcolor",name:"lastcolor",args:[b,2]}),be.jsx("bufferAttribute",{ref:X,attach:"attributes-lastbg",name:"lastbg",args:[T,2]})]}),be.jsx("primitive",{object:c,attach:"material"})]})}function Hb({id:n,z:e,from:t}){const r=Qr(Ph(i=>i.gadget[t]?.find(s=>s.id===n)));switch(r?.type){default:case Qi.BLANK:case Qi.MEDIA:return null;case Qi.TILES:return be.jsx("group",{position:[0,0,e],children:be.jsx(vp,{width:r.width,height:r.height,char:r.char,color:r.color,bg:r.bg})},r.id);case Qi.SPRITES:return be.jsx("group",{position:[0,0,e],children:be.jsx(zA,{sprites:r.sprites})},r.id);case Qi.DITHER:return be.jsx("group",{position:[0,0,e],children:be.jsx(D3,{width:r.width,height:r.height,alphas:r.alphas})},r.id)}}const GH=n=>(n.getAttributes()&Su.CONVOLUTION)===Su.CONVOLUTION,RGe=Ke.memo(Ke.forwardRef(({children:n,camera:e,width:t,height:r},i)=>{const{gl:s,scene:o}=jc(),[a]=Ke.useMemo(()=>{const u=new kre(s,{depthBuffer:!0,stencilBuffer:!1,multisampling:0,frameBufferType:Zv});return u.autoRenderToScreen=!1,u.addPass(new Ire(o,e)),[u]},[e,s,o]);s_((u,h)=>{a.setSize(t,r),a.render(h)},1);const c=Ke.useRef(null);Ke.useLayoutEffect(()=>{const u=[],h=c.current.__r3f;if(h&&a){const f=h.children;for(let d=0;d<f.length;d++){const p=f[d].object;if(p instanceof yd){const m=[p];if(!GH(p)){let v=null;for(;(v=f[d+1]?.object)instanceof yd&&!GH(v);)m.push(v),d++}const _=new Ore(e,...m);u.push(_)}else p instanceof Dh&&u.push(p)}for(const d of u)a?.addPass(d)}return()=>{for(const f of u)a?.removePass(f)}},[a,n,e]);const l=Ke.useMemo(()=>({composer:a,normalPass:null,downSamplingPass:null,resolutionScale:void 0,camera:e,scene:o}),[a,e,o]);return Ke.useImperativeHandle(i,()=>a,[a]),be.jsx(rB.Provider,{value:l,children:be.jsx("group",{ref:c,children:n})})})),kGe=Ke.forwardRef(function({children:e,fbo:t,...r},i){const[s]=Ke.useState(()=>new SM);return Ke.useImperativeHandle(i,()=>t,[t]),be.jsxs(be.Fragment,{children:[Mpe(be.jsxs(be.Fragment,{children:[e,be.jsx("group",{onPointerOver:()=>null})]}),s),be.jsx("primitive",{object:t.texture,...r})]})});function MGe({fbo:n,effects:e}){const{mood:t}=ya(),[r]=Ke.useState(()=>new Cre(n,!0));return Ke.useEffect(()=>()=>{r.dispose()},[r]),be.jsxs(be.Fragment,{children:[t.includes("dark")&&be.jsxs(Ke.Fragment,{children:[be.jsx($Ve,{delay:new zn(10,120),duration:new zn(.1,3),strength:new zn(0,.15),mode:Rv.SPORADIC,active:!0,ratio:.5}),be.jsx(VVe,{opacity:.5,premultiply:!0,blendFunction:di.DARKEN})]},"mood"),t.includes("bright")&&be.jsx(Ke.Fragment,{children:be.jsx(zVe,{intensity:.111,mipmapBlur:!1,luminanceThreshold:.5,luminanceSmoothing:.001,kernelSize:qC.VERY_LARGE})},"mood"),e,be.jsx("primitive",{object:r,dispose:null})]})}function U3({camera:n,viewwidth:e,viewheight:t,effects:r,children:i}){const{mood:s}=ya(),{viewport:o}=jc(),a=Tre(e*o.dpr,t*o.dpr,{samples:0,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),c=e*.5,l=t*.5;return be.jsx(be.Fragment,{children:be.jsxs("mesh",{position:[c,l,0],children:[be.jsx("planeGeometry",{args:[e,t]}),be.jsx("meshBasicMaterial",{transparent:!0,children:be.jsxs(kGe,{attach:"map",fbo:a,children:[i,be.jsx(RGe,{camera:n,width:e,height:t,children:be.jsx(MGe,{fbo:a,effects:r})},s)]})})]})})}function IGe({width:n,height:e}){const{viewport:t}=jc(),r=yg(),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),o=n*kn.DRAW_CHAR_WIDTH(),a=e*kn.DRAW_CHAR_HEIGHT(),c=Ke.useRef(null),l=Ke.useRef(null),u=Ke.useRef(null),h=Ke.useRef(null),f=Ke.useRef(null),[,d]=Ke.useState(!1);Ke.useLayoutEffect(()=>d(!0),[]),s_((b,T)=>{if(!c.current||!h.current||!u.current||!l.current||!f.current)return;const w=g1(Qr.getState().gadget.layers??[]),R=.05,C=Qr.getState().gadget.board;he(c.current.userData.focusx)||(c.current.userData={focusx:w.focusx,focusy:w.focusy,tfocusx:w.focusx,tfocusy:w.focusy,currentboard:C},u.current.scale.setScalar(w.viewscale));const N=c.current.userData??{},U=(N.focusx+.5)*i,B=(N.focusy+.5)*s;Yv(u.current.scale,w.viewscale,R,T),Yv(l.current.position,[-U,-B,0],R,T);const $=u.current.scale.x,I=bn*i,L=wr*s;if(o>I*$)N.tfocusx=bn*.5;else{const P=o*.5/(i*$),H=bn-P;N.tfocusx=Ri(w.focusx,P-1,H+.25)}if(a>L*$)N.tfocusy=wr*.5;else{const P=a*.5/(s*$),H=wr-P;N.tfocusy=Ri(w.focusy,P-1,H)}C!==N.currentboard?(N.focusx=N.tfocusx,N.focusy=N.tfocusy,N.currentboard=C,l.current.position.set(-((N.focusx+.5)*i),-((N.focusy+.5)*s),0)):(cl(N,"focusx",N.tfocusx,R),cl(N,"focusy",N.tfocusy,R)),h.current.position.x=l.current.position.x,h.current.position.y=l.current.position.y,f.current.scale.setScalar($)}),Qr(b=>b.gadget.over?.length??0),Qr(b=>b.gadget.under?.length??0),Qr(b=>b.gadget.layers?.length??0);const{over:p=[],under:m=[],layers:_=[]}=Qr.getState().gadget,v=t.width*-.5+r.marginx,S=t.height*.5-r.marginy;return be.jsxs(be.Fragment,{children:[be.jsx("group",{position:[o*.5,a*.5,1],children:be.jsx("group",{ref:f,children:be.jsx("group",{ref:h,children:be.jsx(xGe,{})})})}),be.jsx("orthographicCamera",{ref:c,left:o*-.5,right:o*.5,top:a*-.5,bottom:a*.5,near:.1,far:2e3,position:[0,0,1e3],onUpdate:b=>b.updateProjectionMatrix()}),c.current&&be.jsx(U3,{camera:c.current,viewwidth:o,viewheight:a,effects:be.jsx(be.Fragment,{}),children:be.jsx("group",{position:[v,S,0],children:be.jsx("group",{ref:u,children:be.jsxs("group",{ref:l,children:[m.map((b,T)=>be.jsx(Hb,{from:"under",id:b.id,z:1+T*2},b.id)),_.map((b,T)=>be.jsx(Hb,{from:"layers",id:b.id,z:1+m.length+T*2},b.id)),p.map((b,T)=>be.jsx(Hb,{from:"over",id:b.id,z:1+m.length+_.length+T*2},b.id))]})})})})]})}const OGe=`
float qinticIn(float t) {
  return pow(t, 5.0);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, const in float depth, out vec4 outputColor) {
	float viewZ = perspectiveDepthToViewZ(depth, cameraNear, cameraFar);
	float linearDepth = 1.0 - viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);
  float moddedDepth = qinticIn(linearDepth);
  float shade = clamp(moddedDepth, 0.0, 1.0);
  outputColor = vec4(vec3(shade), inputColor.a);
}
`;class NGe extends yd{constructor(){super("DepthFogEffect",OGe,{blendFunction:di.MULTIPLY,attributes:Su.DEPTH})}update(){}}const PGe=hT(NGe),Gre=yx(_1(b1)),zI=Im(v1(y1)),DGe=new lo({transparent:!1,side:Ia,uniforms:{time:Ma,interval:uT,palette:new hn(Gre),map:new hn(zI),alt:new hn(zI),cols:new hn(1),step:new hn(new zn)},vertexShader:`
    precision highp float;
    uniform float time;
    uniform float interval;

    varying vec2 vUv;
    varying vec3 vColor;

    void main() {
      vUv = uv;
    
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
        vColor.xyz = instanceColor.xyz;
      	mvPosition = instanceMatrix * mvPosition;
      #endif        
      
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform vec3 palette[16];
    uniform vec2 step;
    uniform float cols;

    varying vec2 vUv;
    varying vec3 vColor;

    ${fT}

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(gl_FragCoord.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }
      
    void main() {
      // r = char, g = color, b = bg
      int tc = int(round(cols));
      int ti = int(round(vColor.r));
      float tx = float(ti % tc);
      float ty = floor(float(ti) / cols);

      int colori = int(round(vColor.g));
      int bgi = int(round(vColor.b));

      vec3 color;
      if (colori > 31) {
        vec3 bg = palette[bgi];
        color = palette[colori - 33];
        float cycle = mod(time * 2.5, interval * 2.0) / interval;
        color = mix(bg, color, cyclefromtime());
      } else {
        color = palette[colori % 16];
      }

      vec3 bg = palette[bgi];

      vec2 uv = vUv * step + vec2(tx * step.x, ty * step.y);
      uv.y = 1.0 - uv.y;

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture(alt, uv).rgb : texture(map, uv).rgb;

      if (blip.r == 0.0) {
        if (bgi >= ${Ft.ONCLEAR}) {
          discard;
        }
        color = palette[bgi];
      }

      gl_FragColor.rgb = color;
      gl_FragColor.a = 1.0;
    }
  `});function LGe(){return cy(DGe)}const UGe=new lo({transparent:!1,side:Ia,uniforms:{time:Ma,interval:uT,smoothrate:new hn(uC),palette:new hn(Gre),map:new hn(zI),alt:new hn(zI),cols:new hn(1),step:new hn(new zn),flip:new hn(!0)},vertexShader:`
    precision highp float;
    attribute float visible;
    attribute vec3 nowposition;
    attribute mat4 lastmatrix;
    attribute vec4 display;
    attribute vec2 lastcolor;
    attribute vec2 lastbg;

    uniform float smoothrate;
    uniform float time;
    uniform float interval;
    uniform vec3 palette[16];

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;
    varying vec2 vUv;

    ${fT}

    vec4 bgFromIndex(float index) {
      vec4 bg;
      if (int(round(index)) >= 16) {
        return vec4(0.0, 0.0, 0.0, 0.0);
      }
      bg.rgb = palette[int(round(index))];
      bg.a = 1.0;
      return bg;
    }

    float animDelta(float startTime, float deltaMod, float maxDelta) {
      float delta = time - startTime;
      if (delta < 0.0) {
        return maxDelta;
      }
      return clamp(delta * deltaMod, 0.0, maxDelta);
    }

    float exponentialInOut(float t) {
      return t == 0.0 || t == 1.0
        ? t
        : t < 0.5
          ? +0.5 * pow(2.0, (20.0 * t) - 10.0)
          : -0.5 * pow(2.0, 10.0 - (t * 20.0)) + 1.0;
    }

    float cyclefromtime() {
      float flux = snoise(vDisplay.xy * 5.0) * 0.05;
      float cycle = mod(time * 2.5 + flux, interval * 2.0) / interval;
      return exponentialInOut(abs(cycle - 1.0));
    }
      
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      
      vec4 mvNowPosition = instanceMatrix * mvPosition;
      vec4 mvLastPosition = lastmatrix * mvPosition;

      float deltaPosition = clamp((time - nowposition.z) * smoothrate, 0.0, 1.0);
      mvPosition = mix(mvLastPosition, mvNowPosition, deltaPosition);

      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;

      vUv = uv;
    
      float deltaColor = animDelta(lastcolor.y, smoothrate, 1.0);
      int sourceColori = int(round(lastcolor.x));
      int destColori = int(round(display.z));

      vec3 sourceColor;
      if (sourceColori > 32) {
        sourceColor = palette[sourceColori - 33];
      } else {
        sourceColor = palette[sourceColori % 16];
      }

      vec3 destColor;
      if (destColori > 32) {
        destColor = palette[destColori - 33];
      } else {
        destColor = palette[destColori % 16];
      }

      vColor = mix(sourceColor, destColor, deltaColor);

      float deltaBg = animDelta(lastbg.y, smoothrate, 1.0);
      vec4 sourceBg = bgFromIndex(lastbg.x);
      vec4 destBg = bgFromIndex(display.w);
      vBg = mix(sourceBg, destBg, deltaBg);

      if (destColori > 31) {
        vColor = mix(vBg.rgb, vColor, cyclefromtime());
      }

      vDisplay.xy = vec2(round(display.x), round(display.y));

      vVisible = visible;
    }
  `,fragmentShader:`
    precision highp float;
    uniform float time;
    uniform float interval;
    uniform sampler2D map;
    uniform sampler2D alt;
    uniform vec3 palette[16];
    uniform vec2 step;
    uniform float cols;
    uniform bool flip;

    varying float vVisible;
    varying vec2 vDisplay;
    varying vec3 vColor;
    varying vec4 vBg;
    varying vec2 vUv;
      
    void main() {
      if (vVisible == 0.0) {
        discard;
      }

      vec2 uv = vUv * step + vec2(vDisplay.x * step.x, vDisplay.y * step.y);
      if (flip) {
        uv.y = 1.0 - uv.y;
      }

      bool useAlt = mod(time, interval * 2.0) > interval;
      vec3 blip = useAlt ? texture2D(alt, uv).rgb : texture2D(map, uv).rgb;

      if (blip.r == 0.0) {
        if (vBg.a < 0.001) {
          discard;
        } else {
          gl_FragColor = vBg;
        }
      } else {
        gl_FragColor.rgb = vColor;
      }
      gl_FragColor.a = 1.0;
    }
  `});function BGe(){return cy(UGe)}const FGe=new lo({transparent:!1,side:Ia,uniforms:{color:{value:new Ti(0,0,0)},data:{value:null}},vertexShader:`
    precision highp float;
    varying float vAlpha;
  
    void main() {
      vec4 mvPosition = vec4(position, 1.0);
      #ifdef USE_INSTANCING
        vAlpha = instanceColor.x;
        mvPosition = instanceMatrix * mvPosition;
      #endif        
      mvPosition = modelViewMatrix * mvPosition;
      gl_Position = projectionMatrix * mvPosition;
    }
    `,fragmentShader:`
    precision highp float;
    uniform vec3 color;
    uniform sampler2D data;

    varying float vAlpha;

    // adapted from https://www.shadertoy.com/view/Mlt3z8
    float bayerDither2x2( vec2 v ) {
      return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
    }

    float bayerDither4x4( vec2 v ) {
      vec2 P1 = mod( v, 2.0 );
      vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
      return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
    }

    void main() {
      if (vAlpha < 1.0) {
        vec2 ditherCoord = floor( mod( gl_FragCoord.xy, 4.0 ) );
        if ( bayerDither4x4( ditherCoord ) / 16.0 >= vAlpha ) {
          discard;
        }
      }

      gl_FragColor.rgba = vec4(color.xyz, 1.0);
    }
    `});function jGe(){return cy(FGe)}const of=new Fc;function iD({sprites:n,facing:e,children:t,limit:r=cg}){const i=ya(Y=>Y.palettedata),s=ya(Y=>Y.charsetdata),o=ya(Y=>Y.altcharsetdata),[a]=Ke.useState(()=>BGe()),[c,l]=hB(n,r),{width:u=0,height:h=0}=s?.image??{};Ke.useEffect(()=>{a.uniforms.map.value=s,a.uniforms.alt.value=o??s,a.uniforms.palette.value=i;const Y=Math.round(u/Zo),J=Math.round(h/Oa);a.uniforms.cols.value=Y,a.uniforms.step.value.x=1/Y,a.uniforms.step.value.y=1/J,a.needsUpdate=!0},[i,s,o,a,u,h]);const{position:f,uv:d}=Ke.useMemo(()=>CHe(),[]),[p,m]=Ke.useState(),_=Ke.useMemo(()=>new Uint8Array(r),[r]),v=Ke.useMemo(()=>new Float32Array(r*3),[r]),S=Ke.useMemo(()=>new Float32Array(r*16),[r]),b=Ke.useMemo(()=>new Float32Array(r*4),[r]),T=Ke.useMemo(()=>new Float32Array(r*2),[r]),w=Ke.useMemo(()=>new Float32Array(r*2),[r]),[R,C]=Ke.useState(),[N,U]=Ke.useState(),[B,$]=Ke.useState(),[I,L]=Ke.useState(),[P,H]=Ke.useState(),[X,G]=Ke.useState();return Ke.useEffect(()=>{if(!he(p)||!he(R)||!he(N)||!he(B)||!he(I)||!he(P)||!he(X))return;const Y=kn.DRAW_CHAR_HEIGHT();for(let J=0;J<c.length;++J){const Q=c[J];if(Q.id){const[z,q,ee]=t(Q.x,Q.y);if(R.getX(J)===0)of.rotation.set(0,0,e),of.position.set(z,q,ee),of.updateMatrix(),p.setMatrixAt(J,of.matrix),of.position.set(z,q,ee+Y*-.8),of.updateMatrix(),B.set(of.matrix.toArray(),J*16),N.setXYZ(J,z,q,Ma.value),I.setXYZW(J,Q.char%So,Math.floor(Q.char/So),Q.color,Q.bg),P.setXY(J,Q.color,Ma.value),X.setXY(J,Q.bg,Ma.value),R.setX(J,1),R.needsUpdate=!0,N.needsUpdate=!0,B.needsUpdate=!0,I.needsUpdate=!0,P.needsUpdate=!0,X.needsUpdate=!0,p.instanceMatrix.needsUpdate=!0;else{(N.getX(J)!==z||N.getY(J)!==q||p.userData.facing!==e)&&(p.getMatrixAt(J,of.matrix),B.set(of.matrix.toArray(),J*16),N.setXYZ(J,z,q,Ma.value),of.rotation.set(0,0,e),of.position.set(z,q,ee),of.updateMatrix(),p.setMatrixAt(J,of.matrix),B.needsUpdate=!0,N.needsUpdate=!0,p.instanceMatrix.needsUpdate=!0);const ie=Q.char%So,Ee=Math.floor(Q.char/So);(I.getX(J)!==ie||I.getY(J)!==Ee)&&(I.setXY(J,ie,Ee),I.needsUpdate=!0),I.getZ(J)!==Q.color&&(P.setXY(J,I.getZ(J),Ma.value),I.setZ(J,Q.color),P.needsUpdate=!0,I.needsUpdate=!0),I.getW(J)!==Q.bg&&(X.setXY(J,I.getW(J),Ma.value),I.setW(J,Q.bg),X.needsUpdate=!0,I.needsUpdate=!0)}}else R.getX(J)&&(R.setX(J,0),R.needsUpdate=!0)}p.userData.facing=e,p.computeBoundingBox(),p.computeBoundingSphere(),p.visible=!!p.count},[n,c,e,l,p,R,B]),be.jsxs("instancedMesh",{ref:m,args:[void 0,void 0,r],children:[be.jsxs("bufferGeometry",{children:[be.jsx("bufferAttribute",{attach:"attributes-position",args:[f,3]}),be.jsx("bufferAttribute",{attach:"attributes-uv",args:[d,2]}),be.jsx("instancedBufferAttribute",{ref:C,name:"visible",usage:L0,attach:"attributes-visible",args:[_,1]}),be.jsx("instancedBufferAttribute",{ref:U,name:"nowposition",usage:L0,attach:"attributes-nowposition",args:[v,3]}),be.jsx("instancedBufferAttribute",{ref:$,name:"lastmatrix",usage:L0,attach:"attributes-lastmatrix",args:[S,16]}),be.jsx("instancedBufferAttribute",{ref:L,name:"display",usage:L0,attach:"attributes-display",args:[b,4]}),be.jsx("instancedBufferAttribute",{ref:H,name:"lastcolor",usage:L0,attach:"attributes-lastcolor",args:[T,2]}),be.jsx("instancedBufferAttribute",{ref:G,name:"lastbg",usage:L0,attach:"attributes-lastbg",args:[w,2]})]}),be.jsx("primitive",{object:a,attach:"material"})]})}function fB(n,e,t,r){return{char:n.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return 0}return Math.abs(i)}),color:e.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return Ft.ONCLEAR}return i}),bg:t.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:return Ft.ONCLEAR;case Fn.ISSOLID:return Ft.BLACK}return i})}}function dB(n,e,t,r){return{char:n.map((i,s)=>r[s]===Fn.ISSOLID?Math.abs(i):0),color:e,bg:t.map((i,s)=>r[s]===Fn.ISSOLID?i:Ft.ONCLEAR)}}function pB(n,e,t,r){return{char:n.map((i,s)=>r[s]===Fn.ISSWIM?Math.abs(i):0),color:e,bg:t.map((i,s)=>r[s]===Fn.ISSWIM?i:Ft.ONCLEAR)}}function zGe(n,e,t,r){return{char:n.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return 0}return n[s]<0?0:i}),color:e,bg:t.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return Ft.ONCLEAR}return n[s]<0?Ft.ONCLEAR:i})}}function Wre(n,e,t,r){return{char:n.map((i,s)=>r[s]===Fn.ISSWIM?0:176),color:e.map((i,s)=>r[s]===Fn.ISSWIM?0:Ft.DKGRAY),bg:t.map((i,s)=>r[s]===Fn.ISSWIM?Ft.ONCLEAR:Ft.BLACK)}}function $Ge(n,e,t,r){return{char:n.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return 0}return n[s]<0?0:176}),color:e.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return 0}return n[s]<0?0:Ft.DKGRAY}),bg:t.map((i,s)=>{switch(r[s]){case Fn.ISSWIM:case Fn.ISSOLID:return Ft.ONCLEAR}return n[s]<0?Ft.ONCLEAR:Ft.BLACK})}}const sD=new Fc,WH=new Ti;function mB({width:n,alphas:e,limit:t=cg}){const[r]=Ke.useState(()=>jGe()),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),[o,a]=Ke.useState();Ke.useEffect(()=>{if(!he(o))return;let l=0;const u=8/14;for(let h=0;h<e.length;++h){const f=$M(h,n),d=e[h];d!==0&&(sD.position.set((f.x+.5)*i-(1-u),(f.y+.5)*s,s*-.5),sD.updateMatrix(),o.setMatrixAt(l,sD.matrix),WH.set(d,0,0),o.setColorAt(l,WH),++l)}o.count=l,o.instanceMatrix.needsUpdate=!0,he(o.instanceColor)&&(o.instanceColor.needsUpdate=!0),o.computeBoundingBox(),o.computeBoundingSphere(),o.visible=!!o.count},[o,e,n,i,s]);const c=.1;return be.jsxs("instancedMesh",{ref:a,args:[void 0,void 0,t],children:[be.jsx("boxGeometry",{args:[i-c,s-c,s*2.5]}),be.jsx("primitive",{object:r,attach:"material"})]})}const oD=new Fc,qH=new Ti;function Gm({width:n,char:e,color:t,bg:r,partial:i,limit:s=cg}){const o=ya(_=>_.palettedata),a=ya(_=>_.charsetdata),c=ya(_=>_.altcharsetdata),[l]=Ke.useState(()=>LGe()),{width:u=0,height:h=0}=a?.image??{};Ke.useEffect(()=>{l.uniforms.map.value=a,l.uniforms.alt.value=c??a,l.uniforms.palette.value=o;const _=Math.round(u/Zo),v=Math.round(h/Oa);l.uniforms.cols.value=_,l.uniforms.step.value.x=1/_,l.uniforms.step.value.y=1/v,l.needsUpdate=!0},[o,a,c,l,u,h]);const{position:f,uv:d}=Ke.useMemo(()=>{const _=xHe(1,1);return i&&(_.position=_.position.map((v,S)=>S%3===2?v*i:v),_.uv=_.uv.map((v,S)=>S%2===1?v*i:v)),_},[i]),[p,m]=Ke.useState();return Ke.useEffect(()=>{if(!he(p))return;const _=kn.DRAW_CHAR_WIDTH(),v=kn.DRAW_CHAR_HEIGHT();let S=0,b=0,T=0;for(let w=0;w<e.length;++w)e[w]===0&&r[w]===Ft.ONCLEAR||(oD.position.set(S*_,b*v,0),oD.updateMatrix(),p.setMatrixAt(T,oD.matrix),qH.set(e[w],t[w],r[w]),p.setColorAt(T,qH),++T),++S,S>=n&&(S=0,++b);p.count=T,p.instanceMatrix.needsUpdate=!0,he(p.instanceColor)&&(p.instanceColor.needsUpdate=!0),p.computeBoundingBox(),p.computeBoundingSphere(),p.visible=!!p.count},[p,e,t,r,n]),be.jsxs("instancedMesh",{ref:m,args:[void 0,void 0,s],children:[be.jsxs("bufferGeometry",{children:[be.jsx("bufferAttribute",{attach:"attributes-position",args:[f,3]}),be.jsx("bufferAttribute",{attach:"attributes-uv",args:[d,2]})]}),be.jsx("primitive",{object:l,attach:"material"})]})}const ip=new Fc;function gB({sprites:n,children:e,alpha:t=.5,limit:r=cg}){const[i,s]=Ke.useState(),[o,a]=Ke.useState(),[c,l]=Ke.useState(),[u,h]=Ke.useState(),[f]=Ke.useState(()=>_He()),[d,p]=hB(n,r);Ke.useLayoutEffect(()=>{f.uniforms.alpha.value=t},[f,t]);const{position:m,uv:_}=Ke.useMemo(()=>oB(1,1),[]),v=Ke.useMemo(()=>new Uint8Array(r),[r]),S=Ke.useMemo(()=>new Float32Array(r*3),[r]),b=Ke.useMemo(()=>new Float32Array(r*16),[r]);return Ke.useEffect(()=>{if(!he(i)||!he(o)||!he(c)||!he(u))return;const T=8/14;for(let w=0;w<d.length;++w){const R=d[w];if(R.id){const[C,N,U]=e(R.x,R.y);o.getX(w)===0?(ip.scale.set(1,T,1),ip.position.set(C,N,U),ip.updateMatrix(),i.setMatrixAt(w,ip.matrix),u.set(ip.matrix.toArray(),w*16),c.setXYZ(w,C,N,Ma.value),o.setX(w,1),u.needsUpdate=!0,c.needsUpdate=!0,o.needsUpdate=!0,i.instanceMatrix.needsUpdate=!0):(c.getX(w)!==C||c.getY(w)!==N)&&(i.getMatrixAt(w,ip.matrix),u.set(ip.matrix.toArray(),w*16),c.setXYZ(w,C,N,Ma.value),ip.scale.set(1,T,1),ip.position.set(C,N,U),ip.updateMatrix(),i.setMatrixAt(w,ip.matrix),u.needsUpdate=!0,c.needsUpdate=!0,i.instanceMatrix.needsUpdate=!0)}else o.getX(w)&&(o.setX(w,0),o.needsUpdate=!0)}i.computeBoundingBox(),i.computeBoundingSphere(),i.visible=!!i.count},[n,d,p,i,o,c,u]),be.jsxs("instancedMesh",{ref:s,args:[void 0,void 0,r],children:[be.jsxs("bufferGeometry",{children:[be.jsx("bufferAttribute",{attach:"attributes-position",args:[m,3]}),be.jsx("bufferAttribute",{attach:"attributes-uv",args:[_,2]}),be.jsx("instancedBufferAttribute",{ref:a,name:"visible",usage:L0,attach:"attributes-visible",args:[v,1]}),be.jsx("instancedBufferAttribute",{ref:l,name:"nowposition",usage:L0,attach:"attributes-nowposition",args:[S,3]}),be.jsx("instancedBufferAttribute",{ref:h,name:"lastmatrix",usage:L0,attach:"attributes-lastmatrix",args:[b,16]})]}),be.jsx("primitive",{object:f,attach:"material"})]})}function oE({id:n,z:e,from:t,layers:r,multi:i=!1}){const s=ii(),o=Qr(Ph(u=>{if(he(t))return u.gadget[t]?.find(h=>h.id===n);if(he(r))return r.find(h=>h.id===n)})),a=kn.DRAW_CHAR_WIDTH(),c=kn.DRAW_CHAR_HEIGHT(),l=g1(Qr.getState().gadget.layers??[]);switch(o?.type){default:case Qi.BLANK:case Qi.MEDIA:return null;case Qi.TILES:{const u=fB(o.char,o.color,o.bg,o.stats),h=dB(o.char,o.color,o.bg,o.stats),f=pB(o.char,o.color,o.bg,o.stats),d=zGe(o.char,o.color,o.bg,o.stats),p=Wre(o.char,o.color,o.bg,o.stats),m=$Ge(o.char,o.color,o.bg,o.stats);return be.jsx(be.Fragment,{children:be.jsxs("group",{position:[0,0,e],children:[be.jsx(vp,{width:o.width,height:o.height,char:u.char,color:u.color,bg:u.bg}),be.jsx("group",{"position-z":c*-.25,children:be.jsx(vp,{width:o.width,height:o.height,char:f.char,color:f.color,bg:f.bg})}),!i&&be.jsx("group",{"position-z":c*-.25,children:be.jsx(Gm,{width:bn,char:p.char,color:p.color,bg:p.bg,partial:.25})}),be.jsx("group",{"position-z":.5,children:be.jsx(Gm,{width:bn,char:h.char,color:h.color,bg:h.bg})}),be.jsx("group",{"position-z":c+.5,children:be.jsx(vp,{width:o.width,height:o.height,char:d.char,color:d.color,bg:d.bg})}),!i&&be.jsxs("group",{"position-z":c+.5,children:[be.jsx(Gm,{width:bn,char:m.char,color:m.color,bg:m.bg,partial:.5}),be.jsx(Gm,{width:bn,char:h.char,color:h.color,bg:h.bg})]})]},o.id)})}case Qi.SPRITES:{const u=.5714285714285714,h=o.sprites.filter(m=>{switch(m.stat){case Fn.ISSWIM:case Fn.ISBULLET:return!1;default:return m.pid!==s}}),f=o.sprites.filter(m=>m.stat===Fn.ISBULLET),d=o.sprites.filter(m=>m.stat===Fn.ISSWIM),p=o.sprites.filter(m=>{switch(m.stat){case Fn.ISSWIM:case Fn.ISGHOST:return!1;default:return m.pid!==s}});return be.jsxs("group",{position:[0,0,e],children:[be.jsx(iD,{sprites:h,facing:l.facing,children:(m,_)=>[(m+.5)*a,(_+.5)*c,c*-.5]}),be.jsx(iD,{sprites:f,facing:l.facing,children:(m,_)=>[(m+.5)*a,(_+.5)*c,c*-.75]}),be.jsx(iD,{sprites:d,facing:l.facing,children:(m,_)=>[(m+.5)*a,(_+.5)*c,c*-1.25]}),be.jsx(gB,{sprites:p,children:(m,_)=>[m*a,(_+.5-u*.5)*c,c*-.5+.5]})]},o.id)}case Qi.DITHER:return be.jsx("group",{position:[0,0,e],children:be.jsx(mB,{alphas:o.alphas,width:bn})},o.id)}}function aE(n){switch(n.type){case Qi.TILES:return 0;case Qi.DITHER:return kn.DRAW_CHAR_HEIGHT()+1;case Qi.SPRITES:return kn.DRAW_CHAR_HEIGHT()*.5}return 0}function VGe(n){switch(n){case mc.NEAR:return 25;default:case mc.MID:return 75;case mc.FAR:return 110}}const NE=[],PE=[],DE=[];for(let n=0;n<wr;++n)for(let e=0;e<bn;++e)e===0||e===bn-1||n===0||n===wr-1?(NE.push(32),PE.push(Ft.BLACK),DE.push(Ft.BLACK)):(NE.push(0),PE.push(0),DE.push(Ft.ONCLEAR));function HGe({width:n,height:e}){const{viewport:t}=jc(),r=yg(),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),o=n*i,a=e*s,c=bn*i,l=Ke.useRef(null),u=Ke.useRef(null),h=Ke.useRef(null),f=Ke.useRef(null),[,d]=Ke.useState(!1);Ke.useLayoutEffect(()=>{d(!0)},[]),s_(($,I)=>{if(!l.current||!u.current||!h.current||!f.current)return;const L=g1(Qr.getState().gadget.layers??[]),P=.05,H=.111,X=Qr.getState().gadget.board;he(f.current.userData.focusx)||(f.current.userData={focusx:L.focusx,focusy:L.focusy,lfocusx:L.focusx,lfocusy:L.focusy,facing:L.facing,lfacing:L.facing,sway:0,vsway:0,lean:0,vlean:0,currentboard:X});const G=f.current.userData??{},Y=(G.focusx+.5)*i,J=(G.focusy+.5)*s;if(G.lfocusx!==L.focusx||G.lfocusy!==L.focusy){const Ee=G.lfocusx-L.focusx,Re=G.lfocusy-L.focusy;switch(Math.round(L.facing/(Math.PI*.5))){default:case 0:G.vsway=Re*7,G.vlean=Ee*.02;break;case 1:G.vsway=-Ee*7,G.vlean=Re*.02;break;case 2:G.vsway=-Re*7,G.vlean=-Ee*.02;break;case 3:G.vsway=Ee*7,G.vlean=-Re*.02;break}G.lfocusx=L.focusx,G.lfocusy=L.focusy}if(G.lfacing!==L.facing){let te=L.facing-G.lfacing;te<-Math.PI?te+=Math.PI*2:te>Math.PI&&(te+=Math.PI*-2);const ie=.02;G.vlean=te*ie,G.lfacing=L.facing}Yv(l.current.position,[Y,-J,512+s*.55],P,I),B4(u.current.rotation,[0,0,Math.PI-L.facing],P,I),B4(f.current.rotation,[Math.PI*-.49,0,G.lean],P,I);const Q=1.2,z=Math.sin(G.sway)*Q,q=Math.abs(Math.sin(G.sway)*Q);if(Yv(f.current.position,[z,0,q],P,I),G.sway+=G.vsway*I,cl(f.current.userData,"vsway",0,H),cl(f.current.userData,"lean",G.vlean,H),cl(f.current.userData,"vlean",0,H),X!==G.currentboard){G.sway=0,G.vsway=0,G.lean=0,G.vlean=0,G.focusx=L.focusx,G.focusy=L.focusy,G.lfocusx=G.focusx,G.lfocusy=G.focusy,G.currentboard=X;const te=(G.focusx+.5)*i,ie=(G.focusy+.5)*s;l.current.position.set(te,-ie,512+s*.5);const Ee=Math.sin(G.sway)*Q,Re=Math.abs(Math.sin(G.sway)*Q);f.current.position.set(Ee,0,Re),f.current.rotation.set(Math.PI*-.49,0,G.lean)}else cl(f.current.userData,"focusx",L.focusx,P),cl(f.current.userData,"focusy",L.focusy,P);cl(f.current,"fov",VGe(L.viewscale),P,I),f.current.updateProjectionMatrix();const ee=Ri(o/c,1,10);h.current.position.x=o-c*ee,h.current.position.y=0,h.current.scale.setScalar(ee)}),Qr($=>$.gadget.over?.length??0),Qr($=>$.gadget.under?.length??0),Qr($=>$.gadget.layers?.length??0);const{gadget:p,gadgetlayercache:m}=Qr.getState(),{over:_=[],under:v=[],layers:S=[]}=p,b=m[p.exiteast]??[],T=m[p.exitwest]??[],w=m[p.exitnorth]??[],R=m[p.exitsouth]??[],C=_.length>0,N=v.length*2+2,U=t.width*-.5+r.marginx,B=t.height*.5-r.marginy;return be.jsxs(be.Fragment,{children:[be.jsx("group",{ref:l,children:be.jsx("group",{ref:u,children:be.jsx("perspectiveCamera",{ref:f,near:.1,far:3e3,aspect:-o/a,position:[0,s*-.5,0]})})}),be.jsx("group",{ref:h,children:v.map(($,I)=>be.jsx(Hb,{from:"under",id:$.id,z:I*2},$.id))}),be.jsx("group",{"position-z":N,children:f.current&&be.jsx(U3,{camera:f.current,viewwidth:o,viewheight:a,effects:be.jsxs(be.Fragment,{children:[be.jsx(iB,{worldFocusDistance:200,worldFocusRange:500,bokehScale:3}),be.jsx(PGe,{})]}),children:be.jsxs("group",{position:[U,B,0],children:[S.map($=>be.jsx(oE,{id:$.id,from:"layers",z:aE($),multi:C},$.id)),_.map($=>be.jsx(oE,{from:"over",id:$.id,z:aE($)+s+1,multi:C},$.id)),be.jsx("group",{position:[bn*i,0,0],children:b.length?be.jsx(be.Fragment,{children:b.map($=>be.jsx(oE,{id:$.id,layers:b,z:aE($),multi:C},$.id))}):be.jsx("group",{"scale-z":2,children:be.jsx(Gm,{width:bn,char:NE,color:PE,bg:DE})})}),be.jsx("group",{position:[bn*-i,0,0],children:T.length?be.jsx(be.Fragment,{children:T.map($=>be.jsx(oE,{id:$.id,layers:T,z:aE($),multi:C},$.id))}):be.jsx("group",{"scale-z":2,children:be.jsx(Gm,{width:bn,char:NE,color:PE,bg:DE})})}),be.jsx("group",{position:[0,wr*-s,0],children:w.length?be.jsx(be.Fragment,{children:w.map($=>be.jsx(oE,{id:$.id,layers:w,z:aE($),multi:C},$.id))}):be.jsx("group",{"scale-z":2,children:be.jsx(Gm,{width:bn,char:NE,color:PE,bg:DE})})}),be.jsx("group",{position:[0,wr*s,0],children:R.length?be.jsx(be.Fragment,{children:R.map($=>be.jsx(oE,{id:$.id,layers:R,z:aE($),multi:C},$.id))}):be.jsx("group",{"scale-z":2,children:be.jsx(Gm,{width:bn,char:NE,color:PE,bg:DE})})})]})})})]})}function cE({id:n,z:e,from:t,layers:r}){const i=Qr(Ph(a=>{if(he(t))return a.gadget[t]?.find(c=>c.id===n);if(he(r))return r.find(c=>c.id===n)})),s=kn.DRAW_CHAR_WIDTH(),o=kn.DRAW_CHAR_HEIGHT();switch(i?.type){default:case Qi.BLANK:case Qi.MEDIA:return null;case Qi.TILES:{const a=fB(i.char,i.color,i.bg,i.stats),c=dB(i.char,i.color,i.bg,i.stats),l=pB(i.char,i.color,i.bg,i.stats),u=Wre(i.char,i.color,i.bg,i.stats);return be.jsx(be.Fragment,{children:be.jsxs("group",{position:[0,0,e],children:[be.jsx(vp,{width:i.width,height:i.height,char:a.char,color:a.color,bg:a.bg}),be.jsx("group",{"position-z":o*-.5,children:be.jsx(vp,{width:i.width,height:i.height,char:l.char,color:l.color,bg:l.bg})}),t!=="over"&&be.jsx("group",{"position-z":o*-1,children:be.jsx(Gm,{width:bn,char:u.char,color:u.color,bg:u.bg})}),be.jsx(Gm,{width:bn,char:c.char.map(h=>h!==0?219:0),color:c.color,bg:c.bg}),be.jsx("group",{"position-z":o+1,children:be.jsx(vp,{width:i.width,height:i.height,char:c.char,color:c.color,bg:c.bg})})]},i.id)})}case Qi.SPRITES:{const a=he(r),c=i.sprites.filter(h=>h.stat!==Fn.ISSWIM&&(!a||!h.pid)),l=i.sprites.filter(h=>h.stat===Fn.ISSWIM&&(!a||!h.pid)),u=c.filter(h=>h.stat!==Fn.ISGHOST);return be.jsxs("group",{position:[0,0,e],children:[be.jsx(gB,{sprites:u,limit:cg,children:(h,f)=>[h*s,(f+.25)*o,o*-.75+.5]}),be.jsx(zA,{sprites:c,scale:1.25}),be.jsx("group",{"position-z":o*-1,children:be.jsx(zA,{sprites:l,scale:1.25})})]},i.id)}case Qi.DITHER:return be.jsx("group",{position:[0,0,e],children:be.jsx(mB,{alphas:i.alphas,width:bn})},i.id)}}function lE(n){switch(n.type){case Qi.TILES:return 0;case Qi.DITHER:return kn.DRAW_CHAR_HEIGHT();case Qi.SPRITES:return kn.DRAW_CHAR_HEIGHT()*.75}return 0}function GGe(n){switch(n){case mc.NEAR:return 3;default:case mc.MID:return 1.75;case mc.FAR:return 1}}function WGe({width:n,height:e}){const{viewport:t}=jc(),r=yg(),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),o=n*i,a=e*s,c=bn*i,l=wr*s,u=Ke.useRef(null),h=Ke.useRef(null),f=Ke.useRef(null),d=Ke.useRef(null),p=Ke.useRef(null),[,m]=Ke.useState(!1);Ke.useLayoutEffect(()=>{m(!0)},[]),s_((I,L)=>{if(!u.current||!h.current||!f.current||!d.current||!p.current)return;const P=g1(Qr.getState().gadget.layers??[]),H=.05,X=Qr.getState().gadget.board;he(d.current.userData.focusx)||(d.current.userData={focusx:P.focusx,focusy:P.focusy,facing:P.facing,currentboard:X},u.current.scale.setScalar(P.viewscale));const G=d.current.userData??{},Y=(G.focusx+.5)*i,J=(G.focusy+.5)*s;switch(Yv(u.current.scale,GGe(P.viewscale),H,L),Yv(f.current.position,[-Y,-J,0],H,L),X!==G.currentboard?(G.focusx=P.focusx,G.focusy=P.focusy,G.currentboard=X,f.current.position.set(-((G.focusx+.5)*i),-((G.focusy+.5)*s),0)):(cl(d.current.userData,"focusx",P.focusx,H),cl(d.current.userData,"focusy",P.focusy,H)),P.viewscale){case mc.NEAR:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1e3,p.current.cocMaterial.worldFocusDistance=1e3;break;default:case mc.MID:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1e3,p.current.cocMaterial.worldFocusDistance=1e3;break;case mc.FAR:p.current.bokehScale=5,p.current.cocMaterial.worldFocusRange=1500,p.current.cocMaterial.worldFocusDistance=1e3;break}d.current.updateProjectionMatrix();const Q=Ri(o/c,1,10),z=Ri(a/l,1,10),q=Math.max(Q,z),ee=c*q,te=l*q;h.current.position.x=o-ee,h.current.position.y=a-te,h.current.scale.setScalar(q)}),Qr(I=>I.gadget.over?.length??0),Qr(I=>I.gadget.under?.length??0),Qr(I=>I.gadget.layers?.length??0);const{gadget:_,gadgetlayercache:v}=Qr.getState(),{over:S=[],under:b=[],layers:T=[]}=_,w=v[_.exiteast]??[],R=v[_.exitwest]??[],C=v[_.exitnorth]??[],N=v[_.exitsouth]??[],U=b.length*2+2,B=t.width*-.5+r.marginx,$=t.height*.5-r.marginy;return be.jsxs(be.Fragment,{children:[be.jsxs("group",{"position-z":U,children:[be.jsx("orthographicCamera",{ref:d,left:o*-.5,right:o*.5,top:a*-.5,bottom:a*.5,near:.1,far:2e3,position:[0,0,1e3]}),d.current&&be.jsx(U3,{camera:d.current,viewwidth:o,viewheight:a,effects:be.jsx(be.Fragment,{children:be.jsx(iB,{ref:p})}),children:be.jsx("group",{position:[B,$,-500],children:be.jsx("group",{rotation:[Math.PI*.25,0,Math.PI*-.25],children:be.jsx("group",{ref:u,children:be.jsxs("group",{ref:f,children:[T.map(I=>be.jsx(cE,{id:I.id,from:"layers",z:lE(I)},I.id)),S.map(I=>be.jsx(cE,{from:"over",id:I.id,z:lE(I)+s+1},I.id)),w.length&&be.jsx("group",{position:[bn*i,0,0],children:w.map(I=>be.jsx(cE,{id:I.id,layers:w,z:lE(I)},I.id))}),R.length&&be.jsx("group",{position:[bn*-i,0,0],children:R.map(I=>be.jsx(cE,{id:I.id,layers:R,z:lE(I)},I.id))}),C.length&&be.jsx("group",{position:[0,wr*-s,0],children:C.map(I=>be.jsx(cE,{id:I.id,layers:C,z:lE(I)},I.id))}),N.length&&be.jsx("group",{position:[0,wr*s,0],children:N.map(I=>be.jsx(cE,{id:I.id,layers:N,z:lE(I)},I.id))})]})})})})})]}),be.jsx("group",{ref:h,children:b.map((I,L)=>be.jsx(Hb,{from:"under",id:I.id,z:L*2},I.id))})]})}const qGe=_1(b1),YGe=v1(y1);function KGe(){const n=Qr(e=>e.gadget.id);return Ke.useEffect(()=>{const e=Qr.getState().gadget.layers??[];let t=qGe,r=YGe,i;const s=ya.getState();for(let o=0;e&&o<e.length;++o){const a=e[o];if(a.type===Qi.MEDIA)switch(a.mime){case"image/palette":sr(a.media)&&(t=DN(nA,sme,a.media));break;case"image/charset":sr(a.media)&&(r=DN(So*Zo,k7*Oa,a.media));break;case"image/altcharset":sr(a.media)&&(i=DN(So*Zo,k7*Oa,a.media));break;case"text/mood":un(a.media)&&s.setmood(a.media);break;case"text/players":un(a.media);break}s.setpalette(t),s.setcharset(r),s.setaltcharset(i)}},[n]),null}function cw({id:n,z:e,from:t,layers:r}){const i=Qr(Ph(a=>{if(he(t))return a.gadget[t]?.find(c=>c.id===n);if(he(r))return r.find(c=>c.id===n)})),s=kn.DRAW_CHAR_WIDTH(),o=kn.DRAW_CHAR_HEIGHT();switch(i?.type){default:case Qi.BLANK:case Qi.MEDIA:return null;case Qi.TILES:{const a=fB(i.char,i.color,i.bg,i.stats),c=dB(i.char,i.color,i.bg,i.stats),l=pB(i.char,i.color,i.bg,i.stats);return be.jsxs("group",{position:[0,0,e],children:[be.jsx(vp,{width:i.width,height:i.height,char:a.char,color:a.color,bg:a.bg}),be.jsx("group",{"position-z":o*-.25,children:be.jsx(vp,{width:i.width,height:i.height,char:l.char,color:l.color,bg:l.bg})}),be.jsx("group",{"position-z":o*.25,children:be.jsx(vp,{width:i.width,height:i.height,char:c.char,color:c.color,bg:c.bg})})]},i.id)}case Qi.SPRITES:{const a=he(r),c=i.sprites.filter(h=>h.stat!==Fn.ISSWIM&&(!a||!h.pid)),l=i.sprites.filter(h=>h.stat===Fn.ISSWIM&&(!a||!h.pid)),u=c.filter(h=>h.stat!==Fn.ISGHOST);return be.jsxs("group",{position:[0,0,e],children:[be.jsx(gB,{sprites:u,limit:cg,children:(h,f)=>[h*s,(f+.5)*o,o*-.5+.5]}),be.jsx(zA,{sprites:c,withbillboards:!0}),be.jsx("group",{"position-z":o*-.5,children:be.jsx(zA,{sprites:l,withbillboards:!0})})]},i.id)}case Qi.DITHER:return be.jsx("group",{position:[0,0,e+1],children:be.jsx(mB,{alphas:i.alphas,width:bn})})}}function uE(n){switch(n.type){case Qi.TILES:return 0;case Qi.DITHER:return kn.DRAW_CHAR_HEIGHT()+1;case Qi.SPRITES:return kn.DRAW_CHAR_HEIGHT()*.5}return 0}function XGe(n){switch(n){case mc.NEAR:return-128;default:case mc.MID:return 128;case mc.FAR:return 512}}function ZGe(n){switch(n){case mc.NEAR:return .888;default:case mc.MID:return .777;case mc.FAR:return .444}}function JGe({width:n,height:e}){const{viewport:t}=jc(),r=yg(),i=kn.DRAW_CHAR_WIDTH(),s=kn.DRAW_CHAR_HEIGHT(),o=n*i,a=e*s,c=bn*i,l=wr*s,u=Ke.useRef(null),h=Ke.useRef(null),f=Ke.useRef(null),d=Ke.useRef(null),p=Ke.useRef(null),[,m]=Ke.useState(!1);Ke.useLayoutEffect(()=>{m(!0)},[]),s_((I,L)=>{if(!u.current||!h.current||!f.current||!d.current||!p.current)return;const P=g1(Qr.getState().gadget.layers??[]),H=.05,X=Qr.getState().gadget.board;he(d.current.userData.focusx)||(d.current.userData={focusx:P.focusx,focusy:P.focusy,currentboard:X});const G=d.current.userData??{},Y=(G.focusx+.5)*i,J=(G.focusy+.5)*s;switch(Yv(d.current.position,[0,0,XGe(P.viewscale)],H,L),B4(u.current.rotation,[ZGe(P.viewscale),0,0],H,L),Yv(f.current.position,[-Y,-J,0],H,L),X!==G.currentboard?(G.focusx=P.focusx,G.focusy=P.focusy,G.currentboard=X,f.current.position.set(-((G.focusx+.5)*i),-((G.focusy+.5)*s),0)):(cl(d.current.userData,"focusx",P.focusx,H),cl(d.current.userData,"focusy",P.focusy,H)),P.viewscale){case mc.NEAR:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1200,p.current.cocMaterial.worldFocusDistance=350;break;default:case mc.MID:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1700,p.current.cocMaterial.worldFocusDistance=800;break;case mc.FAR:p.current.bokehScale=10,p.current.cocMaterial.worldFocusRange=1700,p.current.cocMaterial.worldFocusDistance=1100;break}d.current.rotation.z=Math.PI,d.current.updateProjectionMatrix();const Q=Ri(o/c,1,10),z=Ri(a/l,1,10),q=Math.max(Q,z),ee=c*q,te=l*q;h.current.position.x=o-ee,h.current.position.y=a-te,h.current.scale.setScalar(q)}),Qr(I=>I.gadget.over?.length??0),Qr(I=>I.gadget.under?.length??0),Qr(I=>I.gadget.layers?.length??0);const{gadget:_,gadgetlayercache:v}=Qr.getState(),{over:S=[],under:b=[],layers:T=[]}=_,w=v[_.exiteast]??[],R=v[_.exitwest]??[],C=v[_.exitnorth]??[],N=v[_.exitsouth]??[],U=b.length*2+2,B=t.width*-.5+r.marginx,$=t.height*.5-r.marginy;return be.jsxs(be.Fragment,{children:[be.jsx("perspectiveCamera",{ref:d,near:.1,far:2e3,aspect:-o/a}),be.jsx("group",{"position-z":U,children:d.current&&be.jsx(U3,{camera:d.current,viewwidth:o,viewheight:a,effects:be.jsx(be.Fragment,{children:be.jsx(iB,{ref:p})}),children:be.jsx("group",{position:[B,$,-1e3],children:be.jsx("group",{ref:u,children:be.jsxs("group",{ref:f,children:[T.map(I=>be.jsx(cw,{id:I.id,from:"layers",z:uE(I)},I.id)),S.map(I=>be.jsx(Hb,{from:"over",id:I.id,z:uE(I)+s*1.125},I.id)),w.length&&be.jsx("group",{position:[bn*i,0,0],children:w.map(I=>be.jsx(cw,{id:I.id,layers:w,z:uE(I)},I.id))}),R.length&&be.jsx("group",{position:[bn*-i,0,0],children:R.map(I=>be.jsx(cw,{id:I.id,layers:R,z:uE(I)},I.id))}),C.length&&be.jsx("group",{position:[0,wr*-s,0],children:C.map(I=>be.jsx(cw,{id:I.id,layers:C,z:uE(I)},I.id))}),N.length&&be.jsx("group",{position:[0,wr*s,0],children:N.map(I=>be.jsx(cw,{id:I.id,layers:N,z:uE(I)},I.id))})]})})})})}),be.jsx("group",{ref:h,children:b.map((I,L)=>be.jsx(Hb,{from:"under",id:I.id,z:L*2},I.id))})]})}function QGe({width:n,height:e}){const t=R1(n,e,0,Ft.WHITE,Ft.ONCLEAR),r=Qr(s=>s.gadget.tickers),i=Ke.useMemo(()=>({...h_(n,e,Ft.WHITE,Ft.BLACK),...t.getState()}),[n,e,t]);if(he(r)){i.x=0,i.y=e-1,i.disablewrap=!0;const s=t.getState();i3(s,0,Ft.WHITE,Ft.ONCLEAR);for(let o=0;o<r.length;++o){const a=r[o];ei(a,i,!1),i.x=0,i.y--}}return be.jsx(P1,{store:t,children:be.jsx(D1,{width:n,height:e})})}function cb(n,e,t){let r=0;t.alt&&(r|=I5),t.ctrl&&(r|=O5),t.shift&&(r|=N5),zl(n)&&YY(qe,n,e,r)}function eWe({width:n,height:e}){const t=ii();Qr(Ph(i=>[i.gadget.id,i.gadget.board,i.gadget.layers?.length??0]));const r=Qr(i=>g1(i.gadget.layers??[]).graphics);return be.jsxs(be.Fragment,{children:[be.jsx(Ao,{MOVE_LEFT:i=>cb(t,Ct.MOVE_LEFT,i),MOVE_RIGHT:i=>cb(t,Ct.MOVE_RIGHT,i),MOVE_UP:i=>cb(t,Ct.MOVE_UP,i),MOVE_DOWN:i=>cb(t,Ct.MOVE_DOWN,i),OK_BUTTON:i=>cb(t,Ct.OK_BUTTON,i),CANCEL_BUTTON:i=>cb(t,Ct.CANCEL_BUTTON,i),MENU_BUTTON:i=>cb(t,Ct.MENU_BUTTON,i),keydown:i=>{const s=cr(i.key),o=EC(i),a=ii();switch(s){case"c":d6(qe,a,"");break;case"@":case"2":Jb(qe,a,"@");break;case"#":case"3":Jb(qe,a,"#");break;case"p":o.ctrl&&g6(qe,a);break;case"a":o.ctrl&&_xe(qe,a);break}}}),be.jsx(KGe,{}),r==="flat"&&be.jsx(IGe,{width:n,height:e}),r==="mode7"&&be.jsx(JGe,{width:n,height:e}),r==="iso"&&be.jsx(WGe,{width:n,height:e}),r==="fpv"&&be.jsx(HGe,{width:n,height:e}),be.jsx("group",{"position-z":512,children:be.jsx(QGe,{width:Math.floor(n),height:Math.floor(e)})})]})}function YH({rect:n,shouldclose:e=!1}){switch(n.type){case 0:return be.jsx("group",{"position-z":512,children:be.jsx($re,{width:n.width,height:n.height,color:14,bg:1,text:n.text,ymargin:0})});case 1:return be.jsx(bGe,{width:n.width,height:n.height,color:14,bg:1,text:n.text,shouldclose:e});case 2:return be.jsx(eWe,{width:n.width,height:n.height})}return null}const hE=20;function tWe(){const n=yg(),{islandscape:e,sidebaropen:t,showtouchcontrols:r}=ad(),i=Qr($$(d=>d.gadget.scroll??[])),s=i.length===0,[o,a]=Ke.useState(!1),c=Qr($$(d=>d.gadget.sidebar??[]));if(n.cols<10||n.rows<10)return null;const l={name:"main",type:2,x:0,y:0,text:[],width:n.cols,height:n.rows},u=[];if(c.length)if(r)if(e){const d=t?hE+5:hE,p=t?hE:4,m={name:"sidebar",type:0,x:l.x+l.width-p,y:l.y,width:d,height:l.height,text:c};l.width-=p,u.push(m)}else{const p=t?15:4,m={name:"sidebar",type:0,x:0,y:l.y+l.height-p,width:l.width,height:15,text:c};l.height-=p,u.push(m)}else{const d={name:"sidebar",type:0,x:l.x+l.width-hE,y:l.y,width:hE,height:l.height,text:c};l.width-=hE,u.push(d)}const h={name:"scroll",type:1,x:0,y:0,width:Ri(50,40,l.width-2),height:Ri(20,8,l.height-2),text:i};h.x=l.x+Math.floor((l.width-h.width)*.5),h.y=l.y+Math.floor((l.height-h.height)*.5),!s&&!o&&a(!0),u.unshift(l);const f=ii();return be.jsxs(__.Provider,{value:{sendmessage(d,p){qe.emit(f,d,p)},sendclose(){IEe(qe,f)},didclose(){a(!1)}},children:[be.jsx("group",{position:[-kn.DRAW_CHAR_WIDTH(),-kn.DRAW_CHAR_HEIGHT(),-524],children:be.jsx(Km,{visible:!0,color:new Ti(.076,.076,0),width:n.cols+2,height:n.rows+2})}),be.jsx("group",{position:[0,0,-512],children:u.map(d=>be.jsx("group",{position:[d.x*kn.DRAW_CHAR_WIDTH(),d.y*kn.DRAW_CHAR_HEIGHT(),0],children:be.jsx(YH,{rect:d})},d.name))}),o&&be.jsxs(yh.Fragment,{children:[be.jsx("group",{position:[0,0,800],children:be.jsx(IHe,{width:n.cols,height:n.rows,alpha:.14})}),be.jsx("group",{position:[h.x*kn.DRAW_CHAR_WIDTH(),h.y*kn.DRAW_CHAR_HEIGHT(),900],children:be.jsx(YH,{rect:h,shouldclose:s})})]},"scroll")]})}const nWe=250,rWe=249,$I=Ft.BLUE,iWe=Ft.WHITE,sWe=Ft.DKGRAY,_B=Ft.BLACK;function dT(n){return n?Ft.ONCLEAR:Ft.DKBLUE}function oWe(n){return Math.round(n*.5)}const qre=Ke.createContext({sendmessage(){}});function K0(n,e,t,r){const i=Ip(r);r.iseven=r.y%2===0,r.active.bg=n?_B:r.reset.bg,r.active.leftedge=i.left,r.active.rightedge=i.right,r.active.topedge=i.top,r.active.bottomedge=i.bottom,r.x=r.active.leftedge+e,r.y=r.active.topedge+t}function bb(n,e,t,r,i,s,o,a){const c=Ip(i);i.iseven=i.y%2===0,i.active.color=Ft.WHITE,i.active.bg=i.reset.bg,i.active.leftedge=c.left+s,i.active.rightedge=c.right-s,i.active.topedge=c.top+o,i.active.bottomedge=c.bottom-a,i.x=i.active.leftedge+t,i.y=i.active.topedge+r}function aWe(n){let e=0;return n.split(/\r?\n/).map(r=>{const i=e,s=`${r}
`;return e+=s.length,{start:i,code:s,end:i+r.length}})}function cWe(n){return n.reduce((e,t)=>{const r=t.code.length;return r>e?r:e},0)}function Yre(n,e){for(let t=0;t<e.length;++t)if(n<=e[t].end)return t;return e.length-1}function vB({bump:n}){const e=Wl(),t=Ip(e),{quickterminal:r}=hs(),i=dT(r);if(n&&t.top++,r){for(let s=t.top;s<=t.bottom;++s)for(let o=t.left;o<=t.right;++o)qo(e,e.width,e.height,o,s,{char:0,color:$I,bg:i});return null}for(let s=t.top;s<=t.bottom;++s)for(let o=t.left;o<=t.right;++o){let a=0;(o+s)%2===0&&(a=Math.abs(Math.round(Math.cos(o*s*.01)))?nWe:rWe),qo(e,e.width,e.height,o,s,{char:a,color:$I,bg:i})}return null}const aD=Ft.WHITE,Ww=Ft.GREEN,Ra=Ft.YELLOW,lWe=Ft.CYAN,lf=Ft.DKGREEN,KH=Ft.DKCYAN,uWe=Ft.GREEN,sM=Ft.DKPURPLE,Kre=Ft.WHITE,hWe=Ft.LTGRAY,fWe=Ft.DKGRAY,XH=Ft.DKRED,dWe=Ft.DKRED,cD=Ft.DKYELLOW,pWe={[cA.tokenTypeIdx??0]:aD,[iK.tokenTypeIdx??0]:aD,[sK.tokenTypeIdx??0]:aD,[Qb.tokenTypeIdx??0]:sM,[U0.tokenTypeIdx??0]:Ra,[lA.tokenTypeIdx??0]:Ww,[uA.tokenTypeIdx??0]:lWe,[ux.tokenTypeIdx??0]:dWe,[hA.tokenTypeIdx??0]:Ra,[b6.tokenTypeIdx??0]:Ra,[va.tokenTypeIdx??0]:Ww,[jw.tokenTypeIdx??0]:Ww,[AE.tokenTypeIdx??0]:Kre,[S6.tokenTypeIdx??0]:Ra,[E6.tokenTypeIdx??0]:Ra,[x6.tokenTypeIdx??0]:Ra,[T6.tokenTypeIdx??0]:Ra,[w6.tokenTypeIdx??0]:Ra,[A6.tokenTypeIdx??0]:Ra,[VM.tokenTypeIdx??0]:cD,[HM.tokenTypeIdx??0]:cD,[GM.tokenTypeIdx??0]:cD,[WM.tokenTypeIdx??0]:Ra,[qM.tokenTypeIdx??0]:Ra,[C6.tokenTypeIdx??0]:Ra,[R6.tokenTypeIdx??0]:Ra,[Db.tokenTypeIdx??0]:Ra,[k6.tokenTypeIdx??0]:Ra,[M6.tokenTypeIdx??0]:Ra,[fA.tokenTypeIdx??0]:Ra,[I6.tokenTypeIdx??0]:Ra,[O6.tokenTypeIdx??0]:Ra,[N6.tokenTypeIdx??0]:uWe,[Lb.tokenTypeIdx??0]:lf,[Ub.tokenTypeIdx??0]:KH,[YM.tokenTypeIdx??0]:KH,[Bb.tokenTypeIdx??0]:lf,[P6.tokenTypeIdx??0]:lf,[D6.tokenTypeIdx??0]:lf,[L6.tokenTypeIdx??0]:lf,[U6.tokenTypeIdx??0]:lf,[B6.tokenTypeIdx??0]:lf,[F6.tokenTypeIdx??0]:lf};Ft.DKPURPLE;const mWe=Ft.DKYELLOW,gWe=Ft.DKPURPLE,_We=Ft.CYAN,vWe=Ft.DKCYAN,yWe=Ft.RED,bWe=Ft.WHITE,SWe=Ft.LTGRAY,EWe=Ft.YELLOW,Xre=new Map;function sp(n,e){Xre.set(n,e)}function ZH(n){const e=[];let t=0;for(let r=0;r<n.length;++r){switch(n[r]){case";":t=0;break;case" ":break;default:t===0&&(t=1);break;case"#":t===0&&(t=2);break}switch(t){case 0:e.push(Ft.LTGRAY);break;case 1:e.push(wWe(n[r]));break;case 2:e.push(Ft.CYAN);break}}return e.push(Ft.BLUE),e}function xWe(n){if(n.startsWith("play ")){const e=new Array(5).fill(lf);return e.push(...ZH(n.slice(5))),e}else if(n.startsWith("bgplay ")){const e=new Array(7).fill(lf);return e.push(...ZH(n.slice(7))),e}return Xre.get(n)??Ft.GREEN}const L1=Ft.GREEN,TWe=Ft.DKGREEN,bg=Ft.PURPLE,U1=Ft.DKCYAN,Zre=Ft.CYAN,Jre=Ft.YELLOW,Qre=Ft.DKYELLOW,eie=new Map;function rs(n,e){eie.set(n,e)}function wWe(n){return eie.get(n)??Ft.GREEN}function AWe(){const n=Wl(),e=Ip(n),[t,r,i]=hs(Ph(v=>[v.quickterminal,v.editor.type,v.editor.title])),s=Ft.WHITE,o=dT(t);for(let v=e.top;v<e.bottom;++v)qo(n,n.width,n.height,e.left,v,{char:179,color:s,bg:o}),qo(n,n.width,n.height,e.right,v,{char:179,color:s,bg:o});bb(!1,!1,0,0,n,0,0,0),ei("$213$205$187",n,!0),bb(!1,!1,n.width-3,0,n,0,0,0),ei("$196$196$191",n,!0);const a="$205".repeat(e.width-2);bb(!1,!1,0,e.height-1,n,0,0,0),ei(`$212${a}$190`,n,!0);const c=Ef(),l="$205".repeat(e.width-4);bb(!1,!1,0,1,n,0,0,0),ei(`$179$${c?"7":"232"}$200${l}$181`,n,!0);const h=` ${`$blue[${r}] `}$green${i}$white `,d=f_(h,e.width,e.height)?.measuredwidth??1,p=e.width-2,m=2+Math.round(p*.5)-Math.round(d*.5);bb(!1,!1,m,1,n,0,0,0),ei(h,n,!0);const _=o1?`shift+${kA}+z`:`${kA}+y`;return be.jsx(uB,{margin:3,color:Ft.BLUE,y:e.top,leftedge:0,rightedge:e.width-1,line:`
keys: $whiteesc/cancel$green.CLOSE 
$whitetab$green.CHANGE LAYOUT 
$whitehold shift$green.SELECT TEXT 
$whitealt+up/down$green.JUMP 10 LINES 
$whitealt+left/right$green.JUMP 10 COLS 
$white$meta+up/down$green.JUMP TOP/BOTTOM 
$white$meta+left/right$green.JUMP TO START/END OF LINE 
$white$meta+a$green.SELECT ALL 
$white$meta+c$green.COPY 
$white$meta+x$green.CUT 
$white$meta+v$green.PASTE 
$white$meta+z$green.UNDO 
$white${_}$green.REDO 
$white$meta+p$green.RUN SELECTED CODE 
$white$meta+h$green.OPEN HELPSCROLL $blue
    `,context:n})}const JH=32;function CWe({xcursor:n,ycursor:e,xoffset:t,yoffset:r,rows:i,codepage:s}){const o=Ef(),a=Wl(),c=Dl(),l=ii(),u=Ke.useRef(void 0),h=Ip(a),f=he(s)?s.toJSON():"",d=i.length-1,p=n+1-t,m=e+2-r;if(he(s)){const Y=u.current?.x!==p||u.current?.y!==m;if(o||Y){const J=h.left+p,Q=h.top+m;if(Q>h.top+1&&Q<h.bottom&&J>h.left&&J<h.right){const z=J+Q*a.width;r3(z,"",a),Tx(z,z,Ft.WHITE,Ft.DKBLUE,a)}}}u.current={x:p,y:m};const _=i[d].end,v=i[e];let S=c.cursor,b=c.cursor,T=!1;he(c.select)&&(T=!0,S=Math.min(c.cursor,c.select),b=Math.max(c.cursor,c.select),c.cursor!==c.select&&--b);const w=b-S+1,R=T?f.substring(S,b+1):"";function C(Y){Y?he(c.select)||Dl.setState({select:c.cursor}):Dl.setState({select:void 0})}const N=Ke.useCallback(function(Y){Dl.setState(J=>{const Q=Yre(Y,i),z=Y-i[Q].start,q=h.width-8,ee=h.height-4,te=Math.round(q*.5),ie=Math.round(ee*.5),Ee=Math.round(q*.25),Te=Math.abs(z-(J.xscroll+te))<Ee?J.xscroll:z-te,Pe=Q-ie,We=cWe(i),it=(Math.round(We/JH)+1)*JH,ht=i.length-ee;return{xscroll:Math.round(Ri(Te,0,it)),yscroll:Math.round(Ri(Pe,0,ht))}})},[i,h.width,h.height]),U=Ke.useCallback(function(Y,J,Q){J>0&&s?.delete(Y,J),he(Q)&&s?.insert(Y,Q);const z=Y+(Q??"").length;N(z),Dl.setState({cursor:z,select:void 0})},[s,N]),B=Ke.useCallback(function(Y,J,Q){J>0&&s?.delete(Y,J),he(Q)&&s?.insert(Y,Q);const z=Y+(Q??"").length;N(z),Dl.setState({cursor:z})},[s,N]);function $(){if(T){const Y=R.split(`
`);for(let J=0;J<Y.length;++J){const Q=Y[J],z=Q.trim();z.startsWith("'")?Y[J]=Q.replace(/' ?/,""):z&&(Y[J]=`' ${Q}`)}U(S,w,Y.join(`
`))}}function I(Y=!0){if(T){const J=R.split(`
`);for(let Q=0;Q<J.length;++Q){const z=J[Q];Y?J[Q].startsWith(" ")&&(J[Q]=z.substring(1)):J[Q]=` ${z}`}B(S,w,J.join(`
`))}}function L(){T&&(N(S),Dl.setState({cursor:S}),U(S,w))}function P(){N(_),Dl.setState({cursor:_,select:void 0})}const H=Ke.useCallback(function(Y){Dl.setState(()=>{const J=Ri(Y,0,_);return N(J),{cursor:J}})},[_,N]),X=Ke.useCallback(function(Y){Dl.setState(()=>{let J=0;const Q=Math.round(e+Y);if(Q<0)J=0;else if(Q>d)J=_;else{const z=i[Q];J=z.start+Math.min(n,z.code.length-1)}return N(J),{cursor:J}})},[_,i,d,n,e,N]),G=Ke.useMemo(()=>s?new iRe(s):void 0,[s]);return Ke.useEffect(()=>{function Y(Q){Q.stackItem.meta.set("cursor",c.cursor)}function J(Q){if(Q.stackItem.meta.has("cursor")){const z=Q.stackItem.meta.get("cursor");N(z),Dl.setState({cursor:z})}}return G?.on("stack-item-added",Y),G?.on("stack-item-popped",J),()=>{G?.off("stack-item-added",Y),G?.off("stack-item-popped",J)}},[G,c.cursor,N]),be.jsxs(be.Fragment,{children:[be.jsx(lB,{blocking:!0,x:h.left,y:h.top,width:h.width,height:h.height,onClick:()=>{document.getElementById("touchtext")?.focus()},onScroll:Y=>X(Y*.75)}),be.jsx(Ao,{MOVE_LEFT:Y=>{C(Y.shift),Y.ctrl?H(v.start):H(c.cursor-(Y.alt?10:1))},MOVE_RIGHT:Y=>{C(Y.shift),Y.ctrl?H(v.end):H(c.cursor+(Y.alt?10:1))},MOVE_UP:Y=>{C(Y.shift),Y.ctrl?H(0):X(Y.alt?-10:-1)},MOVE_DOWN:Y=>{C(Y.shift),Y.ctrl?H(_):X(Y.alt?10:1)},OK_BUTTON:()=>{if(he(s)){s.insert(c.cursor,`
`);const Y=c.cursor+1;N(Y),Dl.setState({cursor:Y})}},CANCEL_BUTTON:Y=>{Y.shift||Y.alt||Y.ctrl?Bw(qe,l):txe(qe,l)},MENU_BUTTON:Y=>{VY(qe,l,!Y.shift)},keydown:Y=>{if(!he(s))return;const{key:J}=Y,Q=cr(J),z=EC(Y);switch(Q){case"delete":T?L():U(c.cursor,1);break;case"backspace":T?L():f.length>0&&U(Math.max(c.cursor-1,0),1);break;default:if(z.ctrl)switch(Q){case"z":o1&&z.shift?G?.redo():G?.undo();break;case"y":o1||G?.redo();break;case"a":N(_),Dl.setState({cursor:_,select:0});break;case"c":he(da())?da().writeText(R).catch(q=>_r(qe,l,"clipboard",q)):P();break;case"v":he(da())?da().readText().then(q=>{const ee=q.replaceAll("\r","");T?U(S,w,ee):U(c.cursor,0,ee)}).catch(q=>_r(qe,l,"clipboard",q)):P();break;case"x":he(da())&&T?da().writeText(R).then(()=>L()).catch(q=>_r(qe,l,"clipboard",q)):P();break;case"p":T?(zm(qe,l,R),fs(qe,l,`running $WHITE${R.substring(0,16)}...$BLUE`)):(zm(qe,l,v.code),fs(qe,l,`running $WHITE${v.code.substring(0,16)}...$BLUE`));break;case"'":$();break}else if(!z.alt){if(Y.key.length===1)if(T)Y.key==="'"?$():Y.key===" "?I(Y.shiftKey):U(S,w,Y.key);else{const q=c.cursor+Y.key.length;s.insert(c.cursor,Y.key),N(q),Dl.setState({cursor:q})}}break}}})]})}function QH(n){const[e]=n.substring(1).split(";");return e.split(" ")}let oM;function op(n){const e=IDe(tee(n));Object.keys(e).filter(r=>!!r).length?oM=e:console.error(n)}function RWe({ycursor:n,xoffset:e,yoffset:t,rows:r,codepage:i}){const s=Ef(),o=Wl(),a=Dl(),{quickterminal:c}=hs(),l=Ke.useMemo(()=>{if(r.length){const _=r[r.length-1];return[...r,{code:"",start:_.end+1,end:_.end+1}]}return[]},[r]);if(!he(i)){const _=(s?"|":"-").repeat(3);return bb(!1,!1,0,0,o,1,2,1),ei(` ${_} LOADING ${_}`,o,!0),null}const u=o.width-2,h=Ip(o);h.right=u-1;let f=a.cursor,d=a.cursor,p=!1;he(a.select)&&(p=!0,f=Math.min(a.cursor,a.select),d=Math.max(a.cursor,a.select),a.cursor!==a.select&&--d);const m=h.left+1-4;bb(!1,!1,-e,-t,o,1,2,1);for(let _=0;_<l.length;++_){if(o.y<=h.top+1){++o.y;continue}const v=l[_],S=l[_-1],b=_===n,T=_-1===n,w=v.code.replaceAll(`
`,""),R=m-e;o.x=R,o.iseven=o.y%2===0,o.active.color=Ft.WHITE,o.active.bg=b?_B:dT(c),o.disablewrap=!0,o.active.rightedge=u;const C=`${_+1}`.padStart(3," ");b4(`${_<r.length?C:"   "} ${w} `,o,!1);const N=1+o.y*o.width;qf(N,h.right,-e-4,-e,hWe,o.active.bg,o),QT(N,h.right,-e+20,-e+20,Ft.DKCYAN,o),QT(N,h.right,-e+36,-e+36,Ft.DKCYAN,o),QT(N,h.right,-e+46,-e+46,Ft.DKCYAN,o);let U=-1;const B=Ri(a.cursor-v.start,1,v.end-v.start);if(he(v.tokens))for(let I=0;I<v.tokens.length;++I){const L=v.tokens[I];b&&B>=(L.startColumn??1)&&B<=(L.endColumn??1)&&(U=I);const P=(L.startColumn??1)-1-e,H=(L.endColumn??1)-1-e,X=pWe[L.tokenTypeIdx];if(he(X))switch(X){case sM:{const G=QH(L.image);switch(YL("",G,!!L.payload).type){case Vn.BOARD:case Vn.LOADER:case Vn.OBJECT:case Vn.TERRAIN:case Vn.CHARSET:case Vn.PALETTE:{qf(N,h.right,P,H,sM,o.active.bg,o);break}case Vn.CONST:case Vn.RANGE:case Vn.SELECT:case Vn.NUMBER:case Vn.TEXT:case Vn.HOTKEY:case Vn.COPYIT:case Vn.OPENIT:case Vn.ZSSEDIT:case Vn.CHAREDIT:case Vn.COLOREDIT:{const[J]=G;qf(N,h.right,P,P+J.length,sM,o.active.bg,o),G.length>1&&qf(N,h.right,P+J.length+1,H,Kre,o.active.bg,o);break}default:qf(N,h.right,P,H,Ft.DKRED,o.active.bg,o);break}break}case Ra:{qf(N,h.right,P,P,X,o.active.bg,o),P!==H&&qf(N,h.right,P+1,H,Ww,o.active.bg,o);break}case Ww:{const G=xWe(L.image);if(sr(G))for(let Y=0;Y<G.length;++Y)qf(N,h.right,P+Y,H+Y,G[Y],o.active.bg,o);else qf(N,h.right,P,H,G,o.active.bg,o);break}default:qf(N,h.right,P,H,X,o.active.bg,o);break}}if(p&&v.start<=d&&v.end>=f){const I=Math.max(v.start,f)-v.start-e,L=Math.min(v.end,d)-v.start-e,P=h.width-3,H=Math.max(0,I),X=Math.min(P,L);H<=P&&X>=m&&qf(N,h.right,H,X,iWe,sWe,o)}if(b&&he(v.tokens)){let I;if(he(v.asts)){for(let L=0;L<(v.asts?.length??0);++L)v.asts[L].type===Bn.IF&&(I=v.asts[L]);he(I)||(I=v.asts.find(L=>B<=(L.endColumn??0)))}oM=void 0;for(let L=U;L>=0;--L){const P=v.tokens[L-1],H=v.tokens[L],X=v.tokens[L+1];switch(H.tokenTypeIdx){case U0.tokenTypeIdx:case Ub.tokenTypeIdx:case Lb.tokenTypeIdx:case Bb.tokenTypeIdx:case Qb.tokenTypeIdx:case ux.tokenTypeIdx:case uA.tokenTypeIdx:case hA.tokenTypeIdx:case fA.tokenTypeIdx:case Db.tokenTypeIdx:case lA.tokenTypeIdx:if(H.tokenTypeIdx===Db.tokenTypeIdx&&(!he(I)||H.startColumn!==I.startColumn))continue;break;default:continue}switch(H.tokenTypeIdx){case U0.tokenTypeIdx:{op(`editor:command:${X.image}`);break}case Ub.tokenTypeIdx:{op("editor:command:do");break}case Lb.tokenTypeIdx:{op(P.tokenTypeIdx===Bb.tokenTypeIdx?"editor:command:elseif":"editor:command:if");break}case Bb.tokenTypeIdx:{op(X.tokenTypeIdx===Lb.tokenTypeIdx?"editor:command:elseif":"editor:command:else");break}case Qb.tokenTypeIdx:{const G=QH(H.image),Y=YL("",G,!!H.payload);op(`editor:stat:${xv(Y.type)}`);break}case ux.tokenTypeIdx:{op("editor:label");break}case uA.tokenTypeIdx:{op("editor:comment");break}case hA.tokenTypeIdx:{op("editor:hyperlink");break}case fA.tokenTypeIdx:{op("editor:shorttry");break}case Db.tokenTypeIdx:{op("editor:shortgo");break}case lA.tokenTypeIdx:{op("editor:text");break}}break}un(oM?.desc)&&ei(oM.desc,o,!1)}const[$]=v.errors??[];if(T&&he(S.errors)){o.x=R;const[I]=S.errors,L=`${I.message}`.replaceAll(`
`," ");b4(L,o,!1),qf(N,h.right,0,L.length-1,Ft.WHITE,XH,o)}else if(he($)){const I=3+($.column??1),L=$.length??1;QT(N,h.right,0,2,XH,o),QT(N,h.right,I,I+L-1,fWe,o)}if(++o.y,o.y>=h.bottom)break}return o.disablewrap=!1,o.active.rightedge=o.width,null}function lD(n){switch(n){case"stat":case"text":case"hyperlink":return!1;default:return!0}}rs("a",L1);rs("b",L1);rs("c",L1);rs("d",L1);rs("e",L1);rs("f",L1);rs("g",L1);rs("x",TWe);rs("#",Qre);rs("!",Qre);rs("y",U1);rs("t",U1);rs("s",U1);rs("i",U1);rs("q",U1);rs("h",U1);rs("w",U1);rs("3",Zre);rs(".",Zre);rs("+",Jre);rs("-",Jre);rs("0",bg);rs("1",bg);rs("2",bg);rs("p",bg);rs("4",bg);rs("5",bg);rs("6",bg);rs("7",bg);rs("8",bg);rs("9",bg);rs(";",Ra);function eG(){const n=ii(),[e]=hs(Ph(w=>[w.editor])),[t,r,i,s,o,a,c,l,u,h,f]=Qr(Ph(w=>[w.zsswords.cli,w.zsswords.loader,w.zsswords.runtime,w.zsswords.flags,w.zsswords.stats,w.zsswords.kinds,w.zsswords.altkinds,w.zsswords.colors,w.zsswords.dirs,w.zsswords.dirmods,w.zsswords.exprs]));Ke.useEffect(()=>{t.filter(lD).forEach(w=>sp(w,lf)),r.filter(lD).forEach(w=>sp(w,lf)),i.filter(lD).forEach(w=>sp(w,lf)),s.forEach(w=>sp(w,mWe)),o.forEach(w=>sp(w,gWe)),a.forEach(w=>sp(w,_We)),c.forEach(w=>sp(w,vWe)),l.forEach(w=>sp(w,yWe)),u.forEach(w=>sp(w,bWe)),h.forEach(w=>sp(w,SWe)),f.forEach(w=>sp(w,EWe))},[t,r,i,s,o,a,c,l,u,h,f]);const d=Dl(),p=FQ(KY(e.book,e.path));Ke.useEffect(()=>(vxe(qe,n,e.book,e.path),()=>{yxe(qe,n,e.book,e.path)}),[e.book,e.path,n]);const m=he(p)?p.toJSON():"",_=aWe(m),v=Yre(d.cursor,_),S=d.cursor-_[v].start,b=QZ(m);if(he(b.tokens)){let w=!0;for(let R=0;R<b.tokens.length;++R){const C=b.tokens[R];C.tokenTypeIdx===Qb.tokenTypeIdx&&(C.payload=w,w=!1);const N=_[(C.startLine??1)-1];he(N)&&(N.tokens=N.tokens??[],N.tokens.push(C))}}if(b?.ast?.type===Bn.PROGRAM){mJ(b.ast);const w=[];for(let R=1;R<b.ast.lines.length;++R)w.push(b.ast.lines[R]);for(;w.length;){const R=w.pop();if(rn(R?.type)){switch(R.type){case Bn.LINE:case Bn.IF:if(rn(R.startLine)){const N=_[R.startLine-1];N.asts=N.asts??[],N.asts.unshift(R)}break}const C=Zm(R);for(let N=0;N<C.length;++N){const U=C[N],B=R[U];sr(B)?w.push(...B):typeof B=="object"&&w.push(B)}}}}if(he(b.errors))for(let w=0;w<b.errors.length;++w){const R=b.errors[w],C=_[(R.line??1)-1];he(C)&&(C.errors=C.errors??[],C.errors.push(R))}const T={rows:_,xcursor:S,ycursor:v,codepage:p,xoffset:-4+d.xscroll,yoffset:d.yscroll};return be.jsxs(be.Fragment,{children:[be.jsx(vB,{bump:!0}),be.jsx(AWe,{}),be.jsx(RWe,{...T}),be.jsx(CWe,{...T})]})}function kWe(n,e,t,r){const i=n.slice(0,e),s=n.slice(e+t);return`${i}${r??""}${s}`}function MWe(n){const[e,t]=n.split(":"),r=he(t);return[r?e:"self",r?t:n]}function IWe(n){return Math.max(bn+1,n-1)}function tie(n,e,t){return n.startsWith("!")?1:f_(n,e,t)?.y??1}const OWe=self.SpeechRecognition??self.webkitSpeechRecognition??self.mozSpeechRecognition??self.msSpeechRecognition??self.oSpeechRecognition;class NWe{recognition;constructor(e,t,r,i=navigator.language){if(!("webkitSpeechRecognition"in window))throw new Error("This browser doesn't support speech recognition. Try Google Chrome.");this.recognition=new OWe,this.recognition.interimResults=!!r,this.recognition.lang=i;let s="";this.recognition.onresult=o=>{let a="";for(let c=o.resultIndex;c<o.results.length;c+=1){const l=o.results[c][0].transcript;o.results[c].isFinal?(s+=l,e(s),s=""):this.recognition.interimResults&&(a+=l,r(a))}},this.recognition.onend=()=>{t()}}startListening(){this.recognition.start()}stopListening(){this.recognition.stop()}}function PWe({quickterminal:n,voice2text:e,tapeycursor:t,logrowtotalheight:r}){const i=Ef(),s=Wl(),o=Ai(),[a]=hs(Ph(L=>[L.editor.open])),c=ii(),l=Ip(s),u=o.buffer[o.bufferindex];let h=o.xcursor,f=o.xcursor,d=!1;he(o.xselect)&&he(o.yselect)&&(d=!0,h=Math.min(o.xcursor,o.xselect),f=Math.max(o.xcursor,o.xselect),o.xcursor!==o.xselect&&--f);const p=f-h+1,m=o.ycursor===0,_=d?u.substring(h,f+1):u,v=Ke.useCallback((L,P,H)=>{o.bufferindex>0&&Ai.setState({bufferindex:0}),o.buffer[0]=kWe(u,L,P,H),Ai.setState({buffer:o.buffer,xselect:void 0,xcursor:L+(H??"").length})},[u,o.buffer,o.bufferindex]),S=Ke.useCallback(L=>{o.bufferindex>0&&Ai.setState({bufferindex:0}),o.buffer[0]=L,Ai.setState({buffer:o.buffer,xselect:void 0,xcursor:L.length})},[o.buffer,o.bufferindex]),b=l.bottom-l.top-(a?0:2),T=Ke.useCallback(L=>{Ai.setState(P=>{const H=Ri(Math.round(P.ycursor+L),0,r),X=Ri(H-Math.round(b*.5),0,r-b);return{ycursor:H,scroll:X}})},[r,b]);function w(L){const P=o.buffer.length-1,H=Ri(L,0,P);Ai.setState({bufferindex:H,scroll:0,xcursor:o.buffer[H].length,ycursor:0,xselect:void 0,yselect:void 0})}function R(L){L?he(o.xselect)||Ai.setState({xselect:o.xcursor,yselect:o.ycursor}):Ai.setState({xselect:void 0,yselect:void 0})}function C(){he(o.xselect)&&(Ai.setState({xcursor:h,xselect:void 0,yselect:void 0}),v(h,p))}const N=Ke.useCallback(()=>{Ai.setState({scroll:0,xcursor:u.length,ycursor:0,xselect:void 0,yselect:void 0})},[u.length]);if(s.reset.bg=dT(n),!n){K0(!1,0,0,s);const L="$DKCYANmain:0.86.1 feat: #screenshot (#612)",P=f_(L,l.width,1);s.x=l.width-(P?.measuredwidth??0)-1,ei(L,s,!0)}const U="$196",$="$205".repeat(l.width-6);K0(!1,0,l.height-2,s),s.active.color=Ft.WHITE,ei(`  ${U}${$}${U}  `,s,!0);const I=u.padEnd(l.width," ");if(K0(!1,0,l.height-1,s),s.active.color=Ft.WHITE,b4(I,s,!0),he(o.xselect)&&he(o.yselect)&&o.xcursor!==o.xselect){const L=Math.min(o.xcursor,o.xselect),P=Math.min(o.ycursor,o.yselect),H=Math.max(o.xcursor,o.xselect)-1,X=Math.max(o.ycursor,o.yselect);for(let G=P;G<=X;++G){const Y=L+(l.bottom-G)*l.width,J=H+(l.bottom-G)*l.width;Tx(Y,J,15,8,s)}}if(i){const L=l.left+o.xcursor,P=l.top+t;if(P>=l.top&&P<=l.bottom&&L>=l.left&&L<=l.right){const H=L+P*s.width;r3(H,"",s),Tx(H,H,Ft.WHITE,s.reset.bg,s)}}return Ke.useEffect(()=>{let L;if(!e||!n)return;const{buffer:P,bufferindex:H}=Ai.getState(),X=P[H];if(X!=="")return;function G(Q){S(`${X}${Q}`),setTimeout(()=>{const{buffer:z,bufferindex:q}=Ai.getState(),ee=z[q],te=["",ee,...z.slice(1).filter(ie=>ie!==ee)].filter(ie=>ie.includes("#broadcast")===!1);z$(te).catch(ie=>_r(qe,c,"terminalinput",ie.message)),Ai.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:te}),zm(qe,c,ee),Bw(qe,c)},512)}function Y(){}function J(Q){S(`${X}${Q}`)}try{L=new NWe(G,Y,J),L?.startListening()}catch(Q){console.error(Q.message)}return()=>{L?.stopListening(),L=void 0}},[]),be.jsxs(be.Fragment,{children:[be.jsx(lB,{blocking:!0,x:l.left,y:l.top,width:l.width,height:l.height,onClick:()=>{document.getElementById("touchtext")?.focus()},onScroll:L=>{R(!1),T(-L)}}),be.jsx(Ao,{MOVE_LEFT:L=>{R(L.shift),L.ctrl?Ai.setState({xcursor:0}):Ai.setState({xcursor:Ri(o.xcursor-(L.alt?10:1),0,l.right)})},MOVE_RIGHT:L=>{R(L.shift),L.ctrl?Ai.setState({xcursor:m?u.length:l.right}):Ai.setState({xcursor:Ri(o.xcursor+(L.alt?10:1),0,l.right)})},MOVE_UP:L=>{L.ctrl?w(o.bufferindex+1):(R(L.shift),T(L.alt?10:1))},MOVE_DOWN:L=>{L.ctrl?w(o.bufferindex-1):(R(L.shift),T(-(L.alt?10:1)))},OK_BUTTON:()=>{const L=d?_:u;if(L.length)if(m){const{buffer:P}=Ai.getState(),H=["",L,...P.slice(1).filter(X=>X!==L)].filter(X=>X.includes("#broadcast")===!1);z$(H).catch(X=>_r(qe,c,"terminalinput",X.message)),Ai.setState({xcursor:0,bufferindex:0,xselect:void 0,yselect:void 0,buffer:H}),zm(qe,c,L),n&&Bw(qe,c)}else N()},CANCEL_BUTTON:()=>{Bw(qe,c)},MENU_BUTTON:L=>{VY(qe,c,!L.shift)},keydown:L=>{const{key:P}=L,H=cr(P),X=EC(L);switch(H){case"delete":m?d?C():u.length>0&&v(o.xcursor,1):N();break;case"backspace":m?d?C():o.xcursor>0&&v(o.xcursor-1,1):N();break;default:if(X.ctrl)switch(H){case"p":g6(qe,c);break;case"a":Ai.setState({xselect:0,yselect:0,xcursor:u.length,ycursor:0});break;case"c":m&&he(da())?da().writeText(_):N();break;case"v":m&&he(da())?da().readText().then(G=>{try{const J=JSON.parse(G);if(un(J.exported)&&he(J.data)){Th(qe,c,void 0,"json",`file:${J.exported}`,JSON.stringify(J));return}}catch(J){console.error(J)}const Y=G.replaceAll("\r","");d?v(h,p,Y):v(o.xcursor,0,Y)}).catch(G=>console.error(G)):N();break;case"x":m&&he(da())?da().writeText(_).then(()=>C()).catch(G=>console.error(G)):N();break}else X.alt||L.key.length===1&&(m&&o.xcursor<=u.length?d?(v(h,p,L.key),Ai.setState({xselect:void 0})):v(o.xcursor,0,L.key):N());break}}})]})}function DWe({active:n,prefix:e,label:t,words:r,y:i}){const s=Wl(),o=Ke.useCallback(()=>{const[,...c]=r;lx(qe,ii(),c.join(" "))},[r]),a=Kl(!!n);return K0(!!n,0,i,s),ei(`${e} $purple$16 $yellowCOPYIT ${a}${t}`,s,!0),n&&be.jsx(Ao,{OK_BUTTON:o})}function LWe({active:n,prefix:e,label:t,words:r,y:i}){const s=Wl(),o=Ke.useContext(qre),a=Ke.useCallback(()=>{const[l,...u]=r;setTimeout(()=>{o.sendmessage(l,u)},100)},[r,o]),c=Kl(!!n);return K0(!!n,0,i,s),ei(`${e} $purple$16 ${c}${t}`,s,!0),n&&be.jsx(Ao,{OK_BUTTON:a})}function UWe({active:n,prefix:e,label:t,words:r,y:i}){const s=Wl(),o=Ke.useCallback(()=>{const[,c,...l]=r,u=l.join(" "),h=ii();setTimeout(()=>{switch(c){case"wiki":oo(qe,h,async()=>{const f=await UU(u);qU(h,f)});break;case"inline":window.location.href=u;break;default:window.open(`${c} ${u}`.trim(),"_blank");break}},100)},[r]),a=Kl(!!n);return K0(!!n,0,i,s),ei(`${e} $purple$16 $yellowOPENIT ${a}${t}`,s,!0),n&&be.jsx(Ao,{OK_BUTTON:o})}function BWe({active:n,prefix:e,label:t,words:r,y:i}){const s=Wl(),o=Ke.useCallback(()=>{const[,...c]=r;Jb(qe,ii(),c.join(" "))},[r]),a=Kl(!!n);return K0(!!n,0,i,s),ei(`${e} $purple$16 $CYANRUNIT ${a}${t}`,s,!0),n&&be.jsx(Ao,{OK_BUTTON:o})}function FWe({active:n,prefix:e,label:t,words:r,y:i}){const s=Wl(),{setviewimage:o}=ya(),a=Ke.useCallback(()=>{const[,...l]=r,u=l.join(" ");setTimeout(()=>o(u),100)},[o,r]),c=Kl(!!n);return K0(!!n,0,i,s),ei(`${e} $purple$16 $CYANVIEWIT ${c}${t}`,s,!0),n&&be.jsx(Ao,{OK_BUTTON:a})}function nie({active:n,text:e,y:t}){const r=Wl(),{quickterminal:i}=hs(),s=Ip(r),o=e.startsWith("!");K0(!!n,0,t,r),r.reset.bg=n?_B:dT(i),r.active.bottomedge=s.bottom;const a=OU(e);if(he(a)){const c=s.width-3,u=f_(a,c,3)?.measuredwidth??1,h=Ri(Math.floor(c*.5-u*.5),0,c);ei(`${" ".repeat(h)}$WHITE${a}`,r,!0)}else ei(o?"":e,r,!0);if(o){const[c,...l]=e.slice(1).split("!"),u=`${l.join("!")}`;let h="PRESS ME";const f=[],d=Jx(u,!0);for(let v=0;v<d.tokens.length;v++){const S=d.tokens[v];S.tokenType===n3?h=S.image.slice(1):f.push(S.image)}const[p,...m]=f,_={active:n,prefix:c,label:h,words:m,y:t};switch(cr(p)){case"copyit":return be.jsx(DWe,{..._,words:f});case"openit":return be.jsx(UWe,{..._,words:f});case"viewit":return be.jsx(FWe,{..._,words:f});case"runit":return be.jsx(BWe,{..._,words:f});default:case"hyperlink":return be.jsx(LWe,{..._,words:f});case"hk":case"hotkey":return null;case"rn":case"range":return null;case"sl":case"select":return null;case"nm":case"number":return null;case"tx":case"text":return null;case"zssedit":return null;case"charedit":return null;case"coloredit":return null}}return null}function jWe({active:n,text:e,y:t}){return Ef(),be.jsx(nie,{active:n,text:e,y:t})}function zWe(){const n=yg(),e=hs(m=>m.editor.open),t=hs(m=>m.terminal.logs),r=Wl(),i=Ai(m=>m.scroll),s=Ai(m=>m.xcursor),o=Ai(m=>m.ycursor),a=Ip(r);Ke.useEffect(()=>{const m=Ai.getState().pan;if(r.width>n.cols){const _=Math.round(n.cols*.5),v=Math.round(n.cols*.75),S=n.cols-v,b=r.width-n.cols,T=s-m;T<S?Ai.setState({pan:Ri(m-_,0,b)}):T>v&&Ai.setState({pan:Ri(m+_,0,b)})}else m!==0&&Ai.setState({pan:0})},[s,n.cols,r.width]);const c=r.width-1,l=t.map(m=>tie(m,c,a.height)),u=a.bottom-a.top-(e?0:2);let h=u+1;const f=l.map(m=>(h-=m,h)),d=a.bottom-o+i,p=t.map((m,_)=>{const v=f[_]+i,S=l[_],b=v+S;return b<0||v<0||v>u?null:[_,m,v,!e&&d>=v&&d<b]}).filter(m=>m!==null);return be.jsx(be.Fragment,{children:be.jsx(bC.Provider,{value:r,children:p.map(([m,_,v,S])=>S?be.jsx(jWe,{active:!0,text:_,y:v},m):be.jsx(nie,{text:_,y:v},m))})})}function tG(){const n=ii(),e=hs(d=>d.editor.open),t=hs(d=>d.terminal.logs),r=hs(d=>d.quickterminal),[i,s]=Ke.useState(void 0);Ke.useLayoutEffect(()=>{oo(qe,ii(),async()=>{const d=await Jk("voice2text");s(d==="on")})},[]);const o=Wl(),a=Ai(),c=Ip(o),l=o.width-1,u=t.map(d=>tie(d,l,c.height));let h=0;u.forEach(d=>{h+=d}),++h;const f=c.bottom-a.ycursor+a.scroll;return be.jsxs(be.Fragment,{children:[be.jsx(vB,{}),be.jsxs(qre.Provider,{value:{sendmessage(d,p){const[m,_]=MWe(d);if(m==="self"){const v=`#${_} ${p.join(" ")}`;zm(qe,n,v)}else qe.emit(n,`${m}:${_}`,p)}},children:[be.jsx(zWe,{}),!e&&i!==void 0&&be.jsx(PWe,{quickterminal:r,voice2text:i,tapeycursor:f,logrowtotalheight:h})]})]})}function pk({quickterminal:n,top:e,left:t,width:r,height:i,children:s}){const o=dT(n),a=R1(r,i,0,$I,o),c=Ke.useMemo(()=>({...h_(r,i,$I,o),...a.getState()}),[o,r,i,a]);return be.jsxs(P1,{store:a,children:[be.jsxs(bC.Provider,{value:c,children:[be.jsx(vB,{}),s]}),be.jsx("group",{position:[t*kn.DRAW_CHAR_WIDTH(),e*kn.DRAW_CHAR_HEIGHT(),0],children:be.jsx(D1,{width:r,height:i})})]})}function $We({quickterminal:n,top:e,width:t,height:r}){const i=Ai(c=>c.pan),s=hs(c=>c.layout);if(hs(c=>c.editor.open)){if(s===id.SPLIT_X){const c=oWe(t);return be.jsxs(be.Fragment,{children:[be.jsx(pk,{quickterminal:n,top:e,left:0,width:c,height:r,children:be.jsx(eG,{})}),be.jsx(pk,{quickterminal:n,top:e,left:c,width:t-c,height:r,children:be.jsx(tG,{})})]})}return be.jsx(pk,{quickterminal:n,top:e,left:0,width:t,height:r,children:be.jsx(eG,{})})}const a=IWe(t);return be.jsx(pk,{quickterminal:n,top:e,left:-i,width:a,height:r,children:be.jsx(tG,{})})}function VWe(){const n=yg(),[e,t,r,i]=hs(Ph(l=>[l.layout,l.quickterminal,l.terminal.open,l.editor.open]));let s=0,o=n.rows;switch(e){case id.TOP:o=Math.floor(n.rows*.5);break;case id.BOTTOM:o=Math.ceil(n.rows*.5),s=n.rows-o;break;default:case id.FULL:break}if(n.cols<10||n.rows<10)return null;const a=ii(),c=t||r||i;return be.jsxs(be.Fragment,{children:[c&&be.jsx(L3,{width:n.cols,height:n.rows,top:s,left:0,right:n.cols-1,bottom:s+o-1,alpha:t?.666:.333}),c?be.jsx(iy,{blockhotkeys:!0,children:be.jsx($We,{quickterminal:t,top:s,width:n.cols,height:o})}):be.jsxs(be.Fragment,{children:[be.jsx(Vb,{hotkey:"Shift+?",althotkey:"/",children:()=>Jb(qe,a)}),be.jsx(Vb,{hotkey:"`",children:()=>Jb(qe,a)})]})]})}const HWe=`
// CRT Emulation
// by Mattias

vec3 sample_(sampler2D tex, vec2 tc) {
	vec3 s = pow(texture2D(tex, tc).rgb, vec3(2.0));
	return s;
}

vec3 blur(sampler2D tex, vec2 tc, float offs) {
	vec4 xoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) * texelSize.x * 0.01;
	vec4 yoffs = offs * vec4(-2.0, -1.0, 1.0, 2.0) * texelSize.y * 0.001;
	
	vec3 color = vec3(0.0, 0.0, 0.0);
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.x)) * 0.00366;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.x)) * 0.01465;
	color += sample_(tex, tc + vec2(    0.0, yoffs.x)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.x)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.x)) * 0.00366;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.y)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.y)) * 0.05861;
	color += sample_(tex, tc + vec2(    0.0, yoffs.y)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.y)) * 0.05861;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.y)) * 0.01465;
	
	color += sample_(tex, tc + vec2(xoffs.x, 0.0)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.y, 0.0)) * 0.09524;
	color += sample_(tex, tc + vec2(    0.0, 0.0)) * 0.15018;
	color += sample_(tex, tc + vec2(xoffs.z, 0.0)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.w, 0.0)) * 0.02564;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.z)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.z)) * 0.05861;
	color += sample_(tex, tc + vec2(    0.0, yoffs.z)) * 0.09524;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.z)) * 0.05861;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.z)) * 0.01465;
	
	color += sample_(tex, tc + vec2(xoffs.x, yoffs.w)) * 0.00366;
	color += sample_(tex, tc + vec2(xoffs.y, yoffs.w)) * 0.01465;
	color += sample_(tex, tc + vec2(    0.0, yoffs.w)) * 0.02564;
	color += sample_(tex, tc + vec2(xoffs.z, yoffs.w)) * 0.01465;
	color += sample_(tex, tc + vec2(xoffs.w, yoffs.w)) * 0.00366;

	return color;
}

float rand(vec2 co) {
  float a = 12.9898;
  float b = 78.233;
  float c = 43758.5453;
  float dt = dot(co.xy, vec2(a, b));
  float sn = mod(dt, 3.14);
  return fract(sin(sn) * c);
}

void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor) {
  vec3 col;  
  col.r = 1.0 * blur(inputBuffer, vec2(uv.x + 0.0009, uv.y + 0.0009), 1.2).x + 0.005;
  col.g = 1.0 * blur(inputBuffer, vec2(uv.x + 0.000, uv.y - 0.0015), 1.2).y + 0.005;
  col.b = 1.0 * blur(inputBuffer, vec2(uv.x - 0.0015, uv.y + 0.000), 1.2).z + 0.005;  

  col.r += 0.2 * blur(inputBuffer, vec2(uv.x + 0.0009, uv.y + 0.0009), 2.25).x - 0.005;
  col.g += 0.2 * blur(inputBuffer, vec2(uv.x + 0.000, uv.y - 0.0015), 1.75).y - 0.005;
  col.b += 0.2 * blur(inputBuffer, vec2(uv.x - 0.0015, uv.y + 0.000), 1.25).z - 0.005;
  
  float ghs = 0.05;
	float gphase = 0.371 * sin(time * 0.1);
	col.r += ghs * (1.0 - 0.299) * blur(inputBuffer, gphase * vec2(0.01, -0.027) + vec2(uv.x + 0.001, uv.y + 0.001), 7.0).x;
  col.g += ghs * (1.0 - 0.587) * blur(inputBuffer, gphase * vec2(-0.022, -0.02) + vec2(uv.x + 0.000, uv.y - 0.002), 5.0).y;
  col.b += ghs * (1.0 - 0.114) * blur(inputBuffer, gphase * vec2(-0.02, -0.0) + vec2(uv.x - 0.002, uv.y + 0.000), 3.0).z;

  col = clamp(col * 0.4 + 0.6 * col * 1.0, 0.0, 1.0);
	col = mix(col, col * col * col * col * col * col, 0.5) * 3.8;

	float scans = clamp(0.35 + 0.15 * sin(3.5 * (time * 0.125) + uv.y * resolution.y * 1.5), 0.0, 1.0);
	float s = pow(scans, 0.999);
	col = col * vec3(s);

  col *= 1.0 + 0.0015 * sin(500.0 * time);
  col *= 1.0 - 0.15 * vec3(clamp((mod(uv.x * texelSize.x, 2.0) - 1.0) * 2.0, 0.0, 1.0));
	
  col *= vec3(1.0) - 0.25 * vec3(
   rand(uv + 0.0001 * time), 
   rand(uv + 0.0001 * time + 0.3), 
   rand(uv + 0.0001 * time + 0.5));
	col = pow(col, vec3(0.45));

  outputColor = vec4(col.rgb, 1.0);
}
`;class GWe extends yd{constructor(){super("ScanlinesEffect",HWe,{blendFunction:di.NORMAL,attributes:Su.CONVOLUTION,defines:new Map([]),uniforms:new Map([])})}update(){}}const WWe=hT(GWe),nG=n=>(n.getAttributes()&Su.CONVOLUTION)===Su.CONVOLUTION,qWe=Ke.memo(Ke.forwardRef(({children:n,width:e,height:t},r)=>{const{gl:i,scene:s,camera:o}=jc(),[a]=Ke.useMemo(()=>{const u=new kre(i,{depthBuffer:!0,stencilBuffer:!1,multisampling:0,frameBufferType:Zv});return u.addPass(new Ire(s,o)),[u]},[o,i,s]);s_((u,h)=>{const f=i.autoClear;i.autoClear=!0,a.setSize(e,t),a.render(h),i.autoClear=f},2);const c=Ke.useRef(null);Ke.useLayoutEffect(()=>{const u=[],h=c.current.__r3f;if(h&&a){const f=h.children;for(let d=0;d<f.length;d++){const p=f[d].object;if(p instanceof yd){const m=[p];if(!nG(p)){let v=null;for(;(v=f[d+1]?.object)instanceof yd&&!nG(v);)m.push(v),d++}const _=new Ore(o,...m);u.push(_)}else p instanceof Dh&&u.push(p)}for(const d of u)a?.addPass(d)}return()=>{for(const f of u)a?.removePass(f)}},[a,n,o]);const l=Ke.useMemo(()=>({composer:a,normalPass:null,downSamplingPass:null,resolutionScale:void 0,camera:o,scene:s}),[a,o,s]);return Ke.useImperativeHandle(r,()=>a,[a]),be.jsx(rB.Provider,{value:l,children:be.jsx("group",{ref:c,children:n})})}));function YWe({context:n}){return be.jsx("group",{position:[0,0,999],children:be.jsx(D1,{width:n.width,height:n.height})})}function rG({toast:n}){const e=yg(),t=R1(e.cols,1,0,Ft.GREEN,Ft.ONCLEAR),r={...h_(e.cols,1,Ft.GREEN,Ft.ONCLEAR,0,0,e.cols-1,1),...t.getState()};if(e.cols<10||e.rows<10)return null;const i=e.cols-1;return be.jsx(P1,{store:t,children:n&&be.jsxs(be.Fragment,{children:[be.jsx(uB,{margin:1,color:Ft.YELLOW,y:0,leftedge:0,rightedge:i,line:`${n}$32$19$32`,context:r}),be.jsx("group",{position:[0,0,998],children:be.jsx(L3,{alpha:.4,width:e.cols,height:10,top:0,left:0,right:i,bottom:0})}),be.jsx(YWe,{context:r})]})})}function KWe({url:n,drawwidth:e,drawheight:t}){const r=A5(Wce,n);Ke.useEffect(()=>{r.flipY=!0,bee(r)},[r]);const{width:i=1,height:s=1}=r?.image??{},o=Math.min(e/i,t/s),a=i*o,c=s*o;return be.jsxs("mesh",{children:[be.jsx("planeGeometry",{args:[a,c]}),be.jsx("meshBasicMaterial",{map:r})]})}function XWe(){const n=yg(),{viewimage:e,setviewimage:t}=ya();if(n.cols<10||n.rows<10)return null;const r=n.cols-1,i=n.rows-1,s=(n.cols-4)*kn.DRAW_CHAR_WIDTH(),o=(n.rows-2)*kn.DRAW_CHAR_HEIGHT(),a=n.cols*kn.DRAW_CHAR_WIDTH()*.5,c=n.rows*kn.DRAW_CHAR_HEIGHT()*.5;return e&&be.jsxs(iy,{children:[be.jsx(Ao,{CANCEL_BUTTON:()=>t("")}),be.jsxs("group",{position:[0,0,998],children:[be.jsx(L3,{alpha:.4,width:n.cols,height:n.rows,top:0,left:0,right:r,bottom:i}),be.jsx("group",{position:[a,c,1],"scale-x":-1,"rotation-z":Math.PI,children:be.jsx(Ke.Suspense,{fallback:null,children:be.jsx(KWe,{url:e,drawwidth:s,drawheight:o})})})]})]})}var lw={},uw={},hw={},iG;function ZWe(){if(iG)return hw;iG=1,Object.defineProperty(hw,"__esModule",{value:!0}),hw.Slice=void 0;let n=class{constructor(t,r,i,s){this.uint8=t,this.view=r,this.start=i,this.end=s}subarray(){return this.uint8.subarray(this.start,this.end)}};return hw.Slice=n,hw}var sG;function JWe(){if(sG)return uw;sG=1,Object.defineProperty(uw,"__esModule",{value:!0}),uw.Writer=void 0;const n=ZWe(),e=new Uint8Array([]),t=new DataView(e.buffer),r=typeof io=="function",i=r?io.prototype.utf8Write:null,s=r?io.from:null,o=typeof TextEncoder<"u"?new TextEncoder:null;let a=class{constructor(l=64*1024){this.allocSize=l,this.view=t,this.x0=0,this.x=0,this.uint8=new Uint8Array(l),this.size=l,this.view=new DataView(this.uint8.buffer)}grow(l){const u=this.x0,h=this.x,f=this.uint8,d=new Uint8Array(l),p=new DataView(d.buffer),m=f.subarray(u,h);d.set(m,0),this.x=h-u,this.x0=0,this.uint8=d,this.size=l,this.view=p}ensureCapacity(l){const u=this.size,h=u-this.x;if(h<l){const f=u-this.x0,d=l-h,p=f+d;this.grow(p<=this.allocSize?this.allocSize:p*2)}}move(l){this.ensureCapacity(l),this.x+=l}reset(){this.x0=this.x}newBuffer(l){const u=this.uint8=new Uint8Array(l);this.size=l,this.view=new DataView(u.buffer),this.x=this.x0=0}flush(){const l=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,l}flushSlice(){const l=new n.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,l}u8(l){this.ensureCapacity(1),this.uint8[this.x++]=l}u16(l){this.ensureCapacity(2),this.view.setUint16(this.x,l),this.x+=2}u32(l){this.ensureCapacity(4),this.view.setUint32(this.x,l),this.x+=4}i32(l){this.ensureCapacity(4),this.view.setInt32(this.x,l),this.x+=4}u64(l){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(l)),this.x+=8}f64(l){this.ensureCapacity(8),this.view.setFloat64(this.x,l),this.x+=8}u8u16(l,u){this.ensureCapacity(3);let h=this.x;this.uint8[h++]=l,this.uint8[h++]=u>>>8,this.uint8[h++]=u&255,this.x=h}u8u32(l,u){this.ensureCapacity(5);let h=this.x;this.uint8[h++]=l,this.view.setUint32(h,u),this.x=h+4}u8u64(l,u){this.ensureCapacity(9);let h=this.x;this.uint8[h++]=l,this.view.setBigUint64(h,BigInt(u)),this.x=h+8}u8f32(l,u){this.ensureCapacity(5);let h=this.x;this.uint8[h++]=l,this.view.setFloat32(h,u),this.x=h+4}u8f64(l,u){this.ensureCapacity(9);let h=this.x;this.uint8[h++]=l,this.view.setFloat64(h,u),this.x=h+8}buf(l,u){this.ensureCapacity(u);const h=this.x;this.uint8.set(l,h),this.x=h+u}utf8(l){const u=l.length*4;if(u<168)return this.utf8Native(l);this.ensureCapacity(u);const h=this.size-this.x;if(i){const f=i.call(this.uint8,l,this.x,h);return this.x+=f,f}else if(s){const f=this.uint8,d=f.byteOffset+this.x,m=s(f.buffer).subarray(d,d+h).write(l,0,h,"utf8");return this.x+=m,m}else if(u>1024&&o){const f=o.encodeInto(l,this.uint8.subarray(this.x,this.x+h)).written;return this.x+=f,f}return this.utf8Native(l)}utf8Native(l){const u=l.length,h=this.uint8;let f=this.x,d=0;for(;d<u;){let m=l.charCodeAt(d++);if((m&4294967168)===0){h[f++]=m;continue}else if((m&4294965248)===0)h[f++]=m>>6&31|192;else{if(m>=55296&&m<=56319&&d<u){const _=l.charCodeAt(d);(_&64512)===56320&&(d++,m=((m&1023)<<10)+(_&1023)+65536)}(m&4294901760)===0?(h[f++]=m>>12&15|224,h[f++]=m>>6&63|128):(h[f++]=m>>18&7|240,h[f++]=m>>12&63|128,h[f++]=m>>6&63|128)}h[f++]=m&63|128}const p=f-this.x;return this.x=f,p}ascii(l){const u=l.length;this.ensureCapacity(u);const h=this.uint8;let f=this.x,d=0;for(;d<u;)h[f++]=l.charCodeAt(d++);this.x=f}};return uw.Writer=a,uw}var oG;function QWe(){if(oG)return lw;oG=1,Object.defineProperty(lw,"__esModule",{value:!0}),lw.MsgPackEncoderFast=void 0;const n=JWe();let e=class{constructor(r=new n.Writer){this.writer=r}encode(r){return this.writer.reset(),this.writeAny(r),this.writer.flush()}encodeAny(r){this.writeAny(r)}writeAny(r){switch(r){case null:return this.writer.u8(192);case!1:return this.writer.u8(194);case!0:return this.writer.u8(195)}if(r instanceof Array)return this.writeArr(r);switch(typeof r){case"number":return this.writeNumber(r);case"string":return this.writeStr(r);case"object":return this.writeObj(r)}}encodeFloat64(r){this.writeFloat(r)}writeNull(){return this.writer.u8(192)}writeFloat(r){this.writer.u8f64(203,r)}u32(r){const i=this.writer;this.writer.ensureCapacity(5);const s=i.uint8;r<=127?s[i.x++]=r:r<=65535?(s[i.x++]=205,i.view.setUint16(i.x,r),i.x+=2):r<=4294967295?(s[i.x++]=206,i.view.setUint32(i.x,r),i.x+=4):this.writeFloat(r)}n32(r){const i=this.writer;this.writer.ensureCapacity(5);const s=i.uint8;r>=-32?s[i.x++]=256+r:r>=-32768?(s[i.x++]=209,i.view.setInt16(i.x,r),i.x+=2):r>=-2147483648?(s[i.x++]=210,i.view.setInt32(i.x,r),i.x+=4):this.writeFloat(r)}encodeNumber(r){this.writeNumber(r)}writeNumber(r){if(r>>>0===r)return this.u32(r);if(r>>0===r)return this.n32(r);this.writeFloat(r)}writeInteger(r){if(r>=0){if(r<=4294967295)return this.u32(r);if(r>-2147483648)return this.n32(r)}this.writeFloat(r)}writeUInteger(r){if(r<=4294967295)return this.u32(r);this.writeFloat(r)}encodeNull(){this.writer.u8(192)}encodeTrue(){this.writer.u8(195)}encodeFalse(){this.writer.u8(194)}encodeBoolean(r){this.writeBoolean(r)}writeBoolean(r){r?this.writer.u8(195):this.writer.u8(194)}encodeStringHeader(r){this.writeStrHdr(r)}writeStrHdr(r){r<=31?this.writer.u8(160|r):r<=255?this.writer.u16(55552+r):r<=65535?this.writer.u8u16(218,r):this.writer.u8u32(219,r)}encodeString(r){this.writeStr(r)}writeStr(r){const i=this.writer,o=r.length*4;i.ensureCapacity(5+o);const a=i.uint8;let c=i.x;o<=31?i.x++:o<=255?(a[i.x++]=217,c=i.x,i.x++):o<=65535?(a[i.x++]=218,c=i.x,i.x+=2):(a[i.x++]=219,c=i.x,i.x+=4);const l=this.writer.utf8(r);o<=31?a[c]=160|l:o<=255?a[c]=l:o<=65535?i.view.setUint16(c,l):i.view.setUint32(c,l)}encodeAsciiString(r){this.writeAsciiStr(r)}writeAsciiStr(r){this.writeStrHdr(r.length),this.writer.ascii(r)}encodeArrayHeader(r){this.writeArrHdr(r)}encodeArray(r){this.writeArr(r)}writeArrHdr(r){r<=15?this.writer.u8(144|r):r<=65535?this.writer.u8u16(220,r):r<=4294967295&&this.writer.u8u32(221,r)}writeArr(r){const i=r.length;i<=15?this.writer.u8(144|i):i<=65535?this.writer.u8u16(220,i):i<=4294967295&&this.writer.u8u32(221,i);for(let s=0;s<i;s++)this.writeAny(r[s])}encodeObjectHeader(r){this.writeObjHdr(r)}encodeObject(r){this.writeObj(r)}writeObjHdr(r){r<=15?this.writer.u8(128|r):r<=65535?this.writer.u8u16(222,r):r<=4294967295&&this.writer.u8u32(223,r)}writeObj(r){const i=Object.keys(r),s=i.length;this.writeObjHdr(s);for(let o=0;o<s;o++){const a=i[o];this.writeStr(a),this.writeAny(r[a])}}encodeExtHeader(r,i){switch(i){case 1:this.writer.u16(54272|r);break;case 2:this.writer.u16(54528|r);break;case 4:this.writer.u16(54784|r);break;case 8:this.writer.u16(55040|r);break;case 16:this.writer.u16(55296|r);break;default:i<=255?(this.writer.u16(50944|i),this.writer.u8(r)):i<=65535?(this.writer.u8u16(200,i),this.writer.u8(r)):i<=4294967295&&(this.writer.u8u32(201,i),this.writer.u8(r))}}encodeExt(r){const{tag:i,val:s}=r,o=s.length;this.encodeExtHeader(i,o),this.writer.buf(s,o)}encodeBinaryHeader(r){this.writeBinHdr(r)}encodeBinary(r){this.writeBin(r)}writeBinHdr(r){r<=255?this.writer.u16(50176|r):r<=65535?this.writer.u8u16(197,r):r<=4294967295&&this.writer.u8u32(198,r)}writeBin(r){const i=r.length;this.writeBinHdr(i),this.writer.buf(r,i)}};return lw.MsgPackEncoderFast=e,lw}QWe();var In;(function(n){n[n.add=0]="add",n[n.remove=1]="remove",n[n.replace=2]="replace",n[n.copy=3]="copy",n[n.move=4]="move",n[n.test=5]="test",n[n.str_ins=6]="str_ins",n[n.str_del=7]="str_del",n[n.flip=8]="flip",n[n.inc=9]="inc",n[n.split=10]="split",n[n.merge=11]="merge",n[n.extend=12]="extend",n[n.contains=30]="contains",n[n.defined=31]="defined",n[n.ends=32]="ends",n[n.in=33]="in",n[n.less=34]="less",n[n.matches=35]="matches",n[n.more=36]="more",n[n.starts=37]="starts",n[n.undefined=38]="undefined",n[n.test_type=39]="test_type",n[n.test_string=40]="test_string",n[n.test_string_len=41]="test_string_len",n[n.type=42]="type",n[n.and=43]="and",n[n.not=44]="not",n[n.or=45]="or"})(In||(In={}));class xf{path;from;constructor(e){this.path=e}}var uD={};const B1=nW(e7e);var hD={},aG;function eqe(){return aG||(aG=1,Object.defineProperty(hD,"__esModule",{value:!0})),hD}var fD={},cG;function rie(){return cG||(cG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.isInteger=n.isRoot=n.toPath=void 0,n.unescapeComponent=s,n.escapeComponent=o,n.parseJsonPointer=a,n.formatJsonPointer=c,n.isChild=u,n.isPathEqual=h,n.parent=d,n.isValidIndex=p;const e=/~1/g,t=/~0/g,r=/~/g,i=/\//g;function s(_){return _.indexOf("~")===-1?_:_.replace(e,"/").replace(t,"~")}function o(_){return _.indexOf("/")===-1&&_.indexOf("~")===-1?_:_.replace(r,"~0").replace(i,"~1")}function a(_){return _?_.slice(1).split("/").map(s):[]}function c(_){return(0,n.isRoot)(_)?"":"/"+_.map(v=>o(String(v))).join("/")}const l=_=>typeof _=="string"?a(_):_;n.toPath=l;function u(_,v){if(_.length>=v.length)return!1;for(let S=0;S<_.length;S++)if(_[S]!==v[S])return!1;return!0}function h(_,v){if(_.length!==v.length)return!1;for(let S=0;S<_.length;S++)if(_[S]!==v[S])return!1;return!0}const f=_=>!_.length;n.isRoot=f;function d(_){if(_.length<1)throw new Error("NO_PARENT");return _.slice(0,_.length-1)}function p(_){if(typeof _=="number")return!0;const v=Number.parseInt(_,10);return String(v)===_&&v>=0}const m=_=>{const v=_.length;let S=0,b;for(;S<v;){if(b=_.charCodeAt(S),b>=48&&b<=57){S++;continue}return!1}return!0};n.isInteger=m})(fD)),fD}var dD={},lG;function tqe(){return lG||(lG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.validatePath=n.validateJsonPointer=void 0;const e=i=>{if(typeof i=="string"){if(i){if(i[0]!=="/")throw new Error("POINTER_INVALID");if(i.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,n.validatePath)(i)};n.validateJsonPointer=e;const{isArray:t}=Array,r=i=>{if(!t(i))throw new Error("Invalid path.");if(i.length>256)throw new Error("Path too long.");for(const s of i)switch(typeof s){case"string":case"number":continue;default:throw new Error("Invalid path step.")}};n.validatePath=r})(dD)),dD}var fw={},mk={},uG;function yB(){if(uG)return mk;uG=1,Object.defineProperty(mk,"__esModule",{value:!0}),mk.hasOwnProperty=e;const n=Object.prototype.hasOwnProperty;function e(t,r){return n.call(t,r)}return mk}var hG;function nqe(){if(hG)return fw;hG=1,Object.defineProperty(fw,"__esModule",{value:!0}),fw.get=void 0;const n=yB(),e=(t,r)=>{const i=r.length;let s;if(!i)return t;for(let o=0;o<i;o++)if(s=r[o],t instanceof Array){if(typeof s!="number"){if(s==="-")return;const a=~~s;if(""+a!==s)return;s=a}t=t[s]}else if(typeof t=="object"){if(!t||!(0,n.hasOwnProperty)(t,s))return;t=t[s]}else return;return t};return fw.get=e,fw}var ap={},fG;function rqe(){if(fG)return ap;fG=1,Object.defineProperty(ap,"__esModule",{value:!0}),ap.isObjectReference=ap.isArrayEnd=ap.isArrayReference=ap.find=void 0;const n=yB(),{isArray:e}=Array,t=(o,a)=>{const c=a.length;if(!c)return{val:o};let l,u;for(let f=0;f<c;f++)if(l=o,u=a[f],e(l)){const d=l.length;if(u==="-")u=d;else if(typeof u=="string"){const p=~~u;if(""+p!==u)throw new Error("INVALID_INDEX");if(u=p,u<0)throw new Error("INVALID_INDEX")}o=l[u]}else if(typeof l=="object"&&l)o=(0,n.hasOwnProperty)(l,u)?l[u]:void 0;else throw new Error("NOT_FOUND");return{val:o,obj:l,key:u}};ap.find=t;const r=o=>e(o.obj)&&typeof o.key=="number";ap.isArrayReference=r;const i=o=>o.obj.length===o.key;ap.isArrayEnd=i;const s=o=>typeof o.obj=="object"&&typeof o.key=="string";return ap.isObjectReference=s,ap}var pD={},dw={},dG;function iqe(){if(dG)return dw;dG=1,Object.defineProperty(dw,"__esModule",{value:!0}),dw.findByPointer=void 0;const n=yB(),e=rie(),{isArray:t}=Array,r=(i,s)=>{if(!i)return{val:s};let o,a,c=0,l=1;for(;c>-1;)if(c=i.indexOf("/",l),a=c>-1?i.substring(l,c):i.substring(l),l=c+1,o=s,t(o)){const u=o.length;if(a==="-")a=u;else{const h=~~a;if(""+h!==a)throw new Error("INVALID_INDEX");if(a=h,a<0)throw"INVALID_INDEX"}s=o[a]}else if(typeof o=="object"&&o)a=(0,e.unescapeComponent)(a),s=(0,n.hasOwnProperty)(o,a)?o[a]:void 0;else throw"NOT_FOUND";return{val:s,obj:o,key:a}};return dw.findByPointer=r,dw}var pG;function sqe(){return pG||(pG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),B1.__exportStar(iqe(),n)})(pD)),pD}var mG;function oqe(){return mG||(mG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0});const e=B1;e.__exportStar(eqe(),n),e.__exportStar(rie(),n),e.__exportStar(tqe(),n),e.__exportStar(nqe(),n),e.__exportStar(rqe(),n),e.__exportStar(sqe(),n)})(uD)),uD}var rr=oqe(),mD={},gG;function aqe(){return gG||(gG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.clone=void 0;const{isArray:e}=Array,t=Object.keys,r=i=>{if(!i)return i;if(e(i)){const s=[],o=i.length;for(let a=0;a<o;a++)s.push((0,n.clone)(i[a]));return s}else if(typeof i=="object"){const s=t(i),o=s.length,a={};for(let c=0;c<o;c++){const l=s[c];a[l]=(0,n.clone)(i[l])}return a}return i};n.clone=r})(mD)),mD}var bB=aqe();class SB extends xf{value;constructor(e,t){super(e),this.value=t}op(){return"add"}code(){return In.add}apply(e){const{val:t,key:r,obj:i}=rr.find(e,this.path),s=bB.clone(this.value);if(!i)e=s;else if(typeof r=="string")i[r]=s;else{const o=i.length;if(r<o)i.splice(r,0,s);else{if(r>o)throw new Error("INVALID_INDEX");i.push(s)}}return{doc:e,old:t}}toJson(e){return{op:"add",path:rr.formatJsonPointer(this.path),value:this.value}}toCompact(e,t){return[t?"add":In.add,this.path,this.value]}}class iie extends xf{oldValue;constructor(e,t){super(e),this.oldValue=t}op(){return"remove"}code(){return In.remove}apply(e){const t=rr.find(e,this.path);if(t.val===void 0)throw new Error("NOT_FOUND");return rr.isObjectReference(t)?delete t.obj[t.key]:rr.isArrayReference(t)?t.val!==void 0&&t.obj.splice(t.key,1):e=null,{doc:e,old:t.val}}toJson(e){const t={op:"remove",path:rr.formatJsonPointer(this.path)};return this.oldValue!==void 0&&(t.oldValue=this.oldValue),t}toCompact(e,t){const r=t?"remove":In.remove;return this.oldValue===void 0?[r,this.path]:[r,this.path,this.oldValue]}}class cqe extends xf{value;oldValue;constructor(e,t,r){super(e),this.value=t,this.oldValue=r}op(){return"replace"}code(){return In.replace}apply(e){const t=rr.find(e,this.path);if(t.val===void 0)throw new Error("NOT_FOUND");const r=bB.clone(this.value);return rr.isObjectReference(t)||rr.isArrayReference(t)?t.obj[t.key]=r:e=r,{doc:e,old:t.val}}toJson(e){const t={op:"replace",path:rr.formatJsonPointer(this.path),value:this.value};return this.oldValue!==void 0&&(t.oldValue=this.oldValue),t}toCompact(e,t){const r=t?"replace":In.replace;return this.oldValue===void 0?[r,this.path,this.value]:[r,this.path,this.value,this.oldValue]}}class lqe extends xf{from;constructor(e,t){super(e),this.from=t}op(){return"move"}code(){return In.move}apply(e){const t=new iie(rr.toPath(this.from),void 0).apply(e);return new SB(this.path,t.old).apply(t.doc)}toJson(e){return{op:"move",path:rr.formatJsonPointer(this.path),from:rr.formatJsonPointer(this.from)}}toCompact(e,t){return[t?"move":In.move,this.path,this.from]}}class uqe extends xf{from;constructor(e,t){super(e),this.from=t}op(){return"copy"}code(){return In.copy}apply(e){const{val:t}=rr.find(e,this.from);if(t===void 0)throw new Error("NOT_FOUND");return new SB(this.path,bB.clone(t)).apply(e)}toJson(e){return{op:"copy",path:rr.formatJsonPointer(this.path),from:rr.formatJsonPointer(this.from)}}toCompact(e,t){return[t?"copy":In.copy,this.path,this.from]}}class Iu extends xf{apply(e){if(!this.test(e))throw new Error("TEST");return{doc:e}}}var gD={},_D={},_G;function hqe(){return _G||(_G=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.deepEqual=void 0;const e=Array.isArray,t=Object.prototype,r=(i,s)=>{if(i===s)return!0;let o=0,a=0;if(e(i)){if(!e(s)||(o=i.length,o!==s.length))return!1;for(a=o;a--!==0;)if(!(0,n.deepEqual)(i[a],s[a]))return!1;return!0}if(i&&s&&typeof i=="object"&&typeof s=="object"){e:{if(i.__proto__===t)break e;if(i instanceof Uint8Array){if(!(s instanceof Uint8Array))return!1;const l=i.length;if(l!==s.length)return!1;for(let u=0;u<l;u++)if(i[u]!==s[u])return!1;return!0}}const c=Object.keys(i);if(o=c.length,o!==Object.keys(s).length||e(s))return!1;for(a=o;a--!==0;){const l=c[a];if(!(0,n.deepEqual)(i[l],s[l]))return!1}return!0}return!1};n.deepEqual=r})(_D)),_D}var vG;function fqe(){return vG||(vG=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),B1.__exportStar(hqe(),n)})(gD)),gD}var sie=fqe();class dqe extends Iu{value;not;constructor(e,t,r){super(e),this.value=t,this.not=r}op(){return"test"}code(){return In.test}test(e){const{val:t}=rr.find(e,this.path);if(t===void 0)return!!this.not;const r=sie.deepEqual(t,this.value);return this.not?!r:r}toJson(e){const t={op:"test",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.not&&(t.not=this.not),t}toCompact(e,t){const r=e?this.path.slice(e.path.length):this.path,i=t?"test":In.test;return this.not?[i,r,this.value,1]:[i,r,this.value]}}class pqe extends xf{op(){return"flip"}code(){return In.flip}apply(e){const t=rr.find(e,this.path);return t.obj?t.obj[t.key]=!t.val:e=!t.val,{doc:e,old:t.val}}toJson(e){return{op:"flip",path:rr.formatJsonPointer(this.path)}}toCompact(e,t){return[t?"flip":In.flip,this.path]}}class mqe extends xf{inc;constructor(e,t){super(e),this.inc=t}op(){return"inc"}code(){return In.inc}apply(e){const t=rr.find(e,this.path),r=this.inc+Number(t.val);return t.obj?t.obj[t.key]=r:e=r,{doc:e,old:t.val}}toJson(e){return{op:"inc",path:rr.formatJsonPointer(this.path),inc:this.inc}}toCompact(e,t){return[t?"inc":In.inc,this.path,this.inc]}}class gqe extends xf{pos;str;constructor(e,t,r){super(e),this.pos=t,this.str=r}op(){return"str_ins"}code(){return In.str_ins}apply(e){const{val:t,key:r,obj:i}=rr.find(e,this.path);if(typeof t!="string"){if(t!==void 0)throw new Error("NOT_A_STRING");if(this.pos!==0)throw new Error("POS")}const s=typeof t=="string"?t:"",o=Math.min(this.pos,s.length),a=s.slice(0,o),c=s.slice(o),l=a+this.str+c;return i?i[r]=l:e=l,{doc:e,old:t}}toJson(e){return{op:"str_ins",path:rr.formatJsonPointer(this.path),pos:this.pos,str:this.str}}toCompact(e,t){return[t?"str_ins":In.str_ins,this.path,this.pos,this.str]}}class yG extends xf{pos;str;len;constructor(e,t,r,i){super(e),this.pos=t,this.str=r,this.len=i}op(){return"str_del"}code(){return In.str_del}deleteLength(){return typeof this.str=="string"?this.str.length:this.len}apply(e){const{val:t,key:r,obj:i}=rr.find(e,this.path);if(typeof t!="string")throw new Error("NOT_A_STRING");const s=t.length,o=Math.min(this.pos,t.length),a=Math.min(o,s),c=this.str!==void 0?this.str.length:this.len,l=Math.min(o+c,s),u=t.slice(0,a),h=t.substr(l),f=u+h;return i?i[r]=f:e=f,{doc:e,old:t}}toJson(e){return typeof this.str=="string"?{op:"str_del",path:rr.formatJsonPointer(this.path),pos:this.pos,str:this.str}:{op:"str_del",path:rr.formatJsonPointer(this.path),pos:this.pos,len:this.len}}toCompact(e,t){const r=t?"str_del":In.str_del;return typeof this.str=="string"?[r,this.path,this.pos,this.str]:[r,this.path,this.pos,0,this.len]}}const{isArray:_qe}=Array,W4=n=>!!n&&typeof n=="object"&&typeof n.text=="string",q4=n=>!!n&&typeof n=="object"&&_qe(n.children),vqe=(n,e)=>{const t=new RegExp(n,e?"i":void 0);return r=>t.test(r)};class yqe extends xf{pos;props;constructor(e,t,r){super(e),this.pos=t,this.props=r}op(){return"split"}code(){return In.split}apply(e){const t=rr.find(e,this.path);if(t.val===void 0)throw new Error("NOT_FOUND");const r=this.split(t.val);return rr.isObjectReference(t)?t.obj[t.key]=r:rr.isArrayReference(t)?(t.obj[t.key]=r[0],t.obj.splice(t.key+1,0,r[1])):e=r,{doc:e,old:t.val}}split(e){if(typeof e=="string"){const{pos:t,props:r}=this,i=e.slice(0,t),s=e.slice(t);return r?[{...r,text:i},{...r,text:s}]:[i,s]}else if(W4(e)){const{pos:t,props:r}=this,i=e.text.slice(0,t),s=e.text.slice(t);return[{...e,...r,text:i},{...e,...r,text:s}]}else if(q4(e)){const{pos:t,props:r}=this,i=e.children.slice(0,t),s=e.children.slice(t);return[{...e,...r,children:i},{...e,...r,children:s}]}else if(typeof e=="number"){const{pos:t}=this;return[t,e-t]}else return[e,e]}toJson(e){const t={op:"split",path:rr.formatJsonPointer(this.path),pos:this.pos};return this.props&&(t.props=this.props),t}toCompact(e,t){const r=t?"split":In.split;return this.props?[r,this.path,this.pos,this.props]:[r,this.path,this.pos]}}class bqe extends xf{pos;props;constructor(e,t,r){super(e),this.pos=t,this.props=r}op(){return"merge"}code(){return In.merge}apply(e){const t=rr.find(e,this.path);if(!rr.isArrayReference(t))throw new Error("INVALID_TARGET");if(t.key<=0)throw new Error("INVALID_KEY");const r=t.obj[t.key-1],i=t.obj[t.key],s=this.merge(r,i);return t.obj[t.key-1]=s,t.obj.splice(t.key,1),{doc:e,old:[r,i]}}merge(e,t){return typeof e=="string"&&typeof t=="string"||typeof e=="number"&&typeof t=="number"?e+t:W4(e)&&W4(t)?{...e,...t,text:e.text+t.text}:q4(e)&&q4(t)?{...e,...t,children:[...e.children,...t.children]}:[e,t]}toJson(e){const t={op:"merge",path:rr.formatJsonPointer(this.path),pos:this.pos};return this.props&&(t.props=this.props),t}toCompact(e,t){const r=t?"merge":In.merge;return this.props?[r,this.path,this.pos,this.props]:[r,this.path,this.pos]}}const{isArray:Sqe}=Array;class Eqe extends xf{props;deleteNull;constructor(e,t,r){super(e),this.props=t,this.deleteNull=r}op(){return"extend"}code(){return In.extend}apply(e){const t=rr.find(e,this.path);return rr.isArrayReference(t)?t.val!==void 0&&(t.obj[t.key]=this.extend(t.val)):rr.isObjectReference(t)?t.obj[t.key]=this.extend(t.val):e=this.extend(e),{doc:e}}extend(e){if(Sqe(e)||typeof e!="object"||!e)return e;for(const[t,r]of Object.entries(this.props)){if(t==="__proto__")throw new Error("NO_PROTO");if(r===null&&this.deleteNull){delete e[t];continue}e[t]=r}return e}toJson(e){const t={op:"extend",path:rr.formatJsonPointer(this.path),props:this.props};return this.deleteNull&&(t.deleteNull=this.deleteNull),t}toCompact(e,t){const r=t?"extend":In.extend;return this.deleteNull?[r,this.path,this.props,1]:[r,this.path,this.props]}}class xqe extends Iu{op(){return"defined"}code(){return In.defined}test(e){const{val:t}=rr.find(e,this.path);return t!==void 0}toJson(e){return{op:"defined",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path)}}toCompact(e,t){return[t?"defined":In.defined,e?this.path.slice(e.path.length):this.path]}}class Tqe extends Iu{op(){return"undefined"}code(){return In.undefined}test(e){try{const{val:t}=rr.find(e,this.path);return t===void 0}catch(t){if(t.message==="NOT_FOUND")return!0;throw t}}toJson(e){return{op:"undefined",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path)}}toCompact(e,t){return[t?"undefined":In.undefined,e?this.path.slice(e.path.length):this.path]}}const{isArray:wqe}=Array;class Aqe extends Iu{type;constructor(e,t){super(e),this.type=t}op(){return"test_type"}code(){return In.test_type}test(e){const{val:t}=rr.find(e,this.path);return t===null?this.type.indexOf("null")>-1:wqe(t)?this.type.indexOf("array")>-1:this.type.indexOf(typeof t)>-1||typeof t=="number"&&t===Math.round(t)&&this.type.indexOf("integer")>-1}toJson(e){return{op:"test_type",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),type:this.type}}toCompact(e,t){return[t?"test_type":In.test_type,e?this.path.slice(e.path.length):this.path,this.type]}}class Cqe extends Iu{pos;str;not;constructor(e,t,r,i){super(e),this.pos=t,this.str=r,this.not=i}op(){return"test_string"}code(){return In.test_string}test(e){const{val:t}=rr.find(e,this.path);if(typeof t!="string")return!1;const r=t.length,i=Math.min(this.pos,r),s=Math.min(this.pos+this.str.length,r),o=t.substring(i,s)===this.str;return this.not?!o:o}toJson(e){const t={op:"test_string",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),pos:this.pos,str:this.str};return this.not&&(t.not=this.not),t}toCompact(e,t){const r=t?"test_string":In.test_string,i=e?this.path.slice(e.path.length):this.path;return this.not?[r,i,this.pos,this.str,1]:[r,i,this.pos,this.str]}}class Rqe extends Iu{len;not;constructor(e,t,r){super(e),this.len=t,this.not=r}op(){return"test_string_len"}code(){return In.test_string_len}test(e){const{val:t}=rr.find(e,this.path);if(typeof t!="string")return!1;const i=t.length>=this.len;return this.not?!i:i}toJson(e){const t={op:"test_string_len",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),len:this.len};return this.not&&(t.not=this.not),t}toCompact(e,t){const r=t?"test_string_len":In.test_string_len,i=e?this.path.slice(e.path.length):this.path;return this.not?[r,i,this.len,1]:[r,i,this.len]}}class kqe extends Iu{value;ignore_case;constructor(e,t,r){super(e),this.value=t,this.ignore_case=r}op(){return"contains"}code(){return In.contains}test(e){const{val:t}=rr.find(e,this.path);if(typeof t!="string")return!1;const r=this.ignore_case?t.toLowerCase():t,i=this.ignore_case?this.value.toLowerCase():this.value;return r.indexOf(i)>-1}toJson(e){const t={op:"contains",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(t.ignore_case=this.ignore_case),t}toCompact(e,t){const r=t?"contains":In.contains;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class Mqe extends Iu{value;ignore_case;constructor(e,t,r){super(e),this.value=t,this.ignore_case=r}op(){return"ends"}code(){return In.ends}test(e){const{val:t}=rr.find(e,this.path);if(typeof t!="string")return!1;const r=this.ignore_case?t.toLowerCase():t,i=this.ignore_case?this.value.toLowerCase():this.value;return r.endsWith(i)}toJson(e){const t={op:"ends",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(t.ignore_case=this.ignore_case),t}toCompact(e,t){const r=t?"ends":In.ends;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class Iqe extends Iu{value;ignore_case;constructor(e,t,r){super(e),this.value=t,this.ignore_case=r}op(){return"starts"}code(){return In.starts}test(e){const{val:t}=rr.find(e,this.path);if(typeof t!="string")return!1;const r=this.ignore_case?t.toLowerCase():t,i=this.ignore_case?this.value.toLowerCase():this.value;return r.startsWith(i)}toJson(e){const t={op:"starts",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(t.ignore_case=this.ignore_case),t}toCompact(e,t){const r=t?"starts":In.starts;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}class Oqe extends Iu{value;constructor(e,t){super(e),this.value=t}op(){return"in"}code(){return In.in}test(e){const{val:t}=rr.find(e,this.path);for(const r of this.value)if(sie.deepEqual(t,r))return!0;return!1}toJson(e){return{op:"in",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,t){return[t?"in":In.in,e?this.path.slice(e.path.length):this.path,this.value]}}class Nqe extends Iu{value;constructor(e,t){super(e),this.value=t}op(){return"less"}code(){return In.less}test(e){const{val:t}=rr.find(e,this.path);return typeof t!="number"?!1:t<this.value}toJson(e){return{op:"less",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,t){return[t?"less":In.less,e?this.path.slice(e.path.length):this.path,this.value]}}class Pqe extends Iu{value;constructor(e,t){super(e),this.value=t}op(){return"more"}code(){return In.more}test(e){const{val:t}=rr.find(e,this.path);return typeof t!="number"?!1:t>this.value}toJson(e){return{op:"more",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,t){return[t?"more":In.more,e?this.path.slice(e.path.length):this.path,this.value]}}class EB extends Iu{ops;constructor(e,t){super(e),this.ops=t}}class Dqe extends EB{ops;constructor(e,t){super(e,t),this.ops=t}op(){return"and"}code(){return In.and}test(e){for(const t of this.ops)if(!t.test(e))return!1;return!0}toJson(e){return{op:"and",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,t){return[t?"and":In.and,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,t))]}}class Lqe extends EB{ops;constructor(e,t){super(e,t),this.ops=t}op(){return"or"}code(){return In.or}test(e){for(const t of this.ops)if(t.test(e))return!0;return!1}toJson(e){return{op:"or",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,t){return[t?"or":In.or,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,t))]}}class Uqe extends EB{ops;constructor(e,t){super(e,t),this.ops=t}op(){return"not"}code(){return In.not}test(e){for(const t of this.ops)if(t.test(e))return!1;return!0}toJson(e){return{op:"not",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),apply:this.ops.map(r=>r.toJson(this))}}toCompact(e,t){return[t?"not":In.not,e?this.path.slice(e.path.length):this.path,this.ops.map(i=>i.toCompact(this,t))]}}class Bqe extends Iu{value;ignore_case;matcher;constructor(e,t,r,i){super(e),this.value=t,this.ignore_case=r,this.matcher=i(t,r)}op(){return"matches"}code(){return In.matches}test(e){const{val:t}=rr.find(e,this.path);return typeof t!="string"?!1:this.matcher(t)}toJson(e){const t={op:"matches",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value};return this.ignore_case&&(t.ignore_case=this.ignore_case),t}toCompact(e,t){const r=t?"matches":In.matches;return this.ignore_case?[r,e?this.path.slice(e.path.length):this.path,this.value,1]:[r,e?this.path.slice(e.path.length):this.path,this.value]}}const{isArray:Fqe}=Array;class jqe extends Iu{value;constructor(e,t){super(e),this.value=t}op(){return"type"}code(){return In.type}test(e){const{val:t}=rr.find(e,this.path);return t===null?this.value==="null":Fqe(t)?this.value==="array":typeof t===this.value||typeof t=="number"&&t===Math.round(t)&&this.value==="integer"}toJson(e){return{op:"type",path:rr.formatJsonPointer(e?this.path.slice(e.path.length):this.path),value:this.value}}toCompact(e,t){return[t?"type":In.type,e?this.path.slice(e.path.length):this.path,this.value]}}var pw={},mw={},gw={},gk={},lb={},bG;function zqe(){if(bG)return lb;bG=1,Object.defineProperty(lb,"__esModule",{value:!0}),lb.decodeAsciiMax15=lb.decodeAscii=void 0;const n=String.fromCharCode,e=(r,i,s)=>{const o=[];for(let a=0;a<s;a++){const c=r[i++];if(c&128)return;o.push(c)}return n.apply(String,o)};lb.decodeAscii=e;const t=(r,i,s)=>{if(s<4)if(s<2){if(s===0)return"";{const o=r[i++];if((o&128)>1){i-=1;return}return n(o)}}else{const o=r[i++],a=r[i++];if((o&128)>0||(a&128)>0){i-=2;return}if(s<3)return n(o,a);const c=r[i++];if((c&128)>0){i-=3;return}return n(o,a,c)}else{const o=r[i++],a=r[i++],c=r[i++],l=r[i++];if((o&128)>0||(a&128)>0||(c&128)>0||(l&128)>0){i-=4;return}if(s<6){if(s===4)return n(o,a,c,l);{const u=r[i++];if((u&128)>0){i-=5;return}return n(o,a,c,l,u)}}else if(s<8){const u=r[i++],h=r[i++];if((u&128)>0||(h&128)>0){i-=6;return}if(s<7)return n(o,a,c,l,u,h);const f=r[i++];if((f&128)>0){i-=7;return}return n(o,a,c,l,u,h,f)}else{const u=r[i++],h=r[i++],f=r[i++],d=r[i++];if((u&128)>0||(h&128)>0||(f&128)>0||(d&128)>0){i-=8;return}if(s<10){if(s===8)return n(o,a,c,l,u,h,f,d);{const p=r[i++];if((p&128)>0){i-=9;return}return n(o,a,c,l,u,h,f,d,p)}}else if(s<12){const p=r[i++],m=r[i++];if((p&128)>0||(m&128)>0){i-=10;return}if(s<11)return n(o,a,c,l,u,h,f,d,p,m);const _=r[i++];if((_&128)>0){i-=11;return}return n(o,a,c,l,u,h,f,d,p,m,_)}else{const p=r[i++],m=r[i++],_=r[i++],v=r[i++];if((p&128)>0||(m&128)>0||(_&128)>0||(v&128)>0){i-=12;return}if(s<14){if(s===12)return n(o,a,c,l,u,h,f,d,p,m,_,v);{const S=r[i++];if((S&128)>0){i-=13;return}return n(o,a,c,l,u,h,f,d,p,m,_,v,S)}}else{const S=r[i++],b=r[i++];if((S&128)>0||(b&128)>0){i-=14;return}if(s<15)return n(o,a,c,l,u,h,f,d,p,m,_,v,S,b);const T=r[i++];if((T&128)>0){i-=15;return}return n(o,a,c,l,u,h,f,d,p,m,_,v,S,b,T)}}}}};return lb.decodeAsciiMax15=t,lb}var _k={},SG;function $qe(){if(SG)return _k;SG=1,Object.defineProperty(_k,"__esModule",{value:!0});const n=String.fromCharCode;return _k.default=(e,t,r)=>{let i=t;const s=i+r,o=[];for(;i<s;){let a=e[i++];if((a&128)!==0){const c=e[i++]&63;if((a&224)===192)a=(a&31)<<6|c;else{const l=e[i++]&63;if((a&240)===224)a=(a&31)<<12|c<<6|l;else if((a&248)===240){const u=e[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;if(h>65535){h-=65536;const f=h>>>10&1023|55296;a=56320|h&1023,o.push(f)}else a=h}}}o.push(a)}return n.apply(String,o)},_k}var EG;function Vqe(){if(EG)return gk;EG=1,Object.defineProperty(gk,"__esModule",{value:!0});const n=B1,e=zqe(),t=n.__importDefault($qe()),r=typeof io<"u",i=r?io.prototype.utf8Slice:null,s=r?io.from:null,o=(u,h,f)=>(0,e.decodeAsciiMax15)(u,h,f)??(0,t.default)(u,h,f),a=(u,h,f)=>(0,e.decodeAscii)(u,h,f)??(0,t.default)(u,h,f),c=i?(u,h,f)=>i.call(u,h,h+f):s?(u,h,f)=>s(u).subarray(h,h+f).toString("utf8"):t.default,l=(u,h,f)=>f<16?o(u,h,f):f<32?a(u,h,f):c(u,h,f);return gk.default=l,gk}var xG;function Hqe(){if(xG)return gw;xG=1,Object.defineProperty(gw,"__esModule",{value:!0}),gw.decodeUtf8=void 0;const e=B1.__importDefault(Vqe());return gw.decodeUtf8=e.default,gw}var TG;function Gqe(){if(TG)return mw;TG=1,Object.defineProperty(mw,"__esModule",{value:!0}),mw.Reader=void 0;const n=Hqe();let e=class oie{constructor(r=new Uint8Array([]),i=new DataView(r.buffer,r.byteOffset,r.length),s=0,o=r.length){this.uint8=r,this.view=i,this.x=s,this.end=o}reset(r){this.x=0,this.uint8=r,this.view=new DataView(r.buffer,r.byteOffset,r.length)}size(){return this.end-this.x}peek(){return this.view.getUint8(this.x)}peak(){return this.peek()}skip(r){this.x+=r}buf(r=this.size()){const i=this.x,s=i+r,o=this.uint8.subarray(i,s);return this.x=s,o}subarray(r=0,i){const s=this.x,o=s+r,a=typeof i=="number"?s+i:this.end;return this.uint8.subarray(o,a)}slice(r=0,i){const s=this.x,o=s+r,a=typeof i=="number"?s+i:this.end;return new oie(this.uint8,this.view,o,a)}cut(r=this.size()){const i=this.slice(0,r);return this.skip(r),i}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let r=this.x;const i=(this.uint8[r++]<<8)+this.uint8[r++];return this.x=r,i}i16(){const r=this.view.getInt16(this.x);return this.x+=2,r}u32(){const r=this.view.getUint32(this.x);return this.x+=4,r}i32(){const r=this.view.getInt32(this.x);return this.x+=4,r}u64(){const r=this.view.getBigUint64(this.x);return this.x+=8,r}i64(){const r=this.view.getBigInt64(this.x);return this.x+=8,r}f32(){const r=this.x;return this.x+=4,this.view.getFloat32(r)}f64(){const r=this.x;return this.x+=8,this.view.getFloat64(r)}utf8(r){const i=this.x;return this.x+=r,(0,n.decodeUtf8)(this.uint8,i,r)}ascii(r){const i=this.uint8;let s="";const o=this.x+r;for(let a=this.x;a<o;a++)s+=String.fromCharCode(i[a]);return this.x=o,s}};return mw.Reader=e,mw}var vk={},_w={},yk={},wG;function Wqe(){if(wG)return yk;wG=1,Object.defineProperty(yk,"__esModule",{value:!0});const n=String.fromCharCode;return yk.default=(e,t,r)=>{let i=t;const s=i+r;let o="";for(;i<s;){const a=e[i++];if((a&128)===0){o+=n(a);continue}const c=e[i++]&63;if((a&224)===192){o+=n((a&31)<<6|c);continue}const l=e[i++]&63;if((a&240)===224){o+=n((a&31)<<12|c<<6|l);continue}if((a&248)===240){const u=e[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;if(h>65535){h-=65536;const f=h>>>10&1023|55296;h=56320|h&1023,o+=n(f,h)}else o+=n(h)}else o+=n(a)}return o},yk}var AG;function qqe(){if(AG)return _w;AG=1,Object.defineProperty(_w,"__esModule",{value:!0}),_w.CachedUtf8Decoder=void 0;const e=B1.__importDefault(Wqe());let t=1+Math.round(Math.random()*((-1>>>0)-1));function r(o,a){return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>0)%(a-o+1)+o}class i{constructor(a,c){this.bytes=a,this.value=c}}let s=class{constructor(){this.caches=[];for(let a=0;a<31;a++)this.caches.push([])}get(a,c,l){const u=this.caches[l-1],h=u.length;e:for(let f=0;f<h;f++){const d=u[f],p=d.bytes;for(let m=0;m<l;m++)if(p[m]!==a[c+m])continue e;return d.value}return null}store(a,c){const l=this.caches[a.length-1],u=new i(a,c);l.length>=16?l[r(0,15)]=u:l.push(u)}decode(a,c,l){if(!l)return"";const u=this.get(a,c,l);if(u!==null)return u;const h=(0,e.default)(a,c,l),f=Uint8Array.prototype.slice.call(a,c,c+l);return this.store(f,h),h}};return _w.CachedUtf8Decoder=s,_w}var CG;function Yqe(){if(CG)return vk;CG=1,Object.defineProperty(vk,"__esModule",{value:!0});const n=qqe();return vk.default=new n.CachedUtf8Decoder,vk}var vw={},RG;function Kqe(){if(RG)return vw;RG=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.JsonPackExtension=void 0;let n=class{constructor(t,r){this.tag=t,this.val=r}};return vw.JsonPackExtension=n,vw}var kG;function Xqe(){if(kG)return pw;kG=1,Object.defineProperty(pw,"__esModule",{value:!0}),pw.MsgPackDecoderFast=void 0;const n=B1,e=Gqe(),t=n.__importDefault(Yqe()),r=Kqe();let i=class{constructor(o=new e.Reader,a=t.default){this.reader=o,this.keyDecoder=a}decode(o){return this.reader.reset(o),this.readAny()}read(o){return this.reader.reset(o),this.readAny()}val(){return this.readAny()}readAny(){const o=this.reader,a=o.u8();if(a>=224)return a-256;if(a<=191)return a<144?a<=127?a:this.obj(a&15):a<160?this.arr(a&15):o.utf8(a&31);if(a<=208)return a<=200?a<=196?a<=194?a===194?!1:a===192?null:void 0:a===196?o.buf(o.u8()):!0:a<=198?a===198?o.buf(o.u32()):o.buf(o.u16()):a===200?this.ext(o.u16()):this.ext(o.u8()):a<=204?a<=202?a===202?o.f32():this.ext(o.u32()):a===204?o.u8():o.f64():a<=206?a===206?o.u32():o.u16():a===208?o.i8():o.u32()*4294967296+o.u32();if(a<=216)return a<=212?a<=210?a===210?o.i32():o.i16():a===212?this.ext(1):o.i32()*4294967296+o.u32():a<=214?a===214?this.ext(4):this.ext(2):a===216?this.ext(16):this.ext(8);switch(a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32());case 220:return this.arr(o.u16());case 221:return this.arr(o.u32());case 222:return this.obj(o.u16());case 223:return this.obj(o.u32())}}str(){const o=this.reader,a=o.u8();if(a>>5===5)return o.utf8(a&31);switch(a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32())}}obj(o){const a={};for(let c=0;c<o;c++){const l=this.key();if(l==="__proto__")throw 6;a[l]=this.readAny()}return a}key(){const o=this.reader,a=o.view.getUint8(o.x);if(a>=160&&a<=191){const c=a&31,l=this.keyDecoder.decode(o.uint8,o.x+1,c);return o.x+=1+c,l}else if(a===217){const c=o.view.getUint8(o.x+1);if(c<32){const l=this.keyDecoder.decode(o.uint8,o.x+2,c);return o.x+=2+c,l}}switch(o.x++,a){case 217:return o.utf8(o.u8());case 218:return o.utf8(o.u16());case 219:return o.utf8(o.u32());default:return""}}arr(o){const a=[];for(let c=0;c<o;c++)a.push(this.readAny());return a}ext(o){const a=this.reader,c=a.u8(),l=a.x+o,u=a.uint8.subarray(a.x,l);return a.x=l,new r.JsonPackExtension(c,u)}back(o){this.reader.x-=o}};return pw.MsgPackDecoderFast=i,pw}var Zqe=Xqe();class Jqe extends Zqe.MsgPackDecoderFast{options;constructor(e){super(),this.options=e}decode(e){return this.reader.reset(e),this.decodePatch()}decodePatch(){const e=this.decodeArrayHeader(),t=[];for(let r=0;r<e;r++)t.push(this.decodeOp(void 0));return t}decodeOp(e){const t=this.decodeArrayHeader();switch(this.reader.u8()){case In.add:{const i=this.decodeArray(),s=this.val();return new SB(i,s)}case In.and:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new Dqe(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case In.contains:{const i=this.decodePath(e),s=this.decodeString(),o=t>3;return new kqe(i,s,o)}case In.copy:{const i=this.decodeArray(),s=this.decodeArray();return new uqe(i,s)}case In.defined:{const i=this.decodePath(e);return new xqe(i)}case In.ends:{const i=this.decodePath(e),s=this.decodeString(),o=t>3;return new Mqe(i,s,o)}case In.extend:{const i=this.decodeArray(),s=this.decodeObject(),o=t>3;return new Eqe(i,s,o)}case In.flip:{const i=this.decodeArray();return new pqe(i)}case In.in:{const i=this.decodePath(e),s=this.decodeArray();return new Oqe(i,s)}case In.inc:{const i=this.decodePath(e),s=this.val();return new mqe(i,s)}case In.less:{const i=this.decodePath(e),s=this.val();return new Nqe(i,s)}case In.matches:{const i=this.decodePath(e),s=this.decodeString(),o=t>3;return new Bqe(i,s,o,this.options.createMatcher||vqe)}case In.merge:{const i=t>3,s=this.decodeArray(),o=this.val(),a=i?this.decodeObject():null;return new bqe(s,o,a)}case In.more:{const i=this.decodePath(e),s=this.val();return new Pqe(i,s)}case In.move:{const i=this.decodeArray(),s=this.decodeArray();return new lqe(i,s)}case In.not:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new Uqe(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case In.or:{const i=this.decodePath(e),s=this.decodeArrayHeader(),o=[],a=new Lqe(i,o);for(let c=0;c<s;c++)o.push(this.decodeOp(a));return a}case In.remove:{const i=this.decodeArray(),o=t>2?this.val():void 0;return new iie(i,o)}case In.replace:{const i=this.decodeArray(),s=this.val(),a=t>3?this.val():void 0;return new cqe(i,s,a)}case In.split:{const i=this.decodeArray(),s=this.val(),a=t>3?this.decodeObject():null;return new yqe(i,s,a)}case In.starts:{const i=t>3,s=this.decodePath(e),o=this.decodeString();return new Iqe(s,o,i)}case In.str_del:{const i=t<5,s=this.decodeArray(),o=this.val();if(i){const a=this.decodeString();return new yG(s,o,a,void 0)}else{this.reader.u8();const a=this.val();return new yG(s,o,void 0,a)}}case In.str_ins:{const i=this.decodeArray(),s=this.val(),o=this.decodeString();return new gqe(i,s,o)}case In.test:{const i=t>3,s=this.decodePath(e),o=this.val();return new dqe(s,o,i)}case In.test_string:{const i=t>4,s=this.decodePath(e),o=this.val(),a=this.decodeString();return new Cqe(s,o,a,i)}case In.test_string_len:{const i=t>3,s=this.decodePath(e),o=this.val();return new Rqe(s,o,i)}case In.test_type:{const i=this.decodePath(e),s=this.decodeArray();return new Aqe(i,s)}case In.type:{const i=this.decodePath(e),s=this.decodeString();return new jqe(i,s)}case In.undefined:{const i=this.decodePath(e);return new Tqe(i)}}throw new Error("OP_UNKNOWN")}decodePath(e){const t=this.decodeArray();return e?[...e.path,...t]:t}decodeObject(){const e=this.reader,t=e.u8();return t<=191?this.obj(t&15):t===222?this.obj(e.u16()):this.obj(e.u32())}decodeArray(){const e=this.reader,t=e.u8();return t<159?this.arr(t&15):t===220?this.arr(e.u16()):this.arr(e.u32())}decodeArrayHeader(){const e=this.reader,t=e.u8();return t<159?t&15:t===220?e.u16():e.u32()}decodeString(){const e=this.reader,t=e.u8();return t<=191?e.utf8(t&31):t===217?e.utf8(e.u8()):t===218?e.utf8(e.u16()):e.utf8(e.u32())}}function Qqe(n){const e=[],t=n.length;for(let r=0;r<t;r++)e.push(n[r].toJson());return e}var aie=(n=>(n[n.id=0]="id",n[n.x=1]="x",n[n.y=2]="y",n[n.char=3]="char",n[n.color=4]="color",n[n.bg=5]="bg",n[n.stat=6]="stat",n[n.pid=7]="pid",n))(aie||{});function eYe(n){return y6(n,aie)}var cie=(n=>(n[n.id=0]="id",n[n.type=1]="type",n[n.tag=2]="tag",n[n.width=3]="width",n[n.height=4]="height",n[n.char=5]="char",n[n.color=6]="color",n[n.bg=7]="bg",n[n.stats=8]="stats",n[n.sprites=9]="sprites",n[n.alphas=10]="alphas",n[n.mime=11]="mime",n[n.media=12]="media",n[n.focusx=13]="focusx",n[n.focusy=14]="focusy",n[n.focusid=15]="focusid",n[n.viewscale=16]="viewscale",n[n.graphics=17]="graphics",n[n.facing=18]="facing",n))(cie||{});function tYe(n){return y6(n,cie,{sprites:e=>e.map(eYe)})}var lie=(n=>(n[n.id=0]="id",n[n.board=1]="board",n[n.over=2]="over",n[n.under=3]="under",n[n.layers=4]="layers",n[n.tickers=5]="tickers",n[n.scrollname=6]="scrollname",n[n.scroll=7]="scroll",n[n.sidebar=8]="sidebar",n))(lie||{});function MG(n){return y6(n,lie,{layers:e=>e.map(tYe)})}const nYe=new Jqe({}),IG=mg("gadgetclient",[],n=>{if(!IG.session(n)||n.player!==ii())return;const{desync:e}=Qr.getState();switch(n.target){case"paint":{const t=MG(n.data);Qr.setState({desync:!1,gadget:t,slim:n.data});break}case"patch":e||Qr.setState(t=>{let r;try{const i=nYe.decode(n.data),s=Qqe(i),o=cO(Ks(t.slim),s,!0,!0),a=MG(o.newDocument);return{...t,gadget:a,gadgetlayercache:{...t.gadgetlayercache,[a?.board??""]:a?.layers??[]},slim:o.newDocument}}catch(i){r=i}return he(r)?(IG.reply(n,"desync"),{...t,desync:!0}):t});break}}),xB=Object.prototype.toString.call(typeof Ga<"u"?Ga:0)==="[object process]";var _v,Ar;(function(n){n[n.CRITICAL=0]="CRITICAL",n[n.ERROR=1]="ERROR",n[n.WARNING=2]="WARNING",n[n.INFO=3]="INFO",n[n.DEBUG=4]="DEBUG",n[n.TRACE=7]="TRACE"})(Ar||(Ar={}));function TB(n){if(typeof n=="number"){if(Object.prototype.hasOwnProperty.call(Ar,n))return n;var e=Object.keys(Ar).map(function(r){return parseInt(r,10)}).filter(function(r){return!isNaN(r)&&r<n});return e.length?Math.max.apply(Math,e):Ar.WARNING}var t=n.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(Ar,t))throw new Error("Unknown log level string: ".concat(n));return Ar[t]}var rYe=xB?console.log.bind(console):console.debug.bind(console),uie=(_v={},_v[Ar.CRITICAL]=console.error.bind(console),_v[Ar.ERROR]=console.error.bind(console),_v[Ar.WARNING]=console.warn.bind(console),_v[Ar.INFO]=console.info.bind(console),_v[Ar.DEBUG]=rYe.bind(console),_v[Ar.TRACE]=console.trace.bind(console),_v);function ly(n){return function(e,t){Object.defineProperty(e,t,{get:function(){},set:function(r){Object.defineProperty(this,t,{value:r,writable:!0,enumerable:n})},enumerable:n})}}function Y4(n){return co(this,void 0,Promise,function(){return OC(this,function(e){switch(e.label){case 0:return typeof n!="function"?[3,2]:[4,n()];case 1:return[2,e.sent()];case 2:return[2,n]}})})}function iYe(n){return typeof n=="function"?n():n}function hie(n){var e,t,r;return OC(this,function(i){switch(i.label){case 0:e=0,t=1,i.label=1;case 1:return e<n?[4,e]:[3,3];case 2:return i.sent(),r=O1([t,e+t],2),e=r[0],t=r[1],[3,1];case 3:return[4,n];case 4:return i.sent(),[3,3];case 5:return[2]}})}function bk(n,e){return Object.assign.apply(Object,DA([{}],O1(n.map(e)),!1))}function K4(n,e){Object.entries(n).forEach(function(t){var r=O1(t,2),i=r[0],s=r[1];return e(s,i)})}function fie(n){return n==null}function $A(n,e){return fie(n)?null:e(n)}function die(n,e){return fie(n)?void 0:e(n)}function sYe(n){return co(this,void 0,Promise,function(){return OC(this,function(e){switch(e.label){case 0:return[4,new Promise(function(t){return setTimeout(t,n)})];case 1:return e.sent(),[2]}})})}function X4(){var n,e,t=new Promise(function(r,i){n=r,e=i});return{promise:t,resolve:n,reject:e}}function oYe(n,e,t){if(typeof n=="number"&&(n=n.toString()),e=e-n.length,e<=0)return n;t===void 0&&(t=" ");var r="";do(e&1)===1&&(r+=t),e>>=1,e&&(t+=t);while(e);return r+n}function Gb(n,e,t){var r=n.split(e);return r.length<=t?r:DA(DA([],O1(r.slice(0,t-1)),!1),[r.slice(t-1).join(e)],!1)}var aYe={},vD,yD,VI=typeof Ga>"u"?[]:(yD=(vD=aYe.LOGGING)===null||vD===void 0?void 0:vD.split(";").map(function(n){var e=n.split("=",2),t=e[0],r=e[1];return r?[t==="default"?void 0:t.split(":"),TB(r)]:null}).filter(function(n){return!!n}).sort(function(n,e){var t,r,i=n[0],s=e[0];return((t=s?.length)!==null&&t!==void 0?t:0)-((r=i?.length)!==null&&r!==void 0?r:0)}))!==null&&yD!==void 0?yD:[],bD=VI.findIndex(function(n){var e=n[0];return!e}),pie=void 0;bD!==-1&&(pie=VI[bD][1],VI.splice(bD));function cYe(n,e){return e.length<=n.length&&e.every(function(t,r){return t===n[r]})}function mie(n){for(var e=n.split(":"),t=0,r=VI;t<r.length;t++){var i=r[t],s=i[0],o=i[1];if(cYe(e,s))return o}return pie}var gie=(function(){function n(e){var t=e.name,r=e.minLevel,i=e.emoji,s=i===void 0?!1:i,o=e.colors,a=e.timestamps,c=a===void 0?xB:a,l,u;this._name=t,this._minLevel=(u=(l=die(r,function(h){return TB(h)}))!==null&&l!==void 0?l:mie(t))!==null&&u!==void 0?u:Ar.WARNING,this._emoji=s,this._colors=o,this._timestamps=c}return n.prototype.crit=function(e){this.log(Ar.CRITICAL,e)},n.prototype.error=function(e){this.log(Ar.ERROR,e)},n.prototype.warn=function(e){this.log(Ar.WARNING,e)},n.prototype.info=function(e){this.log(Ar.INFO,e)},n.prototype.debug=function(e){this.log(Ar.DEBUG,e)},n.prototype.trace=function(e){this.log(Ar.TRACE,e)},n})(),lYe=(function(n){m3(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.log=function(t,r){if(!(t>this._minLevel)){var i=uie[t],s="[".concat(this._name,"] ").concat(r);this._timestamps&&(s="[".concat(new Date().toISOString(),"] ").concat(r)),i(s)}},e})(gie),uYe=(function(){function n(e){var t=e.name,r=e.minLevel,i=e.custom,s;this._minLevel=(s=die(r,function(o){return TB(o)}))!==null&&s!==void 0?s:mie(t),this._override=typeof i=="function"?{log:i}:i}return n.prototype.log=function(e,t){this._shouldLog(e)&&this._override.log(e,t)},n.prototype.crit=function(e){this._override.crit?this._shouldLog(Ar.CRITICAL)&&this._override.crit(e):this.log(Ar.CRITICAL,e)},n.prototype.error=function(e){this._override.error?this._shouldLog(Ar.ERROR)&&this._override.error(e):this.log(Ar.ERROR,e)},n.prototype.warn=function(e){this._override.warn?this._shouldLog(Ar.WARNING)&&this._override.warn(e):this.log(Ar.WARNING,e)},n.prototype.info=function(e){this._override.info?this._shouldLog(Ar.INFO)&&this._override.info(e):this.log(Ar.INFO,e)},n.prototype.debug=function(e){this._override.debug?this._shouldLog(Ar.DEBUG)&&this._override.debug(e):this.log(Ar.DEBUG,e)},n.prototype.trace=function(e){this._override.trace?this._shouldLog(Ar.TRACE)&&this._override.trace(e):this.log(Ar.TRACE,e)},n.prototype._shouldLog=function(e){return this._minLevel===void 0||this._minLevel>=e},n})(),vv,yv,bv,hYe=(vv={},vv[Ar.CRITICAL]="",vv[Ar.ERROR]="",vv[Ar.WARNING]=" ",vv[Ar.INFO]=" ",vv[Ar.DEBUG]="",vv[Ar.TRACE]="",vv),fYe={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},dYe={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function B3(n,e,t){return function(r){return"\x1B[".concat(n,"m").concat(t?t(r):r,"\x1B[").concat(e,"m")}}function jm(n){return B3(fYe[n],39)}function yw(n,e){return B3(dYe[n],49,e)}var pYe=(yv={},yv[Ar.CRITICAL]=jm("red"),yv[Ar.ERROR]=jm("redBright"),yv[Ar.WARNING]=jm("yellow"),yv[Ar.INFO]=jm("blue"),yv[Ar.DEBUG]=jm("magenta"),yv[Ar.TRACE]=B3(0,0),yv),OG=(bv={},bv[Ar.CRITICAL]=yw("bgRed",jm("white")),bv[Ar.ERROR]=yw("bgRedBright",jm("white")),bv[Ar.WARNING]=yw("bgYellow",jm("black")),bv[Ar.INFO]=yw("bgBlue",jm("white")),bv[Ar.DEBUG]=yw("bgMagenta",jm("black")),bv[Ar.TRACE]=B3(7,27),bv),mYe=(function(n){m3(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.log=function(t,r){var i,s,o;if(!(t>this._minLevel)){var a=uie[t],c="";if(this._timestamps&&(c+="[".concat(new Date().toISOString(),"] ")),this._emoji){var l=hYe[t];c+="".concat(l," ")}var u=(o=(i=this._colors)!==null&&i!==void 0?i:(s=Ga.stdout)===null||s===void 0?void 0:s.isTTY)!==null&&o!==void 0?o:!0;u?c+="".concat(OG[t](this._name)," ").concat(OG[t](Ar[t])," ").concat(pYe[t](r)):c+="[".concat(this._name,":").concat(Ar[t].toLowerCase(),"] ").concat(r),a(c)}},e})(gie);function F3(n){return n.custom?new uYe(n):xB?new mYe(n):new lYe(n)}let _ie=class extends Error{constructor(...e){var t;super(...e),Object.setPrototypeOf(this,new.target.prototype),(t=Error.captureStackTrace)===null||t===void 0||t.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}};class HI extends _ie{}class vie extends _ie{}class gYe{constructor({logger:e,bucketSize:t,timeFrame:r,doRequest:i,getPartitionKey:s}){this._partitionedQueue=new Map,this._usedFromBucket=new Map,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=F3({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=t,this._timeFrame=r,this._callback=i,this._partitionKeyCallback=s}async request(e,t){return await new Promise((r,i)=>{var s,o;if(this._destroyed){i(new HI("Rate limiter was destroyed"));return}const a={req:e,resolve:r,reject:i,limitReachedBehavior:(s=t?.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"},c=this._partitionKeyCallback(e),l=(o=this._usedFromBucket.get(c))!==null&&o!==void 0?o:0;if(l>=this._bucketSize||this._paused)switch(a.limitReachedBehavior){case"enqueue":{const u=this._getPartitionedQueue(c);u.push(a),l+u.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${u.length}`):this._logger.info(`Enqueueing request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused; queue size is ${u.length}`);break}case"null":{a.resolve(null),this._paused?this._logger.info(`Returning null for request for ${c?`partition ${c}`:"default partition"} because the rate limiter is paused`):this._logger.warn(`Rate limit of ${this._bucketSize} for ${c?`partition ${c}`:"default partition"} was reached, dropping request and returning null`);break}case"throw":{a.reject(new vie(`Request dropped because ${this._paused?"the rate limiter is paused":`the rate limit for ${c?`partition ${c}`:"default partition"} was reached`}`));break}default:throw new Error("this should never happen")}else this._runRequest(a,c)})}clear(){this._partitionedQueue.clear()}pause(){this._paused=!0}resume(){this._paused=!1;for(const e of this._partitionedQueue.keys())this._runNextRequest(e)}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach(e=>{clearTimeout(e)});for(const e of this._partitionedQueue.values())for(const t of e)t.reject(new HI("Rate limiter was destroyed"));this._partitionedQueue.clear()}_getPartitionedQueue(e){if(this._partitionedQueue.has(e))return this._partitionedQueue.get(e);const t=[];return this._partitionedQueue.set(e,t),t}async _runRequest(e,t){var r;const i=this._getPartitionedQueue(t);this._logger.debug(`doing a request for ${t?`partition ${t}`:"default partition"}, new queue length is ${i.length}`),this._usedFromBucket.set(t,((r=this._usedFromBucket.get(t))!==null&&r!==void 0?r:0)+1);const{req:s,resolve:o,reject:a}=e;try{o(await this._callback(s))}catch(c){a(c)}finally{const c=setTimeout(()=>{this._counterTimers.delete(c);const l=this._usedFromBucket.get(t)-1;this._usedFromBucket.set(t,l),i.length&&l<this._bucketSize&&this._runNextRequest(t)},this._timeFrame);this._counterTimers.add(c)}}_runNextRequest(e){if(this._paused)return;const r=this._getPartitionedQueue(e).shift();r&&this._runRequest(r,e)}}class Z4{constructor({logger:e,bucketSize:t,timeFrame:r,doRequest:i}){this._queue=[],this._usedFromBucket=0,this._counterTimers=new Set,this._paused=!1,this._destroyed=!1,this._logger=F3({name:"rate-limiter",emoji:!0,...e}),this._bucketSize=t,this._timeFrame=r,this._callback=i}async request(e,t){return await new Promise((r,i)=>{var s;if(this._destroyed){i(new HI("Rate limiter was destroyed"));return}const o={req:e,resolve:r,reject:i,limitReachedBehavior:(s=t?.limitReachedBehavior)!==null&&s!==void 0?s:"enqueue"};if(this._usedFromBucket>=this._bucketSize||this._paused)switch(o.limitReachedBehavior){case"enqueue":{this._queue.push(o),this._usedFromBucket+this._queue.length>=this._bucketSize?this._logger.warn(`Rate limit of ${this._bucketSize} was reached, waiting for ${this._paused?"the limiter to be unpaused":"a free bucket entry"}; queue size is ${this._queue.length}`):this._logger.info(`Enqueueing request because the rate limiter is paused; queue size is ${this._queue.length}`);break}case"null":{o.resolve(null),this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`),this._paused?this._logger.info("Returning null for request because the rate limiter is paused"):this._logger.warn(`Rate limit of ${this._bucketSize} was reached, dropping request and returning null`);break}case"throw":{o.reject(new vie(`Request dropped because ${this._paused?"the rate limiter is paused":"the rate limit was reached"}`));break}default:throw new Error("this should never happen")}else this._runRequest(o)})}clear(){this._queue=[]}pause(){this._paused=!0}resume(){this._paused=!1,this._runNextRequest()}destroy(){this._paused=!1,this._destroyed=!0,this._counterTimers.forEach(e=>{clearTimeout(e)});for(const e of this._queue)e.reject(new HI("Rate limiter was destroyed"));this._queue=[]}async _runRequest(e){this._logger.debug(`doing a request, new queue length is ${this._queue.length}`),this._usedFromBucket+=1;const{req:t,resolve:r,reject:i}=e;try{r(await this._callback(t))}catch(s){i(s)}finally{const s=setTimeout(()=>{this._counterTimers.delete(s),this._usedFromBucket-=1,this._queue.length&&this._usedFromBucket<this._bucketSize&&this._runNextRequest()},this._timeFrame);this._counterTimers.add(s)}}_runNextRequest(){if(this._paused)return;const e=this._queue.shift();e&&this._runRequest(e)}}class _Ye extends Z4{constructor(e,t){super({...t,async doRequest(r,i){return await e.request(r,i)}})}}class vYe{constructor(e,t,r,i=!1){this.owner=e,this.event=t,this.listener=r,this._internal=i}unbind(){this.owner.removeListener(this)}}class YC{constructor(){this._eventListeners=new Map,this._internalEventListeners=new Map}on(e,t){return this._addListener(!1,e,t)}addListener(e,t){return this._addListener(!1,e,t)}removeListener(e,t){this._removeListener(!1,e,t)}registerEvent(){const e=t=>this.addListener(e,t);return e}emit(e,...t){if(this._eventListeners.has(e))for(const r of this._eventListeners.get(e))r(...t);if(this._internalEventListeners.has(e))for(const r of this._internalEventListeners.get(e))r(...t)}registerInternalEvent(){const e=t=>this.addInternalListener(e,t);return e}addInternalListener(e,t){return this._addListener(!0,e,t)}removeInternalListener(e,t){this._removeListener(!0,e,t)}_addListener(e,t,r){const i=e?this._eventListeners:this._internalEventListeners;return i.has(t)?i.get(t).push(r):i.set(t,[r]),new vYe(this,t,r,e)}_removeListener(e,t,r){const i=e?this._eventListeners:this._internalEventListeners;if(!t)i.clear();else if(typeof t=="object"){const s=t;this._removeListener(s._internal,s.event,s.listener)}else{const s=t;if(i.has(s))if(r){const o=i.get(s);let a=0;for(;(a=o.indexOf(r))!==-1;)o.splice(a,1)}else i.delete(s)}}}const yYe=6e4;function bYe(n){return $A(n.expiresIn,e=>n.obtainmentTimestamp+e*1e3-yYe)}function aM(n){return $A(bYe(n),e=>Date.now()>e)??!1}const Sb=Symbol("twurpleRawData");class SYe{[Sb];constructor(e){this[Sb]=e}}var EYe={};function xYe(){try{return EYe.TWURPLE_MOCK_API_PORT??null}catch{try{return null}catch{return null}}}function yie(n){if(!n)return"";const e=new URLSearchParams;for(const[r,i]of Object.entries(n))if(i===null)e.append(r,"");else if(Array.isArray(i))for(const s of i)e.append(r,s.toString());else i!==void 0&&e.append(r,i.toString());const t=e.toString();return t?`?${t}`:""}class F1 extends Error{constructor(e,t){super(e,t),Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace?.(this,new.target.constructor)}get name(){return this.constructor.name}}function bie(n,e,t){return r=>{const i=function(){return`[${e}#${this[t]} - please check https://twurple.js.org/reference/${n}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class NG extends F1{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}function I0(n){return typeof n=="string"?n:typeof n=="number"?n.toString(10):n.id}class Sie extends F1{_statusCode;_url;_method;_body;constructor(e,t,r,i,s,o){super(`Encountered HTTP status code ${e}: ${t}

URL: ${r}
Method: ${i}
Body:
${!o&&s.length>150?`${s.slice(0,147)}...`:s}`),this._statusCode=e,this._url=r,this._method=i,this._body=s}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function TYe(n,e){if(!n.ok){const t=n.headers.get("Content-Type")==="application/json",r=t?JSON.stringify(await n.json(),null,2):await n.text(),i=yie(e.query),s=`${e.url}${i}`;throw new Sie(n.status,n.statusText,s,e.method??"GET",r,t)}}async function wYe(n){if(n.status===204)return;const e=await n.text();if(e)return JSON.parse(e)}function AYe(n,e){const t=xYe();switch(e){case"helix":{const r=n.replace(/^\//,"");return t?r==="eventsub/subscriptions"?`http://localhost:${t}/${r}`:`http://localhost:${t}/mock/${r}`:`https://api.twitch.tv/helix/${r}`}case"auth":{const r=n.replace(/^\//,"");return t?`http://localhost:${t}/auth/${r}`:`https://id.twitch.tv/oauth2/${r}`}case"custom":return n;default:return n}}async function CYe(n,e,t,r,i={}){const s=n.type??"helix",o=AYe(n.url,s),a=yie(n.query),c=new Headers({Accept:"application/json"});let l;n.jsonBody&&(l=JSON.stringify(n.jsonBody),c.append("Content-Type","application/json")),e&&s!=="auth"&&c.append("Client-ID",e),t&&c.append("Authorization",`${s==="helix"?"Bearer":"OAuth"} ${t}`);const u={...i,method:n.method??"GET",headers:c,body:l};return await fetch(`${o}${a}`,u)}async function j3(n,e,t,r,i={}){const s=await CYe(n,e,t,r,i);return await TYe(s,n),await wYe(s)}class YE extends F1{constructor(e){super("Invalid token supplied",e)}}class cM extends F1{}function RYe(n,e,t,r){return{grant_type:"authorization_code",client_id:n,client_secret:e,code:t,redirect_uri:r}}function kYe(n,e){return{grant_type:"client_credentials",client_id:n,client_secret:e}}function MYe(n,e,t){return{grant_type:"refresh_token",client_id:n,client_secret:e,refresh_token:t}}let J4=class extends SYe{_obtainmentDate;constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[Sb].client_id}get userId(){return this[Sb].user_id??null}get userName(){return this[Sb].login??null}get scopes(){return this[Sb].scopes}get expiryDate(){return $A(this[Sb].expires_in,e=>new Date(this._obtainmentDate.getTime()+e*1e3))}};J4=zs([bie("auth","TokenInfo","clientId")],J4);function wB(n){return{accessToken:n.access_token,refreshToken:n.refresh_token||null,scope:n.scope??[],expiresIn:n.expires_in??null,obtainmentTimestamp:Date.now()}}async function IYe(n,e,t,r){return wB(await j3({type:"auth",url:"token",method:"POST",query:RYe(n,e,t,r)}))}async function OYe(n,e){return wB(await j3({type:"auth",url:"token",method:"POST",query:kYe(n,e)}))}async function PG(n,e,t){return wB(await j3({type:"auth",url:"token",method:"POST",query:MYe(n,e,t)}))}async function VA(n,e){try{const t=await j3({type:"auth",url:"validate"},e,n);return new J4(t)}catch(t){throw t instanceof Sie&&t.statusCode===401?new YE({cause:t}):t}}const NYe=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);function PYe(n,e){if(e?.length){const t=new Set(n.flatMap(r=>[r,...NYe.get(r)??[]]));if(e.every(r=>!t.has(r))){const r=e.join(", ");throw new Error(`This token does not have any of the requested scopes (${r}) and can not be upgraded.
If you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:

	https://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}}function lM(n,e){for(const t of e)PYe(n,t)}async function DYe(n,e,t,r,i){if(i?.length||!t){const s=await VA(e,n);if(!s.userId)throw new Error("Trying to use an app access token as a user access token");const o=r??s.scopes;return i&&lM(o,i.filter(a=>!!a)),[o,s.userId]}return[r,t]}class DG{_executor;_newTokenScopeSets=[];_newTokenPromise=null;_queuedScopeSets=[];_queueExecutor=null;_queuePromise=null;constructor(e){this._executor=e}async fetch(...e){const t=e.filter(o=>!!o);if(this._newTokenPromise){if(!t.length)return await this._newTokenPromise;if(this._queueExecutor?this._queuedScopeSets.push(...t):this._queuedScopeSets=[...t],!this._queuePromise){const{promise:o,resolve:a,reject:c}=X4();this._queuePromise=o,this._queueExecutor=async()=>{if(this._queuePromise){this._newTokenScopeSets=this._queuedScopeSets,this._queuedScopeSets=[],this._newTokenPromise=this._queuePromise,this._queuePromise=null,this._queueExecutor=null;try{a(await this._executor(this._newTokenScopeSets))}catch(l){c(l)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],this._queueExecutor?.()}}}}return await this._queuePromise}this._newTokenScopeSets=[...t];const{promise:r,resolve:i,reject:s}=X4();this._newTokenPromise=r;try{i(await this._executor(this._newTokenScopeSets))}catch(o){s(o)}finally{this._newTokenPromise=null,this._newTokenScopeSets=[],this._queueExecutor?.()}return await r}}class LG extends F1{userId;constructor(e){super(`The user context for the user ${e} has been disabled.
This happened because the access token became invalid (e.g. by expiry) and refreshing it failed (e.g. because the account's password was changed).

Use .addUser(), .addUserForToken() or .addUserForCode() for the same user context to re-enable the user with a new, valid token.`),this.userId=e}}class LYe extends F1{userId;constructor(e){super(`User ${e} was removed while trying to fetch a token.

Make sure you're not executing any actions when you want to remove a user.`),this.userId=e}}class UYe extends F1{intent;constructor(e){super(`Unknown intent: ${e}`),this.intent=e}}let Kv=class extends YC{_clientId;_clientSecret;_redirectUri;_userAccessTokens=new Map;_userTokenFetchers=new Map;_intentToUserId=new Map;_userIdToIntents=new Map;_cachedRefreshFailures=new Set;_appAccessToken;_appTokenFetcher;_appImpliedScopes;onRefresh=this.registerEvent();onRefreshFailure=this.registerEvent();constructor(e){super(),this._clientId=e.clientId,this._clientSecret=e.clientSecret,this._redirectUri=e.redirectUri,this._appImpliedScopes=e.appImpliedScopes??[],this._appTokenFetcher=new DG(async t=>await this._fetchAppToken(t))}addUser(e,t,r){const i=I0(e);if(!t.refreshToken)throw new Error(`Trying to add user ${i} without refresh token`);this._cachedRefreshFailures.delete(i),this._userAccessTokens.set(i,{...t,userId:i}),this._userTokenFetchers.has(i)||this._userTokenFetchers.set(i,new DG(async s=>await this._fetchUserToken(i,s))),r&&this.addIntentsToUser(e,r)}async addUserForToken(e,t){let r=null;if(e.accessToken&&!aM(e))try{const a=await VA(e.accessToken);r=[e,a]}catch(a){if(!(a instanceof YE))throw a}if(!r){if(!e.refreshToken)throw new YE;const a=await PG(this._clientId,this._clientSecret,e.refreshToken),c=await VA(a.accessToken);this.emit(this.onRefresh,c.userId,a),r=[a,c]}const[i,s]=r;if(!s.userId)throw new cM("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");const o=i.scope?i:{...i,scope:s.scopes};return this.addUser(s.userId,o,t),s.userId}async addUserForCode(e,t){if(!this._redirectUri)throw new Error("This method requires you to pass a `redirectUri` as a configuration property");const r=await IYe(this._clientId,this._clientSecret,e,this._redirectUri);return await this.addUserForToken(r,t)}hasUser(e){return this._userTokenFetchers.has(I0(e))}removeUser(e){const t=I0(e);if(this._userIdToIntents.has(t)){const r=this._userIdToIntents.get(t);for(const i of r)this._intentToUserId.delete(i);this._userIdToIntents.delete(t)}this._userAccessTokens.delete(t),this._userTokenFetchers.delete(t),this._cachedRefreshFailures.delete(t)}addIntentsToUser(e,t){const r=I0(e);if(!this._userAccessTokens.has(r))throw new Error("Trying to add intents to a user that was not added to this provider");for(const i of t)this._intentToUserId.has(i)&&this._userIdToIntents.get(this._intentToUserId.get(i)).delete(i),this._intentToUserId.set(i,r),this._userIdToIntents.has(r)?this._userIdToIntents.get(r).add(i):this._userIdToIntents.set(r,new Set([i]))}getIntentsForUser(e){const t=I0(e);return this._userIdToIntents.has(t)?Array.from(this._userIdToIntents.get(t)):[]}removeIntents(e){for(const t of e)if(this._intentToUserId.has(t)){const r=this._intentToUserId.get(t);this._userIdToIntents.get(r)?.delete(t),this._intentToUserId.delete(t)}}async refreshAccessTokenForUser(e){const t=I0(e);if(this._cachedRefreshFailures.has(t))throw new LG(t);const r=this._userAccessTokens.get(t);if(!r)throw new Error("Trying to refresh token for user that was not added to the provider");const i=await this._refreshUserTokenWithCallback(t,r.refreshToken);return this._checkIntermediateUserRemoval(t),this._userAccessTokens.set(t,{...i,userId:t}),this.emit(this.onRefresh,t,i),{...i,userId:t}}async refreshAccessTokenForIntent(e){if(!this._intentToUserId.has(e))throw new UYe(e);const t=this._intentToUserId.get(e);return await this.refreshAccessTokenForUser(t)}get clientId(){return this._clientId}getCurrentScopesForUser(e){const t=this._userAccessTokens.get(I0(e));if(!t)throw new Error("Trying to get scopes for user that was not added to the provider");return t.scope??[]}async getAccessTokenForUser(e,...t){const r=I0(e),i=this._userTokenFetchers.get(r);if(!i)return null;if(this._cachedRefreshFailures.has(r))throw new LG(r);return lM(this.getCurrentScopesForUser(r),t.filter(Boolean)),await i.fetch(...t)}async getAccessTokenForIntent(e,...t){if(!this._intentToUserId.has(e))return null;const r=this._intentToUserId.get(e),i=await this.getAccessTokenForUser(r,...t);if(!i)throw new NG(`Found intent ${e} corresponding to user ID ${r} but no token was found`);return{...i,userId:r}}async getAnyAccessToken(e){if(e){const t=I0(e);if(this._userAccessTokens.has(t)){const r=await this.getAccessTokenForUser(t);if(!r)throw new NG(`Token for user ID ${t} exists but nothing was returned by getAccessTokenForUser`);return{...r,userId:t}}}return await this.getAppAccessToken()}async getAppAccessToken(e=!1){return e&&(this._appAccessToken=void 0),await this._appTokenFetcher.fetch(...this._appImpliedScopes.map(t=>[t]))}_checkIntermediateUserRemoval(e){if(!this._userTokenFetchers.has(e))throw this._cachedRefreshFailures.delete(e),new LYe(e)}async _fetchUserToken(e,t){const r=this._userAccessTokens.get(e);if(!r)throw new Error("Trying to get token for user that was not added to the provider");if(r.accessToken&&!aM(r))try{if(r.scope)return lM(r.scope,t),r;const[s=[]]=await DYe(this._clientId,r.accessToken,e,r.scope,t),o={...r,scope:s};return this._checkIntermediateUserRemoval(e),this._userAccessTokens.set(e,o),o}catch(s){if(!(s instanceof YE))throw s}this._checkIntermediateUserRemoval(e);const i=await this.refreshAccessTokenForUser(e);return lM(i.scope,t),i}async _refreshUserTokenWithCallback(e,t){try{return await PG(this.clientId,this._clientSecret,t)}catch(r){throw this._cachedRefreshFailures.add(e),this.emit(this.onRefreshFailure,e,r),r}}async _fetchAppToken(e){if(e.length>0)for(const t of e)if(this._appImpliedScopes.length){if(t.every(r=>!this._appImpliedScopes.includes(r)))throw new Error(`One of the scopes ${t.join(", ")} requested but only the scope ${this._appImpliedScopes.join(", ")} is implied`)}else throw new Error(`One of the scopes ${t.join(", ")} requested but the client credentials flow does not support scopes`);return!this._appAccessToken||aM(this._appAccessToken)?await this._refreshAppToken():this._appAccessToken}async _refreshAppToken(){return this._appAccessToken=await OYe(this._clientId,this._clientSecret)}};zs([ly(!1)],Kv.prototype,"_clientSecret",void 0);zs([ly(!1)],Kv.prototype,"_userAccessTokens",void 0);zs([ly(!1)],Kv.prototype,"_userTokenFetchers",void 0);zs([ly(!1)],Kv.prototype,"_appAccessToken",void 0);zs([ly(!1)],Kv.prototype,"_appTokenFetcher",void 0);Kv=zs([bie("auth","RefreshingAuthProvider","clientId")],Kv);function AB(n,e,t){return r=>{const i=t?function(){return`[${e}#${this[t]} - please check https://twurple.js.org/reference/${n}/classes/${e}.html for available properties]`}:function(){return`[${e} - please check https://twurple.js.org/reference/${n}/classes/${e}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}class BYe extends YC{constructor({lineBased:e,logger:t,additionalOptions:r}={}){super(),this._currentLine="",this._connecting=!1,this._connected=!1,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._lineBased=e??!1,this._logger=t,this._additionalOptions=r}get isConnecting(){return this._connecting}get isConnected(){return this._connected}sendLine(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(`${e}\r
`))}assumeExternalDisconnect(){var e;(e=this._logger)===null||e===void 0||e.trace("AbstractConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.clearSocket(),this.emit(this.onDisconnect,!1)}receiveRaw(e){var t,r;if(!this._lineBased){this.emit(this.onReceive,e);return}const i=e.split(`\r
`);if(this._currentLine+=(t=i.shift())!==null&&t!==void 0?t:"",i.length){this.emit(this.onReceive,this._currentLine),this._currentLine=(r=i.pop())!==null&&r!==void 0?r:"";for(const s of i)this.emit(this.onReceive,s)}}}class FYe{constructor(){throw new Error("DirectConnection is not implemented in a browser environment")}}class jYe extends YC{constructor(e,t,r={}){var i;super(),this._type=e,this._target=t,this._config=r,this._retryLimit=1/0,this._initialRetryLimit=3,this._connecting=!1,this._connectionRetryCount=0,this.onReceive=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onEnd=this.registerEvent(),this._retryLimit=(i=r.retryLimit)!==null&&i!==void 0?i:1/0,this._logger=r.logger}get isConnected(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnected)!==null&&t!==void 0?t:!1}get isConnecting(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.isConnecting)!==null&&t!==void 0?t:this._connecting}get hasSocket(){var e,t;return(t=(e=this._currentConnection)===null||e===void 0?void 0:e.hasSocket)!==null&&t!==void 0?t:!1}sendLine(e){var t;(t=this._currentConnection)===null||t===void 0||t.sendLine(e)}connect(){if(this._currentConnection||this._connecting)throw new Error("Connection already present");this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(!0)}disconnect(){var e;if((e=this._logger)===null||e===void 0||e.trace(`PersistentConnection disconnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`),this._connecting=!1,this._currentConnection){const t=this._currentConnection;this._currentConnection=void 0,t.disconnect()}}assumeExternalDisconnect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("PersistentConnection assumeExternalDisconnect"),(t=this._currentConnection)===null||t===void 0||t.assumeExternalDisconnect()}reconnect(){this._reconnect(!0)}acknowledgeSuccessfulReconnect(){this._previousConnection&&(this._previousConnection.disconnect(),this._previousConnection=void 0)}_startTryingToConnect(e=!1){this._connecting=!0,this._connectionRetryCount=0,this._tryConnect(e)}_tryConnect(e=!1){var t,r;(t=this._logger)===null||t===void 0||t.trace(`PersistentConnection tryConnect currentConnectionExists:${(!!this._currentConnection).toString()} connecting:${this._connecting.toString()}`);const i=e?this._initialRetryLimit:this._retryLimit;(r=this._retryTimerGenerator)!==null&&r!==void 0||(this._retryTimerGenerator=hie(120));const s=this._currentConnection=new this._type(iYe(this._target),this._config);s.onReceive(o=>this.emit(this.onReceive,o)),s.onConnect(()=>{this.emit(this.onConnect),this._connecting=!1,this._retryTimerGenerator=void 0}),s.onDisconnect((o,a)=>{var c,l,u;if(this.emit(this.onDisconnect,o,a),o)this.emit(this.onEnd,!0),this._connecting=!1,this._retryTimerGenerator=void 0,s.disconnect(),this._currentConnection===s&&(this._currentConnection=void 0),this._previousConnection===s&&(this._previousConnection=void 0);else if(this._connecting){if((c=this._logger)===null||c===void 0||c.debug(`Connection error caught: ${(l=a?.message)!==null&&l!==void 0?l:"unknown error"}`),this._connectionRetryCount>=i)return;this._connectionRetryCount++;const h=this._retryTimerGenerator.next().value;h!==0&&((u=this._logger)===null||u===void 0||u.info(`Retrying in ${h} seconds`)),setTimeout(()=>{var f;this._connecting&&((f=this._logger)===null||f===void 0||f.info(e?"Retrying connection":"Trying to reconnect"),this._tryConnect())},h*1e3)}else this._reconnect()}),s.connect()}_reconnect(e=!1){e&&this._config.overlapManualReconnect?(this._previousConnection=this._currentConnection,this._currentConnection=void 0):this.disconnect(),this._startTryingToConnect(e)}}var xE=null;typeof WebSocket<"u"?xE=WebSocket:typeof MozWebSocket<"u"?xE=MozWebSocket:typeof z0<"u"?xE=z0.WebSocket||z0.MozWebSocket:typeof window<"u"?xE=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(xE=self.WebSocket||self.MozWebSocket);class zYe extends BYe{constructor(e,t){if(super(t),this._socket=null,this._closingOnDemand=!1,e.hostName&&e.port)this._url=`ws${e.secure?"s":""}://${e.hostName}:${e.port}`;else if(e.url)this._url=e.url;else throw new Error("WebSocketConnection requires either hostName & port or url to be set")}get hasSocket(){return!!this._socket}sendRaw(e){var t;(t=this._socket)===null||t===void 0||t.send(e)}connect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection connect"),this._connecting=!0,this._socket=new xE(this._url,(t=this._additionalOptions)===null||t===void 0?void 0:t.wsOptions),this._socket.onopen=()=>{var r;(r=this._logger)===null||r===void 0||r.trace("WebSocketConnection onOpen"),this._connected=!0,this._connecting=!1,this._closingOnDemand=!1,this.emit(this.onConnect)},this._socket.onmessage=({data:r})=>{this.receiveRaw(r.toString())},this._socket.onerror=r=>{var i;(i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onError message:${r.message}`)},this._socket.onclose=r=>{var i;const s=this._connected,o=this._connecting;if((i=this._logger)===null||i===void 0||i.trace(`WebSocketConnection onClose wasConnected:${s.toString()} wasConnecting:${o.toString()} closingOnDemand:${this._closingOnDemand.toString()} wasClean:${r.wasClean.toString()}`),this._connected=!1,this._connecting=!1,this._closingOnDemand)this._closingOnDemand=!1,this.emit(this.onDisconnect,!0),this.emit(this.onEnd,!0);else{const a=new Error(`[${r.code}] ${r.reason}`);this.emit(this.onDisconnect,!1,a),this.emit(this.onEnd,!1,a)}this.clearSocket()}}disconnect(){var e,t;(e=this._logger)===null||e===void 0||e.trace("WebSocketConnection disconnect"),this._closingOnDemand=!0,(t=this._socket)===null||t===void 0||t.close()}clearSocket(){this._socket&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onerror=null,this._socket.onclose=null,this._socket=null)}}function qw(n){var e,t,r;if(Array.isArray(n)){for(t=Array(e=n.length);e--;)t[e]=(r=n[e])&&typeof r=="object"?qw(r):r;return t}if(Object.prototype.toString.call(n)==="[object Object]"){t={};for(e in n)e==="__proto__"?Object.defineProperty(t,e,{value:qw(n[e]),configurable:!0,enumerable:!0,writable:!0}):t[e]=(r=n[e])&&typeof r=="object"?qw(r):r;return t}return n}const $Ye={name:"away-notify"};class GI extends Error{constructor(e,t,r){super(`command "${e}" expected ${t} or more parameters, got ${r}`),this._command=e,this._expectedParams=t,this._actualParams=r,Object.setPrototypeOf(this,GI.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,GI)}get command(){return this._command}get expectedParams(){return this._expectedParams}get actualParams(){return this._actualParams}}class WI extends Error{constructor(e,t,r,i){var s;super(`required parameter "${t}" did not validate against ${(s=r.type)!==null&&s!==void 0?s:"regex"} validation: "${i}"`),this._command=e,this._paramName=t,this._paramSpec=r,this._givenValue=i,Object.setPrototypeOf(this,WI.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,WI)}get command(){return this._command}get paramName(){return this._paramName}get paramSpec(){return this._paramSpec}get givenValue(){return this._givenValue}}const KE={channelTypes:"#&",supportedUserModes:"iwso",supportedChannelModes:{prefix:"ov",list:"b",alwaysWithParam:"ovk",paramWhenSet:"l",noParam:"imnpst"},prefixes:[{modeChar:"v",prefix:"+"},{modeChar:"o",prefix:"@"}]};var SD={exports:{}},UG;function VYe(){return UG||(UG=1,(function(n){n.exports=e=>{if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},n.exports.default=n.exports})(SD)),SD.exports}var HYe=VYe();const GYe=wu(HYe);function Q4(n,e="#&"){return new RegExp(`^[${GYe(e)}][^ \b\0
\r,]+$`).test(n)}const BG={0:"\0",n:`
`,r:"\r","":""};function FG(n){if(!n.startsWith("")||(n=n.substring(1),n.endsWith("")&&(n=n.slice(0,-1)),!n))return!1;n=n.replace(/\x10(.)/,(r,i)=>i in BG?BG[i]:"");let[e,t=""]=Gb(n," ",2);return e=e?e.toUpperCase():"",{command:e,params:t}}const WYe={"\\":"\\",";":":","\n":"n","\r":"r"," ":"s"};function qYe(n){return n.replace(/[\\;\n\r ]/g,e=>`\\${WYe[e]}`)}function YYe(n){let e=`${n.nick}`;return n.user&&(e+=`!${n.user}`),n.host&&(e+=`@${n.host}`),e}function KYe(n,e,t,r,i=KE,s=!1){const o=new n(n.COMMAND,void 0,{serverProperties:i}),a={};if(o._paramSpec&&K4(o._paramSpec,(c,l)=>{if(!(s&&c.noServer)&&!(!s&&c.noClient)){if(l in e){const u=e[l];if(u!==void 0){if(n.checkParam(u,c,i))a[l]={value:u,trailing:!!c.trailing};else if(!c.optional)throw new Error(`required parameter "${l}" did not suit requirements: "${u}"`)}}if(!(l in a)&&!c.optional)throw new Error(`required parameter "${l}" not found in command "${n.COMMAND}"`)}}),o._parsedParams=a,o._paramSpec)for(const c of Object.keys(o._paramSpec))Object.defineProperty(o,c,{get(){var l,u;return(u=(l=this._parsedParams)===null||l===void 0?void 0:l[c])===null||u===void 0?void 0:u.value}});return o._initPrefixAndTags(t,r),o}class cn{static checkParam(e,t,r=KE){return!(t.type==="channel"&&!Q4(e,r.channelTypes)||t.type==="channelList"&&!e.split(",").every(s=>Q4(s,r.channelTypes))||t.match&&!t.match.test(e))}constructor(e,{params:t,tags:r,prefix:i,rawLine:s}={},{serverProperties:o=KE,isServer:a=!1,shouldParseParams:c=!0}={},l){this._params=[],this._serverProperties=KE,this._paramSpec=l,this._command=e,this._params=t,this._tags=r??new Map,this._prefix=i,this._serverProperties=o,this._raw=s,c&&this.parseParams(a)}getMinParamCount(e=!1){return this._paramSpec?Object.values(this._paramSpec).filter(t=>t.noServer&&e||t.noClient&&!e?!1:!t.optional).length:0}get paramCount(){var e,t;return(t=(e=this._params)===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0}prefixToString(){return this._prefix?YYe(this._prefix):""}tagsToString(){return[...this._tags.entries()].map(([e,t])=>t?`${e}=${qYe(t)}`:e).join(";")}toString(e=!1,t=!1){const i=[t?this._buildCommandFromRawParams():this._buildCommandFromNamedParams()];if(e){const o=this.prefixToString();o&&i.unshift(`:${o}`)}const s=this.tagsToString();return s&&i.unshift(`@${s}`),i.join(" ")}_initPrefixAndTags(e,t){this._prefix=e,t&&(this._tags=t)}parseParams(e=!1){if(this._params){let t=this.getMinParamCount(e);if(t>this._params.length)throw new GI(this._command,t,this._params.length);const r=this._paramSpec;if(!r)return;let i=0;const s={};for(const[o,a]of Object.entries(r)){if(a.noServer&&e||a.noClient&&!e)continue;if(this._params.length-i<=t){if(a.optional)continue;if(this._params.length-i!==t)throw new Error("not enough parameters left for required parameters parsing (this is a library bug)")}let c=this._params[i];if(!c){if(a.optional)break;throw new Error("unexpected parameter underflow")}if(a.rest){const l=[];for(;this._params[i]&&!this._params[i].trailing;)l.push(this._params[i].value),++i;if(!l.length){if(a.optional)continue;throw new Error(`no parameters left for required rest parameter "${o}"`)}c={value:l.join(" "),trailing:!1}}if(cn.checkParam(c.value,a))s[o]={...c},a.optional||--t,a.rest||++i;else if(!a.optional)throw new WI(this._command,o,a,c.value);if(a.trailing)break}if(this._parsedParams=s,this._paramSpec)for(const o of Object.keys(this._paramSpec))Object.defineProperty(this,o,{get(){var a,c;return(c=(a=this._parsedParams)===null||a===void 0?void 0:a[o])===null||c===void 0?void 0:c.value}})}}get rawParamValues(){var e,t;return(t=(e=this._params)===null||e===void 0?void 0:e.map(r=>r.value))!==null&&t!==void 0?t:[]}get prefix(){return this._prefix}get command(){return this._command}get tags(){return this._tags}get rawLine(){return this._raw}isResponseTo(e){return!1}endsResponseTo(e){return!1}_acceptsInReplyCollection(e){return e.isResponseTo(this)}_buildCommandFromNamedParams(){const e=this._paramSpec?Object.keys(this._paramSpec):[];return[this._command,...e.map(t=>{var r;const i=(r=this._parsedParams)===null||r===void 0?void 0:r[t];if(i)return(i.trailing?":":"")+i.value}).filter(t=>t!==void 0)].join(" ")}_buildCommandFromRawParams(){var e,t;return[this._command,...(t=(e=this._params)===null||e===void 0?void 0:e.map(r=>`${r.trailing?":":""}${r.value}`))!==null&&t!==void 0?t:[]].join(" ")}}cn.COMMAND="";cn.SUPPORTS_CAPTURE=!1;class Eie extends cn{constructor(e,t,r){super(e,t,r,{reference:{},type:{optional:!0},additionalParams:{optional:!0}})}}Eie.COMMAND="BATCH";const XYe={name:"batch",messageTypes:[Eie],usesTags:!0},ZYe={name:"cap-notify"};class xie extends cn{constructor(e,t,r){super(e,t,r,{newUser:{},newHost:{}})}}xie.COMMAND="CHGHOST";const JYe={name:"chghost",messageTypes:[xie]},QYe={name:"invite-notify"};class Tie extends cn{}Tie.COMMAND="ACK";const eKe={name:"labeled-response",messageTypes:[Tie],usesTags:!0},tKe={name:"message-tags",usesTags:!0},nKe={name:"multi-prefix"},rKe=Object.freeze(Object.defineProperty({__proto__:null,AwayNotify:$Ye,Batch:XYe,CapNotify:ZYe,ChgHost:JYe,InviteNotify:QYe,LabeledResponse:eKe,MessageTags:tKe,MultiPrefix:nKe},Symbol.toStringTag,{value:"Module"}));class iKe{constructor(e,t,...r){this._client=e,this._originalMessage=t,this._messages=[],this._endEventHandlers=new Map,this._types=new Set(r)}untilEvent(e){this._cleanEndEventHandler(e);const t=this._client.on(e,()=>this.end());this._endEventHandlers.set(e,t)}async promise(){return this._promise||(this._promise=new Promise(e=>{this._promiseResolve=e})),await this._promise}collect(e){return this._originalMessage._acceptsInReplyCollection(e)?(this._messages.push(e),e.endsResponseTo(this._originalMessage)&&this.end(),!0):!1}end(){this._client.stopCollect(this),this._cleanEndEventHandlers(),this._promiseResolve&&this._promiseResolve(this._messages)}_cleanEndEventHandlers(){this._endEventHandlers.forEach(e=>{this._client.removeListener(e)}),this._endEventHandlers.clear()}_cleanEndEventHandler(e){this._endEventHandlers.has(e)&&(this._client.removeListener(this._endEventHandlers.get(e)),this._endEventHandlers.delete(e))}}class CB extends cn{constructor(e,t,r){super(e,t,r,{password:{}})}}CB.COMMAND="PASS";class Yw extends cn{constructor(e,t,r){super(e,t,r,{nick:{}})}}Yw.COMMAND="NICK";class RB extends cn{constructor(e,t,r){super(e,t,r,{user:{},mode:{},unused:{},realName:{trailing:!0}})}}RB.COMMAND="USER";class wie extends cn{constructor(e,t,r){super(e,t,r,{name:{},password:{}})}}wie.COMMAND="OPER";class kB extends cn{constructor(e,t,r){super(e,t,r,{text:{trailing:!0,optional:!0}})}}kB.COMMAND="QUIT";class Aie extends cn{constructor(e,t,r){super(e,t,r,{server:{},reason:{trailing:!0}})}}Aie.COMMAND="SQUIT";class HA extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},key:{optional:!0}})}}HA.COMMAND="JOIN";class GA extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},reason:{trailing:!0,optional:!0}})}}GA.COMMAND="PART";class qI extends Error{constructor(e){super(`Unknown channel mode character ${e}`),this._char=e,Object.setPrototypeOf(this,qI.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qI)}get char(){return this._char}}class Cie extends cn{constructor(e,t,r){super(e,t,r,{target:{},modes:{rest:!0,optional:!0}})}get isChannel(){return Q4(this.target,this._serverProperties.channelTypes)}separate(){const e=[],t=this.modes;if(!t)throw new Error("can't separate a channel mode request, just set actions");const r=t.split(" "),i=r.shift();let s="add";for(const o of i){let a=s;switch(o){case"+":{s="add";break}case"-":{s="remove";break}default:{let c=!1,l=!0;if(this.isChannel){if(this._serverProperties.supportedChannelModes.alwaysWithParam.includes(o)||this._serverProperties.supportedChannelModes.prefix.includes(o))c=!0;else if(this._serverProperties.supportedChannelModes.paramWhenSet.includes(o))s==="add"&&(c=!0);else if(this._serverProperties.supportedChannelModes.list.includes(o))r.length?c=!0:a="getList";else if(!this._serverProperties.supportedChannelModes.noParam.includes(o))throw new qI(o)}else l=this._serverProperties.supportedUserModes.includes(o);if(c&&!r.length)continue;e.push({prefix:this._prefix,action:a,letter:o,param:c?r.shift():void 0,known:l})}}}return e}}Cie.COMMAND="MODE";class Rie extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},newTopic:{optional:!0,trailing:!0}})}}Rie.COMMAND="TOPIC";class KC extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channelList",optional:!0}})}}KC.COMMAND="NAMES";KC.SUPPORTS_CAPTURE=!0;class kie extends cn{constructor(e,t,r){super(e,t,r,{channel:{optional:!0},server:{optional:!0}})}}kie.COMMAND="LIST";class Mie extends cn{constructor(e,t,r){super(e,t,r,{target:{},channel:{type:"channel"}})}}Mie.COMMAND="INVITE";class Iie extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},target:{},reason:{trailing:!0,optional:!0}})}}Iie.COMMAND="KICK";class Oie extends cn{constructor(e,t,r){super(e,t,r,{server:{optional:!0}})}}Oie.COMMAND="TIME";class WA extends cn{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}}WA.COMMAND="PRIVMSG";class z3 extends cn{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}}z3.COMMAND="NOTICE";class $3 extends cn{constructor(e,t,r){super(e,t,r,{mask:{},flags:{optional:!0},extendedMask:{optional:!0,trailing:!0}})}}$3.COMMAND="WHO";class Nie extends cn{constructor(e,t,r){super(e,t,r,{server:{optional:!0},nickMask:{}})}}Nie.COMMAND="WHOIS";class Pie extends cn{constructor(e,t,r){super(e,t,r,{nick:{},count:{optional:!0},server:{optional:!0}})}}Pie.COMMAND="WHOWAS";class Die extends cn{constructor(e,t,r){super(e,t,r,{target:{},reason:{trailing:!0,optional:!0}})}}Die.COMMAND="KILL";class YI extends cn{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}YI.COMMAND="PING";class KI extends cn{constructor(e,t,r){super(e,t,r,{server:{noClient:!0},text:{trailing:!0}})}}KI.COMMAND="PONG";class Lie extends cn{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}Lie.COMMAND="ERROR";class Uie extends cn{constructor(e,t,r){super(e,t,r,{text:{trailing:!0,optional:!0}})}}Uie.COMMAND="AWAY";class Bie extends cn{}Bie.COMMAND="REHASH";class Fie extends cn{}Fie.COMMAND="RESTART";class jie extends cn{constructor(e,t,r){super(e,t,r,{text:{trailing:!0}})}}jie.COMMAND="WALLOPS";class zie extends cn{constructor(e,t,r){super(e,t,r,{nicks:{rest:!0}})}}zie.COMMAND="USERHOST";class $ie extends cn{constructor(e,t,r){super(e,t,r,{nicks:{rest:!0}})}}$ie.COMMAND="ISON";class ed extends cn{constructor(e,t,r){super(e,t,r,{target:{match:/^(?:[a-z_\-\[\]\\^{}|`][a-z0-9_\-\[\]\\^{}|`]+|\*)$/i,optional:!0,noClient:!0},subCommand:{match:/^(?:LS|LIST|REQ|ACK|NAK|END|NEW|DEL)$/i},version:{match:/^\d+$/,optional:!0},continued:{match:/^\*$/,optional:!0},capabilities:{trailing:!0,optional:!0}})}isResponseTo(e){if(!(e instanceof ed))return!1;switch(this.subCommand){case"ACK":case"NAK":return e.subCommand==="REQ"&&e.capabilities===this.capabilities.trim();case"LS":case"LIST":return e.subCommand===this.subCommand;default:return!1}}endsResponseTo(e){if(!(e instanceof ed))return!1;switch(this.subCommand){case"LS":case"LIST":return!this.continued;default:return!0}}}ed.COMMAND="CAP";ed.SUPPORTS_CAPTURE=!0;class Vie extends cn{constructor(e,t,r){super(e,t,r,{target:{}})}}Vie.COMMAND="TAGMSG";const Hie=Object.freeze(Object.defineProperty({__proto__:null,Away:Uie,CapabilityNegotiation:ed,ChannelInvite:Mie,ChannelJoin:HA,ChannelKick:Iie,ChannelList:kie,ChannelPart:GA,ClientQuit:kB,ErrorMessage:Lie,IsOnQuery:$ie,Kill:Die,Mode:Cie,Names:KC,NickChange:Yw,Notice:z3,OperLogin:wie,Password:CB,Ping:YI,Pong:KI,PrivateMessage:WA,Rehash:Bie,Restart:Fie,ServerQuit:Aie,TagMessage:Vie,Time:Oie,Topic:Rie,UserHostQuery:zie,UserRegistration:RB,Wallops:jie,WhoIsQuery:Nie,WhoQuery:$3,WhoWasQuery:Pie},Symbol.toStringTag,{value:"Module"}));class MB extends cn{constructor(e,t,r){super(e,t,r,{me:{},welcomeText:{trailing:!0}})}}MB.COMMAND="001";class Gie extends cn{constructor(e,t,r){super(e,t,r,{me:{},yourHost:{trailing:!0}})}}Gie.COMMAND="002";class Wie extends cn{constructor(e,t,r){super(e,t,r,{me:{},createdText:{trailing:!0}})}}Wie.COMMAND="003";class IB extends cn{constructor(e,t,r){super(e,t,r,{me:{},serverName:{},version:{},userModes:{},channelModes:{},channelModesWithParam:{optional:!0}})}}IB.COMMAND="004";class OB extends cn{constructor(e,t,r){super(e,t,r,{me:{},supports:{rest:!0},suffix:{trailing:!0}})}}OB.COMMAND="005";class qie extends cn{constructor(e,t,r){super(e,t,r,{me:{},modes:{}})}}qie.COMMAND="221";class Yie extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},text:{trailing:!0}})}}Yie.COMMAND="301";class Kie extends cn{constructor(e,t,r){super(e,t,r,{me:{},hosts:{trailing:!0}})}}Kie.COMMAND="302";class Xie extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}Xie.COMMAND="305";class Zie extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}Zie.COMMAND="306";class Jie extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},username:{},host:{},_unused:{},realname:{trailing:!0}})}}Jie.COMMAND="311";class Qie extends cn{constructor(e,t,r){super(e,t,r,{me:{},query:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof $3}endsResponseTo(){return!0}}Qie.COMMAND="315";class ese extends cn{constructor(e,t,r){super(e,t,r,{me:{},nickMask:{},suffix:{trailing:!0}})}}ese.COMMAND="318";class tse extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channels:{trailing:!0}})}}tse.COMMAND="319";class nse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},memberCount:{},topic:{trailing:!0}})}}nse.COMMAND="322";class rse extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}rse.COMMAND="323";class ise extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},modes:{rest:!0}})}}ise.COMMAND="324";class sse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}sse.COMMAND="331";class ose extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},topic:{trailing:!0}})}}ose.COMMAND="332";class ase extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},who:{},ts:{}})}}ase.COMMAND="333";class cse extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"}})}}cse.COMMAND="341";class lse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}lse.COMMAND="348";class use extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}use.COMMAND="349";class hse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{},user:{},host:{},server:{},nick:{},flags:{},hopsAndRealName:{trailing:!0}})}get isAway(){return this.flags.includes("G")}get isOper(){return this.flags.includes("*")}get isBot(){return this.flags.includes("B")}isResponseTo(e){return e instanceof $3}}hse.COMMAND="352";class fse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channelType:{},channel:{type:"channel"},names:{trailing:!0}})}isResponseTo(e){return e instanceof KC}}fse.COMMAND="353";class dse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}isResponseTo(e){return e instanceof KC}endsResponseTo(){return!0}}dse.COMMAND="366";class pse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},mask:{},creatorName:{optional:!0},timestamp:{optional:!0}})}}pse.COMMAND="367";class mse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}mse.COMMAND="368";class gse extends cn{constructor(e,t,r){super(e,t,r,{me:{},line:{trailing:!0}})}}gse.COMMAND="372";class _se extends cn{constructor(e,t,r){super(e,t,r,{me:{},line:{trailing:!0}})}}_se.COMMAND="375";class NB extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}NB.COMMAND="376";class vse extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}vse.COMMAND="381";class yse extends cn{constructor(e,t,r){super(e,t,r,{me:{},server:{optional:!0},timestamp:{trailing:!0}})}}yse.COMMAND="391";class bse extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}}bse.COMMAND="401";class Sse extends cn{constructor(e,t,r){super(e,t,r,{me:{},server:{},suffix:{trailing:!0}})}}Sse.COMMAND="402";class Ese extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}Ese.COMMAND="403";class xse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}xse.COMMAND="404";class Tse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Tse.COMMAND="405";class wse extends cn{constructor(e,t,r){super(e,t,r,{me:{},subCommand:{},suffix:{trailing:!0}})}}wse.COMMAND="410";class Ase extends cn{constructor(e,t,r){super(e,t,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command===this.originalCommand}endsResponseTo(){return!0}}Ase.COMMAND="421";class PB extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}PB.COMMAND="422";class Cse extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Cse.COMMAND="431";class Rse extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Rse.COMMAND="432";class kse extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}kse.COMMAND="433";class Mse extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Mse.COMMAND="436";class Ise extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Ise.COMMAND="441";class Ose extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Ose.COMMAND="442";class Nse extends cn{constructor(e,t,r){super(e,t,r,{me:{},nick:{},channel:{type:"channel"},suffix:{trailing:!0}})}isResponseTo(e){return e.command==="NICK"}endsResponseTo(){return!0}}Nse.COMMAND="443";class Pse extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}Pse.COMMAND="451";class Dse extends cn{constructor(e,t,r){super(e,t,r,{me:{},originalCommand:{},suffix:{trailing:!0}})}}Dse.COMMAND="461";class DB extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}DB.COMMAND="462";class Lse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Lse.COMMAND="471";class Use extends cn{constructor(e,t,r){super(e,t,r,{me:{},char:{},suffix:{trailing:!0}})}}Use.COMMAND="472";class Bse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Bse.COMMAND="473";class Fse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}Fse.COMMAND="474";class jse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{type:"channel"},suffix:{trailing:!0}})}}jse.COMMAND="475";class zse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}zse.COMMAND="479";class $se extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}$se.COMMAND="481";class Vse extends cn{constructor(e,t,r){super(e,t,r,{me:{},channel:{},suffix:{trailing:!0}})}}Vse.COMMAND="482";class Hse extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}Hse.COMMAND="491";class Gse extends cn{constructor(e,t,r){super(e,t,r,{me:{},modeChar:{optional:!0,match:/^\w$/},suffix:{trailing:!0}})}}Gse.COMMAND="501";class Wse extends cn{constructor(e,t,r){super(e,t,r,{me:{},suffix:{trailing:!0}})}}Wse.COMMAND="502";const qse=Object.freeze(Object.defineProperty({__proto__:null,Error401NoSuchNick:bse,Error402NoSuchServer:Sse,Error403NoSuchChannel:Ese,Error404CanNotSendToChan:xse,Error405TooManyChannels:Tse,Error410InvalidCapCmd:wse,Error421UnknownCommand:Ase,Error422NoMotd:PB,Error431NoNickNameGiven:Cse,Error432ErroneusNickname:Rse,Error433NickNameInUse:kse,Error436NickCollision:Mse,Error441UserNotInChannel:Ise,Error442NotOnChannel:Ose,Error443UserOnChannel:Nse,Error451NotRegistered:Pse,Error461NeedMoreParams:Dse,Error462AlreadyRegistered:DB,Error471ChannelIsFull:Lse,Error472UnknownMode:Use,Error473InviteOnlyChan:Bse,Error474BannedFromChan:Fse,Error475BadChannelKey:jse,Error479BadChanName:zse,Error481NoPrivileges:$se,Error482ChanOpPrivsNeeded:Vse,Error491NoOperHost:Hse,Error501UmodeUnknownFlag:Gse,Error502UsersDontMatch:Wse,Reply001Welcome:MB,Reply002YourHost:Gie,Reply003Created:Wie,Reply004ServerInfo:IB,Reply005Isupport:OB,Reply221UmodeIs:qie,Reply301Away:Yie,Reply302UserHost:Kie,Reply305UnAway:Xie,Reply306NowAway:Zie,Reply311WhoisUser:Jie,Reply315EndOfWho:Qie,Reply318EndOfWhois:ese,Reply319WhoisChannels:tse,Reply322List:nse,Reply323ListEnd:rse,Reply324ChannelModeIs:ise,Reply331NoTopic:sse,Reply332Topic:ose,Reply333TopicWhoTime:ase,Reply341Inviting:cse,Reply348ExceptList:lse,Reply349EndOfExceptList:use,Reply352WhoReply:hse,Reply353NamesReply:fse,Reply366EndOfNames:dse,Reply367BanList:pse,Reply368EndOfBanList:mse,Reply372Motd:gse,Reply375MotdStart:_se,Reply376EndOfMotd:NB,Reply381YoureOper:vse,Reply391Time:yse},Symbol.toStringTag,{value:"Module"})),sKe=new Map([...Object.values(Hie),...Object.values(qse)].map(n=>[n.COMMAND,n]));function oKe(n){const[e,t]=Gb(n,"!",2);if(t){const[r,i]=Gb(t,"@",2);return i?{nick:e,user:r,host:i}:{nick:e,host:r}}return{nick:e}}const jG={":":";",n:`
`,r:"\r",s:" "};function aKe(n){const e=new Map,t=n.split(";");for(const r of t){const[i,s]=Gb(r,"=",2);i!==""&&e.set(i,s?s.replace(/\\(.?)/g,(o,a)=>Object.prototype.hasOwnProperty.call(jG,a)?jG[a]:a):"")}return e}function cKe(n,e=KE,t=sKe,r=!1,i=[],s=!0){const o=n.split(" ");let a,c;const l=[];let u,h;for(;o.length;){if([a]=o,a.startsWith("@")&&!u&&!c&&!h)u=aKe(a.slice(1));else if(a.startsWith(":"))if(!h&&!c)a.length>1&&(h=oKe(a.slice(1)));else{l.push({value:o.join(" ").slice(1),trailing:!0});break}else c?l.push({value:a,trailing:!1}):c=a.toUpperCase();o.shift()}if(u||(u=new Map),!c)throw new Error(`line without command received: ${n}`);s&&(s=!i.includes(c));let f=cn;return t.has(c)&&(f=t.get(c)),new f(c,{params:l,tags:u,prefix:h,rawLine:n},{serverProperties:e,isServer:r,shouldParseParams:s})}class Yse extends YC{constructor(e){super(),this._registered=!1,this._supportsCapabilities=!0,this._events=new Map,this._registeredMessageTypes=new Map,this.onConnect=this.registerEvent(),this.onRegister=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPrivmsg=this.registerEvent(),this.onAction=this.registerEvent(),this.onNotice=this.registerEvent(),this.onNickChange=this.registerEvent(),this.onCtcp=this.registerEvent(),this.onCtcpReply=this.registerEvent(),this.onPasswordError=this.registerEvent(),this.onAnyMessage=this.registerEvent(),this._serverProperties=qw(KE),this._supportedFeatures={},this._collectors=[],this._clientCapabilities=new Map,this._serverCapabilities=new Map,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._hasRegisteredBefore=!1,this._channelsFromLastRegister=new Set,this._initialConnectionSetupDone=!1;const{connection:t,credentials:r,channels:i,channelTypes:s,webSocket:o,logger:a={}}=e;this._options=e;const{pingOnInactivity:c=60,pingTimeout:l=10}=t;this._pingOnInactivity=c,this._pingTimeout=l,this._currentNick=r.nick,this._logger=F3({name:"ircv3",emoji:!0,...a}),this.registerCoreMessageTypes();const{hostName:u,secure:h,reconnect:f=!0}=t,d={hostName:u,port:this.port,secure:h},p={lineBased:!0,logger:this._logger,additionalOptions:e.connectionOptions},m=o?zYe:FYe;f?this._connection=new jYe(m,d,p):this._connection=new m(p,this._logger,e.connectionOptions);for(const _ of Object.values(rKe))this.addCapability(_);this.addInternalListener(this.onRegister,async()=>{const _=this._hasRegisteredBefore,v=this._channelsFromLastRegister;this._hasRegisteredBefore=!0,this._channelsFromLastRegister=new Set;const S=_&&this._options.rejoinChannelsOnReconnect?v:await Y4(i);if(S)for(const b of S)this.join(b)}),this.onTypedMessage(ed,async({subCommand:_,capabilities:v})=>{const S=v.split(" ");switch(_.toUpperCase()){case"NEW":{this._logger.debug(`Server registered new capabilities: ${S.join(", ")}`);const b=bk(S,w=>{if(!w)return{};const[R,C]=Gb(w,"=",2);return{[R]:{name:R,param:C||!0}}});for(const[w,R]of Object.entries(b))this._serverCapabilities.set(w,R);const T=Object.keys(b);await this._negotiateCapabilities(Array.from(this._clientCapabilities.entries()).filter(([w])=>T.includes(w)).map(([,w])=>w));break}case"DEL":{this._logger.debug(`Server removed capabilities: ${S.join(", ")}`);for(const b of S)this._serverCapabilities.delete(b),this._negotiatedCapabilities.delete(b)}}}),this.onTypedMessage(YI,({text:_})=>{this.sendMessage(KI,{text:_})}),this.onTypedMessage(MB,({me:_})=>this._handleReceivedClientNick(_)),this.onTypedMessage(IB,({userModes:_})=>{_&&(this._serverProperties.supportedUserModes=_)}),this.onTypedMessage(OB,({supports:_})=>{const v=bk(_.split(" "),S=>{const[b,T]=Gb(S,"=",2);return{[b]:T||!0}});this._supportedFeatures={...this._supportedFeatures,...v}}),this.onTypedMessage(NB,({me:_})=>{this._registered||(this._handleReceivedClientNick(_),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(PB,({me:_})=>{this._registered||(this._handleReceivedClientNick(_),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(DB,({me:_})=>{this._registered||(this._logger.warn("We thought we're not registered yet, but we actually are"),this._handleReceivedClientNick(_),this._registered=!0,this.emit(this.onRegister))}),this.onTypedMessage(WA,_=>{var v;const{target:S,text:b}=_,T=FG(b),w=(v=_.prefix)===null||v===void 0?void 0:v.nick;T?T.command==="ACTION"?this.emit(this.onAction,S,w,T.params,_):this.emit(this.onCtcp,S,w,T.command,T.params,_):this.emit(this.onPrivmsg,S,w,b,_)}),this.onTypedMessage(Yw,_=>{var v;const{nick:S}=_,b=(v=_.prefix)===null||v===void 0?void 0:v.nick;b===this._currentNick&&(this._currentNick=S),this.emit(this.onNickChange,b,S,_)}),this.onTypedMessage(z3,_=>{var v;const{target:S,text:b}=_,T=FG(b),w=(v=_.prefix)===null||v===void 0?void 0:v.nick;T&&this.emit(this.onCtcpReply,S,w,T.command,T.params,_),this.emit(this.onNotice,S,w,b,_)}),this._options.manuallyAcknowledgeJoins||this.onTypedMessage(HA,({channel:_,prefix:v})=>{v?.nick===this._currentNick&&this.acknowledgeJoin(_)}),this.onTypedMessage(GA,_=>{var v;((v=_.prefix)===null||v===void 0?void 0:v.nick)===this._currentNick&&(this._currentChannels.delete(_.channel),this._channelsFromLastRegister.delete(_.channel))}),this.addInternalListener(this.onRegister,()=>this._startPingCheckTimer()),this._desiredNick=r.nick,this._userName=r.userName,this._realName=r.realName,s&&(this._serverProperties.channelTypes=s)}receiveLine(e){var t;this._logger.debug(`Received message: ${e}`);let r;try{r=cKe(e,this._serverProperties,this._registeredMessageTypes,!0,this._options.nonConformingCommands)}catch(i){this._logger.error(`Error parsing message: ${i.message}`),this._logger.trace((t=i.stack)!==null&&t!==void 0?t:"No stack available");return}this._logger.trace(`Parsed message: ${JSON.stringify(r)}`),this._startPingCheckTimer(),this.emit(this.onAnyMessage,r),this._handleEvents(r)}get serverProperties(){return qw(this._serverProperties)}get port(){const{webSocket:e,connection:{port:t,secure:r}}=this._options;return t||(e?r?443:80:r?6697:6667)}pingCheck(){const e=Date.now(),t=e.toString(),r=this.onTypedMessage(KI,i=>{const{text:s}=i;s===t&&(this._logger.debug(`Current ping: ${Date.now()-e}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeMessageListener(r))});this._pingTimeoutTimer=setTimeout(()=>{this.removeMessageListener(r),this._options.connection.reconnect===!1?this._logger.error(`Disconnecting because the last ping took over ${this._pingTimeout} seconds`):this._logger.warn(`Reconnecting because the last ping took over ${this._pingTimeout} seconds`),this._connection.assumeExternalDisconnect()},this._pingTimeout*1e3),this.sendMessage(YI,{text:t})}reconnect(e){this.quit(e),this.connect()}registerMessageType(e){e.COMMAND!==""&&(this._logger.trace(`Registering message type ${e.COMMAND}`),this._registeredMessageTypes.set(e.COMMAND.toUpperCase(),e))}knowsCommand(e){return this._registeredMessageTypes.has(e.toUpperCase())}getCommandClass(e){return this._registeredMessageTypes.get(e.toUpperCase())}acknowledgeJoin(e){this._currentChannels.add(e),this._channelsFromLastRegister.add(e)}connect(){this._supportsCapabilities=!1,this._negotiatedCapabilities=new Map,this._currentChannels=new Set,this._currentNick=this._desiredNick,this._setupConnection(),this._logger.info(`Connecting to ${this._options.connection.hostName}:${this.port}`),this._connection.connect()}addCapability(e){if(this._clientCapabilities.set(e.name,e),e.messageTypes)for(const t of Object.values(e.messageTypes))this.registerMessageType(t)}async registerCapability(e){return this.addCapability(e),this._serverCapabilities.has(e.name)?await this._negotiateCapabilities([e]):[]}send(e){this.sendRaw(e.toString())}sendRaw(e){this._connection.isConnected&&(this._logger.debug(`Sending message: ${e}`),this._connection.sendLine(e))}onNamedMessage(e,t,r){this._events.has(e)||this._events.set(e,new Map);const i=this._events.get(e);if(!r)do r=`${e}:${oYe(Math.random()*1e4,4,"0")}`;while(i.has(r));return i.set(r,t),r}onTypedMessage(e,t,r){return this.onNamedMessage(e.COMMAND,t,r)}removeMessageListener(e){const[t]=e.split(":");this._events.has(t)&&this._events.get(t).delete(e)}createMessage(e,t,r){const i=r?new Map(Object.entries(r)):void 0;return KYe(e,t,void 0,i,this.serverProperties)}sendMessage(e,t,r){this.send(this.createMessage(e,t,r))}async sendMessageAndCaptureReply(e,t){if(!e.SUPPORTS_CAPTURE)throw new Error(`The command "${e.COMMAND}" does not support reply capture`);const r=this.createMessage(e,t),i=this.collect(r).promise();return this.send(r),await i}get isConnected(){return this._connection.isConnected}get isConnecting(){return this._connection.isConnecting}get isRegistered(){return this._registered}get currentNick(){return this._currentNick}get currentChannels(){return Array.from(this._currentChannels)}collect(e,...t){const r=new iKe(this,e,...t);return this._collectors.push(r),r}stopCollect(e){this._collectors.splice(this._collectors.findIndex(t=>t===e),1)}join(e,t){this.sendMessage(HA,{channel:e,key:t})}part(e){this.sendMessage(GA,{channel:e})}quit(e){this.sendMessage(kB,{text:e}),this.quitAbruptly()}quitAbruptly(){this._registered=!1,this._connection.disconnect()}say(e,t,r={}){this.sendMessage(WA,{target:e,text:t},r)}sendCtcp(e,t,r){this.say(e,`${t.toUpperCase()} ${r}`)}action(e,t){this.sendCtcp(e,"ACTION",t)}changeNick(e){this._currentNick!==e&&(this._desiredNick=e,this.isRegistered&&this.sendMessage(Yw,{nick:e}))}registerCoreMessageTypes(){K4(Hie,e=>{this.registerMessageType(e)}),K4(qse,e=>{this.registerMessageType(e)})}async _negotiateCapabilityBatch(e){return await Promise.all(e.filter(t=>t.length).map(async t=>await this._negotiateCapabilities(t)))}async _negotiateCapabilities(e){const t=bk(e,o=>({[o.name]:o})),i=(await this.sendMessageAndCaptureReply(ed,{subCommand:"REQ",capabilities:e.map(o=>o.name).join(" ")})).shift();if(!i)throw new Error("capability negotiation failed unexpectedly without any reply");if(!(i instanceof ed))throw new Error(`capability negotiation failed unexpectedly with "${i.command}" command`);const s=i.capabilities.split(" ").filter(o=>o);if(i.subCommand==="ACK"){this._logger.debug(`Successfully negotiated capabilities: ${s.join(", ")}`);const o=s.map(a=>t[a]);for(const a of o){const c=this._clientCapabilities.get(a.name);c.param=a.param,this._negotiatedCapabilities.set(c.name,c)}return o}return this._logger.warn(`Failed to negotiate capabilities: ${s.join(", ")}`),new Error("capabilities failed to negotiate")}_setupConnection(){this._initialConnectionSetupDone||(this._connection.onConnect(async()=>{var e,t;this._logger.info(`Connection to server ${this._options.connection.hostName}:${this.port} established`),this.emit(this.onConnect),this._logger.debug("Determining connection password");try{const[r]=await Promise.all([Y4(this._options.credentials.password),this.sendMessageAndCaptureReply(ed,{subCommand:"LS",version:"302"}).then(async i=>{if(!i.length||!(i[0]instanceof ed))return this._logger.debug("Server does not support capabilities"),[];this._supportsCapabilities=!0;const s=i.map(a=>bk(a.capabilities.split(" "),c=>{if(!c)return{};const[l,u]=Gb(c,"=",2);return{[l]:{name:l,param:u||!0}}}));this._serverCapabilities=new Map(Object.entries(Object.assign({},...s))),this._logger.debug(`Capabilities supported by server: ${Array.from(this._serverCapabilities.keys()).join(", ")}`);const o=s.map(a=>{const c=Object.keys(a);return Array.from(this._clientCapabilities.entries()).filter(([l])=>c.includes(l)).map(([,l])=>l)});return await this._negotiateCapabilityBatch(o)}).then(()=>{this.sendMessage(ed,{subCommand:"END"})})]);r&&this.sendMessage(CB,{password:r}),this.sendMessage(Yw,{nick:this._desiredNick}),this.sendMessage(RB,{user:(e=this._userName)!==null&&e!==void 0?e:this._desiredNick,mode:"8",unused:"*",realName:(t=this._realName)!==null&&t!==void 0?t:this._desiredNick})}catch(r){this.emit(this.onPasswordError,r),this.quit()}}),this._initialConnectionSetupDone=!0,this._connection.onReceive(e=>{this.receiveLine(e)}),this._connection.onDisconnect((e,t)=>{var r;if(this._registered=!1,this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),e)this._logger.info("Disconnected");else{const i=(r=this._options.connection.reconnect)!==null&&r!==void 0?r:!0,s=t?`Disconnected unexpectedly: ${t.message}`:"Disconnected unexpectedly";i?this._logger.warn(`${s}; trying to reconnect`):this._logger.error(s)}this.emit(this.onDisconnect,e,t)}),this._connection.onEnd(e=>{e||this._logger.warn("No further retries will be made")}))}_handleReceivedClientNick(e){this._currentNick!==e&&(this._currentNick!==""&&this._logger.warn(`Mismatching nicks: passed ${this._currentNick}, but you're actually ${e}`),this._currentNick=e)}_handleEvents(e){this._collectors.some(r=>r.collect(e));const t=this._events.get(e.constructor.COMMAND);if(t)for(const r of t.values())r(e)}_startPingCheckTimer(){this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setTimeout(()=>this.pingCheck(),this._pingOnInactivity*1e3):this._pingCheckTimer=void 0}}zs([ly(!1)],Yse.prototype,"_options",void 0);class LB extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},user:{trailing:!0,optional:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get channelId(){return this._tags.get("room-id")}get targetUserId(){var e;return(e=this._tags.get("target-user-id"))!==null&&e!==void 0?e:null}}LB.COMMAND="CLEARCHAT";class Kse extends cn{}Kse.COMMAND="RECONNECT";class UB extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"}})}}UB.COMMAND="ROOMSTATE";function lKe(n){switch(typeof n){case"undefined":return"";case"object":{if(n===null)return"";if("cacheKey"in n)return n.cacheKey;const e=JSON.stringify(n);if(e!=="{}")return e}default:return n.toString()}}function Xse(n,e,t){return[n,...e.map(lKe)].join("/")+(t?"/":"")}const O0=Symbol("cache");function uKe(n){var e,t;return t=class extends n{constructor(){super(...arguments),this[e]=new Map}getFromCache(r){if(this._cleanCache(),this[O0].has(r)){const i=this[O0].get(r);if(i)return i.value}}setCache(r,i,s){this[O0].set(r,{value:i,expires:Date.now()+s*1e3})}removeFromCache(r,i){const s=this._getInternalCacheKey(r,i);i?this[O0].forEach((o,a)=>{a.startsWith(s)&&this[O0].delete(a)}):this[O0].delete(s)}_cleanCache(){const r=Date.now();this[O0].forEach((i,s)=>{i.expires<r&&this[O0].delete(s)})}_getInternalCacheKey(r,i){if(typeof r=="string"){let s=r;return s.endsWith("/")||(s+="/"),s}else{const s=r.shift();return Xse(s,r,i)}}},e=O0,t}function Zse(n=1/0){return function(e,t,r){if(r.get){const i=r.get;r.get=function(){const s=Xse(t,[]),o=this.getFromCache(s);if(o)return o;const a=i.call(this);return this.setCache(s,a,n),a}}return r}}var uM;let Xv=uM=class{constructor(e,t){this._userName=e.toLowerCase(),this._userData=t?new Map(t):new Map}static _parseBadgesLike(e){return e?new Map(e.split(",").map(t=>{const r=t.indexOf("/");return r===-1?[t,""]:[t.slice(0,r),t.slice(r+1)]})):new Map}get userName(){return this._userName}get displayName(){var e;return(e=this._userData.get("display-name"))!==null&&e!==void 0?e:this._userName}get color(){return this._userData.get("color")}get badges(){const e=this._userData.get("badges");return uM._parseBadgesLike(e)}get badgeInfo(){const e=this._userData.get("badge-info");return uM._parseBadgesLike(e)}get userId(){return this._userData.get("user-id")}get userType(){return this._userData.get("user-type")}get isBroadcaster(){return this.badges.has("broadcaster")}get isSubscriber(){return this.badges.has("subscriber")||this.isFounder}get isFounder(){return this.badges.has("founder")}get isMod(){return this.badges.has("moderator")}get isVip(){const e=this._userData.get("vip");return e!=null&&e!=="0"}get isArtist(){return this.badges.has("artist-badge")}};zs([ly(!1)],Xv.prototype,"_userData",void 0);zs([Zse()],Xv.prototype,"badges",null);zs([Zse()],Xv.prototype,"badgeInfo",null);Xv=uM=zs([uKe,AB("chat","ChatUser","userId")],Xv);function BB(n){return n?new Map(n.split("/").map(e=>{const[t,r]=e.split(":",2);return r?[t,r.split(",")]:null}).filter(e=>e!==null)):new Map}class FB extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},text:{trailing:!0,optional:!0}})}get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new Xv(this._tags.get("login"),this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get emoteOffsets(){return BB(this._tags.get("emotes"))}}FB.COMMAND="USERNOTICE";class Jse extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"}})}}Jse.COMMAND="USERSTATE";class jB extends cn{constructor(e,t,r){super(e,t,r,{target:{},text:{trailing:!0}})}get userInfo(){return new Xv(this._prefix.nick,this._tags)}get emoteOffsets(){return BB(this._tags.get("emotes"))}}jB.COMMAND="WHISPER";const hKe={name:"twitch.tv/commands",messageTypes:[LB,Kse,UB,FB,Jse,jB]},fKe={name:"twitch.tv/membership"};class zB extends cn{constructor(e,t,r){super(e,t,r,{channel:{type:"channel"},text:{trailing:!0}})}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userName(){return this._tags.get("login")}get channelId(){return this._tags.get("room-id")}get targetMessageId(){return this._tags.get("target-msg-id")}}zB.COMMAND="CLEARMSG";class Qse extends cn{}Qse.COMMAND="GLOBALUSERSTATE";const dKe={name:"twitch.tv/tags",messageTypes:[Qse,zB]},pKe=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE","TEN"];let XI=class extends WA{get id(){return this._tags.get("id")}get date(){const e=this._tags.get("tmi-sent-ts");return new Date(Number(e))}get userInfo(){return new Xv(this._prefix.nick,this._tags)}get channelId(){var e;return(e=this._tags.get("room-id"))!==null&&e!==void 0?e:null}get isCheer(){return this._tags.has("bits")}get isRedemption(){return!!this._tags.get("custom-reward-id")}get rewardId(){return this._tags.get("custom-reward-id")||null}get isFirst(){return this._tags.get("first-msg")==="1"}get isReturningChatter(){return this._tags.get("returning-chatter")==="1"}get isHighlight(){return this._tags.get("msg-id")==="highlighted-message"}get isReply(){return this._tags.has("reply-parent-msg-id")}get parentMessageId(){var e;return(e=this._tags.get("reply-parent-msg-id"))!==null&&e!==void 0?e:null}get parentMessageText(){var e;return(e=this._tags.get("reply-parent-msg-body"))!==null&&e!==void 0?e:null}get parentMessageUserId(){var e;return(e=this._tags.get("reply-parent-user-id"))!==null&&e!==void 0?e:null}get parentMessageUserName(){var e;return(e=this._tags.get("reply-parent-user-login"))!==null&&e!==void 0?e:null}get parentMessageUserDisplayName(){var e;return(e=this._tags.get("reply-parent-display-name"))!==null&&e!==void 0?e:null}get threadMessageId(){var e;return(e=this._tags.get("reply-thread-parent-msg-id"))!==null&&e!==void 0?e:null}get threadMessageUserId(){var e;return(e=this._tags.get("reply-thread-parent-user-id"))!==null&&e!==void 0?e:null}get bits(){var e;return Number((e=this._tags.get("bits"))!==null&&e!==void 0?e:0)}get emoteOffsets(){return BB(this._tags.get("emotes"))}get isHypeChat(){return this._tags.has("pinned-chat-paid-amount")}get hypeChatAmount(){return $A(this._tags.get("pinned-chat-paid-amount"),Number)}get hypeChatDecimalPlaces(){return $A(this._tags.get("pinned-chat-paid-exponent"),Number)}get hypeChatLocalizedAmount(){const e=this.hypeChatAmount;return e?e/10**this.hypeChatDecimalPlaces:null}get hypeChatCurrency(){var e;return(e=this._tags.get("pinned-chat-paid-currency"))!==null&&e!==void 0?e:null}get hypeChatLevel(){const e=this._tags.get("pinned-chat-paid-level");return e?pKe.indexOf(e)+1:null}get hypeChatIsSystemMessage(){const e=this._tags.get("pinned-chat-paid-is-system-message");return e?!!Number(e):null}};XI=zs([AB("chat","ChatMessage","id")],XI);function mKe(n){return n instanceof XI?n.tags.get("id"):n}function zG(n,e){if(n.length<=e)return[n];n=n.trim();const t=[];let r=0,i=e;for(;r<n.length;){let s=n.lastIndexOf(" ",i);(s===-1||s<=r||n.length-r+1<=e)&&(s=r+e);const o=n.slice(r,s).trim();o.length&&t.push(o),r=s+(n[s]===" "?1:0),i=r+e}return t}const gKe=/^[a-z0-9][a-z0-9_]{0,24}$/;function ic(n){const e=n.replace(/^#/,"").toLowerCase();if(!gKe.test(e))throw new Error(`"${e}" is not a valid user or channel name. It must be at most 25 characters long, can only include letters, numbers and underscores, and can not start with an underscore.`);return e}function Sk(n){return`#${ic(n)}`}var e5;let ZI=e5=class extends YC{constructor(e={}){var t,r,i,s,o,a,c;if(e.authProvider&&!e.authProvider.getAccessTokenForIntent)throw new cM("You can not connect to chat using an AuthProvider that does not support intents.\nTo get an anonymous, read-only connection, please don't pass an `AuthProvider` at all.\nTo get a read-write connection, please provide an auth provider that provides user access tokens via intents, such as `RefreshingAuthProvider`.");super(),this._authVerified=!1,this._authRetryCount=0,this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onTimeout=this.registerEvent(),this.onBan=this.registerEvent(),this.onBitsBadgeUpgrade=this.registerEvent(),this.onChatClear=this.registerEvent(),this.onEmoteOnly=this.registerEvent(),this.onFollowersOnly=this.registerEvent(),this.onJoin=this.registerEvent(),this.onJoinFailure=this.registerEvent(),this.onPart=this.registerEvent(),this.onMessageRemove=this.registerEvent(),this.onUniqueChat=this.registerEvent(),this.onRaid=this.registerEvent(),this.onRaidCancel=this.registerEvent(),this.onRitual=this.registerEvent(),this.onSlow=this.registerEvent(),this.onSubsOnly=this.registerEvent(),this.onSub=this.registerEvent(),this.onResub=this.registerEvent(),this.onSubGift=this.registerEvent(),this.onCommunitySub=this.registerEvent(),this.onSubExtend=this.registerEvent(),this.onRewardGift=this.registerEvent(),this.onPrimePaidUpgrade=this.registerEvent(),this.onGiftPaidUpgrade=this.registerEvent(),this.onPrimeCommunityGift=this.registerEvent(),this.onStandardPayForward=this.registerEvent(),this.onCommunityPayForward=this.registerEvent(),this.onAnnouncement=this.registerEvent(),this.onWhisper=this.registerEvent(),this.onNoPermission=this.registerEvent(),this.onMessageRatelimit=this.registerEvent(),this.onAuthenticationSuccess=this.registerEvent(),this.onAuthenticationFailure=this.registerEvent(),this.onTokenFetchFailure=this.registerEvent(),this.onMessageFailed=this.registerEvent(),this.onMessage=this.registerEvent(),this.onAction=this.registerEvent(),this._onJoinResult=this.registerInternalEvent(),this._ircClient=new Yse({connection:{hostName:(t=e.hostName)!==null&&t!==void 0?t:!((r=e.webSocket)!==null&&r!==void 0)||r?"irc-ws.chat.twitch.tv":"irc.chat.twitch.tv",secure:(i=e.ssl)!==null&&i!==void 0?i:!0},credentials:{nick:"",password:async()=>await this._getAuthToken()},webSocket:(s=e.webSocket)!==null&&s!==void 0?s:!0,connectionOptions:e.connectionOptions,logger:{name:"twurple:chat:irc",...e.logger},nonConformingCommands:["004"],manuallyAcknowledgeJoins:!0,rejoinChannelsOnReconnect:e.rejoinChannelsOnReconnect}),this._ircClient.onDisconnect((l,u)=>{var h,f,d,p;(h=this._messageRateLimiter)===null||h===void 0||h.clear(),(f=this._messageRateLimiter)===null||f===void 0||f.pause(),(d=this._joinRateLimiter)===null||d===void 0||d.clear(),(p=this._joinRateLimiter)===null||p===void 0||p.pause(),this.emit(this.onDisconnect,l,u)}),this._ircClient.registerMessageType(XI),this._chatLogger=F3({name:"twurple:chat:twitch",...e.logger}),this._authProvider=e.authProvider,this._useLegacyScopes=!!e.legacyScopes,this._readOnly=!!e.readOnly,this._authIntents=[...(o=e.authIntents)!==null&&o!==void 0?o:[],"chat"],this._isAlwaysMod=(a=e.isAlwaysMod)!==null&&a!==void 0?a:!1,this._botLevel=(c=e.botLevel)!==null&&c!==void 0?c:"none",this._ircClient.addCapability(dKe),this._ircClient.addCapability(hKe),e.requestMembershipEvents&&this._ircClient.addCapability(fKe),this._ircClient.onConnect(()=>{this.emit(this.onConnect)}),this._ircClient.onRegister(async()=>{var l,u;(l=this._messageRateLimiter)===null||l===void 0||l.resume(),(u=this._joinRateLimiter)===null||u===void 0||u.resume(),this._authVerified=!0,this._authRetryTimer=void 0,this._authRetryCount=0,this.emit(this.onAuthenticationSuccess);const h=await Y4(e.channels);h&&await Promise.all(h.map(async f=>{var d;try{await this.join(f)}catch(p){this._chatLogger.warn(`Failed to join configured channel ${f}; original message: ${(d=p?.message)!==null&&d!==void 0?d:p}`)}}))}),this._ircClient.onPasswordError(l=>{this._chatLogger.error(`Error fetching a token for connecting to the server: ${l.message}`),this.emit(this.onTokenFetchFailure,l)}),this._ircClient.onPrivmsg((l,u,h,f)=>{u!=="jtv"&&this.emit(this.onMessage,ic(l),u,h,f)}),this._ircClient.onAction((l,u,h,f)=>{this.emit(this.onAction,ic(l),u,h,f)}),this.addInternalListener(this._onJoinResult,(l,u,h)=>{h?this.emit(this.onJoinFailure,ic(l),h):this._ircClient.acknowledgeJoin(l)}),this._ircClient.onTypedMessage(LB,l=>{const{channel:u,user:h,tags:f}=l,d=ic(u);if(h){const p=f.get("ban-duration");p===void 0?this.emit(this.onBan,d,h,l):this.emit(this.onTimeout,d,h,Number(p),l)}else this.emit(this.onChatClear,d,l)}),this._ircClient.onTypedMessage(zB,l=>{const{channel:u,targetMessageId:h}=l;this.emit(this.onMessageRemove,ic(u),h,l)}),this._ircClient.onTypedMessage(HA,({prefix:l,channel:u})=>{this.emit(this.onJoin,ic(u),l.nick)}),this._ircClient.onTypedMessage(GA,({prefix:l,channel:u})=>{this.emit(this.onPart,ic(u),l.nick)}),this._ircClient.onTypedMessage(UB,({channel:l,tags:u})=>{let h=!1;if(u.has("subs-only")&&u.has("slow")&&(this.emit(this._onJoinResult,l,u),h=!0),!h){const f=ic(l);if(u.has("slow")){const d=Number(u.get("slow"));d?this.emit(this.onSlow,f,!0,d):this.emit(this.onSlow,f,!1)}if(u.has("followers-only")){const d=Number(u.get("followers-only"));d===-1?this.emit(this.onFollowersOnly,f,!1):this.emit(this.onFollowersOnly,f,!0,d)}}}),this._ircClient.onTypedMessage(FB,l=>{const{channel:u,text:h,tags:f}=l,d=f.get("msg-id"),p=ic(u);switch(d){case"sub":case"resub":{const m=d==="sub"?this.onSub:this.onResub,_=f.get("msg-param-sub-plan"),v=f.get("msg-param-streak-months"),S={userId:f.get("user-id"),displayName:f.get("display-name"),plan:_,planName:f.get("msg-param-sub-plan-name"),isPrime:_==="Prime",months:Number(f.get("msg-param-cumulative-months")),streak:v?Number(v):void 0,message:h};if(f.get("msg-param-was-gifted")==="true"){const T=f.get("msg-param-anon-gift")==="true",w=Number(f.get("msg-param-gift-months")),R=Number(f.get("msg-param-gift-month-being-redeemed"));T?S.originalGiftInfo={anonymous:!0,duration:w,redeemedMonth:R}:S.originalGiftInfo={anonymous:!1,duration:w,redeemedMonth:R,userId:f.get("msg-param-gifter-id"),userName:f.get("msg-param-gifter-login"),userDisplayName:f.get("msg-param-gifter-name")}}this.emit(m,p,f.get("login"),S,l);break}case"subgift":{const m=f.get("msg-param-sub-plan"),_=f.get("login"),v=_==="ananonymousgifter",S={userId:f.get("msg-param-recipient-id"),displayName:f.get("msg-param-recipient-display-name"),gifter:v?void 0:_,gifterUserId:v?void 0:f.get("user-id"),gifterDisplayName:v?void 0:f.get("display-name"),gifterGiftCount:v?void 0:Number(f.get("msg-param-sender-count")),giftDuration:Number(f.get("msg-param-gift-months")),plan:m,planName:f.get("msg-param-sub-plan-name"),isPrime:m==="Prime",months:Number(f.get("msg-param-months"))};this.emit(this.onSubGift,p,f.get("msg-param-recipient-user-name"),S,l);break}case"submysterygift":{const m=f.get("login"),_=m==="ananonymousgifter",v={gifter:_?void 0:m,gifterUserId:_?void 0:f.get("user-id"),gifterDisplayName:_?void 0:f.get("display-name"),gifterGiftCount:_?void 0:Number(f.get("msg-param-sender-count")),count:Number(f.get("msg-param-mass-gift-count")),plan:f.get("msg-param-sub-plan")};this.emit(this.onCommunitySub,p,f.get("login"),v,l);break}case"primepaidupgrade":{const m={userId:f.get("user-id"),displayName:f.get("display-name"),plan:f.get("msg-param-sub-plan")};this.emit(this.onPrimePaidUpgrade,p,f.get("login"),m,l);break}case"giftpaidupgrade":{const m={userId:f.get("user-id"),displayName:f.get("display-name"),gifter:f.get("msg-param-sender-login"),gifterDisplayName:f.get("msg-param-sender-name")};this.emit(this.onGiftPaidUpgrade,p,f.get("login"),m,l);break}case"standardpayforward":{const m=f.get("msg-param-prior-gifter-anonymous")==="true",_={userId:f.get("user-id"),displayName:f.get("display-name"),originalGifterUserId:m?void 0:f.get("msg-param-prior-gifter-id"),originalGifterDisplayName:m?void 0:f.get("msg-param-prior-gifter-display-name"),recipientUserId:f.get("msg-param-recipient-id"),recipientDisplayName:f.get("msg-param-recipient-display-name")};this.emit(this.onStandardPayForward,p,f.get("login"),_,l);break}case"communitypayforward":{const m=f.get("msg-param-prior-gifter-anonymous")==="true",_={userId:f.get("user-id"),displayName:f.get("display-name"),originalGifterUserId:m?void 0:f.get("msg-param-prior-gifter-id"),originalGifterDisplayName:m?void 0:f.get("msg-param-prior-gifter-display-name")};this.emit(this.onCommunityPayForward,p,f.get("login"),_,l);break}case"primecommunitygiftreceived":{const m={name:f.get("msg-param-gift-name"),gifter:f.get("login"),gifterDisplayName:f.get("display-name")};this.emit(this.onPrimeCommunityGift,p,f.get("msg-param-recipient"),m,l);break}case"raid":{const m={displayName:f.get("msg-param-displayName"),viewerCount:Number(f.get("msg-param-viewerCount"))};this.emit(this.onRaid,p,f.get("login"),m,l);break}case"unraid":{this.emit(this.onRaidCancel,p,l);break}case"ritual":{const m={ritualName:f.get("msg-param-ritual-name"),message:h};this.emit(this.onRitual,p,f.get("login"),m,l);break}case"bitsbadgetier":{const m={displayName:f.get("display-name"),threshold:Number(f.get("msg-param-threshold"))};this.emit(this.onBitsBadgeUpgrade,p,f.get("login"),m,l);break}case"extendsub":{const m={userId:f.get("user-id"),displayName:f.get("display-name"),plan:f.get("msg-param-sub-plan"),months:Number(f.get("msg-param-cumulative-months")),endMonth:Number(f.get("msg-param-sub-benefit-end-month"))};this.emit(this.onSubExtend,p,f.get("login"),m,l);break}case"rewardgift":{const m={domain:f.get("msg-param-domain"),gifterId:f.get("user-id"),gifterDisplayName:f.get("display-name"),count:Number(f.get("msg-param-selected-count")),gifterGiftCount:Number(f.get("msg-param-total-reward-count")),triggerType:f.get("msg-param-trigger-type")};this.emit(this.onRewardGift,p,f.get("login"),m,l);break}case"announcement":{const m={color:f.get("msg-param-color")};this.emit(this.onAnnouncement,p,f.get("login"),m,l);break}default:this._chatLogger.warn(`Unrecognized usernotice ID: ${d}`)}}),this._ircClient.onTypedMessage(jB,l=>{this.emit(this.onWhisper,l.prefix.nick,l.text,l)}),this._ircClient.onTypedMessage(z3,async({target:l,text:u,tags:h})=>{const f=h.get("msg-id");switch(f){case"emote_only_on":{this.emit(this.onEmoteOnly,ic(l),!0);break}case"emote_only_off":{this.emit(this.onEmoteOnly,ic(l),!1);break}case"msg_channel_suspended":case"msg_banned":{this.emit(this._onJoinResult,l,void 0,f);break}case"r9k_on":{this.emit(this.onUniqueChat,ic(l),!0);break}case"r9k_off":{this.emit(this.onUniqueChat,ic(l),!1);break}case"subs_on":{this.emit(this.onSubsOnly,ic(l),!0);break}case"subs_off":{this.emit(this.onSubsOnly,ic(l),!1);break}case"cmds_available":break;case"followers_on":case"followers_on_zero":case"followers_off":case"slow_on":case"slow_off":break;case"timeout_success":break;case"unrecognized_cmd":break;case"no_permission":{this.emit(this.onNoPermission,ic(l),u);break}case"msg_ratelimit":{this.emit(this.onMessageRatelimit,ic(l),u);break}case"msg_duplicate":case"msg_emoteonly":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_subsonly":case"msg_slowmode":case"msg_r9k":case"msg_verified_email":case"msg_timedout":case"msg_rejected_mandatory":case"msg_channel_blocked":{this.emit(this.onMessageFailed,ic(l),f);break}case void 0:{if(u==="Login authentication failed"||u==="Improperly formatted AUTH"||u==="Invalid NICK"){this._authVerified=!1,this._authRetryTimer||(this._authRetryTimer=hie(120),this._authRetryCount=0);const d=this._authRetryTimer.next().value,p=++this._authRetryCount;this.emit(this.onAuthenticationFailure,u,p),d!==0&&this._chatLogger.info(`Retrying authentication in ${d} seconds`),await sYe(d*1e3),this._ircClient.reconnect()}break}default:f.startsWith("usage_")||this._chatLogger.warn(`Unrecognized notice ID: '${f}'`)}})}connect(){this._authProvider||this._ircClient.changeNick(e5._generateJustinfanNick()),this._initializeRateLimiters(),this._ircClient.connect()}get irc(){return this._ircClient}get isConnected(){return this._ircClient.isConnected}get isConnecting(){return this._ircClient.isConnecting}get currentChannels(){return this._ircClient.currentChannels}async say(e,t,r={},i){const s={};r.replyTo&&(s["reply-parent-msg-id"]=mKe(r.replyTo));const o=zG(t,500);await Promise.all(o.map(async a=>await this._messageRateLimiter.request({type:"say",channel:Sk(e),text:a,tags:s},i)))}async action(e,t,r){const i=zG(t,490);await Promise.all(i.map(async s=>await this._messageRateLimiter.request({type:"action",channel:Sk(e),text:s},r)))}async join(e){await this._joinRateLimiter.request(Sk(e))}part(e){this._ircClient.part(Sk(e))}quit(){var e,t,r,i;(t=(e=this._messageRateLimiter)===null||e===void 0?void 0:e.destroy)===null||t===void 0||t.call(e),(i=(r=this._joinRateLimiter)===null||r===void 0?void 0:r.destroy)===null||i===void 0||i.call(r),this._messageRateLimiter=void 0,this._joinRateLimiter=void 0,this._ircClient.quitAbruptly()}reconnect(){this.quit(),this.connect()}async _getAuthToken(){var e,t;if(!this._authProvider){this._chatLogger.debug("No authProvider given; connecting anonymously");return}if(this._authToken&&!aM(this._authToken)&&this._authVerified)return this._chatLogger.debug("AccessToken assumed to be correct from last connection"),`oauth:${this._authToken.accessToken}`;const r=this._getNecessaryScopes();let i,s=!1;for(const o of this._authIntents){try{if(this._authToken=await this._authProvider.getAccessTokenForIntent(o,r),!this._authToken)continue;s=!0;const a=await VA(this._authToken.accessToken);if(!a.userName)throw new cM("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}catch(a){a instanceof YE?i=a:this._chatLogger.error(`Retrieving an access token failed: ${a.message}`)}this._chatLogger.warn("No valid token available; trying to refresh");try{if(this._authToken=await((t=(e=this._authProvider).refreshAccessTokenForIntent)===null||t===void 0?void 0:t.call(e,o)),this._authToken){const a=await VA(this._authToken.accessToken);if(!a.userName)throw new cM("Could not determine a user name for your token; you might be trying to disguise an app token as a user token.");return this._ircClient.changeNick(a.userName),`oauth:${this._authToken.accessToken}`}}catch(a){a instanceof YE?i=a:this._chatLogger.error(`Refreshing the access token failed: ${a.message}`)}}throw this._authVerified=!1,i??new Error(s?"Could not retrieve a valid token":`None of the queried intents (${this._authIntents.join(", ")}) are known by the auth provider${this._authProvider instanceof Kv?".\nPlease add one of these to the user you want to connect with using the `addIntentToUser` method or the additional parameter to `addUser` or `addUserForToken`.":""}`)}_getNecessaryScopes(){return this._useLegacyScopes?["chat_login"]:this._readOnly?["chat:read"]:["chat:read","chat:edit"]}static _generateJustinfanNick(){return`justinfan${Math.floor(Math.random()*1e5).toString().padStart(5,"0")}`}_initializeRateLimiters(){const e=async({type:r,text:i,channel:s,tags:o})=>{r==="say"?this._ircClient.say(s,i,o):this._ircClient.action(s,i)},t=async r=>{const{promise:i,resolve:s,reject:o}=X4();let a;const c=this.addInternalListener(this._onJoinResult,(l,u,h)=>{l===r&&(clearTimeout(a),h?o(h):s(),this.removeListener(c))});a=setTimeout(()=>{this.removeListener(c),this.emit(this._onJoinResult,r,void 0,"twurple_timeout"),o(new Error(`Did not receive a reply to join ${r} in time; assuming that the join failed`))},1e4),this._ircClient.join(r),await i};if(this._isAlwaysMod)this._messageRateLimiter=new Z4({bucketSize:this._botLevel==="verified"?7500:100,timeFrame:32e3,doRequest:e});else{let r=20;this._botLevel==="verified"?r=7500:this._botLevel==="known"&&(r=50),this._messageRateLimiter=new _Ye(new gYe({bucketSize:1,timeFrame:1200,logger:{minLevel:Ar.ERROR},doRequest:e,getPartitionKey:({channel:i})=>i}),{bucketSize:r,timeFrame:32e3})}this._joinRateLimiter=new Z4({bucketSize:this._botLevel==="verified"?2e3:20,timeFrame:11e3,doRequest:t}),this._messageRateLimiter.pause(),this._joinRateLimiter.pause()}};zs([ly(!1)],ZI.prototype,"_authProvider",void 0);ZI=e5=zs([AB("chat","ChatClient")],ZI);var ED={exports:{}},$G;function _Ke(){return $G||($G=1,(function(n,e){(function(t,r){n.exports=r()})(self,(()=>(()=>{var t={2505:(o,a,c)=>{o.exports=c(8015)},5592:(o,a,c)=>{var l=c(9516),u=c(7522),h=c(3948),f=c(9106),d=c(9615),p=c(2012),m=c(4202),_=c(4896),v=c(5845),S=c(8563),b=c(5656);o.exports=function(T){return new Promise((function(w,R){var C,N=T.data,U=T.headers,B=T.responseType;function $(){T.cancelToken&&T.cancelToken.unsubscribe(C),T.signal&&T.signal.removeEventListener("abort",C)}l.isFormData(N)&&l.isStandardBrowserEnv()&&delete U["Content-Type"];var I=new XMLHttpRequest;if(T.auth){var L=T.auth.username||"",P=T.auth.password?unescape(encodeURIComponent(T.auth.password)):"";U.Authorization="Basic "+btoa(L+":"+P)}var H=d(T.baseURL,T.url);function X(){if(I){var J="getAllResponseHeaders"in I?p(I.getAllResponseHeaders()):null,Q={data:B&&B!=="text"&&B!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:J,config:T,request:I};u((function(z){w(z),$()}),(function(z){R(z),$()}),Q),I=null}}if(I.open(T.method.toUpperCase(),f(H,T.params,T.paramsSerializer),!0),I.timeout=T.timeout,"onloadend"in I?I.onloadend=X:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(X)},I.onabort=function(){I&&(R(new v("Request aborted",v.ECONNABORTED,T,I)),I=null)},I.onerror=function(){R(new v("Network Error",v.ERR_NETWORK,T,I,I)),I=null},I.ontimeout=function(){var J=T.timeout?"timeout of "+T.timeout+"ms exceeded":"timeout exceeded",Q=T.transitional||_;T.timeoutErrorMessage&&(J=T.timeoutErrorMessage),R(new v(J,Q.clarifyTimeoutError?v.ETIMEDOUT:v.ECONNABORTED,T,I)),I=null},l.isStandardBrowserEnv()){var G=(T.withCredentials||m(H))&&T.xsrfCookieName?h.read(T.xsrfCookieName):void 0;G&&(U[T.xsrfHeaderName]=G)}"setRequestHeader"in I&&l.forEach(U,(function(J,Q){N===void 0&&Q.toLowerCase()==="content-type"?delete U[Q]:I.setRequestHeader(Q,J)})),l.isUndefined(T.withCredentials)||(I.withCredentials=!!T.withCredentials),B&&B!=="json"&&(I.responseType=T.responseType),typeof T.onDownloadProgress=="function"&&I.addEventListener("progress",T.onDownloadProgress),typeof T.onUploadProgress=="function"&&I.upload&&I.upload.addEventListener("progress",T.onUploadProgress),(T.cancelToken||T.signal)&&(C=function(J){I&&(R(!J||J&&J.type?new S:J),I.abort(),I=null)},T.cancelToken&&T.cancelToken.subscribe(C),T.signal&&(T.signal.aborted?C():T.signal.addEventListener("abort",C))),N||(N=null);var Y=b(H);Y&&["http","https","file"].indexOf(Y)===-1?R(new v("Unsupported protocol "+Y+":",v.ERR_BAD_REQUEST,T)):I.send(N)}))}},8015:(o,a,c)=>{var l=c(9516),u=c(9012),h=c(5155),f=c(5343),d=(function p(m){var _=new h(m),v=u(h.prototype.request,_);return l.extend(v,h.prototype,_),l.extend(v,_),v.create=function(S){return p(f(m,S))},v})(c(7412));d.Axios=h,d.CanceledError=c(8563),d.CancelToken=c(3191),d.isCancel=c(3864),d.VERSION=c(9641).version,d.toFormData=c(6440),d.AxiosError=c(5845),d.Cancel=d.CanceledError,d.all=function(p){return Promise.all(p)},d.spread=c(7980),d.isAxiosError=c(5019),o.exports=d,o.exports.default=d},3191:(o,a,c)=>{var l=c(8563);function u(h){if(typeof h!="function")throw new TypeError("executor must be a function.");var f;this.promise=new Promise((function(p){f=p}));var d=this;this.promise.then((function(p){if(d._listeners){var m,_=d._listeners.length;for(m=0;m<_;m++)d._listeners[m](p);d._listeners=null}})),this.promise.then=function(p){var m,_=new Promise((function(v){d.subscribe(v),m=v})).then(p);return _.cancel=function(){d.unsubscribe(m)},_},h((function(p){d.reason||(d.reason=new l(p),f(d.reason))}))}u.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},u.prototype.subscribe=function(h){this.reason?h(this.reason):this._listeners?this._listeners.push(h):this._listeners=[h]},u.prototype.unsubscribe=function(h){if(this._listeners){var f=this._listeners.indexOf(h);f!==-1&&this._listeners.splice(f,1)}},u.source=function(){var h;return{token:new u((function(f){h=f})),cancel:h}},o.exports=u},8563:(o,a,c)=>{var l=c(5845);function u(h){l.call(this,h??"canceled",l.ERR_CANCELED),this.name="CanceledError"}c(9516).inherits(u,l,{__CANCEL__:!0}),o.exports=u},3864:o=>{o.exports=function(a){return!(!a||!a.__CANCEL__)}},5155:(o,a,c)=>{var l=c(9516),u=c(9106),h=c(3471),f=c(4490),d=c(5343),p=c(9615),m=c(4841),_=m.validators;function v(S){this.defaults=S,this.interceptors={request:new h,response:new h}}v.prototype.request=function(S,b){typeof S=="string"?(b=b||{}).url=S:b=S||{},(b=d(this.defaults,b)).method?b.method=b.method.toLowerCase():this.defaults.method?b.method=this.defaults.method.toLowerCase():b.method="get";var T=b.transitional;T!==void 0&&m.assertOptions(T,{silentJSONParsing:_.transitional(_.boolean),forcedJSONParsing:_.transitional(_.boolean),clarifyTimeoutError:_.transitional(_.boolean)},!1);var w=[],R=!0;this.interceptors.request.forEach((function(L){typeof L.runWhen=="function"&&L.runWhen(b)===!1||(R=R&&L.synchronous,w.unshift(L.fulfilled,L.rejected))}));var C,N=[];if(this.interceptors.response.forEach((function(L){N.push(L.fulfilled,L.rejected)})),!R){var U=[f,void 0];for(Array.prototype.unshift.apply(U,w),U=U.concat(N),C=Promise.resolve(b);U.length;)C=C.then(U.shift(),U.shift());return C}for(var B=b;w.length;){var $=w.shift(),I=w.shift();try{B=$(B)}catch(L){I(L);break}}try{C=f(B)}catch(L){return Promise.reject(L)}for(;N.length;)C=C.then(N.shift(),N.shift());return C},v.prototype.getUri=function(S){S=d(this.defaults,S);var b=p(S.baseURL,S.url);return u(b,S.params,S.paramsSerializer)},l.forEach(["delete","get","head","options"],(function(S){v.prototype[S]=function(b,T){return this.request(d(T||{},{method:S,url:b,data:(T||{}).data}))}})),l.forEach(["post","put","patch"],(function(S){function b(T){return function(w,R,C){return this.request(d(C||{},{method:S,headers:T?{"Content-Type":"multipart/form-data"}:{},url:w,data:R}))}}v.prototype[S]=b(),v.prototype[S+"Form"]=b(!0)})),o.exports=v},5845:(o,a,c)=>{var l=c(9516);function u(d,p,m,_,v){Error.call(this),this.message=d,this.name="AxiosError",p&&(this.code=p),m&&(this.config=m),_&&(this.request=_),v&&(this.response=v)}l.inherits(u,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var h=u.prototype,f={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(d){f[d]={value:d}})),Object.defineProperties(u,f),Object.defineProperty(h,"isAxiosError",{value:!0}),u.from=function(d,p,m,_,v,S){var b=Object.create(h);return l.toFlatObject(d,b,(function(T){return T!==Error.prototype})),u.call(b,d.message,p,m,_,v),b.name=d.name,S&&Object.assign(b,S),b},o.exports=u},3471:(o,a,c)=>{var l=c(9516);function u(){this.handlers=[]}u.prototype.use=function(h,f,d){return this.handlers.push({fulfilled:h,rejected:f,synchronous:!!d&&d.synchronous,runWhen:d?d.runWhen:null}),this.handlers.length-1},u.prototype.eject=function(h){this.handlers[h]&&(this.handlers[h]=null)},u.prototype.forEach=function(h){l.forEach(this.handlers,(function(f){f!==null&&h(f)}))},o.exports=u},9615:(o,a,c)=>{var l=c(9137),u=c(4680);o.exports=function(h,f){return h&&!l(f)?u(h,f):f}},4490:(o,a,c)=>{var l=c(9516),u=c(2881),h=c(3864),f=c(7412),d=c(8563);function p(m){if(m.cancelToken&&m.cancelToken.throwIfRequested(),m.signal&&m.signal.aborted)throw new d}o.exports=function(m){return p(m),m.headers=m.headers||{},m.data=u.call(m,m.data,m.headers,m.transformRequest),m.headers=l.merge(m.headers.common||{},m.headers[m.method]||{},m.headers),l.forEach(["delete","get","head","post","put","patch","common"],(function(_){delete m.headers[_]})),(m.adapter||f.adapter)(m).then((function(_){return p(m),_.data=u.call(m,_.data,_.headers,m.transformResponse),_}),(function(_){return h(_)||(p(m),_&&_.response&&(_.response.data=u.call(m,_.response.data,_.response.headers,m.transformResponse))),Promise.reject(_)}))}},5343:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){h=h||{};var f={};function d(b,T){return l.isPlainObject(b)&&l.isPlainObject(T)?l.merge(b,T):l.isPlainObject(T)?l.merge({},T):l.isArray(T)?T.slice():T}function p(b){return l.isUndefined(h[b])?l.isUndefined(u[b])?void 0:d(void 0,u[b]):d(u[b],h[b])}function m(b){if(!l.isUndefined(h[b]))return d(void 0,h[b])}function _(b){return l.isUndefined(h[b])?l.isUndefined(u[b])?void 0:d(void 0,u[b]):d(void 0,h[b])}function v(b){return b in h?d(u[b],h[b]):b in u?d(void 0,u[b]):void 0}var S={url:m,method:m,data:m,baseURL:_,transformRequest:_,transformResponse:_,paramsSerializer:_,timeout:_,timeoutMessage:_,withCredentials:_,adapter:_,responseType:_,xsrfCookieName:_,xsrfHeaderName:_,onUploadProgress:_,onDownloadProgress:_,decompress:_,maxContentLength:_,maxBodyLength:_,beforeRedirect:_,transport:_,httpAgent:_,httpsAgent:_,cancelToken:_,socketPath:_,responseEncoding:_,validateStatus:v};return l.forEach(Object.keys(u).concat(Object.keys(h)),(function(b){var T=S[b]||p,w=T(b);l.isUndefined(w)&&T!==v||(f[b]=w)})),f}},7522:(o,a,c)=>{var l=c(5845);o.exports=function(u,h,f){var d=f.config.validateStatus;f.status&&d&&!d(f.status)?h(new l("Request failed with status code "+f.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(f.status/100)-4],f.config,f.request,f)):u(f)}},2881:(o,a,c)=>{var l=c(9516),u=c(7412);o.exports=function(h,f,d){var p=this||u;return l.forEach(d,(function(m){h=m.call(p,h,f)})),h}},7412:(o,a,c)=>{var l=c(9516),u=c(7018),h=c(5845),f=c(4896),d=c(6440),p={"Content-Type":"application/x-www-form-urlencoded"};function m(S,b){!l.isUndefined(S)&&l.isUndefined(S["Content-Type"])&&(S["Content-Type"]=b)}var _,v={transitional:f,adapter:((typeof XMLHttpRequest<"u"||typeof Ga<"u"&&Object.prototype.toString.call(Ga)==="[object process]")&&(_=c(5592)),_),transformRequest:[function(S,b){if(u(b,"Accept"),u(b,"Content-Type"),l.isFormData(S)||l.isArrayBuffer(S)||l.isBuffer(S)||l.isStream(S)||l.isFile(S)||l.isBlob(S))return S;if(l.isArrayBufferView(S))return S.buffer;if(l.isURLSearchParams(S))return m(b,"application/x-www-form-urlencoded;charset=utf-8"),S.toString();var T,w=l.isObject(S),R=b&&b["Content-Type"];if((T=l.isFileList(S))||w&&R==="multipart/form-data"){var C=this.env&&this.env.FormData;return d(T?{"files[]":S}:S,C&&new C)}return w||R==="application/json"?(m(b,"application/json"),(function(N,U,B){if(l.isString(N))try{return(U||JSON.parse)(N),l.trim(N)}catch($){if($.name!=="SyntaxError")throw $}return(B||JSON.stringify)(N)})(S)):S}],transformResponse:[function(S){var b=this.transitional||v.transitional,T=b&&b.silentJSONParsing,w=b&&b.forcedJSONParsing,R=!T&&this.responseType==="json";if(R||w&&l.isString(S)&&S.length)try{return JSON.parse(S)}catch(C){if(R)throw C.name==="SyntaxError"?h.from(C,h.ERR_BAD_RESPONSE,this,null,this.response):C}return S}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c(1534)},validateStatus:function(S){return S>=200&&S<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};l.forEach(["delete","get","head"],(function(S){v.headers[S]={}})),l.forEach(["post","put","patch"],(function(S){v.headers[S]=l.merge(p)})),o.exports=v},4896:o=>{o.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},9641:o=>{o.exports={version:"0.27.2"}},9012:o=>{o.exports=function(a,c){return function(){for(var l=new Array(arguments.length),u=0;u<l.length;u++)l[u]=arguments[u];return a.apply(c,l)}}},9106:(o,a,c)=>{var l=c(9516);function u(h){return encodeURIComponent(h).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}o.exports=function(h,f,d){if(!f)return h;var p;if(d)p=d(f);else if(l.isURLSearchParams(f))p=f.toString();else{var m=[];l.forEach(f,(function(v,S){v!=null&&(l.isArray(v)?S+="[]":v=[v],l.forEach(v,(function(b){l.isDate(b)?b=b.toISOString():l.isObject(b)&&(b=JSON.stringify(b)),m.push(u(S)+"="+u(b))})))})),p=m.join("&")}if(p){var _=h.indexOf("#");_!==-1&&(h=h.slice(0,_)),h+=(h.indexOf("?")===-1?"?":"&")+p}return h}},4680:o=>{o.exports=function(a,c){return c?a.replace(/\/+$/,"")+"/"+c.replace(/^\/+/,""):a}},3948:(o,a,c)=>{var l=c(9516);o.exports=l.isStandardBrowserEnv()?{write:function(u,h,f,d,p,m){var _=[];_.push(u+"="+encodeURIComponent(h)),l.isNumber(f)&&_.push("expires="+new Date(f).toGMTString()),l.isString(d)&&_.push("path="+d),l.isString(p)&&_.push("domain="+p),m===!0&&_.push("secure"),document.cookie=_.join("; ")},read:function(u){var h=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},9137:o=>{o.exports=function(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}},5019:(o,a,c)=>{var l=c(9516);o.exports=function(u){return l.isObject(u)&&u.isAxiosError===!0}},4202:(o,a,c)=>{var l=c(9516);o.exports=l.isStandardBrowserEnv()?(function(){var u,h=/(msie|trident)/i.test(navigator.userAgent),f=document.createElement("a");function d(p){var m=p;return h&&(f.setAttribute("href",m),m=f.href),f.setAttribute("href",m),{href:f.href,protocol:f.protocol?f.protocol.replace(/:$/,""):"",host:f.host,search:f.search?f.search.replace(/^\?/,""):"",hash:f.hash?f.hash.replace(/^#/,""):"",hostname:f.hostname,port:f.port,pathname:f.pathname.charAt(0)==="/"?f.pathname:"/"+f.pathname}}return u=d(window.location.href),function(p){var m=l.isString(p)?d(p):p;return m.protocol===u.protocol&&m.host===u.host}})():function(){return!0}},7018:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){l.forEach(u,(function(f,d){d!==h&&d.toUpperCase()===h.toUpperCase()&&(u[h]=f,delete u[d])}))}},1534:o=>{o.exports=null},2012:(o,a,c)=>{var l=c(9516),u=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];o.exports=function(h){var f,d,p,m={};return h&&l.forEach(h.split(`
`),(function(_){if(p=_.indexOf(":"),f=l.trim(_.substr(0,p)).toLowerCase(),d=l.trim(_.substr(p+1)),f){if(m[f]&&u.indexOf(f)>=0)return;m[f]=f==="set-cookie"?(m[f]?m[f]:[]).concat([d]):m[f]?m[f]+", "+d:d}})),m}},5656:o=>{o.exports=function(a){var c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return c&&c[1]||""}},7980:o=>{o.exports=function(a){return function(c){return a.apply(null,c)}}},6440:(o,a,c)=>{var l=c(9516);o.exports=function(u,h){h=h||new FormData;var f=[];function d(p){return p===null?"":l.isDate(p)?p.toISOString():l.isArrayBuffer(p)||l.isTypedArray(p)?typeof Blob=="function"?new Blob([p]):io.from(p):p}return(function p(m,_){if(l.isPlainObject(m)||l.isArray(m)){if(f.indexOf(m)!==-1)throw Error("Circular reference detected in "+_);f.push(m),l.forEach(m,(function(v,S){if(!l.isUndefined(v)){var b,T=_?_+"."+S:S;if(v&&!_&&typeof v=="object"){if(l.endsWith(S,"{}"))v=JSON.stringify(v);else if(l.endsWith(S,"[]")&&(b=l.toArray(v)))return void b.forEach((function(w){!l.isUndefined(w)&&h.append(T,d(w))}))}p(v,T)}})),f.pop()}else h.append(_,d(m))})(u),h}},4841:(o,a,c)=>{var l=c(9641).version,u=c(5845),h={};["object","boolean","number","function","string","symbol"].forEach((function(d,p){h[d]=function(m){return typeof m===d||"a"+(p<1?"n ":" ")+d}}));var f={};h.transitional=function(d,p,m){function _(v,S){return"[Axios v"+l+"] Transitional option '"+v+"'"+S+(m?". "+m:"")}return function(v,S,b){if(d===!1)throw new u(_(S," has been removed"+(p?" in "+p:"")),u.ERR_DEPRECATED);return p&&!f[S]&&(f[S]=!0,console.warn(_(S," has been deprecated since v"+p+" and will be removed in the near future"))),!d||d(v,S,b)}},o.exports={assertOptions:function(d,p,m){if(typeof d!="object")throw new u("options must be an object",u.ERR_BAD_OPTION_VALUE);for(var _=Object.keys(d),v=_.length;v-- >0;){var S=_[v],b=p[S];if(b){var T=d[S],w=T===void 0||b(T,S,d);if(w!==!0)throw new u("option "+S+" must be "+w,u.ERR_BAD_OPTION_VALUE)}else if(m!==!0)throw new u("Unknown option "+S,u.ERR_BAD_OPTION)}},validators:h}},9516:(o,a,c)=>{var l,u=c(9012),h=Object.prototype.toString,f=(l=Object.create(null),function(I){var L=h.call(I);return l[L]||(l[L]=L.slice(8,-1).toLowerCase())});function d(I){return I=I.toLowerCase(),function(L){return f(L)===I}}function p(I){return Array.isArray(I)}function m(I){return I===void 0}var _=d("ArrayBuffer");function v(I){return I!==null&&typeof I=="object"}function S(I){if(f(I)!=="object")return!1;var L=Object.getPrototypeOf(I);return L===null||L===Object.prototype}var b=d("Date"),T=d("File"),w=d("Blob"),R=d("FileList");function C(I){return h.call(I)==="[object Function]"}var N=d("URLSearchParams");function U(I,L){if(I!=null)if(typeof I!="object"&&(I=[I]),p(I))for(var P=0,H=I.length;P<H;P++)L.call(null,I[P],P,I);else for(var X in I)Object.prototype.hasOwnProperty.call(I,X)&&L.call(null,I[X],X,I)}var B,$=(B=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(I){return B&&I instanceof B});o.exports={isArray:p,isArrayBuffer:_,isBuffer:function(I){return I!==null&&!m(I)&&I.constructor!==null&&!m(I.constructor)&&typeof I.constructor.isBuffer=="function"&&I.constructor.isBuffer(I)},isFormData:function(I){var L="[object FormData]";return I&&(typeof FormData=="function"&&I instanceof FormData||h.call(I)===L||C(I.toString)&&I.toString()===L)},isArrayBufferView:function(I){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(I):I&&I.buffer&&_(I.buffer)},isString:function(I){return typeof I=="string"},isNumber:function(I){return typeof I=="number"},isObject:v,isPlainObject:S,isUndefined:m,isDate:b,isFile:T,isBlob:w,isFunction:C,isStream:function(I){return v(I)&&C(I.pipe)},isURLSearchParams:N,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:U,merge:function I(){var L={};function P(G,Y){S(L[Y])&&S(G)?L[Y]=I(L[Y],G):S(G)?L[Y]=I({},G):p(G)?L[Y]=G.slice():L[Y]=G}for(var H=0,X=arguments.length;H<X;H++)U(arguments[H],P);return L},extend:function(I,L,P){return U(L,(function(H,X){I[X]=P&&typeof H=="function"?u(H,P):H})),I},trim:function(I){return I.trim?I.trim():I.replace(/^\s+|\s+$/g,"")},stripBOM:function(I){return I.charCodeAt(0)===65279&&(I=I.slice(1)),I},inherits:function(I,L,P,H){I.prototype=Object.create(L.prototype,H),I.prototype.constructor=I,P&&Object.assign(I.prototype,P)},toFlatObject:function(I,L,P){var H,X,G,Y={};L=L||{};do{for(X=(H=Object.getOwnPropertyNames(I)).length;X-- >0;)Y[G=H[X]]||(L[G]=I[G],Y[G]=!0);I=Object.getPrototypeOf(I)}while(I&&(!P||P(I,L))&&I!==Object.prototype);return L},kindOf:f,kindOfTest:d,endsWith:function(I,L,P){I=String(I),(P===void 0||P>I.length)&&(P=I.length),P-=L.length;var H=I.indexOf(L,P);return H!==-1&&H===P},toArray:function(I){if(!I)return null;var L=I.length;if(m(L))return null;for(var P=new Array(L);L-- >0;)P[L]=I[L];return P},isTypedArray:$,isFileList:R}},6880:function(o){o.exports=(function(a){var c={};function l(u){if(c[u])return c[u].exports;var h=c[u]={i:u,l:!1,exports:{}};return a[u].call(h.exports,h,h.exports,l),h.l=!0,h.exports}return l.m=a,l.c=c,l.d=function(u,h,f){l.o(u,h)||Object.defineProperty(u,h,{enumerable:!0,get:f})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,h){if(1&h&&(u=l(u)),8&h||4&h&&typeof u=="object"&&u&&u.__esModule)return u;var f=Object.create(null);if(l.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:u}),2&h&&typeof u!="string")for(var d in u)l.d(f,d,(function(p){return u[p]}).bind(null,d));return f},l.n=function(u){var h=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(h,"a",h),h},l.o=function(u,h){return Object.prototype.hasOwnProperty.call(u,h)},l.p="",l(l.s=90)})({17:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=l(18),h=(function(){function f(){}return f.getFirstMatch=function(d,p){var m=p.match(d);return m&&m.length>0&&m[1]||""},f.getSecondMatch=function(d,p){var m=p.match(d);return m&&m.length>1&&m[2]||""},f.matchAndReturnConst=function(d,p,m){if(d.test(p))return m},f.getWindowsVersionName=function(d){switch(d){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},f.getMacOSVersionName=function(d){var p=d.split(".").splice(0,2).map((function(m){return parseInt(m,10)||0}));if(p.push(0),p[0]===10)switch(p[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},f.getAndroidVersionName=function(d){var p=d.split(".").splice(0,2).map((function(m){return parseInt(m,10)||0}));if(p.push(0),!(p[0]===1&&p[1]<5))return p[0]===1&&p[1]<6?"Cupcake":p[0]===1&&p[1]>=6?"Donut":p[0]===2&&p[1]<2?"Eclair":p[0]===2&&p[1]===2?"Froyo":p[0]===2&&p[1]>2?"Gingerbread":p[0]===3?"Honeycomb":p[0]===4&&p[1]<1?"Ice Cream Sandwich":p[0]===4&&p[1]<4?"Jelly Bean":p[0]===4&&p[1]>=4?"KitKat":p[0]===5?"Lollipop":p[0]===6?"Marshmallow":p[0]===7?"Nougat":p[0]===8?"Oreo":p[0]===9?"Pie":void 0},f.getVersionPrecision=function(d){return d.split(".").length},f.compareVersions=function(d,p,m){m===void 0&&(m=!1);var _=f.getVersionPrecision(d),v=f.getVersionPrecision(p),S=Math.max(_,v),b=0,T=f.map([d,p],(function(w){var R=S-f.getVersionPrecision(w),C=w+new Array(R+1).join(".0");return f.map(C.split("."),(function(N){return new Array(20-N.length).join("0")+N})).reverse()}));for(m&&(b=S-Math.min(_,v)),S-=1;S>=b;){if(T[0][S]>T[1][S])return 1;if(T[0][S]===T[1][S]){if(S===b)return 0;S-=1}else if(T[0][S]<T[1][S])return-1}},f.map=function(d,p){var m,_=[];if(Array.prototype.map)return Array.prototype.map.call(d,p);for(m=0;m<d.length;m+=1)_.push(p(d[m]));return _},f.find=function(d,p){var m,_;if(Array.prototype.find)return Array.prototype.find.call(d,p);for(m=0,_=d.length;m<_;m+=1){var v=d[m];if(p(v,m))return v}},f.assign=function(d){for(var p,m,_=d,v=arguments.length,S=new Array(v>1?v-1:0),b=1;b<v;b++)S[b-1]=arguments[b];if(Object.assign)return Object.assign.apply(Object,[d].concat(S));var T=function(){var w=S[p];typeof w=="object"&&w!==null&&Object.keys(w).forEach((function(R){_[R]=w[R]}))};for(p=0,m=S.length;p<m;p+=1)T();return d},f.getBrowserAlias=function(d){return u.BROWSER_ALIASES_MAP[d]},f.getBrowserTypeByAlias=function(d){return u.BROWSER_MAP[d]||""},f})();c.default=h,a.exports=c.default},18:function(a,c,l){c.__esModule=!0,c.ENGINE_MAP=c.OS_MAP=c.PLATFORMS_MAP=c.BROWSER_MAP=c.BROWSER_ALIASES_MAP=void 0,c.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},c.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},c.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},c.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(91))&&u.__esModule?u:{default:u},f=l(18);function d(m,_){for(var v=0;v<_.length;v++){var S=_[v];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(m,S.key,S)}}var p=(function(){function m(){}var _,v,S;return m.getParser=function(b,T){if(T===void 0&&(T=!1),typeof b!="string")throw new Error("UserAgent should be a string");return new h.default(b,T)},m.parse=function(b){return new h.default(b).getResult()},_=m,S=[{key:"BROWSER_MAP",get:function(){return f.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return f.ENGINE_MAP}},{key:"OS_MAP",get:function(){return f.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return f.PLATFORMS_MAP}}],(v=null)&&d(_.prototype,v),S&&d(_,S),m})();c.default=p,a.exports=c.default},91:function(a,c,l){c.__esModule=!0,c.default=void 0;var u=m(l(92)),h=m(l(93)),f=m(l(94)),d=m(l(95)),p=m(l(17));function m(v){return v&&v.__esModule?v:{default:v}}var _=(function(){function v(b,T){if(T===void 0&&(T=!1),b==null||b==="")throw new Error("UserAgent parameter can't be empty");this._ua=b,this.parsedResult={},T!==!0&&this.parse()}var S=v.prototype;return S.getUA=function(){return this._ua},S.test=function(b){return b.test(this._ua)},S.parseBrowser=function(){var b=this;this.parsedResult.browser={};var T=p.default.find(u.default,(function(w){if(typeof w.test=="function")return w.test(b);if(w.test instanceof Array)return w.test.some((function(R){return b.test(R)}));throw new Error("Browser's test function is not valid")}));return T&&(this.parsedResult.browser=T.describe(this.getUA())),this.parsedResult.browser},S.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},S.getBrowserName=function(b){return b?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},S.getBrowserVersion=function(){return this.getBrowser().version},S.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},S.parseOS=function(){var b=this;this.parsedResult.os={};var T=p.default.find(h.default,(function(w){if(typeof w.test=="function")return w.test(b);if(w.test instanceof Array)return w.test.some((function(R){return b.test(R)}));throw new Error("Browser's test function is not valid")}));return T&&(this.parsedResult.os=T.describe(this.getUA())),this.parsedResult.os},S.getOSName=function(b){var T=this.getOS().name;return b?String(T).toLowerCase()||"":T||""},S.getOSVersion=function(){return this.getOS().version},S.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},S.getPlatformType=function(b){b===void 0&&(b=!1);var T=this.getPlatform().type;return b?String(T).toLowerCase()||"":T||""},S.parsePlatform=function(){var b=this;this.parsedResult.platform={};var T=p.default.find(f.default,(function(w){if(typeof w.test=="function")return w.test(b);if(w.test instanceof Array)return w.test.some((function(R){return b.test(R)}));throw new Error("Browser's test function is not valid")}));return T&&(this.parsedResult.platform=T.describe(this.getUA())),this.parsedResult.platform},S.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},S.getEngineName=function(b){return b?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},S.parseEngine=function(){var b=this;this.parsedResult.engine={};var T=p.default.find(d.default,(function(w){if(typeof w.test=="function")return w.test(b);if(w.test instanceof Array)return w.test.some((function(R){return b.test(R)}));throw new Error("Browser's test function is not valid")}));return T&&(this.parsedResult.engine=T.describe(this.getUA())),this.parsedResult.engine},S.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},S.getResult=function(){return p.default.assign({},this.parsedResult)},S.satisfies=function(b){var T=this,w={},R=0,C={},N=0;if(Object.keys(b).forEach((function(X){var G=b[X];typeof G=="string"?(C[X]=G,N+=1):typeof G=="object"&&(w[X]=G,R+=1)})),R>0){var U=Object.keys(w),B=p.default.find(U,(function(X){return T.isOS(X)}));if(B){var $=this.satisfies(w[B]);if($!==void 0)return $}var I=p.default.find(U,(function(X){return T.isPlatform(X)}));if(I){var L=this.satisfies(w[I]);if(L!==void 0)return L}}if(N>0){var P=Object.keys(C),H=p.default.find(P,(function(X){return T.isBrowser(X,!0)}));if(H!==void 0)return this.compareVersion(C[H])}},S.isBrowser=function(b,T){T===void 0&&(T=!1);var w=this.getBrowserName().toLowerCase(),R=b.toLowerCase(),C=p.default.getBrowserTypeByAlias(R);return T&&C&&(R=C.toLowerCase()),R===w},S.compareVersion=function(b){var T=[0],w=b,R=!1,C=this.getBrowserVersion();if(typeof C=="string")return b[0]===">"||b[0]==="<"?(w=b.substr(1),b[1]==="="?(R=!0,w=b.substr(2)):T=[],b[0]===">"?T.push(1):T.push(-1)):b[0]==="="?w=b.substr(1):b[0]==="~"&&(R=!0,w=b.substr(1)),T.indexOf(p.default.compareVersions(C,w,R))>-1},S.isOS=function(b){return this.getOSName(!0)===String(b).toLowerCase()},S.isPlatform=function(b){return this.getPlatformType(!0)===String(b).toLowerCase()},S.isEngine=function(b){return this.getEngineName(!0)===String(b).toLowerCase()},S.is=function(b,T){return T===void 0&&(T=!1),this.isBrowser(b,T)||this.isOS(b)||this.isPlatform(b)},S.some=function(b){var T=this;return b===void 0&&(b=[]),b.some((function(w){return T.is(w)}))},v})();c.default=_,a.exports=c.default},92:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=/version\/(\d+(\.?_?\d+)+)/i,d=[{test:[/googlebot/i],describe:function(p){var m={name:"Googlebot"},_=h.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/opera/i],describe:function(p){var m={name:"Opera"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/opr\/|opios/i],describe:function(p){var m={name:"Opera"},_=h.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/SamsungBrowser/i],describe:function(p){var m={name:"Samsung Internet for Android"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/Whale/i],describe:function(p){var m={name:"NAVER Whale Browser"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/MZBrowser/i],describe:function(p){var m={name:"MZ Browser"},_=h.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/focus/i],describe:function(p){var m={name:"Focus"},_=h.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/swing/i],describe:function(p){var m={name:"Swing"},_=h.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/coast/i],describe:function(p){var m={name:"Opera Coast"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(p){var m={name:"Opera Touch"},_=h.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/yabrowser/i],describe:function(p){var m={name:"Yandex Browser"},_=h.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/ucbrowser/i],describe:function(p){var m={name:"UC Browser"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/Maxthon|mxios/i],describe:function(p){var m={name:"Maxthon"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/epiphany/i],describe:function(p){var m={name:"Epiphany"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/puffin/i],describe:function(p){var m={name:"Puffin"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/sleipnir/i],describe:function(p){var m={name:"Sleipnir"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/k-meleon/i],describe:function(p){var m={name:"K-Meleon"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/micromessenger/i],describe:function(p){var m={name:"WeChat"},_=h.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/qqbrowser/i],describe:function(p){var m={name:/qqbrowserlite/i.test(p)?"QQ Browser Lite":"QQ Browser"},_=h.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/msie|trident/i],describe:function(p){var m={name:"Internet Explorer"},_=h.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/\sedg\//i],describe:function(p){var m={name:"Microsoft Edge"},_=h.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/edg([ea]|ios)/i],describe:function(p){var m={name:"Microsoft Edge"},_=h.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/vivaldi/i],describe:function(p){var m={name:"Vivaldi"},_=h.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/seamonkey/i],describe:function(p){var m={name:"SeaMonkey"},_=h.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/sailfish/i],describe:function(p){var m={name:"Sailfish"},_=h.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,p);return _&&(m.version=_),m}},{test:[/silk/i],describe:function(p){var m={name:"Amazon Silk"},_=h.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/phantom/i],describe:function(p){var m={name:"PhantomJS"},_=h.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/slimerjs/i],describe:function(p){var m={name:"SlimerJS"},_=h.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var m={name:"BlackBerry"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var m={name:"WebOS Browser"},_=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/bada/i],describe:function(p){var m={name:"Bada"},_=h.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/tizen/i],describe:function(p){var m={name:"Tizen"},_=h.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/qupzilla/i],describe:function(p){var m={name:"QupZilla"},_=h.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/firefox|iceweasel|fxios/i],describe:function(p){var m={name:"Firefox"},_=h.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/electron/i],describe:function(p){var m={name:"Electron"},_=h.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/MiuiBrowser/i],describe:function(p){var m={name:"Miui"},_=h.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/chromium/i],describe:function(p){var m={name:"Chromium"},_=h.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/chrome|crios|crmo/i],describe:function(p){var m={name:"Chrome"},_=h.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/GSA/i],describe:function(p){var m={name:"Google Search"},_=h.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:function(p){var m=!p.test(/like android/i),_=p.test(/android/i);return m&&_},describe:function(p){var m={name:"Android Browser"},_=h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/playstation 4/i],describe:function(p){var m={name:"PlayStation 4"},_=h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/safari|applewebkit/i],describe:function(p){var m={name:"Safari"},_=h.default.getFirstMatch(f,p);return _&&(m.version=_),m}},{test:[/.*/i],describe:function(p){var m=p.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:h.default.getFirstMatch(m,p),version:h.default.getSecondMatch(m,p)}}}];c.default=d,a.exports=c.default},93:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:[/Roku\/DVP/],describe:function(p){var m=h.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,p);return{name:f.OS_MAP.Roku,version:m}}},{test:[/windows phone/i],describe:function(p){var m=h.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.WindowsPhone,version:m}}},{test:[/windows /i],describe:function(p){var m=h.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,p),_=h.default.getWindowsVersionName(m);return{name:f.OS_MAP.Windows,version:m,versionName:_}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(p){var m={name:f.OS_MAP.iOS},_=h.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,p);return _&&(m.version=_),m}},{test:[/macintosh/i],describe:function(p){var m=h.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,p).replace(/[_\s]/g,"."),_=h.default.getMacOSVersionName(m),v={name:f.OS_MAP.MacOS,version:m};return _&&(v.versionName=_),v}},{test:[/(ipod|iphone|ipad)/i],describe:function(p){var m=h.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,p).replace(/[_\s]/g,".");return{name:f.OS_MAP.iOS,version:m}}},{test:function(p){var m=!p.test(/like android/i),_=p.test(/android/i);return m&&_},describe:function(p){var m=h.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,p),_=h.default.getAndroidVersionName(m),v={name:f.OS_MAP.Android,version:m};return _&&(v.versionName=_),v}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var m=h.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,p),_={name:f.OS_MAP.WebOS};return m&&m.length&&(_.version=m),_}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var m=h.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,p)||h.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,p)||h.default.getFirstMatch(/\bbb(\d+)/i,p);return{name:f.OS_MAP.BlackBerry,version:m}}},{test:[/bada/i],describe:function(p){var m=h.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.Bada,version:m}}},{test:[/tizen/i],describe:function(p){var m=h.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.Tizen,version:m}}},{test:[/linux/i],describe:function(){return{name:f.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:f.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(p){var m=h.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.PlayStation4,version:m}}}];c.default=d,a.exports=c.default},94:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(p){var m=h.default.getFirstMatch(/(can-l01)/i,p)&&"Nova",_={type:f.PLATFORMS_MAP.mobile,vendor:"Huawei"};return m&&(_.model=m),_}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet}}},{test:function(p){var m=p.test(/ipod|iphone/i),_=p.test(/like (ipod|iphone)/i);return m&&!_},describe:function(p){var m=h.default.getFirstMatch(/(ipod|iphone)/i,p);return{type:f.PLATFORMS_MAP.mobile,vendor:"Apple",model:m}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName(!0)==="blackberry"},describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(p){return p.getBrowserName(!0)==="bada"},describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName()==="windows phone"},describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(p){var m=Number(String(p.getOSVersion()).split(".")[0]);return p.getOSName(!0)==="android"&&m>=3},describe:function(){return{type:f.PLATFORMS_MAP.tablet}}},{test:function(p){return p.getOSName(!0)==="android"},describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getOSName(!0)==="macos"},describe:function(){return{type:f.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(p){return p.getOSName(!0)==="windows"},describe:function(){return{type:f.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="linux"},describe:function(){return{type:f.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="playstation 4"},describe:function(){return{type:f.PLATFORMS_MAP.tv}}},{test:function(p){return p.getOSName(!0)==="roku"},describe:function(){return{type:f.PLATFORMS_MAP.tv}}}];c.default=d,a.exports=c.default},95:function(a,c,l){c.__esModule=!0,c.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),d=[{test:function(p){return p.getBrowserName(!0)==="microsoft edge"},describe:function(p){if(/\sedg\//i.test(p))return{name:f.ENGINE_MAP.Blink};var m=h.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,p);return{name:f.ENGINE_MAP.EdgeHTML,version:m}}},{test:[/trident/i],describe:function(p){var m={name:f.ENGINE_MAP.Trident},_=h.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:function(p){return p.test(/presto/i)},describe:function(p){var m={name:f.ENGINE_MAP.Presto},_=h.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:function(p){var m=p.test(/gecko/i),_=p.test(/like gecko/i);return m&&!_},describe:function(p){var m={name:f.ENGINE_MAP.Gecko},_=h.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:f.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(p){var m={name:f.ENGINE_MAP.WebKit},_=h.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,p);return _&&(m.version=_),m}}];c.default=d,a.exports=c.default}})},228:o=>{var a=Object.prototype.hasOwnProperty,c="~";function l(){}function u(p,m,_){this.fn=p,this.context=m,this.once=_||!1}function h(p,m,_,v,S){if(typeof _!="function")throw new TypeError("The listener must be a function");var b=new u(_,v||p,S),T=c?c+m:m;return p._events[T]?p._events[T].fn?p._events[T]=[p._events[T],b]:p._events[T].push(b):(p._events[T]=b,p._eventsCount++),p}function f(p,m){--p._eventsCount==0?p._events=new l:delete p._events[m]}function d(){this._events=new l,this._eventsCount=0}Object.create&&(l.prototype=Object.create(null),new l().__proto__||(c=!1)),d.prototype.eventNames=function(){var p,m,_=[];if(this._eventsCount===0)return _;for(m in p=this._events)a.call(p,m)&&_.push(c?m.slice(1):m);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(p)):_},d.prototype.listeners=function(p){var m=c?c+p:p,_=this._events[m];if(!_)return[];if(_.fn)return[_.fn];for(var v=0,S=_.length,b=new Array(S);v<S;v++)b[v]=_[v].fn;return b},d.prototype.listenerCount=function(p){var m=c?c+p:p,_=this._events[m];return _?_.fn?1:_.length:0},d.prototype.emit=function(p,m,_,v,S,b){var T=c?c+p:p;if(!this._events[T])return!1;var w,R,C=this._events[T],N=arguments.length;if(C.fn){switch(C.once&&this.removeListener(p,C.fn,void 0,!0),N){case 1:return C.fn.call(C.context),!0;case 2:return C.fn.call(C.context,m),!0;case 3:return C.fn.call(C.context,m,_),!0;case 4:return C.fn.call(C.context,m,_,v),!0;case 5:return C.fn.call(C.context,m,_,v,S),!0;case 6:return C.fn.call(C.context,m,_,v,S,b),!0}for(R=1,w=new Array(N-1);R<N;R++)w[R-1]=arguments[R];C.fn.apply(C.context,w)}else{var U,B=C.length;for(R=0;R<B;R++)switch(C[R].once&&this.removeListener(p,C[R].fn,void 0,!0),N){case 1:C[R].fn.call(C[R].context);break;case 2:C[R].fn.call(C[R].context,m);break;case 3:C[R].fn.call(C[R].context,m,_);break;case 4:C[R].fn.call(C[R].context,m,_,v);break;default:if(!w)for(U=1,w=new Array(N-1);U<N;U++)w[U-1]=arguments[U];C[R].fn.apply(C[R].context,w)}}return!0},d.prototype.on=function(p,m,_){return h(this,p,m,_,!1)},d.prototype.once=function(p,m,_){return h(this,p,m,_,!0)},d.prototype.removeListener=function(p,m,_,v){var S=c?c+p:p;if(!this._events[S])return this;if(!m)return f(this,S),this;var b=this._events[S];if(b.fn)b.fn!==m||v&&!b.once||_&&b.context!==_||f(this,S);else{for(var T=0,w=[],R=b.length;T<R;T++)(b[T].fn!==m||v&&!b[T].once||_&&b[T].context!==_)&&w.push(b[T]);w.length?this._events[S]=w.length===1?w[0]:w:f(this,S)}return this},d.prototype.removeAllListeners=function(p){var m;return p?(m=c?c+p:p,this._events[m]&&f(this,m)):(this._events=new l,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=c,d.EventEmitter=d,o.exports=d},8954:function(o){var a;a=()=>(()=>{var c={228:h=>{var f=Object.prototype.hasOwnProperty,d="~";function p(){}function m(b,T,w){this.fn=b,this.context=T,this.once=w||!1}function _(b,T,w,R,C){if(typeof w!="function")throw new TypeError("The listener must be a function");var N=new m(w,R||b,C),U=d?d+T:T;return b._events[U]?b._events[U].fn?b._events[U]=[b._events[U],N]:b._events[U].push(N):(b._events[U]=N,b._eventsCount++),b}function v(b,T){--b._eventsCount==0?b._events=new p:delete b._events[T]}function S(){this._events=new p,this._eventsCount=0}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(d=!1)),S.prototype.eventNames=function(){var b,T,w=[];if(this._eventsCount===0)return w;for(T in b=this._events)f.call(b,T)&&w.push(d?T.slice(1):T);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(b)):w},S.prototype.listeners=function(b){var T=d?d+b:b,w=this._events[T];if(!w)return[];if(w.fn)return[w.fn];for(var R=0,C=w.length,N=new Array(C);R<C;R++)N[R]=w[R].fn;return N},S.prototype.listenerCount=function(b){var T=d?d+b:b,w=this._events[T];return w?w.fn?1:w.length:0},S.prototype.emit=function(b,T,w,R,C,N){var U=d?d+b:b;if(!this._events[U])return!1;var B,$,I=this._events[U],L=arguments.length;if(I.fn){switch(I.once&&this.removeListener(b,I.fn,void 0,!0),L){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,T),!0;case 3:return I.fn.call(I.context,T,w),!0;case 4:return I.fn.call(I.context,T,w,R),!0;case 5:return I.fn.call(I.context,T,w,R,C),!0;case 6:return I.fn.call(I.context,T,w,R,C,N),!0}for($=1,B=new Array(L-1);$<L;$++)B[$-1]=arguments[$];I.fn.apply(I.context,B)}else{var P,H=I.length;for($=0;$<H;$++)switch(I[$].once&&this.removeListener(b,I[$].fn,void 0,!0),L){case 1:I[$].fn.call(I[$].context);break;case 2:I[$].fn.call(I[$].context,T);break;case 3:I[$].fn.call(I[$].context,T,w);break;case 4:I[$].fn.call(I[$].context,T,w,R);break;default:if(!B)for(P=1,B=new Array(L-1);P<L;P++)B[P-1]=arguments[P];I[$].fn.apply(I[$].context,B)}}return!0},S.prototype.on=function(b,T,w){return _(this,b,T,w,!1)},S.prototype.once=function(b,T,w){return _(this,b,T,w,!0)},S.prototype.removeListener=function(b,T,w,R){var C=d?d+b:b;if(!this._events[C])return this;if(!T)return v(this,C),this;var N=this._events[C];if(N.fn)N.fn!==T||R&&!N.once||w&&N.context!==w||v(this,C);else{for(var U=0,B=[],$=N.length;U<$;U++)(N[U].fn!==T||R&&!N[U].once||w&&N[U].context!==w)&&B.push(N[U]);B.length?this._events[C]=B.length===1?B[0]:B:v(this,C)}return this},S.prototype.removeAllListeners=function(b){var T;return b?(T=d?d+b:b,this._events[T]&&v(this,T)):(this._events=new p,this._eventsCount=0),this},S.prototype.off=S.prototype.removeListener,S.prototype.addListener=S.prototype.on,S.prefixed=d,S.EventEmitter=S,h.exports=S},1549:(h,f,d)=>{var p=d(2032),m=d(3862),_=d(6721),v=d(2749),S=d(5749);function b(T){var w=-1,R=T==null?0:T.length;for(this.clear();++w<R;){var C=T[w];this.set(C[0],C[1])}}b.prototype.clear=p,b.prototype.delete=m,b.prototype.get=_,b.prototype.has=v,b.prototype.set=S,h.exports=b},79:(h,f,d)=>{var p=d(3702),m=d(80),_=d(4739),v=d(8655),S=d(1175);function b(T){var w=-1,R=T==null?0:T.length;for(this.clear();++w<R;){var C=T[w];this.set(C[0],C[1])}}b.prototype.clear=p,b.prototype.delete=m,b.prototype.get=_,b.prototype.has=v,b.prototype.set=S,h.exports=b},8223:(h,f,d)=>{var p=d(6110)(d(9325),"Map");h.exports=p},3661:(h,f,d)=>{var p=d(3040),m=d(7670),_=d(289),v=d(4509),S=d(2949);function b(T){var w=-1,R=T==null?0:T.length;for(this.clear();++w<R;){var C=T[w];this.set(C[0],C[1])}}b.prototype.clear=p,b.prototype.delete=m,b.prototype.get=_,b.prototype.has=v,b.prototype.set=S,h.exports=b},7217:(h,f,d)=>{var p=d(79),m=d(1420),_=d(938),v=d(3605),S=d(9817),b=d(945);function T(w){var R=this.__data__=new p(w);this.size=R.size}T.prototype.clear=m,T.prototype.delete=_,T.prototype.get=v,T.prototype.has=S,T.prototype.set=b,h.exports=T},1873:(h,f,d)=>{var p=d(9325).Symbol;h.exports=p},7828:(h,f,d)=>{var p=d(9325).Uint8Array;h.exports=p},1033:h=>{h.exports=function(f,d,p){switch(p.length){case 0:return f.call(d);case 1:return f.call(d,p[0]);case 2:return f.call(d,p[0],p[1]);case 3:return f.call(d,p[0],p[1],p[2])}return f.apply(d,p)}},695:(h,f,d)=>{var p=d(8096),m=d(2428),_=d(6449),v=d(3656),S=d(361),b=d(7167),T=Object.prototype.hasOwnProperty;h.exports=function(w,R){var C=_(w),N=!C&&m(w),U=!C&&!N&&v(w),B=!C&&!N&&!U&&b(w),$=C||N||U||B,I=$?p(w.length,String):[],L=I.length;for(var P in w)!R&&!T.call(w,P)||$&&(P=="length"||U&&(P=="offset"||P=="parent")||B&&(P=="buffer"||P=="byteLength"||P=="byteOffset")||S(P,L))||I.push(P);return I}},7805:(h,f,d)=>{var p=d(3360),m=d(5288);h.exports=function(_,v,S){(S!==void 0&&!m(_[v],S)||S===void 0&&!(v in _))&&p(_,v,S)}},6547:(h,f,d)=>{var p=d(3360),m=d(5288),_=Object.prototype.hasOwnProperty;h.exports=function(v,S,b){var T=v[S];_.call(v,S)&&m(T,b)&&(b!==void 0||S in v)||p(v,S,b)}},6025:(h,f,d)=>{var p=d(5288);h.exports=function(m,_){for(var v=m.length;v--;)if(p(m[v][0],_))return v;return-1}},3360:(h,f,d)=>{var p=d(3243);h.exports=function(m,_,v){_=="__proto__"&&p?p(m,_,{configurable:!0,enumerable:!0,value:v,writable:!0}):m[_]=v}},9344:(h,f,d)=>{var p=d(3805),m=Object.create,_=(function(){function v(){}return function(S){if(!p(S))return{};if(m)return m(S);v.prototype=S;var b=new v;return v.prototype=void 0,b}})();h.exports=_},6649:(h,f,d)=>{var p=d(3221)();h.exports=p},2552:(h,f,d)=>{var p=d(1873),m=d(659),_=d(9350),v=p?p.toStringTag:void 0;h.exports=function(S){return S==null?S===void 0?"[object Undefined]":"[object Null]":v&&v in Object(S)?m(S):_(S)}},7534:(h,f,d)=>{var p=d(2552),m=d(346);h.exports=function(_){return m(_)&&p(_)=="[object Arguments]"}},5083:(h,f,d)=>{var p=d(1882),m=d(7296),_=d(3805),v=d(7473),S=/^\[object .+?Constructor\]$/,b=Function.prototype,T=Object.prototype,w=b.toString,R=T.hasOwnProperty,C=RegExp("^"+w.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");h.exports=function(N){return!(!_(N)||m(N))&&(p(N)?C:S).test(v(N))}},4901:(h,f,d)=>{var p=d(2552),m=d(294),_=d(346),v={};v["[object Float32Array]"]=v["[object Float64Array]"]=v["[object Int8Array]"]=v["[object Int16Array]"]=v["[object Int32Array]"]=v["[object Uint8Array]"]=v["[object Uint8ClampedArray]"]=v["[object Uint16Array]"]=v["[object Uint32Array]"]=!0,v["[object Arguments]"]=v["[object Array]"]=v["[object ArrayBuffer]"]=v["[object Boolean]"]=v["[object DataView]"]=v["[object Date]"]=v["[object Error]"]=v["[object Function]"]=v["[object Map]"]=v["[object Number]"]=v["[object Object]"]=v["[object RegExp]"]=v["[object Set]"]=v["[object String]"]=v["[object WeakMap]"]=!1,h.exports=function(S){return _(S)&&m(S.length)&&!!v[p(S)]}},2903:(h,f,d)=>{var p=d(3805),m=d(5527),_=d(181),v=Object.prototype.hasOwnProperty;h.exports=function(S){if(!p(S))return _(S);var b=m(S),T=[];for(var w in S)(w!="constructor"||!b&&v.call(S,w))&&T.push(w);return T}},5250:(h,f,d)=>{var p=d(7217),m=d(7805),_=d(6649),v=d(2824),S=d(3805),b=d(7241),T=d(4974);h.exports=function w(R,C,N,U,B){R!==C&&_(C,(function($,I){if(B||(B=new p),S($))v(R,C,I,N,w,U,B);else{var L=U?U(T(R,I),$,I+"",R,C,B):void 0;L===void 0&&(L=$),m(R,I,L)}}),b)}},2824:(h,f,d)=>{var p=d(7805),m=d(3290),_=d(1961),v=d(3007),S=d(5529),b=d(2428),T=d(6449),w=d(3693),R=d(3656),C=d(1882),N=d(3805),U=d(1331),B=d(7167),$=d(4974),I=d(9884);h.exports=function(L,P,H,X,G,Y,J){var Q=$(L,H),z=$(P,H),q=J.get(z);if(q)p(L,H,q);else{var ee=Y?Y(Q,z,H+"",L,P,J):void 0,te=ee===void 0;if(te){var ie=T(z),Ee=!ie&&R(z),Re=!ie&&!Ee&&B(z);ee=z,ie||Ee||Re?T(Q)?ee=Q:w(Q)?ee=v(Q):Ee?(te=!1,ee=m(z,!0)):Re?(te=!1,ee=_(z,!0)):ee=[]:U(z)||b(z)?(ee=Q,b(Q)?ee=I(Q):N(Q)&&!C(Q)||(ee=S(z))):te=!1}te&&(J.set(z,ee),G(ee,z,X,Y,J),J.delete(z)),p(L,H,ee)}}},9302:(h,f,d)=>{var p=d(3488),m=d(6757),_=d(2865);h.exports=function(v,S){return _(m(v,S,p),v+"")}},9570:(h,f,d)=>{var p=d(7334),m=d(3243),_=d(3488),v=m?function(S,b){return m(S,"toString",{configurable:!0,enumerable:!1,value:p(b),writable:!0})}:_;h.exports=v},8096:h=>{h.exports=function(f,d){for(var p=-1,m=Array(f);++p<f;)m[p]=d(p);return m}},7301:h=>{h.exports=function(f){return function(d){return f(d)}}},9653:(h,f,d)=>{var p=d(7828);h.exports=function(m){var _=new m.constructor(m.byteLength);return new p(_).set(new p(m)),_}},3290:(h,f,d)=>{h=d.nmd(h);var p=d(9325),m=f&&!f.nodeType&&f,_=m&&h&&!h.nodeType&&h,v=_&&_.exports===m?p.Buffer:void 0,S=v?v.allocUnsafe:void 0;h.exports=function(b,T){if(T)return b.slice();var w=b.length,R=S?S(w):new b.constructor(w);return b.copy(R),R}},1961:(h,f,d)=>{var p=d(9653);h.exports=function(m,_){var v=_?p(m.buffer):m.buffer;return new m.constructor(v,m.byteOffset,m.length)}},3007:h=>{h.exports=function(f,d){var p=-1,m=f.length;for(d||(d=Array(m));++p<m;)d[p]=f[p];return d}},1791:(h,f,d)=>{var p=d(6547),m=d(3360);h.exports=function(_,v,S,b){var T=!S;S||(S={});for(var w=-1,R=v.length;++w<R;){var C=v[w],N=b?b(S[C],_[C],C,S,_):void 0;N===void 0&&(N=_[C]),T?m(S,C,N):p(S,C,N)}return S}},5481:(h,f,d)=>{var p=d(9325)["__core-js_shared__"];h.exports=p},999:(h,f,d)=>{var p=d(9302),m=d(6800);h.exports=function(_){return p((function(v,S){var b=-1,T=S.length,w=T>1?S[T-1]:void 0,R=T>2?S[2]:void 0;for(w=_.length>3&&typeof w=="function"?(T--,w):void 0,R&&m(S[0],S[1],R)&&(w=T<3?void 0:w,T=1),v=Object(v);++b<T;){var C=S[b];C&&_(v,C,b,w)}return v}))}},3221:h=>{h.exports=function(f){return function(d,p,m){for(var _=-1,v=Object(d),S=m(d),b=S.length;b--;){var T=S[f?b:++_];if(p(v[T],T,v)===!1)break}return d}}},3243:(h,f,d)=>{var p=d(6110),m=(function(){try{var _=p(Object,"defineProperty");return _({},"",{}),_}catch{}})();h.exports=m},4840:(h,f,d)=>{var p=typeof d.g=="object"&&d.g&&d.g.Object===Object&&d.g;h.exports=p},2651:(h,f,d)=>{var p=d(4218);h.exports=function(m,_){var v=m.__data__;return p(_)?v[typeof _=="string"?"string":"hash"]:v.map}},6110:(h,f,d)=>{var p=d(5083),m=d(392);h.exports=function(_,v){var S=m(_,v);return p(S)?S:void 0}},8879:(h,f,d)=>{var p=d(4335)(Object.getPrototypeOf,Object);h.exports=p},659:(h,f,d)=>{var p=d(1873),m=Object.prototype,_=m.hasOwnProperty,v=m.toString,S=p?p.toStringTag:void 0;h.exports=function(b){var T=_.call(b,S),w=b[S];try{b[S]=void 0;var R=!0}catch{}var C=v.call(b);return R&&(T?b[S]=w:delete b[S]),C}},392:h=>{h.exports=function(f,d){return f?.[d]}},2032:(h,f,d)=>{var p=d(1042);h.exports=function(){this.__data__=p?p(null):{},this.size=0}},3862:h=>{h.exports=function(f){var d=this.has(f)&&delete this.__data__[f];return this.size-=d?1:0,d}},6721:(h,f,d)=>{var p=d(1042),m=Object.prototype.hasOwnProperty;h.exports=function(_){var v=this.__data__;if(p){var S=v[_];return S==="__lodash_hash_undefined__"?void 0:S}return m.call(v,_)?v[_]:void 0}},2749:(h,f,d)=>{var p=d(1042),m=Object.prototype.hasOwnProperty;h.exports=function(_){var v=this.__data__;return p?v[_]!==void 0:m.call(v,_)}},5749:(h,f,d)=>{var p=d(1042);h.exports=function(m,_){var v=this.__data__;return this.size+=this.has(m)?0:1,v[m]=p&&_===void 0?"__lodash_hash_undefined__":_,this}},5529:(h,f,d)=>{var p=d(9344),m=d(8879),_=d(5527);h.exports=function(v){return typeof v.constructor!="function"||_(v)?{}:p(m(v))}},361:h=>{var f=/^(?:0|[1-9]\d*)$/;h.exports=function(d,p){var m=typeof d;return!!(p=p??9007199254740991)&&(m=="number"||m!="symbol"&&f.test(d))&&d>-1&&d%1==0&&d<p}},6800:(h,f,d)=>{var p=d(5288),m=d(4894),_=d(361),v=d(3805);h.exports=function(S,b,T){if(!v(T))return!1;var w=typeof b;return!!(w=="number"?m(T)&&_(b,T.length):w=="string"&&b in T)&&p(T[b],S)}},4218:h=>{h.exports=function(f){var d=typeof f;return d=="string"||d=="number"||d=="symbol"||d=="boolean"?f!=="__proto__":f===null}},7296:(h,f,d)=>{var p,m=d(5481),_=(p=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+p:"";h.exports=function(v){return!!_&&_ in v}},5527:h=>{var f=Object.prototype;h.exports=function(d){var p=d&&d.constructor;return d===(typeof p=="function"&&p.prototype||f)}},3702:h=>{h.exports=function(){this.__data__=[],this.size=0}},80:(h,f,d)=>{var p=d(6025),m=Array.prototype.splice;h.exports=function(_){var v=this.__data__,S=p(v,_);return!(S<0||(S==v.length-1?v.pop():m.call(v,S,1),--this.size,0))}},4739:(h,f,d)=>{var p=d(6025);h.exports=function(m){var _=this.__data__,v=p(_,m);return v<0?void 0:_[v][1]}},8655:(h,f,d)=>{var p=d(6025);h.exports=function(m){return p(this.__data__,m)>-1}},1175:(h,f,d)=>{var p=d(6025);h.exports=function(m,_){var v=this.__data__,S=p(v,m);return S<0?(++this.size,v.push([m,_])):v[S][1]=_,this}},3040:(h,f,d)=>{var p=d(1549),m=d(79),_=d(8223);h.exports=function(){this.size=0,this.__data__={hash:new p,map:new(_||m),string:new p}}},7670:(h,f,d)=>{var p=d(2651);h.exports=function(m){var _=p(this,m).delete(m);return this.size-=_?1:0,_}},289:(h,f,d)=>{var p=d(2651);h.exports=function(m){return p(this,m).get(m)}},4509:(h,f,d)=>{var p=d(2651);h.exports=function(m){return p(this,m).has(m)}},2949:(h,f,d)=>{var p=d(2651);h.exports=function(m,_){var v=p(this,m),S=v.size;return v.set(m,_),this.size+=v.size==S?0:1,this}},1042:(h,f,d)=>{var p=d(6110)(Object,"create");h.exports=p},181:h=>{h.exports=function(f){var d=[];if(f!=null)for(var p in Object(f))d.push(p);return d}},6009:(h,f,d)=>{h=d.nmd(h);var p=d(4840),m=f&&!f.nodeType&&f,_=m&&h&&!h.nodeType&&h,v=_&&_.exports===m&&p.process,S=(function(){try{return _&&_.require&&_.require("util").types||v&&v.binding&&v.binding("util")}catch{}})();h.exports=S},9350:h=>{var f=Object.prototype.toString;h.exports=function(d){return f.call(d)}},4335:h=>{h.exports=function(f,d){return function(p){return f(d(p))}}},6757:(h,f,d)=>{var p=d(1033),m=Math.max;h.exports=function(_,v,S){return v=m(v===void 0?_.length-1:v,0),function(){for(var b=arguments,T=-1,w=m(b.length-v,0),R=Array(w);++T<w;)R[T]=b[v+T];T=-1;for(var C=Array(v+1);++T<v;)C[T]=b[T];return C[v]=S(R),p(_,this,C)}}},9325:(h,f,d)=>{var p=d(4840),m=typeof self=="object"&&self&&self.Object===Object&&self,_=p||m||Function("return this")();h.exports=_},4974:h=>{h.exports=function(f,d){if((d!=="constructor"||typeof f[d]!="function")&&d!="__proto__")return f[d]}},2865:(h,f,d)=>{var p=d(9570),m=d(1811)(p);h.exports=m},1811:h=>{var f=Date.now;h.exports=function(d){var p=0,m=0;return function(){var _=f(),v=16-(_-m);if(m=_,v>0){if(++p>=800)return arguments[0]}else p=0;return d.apply(void 0,arguments)}}},1420:(h,f,d)=>{var p=d(79);h.exports=function(){this.__data__=new p,this.size=0}},938:h=>{h.exports=function(f){var d=this.__data__,p=d.delete(f);return this.size=d.size,p}},3605:h=>{h.exports=function(f){return this.__data__.get(f)}},9817:h=>{h.exports=function(f){return this.__data__.has(f)}},945:(h,f,d)=>{var p=d(79),m=d(8223),_=d(3661);h.exports=function(v,S){var b=this.__data__;if(b instanceof p){var T=b.__data__;if(!m||T.length<199)return T.push([v,S]),this.size=++b.size,this;b=this.__data__=new _(T)}return b.set(v,S),this.size=b.size,this}},7473:h=>{var f=Function.prototype.toString;h.exports=function(d){if(d!=null){try{return f.call(d)}catch{}try{return d+""}catch{}}return""}},7334:h=>{h.exports=function(f){return function(){return f}}},5288:h=>{h.exports=function(f,d){return f===d||f!=f&&d!=d}},3488:h=>{h.exports=function(f){return f}},2428:(h,f,d)=>{var p=d(7534),m=d(346),_=Object.prototype,v=_.hasOwnProperty,S=_.propertyIsEnumerable,b=p((function(){return arguments})())?p:function(T){return m(T)&&v.call(T,"callee")&&!S.call(T,"callee")};h.exports=b},6449:h=>{var f=Array.isArray;h.exports=f},4894:(h,f,d)=>{var p=d(1882),m=d(294);h.exports=function(_){return _!=null&&m(_.length)&&!p(_)}},3693:(h,f,d)=>{var p=d(4894),m=d(346);h.exports=function(_){return m(_)&&p(_)}},3656:(h,f,d)=>{h=d.nmd(h);var p=d(9325),m=d(9935),_=f&&!f.nodeType&&f,v=_&&h&&!h.nodeType&&h,S=v&&v.exports===_?p.Buffer:void 0,b=(S?S.isBuffer:void 0)||m;h.exports=b},1882:(h,f,d)=>{var p=d(2552),m=d(3805);h.exports=function(_){if(!m(_))return!1;var v=p(_);return v=="[object Function]"||v=="[object GeneratorFunction]"||v=="[object AsyncFunction]"||v=="[object Proxy]"}},294:h=>{h.exports=function(f){return typeof f=="number"&&f>-1&&f%1==0&&f<=9007199254740991}},3805:h=>{h.exports=function(f){var d=typeof f;return f!=null&&(d=="object"||d=="function")}},346:h=>{h.exports=function(f){return f!=null&&typeof f=="object"}},1331:(h,f,d)=>{var p=d(2552),m=d(8879),_=d(346),v=Function.prototype,S=Object.prototype,b=v.toString,T=S.hasOwnProperty,w=b.call(Object);h.exports=function(R){if(!_(R)||p(R)!="[object Object]")return!1;var C=m(R);if(C===null)return!0;var N=T.call(C,"constructor")&&C.constructor;return typeof N=="function"&&N instanceof N&&b.call(N)==w}},7167:(h,f,d)=>{var p=d(4901),m=d(7301),_=d(6009),v=_&&_.isTypedArray,S=v?m(v):p;h.exports=S},7241:(h,f,d)=>{var p=d(695),m=d(2903),_=d(4894);h.exports=function(v){return _(v)?p(v,!0):m(v)}},6924:(h,f,d)=>{var p=d(5250),m=d(999)((function(_,v,S,b){p(_,v,S,b)}));h.exports=m},9935:h=>{h.exports=function(){return!1}},9884:(h,f,d)=>{var p=d(1791),m=d(7241);h.exports=function(_){return p(_,m(_))}},4355:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CriteriaInputs=f.BooleanComparisonSchema=void 0;var p=d(4713);f.BooleanComparisonSchema={comparison:{type:"string",required:!0},format:{type:"string",required:!0},value:{type:"string",required:!1}};var m=(function(){function _(v){this.inputs=v}return _.prototype.matches=function(v,S){if(S.length===0)return{success:!0,matched:!1};var b=this.inputs[v];if(b===void 0)return{success:!0,matched:!1};for(var T=0,w=S;T<w.length;T++){var R=w[T],C=this.matchSingleFilter(v,b,R);if(!C.success)return C;if(C.matched)return{success:!0,matched:!0}}return{success:!0,matched:!1}},_.prototype.matchSingleFilter=function(v,S,b){return this.isPrimitiveFilter(b)?this.matchPrimitive(S,b):this.isComparatorFilter(b)?this.matchComparator(v,S,b):{success:!1,error:"Invalid filter type for property ".concat(v)}},_.prototype.matchPrimitive=function(v,S){return typeof v!=typeof S?{success:!0,matched:!1}:typeof v=="string"&&typeof S=="string"?{success:!0,matched:(0,p.matchesWithWildcard)(v,S)}:{success:!0,matched:v===S}},_.prototype.matchComparator=function(v,S,b){var T=b.comparison,w=b.format,R=b.value;return this.isValidComparisonOperator(T)?w==="semver"?this.matchSemverComparator(S,T,R):w==="number"?this.matchNumberComparator(S,T,R):{success:!1,error:"Unknown comparator format: ".concat(w)}:{success:!1,error:"Invalid comparison operator: ".concat(T)}},_.prototype.matchSemverComparator=function(v,S,b){if(typeof v!="string")return{success:!1,error:"Input value must be string for semver comparison"};var T=(0,p.compareSemvers)(v,b);return T===void 0?{success:!1,error:'Invalid semver: input="'.concat(v,'", filter="').concat(b,'"')}:{success:!0,matched:this.evaluateComparison(T,S)}},_.prototype.matchNumberComparator=function(v,S,b){if(typeof v!="number")return{success:!1,error:"Input value must be number for number comparison"};var T,w=parseFloat(b);return isNaN(w)?{success:!1,error:"Invalid number in filter: ".concat(b)}:(T=v<w?-1:v>w?1:0,{success:!0,matched:this.evaluateComparison(T,S)})},_.prototype.evaluateComparison=function(v,S){switch(S){case"<":return v<0;case"<=":return v<=0;case">":return v>0;case">=":return v>=0;case"==":return v===0;case"!=":return v!==0;default:return!1}},_.prototype.isPrimitiveFilter=function(v){return typeof v=="string"||typeof v=="number"||typeof v=="boolean"},_.prototype.isComparatorFilter=function(v){return typeof v=="object"&&v!==null&&"comparison"in v&&"format"in v&&"value"in v},_.prototype.isValidComparisonOperator=function(v){return["<","<=",">",">=","==","!="].includes(v)},_})();f.CriteriaInputs=m},5185:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.CriteriaParser=f.DeviceConfigCriteriaConfigSchema=f.DeviceConfigCriteriaSchema=f.DeviceConfigRulesSchema=void 0;var p=d(4293);f.DeviceConfigRulesSchema={},f.DeviceConfigCriteriaSchema={version:{type:"number",required:!0},rules:{type:"object",required:!0,config:{schema:f.DeviceConfigRulesSchema}}},f.DeviceConfigCriteriaConfigSchema={criteria:{type:"object",required:!0,config:{schema:f.DeviceConfigCriteriaSchema}},payload:{type:"object",required:!0,config:{schema:{}}}};var m=(function(){function _(){}return Object.defineProperty(_,"CURRENT_VERSION",{get:function(){return this.SUPPORTED_VERSION},enumerable:!1,configurable:!0}),_.evaluateCriteria=function(v,S){if(!v.criteria)return(0,p.err)("Missing criteria object");var b=v.criteria;if(b.version!==this.SUPPORTED_VERSION)return(0,p.ok)({matched:!1});if(!b.rules)return(0,p.err)("Missing rules in criteria");var T=b.rules;if(Object.keys(T).length===0)return(0,p.ok)({matched:!0,payload:v.payload});for(var w=0,R=Object.entries(T);w<R.length;w++){var C=R[w],N=C[0],U=C[1],B=S.matches(N,U);if(!B.success)return(0,p.err)(B.error||"Match evaluation failed");if(!B.matched)return(0,p.ok)({matched:!1})}return(0,p.ok)({matched:!0,payload:v.payload})},_.matchingPayloads=function(v,S){for(var b=[],T=[],w=0,R=v;w<R.length;w++){var C=R[w],N=this.evaluateCriteria(C,S);N.ok?N.value.matched&&N.value.payload!==void 0&&b.push(N.value.payload):T.push(N.error)}return T.length>0?(0,p.err)(T):(0,p.ok)({payloads:b})},_.matches=function(v,S,b){return b.matches(v,S)},_.SUPPORTED_VERSION=1,_})();f.CriteriaParser=m},4713:(h,f)=>{function d(p){if(p&&typeof p=="string"){var m=p.split("+")[0];if(m){var _=m.split("-"),v=_[0],S=_.slice(1);if(v){var b=v.split(".");if(!(b.length===0||b.length>3||b.some((function(I){return I===""||!/^\d+$/.test(I)})))){var T=b.map((function(I){return parseInt(I,10)})),w=T[0],R=w===void 0?0:w,C=T[1],N=C===void 0?0:C,U=T[2],B={major:R,minor:N,patch:U===void 0?0:U};if(S.length>0){var $=S.join("-");$&&(B.prerelease=$.split("."))}return B}}}}}Object.defineProperty(f,"__esModule",{value:!0}),f.compareSemvers=f.parseSemver=f.matchesWithWildcard=void 0,f.matchesWithWildcard=function(p,m){if(m==="*")return!0;if(m.endsWith("*")){var _=m.slice(0,-1);return p.indexOf(_)===0}return p===m},f.parseSemver=d,f.compareSemvers=function(p,m){var _=d(p),v=d(m);if(_&&v){if(_.major!==v.major)return _.major>v.major?1:-1;if(_.minor!==v.minor)return _.minor>v.minor?1:-1;if(_.patch!==v.patch)return _.patch>v.patch?1:-1;var S=_.prerelease&&_.prerelease.length>0,b=v.prerelease&&v.prerelease.length>0;if(S&&!b)return-1;if(!S&&b)return 1;if(!S&&!b)return 0;for(var T=_.prerelease,w=v.prerelease,R=Math.max(T.length,w.length),C=0;C<R;C++){var N=T[C],U=w[C];if(N===void 0)return-1;if(U===void 0)return 1;var B=/^\d+$/.test(N),$=/^\d+$/.test(U);if(B&&$){var I=parseInt(N,10),L=parseInt(U,10);if(I!==L)return I>L?1:-1}else{if(B&&!$)return-1;if(!B&&$)return 1;if(N!==U)return N>U?1:-1}}return 0}}},6270:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigRulesSchema=f.DeviceConfigCriteriaSchema=f.DeviceConfigCriteriaConfigSchema=f.CriteriaParser=f.BooleanComparisonSchema=f.CriteriaInputs=f.compareSemvers=f.parseSemver=f.matchesWithWildcard=void 0;var p=d(4713);Object.defineProperty(f,"matchesWithWildcard",{enumerable:!0,get:function(){return p.matchesWithWildcard}}),Object.defineProperty(f,"parseSemver",{enumerable:!0,get:function(){return p.parseSemver}}),Object.defineProperty(f,"compareSemvers",{enumerable:!0,get:function(){return p.compareSemvers}});var m=d(4355);Object.defineProperty(f,"CriteriaInputs",{enumerable:!0,get:function(){return m.CriteriaInputs}}),Object.defineProperty(f,"BooleanComparisonSchema",{enumerable:!0,get:function(){return m.BooleanComparisonSchema}});var _=d(5185);Object.defineProperty(f,"CriteriaParser",{enumerable:!0,get:function(){return _.CriteriaParser}}),Object.defineProperty(f,"DeviceConfigCriteriaConfigSchema",{enumerable:!0,get:function(){return _.DeviceConfigCriteriaConfigSchema}}),Object.defineProperty(f,"DeviceConfigCriteriaSchema",{enumerable:!0,get:function(){return _.DeviceConfigCriteriaSchema}}),Object.defineProperty(f,"DeviceConfigRulesSchema",{enumerable:!0,get:function(){return _.DeviceConfigRulesSchema}})},7094:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DefaultClock=f.DefaultStorage=f.DefaultAnalytics=f.DefaultTrace=f.getDefaultConfigRefreshOptions=f.getDefaultCommonAnalytics=f.DEFAULT_INITIAL_DELAY_SECONDS=f.DEFAULT_HTTP_TIMEOUT_SECONDS=f.DEFAULT_STOP_REFRESH_AFTER_SECONDS=f.DEFAULT_MAX_AGE_CACHE_SECONDS=f.DEFAULT_RETRY_INTERVAL_SECONDS=f.DEFAULT_RETRY_COUNT=f.DEFAULT_REFRESH_INTERVAL_SECONDS=f.STORAGE_PREFIX_KEY=f.ENCODING_BASE64=f.STATE_KEY=f.DATA_KEY=void 0;var p=d(3259),m=d(4811);f.DATA_KEY="data",f.STATE_KEY="state",f.ENCODING_BASE64="base64",f.STORAGE_PREFIX_KEY="amazon_ivs_device_config_v1_",f.DEFAULT_REFRESH_INTERVAL_SECONDS=(0,p.minutesToSeconds)(15),f.DEFAULT_RETRY_COUNT=3,f.DEFAULT_RETRY_INTERVAL_SECONDS=10,f.DEFAULT_MAX_AGE_CACHE_SECONDS=(0,p.daysToSeconds)(3),f.DEFAULT_STOP_REFRESH_AFTER_SECONDS=(0,p.hoursToSeconds)(2),f.DEFAULT_HTTP_TIMEOUT_SECONDS=15,f.DEFAULT_INITIAL_DELAY_SECONDS=5,f.getDefaultCommonAnalytics=function(){return{client_sdk:"unknown",env:m.DeviceConfigEnv.PROD}},f.getDefaultConfigRefreshOptions=function(){return{refreshIntervalSeconds:f.DEFAULT_REFRESH_INTERVAL_SECONDS,retryCount:f.DEFAULT_RETRY_COUNT,retryIntervalSeconds:f.DEFAULT_RETRY_INTERVAL_SECONDS,maxCacheAgeSeconds:f.DEFAULT_MAX_AGE_CACHE_SECONDS,stopRefreshAfterSeconds:f.DEFAULT_STOP_REFRESH_AFTER_SECONDS,canRefreshNow:function(){return!0}}};var _=(function(){function T(w){this.enableConsoleLog=w}return T.prototype.onTrace=function(w){this.enableConsoleLog&&console.log("DeviceConfig trace: "+w)},T})();f.DefaultTrace=_;var v=(function(){function T(w){this.enableConsoleLog=w}return T.prototype.onValue=function(w){this.enableConsoleLog&&console.log("DeviceConfig analytics value:  ".concat(w))},T.prototype.onError=function(w){this.enableConsoleLog&&console.error("DeviceConfig analytics error: ".concat(w))},T.prototype.onTrace=function(w){this.enableConsoleLog&&console.log("DeviceConfig analytics trace: ".concat(w))},T.prototype.onAssignment=function(w){this.enableConsoleLog&&console.log("DeviceConfig analytics assignment: ".concat(w))},T})();f.DefaultAnalytics=v;var S=(function(){function T(w,R){this.prefix=w,this.storage=R}return T.prototype.getJson=function(w){var R=this.prefix+"_"+w;try{var C=this.storage.getItem(R);if(C)return JSON.parse(C)}catch(N){console.error("Error getting local storage key ".concat(R)+N)}return null},T.prototype.setJson=function(w,R){var C=this.prefix+"_"+w;try{this.storage.setItem(C,JSON.stringify(R))}catch(N){console.error("Error setting local storage key ".concat(C,": ")+N)}},T})();f.DefaultStorage=S;var b=(function(){function T(){}return T.prototype.getMillis=function(){return Date.now()},T})();f.DefaultClock=b},9225:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BucketAssignmentManager=f.PERCENTAGE_SUM_TOLERANCE=void 0;var p=d(8177),m=d(4293),_=d(5234);f.PERCENTAGE_SUM_TOLERANCE=.001;var v=(function(){function S(){}return S.prototype.roll=function(b){var T=(0,p.getSecureRandom)();return T.method!==p.SecureRandomMethod.CRYPTO_RANDOM_VALUES&&b.push({type:_.RolloutWarningType.NON_IDEAL_RANDOM_GENERATED,context:{details:T.method}}),T.value},S.prototype.assignVariant=function(b,T){var w=[],R=this.validateRollout(b,w);return R.ok?T&&b["rollout-id"]===T.rolloutId?(0,m.ok)({variant:T.assignedVariant,shouldUpdateState:!1,warnings:w}):b["force-redistribute"]?this.performInitialAssignment(b,w):T?this.performStickyAssignment(b,T,w):this.performInitialAssignment(b,w):R},S.prototype.validateRollout=function(b,T){var w=b.variants;if(w.length===0)return(0,m.err)("Empty variants array");var R=this.calculateTotalPercentage(w,T);return Math.abs(R-1)>f.PERCENTAGE_SUM_TOLERANCE?(0,m.err)("Variant percentages don't sum to 1.0 within ".concat(f.PERCENTAGE_SUM_TOLERANCE," tolerance (got ").concat(R,")")):(0,m.ok)(b)},S.prototype.calculateTotalPercentage=function(b,T){return b.reduce((function(w,R){var C=Object.values(R);return C.length>1&&T.push({type:_.RolloutWarningType.UNEXPECTED_VARIANT_PROPERTIES,context:{details:"Found more than 1 value for variant: ".concat(C)}}),w+C[0]}),0)},S.prototype.performInitialAssignment=function(b,T){var w=this.roll(T),R=this.selectVariantFromRoll(b.variants,w);return(0,m.ok)({variant:R,shouldUpdateState:!0,warnings:T})},S.prototype.performStickyAssignment=function(b,T,w){var R=T.assignedVariant,C=T.rolloutConfig,N=this.getVariantPercentage(b.variants,R),U=this.getVariantPercentage(C.variants,R);if(!N.ok)return this.performInitialAssignment(b,w);var B=N.value;if(!U.ok||B>=U.value)return U.ok||w.push({type:_.RolloutWarningType.PREVIOUS_VARIANT_NOT_FOUND,context:{details:"Previous variant not found: ".concat(R)}}),(0,m.ok)({variant:R,shouldUpdateState:!0,warnings:w});var $=B/U.value;if(this.roll(w)<=$)return(0,m.ok)({variant:R,shouldUpdateState:!0,warnings:w});var I=this.calculateFreeCapacity(b.variants,C.variants),L=this.roll(w),P=this.selectVariantFromRoll(I,L);return(0,m.ok)({variant:P,shouldUpdateState:!0,warnings:w})},S.prototype.getVariantPercentage=function(b,T){for(var w=0,R=b;w<R.length;w++){var C=R[w];if(C[T]!==void 0)return(0,m.ok)(C[T])}return(0,m.err)("variant not found")},S.prototype.selectVariantFromRoll=function(b,T){for(var w=0,R=0,C=b;R<C.length;R++){var N=C[R],U=Object.entries(N)[0],B=U[0];if(T<=(w+=U[1]))return B}return Object.keys(b[b.length-1])[0]},S.prototype.calculateFreeCapacity=function(b,T){for(var w,R=[],C=0,N=b;C<N.length;C++){var U=N[C],B=Object.entries(U)[0],$=B[0],I=B[1],L=this.getVariantPercentage(T,$),P=0;L.ok&&(P=L.value),I>P&&R.push(((w={})[$]=I-P,w))}return R},S})();f.BucketAssignmentManager=v},5234:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.RolloutManager=f.RolloutWarningType=void 0;var p,m=d(2570),_=d(9225),v=d(8177),S=d(4293);(function(T){T.STORAGE_INITIAL_LOAD_FAILED="STORAGE_INITIAL_LOAD_FAILED",T.STORAGE_INITIAL_LOAD_VERSION_MISMATCH="STORAGE_INITIAL_LOAD_VERSION_MISMATCH",T.STORAGE_INITIAL_SAVE_FAILED="STORAGE_INITIAL_SAVE_FAILED",T.STORAGE_SAVE_FAILED="STORAGE_SAVE_FAILED",T.UNEXPECTED_VARIANT_PROPERTIES="UNEXPECTED_VARIANT_PROPERTIES",T.PREVIOUS_VARIANT_NOT_FOUND="PREVIOUS_VARIANT_NOT_FOUND",T.NON_IDEAL_UUID_GENERATED="NON_IDEAL_UUID_GENERATED",T.NON_IDEAL_RANDOM_GENERATED="NON_IDEAL_RANDOM_GENERATED"})(p||(f.RolloutWarningType=p={}));var b=(function(){function T(w){this.rolloutStateManager=new m.LocalStorageRolloutStateManager(w),this.bucketAssignmentManager=new _.BucketAssignmentManager}return T.prototype.getVariantAssignment=function(w){var R=[],C=w["feature-id"],N=this.rolloutStateManager.getRolloutState(C),U=N.state,B=N.warnings;R.push.apply(R,B);var $=this.bucketAssignmentManager.assignVariant(w,U);if(!$.ok)return(0,S.err)($.error);R.push.apply(R,$.value.warnings);var I=U?.trackingId;if(!I){var L=(0,v.generateUuid)(),P=L.value,H=L.method;I=P,H!==v.UuidMethod.CRYPTO_RANDOM_UUID&&R.push({type:p.NON_IDEAL_UUID_GENERATED,context:{details:H}})}if($.value.shouldUpdateState){var X={rolloutId:w["rollout-id"],assignedVariant:$.value.variant,rolloutConfig:w,trackingId:I},G=this.rolloutStateManager.setRolloutState(C,X);R.push.apply(R,G.warnings)}return(0,S.ok)({variant:$.value.variant,featureId:C,rolloutId:w["rollout-id"],trackingId:I,warnings:R})},T})();f.RolloutManager=b},7974:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigRolloutSchema=f.DeviceConfigRolloutVariantSchema=void 0,f.DeviceConfigRolloutVariantSchema={},f.DeviceConfigRolloutSchema={variants:{type:"array",required:!0,items:{type:"object",required:!0,config:{schema:f.DeviceConfigRolloutVariantSchema}}},"feature-id":{type:"string",required:!0},"rollout-id":{type:"number",required:!0},"force-redistribute":{type:"boolean",required:!1},version:{type:"number",required:!0}}},2570:function(h,f,d){var p=this&&this.__spreadArray||function(v,S,b){if(b||arguments.length===2)for(var T,w=0,R=S.length;w<R;w++)!T&&w in S||(T||(T=Array.prototype.slice.call(S,0,w)),T[w]=S[w]);return v.concat(T||Array.prototype.slice.call(S))};Object.defineProperty(f,"__esModule",{value:!0}),f.LocalStorageRolloutStateManager=f.DEVICE_CONFIG_STORAGE_VERSION=void 0;var m=d(5234);f.DEVICE_CONFIG_STORAGE_VERSION=1;var _=(function(){function v(S){this.storageKey=(function(R){return"_amazon_ivs_dc_".concat(R,"_b8e4f7c1")})(S);var b=this.loadStorage(),T=b.storage,w=b.warnings;this.storage=T,this.loadWarnings=w}return v.prototype.getRolloutState=function(S){var b;return{state:((b=this.storage.features[S])===null||b===void 0?void 0:b.rolloutState)||null,warnings:p([],this.loadWarnings,!0)}},v.prototype.setRolloutState=function(S,b){return this.storage.features[S]||(this.storage.features[S]={}),this.storage.features[S].rolloutState=b,this.saveStorage()},v.prototype.loadStorage=function(){var S=[];try{var b=localStorage.getItem(this.storageKey);if(b){var T=JSON.parse(b);if(typeof T=="object"){if(T.version===f.DEVICE_CONFIG_STORAGE_VERSION)return{storage:T,warnings:S};S.push({type:m.RolloutWarningType.STORAGE_INITIAL_LOAD_VERSION_MISMATCH,context:{details:"Expected version ".concat(f.DEVICE_CONFIG_STORAGE_VERSION,", but got ").concat(T.version)}})}}}catch(R){S.push({type:m.RolloutWarningType.STORAGE_INITIAL_LOAD_FAILED,context:{error:R}})}var w={version:f.DEVICE_CONFIG_STORAGE_VERSION,features:{}};try{localStorage.setItem(this.storageKey,JSON.stringify(w))}catch(R){S.push({type:m.RolloutWarningType.STORAGE_INITIAL_SAVE_FAILED,context:{error:R}})}return{storage:w,warnings:S}},v.prototype.saveStorage=function(){try{return localStorage.setItem(this.storageKey,JSON.stringify(this.storage)),{warnings:[]}}catch(S){return{warnings:[{type:m.RolloutWarningType.STORAGE_SAVE_FAILED,context:{error:S}}]}}},v})();f.LocalStorageRolloutStateManager=_},3259:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.daysToSeconds=f.hoursToSeconds=f.minutesToSeconds=f.secondsToMillis=f.createPropertyMap=void 0;var p=d(4811);f.createPropertyMap=function(m){return new Map(Object.entries(m).map((function(_){var v=_[0],S=_[1];return[v,new p.Property(v,typeof S=="string"?p.ValueType.STRING:typeof S=="number"?p.ValueType.NUMBER:typeof S=="boolean"?p.ValueType.BOOLEAN:p.ValueType.JSON,typeof S=="string"?S:void 0,typeof S=="number"?S:void 0,typeof S=="boolean"?S:void 0,typeof S=="object"?JSON.stringify(S):void 0,v)]})))},f.secondsToMillis=function(m){return 1e3*m},f.minutesToSeconds=function(m){return 60*m},f.hoursToSeconds=function(m){return 60*m*60},f.daysToSeconds=function(m){return 60*m*60*24}},3723:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.WindowPropertyOverrider=void 0;var p=d(3259);f.WindowPropertyOverrider=function(m){return{getPropertyOverride:function(_){var v,S,b;if(((S=m?.AMAZON_IVS_DEVICE_CONFIG)===null||S===void 0?void 0:S.enableOverrides)===!0&&((b=m.AMAZON_IVS_DEVICE_CONFIG.propertyOverrides)===null||b===void 0?void 0:b[_])!==void 0){var T=m.AMAZON_IVS_DEVICE_CONFIG.propertyOverrides;return(0,p.createPropertyMap)((v={},v[_]=T[_],v)).get(_)}}}}},1743:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(b,T,w,R){R===void 0&&(R=w);var C=Object.getOwnPropertyDescriptor(T,w);C&&!("get"in C?!T.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return T[w]}}),Object.defineProperty(b,R,C)}:function(b,T,w,R){R===void 0&&(R=w),b[R]=T[w]}),m=this&&this.__setModuleDefault||(Object.create?function(b,T){Object.defineProperty(b,"default",{enumerable:!0,value:T})}:function(b,T){b.default=T}),_=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var T={};if(b!=null)for(var w in b)w!=="default"&&Object.prototype.hasOwnProperty.call(b,w)&&p(T,b,w);return m(T,b),T};Object.defineProperty(f,"__esModule",{value:!0}),f.validateSchemaAndReturn=f.validateSchema=void 0;var v=_(d(4293));function S(b,T){var w;if(b==null)return v.err("value is undefined or null");if(typeof b!="object")return v.err("value is not an object");for(var R=b,C=0,N=Object.entries(T);C<N.length;C++){var U=N[C],B=U[0],$=U[1];if($.type==="object"){if($.required&&!(B in R))return v.err("".concat(B," is required in schema"));if(R[B]&&!(H=S(R[B],(w=$?.config)===null||w===void 0?void 0:w.schema)).ok)return v.err("".concat(B," ").concat(H.error))}else if($.type==="array"){if($.required&&!(B in R))return v.err("".concat(B," is required in schema"));if(B in R){if(!Array.isArray(R[B]))return v.err("".concat(B," is not an array"));if($.items)for(var I=0,L=R[B];I<L.length;I++){var P=L[I];if($.items.type==="string"||$.items.type==="number"||$.items.type==="boolean"){if(typeof P!==$.items.type)return v.err("".concat(P," in ").concat(B," is not an ").concat($.items.type))}else if($.items.type==="object"&&$.items.config){var H;if(!(H=S(P,$.items.config.schema)).ok)return H}}}}else{if($.required&&!(B in R))return v.err("".concat(B," is required in schema"));if(B in R&&typeof R[B]!==$.type)return v.err("".concat(B," is not of type ").concat($.type))}}return v.ok(!0)}f.validateSchema=S,f.validateSchemaAndReturn=function(b,T){var w=S(b,T);return w.ok?v.ok(b):v.err(w.error)}},3840:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.validateSchema=void 0;var p=d(1743);Object.defineProperty(f,"validateSchema",{enumerable:!0,get:function(){return p.validateSchema}})},4811:function(h,f,d){var p,m=this&&this.__extends||(p=function(w,R){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,N){C.__proto__=N}||function(C,N){for(var U in N)Object.prototype.hasOwnProperty.call(N,U)&&(C[U]=N[U])},p(w,R)},function(w,R){if(typeof R!="function"&&R!==null)throw new TypeError("Class extends value "+String(R)+" is not a constructor or null");function C(){this.constructor=w}p(w,R),w.prototype=R===null?Object.create(R):(C.prototype=R.prototype,new C)});Object.defineProperty(f,"__esModule",{value:!0}),f.HttpError=f.StateHolder=f.Property=f.ValueType=f.DeviceConfigEnv=void 0;var _,v,S=d(7094);(function(w){w.BETA="beta",w.PROD="prod",w.CUSTOM="custom"})(_||(f.DeviceConfigEnv=_={})),(function(w){w[w.STRING=0]="STRING",w[w.NUMBER=1]="NUMBER",w[w.BOOLEAN=2]="BOOLEAN",w[w.JSON=3]="JSON"})(v||(f.ValueType=v={})),f.Property=function(w,R,C,N,U,B,$,I){switch(this.name=w,this.type=R,this.valueString=C,this.valueNumber=N,this.valueBoolean=U,this.valueJson=B,this.valueAnalytics=$,this.type){case v.STRING:I===S.ENCODING_BASE64&&C&&(this.valueString=atob(C));break;case v.JSON:I===S.ENCODING_BASE64&&B&&(this.valueJson=atob(B))}};var b=(function(){function w(R,C){var N;this.storage=R,this.key=C,this.state=(N=R.getJson(C))!==null&&N!==void 0?N:{}}return w.prototype.getState=function(){return this.state},w.prototype.setState=function(R){Object.assign(this.state,R),this.storage.setJson(this.key,this.state)},w})();f.StateHolder=b;var T=(function(w){function R(C){return w.call(this,C)||this}return m(R,w),R})(Error);f.HttpError=T},363:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(L){for(var P,H=1,X=arguments.length;H<X;H++)for(var G in P=arguments[H])Object.prototype.hasOwnProperty.call(P,G)&&(L[G]=P[G]);return L},p.apply(this,arguments)},m=this&&this.__spreadArray||function(L,P,H){if(H||arguments.length===2)for(var X,G=0,Y=P.length;G<Y;G++)!X&&G in P||(X||(X=Array.prototype.slice.call(P,0,G)),X[G]=P[G]);return L.concat(X||Array.prototype.slice.call(P))};Object.defineProperty(f,"__esModule",{value:!0}),f.DeviceConfigPropertyHolder=f.DeviceConfigManager=void 0;var _=d(4478),v=d(6270),S=d(4355),b=d(7094),T=d(3259),w=d(1743),R=d(3723),C=d(5234),N=d(7974),U=d(4811),B=(function(){function L(P,H){var X,G,Y,J;if(!H.fileKey)throw new Error("options.fileKey cannot be empty");var Q=(X=H.clock)!==null&&X!==void 0?X:new b.DefaultClock,z=Q.getMillis();switch(this.context=P,this.fileKey=H.fileKey,this.env=H.standardEnv,H.standardEnv){case U.DeviceConfigEnv.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case U.DeviceConfigEnv.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case U.DeviceConfigEnv.CUSTOM:if(!H.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=H.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(H.standardEnv))}this.trace=(G=H.trace)!==null&&G!==void 0?G:new b.DefaultTrace(H.enableConsoleLog),this.fetch=(Y=H.fetch)!==null&&Y!==void 0?Y:new I(P),this.storage=new b.DefaultStorage(b.STORAGE_PREFIX_KEY+H.fileKey,P.localStorage),this.state=new U.StateHolder(this.storage,b.STATE_KEY),this.refresh=p(p({},(0,b.getDefaultConfigRefreshOptions)()),H.refresh),this.emitMetrics=H.emitMetrics,this.analyticsProperties=(J=H.analyticsProperties)!==null&&J!==void 0?J:(0,b.getDefaultCommonAnalytics)(),this.enableConsoleLog=H.enableConsoleLog,this.clock=Q,this.isInitialRefreshDone=!1;var q=0,ee=this.state.getState();ee&&ee.fetchServer===this.fetchServer&&ee.lastFetchWhenMs&&(q=ee.lastFetchWhenMs);var te,ie=Q.getMillis(),Ee=(ie-q)/1e3;if(Ee<=this.refresh.maxCacheAgeSeconds){var Re=this.storage.getJson(b.DATA_KEY);Re&&Re.fetchServer===this.fetchServer&&this.setData(Re.json)}this.lastUseMs=ie,Ee>=this.refresh.refreshIntervalSeconds||q==0?te=0:(te=Math.round(this.refresh.refreshIntervalSeconds-Ee),this.isInitialRefreshDone=!0),te<5&&(te=b.DEFAULT_INITIAL_DELAY_SECONDS),this.trace.onTrace("Will start refresh in "+te+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*te);var Te=Q.getMillis();this.initialLoadTime=Te-z}return L.getInstance=function(P,H){try{if(!(P.fetch&&P.setTimeout&&P.clearTimeout&&P.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(X){return void console.error("Error checking for context properties "+X)}if(this.gInstance){if(this.gInstance.fileKey!=H.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(H.fileKey));return this.gInstance}return this.gInstance=new L(P,H),this.gInstance},L.prototype.getConfigurationHolder=function(P){var H,X,G,Y=this.clock.getMillis();this.lastUseMs=Y;var J=(H=P.analytics)!==null&&H!==void 0?H:new b.DefaultAnalytics(this.enableConsoleLog),Q=0,z=this.state.getState();return z&&z.fetchServer===this.fetchServer&&z.lastFetchWhenMs&&(Q=z.lastFetchWhenMs),(Y-Q)/1e3<=this.refresh.maxCacheAgeSeconds?new $(J,this.analyticsProperties,this.properties,Q,this.clock,this.fileKey,(X=this.enableConsoleLog)!==null&&X!==void 0&&X):new $(J,this.analyticsProperties,void 0,0,this.clock,this.fileKey,(G=this.enableConsoleLog)!==null&&G!==void 0&&G)},L.prototype.getFetchUrl=function(){var P="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),H=new URL(P);return H.searchParams.set("version","1.0"),H},L.clearInstance=function(){var P;(P=this.gInstance)===null||P===void 0||P.clearInstanceImpl(),this.gInstance=void 0},L.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},L.prototype.startRefresh=function(){var P=this;this.trace.onTrace("Starting refresh request"),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds);var H=this.clock.getMillis();if((H-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds)this.trace.onTrace("Will not refresh due to refresh timeout");else if(!this.isInitialRefreshDone||this.refresh.canRefreshNow()){this.isInitialRefreshDone=!0;var X={};this.fetchData().then((function(G){P.processResponse(G,X,H),P.emitMetricsImpl(X)})).catch((function(G){P.exceptionMetrics(X,G),P.emitMetricsImpl(X),P.trace.onTrace("Fetch error: "+G),P.refresh.retryCount>0&&P.scheduleRetry(1)}))}else this.trace.onTrace("Will not refresh due to callback having returned false")},L.prototype.fetchData=function(){var P=this.getFetchUrl(),H=new Headers,X=this.state.getState();return X.fetchServer===this.fetchServer&&(X.lastFetchWhenFullMs&&this.clock.getMillis()-X.lastFetchWhenFullMs>1e3*(0,T.hoursToSeconds)(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&X.lastFetchEtagHeader&&H.set("If-None-Match",X.lastFetchEtagHeader)),this.fetch.fetchUrl(P,H)},L.prototype.processResponse=function(P,H,X){var G={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},Y=P.headers.get("etag");if(Y&&(G.lastFetchEtagHeader=Y),P.status<300&&P.json)if(this.setData(P.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(b.DATA_KEY,{fetchServer:this.fetchServer,json:P.json});var J=this.clock.getMillis();G.lastFetchWhenFullMs=J,this.state.setState(G),H.success_new_data_count=1,H.fetch_duration_average=Math.max(0,J-X)}else H.fail_invalid_data_count=1;else{if(P.status!==304){var Q="Unexpected http fetch status: "+P.status;throw this.trace.onTrace(Q),new U.HttpError(Q)}this.trace.onTrace("Server said no change in data"),J=this.clock.getMillis(),G.lastFetchWhenMs=J,this.state.setState(G),H.success_no_change_count=1,H.fetch_duration_average=Math.max(0,J-X)}},L.prototype.scheduleRetry=function(P){var H=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var X=P*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout((function(){H.retryTask=void 0,H.fetchRetry(P)}),1e3*X)},L.prototype.fetchRetry=function(P){var H=this;this.trace.onTrace("Starting retry request ".concat(P,"..."));var X={},G=this.clock.getMillis();this.fetchData().then((function(Y){H.processResponse(Y,X,G),H.emitMetricsImpl(X)})).catch((function(Y){H.exceptionMetrics(X,Y),H.emitMetricsImpl(X),H.trace.onTrace("Fetch error: "+Y),H.refresh.retryCount>P&&H.scheduleRetry(P+1)}))},L.prototype.setData=function(P){if(!P)return!1;if(P.version!=="1.0")return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var H=P.properties;if(!H||!Array.isArray(H))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var X=new Map,G=0,Y=H;G<Y.length;G++){var J=Y[G];if(J.name&&J.type&&this.isValidValueType(J.type)){if(J.value_string&&typeof J.value_string!="string"){this.trace.onTrace("Invalid type of value.value_string "+typeof J.value_string);continue}if(J.value_number&&typeof J.value_number!="number"){this.trace.onTrace("Invalid type of value.value_number "+typeof J.value_number);continue}if(J.value_boolean&&typeof J.value_boolean!="boolean"){this.trace.onTrace("Invalid type of value.value_boolean "+typeof J.value_boolean);continue}if(J.value_json&&typeof J.value_json!="string"){this.trace.onTrace("Invalid type of value.value_json "+typeof J.value_json);continue}if(J.value_analytics&&typeof J.value_analytics!="string"){this.trace.onTrace("Invalid type of item.value_analytics "+typeof J.value_analytics);continue}var Q=new U.Property(J.name,this.parseValueType(J.type),J.value_string,J.value_number,J.value_boolean,J.value_json,J.value_analytics,J.encoding);X.set(Q.name,Q)}}return X.size!=0&&(this.properties=X,!0)},L.prototype.isValidValueType=function(P){return P==="string"||P==="number"||P==="boolean"||P=="json"},L.prototype.parseValueType=function(P){switch(P){case"string":return U.ValueType.STRING;case"number":return U.ValueType.NUMBER;case"boolean":return U.ValueType.BOOLEAN;case"json":return U.ValueType.JSON;default:throw new Error("Unsupported value type ".concat(P))}},L.prototype.emitMetricsImpl=function(P){var H,X,G,Y,J,Q,z=p(p({},this.analyticsProperties),{initial_load_time:this.initialLoadTime,fetch_attempt_count:1,fetch_duration_average:(H=P.fetch_duration_average)!==null&&H!==void 0?H:0,success_no_change_count:(X=P.success_no_change_count)!==null&&X!==void 0?X:0,success_new_data_count:(G=P.success_new_data_count)!==null&&G!==void 0?G:0,fail_exception_count:(Y=P.fail_exception_count)!==null&&Y!==void 0?Y:0,fail_http_error_count:(J=P.fail_http_error_count)!==null&&J!==void 0?J:0,fail_invalid_data_count:(Q=P.fail_invalid_data_count)!==null&&Q!==void 0?Q:0});this.emitMetrics(z)},L.prototype.exceptionMetrics=function(P,H){H instanceof U.HttpError||typeof H?.message=="string"&&H.message.indexOf("http error")===0?P.fail_http_error_count=1:P.fail_exception_count=1},L})();f.DeviceConfigManager=B;var $=(function(){function L(P,H,X,G,Y,J,Q){Q===void 0&&(Q=!1);var z=this;this.emitValue=function(q,ee){z.analytics.onValue(p(p({},z.analyticsProperties),{key_name:q,value:"".concat(ee),fetched_seconds_ago:z.getFetchedSecondsAgo()}))},this.emitTrace=function(q,ee){z.analytics.onTrace(p(p({},z.analyticsProperties),{key_name:q,message:ee}))},this.emitError=function(q,ee){z.analytics.onError(p(p({},z.analyticsProperties),{key_name:q,message:ee}))},this.emitAssignment=function(q){var ee=q.warnings.map((function(te){return te.type})).join(",");z.analytics.onAssignment(p(p({},z.analyticsProperties),{assignment:q.variant,feature_id:q.featureId,rollout_id:q.rolloutId,tracking_id:q.trackingId,warnings:ee}))},this.analytics=P,this.analyticsProperties=H,this.properties=X,this.dataFetchedWhenMs=G,this.clock=Y,this.fileKey=J,this.enableConsoleLog=Q,this.overrider=(0,R.WindowPropertyOverrider)(window)}return L.prototype.getSize=function(){return this.properties?this.properties.size:-1},L.prototype.getProperty=function(P){var H=this.overrider.getPropertyOverride(P);if(H)return this.debugLog("Using override for key: ".concat(P)),H;if(this.properties){var X=this.properties.get(P);if(X)return X;this.emitError(P,"No property exists for key name")}else this.emitTrace(P,"No properties, local cache is expired")},L.prototype.getStringValue=function(P){var H,X,G=this.getProperty(P);if(G){if(G.type===U.ValueType.STRING){var Y=(H=G.valueString)!==null&&H!==void 0?H:"";return this.emitValue(G.name,(X=G.valueAnalytics)!==null&&X!==void 0?X:Y),Y}this.emitError(G.name,"Type is not a string")}},L.prototype.getNumberValue=function(P){var H,X,G=this.getProperty(P);if(G){if(G.type===U.ValueType.NUMBER){var Y=(H=G.valueNumber)!==null&&H!==void 0?H:0;return this.emitValue(G.name,(X=G.valueAnalytics)!==null&&X!==void 0?X:Y),Y}this.emitError(G.name,"Type is not a number")}},L.prototype.getBooleanValue=function(P){var H,X,G=this.getProperty(P);if(G){if(G.type===U.ValueType.BOOLEAN){var Y=(H=G.valueBoolean)!==null&&H!==void 0&&H;return this.emitValue(G.name,(X=G.valueAnalytics)!==null&&X!==void 0?X:Y),Y}this.emitError(G.name,"Type is not a boolean")}},L.prototype.getJsonValue=function(P){var H,X,G=this.getProperty(P);if(G)if(G.type===U.ValueType.JSON){var Y=(H=G.valueAnalytics)!==null&&H!==void 0?H:"",J=G.valueJson;if(J)try{var Q=JSON.parse(J);return this.emitValue(G.name,(X=G.valueAnalytics)!==null&&X!==void 0?X:Q),Q}catch{return void this.emitError(G.name,"JSON parse error")}else this.emitValue(G.name,Y)}else this.emitError(G.name,"Type is not JSON")},L.prototype.getResolvedConfigForPropertyKey=function(P){var H=P.key,X=P.context,G=P.schema,Y=P.trace,J=Y!==void 0&&Y,Q=this.getJsonValue(H);if(Q!==void 0)if(Q.length!==0){for(var z=[],q=0,ee=Q;q<ee.length;q++){var te=ee[q];(ht=(0,w.validateSchema)(te,v.DeviceConfigCriteriaConfigSchema)).ok?z.push(te):this.emitError(H,"Criteria structure invalid: ".concat(ht.error))}for(var ie=new S.CriteriaInputs(X),Ee=[],Re=0,Te=z;Re<Te.length;Re++)te=Te[Re],(ht=v.CriteriaParser.evaluateCriteria(te,ie)).ok?ht.value.matched&&Ee.push(ht.value.payload):this.emitError(H,ht.error);if(Ee.length!==0){for(var Pe=[],We=0,it=Ee;We<it.length;We++){var ht;te=it[We],(ht=(0,w.validateSchema)(te,G)).ok?Pe.push(te):this.emitError(H,"Payload structure invalid: ".concat(ht.error))}var vt=_.mergeConfigs.apply(void 0,m([{}],Pe,!1)),re=JSON.stringify(vt);return this.emitValue(H,"Resolved: ".concat(re)),vt}if(J){var Le=z.length;this.emitTrace(H,"No matches from ".concat(Le," payloads"))}}else J&&this.emitTrace(H,"No payloads exist for key")},L.prototype.getResolvedExperimentForPropertyKeys=function(P){for(var H=P.keys,X=P.context,G=P.trace,Y=G!==void 0&&G,J={},Q=new C.RolloutManager(this.fileKey),z=0,q=H;z<q.length;z++){var ee=q[z];J[ee]=this.processExperimentKey(ee,X,Y,Q)}return J},L.prototype.processExperimentKey=function(P,H,X,G){var Y=this.getJsonValue(P);if(Y!==void 0)if(Y.length!==0){for(var J=[],Q=0,z=Y;Q<z.length;Q++){var q=z[Q],ee=(0,w.validateSchema)(q,v.DeviceConfigCriteriaConfigSchema);ee.ok?J.push(q):this.emitError(P,"Criteria structure invalid: ".concat(ee.error))}var te=this.getMatchedCriteria(J,H,P),ie=this.validateMatchedPayloads(te,P),Ee=this.selectPayload(ie);if(Ee){var Re=G.getVariantAssignment(Ee);if(Re.ok){var Te=Re.value;return this.emitAssignment(Te),X&&this.emitTrace(P,"Experiment variant assigned: ".concat(Te.variant)),Te}this.emitError(P,"Experiment assignment failed: ".concat(Re.error))}else X&&this.emitTrace(P,"No matching criteria from ".concat(J.length," experiment payloads"))}else X&&this.emitTrace(P,"No experiment payloads exist for key")},L.prototype.getMatchedCriteria=function(P,H,X){for(var G=new S.CriteriaInputs(H),Y=[],J=0,Q=P;J<Q.length;J++){var z=Q[J],q=v.CriteriaParser.evaluateCriteria(z,G);q.ok?q.value.matched&&Y.push(q.value.payload):this.emitError(X,q.error)}return Y},L.prototype.validateMatchedPayloads=function(P,H){for(var X=[],G=0,Y=P;G<Y.length;G++){var J=Y[G];if(J){var Q=(0,w.validateSchemaAndReturn)(J,N.DeviceConfigRolloutSchema);Q.ok?X.push(Q.value):this.emitError(H,"Rollout payload invalid: ".concat(Q.error))}}return X},L.prototype.selectPayload=function(P){return P.length>0?P[0]:void 0},L.prototype.getFetchedSecondsAgo=function(){if(this.dataFetchedWhenMs)return(this.clock.getMillis()-this.dataFetchedWhenMs)/1e3},L.prototype.debugLog=function(P){this.enableConsoleLog&&console.log("[DeviceConfig] ".concat(P))},L})();f.DeviceConfigPropertyHolder=$;var I=(function(){function L(P){this.context=P}return L.prototype.fetchUrl=function(P,H){var X=this,G={headers:H,cache:"no-store"},Y=null;if(typeof AbortController<"u"){var J=new AbortController;Y=this.context.setTimeout((function(){return J.abort()}),1e3*b.DEFAULT_HTTP_TIMEOUT_SECONDS),G.signal=J.signal}return new Promise((function(Q,z){X.context.fetch(P,G).then((function(q){if(q.status>=400)z(new U.HttpError("http error ".concat(q.status,", ").concat(q.statusText)));else{var ee={status:q.status,headers:q.headers};q.json().then((function(te){ee.json=te,Q(ee)})).catch((function(){Q(ee)}))}})).catch((function(q){z(q)})).finally((function(){Y&&X.context.clearTimeout(Y)}))}))},L})()},3864:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(_,v,S,b){b===void 0&&(b=S);var T=Object.getOwnPropertyDescriptor(v,S);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[S]}}),Object.defineProperty(_,b,T)}:function(_,v,S,b){b===void 0&&(b=S),_[b]=v[S]}),m=this&&this.__exportStar||function(_,v){for(var S in _)S==="default"||Object.prototype.hasOwnProperty.call(v,S)||p(v,_,S)};Object.defineProperty(f,"__esModule",{value:!0}),m(d(363),f),m(d(4811),f),m(d(7094),f),m(d(3259),f),m(d(3840),f),m(d(6270),f)},9456:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(_,v,S,b){b===void 0&&(b=S);var T=Object.getOwnPropertyDescriptor(v,S);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[S]}}),Object.defineProperty(_,b,T)}:function(_,v,S,b){b===void 0&&(b=S),_[b]=v[S]}),m=this&&this.__exportStar||function(_,v){for(var S in _)S==="default"||Object.prototype.hasOwnProperty.call(v,S)||p(v,_,S)};Object.defineProperty(f,"__esModule",{value:!0}),m(d(8903),f)},8903:function(h,f,d){var p=this&&this.__spreadArray||function(v,S,b){if(b||arguments.length===2)for(var T,w=0,R=S.length;w<R;w++)!T&&w in S||(T||(T=Array.prototype.slice.call(S,0,w)),T[w]=S[w]);return v.concat(T||Array.prototype.slice.call(S))};Object.defineProperty(f,"__esModule",{value:!0}),f.TypedEmitter=void 0;var m=d(228),_=(function(){function v(S){var b;this.emitter=new m.EventEmitter,this.propagateErrors=(b=S?.propagateErrors)!==null&&b!==void 0&&b}return v.prototype.on=function(S,b){b.call=this.wrapCall(S,b),this.emitter.on(S,b)},v.prototype.off=function(S,b){this.emitter.off(S,b)},v.prototype.emit=function(S){for(var b,T=[],w=1;w<arguments.length;w++)T[w-1]=arguments[w];(b=this.emitter).emit.apply(b,p([S],T,!1))},v.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},v.prototype.wrapCall=function(S,b){var T=this;return function(w){for(var R=[],C=1;C<arguments.length;C++)R[C-1]=arguments[C];if(T.propagateErrors)b.apply(w,R);else try{b.apply(w,R)}catch(B){var N="Error in callback for ".concat(S),U=b.name;return U&&(N+=" for function ".concat(U)),void console.error(N,B)}}},v})();f.TypedEmitter=_},5987:function(h,f,d){var p,m=this&&this.__extends||(p=function(R,C){return p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,U){N.__proto__=U}||function(N,U){for(var B in U)Object.prototype.hasOwnProperty.call(U,B)&&(N[B]=U[B])},p(R,C)},function(R,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function N(){this.constructor=R}p(R,C),R.prototype=C===null?Object.create(C):(N.prototype=C.prototype,new N)}),_=this&&this.__createBinding||(Object.create?function(R,C,N,U){U===void 0&&(U=N);var B=Object.getOwnPropertyDescriptor(C,N);B&&!("get"in B?!C.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return C[N]}}),Object.defineProperty(R,U,B)}:function(R,C,N,U){U===void 0&&(U=N),R[U]=C[N]}),v=this&&this.__setModuleDefault||(Object.create?function(R,C){Object.defineProperty(R,"default",{enumerable:!0,value:C})}:function(R,C){R.default=C}),S=this&&this.__importStar||function(R){if(R&&R.__esModule)return R;var C={};if(R!=null)for(var N in R)N!=="default"&&Object.prototype.hasOwnProperty.call(R,N)&&_(C,R,N);return v(C,R),C};Object.defineProperty(f,"__esModule",{value:!0}),f.createFsm=f.FsmWildcardState=f.RejectedTransitionError=f.InvalidStateTransitionError=void 0;var b=S(d(4293)),T=(function(R){function C(N,U){var B=R.call(this,"Invalid transition from '".concat(U,"' via event '").concat(N,"'"))||this;return B.name="InvalidStateTransitionError",B}return m(C,R),C})(Error);f.InvalidStateTransitionError=T;var w=(function(R){function C(N,U,B){var $=R.call(this,"Transition from '".concat(U,"' via event '").concat(N,"' was rejected for: ").concat(B))||this;return $.name="RejectedTransitionError",$}return m(C,R),C})(Error);f.RejectedTransitionError=w,f.FsmWildcardState="*",f.createFsm=function(R){var C,N=R.transitions,U=R.callbacks,B=R.initialState,$=function(I){var L,P=(L=N[I])===null||L===void 0?void 0:L.from;return!!P&&(typeof P=="string"?P===f.FsmWildcardState:P.includes(B))};return{canTransition:$,transition:function(I,L){var P,H,X,G,Y,J;if(!$(I))return b.err(new T(String(B),String(I)));var Q=N[I];return Q.shouldTransition===void 0||Q.shouldTransition(B)?((H=(P=U?.[B])===null||P===void 0?void 0:P.onExiting)===null||H===void 0||H.call(P),(X=U?.onStateExiting)===null||X===void 0||X.call(U,B),C=B,B=Q.to,(Y=(G=U?.[B])===null||G===void 0?void 0:G.onChanged)===null||Y===void 0||Y.call(G,C,L),(J=U?.onStateChanged)===null||J===void 0||J.call(U,C,B,L),b.ok(B)):b.err(new w(String(B),String(I),"shouldTransition returned false"))},previousState:function(){return C},currentState:function(){return B}}}},8156:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(_,v,S,b){b===void 0&&(b=S);var T=Object.getOwnPropertyDescriptor(v,S);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[S]}}),Object.defineProperty(_,b,T)}:function(_,v,S,b){b===void 0&&(b=S),_[b]=v[S]}),m=this&&this.__exportStar||function(_,v){for(var S in _)S==="default"||Object.prototype.hasOwnProperty.call(v,S)||p(v,_,S)};Object.defineProperty(f,"__esModule",{value:!0}),f.VERSION=void 0,f.VERSION="0.10.0",m(d(3864),f),m(d(9456),f),m(d(5987),f),m(d(9266),f),m(d(6925),f)},6925:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(_,v,S,b){b===void 0&&(b=S);var T=Object.getOwnPropertyDescriptor(v,S);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[S]}}),Object.defineProperty(_,b,T)}:function(_,v,S,b){b===void 0&&(b=S),_[b]=v[S]}),m=this&&this.__exportStar||function(_,v){for(var S in _)S==="default"||Object.prototype.hasOwnProperty.call(v,S)||p(v,_,S)};Object.defineProperty(f,"__esModule",{value:!0}),m(d(6166),f),m(d(7612),f),m(d(7056),f),m(d(8139),f),m(d(3877),f)},6166:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(R){for(var C,N=1,U=arguments.length;N<U;N++)for(var B in C=arguments[N])Object.prototype.hasOwnProperty.call(C,B)&&(R[B]=C[B]);return R},p.apply(this,arguments)},m=this&&this.__spreadArray||function(R,C,N){if(N||arguments.length===2)for(var U,B=0,$=C.length;B<$;B++)!U&&B in C||(U||(U=Array.prototype.slice.call(C,0,B)),U[B]=C[B]);return R.concat(U||Array.prototype.slice.call(C))};Object.defineProperty(f,"__esModule",{value:!0}),f.getLogConfig=f.setLogConfig=f.setLogConfigByLevel=f.extractLogConfig=void 0;var _=d(7612),v=d(7056),S=d(8139),b=d(4478),T={enabled:!1,levels:{debug:!0,log:!0,info:!0,warn:!0,error:!0},targets:[(0,v.createConsoleLogTarget)()],categories:{}},w=Object.keys(T);f.extractLogConfig=function(R){var C={};if(Object.keys(R).some((function(I){return w.includes(I)}))){for(var N=0,U=w;N<U.length;N++){var B=U[N];if(R[B]!==void 0){var $=R[B];C[B]=$}}return C}},f.setLogConfigByLevel=function(R){var C=R.enabled||T.enabled,N=R.targets||T.targets,U={debug:!1,log:!1,info:!1,warn:!1,error:!1},B=function($,I){for(var L=0,P=$;L<P.length;L++){var H=P[L];U[H]=I}};switch(R.level){case"debug":B(["debug","log","info","warn","error"],C);break;case"log":B(["log","info","warn","error"],C);break;case"info":B(["info","warn","error"],!0);break;case"warn":B(["warn","error"],!0);break;case"error":B(["error"],!0)}(0,f.setLogConfig)({enabled:C,levels:U,targets:N})},f.setLogConfig=function(R){var C=(0,b.mergeConfigs)(T,R);C&&(T=C,_.defaultLogEmitter.emit(S.LogEventType.CONFIG_UPDATED,T))},f.getLogConfig=function(){return{enabled:T.enabled,levels:p({},T.levels),targets:m([],T.targets,!0),categories:p({},T.categories)}}},7612:(h,f,d)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.defaultLogEmitter=void 0;var p=d(9456);f.defaultLogEmitter=new p.TypedEmitter({})},7056:function(h,f,d){var p=this&&this.__spreadArray||function(_,v,S){if(S||arguments.length===2)for(var b,T=0,w=v.length;T<w;T++)!b&&T in v||(b||(b=Array.prototype.slice.call(v,0,T)),b[T]=v[T]);return _.concat(b||Array.prototype.slice.call(v))};Object.defineProperty(f,"__esModule",{value:!0}),f.createEventLogTarget=f.createConsoleLogTarget=void 0;var m=d(8139);f.createConsoleLogTarget=function(){return{handleMessage:function(_){for(var v=[],S=1;S<arguments.length;S++)v[S-1]=arguments[S];console[_].apply(console,v)}}},f.createEventLogTarget=function(_){return{handleMessage:function(v){for(var S=[],b=1;b<arguments.length;b++)S[b-1]=arguments[b];_.emit.apply(_,p([m.LogEventType.MESSAGE_LOGGED,v],S,!1))}}}},8139:(h,f)=>{var d;Object.defineProperty(f,"__esModule",{value:!0}),f.LogEventType=void 0,(function(p){p.CONFIG_UPDATED="logConfigUpdated",p.MESSAGE_LOGGED="messageLogged"})(d||(f.LogEventType=d={}))},3877:function(h,f,d){var p=this&&this.__assign||function(){return p=Object.assign||function(w){for(var R,C=1,N=arguments.length;C<N;C++)for(var U in R=arguments[C])Object.prototype.hasOwnProperty.call(R,U)&&(w[U]=R[U]);return w},p.apply(this,arguments)},m=this&&this.__spreadArray||function(w,R,C){if(C||arguments.length===2)for(var N,U=0,B=R.length;U<B;U++)!N&&U in R||(N||(N=Array.prototype.slice.call(R,0,U)),N[U]=R[U]);return w.concat(N||Array.prototype.slice.call(R))};Object.defineProperty(f,"__esModule",{value:!0}),f.createLogger=void 0;var _=d(4478),v=d(6166),S=d(7612),b=d(8139),T=function(w,R){return(0,_.mergeConfigs)(w,R)||w};f.createLogger=function(w){var R=w.name,C=w.category,N=w.parent,U=(0,v.extractLogConfig)(w)||{},B=T((0,v.getLogConfig)(),U);S.defaultLogEmitter.on(b.LogEventType.CONFIG_UPDATED,(function(H){B=T(H,U||{})}));var $=function(H){for(var X=[],G=1;G<arguments.length;G++)X[G-1]=arguments[G];if(N&&!N.canLog(H)||!L(H))return!1;for(var Y=I(),J=new Date().toTimeString().split(" ")[0],Q=m(["".concat(J," - (").concat(Y,")")],X,!0),z=0,q=B.targets;z<q.length;z++){var ee=q[z];ee.handleMessage.apply(ee,m([H],Q,!1))}return!0},I=function(){return N?"".concat(N.getName()," | ").concat(R):R},L=function(H){return!(!B.enabled||!B.levels[H]||B.targets.length===0||C!==void 0&&!B.categories[C])},P={debug:function(){for(var H=[],X=0;X<arguments.length;X++)H[X]=arguments[X];return $.apply(void 0,m(["debug"],H,!1))},log:function(){for(var H=[],X=0;X<arguments.length;X++)H[X]=arguments[X];return $.apply(void 0,m(["log"],H,!1))},info:function(){for(var H=[],X=0;X<arguments.length;X++)H[X]=arguments[X];return $.apply(void 0,m(["info"],H,!1))},warn:function(){for(var H=[],X=0;X<arguments.length;X++)H[X]=arguments[X];return $.apply(void 0,m(["warn"],H,!1))},error:function(){for(var H=[],X=0;X<arguments.length;X++)H[X]=arguments[X];return $.apply(void 0,m(["error"],H,!1))},getName:I,canLog:L,getChildLogger:function(H){return(0,f.createLogger)(p(p({},H),{parent:P}))},setConfig:function(H){B=T(B,U=H)}};return P}},8177:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(C,N,U,B){B===void 0&&(B=U);var $=Object.getOwnPropertyDescriptor(N,U);$&&!("get"in $?!N.__esModule:$.writable||$.configurable)||($={enumerable:!0,get:function(){return N[U]}}),Object.defineProperty(C,B,$)}:function(C,N,U,B){B===void 0&&(B=U),C[B]=N[U]}),m=this&&this.__setModuleDefault||(Object.create?function(C,N){Object.defineProperty(C,"default",{enumerable:!0,value:N})}:function(C,N){C.default=N}),_=this&&this.__importStar||function(C){if(C&&C.__esModule)return C;var N={};if(C!=null)for(var U in C)U!=="default"&&Object.prototype.hasOwnProperty.call(C,U)&&p(N,C,U);return m(N,C),N},v=this&&this.__awaiter||function(C,N,U,B){return new(U||(U=Promise))((function($,I){function L(X){try{H(B.next(X))}catch(G){I(G)}}function P(X){try{H(B.throw(X))}catch(G){I(G)}}function H(X){var G;X.done?$(X.value):(G=X.value,G instanceof U?G:new U((function(Y){Y(G)}))).then(L,P)}H((B=B.apply(C,N||[])).next())}))},S=this&&this.__generator||function(C,N){var U,B,$,I,L={label:0,sent:function(){if(1&$[0])throw $[1];return $[1]},trys:[],ops:[]};return I={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(I[Symbol.iterator]=function(){return this}),I;function P(H){return function(X){return(function(G){if(U)throw new TypeError("Generator is already executing.");for(;I&&(I=0,G[0]&&(L=0)),L;)try{if(U=1,B&&($=2&G[0]?B.return:G[0]?B.throw||(($=B.return)&&$.call(B),0):B.next)&&!($=$.call(B,G[1])).done)return $;switch(B=0,$&&(G=[2&G[0],$.value]),G[0]){case 0:case 1:$=G;break;case 4:return L.label++,{value:G[1],done:!1};case 5:L.label++,B=G[1],G=[0];continue;case 7:G=L.ops.pop(),L.trys.pop();continue;default:if(!(($=($=L.trys).length>0&&$[$.length-1])||G[0]!==6&&G[0]!==2)){L=0;continue}if(G[0]===3&&(!$||G[1]>$[0]&&G[1]<$[3])){L.label=G[1];break}if(G[0]===6&&L.label<$[1]){L.label=$[1],$=G;break}if($&&L.label<$[2]){L.label=$[2],L.ops.push(G);break}$[2]&&L.ops.pop(),L.trys.pop();continue}G=N.call(C,L)}catch(Y){G=[6,Y],B=0}finally{U=$=0}if(5&G[0])throw G[1];return{value:G[0]?G[1]:void 0,done:!0}})([H,X])}}};Object.defineProperty(f,"__esModule",{value:!0}),f.generateUuid=f.getSecureRandom=f.UuidMethod=f.SecureRandomMethod=f.hashProperty=void 0;var b,T,w=_(d(4293));function R(){if(typeof crypto<"u"&&crypto.getRandomValues)try{var C=new Uint32Array(1);return crypto.getRandomValues(C),{value:C[0]/4294967296,method:b.CRYPTO_RANDOM_VALUES}}catch{}return{value:Math.random(),method:b.MATH_RANDOM}}f.hashProperty=function(C){return v(void 0,void 0,void 0,(function(){var N,U,B,$,I;return S(this,(function(L){switch(L.label){case 0:if(typeof crypto>"u")return[2,w.err("WebCrypto is unsupported, skipping hash")];if(typeof(crypto==null?void 0:crypto.subtle.digest)!="function")return[2,w.err("WebCrypto subtle.digest does not exist, possible insecure origin")];L.label=1;case 1:return L.trys.push([1,3,,4]),N=new TextEncoder().encode(C),[4,crypto.subtle.digest("SHA-256",N)];case 2:return U=L.sent(),B=Array.from(new Uint8Array(U)),$=B.map((function(P){return P.toString(16).padStart(2,"0")})).join(""),[2,w.ok({key:C,hash:$})];case 3:return I=L.sent(),[2,w.err("Unable to hash rule: ".concat(I))];case 4:return[2]}}))}))},(function(C){C.CRYPTO_RANDOM_VALUES="crypto-random-values",C.MATH_RANDOM="math-random"})(b||(f.SecureRandomMethod=b={})),(function(C){C.CRYPTO_RANDOM_UUID="crypto-random-uuid",C.MANUAL_CRYPTO_RANDOM_VALUES="manual-crypto-random-values",C.MANUAL_MATH_RANDOM="manual-math-random"})(T||(f.UuidMethod=T={})),f.getSecureRandom=R,f.generateUuid=function(){if(typeof crypto<"u"&&crypto.randomUUID)try{return{value:crypto.randomUUID(),method:T.CRYPTO_RANDOM_UUID}}catch{}for(var C="0123456789abcdef",N="",U=T.MANUAL_CRYPTO_RANDOM_VALUES,B=0;B<36;B++)if(B===8||B===13||B===18||B===23)N+="-";else if(B===14)N+="4";else if(B===19)($=R()).method===b.MATH_RANDOM&&(U=T.MANUAL_MATH_RANDOM),N+=C[Math.floor(4*$.value)+8];else{var $;($=R()).method===b.MATH_RANDOM&&(U=T.MANUAL_MATH_RANDOM),N+=C[Math.floor(16*$.value)]}return{value:N,method:U}}},9266:function(h,f,d){var p=this&&this.__createBinding||(Object.create?function(_,v,S,b){b===void 0&&(b=S);var T=Object.getOwnPropertyDescriptor(v,S);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[S]}}),Object.defineProperty(_,b,T)}:function(_,v,S,b){b===void 0&&(b=S),_[b]=v[S]}),m=this&&this.__exportStar||function(_,v){for(var S in _)S==="default"||Object.prototype.hasOwnProperty.call(v,S)||p(v,_,S)};Object.defineProperty(f,"__esModule",{value:!0}),m(d(8177),f),m(d(3012),f),m(d(4293),f)},4478:function(h,f,d){var p=this&&this.__spreadArray||function(S,b,T){if(T||arguments.length===2)for(var w,R=0,C=b.length;R<C;R++)!w&&R in b||(w||(w=Array.prototype.slice.call(b,0,R)),w[R]=b[R]);return S.concat(w||Array.prototype.slice.call(b))},m=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(f,"__esModule",{value:!0}),f.mergeConfigs=void 0;var _=m(d(6924)),v=function(S,b){if(Array.isArray(S))return b};f.mergeConfigs=function(S){for(var b=[],T=1;T<arguments.length;T++)b[T-1]=arguments[T];var w=b.map((function(R){return R==null||typeof R!="object"})).filter(Boolean).length>0;if(typeof S=="object"&&!w)return _.default.apply(void 0,p(p([{},S],b,!1),[v],!1))}},4293:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.getErr=f.getOk_or=f.getOk=f.isNotOk=f.isOk=f.err=f.ok=void 0,f.ok=function(d){return{ok:!0,value:d}},f.err=function(d){return{ok:!1,error:d}},f.isOk=function(d){return d.ok===!0},f.isNotOk=function(d){return!(0,f.isOk)(d)},f.getOk=function(d){if(d.ok===!0)return d.value},f.getOk_or=function(d,p){return d.ok===!0?d.value:p},f.getErr=function(d){if(d.ok!==!0)return d.error}},3012:(h,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.timedThrottle=void 0,f.timedThrottle=function(d,p){var m=0;return function(){for(var _=[],v=0;v<arguments.length;v++)_[v]=arguments[v];var S=Date.now();S-m>=p&&(m=S,d.apply(this,_))}}}},l={};function u(h){var f=l[h];if(f!==void 0)return f.exports;var d=l[h]={id:h,loaded:!1,exports:{}};return c[h].call(d.exports,d,d.exports,u),d.loaded=!0,d.exports}return u.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),u.nmd=h=>(h.paths=[],h.children||(h.children=[]),h),u(8156)})(),o.exports=a()},1549:(o,a,c)=>{var l=c(2032),u=c(3862),h=c(6721),f=c(2749),d=c(5749);function p(m){var _=-1,v=m==null?0:m.length;for(this.clear();++_<v;){var S=m[_];this.set(S[0],S[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},79:(o,a,c)=>{var l=c(3702),u=c(80),h=c(4739),f=c(8655),d=c(1175);function p(m){var _=-1,v=m==null?0:m.length;for(this.clear();++_<v;){var S=m[_];this.set(S[0],S[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},8223:(o,a,c)=>{var l=c(6110)(c(9325),"Map");o.exports=l},3661:(o,a,c)=>{var l=c(3040),u=c(7670),h=c(289),f=c(4509),d=c(2949);function p(m){var _=-1,v=m==null?0:m.length;for(this.clear();++_<v;){var S=m[_];this.set(S[0],S[1])}}p.prototype.clear=l,p.prototype.delete=u,p.prototype.get=h,p.prototype.has=f,p.prototype.set=d,o.exports=p},7217:(o,a,c)=>{var l=c(79),u=c(1420),h=c(938),f=c(3605),d=c(9817),p=c(945);function m(_){var v=this.__data__=new l(_);this.size=v.size}m.prototype.clear=u,m.prototype.delete=h,m.prototype.get=f,m.prototype.has=d,m.prototype.set=p,o.exports=m},1873:(o,a,c)=>{var l=c(9325).Symbol;o.exports=l},7828:(o,a,c)=>{var l=c(9325).Uint8Array;o.exports=l},1033:o=>{o.exports=function(a,c,l){switch(l.length){case 0:return a.call(c);case 1:return a.call(c,l[0]);case 2:return a.call(c,l[0],l[1]);case 3:return a.call(c,l[0],l[1],l[2])}return a.apply(c,l)}},695:(o,a,c)=>{var l=c(8096),u=c(2428),h=c(6449),f=c(3656),d=c(361),p=c(7167),m=Object.prototype.hasOwnProperty;o.exports=function(_,v){var S=h(_),b=!S&&u(_),T=!S&&!b&&f(_),w=!S&&!b&&!T&&p(_),R=S||b||T||w,C=R?l(_.length,String):[],N=C.length;for(var U in _)!v&&!m.call(_,U)||R&&(U=="length"||T&&(U=="offset"||U=="parent")||w&&(U=="buffer"||U=="byteLength"||U=="byteOffset")||d(U,N))||C.push(U);return C}},7805:(o,a,c)=>{var l=c(3360),u=c(5288);o.exports=function(h,f,d){(d!==void 0&&!u(h[f],d)||d===void 0&&!(f in h))&&l(h,f,d)}},6547:(o,a,c)=>{var l=c(3360),u=c(5288),h=Object.prototype.hasOwnProperty;o.exports=function(f,d,p){var m=f[d];h.call(f,d)&&u(m,p)&&(p!==void 0||d in f)||l(f,d,p)}},6025:(o,a,c)=>{var l=c(5288);o.exports=function(u,h){for(var f=u.length;f--;)if(l(u[f][0],h))return f;return-1}},3360:(o,a,c)=>{var l=c(3243);o.exports=function(u,h,f){h=="__proto__"&&l?l(u,h,{configurable:!0,enumerable:!0,value:f,writable:!0}):u[h]=f}},9344:(o,a,c)=>{var l=c(3805),u=Object.create,h=(function(){function f(){}return function(d){if(!l(d))return{};if(u)return u(d);f.prototype=d;var p=new f;return f.prototype=void 0,p}})();o.exports=h},6649:(o,a,c)=>{var l=c(3221)();o.exports=l},2552:(o,a,c)=>{var l=c(1873),u=c(659),h=c(9350),f=l?l.toStringTag:void 0;o.exports=function(d){return d==null?d===void 0?"[object Undefined]":"[object Null]":f&&f in Object(d)?u(d):h(d)}},7534:(o,a,c)=>{var l=c(2552),u=c(346);o.exports=function(h){return u(h)&&l(h)=="[object Arguments]"}},5083:(o,a,c)=>{var l=c(1882),u=c(7296),h=c(3805),f=c(7473),d=/^\[object .+?Constructor\]$/,p=Function.prototype,m=Object.prototype,_=p.toString,v=m.hasOwnProperty,S=RegExp("^"+_.call(v).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(b){return!(!h(b)||u(b))&&(l(b)?S:d).test(f(b))}},4901:(o,a,c)=>{var l=c(2552),u=c(294),h=c(346),f={};f["[object Float32Array]"]=f["[object Float64Array]"]=f["[object Int8Array]"]=f["[object Int16Array]"]=f["[object Int32Array]"]=f["[object Uint8Array]"]=f["[object Uint8ClampedArray]"]=f["[object Uint16Array]"]=f["[object Uint32Array]"]=!0,f["[object Arguments]"]=f["[object Array]"]=f["[object ArrayBuffer]"]=f["[object Boolean]"]=f["[object DataView]"]=f["[object Date]"]=f["[object Error]"]=f["[object Function]"]=f["[object Map]"]=f["[object Number]"]=f["[object Object]"]=f["[object RegExp]"]=f["[object Set]"]=f["[object String]"]=f["[object WeakMap]"]=!1,o.exports=function(d){return h(d)&&u(d.length)&&!!f[l(d)]}},2903:(o,a,c)=>{var l=c(3805),u=c(5527),h=c(181),f=Object.prototype.hasOwnProperty;o.exports=function(d){if(!l(d))return h(d);var p=u(d),m=[];for(var _ in d)(_!="constructor"||!p&&f.call(d,_))&&m.push(_);return m}},5250:(o,a,c)=>{var l=c(7217),u=c(7805),h=c(6649),f=c(2824),d=c(3805),p=c(7241),m=c(4974);o.exports=function _(v,S,b,T,w){v!==S&&h(S,(function(R,C){if(w||(w=new l),d(R))f(v,S,C,b,_,T,w);else{var N=T?T(m(v,C),R,C+"",v,S,w):void 0;N===void 0&&(N=R),u(v,C,N)}}),p)}},2824:(o,a,c)=>{var l=c(7805),u=c(3290),h=c(1961),f=c(3007),d=c(5529),p=c(2428),m=c(6449),_=c(3693),v=c(3656),S=c(1882),b=c(3805),T=c(1331),w=c(7167),R=c(4974),C=c(9884);o.exports=function(N,U,B,$,I,L,P){var H=R(N,B),X=R(U,B),G=P.get(X);if(G)l(N,B,G);else{var Y=L?L(H,X,B+"",N,U,P):void 0,J=Y===void 0;if(J){var Q=m(X),z=!Q&&v(X),q=!Q&&!z&&w(X);Y=X,Q||z||q?m(H)?Y=H:_(H)?Y=f(H):z?(J=!1,Y=u(X,!0)):q?(J=!1,Y=h(X,!0)):Y=[]:T(X)||p(X)?(Y=H,p(H)?Y=C(H):b(H)&&!S(H)||(Y=d(X))):J=!1}J&&(P.set(X,Y),I(Y,X,$,L,P),P.delete(X)),l(N,B,Y)}}},9302:(o,a,c)=>{var l=c(3488),u=c(6757),h=c(2865);o.exports=function(f,d){return h(u(f,d,l),f+"")}},9570:(o,a,c)=>{var l=c(7334),u=c(3243),h=c(3488),f=u?function(d,p){return u(d,"toString",{configurable:!0,enumerable:!1,value:l(p),writable:!0})}:h;o.exports=f},8096:o=>{o.exports=function(a,c){for(var l=-1,u=Array(a);++l<a;)u[l]=c(l);return u}},7301:o=>{o.exports=function(a){return function(c){return a(c)}}},9653:(o,a,c)=>{var l=c(7828);o.exports=function(u){var h=new u.constructor(u.byteLength);return new l(h).set(new l(u)),h}},3290:(o,a,c)=>{o=c.nmd(o);var l=c(9325),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,f=h&&h.exports===u?l.Buffer:void 0,d=f?f.allocUnsafe:void 0;o.exports=function(p,m){if(m)return p.slice();var _=p.length,v=d?d(_):new p.constructor(_);return p.copy(v),v}},1961:(o,a,c)=>{var l=c(9653);o.exports=function(u,h){var f=h?l(u.buffer):u.buffer;return new u.constructor(f,u.byteOffset,u.length)}},3007:o=>{o.exports=function(a,c){var l=-1,u=a.length;for(c||(c=Array(u));++l<u;)c[l]=a[l];return c}},1791:(o,a,c)=>{var l=c(6547),u=c(3360);o.exports=function(h,f,d,p){var m=!d;d||(d={});for(var _=-1,v=f.length;++_<v;){var S=f[_],b=p?p(d[S],h[S],S,d,h):void 0;b===void 0&&(b=h[S]),m?u(d,S,b):l(d,S,b)}return d}},5481:(o,a,c)=>{var l=c(9325)["__core-js_shared__"];o.exports=l},999:(o,a,c)=>{var l=c(9302),u=c(6800);o.exports=function(h){return l((function(f,d){var p=-1,m=d.length,_=m>1?d[m-1]:void 0,v=m>2?d[2]:void 0;for(_=h.length>3&&typeof _=="function"?(m--,_):void 0,v&&u(d[0],d[1],v)&&(_=m<3?void 0:_,m=1),f=Object(f);++p<m;){var S=d[p];S&&h(f,S,p,_)}return f}))}},3221:o=>{o.exports=function(a){return function(c,l,u){for(var h=-1,f=Object(c),d=u(c),p=d.length;p--;){var m=d[a?p:++h];if(l(f[m],m,f)===!1)break}return c}}},3243:(o,a,c)=>{var l=c(6110),u=(function(){try{var h=l(Object,"defineProperty");return h({},"",{}),h}catch{}})();o.exports=u},4840:(o,a,c)=>{var l=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g;o.exports=l},2651:(o,a,c)=>{var l=c(4218);o.exports=function(u,h){var f=u.__data__;return l(h)?f[typeof h=="string"?"string":"hash"]:f.map}},6110:(o,a,c)=>{var l=c(5083),u=c(392);o.exports=function(h,f){var d=u(h,f);return l(d)?d:void 0}},8879:(o,a,c)=>{var l=c(4335)(Object.getPrototypeOf,Object);o.exports=l},659:(o,a,c)=>{var l=c(1873),u=Object.prototype,h=u.hasOwnProperty,f=u.toString,d=l?l.toStringTag:void 0;o.exports=function(p){var m=h.call(p,d),_=p[d];try{p[d]=void 0;var v=!0}catch{}var S=f.call(p);return v&&(m?p[d]=_:delete p[d]),S}},392:o=>{o.exports=function(a,c){return a?.[c]}},2032:(o,a,c)=>{var l=c(1042);o.exports=function(){this.__data__=l?l(null):{},this.size=0}},3862:o=>{o.exports=function(a){var c=this.has(a)&&delete this.__data__[a];return this.size-=c?1:0,c}},6721:(o,a,c)=>{var l=c(1042),u=Object.prototype.hasOwnProperty;o.exports=function(h){var f=this.__data__;if(l){var d=f[h];return d==="__lodash_hash_undefined__"?void 0:d}return u.call(f,h)?f[h]:void 0}},2749:(o,a,c)=>{var l=c(1042),u=Object.prototype.hasOwnProperty;o.exports=function(h){var f=this.__data__;return l?f[h]!==void 0:u.call(f,h)}},5749:(o,a,c)=>{var l=c(1042);o.exports=function(u,h){var f=this.__data__;return this.size+=this.has(u)?0:1,f[u]=l&&h===void 0?"__lodash_hash_undefined__":h,this}},5529:(o,a,c)=>{var l=c(9344),u=c(8879),h=c(5527);o.exports=function(f){return typeof f.constructor!="function"||h(f)?{}:l(u(f))}},361:o=>{var a=/^(?:0|[1-9]\d*)$/;o.exports=function(c,l){var u=typeof c;return!!(l=l??9007199254740991)&&(u=="number"||u!="symbol"&&a.test(c))&&c>-1&&c%1==0&&c<l}},6800:(o,a,c)=>{var l=c(5288),u=c(4894),h=c(361),f=c(3805);o.exports=function(d,p,m){if(!f(m))return!1;var _=typeof p;return!!(_=="number"?u(m)&&h(p,m.length):_=="string"&&p in m)&&l(m[p],d)}},4218:o=>{o.exports=function(a){var c=typeof a;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?a!=="__proto__":a===null}},7296:(o,a,c)=>{var l,u=c(5481),h=(l=/[^.]+$/.exec(u&&u.keys&&u.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";o.exports=function(f){return!!h&&h in f}},5527:o=>{var a=Object.prototype;o.exports=function(c){var l=c&&c.constructor;return c===(typeof l=="function"&&l.prototype||a)}},3702:o=>{o.exports=function(){this.__data__=[],this.size=0}},80:(o,a,c)=>{var l=c(6025),u=Array.prototype.splice;o.exports=function(h){var f=this.__data__,d=l(f,h);return!(d<0)&&(d==f.length-1?f.pop():u.call(f,d,1),--this.size,!0)}},4739:(o,a,c)=>{var l=c(6025);o.exports=function(u){var h=this.__data__,f=l(h,u);return f<0?void 0:h[f][1]}},8655:(o,a,c)=>{var l=c(6025);o.exports=function(u){return l(this.__data__,u)>-1}},1175:(o,a,c)=>{var l=c(6025);o.exports=function(u,h){var f=this.__data__,d=l(f,u);return d<0?(++this.size,f.push([u,h])):f[d][1]=h,this}},3040:(o,a,c)=>{var l=c(1549),u=c(79),h=c(8223);o.exports=function(){this.size=0,this.__data__={hash:new l,map:new(h||u),string:new l}}},7670:(o,a,c)=>{var l=c(2651);o.exports=function(u){var h=l(this,u).delete(u);return this.size-=h?1:0,h}},289:(o,a,c)=>{var l=c(2651);o.exports=function(u){return l(this,u).get(u)}},4509:(o,a,c)=>{var l=c(2651);o.exports=function(u){return l(this,u).has(u)}},2949:(o,a,c)=>{var l=c(2651);o.exports=function(u,h){var f=l(this,u),d=f.size;return f.set(u,h),this.size+=f.size==d?0:1,this}},1042:(o,a,c)=>{var l=c(6110)(Object,"create");o.exports=l},181:o=>{o.exports=function(a){var c=[];if(a!=null)for(var l in Object(a))c.push(l);return c}},6009:(o,a,c)=>{o=c.nmd(o);var l=c(4840),u=a&&!a.nodeType&&a,h=u&&o&&!o.nodeType&&o,f=h&&h.exports===u&&l.process,d=(function(){try{var p=h&&h.require&&h.require("util").types;return p||f&&f.binding&&f.binding("util")}catch{}})();o.exports=d},9350:o=>{var a=Object.prototype.toString;o.exports=function(c){return a.call(c)}},4335:o=>{o.exports=function(a,c){return function(l){return a(c(l))}}},6757:(o,a,c)=>{var l=c(1033),u=Math.max;o.exports=function(h,f,d){return f=u(f===void 0?h.length-1:f,0),function(){for(var p=arguments,m=-1,_=u(p.length-f,0),v=Array(_);++m<_;)v[m]=p[f+m];m=-1;for(var S=Array(f+1);++m<f;)S[m]=p[m];return S[f]=d(v),l(h,this,S)}}},9325:(o,a,c)=>{var l=c(4840),u=typeof self=="object"&&self&&self.Object===Object&&self,h=l||u||Function("return this")();o.exports=h},4974:o=>{o.exports=function(a,c){if((c!=="constructor"||typeof a[c]!="function")&&c!="__proto__")return a[c]}},2865:(o,a,c)=>{var l=c(9570),u=c(1811)(l);o.exports=u},1811:o=>{var a=Date.now;o.exports=function(c){var l=0,u=0;return function(){var h=a(),f=16-(h-u);if(u=h,f>0){if(++l>=800)return arguments[0]}else l=0;return c.apply(void 0,arguments)}}},1420:(o,a,c)=>{var l=c(79);o.exports=function(){this.__data__=new l,this.size=0}},938:o=>{o.exports=function(a){var c=this.__data__,l=c.delete(a);return this.size=c.size,l}},3605:o=>{o.exports=function(a){return this.__data__.get(a)}},9817:o=>{o.exports=function(a){return this.__data__.has(a)}},945:(o,a,c)=>{var l=c(79),u=c(8223),h=c(3661);o.exports=function(f,d){var p=this.__data__;if(p instanceof l){var m=p.__data__;if(!u||m.length<199)return m.push([f,d]),this.size=++p.size,this;p=this.__data__=new h(m)}return p.set(f,d),this.size=p.size,this}},7473:o=>{var a=Function.prototype.toString;o.exports=function(c){if(c!=null){try{return a.call(c)}catch{}try{return c+""}catch{}}return""}},7334:o=>{o.exports=function(a){return function(){return a}}},5288:o=>{o.exports=function(a,c){return a===c||a!=a&&c!=c}},3488:o=>{o.exports=function(a){return a}},2428:(o,a,c)=>{var l=c(7534),u=c(346),h=Object.prototype,f=h.hasOwnProperty,d=h.propertyIsEnumerable,p=l((function(){return arguments})())?l:function(m){return u(m)&&f.call(m,"callee")&&!d.call(m,"callee")};o.exports=p},6449:o=>{var a=Array.isArray;o.exports=a},4894:(o,a,c)=>{var l=c(1882),u=c(294);o.exports=function(h){return h!=null&&u(h.length)&&!l(h)}},3693:(o,a,c)=>{var l=c(4894),u=c(346);o.exports=function(h){return u(h)&&l(h)}},3656:(o,a,c)=>{o=c.nmd(o);var l=c(9325),u=c(9935),h=a&&!a.nodeType&&a,f=h&&o&&!o.nodeType&&o,d=f&&f.exports===h?l.Buffer:void 0,p=(d?d.isBuffer:void 0)||u;o.exports=p},1882:(o,a,c)=>{var l=c(2552),u=c(3805);o.exports=function(h){if(!u(h))return!1;var f=l(h);return f=="[object Function]"||f=="[object GeneratorFunction]"||f=="[object AsyncFunction]"||f=="[object Proxy]"}},294:o=>{o.exports=function(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=9007199254740991}},3805:o=>{o.exports=function(a){var c=typeof a;return a!=null&&(c=="object"||c=="function")}},346:o=>{o.exports=function(a){return a!=null&&typeof a=="object"}},1331:(o,a,c)=>{var l=c(2552),u=c(8879),h=c(346),f=Function.prototype,d=Object.prototype,p=f.toString,m=d.hasOwnProperty,_=p.call(Object);o.exports=function(v){if(!h(v)||l(v)!="[object Object]")return!1;var S=u(v);if(S===null)return!0;var b=m.call(S,"constructor")&&S.constructor;return typeof b=="function"&&b instanceof b&&p.call(b)==_}},7167:(o,a,c)=>{var l=c(4901),u=c(7301),h=c(6009),f=h&&h.isTypedArray,d=f?u(f):l;o.exports=d},7241:(o,a,c)=>{var l=c(695),u=c(2903),h=c(4894);o.exports=function(f){return h(f)?l(f,!0):u(f)}},2543:function(o,a,c){var l;o=c.nmd(o),(function(){var u,h="Expected a function",f="__lodash_hash_undefined__",d="__lodash_placeholder__",p=16,m=32,_=64,v=128,S=256,b=1/0,T=9007199254740991,w=NaN,R=4294967295,C=[["ary",v],["bind",1],["bindKey",2],["curry",8],["curryRight",p],["flip",512],["partial",m],["partialRight",_],["rearg",S]],N="[object Arguments]",U="[object Array]",B="[object Boolean]",$="[object Date]",I="[object Error]",L="[object Function]",P="[object GeneratorFunction]",H="[object Map]",X="[object Number]",G="[object Object]",Y="[object Promise]",J="[object RegExp]",Q="[object Set]",z="[object String]",q="[object Symbol]",ee="[object WeakMap]",te="[object ArrayBuffer]",ie="[object DataView]",Ee="[object Float32Array]",Re="[object Float64Array]",Te="[object Int8Array]",Pe="[object Int16Array]",We="[object Int32Array]",it="[object Uint8Array]",ht="[object Uint8ClampedArray]",vt="[object Uint16Array]",re="[object Uint32Array]",Le=/\b__p \+= '';/g,$e=/\b(__p \+=) '' \+/g,De=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Oe=/&(?:amp|lt|gt|quot|#39);/g,ae=/[&<>"']/g,ve=RegExp(Oe.source),xe=RegExp(ae.source),pe=/<%-([\s\S]+?)%>/g,ze=/<%([\s\S]+?)%>/g,Je=/<%=([\s\S]+?)%>/g,Xe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,et=/^\w*$/,Ut=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(gt.source),Ce=/^\s+/,se=/\s/,W=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oe=/\{\n\/\* \[wrapped with (.+)\] \*/,Se=/,? & /,Ae=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ye=/[()=,{}\[\]\/\s]/,_e=/\\(\\)?/g,Ye=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ke=/\w*$/,Ve=/^[-+]0x[0-9a-f]+$/i,Fe=/^0b[01]+$/i,Ge=/^\[object .+?Constructor\]$/,at=/^0o[0-7]+$/i,Be=/^(?:0|[1-9]\d*)$/,tt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,rt=/($^)/,xt=/['\n\r\u2028\u2029\\]/g,ot="\\ud800-\\udfff",tn="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ln="\\u2700-\\u27bf",Rt="a-z\\xdf-\\xf6\\xf8-\\xff",$t="A-Z\\xc0-\\xd6\\xd8-\\xde",mt="\\ufe0e\\ufe0f",Zt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",wn="[']",qt="["+ot+"]",An="["+Zt+"]",Ln="["+tn+"]",mr="\\d+",is="["+ln+"]",hi="["+Rt+"]",ti="[^"+ot+Zt+mr+ln+Rt+$t+"]",ji="\\ud83c[\\udffb-\\udfff]",ss="[^"+ot+"]",Yi="(?:\\ud83c[\\udde6-\\uddff]){2}",os="[\\ud800-\\udbff][\\udc00-\\udfff]",as="["+$t+"]",je="\\u200d",_t="(?:"+hi+"|"+ti+")",Ot="(?:"+as+"|"+ti+")",Lt="(?:['](?:d|ll|m|re|s|t|ve))?",yt="(?:['](?:D|LL|M|RE|S|T|VE))?",an="(?:"+Ln+"|"+ji+")?",On="["+mt+"]?",_n=On+an+("(?:"+je+"(?:"+[ss,Yi,os].join("|")+")"+On+an+")*"),Pn="(?:"+[is,Yi,os].join("|")+")"+_n,er="(?:"+[ss+Ln+"?",Ln,Yi,os,qt].join("|")+")",fr=RegExp(wn,"g"),Cn=RegExp(Ln,"g"),yr=RegExp(ji+"(?="+ji+")|"+er+_n,"g"),Vr=RegExp([as+"?"+hi+"+"+Lt+"(?="+[An,as,"$"].join("|")+")",Ot+"+"+yt+"(?="+[An,as+_t,"$"].join("|")+")",as+"?"+_t+"+"+Lt,as+"+"+yt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",mr,Pn].join("|"),"g"),ms=RegExp("["+je+ot+tn+mt+"]"),Lr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Gr=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],or=-1,br={};br[Ee]=br[Re]=br[Te]=br[Pe]=br[We]=br[it]=br[ht]=br[vt]=br[re]=!0,br[N]=br[U]=br[te]=br[B]=br[ie]=br[$]=br[I]=br[L]=br[H]=br[X]=br[G]=br[J]=br[Q]=br[z]=br[ee]=!1;var Un={};Un[N]=Un[U]=Un[te]=Un[ie]=Un[B]=Un[$]=Un[Ee]=Un[Re]=Un[Te]=Un[Pe]=Un[We]=Un[H]=Un[X]=Un[G]=Un[J]=Un[Q]=Un[z]=Un[q]=Un[it]=Un[ht]=Un[vt]=Un[re]=!0,Un[I]=Un[L]=Un[ee]=!1;var bi={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ai=parseFloat,Rs=parseInt,ho=typeof c.g=="object"&&c.g&&c.g.Object===Object&&c.g,Mi=typeof self=="object"&&self&&self.Object===Object&&self,Mn=ho||Mi||Function("return this")(),Li=a&&!a.nodeType&&a,Kn=Li&&o&&!o.nodeType&&o,gs=Kn&&Kn.exports===Li,pl=gs&&ho.process,_s=(function(){try{var Bt=Kn&&Kn.require&&Kn.require("util").types;return Bt||pl&&pl.binding&&pl.binding("util")}catch{}})(),Gc=_s&&_s.isArrayBuffer,Sg=_s&&_s.isDate,v_=_s&&_s.isMap,y_=_s&&_s.isRegExp,b_=_s&&_s.isSet,Pp=_s&&_s.isTypedArray;function ba(Bt,en,sn){switch(sn.length){case 0:return Bt.call(en);case 1:return Bt.call(en,sn[0]);case 2:return Bt.call(en,sn[0],sn[1]);case 3:return Bt.call(en,sn[0],sn[1],sn[2])}return Bt.apply(en,sn)}function V1(Bt,en,sn,$n){for(var kr=-1,Si=Bt==null?0:Bt.length;++kr<Si;){var po=Bt[kr];en($n,po,sn(po),Bt)}return $n}function Wc(Bt,en){for(var sn=-1,$n=Bt==null?0:Bt.length;++sn<$n&&en(Bt[sn],sn,Bt)!==!1;);return Bt}function uy(Bt,en){for(var sn=Bt==null?0:Bt.length;sn--&&en(Bt[sn],sn,Bt)!==!1;);return Bt}function S_(Bt,en){for(var sn=-1,$n=Bt==null?0:Bt.length;++sn<$n;)if(!en(Bt[sn],sn,Bt))return!1;return!0}function ml(Bt,en){for(var sn=-1,$n=Bt==null?0:Bt.length,kr=0,Si=[];++sn<$n;){var po=Bt[sn];en(po,sn,Bt)&&(Si[kr++]=po)}return Si}function Dp(Bt,en){return!!(Bt!=null&&Bt.length)&&Ec(Bt,en,0)>-1}function Eg(Bt,en,sn){for(var $n=-1,kr=Bt==null?0:Bt.length;++$n<kr;)if(sn(en,Bt[$n]))return!0;return!1}function Ss(Bt,en){for(var sn=-1,$n=Bt==null?0:Bt.length,kr=Array($n);++sn<$n;)kr[sn]=en(Bt[sn],sn,Bt);return kr}function bc(Bt,en){for(var sn=-1,$n=en.length,kr=Bt.length;++sn<$n;)Bt[kr+sn]=en[sn];return Bt}function Tf(Bt,en,sn,$n){var kr=-1,Si=Bt==null?0:Bt.length;for($n&&Si&&(sn=Bt[++kr]);++kr<Si;)sn=en(sn,Bt[kr],kr,Bt);return sn}function Sc(Bt,en,sn,$n){var kr=Bt==null?0:Bt.length;for($n&&kr&&(sn=Bt[--kr]);kr--;)sn=en(sn,Bt[kr],kr,Bt);return sn}function qc(Bt,en){for(var sn=-1,$n=Bt==null?0:Bt.length;++sn<$n;)if(en(Bt[sn],sn,Bt))return!0;return!1}var wf=E_("length");function Ou(Bt,en,sn){var $n;return sn(Bt,(function(kr,Si,po){if(en(kr,Si,po))return $n=Si,!1})),$n}function Lh(Bt,en,sn,$n){for(var kr=Bt.length,Si=sn+($n?1:-1);$n?Si--:++Si<kr;)if(en(Bt[Si],Si,Bt))return Si;return-1}function Ec(Bt,en,sn){return en==en?(function($n,kr,Si){for(var po=Si-1,Zl=$n.length;++po<Zl;)if($n[po]===kr)return po;return-1})(Bt,en,sn):Lh(Bt,xg,sn)}function hr(Bt,en,sn,$n){for(var kr=sn-1,Si=Bt.length;++kr<Si;)if($n(Bt[kr],en))return kr;return-1}function xg(Bt){return Bt!=Bt}function hy(Bt,en){var sn=Bt==null?0:Bt.length;return sn?Tg(Bt,en)/sn:w}function E_(Bt){return function(en){return en==null?u:en[Bt]}}function Uh(Bt){return function(en){return Bt==null?u:Bt[en]}}function x_(Bt,en,sn,$n,kr){return kr(Bt,(function(Si,po,Zl){sn=$n?($n=!1,Si):en(sn,Si,po,Zl)})),sn}function Tg(Bt,en){for(var sn,$n=-1,kr=Bt.length;++$n<kr;){var Si=en(Bt[$n]);Si!==u&&(sn=sn===u?Si:sn+Si)}return sn}function Da(Bt,en){for(var sn=-1,$n=Array(Bt);++sn<Bt;)$n[sn]=en(sn);return $n}function wg(Bt){return Bt&&Bt.slice(0,xn(Bt)+1).replace(Ce,"")}function xc(Bt){return function(en){return Bt(en)}}function T_(Bt,en){return Ss(en,(function(sn){return Bt[sn]}))}function Nu(Bt,en){return Bt.has(en)}function fo(Bt,en){for(var sn=-1,$n=Bt.length;++sn<$n&&Ec(en,Bt[sn],0)>-1;);return sn}function fy(Bt,en){for(var sn=Bt.length;sn--&&Ec(en,Bt[sn],0)>-1;);return sn}var w_=Uh({:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"}),gl=Uh({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ks(Bt){return"\\"+bi[Bt]}function Qo(Bt){return ms.test(Bt)}function dy(Bt){var en=-1,sn=Array(Bt.size);return Bt.forEach((function($n,kr){sn[++en]=[kr,$n]})),sn}function H1(Bt,en){return function(sn){return Bt(en(sn))}}function Xl(Bt,en){for(var sn=-1,$n=Bt.length,kr=0,Si=[];++sn<$n;){var po=Bt[sn];po!==en&&po!==d||(Bt[sn]=d,Si[kr++]=sn)}return Si}function Po(Bt){var en=-1,sn=Array(Bt.size);return Bt.forEach((function($n){sn[++en]=$n})),sn}function $s(Bt){var en=-1,sn=Array(Bt.size);return Bt.forEach((function($n){sn[++en]=[$n,$n]})),sn}function _l(Bt){return Qo(Bt)?(function(en){for(var sn=yr.lastIndex=0;yr.test(en);)++sn;return sn})(Bt):wf(Bt)}function Sa(Bt){return Qo(Bt)?(function(en){return en.match(yr)||[]})(Bt):(function(en){return en.split("")})(Bt)}function xn(Bt){for(var en=Bt.length;en--&&se.test(Bt.charAt(en)););return en}var py=Uh({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Ag=(function Bt(en){var sn,$n=(en=en==null?Mn:Ag.defaults(Mn.Object(),en,Ag.pick(Mn,Gr))).Array,kr=en.Date,Si=en.Error,po=en.Function,Zl=en.Math,Wr=en.Object,A_=en.RegExp,G1=en.String,Yc=en.TypeError,Cg=$n.prototype,Rg=po.prototype,Ed=Wr.prototype,xd=en["__core-js_shared__"],kg=Rg.toString,Ki=Ed.hasOwnProperty,Mg=0,C_=(sn=/[^.]+$/.exec(xd&&xd.keys&&xd.keys.IE_PROTO||""))?"Symbol(src)_1."+sn:"",Ig=Ed.toString,W1=kg.call(Wr),vl=Mn._,Lp=A_("^"+kg.call(Ki).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yl=gs?en.Buffer:u,Ms=en.Symbol,Up=en.Uint8Array,zi=yl?yl.allocUnsafe:u,Bp=H1(Wr.getPrototypeOf,Wr),Og=Wr.create,Fp=Ed.propertyIsEnumerable,Td=Cg.splice,Pu=Ms?Ms.isConcatSpreadable:u,wd=Ms?Ms.iterator:u,Af=Ms?Ms.toStringTag:u,Jl=(function(){try{var x=fi(Wr,"defineProperty");return x({},"",{}),x}catch{}})(),bl=en.clearTimeout!==Mn.clearTimeout&&en.clearTimeout,Ng=kr&&kr.now!==Mn.Date.now&&kr.now,q1=en.setTimeout!==Mn.setTimeout&&en.setTimeout,jp=Zl.ceil,Pg=Zl.floor,zp=Wr.getOwnPropertySymbols,R_=yl?yl.isBuffer:u,Ad=en.isFinite,k_=Cg.join,M_=H1(Wr.keys,Wr),Vs=Zl.max,qr=Zl.min,Y1=kr.now,pT=en.parseInt,Dg=Zl.random,Tn=Cg.reverse,fn=fi(en,"DataView"),Sn=fi(en,"Map"),Cd=fi(en,"Promise"),Hr=fi(en,"Set"),Cr=fi(en,"WeakMap"),Ea=fi(Wr,"create"),Du=Cr&&new Cr,Cf={},$p=jd(fn),Rd=jd(Sn),Lg=jd(Cd),Ug=jd(Hr),my=jd(Cr),Vp=Ms?Ms.prototype:u,Rf=Vp?Vp.valueOf:u,I_=Vp?Vp.toString:u;function Ue(x){if(Qs(x)&&!Ur(x)&&!(x instanceof ci)){if(x instanceof Ya)return x;if(Ki.call(x,"__wrapped__"))return eS(x)}return new Ya(x)}var Bh=(function(){function x(){}return function(D){if(!vs(D))return{};if(Og)return Og(D);x.prototype=D;var Z=new x;return x.prototype=u,Z}})();function kf(){}function Ya(x,D){this.__wrapped__=x,this.__actions__=[],this.__chain__=!!D,this.__index__=0,this.__values__=u}function ci(x){this.__wrapped__=x,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=R,this.__views__=[]}function Ql(x){var D=-1,Z=x==null?0:x.length;for(this.clear();++D<Z;){var ge=x[D];this.set(ge[0],ge[1])}}function Is(x){var D=-1,Z=x==null?0:x.length;for(this.clear();++D<Z;){var ge=x[D];this.set(ge[0],ge[1])}}function Lu(x){var D=-1,Z=x==null?0:x.length;for(this.clear();++D<Z;){var ge=x[D];this.set(ge[0],ge[1])}}function mo(x){var D=-1,Z=x==null?0:x.length;for(this.__data__=new Lu;++D<Z;)this.add(x[D])}function Kc(x){var D=this.__data__=new Is(x);this.size=D.size}function Uu(x,D){var Z=Ur(x),ge=!Z&&Qc(x),Ie=!Z&&!ge&&Ff(x),He=!Z&&!ge&&!Ie&&Zu(x),ct=Z||ge||Ie||He,ft=ct?Da(x.length,G1):[],kt=ft.length;for(var Wt in x)!D&&!Ki.call(x,Wt)||ct&&(Wt=="length"||Ie&&(Wt=="offset"||Wt=="parent")||He&&(Wt=="buffer"||Wt=="byteLength"||Wt=="byteOffset")||Co(Wt,kt))||ft.push(Wt);return ft}function Mf(x){var D=x.length;return D?x[Vg(0,D-1)]:u}function Fh(x,D){return t0(Zs(x),zh(D,0,x.length))}function Do(x){return t0(Zs(x))}function Hp(x,D,Z){(Z!==u&&!Jc(x[D],Z)||Z===u&&!(D in x))&&ea(x,D,Z)}function La(x,D,Z){var ge=x[D];Ki.call(x,D)&&Jc(ge,Z)&&(Z!==u||D in x)||ea(x,D,Z)}function Bg(x,D){for(var Z=x.length;Z--;)if(Jc(x[Z][0],D))return Z;return-1}function jh(x,D,Z,ge){return Fu(x,(function(Ie,He,ct){D(ge,Ie,Z(Ie),ct)})),ge}function Gp(x,D){return x&&Ac(D,Ro(D),x)}function ea(x,D,Z){D=="__proto__"&&Jl?Jl(x,D,{configurable:!0,enumerable:!0,value:Z,writable:!0}):x[D]=Z}function O_(x,D){for(var Z=-1,ge=D.length,Ie=$n(ge),He=x==null;++Z<ge;)Ie[Z]=He?u:ec(x,D[Z]);return Ie}function zh(x,D,Z){return x==x&&(Z!==u&&(x=x<=Z?x:Z),D!==u&&(x=x>=D?x:D)),x}function ta(x,D,Z,ge,Ie,He){var ct,ft=1&D,kt=2&D,Wt=4&D;if(Z&&(ct=Ie?Z(x,ge,Ie,He):Z(x)),ct!==u)return ct;if(!vs(x))return x;var Yt=Ur(x);if(Yt){if(ct=(function(Vt){var mn=Vt.length,nr=new Vt.constructor(mn);return mn&&typeof Vt[0]=="string"&&Ki.call(Vt,"index")&&(nr.index=Vt.index,nr.input=Vt.input),nr})(x),!ft)return Zs(x,ct)}else{var nn=Ta(x),Gn=nn==L||nn==P;if(Ff(x))return Pf(x,ft);if(nn==G||nn==N||Gn&&!Ie){if(ct=kt||Gn?{}:Zg(x),!ft)return kt?(function(Vt,mn){return Ac(Vt,eu(Vt),mn)})(x,(function(Vt,mn){return Vt&&Ac(mn,Fo(mn),Vt)})(ct,x)):(function(Vt,mn){return Ac(Vt,H_(Vt),mn)})(x,Gp(ct,x))}else{if(!Un[nn])return Ie?x:{};ct=(function(Vt,mn,nr){var Rn=Vt.constructor;switch(mn){case te:return zu(Vt);case B:case $:return new Rn(+Vt);case ie:return(function(Er,si){var tr=si?zu(Er.buffer):Er.buffer;return new Er.constructor(tr,Er.byteOffset,Er.byteLength)})(Vt,nr);case Ee:case Re:case Te:case Pe:case We:case it:case ht:case vt:case re:return Pd(Vt,nr);case H:return new Rn;case X:case z:return new Rn(Vt);case J:return(function(Er){var si=new Er.constructor(Er.source,ke.exec(Er));return si.lastIndex=Er.lastIndex,si})(Vt);case Q:return new Rn;case q:return gr=Vt,Rf?Wr(Rf.call(gr)):{}}var gr})(x,nn,ft)}}He||(He=new Kc);var pn=He.get(x);if(pn)return pn;He.set(x,ct),Xu(x)?x.forEach((function(Vt){ct.add(ta(Vt,D,Z,Vt,x,He))})):By(x)&&x.forEach((function(Vt,mn){ct.set(mn,ta(Vt,D,Z,mn,x,He))}));var Nn=Yt?u:(Wt?kt?ia:Ba:kt?Fo:Ro)(x);return Wc(Nn||x,(function(Vt,mn){Nn&&(Vt=x[mn=Vt]),La(ct,mn,ta(Vt,D,Z,mn,x,He))})),ct}function Ka(x,D,Z){var ge=Z.length;if(x==null)return!ge;for(x=Wr(x);ge--;){var Ie=Z[ge],He=D[Ie],ct=x[Ie];if(ct===u&&!(Ie in x)||!He(ct))return!1}return!0}function Bu(x,D,Z){if(typeof x!="function")throw new Yc(h);return Yh((function(){x.apply(u,Z)}),D)}function kd(x,D,Z,ge){var Ie=-1,He=Dp,ct=!0,ft=x.length,kt=[],Wt=D.length;if(!ft)return kt;Z&&(D=Ss(D,xc(Z))),ge?(He=Eg,ct=!1):D.length>=200&&(He=Nu,ct=!1,D=new mo(D));e:for(;++Ie<ft;){var Yt=x[Ie],nn=Z==null?Yt:Z(Yt);if(Yt=ge||Yt!==0?Yt:0,ct&&nn==nn){for(var Gn=Wt;Gn--;)if(D[Gn]===nn)continue e;kt.push(Yt)}else He(D,nn,ge)||kt.push(Yt)}return kt}Ue.templateSettings={escape:pe,evaluate:ze,interpolate:Je,variable:"",imports:{_:Ue}},Ue.prototype=kf.prototype,Ue.prototype.constructor=Ue,Ya.prototype=Bh(kf.prototype),Ya.prototype.constructor=Ya,ci.prototype=Bh(kf.prototype),ci.prototype.constructor=ci,Ql.prototype.clear=function(){this.__data__=Ea?Ea(null):{},this.size=0},Ql.prototype.delete=function(x){var D=this.has(x)&&delete this.__data__[x];return this.size-=D?1:0,D},Ql.prototype.get=function(x){var D=this.__data__;if(Ea){var Z=D[x];return Z===f?u:Z}return Ki.call(D,x)?D[x]:u},Ql.prototype.has=function(x){var D=this.__data__;return Ea?D[x]!==u:Ki.call(D,x)},Ql.prototype.set=function(x,D){var Z=this.__data__;return this.size+=this.has(x)?0:1,Z[x]=Ea&&D===u?f:D,this},Is.prototype.clear=function(){this.__data__=[],this.size=0},Is.prototype.delete=function(x){var D=this.__data__,Z=Bg(D,x);return!(Z<0)&&(Z==D.length-1?D.pop():Td.call(D,Z,1),--this.size,!0)},Is.prototype.get=function(x){var D=this.__data__,Z=Bg(D,x);return Z<0?u:D[Z][1]},Is.prototype.has=function(x){return Bg(this.__data__,x)>-1},Is.prototype.set=function(x,D){var Z=this.__data__,ge=Bg(Z,x);return ge<0?(++this.size,Z.push([x,D])):Z[ge][1]=D,this},Lu.prototype.clear=function(){this.size=0,this.__data__={hash:new Ql,map:new(Sn||Is),string:new Ql}},Lu.prototype.delete=function(x){var D=go(this,x).delete(x);return this.size-=D?1:0,D},Lu.prototype.get=function(x){return go(this,x).get(x)},Lu.prototype.has=function(x){return go(this,x).has(x)},Lu.prototype.set=function(x,D){var Z=go(this,x),ge=Z.size;return Z.set(x,D),this.size+=Z.size==ge?0:1,this},mo.prototype.add=mo.prototype.push=function(x){return this.__data__.set(x,f),this},mo.prototype.has=function(x){return this.__data__.has(x)},Kc.prototype.clear=function(){this.__data__=new Is,this.size=0},Kc.prototype.delete=function(x){var D=this.__data__,Z=D.delete(x);return this.size=D.size,Z},Kc.prototype.get=function(x){return this.__data__.get(x)},Kc.prototype.has=function(x){return this.__data__.has(x)},Kc.prototype.set=function(x,D){var Z=this.__data__;if(Z instanceof Is){var ge=Z.__data__;if(!Sn||ge.length<199)return ge.push([x,D]),this.size=++Z.size,this;Z=this.__data__=new Lu(ge)}return Z.set(x,D),this.size=Z.size,this};var Fu=Xp(Os),Fg=Xp(Wp,!0);function jg(x,D){var Z=!0;return Fu(x,(function(ge,Ie,He){return Z=!!D(ge,Ie,He)})),Z}function Md(x,D,Z){for(var ge=-1,Ie=x.length;++ge<Ie;){var He=x[ge],ct=D(He);if(ct!=null&&(ft===u?ct==ct&&!Es(ct):Z(ct,ft)))var ft=ct,kt=He}return kt}function Tr(x,D){var Z=[];return Fu(x,(function(ge,Ie,He){D(ge,Ie,He)&&Z.push(ge)})),Z}function Xi(x,D,Z,ge,Ie){var He=-1,ct=x.length;for(Z||(Z=Ry),Ie||(Ie=[]);++He<ct;){var ft=x[He];D>0&&Z(ft)?D>1?Xi(ft,D-1,Z,ge,Ie):bc(Ie,ft):ge||(Ie[Ie.length]=ft)}return Ie}var N_=Vu(),Xa=Vu(!0);function Os(x,D){return x&&N_(x,D,Ro)}function Wp(x,D){return x&&Xa(x,D,Ro)}function zg(x,D){return ml(D,(function(Z){return wl(x[Z])}))}function Tc(x,D){for(var Z=0,ge=(D=Nf(D,x)).length;x!=null&&Z<ge;)x=x[Ku(D[Z++])];return Z&&Z==ge?x:u}function gy(x,D,Z){var ge=D(x);return Ur(x)?ge:bc(ge,Z(x))}function xa(x){return x==null?x===u?"[object Undefined]":"[object Null]":Af&&Af in Wr(x)?(function(D){var Z=Ki.call(D,Af),ge=D[Af];try{D[Af]=u;var Ie=!0}catch{}var He=Ig.call(D);return Ie&&(Z?D[Af]=ge:delete D[Af]),He})(x):(function(D){return Ig.call(D)})(x)}function ju(x,D){return x>D}function qp(x,D){return x!=null&&Ki.call(x,D)}function K1(x,D){return x!=null&&D in Wr(x)}function P_(x,D,Z){for(var ge=Z?Eg:Dp,Ie=x[0].length,He=x.length,ct=He,ft=$n(He),kt=1/0,Wt=[];ct--;){var Yt=x[ct];ct&&D&&(Yt=Ss(Yt,xc(D))),kt=qr(Yt.length,kt),ft[ct]=!Z&&(D||Ie>=120&&Yt.length>=120)?new mo(ct&&Yt):u}Yt=x[0];var nn=-1,Gn=ft[0];e:for(;++nn<Ie&&Wt.length<kt;){var pn=Yt[nn],Nn=D?D(pn):pn;if(pn=Z||pn!==0?pn:0,!(Gn?Nu(Gn,Nn):ge(Wt,Nn,Z))){for(ct=He;--ct;){var Vt=ft[ct];if(!(Vt?Nu(Vt,Nn):ge(x[ct],Nn,Z)))continue e}Gn&&Gn.push(Nn),Wt.push(pn)}}return Wt}function $h(x,D,Z){var ge=(x=Yu(x,D=Nf(D,x)))==null?x:x[Ku(_o(D))];return ge==null?u:ba(ge,x,Z)}function $g(x){return Qs(x)&&xa(x)==N}function Id(x,D,Z,ge,Ie){return x===D||(x==null||D==null||!Qs(x)&&!Qs(D)?x!=x&&D!=D:(function(He,ct,ft,kt,Wt,Yt){var nn=Ur(He),Gn=Ur(ct),pn=nn?U:Ta(He),Nn=Gn?U:Ta(ct),Vt=(pn=pn==N?G:pn)==G,mn=(Nn=Nn==N?G:Nn)==G,nr=pn==Nn;if(nr&&Ff(He)){if(!Ff(ct))return!1;nn=!0,Vt=!1}if(nr&&!Vt)return Yt||(Yt=new Kc),nn||Zu(He)?Ay(He,ct,ft,kt,Wt,Yt):(function(tr,jn,wi,Ls,wa,cs,zo){switch(wi){case ie:if(tr.byteLength!=jn.byteLength||tr.byteOffset!=jn.byteOffset)return!1;tr=tr.buffer,jn=jn.buffer;case te:return!(tr.byteLength!=jn.byteLength||!cs(new Up(tr),new Up(jn)));case B:case $:case X:return Jc(+tr,+jn);case I:return tr.name==jn.name&&tr.message==jn.message;case J:case z:return tr==jn+"";case H:var $i=dy;case Q:var nh=1&Ls;if($i||($i=Po),tr.size!=jn.size&&!nh)return!1;var nl=zo.get(tr);if(nl)return nl==jn;Ls|=2,zo.set(tr,jn);var Us=Ay($i(tr),$i(jn),Ls,wa,cs,zo);return zo.delete(tr),Us;case q:if(Rf)return Rf.call(tr)==Rf.call(jn)}return!1})(He,ct,pn,ft,kt,Wt,Yt);if(!(1&ft)){var Rn=Vt&&Ki.call(He,"__wrapped__"),gr=mn&&Ki.call(ct,"__wrapped__");if(Rn||gr){var Er=Rn?He.value():He,si=gr?ct.value():ct;return Yt||(Yt=new Kc),Wt(Er,si,ft,kt,Yt)}}return nr?(Yt||(Yt=new Kc),(function(tr,jn,wi,Ls,wa,cs){var zo=1&wi,$i=Ba(tr),nh=$i.length,nl=Ba(jn),Us=nl.length;if(nh!=Us&&!zo)return!1;for(var Gd=nh;Gd--;){var iu=$i[Gd];if(!(zo?iu in jn:Ki.call(jn,iu)))return!1}var vo=cs.get(tr),yo=cs.get(jn);if(vo&&yo)return vo==jn&&yo==tr;var Aa=!0;cs.set(tr,jn),cs.set(jn,tr);for(var ls=zo;++Gd<nh;){var su=tr[iu=$i[Gd]],ou=jn[iu];if(Ls)var g0=zo?Ls(ou,su,iu,jn,tr,cs):Ls(su,ou,iu,tr,jn,cs);if(!(g0===u?su===ou||wa(su,ou,wi,Ls,cs):g0)){Aa=!1;break}ls||(ls=iu=="constructor")}if(Aa&&!ls){var Wd=tr.constructor,Vf=jn.constructor;Wd==Vf||!("constructor"in tr)||!("constructor"in jn)||typeof Wd=="function"&&Wd instanceof Wd&&typeof Vf=="function"&&Vf instanceof Vf||(Aa=!1)}return cs.delete(tr),cs.delete(jn),Aa})(He,ct,ft,kt,Wt,Yt)):!1})(x,D,Z,ge,Id,Ie))}function If(x,D,Z,ge){var Ie=Z.length,He=Ie,ct=!ge;if(x==null)return!He;for(x=Wr(x);Ie--;){var ft=Z[Ie];if(ct&&ft[2]?ft[1]!==x[ft[0]]:!(ft[0]in x))return!1}for(;++Ie<He;){var kt=(ft=Z[Ie])[0],Wt=x[kt],Yt=ft[1];if(ct&&ft[2]){if(Wt===u&&!(kt in x))return!1}else{var nn=new Kc;if(ge)var Gn=ge(Wt,Yt,kt,x,D,nn);if(!(Gn===u?Id(Yt,Wt,3,ge,nn):Gn))return!1}}return!0}function _y(x){return!(!vs(x)||(D=x,C_&&C_ in D))&&(wl(x)?Lp:Ge).test(jd(x));var D}function X1(x){return typeof x=="function"?x:x==null?ys:typeof x=="object"?Ur(x)?L_(x[0],x[1]):yy(x):om(x)}function D_(x){if(!Jg(x))return M_(x);var D=[];for(var Z in Wr(x))Ki.call(x,Z)&&Z!="constructor"&&D.push(Z);return D}function vy(x){if(!vs(x))return(function(Ie){var He=[];if(Ie!=null)for(var ct in Wr(Ie))He.push(ct);return He})(x);var D=Jg(x),Z=[];for(var ge in x)(ge!="constructor"||!D&&Ki.call(x,ge))&&Z.push(ge);return Z}function Of(x,D){return x<D}function Vh(x,D){var Z=-1,ge=Qa(x)?$n(x.length):[];return Fu(x,(function(Ie,He,ct){ge[++Z]=D(Ie,He,ct)})),ge}function yy(x){var D=sa(x);return D.length==1&&D[0][2]?Wu(D[0][0],D[0][1]):function(Z){return Z===x||If(Z,x,D)}}function L_(x,D){return em(x)&&Lf(D)?Wu(Ku(x),D):function(Z){var ge=ec(Z,x);return ge===u&&ge===D?tc(Z,x):Id(D,ge,3)}}function Od(x,D,Z,ge,Ie){x!==D&&N_(D,(function(He,ct){if(Ie||(Ie=new Kc),vs(He))(function(kt,Wt,Yt,nn,Gn,pn,Nn){var Vt=tm(kt,Yt),mn=tm(Wt,Yt),nr=Nn.get(mn);if(nr)return void Hp(kt,Yt,nr);var Rn=pn?pn(Vt,mn,Yt+"",kt,Wt,Nn):u,gr=Rn===u;if(gr){var Er=Ur(mn),si=!Er&&Ff(mn),tr=!Er&&!si&&Zu(mn);Rn=mn,Er||si||tr?Ur(Vt)?Rn=Vt:Js(Vt)?Rn=Zs(Vt):si?(gr=!1,Rn=Pf(mn,!0)):tr?(gr=!1,Rn=Pd(mn,!0)):Rn=[]:tu(mn)||Qc(mn)?(Rn=Vt,Qc(Vt)?Rn=_S(Vt):vs(Vt)&&!wl(Vt)||(Rn=Zg(mn))):gr=!1}gr&&(Nn.set(mn,Rn),Gn(Rn,mn,nn,pn,Nn),Nn.delete(mn)),Hp(kt,Yt,Rn)})(x,D,ct,Z,Od,ge,Ie);else{var ft=ge?ge(tm(x,ct),He,ct+"",x,D,Ie):u;ft===u&&(ft=He),Hp(x,ct,ft)}}),Fo)}function U_(x,D){var Z=x.length;if(Z)return Co(D+=D<0?Z:0,Z)?x[D]:u}function Yp(x,D,Z){D=D.length?Ss(D,(function(He){return Ur(He)?function(ct){return Tc(ct,He.length===1?He[0]:He)}:He})):[ys];var ge=-1;D=Ss(D,xc(vr()));var Ie=Vh(x,(function(He,ct,ft){var kt=Ss(D,(function(Wt){return Wt(He)}));return{criteria:kt,index:++ge,value:He}}));return(function(He,ct){var ft=He.length;for(He.sort(ct);ft--;)He[ft]=He[ft].value;return He})(Ie,(function(He,ct){return(function(ft,kt,Wt){for(var Yt=-1,nn=ft.criteria,Gn=kt.criteria,pn=nn.length,Nn=Wt.length;++Yt<pn;){var Vt=Dd(nn[Yt],Gn[Yt]);if(Vt)return Yt>=Nn?Vt:Vt*(Wt[Yt]=="desc"?-1:1)}return ft.index-kt.index})(He,ct,Z)}))}function by(x,D,Z){for(var ge=-1,Ie=D.length,He={};++ge<Ie;){var ct=D[ge],ft=Tc(x,ct);Z(ft,ct)&&Hg(He,Nf(ct,x),ft)}return He}function Hh(x,D,Z,ge){var Ie=ge?hr:Ec,He=-1,ct=D.length,ft=x;for(x===D&&(D=Zs(D)),Z&&(ft=Ss(x,xc(Z)));++He<ct;)for(var kt=0,Wt=D[He],Yt=Z?Z(Wt):Wt;(kt=Ie(ft,Yt,kt,ge))>-1;)ft!==x&&Td.call(ft,kt,1),Td.call(x,kt,1);return x}function B_(x,D){for(var Z=x?D.length:0,ge=Z-1;Z--;){var Ie=D[Z];if(Z==ge||Ie!==He){var He=Ie;Co(Ie)?Td.call(x,Ie,1):Ey(x,Ie)}}return x}function Vg(x,D){return x+Pg(Dg()*(D-x+1))}function Qt(x,D){var Z="";if(!x||D<1||D>T)return Z;do D%2&&(Z+=x),(D=Pg(D/2))&&(x+=x);while(D);return Z}function Kr(x,D){return Qg(qu(x,D,ys),x+"")}function mT(x){return Mf(Rc(x))}function Z1(x,D){var Z=Rc(x);return t0(Z,zh(D,0,Z.length))}function Hg(x,D,Z,ge){if(!vs(x))return x;for(var Ie=-1,He=(D=Nf(D,x)).length,ct=He-1,ft=x;ft!=null&&++Ie<He;){var kt=Ku(D[Ie]),Wt=Z;if(kt==="__proto__"||kt==="constructor"||kt==="prototype")return x;if(Ie!=ct){var Yt=ft[kt];(Wt=ge?ge(Yt,kt,ft):u)===u&&(Wt=vs(Yt)?Yt:Co(D[Ie+1])?[]:{})}La(ft,kt,Wt),ft=ft[kt]}return x}var Sy=Du?function(x,D){return Du.set(x,D),x}:ys,gT=Jl?function(x,D){return Jl(x,"toString",{configurable:!0,enumerable:!1,value:Jh(D),writable:!0})}:ys;function Nd(x){return t0(Rc(x))}function Za(x,D,Z){var ge=-1,Ie=x.length;D<0&&(D=-D>Ie?0:Ie+D),(Z=Z>Ie?Ie:Z)<0&&(Z+=Ie),Ie=D>Z?0:Z-D>>>0,D>>>=0;for(var He=$n(Ie);++ge<Ie;)He[ge]=x[ge+D];return He}function Ns(x,D){var Z;return Fu(x,(function(ge,Ie,He){return!(Z=D(ge,Ie,He))})),!!Z}function Kp(x,D,Z){var ge=0,Ie=x==null?ge:x.length;if(typeof D=="number"&&D==D&&Ie<=2147483647){for(;ge<Ie;){var He=ge+Ie>>>1,ct=x[He];ct!==null&&!Es(ct)&&(Z?ct<=D:ct<D)?ge=He+1:Ie=He}return Ie}return Ja(x,D,ys,Z)}function Ja(x,D,Z,ge){var Ie=0,He=x==null?0:x.length;if(He===0)return 0;for(var ct=(D=Z(D))!=D,ft=D===null,kt=Es(D),Wt=D===u;Ie<He;){var Yt=Pg((Ie+He)/2),nn=Z(x[Yt]),Gn=nn!==u,pn=nn===null,Nn=nn==nn,Vt=Es(nn);if(ct)var mn=ge||Nn;else mn=Wt?Nn&&(ge||Gn):ft?Nn&&Gn&&(ge||!pn):kt?Nn&&Gn&&!pn&&(ge||!Vt):!pn&&!Vt&&(ge?nn<=D:nn<D);mn?Ie=Yt+1:He=Yt}return qr(He,4294967294)}function Gh(x,D){for(var Z=-1,ge=x.length,Ie=0,He=[];++Z<ge;){var ct=x[Z],ft=D?D(ct):ct;if(!Z||!Jc(ft,kt)){var kt=ft;He[Ie++]=ct===0?0:ct}}return He}function Rr(x){return typeof x=="number"?x:Es(x)?w:+x}function na(x){if(typeof x=="string")return x;if(Ur(x))return Ss(x,na)+"";if(Es(x))return I_?I_.call(x):"";var D=x+"";return D=="0"&&1/x==-1/0?"-0":D}function Xc(x,D,Z){var ge=-1,Ie=Dp,He=x.length,ct=!0,ft=[],kt=ft;if(Z)ct=!1,Ie=Eg;else if(He>=200){var Wt=D?null:J1(x);if(Wt)return Po(Wt);ct=!1,Ie=Nu,kt=new mo}else kt=D?[]:ft;e:for(;++ge<He;){var Yt=x[ge],nn=D?D(Yt):Yt;if(Yt=Z||Yt!==0?Yt:0,ct&&nn==nn){for(var Gn=kt.length;Gn--;)if(kt[Gn]===nn)continue e;D&&kt.push(nn),ft.push(Yt)}else Ie(kt,nn,Z)||(kt!==ft&&kt.push(nn),ft.push(Yt))}return ft}function Ey(x,D){return(x=Yu(x,D=Nf(D,x)))==null||delete x[Ku(_o(D))]}function Gg(x,D,Z,ge){return Hg(x,D,Z(Tc(x,D)),ge)}function Lo(x,D,Z,ge){for(var Ie=x.length,He=ge?Ie:-1;(ge?He--:++He<Ie)&&D(x[He],He,x););return Z?Za(x,ge?0:He,ge?He+1:Ie):Za(x,ge?He+1:0,ge?Ie:He)}function Wh(x,D){var Z=x;return Z instanceof ci&&(Z=Z.value()),Tf(D,(function(ge,Ie){return Ie.func.apply(Ie.thisArg,bc([ge],Ie.args))}),Z)}function Wg(x,D,Z){var ge=x.length;if(ge<2)return ge?Xc(x[0]):[];for(var Ie=-1,He=$n(ge);++Ie<ge;)for(var ct=x[Ie],ft=-1;++ft<ge;)ft!=Ie&&(He[Ie]=kd(He[Ie]||ct,x[ft],D,Z));return Xc(Xi(He,1),D,Z)}function wc(x,D,Z){for(var ge=-1,Ie=x.length,He=D.length,ct={};++ge<Ie;){var ft=ge<He?D[ge]:u;Z(ct,x[ge],ft)}return ct}function Jt(x){return Js(x)?x:[]}function Sr(x){return typeof x=="function"?x:ys}function Nf(x,D){return Ur(x)?x:em(x,D)?[x]:Q1(Fr(x))}var Ua=Kr;function Zc(x,D,Z){var ge=x.length;return Z=Z===u?ge:Z,!D&&Z>=ge?x:Za(x,D,Z)}var F_=bl||function(x){return Mn.clearTimeout(x)};function Pf(x,D){if(D)return x.slice();var Z=x.length,ge=zi?zi(Z):new x.constructor(Z);return x.copy(ge),ge}function zu(x){var D=new x.constructor(x.byteLength);return new Up(D).set(new Up(x)),D}function Pd(x,D){var Z=D?zu(x.buffer):x.buffer;return new x.constructor(Z,x.byteOffset,x.length)}function Dd(x,D){if(x!==D){var Z=x!==u,ge=x===null,Ie=x==x,He=Es(x),ct=D!==u,ft=D===null,kt=D==D,Wt=Es(D);if(!ft&&!Wt&&!He&&x>D||He&&ct&&kt&&!ft&&!Wt||ge&&ct&&kt||!Z&&kt||!Ie)return 1;if(!ge&&!He&&!Wt&&x<D||Wt&&Z&&Ie&&!ge&&!He||ft&&Z&&Ie||!ct&&Ie||!kt)return-1}return 0}function qg(x,D,Z,ge){for(var Ie=-1,He=x.length,ct=Z.length,ft=-1,kt=D.length,Wt=Vs(He-ct,0),Yt=$n(kt+Wt),nn=!ge;++ft<kt;)Yt[ft]=D[ft];for(;++Ie<ct;)(nn||Ie<He)&&(Yt[Z[Ie]]=x[Ie]);for(;Wt--;)Yt[ft++]=x[Ie++];return Yt}function j_(x,D,Z,ge){for(var Ie=-1,He=x.length,ct=-1,ft=Z.length,kt=-1,Wt=D.length,Yt=Vs(He-ft,0),nn=$n(Yt+Wt),Gn=!ge;++Ie<Yt;)nn[Ie]=x[Ie];for(var pn=Ie;++kt<Wt;)nn[pn+kt]=D[kt];for(;++ct<ft;)(Gn||Ie<He)&&(nn[pn+Z[ct]]=x[Ie++]);return nn}function Zs(x,D){var Z=-1,ge=x.length;for(D||(D=$n(ge));++Z<ge;)D[Z]=x[Z];return D}function Ac(x,D,Z,ge){var Ie=!Z;Z||(Z={});for(var He=-1,ct=D.length;++He<ct;){var ft=D[He],kt=ge?ge(Z[ft],x[ft],ft,Z,x):u;kt===u&&(kt=x[ft]),Ie?ea(Z,ft,kt):La(Z,ft,kt)}return Z}function Df(x,D){return function(Z,ge){var Ie=Ur(Z)?V1:jh,He=D?D():{};return Ie(Z,x,vr(ge,2),He)}}function $u(x){return Kr((function(D,Z){var ge=-1,Ie=Z.length,He=Ie>1?Z[Ie-1]:u,ct=Ie>2?Z[2]:u;for(He=x.length>3&&typeof He=="function"?(Ie--,He):u,ct&&Uo(Z[0],Z[1],ct)&&(He=Ie<3?u:He,Ie=1),D=Wr(D);++ge<Ie;){var ft=Z[ge];ft&&x(D,ft,ge,He)}return D}))}function Xp(x,D){return function(Z,ge){if(Z==null)return Z;if(!Qa(Z))return x(Z,ge);for(var Ie=Z.length,He=D?Ie:-1,ct=Wr(Z);(D?He--:++He<Ie)&&ge(ct[He],He,ct)!==!1;);return Z}}function Vu(x){return function(D,Z,ge){for(var Ie=-1,He=Wr(D),ct=ge(D),ft=ct.length;ft--;){var kt=ct[x?ft:++Ie];if(Z(He[kt],kt,He)===!1)break}return D}}function Zp(x){return function(D){var Z=Qo(D=Fr(D))?Sa(D):u,ge=Z?Z[0]:D.charAt(0),Ie=Z?Zc(Z,1).join(""):D.slice(1);return ge[x]()+Ie}}function Ld(x){return function(D){return Tf(tl(aa(D).replace(fr,"")),x,"")}}function Ud(x){return function(){var D=arguments;switch(D.length){case 0:return new x;case 1:return new x(D[0]);case 2:return new x(D[0],D[1]);case 3:return new x(D[0],D[1],D[2]);case 4:return new x(D[0],D[1],D[2],D[3]);case 5:return new x(D[0],D[1],D[2],D[3],D[4]);case 6:return new x(D[0],D[1],D[2],D[3],D[4],D[5]);case 7:return new x(D[0],D[1],D[2],D[3],D[4],D[5],D[6])}var Z=Bh(x.prototype),ge=x.apply(Z,D);return vs(ge)?ge:Z}}function xy(x){return function(D,Z,ge){var Ie=Wr(D);if(!Qa(D)){var He=vr(Z,3);D=Ro(D),Z=function(ft){return He(Ie[ft],ft,Ie)}}var ct=x(D,Z,ge);return ct>-1?Ie[He?D[ct]:ct]:u}}function Jp(x){return ra((function(D){var Z=D.length,ge=Z,Ie=Ya.prototype.thru;for(x&&D.reverse();ge--;){var He=D[ge];if(typeof He!="function")throw new Yc(h);if(Ie&&!ct&&gi(He)=="wrapper")var ct=new Ya([],!0)}for(ge=ct?ge:Z;++ge<Z;){var ft=gi(He=D[ge]),kt=ft=="wrapper"?El(He):u;ct=kt&&xl(kt[0])&&kt[1]==424&&!kt[4].length&&kt[9]==1?ct[gi(kt[0])].apply(ct,kt[3]):He.length==1&&xl(He)?ct[ft]():ct.thru(He)}return function(){var Wt=arguments,Yt=Wt[0];if(ct&&Wt.length==1&&Ur(Yt))return ct.plant(Yt).value();for(var nn=0,Gn=Z?D[nn].apply(this,Wt):Yt;++nn<Z;)Gn=D[nn].call(this,Gn);return Gn}}))}function dr(x,D,Z,ge,Ie,He,ct,ft,kt,Wt){var Yt=D&v,nn=1&D,Gn=2&D,pn=24&D,Nn=512&D,Vt=Gn?u:Ud(x);return function mn(){for(var nr=arguments.length,Rn=$n(nr),gr=nr;gr--;)Rn[gr]=arguments[gr];if(pn)var Er=Bd(mn),si=(function(Ls,wa){for(var cs=Ls.length,zo=0;cs--;)Ls[cs]===wa&&++zo;return zo})(Rn,Er);if(ge&&(Rn=qg(Rn,ge,Ie,pn)),He&&(Rn=j_(Rn,He,ct,pn)),nr-=si,pn&&nr<Wt){var tr=Xl(Rn,Er);return wy(x,D,dr,mn.placeholder,Z,Rn,tr,ft,kt,Wt-nr)}var jn=nn?Z:this,wi=Gn?jn[x]:x;return nr=Rn.length,ft?Rn=(function(Ls,wa){for(var cs=Ls.length,zo=qr(wa.length,cs),$i=Zs(Ls);zo--;){var nh=wa[zo];Ls[zo]=Co(nh,cs)?$i[nh]:u}return Ls})(Rn,ft):Nn&&nr>1&&Rn.reverse(),Yt&&kt<nr&&(Rn.length=kt),this&&this!==Mn&&this instanceof mn&&(wi=Vt||Ud(wi)),wi.apply(jn,Rn)}}function Ty(x,D){return function(Z,ge){return(function(Ie,He,ct,ft){return Os(Ie,(function(kt,Wt,Yt){He(ft,ct(kt),Wt,Yt)})),ft})(Z,x,D(ge),{})}}function Yg(x,D){return function(Z,ge){var Ie;if(Z===u&&ge===u)return D;if(Z!==u&&(Ie=Z),ge!==u){if(Ie===u)return ge;typeof Z=="string"||typeof ge=="string"?(Z=na(Z),ge=na(ge)):(Z=Rr(Z),ge=Rr(ge)),Ie=x(Z,ge)}return Ie}}function Sl(x){return ra((function(D){return D=Ss(D,xc(vr())),Kr((function(Z){var ge=this;return x(D,(function(Ie){return ba(Ie,ge,Z)}))}))}))}function Hu(x,D){var Z=(D=D===u?" ":na(D)).length;if(Z<2)return Z?Qt(D,x):D;var ge=Qt(D,jp(x/_l(D)));return Qo(D)?Zc(Sa(ge),0,x).join(""):ge.slice(0,x)}function z_(x){return function(D,Z,ge){return ge&&typeof ge!="number"&&Uo(D,Z,ge)&&(Z=ge=u),D=Al(D),Z===u?(Z=D,D=0):Z=Al(Z),(function(Ie,He,ct,ft){for(var kt=-1,Wt=Vs(jp((He-Ie)/(ct||1)),0),Yt=$n(Wt);Wt--;)Yt[ft?Wt:++kt]=Ie,Ie+=ct;return Yt})(D,Z,ge=ge===u?D<Z?1:-1:Al(ge),x)}}function Kg(x){return function(D,Z){return typeof D=="string"&&typeof Z=="string"||(D=Cl(D),Z=Cl(Z)),x(D,Z)}}function wy(x,D,Z,ge,Ie,He,ct,ft,kt,Wt){var Yt=8&D;D|=Yt?m:_,4&(D&=~(Yt?_:m))||(D&=-4);var nn=[x,D,Ie,Yt?He:u,Yt?ct:u,Yt?u:He,Yt?u:ct,ft,kt,Wt],Gn=Z.apply(u,nn);return xl(x)&&Fd(Gn,nn),Gn.placeholder=ge,e0(Gn,x,D)}function $_(x){var D=Zl[x];return function(Z,ge){if(Z=Cl(Z),(ge=ge==null?0:qr(Br(ge),292))&&Ad(Z)){var Ie=(Fr(Z)+"e").split("e");return+((Ie=(Fr(D(Ie[0]+"e"+(+Ie[1]+ge)))+"e").split("e"))[0]+"e"+(+Ie[1]-ge))}return D(Z)}}var J1=Hr&&1/Po(new Hr([,-0]))[1]==b?function(x){return new Hr(x)}:Qh;function Xg(x){return function(D){var Z=Ta(D);return Z==H?dy(D):Z==Q?$s(D):(function(ge,Ie){return Ss(Ie,(function(He){return[He,ge[He]]}))})(D,x(D))}}function Gu(x,D,Z,ge,Ie,He,ct,ft){var kt=2&D;if(!kt&&typeof x!="function")throw new Yc(h);var Wt=ge?ge.length:0;if(Wt||(D&=-97,ge=Ie=u),ct=ct===u?ct:Vs(Br(ct),0),ft=ft===u?ft:Br(ft),Wt-=Ie?Ie.length:0,D&_){var Yt=ge,nn=Ie;ge=Ie=u}var Gn=kt?u:El(x),pn=[x,D,Z,ge,Ie,Yt,nn,He,ct,ft];if(Gn&&(function(Vt,mn){var nr=Vt[1],Rn=mn[1],gr=nr|Rn,Er=gr<131,si=Rn==v&&nr==8||Rn==v&&nr==S&&Vt[7].length<=mn[8]||Rn==384&&mn[7].length<=mn[8]&&nr==8;if(!Er&&!si)return Vt;1&Rn&&(Vt[2]=mn[2],gr|=1&nr?0:4);var tr=mn[3];if(tr){var jn=Vt[3];Vt[3]=jn?qg(jn,tr,mn[4]):tr,Vt[4]=jn?Xl(Vt[3],d):mn[4]}(tr=mn[5])&&(jn=Vt[5],Vt[5]=jn?j_(jn,tr,mn[6]):tr,Vt[6]=jn?Xl(Vt[5],d):mn[6]),(tr=mn[7])&&(Vt[7]=tr),Rn&v&&(Vt[8]=Vt[8]==null?mn[8]:qr(Vt[8],mn[8])),Vt[9]==null&&(Vt[9]=mn[9]),Vt[0]=mn[0],Vt[1]=gr})(pn,Gn),x=pn[0],D=pn[1],Z=pn[2],ge=pn[3],Ie=pn[4],!(ft=pn[9]=pn[9]===u?kt?0:x.length:Vs(pn[9]-Wt,0))&&24&D&&(D&=-25),D&&D!=1)Nn=D==8||D==p?(function(Vt,mn,nr){var Rn=Ud(Vt);return function gr(){for(var Er=arguments.length,si=$n(Er),tr=Er,jn=Bd(gr);tr--;)si[tr]=arguments[tr];var wi=Er<3&&si[0]!==jn&&si[Er-1]!==jn?[]:Xl(si,jn);return(Er-=wi.length)<nr?wy(Vt,mn,dr,gr.placeholder,u,si,wi,u,u,nr-Er):ba(this&&this!==Mn&&this instanceof gr?Rn:Vt,this,si)}})(x,D,ft):D!=m&&D!=33||Ie.length?dr.apply(u,pn):(function(Vt,mn,nr,Rn){var gr=1&mn,Er=Ud(Vt);return function si(){for(var tr=-1,jn=arguments.length,wi=-1,Ls=Rn.length,wa=$n(Ls+jn),cs=this&&this!==Mn&&this instanceof si?Er:Vt;++wi<Ls;)wa[wi]=Rn[wi];for(;jn--;)wa[wi++]=arguments[++tr];return ba(cs,gr?nr:this,wa)}})(x,D,Z,ge);else var Nn=(function(Vt,mn,nr){var Rn=1&mn,gr=Ud(Vt);return function Er(){return(this&&this!==Mn&&this instanceof Er?gr:Vt).apply(Rn?nr:this,arguments)}})(x,D,Z);return e0((Gn?Sy:Fd)(Nn,pn),x,D)}function Qp(x,D,Z,ge){return x===u||Jc(x,Ed[Z])&&!Ki.call(ge,Z)?D:x}function V_(x,D,Z,ge,Ie,He){return vs(x)&&vs(D)&&(He.set(D,x),Od(x,D,u,V_,He),He.delete(D)),x}function _T(x){return tu(x)?u:x}function Ay(x,D,Z,ge,Ie,He){var ct=1&Z,ft=x.length,kt=D.length;if(ft!=kt&&!(ct&&kt>ft))return!1;var Wt=He.get(x),Yt=He.get(D);if(Wt&&Yt)return Wt==D&&Yt==x;var nn=-1,Gn=!0,pn=2&Z?new mo:u;for(He.set(x,D),He.set(D,x);++nn<ft;){var Nn=x[nn],Vt=D[nn];if(ge)var mn=ct?ge(Vt,Nn,nn,D,x,He):ge(Nn,Vt,nn,x,D,He);if(mn!==u){if(mn)continue;Gn=!1;break}if(pn){if(!qc(D,(function(nr,Rn){if(!Nu(pn,Rn)&&(Nn===nr||Ie(Nn,nr,Z,ge,He)))return pn.push(Rn)}))){Gn=!1;break}}else if(Nn!==Vt&&!Ie(Nn,Vt,Z,ge,He)){Gn=!1;break}}return He.delete(x),He.delete(D),Gn}function ra(x){return Qg(qu(x,u,iS),x+"")}function Ba(x){return gy(x,Ro,H_)}function ia(x){return gy(x,Fo,eu)}var El=Du?function(x){return Du.get(x)}:Qh;function gi(x){for(var D=x.name+"",Z=Cf[D],ge=Ki.call(Cf,D)?Z.length:0;ge--;){var Ie=Z[ge],He=Ie.func;if(He==null||He==x)return Ie.name}return D}function Bd(x){return(Ki.call(Ue,"placeholder")?Ue:x).placeholder}function vr(){var x=Ue.iteratee||rv;return x=x===rv?X1:x,arguments.length?x(arguments[0],arguments[1]):x}function go(x,D){var Z,ge,Ie=x.__data__;return((ge=typeof(Z=D))=="string"||ge=="number"||ge=="symbol"||ge=="boolean"?Z!=="__proto__":Z===null)?Ie[typeof D=="string"?"string":"hash"]:Ie.map}function sa(x){for(var D=Ro(x),Z=D.length;Z--;){var ge=D[Z],Ie=x[ge];D[Z]=[ge,Ie,Lf(Ie)]}return D}function fi(x,D){var Z=(function(ge,Ie){return ge==null?u:ge[Ie]})(x,D);return _y(Z)?Z:u}var H_=zp?function(x){return x==null?[]:(x=Wr(x),ml(zp(x),(function(D){return Fp.call(x,D)})))}:Ts,eu=zp?function(x){for(var D=[];x;)bc(D,H_(x)),x=Bp(x);return D}:Ts,Ta=xa;function Cy(x,D,Z){for(var ge=-1,Ie=(D=Nf(D,x)).length,He=!1;++ge<Ie;){var ct=Ku(D[ge]);if(!(He=x!=null&&Z(x,ct)))break;x=x[ct]}return He||++ge!=Ie?He:!!(Ie=x==null?0:x.length)&&Hs(Ie)&&Co(ct,Ie)&&(Ur(x)||Qc(x))}function Zg(x){return typeof x.constructor!="function"||Jg(x)?{}:Bh(Bp(x))}function Ry(x){return Ur(x)||Qc(x)||!!(Pu&&x&&x[Pu])}function Co(x,D){var Z=typeof x;return!!(D=D??T)&&(Z=="number"||Z!="symbol"&&Be.test(x))&&x>-1&&x%1==0&&x<D}function Uo(x,D,Z){if(!vs(Z))return!1;var ge=typeof D;return!!(ge=="number"?Qa(Z)&&Co(D,Z.length):ge=="string"&&D in Z)&&Jc(Z[D],x)}function em(x,D){if(Ur(x))return!1;var Z=typeof x;return!(Z!="number"&&Z!="symbol"&&Z!="boolean"&&x!=null&&!Es(x))||et.test(x)||!Xe.test(x)||D!=null&&x in Wr(D)}function xl(x){var D=gi(x),Z=Ue[D];if(typeof Z!="function"||!(D in ci.prototype))return!1;if(x===Z)return!0;var ge=El(Z);return!!ge&&x===ge[0]}(fn&&Ta(new fn(new ArrayBuffer(1)))!=ie||Sn&&Ta(new Sn)!=H||Cd&&Ta(Cd.resolve())!=Y||Hr&&Ta(new Hr)!=Q||Cr&&Ta(new Cr)!=ee)&&(Ta=function(x){var D=xa(x),Z=D==G?x.constructor:u,ge=Z?jd(Z):"";if(ge)switch(ge){case $p:return ie;case Rd:return H;case Lg:return Y;case Ug:return Q;case my:return ee}return D});var qh=xd?wl:Hd;function Jg(x){var D=x&&x.constructor;return x===(typeof D=="function"&&D.prototype||Ed)}function Lf(x){return x==x&&!vs(x)}function Wu(x,D){return function(Z){return Z!=null&&Z[x]===D&&(D!==u||x in Wr(Z))}}function qu(x,D,Z){return D=Vs(D===u?x.length-1:D,0),function(){for(var ge=arguments,Ie=-1,He=Vs(ge.length-D,0),ct=$n(He);++Ie<He;)ct[Ie]=ge[D+Ie];Ie=-1;for(var ft=$n(D+1);++Ie<D;)ft[Ie]=ge[Ie];return ft[D]=Z(ct),ba(x,this,ft)}}function Yu(x,D){return D.length<2?x:Tc(x,Za(D,0,-1))}function tm(x,D){if((D!=="constructor"||typeof x[D]!="function")&&D!="__proto__")return x[D]}var Fd=nm(Sy),Yh=q1||function(x,D){return Mn.setTimeout(x,D)},Qg=nm(gT);function e0(x,D,Z){var ge=D+"";return Qg(x,(function(Ie,He){var ct=He.length;if(!ct)return Ie;var ft=ct-1;return He[ft]=(ct>1?"& ":"")+He[ft],He=He.join(ct>2?", ":" "),Ie.replace(W,`{
/* [wrapped with `+He+`] */
`)})(ge,(function(Ie,He){return Wc(C,(function(ct){var ft="_."+ct[0];He&ct[1]&&!Dp(Ie,ft)&&Ie.push(ft)})),Ie.sort()})((function(Ie){var He=Ie.match(oe);return He?He[1].split(Se):[]})(ge),Z)))}function nm(x){var D=0,Z=0;return function(){var ge=Y1(),Ie=16-(ge-Z);if(Z=ge,Ie>0){if(++D>=800)return arguments[0]}else D=0;return x.apply(u,arguments)}}function t0(x,D){var Z=-1,ge=x.length,Ie=ge-1;for(D=D===u?ge:D;++Z<D;){var He=Vg(Z,Ie),ct=x[He];x[He]=x[Z],x[Z]=ct}return x.length=D,x}var Q1=(function(x){var D=o0(x,(function(ge){return Z.size===500&&Z.clear(),ge})),Z=D.cache;return D})((function(x){var D=[];return x.charCodeAt(0)===46&&D.push(""),x.replace(Ut,(function(Z,ge,Ie,He){D.push(Ie?He.replace(_e,"$1"):ge||Z)})),D}));function Ku(x){if(typeof x=="string"||Es(x))return x;var D=x+"";return D=="0"&&1/x==-1/0?"-0":D}function jd(x){if(x!=null){try{return kg.call(x)}catch{}try{return x+""}catch{}}return""}function eS(x){if(x instanceof ci)return x.clone();var D=new Ya(x.__wrapped__,x.__chain__);return D.__actions__=Zs(x.__actions__),D.__index__=x.__index__,D.__values__=x.__values__,D}var tS=Kr((function(x,D){return Js(x)?kd(x,Xi(D,1,Js,!0)):[]})),nS=Kr((function(x,D){var Z=_o(D);return Js(Z)&&(Z=u),Js(x)?kd(x,Xi(D,1,Js,!0),vr(Z,2)):[]})),G_=Kr((function(x,D){var Z=_o(D);return Js(Z)&&(Z=u),Js(x)?kd(x,Xi(D,1,Js,!0),u,Z):[]}));function rS(x,D,Z){var ge=x==null?0:x.length;if(!ge)return-1;var Ie=Z==null?0:Br(Z);return Ie<0&&(Ie=Vs(ge+Ie,0)),Lh(x,vr(D,3),Ie)}function ky(x,D,Z){var ge=x==null?0:x.length;if(!ge)return-1;var Ie=ge-1;return Z!==u&&(Ie=Br(Z),Ie=Z<0?Vs(ge+Ie,0):qr(Ie,ge-1)),Lh(x,vr(D,3),Ie,!0)}function iS(x){return x!=null&&x.length?Xi(x,1):[]}function sS(x){return x&&x.length?x[0]:u}var vT=Kr((function(x){var D=Ss(x,Jt);return D.length&&D[0]===x[0]?P_(D):[]})),oS=Kr((function(x){var D=_o(x),Z=Ss(x,Jt);return D===_o(Z)?D=u:Z.pop(),Z.length&&Z[0]===x[0]?P_(Z,vr(D,2)):[]})),aS=Kr((function(x){var D=_o(x),Z=Ss(x,Jt);return(D=typeof D=="function"?D:u)&&Z.pop(),Z.length&&Z[0]===x[0]?P_(Z,u,D):[]}));function _o(x){var D=x==null?0:x.length;return D?x[D-1]:u}var My=Kr(W_);function W_(x,D){return x&&x.length&&D&&D.length?Hh(x,D):x}var yT=ra((function(x,D){var Z=x==null?0:x.length,ge=O_(x,D);return B_(x,Ss(D,(function(Ie){return Co(Ie,Z)?+Ie:Ie})).sort(Dd)),ge}));function q_(x){return x==null?x:Tn.call(x)}var cS=Kr((function(x){return Xc(Xi(x,1,Js,!0))})),lS=Kr((function(x){var D=_o(x);return Js(D)&&(D=u),Xc(Xi(x,1,Js,!0),vr(D,2))})),Iy=Kr((function(x){var D=_o(x);return D=typeof D=="function"?D:u,Xc(Xi(x,1,Js,!0),u,D)}));function n0(x){if(!x||!x.length)return[];var D=0;return x=ml(x,(function(Z){if(Js(Z))return D=Vs(Z.length,D),!0})),Da(D,(function(Z){return Ss(x,E_(Z))}))}function uS(x,D){if(!x||!x.length)return[];var Z=n0(x);return D==null?Z:Ss(Z,(function(ge){return ba(D,u,ge)}))}var bT=Kr((function(x,D){return Js(x)?kd(x,D):[]})),ST=Kr((function(x){return Wg(ml(x,Js))})),Y_=Kr((function(x){var D=_o(x);return Js(D)&&(D=u),Wg(ml(x,Js),vr(D,2))})),rm=Kr((function(x){var D=_o(x);return D=typeof D=="function"?D:u,Wg(ml(x,Js),u,D)})),im=Kr(n0),sm=Kr((function(x){var D=x.length,Z=D>1?x[D-1]:u;return Z=typeof Z=="function"?(x.pop(),Z):u,uS(x,Z)}));function Uf(x){var D=Ue(x);return D.__chain__=!0,D}function Kh(x,D){return D(x)}var Bf=ra((function(x){var D=x.length,Z=D?x[0]:0,ge=this.__wrapped__,Ie=function(He){return O_(He,x)};return!(D>1||this.__actions__.length)&&ge instanceof ci&&Co(Z)?((ge=ge.slice(Z,+Z+(D?1:0))).__actions__.push({func:Kh,args:[Ie],thisArg:u}),new Ya(ge,this.__chain__).thru((function(He){return D&&!He.length&&He.push(u),He}))):this.thru(Ie)})),K_=Df((function(x,D,Z){Ki.call(x,Z)?++x[Z]:ea(x,Z,1)})),ET=xy(rS),xT=xy(ky);function r0(x,D){return(Ur(x)?Wc:Fu)(x,vr(D,3))}function hS(x,D){return(Ur(x)?uy:Fg)(x,vr(D,3))}var TT=Df((function(x,D,Z){Ki.call(x,Z)?x[Z].push(D):ea(x,Z,[D])})),i0=Kr((function(x,D,Z){var ge=-1,Ie=typeof D=="function",He=Qa(x)?$n(x.length):[];return Fu(x,(function(ct){He[++ge]=Ie?ba(D,ct,Z):$h(ct,D,Z)})),He})),fS=Df((function(x,D,Z){ea(x,Z,D)}));function Xh(x,D){return(Ur(x)?Ss:Vh)(x,vr(D,3))}var dS=Df((function(x,D,Z){x[Z?0:1].push(D)}),(function(){return[[],[]]})),pS=Kr((function(x,D){if(x==null)return[];var Z=D.length;return Z>1&&Uo(x,D[0],D[1])?D=[]:Z>2&&Uo(D[0],D[1],D[2])&&(D=[D[0]]),Yp(x,Xi(D,1),[])})),s0=Ng||function(){return Mn.Date.now()};function Oy(x,D,Z){return D=Z?u:D,D=x&&D==null?x.length:D,Gu(x,v,u,u,u,u,D)}function Ny(x,D){var Z;if(typeof D!="function")throw new Yc(h);return x=Br(x),function(){return--x>0&&(Z=D.apply(this,arguments)),x<=1&&(D=u),Z}}var X_=Kr((function(x,D,Z){var ge=1;if(Z.length){var Ie=Xl(Z,Bd(X_));ge|=m}return Gu(x,ge,D,Z,Ie)})),Z_=Kr((function(x,D,Z){var ge=3;if(Z.length){var Ie=Xl(Z,Bd(Z_));ge|=m}return Gu(D,ge,x,Z,Ie)}));function Py(x,D,Z){var ge,Ie,He,ct,ft,kt,Wt=0,Yt=!1,nn=!1,Gn=!0;if(typeof x!="function")throw new Yc(h);function pn(Rn){var gr=ge,Er=Ie;return ge=Ie=u,Wt=Rn,ct=x.apply(Er,gr)}function Nn(Rn){var gr=Rn-kt;return kt===u||gr>=D||gr<0||nn&&Rn-Wt>=He}function Vt(){var Rn=s0();if(Nn(Rn))return mn(Rn);ft=Yh(Vt,(function(gr){var Er=D-(gr-kt);return nn?qr(Er,He-(gr-Wt)):Er})(Rn))}function mn(Rn){return ft=u,Gn&&ge?pn(Rn):(ge=Ie=u,ct)}function nr(){var Rn=s0(),gr=Nn(Rn);if(ge=arguments,Ie=this,kt=Rn,gr){if(ft===u)return(function(Er){return Wt=Er,ft=Yh(Vt,D),Yt?pn(Er):ct})(kt);if(nn)return F_(ft),ft=Yh(Vt,D),pn(kt)}return ft===u&&(ft=Yh(Vt,D)),ct}return D=Cl(D)||0,vs(Z)&&(Yt=!!Z.leading,He=(nn="maxWait"in Z)?Vs(Cl(Z.maxWait)||0,D):He,Gn="trailing"in Z?!!Z.trailing:Gn),nr.cancel=function(){ft!==u&&F_(ft),Wt=0,ge=kt=Ie=ft=u},nr.flush=function(){return ft===u?ct:mn(s0())},nr}var Dy=Kr((function(x,D){return Bu(x,1,D)})),mS=Kr((function(x,D,Z){return Bu(x,Cl(D)||0,Z)}));function o0(x,D){if(typeof x!="function"||D!=null&&typeof D!="function")throw new Yc(h);var Z=function(){var ge=arguments,Ie=D?D.apply(this,ge):ge[0],He=Z.cache;if(He.has(Ie))return He.get(Ie);var ct=x.apply(this,ge);return Z.cache=He.set(Ie,ct)||He,ct};return Z.cache=new(o0.Cache||Lu),Z}function a0(x){if(typeof x!="function")throw new Yc(h);return function(){var D=arguments;switch(D.length){case 0:return!x.call(this);case 1:return!x.call(this,D[0]);case 2:return!x.call(this,D[0],D[1]);case 3:return!x.call(this,D[0],D[1],D[2])}return!x.apply(this,D)}}o0.Cache=Lu;var Bo=Ua((function(x,D){var Z=(D=D.length==1&&Ur(D[0])?Ss(D[0],xc(vr())):Ss(Xi(D,1),xc(vr()))).length;return Kr((function(ge){for(var Ie=-1,He=qr(ge.length,Z);++Ie<He;)ge[Ie]=D[Ie].call(this,ge[Ie]);return ba(x,this,ge)}))})),c0=Kr((function(x,D){var Z=Xl(D,Bd(c0));return Gu(x,m,u,D,Z)})),gS=Kr((function(x,D){var Z=Xl(D,Bd(gS));return Gu(x,_,u,D,Z)})),Tl=ra((function(x,D){return Gu(x,S,u,u,u,D)}));function Jc(x,D){return x===D||x!=x&&D!=D}var l0=Kg(ju),Ly=Kg((function(x,D){return x>=D})),Qc=$g((function(){return arguments})())?$g:function(x){return Qs(x)&&Ki.call(x,"callee")&&!Fp.call(x,"callee")},Ur=$n.isArray,wT=Gc?xc(Gc):function(x){return Qs(x)&&xa(x)==te};function Qa(x){return x!=null&&Hs(x.length)&&!wl(x)}function Js(x){return Qs(x)&&Qa(x)}var Ff=R_||Hd,AT=Sg?xc(Sg):function(x){return Qs(x)&&xa(x)==$};function Uy(x){if(!Qs(x))return!1;var D=xa(x);return D==I||D=="[object DOMException]"||typeof x.message=="string"&&typeof x.name=="string"&&!tu(x)}function wl(x){if(!vs(x))return!1;var D=xa(x);return D==L||D==P||D=="[object AsyncFunction]"||D=="[object Proxy]"}function J_(x){return typeof x=="number"&&x==Br(x)}function Hs(x){return typeof x=="number"&&x>-1&&x%1==0&&x<=T}function vs(x){var D=typeof x;return x!=null&&(D=="object"||D=="function")}function Qs(x){return x!=null&&typeof x=="object"}var By=v_?xc(v_):function(x){return Qs(x)&&Ta(x)==H};function Fy(x){return typeof x=="number"||Qs(x)&&xa(x)==X}function tu(x){if(!Qs(x)||xa(x)!=G)return!1;var D=Bp(x);if(D===null)return!0;var Z=Ki.call(D,"constructor")&&D.constructor;return typeof Z=="function"&&Z instanceof Z&&kg.call(Z)==W1}var u0=y_?xc(y_):function(x){return Qs(x)&&xa(x)==J},Xu=b_?xc(b_):function(x){return Qs(x)&&Ta(x)==Q};function Zh(x){return typeof x=="string"||!Ur(x)&&Qs(x)&&xa(x)==z}function Es(x){return typeof x=="symbol"||Qs(x)&&xa(x)==q}var Zu=Pp?xc(Pp):function(x){return Qs(x)&&Hs(x.length)&&!!br[xa(x)]},Q_=Kg(Of),h0=Kg((function(x,D){return x<=D}));function f0(x){if(!x)return[];if(Qa(x))return Zh(x)?Sa(x):Zs(x);if(wd&&x[wd])return(function(Z){for(var ge,Ie=[];!(ge=Z.next()).done;)Ie.push(ge.value);return Ie})(x[wd]());var D=Ta(x);return(D==H?dy:D==Q?Po:Rc)(x)}function Al(x){return x?(x=Cl(x))===b||x===-1/0?17976931348623157e292*(x<0?-1:1):x==x?x:0:x===0?x:0}function Br(x){var D=Al(x),Z=D%1;return D==D?Z?D-Z:D:0}function ev(x){return x?zh(Br(x),0,R):0}function Cl(x){if(typeof x=="number")return x;if(Es(x))return w;if(vs(x)){var D=typeof x.valueOf=="function"?x.valueOf():x;x=vs(D)?D+"":D}if(typeof x!="string")return x===0?x:+x;x=wg(x);var Z=Fe.test(x);return Z||at.test(x)?Rs(x.slice(2),Z?2:8):Ve.test(x)?w:+x}function _S(x){return Ac(x,Fo(x))}function Fr(x){return x==null?"":na(x)}var vS=$u((function(x,D){if(Jg(D)||Qa(D))Ac(D,Ro(D),x);else for(var Z in D)Ki.call(D,Z)&&La(x,Z,D[Z])})),yS=$u((function(x,D){Ac(D,Fo(D),x)})),zd=$u((function(x,D,Z,ge){Ac(D,Fo(D),x,ge)})),CT=$u((function(x,D,Z,ge){Ac(D,Ro(D),x,ge)})),RT=ra(O_),kT=Kr((function(x,D){x=Wr(x);var Z=-1,ge=D.length,Ie=ge>2?D[2]:u;for(Ie&&Uo(D[0],D[1],Ie)&&(ge=1);++Z<ge;)for(var He=D[Z],ct=Fo(He),ft=-1,kt=ct.length;++ft<kt;){var Wt=ct[ft],Yt=x[Wt];(Yt===u||Jc(Yt,Ed[Wt])&&!Ki.call(x,Wt))&&(x[Wt]=He[Wt])}return x})),d0=Kr((function(x){return x.push(u,V_),ba(oa,u,x)}));function ec(x,D,Z){var ge=x==null?u:Tc(x,D);return ge===u?Z:ge}function tc(x,D){return x!=null&&Cy(x,D,K1)}var bS=Ty((function(x,D,Z){D!=null&&typeof D.toString!="function"&&(D=Ig.call(D)),x[D]=Z}),Jh(ys)),MT=Ty((function(x,D,Z){D!=null&&typeof D.toString!="function"&&(D=Ig.call(D)),Ki.call(x,D)?x[D].push(Z):x[D]=[Z]}),vr),jy=Kr($h);function Ro(x){return Qa(x)?Uu(x):D_(x)}function Fo(x){return Qa(x)?Uu(x,!0):vy(x)}var nc=$u((function(x,D,Z){Od(x,D,Z)})),oa=$u((function(x,D,Z,ge){Od(x,D,Z,ge)})),Ni=ra((function(x,D){var Z={};if(x==null)return Z;var ge=!1;D=Ss(D,(function(He){return He=Nf(He,x),ge||(ge=He.length>1),He})),Ac(x,ia(x),Z),ge&&(Z=ta(Z,7,_T));for(var Ie=D.length;Ie--;)Ey(Z,D[Ie]);return Z})),tv=ra((function(x,D){return x==null?{}:(function(Z,ge){return by(Z,ge,(function(Ie,He){return tc(Z,He)}))})(x,D)}));function $d(x,D){if(x==null)return{};var Z=Ss(ia(x),(function(ge){return[ge]}));return D=vr(D),by(x,Z,(function(ge,Ie){return D(ge,Ie[0])}))}var el=Xg(Ro),Cc=Xg(Fo);function Rc(x){return x==null?[]:T_(x,Ro(x))}var Ju=Ld((function(x,D,Z){return D=D.toLowerCase(),x+(Z?nu(D):D)}));function nu(x){return ru(Fr(x).toLowerCase())}function aa(x){return(x=Fr(x))&&x.replace(tt,w_).replace(Cn,"")}var p0=Ld((function(x,D,Z){return x+(Z?"-":"")+D.toLowerCase()})),jf=Ld((function(x,D,Z){return x+(Z?" ":"")+D.toLowerCase()})),nv=Zp("toLowerCase"),jo=Ld((function(x,D,Z){return x+(Z?"_":"")+D.toLowerCase()})),li=Ld((function(x,D,Z){return x+(Z?" ":"")+ru(D)})),_i=Ld((function(x,D,Z){return x+(Z?" ":"")+D.toUpperCase()})),ru=Zp("toUpperCase");function tl(x,D,Z){return x=Fr(x),(D=Z?u:D)===u?(function(ge){return Lr.test(ge)})(x)?(function(ge){return ge.match(Vr)||[]})(x):(function(ge){return ge.match(Ae)||[]})(x):x.match(D)||[]}var zf=Kr((function(x,D){try{return ba(x,u,D)}catch(Z){return Uy(Z)?Z:new Si(Z)}})),ca=ra((function(x,D){return Wc(D,(function(Z){Z=Ku(Z),ea(x,Z,X_(x[Z],x))})),x}));function Jh(x){return function(){return x}}var Qu=Jp(),SS=Jp(!0);function ys(x){return x}function rv(x){return X1(typeof x=="function"?x:ta(x,1))}var Ps=Kr((function(x,D){return function(Z){return $h(Z,x,D)}})),iv=Kr((function(x,D){return function(Z){return $h(x,Z,D)}}));function xs(x,D,Z){var ge=Ro(D),Ie=zg(D,ge);Z!=null||vs(D)&&(Ie.length||!ge.length)||(Z=D,D=x,x=this,Ie=zg(D,Ro(D)));var He=!(vs(Z)&&"chain"in Z&&!Z.chain),ct=wl(x);return Wc(Ie,(function(ft){var kt=D[ft];x[ft]=kt,ct&&(x.prototype[ft]=function(){var Wt=this.__chain__;if(He||Wt){var Yt=x(this.__wrapped__);return(Yt.__actions__=Zs(this.__actions__)).push({func:kt,args:arguments,thisArg:x}),Yt.__chain__=Wt,Yt}return kt.apply(x,bc([this.value()],arguments))})})),x}function Qh(){}var m0=Sl(Ss),sv=Sl(S_),Vd=Sl(qc);function om(x){return em(x)?E_(Ku(x)):(function(D){return function(Z){return Tc(Z,D)}})(x)}var zy=z_(),eh=z_(!0);function Ts(){return[]}function Hd(){return!1}var Ds=Yg((function(x,D){return x+D}),0),kc=$_("ceil"),$y=Yg((function(x,D){return x/D}),1),$f=$_("floor"),ef,eo=Yg((function(x,D){return x*D}),1),Gs=$_("round"),th=Yg((function(x,D){return x-D}),0);return Ue.after=function(x,D){if(typeof D!="function")throw new Yc(h);return x=Br(x),function(){if(--x<1)return D.apply(this,arguments)}},Ue.ary=Oy,Ue.assign=vS,Ue.assignIn=yS,Ue.assignInWith=zd,Ue.assignWith=CT,Ue.at=RT,Ue.before=Ny,Ue.bind=X_,Ue.bindAll=ca,Ue.bindKey=Z_,Ue.castArray=function(){if(!arguments.length)return[];var x=arguments[0];return Ur(x)?x:[x]},Ue.chain=Uf,Ue.chunk=function(x,D,Z){D=(Z?Uo(x,D,Z):D===u)?1:Vs(Br(D),0);var ge=x==null?0:x.length;if(!ge||D<1)return[];for(var Ie=0,He=0,ct=$n(jp(ge/D));Ie<ge;)ct[He++]=Za(x,Ie,Ie+=D);return ct},Ue.compact=function(x){for(var D=-1,Z=x==null?0:x.length,ge=0,Ie=[];++D<Z;){var He=x[D];He&&(Ie[ge++]=He)}return Ie},Ue.concat=function(){var x=arguments.length;if(!x)return[];for(var D=$n(x-1),Z=arguments[0],ge=x;ge--;)D[ge-1]=arguments[ge];return bc(Ur(Z)?Zs(Z):[Z],Xi(D,1))},Ue.cond=function(x){var D=x==null?0:x.length,Z=vr();return x=D?Ss(x,(function(ge){if(typeof ge[1]!="function")throw new Yc(h);return[Z(ge[0]),ge[1]]})):[],Kr((function(ge){for(var Ie=-1;++Ie<D;){var He=x[Ie];if(ba(He[0],this,ge))return ba(He[1],this,ge)}}))},Ue.conforms=function(x){return(function(D){var Z=Ro(D);return function(ge){return Ka(ge,D,Z)}})(ta(x,1))},Ue.constant=Jh,Ue.countBy=K_,Ue.create=function(x,D){var Z=Bh(x);return D==null?Z:Gp(Z,D)},Ue.curry=function x(D,Z,ge){var Ie=Gu(D,8,u,u,u,u,u,Z=ge?u:Z);return Ie.placeholder=x.placeholder,Ie},Ue.curryRight=function x(D,Z,ge){var Ie=Gu(D,p,u,u,u,u,u,Z=ge?u:Z);return Ie.placeholder=x.placeholder,Ie},Ue.debounce=Py,Ue.defaults=kT,Ue.defaultsDeep=d0,Ue.defer=Dy,Ue.delay=mS,Ue.difference=tS,Ue.differenceBy=nS,Ue.differenceWith=G_,Ue.drop=function(x,D,Z){var ge=x==null?0:x.length;return ge?Za(x,(D=Z||D===u?1:Br(D))<0?0:D,ge):[]},Ue.dropRight=function(x,D,Z){var ge=x==null?0:x.length;return ge?Za(x,0,(D=ge-(D=Z||D===u?1:Br(D)))<0?0:D):[]},Ue.dropRightWhile=function(x,D){return x&&x.length?Lo(x,vr(D,3),!0,!0):[]},Ue.dropWhile=function(x,D){return x&&x.length?Lo(x,vr(D,3),!0):[]},Ue.fill=function(x,D,Z,ge){var Ie=x==null?0:x.length;return Ie?(Z&&typeof Z!="number"&&Uo(x,D,Z)&&(Z=0,ge=Ie),(function(He,ct,ft,kt){var Wt=He.length;for((ft=Br(ft))<0&&(ft=-ft>Wt?0:Wt+ft),(kt=kt===u||kt>Wt?Wt:Br(kt))<0&&(kt+=Wt),kt=ft>kt?0:ev(kt);ft<kt;)He[ft++]=ct;return He})(x,D,Z,ge)):[]},Ue.filter=function(x,D){return(Ur(x)?ml:Tr)(x,vr(D,3))},Ue.flatMap=function(x,D){return Xi(Xh(x,D),1)},Ue.flatMapDeep=function(x,D){return Xi(Xh(x,D),b)},Ue.flatMapDepth=function(x,D,Z){return Z=Z===u?1:Br(Z),Xi(Xh(x,D),Z)},Ue.flatten=iS,Ue.flattenDeep=function(x){return x!=null&&x.length?Xi(x,b):[]},Ue.flattenDepth=function(x,D){return x!=null&&x.length?Xi(x,D=D===u?1:Br(D)):[]},Ue.flip=function(x){return Gu(x,512)},Ue.flow=Qu,Ue.flowRight=SS,Ue.fromPairs=function(x){for(var D=-1,Z=x==null?0:x.length,ge={};++D<Z;){var Ie=x[D];ge[Ie[0]]=Ie[1]}return ge},Ue.functions=function(x){return x==null?[]:zg(x,Ro(x))},Ue.functionsIn=function(x){return x==null?[]:zg(x,Fo(x))},Ue.groupBy=TT,Ue.initial=function(x){return x!=null&&x.length?Za(x,0,-1):[]},Ue.intersection=vT,Ue.intersectionBy=oS,Ue.intersectionWith=aS,Ue.invert=bS,Ue.invertBy=MT,Ue.invokeMap=i0,Ue.iteratee=rv,Ue.keyBy=fS,Ue.keys=Ro,Ue.keysIn=Fo,Ue.map=Xh,Ue.mapKeys=function(x,D){var Z={};return D=vr(D,3),Os(x,(function(ge,Ie,He){ea(Z,D(ge,Ie,He),ge)})),Z},Ue.mapValues=function(x,D){var Z={};return D=vr(D,3),Os(x,(function(ge,Ie,He){ea(Z,Ie,D(ge,Ie,He))})),Z},Ue.matches=function(x){return yy(ta(x,1))},Ue.matchesProperty=function(x,D){return L_(x,ta(D,1))},Ue.memoize=o0,Ue.merge=nc,Ue.mergeWith=oa,Ue.method=Ps,Ue.methodOf=iv,Ue.mixin=xs,Ue.negate=a0,Ue.nthArg=function(x){return x=Br(x),Kr((function(D){return U_(D,x)}))},Ue.omit=Ni,Ue.omitBy=function(x,D){return $d(x,a0(vr(D)))},Ue.once=function(x){return Ny(2,x)},Ue.orderBy=function(x,D,Z,ge){return x==null?[]:(Ur(D)||(D=D==null?[]:[D]),Ur(Z=ge?u:Z)||(Z=Z==null?[]:[Z]),Yp(x,D,Z))},Ue.over=m0,Ue.overArgs=Bo,Ue.overEvery=sv,Ue.overSome=Vd,Ue.partial=c0,Ue.partialRight=gS,Ue.partition=dS,Ue.pick=tv,Ue.pickBy=$d,Ue.property=om,Ue.propertyOf=function(x){return function(D){return x==null?u:Tc(x,D)}},Ue.pull=My,Ue.pullAll=W_,Ue.pullAllBy=function(x,D,Z){return x&&x.length&&D&&D.length?Hh(x,D,vr(Z,2)):x},Ue.pullAllWith=function(x,D,Z){return x&&x.length&&D&&D.length?Hh(x,D,u,Z):x},Ue.pullAt=yT,Ue.range=zy,Ue.rangeRight=eh,Ue.rearg=Tl,Ue.reject=function(x,D){return(Ur(x)?ml:Tr)(x,a0(vr(D,3)))},Ue.remove=function(x,D){var Z=[];if(!x||!x.length)return Z;var ge=-1,Ie=[],He=x.length;for(D=vr(D,3);++ge<He;){var ct=x[ge];D(ct,ge,x)&&(Z.push(ct),Ie.push(ge))}return B_(x,Ie),Z},Ue.rest=function(x,D){if(typeof x!="function")throw new Yc(h);return Kr(x,D=D===u?D:Br(D))},Ue.reverse=q_,Ue.sampleSize=function(x,D,Z){return D=(Z?Uo(x,D,Z):D===u)?1:Br(D),(Ur(x)?Fh:Z1)(x,D)},Ue.set=function(x,D,Z){return x==null?x:Hg(x,D,Z)},Ue.setWith=function(x,D,Z,ge){return ge=typeof ge=="function"?ge:u,x==null?x:Hg(x,D,Z,ge)},Ue.shuffle=function(x){return(Ur(x)?Do:Nd)(x)},Ue.slice=function(x,D,Z){var ge=x==null?0:x.length;return ge?(Z&&typeof Z!="number"&&Uo(x,D,Z)?(D=0,Z=ge):(D=D==null?0:Br(D),Z=Z===u?ge:Br(Z)),Za(x,D,Z)):[]},Ue.sortBy=pS,Ue.sortedUniq=function(x){return x&&x.length?Gh(x):[]},Ue.sortedUniqBy=function(x,D){return x&&x.length?Gh(x,vr(D,2)):[]},Ue.split=function(x,D,Z){return Z&&typeof Z!="number"&&Uo(x,D,Z)&&(D=Z=u),(Z=Z===u?R:Z>>>0)?(x=Fr(x))&&(typeof D=="string"||D!=null&&!u0(D))&&!(D=na(D))&&Qo(x)?Zc(Sa(x),0,Z):x.split(D,Z):[]},Ue.spread=function(x,D){if(typeof x!="function")throw new Yc(h);return D=D==null?0:Vs(Br(D),0),Kr((function(Z){var ge=Z[D],Ie=Zc(Z,0,D);return ge&&bc(Ie,ge),ba(x,this,Ie)}))},Ue.tail=function(x){var D=x==null?0:x.length;return D?Za(x,1,D):[]},Ue.take=function(x,D,Z){return x&&x.length?Za(x,0,(D=Z||D===u?1:Br(D))<0?0:D):[]},Ue.takeRight=function(x,D,Z){var ge=x==null?0:x.length;return ge?Za(x,(D=ge-(D=Z||D===u?1:Br(D)))<0?0:D,ge):[]},Ue.takeRightWhile=function(x,D){return x&&x.length?Lo(x,vr(D,3),!1,!0):[]},Ue.takeWhile=function(x,D){return x&&x.length?Lo(x,vr(D,3)):[]},Ue.tap=function(x,D){return D(x),x},Ue.throttle=function(x,D,Z){var ge=!0,Ie=!0;if(typeof x!="function")throw new Yc(h);return vs(Z)&&(ge="leading"in Z?!!Z.leading:ge,Ie="trailing"in Z?!!Z.trailing:Ie),Py(x,D,{leading:ge,maxWait:D,trailing:Ie})},Ue.thru=Kh,Ue.toArray=f0,Ue.toPairs=el,Ue.toPairsIn=Cc,Ue.toPath=function(x){return Ur(x)?Ss(x,Ku):Es(x)?[x]:Zs(Q1(Fr(x)))},Ue.toPlainObject=_S,Ue.transform=function(x,D,Z){var ge=Ur(x),Ie=ge||Ff(x)||Zu(x);if(D=vr(D,4),Z==null){var He=x&&x.constructor;Z=Ie?ge?new He:[]:vs(x)&&wl(He)?Bh(Bp(x)):{}}return(Ie?Wc:Os)(x,(function(ct,ft,kt){return D(Z,ct,ft,kt)})),Z},Ue.unary=function(x){return Oy(x,1)},Ue.union=cS,Ue.unionBy=lS,Ue.unionWith=Iy,Ue.uniq=function(x){return x&&x.length?Xc(x):[]},Ue.uniqBy=function(x,D){return x&&x.length?Xc(x,vr(D,2)):[]},Ue.uniqWith=function(x,D){return D=typeof D=="function"?D:u,x&&x.length?Xc(x,u,D):[]},Ue.unset=function(x,D){return x==null||Ey(x,D)},Ue.unzip=n0,Ue.unzipWith=uS,Ue.update=function(x,D,Z){return x==null?x:Gg(x,D,Sr(Z))},Ue.updateWith=function(x,D,Z,ge){return ge=typeof ge=="function"?ge:u,x==null?x:Gg(x,D,Sr(Z),ge)},Ue.values=Rc,Ue.valuesIn=function(x){return x==null?[]:T_(x,Fo(x))},Ue.without=bT,Ue.words=tl,Ue.wrap=function(x,D){return c0(Sr(D),x)},Ue.xor=ST,Ue.xorBy=Y_,Ue.xorWith=rm,Ue.zip=im,Ue.zipObject=function(x,D){return wc(x||[],D||[],La)},Ue.zipObjectDeep=function(x,D){return wc(x||[],D||[],Hg)},Ue.zipWith=sm,Ue.entries=el,Ue.entriesIn=Cc,Ue.extend=yS,Ue.extendWith=zd,xs(Ue,Ue),Ue.add=Ds,Ue.attempt=zf,Ue.camelCase=Ju,Ue.capitalize=nu,Ue.ceil=kc,Ue.clamp=function(x,D,Z){return Z===u&&(Z=D,D=u),Z!==u&&(Z=(Z=Cl(Z))==Z?Z:0),D!==u&&(D=(D=Cl(D))==D?D:0),zh(Cl(x),D,Z)},Ue.clone=function(x){return ta(x,4)},Ue.cloneDeep=function(x){return ta(x,5)},Ue.cloneDeepWith=function(x,D){return ta(x,5,D=typeof D=="function"?D:u)},Ue.cloneWith=function(x,D){return ta(x,4,D=typeof D=="function"?D:u)},Ue.conformsTo=function(x,D){return D==null||Ka(x,D,Ro(D))},Ue.deburr=aa,Ue.defaultTo=function(x,D){return x==null||x!=x?D:x},Ue.divide=$y,Ue.endsWith=function(x,D,Z){x=Fr(x),D=na(D);var ge=x.length,Ie=Z=Z===u?ge:zh(Br(Z),0,ge);return(Z-=D.length)>=0&&x.slice(Z,Ie)==D},Ue.eq=Jc,Ue.escape=function(x){return(x=Fr(x))&&xe.test(x)?x.replace(ae,gl):x},Ue.escapeRegExp=function(x){return(x=Fr(x))&&At.test(x)?x.replace(gt,"\\$&"):x},Ue.every=function(x,D,Z){var ge=Ur(x)?S_:jg;return Z&&Uo(x,D,Z)&&(D=u),ge(x,vr(D,3))},Ue.find=ET,Ue.findIndex=rS,Ue.findKey=function(x,D){return Ou(x,vr(D,3),Os)},Ue.findLast=xT,Ue.findLastIndex=ky,Ue.findLastKey=function(x,D){return Ou(x,vr(D,3),Wp)},Ue.floor=$f,Ue.forEach=r0,Ue.forEachRight=hS,Ue.forIn=function(x,D){return x==null?x:N_(x,vr(D,3),Fo)},Ue.forInRight=function(x,D){return x==null?x:Xa(x,vr(D,3),Fo)},Ue.forOwn=function(x,D){return x&&Os(x,vr(D,3))},Ue.forOwnRight=function(x,D){return x&&Wp(x,vr(D,3))},Ue.get=ec,Ue.gt=l0,Ue.gte=Ly,Ue.has=function(x,D){return x!=null&&Cy(x,D,qp)},Ue.hasIn=tc,Ue.head=sS,Ue.identity=ys,Ue.includes=function(x,D,Z,ge){x=Qa(x)?x:Rc(x),Z=Z&&!ge?Br(Z):0;var Ie=x.length;return Z<0&&(Z=Vs(Ie+Z,0)),Zh(x)?Z<=Ie&&x.indexOf(D,Z)>-1:!!Ie&&Ec(x,D,Z)>-1},Ue.indexOf=function(x,D,Z){var ge=x==null?0:x.length;if(!ge)return-1;var Ie=Z==null?0:Br(Z);return Ie<0&&(Ie=Vs(ge+Ie,0)),Ec(x,D,Ie)},Ue.inRange=function(x,D,Z){return D=Al(D),Z===u?(Z=D,D=0):Z=Al(Z),(function(ge,Ie,He){return ge>=qr(Ie,He)&&ge<Vs(Ie,He)})(x=Cl(x),D,Z)},Ue.invoke=jy,Ue.isArguments=Qc,Ue.isArray=Ur,Ue.isArrayBuffer=wT,Ue.isArrayLike=Qa,Ue.isArrayLikeObject=Js,Ue.isBoolean=function(x){return x===!0||x===!1||Qs(x)&&xa(x)==B},Ue.isBuffer=Ff,Ue.isDate=AT,Ue.isElement=function(x){return Qs(x)&&x.nodeType===1&&!tu(x)},Ue.isEmpty=function(x){if(x==null)return!0;if(Qa(x)&&(Ur(x)||typeof x=="string"||typeof x.splice=="function"||Ff(x)||Zu(x)||Qc(x)))return!x.length;var D=Ta(x);if(D==H||D==Q)return!x.size;if(Jg(x))return!D_(x).length;for(var Z in x)if(Ki.call(x,Z))return!1;return!0},Ue.isEqual=function(x,D){return Id(x,D)},Ue.isEqualWith=function(x,D,Z){var ge=(Z=typeof Z=="function"?Z:u)?Z(x,D):u;return ge===u?Id(x,D,u,Z):!!ge},Ue.isError=Uy,Ue.isFinite=function(x){return typeof x=="number"&&Ad(x)},Ue.isFunction=wl,Ue.isInteger=J_,Ue.isLength=Hs,Ue.isMap=By,Ue.isMatch=function(x,D){return x===D||If(x,D,sa(D))},Ue.isMatchWith=function(x,D,Z){return Z=typeof Z=="function"?Z:u,If(x,D,sa(D),Z)},Ue.isNaN=function(x){return Fy(x)&&x!=+x},Ue.isNative=function(x){if(qh(x))throw new Si("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return _y(x)},Ue.isNil=function(x){return x==null},Ue.isNull=function(x){return x===null},Ue.isNumber=Fy,Ue.isObject=vs,Ue.isObjectLike=Qs,Ue.isPlainObject=tu,Ue.isRegExp=u0,Ue.isSafeInteger=function(x){return J_(x)&&x>=-9007199254740991&&x<=T},Ue.isSet=Xu,Ue.isString=Zh,Ue.isSymbol=Es,Ue.isTypedArray=Zu,Ue.isUndefined=function(x){return x===u},Ue.isWeakMap=function(x){return Qs(x)&&Ta(x)==ee},Ue.isWeakSet=function(x){return Qs(x)&&xa(x)=="[object WeakSet]"},Ue.join=function(x,D){return x==null?"":k_.call(x,D)},Ue.kebabCase=p0,Ue.last=_o,Ue.lastIndexOf=function(x,D,Z){var ge=x==null?0:x.length;if(!ge)return-1;var Ie=ge;return Z!==u&&(Ie=(Ie=Br(Z))<0?Vs(ge+Ie,0):qr(Ie,ge-1)),D==D?(function(He,ct,ft){for(var kt=ft+1;kt--;)if(He[kt]===ct)return kt;return kt})(x,D,Ie):Lh(x,xg,Ie,!0)},Ue.lowerCase=jf,Ue.lowerFirst=nv,Ue.lt=Q_,Ue.lte=h0,Ue.max=function(x){return x&&x.length?Md(x,ys,ju):u},Ue.maxBy=function(x,D){return x&&x.length?Md(x,vr(D,2),ju):u},Ue.mean=function(x){return hy(x,ys)},Ue.meanBy=function(x,D){return hy(x,vr(D,2))},Ue.min=function(x){return x&&x.length?Md(x,ys,Of):u},Ue.minBy=function(x,D){return x&&x.length?Md(x,vr(D,2),Of):u},Ue.stubArray=Ts,Ue.stubFalse=Hd,Ue.stubObject=function(){return{}},Ue.stubString=function(){return""},Ue.stubTrue=function(){return!0},Ue.multiply=eo,Ue.nth=function(x,D){return x&&x.length?U_(x,Br(D)):u},Ue.noConflict=function(){return Mn._===this&&(Mn._=vl),this},Ue.noop=Qh,Ue.now=s0,Ue.pad=function(x,D,Z){x=Fr(x);var ge=(D=Br(D))?_l(x):0;if(!D||ge>=D)return x;var Ie=(D-ge)/2;return Hu(Pg(Ie),Z)+x+Hu(jp(Ie),Z)},Ue.padEnd=function(x,D,Z){x=Fr(x);var ge=(D=Br(D))?_l(x):0;return D&&ge<D?x+Hu(D-ge,Z):x},Ue.padStart=function(x,D,Z){x=Fr(x);var ge=(D=Br(D))?_l(x):0;return D&&ge<D?Hu(D-ge,Z)+x:x},Ue.parseInt=function(x,D,Z){return Z||D==null?D=0:D&&(D=+D),pT(Fr(x).replace(Ce,""),D||0)},Ue.random=function(x,D,Z){if(Z&&typeof Z!="boolean"&&Uo(x,D,Z)&&(D=Z=u),Z===u&&(typeof D=="boolean"?(Z=D,D=u):typeof x=="boolean"&&(Z=x,x=u)),x===u&&D===u?(x=0,D=1):(x=Al(x),D===u?(D=x,x=0):D=Al(D)),x>D){var ge=x;x=D,D=ge}if(Z||x%1||D%1){var Ie=Dg();return qr(x+Ie*(D-x+ai("1e-"+((Ie+"").length-1))),D)}return Vg(x,D)},Ue.reduce=function(x,D,Z){var ge=Ur(x)?Tf:x_,Ie=arguments.length<3;return ge(x,vr(D,4),Z,Ie,Fu)},Ue.reduceRight=function(x,D,Z){var ge=Ur(x)?Sc:x_,Ie=arguments.length<3;return ge(x,vr(D,4),Z,Ie,Fg)},Ue.repeat=function(x,D,Z){return D=(Z?Uo(x,D,Z):D===u)?1:Br(D),Qt(Fr(x),D)},Ue.replace=function(){var x=arguments,D=Fr(x[0]);return x.length<3?D:D.replace(x[1],x[2])},Ue.result=function(x,D,Z){var ge=-1,Ie=(D=Nf(D,x)).length;for(Ie||(Ie=1,x=u);++ge<Ie;){var He=x==null?u:x[Ku(D[ge])];He===u&&(ge=Ie,He=Z),x=wl(He)?He.call(x):He}return x},Ue.round=Gs,Ue.runInContext=Bt,Ue.sample=function(x){return(Ur(x)?Mf:mT)(x)},Ue.size=function(x){if(x==null)return 0;if(Qa(x))return Zh(x)?_l(x):x.length;var D=Ta(x);return D==H||D==Q?x.size:D_(x).length},Ue.snakeCase=jo,Ue.some=function(x,D,Z){var ge=Ur(x)?qc:Ns;return Z&&Uo(x,D,Z)&&(D=u),ge(x,vr(D,3))},Ue.sortedIndex=function(x,D){return Kp(x,D)},Ue.sortedIndexBy=function(x,D,Z){return Ja(x,D,vr(Z,2))},Ue.sortedIndexOf=function(x,D){var Z=x==null?0:x.length;if(Z){var ge=Kp(x,D);if(ge<Z&&Jc(x[ge],D))return ge}return-1},Ue.sortedLastIndex=function(x,D){return Kp(x,D,!0)},Ue.sortedLastIndexBy=function(x,D,Z){return Ja(x,D,vr(Z,2),!0)},Ue.sortedLastIndexOf=function(x,D){if(x!=null&&x.length){var Z=Kp(x,D,!0)-1;if(Jc(x[Z],D))return Z}return-1},Ue.startCase=li,Ue.startsWith=function(x,D,Z){return x=Fr(x),Z=Z==null?0:zh(Br(Z),0,x.length),D=na(D),x.slice(Z,Z+D.length)==D},Ue.subtract=th,Ue.sum=function(x){return x&&x.length?Tg(x,ys):0},Ue.sumBy=function(x,D){return x&&x.length?Tg(x,vr(D,2)):0},Ue.template=function(x,D,Z){var ge=Ue.templateSettings;Z&&Uo(x,D,Z)&&(D=u),x=Fr(x),D=zd({},D,ge,Qp);var Ie,He,ct=zd({},D.imports,ge.imports,Qp),ft=Ro(ct),kt=T_(ct,ft),Wt=0,Yt=D.interpolate||rt,nn="__p += '",Gn=A_((D.escape||rt).source+"|"+Yt.source+"|"+(Yt===Je?Ye:rt).source+"|"+(D.evaluate||rt).source+"|$","g"),pn="//# sourceURL="+(Ki.call(D,"sourceURL")?(D.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++or+"]")+`
`;x.replace(Gn,(function(mn,nr,Rn,gr,Er,si){return Rn||(Rn=gr),nn+=x.slice(Wt,si).replace(xt,ks),nr&&(Ie=!0,nn+=`' +
__e(`+nr+`) +
'`),Er&&(He=!0,nn+=`';
`+Er+`;
__p += '`),Rn&&(nn+=`' +
((__t = (`+Rn+`)) == null ? '' : __t) +
'`),Wt=si+mn.length,mn})),nn+=`';
`;var Nn=Ki.call(D,"variable")&&D.variable;if(Nn){if(ye.test(Nn))throw new Si("Invalid `variable` option passed into `_.template`")}else nn=`with (obj) {
`+nn+`
}
`;nn=(He?nn.replace(Le,""):nn).replace($e,"$1").replace(De,"$1;"),nn="function("+(Nn||"obj")+`) {
`+(Nn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ie?", __e = _.escape":"")+(He?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+nn+`return __p
}`;var Vt=zf((function(){return po(ft,pn+"return "+nn).apply(u,kt)}));if(Vt.source=nn,Uy(Vt))throw Vt;return Vt},Ue.times=function(x,D){if((x=Br(x))<1||x>T)return[];var Z=R,ge=qr(x,R);D=vr(D),x-=R;for(var Ie=Da(ge,D);++Z<x;)D(Z);return Ie},Ue.toFinite=Al,Ue.toInteger=Br,Ue.toLength=ev,Ue.toLower=function(x){return Fr(x).toLowerCase()},Ue.toNumber=Cl,Ue.toSafeInteger=function(x){return x?zh(Br(x),-9007199254740991,T):x===0?x:0},Ue.toString=Fr,Ue.toUpper=function(x){return Fr(x).toUpperCase()},Ue.trim=function(x,D,Z){if((x=Fr(x))&&(Z||D===u))return wg(x);if(!x||!(D=na(D)))return x;var ge=Sa(x),Ie=Sa(D);return Zc(ge,fo(ge,Ie),fy(ge,Ie)+1).join("")},Ue.trimEnd=function(x,D,Z){if((x=Fr(x))&&(Z||D===u))return x.slice(0,xn(x)+1);if(!x||!(D=na(D)))return x;var ge=Sa(x);return Zc(ge,0,fy(ge,Sa(D))+1).join("")},Ue.trimStart=function(x,D,Z){if((x=Fr(x))&&(Z||D===u))return x.replace(Ce,"");if(!x||!(D=na(D)))return x;var ge=Sa(x);return Zc(ge,fo(ge,Sa(D))).join("")},Ue.truncate=function(x,D){var Z=30,ge="...";if(vs(D)){var Ie="separator"in D?D.separator:Ie;Z="length"in D?Br(D.length):Z,ge="omission"in D?na(D.omission):ge}var He=(x=Fr(x)).length;if(Qo(x)){var ct=Sa(x);He=ct.length}if(Z>=He)return x;var ft=Z-_l(ge);if(ft<1)return ge;var kt=ct?Zc(ct,0,ft).join(""):x.slice(0,ft);if(Ie===u)return kt+ge;if(ct&&(ft+=kt.length-ft),u0(Ie)){if(x.slice(ft).search(Ie)){var Wt,Yt=kt;for(Ie.global||(Ie=A_(Ie.source,Fr(ke.exec(Ie))+"g")),Ie.lastIndex=0;Wt=Ie.exec(Yt);)var nn=Wt.index;kt=kt.slice(0,nn===u?ft:nn)}}else if(x.indexOf(na(Ie),ft)!=ft){var Gn=kt.lastIndexOf(Ie);Gn>-1&&(kt=kt.slice(0,Gn))}return kt+ge},Ue.unescape=function(x){return(x=Fr(x))&&ve.test(x)?x.replace(Oe,py):x},Ue.uniqueId=function(x){var D=++Mg;return Fr(x)+D},Ue.upperCase=_i,Ue.upperFirst=ru,Ue.each=r0,Ue.eachRight=hS,Ue.first=sS,xs(Ue,(ef={},Os(Ue,(function(x,D){Ki.call(Ue.prototype,D)||(ef[D]=x)})),ef),{chain:!1}),Ue.VERSION="4.17.21",Wc(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(x){Ue[x].placeholder=Ue})),Wc(["drop","take"],(function(x,D){ci.prototype[x]=function(Z){Z=Z===u?1:Vs(Br(Z),0);var ge=this.__filtered__&&!D?new ci(this):this.clone();return ge.__filtered__?ge.__takeCount__=qr(Z,ge.__takeCount__):ge.__views__.push({size:qr(Z,R),type:x+(ge.__dir__<0?"Right":"")}),ge},ci.prototype[x+"Right"]=function(Z){return this.reverse()[x](Z).reverse()}})),Wc(["filter","map","takeWhile"],(function(x,D){var Z=D+1,ge=Z==1||Z==3;ci.prototype[x]=function(Ie){var He=this.clone();return He.__iteratees__.push({iteratee:vr(Ie,3),type:Z}),He.__filtered__=He.__filtered__||ge,He}})),Wc(["head","last"],(function(x,D){var Z="take"+(D?"Right":"");ci.prototype[x]=function(){return this[Z](1).value()[0]}})),Wc(["initial","tail"],(function(x,D){var Z="drop"+(D?"":"Right");ci.prototype[x]=function(){return this.__filtered__?new ci(this):this[Z](1)}})),ci.prototype.compact=function(){return this.filter(ys)},ci.prototype.find=function(x){return this.filter(x).head()},ci.prototype.findLast=function(x){return this.reverse().find(x)},ci.prototype.invokeMap=Kr((function(x,D){return typeof x=="function"?new ci(this):this.map((function(Z){return $h(Z,x,D)}))})),ci.prototype.reject=function(x){return this.filter(a0(vr(x)))},ci.prototype.slice=function(x,D){x=Br(x);var Z=this;return Z.__filtered__&&(x>0||D<0)?new ci(Z):(x<0?Z=Z.takeRight(-x):x&&(Z=Z.drop(x)),D!==u&&(Z=(D=Br(D))<0?Z.dropRight(-D):Z.take(D-x)),Z)},ci.prototype.takeRightWhile=function(x){return this.reverse().takeWhile(x).reverse()},ci.prototype.toArray=function(){return this.take(R)},Os(ci.prototype,(function(x,D){var Z=/^(?:filter|find|map|reject)|While$/.test(D),ge=/^(?:head|last)$/.test(D),Ie=Ue[ge?"take"+(D=="last"?"Right":""):D],He=ge||/^find/.test(D);Ie&&(Ue.prototype[D]=function(){var ct=this.__wrapped__,ft=ge?[1]:arguments,kt=ct instanceof ci,Wt=ft[0],Yt=kt||Ur(ct),nn=function(nr){var Rn=Ie.apply(Ue,bc([nr],ft));return ge&&Gn?Rn[0]:Rn};Yt&&Z&&typeof Wt=="function"&&Wt.length!=1&&(kt=Yt=!1);var Gn=this.__chain__,pn=!!this.__actions__.length,Nn=He&&!Gn,Vt=kt&&!pn;if(!He&&Yt){ct=Vt?ct:new ci(this);var mn=x.apply(ct,ft);return mn.__actions__.push({func:Kh,args:[nn],thisArg:u}),new Ya(mn,Gn)}return Nn&&Vt?x.apply(this,ft):(mn=this.thru(nn),Nn?ge?mn.value()[0]:mn.value():mn)})})),Wc(["pop","push","shift","sort","splice","unshift"],(function(x){var D=Cg[x],Z=/^(?:push|sort|unshift)$/.test(x)?"tap":"thru",ge=/^(?:pop|shift)$/.test(x);Ue.prototype[x]=function(){var Ie=arguments;if(ge&&!this.__chain__){var He=this.value();return D.apply(Ur(He)?He:[],Ie)}return this[Z]((function(ct){return D.apply(Ur(ct)?ct:[],Ie)}))}})),Os(ci.prototype,(function(x,D){var Z=Ue[D];if(Z){var ge=Z.name+"";Ki.call(Cf,ge)||(Cf[ge]=[]),Cf[ge].push({name:D,func:Z})}})),Cf[dr(u,2).name]=[{name:"wrapper",func:u}],ci.prototype.clone=function(){var x=new ci(this.__wrapped__);return x.__actions__=Zs(this.__actions__),x.__dir__=this.__dir__,x.__filtered__=this.__filtered__,x.__iteratees__=Zs(this.__iteratees__),x.__takeCount__=this.__takeCount__,x.__views__=Zs(this.__views__),x},ci.prototype.reverse=function(){if(this.__filtered__){var x=new ci(this);x.__dir__=-1,x.__filtered__=!0}else(x=this.clone()).__dir__*=-1;return x},ci.prototype.value=function(){var x=this.__wrapped__.value(),D=this.__dir__,Z=Ur(x),ge=D<0,Ie=Z?x.length:0,He=(function(si,tr,jn){for(var wi=-1,Ls=jn.length;++wi<Ls;){var wa=jn[wi],cs=wa.size;switch(wa.type){case"drop":si+=cs;break;case"dropRight":tr-=cs;break;case"take":tr=qr(tr,si+cs);break;case"takeRight":si=Vs(si,tr-cs)}}return{start:si,end:tr}})(0,Ie,this.__views__),ct=He.start,ft=He.end,kt=ft-ct,Wt=ge?ft:ct-1,Yt=this.__iteratees__,nn=Yt.length,Gn=0,pn=qr(kt,this.__takeCount__);if(!Z||!ge&&Ie==kt&&pn==kt)return Wh(x,this.__actions__);var Nn=[];e:for(;kt--&&Gn<pn;){for(var Vt=-1,mn=x[Wt+=D];++Vt<nn;){var nr=Yt[Vt],Rn=nr.iteratee,gr=nr.type,Er=Rn(mn);if(gr==2)mn=Er;else if(!Er){if(gr==1)continue e;break e}}Nn[Gn++]=mn}return Nn},Ue.prototype.at=Bf,Ue.prototype.chain=function(){return Uf(this)},Ue.prototype.commit=function(){return new Ya(this.value(),this.__chain__)},Ue.prototype.next=function(){this.__values__===u&&(this.__values__=f0(this.value()));var x=this.__index__>=this.__values__.length;return{done:x,value:x?u:this.__values__[this.__index__++]}},Ue.prototype.plant=function(x){for(var D,Z=this;Z instanceof kf;){var ge=eS(Z);ge.__index__=0,ge.__values__=u,D?Ie.__wrapped__=ge:D=ge;var Ie=ge;Z=Z.__wrapped__}return Ie.__wrapped__=x,D},Ue.prototype.reverse=function(){var x=this.__wrapped__;if(x instanceof ci){var D=x;return this.__actions__.length&&(D=new ci(this)),(D=D.reverse()).__actions__.push({func:Kh,args:[q_],thisArg:u}),new Ya(D,this.__chain__)}return this.thru(q_)},Ue.prototype.toJSON=Ue.prototype.valueOf=Ue.prototype.value=function(){return Wh(this.__wrapped__,this.__actions__)},Ue.prototype.first=Ue.prototype.head,wd&&(Ue.prototype[wd]=function(){return this}),Ue})();Mn._=Ag,(l=(function(){return Ag}).call(a,c,a,o))===u||(o.exports=l)}).call(this)},5364:(o,a,c)=>{var l=c(5250),u=c(999)((function(h,f,d){l(h,f,d)}));o.exports=u},9935:o=>{o.exports=function(){return!1}},9884:(o,a,c)=>{var l=c(1791),u=c(7241);o.exports=function(h){return l(h,u(h))}},5602:o=>{var a=o.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var l="candidate:%s %d %s %d %s %d typ %s";return l+=c.raddr!=null?" raddr %s rport %d":"%v%v",l+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(l+=" generation %d"),l+=c["network-id"]!=null?" network-id %d":"%v",l+=c["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var l="ssrc:%d";return c.attribute!=null&&(l+=" %s",c.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var l="mediaclk:";return l+=c.id!=null?"id=%s %s":"%v%s",l+=c.mediaClockValue!=null?"=%s":"",l+=c.rateNumerator!=null?" rate=%s":"",l+=c.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(a).forEach((function(c){a[c].forEach((function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")}))}))},7363:(o,a,c)=>{var l=c(5020),u=c(3804);a.M9=u,a.qg=l.parse,a.Sl=l.parseParams,l.parseFmtpConfig,l.parsePayloads,l.parseRemoteCandidates,l.parseImageAttributes,l.parseSimulcastStreamList},5020:(o,a,c)=>{var l=function(p){return String(Number(p))===p?Number(p):p},u=function(p,m,_){var v=p.name&&p.names;p.push&&!m[p.push]?m[p.push]=[]:v&&!m[p.name]&&(m[p.name]={});var S=p.push?{}:v?m[p.name]:m;(function(b,T,w,R){if(R&&!w)T[R]=l(b[1]);else for(var C=0;C<w.length;C+=1)b[C+1]!=null&&(T[w[C]]=l(b[C+1]))})(_.match(p.reg),S,p.names,p.name),p.push&&m[p.push].push(S)},h=c(5602),f=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a.parse=function(p){var m={},_=[],v=m;return p.split(/(\r\n|\r|\n)/).filter(f).forEach((function(S){var b=S[0],T=S.slice(2);b==="m"&&(_.push({rtp:[],fmtp:[]}),v=_[_.length-1]);for(var w=0;w<(h[b]||[]).length;w+=1){var R=h[b][w];if(R.reg.test(T))return u(R,v,T)}})),m.media=_,m};var d=function(p,m){var _=m.split(/=(.+)/,2);return _.length===2?p[_[0]]=l(_[1]):_.length===1&&m.length>1&&(p[_[0]]=void 0),p};a.parseParams=function(p){return p.split(/;\s?/).reduce(d,{})},a.parseFmtpConfig=a.parseParams,a.parsePayloads=function(p){return p.toString().split(" ").map(Number)},a.parseRemoteCandidates=function(p){for(var m=[],_=p.split(" ").map(l),v=0;v<_.length;v+=3)m.push({component:_[v],ip:_[v+1],port:_[v+2]});return m},a.parseImageAttributes=function(p){return p.split(" ").map((function(m){return m.substring(1,m.length-1).split(",").reduce(d,{})}))},a.parseSimulcastStreamList=function(p){return p.split(";").map((function(m){return m.split(",").map((function(_){var v,S=!1;return _[0]!=="~"?v=l(_):(v=l(_.substring(1,_.length)),S=!0),{scid:v,paused:S}}))}))}},3804:(o,a,c)=>{var l=c(5602),u=/%[sdv%]/g,h=function(m){var _=1,v=arguments,S=v.length;return m.replace(u,(function(b){if(_>=S)return b;var T=v[_];switch(_+=1,b){case"%%":return"%";case"%s":return String(T);case"%d":return Number(T);case"%v":return""}}))},f=function(m,_,v){var S=[m+"="+(_.format instanceof Function?_.format(_.push?v:v[_.name]):_.format)];if(_.names)for(var b=0;b<_.names.length;b+=1){var T=_.names[b];_.name?S.push(v[_.name][T]):S.push(v[_.names[b]])}else S.push(v[_.name]);return h.apply(null,S)},d=["v","o","s","i","u","e","p","c","b","t","r","z","a"],p=["i","c","b","a"];o.exports=function(m,_){_=_||{},m.version==null&&(m.version=0),m.name==null&&(m.name=" "),m.media.forEach((function(T){T.payloads==null&&(T.payloads="")}));var v=_.outerOrder||d,S=_.innerOrder||p,b=[];return v.forEach((function(T){l[T].forEach((function(w){w.name in m&&m[w.name]!=null?b.push(f(T,w,m)):w.push in m&&m[w.push]!=null&&m[w.push].forEach((function(R){b.push(f(T,w,R))}))}))})),m.media.forEach((function(T){b.push(f("m",l.m[0],T)),S.forEach((function(w){l[w].forEach((function(R){R.name in T&&T[R.name]!=null?b.push(f(w,R,T)):R.push in T&&T[R.push]!=null&&T[R.push].forEach((function(C){b.push(f(w,R,C))}))}))}))})),b.join(`\r
`)+`\r
`}},7963:o=>{const a={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};a.localCName=a.generateIdentifier(),a.splitLines=function(c){return c.trim().split(`
`).map((l=>l.trim()))},a.splitSections=function(c){return c.split(`
m=`).map(((l,u)=>(u>0?"m="+l:l).trim()+`\r
`))},a.getDescription=function(c){const l=a.splitSections(c);return l&&l[0]},a.getMediaSections=function(c){const l=a.splitSections(c);return l.shift(),l},a.matchPrefix=function(c,l){return a.splitLines(c).filter((u=>u.indexOf(l)===0))},a.parseCandidate=function(c){let l;l=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" ");const u={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let h=8;h<l.length;h+=2)switch(l[h]){case"raddr":u.relatedAddress=l[h+1];break;case"rport":u.relatedPort=parseInt(l[h+1],10);break;case"tcptype":u.tcpType=l[h+1];break;case"ufrag":u.ufrag=l[h+1],u.usernameFragment=l[h+1];break;default:u[l[h]]===void 0&&(u[l[h]]=l[h+1])}return u},a.writeCandidate=function(c){const l=[];l.push(c.foundation);const u=c.component;u==="rtp"?l.push(1):u==="rtcp"?l.push(2):l.push(u),l.push(c.protocol.toUpperCase()),l.push(c.priority),l.push(c.address||c.ip),l.push(c.port);const h=c.type;return l.push("typ"),l.push(h),h!=="host"&&c.relatedAddress&&c.relatedPort&&(l.push("raddr"),l.push(c.relatedAddress),l.push("rport"),l.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(l.push("ufrag"),l.push(c.usernameFragment||c.ufrag)),"candidate:"+l.join(" ")},a.parseIceOptions=function(c){return c.substring(14).split(" ")},a.parseRtpMap=function(c){let l=c.substring(9).split(" ");const u={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),u.name=l[0],u.clockRate=parseInt(l[1],10),u.channels=l.length===3?parseInt(l[2],10):1,u.numChannels=u.channels,u},a.writeRtpMap=function(c){let l=c.payloadType;c.preferredPayloadType!==void 0&&(l=c.preferredPayloadType);const u=c.channels||c.numChannels||1;return"a=rtpmap:"+l+" "+c.name+"/"+c.clockRate+(u!==1?"/"+u:"")+`\r
`},a.parseExtmap=function(c){const l=c.substring(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1],attributes:l.slice(2).join(" ")}},a.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+(c.attributes?" "+c.attributes:"")+`\r
`},a.parseFmtp=function(c){const l={};let u;const h=c.substring(c.indexOf(" ")+1).split(";");for(let f=0;f<h.length;f++)u=h[f].trim().split("="),l[u[0].trim()]=u[1];return l},a.writeFmtp=function(c){let l="",u=c.payloadType;if(c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){const h=[];Object.keys(c.parameters).forEach((f=>{c.parameters[f]!==void 0?h.push(f+"="+c.parameters[f]):h.push(f)})),l+="a=fmtp:"+u+" "+h.join(";")+`\r
`}return l},a.parseRtcpFb=function(c){const l=c.substring(c.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},a.writeRtcpFb=function(c){let l="",u=c.payloadType;return c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach((h=>{l+="a=rtcp-fb:"+u+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`})),l},a.parseSsrcMedia=function(c){const l=c.indexOf(" "),u={ssrc:parseInt(c.substring(7,l),10)},h=c.indexOf(":",l);return h>-1?(u.attribute=c.substring(l+1,h),u.value=c.substring(h+1)):u.attribute=c.substring(l+1),u},a.parseSsrcGroup=function(c){const l=c.substring(13).split(" ");return{semantics:l.shift(),ssrcs:l.map((u=>parseInt(u,10)))}},a.getMid=function(c){const l=a.matchPrefix(c,"a=mid:")[0];if(l)return l.substring(6)},a.parseFingerprint=function(c){const l=c.substring(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},a.getDtlsParameters=function(c,l){return{role:"auto",fingerprints:a.matchPrefix(c+l,"a=fingerprint:").map(a.parseFingerprint)}},a.writeDtlsParameters=function(c,l){let u="a=setup:"+l+`\r
`;return c.fingerprints.forEach((h=>{u+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`})),u},a.parseCryptoLine=function(c){const l=c.substring(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},a.writeCryptoLine=function(c){return"a=crypto:"+c.tag+" "+c.cryptoSuite+" "+(typeof c.keyParams=="object"?a.writeCryptoKeyParams(c.keyParams):c.keyParams)+(c.sessionParams?" "+c.sessionParams.join(" "):"")+`\r
`},a.parseCryptoKeyParams=function(c){if(c.indexOf("inline:")!==0)return null;const l=c.substring(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},a.writeCryptoKeyParams=function(c){return c.keyMethod+":"+c.keySalt+(c.lifeTime?"|"+c.lifeTime:"")+(c.mkiValue&&c.mkiLength?"|"+c.mkiValue+":"+c.mkiLength:"")},a.getCryptoParameters=function(c,l){return a.matchPrefix(c+l,"a=crypto:").map(a.parseCryptoLine)},a.getIceParameters=function(c,l){const u=a.matchPrefix(c+l,"a=ice-ufrag:")[0],h=a.matchPrefix(c+l,"a=ice-pwd:")[0];return u&&h?{usernameFragment:u.substring(12),password:h.substring(10)}:null},a.writeIceParameters=function(c){let l="a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`;return c.iceLite&&(l+=`a=ice-lite\r
`),l},a.parseRtpParameters=function(c){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},u=a.splitLines(c)[0].split(" ");l.profile=u[2];for(let f=3;f<u.length;f++){const d=u[f],p=a.matchPrefix(c,"a=rtpmap:"+d+" ")[0];if(p){const m=a.parseRtpMap(p),_=a.matchPrefix(c,"a=fmtp:"+d+" ");switch(m.parameters=_.length?a.parseFmtp(_[0]):{},m.rtcpFeedback=a.matchPrefix(c,"a=rtcp-fb:"+d+" ").map(a.parseRtcpFb),l.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(m.name.toUpperCase())}}}a.matchPrefix(c,"a=extmap:").forEach((f=>{l.headerExtensions.push(a.parseExtmap(f))}));const h=a.matchPrefix(c,"a=rtcp-fb:* ").map(a.parseRtcpFb);return l.codecs.forEach((f=>{h.forEach((d=>{f.rtcpFeedback.find((p=>p.type===d.type&&p.parameter===d.parameter))||f.rtcpFeedback.push(d)}))})),l},a.writeRtpDescription=function(c,l){let u="";u+="m="+c+" ",u+=l.codecs.length>0?"9":"0",u+=" "+(l.profile||"UDP/TLS/RTP/SAVPF")+" ",u+=l.codecs.map((f=>f.preferredPayloadType!==void 0?f.preferredPayloadType:f.payloadType)).join(" ")+`\r
`,u+=`c=IN IP4 0.0.0.0\r
`,u+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach((f=>{u+=a.writeRtpMap(f),u+=a.writeFmtp(f),u+=a.writeRtcpFb(f)}));let h=0;return l.codecs.forEach((f=>{f.maxptime>h&&(h=f.maxptime)})),h>0&&(u+="a=maxptime:"+h+`\r
`),l.headerExtensions&&l.headerExtensions.forEach((f=>{u+=a.writeExtmap(f)})),u},a.parseRtpEncodingParameters=function(c){const l=[],u=a.parseRtpParameters(c),h=u.fecMechanisms.indexOf("RED")!==-1,f=u.fecMechanisms.indexOf("ULPFEC")!==-1,d=a.matchPrefix(c,"a=ssrc:").map((S=>a.parseSsrcMedia(S))).filter((S=>S.attribute==="cname")),p=d.length>0&&d[0].ssrc;let m;const _=a.matchPrefix(c,"a=ssrc-group:FID").map((S=>S.substring(17).split(" ").map((b=>parseInt(b,10)))));_.length>0&&_[0].length>1&&_[0][0]===p&&(m=_[0][1]),u.codecs.forEach((S=>{if(S.name.toUpperCase()==="RTX"&&S.parameters.apt){let b={ssrc:p,codecPayloadType:parseInt(S.parameters.apt,10)};p&&m&&(b.rtx={ssrc:m}),l.push(b),h&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:p,mechanism:f?"red+ulpfec":"red"},l.push(b))}})),l.length===0&&p&&l.push({ssrc:p});let v=a.matchPrefix(c,"b=");return v.length&&(v=v[0].indexOf("b=TIAS:")===0?parseInt(v[0].substring(7),10):v[0].indexOf("b=AS:")===0?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,l.forEach((S=>{S.maxBitrate=v}))),l},a.parseRtcpParameters=function(c){const l={},u=a.matchPrefix(c,"a=ssrc:").map((d=>a.parseSsrcMedia(d))).filter((d=>d.attribute==="cname"))[0];u&&(l.cname=u.value,l.ssrc=u.ssrc);const h=a.matchPrefix(c,"a=rtcp-rsize");l.reducedSize=h.length>0,l.compound=h.length===0;const f=a.matchPrefix(c,"a=rtcp-mux");return l.mux=f.length>0,l},a.writeRtcpParameters=function(c){let l="";return c.reducedSize&&(l+=`a=rtcp-rsize\r
`),c.mux&&(l+=`a=rtcp-mux\r
`),c.ssrc!==void 0&&c.cname&&(l+="a=ssrc:"+c.ssrc+" cname:"+c.cname+`\r
`),l},a.parseMsid=function(c){let l;const u=a.matchPrefix(c,"a=msid:");if(u.length===1)return l=u[0].substring(7).split(" "),{stream:l[0],track:l[1]};const h=a.matchPrefix(c,"a=ssrc:").map((f=>a.parseSsrcMedia(f))).filter((f=>f.attribute==="msid"));return h.length>0?(l=h[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},a.parseSctpDescription=function(c){const l=a.parseMLine(c),u=a.matchPrefix(c,"a=max-message-size:");let h;u.length>0&&(h=parseInt(u[0].substring(19),10)),isNaN(h)&&(h=65536);const f=a.matchPrefix(c,"a=sctp-port:");if(f.length>0)return{port:parseInt(f[0].substring(12),10),protocol:l.fmt,maxMessageSize:h};const d=a.matchPrefix(c,"a=sctpmap:");if(d.length>0){const p=d[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:h}}},a.writeSctpDescription=function(c,l){let u=[];return u=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&u.push("a=max-message-size:"+l.maxMessageSize+`\r
`),u.join("")},a.generateSessionId=function(){return Math.random().toString().substr(2,22)},a.writeSessionBoilerplate=function(c,l,u){let h;const f=l!==void 0?l:2;return h=c||a.generateSessionId(),`v=0\r
o=`+(u||"thisisadapterortc")+" "+h+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},a.getDirection=function(c,l){const u=a.splitLines(c);for(let h=0;h<u.length;h++)switch(u[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return u[h].substring(2)}return l?a.getDirection(l):"sendrecv"},a.getKind=function(c){return a.splitLines(c)[0].split(" ")[0].substring(2)},a.isRejected=function(c){return c.split(" ",2)[1]==="0"},a.parseMLine=function(c){const l=a.splitLines(c)[0].substring(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},a.parseOLine=function(c){const l=a.matchPrefix(c,"o=")[0].substring(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},a.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;const l=a.splitLines(c);for(let u=0;u<l.length;u++)if(l[u].length<2||l[u].charAt(1)!=="=")return!1;return!0},o.exports=a},5512:o=>{o.exports=function(a,c,l,u){var h=self||window;try{try{var f;try{f=new h.Blob([a])}catch{(f=new(h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder)).append(a),f=f.getBlob()}var d=h.URL||h.webkitURL,p=d.createObjectURL(f),m=new h[c](p,l);return d.revokeObjectURL(p),m}catch{return new h[c]("data:application/javascript,".concat(encodeURIComponent(a)),l)}}catch{if(!u)throw Error("Inline worker is not supported");return new h[c](u,l)}}},8630:(o,a,c)=>{var l;(function(u){(function(){var h=typeof globalThis=="object"?globalThis:typeof c.g=="object"?c.g:typeof self=="object"?self:typeof this=="object"?this:(function(){try{return Function("return this;")()}catch{}})()||(function(){try{return(0,eval)("(function() { return this; })()")}catch{}})(),f=d(u);function d(p,m){return function(_,v){Object.defineProperty(p,_,{configurable:!0,writable:!0,value:v}),m&&m(_,v)}}h.Reflect!==void 0&&(f=d(h.Reflect,f)),(function(p,m){var _=Object.prototype.hasOwnProperty,v=typeof Symbol=="function",S=v&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",b=v&&Symbol.iterator!==void 0?Symbol.iterator:"@@iterator",T=typeof Object.create=="function",w={__proto__:[]}instanceof Array,R=!T&&!w,C={create:T?function(){return at(Object.create(null))}:w?function(){return at({__proto__:null})}:function(){return at({})},has:R?function(Be,tt){return _.call(Be,tt)}:function(Be,tt){return tt in Be},get:R?function(Be,tt){return _.call(Be,tt)?Be[tt]:void 0}:function(Be,tt){return Be[tt]}},N=Object.getPrototypeOf(Function),U=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ve(),B=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Fe(),$=typeof WeakMap=="function"?WeakMap:Ge(),I=v?Symbol.for("@reflect-metadata:registry"):void 0,L=ye(),P=_e(L);function H(Be,tt,rt,xt){if(Le(rt)){if(!Je(Be))throw new TypeError;if(!et(tt))throw new TypeError;return ie(Be,tt)}if(!Je(Be))throw new TypeError;if(!Oe(tt))throw new TypeError;if(!Oe(xt)&&!Le(xt)&&!$e(xt))throw new TypeError;return $e(xt)&&(xt=void 0),Ee(Be,tt,rt=ze(rt),xt)}function X(Be,tt){function rt(xt,ot){if(!Oe(xt))throw new TypeError;if(!Le(ot)&&!Ut(ot))throw new TypeError;it(Be,tt,xt,ot)}return rt}function G(Be,tt,rt,xt){if(!Oe(rt))throw new TypeError;return Le(xt)||(xt=ze(xt)),it(Be,tt,rt,xt)}function Y(Be,tt,rt){if(!Oe(tt))throw new TypeError;return Le(rt)||(rt=ze(rt)),Re(Be,tt,rt)}function J(Be,tt,rt){if(!Oe(tt))throw new TypeError;return Le(rt)||(rt=ze(rt)),Te(Be,tt,rt)}function Q(Be,tt,rt){if(!Oe(tt))throw new TypeError;return Le(rt)||(rt=ze(rt)),Pe(Be,tt,rt)}function z(Be,tt,rt){if(!Oe(tt))throw new TypeError;return Le(rt)||(rt=ze(rt)),We(Be,tt,rt)}function q(Be,tt){if(!Oe(Be))throw new TypeError;return Le(tt)||(tt=ze(tt)),ht(Be,tt)}function ee(Be,tt){if(!Oe(Be))throw new TypeError;return Le(tt)||(tt=ze(tt)),vt(Be,tt)}function te(Be,tt,rt){if(!Oe(tt))throw new TypeError;if(Le(rt)||(rt=ze(rt)),!Oe(tt))throw new TypeError;Le(rt)||(rt=ze(rt));var xt=ke(tt,rt,!1);return!Le(xt)&&xt.OrdinaryDeleteMetadata(Be,tt,rt)}function ie(Be,tt){for(var rt=Be.length-1;rt>=0;--rt){var xt=(0,Be[rt])(tt);if(!Le(xt)&&!$e(xt)){if(!et(xt))throw new TypeError;tt=xt}}return tt}function Ee(Be,tt,rt,xt){for(var ot=Be.length-1;ot>=0;--ot){var tn=(0,Be[ot])(tt,rt,xt);if(!Le(tn)&&!$e(tn)){if(!Oe(tn))throw new TypeError;xt=tn}}return xt}function Re(Be,tt,rt){if(Te(Be,tt,rt))return!0;var xt=Se(tt);return!$e(xt)&&Re(Be,xt,rt)}function Te(Be,tt,rt){var xt=ke(tt,rt,!1);return!Le(xt)&&xe(xt.OrdinaryHasOwnMetadata(Be,tt,rt))}function Pe(Be,tt,rt){if(Te(Be,tt,rt))return We(Be,tt,rt);var xt=Se(tt);return $e(xt)?void 0:Pe(Be,xt,rt)}function We(Be,tt,rt){var xt=ke(tt,rt,!1);if(!Le(xt))return xt.OrdinaryGetOwnMetadata(Be,tt,rt)}function it(Be,tt,rt,xt){ke(rt,xt,!0).OrdinaryDefineOwnMetadata(Be,tt,rt,xt)}function ht(Be,tt){var rt=vt(Be,tt),xt=Se(Be);if(xt===null)return rt;var ot=ht(xt,tt);if(ot.length<=0)return rt;if(rt.length<=0)return ot;for(var tn=new B,ln=[],Rt=0,$t=rt;Rt<$t.length;Rt++){var mt=$t[Rt];tn.has(mt)||(tn.add(mt),ln.push(mt))}for(var Zt=0,wn=ot;Zt<wn.length;Zt++)mt=wn[Zt],tn.has(mt)||(tn.add(mt),ln.push(mt));return ln}function vt(Be,tt){var rt=ke(Be,tt,!1);return rt?rt.OrdinaryOwnMetadataKeys(Be,tt):[]}function re(Be){if(Be===null)return 1;switch(typeof Be){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Be===null?1:6;default:return 6}}function Le(Be){return Be===void 0}function $e(Be){return Be===null}function De(Be){return typeof Be=="symbol"}function Oe(Be){return typeof Be=="object"?Be!==null:typeof Be=="function"}function ae(Be,tt){switch(re(Be)){case 0:case 1:case 2:case 3:case 4:case 5:return Be}var rt="string",xt=At(Be,S);if(xt!==void 0){var ot=xt.call(Be,rt);if(Oe(ot))throw new TypeError;return ot}return ve(Be)}function ve(Be,tt){var rt,xt;{var ot=Be.toString;if(Xe(ot)&&!Oe(xt=ot.call(Be))||Xe(rt=Be.valueOf)&&!Oe(xt=rt.call(Be)))return xt}throw new TypeError}function xe(Be){return!!Be}function pe(Be){return""+Be}function ze(Be){var tt=ae(Be);return De(tt)?tt:pe(tt)}function Je(Be){return Array.isArray?Array.isArray(Be):Be instanceof Object?Be instanceof Array:Object.prototype.toString.call(Be)==="[object Array]"}function Xe(Be){return typeof Be=="function"}function et(Be){return typeof Be=="function"}function Ut(Be){switch(re(Be)){case 3:case 4:return!0;default:return!1}}function gt(Be,tt){return Be===tt||Be!=Be&&tt!=tt}function At(Be,tt){var rt=Be[tt];if(rt!=null){if(!Xe(rt))throw new TypeError;return rt}}function Ce(Be){var tt=At(Be,b);if(!Xe(tt))throw new TypeError;var rt=tt.call(Be);if(!Oe(rt))throw new TypeError;return rt}function se(Be){return Be.value}function W(Be){var tt=Be.next();return!tt.done&&tt}function oe(Be){var tt=Be.return;tt&&tt.call(Be)}function Se(Be){var tt=Object.getPrototypeOf(Be);if(typeof Be!="function"||Be===N||tt!==N)return tt;var rt=Be.prototype,xt=rt&&Object.getPrototypeOf(rt);if(xt==null||xt===Object.prototype)return tt;var ot=xt.constructor;return typeof ot!="function"||ot===Be?tt:ot}function Ae(){var Be,tt,rt,xt;Le(I)||m.Reflect===void 0||I in m.Reflect||typeof m.Reflect.defineMetadata!="function"||(Be=Ye(m.Reflect));var ot=new $,tn={registerProvider:ln,getProvider:$t,setProvider:Zt};return tn;function ln(wn){if(!Object.isExtensible(tn))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Be===wn:break;case Le(tt):tt=wn;break;case tt===wn:break;case Le(rt):rt=wn;break;case rt===wn:break;default:xt===void 0&&(xt=new B),xt.add(wn)}}function Rt(wn,qt){if(!Le(tt)){if(tt.isProviderFor(wn,qt))return tt;if(!Le(rt)){if(rt.isProviderFor(wn,qt))return tt;if(!Le(xt))for(var An=Ce(xt);;){var Ln=W(An);if(!Ln)return;var mr=se(Ln);if(mr.isProviderFor(wn,qt))return oe(An),mr}}}if(!Le(Be)&&Be.isProviderFor(wn,qt))return Be}function $t(wn,qt){var An,Ln=ot.get(wn);return Le(Ln)||(An=Ln.get(qt)),Le(An)&&(Le(An=Rt(wn,qt))||(Le(Ln)&&(Ln=new U,ot.set(wn,Ln)),Ln.set(qt,An))),An}function mt(wn){if(Le(wn))throw new TypeError;return tt===wn||rt===wn||!Le(xt)&&xt.has(wn)}function Zt(wn,qt,An){if(!mt(An))throw new Error("Metadata provider not registered.");var Ln=$t(wn,qt);if(Ln!==An){if(!Le(Ln))return!1;var mr=ot.get(wn);Le(mr)&&(mr=new U,ot.set(wn,mr)),mr.set(qt,An)}return!0}}function ye(){var Be;return!Le(I)&&Oe(m.Reflect)&&Object.isExtensible(m.Reflect)&&(Be=m.Reflect[I]),Le(Be)&&(Be=Ae()),!Le(I)&&Oe(m.Reflect)&&Object.isExtensible(m.Reflect)&&Object.defineProperty(m.Reflect,I,{enumerable:!1,configurable:!1,writable:!1,value:Be}),Be}function _e(Be){var tt=new $,rt={isProviderFor:function(mt,Zt){var wn=tt.get(mt);return!Le(wn)&&wn.has(Zt)},OrdinaryDefineOwnMetadata:ln,OrdinaryHasOwnMetadata:ot,OrdinaryGetOwnMetadata:tn,OrdinaryOwnMetadataKeys:Rt,OrdinaryDeleteMetadata:$t};return L.registerProvider(rt),rt;function xt(mt,Zt,wn){var qt=tt.get(mt),An=!1;if(Le(qt)){if(!wn)return;qt=new U,tt.set(mt,qt),An=!0}var Ln=qt.get(Zt);if(Le(Ln)){if(!wn)return;if(Ln=new U,qt.set(Zt,Ln),!Be.setProvider(mt,Zt,rt))throw qt.delete(Zt),An&&tt.delete(mt),new Error("Wrong provider for target.")}return Ln}function ot(mt,Zt,wn){var qt=xt(Zt,wn,!1);return!Le(qt)&&xe(qt.has(mt))}function tn(mt,Zt,wn){var qt=xt(Zt,wn,!1);if(!Le(qt))return qt.get(mt)}function ln(mt,Zt,wn,qt){xt(wn,qt,!0).set(mt,Zt)}function Rt(mt,Zt){var wn=[],qt=xt(mt,Zt,!1);if(Le(qt))return wn;for(var An=Ce(qt.keys()),Ln=0;;){var mr=W(An);if(!mr)return wn.length=Ln,wn;var is=se(mr);try{wn[Ln]=is}catch(hi){try{oe(An)}finally{throw hi}}Ln++}}function $t(mt,Zt,wn){var qt=xt(Zt,wn,!1);if(Le(qt)||!qt.delete(mt))return!1;if(qt.size===0){var An=tt.get(Zt);Le(An)||(An.delete(wn),An.size===0&&tt.delete(An))}return!0}}function Ye(Be){var tt=Be.defineMetadata,rt=Be.hasOwnMetadata,xt=Be.getOwnMetadata,ot=Be.getOwnMetadataKeys,tn=Be.deleteMetadata,ln=new $;return{isProviderFor:function(Rt,$t){var mt=ln.get(Rt);return!(Le(mt)||!mt.has($t))||!!ot(Rt,$t).length&&(Le(mt)&&(mt=new B,ln.set(Rt,mt)),mt.add($t),!0)},OrdinaryDefineOwnMetadata:tt,OrdinaryHasOwnMetadata:rt,OrdinaryGetOwnMetadata:xt,OrdinaryOwnMetadataKeys:ot,OrdinaryDeleteMetadata:tn}}function ke(Be,tt,rt){var xt=L.getProvider(Be,tt);if(!Le(xt))return xt;if(rt){if(L.setProvider(Be,tt,P))return P;throw new Error("Illegal state.")}}function Ve(){var Be={},tt=[],rt=(function(){function ln(Rt,$t,mt){this._index=0,this._keys=Rt,this._values=$t,this._selector=mt}return ln.prototype["@@iterator"]=function(){return this},ln.prototype[b]=function(){return this},ln.prototype.next=function(){var Rt=this._index;if(Rt>=0&&Rt<this._keys.length){var $t=this._selector(this._keys[Rt],this._values[Rt]);return Rt+1>=this._keys.length?(this._index=-1,this._keys=tt,this._values=tt):this._index++,{value:$t,done:!1}}return{value:void 0,done:!0}},ln.prototype.throw=function(Rt){throw this._index>=0&&(this._index=-1,this._keys=tt,this._values=tt),Rt},ln.prototype.return=function(Rt){return this._index>=0&&(this._index=-1,this._keys=tt,this._values=tt),{value:Rt,done:!0}},ln})();return(function(){function ln(){this._keys=[],this._values=[],this._cacheKey=Be,this._cacheIndex=-2}return Object.defineProperty(ln.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ln.prototype.has=function(Rt){return this._find(Rt,!1)>=0},ln.prototype.get=function(Rt){var $t=this._find(Rt,!1);return $t>=0?this._values[$t]:void 0},ln.prototype.set=function(Rt,$t){var mt=this._find(Rt,!0);return this._values[mt]=$t,this},ln.prototype.delete=function(Rt){var $t=this._find(Rt,!1);if($t>=0){for(var mt=this._keys.length,Zt=$t+1;Zt<mt;Zt++)this._keys[Zt-1]=this._keys[Zt],this._values[Zt-1]=this._values[Zt];return this._keys.length--,this._values.length--,gt(Rt,this._cacheKey)&&(this._cacheKey=Be,this._cacheIndex=-2),!0}return!1},ln.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Be,this._cacheIndex=-2},ln.prototype.keys=function(){return new rt(this._keys,this._values,xt)},ln.prototype.values=function(){return new rt(this._keys,this._values,ot)},ln.prototype.entries=function(){return new rt(this._keys,this._values,tn)},ln.prototype["@@iterator"]=function(){return this.entries()},ln.prototype[b]=function(){return this.entries()},ln.prototype._find=function(Rt,$t){if(!gt(this._cacheKey,Rt)){this._cacheIndex=-1;for(var mt=0;mt<this._keys.length;mt++)if(gt(this._keys[mt],Rt)){this._cacheIndex=mt;break}}return this._cacheIndex<0&&$t&&(this._cacheIndex=this._keys.length,this._keys.push(Rt),this._values.push(void 0)),this._cacheIndex},ln})();function xt(ln,Rt){return ln}function ot(ln,Rt){return Rt}function tn(ln,Rt){return[ln,Rt]}}function Fe(){return(function(){function Be(){this._map=new U}return Object.defineProperty(Be.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Be.prototype.has=function(tt){return this._map.has(tt)},Be.prototype.add=function(tt){return this._map.set(tt,tt),this},Be.prototype.delete=function(tt){return this._map.delete(tt)},Be.prototype.clear=function(){this._map.clear()},Be.prototype.keys=function(){return this._map.keys()},Be.prototype.values=function(){return this._map.keys()},Be.prototype.entries=function(){return this._map.entries()},Be.prototype["@@iterator"]=function(){return this.keys()},Be.prototype[b]=function(){return this.keys()},Be})()}function Ge(){var Be=16,tt=C.create(),rt=xt();return(function(){function $t(){this._key=xt()}return $t.prototype.has=function(mt){var Zt=ot(mt,!1);return Zt!==void 0&&C.has(Zt,this._key)},$t.prototype.get=function(mt){var Zt=ot(mt,!1);return Zt!==void 0?C.get(Zt,this._key):void 0},$t.prototype.set=function(mt,Zt){return ot(mt,!0)[this._key]=Zt,this},$t.prototype.delete=function(mt){var Zt=ot(mt,!1);return Zt!==void 0&&delete Zt[this._key]},$t.prototype.clear=function(){this._key=xt()},$t})();function xt(){var $t;do $t="@@WeakMap@@"+Rt();while(C.has(tt,$t));return tt[$t]=!0,$t}function ot($t,mt){if(!_.call($t,rt)){if(!mt)return;Object.defineProperty($t,rt,{value:C.create()})}return $t[rt]}function tn($t,mt){for(var Zt=0;Zt<mt;++Zt)$t[Zt]=255*Math.random()|0;return $t}function ln($t){if(typeof Uint8Array=="function"){var mt=new Uint8Array($t);return typeof crypto<"u"?crypto.getRandomValues(mt):typeof msCrypto<"u"?msCrypto.getRandomValues(mt):tn(mt,$t),mt}return tn(new Array($t),$t)}function Rt(){var $t=ln(Be);$t[6]=79&$t[6]|64,$t[8]=191&$t[8]|128;for(var mt="",Zt=0;Zt<Be;++Zt){var wn=$t[Zt];Zt!==4&&Zt!==6&&Zt!==8||(mt+="-"),wn<16&&(mt+="0"),mt+=wn.toString(16).toLowerCase()}return mt}}function at(Be){return Be.__=void 0,delete Be.__,Be}p("decorate",H),p("metadata",X),p("defineMetadata",G),p("hasMetadata",Y),p("hasOwnMetadata",J),p("getMetadata",Q),p("getOwnMetadata",z),p("getMetadataKeys",q),p("getOwnMetadataKeys",ee),p("deleteMetadata",te)})(f,h),h.Reflect===void 0&&(h.Reflect=u)})()})(l||(l={}))}},r={};function i(o){var a=r[o];if(a!==void 0)return a.exports;var c=r[o]={id:o,loaded:!1,exports:{}};return t[o].call(c.exports,c,c.exports,i),c.loaded=!0,c.exports}i.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return i.d(a,{a}),a},i.d=(o,a)=>{for(var c in a)i.o(a,c)&&!i.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:a[c]})},i.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),i.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i.nmd=o=>(o.paths=[],o.children||(o.children=[]),o);var s={};return(()=>{i.r(s),i.d(s,{BASIC_FULL_HD_LANDSCAPE:()=>br,BASIC_FULL_HD_PORTRAIT:()=>Un,BASIC_LANDSCAPE:()=>Gr,BASIC_PORTRAIT:()=>or,BroadcastClientError:()=>_e,BroadcastClientEvents:()=>Sc,ConnectionState:()=>hr,Errors:()=>u,InitialLayerPreference:()=>Sa,JitterBufferMinDelay:()=>Ms,LOG_LEVEL:()=>W,LocalStageStream:()=>wa,LocalStageStreamEvents:()=>gr,LogLevels:()=>W,RemoteStageStream:()=>Gd,RemoteStageStreamEvents:()=>nr,SIMULCAST_DUPLICATE_LAYERS_CONFIGURED:()=>pS,SIMULCAST_LAYER_CONFIGURATION_CONFLICT:()=>Dy,SIMULCAST_LAYER_INPUT_FRAMERATE_INSUFFICIENT:()=>a0,SIMULCAST_LAYER_INPUT_RESOLUTION_INSUFFICIENT:()=>o0,SIMULCAST_LAYER_INVALID_TYPE:()=>Xh,SIMULCAST_LAYER_ORIENTATION_MISMATCH:()=>mS,SIMULCAST_MAX_LAYERS_EXCEEDED:()=>dS,SIMULCAST_MAX_LAYER_BITRATE_EXCEEDED:()=>s0,SIMULCAST_MAX_LAYER_DIMENSIONS_EXCEEDED:()=>Z_,SIMULCAST_MAX_LAYER_FRAMERATE_EXCEEDED:()=>Ny,SIMULCAST_MIN_LAYER_BITRATE_EXCEEDED:()=>Oy,SIMULCAST_MIN_LAYER_DIMENSIONS_EXCEEDED:()=>Py,SIMULCAST_MIN_LAYER_FRAMERATE_EXCEEDED:()=>X_,SIMULCAST_UNSUPPORTED:()=>fS,STAGE_MAX_AUDIO_BITRATE_KBPS:()=>nm,STAGE_MAX_AUDIO_BITRATE_KBPS_DEFAULT:()=>t0,STAGE_MAX_BITRATE:()=>Wu,STAGE_MAX_FRAMERATE:()=>Yu,STAGE_MAX_RESOLUTION:()=>Fd,STAGE_MIN_AUDIO_BITRATE_KBPS:()=>e0,STAGE_MIN_BITRATE:()=>Lf,STAGE_MIN_FRAMERATE:()=>qu,STAGE_MIN_RESOLUTION:()=>tm,STANDARD_LANDSCAPE:()=>bi,STANDARD_PORTRAIT:()=>ai,SimulcastLayerPresets:()=>em,Stage:()=>ov,StageConnectionState:()=>Ni,StageErrorCategory:()=>Z,StageErrorCode:()=>ge,StageEvents:()=>ar,StageLeftReason:()=>am,StageParticipantPublishState:()=>jn,StageParticipantSubscribeState:()=>wi,StageStream:()=>si,StageStreamLayerSelectedReason:()=>Rn,StreamType:()=>Tr,SubscribeType:()=>Gs,__version:()=>Vg,create:()=>B_,default:()=>Yd,isSupported:()=>se});var o={};i.r(o),i.d(o,{fixNegotiationNeeded:()=>J,shimAddTrackRemoveTrack:()=>G,shimAddTrackRemoveTrackWithNative:()=>X,shimGetDisplayMedia:()=>B,shimGetSendersWithDtmf:()=>L,shimGetStats:()=>P,shimGetUserMedia:()=>U,shimMediaStream:()=>$,shimOnTrack:()=>I,shimPeerConnection:()=>Y,shimSenderReceiverGetStats:()=>H});var a={};i.r(a),i.d(a,{shimAddTransceiver:()=>Te,shimCreateAnswer:()=>it,shimCreateOffer:()=>We,shimGetDisplayMedia:()=>z,shimGetParameters:()=>Pe,shimGetUserMedia:()=>Q,shimOnTrack:()=>q,shimPeerConnection:()=>ee,shimRTCDataChannel:()=>Re,shimReceiverGetStats:()=>ie,shimRemoveStream:()=>Ee,shimSenderGetStats:()=>te});var c={};i.r(c),i.d(c,{shimAudioContext:()=>ve,shimCallbacksAPI:()=>re,shimConstraints:()=>$e,shimCreateOfferLegacy:()=>ae,shimGetUserMedia:()=>Le,shimLocalStreamsAPI:()=>ht,shimRTCIceServerUrls:()=>De,shimRemoteStreamsAPI:()=>vt,shimTrackEventTransceiver:()=>Oe});var l={};i.r(l),i.d(l,{removeExtmapAllowMixed:()=>gt,shimAddIceCandidateNullOrEmpty:()=>At,shimConnectionState:()=>Ut,shimMaxMessageSize:()=>Xe,shimParameterlessSetLocalDescription:()=>Ce,shimRTCIceCandidate:()=>ze,shimRTCIceCandidateRelayProtocol:()=>Je,shimSendThrowTypeError:()=>et});var u={};i.r(u),i.d(u,{ADD_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Be,ADD_DEVICE_COMPOSITION_MISSING_ERROR:()=>at,ADD_DEVICE_CONSTRAINTS_ERROR:()=>xt,ADD_DEVICE_DEVICE_ERROR:()=>Fe,ADD_DEVICE_NAME_EXISTS_ERROR:()=>Ge,ADD_DEVICE_NAME_MISSING_ERROR:()=>tt,ADD_DEVICE_UNSUPPORTED:()=>rt,BROADCAST_CONFIGURATION_ERROR:()=>Ln,BROADCAST_ERROR:()=>Ye,CAMERA_ERROR:()=>ke,CLIENT_INVALID_ERROR:()=>ss,EXCHANGE_POSITION_DEVICE_NOT_FOUND_ERROR:()=>mt,FAILED_TO_ADD_IMAGE_ERROR:()=>Zt,INGEST_ENDPOINT_TYPE_ERROR:()=>is,INGEST_ENDPOINT_URL_ERROR:()=>hi,INPUT_ERROR:()=>Ve,INVALID_STREAM_KEY:()=>An,LOGGER_TYPE_ERROR:()=>ji,LOG_LEVEL_TYPE_ERROR:()=>ti,NETWORK_RECONNECT_CONFIGURATION_ERROR:()=>Yi,NETWORK_RECONNECT_CONFIGURATION_INVALID_TIMEOUT_ERROR:()=>os,PEER_CONNECTION_ERROR:()=>qt,PEER_SETUP_ERROR:()=>wn,REMOVE_DEVICE_NOT_FOUND_ERROR:()=>ot,REMOVE_IMAGE_NOT_FOUND_ERROR:()=>tn,STAGE_TOKEN_TYPE_ERROR:()=>je,STAGE_WHIP_OVERRIDE_ERROR:()=>_t,STREAM_CONFIGURATION_ERROR:()=>mr,STREAM_KEY_INVALID_CHAR_ERROR:()=>as,UPDATE_VIDEO_DEVICE_COMPOSITION_INDEX_MISSING_ERROR:()=>Rt,UPDATE_VIDEO_DEVICE_COMPOSITION_MISSING_ERROR:()=>ln,UPDATE_VIDEO_DEVICE_COMPOSITION_NAME_NOT_FOUND_ERROR:()=>$t});var h={};i.r(h),i.d(h,{BASIC_FULL_HD_LANDSCAPE:()=>br,BASIC_FULL_HD_PORTRAIT:()=>Un,BASIC_LANDSCAPE:()=>Gr,BASIC_PORTRAIT:()=>or,BroadcastClientError:()=>_e,BroadcastClientEvents:()=>Sc,ConnectionState:()=>hr,Errors:()=>u,LOG_LEVEL:()=>W,LogLevels:()=>W,STANDARD_LANDSCAPE:()=>bi,STANDARD_PORTRAIT:()=>ai,__version:()=>Vg,create:()=>B_,isSupported:()=>se});let f=!0,d=!0;function p(M,E,A){const O=M.match(E);return O&&O.length>=A&&parseInt(O[A],10)}function m(M,E,A){if(!M.RTCPeerConnection)return;const O=M.RTCPeerConnection.prototype,F=O.addEventListener;O.addEventListener=function(K,ue){if(K!==E)return F.apply(this,arguments);const me=ce=>{const de=A(ce);de&&(ue.handleEvent?ue.handleEvent(de):ue(de))};return this._eventMap=this._eventMap||{},this._eventMap[E]||(this._eventMap[E]=new Map),this._eventMap[E].set(ue,me),F.apply(this,[K,me])};const V=O.removeEventListener;O.removeEventListener=function(K,ue){if(K!==E||!this._eventMap||!this._eventMap[E])return V.apply(this,arguments);if(!this._eventMap[E].has(ue))return V.apply(this,arguments);const me=this._eventMap[E].get(ue);return this._eventMap[E].delete(ue),this._eventMap[E].size===0&&delete this._eventMap[E],Object.keys(this._eventMap).length===0&&delete this._eventMap,V.apply(this,[K,me])},Object.defineProperty(O,"on"+E,{get(){return this["_on"+E]},set(K){this["_on"+E]&&(this.removeEventListener(E,this["_on"+E]),delete this["_on"+E]),K&&this.addEventListener(E,this["_on"+E]=K)},enumerable:!0,configurable:!0})}function _(M){return typeof M!="boolean"?new Error("Argument type: "+typeof M+". Please use a boolean."):(f=M,M?"adapter.js logging disabled":"adapter.js logging enabled")}function v(M){return typeof M!="boolean"?new Error("Argument type: "+typeof M+". Please use a boolean."):(d=!M,"adapter.js deprecation warnings "+(M?"disabled":"enabled"))}function S(){if(typeof window=="object"){if(f)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function b(M,E){d&&console.warn(M+" is deprecated, please use "+E+" instead.")}function T(M){return Object.prototype.toString.call(M)==="[object Object]"}function w(M){return T(M)?Object.keys(M).reduce((function(E,A){const O=T(M[A]),F=O?w(M[A]):M[A],V=O&&!Object.keys(F).length;return F===void 0||V?E:Object.assign(E,{[A]:F})}),{}):M}function R(M,E,A){E&&!A.has(E.id)&&(A.set(E.id,E),Object.keys(E).forEach((O=>{O.endsWith("Id")?R(M,M.get(E[O]),A):O.endsWith("Ids")&&E[O].forEach((F=>{R(M,M.get(F),A)}))})))}function C(M,E,A){const O=A?"outbound-rtp":"inbound-rtp",F=new Map;if(E===null)return F;const V=[];return M.forEach((K=>{K.type==="track"&&K.trackIdentifier===E.id&&V.push(K)})),V.forEach((K=>{M.forEach((ue=>{ue.type===O&&ue.trackId===K.id&&R(M,ue,F)}))})),F}const N=S;function U(M,E){const A=M&&M.navigator;if(!A.mediaDevices)return;const O=function(K){if(typeof K!="object"||K.mandatory||K.optional)return K;const ue={};return Object.keys(K).forEach((me=>{if(me==="require"||me==="advanced"||me==="mediaSource")return;const ce=typeof K[me]=="object"?K[me]:{ideal:K[me]};ce.exact!==void 0&&typeof ce.exact=="number"&&(ce.min=ce.max=ce.exact);const de=function(we,Me){return we?we+Me.charAt(0).toUpperCase()+Me.slice(1):Me==="deviceId"?"sourceId":Me};if(ce.ideal!==void 0){ue.optional=ue.optional||[];let we={};typeof ce.ideal=="number"?(we[de("min",me)]=ce.ideal,ue.optional.push(we),we={},we[de("max",me)]=ce.ideal,ue.optional.push(we)):(we[de("",me)]=ce.ideal,ue.optional.push(we))}ce.exact!==void 0&&typeof ce.exact!="number"?(ue.mandatory=ue.mandatory||{},ue.mandatory[de("",me)]=ce.exact):["min","max"].forEach((we=>{ce[we]!==void 0&&(ue.mandatory=ue.mandatory||{},ue.mandatory[de(we,me)]=ce[we])}))})),K.advanced&&(ue.optional=(ue.optional||[]).concat(K.advanced)),ue},F=function(K,ue){if(E.version>=61)return ue(K);if((K=JSON.parse(JSON.stringify(K)))&&typeof K.audio=="object"){const me=function(ce,de,we){de in ce&&!(we in ce)&&(ce[we]=ce[de],delete ce[de])};me((K=JSON.parse(JSON.stringify(K))).audio,"autoGainControl","googAutoGainControl"),me(K.audio,"noiseSuppression","googNoiseSuppression"),K.audio=O(K.audio)}if(K&&typeof K.video=="object"){let me=K.video.facingMode;me=me&&(typeof me=="object"?me:{ideal:me});const ce=E.version<66;if(me&&(me.exact==="user"||me.exact==="environment"||me.ideal==="user"||me.ideal==="environment")&&(!A.mediaDevices.getSupportedConstraints||!A.mediaDevices.getSupportedConstraints().facingMode||ce)){let de;if(delete K.video.facingMode,me.exact==="environment"||me.ideal==="environment"?de=["back","rear"]:me.exact!=="user"&&me.ideal!=="user"||(de=["front"]),de)return A.mediaDevices.enumerateDevices().then((we=>{let Me=(we=we.filter((nt=>nt.kind==="videoinput"))).find((nt=>de.some((bt=>nt.label.toLowerCase().includes(bt)))));return!Me&&we.length&&de.includes("back")&&(Me=we[we.length-1]),Me&&(K.video.deviceId=me.exact?{exact:Me.deviceId}:{ideal:Me.deviceId}),K.video=O(K.video),N("chrome: "+JSON.stringify(K)),ue(K)}))}K.video=O(K.video)}return N("chrome: "+JSON.stringify(K)),ue(K)},V=function(K){return E.version>=64?K:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[K.name]||K.name,message:K.message,constraint:K.constraint||K.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(A.getUserMedia=(function(K,ue,me){F(K,(ce=>{A.webkitGetUserMedia(ce,ue,(de=>{me&&me(V(de))}))}))}).bind(A),A.mediaDevices.getUserMedia){const K=A.mediaDevices.getUserMedia.bind(A.mediaDevices);A.mediaDevices.getUserMedia=function(ue){return F(ue,(me=>K(me).then((ce=>{if(me.audio&&!ce.getAudioTracks().length||me.video&&!ce.getVideoTracks().length)throw ce.getTracks().forEach((de=>{de.stop()})),new DOMException("","NotFoundError");return ce}),(ce=>Promise.reject(V(ce))))))}}}function B(M,E){M.navigator.mediaDevices&&"getDisplayMedia"in M.navigator.mediaDevices||M.navigator.mediaDevices&&(typeof E=="function"?M.navigator.mediaDevices.getDisplayMedia=function(A){return E(A).then((O=>{const F=A.video&&A.video.width,V=A.video&&A.video.height,K=A.video&&A.video.frameRate;return A.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:O,maxFrameRate:K||3}},F&&(A.video.mandatory.maxWidth=F),V&&(A.video.mandatory.maxHeight=V),M.navigator.mediaDevices.getUserMedia(A)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function $(M){M.MediaStream=M.MediaStream||M.webkitMediaStream}function I(M){if(typeof M=="object"&&M.RTCPeerConnection&&!("ontrack"in M.RTCPeerConnection.prototype)){Object.defineProperty(M.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(A){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=A)},enumerable:!0,configurable:!0});const E=M.RTCPeerConnection.prototype.setRemoteDescription;M.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=A=>{A.stream.addEventListener("addtrack",(O=>{let F;F=M.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((K=>K.track&&K.track.id===O.track.id)):{track:O.track};const V=new Event("track");V.track=O.track,V.receiver=F,V.transceiver={receiver:F},V.streams=[A.stream],this.dispatchEvent(V)})),A.stream.getTracks().forEach((O=>{let F;F=M.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((K=>K.track&&K.track.id===O.id)):{track:O};const V=new Event("track");V.track=O,V.receiver=F,V.transceiver={receiver:F},V.streams=[A.stream],this.dispatchEvent(V)}))},this.addEventListener("addstream",this._ontrackpoly)),E.apply(this,arguments)}}else m(M,"track",(E=>(E.transceiver||Object.defineProperty(E,"transceiver",{value:{receiver:E.receiver}}),E)))}function L(M){if(typeof M=="object"&&M.RTCPeerConnection&&!("getSenders"in M.RTCPeerConnection.prototype)&&"createDTMFSender"in M.RTCPeerConnection.prototype){const E=function(F,V){return{track:V,get dtmf(){return this._dtmf===void 0&&(V.kind==="audio"?this._dtmf=F.createDTMFSender(V):this._dtmf=null),this._dtmf},_pc:F}};if(!M.RTCPeerConnection.prototype.getSenders){M.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const F=M.RTCPeerConnection.prototype.addTrack;M.RTCPeerConnection.prototype.addTrack=function(K,ue){let me=F.apply(this,arguments);return me||(me=E(this,K),this._senders.push(me)),me};const V=M.RTCPeerConnection.prototype.removeTrack;M.RTCPeerConnection.prototype.removeTrack=function(K){V.apply(this,arguments);const ue=this._senders.indexOf(K);ue!==-1&&this._senders.splice(ue,1)}}const A=M.RTCPeerConnection.prototype.addStream;M.RTCPeerConnection.prototype.addStream=function(F){this._senders=this._senders||[],A.apply(this,[F]),F.getTracks().forEach((V=>{this._senders.push(E(this,V))}))};const O=M.RTCPeerConnection.prototype.removeStream;M.RTCPeerConnection.prototype.removeStream=function(F){this._senders=this._senders||[],O.apply(this,[F]),F.getTracks().forEach((V=>{const K=this._senders.find((ue=>ue.track===V));K&&this._senders.splice(this._senders.indexOf(K),1)}))}}else if(typeof M=="object"&&M.RTCPeerConnection&&"getSenders"in M.RTCPeerConnection.prototype&&"createDTMFSender"in M.RTCPeerConnection.prototype&&M.RTCRtpSender&&!("dtmf"in M.RTCRtpSender.prototype)){const E=M.RTCPeerConnection.prototype.getSenders;M.RTCPeerConnection.prototype.getSenders=function(){const A=E.apply(this,[]);return A.forEach((O=>O._pc=this)),A},Object.defineProperty(M.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function P(M){if(!M.RTCPeerConnection)return;const E=M.RTCPeerConnection.prototype.getStats;M.RTCPeerConnection.prototype.getStats=function(){const[A,O,F]=arguments;if(arguments.length>0&&typeof A=="function")return E.apply(this,arguments);if(E.length===0&&(arguments.length===0||typeof A!="function"))return E.apply(this,[]);const V=function(ue){const me={};return ue.result().forEach((ce=>{const de={id:ce.id,timestamp:ce.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[ce.type]||ce.type};ce.names().forEach((we=>{de[we]=ce.stat(we)})),me[de.id]=de})),me},K=function(ue){return new Map(Object.keys(ue).map((me=>[me,ue[me]])))};if(arguments.length>=2){const ue=function(me){O(K(V(me)))};return E.apply(this,[ue,A])}return new Promise(((ue,me)=>{E.apply(this,[function(ce){ue(K(V(ce)))},me])})).then(O,F)}}function H(M){if(!(typeof M=="object"&&M.RTCPeerConnection&&M.RTCRtpSender&&M.RTCRtpReceiver))return;if(!("getStats"in M.RTCRtpSender.prototype)){const A=M.RTCPeerConnection.prototype.getSenders;A&&(M.RTCPeerConnection.prototype.getSenders=function(){const F=A.apply(this,[]);return F.forEach((V=>V._pc=this)),F});const O=M.RTCPeerConnection.prototype.addTrack;O&&(M.RTCPeerConnection.prototype.addTrack=function(){const F=O.apply(this,arguments);return F._pc=this,F}),M.RTCRtpSender.prototype.getStats=function(){const F=this;return this._pc.getStats().then((V=>C(V,F.track,!0)))}}if(!("getStats"in M.RTCRtpReceiver.prototype)){const A=M.RTCPeerConnection.prototype.getReceivers;A&&(M.RTCPeerConnection.prototype.getReceivers=function(){const O=A.apply(this,[]);return O.forEach((F=>F._pc=this)),O}),m(M,"track",(O=>(O.receiver._pc=O.srcElement,O))),M.RTCRtpReceiver.prototype.getStats=function(){const O=this;return this._pc.getStats().then((F=>C(F,O.track,!1)))}}if(!("getStats"in M.RTCRtpSender.prototype)||!("getStats"in M.RTCRtpReceiver.prototype))return;const E=M.RTCPeerConnection.prototype.getStats;M.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof M.MediaStreamTrack){const A=arguments[0];let O,F,V;return this.getSenders().forEach((K=>{K.track===A&&(O?V=!0:O=K)})),this.getReceivers().forEach((K=>(K.track===A&&(F?V=!0:F=K),K.track===A))),V||O&&F?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):O?O.getStats():F?F.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return E.apply(this,arguments)}}function X(M){M.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((V=>this._shimmedLocalStreams[V][0]))};const E=M.RTCPeerConnection.prototype.addTrack;M.RTCPeerConnection.prototype.addTrack=function(V,K){if(!K)return E.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const ue=E.apply(this,arguments);return this._shimmedLocalStreams[K.id]?this._shimmedLocalStreams[K.id].indexOf(ue)===-1&&this._shimmedLocalStreams[K.id].push(ue):this._shimmedLocalStreams[K.id]=[K,ue],ue};const A=M.RTCPeerConnection.prototype.addStream;M.RTCPeerConnection.prototype.addStream=function(V){this._shimmedLocalStreams=this._shimmedLocalStreams||{},V.getTracks().forEach((me=>{if(this.getSenders().find((ce=>ce.track===me)))throw new DOMException("Track already exists.","InvalidAccessError")}));const K=this.getSenders();A.apply(this,arguments);const ue=this.getSenders().filter((me=>K.indexOf(me)===-1));this._shimmedLocalStreams[V.id]=[V].concat(ue)};const O=M.RTCPeerConnection.prototype.removeStream;M.RTCPeerConnection.prototype.removeStream=function(V){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[V.id],O.apply(this,arguments)};const F=M.RTCPeerConnection.prototype.removeTrack;M.RTCPeerConnection.prototype.removeTrack=function(V){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},V&&Object.keys(this._shimmedLocalStreams).forEach((K=>{const ue=this._shimmedLocalStreams[K].indexOf(V);ue!==-1&&this._shimmedLocalStreams[K].splice(ue,1),this._shimmedLocalStreams[K].length===1&&delete this._shimmedLocalStreams[K]})),F.apply(this,arguments)}}function G(M,E){if(!M.RTCPeerConnection)return;if(M.RTCPeerConnection.prototype.addTrack&&E.version>=65)return X(M);const A=M.RTCPeerConnection.prototype.getLocalStreams;M.RTCPeerConnection.prototype.getLocalStreams=function(){const me=A.apply(this);return this._reverseStreams=this._reverseStreams||{},me.map((ce=>this._reverseStreams[ce.id]))};const O=M.RTCPeerConnection.prototype.addStream;M.RTCPeerConnection.prototype.addStream=function(me){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},me.getTracks().forEach((ce=>{if(this.getSenders().find((de=>de.track===ce)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[me.id]){const ce=new M.MediaStream(me.getTracks());this._streams[me.id]=ce,this._reverseStreams[ce.id]=me,me=ce}O.apply(this,[me])};const F=M.RTCPeerConnection.prototype.removeStream;function V(me,ce){let de=ce.sdp;return Object.keys(me._reverseStreams||[]).forEach((we=>{const Me=me._reverseStreams[we],nt=me._streams[Me.id];de=de.replace(new RegExp(nt.id,"g"),Me.id)})),new RTCSessionDescription({type:ce.type,sdp:de})}M.RTCPeerConnection.prototype.removeStream=function(me){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},F.apply(this,[this._streams[me.id]||me]),delete this._reverseStreams[this._streams[me.id]?this._streams[me.id].id:me.id],delete this._streams[me.id]},M.RTCPeerConnection.prototype.addTrack=function(me,ce){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const de=[].slice.call(arguments,1);if(de.length!==1||!de[0].getTracks().find((Me=>Me===me)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((Me=>Me.track===me)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const we=this._streams[ce.id];if(we)we.addTrack(me),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const Me=new M.MediaStream([me]);this._streams[ce.id]=Me,this._reverseStreams[Me.id]=ce,this.addStream(Me)}return this.getSenders().find((Me=>Me.track===me))},["createOffer","createAnswer"].forEach((function(me){const ce=M.RTCPeerConnection.prototype[me],de={[me](){const we=arguments;return arguments.length&&typeof arguments[0]=="function"?ce.apply(this,[Me=>{const nt=V(this,Me);we[0].apply(null,[nt])},Me=>{we[1]&&we[1].apply(null,Me)},arguments[2]]):ce.apply(this,arguments).then((Me=>V(this,Me)))}};M.RTCPeerConnection.prototype[me]=de[me]}));const K=M.RTCPeerConnection.prototype.setLocalDescription;M.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(me,ce){let de=ce.sdp;return Object.keys(me._reverseStreams||[]).forEach((we=>{const Me=me._reverseStreams[we],nt=me._streams[Me.id];de=de.replace(new RegExp(Me.id,"g"),nt.id)})),new RTCSessionDescription({type:ce.type,sdp:de})})(this,arguments[0]),K.apply(this,arguments)):K.apply(this,arguments)};const ue=Object.getOwnPropertyDescriptor(M.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(M.RTCPeerConnection.prototype,"localDescription",{get(){const me=ue.get.apply(this);return me.type===""?me:V(this,me)}}),M.RTCPeerConnection.prototype.removeTrack=function(me){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!me._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(me._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let ce;this._streams=this._streams||{},Object.keys(this._streams).forEach((de=>{this._streams[de].getTracks().find((we=>me.track===we))&&(ce=this._streams[de])})),ce&&(ce.getTracks().length===1?this.removeStream(this._reverseStreams[ce.id]):ce.removeTrack(me.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Y(M,E){!M.RTCPeerConnection&&M.webkitRTCPeerConnection&&(M.RTCPeerConnection=M.webkitRTCPeerConnection),M.RTCPeerConnection&&E.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(A){const O=M.RTCPeerConnection.prototype[A],F={[A](){return arguments[0]=new(A==="addIceCandidate"?M.RTCIceCandidate:M.RTCSessionDescription)(arguments[0]),O.apply(this,arguments)}};M.RTCPeerConnection.prototype[A]=F[A]}))}function J(M,E){m(M,"negotiationneeded",(A=>{const O=A.target;if(!(E.version<72||O.getConfiguration&&O.getConfiguration().sdpSemantics==="plan-b")||O.signalingState==="stable")return A}))}function Q(M,E){const A=M&&M.navigator,O=M&&M.MediaStreamTrack;if(A.getUserMedia=function(F,V,K){b("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),A.mediaDevices.getUserMedia(F).then(V,K)},!(E.version>55&&"autoGainControl"in A.mediaDevices.getSupportedConstraints())){const F=function(K,ue,me){ue in K&&!(me in K)&&(K[me]=K[ue],delete K[ue])},V=A.mediaDevices.getUserMedia.bind(A.mediaDevices);if(A.mediaDevices.getUserMedia=function(K){return typeof K=="object"&&typeof K.audio=="object"&&(K=JSON.parse(JSON.stringify(K)),F(K.audio,"autoGainControl","mozAutoGainControl"),F(K.audio,"noiseSuppression","mozNoiseSuppression")),V(K)},O&&O.prototype.getSettings){const K=O.prototype.getSettings;O.prototype.getSettings=function(){const ue=K.apply(this,arguments);return F(ue,"mozAutoGainControl","autoGainControl"),F(ue,"mozNoiseSuppression","noiseSuppression"),ue}}if(O&&O.prototype.applyConstraints){const K=O.prototype.applyConstraints;O.prototype.applyConstraints=function(ue){return this.kind==="audio"&&typeof ue=="object"&&(ue=JSON.parse(JSON.stringify(ue)),F(ue,"autoGainControl","mozAutoGainControl"),F(ue,"noiseSuppression","mozNoiseSuppression")),K.apply(this,[ue])}}}}function z(M,E){M.navigator.mediaDevices&&"getDisplayMedia"in M.navigator.mediaDevices||M.navigator.mediaDevices&&(M.navigator.mediaDevices.getDisplayMedia=function(A){if(!A||!A.video){const O=new DOMException("getDisplayMedia without video constraints is undefined");return O.name="NotFoundError",O.code=8,Promise.reject(O)}return A.video===!0?A.video={mediaSource:E}:A.video.mediaSource=E,M.navigator.mediaDevices.getUserMedia(A)})}function q(M){typeof M=="object"&&M.RTCTrackEvent&&"receiver"in M.RTCTrackEvent.prototype&&!("transceiver"in M.RTCTrackEvent.prototype)&&Object.defineProperty(M.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ee(M,E){if(typeof M!="object"||!M.RTCPeerConnection&&!M.mozRTCPeerConnection)return;!M.RTCPeerConnection&&M.mozRTCPeerConnection&&(M.RTCPeerConnection=M.mozRTCPeerConnection),E.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(F){const V=M.RTCPeerConnection.prototype[F],K={[F](){return arguments[0]=new(F==="addIceCandidate"?M.RTCIceCandidate:M.RTCSessionDescription)(arguments[0]),V.apply(this,arguments)}};M.RTCPeerConnection.prototype[F]=K[F]}));const A={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},O=M.RTCPeerConnection.prototype.getStats;M.RTCPeerConnection.prototype.getStats=function(){const[F,V,K]=arguments;return O.apply(this,[F||null]).then((ue=>{if(E.version<53&&!V)try{ue.forEach((me=>{me.type=A[me.type]||me.type}))}catch(me){if(me.name!=="TypeError")throw me;ue.forEach(((ce,de)=>{ue.set(de,Object.assign({},ce,{type:A[ce.type]||ce.type}))}))}return ue})).then(V,K)}}function te(M){if(typeof M!="object"||!M.RTCPeerConnection||!M.RTCRtpSender||M.RTCRtpSender&&"getStats"in M.RTCRtpSender.prototype)return;const E=M.RTCPeerConnection.prototype.getSenders;E&&(M.RTCPeerConnection.prototype.getSenders=function(){const O=E.apply(this,[]);return O.forEach((F=>F._pc=this)),O});const A=M.RTCPeerConnection.prototype.addTrack;A&&(M.RTCPeerConnection.prototype.addTrack=function(){const O=A.apply(this,arguments);return O._pc=this,O}),M.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function ie(M){if(typeof M!="object"||!M.RTCPeerConnection||!M.RTCRtpSender||M.RTCRtpSender&&"getStats"in M.RTCRtpReceiver.prototype)return;const E=M.RTCPeerConnection.prototype.getReceivers;E&&(M.RTCPeerConnection.prototype.getReceivers=function(){const A=E.apply(this,[]);return A.forEach((O=>O._pc=this)),A}),m(M,"track",(A=>(A.receiver._pc=A.srcElement,A))),M.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ee(M){M.RTCPeerConnection&&!("removeStream"in M.RTCPeerConnection.prototype)&&(M.RTCPeerConnection.prototype.removeStream=function(E){b("removeStream","removeTrack"),this.getSenders().forEach((A=>{A.track&&E.getTracks().includes(A.track)&&this.removeTrack(A)}))})}function Re(M){M.DataChannel&&!M.RTCDataChannel&&(M.RTCDataChannel=M.DataChannel)}function Te(M){if(typeof M!="object"||!M.RTCPeerConnection)return;const E=M.RTCPeerConnection.prototype.addTransceiver;E&&(M.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let A=arguments[1]&&arguments[1].sendEncodings;A===void 0&&(A=[]),A=[...A];const O=A.length>0;O&&A.forEach((V=>{if("rid"in V&&!/^[a-z0-9]{0,16}$/i.test(V.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in V&&!(parseFloat(V.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in V&&!(parseFloat(V.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const F=E.apply(this,arguments);if(O){const{sender:V}=F,K=V.getParameters();(!("encodings"in K)||K.encodings.length===1&&Object.keys(K.encodings[0]).length===0)&&(K.encodings=A,V.sendEncodings=A,this.setParametersPromises.push(V.setParameters(K).then((()=>{delete V.sendEncodings})).catch((()=>{delete V.sendEncodings}))))}return F})}function Pe(M){if(typeof M!="object"||!M.RTCRtpSender)return;const E=M.RTCRtpSender.prototype.getParameters;E&&(M.RTCRtpSender.prototype.getParameters=function(){const A=E.apply(this,arguments);return"encodings"in A||(A.encodings=[].concat(this.sendEncodings||[{}])),A})}function We(M){if(typeof M!="object"||!M.RTCPeerConnection)return;const E=M.RTCPeerConnection.prototype.createOffer;M.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>E.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):E.apply(this,arguments)}}function it(M){if(typeof M!="object"||!M.RTCPeerConnection)return;const E=M.RTCPeerConnection.prototype.createAnswer;M.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>E.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):E.apply(this,arguments)}}function ht(M){if(typeof M=="object"&&M.RTCPeerConnection){if("getLocalStreams"in M.RTCPeerConnection.prototype||(M.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in M.RTCPeerConnection.prototype)){const E=M.RTCPeerConnection.prototype.addTrack;M.RTCPeerConnection.prototype.addStream=function(A){this._localStreams||(this._localStreams=[]),this._localStreams.includes(A)||this._localStreams.push(A),A.getAudioTracks().forEach((O=>E.call(this,O,A))),A.getVideoTracks().forEach((O=>E.call(this,O,A)))},M.RTCPeerConnection.prototype.addTrack=function(A,...O){return O&&O.forEach((F=>{this._localStreams?this._localStreams.includes(F)||this._localStreams.push(F):this._localStreams=[F]})),E.apply(this,arguments)}}"removeStream"in M.RTCPeerConnection.prototype||(M.RTCPeerConnection.prototype.removeStream=function(E){this._localStreams||(this._localStreams=[]);const A=this._localStreams.indexOf(E);if(A===-1)return;this._localStreams.splice(A,1);const O=E.getTracks();this.getSenders().forEach((F=>{O.includes(F.track)&&this.removeTrack(F)}))})}}function vt(M){if(typeof M=="object"&&M.RTCPeerConnection&&("getRemoteStreams"in M.RTCPeerConnection.prototype||(M.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in M.RTCPeerConnection.prototype))){Object.defineProperty(M.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(A){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=A),this.addEventListener("track",this._onaddstreampoly=O=>{O.streams.forEach((F=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(F))return;this._remoteStreams.push(F);const V=new Event("addstream");V.stream=F,this.dispatchEvent(V)}))})}});const E=M.RTCPeerConnection.prototype.setRemoteDescription;M.RTCPeerConnection.prototype.setRemoteDescription=function(){const A=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(O){O.streams.forEach((F=>{if(A._remoteStreams||(A._remoteStreams=[]),A._remoteStreams.indexOf(F)>=0)return;A._remoteStreams.push(F);const V=new Event("addstream");V.stream=F,A.dispatchEvent(V)}))}),E.apply(A,arguments)}}}function re(M){if(typeof M!="object"||!M.RTCPeerConnection)return;const E=M.RTCPeerConnection.prototype,A=E.createOffer,O=E.createAnswer,F=E.setLocalDescription,V=E.setRemoteDescription,K=E.addIceCandidate;E.createOffer=function(me,ce){const de=arguments.length>=2?arguments[2]:arguments[0],we=A.apply(this,[de]);return ce?(we.then(me,ce),Promise.resolve()):we},E.createAnswer=function(me,ce){const de=arguments.length>=2?arguments[2]:arguments[0],we=O.apply(this,[de]);return ce?(we.then(me,ce),Promise.resolve()):we};let ue=function(me,ce,de){const we=F.apply(this,[me]);return de?(we.then(ce,de),Promise.resolve()):we};E.setLocalDescription=ue,ue=function(me,ce,de){const we=V.apply(this,[me]);return de?(we.then(ce,de),Promise.resolve()):we},E.setRemoteDescription=ue,ue=function(me,ce,de){const we=K.apply(this,[me]);return de?(we.then(ce,de),Promise.resolve()):we},E.addIceCandidate=ue}function Le(M){const E=M&&M.navigator;if(E.mediaDevices&&E.mediaDevices.getUserMedia){const A=E.mediaDevices,O=A.getUserMedia.bind(A);E.mediaDevices.getUserMedia=F=>O($e(F))}!E.getUserMedia&&E.mediaDevices&&E.mediaDevices.getUserMedia&&(E.getUserMedia=(function(A,O,F){E.mediaDevices.getUserMedia(A).then(O,F)}).bind(E))}function $e(M){return M&&M.video!==void 0?Object.assign({},M,{video:w(M.video)}):M}function De(M){if(!M.RTCPeerConnection)return;const E=M.RTCPeerConnection;M.RTCPeerConnection=function(A,O){if(A&&A.iceServers){const F=[];for(let V=0;V<A.iceServers.length;V++){let K=A.iceServers[V];K.urls===void 0&&K.url?(b("RTCIceServer.url","RTCIceServer.urls"),K=JSON.parse(JSON.stringify(K)),K.urls=K.url,delete K.url,F.push(K)):F.push(A.iceServers[V])}A.iceServers=F}return new E(A,O)},M.RTCPeerConnection.prototype=E.prototype,"generateCertificate"in E&&Object.defineProperty(M.RTCPeerConnection,"generateCertificate",{get:()=>E.generateCertificate})}function Oe(M){typeof M=="object"&&M.RTCTrackEvent&&"receiver"in M.RTCTrackEvent.prototype&&!("transceiver"in M.RTCTrackEvent.prototype)&&Object.defineProperty(M.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ae(M){const E=M.RTCPeerConnection.prototype.createOffer;M.RTCPeerConnection.prototype.createOffer=function(A){if(A){A.offerToReceiveAudio!==void 0&&(A.offerToReceiveAudio=!!A.offerToReceiveAudio);const O=this.getTransceivers().find((V=>V.receiver.track.kind==="audio"));A.offerToReceiveAudio===!1&&O?O.direction==="sendrecv"?O.setDirection?O.setDirection("sendonly"):O.direction="sendonly":O.direction==="recvonly"&&(O.setDirection?O.setDirection("inactive"):O.direction="inactive"):A.offerToReceiveAudio!==!0||O||this.addTransceiver("audio",{direction:"recvonly"}),A.offerToReceiveVideo!==void 0&&(A.offerToReceiveVideo=!!A.offerToReceiveVideo);const F=this.getTransceivers().find((V=>V.receiver.track.kind==="video"));A.offerToReceiveVideo===!1&&F?F.direction==="sendrecv"?F.setDirection?F.setDirection("sendonly"):F.direction="sendonly":F.direction==="recvonly"&&(F.setDirection?F.setDirection("inactive"):F.direction="inactive"):A.offerToReceiveVideo!==!0||F||this.addTransceiver("video",{direction:"recvonly"})}return E.apply(this,arguments)}}function ve(M){typeof M!="object"||M.AudioContext||(M.AudioContext=M.webkitAudioContext)}var xe=i(7963),pe=i.n(xe);function ze(M){if(!M.RTCIceCandidate||M.RTCIceCandidate&&"foundation"in M.RTCIceCandidate.prototype)return;const E=M.RTCIceCandidate;M.RTCIceCandidate=function(A){if(typeof A=="object"&&A.candidate&&A.candidate.indexOf("a=")===0&&((A=JSON.parse(JSON.stringify(A))).candidate=A.candidate.substring(2)),A.candidate&&A.candidate.length){const O=new E(A),F=pe().parseCandidate(A.candidate);for(const V in F)V in O||Object.defineProperty(O,V,{value:F[V]});return O.toJSON=function(){return{candidate:O.candidate,sdpMid:O.sdpMid,sdpMLineIndex:O.sdpMLineIndex,usernameFragment:O.usernameFragment}},O}return new E(A)},M.RTCIceCandidate.prototype=E.prototype,m(M,"icecandidate",(A=>(A.candidate&&Object.defineProperty(A,"candidate",{value:new M.RTCIceCandidate(A.candidate),writable:"false"}),A)))}function Je(M){!M.RTCIceCandidate||M.RTCIceCandidate&&"relayProtocol"in M.RTCIceCandidate.prototype||m(M,"icecandidate",(E=>{if(E.candidate){const A=pe().parseCandidate(E.candidate.candidate);A.type==="relay"&&(E.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[A.priority>>24])}return E}))}function Xe(M,E){if(!M.RTCPeerConnection)return;"sctp"in M.RTCPeerConnection.prototype||Object.defineProperty(M.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const A=M.RTCPeerConnection.prototype.setRemoteDescription;M.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,E.browser==="chrome"&&E.version>=76){const{sdpSemantics:O}=this.getConfiguration();O==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if((function(O){if(!O||!O.sdp)return!1;const F=pe().splitSections(O.sdp);return F.shift(),F.some((V=>{const K=pe().parseMLine(V);return K&&K.kind==="application"&&K.protocol.indexOf("SCTP")!==-1}))})(arguments[0])){const O=(function(me){const ce=me.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(ce===null||ce.length<2)return-1;const de=parseInt(ce[1],10);return de!=de?-1:de})(arguments[0]),F=(function(me){let ce=65536;return E.browser==="firefox"&&(ce=E.version<57?me===-1?16384:2147483637:E.version<60?E.version===57?65535:65536:2147483637),ce})(O),V=(function(me,ce){let de=65536;E.browser==="firefox"&&E.version===57&&(de=65535);const we=pe().matchPrefix(me.sdp,"a=max-message-size:");return we.length>0?de=parseInt(we[0].substring(19),10):E.browser==="firefox"&&ce!==-1&&(de=2147483637),de})(arguments[0],O);let K;K=F===0&&V===0?Number.POSITIVE_INFINITY:F===0||V===0?Math.max(F,V):Math.min(F,V);const ue={};Object.defineProperty(ue,"maxMessageSize",{get:()=>K}),this._sctp=ue}return A.apply(this,arguments)}}function et(M){if(!M.RTCPeerConnection||!("createDataChannel"in M.RTCPeerConnection.prototype))return;function E(O,F){const V=O.send;O.send=function(){const K=arguments[0],ue=K.length||K.size||K.byteLength;if(O.readyState==="open"&&F.sctp&&ue>F.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+F.sctp.maxMessageSize+" bytes)");return V.apply(O,arguments)}}const A=M.RTCPeerConnection.prototype.createDataChannel;M.RTCPeerConnection.prototype.createDataChannel=function(){const O=A.apply(this,arguments);return E(O,this),O},m(M,"datachannel",(O=>(E(O.channel,O.target),O)))}function Ut(M){if(!M.RTCPeerConnection||"connectionState"in M.RTCPeerConnection.prototype)return;const E=M.RTCPeerConnection.prototype;Object.defineProperty(E,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(E,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(A){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),A&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=A)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((A=>{const O=E[A];E[A]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=F=>{const V=F.target;if(V._lastConnectionState!==V.connectionState){V._lastConnectionState=V.connectionState;const K=new Event("connectionstatechange",F);V.dispatchEvent(K)}return F},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),O.apply(this,arguments)}}))}function gt(M,E){if(!M.RTCPeerConnection||E.browser==="chrome"&&E.version>=71||E.browser==="safari"&&E.version>=605)return;const A=M.RTCPeerConnection.prototype.setRemoteDescription;M.RTCPeerConnection.prototype.setRemoteDescription=function(O){if(O&&O.sdp&&O.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const F=O.sdp.split(`
`).filter((V=>V.trim()!=="a=extmap-allow-mixed")).join(`
`);M.RTCSessionDescription&&O instanceof M.RTCSessionDescription?arguments[0]=new M.RTCSessionDescription({type:O.type,sdp:F}):O.sdp=F}return A.apply(this,arguments)}}function At(M,E){if(!M.RTCPeerConnection||!M.RTCPeerConnection.prototype)return;const A=M.RTCPeerConnection.prototype.addIceCandidate;A&&A.length!==0&&(M.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(E.browser==="chrome"&&E.version<78||E.browser==="firefox"&&E.version<68||E.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():A.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Ce(M,E){if(!M.RTCPeerConnection||!M.RTCPeerConnection.prototype)return;const A=M.RTCPeerConnection.prototype.setLocalDescription;A&&A.length!==0&&(M.RTCPeerConnection.prototype.setLocalDescription=function(){let O=arguments[0]||{};if(typeof O!="object"||O.type&&O.sdp)return A.apply(this,arguments);if(O={type:O.type,sdp:O.sdp},!O.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":O.type="offer";break;default:O.type="answer"}return O.sdp||O.type!=="offer"&&O.type!=="answer"?A.apply(this,[O]):(O.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((F=>A.apply(this,[F])))})}(function({window:M}={},E={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const A=S,O=(function(V){const K={browser:null,version:null};if(V===void 0||!V.navigator||!V.navigator.userAgent)return K.browser="Not a browser.",K;const{navigator:ue}=V;if(ue.mozGetUserMedia)K.browser="firefox",K.version=p(ue.userAgent,/Firefox\/(\d+)\./,1);else if(ue.webkitGetUserMedia||V.isSecureContext===!1&&V.webkitRTCPeerConnection)K.browser="chrome",K.version=p(ue.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!V.RTCPeerConnection||!ue.userAgent.match(/AppleWebKit\/(\d+)\./))return K.browser="Not a supported browser.",K;K.browser="safari",K.version=p(ue.userAgent,/AppleWebKit\/(\d+)\./,1),K.supportsUnifiedPlan=V.RTCRtpTransceiver&&"currentDirection"in V.RTCRtpTransceiver.prototype}return K})(M),F={browserDetails:O,commonShim:l,extractVersion:p,disableLog:_,disableWarnings:v,sdp:xe};switch(O.browser){case"chrome":if(!o||!Y||!E.shimChrome)return A("Chrome shim is not included in this adapter release."),F;if(O.version===null)return A("Chrome shim can not determine version, not shimming."),F;A("adapter.js shimming chrome."),F.browserShim=o,At(M,O),Ce(M),U(M,O),$(M),Y(M,O),I(M),G(M,O),L(M),P(M),H(M),J(M,O),ze(M),Je(M),Ut(M),Xe(M,O),et(M),gt(M,O);break;case"firefox":if(!a||!ee||!E.shimFirefox)return A("Firefox shim is not included in this adapter release."),F;A("adapter.js shimming firefox."),F.browserShim=a,At(M,O),Ce(M),Q(M,O),ee(M,O),q(M),Ee(M),te(M),ie(M),Re(M),Te(M),Pe(M),We(M),it(M),ze(M),Ut(M),Xe(M,O),et(M);break;case"safari":if(!c||!E.shimSafari)return A("Safari shim is not included in this adapter release."),F;A("adapter.js shimming safari."),F.browserShim=c,At(M,O),Ce(M),De(M),ae(M),re(M),ht(M),vt(M),Oe(M),Le(M),ve(M),ze(M),Je(M),Xe(M,O),et(M),gt(M,O);break;default:A("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),i(8630);const se=()=>typeof RTCPeerConnection=="function";var W,oe;(function(M){M[M.TRACE=0]="TRACE",M[M.DEBUG=1]="DEBUG",M[M.INFO=2]="INFO",M[M.WARN=3]="WARN",M[M.ERROR=4]="ERROR",M[M.SILENT=5]="SILENT"})(W||(W={})),(function(M){M.TIME="Time",M.WEBRTC="WebRTC",M.EMITTER="Emitter",M.MEDIA="Media",M.SUBSCRIPTION="StageSubscription",M.PUBLICATION="StagePublication",M.CONNECTION="StageConnection",M.SOCKET="StageSocket",M.BROADCAST_STAGE_CLIENT="BroadcastStageClient",M.STAGE="Stage",M.REMOTE_PARTICIPANT="RemoteParticipant",M.LOCAL_PARTICIPANT="LocalParticipant",M.CONFIGURATION="Configuration",M.REMOTE_PLAYBACK="RemotePlaybackController",M.REMOTE_STAGE_STREAM="RemoteStageStream"})(oe||(oe={}));const Se=12e4,Ae=3e5,ye="no-rid";class _e extends Error{constructor({name:E,message:A,code:O,details:F,cause:V,params:K}){super(A),Error.captureStackTrace&&Error.captureStackTrace(this,_e),this.name=E||"BroadcastClientError",this.message=A,this.code=O,this.details=F,this.cause=V,this.params=K}}const Ye={name:"BroadcastError",code:1e3,message:"Unable to broadcast"},ke={name:"CameraError",code:2e3,message:"Camera could not be captured"},Ve={name:"InputError",code:3e3,message:"Input could not be attached"},Fe={name:"AddDeviceError",code:4e3,message:"Device is missing"},Ge={name:"AddDeviceNameExistsError",code:4001,message:"Name is already registered"},at={name:"AddDeviceCompositionMissingError",code:4002,message:"VideoComposition is missing"},Be={name:"AddDeviceCompositionIndexMissingError",code:4003,message:`VideoComposition's "index" property is missing`},tt={name:"AddDeviceNameMissingError",code:4004,message:"Name property is missing"},rt={name:"AddDeviceUnsupported",code:4005,message:"Unsupported device"},xt={name:"AddDeviceConstraintsError",code:4006,message:"Constraints error"},ot={name:"RemoveDeviceNotFoundError",code:5e3,message:"Device not found"},tn={name:"RemoveImageNotFoundError",code:6e3,message:"Image not found"},ln={name:"UpdateVideoDeviceCompositionMissingError",code:7e3,message:"VideoComposition is missing"},Rt={name:"UpdateVideoDeviceCompositionIndexMissingError",code:7001,message:`VideoComposition's "index" property is missing`},$t={name:"UpdateVideoDeviceCompositionNameMissingError",code:7002,message:"Video device with that name is not found"},mt={name:"ExchangePositionDeviceNotFoundError",code:8e3,message:"Device with that name is not found"},Zt={name:"FailedToAddImageError",code:9e3,message:"Failed to add image"},wn={name:"PeerSetupError",code:1e4,message:"Unexpected return value from setup request"},qt={name:"PeerConnectionError",code:10001,message:"Peer connection has failed."},An={name:"InvalidStreamKey",code:10003,message:"Invalid Stream Key."},Ln={name:"BroadcastConfigurationError",code:11e3,message:"Error when configuring broadcast client"},mr={name:"StreamConfigurationError",code:12e3,message:"Error when configuring stream"},is={name:"IngestEndpointTypeError",code:13e3,message:"Ingest endpoint must be a string"},hi={name:"IngestEndpointUrlError",code:13001,message:"Ingest endpoint must be a valid https or rtmps URL"},ti={name:"LogLevelTypeError",code:14e3,message:"Log Level must be a valid integer between [0..5]"},ji={name:"LoggerTypeError",code:15e3,message:"Logger must be an object"},ss={name:"ClientInvalidError",code:16e3,message:"Client is no longer valid, possibly due to delete() invocation."},Yi={name:"NetworkReconnectConfigurationError",code:17e3,message:"Error when configuring network reconnect"},os={name:"NetworkReconnectConfigurationInvalidTimeoutError",code:17001,message:"Network reconnect timeout value must be a number between [10000, 300000]"},as={name:"StreamKeyInvalidCharError",code:18e3,message:"Streamkey must contain only [A-Za-z0-9_-] characters"},je={name:"StageTokenTypeError",code:19e3,message:"Stage token must be a string"},_t={name:"StageWhipUrlOverrideError",code:19001,message:"Stage WHIP override URL must be a string starting with http"};var Ot,Lt,yt,an,On,_n,Pn,er,fr,Cn=function(M,E,A,O){if(typeof E=="function"?M!==E||!O:!E.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?O:A==="a"?O.call(M):O?O.value:E.get(M)},yr=function(M,E,A,O,F){if(typeof E=="function"?M!==E||!0:!E.has(M))throw new TypeError("Cannot write private member to an object whose class did not declare it");return E.set(M,A),A};const Vr=1920,ms=1080,Lr=W.ERROR,Gr={maxResolution:{width:852,height:480},maxFramerate:30,maxBitrate:1500},or={maxResolution:{width:480,height:852},maxFramerate:30,maxBitrate:1500},br={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:3500},Un={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:3500},bi={maxResolution:{width:1920,height:1080},maxFramerate:30,maxBitrate:8500},ai={maxResolution:{width:1080,height:1920},maxFramerate:30,maxBitrate:8500},Rs={reconnect:!1,timeout:Se};function ho(M){var E,A;if(typeof M!="string"&&M!==void 0)throw new _e(is);if(M){if(M.startsWith("https"))return M;{const O=/(?<protocol>(rtmps|https):\/\/)?(?<id>.+)\.(?<environment>(?=\S*['-])([a-zA-Z'-]+))\.live-video\.net.*/.exec(M);if(((E=O?.groups)===null||E===void 0?void 0:E.protocol)==="rtmps"&&console.warn("rtmps server url detected; please pass in the ingest endpoint (no rtmps:// protocol) instead"),(A=O?.groups)===null||A===void 0?void 0:A.id)return`https://${O.groups.id}.webrtc.live-video.net:4443`;throw new _e(hi)}}return""}class Mi{constructor(E,A,O=Gr,F,V=Rs){this.LOG_LEVEL=W,this.BASIC_LANDSCAPE=Gr,this.BASIC_PORTRAIT=or,this.BASIC_FULL_HD_LANDSCAPE=br,this.BASIC_FULL_HD_PORTRAIT=Un,this.STANDARD_LANDSCAPE=bi,this.STANDARD_PORTRAIT=ai,Ot.set(this,void 0),Lt.set(this,void 0),yt.set(this,Gr),an.set(this,void 0),On.set(this,Rs),_n.set(this,(K=>{if(!K)throw new _e(Object.assign(Object.assign({},mr),{details:"missing stream configuration"}));if(!(K.maxBitrate<=8500&&K.maxBitrate>=200))throw new _e(Object.assign(Object.assign({},mr),{details:"maxBitrate must be between 200 and 8500"}));if(!(K.maxFramerate<=60&&K.maxFramerate>=10))throw new _e(Object.assign(Object.assign({},mr),{details:"maxFramerate must be between 10 and 60"}));const ue=K.maxResolution.width,me=K.maxResolution.height;if(ue>Vr||me>Vr||ue<160||me<160||ue===Vr&&me>ms||me===Vr&&ue>ms)throw new _e(Object.assign(Object.assign({},mr),{details:"maxResolution values must be between 1080x1920 or 1920x1080"}))})),Pn.set(this,(K=>{if(!K)return;const ue=Number(K),me=Number.isInteger(ue),ce=ue>=W.TRACE,de=ue<=W.SILENT;if(!me||!ce||!de)throw new _e(ti)})),er.set(this,(K=>{if(K&&typeof K!="object")throw new _e(ji)})),fr.set(this,(K=>{if(!K)return;if(typeof K!="object"||typeof K.reconnect!="boolean")throw new _e(Yi);const{timeout:ue}=K;if(ue!==void 0&&(Number.isNaN(ue)||typeof ue!="number"||ue<1e4||ue>Ae))throw new _e(os)})),Cn(this,er,"f").call(this,F),Cn(this,Pn,"f").call(this,A),Cn(this,_n,"f").call(this,O),yr(this,Ot,E),yr(this,Lt,A),yr(this,yt,O),yr(this,an,F),yr(this,On,V)}get ingestEndpoint(){return Cn(this,Ot,"f")}set ingestEndpoint(E){yr(this,Ot,ho(E))}get streamConfig(){return Cn(this,yt,"f")}set streamConfig(E){Cn(this,_n,"f").call(this,E),yr(this,yt,E)}get logLevel(){return Cn(this,Lt,"f")}set logLevel(E){Cn(this,Pn,"f").call(this,E),yr(this,Lt,E)}get logger(){return Cn(this,an,"f")}set logger(E){Cn(this,er,"f").call(this,E),yr(this,an,E)}get networkReconnectConfig(){return Cn(this,On,"f")}set networkReconnectConfig(E){Cn(this,fr,"f").call(this,E),yr(this,On,E)}}Ot=new WeakMap,Lt=new WeakMap,yt=new WeakMap,an=new WeakMap,On=new WeakMap,_n=new WeakMap,Pn=new WeakMap,er=new WeakMap,fr=new WeakMap;var Mn,Li=i(228);(function(M){M.PUBLISHED_VIDEO_STATS="ivs_broadcast_webrtc_published_video_stats",M.PUBLISHED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_published_video_stats_window",M.PUBLISHED_AUDIO_STATS="ivs_broadcast_webrtc_published_audio_stats",M.PUBLISHED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_published_audio_stats_window",M.SUBSCRIBED_VIDEO_STATS="ivs_broadcast_webrtc_subscribed_video_stats",M.SUBSCRIBED_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_video_stats_window",M.SUBSCRIBED_AUDIO_STATS="ivs_broadcast_webrtc_subscribed_audio_stats",M.SUBSCRIBED_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_sbcrbd_audio_stats_window",M.PUBLISH="ivs_broadcast_multihost_publish",M.UNPUBLISH="ivs_broadcast_multihost_unpublish",M.SUBSCRIBE="ivs_broadcast_multihost_subscribe",M.UNSUBSCRIBE="ivs_broadcast_multihost_unsubscribe",M.PUBLISH_STARTED="ivs_broadcast_multihost_publish_started",M.PUBLISH_FAILED="ivs_broadcast_multihost_publish_failed",M.PUBLISH_ENDED="ivs_broadcast_multihost_publish_ended",M.STATE_UPDATED="ivs_broadcast_multihost_event_state_updated",M.SUBSCRIBE_STARTED="ivs_broadcast_multihost_subscribe_started",M.SUBSCRIBE_FAILED="ivs_broadcast_multihost_subscribe_failed",M.SUBSCRIBE_ENDED="ivs_broadcast_multihost_subscribe_ended",M.FIRST_FRAME="ivs_broadcast_multihost_first_frame",M.JOIN="ivs_broadcast_multihost_join",M.JOIN_ATTEMPT="ivs_broadcast_multihost_event_connect_attempt",M.JOIN_ATTEMPT_FAILED="ivs_broadcast_multihost_event_connect_failed",M.JOIN_ENDED="ivs_broadcast_multihost_join_ended",M.LEAVE="ivs_broadcast_multihost_leave",M.REASSIGNMENT_REQUEST="ivs_broadcast_multihost_reassignment_request",M.SERVER_REQUEST="ivs_broadcast_multihost_server_request",M.TRACE="ivs_broadcast_stage_trace",M.ERROR="ivs_broadcast_error",M.MINUTE="ivs_broadcast_multihost_minute",M.CONNECTION_STATE="ivs_broadcast_webrtc_connection_state",M.ICE_GATHERING_STATE="ivs_broadcast_webrtc_gathering_state",M.EDP_CONNECTED="ivs_broadcast_multihost_event_connected",M.EDP_DISCONNECTED="ivs_broadcast_multihost_event_disconnected",M.EDP_PONG="ivs_broadcast_multihost_edp_rtt",M.SIMULCAST_LAYER_INFO="ivs_broadcast_simulcast_layer_info",M.MULTIHOST_CONFIGURATION="ivs_broadcast_multihost_configuration",M.MULTIHOST_SUBSCRIBE_CONFIGURATION="ivs_broadcast_multihost_subscribe_configuration",M.PLAYBACK_LAYER_REQUEST="ivs_broadcast_multihost_playback_layer_request",M.PLAYBACK_LAYER_STATE="ivs_broadcast_multihost_playback_layer_state",M.SELECTED_PAIR_CHANGE="ivs_broadcast_webrtc_selected_pair_change",M.ANALYTICS_HEALTH_REPORT="ivs_broadcast_analytics_health_report",M.DEVCONF_ERROR="ivs_devconf_error",M.DEVCONF_OPS_METRICS="ivs_devconf_ops_metrics",M.DEVCONF_TRACE="ivs_devconf_trace",M.DEVCONF_VALUE="ivs_devconf_value",M.DEVCONF_ROLLOUT_ASSIGNMENT="ivs_devconf_rollout_assignment"})(Mn||(Mn={}));class Kn{constructor(E,A,O,F){this.event=E,this.properties={client_time:new Date().toISOString(),customer_id:A.customerId,device_software:window.navigator.userAgent,multihost_id:A.stageARN,participant_id:A.participantID,participant_user_id:A.userID,platform:"web",sdk_version:"1.31.1",stage_arn:A.stageARN,trace_id:O.value},A.attrGsRole&&(this.properties.token_attribute_0=A.attrGsRole),A.attrGsSessionId&&(this.properties.token_attribute_1=A.attrGsSessionId),this.critical=F}}class gs extends Kn{constructor(E){super(Mn.ERROR,E.token,E.traceId,!0),Object.assign(this.properties,{code:E.code,tag:E.tag,description:E.message,remote_participant_id:E.remoteParticipantId,request_uuid:E.requestUUID,is_nominal:E.nominal,is_fatal:E.fatal,details:E.details,location:E.location,event_count:E.count})}}function pl(M){const E=window.IVS_CLIENT_OVERRIDES;return typeof E=="object"?E[M]:M==="logLevel"?window.STAGES_LOG_LEVEL:M==="appLabel"?window.IVS_APP_LABEL:M==="whipUrl"?window.IVS_DATA_PLANE_ENDPOINT:void 0}function _s(M){const E=pl(M);if(typeof E=="string")return E}function Gc(M){const E=pl(M);if(typeof E=="boolean")return E}function Sg(M){const E=pl(M);if(typeof E=="number")return E;if(typeof E=="string"){const A=parseFloat(E);if(!isNaN(A))return A}}function v_(){const M=pl("logLevel");if(typeof M=="number"&&Object.values(W).includes(M))return M}function y_(){const M=_s("appLabel");if(M!==void 0)return M.substring(0,64)}function b_(){return Gc("disableXdp")}function Pp(){return Gc("preferMainProfile")}function ba(){return Gc("enableInitialLayerOnSdp")}function V1(){return Gc("disableAudioRtcpRsize")}var Wc=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};function uy(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(M=>{const E=16*Math.random()|0;return(M==="x"?E:3&E|8).toString(16)}))}function S_(M,E=A=>{}){Wc(this,void 0,void 0,(function*(){try{yield M()}catch(A){E(A)}}))}var ml=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};function Dp(M,E,A={},O=""){return ml(this,void 0,void 0,(function*(){const F=new XMLHttpRequest;return F.open(M,E,!0),A&&Object.keys(A).forEach((V=>{A.hasOwnProperty(V)&&F.setRequestHeader(V,A[V])})),new Promise(((V,K)=>{F.onreadystatechange=()=>{F.readyState===4&&(F.status>=200&&F.status<300?V(F.responseText):K(new Error(`Ingest ${M} ${E} responded ${F.status}
${F.responseText}`)))},F.send(O)}))}))}function Eg(M){const E=Date.now();for(const O of M)O.properties.batch_time_millis=E;var A;return{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:`data=${A=JSON.stringify(M),btoa(encodeURIComponent(A).replace(/%([0-9A-F]{2})/g,((O,F)=>String.fromCharCode(+`0x${F}`))))}`}}class Ss{send(E,A=!1){return ml(this,void 0,void 0,(function*(){const{currentEndpoint:O}=Do,{headers:F,body:V}=Eg(E),K="eventSenderResult",ue=E.length;if(A){const me=navigator.sendBeacon(O,V);Do.trackEvent({type:K,success:me,count:ue})}else S_((()=>ml(this,void 0,void 0,(function*(){yield Dp("POST",O,F,V),Do.trackEvent({type:K,success:!0,count:ue})}))),(()=>{Do.trackEvent({type:K,success:!1,count:ue})}))}))}}var bc=i(2505),Tf=i.n(bc);const Sc={CONNECTION_STATE_CHANGE:"connectionStateChange",ERROR:"clientError",ACTIVE_STATE_CHANGE:"activeStateChange"},qc="connectionStateChange",wf="sdpNegotiated",Ou="clientError",Lh="seiMessageReceived",Ec="transformError";var hr;(function(M){M.CLOSED="closed",M.COMPLETED="completed",M.CONNECTED="connected",M.CONNECTING="connecting",M.DISCONNECTED="disconnected",M.FAILED="failed",M.IDLE="idle",M.NEW="new",M.NONE="none"})(hr||(hr={}));var xg=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};function hy(M,E){return xg(this,void 0,void 0,(function*(){M.validateStatus=O=>O>=200&&O<300||O===403;const A=yield Tf()(M);if(A.status===403){if(A.data.code===2003)throw new bc.AxiosError("Request failed with status code 403","ERR_BAD_REQUEST",M,A.request,A);return M.url===A.request.responseURL?(M.validateStatus=O=>O>=200&&O<300,Tf()(M)):(M.url=A.request.responseURL,E<5?hy(M,E+1):(M.validateStatus=O=>O>=200&&O<300,Tf()(M)))}return A}))}function E_(M){return xg(this,void 0,void 0,(function*(){return hy(M,0)}))}function Uh(){}function x_(M){switch(M){case"new":return hr.NEW;case"closed":return hr.CLOSED;case"disconnected":return hr.DISCONNECTED;case"failed":return hr.FAILED;case"idle":return hr.IDLE;case"checking":case"connecting":return hr.CONNECTING;case"completed":case"connected":return hr.CONNECTED;default:throw new Error(`unknown connecion state: ${M}`)}}function Tg(M,E,A){let O=document.createElement(E);const F=()=>{O&&(O.removeEventListener("loadeddata",V),O.removeEventListener("error",F),O.srcObject=null,O.src="",O=null)},V=()=>{F(),A(E)};return O.addEventListener("loadeddata",V),O.addEventListener("error",F),O.srcObject=M,F}class Da{constructor(){this.emitter=new Li}hasListenersFor(E){return this.emitter.listenerCount(E)>0}on(E,A,O){A.call=(function(F,V){return function(K,...ue){try{V.apply(K,ue)}catch(me){let ce=`Error in callback for ${F}`;const de=V.name;return de&&(ce+=` for function ${de}`),void console.error(`${ce}
`,me)}}})(E,A),this.emitter.on(E,A,O)}off(E,A,O){this.emitter.off(E,A,O)}emit(E,...A){this.emitter.emit(E,...A)}removeAllListeners(){this.emitter.removeAllListeners()}}const wg="https://broadcast.stats.live-video.net/";class xc{constructor({totalEvents:E,totalEventsLost:A,windowedEvents:O,windowedEventsLost:F,currentEndpoint:V}){this.transformProperties=(ue,me,ce,de,we)=>({total_events:ue,total_events_lost:me,windowed_events:ce,windowed_events_lost:de,current_endpoint:we??wg});const K=this.transformProperties(E,A,O,F,V);this.data={event:Mn.ANALYTICS_HEALTH_REPORT,properties:Object.assign({},K)}}}const T_={totalEvents:0,totalEventsSent:0,totalEventsLost:0,windowedEvents:0,windowedEventsSent:0,windowedEventsLost:0};var Nu,fo;(function(M){M.ANALYTICS_EVENT="ANALYTICS_EVENT"})(Nu||(Nu={}));class fy extends Da{constructor(){super(),this.eventSenderMetrics=Object.assign({},T_),this.scheduleHealthReport=()=>{this.reportTimer=window.setTimeout(this.onHealthReportInterval,6e4)},this.onHealthReportInterval=()=>{const E=Object.assign({},this.eventSenderMetrics);if(this.eventSenderMetrics.windowedEvents===0?this.emptyWindows++:this.emptyWindows=0,this.emptyWindows>3)return window.clearTimeout(this.reportTimer),void(this.reportTimer=void 0);this.postHealthReport(E),this.eventSenderMetrics.windowedEvents=0,this.eventSenderMetrics.windowedEventsSent=0,this.eventSenderMetrics.windowedEventsLost=0,this.scheduleHealthReport()},this.emptyWindows=0}trackEventSendResult(E){const{count:A,success:O}=E;this.eventSenderMetrics.totalEvents+=A,this.eventSenderMetrics.windowedEvents+=A,O?(this.eventSenderMetrics.totalEventsSent+=A,this.eventSenderMetrics.windowedEventsSent+=A):(this.eventSenderMetrics.totalEventsLost+=A,this.eventSenderMetrics.windowedEventsLost+=A),this.isHealthReportScheduled()||this.scheduleHealthReport()}isHealthReportScheduled(){return typeof this.reportTimer=="number"}postHealthReport(E){const A=new xc(E);this.emit(Nu.ANALYTICS_EVENT,A)}}(function(M){M[M.EXCELLENT=4]="EXCELLENT",M[M.GOOD=3]="GOOD",M[M.NORMAL=2]="NORMAL",M[M.POOR=1]="POOR",M[M.DOWN=0]="DOWN"})(fo||(fo={}));var w_,gl,ks,Qo;(function(M){M.NETWORK_QUALITY_CHANGE="networkQualityChange"})(w_||(w_={}));class dy extends Da{constructor(){super(),this.lastNetworkStatus={},this.networkAssessment={networkQuality:fo.NORMAL,reason:"no-data"},this.checkNetworkStatus=()=>{var E,A;const O=(E=navigator?.connection)!==null&&E!==void 0?E:{},F={downlink:O.downlink,effectiveType:O.effectiveType,rtt:O.rtt,isOnline:(A=navigator.onLine)===null||A===void 0||A};if(!this.isChangedNetworkStatus(this.lastNetworkStatus,F))return;this.lastNetworkStatus=F;const V=this.networkAssessment,K=(function(ue){const{rtt:me,downlink:ce,isOnline:de}=ue;if(!de)return{networkQuality:fo.DOWN,reason:"offline"};if(typeof me!="number"||typeof ce!="number")return{networkQuality:fo.NORMAL,reason:"no-data"};let we=0;me>800?we+=2:me>300&&(we+=1),ce<2.5?we+=2:ce<5&&(we+=1);const Me="score";switch(we){case 4:return{networkQuality:fo.POOR,reason:Me};case 0:return{networkQuality:fo.EXCELLENT,reason:Me};default:return{networkQuality:we<=2?fo.GOOD:fo.NORMAL,reason:Me}}})(F);V.networkQuality!==K.networkQuality&&this.emit(w_.NETWORK_QUALITY_CHANGE,V.networkQuality,K.networkQuality),this.networkAssessment=K},this.getNetworkQuality=()=>this.networkAssessment.networkQuality,this.setupWindowListeners(),this.checkNetworkStatus()}setupWindowListeners(){window.addEventListener("online",(()=>{this.checkNetworkStatus()})),window.addEventListener("offline",(()=>{this.checkNetworkStatus()})),window.navigator.connection&&window.navigator.connection.addEventListener("change",(()=>{this.checkNetworkStatus()}))}isChangedNetworkStatus(E,A){const{downlink:O,effectiveType:F,rtt:V,isOnline:K}=A;return E.effectiveType!==F||E.downlink!==O||E.rtt!==V||E.isOnline!==K}}(function(M){M.ANALYTICS_EVENT="ANALYTICS_EVENT",M.REFRESH="REFRESH"})(gl||(gl={})),(function(M){M.IDLE="idle",M.ACTIVATING="activating",M.ACTIVE="active",M.REFRESHING="refreshing",M.PAUSED="paused",M.DESTROYED="destroyed"})(ks||(ks={})),(function(M){M.INITIALIZE="initialize",M.REFRESH="refresh",M.ACTIVATE="activate",M.PAUSE="pause",M.DESTROY="destroy"})(Qo||(Qo={}));const H1={[Qo.INITIALIZE]:{from:[ks.IDLE],to:ks.ACTIVATING},[Qo.REFRESH]:{from:[ks.ACTIVATING,ks.ACTIVE,ks.PAUSED],to:ks.REFRESHING},[Qo.ACTIVATE]:{from:[ks.ACTIVATING,ks.REFRESHING,ks.PAUSED],to:ks.ACTIVE},[Qo.PAUSE]:{from:[ks.REFRESHING,ks.ACTIVE],to:ks.PAUSED},[Qo.DESTROY]:{from:[ks.ACTIVE,ks.PAUSED],to:ks.DESTROYED}};var Xl,Po;(function(M){M.STAGE_CONFIGURATION="stage_configuration",M.STAGE_SUBSCRIBE_CONFIGURATION="stage_subscribe_configuration",M.STAGE_LOCAL_STREAM_CONFIGURATION="stage_local_stream_configuration",M.BROADCAST_CONFIGURATION="broadcast_configuration"})(Xl||(Xl={})),(function(M){M.RT="real_time",M.LL="low_latency"})(Po||(Po={}));var $s,_l,Sa,xn=i(8954);class py{constructor(E,A){this.transformProperties=(F,V)=>({sum:F.sum,median:F.median(),min:F.min,max:F.max,p90:F.percentile(.9),event_count:F.data.length,period:V});const O=this.transformProperties(E,A);this.data={event:$s.CONGESTION_TIME,properties:O}}}class Ag{constructor(E,A,O){this.transformProperties=(V,K,ue)=>({duration:(V.getTime()-(K?.getTime()||0))/1e3,ecn_negotiated:!1,ingest_session_id:ue});const F=this.transformProperties(E,A,O);this.data={event:$s.CONNECTION_ESTABLISHED,properties:F}}}class Bt{constructor(E,A){this.transformProperties=(F,V)=>({sum:F.sum,median:F.median(),min:F.min,max:F.max,p90:F.percentile(.9),event_count:F.data.length,period:V});const O=this.transformProperties(E,A);this.data={event:$s.CONNECTION_RTT,properties:O}}}class en{constructor(E){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_ERROR,properties:E}}}class sn{constructor(E){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_OPS_METRICS,properties:E}}}class $n{constructor(E){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_ROLLOUT_ASSIGNMENT,properties:E}}}class kr{constructor(E){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_TRACE,properties:E}}}class Si{constructor(E){this.transformProperties=()=>({}),this.data={event:Mn.DEVCONF_VALUE,properties:E}}}class po{constructor(E){this.transformProperties=O=>{var F;return{is_fatal:(F=O.isFatal)!==null&&F!==void 0&&F,value:O.value,code:O.code,description:O.description}};const A=this.transformProperties(E);this.data={event:$s.ERROR,properties:A}}}class Zl{constructor(E,A){this.transformProperties=(F,V)=>({type:F,input_device_id:V.deviceId,position:V.facingMode||"unknown"});const O=this.transformProperties(E,A);this.data={event:$s.INPUT_DEVICE_ATTACHED,properties:O}}}class Wr{constructor(E,A){this.transformProperties=(F,V)=>({type:F,input_device_id:V.deviceId,position:V.facingMode||"unknown"});const O=this.transformProperties(E,A);this.data={event:$s.INPUT_DEVICE_DETACHED,properties:O}}}class A_{constructor(E,A){this.transformProperties=(F,V)=>({sum:F.sum,median:F.median(),min:F.min,max:F.max,p90:F.percentile(.9),event_count:F.data.length,period:V});const O=this.transformProperties(E,A);this.data={event:$s.MEASURED_BITRATE,properties:O}}}class G1{constructor(E,A){this.transformProperties=(F,V)=>({minutes_logged:Math.round((F.timestamp-V)/6e4)});const O=this.transformProperties(E,A);this.data={event:$s.MINUTE_BROADCAST,properties:O}}}class Yc{constructor(E,A){this.transformProperties=(F,V)=>({sum:F.sum,median:F.median(),min:F.min,max:F.max,p90:F.percentile(.9),event_count:F.data.length,period:V});const O=this.transformProperties(E,A);this.data={event:$s.RECOMMENDED_BITRATE,properties:O}}}class Cg{constructor(E){this.transformProperties=O=>({codec:O.mimeType,bitrate:0,sample_rate:O.clockRate,channel_count:O.channels});const A=this.transformProperties(E);this.data={event:$s.SESSION_AUDIO_ENCODER_CONFIGURED,properties:A}}}class Rg{constructor(E){this.transformProperties=O=>({codec:"audio",bitrate:32e3,sample_rate:O.sampleRate,channel_count:O.channelCount});const A=this.transformProperties(E);this.data={event:$s.SESSION_AUDIO_PROPERTIES,properties:A}}}class Ed{constructor(E,A,O){this.transformProperties=(V,K,ue)=>({codec:ue.mimeType,codec_profile:K.profile,codec_level:K.level,rate_mode:"vbr",initial_bitrate:0,keyframe_interval:2,width:V.width,height:V.height,bframe_count:0,target_fps:V.frameRate});const F=this.transformProperties(E,A,O);this.data={event:$s.SESSION_VIDEO_ENCODER_CONFIGURED,properties:F}}}class xd{constructor(E){this.transformProperties=O=>({codec:"video",initial_bitrate:32e3,min_bitrate:0,max_bitrate:0,keyframe_interval:2,width:O.width,height:O.height,auto_bitrate_enabled:!0,bframes_enabled:!1,target_fps:O.frameRate});const A=this.transformProperties(E);this.data={event:$s.SESSION_VIDEO_PROPERTIES,properties:A}}}class kg{constructor(E,A){this.transformProperties=(F,V)=>({sum:F.sum,median:F.median(),min:F.min,max:F.max,p90:F.percentile(.9),event_count:F.data.length,period:V});const O=this.transformProperties(E,A);this.data={event:$s.SOURCE_AUDIO_LATENCY,properties:O}}}class Ki{constructor(E,A){this.transformProperties=(F,V)=>({sum:F.sum,median:F.median(),min:F.min,max:F.max,p90:F.percentile(.9),event_count:F.data.length,period:V});const O=this.transformProperties(E,A);this.data={event:$s.SOURCE_VIDEO_LATENCY,properties:O}}}class Mg{constructor(E,A){this.transformProperties=({protocol:F,hostname:V,port:K},ue)=>({protocol:F,endpoint_host:V,endpoint_port:K,reason:ue});const O=this.transformProperties(E,A);this.data={event:$s.START_BROADCAST,properties:O}}}class C_{constructor(E){this.transformProperties=({protocol:O,hostname:F,port:V})=>({protocol:O,endpoint_host:F,endpoint_port:V});const A=this.transformProperties(E);this.data={event:$s.STOP_BROADCAST,properties:A}}}class Ig{constructor(E){this.transformProperties=O=>({bytes_sent:O.bytesSent,header_bytes_sent:O.headerBytesSent,nack_count:O.nackCount,packets_sent:O.packetsSent,retransmitted_bytes_sent:O.retransmittedBytesSent,retransmitted_packets_sent:O.retransmittedPacketsSent});const A=this.transformProperties(E);this.data={event:$s.WEBRTC_AUDIO_STATS,properties:A}}}class W1{constructor(E){this.transformProperties=O=>({bytes_sent:O.bytesSent,fir_count:O.firCount,frames_encoded:O.framesEncoded,frames_sent:O.framesSent,header_bytes_sent:O.headerBytesSent,huge_frames_sent:O.hugeFramesSent,key_frames_encoded:O.keyFramesEncoded,nack_count:O.nackCount,packets_sent:O.packetsSent,pli_count:O.pliCount,quality_limitation_reason:O.qualityLimitationReason,quality_limitation_resolution_changes:O.qualityLimitationResolutionChanges,retransmitted_bytes_sent:O.retransmittedBytesSent,retransmitted_packets_sent:O.retransmittedPacketsSent,total_encode_time:O.totalEncodeTime,total_encoded_bytes_target:O.totalEncodedBytesTarget,total_packet_send_delay:O.totalPacketSendDelay});const A=this.transformProperties(E);this.data={event:$s.WEBRTC_VIDEO_STATS,properties:A}}}(function(M){M.START_BROADCAST="ivs_broadcast_start_broadcast",M.STOP_BROADCAST="ivs_broadcast_stop_broadcast",M.MINUTE_BROADCAST="ivs_broadcast_minute_broadcast",M.WEBRTC_AUDIO_STATS="ivs_broadcast_webrtc_audio_stats",M.WEBRTC_VIDEO_STATS="ivs_broadcast_webrtc_video_stats",M.WEBRTC_AUDIO_STATS_WINDOW="ivs_broadcast_webrtc_audio_stats_window",M.WEBRTC_VIDEO_STATS_WINDOW="ivs_broadcast_webrtc_video_stats_window",M.CONNECTION_ESTABLISHED="ivs_broadcast_connection_established",M.SESSION_VIDEO_PROPERTIES="ivs_broadcast_session_video_properties",M.SESSION_AUDIO_PROPERTIES="ivs_broadcast_session_audio_properties",M.SESSION_VIDEO_ENCODER_CONFIGURED="ivs_broadcast_session_video_encoder_configured",M.SESSION_AUDIO_ENCODER_CONFIGURED="ivs_broadcast_session_audio_encoder_configured",M.SOURCE_AUDIO_LATENCY="ivs_broadcast_source_audio_latency",M.SOURCE_VIDEO_LATENCY="ivs_broadcast_source_video_latency",M.INPUT_DEVICE_ATTACHED="ivs_broadcast_input_device_attached",M.INPUT_DEVICE_DETACHED="ivs_broadcast_input_device_detached",M.CONGESTION_TIME="ivs_broadcast_congestion_time",M.BUFFER_DURATION="ivs_broadcast_buffer_duration",M.MEASURED_BITRATE="ivs_broadcast_measured_bitrate",M.RECOMMENDED_BITRATE="ivs_broadcast_recommended_bitrate",M.CONNECTION_RTT="ivs_broadcast_connection_rtt",M.ERROR="ivs_broadcast_error"})($s||($s={})),(function(M){M.USER_INITIATED="user-initiated",M.NETWORK_DISCONNECT="network-disconnect"})(_l||(_l={})),(function(M){M.LOWEST_QUALITY="lowest_quality",M.HIGHEST_QUALITY="highest_quality"})(Sa||(Sa={}));var vl,Lp,yl,Ms;(function(M){M.HI="hi",M.MID="mid",M.LOW="low"})(vl||(vl={})),(function(M){M.PORTRAIT="portrait",M.LANDSCAPE="landscape"})(Lp||(Lp={})),(function(M){M.VIDEO="video",M.AUDIO="audio"})(yl||(yl={})),(function(M){M.DEFAULT="default",M.LOW="low",M.MEDIUM="medium",M.HIGH="high"})(Ms||(Ms={}));const Up={jitterBuffer:{type:"object",required:!1,config:{schema:{minDelayWhenPublishing:{type:"number",required:!1},minDelayWhenSubscribeOnly:{type:"number",required:!1}}}},inBandMessaging:{type:"object",required:!1,config:{schema:{enabled:{type:"boolean",required:!1}}}},simulcast:{type:"object",required:!1,config:{schema:{initialLayerPreference:{type:"string",required:!1},layerPollingEnabled:{type:"boolean",required:!1},layerPollingIntervalMs:{type:"number",required:!1}}}}};var zi=i(2543);const Bp=(function(){if(typeof URLSearchParams<"u"){const A=new URLSearchParams(window.location.search);return{get:O=>A.get(O),has:O=>A.has(O)}}const M=window.location.search.slice(1),E={};return M&&M.split("&").forEach((A=>{const[O,F]=A.split("=");E[decodeURIComponent(O)]=decodeURIComponent(F||"")})),{get:A=>{var O;return(O=E[A])!==null&&O!==void 0?O:null},has:A=>A in E}})();var Og,Fp;const Td=Bp.get("ivs_dc_cnf_env")===xn.DeviceConfigEnv.BETA?xn.DeviceConfigEnv.BETA:xn.DeviceConfigEnv.PROD,Pu=xn.DEFAULT_REFRESH_INTERVAL_SECONDS,wd=Td===xn.DeviceConfigEnv.BETA?10:Pu,Af="broadcast-web-v1",Jl=((Fp=(Og=window.location)===null||Og===void 0?void 0:Og.hostname)===null||Fp===void 0?void 0:Fp.indexOf("localhost"))>-1,bl=`amazon_ivs_device_config_v1_${Af}_context`,Ng=()=>({[Po.RT]:{customerIds:[],hosts:[]},[Po.LL]:{customerIds:[],hosts:[]}});var q1=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};const jp=M=>{let E=(0,zi.merge)(Ng(),M);const A=(()=>{try{const F=localStorage.getItem(bl);return F===null?xn.err("Key does not exist"):xn.ok(JSON.parse(F))}catch(F){return xn.err(`Error while parsing: ${F}`)}})();if(!A.ok)return E;const O=A.value;return E=zp(Po.RT,O[Po.RT],E),E=zp(Po.LL,O[Po.LL],E),E},Pg=(M,E)=>M.hash===E.hash&&M.key===E.key,zp=(M,E,A)=>{const O=Object.keys(A[M]);for(const F of O)A[M][F]=(0,zi.uniqWith)([...E[F],...A[M][F]],Pg);return A},R_=(M,E,A)=>{const O=(0,zi.cloneDeep)(M??{}),F=Object.assign(Object.assign({},O),{cFilter:O.customerId,hFilter:O.host});for(const V of A[E].customerIds)V.key===M.customerId&&(F.cFilter=V.hash);for(const V of A[E].hosts)V.key===M.host&&(F.hFilter=V.hash);return F},Ad=M=>M?{customer_id:M.customerId,session_id:M.sessionId}:{};var k_;(function(M){M.EXPERIMENT_FOOBAR="experiment_foobar"})(k_||(k_={}));var M_=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class Vs extends Da{constructor(E){var A,O;super(),this.onStateChanged=(F,V)=>{this.logger.log(`[onStateChanged] From ${F} to ${V}`)},this.handleRefresh=()=>{this.logger.log("[handleRefresh] Starting refresh trigger");const F=this.fsm.currentState()===ks.ACTIVATING||this.fsm.currentState()===ks.ACTIVE;return F?(this.logger.log("[handleRefresh] Starting refresh"),this.fsm.transition(Qo.REFRESH)):this.logger.log("[handleRefresh] Skipping refresh due to inactive state"),F},this.onMetricsEmitted=F=>{this.fsm.currentState()!==ks.ACTIVATING&&this.fsm.currentState()!==ks.REFRESHING||this.fsm.transition(Qo.ACTIVATE);const V=new sn(Object.assign({},F));this.emit(gl.ANALYTICS_EVENT,V),this.emit(gl.REFRESH)},this.onConfigValue=(F,V)=>{const K=new Si(Object.assign(Object.assign({},F),Ad(V)));this.emit(gl.ANALYTICS_EVENT,K)},this.onConfigError=(F,V)=>{const K=new en(Object.assign(Object.assign({},F),Ad(V)));this.emit(gl.ANALYTICS_EVENT,K)},this.onConfigTrace=(F,V)=>{const K=new kr(Object.assign(Object.assign({},F),Ad(V)));this.emit(gl.ANALYTICS_EVENT,K)},this.onConfigAssignment=(F,V)=>{const K=new $n(Object.assign(Object.assign({},F),Ad(V)));this.emit(gl.ANALYTICS_EVENT,K)},this.cacheContextForSource=(F,V)=>M_(this,void 0,void 0,(function*(){const K=yield(ue=>q1(void 0,void 0,void 0,(function*(){const me={customerIds:[],hosts:[]};if(ue.customerId){const ce=yield(0,xn.hashProperty)(ue.customerId);if(!ce.ok)return xn.err(`customerId: ${ce.error}`);me.customerIds.push(ce.value)}if(ue.host){const ce=yield(0,xn.hashProperty)(ue.host);if(!ce.ok)return xn.err(`host: ${ce.error}`);me.hosts.push(ce.value)}return xn.ok(me)})))(V);K.ok?(this.context=zp(F,K.value,this.context),(ue=>{try{const me=JSON.stringify(ue);return localStorage.setItem(bl,me),xn.ok(void 0)}catch(me){return xn.err(`Error while storing: ${me}`)}})(this.context)):this.logger.error("[cacheContextForSource] ",K.error)})),this.disableConfigRefresh=()=>{this.fsm.transition(Qo.PAUSE)},this.enableConfigRefresh=()=>{this.fsm.transition(Qo.ACTIVATE)},this.logger=(O={name:"GlobalConfigManager"},(0,xn.createLogger)(O)),this.logger.setConfig({enabled:!0,levels:{debug:!1,log:Jl,info:Jl,error:Jl,warn:Jl}}),this.context=jp(Ng()),this.overrides=Object.assign(Object.assign({},{refreshIntervalSeconds:wd}),E),this.fsm=(0,xn.createFsm)({initialState:ks.IDLE,transitions:H1,callbacks:{onStateChanged:this.onStateChanged}}),this.manager=xn.DeviceConfigManager.getInstance(window,{fileKey:(A=_s("fileKey"))!==null&&A!==void 0?A:Af,standardEnv:Td,refresh:{refreshIntervalSeconds:this.overrides.refreshIntervalSeconds,canRefreshNow:this.handleRefresh},fetch:this.overrides.refreshRequestHook,trace:{onTrace:F=>{this.logger.log("[onTrace] ",F)}},emitMetrics:this.onMetricsEmitted,analyticsProperties:{env:Td,client_sdk:"broadcast-web"},enableConsoleLog:Jl}),this.fsm.transition(Qo.INITIALIZE)}get state(){return this.fsm.currentState()}resolveExperimentsForSource(E,A){const O=R_(A,E,this.context),F=this.getResolvedExperiments([k_.EXPERIMENT_FOOBAR],O);this.logger.info("[resolveExperimentContext]",F)}getRemoteStageSubscribeConfiguration(E){const A=R_(E,Po.RT,this.context);return this.getRemoteConfigurationForProperty(Xl.STAGE_SUBSCRIBE_CONFIGURATION,A,Up)}getConfigurationHolder(E){var A;return(A=this.manager)===null||A===void 0?void 0:A.getConfigurationHolder({analytics:{onValue:O=>{this.onConfigValue(O,E)},onError:O=>{this.onConfigError(O,E)},onTrace:O=>{this.onConfigTrace(O,E)},onAssignment:O=>{this.onConfigAssignment(O,E)}}})}getRemoteConfigurationForProperty(E,A,O){const F=this.getConfigurationHolder(A);if(F)return F.getResolvedConfigForPropertyKey({key:E,context:A,schema:O,trace:Jl});this.logger.error("[getRemoteConfigurationForProperty] No config manager is present")}getResolvedExperiments(E,A){const O=this.getConfigurationHolder(A);if(O)return O.getResolvedExperimentForPropertyKeys({keys:E,context:A,trace:Jl});this.logger.error("[getResolvedExperiments] No config manager is present")}}var qr=i(6880),Y1=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};function pT(M){return Y1(this,void 0,void 0,(function*(){const E=ue=>{let me="";return ue.architecture=="x86"&&ue.bitness=="64"?me="; Win64; x64":ue.architecture=="arm"?me="; ARM":ue.wow64===!0&&(me="; WOW64"),`Windows NT ${(function(ce){const de=new Map([["0.3.0","6.3"],["0.2.0","6.2"],["0.1.0","6.1"]]),we=ce??"";return de.has(we)?de.get(we):"10.0"})(ue.platformVersion)}${me}`},A=navigator.userAgentData;if(!A)return Promise.resolve(void 0);let O,F,V=!1;const K=new RegExp("AppleWebKit/537.36 \\(KHTML, like Gecko\\) (?:SamsungBrowser/[\\d.]+ )?Chrome/[\\d.]+ (Mobile )?Safari/537.36(?: Edg[A]?/[\\d.]+)?");return A.brands.forEach((ue=>{ue.brand=="Chromium"?(V=K.test(navigator.userAgent),O=parseFloat(ue.version)):ue.brand=="Samsung Internet"?F={brand:"Samsung Internet",version:ue.version}:ue.brand=="Microsoft Edge"&&(F={brand:"Microsoft Edge",version:ue.version})})),!V||O&&O<100?Promise.resolve(void 0):new Promise((ue=>{A.getHighEntropyValues(M).then((me=>{var ce,de,we,Me,nt;let bt={platform:(ce=navigator.userAgentData)===null||ce===void 0?void 0:ce.platform,version:O},ut=Object.assign(bt,me);ut=(Qe=>(Qe.architecture||(Qe.architecture="x86"),Qe.bitness||(Qe.bitness="64"),Qe.model||(Qe.model=""),Qe.platform||(Qe.platform="Windows"),Qe.platformVersion||(Qe.platformVersion="10.0"),Qe.wow64||(Qe.wow64=!1),Qe))(ut);let dt="Mozilla/5.0 (";if(["Chrome OS","Chromium OS"].includes((de=ut?.platform)!==null&&de!==void 0?de:"")?dt+=(Qe=>{let st="";return Qe.bitness=="64"?Qe.architecture=="x86"?st="x86_64":Qe.architecture=="arm"&&(st="aarch64"):Qe.architecture=="arm"&&Qe.bitness=="32"&&(st="armv7l"),st==""?`X11; CrOS ${Qe.platformVersion}`:`X11; CrOS ${st} ${Qe.platformVersion}`})(ut):ut.platform=="Windows"?dt+=E(ut):ut.platform=="macOS"?dt+=(Qe=>{var st;let It="Macintosh; Intel Mac OS X ",En=(st=Qe.platformVersion)!==null&&st!==void 0?st:"";return En.indexOf(".")>-1&&(En=En.split(".").join("_")),It+=En,It})(ut):ut.platform=="Android"?dt+=(Qe=>{let st="Linux; Android ";return st+=Qe.platformVersion,Qe.model&&(st+="; ",st+=Qe.model),st})(ut):dt+="X11; Linux x86_64",dt+=") AppleWebKit/537.36 (KHTML, like Gecko) Chrome/",dt+=Dg((we=ut?.fullVersionList)!==null&&we!==void 0?we:[],bt.version,F),A.mobile&&(dt+=" Mobile"),dt+=" Safari/537.36",F?.brand==="Samsung Internet"){const Qe=Dg((Me=ut?.fullVersionList)!==null&&Me!==void 0?Me:[],void 0,F);dt=dt.replace(" Safari/537.36",` SamsungBrowser/${Qe} Safari/537.36`)}else if(F?.brand==="Microsoft Edge"){const Qe=Dg((nt=ut?.fullVersionList)!==null&&nt!==void 0?nt:[],void 0,F);dt+=` ${A.mobile?"EdgA":"Edg"}/${Qe}`}ue(dt)})).catch((()=>{ue(void 0)}))}))}))}function Dg(M,E,A){var O,F;return A?((O=M?.find((V=>V.brand===A.brand)))===null||O===void 0?void 0:O.version)||`${A.version}.0.0.0`:((F=M?.find((V=>V.brand=="Google Chrome")))===null||F===void 0?void 0:F.version)||`${E}.0.0.0`}const Tn="model",fn="type",Sn="vendor",Cd="console",Hr="mobile",Cr="tablet",Ea="smarttv",Du="wearable",Cf="embedded",$p="Amazon",Rd="Apple",Lg="ASUS",Ug="Google",my="Huawei",Vp="LG",Rf="Microsoft",I_="Motorola",Ue="Samsung",Bh="Sharp",kf="Sony",Ya="Xiaomi",ci="Zebra",Ql=(M,E)=>{if(typeof M=="string")return M=M.replace(/^\s\s*/,""),E===void 0?M:M.substring(0,500)},Is=function(M,E){let A,O,F,V,K,ue,me=0;for(;E&&me<E.length&&!K;){const ce=E[me],de=E[me+1];for(A=O=0;A<ce.length&&!K&&ce[A];){const we=ce[A++];if(K=typeof we.exec=="function"?we.exec(M):void 0,K)for(F=0;F<de.length;F++)ue=K[++O],V=de[F],typeof V=="object"&&V.length>0?V.length===2?typeof V[1]=="function"?this[V[0]]=V[1].call(this,ue):this[V[0]]=V[1]:V.length===3?typeof V[1]!="function"||V[1].exec&&V[1].test?this[V[0]]=typeof ue=="string"?ue.replace(V[1],V[2]):void 0:this[V[0]]=ue?V[1].call(this,ue,V[2]):void 0:V.length===4&&V[0]!==void 0&&(this[V[0]]=ue?V[3].call(this,ue.replace(V[1],V[2])):void 0):this[V]=ue||void 0}me+=2}},Lu={device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[Tn,[Sn,Ue],[fn,Cr]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[Tn,[Sn,Ue],[fn,Hr]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[Tn,[Sn,Rd],[fn,Hr]],[/\((ipad);[-\w),; ]+apple/i,/applecoremedia\/[\w.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[Tn,[Sn,Rd],[fn,Cr]],[/(macintosh);/i],[Tn,[Sn,Rd]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[Tn,[Sn,Bh],[fn,Hr]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[Tn,[Sn,my],[fn,Cr]],[/(?:huawei|honor)([-\w ]+)[;)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[Tn,[Sn,my],[fn,Hr]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[Tn,/_/g," "],[Sn,Ya],[fn,Hr]],[/oid[^)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[Tn,/_/g," "],[Sn,Ya],[fn,Cr]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[Tn,[Sn,"OPPO"],[fn,Hr]],[/\b(opd2\d{3}a?) bui/i],[Tn,[Sn,"OPPO"],[fn,Cr]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at]?)(?: bui|;|\))/i],[Tn,[Sn,"Vivo"],[fn,Hr]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[Tn,[Sn,"Realme"],[fn,Hr]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w() ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[Tn,[Sn,I_],[fn,Hr]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[Tn,[Sn,I_],[fn,Cr]],[/((?=lg)?[vl]k-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[Tn,[Sn,Vp],[fn,Cr]],[/(lm(?:-?f100[nv]?|-[\w.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[Tn,[Sn,Vp],[fn,Hr]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[Tn,[Sn,"Lenovo"],[fn,Cr]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w.]*)/i],[[Tn,/_/g," "],[Sn,"Nokia"],[fn,Hr]],[/(pixel c)\b/i],[Tn,[Sn,Ug],[fn,Cr]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[Tn,[Sn,Ug],[fn,Hr]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[Tn,[Sn,kf],[fn,Hr]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[Tn,"Xperia Tablet"],[Sn,kf],[fn,Cr]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[Tn,[Sn,"OnePlus"],[fn,Hr]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[Tn,[Sn,$p],[fn,Cr]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[Tn,/(.+)/g,"Fire Phone $1"],[Sn,$p],[fn,Hr]],[/(playbook);[-\w),; ]+(rim)/i],[Tn,Sn,[fn,Cr]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[Tn,[Sn,"BlackBerry"],[fn,Hr]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[Tn,[Sn,Lg],[fn,Cr]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[Tn,[Sn,Lg],[fn,Hr]],[/(nexus 9)/i],[Tn,[Sn,"HTC"],[fn,Cr]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[Sn,[Tn,/_/g," "],[fn,Hr]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[Tn,[Sn,"Acer"],[fn,Cr]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[Tn,[Sn,"Meizu"],[fn,Hr]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[Tn,[Sn,"Ulefone"],[fn,Hr]],[/(blackberry|benq|palm(?=-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[Sn,Tn,[fn,Hr]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[Sn,Tn,[fn,Cr]],[/(surface duo)/i],[Tn,[Sn,Rf],[fn,Cr]],[/droid [\d.]+; (fp\du?)(?: b|\))/i],[Tn,[Sn,"Fairphone"],[fn,Hr]],[/(u304aa)/i],[Tn,[Sn,"AT&T"],[fn,Hr]],[/\bsie-(\w*)/i],[Tn,[Sn,"Siemens"],[fn,Hr]],[/\b(rct\w+) b/i],[Tn,[Sn,"RCA"],[fn,Cr]],[/\b(venue[\d ]{2,7}) b/i],[Tn,[Sn,"Dell"],[fn,Cr]],[/\b(q(?:mv|ta)\w+) b/i],[Tn,[Sn,"Verizon"],[fn,Cr]],[/\b(?:barnes[& ]+noble |bn[rt])([\w+ ]*) b/i],[Tn,[Sn,"Barnes & Noble"],[fn,Cr]],[/\b(tm\d{3}\w+) b/i],[Tn,[Sn,"NuVision"],[fn,Cr]],[/\b(k88) b/i],[Tn,[Sn,"ZTE"],[fn,Cr]],[/\b(nx\d{3}j) b/i],[Tn,[Sn,"ZTE"],[fn,Hr]],[/\b(gen\d{3}) b.+49h/i],[Tn,[Sn,"Swiss"],[fn,Hr]],[/\b(zur\d{3}) b/i],[Tn,[Sn,"Swiss"],[fn,Cr]],[/\b((zeki)?tb.*\b) b/i],[Tn,[Sn,"Zeki"],[fn,Cr]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[Sn,"Dragon Touch"],Tn,[fn,Cr]],[/\b(ns-?\w{0,9}) b/i],[Tn,[Sn,"Insignia"],[fn,Cr]],[/\b((nxa|next)-?\w{0,9}) b/i],[Tn,[Sn,"NextBook"],[fn,Cr]],[/\b(xtreme_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[Sn,"Voice"],Tn,[fn,Hr]],[/\b(lvtel-)?(v1[12]) b/i],[[Sn,"LvTel"],Tn,[fn,Hr]],[/\b(ph-1) /i],[Tn,[Sn,"Essential"],[fn,Hr]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[Tn,[Sn,"Envizen"],[fn,Cr]],[/\b(trio[-\w. ]+) b/i],[Tn,[Sn,"MachSpeed"],[fn,Cr]],[/\btu_(1491) b/i],[Tn,[Sn,"Rotor"],[fn,Cr]],[/(shield[\w ]+) b/i],[Tn,[Sn,"Nvidia"],[fn,Cr]],[/(sprint) (\w+)/i],[Sn,Tn,[fn,Hr]],[/(kin\.[onetw]{3})/i],[[Tn,/\./g," "],[Sn,Rf],[fn,Hr]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[Tn,[Sn,ci],[fn,Cr]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[Tn,[Sn,ci],[fn,Hr]],[/smart-tv.+(samsung)/i],[Sn,[fn,Ea]],[/hbbtv.+maple;(\d+)/i],[[Tn,/^/,"SmartTV"],[Sn,Ue],[fn,Ea]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[Sn,Vp],[fn,Ea]],[/(apple) ?tv/i],[Sn,[Tn,Rd+" TV"],[fn,Ea]],[/crkey/i],[[Tn,"Chromecast"],[Sn,Ug],[fn,Ea]],[/droid.+aft(\w+)( bui|\))/i],[Tn,[Sn,$p],[fn,Ea]],[/\(dtv[);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[Tn,[Sn,Bh],[fn,Ea]],[/(bravia[\w ]+)( bui|\))/i],[Tn,[Sn,kf],[fn,Ea]],[/(mitv-\w{5}) bui/i],[Tn,[Sn,Ya],[fn,Ea]],[/Hbbtv.*(technisat) (.*);/i],[Sn,Tn,[fn,Ea]],[/\b(roku)[\dx]*[)/]((?:dvp-)?[\d.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w+ ]*; *([\w\d][^;]*);([^;]*)/i],[[Sn,Ql],[Tn,Ql],[fn,Ea]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[fn,Ea]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[Sn,Tn,[fn,Cd]],[/droid.+; (shield) bui/i],[Tn,[Sn,"Nvidia"],[fn,Cd]],[/(playstation [345portablevi]+)/i],[Tn,[Sn,kf],[fn,Cd]],[/\b(xbox(?: one)?(?!; xbox))[); ]/i],[Tn,[Sn,Rf],[fn,Cd]],[/((pebble))app/i],[Sn,Tn,[fn,Du]],[/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i],[Tn,[Sn,Rd],[fn,Du]],[/droid.+; (glass) \d/i],[Tn,[Sn,Ug],[fn,Du]],[/droid.+; (wt63?0{2,3})\)/i],[Tn,[Sn,ci],[fn,Du]],[/(quest( \d| pro)?)/i],[Tn,[Sn,"Facebook"],[fn,Du]],[/(tesla)(?: qtcarbrowser|\/[-\w.]+)/i],[Sn,[fn,Cf]],[/(aeobc)\b/i],[Tn,[Sn,$p],[fn,Cf]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[Tn,[fn,Hr]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[Tn,[fn,Cr]],[/\b((tablet|tab)[;/]|focus\/\d(?!.+mobile))/i],[[fn,Cr]],[/(phone|mobile(?:[;/]| [ \w/.]*safari)|pda(?=.+windows ce))/i],[[fn,Hr]],[/(android[-\w. ]{0,9});.+buil/i],[Tn,[Sn,"Generic"]]]};var mo=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};function Kc(M){const{globalSessionId:E,userAgent:A}=M,O=A??navigator.userAgent,F=qr.getParser(O),V=(function(ue){const me=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/.exec(ue)||/^(\d+)\.(\d+)[+|-]?(.*)?$/.exec(ue)||/^(\d+)$/.exec(ue)||[];return{major:parseInt(me[1],10)||0,minor:parseInt(me[2],10)||0,patch:parseInt(me[3],10)||0}})(String(F.getBrowserVersion())),K=(ue=>{var me;const ce={};return ce[Sn]=void 0,ce[Tn]=void 0,ce[fn]=void 0,Is.call(ce,(me=ue??navigator.userAgent)!==null&&me!==void 0?me:"",Lu.device),ce})(O);return{browser:navigator.appVersion,browser_family:F.getBrowserName().toLowerCase(),browser_version:`${V.major}.${V.minor}`,customer_id:"ivs",host:window.location.hostname,os_name:F.getOSName(),os_version:String(F.getOSVersion()),platform:"web",global_session_id:E,sdk_version:"1.31.1",user_agent:O,is_backgrounded:document?.visibilityState==="hidden",device_model:K.model,device_manufacturer:K.vendor,device_os_version:String(F.getOSVersion()),device_software:O}}function Uu(M){return mo(this,void 0,void 0,(function*(){const E=yield(function(A=["architecture","bitness","model","platformVersion","fullVersionList"]){return Y1(this,void 0,void 0,(function*(){try{const O=yield pT(A);return O??navigator.userAgent}catch{return navigator.userAgent}}))})();return Kc(Object.assign(Object.assign({},M),{userAgent:E}))}))}var Mf=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class Fh{constructor(){this.globalSessionId=uy(),this.currentGlobalEndpoint=wg,this.signalInternalUsage=()=>{this.usageReferences>0?this.configManager.enableConfigRefresh():this.configManager.disableConfigRefresh()},this.markSdkUsage=()=>{this.usageReferences++,this.signalInternalUsage()},this.removeSdkUsage=()=>{this.usageReferences=Math.max(0,this.usageReferences-1),this.signalInternalUsage()},this.usageReferences=0,this.healthReporter=new fy,this.networkMonitor=new dy,this.configManager=new Vs,this.healthReporter.on(Nu.ANALYTICS_EVENT,(E=>{this.trackGlobalEvent(E)})),this.configManager.on(gl.ANALYTICS_EVENT,(E=>{this.trackGlobalEvent(E)})),this.configManager.on(gl.REFRESH,(()=>{this.signalInternalUsage()})),this.globalProperties=Kc({globalSessionId:this.globalSessionId}),Uu({globalSessionId:this.globalSessionId}).then((E=>{this.globalProperties=Object.assign(Object.assign({},this.globalProperties),E)})).catch(Uh)}updateGlobalProperties(){this.globalProperties=Object.assign(Object.assign({},this.globalProperties),{is_backgrounded:document?.visibilityState==="hidden"})}trackGlobalEvent(E){const A=this.getGlobalProperties();E.data.properties=Object.assign(Object.assign(Object.assign({},A),E.data.properties),{client_time:new Date().toISOString(),current_endpoint:this.currentEndpoint});const{headers:O,body:F}=Eg([E.data]);S_((()=>Mf(this,void 0,void 0,(function*(){yield Dp("POST",this.currentEndpoint,O,F)}))))}enrichContext(E){var A,O;return Object.assign({appLabel:(A=y_())!==null&&A!==void 0?A:"default",customerId:this.globalProperties.customer_id,host:this.globalProperties.host,browserFamily:this.globalProperties.browser_family,browserVersion:this.globalProperties.browser_version,osName:this.globalProperties.os_name,osVersion:this.globalProperties.os_version,userAgent:this.globalProperties.user_agent,sdkVersion:this.globalProperties.sdk_version,sessionId:(O=E.sessionId)!==null&&O!==void 0?O:""},E)}getGlobalSessionId(){return this.globalSessionId}getGlobalProperties(){return this.updateGlobalProperties(),this.globalProperties}set currentEndpoint(E){this.currentGlobalEndpoint=E}get currentEndpoint(){var E;return!((E=window.IVS_CLIENT_OVERRIDES)===null||E===void 0)&&E.analyticsPostUrl?window.IVS_CLIENT_OVERRIDES.analyticsPostUrl:this.currentGlobalEndpoint}trackEvent(E){E.type==="eventSenderResult"&&this.healthReporter.trackEventSendResult(E)}getNetworkQuality(){return this.networkMonitor.getNetworkQuality()}cacheRealTimeContext(E){const A=this.enrichContext(E);this.configManager.cacheContextForSource(Po.RT,A).catch(Uh)}cacheLowLatencyContext(E){const A=this.enrichContext(E);this.configManager.cacheContextForSource(Po.LL,A).catch(Uh)}resolveExperimentsForRealTimeContext(E){const A=this.enrichContext(E);this.configManager.resolveExperimentsForSource(Po.RT,A)}getRemoteSubscribeConfig(E){const A=this.enrichContext(E);return this.configManager.getRemoteStageSubscribeConfiguration(A)}}window.IVS_CLIENT_GLOBAL_STATE||(window.IVS_CLIENT_GLOBAL_STATE={}),window.IVS_CLIENT_GLOBAL_STATE.session||(window.IVS_CLIENT_GLOBAL_STATE.session=new Fh);const Do=window.IVS_CLIENT_GLOBAL_STATE.session;function Hp(M){if(!M)throw new Error("eventSender is not defined")}class La{constructor(){this.sharedProperties={},this.eventSender={},this.queuedEvents=[],this.genSessionId();const E=y_();this.eventSender=new Ss,this.initSharedProperties({appLabel:E}),this.errorReports=new Map}start(){this.flushInterval||(this.flushInterval=window.setInterval((()=>{this.queueAggregateErrors({force:!1}),this.flushEvents()}),1e3))}stop(E){let A=!1;clearInterval(this.flushInterval),this.flushInterval=void 0,this.queueAggregateErrors({force:!0}),E&&(this.queuedEvents=this.queuedEvents.filter((O=>O.critical)),A=!0),this.flushEvents(A),this.genSessionId()}trackEvent(E,A=!1){let O=this.sharedProperties;A&&(O={global_session_id:this.sharedProperties.global_session_id,session_id:this.sharedProperties.session_id,browser:this.sharedProperties.browser,browser_family:this.sharedProperties.browser_family,browser_version:this.sharedProperties.browser_version,os_name:this.sharedProperties.os_name,os_version:this.sharedProperties.os_version,is_backgrounded:this.sharedProperties.is_backgrounded}),document?.visibilityState==="hidden"&&(O.is_backgrounded=!0),"data"in E?(E.data.properties=Object.assign({},O,E.data.properties),this.queuedEvents.push(E.data)):(E.properties=Object.assign({},O,E.properties),this.queuedEvents.push(E))}trackEventNoSharedProps(E){this.trackEvent(E,!0)}trackErrorAndThrow(E){throw this.trackError(E),E}trackError(E){const A=`${E.code}${E.fatal}${E.nominal}${E.tag}${E.traceId.value}`,O=this.errorReports.get(A),F={error:E,queuedAt:Date.now(),count:0};return O?(O.count===0&&(O.error=E),O.count+=1,O.queuedAt+6e4<=Date.now()?(this.trackErrorReportIfNeeded(O),void this.errorReports.set(A,F)):void 0):(this.errorReports.set(A,F),void this.trackEvent(new gs(E)))}queueAggregateErrors({force:E=!1}){this.errorReports.forEach(((A,O)=>{const F=A.queuedAt+6e4;!E&&F>Date.now()||(this.trackErrorReportIfNeeded(A),this.errorReports.delete(O))}))}trackErrorReportIfNeeded(E){if(E.count===0)return;const A=E.error;A.count=E.count,this.trackEvent(new gs(A))}batchEvents(E){Hp(this.eventSender);const A=E.map((O=>(O.data.properties=Object.assign({},this.sharedProperties,O.data.properties),O.data)));this.eventSender.send(A)}initSharedProperties({appLabel:E}){const A=Do.getGlobalProperties();this.sharedProperties=Object.assign(Object.assign({},A),{session_id:this.sessionId}),E&&(this.sharedProperties.app_label=E)}genSessionId(){this.sessionId=uy(),this.sharedProperties.session_id=this.sessionId}flushEvents(E=!1){Hp(this.eventSender),this.queuedEvents.length>0&&this.eventSender.send(this.queuedEvents,E),this.queuedEvents=[]}getSessionId(){return this.sessionId}}const Bg={[W.INFO]:"#528bff",[W.WARN]:"#ffb31a",[W.DEBUG]:"#00f593",[W.ERROR]:"#ff4f4d",[W.TRACE]:"",[W.SILENT]:"",[oe.TIME]:"#53535f",[oe.WEBRTC]:"#0e9bd8",[oe.SUBSCRIPTION]:"#ffc400",[oe.CONNECTION]:"#ff5edb",[oe.SOCKET]:"#8585ff",[oe.EMITTER]:"#adadb8",[oe.LOCAL_PARTICIPANT]:"#1DD21D",[oe.STAGE]:"#EC9806",[oe.REMOTE_PARTICIPANT]:"#0680EC",details:"#808080"},jh=({label:M})=>`background: ${Bg[M]||"#333333"}; color: white; padding: 3px; margin-left: 3px;`,Gp=Object.entries(W),ea=(M,E,A)=>{const O=jh({label:M}),[F]=Gp.find((([,bt])=>bt===Number(M)))||[],V=`%c${F}`,K=jh({label:E}),ue=`%c${E}`,me=jh({label:oe.TIME}),ce=`%c[${new Date().toISOString()}]`,de=jh({label:"details"}),we=`%c[${A}]`,Me=[ce,V,ue],nt=[me,O,K];return A&&(Me.push(we),nt.push(de)),[Me.join(""),...nt]},O_={debug(M){console.groupCollapsed(...ea(W.DEBUG,M.scope,M.label)),console.debug(M.msg,Object.assign(Object.assign({},M),{level:"debug"})),console.groupEnd()},info(M){console.groupCollapsed(...ea(W.INFO,M.scope,M.label)),console.info(M.msg,Object.assign(Object.assign({},M),{level:"info"})),console.groupEnd()},warn(M){console.groupCollapsed(...ea(W.WARN,M.scope,M.label)),console.warn(M.msg,Object.assign(Object.assign({},M),{level:"warn"})),console.groupEnd()},error(M){console.groupCollapsed(...ea(W.ERROR,M.scope,M.label)),console.error(M),console.groupEnd()}};var zh=function(M,E){var A={};for(var O in M)Object.prototype.hasOwnProperty.call(M,O)&&E.indexOf(O)<0&&(A[O]=M[O]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function"){var F=0;for(O=Object.getOwnPropertySymbols(M);F<O.length;F++)E.indexOf(O[F])<0&&Object.prototype.propertyIsEnumerable.call(M,O[F])&&(A[O[F]]=M[O[F]])}return A};Object.entries(W);class ta{constructor(E=Lr,A=O_){this.logLevel=E,this.loggerInstance=A}debug(E){var A,O;this.logLevel>W.DEBUG||(O=(A=this.loggerInstance).debug)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{level:"debug"}))))}info(E){var A,O;this.logLevel>W.INFO||(O=(A=this.loggerInstance).info)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{level:"info"}))))}warn(E){var A,O;this.logLevel>W.WARN||(O=(A=this.loggerInstance).warn)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{level:"warn"}))))}error(E){var A,O,{err:F}=E,V=zh(E,["err"]);this.logLevel>W.ERROR||(O=(A=this.loggerInstance).error)===null||O===void 0||O.call(A,Object.assign({err:F},V))}}class Ka{constructor(E,A){this.logger=E,this.scope=A}debug(E){var A,O;(O=(A=this.logger).debug)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{scope:this.scope}))))}info(E){var A,O;(O=(A=this.logger).info)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{scope:this.scope}))))}warn(E){var A,O;(O=(A=this.logger).warn)===null||O===void 0||O.call(A,JSON.parse(JSON.stringify(Object.assign(Object.assign({},E),{scope:this.scope}))))}error(E){var A,O,{err:F}=E,V=zh(E,["err"]);(O=(A=this.logger).error)===null||O===void 0||O.call(A,Object.assign(Object.assign({err:F},V),{scope:this.scope}))}unwrap(){return this.logger}}class Bu{constructor(){this.min=0,this.max=0,this.sum=0,this.data=[]}push(E){(this.min===0||E<this.min)&&(this.min=E),E>=this.max&&(this.max=E),this.data.push(E),this.sum+=E}median(){this.data.sort();const E=this.data.length>>1;return this.data.length%2==0?this.data[E-1]+this.data[E]>>1:this.data[E]}percentile(E){if(this.data.length===0)return 0;if(E<=0)return this.data[0];if(E>=1)return this.data[this.data.length-1];const A=(this.data.length-1)*E,O=Math.floor(A),F=O+1,V=A%1;return F>=this.data.length?this.data[O]:this.data[O]*(1-V)+this.data[F]*V}}var kd=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class Fu{constructor(E,A,O,F){this.peerClient=E,this.broadcastCanvasManager=A,this.analyticsTracker=F,this.logger=new Ka(O,oe.EMITTER),this.previousBytesSent=0,this.startTimestamp=0,this.initializeSamples()}start(){this.logger.info({msg:"start emitter"}),this.collectSamplesTimerId=window.setInterval((()=>{this.collectSamples()}),1e3),this.trackSamplesTimerId=window.setInterval((()=>{this.trackSamples()}),3e4),this.trackPeerConnectionStatsTimerId=window.setInterval((()=>{this.trackPeerConnectionStats()}),6e4),this.trackSamples()}stop(){clearInterval(this.collectSamplesTimerId),clearInterval(this.trackSamplesTimerId),clearInterval(this.trackPeerConnectionStatsTimerId),this.collectSamplesTimerId=void 0,this.trackSamplesTimerId=void 0,this.trackPeerConnectionStatsTimerId=void 0}trackPeerConnectionStats(){return kd(this,void 0,void 0,(function*(){(yield this.peerClient.getReports()).forEach((E=>{if(E.type==="outbound-rtp")switch(E.kind){case"audio":this.analyticsTracker.trackEvent(new Ig(E));break;case"video":{const A=new W1(E),O=new G1(E,this.startTimestamp);this.analyticsTracker.batchEvents([A,O]);break}default:this.logger.warn({msg:"unknown report kind: ",reportKind:E.kind})}}))}))}collectSamples(){return kd(this,void 0,void 0,(function*(){let E=0;this.audioLatencySamples.push(this.broadcastCanvasManager.getAudioLatency()),this.videoLatencySamples.push(this.broadcastCanvasManager.getVideoLatency()),(yield this.peerClient.getReports()).forEach((O=>{switch(O.type){case"candidate-pair":O.nominated&&(this.rttSamples.push(O.currentRoundTripTime),this.recommendedBitrateSamples.push(O.availableOutgoingBitrate));break;case"outbound-rtp":E+=O.bytesSent||0,this.startTimestamp===0&&O.kind==="video"&&(this.startTimestamp=O.timestamp)}}));const A=8*Math.round(E-this.previousBytesSent);this.previousBytesSent=E,this.measuredBitrateSamples.push(A)}))}trackSamples(){const A=new kg(this.audioLatencySamples,30),O=new Ki(this.videoLatencySamples,30),F=new py(this.congestionTimeSamples,30),V=new A_(this.measuredBitrateSamples,30),K=new Yc(this.recommendedBitrateSamples,30),ue=new Bt(this.rttSamples,30);this.analyticsTracker.batchEvents([A,O,F,V,K,ue]),this.initializeSamples()}initializeSamples(){this.audioLatencySamples=new Bu,this.videoLatencySamples=new Bu,this.congestionTimeSamples=new Bu,this.measuredBitrateSamples=new Bu,this.recommendedBitrateSamples=new Bu,this.rttSamples=new Bu}}const Fg=M=>{const E=V=>{var K;return!((K=V.deviceId)===null||K===void 0)&&K.startsWith("web-contents-media-stream")?"tab":void 0},A=V=>{var K;return!((K=V.deviceId)===null||K===void 0)&&K.startsWith("window")&&V.displaySurface==="window"?"window":void 0},O=V=>{var K;return!((K=V.deviceId)===null||K===void 0)&&K.startsWith("screen")&&V.displaySurface==="monitor"?"screen":void 0};return(E(F=M)||A(F)||O(F)?void 0:"camera")||O(M)||A(M)||E(M)||"unknown";var F};function jg(M,E){return M.find((A=>A.kind===E))}function Md(M){return M?.readyState==="live"}var Tr;(function(M){M.VIDEO="video",M.AUDIO="audio"})(Tr||(Tr={}));class Xi{constructor(){this.mediaTracks=new Map([[Tr.VIDEO,void 0],[Tr.AUDIO,void 0]])}setTrack(E,A){this.mediaTracks.set(E,A)}getTrack(E){return this.mediaTracks.get(E)}}class N_{constructor(){this.levelAsymmetryAllowed=!1,this.packetisationMode=!1,this.profile="",this.level=0}extractVideoSdpFmtpLine(E){return E?(E.split("\r").join(";").split(`
`).join(";").split(" ").join(";").split(";").map((A=>A.trim())).filter(Boolean).forEach((A=>{const O=A.split("=");if(O.length===2)switch(O[0]){case"level-asymmetry-allowed":O[1]==="1"?this.levelAsymmetryAllowed=!0:this.levelAsymmetryAllowed=!1;break;case"packetization-mode":O[1]==="1"?this.packetisationMode=!0:this.packetisationMode=!1;break;case"profile-level-id":this.profile=this.getProfileFromId(O[1]),this.level=this.getLevelFromId(O[1])}})),{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}):{levelAsymmetryAllowed:this.levelAsymmetryAllowed,packetisationMode:this.packetisationMode,profile:this.profile,level:this.level}}getProfileFromId(E){const A=E.substr(0,2),O=E.substr(2,2);switch(A.substr(0,2)){case"42":return"baseline";case"4d":return"main";case"58":return"extended";case"64":return"high";case"6e":return O==="00"?"high 10":"high 10 intra";case"7a":return O==="00"?"high 42":"high 42 intra";case"f4":return O==="00"?"high 44":"high 44 intra";default:return"unknown"}}getLevelFromId(E){return parseInt(E.substr(4,2),16)}}function Xa(M){return btoa(JSON.stringify(M))}var Os,Wp=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};(function(M){M.IDLE="idle",M.EXECUTING="executing",M.RECONNECTING="reconnecting"})(Os||(Os={}));class zg{constructor(E,A=12e4,O,F){this.state=Os.IDLE,this.failureCallback=()=>{},this.peerClient=E,this.timeout=A,this.logger=O,this.emitter=F}onFailure(E){this.failureCallback=E}setStartConfig(E,A){this.ingestEndpoint=E,this.streamKey=A}execute(){const{id:E}=this;this.state===Os.IDLE&&(this.state=Os.EXECUTING,this.emitter.emit(Sc.CONNECTION_STATE_CHANGE,hr.CONNECTING),this.logger.info({msg:"Starting execution of reconnect strategy.",id:E}),this.startTimeoutTimer(this.timeout),this.executeStrategy())}startTimeoutTimer(E){this.timeoutTimerId=window.setTimeout((()=>{this.state!==Os.IDLE&&(this.logger.info({msg:"Reconnect strategy timed out."}),this.stop(),this.emitter.emit(Sc.CONNECTION_STATE_CHANGE,hr.FAILED),this.failureCallback())}),E)}stop(){this.state=Os.IDLE,clearTimeout(this.timeoutTimerId),this.stopStrategy()}reconnect(){return Wp(this,void 0,void 0,(function*(){if(this.ingestEndpoint&&this.streamKey){const E=this.peerClient.getConnectionState();try{this.logger.info({msg:"Attempting reconnect."}),E===hr.CONNECTED?this.logger.info({msg:"Already connected! Stopping reconnect strategy."}):(yield this.peerClient.start(this.ingestEndpoint,this.streamKey),this.logger.info({msg:"Reconnect succeeded!"})),this.stop()}catch(A){throw this.logger.error({err:A}),A}}}))}isActive(){return this.state!==Os.IDLE}}class Tc extends zg{constructor(){super(...arguments),this.id="ExponentialBackoffStrategy"}executeStrategy(){let E=5e3;const A=()=>Wp(this,void 0,void 0,(function*(){if(this.state===Os.EXECUTING)try{this.state=Os.RECONNECTING,yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed. Trying again in: ",nextRetry:E}),this.state=Os.EXECUTING,this.currentTimeoutId=window.setTimeout(A,E),E*=2}}));this.currentTimeoutId=window.setTimeout(A,0)}stopStrategy(){clearTimeout(this.currentTimeoutId)}}class gy extends zg{constructor(){super(...arguments),this.id="NetworkApiStrategy",this.onConnectionChange=()=>Wp(this,void 0,void 0,(function*(){if(navigator.onLine&&this.state===Os.EXECUTING){this.state=Os.RECONNECTING;try{yield this.reconnect()}catch{this.logger.warn({msg:"Attempted reconnect failed."}),this.state=Os.EXECUTING}}}))}executeStrategy(){navigator.connection.addEventListener("change",this.onConnectionChange),this.onConnectionChange()}stopStrategy(){navigator.connection.removeEventListener("change",this.onConnectionChange)}}class xa{static create(E,A=Rs,O,F){const{reconnect:V,timeout:K}=A;if(V){const ue=qr.getParser(navigator.userAgent).getBrowserName().toLowerCase();return["edge","chrome"].includes(ue)&&navigator.connection?new gy(E,K,O,F):new Tc(E,K,O,F)}}}var ju,qp=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))},K1=function(M,E,A,O){if(typeof E=="function"?M!==E||!O:!E.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?O:A==="a"?O.call(M):O?O.value:E.get(M)};const P_=M=>!!M;function $h(M){if(!M)throw new Error("PeerConnection is not defined")}const $g={bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",enableDtlsSrtp:{exact:!0},enableRtpDataChannels:{exact:!1},optional:[{googHighStartBitrate:{exact:0}},{googPayloadPadding:{exact:!0}},{googScreencastMinBitrate:{exact:100}},{googCpuOveruseDetection:{exact:!0}},{googCpuOveruseEncodeUsage:{exact:!0}},{googCpuUnderuseThreshold:{exact:55}},{googCpuOveruseThreshold:{exact:85}},{enableDscp:{exact:!0}}]};class Id{constructor(E,A,O,F,V){this.config=E,this.emitter=A,this.mediaStreamManager=O,this.analyticsTracker=V,this.establishConnection=(K,ue)=>qp(this,void 0,void 0,(function*(){var me,ce,de;$h(this.peerConnection);try{const we=yield this.peerConnection.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1});yield this.handleLocalDescription(we),yield this.sendSetupRequest(K,ue,we)}catch(we){if(we instanceof Error){(me=(de=we).code)!==null&&me!==void 0||(de.code=wn.code);const Me=new _e(Object.assign(Object.assign({},wn),{name:we.name,message:we.message,code:we?.code,cause:we}));throw!((ce=this.reconnectStrategy)===null||ce===void 0)&&ce.isActive()||this.handleError(we.code,we.message),this.stop(),Me}}})),this.getSessionId=()=>this.ingestSessionId,this.getConnectionState=()=>{var K;if(!this.peerConnection)return hr.NONE;const ue=(K=this.reconnectStrategy)===null||K===void 0?void 0:K.isActive(),me=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;switch(me){case"new":return hr.NEW;case"closed":return hr.CLOSED;case"disconnected":return ue?hr.CONNECTING:hr.DISCONNECTED;case"failed":return ue?hr.CONNECTING:hr.FAILED;case"idle":return hr.IDLE;case"checking":case"connecting":return hr.CONNECTING;case"completed":case"connected":return hr.CONNECTED;default:return this.logger.warn({msg:"Unhandled connection state:",rawState:me}),hr.IDLE}},this.onConnectionStateChange=()=>{var K;const ue=this.getConnectionState();switch(ue){case hr.CONNECTED:{this.emitter.emit(Sc.CONNECTION_STATE_CHANGE,ue);const me=new Date;this.analyticsTracker.trackEvent(new Ag(me,this.connectionStartDate,this.ingestSessionId));const ce=this.mediaStreamManager.getTrack(Tr.AUDIO),de=this.mediaStreamManager.getTrack(Tr.VIDEO);if(de){const we=de.getSettings();this.analyticsTracker.trackEvent(new xd(we))}if(ce){const we=ce.getSettings();this.analyticsTracker.trackEvent(new Rg(we))}(((K=this.peerConnection)===null||K===void 0?void 0:K.getSenders())||[]).forEach((we=>{var Me;(((Me=we.getParameters())===null||Me===void 0?void 0:Me.codecs)||[]).forEach((nt=>{var bt;switch((bt=we.track)===null||bt===void 0?void 0:bt.kind){case"video":{if(!de)break;const ut=new N_().extractVideoSdpFmtpLine(nt.sdpFmtpLine),dt=de.getSettings();this.analyticsTracker.trackEvent(new Ed(dt,ut,nt));break}case"audio":if(!ce)break;this.analyticsTracker.trackEvent(new Cg(nt))}}))}));break}case hr.CONNECTING:this.emitter.emit(Sc.CONNECTION_STATE_CHANGE,ue),this.connectionStartDate=new Date,this.disconnectionStartDate=void 0;break;case hr.FAILED:this.reconnectStrategy?this.reconnectStrategy.execute():(this.emitter.emit(Sc.CONNECTION_STATE_CHANGE,ue),this.handleTerminalConnectionFailure());break;case hr.DISCONNECTED:this.emitter.emit(Sc.CONNECTION_STATE_CHANGE,ue),this.disconnectionStartDate=new Date;break;default:this.emitter.emit(Sc.CONNECTION_STATE_CHANGE,ue)}},this.handleLocalDescription=K=>qp(this,void 0,void 0,(function*(){var ue;return(ue=this.peerConnection)===null||ue===void 0?void 0:ue.setLocalDescription(K)})),ju.set(this,(K=>{if(typeof K!="string")throw new _e(is);try{new URL(K)}catch{throw new _e(hi)}})),this.logger=new Ka(F,oe.WEBRTC),this.createReconnectStrategy(E)}start(E,A){var O;return qp(this,void 0,void 0,(function*(){K1(this,ju,"f").call(this,E);const F=[this.mediaStreamManager.getTrack(Tr.VIDEO),this.mediaStreamManager.getTrack(Tr.AUDIO)].filter(P_);if(this.createPeerConnection(),this.addTracks({tracks:F}),this.reconnectStrategy&&this.reconnectStrategy.setStartConfig(E,A),yield this.establishConnection(E,A),!((O=this.reconnectStrategy)===null||O===void 0)&&O.isActive()){const V=new URL(E);this.analyticsTracker.trackEvent(new Mg({protocol:"webrtc",hostname:V.hostname,port:V.port},_l.NETWORK_DISCONNECT))}}))}stop(){var E,A,O,F;this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stopStreamDataChannel&&this.stopStreamDataChannel.readyState==="open"&&this.stopStreamDataChannel.send(" "),[hr.NEW,hr.CONNECTING,hr.CONNECTED].includes(this.getConnectionState())&&this.emitter.emit(Sc.CONNECTION_STATE_CHANGE,hr.CLOSED),(E=this.peerConnection)===null||E===void 0||E.close(),(A=this.peerConnection)===null||A===void 0||A.removeEventListener("connectionstatechange",this.onConnectionStateChange),(O=this.peerConnection)===null||O===void 0||O.removeEventListener("iceconnectionstatechange",this.onConnectionStateChange),this.ingestSessionId=void 0,(F=this.reconnectStrategy)===null||F===void 0||F.stop()}addTracks(E){var A;if($h(this.peerConnection),!E)return;const O=this.peerConnection.getSenders().map((V=>{var K;return(K=V.track)===null||K===void 0?void 0:K.id})),F=E.tracks.filter((V=>!O.includes(V.id)));for(const V of F)(A=this.peerConnection)===null||A===void 0||A.addTrack(V)}getReports(){var E;return qp(this,void 0,void 0,(function*(){try{const A=(yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats())||[],O=[];return A.forEach((F=>{O.push(F)})),O}catch{return[]}}))}sendSetupRequest(E,A,O){var F;return qp(this,void 0,void 0,(function*(){const V=yield fetch(`${E}/v1/offer`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({offer:Xa(O),streamKey:A},this.config.streamConfig))});if(!V.ok)throw(function(ue){let me=new _e(Object.assign({},wn));return ue?.code===1007&&(me=new _e(Object.assign({},An))),ue?.message&&(me.message=ue.message),me})(yield V.json());const K=yield V.json();K?.answer&&(yield(F=this.peerConnection)===null||F===void 0?void 0:F.setRemoteDescription((function(ue){return JSON.parse(atob(ue))})(K.answer)),this.ingestSessionId=K.ingestSessionId)}))}handleTerminalConnectionFailure(){const E=new _e(qt);this.handleError(E.code,E.message)}handleError(E,A){this.analyticsTracker.trackEvent(new po({code:E,description:A,isFatal:!0})),this.emitter.emit(Sc.ERROR,{code:E,message:A})}createPeerConnection(){var E;const A=this.getConnectionState(),O=A!==hr.NONE,F=A!==hr.CLOSED,V=(E=this.reconnectStrategy)===null||E===void 0?void 0:E.isActive();O&&F&&!V||(this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0),this.stateCheckInterval=window.setInterval((()=>{const K=this.getConnectionState();if(this.reconnectStrategy&&K===hr.DISCONNECTED&&this.disconnectionStartDate){const ue=Date.now()-this.disconnectionStartDate.getTime();this.logger.info({msg:"Time since disconnected:",timeSinceDisconnect:ue}),ue>1e4&&(this.disconnectionStartDate=void 0,this.reconnectStrategy.execute())}else K===hr.CLOSED&&(this.handleTerminalConnectionFailure(),clearInterval(this.stateCheckInterval),this.stateCheckInterval=void 0)}),1e3),this.peerConnection=new RTCPeerConnection($g),this.stopStreamDataChannel=this.peerConnection.createDataChannel("stopStream"),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onConnectionStateChange))}createReconnectStrategy(E){if(this.reconnectStrategy=xa.create(this,E.networkReconnectConfig,this.logger,this.emitter),this.reconnectStrategy){this.reconnectStrategy.onFailure(this.handleTerminalConnectionFailure.bind(this));const A=this.reconnectStrategy.id;this.logger.info({msg:"Using reconnect strategy:",strategyId:A})}}}ju=new WeakMap;var If,_y,X1=i(5364);(function(M){M.CONFIG="config",M.UPDATE="update",M.START="start",M.STOP="stop"})(If||(If={})),(function(M){M.VIDEO_SEND="video/send",M.VIDEO_RECEIVE="video/receive",M.INSERT_SEI="insertSei"})(_y||(_y={}));var D_=i(5512),vy=i.n(D_);function Of(){return vy()(`/*! For license information please see scheduler.worker.worker.js.LICENSE.txt */
(()=>{"use strict";var i,t;!function(i){i.CONFIG="config",i.UPDATE="update",i.START="start",i.STOP="stop"}(i||(i={})),function(i){i.VIDEO_SEND="video/send",i.VIDEO_RECEIVE="video/receive",i.INSERT_SEI="insertSei"}(t||(t={}));const s=self;const n=new class Scheduler{constructor(){this.config={frameRate:60,isRunning:!1}}setConfig(i){this.config=Object.assign(Object.assign({},this.config),i),this.config.isRunning&&(this.stop(),this.start())}start(){this.config.isRunning||(this.intervalId=setInterval((()=>{s.postMessage({type:i.UPDATE})}),1e3/this.config.frameRate),this.config.isRunning=!0)}stop(){this.config.isRunning&&(clearInterval(this.intervalId),this.intervalId=void 0,this.config.isRunning=!1)}};s.addEventListener("message",(function(t){var s;if(null===(s=null==t?void 0:t.data)||void 0===s?void 0:s.type)switch(t.data.type){case i.CONFIG:n.setConfig(t.data.payload||{});break;case i.START:n.start();break;case i.STOP:n.stop()}}))})();`,"Worker",void 0,void 0)}var Vh=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class yy{constructor(E,A,O){this.config=E,this.mediaStreamManager=A,this.analyticsTracker=O,this.handleWorkerEvent=ue=>{var me;((me=ue.data)===null||me===void 0?void 0:me.type)===If.UPDATE&&this.drawComposite()},this.mixer={video:[],audio:[]},this.schedulerWorker=new Of,this.running=!1,this.compositeEl=document.createElement("canvas"),this.compositeEl.height=this.config.streamConfig.maxResolution.height,this.compositeEl.width=this.config.streamConfig.maxResolution.width;const F=this.compositeEl.getContext("2d");if(F===null)throw new _e(Object.assign({},Ye));this.compositeContext=F,this.compositeStream=this.compositeEl.captureStream(typeof CanvasCaptureMediaStreamTrack!==void 0?0:30);const V=jg(this.compositeStream.getTracks(),Tr.VIDEO);this.audioContext=new AudioContext,this.unlockAudioContext(),this.audioDestination=this.audioContext.createMediaStreamDestination(),this.setupSilence();const K=jg(this.audioDestination.stream.getTracks(),Tr.AUDIO);V&&this.mediaStreamManager.setTrack(Tr.VIDEO,V),K&&this.mediaStreamManager.setTrack(Tr.AUDIO,K),this.schedulerWorker.addEventListener("message",this.handleWorkerEvent),this.schedulerWorker.postMessage({type:If.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.previewElement=null,this.previewCtx=null,this.nextMix=new Date().getTime()}attachPreview(E){this.previewElement=E;const{width:A,height:O}=this.config.streamConfig.maxResolution;this.previewElement.width=A,this.previewElement.height=O,this.previewCtx=this.previewElement.getContext("2d")}detachPreview(){this.previewElement=null,this.previewCtx=null}setupSilence(){const E=this.audioContext.createConstantSource(),A=this.audioContext.createGain();A.gain.value=.001,E.connect(A),A.connect(this.audioDestination),E.start()}unlockAudioContext(){if(this.audioContext.state!=="suspended")return;const E=document.body,A=["touchstart","touchend","mousedown","keydown"],O=()=>{A.forEach((V=>{E.removeEventListener(V,F)}))},F=()=>{this.audioContext.resume().then(O)};A.forEach((V=>{E.addEventListener(V,F,!1)}))}getTracks(){return[this.mediaStreamManager.getTrack(Tr.VIDEO),this.mediaStreamManager.getTrack(Tr.AUDIO)]}getCanvasVideoTrack(){return this.mediaStreamManager.getTrack(Tr.VIDEO)}getAudioInputDevice(E){if(typeof E!="string")return;const A=this.mixer.audio.find((O=>{if(O.name===E)return O.source}));return A?.source}getVideoInputDevice(E){if(typeof E=="string")return this.mixer.video.find((A=>A.name===E))}getCanvasDimensions(){return{height:this.compositeEl.height,width:this.compositeEl.width}}addVideoInputDevice(E,A,O){var F;return Vh(this,void 0,void 0,(function*(){if(typeof E!="object")throw new _e(Object.assign({},Fe));if(!A||typeof A!="string")throw new _e(Object.assign({},tt));if(this.mixer.video.some((Me=>Me.name===A)))throw new _e(Object.assign({},Ge));if(!O)throw new _e(Object.assign({},at));if(typeof O.index!="number")throw new _e(Object.assign({},Be));const V=(function(){const Me=document.createElement("video");return Me.autoplay=!0,Me.muted=!0,Me.setAttribute("playsinline",""),Me.setAttribute("webkit-playsinline",""),Me})(),K=E.getVideoTracks(),[ue]=K;if(!K.length)throw new _e(Object.assign({},ke));const me=ue.getConstraints(),ce=X1({},me,{frameRate:this.config.streamConfig.maxFramerate});try{yield ue.applyConstraints(ce)}catch(Me){let nt="Unknown constraints error";Me instanceof Error&&(nt=Me.message),this.analyticsTracker.trackEvent(new po({description:`${xt.message}: ${nt}`,isFatal:!1,code:xt.code}))}const de=()=>Vh(this,void 0,void 0,(function*(){let Me=0;for(;Me<5;)try{return void(yield V.play())}catch(nt){if(!(nt instanceof Error))throw new Error("unknown error trying to add video to broadcast");Me++,yield new Promise((bt=>setTimeout(bt,150)))}throw new Error("Error playing video, tries exceeded")})),we=new MediaStream([ue]);V.srcObject=we;try{yield de();const Me={name:A,element:V,position:O,source:we,render:!0},nt=((F=ue.getSettings)===null||F===void 0?void 0:F.call(ue))||{};this.analyticsTracker.trackEvent(new Zl(Fg(nt),nt)),this.mixer.video.push(Me)}catch(Me){throw new _e(Object.assign(Object.assign({},ke),{cause:Me}))}}))}addImageSource(E,A,O){var F;return Vh(this,void 0,void 0,(function*(){if(!E)throw new _e(Object.assign({},Fe));if(!A||typeof A!="string")throw new _e(Object.assign({},tt));if(E.tagName==="image")throw new _e(Object.assign({},rt));if(this.mixer.video.some((K=>K.name===A)))throw new _e(Object.assign({},Ge));if(!O)throw new _e(Object.assign({},at));if(typeof O.index!="number")throw new _e(Object.assign({},Be));if(E instanceof Image){const K=(F=E.src)===null||F===void 0?void 0:F.slice();try{const ue=E.src?new URL(E.src):{};if(ue.host&&ue.hostname){const me=yield fetch(E.src).then((de=>Vh(this,void 0,void 0,(function*(){return de.blob()})))),ce=yield new Promise((de=>{const we=new FileReader;we.onload=()=>{de(we.result)},we.readAsDataURL(me)}));E.src=ce}}catch{throw new _e(Object.assign(Object.assign({},Zt),{params:{details:`Image URL: ${K}`}}))}}const V={name:A,element:E,position:O,render:!0};this.mixer.video.push(V)}))}addAudioInputDevice(E,A){return Vh(this,void 0,void 0,(function*(){if(typeof E!="object")throw new _e(Object.assign({},Fe));if(!A||typeof A!="string")throw new _e(Object.assign({},tt));if(this.mixer.audio.some((ue=>ue.name===A)))throw new _e(Object.assign({},Ge));const O=E.getAudioTracks();if(!O.length)throw new _e(Object.assign({},Ve));const F=this.audioContext.createMediaStreamSource(new MediaStream(O)),V=this.audioContext.createGain();V.gain.value=1,F.connect(V),V.connect(this.audioDestination);const K={name:A,source:E,audioTrackSource:F,gainNode:V};this.analyticsTracker.trackEvent(new Zl("audio",{deviceId:E.id})),this.mixer.audio.push(K)}))}removeImage(E){const A=this.mixer.video.findIndex((O=>O.name===E));if(A<0)throw new _e(Object.assign({},tn));this.mixer.video.splice(A,1)}removeVideoInputDevice(E){var A;const O=this.removeDevice(E,this.mixer.video);if(!O)throw new _e(Object.assign({},ot));{const F=jg(O.source.getTracks(),Tr.VIDEO);if(!F)throw new _e(Object.assign({},ot));O.element.srcObject=null,F.stop();const V=((A=F?.getSettings)===null||A===void 0?void 0:A.call(F))||{};this.analyticsTracker.trackEvent(new Wr(Fg(V),V))}}removeAudioInputDevice(E){const A=this.removeDevice(E,this.mixer.audio);if(A?.audioTrackSource){for(const O of A.source.getTracks())O.stop(),this.analyticsTracker.trackEvent(new Wr("audio",{deviceId:O.id}));A.gainNode.disconnect(this.audioDestination)}else if(!A)throw new _e(Object.assign({},ot))}updateVideoDeviceComposition(E,A){if(!E||typeof E!="string")throw new _e(Object.assign({},$t));if(!A)throw new _e(Object.assign({},ln));if(typeof A.index!="number")throw new _e(Object.assign({},Rt));this.mixer.video.forEach(((O,F)=>{O.name===E&&(O.position=A)}))}exchangeVideoDevicePositions(E,A){const O=this.getVideoInputDevice(E),F=this.getVideoInputDevice(A);if(!O)throw new _e(Object.assign(Object.assign({},mt),{params:{details:`device with name: "${E}" not found`}}));if(!F)throw new _e(Object.assign(Object.assign({},mt),{params:{details:`device with name: "${A}" not found`}}));const V=Object.assign({},O.position),K=Object.assign({},F.position);for(const ue of this.mixer.video)ue.name===E&&(L_(K.x)?ue.position=Object.assign(Object.assign({},ue.position),K):ue.position={index:K.index}),ue.name===A&&(L_(V.x)?ue.position=Object.assign(Object.assign({},ue.position),V):ue.position={index:V.index})}start(){this.running||(this.running=!0,this.schedulerWorker.postMessage({type:If.CONFIG,payload:{frameRate:this.config.streamConfig.maxFramerate}}),this.schedulerWorker.postMessage({type:If.START}))}stop(){this.running&&(this.running=!1,this.schedulerWorker.removeEventListener("message",this.handleWorkerEvent))}isCapturing(){return this.running}getAudioLatency(){return this.audioContext.baseLatency}getVideoLatency(){var E;return((E=this.mediaStreamManager.getTrack(Tr.VIDEO))===null||E===void 0?void 0:E.getConstraints().latency)||0}disableVideo(){this.mixer.video.forEach((E=>{E.render=!1}))}enableVideo(){this.mixer.video.forEach((E=>{E.render=!0}))}disableAudio(){this.mixer.audio.forEach((E=>{E.audioTrackSource&&(E.gainNode.gain.value=0)}))}enableAudio(){this.mixer.audio.forEach((E=>{E.audioTrackSource&&(E.gainNode.gain.value=1)}))}getDrawRegion(E,A,O){var F,V,K,ue;let me=(F=E.position.x)!==null&&F!==void 0?F:0,ce=(V=E.position.y)!==null&&V!==void 0?V:0;const de=(K=E.position.width)!==null&&K!==void 0?K:A-me,we=(ue=E.position.height)!==null&&ue!==void 0?ue:O-ce,Me=de/we;let nt=E.element.width,bt=E.element.height;E.element instanceof HTMLVideoElement&&(nt=E.element.videoWidth,bt=E.element.videoHeight);const ut=nt/bt;let dt=de,Qe=we;return ut>Me?(dt=de,Qe=2*Math.round(de/ut/2),ce+=(we-Qe)/2):ut<Me&&(Qe=we,dt=2*Math.round(we*ut/2),me+=(de-dt)/2),{x:me,y:ce,width:dt,height:Qe}}drawComposite(){if(!this.shouldMix(new Date))return;this.compositeContext.clearRect(0,0,this.compositeEl.width,this.compositeEl.height),this.drawBlackScreen();const E=this.mixer.video.filter((A=>A.render));E.sort(((A,O)=>A.position.index-O.position.index));for(const A of E){const{x:O,y:F,width:V,height:K}=this.getDrawRegion(A,this.compositeEl.width,this.compositeEl.height);this.compositeContext.drawImage(A.element,O,F,V,K)}this.previewElement&&this.previewCtx&&this.previewCtx.drawImage(this.compositeEl,0,0,this.previewElement.width,this.previewElement.height),this.requestCanvasCapture()}requestCanvasCapture(){typeof CanvasCaptureMediaStreamTrack!==void 0&&(typeof this.compositeStream.requestFrame=="function"?this.compositeStream.requestFrame():this.mediaStreamManager.getTrack(Tr.VIDEO).requestFrame())}drawBlackScreen(){this.compositeContext.fillStyle="#000000",this.compositeContext.fillRect(0,0,this.compositeEl.width,this.compositeEl.height)}removeDevice(E,A){const O=A.findIndex((F=>(V=>V.name===E)(F)));if(!(O<0))return A.splice(O,1)[0]}shouldMix(E){if(E.getTime()<this.nextMix)return!1;for(;this.nextMix<=E.getTime();)this.nextMix+=1e3/this.config.streamConfig.maxFramerate;return!0}}function L_(M){return Number.isSafeInteger(M)}var Od,U_,Yp=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))},by=function(M,E,A,O){if(typeof E=="function"?M!==E||!O:!E.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?O:A==="a"?O.call(M):O?O.value:E.get(M)};class Hh{constructor(E){this.config=E,Od.add(this),this.emitter=new Li,this.isValid=!0,this.emitter.on(Sc.ERROR,this.stopBroadcast),this.config.ingestEndpoint&&(this.url=new URL(this.config.ingestEndpoint)),this.analyticsTracker=new La,this.mediaStreamManager=new Xi;const A=new ta(E.logLevel,E.logger);this.peerClient=new Id(this.config,this.emitter,this.mediaStreamManager,A,this.analyticsTracker),this.broadcastCanvasManager=new yy(E,this.mediaStreamManager,this.analyticsTracker),this.peerStatsTracker=new Fu(this.peerClient,this.broadcastCanvasManager,A,this.analyticsTracker),this.broadcastCanvasManager.start(),Object.getOwnPropertyNames(Hh.prototype).forEach((O=>{this[O]=new Proxy(this[O],{apply:(F,V,K)=>{if(!V.isValid)throw new _e(Object.assign({},ss));return Reflect.apply(F,V,K)}})})),window.addEventListener("beforeunload",(()=>{this.analyticsTracker.stop(!0)}))}delete(){this.isValid=!1,this.peerClient.stop(),this.broadcastCanvasManager.stop(),this.emitter.removeAllListeners()}startBroadcast(E,A){return Yp(this,void 0,void 0,(function*(){Do.markSdkUsage(),by(this,Od,"m",U_).call(this,E);const O=ho(A||this.config.ingestEndpoint);this.analyticsTracker.start(),this.peerStatsTracker.start(),yield this.peerClient.start(O,E),this.emitter.emit(Sc.ACTIVE_STATE_CHANGE,!0),this.url=new URL(O),this.url&&this.analyticsTracker.trackEvent(new Mg({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port},_l.USER_INITIATED))}))}stopBroadcast(){var E,A,O;this.url&&this.analyticsTracker.trackEvent(new C_({protocol:"webrtc",hostname:this.url.hostname,port:this.url.port})),(E=this.peerStatsTracker)===null||E===void 0||E.stop(),(A=this.peerClient)===null||A===void 0||A.stop(),(O=this.emitter)===null||O===void 0||O.emit(Sc.ACTIVE_STATE_CHANGE,!1)}getCanvasDimensions(){return this.broadcastCanvasManager.getCanvasDimensions()}addVideoInputDevice(E,A,O){return Yp(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addVideoInputDevice(E,A,O)}))}addImageSource(E,A,O){return Yp(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addImageSource(E,A,O)}))}addAudioInputDevice(E,A){return Yp(this,void 0,void 0,(function*(){return this.broadcastCanvasManager.addAudioInputDevice(E,A)}))}removeVideoInputDevice(E){this.broadcastCanvasManager.removeVideoInputDevice(E)}removeAudioInputDevice(E){this.broadcastCanvasManager.removeAudioInputDevice(E)}removeImage(E){this.broadcastCanvasManager.removeImage(E)}updateVideoDeviceComposition(E,A){this.broadcastCanvasManager.updateVideoDeviceComposition(E,A)}exchangeVideoDevicePositions(E,A){this.broadcastCanvasManager.exchangeVideoDevicePositions(E,A)}getAudioInputDevice(E){return this.broadcastCanvasManager.getAudioInputDevice(E)}getVideoInputDevice(E){return this.broadcastCanvasManager.getVideoInputDevice(E)}getConnectionState(){return this.peerClient.getConnectionState()}getSessionId(){return this.peerClient.getSessionId()}on(E,A){this.emitter.on(E,A)}off(E,A){this.emitter.off(E,A)}getAudioContext(){return this.broadcastCanvasManager.audioContext}attachPreview(E){this.broadcastCanvasManager.attachPreview(E)}detachPreview(){this.broadcastCanvasManager.detachPreview()}disableVideo(){this.broadcastCanvasManager.disableVideo()}enableVideo(){this.broadcastCanvasManager.enableVideo()}disableAudio(){this.broadcastCanvasManager.disableAudio()}enableAudio(){this.broadcastCanvasManager.enableAudio()}}function B_(M){return new Hh((function(E){const A=new Mi;return A.streamConfig=E.streamConfig,A.ingestEndpoint=E.ingestEndpoint,A.logger=E.logger,A.logLevel=E.logLevel,A.networkReconnectConfig=E.networkReconnectConfig,A})(M))}Od=new WeakSet,U_=function(M){if(typeof M!="string"||!/^[a-zA-Z0-9_-]+$/.test(M))throw new _e(as)};const Vg="1.31.1";var Qt;(function(M){M.PUBLISH="publish",M.SUBSCRIBE="subscribe",M.JOIN="join",M.LEAVE="leave"})(Qt||(Qt={}));const Kr=2,mT="X-Stages-Options",Z1="cap";class Hg extends Kn{constructor(E){super(Mn.LEAVE,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.LEAVE,event_endpoint:E.eventEndpoint,whip_endpoint:E.whipEndpoint,reason:E.reason}),this.critical=!0}}function Sy(M){const E="0123456789abcdef";let A="";for(let O=0;O<M;O+=1)A+=E.charAt(Math.floor(16*Math.random()));return A}class gT{constructor(){const E=Sy;this.value=`${E(8)}-${E(4)}-${E(4)}-${E(4)}-${E(12)}`}}function Nd(){return new gT}class Za{constructor(){const E=(Date.now()/1e3|0).toString(16);this.value=`1-${E}-${Sy(24)}`}}function Ns(){return new Za}var Kp,Ja,Gh;(function(M){M.MESSAGE="message",M.RESPONSE="response"})(Kp||(Kp={})),(function(M){M.STAGE_DELETED="STAGE_DELETED",M.PARTICIPANT_DISCONNECTED="PARTICIPANT_DISCONNECTED",M.TOKEN_INVALID="TOKEN_INVALID",M.TOKEN_EXPIRED="TOKEN_EXPIRED",M.TOKEN_INVALID_SIGNATURE="TOKEN_INVALID_SIGNATURE",M.TOKEN_MISSING="TOKEN_MISSING",M.INTERNAL="INTERNAL",M.BAD_REQUEST="BAD_REQUEST"})(Ja||(Ja={})),(function(M){M[M.BAD_REQUEST=400]="BAD_REQUEST",M[M.UNAUTHORIZED=401]="UNAUTHORIZED",M[M.FORBIDDEN=403]="FORBIDDEN",M[M.NOT_FOUND=404]="NOT_FOUND",M[M.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR"})(Gh||(Gh={}));class Rr extends _e{constructor({token:E,traceId:A,code:O,tag:F,location:V,message:K,details:ue,remoteParticipantId:me,requestUUID:ce,fatal:de,nominal:we,action:Me,count:nt=1}){super({name:"StageClientError",message:K,code:O}),Error.captureStackTrace&&Error.captureStackTrace(this,Rr),this.action=Me,this.token=E,this.traceId=A,this.code=O,this.tag=F,this.location=V,this.message=K,this.details=ue,this.remoteParticipantId=me,this.requestUUID=ce,this.fatal=de,this.nominal=we,this.count=nt}}const na="signalling_session",Xc="webrtc_sink",Ey="webrtc_unsink",Gg="webrtc_source";function Lo(M,E){switch(M){case Qt.PUBLISH:return Xc;case Qt.SUBSCRIBE:return`webrtc_source:${E}`;default:return"unknown"}}function Wh(M,E){var A,O,F,V;const K={code:M.code,message:`${M.message}: ${E.name} ${E.message}`,fatal:(A=M.fatal)!==null&&A!==void 0&&A,nominal:(O=M.nominal)!==null&&O!==void 0&&O};return E instanceof Rr&&(K.fatal=(F=E.fatal)!==null&&F!==void 0&&F,K.nominal=(V=E.nominal)!==null&&V!==void 0&&V),K}function Wg(M,E){if(M===0)return Jt.UNKNOWN_SERVER_ERROR;if(!(M<400))if(M>=400&&M<=403)switch(E){case wc.TokenExpired:return Jt.EXPIRED_TOKEN;case wc.NoPermissions:return Jt.TOKEN_PERMISSIONS_DENIED;case wc.StageAtCapacity:return Jt.STAGE_AT_CAPACITY;case wc.NoMatchingCodec:return Jt.NO_MATCHING_CODEC;default:return Jt.UNKNOWN_SERVER_ERROR}else{if(M===404)return E===wc.RemoteStreamNotFound?Jt.REMOTE_STREAM_NOT_FOUND:Jt.UNKNOWN_SERVER_ERROR;if(M===412)return E===wc.AbortedMHCPError?Jt.MHCP_ABORTED:Jt.UNKNOWN_SERVER_ERROR;if(M===429)return E===wc.StageAuthThrottled?Jt.STAGE_AUTH_THROTTLED:Jt.WHIP_TOO_MANY_REQUESTS;if(M!==500)return Jt.UNKNOWN_SERVER_ERROR;switch(E){case wc.InternalMHCPError:return Jt.INTERNAL_MHCP_ERROR;case wc.UnreachableMHCP:return Jt.UNREACHABLE_MHCP;case wc.InvalidSessionStatus:return Jt.INVALID_SESSION_STATUS;default:return Jt.INTERNAL_SERVER_ERROR}}}var wc;(function(M){M[M.Unspecified=2001]="Unspecified",M[M.TokenExpired=2002]="TokenExpired",M[M.NoPermissions=2003]="NoPermissions",M[M.RemoteStreamNotFound=2004]="RemoteStreamNotFound",M[M.StageAtCapacity=2005]="StageAtCapacity",M[M.InternalMHCPError=2006]="InternalMHCPError",M[M.UncategorizedMHCPError=2007]="UncategorizedMHCPError",M[M.UnreachableMHCP=2008]="UnreachableMHCP",M[M.InvalidSessionStatus=2010]="InvalidSessionStatus",M[M.PostWithoutOptions=2011]="PostWithoutOptions",M[M.AbortedMHCPError=2012]="AbortedMHCPError",M[M.StageAuthThrottled=2013]="StageAuthThrottled",M[M.NoMatchingCodec=2014]="NoMatchingCodec"})(wc||(wc={}));const Jt={MALFORMED_TOKEN:{code:1e3,message:"Token is malformed",fatal:!0,nominal:!0},EXPIRED_TOKEN:{code:1001,message:"Token expired and is no longer valid",fatal:!0,nominal:!0},STAGE_DELETED:{code:1037,message:"Stage has been deleted",fatal:!0,nominal:!0},PARTICIPANT_DISCONNECTED:{code:1038,message:"Participant has been disconnected",fatal:!0,nominal:!0},JOIN_SERVER_INTERNAL_ERROR:{code:1039,message:"Internal server error during join",fatal:!1,nominal:!1},JOIN_SERVER_BAD_REQUEST:{code:1040,message:"Bad request during join",fatal:!0,nominal:!1},UNPUBLISH_FAILURE:{code:1013,message:"Failed to unpublish",fatal:!1,nominal:!1},UNSUBSCRIBE_FAILURE:{code:1014,message:"Failed to unsubscribe",fatal:!1,nominal:!1},PUBLISH_FAILURE:{code:1015,message:"Failed to publish",fatal:!1,nominal:!1},SUBSCRIBE_FAILURE:{code:1016,message:"Failed to subscribe",fatal:!1,nominal:!1},JOIN_FAILURE:{code:1017,message:"Failed to join",fatal:!0,nominal:!1},JOIN_TIMED_OUT:{code:1019,message:"Join timed out",fatal:!0,nominal:!1},PUBLISH_TIMED_OUT:{code:1020,message:"Publish timed out",fatal:!1,nominal:!1},SUBSCRIBE_TIMED_OUT:{code:1021,message:"Subscribe timed out",fatal:!1,nominal:!1},OPERATION_ABORTED:{code:1023,message:"Request aborted",fatal:!1,nominal:!0},STAGE_AT_CAPACITY:{code:1024,message:"Stage at capacity",fatal:!0,nominal:!0},INTERNAL_SERVER_ERROR:{code:1025,message:"Internal server error",fatal:!0,nominal:!1},TOKEN_PERMISSIONS_DENIED:{code:1026,message:"Token permissions are not valid for the operation",fatal:!0,nominal:!1},REMOTE_STREAM_NOT_FOUND:{code:1027,message:"Contributor group (PUBLISH) or remote stream (SUBSCRIBE) not found",fatal:!0,nominal:!1},INTERNAL_MHCP_ERROR:{code:1028,message:"Authorization failed due to internal MHCP error",fatal:!0,nominal:!1},UNREACHABLE_MHCP:{code:1030,message:"Authorization failed due to MHCP unreachable",fatal:!0,nominal:!1},INVALID_SESSION_STATUS:{code:1031,message:"Stream has already been published (PUBLISH) or subscribed to (SUBSCRIBE)",fatal:!0,nominal:!1},MHCP_ABORTED:{code:1033,message:"Publisher state conflict",fatal:!0,nominal:!1},STAGE_AUTH_THROTTLED:{code:1034,message:"Too many requests",fatal:!1,nominal:!1},NO_MATCHING_CODEC:{code:1035,message:"No matching codec found",fatal:!0,nominal:!1},UNKNOWN_SERVER_ERROR:{code:1099,message:"Service error code unknown or not found",fatal:!0,nominal:!1},XDP_CONNECTION_LOST:{code:1221,message:"Connection lost during SDP exchange",fatal:!1,nominal:!1},XDP_INVALID_ANSWER_MSG:{code:1222,message:"Invalid answer message received by client",fatal:!1,nominal:!1},XDP_TIMEOUT:{code:1223,message:"Failed to receive SDP answer within timeout period",fatal:!1,nominal:!1},XDP_UNEXPECTED_ERROR:{code:1224,message:"Unexpected error encountered",fatal:!1,nominal:!1},WEBSOCKET_MESSAGE_PARSE_FAILURE:{code:1204,message:"Failed to parse websocket message"},WHIP_TOO_MANY_REQUESTS:{code:1207,message:"WHIP endpoint received too many requests",fatal:!1,nominal:!1},WHIP_POST_FAILURE:{code:1502,message:"WHIP post failure",fatal:!1,nominal:!1},WHIP_DELETE_FAILURE:{code:1503,message:"WHIP delete failure",fatal:!1,nominal:!1},WHIP_URL_MISSING:{code:1504,message:"WHIP delete failure",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_FAILED:{code:1510,message:"Set layer request failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_SET_LAYER_REQUEST_THROTTLED:{code:1511,message:"Too many set layer requests",fatal:!1,nominal:!0},WHEP_GET_LAYER_STATE_FAILED:{code:1512,message:"Get layer state failed for reason: Unknown",fatal:!1,nominal:!1},WHEP_GET_LAYER_STATE_THROTTLED:{code:1513,message:"Too many get layer state requests",fatal:!1,nominal:!0},EVENT_PLANE_WS_CREATE_FAILED:{code:1300,message:"Error creating WebSocket",fatal:!0,nominal:!1},EVENT_PLANE_WS_UNEXPECTED_CLOSE:{code:1302,message:"Unexpectedly not connected to event plane",fatal:!1,nominal:!1},EVENT_PLANE_PONG_TIMEOUT:{code:1304,message:"Pong timed out",fatal:!1,nominal:!1},EVENT_PLANE_WS_CLOSE_BEFORE_OPEN:{code:1305,message:"Connect attempt closed by server",fatal:!1,nominal:!1},PEER_CONNECTION_NETWORK_FAILURE:{code:1400,message:"PeerConnection is lost due to unknown network error",fatal:!1,nominal:!1},CREATE_OFFER_FAILURE:{code:1402,message:"Failed to set local description",fatal:!1,nominal:!1},CREATE_PEER_CONNECTION_FAILURE:{code:1403,message:"Failed to create a peer connection",fatal:!1,nominal:!1},ICE_CANDIDATE_ERROR:{code:1404,message:"ICE candidate error",fatal:!1,nominal:!1},SET_ANSWER_FAILURE:{code:1405,message:"Failed to set remote answer",fatal:!1,nominal:!1},NETWORK_FAILURE:{code:1406,message:"Failed due to network problem",fatal:!1,nominal:!1},SEI_INSERT_NOT_PUBLISHING_VIDEO:{code:1460,message:"SEI failed to insert due to not publishing video",fatal:!1,nominal:!0},SEI_INSERT_INBAND_NOT_ENABLED:{code:1461,message:"SEI failed to insert due to in-band messaging not being enabled",fatal:!1,nominal:!0},REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID:{code:1470,message:"Invalid participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID:{code:1471,message:"Invalid remote participant id in the reassignment message",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE:{code:1472,message:"Invalid subscriber peer connection state for reassignment",fatal:!1,nominal:!1},REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS:{code:1473,message:"Request rejected because client is already processing a previous reassignment request",fatal:!1,nominal:!1},UNEXPECTED_ERROR:{code:9999,message:"Encountered unexpected error condition. Expected StageClientError type.",fatal:!1,nominal:!1},TRANSFORM_UNEXPECTED_ERROR:{code:1480,message:"Unexpected error occurred during transform execution",fatal:!1,nominal:!1},TRANSFORM_TOO_MANY_ERRORS:{code:1481,message:"Transformer encountered too many consecutive errors",fatal:!1,nominal:!1},TRANSFORM_NOT_SUPPORTED_BY_PLATFORM:{code:1482,message:"Transforms are not supported by this platform",fatal:!1,nominal:!1},CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR:{code:1490,message:"Unexpected error occurred when handling incompatible codecs",fatal:!1,nominal:!1}};var Sr;(function(M){M.UNPUBLISH="unpublish",M.UNSUBSCRIBE="unsubscribe",M.UNLOAD="unload",M.CONNECTION_FAIL="connection fail",M.REASSIGNMENT="reassignment"})(Sr||(Sr={}));const Nf="stageJoined",Ua="stageParticipantJoined",Zc="stageParticipantLeft",F_="stageParticipantKicked",Pf="stageParticipantUpdated",zu="localPublishingChanged",Pd="stageRefresh",Dd="stateChange",qg="error",j_="reassignmentRequest",Zs="incompatibleCodecs",Ac="connectionStateChange",Df="mediaStreamCreated",$u="mediaStreamRemoved",Xp="error",Vu="stageStreamSeiMessageReceived",Zp="transformError",Ld="reassignmentStarted",Ud="reassignmentSuccess",xy="reassignmentFailed",Jp="open",dr="closed",Ty="messageParseError",Yg="refresh",Sl="error",Hu="stageStateMessage",z_="sdpAnswer",Kg="disconnectMessage",wy="reassignmentMessage",$_="incompatibleCodecs",J1="ssu";function Xg(M){return A=(function(O){return O.replace(/-/g,"+").replace(/_/g,"/").padEnd(O.length+(4-O.length%4)%4,"=")})(M),window.atob(A);var A}class Gu{constructor(E,A){var O;this.analyticsTracker=A,this.rawToken=E;const F=E.split(".");if(F.length!==3)throw Error(`Token format incorrect. length: ${F.length}`);try{this.header=JSON.parse(Xg(F[0]))}catch(ue){const me=ue instanceof Error?`: ${ue.message}`:"";throw Error(`Error parsing Stage Token header${me}`)}try{this.claims=JSON.parse(Xg(F[1]))}catch(ue){const me=ue instanceof Error?`: ${ue.message}`:"";throw Error(`Error parsing Stage Token claims${me}`)}this.signature=F[2];const{claims:V}=this;this.stageARN=V.resource,this.customerId=(O=(function(ue){if(ue.indexOf("arn:aws:")<0)return;const me=ue.split(":");return me.length>=5?me[4]:void 0})(this.stageARN))!==null&&O!==void 0?O:"unknown",this.participantID=V.jti,this.eventsURL=V.events_url,this.whipURL=_s("whipUrl")||V.whip_url,this.userID=V.user_id,this.expirationTime=V.exp,this.topic=V.topic,this.parseVersionFlags(V.version);const{attributes:K}=V;K&&(this.attrGsRole=K.gs_role,this.attrGsSessionId=K.gs_session_id)}getPublishEndpoint(){let E="";return this.whipURL&&this.participantID&&(E=`${this.whipURL}/publish/${this.participantID}`),E}getSubscribeEndpoint(E){let A="";return this.whipURL&&(A=`${this.whipURL}/subscribe/${E}`),A}assertTokenIsUnexpired(E,A,O,F){Gc("disableTokenValidation")||(!this.expirationTime||Date.now()/1e3>=this.expirationTime)&&this.analyticsTracker.trackErrorAndThrow(new Rr(Object.assign(Object.assign({},Jt.EXPIRED_TOKEN),{action:Qt.JOIN,location:O,tag:A,token:this,traceId:E,remoteParticipantId:F,message:Jt.EXPIRED_TOKEN.message,details:`Token expired at ${this.expirationTime} and is no longer valid`})))}parseVersionFlags(E){if(!E)return;const A=E.split(".");A.length===2&&(this.versionFlags=parseInt(A[1],10))}shouldSendSilentAudio(){return this.versionFlags===void 0||!!(this.versionFlags&Kr)}}function Qp(M,E){return new Gu(M,E)}var V_;(function(M){M.PUBLISH="publish",M.SUBSCRIBE="subscribe"})(V_||(V_={}));class _T{constructor(E,A){this.throttleDuration=0,this.throttled=!1,this.timeout=0,this.unthrottle=()=>{this.trailing&&this.trailingFn&&this.trailingFn(...this.trailingFnArgs),this.clear()},this.throttleDuration=E,this.trailing=!(A&&A.skipTrailing)}invoke(E,...A){return this.throttled?(this.trailingFn=E,this.trailingFnArgs=A,!1):(this.throttled=!0,this.timeout=window.setTimeout(this.unthrottle,this.throttleDuration),E(...A),!0)}clear(){clearTimeout(this.timeout),this.timeout=0,this.throttled=!1,delete this.trailingFn,delete this.trailingFnArgs}}class Ay extends Kn{constructor(E,A,O,F,V,K,ue,me){super(Mn.SERVER_REQUEST,A,ue,!0),Object.assign(this.properties,{action:E,http_method:F,remote_participant_id:K,request_uuid:V,url:O,transport:me})}}const ra="draft-ietf-wish-whip-04";class Ba extends Kn{constructor(E,A,O,F,V){super(Mn.TRACE,E,A,!1),Object.assign(this.properties,{action:F,message:O,remote_participant_id:V})}}class ia extends Kn{constructor(E,A,O,F,V){super(Mn.CONNECTION_STATE,A,O,!1),Object.assign(this.properties,{action:E,remote_participant_id:V,state:F})}}class El extends Kn{constructor(E,A,O,F,V){super(Mn.ICE_GATHERING_STATE,A,O,!1),Object.assign(this.properties,{action:E,remote_participant_id:V,state:F})}}var gi;(function(M){M.POST="post",M.CONNECTED="connected",M.ICE_GATHERING="icegathering",M.SDP_EXCHANGE="sdpExchange",M.SET_REMOTE_DESC="setRemoteDesc",M.PEER_CONNECTION="peerConnection"})(gi||(gi={}));const Bd="start",vr="stop";class go{constructor(E,A){this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0,this.action=E,this.traceId=A}markActionStart(){this.markStart(gi.CONNECTED)}markPostStart(){this.markStart(gi.POST)}markPostStop(){this.markStop(gi.POST),this.postDuration=this.measure(gi.POST)}markIceGatheringStart(){this.markStart(gi.ICE_GATHERING)}markIceGatheringStop(){this.markStop(gi.ICE_GATHERING),this.timeToCandidate=this.measure(gi.ICE_GATHERING)}markActionStop(){this.markStop(gi.CONNECTED),this.timeToConnected=this.measure(gi.CONNECTED),this.markStop(gi.PEER_CONNECTION),this.peerConnectionDuration=this.measure(gi.PEER_CONNECTION)}markSetRemoteDescStart(){this.markStart(gi.SET_REMOTE_DESC)}markSetRemoteDescStop(){const E=gi.SET_REMOTE_DESC;this.markStop(E),this.setRemoteDescDuration=this.measure(E),this.markStart(gi.PEER_CONNECTION)}markSdpExchangeStart(){this.markStart(gi.SDP_EXCHANGE)}markSdpExchangeStop(){const E=gi.SDP_EXCHANGE;this.markStop(E),this.sdpExchangeDuration=this.measure(E)}setTransport(E){this.sdpExchangeTransport=E}markStart(E){this.marks[`${this.namespace}.${E}.${Bd}`]=performance.now()}markStop(E){this.marks[`${this.namespace}.${E}.${vr}`]=performance.now()}measure(E){const A=`${this.namespace}.${E}.${Bd}`,O=`${this.namespace}.${E}.${vr}`,F=this.marks[A],V=this.marks[O];return F===void 0||V===void 0?0:V-F}get namespace(){return`ivswb.peerclient.${this.action}.${this.traceId.value}`}getMeasurements(){const{optionsDuration:E,postDuration:A,timeToCandidate:O,timeToConnected:F,sdpExchangeDuration:V,sdpExchangeTransport:K,setRemoteDescDuration:ue,peerConnectionDuration:me}=this;return{optionsDuration:E,postDuration:A,timeToCandidate:O,timeToConnected:F,sdpExchangeDuration:V,sdpExchangeTransport:K,setRemoteDescDuration:ue,peerConnectionDuration:me}}resetMeasurements(E){this.traceId=E,this.marks={},this.optionsDuration=0,this.postDuration=0,this.timeToCandidate=0,this.timeToConnected=0,this.sdpExchangeDuration=0,this.sdpExchangeTransport="",this.setRemoteDescDuration=0,this.peerConnectionDuration=0}}var sa=i(7363);class fi{constructor(E){this.sdp=E}static splitLines(E){return E.trim().split(`
`).map((A=>A.trim()))}static splitSections(E){return E.split(`
m=`).map(((A,O)=>(O>0?`m=${A}`:A).trim()+fi.CRLF))}getUniqueRtpHeaderExtensionId(E){const A=[];for(const F of E)if(/^a=extmap:/.test(F.trim())){const V=+F.split("a=extmap:")[1].split(" ")[0];A.includes(V)||A.push(V)}A.sort(((F,V)=>F-V));let O=0;for(const F of A){if(F-O>1)return O+1;O=F}return O===14?-1:O+1}withVideoLayersAllocationRtpHeaderExtension(E){const A="http://www.webrtc.org/experiments/rtp-hdrext/video-layers-allocation00",O=E?E.getRtpHeaderExtensionId(A):-1,F=O===-1?this.getUniqueRtpHeaderExtensionId(fi.splitLines(this.sdp)):O,V=fi.splitSections(this.sdp),K=[];for(let me of V){if(/^m=video/.test(me)&&fi.getRtpHeaderExtensionIdInSection(me,A)===-1){const ce=fi.splitLines(me),de=[];if(F===-1||this.hasRtpHeaderExtensionId(F)){K.push(me);continue}for(const we of ce)if(de.push(we),/^a=sendrecv/.test(we.trim())){const Me=`a=extmap:${F} ${A}`;de.push(Me)}me=de.join(fi.CRLF)+fi.CRLF}else if(O!==-1&&/^m=video/.test(me)&&fi.getRtpHeaderExtensionIdInSection(me,A)!==O){const ce=fi.splitLines(me),de=[];for(const we of ce){if(/^a=extmap:/.test(we.trim())&&we.split("a=extmap:")[1].split(" ")[1]===A){if(!this.hasRtpHeaderExtensionId(O)){const Me=`a=extmap:${O} ${A}`;de.push(Me)}continue}de.push(we)}me=de.join(fi.CRLF)+fi.CRLF}K.push(me)}const ue=K.join("");return new fi(ue)}withOpusAudioConfig(E,A){const O=sa.qg(this.sdp);for(const F of O.media)if(F.type==="audio"){const{payload:V}=F.rtp.find((ce=>ce.codec==="opus"));if(!V)continue;let K=F.fmtp.find((ce=>ce.payload===V));K||(K={payload:V,config:""});const ue=sa.Sl(K.config);if(ue.maxaveragebitrate=E,typeof A=="boolean"){const ce=A?1:0;ue["sprop-stereo"]=ce,ue.stereo=ce}let me="";for(const ce of Object.keys(ue))me+=`${ce}=${ue[ce]}; `;K.config=me.trim()}return new fi(sa.M9(O))}withoutAudioRtcpRSize(){var E;const A=sa.qg(this.sdp);for(const O of A.media){if(O.type!=="audio")continue;const F=V1()!==void 0,V=(E=V1())!==null&&E!==void 0&&E;F&&(O.rtcpRsize=V?void 0:"rtcp-rsize")}return new fi(sa.M9(A))}withFilteredCandidates(E){const A=sa.qg(this.sdp);return A.media.forEach((O=>{const F=O.candidates;if(F){const V=F.filter((K=>K.transport===E));O.candidates=V}})),new fi(sa.M9(A))}static getRtpHeaderExtensionIdInSection(E,A){const O=fi.splitLines(E);for(const F of O)if(/^a=extmap:/.test(F.trim())){const V=F.split("a=extmap:")[1].split(" "),K=+V[0];if(V[1]===A)return K}return-1}getRtpHeaderExtensionId(E){const A=fi.splitSections(this.sdp);for(const O of A)if(/^m=video/.test(O)){const F=fi.getRtpHeaderExtensionIdInSection(O,E);if(F!==-1)return F}return-1}hasRtpHeaderExtensionId(E){const A=fi.splitLines(this.sdp);for(const O of A)if(/^a=extmap:/.test(O.trim())&&+O.split("a=extmap:")[1].split(" ")[0]===E)return!0;return!1}hasAudioNacksEnabled(){var E,A,O;return((O=(A=((E=sa.qg(this.sdp).media.filter((F=>F.type==="audio"))[0])!==null&&E!==void 0?E:{}).rtcpFb)===null||A===void 0?void 0:A.filter((F=>F.type==="nack")))!==null&&O!==void 0?O:[]).length>0}}function H_(M){const{config:E}=M;return[{maxBitrate:E.maxBitrateBps}]}fi.CRLF=`\r
`,fi.rfc7587LowestBitrate=6e3,fi.rfc7587HighestBitrate=51e4;function eu(M){return 1e3*M}const Ta=(M,...E)=>{const A=E.map((O=>typeof O!="object")).filter(Boolean).length>0;if(typeof M=="object"&&!A)return(0,zi.merge)({},M,...E)},Cy=M=>Zg(M),Zg=M=>(0,zi.cloneDeep)(M),Ry=M=>{switch(M){case Sa.HIGHEST_QUALITY:return"highest";case Sa.LOWEST_QUALITY:default:return"lowest"}},Co=M=>Object.freeze(M),Uo=Object.freeze({DEFAULT_1080:Co({maxBitrateKbps:2500,maxFramerate:30,width:1920,height:1080}),INACTIVE:Co({maxBitrateKbps:0,maxFramerate:0,width:0,height:0})}),em=Object.freeze({DEFAULT_720:Co({maxBitrateKbps:2500,maxFramerate:30,width:1280,height:720}),DEFAULT_540:Co({maxBitrateKbps:1400,maxFramerate:15,width:960,height:540}),DEFAULT_480:Co({maxBitrateKbps:1100,maxFramerate:15,width:854,height:480}),DEFAULT_360:Co({maxBitrateKbps:600,maxFramerate:15,width:640,height:360}),DEFAULT_270:Co({maxBitrateKbps:350,maxFramerate:15,width:480,height:270}),DEFAULT_180:Co({maxBitrateKbps:150,maxFramerate:15,width:320,height:180}),DEFAULT_160:Co({maxBitrateKbps:120,maxFramerate:15,width:284,height:160})}),xl=Object.freeze({HI:Co(Object.assign({},em.DEFAULT_720)),MID:Co(Object.assign(Object.assign({},em.DEFAULT_360),{maxBitrateKbps:700,maxFramerate:20})),LOW:Co(Object.assign(Object.assign({},em.DEFAULT_180),{maxBitrateKbps:200,maxFramerate:15}))}),qh=M=>({rid:M,active:!1,scaleFactor:Jg(M),maxBitrateBps:eu(Uo.INACTIVE.maxBitrateKbps),maxFramerate:Uo.INACTIVE.maxFramerate,width:Uo.INACTIVE.width,height:Uo.INACTIVE.height}),Jg=M=>{switch(M){case vl.HI:return 1;case vl.MID:return 2;case vl.LOW:return 4;default:return 1}},Lf=50,Wu=2500,qu=10,Yu=30,tm=160,Fd=1280,Yh=720*Fd,Qg=16/9,e0=12,nm=128,t0=64,Q1={[Ms.DEFAULT]:0,[Ms.LOW]:50,[Ms.MEDIUM]:150,[Ms.HIGH]:250},Ku={[Ms.DEFAULT]:0,[Ms.LOW]:100,[Ms.MEDIUM]:200,[Ms.HIGH]:300};function jd(M){const{outbound:E,remoteInbound:A,networkQuality:O}=M;return{networkQuality:O,nackCount:E.nackCount,packetsSent:E.packetsSent,packetsLost:A?.packetsLost,retransmittedPacketsSent:E.retransmittedPacketsSent,bytesSent:E.bytesSent,headerBytesSent:E.headerBytesSent,retransmittedBytesSent:E.retransmittedBytesSent,totalPacketSendDelay:E.totalPacketSendDelay}}function eS(M){var E,A,O;const{outbound:F,remoteInbound:V,networkQuality:K}=M;return{networkQuality:K,nackCount:F.nackCount,packetsSent:F.packetsSent,packetsLost:V?.packetsLost,retransmittedPacketsSent:F.retransmittedPacketsSent,bytesSent:F.bytesSent,headerBytesSent:F.headerBytesSent,retransmittedBytesSent:F.retransmittedBytesSent,totalPacketSendDelay:F.totalPacketSendDelay,firCount:F.firCount,pliCount:F.pliCount,framesEncoded:F.framesEncoded,keyFramesEncoded:F.keyFramesEncoded,totalEncodeTime:F.totalEncodeTime,totalEncodedBytesTarget:F.totalEncodedBytesTarget,framesSent:F.framesSent,hugeFramesSent:F.hugeFramesSent,active:((E=F.framesPerSecond)!==null&&E!==void 0?E:0)!==0,qualityLimitationReason:F.qualityLimitationReason,qualityLimitationResolutionChanges:F.qualityLimitationResolutionChanges,qualityLimitationCpuDuration:(A=F.qualityLimitationDurations)===null||A===void 0?void 0:A.cpu,qualityLimitationBandwidthDuration:(O=F.qualityLimitationDurations)===null||O===void 0?void 0:O.bandwidth,frameWidth:F.frameWidth,frameHeight:F.frameHeight,framesPerSecond:F.framesPerSecond,rid:F.rid,ssrc:F.ssrc}}function tS(M,E){const A=new Map,O=new Map;for(const F of E.values())if(F.kind===M&&F.type==="outbound-rtp"&&F.ssrc){const V=F.rid||ye;O.set(F.ssrc,V);let K=A.get(V);K||(K={},A.set(V,K)),K.outbound=F}for(const F of E.values())if(F.kind===M&&F.type==="remote-inbound-rtp"&&F.ssrc){const V=O.get(F.ssrc)||ye,K=A.get(V);K&&(K.remoteInbound=F)}return A}function nS(M,E){const A=new Map;for(const O of E.values())if(O.kind===M&&O.type==="inbound-rtp"){const F=O.rid||ye;A.set(F,{inbound:O})}return A}function G_(M,E){return M!==fo.DOWN&&E!=null?E:M}const rS=(M,E)=>{const A=[],O=Do.getNetworkQuality(),F=tS("audio",M);for(const V of F.values())if(V.outbound){const K=V.outbound.rid||ye,ue=G_(O,E.get(K)),me=jd({outbound:V.outbound,remoteInbound:V.remoteInbound,networkQuality:ue});A.push(me)}if(A.length)return A},ky=(M,E)=>{const A=[],O=Do.getNetworkQuality(),F=tS("video",M);for(const V of F.values())if(V.outbound){const K=V.outbound.rid||ye,ue=eS({outbound:V.outbound,remoteInbound:V.remoteInbound});if(ue.active){const me=G_(O,E.get(K));ue.networkQuality=me}A.push(ue)}if(A.length)return A},iS=(M,E)=>{const A=[],O=Do.getNetworkQuality(),F=nS("audio",M);for(const K of F.values())if(K.inbound){const ue=K.inbound.id;if(!ue)continue;const me=G_(O,E.get(ue)),ce={networkQuality:(V={inbound:K.inbound,networkQuality:me}).networkQuality,nackCount:V.inbound.nackCount,packetsReceived:V.inbound.packetsReceived,packetsLost:V.inbound.packetsLost,packetsDiscarded:V.inbound.packetsDiscarded,bytesReceived:V.inbound.bytesReceived,headerBytesReceived:V.inbound.headerBytesReceived,jitterBufferDelay:V.inbound.jitterBufferDelay,jitterBufferEmittedCount:V.inbound.jitterBufferEmittedCount,jitter:V.inbound.jitter,totalSamplesReceived:V.inbound.totalSamplesReceived,concealedSamples:V.inbound.concealedSamples,silentConcealedSamples:V.inbound.silentConcealedSamples,concealmentEvents:V.inbound.concealmentEvents,insertedSamplesForDeceleration:V.inbound.insertedSamplesForDeceleration,removedSamplesForAcceleration:V.inbound.removedSamplesForAcceleration,audioLevel:V.inbound.audioLevel};A.push(ce)}var V;if(A.length)return A},sS=(M,E)=>{const A=[],O=Do.getNetworkQuality(),F=nS("video",M);for(const K of F.values())if(K.inbound){const ue=K.inbound.id;if(!ue)continue;const me={networkQuality:(V={inbound:K.inbound,networkQuality:G_(O,E.get(ue))}).networkQuality,nackCount:V.inbound.nackCount,packetsReceived:V.inbound.packetsReceived,packetsLost:V.inbound.packetsLost,packetsDiscarded:V.inbound.packetsDiscarded,bytesReceived:V.inbound.bytesReceived,headerBytesReceived:V.inbound.headerBytesReceived,jitterBufferDelay:V.inbound.jitterBufferDelay,jitterBufferEmittedCount:V.inbound.jitterBufferEmittedCount,jitter:V.inbound.jitter,pliCount:V.inbound.pliCount,firCount:V.inbound.firCount,framesReceived:V.inbound.framesReceived,framesDecoded:V.inbound.framesDecoded,keyFramesDecoded:V.inbound.keyFramesDecoded,framesDropped:V.inbound.framesDropped,totalDecodeTime:V.inbound.totalDecodeTime,totalInterFrameDelay:V.inbound.totalInterFrameDelay,totalSquaredInterFrameDelay:V.inbound.totalSquaredInterFrameDelay,pauseCount:V.inbound.pauseCount,totalPausesDuration:V.inbound.totalPausesDuration,freezeCount:V.inbound.freezeCount,totalFreezesDuration:V.inbound.totalFreezesDuration,frameWidth:V.inbound.frameWidth,frameHeight:V.inbound.frameHeight,framesPerSecond:V.inbound.framesPerSecond,ssrc:V.inbound.ssrc};A.push(me)}var V;if(A.length)return A};var vT=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};const oS="H264",aS=M=>{const E=M?.split("/");if(E?.length===2)return E[1]},_o=(M,E)=>{const A=aS(M);if(M===void 0||A===void 0)return;const O={mimeSubtype:A};if(E){const F=(V=>{const K=V.split(";"),ue=new Map;for(const me of K){const[ce,de]=me.split("=");ue.set(ce,de)}return ue})(E);switch(A){case oS:{const V=F.get("profile-level-id");V&&((K,ue)=>{if(ue.length<6)return;const me=ue.substring(0,4),ce=parseInt(ue.substring(4,6),16);K.profile=me,K.level=ce})(O,V);break}case"H265":((V,K)=>{const ue=K.get("profile-id")||"0",me=K.get("tier-flag")||"0",ce=parseInt(K.get("level-id")||"0",10),de=[me,ue].join("_");V.profile=de,V.level=ce})(O,F)}}return O},My=(M,E)=>M.sort(((A,O)=>{if(aS(A.mimeType)===oS){const F=_o(A.mimeType,A.sdpFmtpLine);if(F?.profile===E)return-1}return 0})),W_=(M,E)=>{var A;const O=_o(M.mimeType,M.sdpFmtpLine);return O?.mimeSubtype.toLowerCase()===E.mime.toLowerCase()&&((A=O?.profile)===null||A===void 0?void 0:A.toLowerCase().indexOf(E.config.toLowerCase()))===0},yT=(M,E)=>E.filter((A=>!A.mimeType.endsWith("rtx"))).filter((A=>A.mimeType.indexOf("packetization-mode=0")===-1)).find((A=>M.reduce(((O,F)=>O&&W_(A,F)===!1),!0)));class q_ extends Kn{constructor(E,A,O,F,V,K,ue,me,ce){var de,we;super(Mn.PUBLISHED_VIDEO_STATS,E,A,!1),Object.assign(this.properties,Object.assign({action:Qt.PUBLISH,node:(de=O?.node)!==null&&de!==void 0?de:"",cluster:(we=O?.cluster)!==null&&we!==void 0?we:""},((Me,nt,bt,ut,dt,Qe)=>{var st,It,En,Dn,Xn,g,y,k,j,ne,le,Ne,Ze,St,Dt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,pt,Mt,on,Hn,Pr,Qn,pr,Ii,Ir,Ws;const rl=(It=(st=Me?.qualityLimitationDurations)===null||st===void 0?void 0:st.cpu)!==null&&It!==void 0?It:0,au=(Dn=(En=Me?.qualityLimitationDurations)===null||En===void 0?void 0:En.bandwidth)!==null&&Dn!==void 0?Dn:0,il=Math.max((Xn=Me?.bytesSent)!==null&&Xn!==void 0?Xn:0,0),tf=8*il/(Qe??1),rh=Math.max((g=nt?.packetsLost)!==null&&g!==void 0?g:0,0),nf=Math.max((y=Me?.packetsSent)!==null&&y!==void 0?y:0,0),Hf=rh/Math.max(nf,1),kl=_o(ut?.mimeType,ut?.sdpFmtpLine);return{active:!!Me?.framesPerSecond&&Me.framesPerSecond!==0,bytes_sent:il,codec_mime_type:kl?.mimeSubtype,codec_profile:kl?.profile,codec_level:kl?.level,configured_bitrate:dt?.max_bitrate,connection_bandwidth:(j=(k=bt?.candidatePair)===null||k===void 0?void 0:k.availableOutgoingBitrate)!==null&&j!==void 0?j:0,encode_bitrate:tf,encoder_implementation:(ne=Me?.encoderImplementation)!==null&&ne!==void 0?ne:"unknown",fir_count:(le=Me?.firCount)!==null&&le!==void 0?le:0,fraction_packets_lost:Hf,frame_height:Math.max((Ne=Me?.frameHeight)!==null&&Ne!==void 0?Ne:0,0),frame_width:Math.max((Ze=Me?.frameWidth)!==null&&Ze!==void 0?Ze:0,0),frames_encoded:(St=Me?.framesEncoded)!==null&&St!==void 0?St:0,frames_per_second:Math.max((Dt=Me?.framesPerSecond)!==null&&Dt!==void 0?Dt:0,0),frames_sent:(Kt=Me?.framesSent)!==null&&Kt!==void 0?Kt:0,header_bytes_sent:(Xt=Me?.headerBytesSent)!==null&&Xt!==void 0?Xt:0,huge_frames_sent:(vn=Me?.hugeFramesSent)!==null&&vn!==void 0?vn:0,key_frames_encoded:(Zn=Me?.keyFramesEncoded)!==null&&Zn!==void 0?Zn:0,nack_count:(Nr=Me?.nackCount)!==null&&Nr!==void 0?Nr:0,packets_lost:rh,packets_sent:nf,power_efficient_encoder:(Vi=Me?.powerEfficientEncoder)!==null&&Vi!==void 0&&Vi,pli_count:(Hi=Me?.pliCount)!==null&&Hi!==void 0?Hi:0,quality_limitation_reason:(Tt=Me?.qualityLimitationReason)!==null&&Tt!==void 0?Tt:"none",quality_limitation_resolution_changes:(pt=Me?.qualityLimitationResolutionChanges)!==null&&pt!==void 0?pt:0,quality_limitation_cpu_duration:rl,quality_limitation_bandwidth_duration:au,retransmitted_bytes_sent:(Mt=Me?.retransmittedBytesSent)!==null&&Mt!==void 0?Mt:0,retransmitted_packets_sent:(on=Me?.retransmittedPacketsSent)!==null&&on!==void 0?on:0,rid:(Hn=Me?.rid)!==null&&Hn!==void 0?Hn:ye,scalability_mode:(Pr=Me?.scalabilityMode)!==null&&Pr!==void 0?Pr:"unknown",target_bitrate:Math.max((Qn=Me?.targetBitrate)!==null&&Qn!==void 0?Qn:0,0),total_encode_time:(pr=Me?.totalEncodeTime)!==null&&pr!==void 0?pr:0,total_encoded_bytes_target:(Ii=Me?.totalEncodedBytesTarget)!==null&&Ii!==void 0?Ii:0,total_packet_send_delay:(Ir=Me?.totalPacketSendDelay)!==null&&Ir!==void 0?Ir:0,protocol:(Ws=bt?.localCandidate)===null||Ws===void 0?void 0:Ws.protocol}})(F,V,K,ue,me,ce)))}}class cS extends Kn{constructor(E,A,O,F,V,K,ue,me,ce,de,we,Me){var nt,bt,ut,dt;super(Mn.PUBLISHED_VIDEO_STATS_WINDOW,E,A,!1);const Qe=Math.max(((nt=F?.timestamp)!==null&&nt!==void 0?nt:0)-((bt=V?.timestamp)!==null&&bt!==void 0?bt:0),0);Object.assign(this.properties,Object.assign({action:Qt.PUBLISH,node:(ut=O?.node)!==null&&ut!==void 0?ut:"",cluster:(dt=O?.cluster)!==null&&dt!==void 0?dt:"",window_size_ms:Qe},((st,It,En,Dn,Xn,g,y,k,j,ne)=>{var le,Ne,Ze,St,Dt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,pt,Mt,on,Hn,Pr,Qn,pr,Ii,Ir,Ws,rl,au,il,tf,rh,nf,Hf,kl,cm,_0,Kd,lm,v0,um,hm,y0,fm,dm,pm,xS,TS,wS,AS,IT,OT,NT,PT,Hy,CS,DT,mm;const H3=(Ne=(le=st?.qualityLimitationDurations)===null||le===void 0?void 0:le.cpu)!==null&&Ne!==void 0?Ne:0,XC=(St=(Ze=It?.qualityLimitationDurations)===null||Ze===void 0?void 0:Ze.cpu)!==null&&St!==void 0?St:0,ZC=(Kt=(Dt=st?.qualityLimitationDurations)===null||Dt===void 0?void 0:Dt.bandwidth)!==null&&Kt!==void 0?Kt:0,Goe=(vn=(Xt=It?.qualityLimitationDurations)===null||Xt===void 0?void 0:Xt.bandwidth)!==null&&vn!==void 0?vn:0,qB=Math.max(((Zn=st?.bytesSent)!==null&&Zn!==void 0?Zn:0)-((Nr=It?.bytesSent)!==null&&Nr!==void 0?Nr:0),0),YB=typeof k!="number"?1:k/1e3,Woe=8*qB/YB,KB=Math.max(((Vi=En?.packetsLost)!==null&&Vi!==void 0?Vi:0)-((Hi=Dn?.packetsLost)!==null&&Hi!==void 0?Hi:0),0),XB=Math.max(((Tt=st?.packetsSent)!==null&&Tt!==void 0?Tt:0)-((pt=It?.packetsSent)!==null&&pt!==void 0?pt:0),0),qoe=KB/Math.max(XB,1),RS=_o(g?.mimeType,g?.sdpFmtpLine),Yoe=8*(ne||0)/YB;return{active:!!st?.framesPerSecond&&st?.framesPerSecond!==0,bytes_sent:qB,codec_mime_type:RS?.mimeSubtype,codec_profile:RS?.profile,codec_level:RS?.level,configured_bitrate:y?.max_bitrate,connection_bandwidth:(on=(Mt=Xn?.candidatePair)===null||Mt===void 0?void 0:Mt.availableOutgoingBitrate)!==null&&on!==void 0?on:0,encode_bitrate:Woe,encoder_implementation:(Hn=st?.encoderImplementation)!==null&&Hn!==void 0?Hn:"unknown",fir_count:Math.max(((Pr=st?.firCount)!==null&&Pr!==void 0?Pr:0)-((Qn=It?.firCount)!==null&&Qn!==void 0?Qn:0),0),fraction_packets_lost:qoe,frame_height:Math.max((pr=st?.frameHeight)!==null&&pr!==void 0?pr:0,0),frame_width:Math.max((Ii=st?.frameWidth)!==null&&Ii!==void 0?Ii:0,0),frames_encoded:Math.max(((Ir=st?.framesEncoded)!==null&&Ir!==void 0?Ir:0)-((Ws=It?.framesEncoded)!==null&&Ws!==void 0?Ws:0),0),frames_per_second:Math.max((rl=st?.framesPerSecond)!==null&&rl!==void 0?rl:0,0),frames_sent:Math.max(((au=st?.framesSent)!==null&&au!==void 0?au:0)-((il=It?.framesSent)!==null&&il!==void 0?il:0),0),header_bytes_sent:Math.max(((tf=st?.headerBytesSent)!==null&&tf!==void 0?tf:0)-((rh=It?.headerBytesSent)!==null&&rh!==void 0?rh:0),0),huge_frames_sent:Math.max(((nf=st?.hugeFramesSent)!==null&&nf!==void 0?nf:0)-((Hf=It?.hugeFramesSent)!==null&&Hf!==void 0?Hf:0),0),key_frames_encoded:Math.max(((kl=st?.keyFramesEncoded)!==null&&kl!==void 0?kl:0)-((cm=It?.keyFramesEncoded)!==null&&cm!==void 0?cm:0),0),nack_count:Math.max(((_0=st?.nackCount)!==null&&_0!==void 0?_0:0)-((Kd=It?.nackCount)!==null&&Kd!==void 0?Kd:0),0),packets_lost:KB,packets_sent:XB,power_efficient_encoder:(lm=st?.powerEfficientEncoder)!==null&&lm!==void 0&&lm,pli_count:Math.max(((v0=st?.pliCount)!==null&&v0!==void 0?v0:0)-((um=It?.pliCount)!==null&&um!==void 0?um:0),0),quality_limitation_reason:(hm=st?.qualityLimitationReason)!==null&&hm!==void 0?hm:"none",quality_limitation_resolution_changes:Math.max(((y0=st?.qualityLimitationResolutionChanges)!==null&&y0!==void 0?y0:0)-((fm=It?.qualityLimitationResolutionChanges)!==null&&fm!==void 0?fm:0),0),quality_limitation_cpu_duration:Math.max(H3-XC,0),quality_limitation_bandwidth_duration:Math.max(ZC-Goe,0),retransmitted_bytes_sent:Math.max(((dm=st?.retransmittedBytesSent)!==null&&dm!==void 0?dm:0)-((pm=It?.retransmittedBytesSent)!==null&&pm!==void 0?pm:0),0),rid:(xS=st?.rid)!==null&&xS!==void 0?xS:ye,retransmitted_packets_sent:Math.max(((TS=st?.retransmittedPacketsSent)!==null&&TS!==void 0?TS:0)-((wS=It?.retransmittedPacketsSent)!==null&&wS!==void 0?wS:0),0),scalability_mode:(AS=st?.scalabilityMode)!==null&&AS!==void 0?AS:"unknown",target_bitrate:Math.max((IT=st?.targetBitrate)!==null&&IT!==void 0?IT:0,0),total_encode_time:Math.max(((OT=st?.totalEncodeTime)!==null&&OT!==void 0?OT:0)-((NT=It?.totalEncodeTime)!==null&&NT!==void 0?NT:0),0),total_encoded_bytes_target:Math.max(((PT=st?.totalEncodedBytesTarget)!==null&&PT!==void 0?PT:0)-((Hy=It?.totalEncodedBytesTarget)!==null&&Hy!==void 0?Hy:0),0),total_packet_send_delay:Math.max(((CS=st?.totalPacketSendDelay)!==null&&CS!==void 0?CS:0)-((DT=It?.totalPacketSendDelay)!==null&&DT!==void 0?DT:0),0),sei_write_count:j,sei_bytes_sent:ne,sei_bitrate:Yoe,protocol:(mm=Xn?.localCandidate)===null||mm===void 0?void 0:mm.protocol}})(F,V,K,ue,me,ce,de,Qe,we,Me)))}}class lS extends Kn{constructor(E,A,O,F,V,K,ue,me,ce,de){var we,Me;super(Mn.PUBLISHED_AUDIO_STATS,E,A,!1),Object.assign(this.properties,Object.assign({action:Qt.PUBLISH,node:(we=O?.node)!==null&&we!==void 0?we:"",cluster:(Me=O?.cluster)!==null&&Me!==void 0?Me:""},((nt,bt,ut,dt,Qe,st,It)=>{var En,Dn,Xn,g,y,k,j,ne,le,Ne,Ze,St,Dt;const Kt=Math.max((En=nt?.bytesSent)!==null&&En!==void 0?En:0,0),Xt=8*Kt/(st??1),vn=Math.max((Dn=bt?.packetsLost)!==null&&Dn!==void 0?Dn:0,0),Zn=Math.max((Xn=nt?.packetsSent)!==null&&Xn!==void 0?Xn:0,0),Nr=vn/Math.max(Zn,1),Vi=_o(dt?.mimeType,dt?.sdpFmtpLine);return{audio_nacks_enabled:(g=It?.audioNacks)!==null&&g!==void 0&&g,bytes_sent:Kt,codec_mime_type:Vi?.mimeSubtype,configured_bitrate:(y=Qe?.max_audio_bitrate_bps)!==null&&y!==void 0?y:0,connection_bandwidth:(j=(k=ut?.candidatePair)===null||k===void 0?void 0:k.availableOutgoingBitrate)!==null&&j!==void 0?j:0,encode_bitrate:Xt,fraction_packets_lost:Nr,header_bytes_sent:(ne=nt?.headerBytesSent)!==null&&ne!==void 0?ne:0,nack_count:(le=nt?.nackCount)!==null&&le!==void 0?le:0,packets_lost:vn,packets_sent:Zn,retransmitted_bytes_sent:(Ne=nt?.retransmittedBytesSent)!==null&&Ne!==void 0?Ne:0,retransmitted_packets_sent:(Ze=nt?.retransmittedPacketsSent)!==null&&Ze!==void 0?Ze:0,target_bitrate:(St=nt?.targetBitrate)!==null&&St!==void 0?St:0,protocol:(Dt=ut?.localCandidate)===null||Dt===void 0?void 0:Dt.protocol}})(F,V,K,ue,me,ce,de)))}}class Iy extends Kn{constructor(E,A,O,F,V,K,ue,me,ce,de,we){var Me,nt,bt,ut;super(Mn.PUBLISHED_AUDIO_STATS_WINDOW,E,A,!1);const dt=Math.max(((Me=F?.timestamp)!==null&&Me!==void 0?Me:0)-((nt=V?.timestamp)!==null&&nt!==void 0?nt:0),0);Object.assign(this.properties,Object.assign({action:Qt.PUBLISH,node:(bt=O?.node)!==null&&bt!==void 0?bt:"",cluster:(ut=O?.cluster)!==null&&ut!==void 0?ut:"",window_size_ms:dt},((Qe,st,It,En,Dn,Xn,g,y,k)=>{var j,ne,le,Ne,Ze,St,Dt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,pt,Mt,on,Hn,Pr,Qn,pr;const Ii=Math.max(((j=Qe?.bytesSent)!==null&&j!==void 0?j:0)-((ne=st?.bytesSent)!==null&&ne!==void 0?ne:0),0),Ir=8*Ii/(typeof y!="number"?1:y/1e3),Ws=Math.max(((le=It?.packetsLost)!==null&&le!==void 0?le:0)-((Ne=En?.packetsLost)!==null&&Ne!==void 0?Ne:0),0),rl=Math.max(((Ze=Qe?.packetsSent)!==null&&Ze!==void 0?Ze:0)-((St=st?.packetsSent)!==null&&St!==void 0?St:0),0),au=Ws/Math.max(rl,1),il=_o(Xn?.mimeType,Xn?.sdpFmtpLine);return{audio_nacks_enabled:(Dt=k?.audioNacks)!==null&&Dt!==void 0&&Dt,bytes_sent:Ii,codec_mime_type:il?.mimeSubtype,configured_bitrate:(Kt=g?.max_audio_bitrate_bps)!==null&&Kt!==void 0?Kt:0,connection_bandwidth:(vn=(Xt=Dn?.candidatePair)===null||Xt===void 0?void 0:Xt.availableOutgoingBitrate)!==null&&vn!==void 0?vn:0,encode_bitrate:Ir,fraction_packets_lost:au,header_bytes_sent:Math.max(((Zn=Qe?.headerBytesSent)!==null&&Zn!==void 0?Zn:0)-((Nr=st?.headerBytesSent)!==null&&Nr!==void 0?Nr:0),0),nack_count:Math.max(((Vi=Qe?.nackCount)!==null&&Vi!==void 0?Vi:0)-((Hi=st?.nackCount)!==null&&Hi!==void 0?Hi:0),0),packets_lost:Ws,packets_sent:Math.max(((Tt=Qe?.packetsSent)!==null&&Tt!==void 0?Tt:0)-((pt=st?.packetsSent)!==null&&pt!==void 0?pt:0),0),retransmitted_bytes_sent:Math.max(((Mt=Qe?.retransmittedBytesSent)!==null&&Mt!==void 0?Mt:0)-((on=st?.retransmittedBytesSent)!==null&&on!==void 0?on:0),0),retransmitted_packets_sent:Math.max(((Hn=Qe?.retransmittedPacketsSent)!==null&&Hn!==void 0?Hn:0)-((Pr=st?.retransmittedPacketsSent)!==null&&Pr!==void 0?Pr:0),0),target_bitrate:Math.max((Qn=Qe?.targetBitrate)!==null&&Qn!==void 0?Qn:0,0),protocol:(pr=Dn?.localCandidate)===null||pr===void 0?void 0:pr.protocol}})(F,V,K,ue,me,ce,de,dt,we)))}}class n0 extends Kn{constructor(E,A,O,F,V,K,ue,me){var ce,de;super(Mn.SUBSCRIBED_VIDEO_STATS,E,A,!1),Object.assign(this.properties,Object.assign({action:Qt.SUBSCRIBE,node:(ce=F?.node)!==null&&ce!==void 0?ce:"",cluster:(de=F?.cluster)!==null&&de!==void 0?de:"",remote_participant_id:O},((we,Me,nt,bt)=>{var ut,dt,Qe,st,It,En,Dn,Xn,g,y,k,j,ne,le,Ne,Ze,St,Dt,Kt,Xt,vn,Zn,Nr,Vi;let Hi=0;we?.jitterBufferDelay&&we?.jitterBufferEmittedCount&&we.jitterBufferEmittedCount>0&&(Hi=we.jitterBufferDelay/we.jitterBufferEmittedCount);const Tt=bt??1,pt=Math.max((ut=we?.bytesReceived)!==null&&ut!==void 0?ut:0,0),Mt=8*pt/Tt;let on=0;we?.totalDecodeTime&&we?.framesDecoded&&(on=we.totalDecodeTime/Math.max(we?.framesDecoded,1));const Hn=Math.max((dt=we?.packetsLost)!==null&&dt!==void 0?dt:0,0),Pr=Math.max((Qe=we?.packetsReceived)!==null&&Qe!==void 0?Qe:0,0),Qn=Hn/Math.max(Pr+Hn,1),pr=_o(nt?.mimeType,nt?.sdpFmtpLine);return{bytes_received:pt,codec_mime_type:pr?.mimeSubtype,codec_profile:pr?.profile,codec_level:pr?.level,connection_bandwidth:(It=(st=Me?.candidatePair)===null||st===void 0?void 0:st.availableIncomingBitrate)!==null&&It!==void 0?It:0,decode_bitrate:Mt,decoder_implementation:(En=we?.decoderImplementation)!==null&&En!==void 0?En:"unknown",fir_count:Math.max((Dn=we?.firCount)!==null&&Dn!==void 0?Dn:0,0),fraction_packets_lost:Qn,frame_decode_time_avg:on,frame_height:Math.max((Xn=we?.frameHeight)!==null&&Xn!==void 0?Xn:0,0),frame_width:Math.max((g=we?.frameWidth)!==null&&g!==void 0?g:0,0),frames_decoded:Math.max((y=we?.framesDecoded)!==null&&y!==void 0?y:0,0),frames_dropped:Math.max((k=we?.framesDropped)!==null&&k!==void 0?k:0,0),frames_received:Math.max((j=we?.framesReceived)!==null&&j!==void 0?j:0,0),freeze_count:Math.max((ne=we?.freezeCount)!==null&&ne!==void 0?ne:0,0),frames_rendered:Math.max((le=we?.framesRendered)!==null&&le!==void 0?le:0,0),frames_per_second:Math.max((Ne=we?.framesPerSecond)!==null&&Ne!==void 0?Ne:0,0),header_bytes_received:Math.max((Ze=we?.headerBytesReceived)!==null&&Ze!==void 0?Ze:0,0),jitter_buffer_delay_avg:Hi,key_frames_decoded:Math.max((St=we?.keyFramesDecoded)!==null&&St!==void 0?St:0,0),nack_count:Math.max((Dt=we?.nackCount)!==null&&Dt!==void 0?Dt:0,0),packets_discarded:Math.max((Kt=we?.packetsDiscarded)!==null&&Kt!==void 0?Kt:0,0),packets_lost:Hn,packets_received:Pr,pause_count:Math.max((Xt=we?.pauseCount)!==null&&Xt!==void 0?Xt:0,0),pli_count:Math.max((vn=we?.pliCount)!==null&&vn!==void 0?vn:0,0),power_efficient_decoder:(Zn=we?.powerEfficientDecoder)!==null&&Zn!==void 0&&Zn,total_freezes_duration:Math.max((Nr=we?.totalFreezesDuration)!==null&&Nr!==void 0?Nr:0,0),total_pauses_duration:Math.max((Vi=we?.totalPausesDuration)!==null&&Vi!==void 0?Vi:0,0)}})(V,K,ue,me)))}}class uS extends Kn{constructor(E,A,O,F,V,K,ue,me,ce,de,we){var Me,nt,bt,ut;super(Mn.SUBSCRIBED_VIDEO_STATS_WINDOW,E,A,!1);const dt=Math.max(((Me=V?.timestamp)!==null&&Me!==void 0?Me:0)-((nt=K?.timestamp)!==null&&nt!==void 0?nt:0),0);Object.assign(this.properties,Object.assign({action:Qt.SUBSCRIBE,node:(bt=F?.node)!==null&&bt!==void 0?bt:"",cluster:(ut=F?.cluster)!==null&&ut!==void 0?ut:"",window_size_ms:dt,remote_participant_id:O},((Qe,st,It,En,Dn,Xn,g,y)=>{var k,j,ne,le,Ne,Ze,St,Dt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,pt,Mt,on,Hn,Pr,Qn,pr,Ii,Ir,Ws,rl,au,il,tf,rh,nf,Hf,kl,cm,_0,Kd,lm,v0,um,hm,y0,fm,dm,pm;let xS=0,TS=0;if(Qe?.jitterBufferEmittedCount&&st?.jitterBufferEmittedCount&&Qe.jitterBufferEmittedCount>st.jitterBufferEmittedCount){Qe?.jitterBufferDelay&&st?.jitterBufferDelay&&(xS=(Qe.jitterBufferDelay-st.jitterBufferDelay)/(Qe.jitterBufferEmittedCount-st.jitterBufferEmittedCount));const XC=st?.jitterBufferMinimumDelay,ZC=Qe?.jitterBufferMinimumDelay;XC&&ZC&&(TS=(ZC-XC)/(Qe.jitterBufferEmittedCount-st.jitterBufferEmittedCount))}const wS=Math.max(((k=Qe?.bytesReceived)!==null&&k!==void 0?k:0)-((j=st?.bytesReceived)!==null&&j!==void 0?j:0),0),AS=typeof Dn!="number"?1:Dn/1e3,IT=8*wS/AS,OT=Math.max(((ne=Qe?.totalDecodeTime)!==null&&ne!==void 0?ne:0)-((le=st?.totalDecodeTime)!==null&&le!==void 0?le:0),0),NT=Math.max(((Ne=Qe?.framesDecoded)!==null&&Ne!==void 0?Ne:0)-((Ze=st?.framesDecoded)!==null&&Ze!==void 0?Ze:0),0),PT=OT/Math.max(NT,1),Hy=Math.max(((St=Qe?.packetsLost)!==null&&St!==void 0?St:0)-((Dt=st?.packetsLost)!==null&&Dt!==void 0?Dt:0),0),CS=Math.max(((Kt=Qe?.packetsReceived)!==null&&Kt!==void 0?Kt:0)-((Xt=st?.packetsReceived)!==null&&Xt!==void 0?Xt:0),0),DT=Hy/Math.max(CS+Hy,1),mm=_o(En?.mimeType,En?.sdpFmtpLine),H3=8*(y||0)/AS;return{bytes_received:wS,codec_mime_type:mm?.mimeSubtype,codec_profile:mm?.profile,codec_level:mm?.level,connection_bandwidth:(Zn=(vn=It?.candidatePair)===null||vn===void 0?void 0:vn.availableIncomingBitrate)!==null&&Zn!==void 0?Zn:0,decode_bitrate:IT,decoder_implementation:(Nr=Qe?.decoderImplementation)!==null&&Nr!==void 0?Nr:"unknown",fir_count:Math.max(((Vi=Qe?.firCount)!==null&&Vi!==void 0?Vi:0)-((Hi=st?.firCount)!==null&&Hi!==void 0?Hi:0),0),fraction_packets_lost:DT,frame_decode_time_avg:PT,frame_height:Math.max((Tt=Qe?.frameHeight)!==null&&Tt!==void 0?Tt:0,0),frame_width:Math.max((pt=Qe?.frameWidth)!==null&&pt!==void 0?pt:0,0),frames_decoded:Math.max(((Mt=Qe?.framesDecoded)!==null&&Mt!==void 0?Mt:0)-((on=st?.framesDecoded)!==null&&on!==void 0?on:0),0),frames_dropped:Math.max(((Hn=Qe?.framesDropped)!==null&&Hn!==void 0?Hn:0)-((Pr=st?.framesDropped)!==null&&Pr!==void 0?Pr:0),0),frames_received:Math.max(((Qn=Qe?.framesReceived)!==null&&Qn!==void 0?Qn:0)-((pr=st?.framesReceived)!==null&&pr!==void 0?pr:0),0),freeze_count:Math.max(((Ii=Qe?.freezeCount)!==null&&Ii!==void 0?Ii:0)-((Ir=st?.freezeCount)!==null&&Ir!==void 0?Ir:0),0),frames_rendered:Math.max((Ws=Qe?.framesRendered)!==null&&Ws!==void 0?Ws:0,0),frames_per_second:Math.max((rl=Qe?.framesPerSecond)!==null&&rl!==void 0?rl:0,0),header_bytes_received:Math.max(((au=Qe?.headerBytesReceived)!==null&&au!==void 0?au:0)-((il=st?.headerBytesReceived)!==null&&il!==void 0?il:0),0),configured_jitter_buffer_min_delay_ms:Xn??0,jitter_buffer_min_obtainable_delay:TS,jitter_buffer_delay_avg:xS,key_frames_decoded:Math.max(((tf=Qe?.keyFramesDecoded)!==null&&tf!==void 0?tf:0)-((rh=st?.keyFramesDecoded)!==null&&rh!==void 0?rh:0),0),nack_count:Math.max(((nf=Qe?.nackCount)!==null&&nf!==void 0?nf:0)-((Hf=st?.nackCount)!==null&&Hf!==void 0?Hf:0),0),packets_discarded:Math.max(((kl=Qe?.packetsDiscarded)!==null&&kl!==void 0?kl:0)-((cm=st?.packetsDiscarded)!==null&&cm!==void 0?cm:0),0),packets_lost:Hy,packets_received:CS,pause_count:Math.max(((_0=Qe?.pauseCount)!==null&&_0!==void 0?_0:0)-((Kd=st?.pauseCount)!==null&&Kd!==void 0?Kd:0),0),pli_count:Math.max(((lm=Qe?.pliCount)!==null&&lm!==void 0?lm:0)-((v0=st?.pliCount)!==null&&v0!==void 0?v0:0),0),power_efficient_decoder:(um=Qe?.powerEfficientDecoder)!==null&&um!==void 0&&um,total_freezes_duration:Math.max(((hm=Qe?.totalFreezesDuration)!==null&&hm!==void 0?hm:0)-((y0=st?.totalFreezesDuration)!==null&&y0!==void 0?y0:0),0),total_pauses_duration:Math.max(((fm=Qe?.totalPausesDuration)!==null&&fm!==void 0?fm:0)-((dm=st?.totalPausesDuration)!==null&&dm!==void 0?dm:0),0),sei_read_count:g,sei_bytes_received:y,sei_bitrate:H3,protocol:(pm=It?.localCandidate)===null||pm===void 0?void 0:pm.protocol}})(V,K,ue,me,dt,ce,de,we)))}}class bT extends Kn{constructor(E,A,O,F,V,K,ue,me,ce){var de,we;super(Mn.SUBSCRIBED_AUDIO_STATS,E,A,!1),Object.assign(this.properties,Object.assign({action:Qt.SUBSCRIBE,node:(de=F?.node)!==null&&de!==void 0?de:"",cluster:(we=F?.cluster)!==null&&we!==void 0?we:"",remote_participant_id:O},((Me,nt,bt,ut,dt)=>{var Qe,st,It,En,Dn,Xn,g,y,k,j,ne,le,Ne,Ze,St,Dt,Kt,Xt;let vn=0;Me?.jitterBufferDelay&&Me?.jitterBufferEmittedCount&&Me.jitterBufferEmittedCount>0&&(vn=Me.jitterBufferDelay/Me.jitterBufferEmittedCount);const Zn=ut??1,Nr=Math.max((Qe=Me?.bytesReceived)!==null&&Qe!==void 0?Qe:0,0),Vi=8*Nr/Zn,Hi=Math.max((st=Me?.packetsLost)!==null&&st!==void 0?st:0,0),Tt=Math.max((It=Me?.packetsReceived)!==null&&It!==void 0?It:0,0),pt=Hi/Math.max(Tt+Hi,1),Mt=Math.max((En=Me?.concealedSamples)!==null&&En!==void 0?En:0,0),on=Math.max((Dn=Me?.totalSamplesReceived)!==null&&Dn!==void 0?Dn:0,0),Hn=Mt/Math.max(on,1),Pr=_o(bt?.mimeType,bt?.sdpFmtpLine);return{audio_level:(Xn=Me?.audioLevel)!==null&&Xn!==void 0?Xn:0,audio_nacks_enabled:(g=dt?.audioNacks)!==null&&g!==void 0&&g,bytes_received:Nr,codec_mime_type:Pr?.mimeSubtype,connection_bandwidth:(k=(y=nt?.candidatePair)===null||y===void 0?void 0:y.availableIncomingBitrate)!==null&&k!==void 0?k:0,concealed_samples:Mt,concealment_events:Math.max((j=Me?.concealmentEvents)!==null&&j!==void 0?j:0,0),silent_concealed_samples:Math.max((ne=Me?.silentConcealedSamples)!==null&&ne!==void 0?ne:0,0),decode_bitrate:Vi,fraction_audio_concealed:Hn,fraction_packets_lost:pt,header_bytes_received:Math.max((le=Me?.headerBytesReceived)!==null&&le!==void 0?le:0,0),inserted_samples_for_deceleration:Math.max((Ne=Me?.insertedSamplesForDeceleration)!==null&&Ne!==void 0?Ne:0,0),jitter_buffer_delay_avg:vn,packets_discarded:Math.max((Ze=Me?.packetsDiscarded)!==null&&Ze!==void 0?Ze:0,0),retransmitted_packets_received:Math.max((St=Me?.retransmittedPacketsReceived)!==null&&St!==void 0?St:0,0),retransmitted_bytes_received:Math.max((Dt=Me?.retransmittedBytesReceived)!==null&&Dt!==void 0?Dt:0,0),packets_lost:Hi,packets_received:Tt,nack_count:Math.max((Kt=Me?.nackCount)!==null&&Kt!==void 0?Kt:0,0),removed_samples_for_acceleration:Math.max((Xt=Me?.removedSamplesForAcceleration)!==null&&Xt!==void 0?Xt:0,0),total_samples_received:on}})(V,K,ue,me,ce)))}}class ST extends Kn{constructor(E,A,O,F,V,K,ue,me,ce,de){var we,Me,nt,bt;super(Mn.SUBSCRIBED_AUDIO_STATS_WINDOW,E,A,!1);const ut=Math.max(((we=V?.timestamp)!==null&&we!==void 0?we:0)-((Me=K?.timestamp)!==null&&Me!==void 0?Me:0),0);Object.assign(this.properties,Object.assign({action:Qt.SUBSCRIBE,window_size_ms:ut,node:(nt=F?.node)!==null&&nt!==void 0?nt:"",cluster:(bt=F?.cluster)!==null&&bt!==void 0?bt:"",remote_participant_id:O},((dt,Qe,st,It,En,Dn,Xn)=>{var g,y,k,j,ne,le,Ne,Ze,St,Dt,Kt,Xt,vn,Zn,Nr,Vi,Hi,Tt,pt,Mt,on,Hn,Pr,Qn,pr,Ii,Ir,Ws,rl,au,il,tf,rh;let nf=0,Hf=0;if(dt?.jitterBufferEmittedCount&&Qe?.jitterBufferEmittedCount&&dt.jitterBufferEmittedCount>Qe.jitterBufferEmittedCount){dt?.jitterBufferDelay&&Qe?.jitterBufferDelay&&(nf=(dt.jitterBufferDelay-Qe.jitterBufferDelay)/(dt.jitterBufferEmittedCount-Qe.jitterBufferEmittedCount));const dm=Qe?.jitterBufferMinimumDelay,pm=dt?.jitterBufferMinimumDelay;dm&&pm&&(Hf=(pm-dm)/(dt.jitterBufferEmittedCount-Qe.jitterBufferEmittedCount))}const kl=typeof En!="number"?1:En/1e3,cm=Math.max(((g=dt?.bytesReceived)!==null&&g!==void 0?g:0)-((y=Qe?.bytesReceived)!==null&&y!==void 0?y:0),0),_0=8*cm/kl,Kd=Math.max(((k=dt?.packetsLost)!==null&&k!==void 0?k:0)-((j=Qe?.packetsLost)!==null&&j!==void 0?j:0),0),lm=Math.max(((ne=dt?.packetsReceived)!==null&&ne!==void 0?ne:0)-((le=Qe?.packetsReceived)!==null&&le!==void 0?le:0),0),v0=Kd/Math.max(lm+Kd,1),um=Math.max(((Ne=dt?.concealedSamples)!==null&&Ne!==void 0?Ne:0)-((Ze=Qe?.concealedSamples)!==null&&Ze!==void 0?Ze:0),0),hm=Math.max(((St=dt?.totalSamplesReceived)!==null&&St!==void 0?St:0)-((Dt=Qe?.totalSamplesReceived)!==null&&Dt!==void 0?Dt:0),0),y0=um/Math.max(hm,1),fm=_o(It?.mimeType,It?.sdpFmtpLine);return{audio_level:(Kt=dt?.audioLevel)!==null&&Kt!==void 0?Kt:0,audio_nacks_enabled:(Xt=Dn?.audioNacks)!==null&&Xt!==void 0&&Xt,bytes_received:cm,codec_mime_type:fm?.mimeSubtype,connection_bandwidth:(Zn=(vn=st?.candidatePair)===null||vn===void 0?void 0:vn.availableIncomingBitrate)!==null&&Zn!==void 0?Zn:0,decode_bitrate:_0,concealed_samples:um,concealment_events:Math.max(((Nr=dt?.concealmentEvents)!==null&&Nr!==void 0?Nr:0)-((Vi=Qe?.concealmentEvents)!==null&&Vi!==void 0?Vi:0),0),silent_concealed_samples:Math.max(((Hi=dt?.silentConcealedSamples)!==null&&Hi!==void 0?Hi:0)-((Tt=Qe?.silentConcealedSamples)!==null&&Tt!==void 0?Tt:0),0),fraction_audio_concealed:y0,fraction_packets_lost:v0,header_bytes_received:Math.max(((pt=dt?.headerBytesReceived)!==null&&pt!==void 0?pt:0)-((Mt=Qe?.headerBytesReceived)!==null&&Mt!==void 0?Mt:0),0),inserted_samples_for_deceleration:Math.max(((on=dt?.insertedSamplesForDeceleration)!==null&&on!==void 0?on:0)-((Hn=Qe?.insertedSamplesForDeceleration)!==null&&Hn!==void 0?Hn:0),0),configured_jitter_buffer_min_delay_ms:Xn??0,jitter_buffer_min_obtainable_delay:Hf,jitter_buffer_delay_avg:nf,packets_discarded:Math.max(((Pr=dt?.packetsDiscarded)!==null&&Pr!==void 0?Pr:0)-((Qn=Qe?.packetsDiscarded)!==null&&Qn!==void 0?Qn:0),0),packets_lost:Kd,packets_received:lm,nack_count:Math.max(((pr=dt?.nackCount)!==null&&pr!==void 0?pr:0)-((Ii=Qe?.nackCount)!==null&&Ii!==void 0?Ii:0),0),removed_samples_for_acceleration:Math.max(((Ir=dt?.removedSamplesForAcceleration)!==null&&Ir!==void 0?Ir:0)-((Ws=Qe?.removedSamplesForAcceleration)!==null&&Ws!==void 0?Ws:0),0),retransmitted_packets_received:Math.max(((rl=dt?.retransmittedPacketsReceived)!==null&&rl!==void 0?rl:0)-((au=Qe?.retransmittedPacketsReceived)!==null&&au!==void 0?au:0),0),retransmitted_bytes_received:Math.max(((il=dt?.retransmittedBytesReceived)!==null&&il!==void 0?il:0)-((tf=Qe?.retransmittedBytesReceived)!==null&&tf!==void 0?tf:0),0),total_samples_received:hm,protocol:(rh=st?.localCandidate)===null||rh===void 0?void 0:rh.protocol}})(V,K,ue,me,ut,ce,de)))}}class Y_ extends Kn{constructor(E,A,O,F,V=Qt.PUBLISH,K=!1,ue=""){super(Mn.SIMULCAST_LAYER_INFO,E,A,!1),Object.assign(this.properties,{rid:O,active:F,selected:K,source:V===Qt.PUBLISH?"publisher":"subscriber",remote_participant_id:ue})}}const rm=M=>{console.warn(`[IVS Stages] ${M}`)};var im,sm,Uf;(function(M){M.Mobile="mobile",M.Tablet="tablet",M.Desktop="desktop",M.Tv="tv"})(im||(im={})),(function(M){M.IOS="iOS",M.MacOS="macOS",M.Windows="Windows",M.Android="Android"})(sm||(sm={})),(function(M){M.Safari="Safari",M.Firefox="Firefox",M.Chrome="Chrome",M.IE="Internet Explorer",M.Edge="Microsoft Edge"})(Uf||(Uf={}));const Kh=(function(M){const E=Bf(M);return{platform:{isMobile:K_(im.Mobile,E),isTablet:K_(im.Tablet,E),isDesktop:K_(im.Desktop,E),isTv:K_(im.Tv,E)},os:{name:xT(E),version:ET(E),isIOS:r0(sm.IOS,E),isMacOS:r0(sm.MacOS,E),isWindows:r0(sm.Windows,E),isAndroid:r0(sm.Android,E)},browser:{name:TT(E),version:hS(E),isSafari:i0(Uf.Safari,E),isFirefox:i0(Uf.Firefox,E),isChrome:i0(Uf.Chrome,E),isIE:i0(Uf.IE,E),isEdge:i0(Uf.Edge,E)}}})(window.navigator.userAgent);function Bf(M){try{return qr.getParser(M||window.navigator.userAgent)}catch{}}function K_(M,E){return()=>(E||(E=Bf()),!(!E||E.getPlatformType(!0)!==M.toLowerCase()))}function ET(M){return()=>(M||(M=Bf()),M&&M.getOSVersion()||"")}function xT(M){return()=>(M||(M=Bf()),M&&M.getOSName()||"")}function r0(M,E){return()=>(E||(E=Bf()),!(!E||E.getOSName(!0)!==M.toLowerCase()))}function hS(M){return()=>(M||(M=Bf()),M&&M.getBrowserVersion()||"")}function TT(M){return()=>(M||(M=Bf()),M&&M.getBrowserName()||"")}function i0(M,E){return()=>(E||(E=Bf()),!(!E||E.getBrowserName().toLowerCase()!==M.toLowerCase()))}const fS={name:"SimulcastUnsupported",message:`Simulcast is only supported on Chromium browsers at bitrates over ${xl.MID.maxBitrateKbps}Kbps`,code:100},Xh={name:"SimulcastLayerInvalidType",message:"Layer configuration is invalid: ",code:101},dS={name:"SimulcastMaxLayersExceeded",message:"No more than 3 simulcast layers may be configured",code:102},pS={name:"SimulcastDuplicateLayersConfigured",message:"Two duplicate layers are configured. At minimum bitrate, framerate, or dimensions must differ",code:103},s0={name:"SimulcastMaxLayerBitrateExceeded",message:`maxBitrateKbps cannot exceed ${Wu} Kbps`,code:105},Oy={name:"SimulcastMinLayerBitrateExceeded",message:`maxBitrateKbps cannot be less than ${Lf} Kbps`,code:106},Ny={name:"SimulcastMaxLayerFramerateExceeded",message:`maxFramerate cannot exceed ${Yu} fps`,code:107},X_={name:"SimulcastMinLayerFramerateExceeded",message:`maxFramerate cannot be less than ${qu} fps`,code:108},Z_={name:"SimulcastMaxLayerDimensionsExceeded",message:`dimensions cannot exceed max resolution of ${Fd}x720`,code:109},Py={name:"SimulcastMinLayerDimensionsExceeded",message:`width or height cannot be lower than ${tm}`,code:110},Dy={name:"SimulcastLayerConfigurationConflict",message:"Layer configuration conflict: ",code:111},mS={name:"SimulcastLayerOrientationMismatch",message:"Layer orientation different from input video track: ",code:112},o0={name:"SimulcastLayerInputResolutionInsufficient",message:"Input video resolution is lower than the configured layer: ",code:113},a0={name:"SimulcastLayerInputFramerateInsufficient",message:"Input video framerate is lower than the configured layer: ",code:114};class Bo extends Error{constructor({name:E,message:A,code:O,details:F,cause:V,params:K}){super(A),Error.captureStackTrace&&Error.captureStackTrace(this,Bo),this.name=E,this.message=A,this.code=O,this.details=F,this.cause=V,this.params=K}}const c0=M=>({rid:M.rid,active:M.active,scaleResolutionDownBy:M.scaleFactor,maxBitrate:M.maxBitrateBps,maxFramerate:M.maxFramerate}),gS=(M,E)=>M.width*M.height>E.width*E.height||M.maxBitrateKbps>E.maxBitrateKbps||M.maxFramerate>E.maxFramerate?1:Tl(M,E)?0:-1,Tl=(M,E)=>{if(typeof M!="object"||typeof E!="object")return!1;const A=Object.keys(M);for(const O of A)if(M[O]!==E[O])return!1;return!0},Jc=M=>{const{width:E,height:A}=l0(M);return E*A},l0=M=>{const{height:E,width:A}=M;let O=Fd/Qg,F=Fd;return E!==void 0&&(O=E),A!==void 0&&(F=A),E&&!A&&(F=E*Qg),!E&&A&&(O=A/Qg),{height:O,width:F}},Ly=M=>{const{width:E,height:A}=M;return E/A>=1?Lp.LANDSCAPE:Lp.PORTRAIT},Qc=(M,E,A)=>{var O;const F=(O=M.getSettings().frameRate)!==null&&O!==void 0?O:Yu;return Object.assign(Object.assign({},A),{active:!0,height:E.height,width:E.width,maxBitrateBps:eu(E.maxBitrateKbps),maxFramerate:Math.min(E.maxFramerate,F),scaleFactor:Ur(E,M)})},Ur=(M,E)=>{const A=Jc(E.getSettings()),O=Jc(M);if(O>=A)return 1;const F=1/Math.sqrt(O/A);return Math.max(F,1)},wT=M=>{if(typeof M!="object"){const E=Object.assign({},Xh);throw E.message+=" is not an object",new Bo(E)}},Qa=(M,E)=>{if(typeof M!="number"){const A=Object.assign({},Xh);throw A.message+="maxBitrateKbps is not a number",new Bo(A)}if(M<Lf)throw new Bo(Object.assign({},Oy));if(M>Wu)throw new Bo(Object.assign({},s0));if(E&&M>E){const A=Object.assign({},Dy);throw A.message+=`maxBitrateKbps cannot be greater than stage maxVideoBitrateKbps of ${E}`,new Bo(A)}},Js=(M,E)=>{if(typeof M!="number"){const A=Object.assign({},Xh);throw A.message+="maxFramerate is not a number",new Bo(A)}if(M<qu)throw new Bo(Object.assign({},X_));if(M>Yu)throw new Bo(Object.assign({},Ny));if(E&&M>E){const A=Object.assign({},Dy);throw A.message+=`maxFramerate cannot be greater than stage maxFramerate of ${E} `,new Bo(A)}},Ff=(M,E)=>{var A;if(typeof M!="number"||typeof E!="number"){const V=Object.assign({},Xh);throw V.message+="width and height must be numbers",new Bo(V)}if(M<tm||E<tm)throw new Bo(Object.assign({},Py));const O=(A=Gc("enable1080pResolution"))!==null&&A!==void 0&&A,F=O?1920:Fd;if(M>F||E>F)throw new Bo(Object.assign({},Z_));if(M*E>(O?2073600:Yh))throw new Bo(Object.assign({},Z_))},AT=(M,E)=>{const A=l0(E.getSettings()),O=Ly(A);O!==Ly(M)&&rm(`${mS.message}forcing orientation to ${O}`)},Uy=(M,E)=>{var A,O,F,V,K;let ue=(0,zi.cloneDeep)(E);const me=(A=ue.simulcast)!==null&&A!==void 0?A:{},ce=!Kh.browser.isChrome()&&!Kh.browser.isEdge(),de=(F=(O=M.getSettings())===null||O===void 0?void 0:O.displaySurface)!==null&&F!==void 0&&F,we=(V=ue.maxVideoBitrateKbps)!==null&&V!==void 0?V:Wu,Me=!(Array.isArray((K=E.simulcast)===null||K===void 0?void 0:K.layers)||!E.maxVideoBitrateKbps)&&we<xl.MID.maxBitrateKbps;if(typeof me.enabled=="boolean"&&me.enabled&&(ce||de||Me)){ue.simulcast={enabled:!1};const{name:nt,message:bt}=fS;rm(`${nt}${bt}, disabling the feature`)}return ue=((nt,bt)=>{var ut,dt;const Qe=bt,st=(ut=bt.simulcast)===null||ut===void 0?void 0:ut.layers;if(st===void 0)return Qe;if(!Array.isArray(st)){const It=Object.assign({},Xh);throw It.message+=" layers is not an array",new Bo(It)}if(st.length===0)return(dt=Qe.simulcast)===null||dt===void 0||delete dt.layers,Qe;if(st.length>3)throw new Bo(Object.assign({},dS));if((0,zi.uniqWith)(st,Tl).length!==st.length)throw new Bo(Object.assign({},pS));for(const It of st)wT(It),Qa(It.maxBitrateKbps,bt.maxVideoBitrateKbps),Js(It.maxFramerate,bt.maxFramerate),Ff(It.width,It.height),AT(It,nt);return Qe})(M,ue),ue};function wl(M){return M.track.kind===yl.AUDIO}function J_(M){return M.track.kind===yl.VIDEO&&typeof M.config=="object"}function Hs(M){if(M!==void 0&&(M<Lf||M>Wu))throw new Error(`Stage bitrate must be a number between ${Lf} kbps and ${Wu} kbps inclusive`)}function vs(M){return M!==void 0&&("maxBitrate"in M||"maxVideoBitrateKbps"in M||"maxFramerate"in M||"simulcast"in M||"inBandMessaging"in M||"minBitrate"in M)}function Qs(M,E){if(E===void 0)return E;let A=(0,zi.cloneDeep)(E);return vs(A)?(A.maxBitrate!==void 0&&(A.maxVideoBitrateKbps=A.maxBitrate,rm("maxBitrate is deprecated in favor of maxVideoBitrateKbps")),A=Uy(M,A),Hs(A.maxVideoBitrateKbps),Hs(A.minBitrate),(function(O){if(O!==void 0&&(O>Yu||O<qu))throw new Error(`Stage framerate must be between ${qu} fps and ${Yu} fps inclusive`)})(A.maxFramerate),(function(O){if(O!==void 0){if(typeof O!="object")throw new Error("In-band messaging config must be an object");if(typeof O.enabled!="boolean")throw new Error("In-band messaging config enabled property must be a boolean")}})(A.inBandMessaging)):((function(O){if(O!==void 0&&(O<e0||O>nm))throw new Error(`Stage audio bitrate must be between ${e0} Kbps and ${nm} Kbps inclusive`)})(A.maxAudioBitrateKbps),(function(O){if(O!==void 0&&typeof O!="boolean")throw new Error("Stage stereo prop must be a boolean")})(A.stereo)),A}const By=(M,E,A)=>{var O;const F={[vl.HI]:qh(vl.HI),[vl.MID]:qh(vl.MID),[vl.LOW]:qh(vl.LOW)},V=E.simulcast,K=A?.simulcast;let ue=V.layers.sort(gS);const me=(O=K?.layers)!==null&&O!==void 0?O:[],ce=ue.length,de=me.length;return ue=ue.map((we=>{((nt,bt)=>{const{width:ut,height:dt}=l0(bt.getSettings()),{width:Qe,height:st}=nt;if(Qe*st>ut*dt){const It=`forcing layer of ${Qe}x${st} to the input dimensions ${ut}x${dt}`,{name:En,message:Dn}=o0;rm(`${En}${Dn}${It}`)}})(we,M),((nt,bt)=>{var ut;const dt=(ut=bt.getSettings().frameRate)!==null&&ut!==void 0?ut:Yu,Qe=nt.maxFramerate;if(Qe>dt){const st=`forcing layer of ${Qe}fps to the input framerate of ${dt}`,{name:It,message:En}=a0;rm(`${It}${En}${st}`)}})(we,M);let Me=((nt,bt)=>{const{maxVideoBitrateKbps:ut}=bt,dt=nt;return ut&&nt.maxBitrateKbps>ut&&(dt.maxBitrateKbps=ut),dt})(we,E);return Me=((nt,bt)=>{const{maxFramerate:ut}=bt,dt=nt;return ut&&nt.maxFramerate>ut&&(dt.maxFramerate=ut),dt})(we,E),Me})),(de===0||de===3)&&ce===3?(F.hi=Qc(M,ue[2],F.hi),F.mid=Qc(M,ue[1],F.mid),F.low=Qc(M,ue[0],F.low),xn.ok(F)):de===1&&ce===1?(F.hi=Qc(M,ue[0],F.hi),xn.ok(F)):de===2&&ce===2?(F.hi=Qc(M,ue[1],F.hi),F.low=Qc(M,ue[0],F.low),xn.ok(F)):xn.err(null)},Fy=(M,E,A)=>{const O=E.simulcast,F=E.inBandMessaging,V=eu(E.minBitrate),K=eu(E.maxVideoBitrateKbps),ue=E.maxFramerate;let me=[{maxBitrate:K,maxFramerate:ue}];const ce=By(M,E,A??{});return O.enabled&&ce.ok&&(me=(de=>{const{hi:we,mid:Me,low:nt}=de;return[c0(nt),c0(Me),c0(we)]})(ce.value)),{track:M,config:{minBitrateBps:V,maxBitrateBps:K,maxFramerate:ue,inBandMessagingEnabled:F.enabled,simulcastEnabled:O.enabled,simulcastLayers:ce.ok?ce.value:void 0,encodingLayers:me}}},tu=M=>{const E=M.mediaStreamTrack,A=M.normalizedConfig;let O={};const F=M.validatedExternalConfig;return vs(F)&&(O=F),(function(V){return V.kind===yl.AUDIO})(E)?((V,K)=>{const ue={maxBitrateBps:eu(K.maxAudioBitrateKbps)},me=K?.stereo;return typeof me=="boolean"&&(ue.stereo=me),{track:V,config:ue}})(E,A):Fy(E,A,O)},u0=(M,E)=>{const A={minBitrate:Lf,maxBitrate:Wu,maxVideoBitrateKbps:Wu,maxFramerate:Yu,simulcast:{enabled:!1,layers:[Object.assign({},xl.HI),Object.assign({},xl.MID),Object.assign({},xl.LOW)]},maxAudioBitrateKbps:t0,stereo:!1,inBandMessaging:{enabled:!1}},O=(0,zi.cloneDeep)(E),F=Object.assign(Object.assign({},A),O);return vs(O)&&(O.simulcast&&(F.simulcast=Object.assign(Object.assign({},A.simulcast),O.simulcast)),O.inBandMessaging&&(F.inBandMessaging=Object.assign(Object.assign({},A.inBandMessaging),O.inBandMessaging))),F},Xu=(M,E)=>{if(typeof M=="number")return M;const A=E?Q1:Ku;return A[M]!==void 0?A[M]:0};class Zh extends Kn{constructor(E,A,O,F){super(Mn.MULTIHOST_CONFIGURATION,E,A,!1),Object.assign(this.properties,Object.assign(Object.assign({},O),{action:F}))}}class Es extends Kn{constructor(E,A,O,F,V){super(Mn.MULTIHOST_SUBSCRIBE_CONFIGURATION,E,A,!1);const K={trigger:O,remote_participant_id:F,min_delay_when_publishing:Xu(V.jitterBuffer.minDelayWhenPublishing,!0),min_delay_when_subscribe_only:Xu(V.jitterBuffer.minDelayWhenSubscribeOnly,!1),in_band_messaging_enabled:V.inBandMessaging.enabled,simulcast_initial_layer_preference:V.simulcast.initialLayerPreference,simulcast_layer_poll_interval_ms:V.simulcast.layerPollingIntervalMs,simulcast_layer_poll_enabled:V.simulcast.layerPollingEnabled};Object.assign(this.properties,K)}}var Zu=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class Q_{constructor(E,A,O,F,V){this.analyticsTracker=V,this.simulcastEnabled=!1,this.simulcastState={low:!1,mid:!1,hi:!1},this.sdp=new fi(""),this.sdpFeatures={audioNacks:!1},this.multihostConfiguration=Q_.defaultMultihostConfiguration(),this.prevOutboundVideoStats=new Map,this.prevInboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.sfuResource={node:"",cluster:""},this.connectionStartedTimestamp=Date.now(),this.seiStats={seiReadCnt:0,seiBytesRead:0,seiWriteCnt:0,seiBytesWritten:0},this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0},this.vidNetworkQualityMap=new Map,this.audioNetworkQualityMap=new Map,this.onPeerConnectionStateChange=()=>{switch(this.getConnectionState()){case hr.CONNECTED:this.connectionStartedTimestamp=Date.now(),this.setupIntervals();break;case hr.FAILED:this.flushStats()}},this.action=E,this.token=A,this.traceId=O,this.identifier=F}static defaultMultihostConfiguration(){return{video_codec:"unknown",width:0,height:0,max_bitrate:0,min_bitrate:0,target_fps:0,echo_cancellation:!1,auto_gain:!1,noise_suppression:!1,enable_simulcast:!1,max_audio_bitrate_bps:eu(nm),hi_video_layer:"",mid_video_layer:"",low_video_layer:""}}set sdpAnswer(E){try{this.sdp=new fi(E),this.sdpFeatures.audioNacks=this.sdp.hasAudioNacksEnabled()}catch{}}start(E,A=!1){this.peerConnection=E,this.simulcastEnabled=A,this.prevOutboundAudioStats=void 0,this.prevOutboundVideoStats=new Map,this.prevRemoteInboundStats=new Map,this.peerConnection.addEventListener("connectionstatechange",this.onPeerConnectionStateChange)}stop(){var E;clearInterval(this.uploadStatsInterval),this.uploadStatsInterval=void 0,(E=this.peerConnection)===null||E===void 0||E.removeEventListener("connectionstatechange",this.onPeerConnectionStateChange)}updateSfuResource(E){this.sfuResource=E}updateMultihostConfiguration(E,A){var O,F,V,K,ue,me,ce,de,we;return Zu(this,void 0,void 0,(function*(){if(this.action!==Qt.PUBLISH||!this.peerConnection)return;const Me=Q_.defaultMultihostConfiguration();if(A){const nt=this.peerConnection.getSenders().filter((dt=>dt.track!==null&&dt.track.kind==="video"));let bt="unknown";nt.length>0&&(yield nt[0].getStats()).forEach((dt=>{if(dt.type==="codec"&&(Me.video_codec=dt.mimeType,dt.sdpFmtpLine)){const Qe=dt.sdpFmtpLine.match(/profile-level-id=([a-f0-9]+)/);Qe&&Qe.length>0&&(bt=Qe[1])}}));const ut=A.track.getSettings();Me.width=(O=ut.width)!==null&&O!==void 0?O:0,Me.height=(F=ut.height)!==null&&F!==void 0?F:0,Me.target_fps=(V=ut.frameRate)!==null&&V!==void 0?V:0,A.config?(Me.max_bitrate=A.config.maxBitrateBps,Me.min_bitrate=A.config.minBitrateBps,Me.enable_simulcast=A.config.simulcastEnabled):(Me.max_bitrate=eu(Wu),Me.min_bitrate=eu(Lf),Me.enable_simulcast=!1),A.config.simulcastEnabled&&(Me.hi_video_layer=this.mapLayerToMetric(bt,(K=A.config.simulcastLayers)===null||K===void 0?void 0:K.hi),Me.mid_video_layer=this.mapLayerToMetric(bt,(ue=A.config.simulcastLayers)===null||ue===void 0?void 0:ue.mid),Me.low_video_layer=this.mapLayerToMetric(bt,(me=A.config.simulcastLayers)===null||me===void 0?void 0:me.low))}if(E){const nt=E.track.getSettings();Me.auto_gain=(ce=nt.autoGainControl)!==null&&ce!==void 0&&ce,Me.echo_cancellation=(de=nt.echoCancellation)!==null&&de!==void 0&&de,Me.noise_suppression=(we=nt.noiseSuppression)!==null&&we!==void 0&&we,Me.max_audio_bitrate_bps=E.config.maxBitrateBps,Me.stereo=E.config.stereo}(0,zi.isEqual)(Me,this.multihostConfiguration)||(this.analyticsTracker.trackEventNoSharedProps(new Zh(this.token,this.traceId,Me,this.action)),this.multihostConfiguration=Me)}))}resetTransformers(E,A){this.senderVideoTransformer=A,this.receiveVideoTransformer=E,this.prevVideoReceiverTransformerStats={seiReadCnt:0,seiBytesRead:0},this.prevVideoSenderTransformerStats={seiWriteCnt:0,seiBytesWritten:0}}getStats(E){var A;return Zu(this,void 0,void 0,(function*(){const O=yield(A=this.peerConnection)===null||A===void 0?void 0:A.getStats(E),{action:F}=this;if(O)if(E.kind==="audio"){if(F===Qt.PUBLISH)return{action:F,rawReport:O,stats:rS(O,this.audioNetworkQualityMap)};if(F===Qt.SUBSCRIBE)return{action:F,rawReport:O,stats:iS(O,this.audioNetworkQualityMap)}}else{if(F===Qt.PUBLISH)return{action:F,rawReport:O,stats:ky(O,this.vidNetworkQualityMap)};if(F===Qt.SUBSCRIBE)return{action:F,rawReport:O,stats:sS(O,this.vidNetworkQualityMap)}}}))}mapLayerToMetric(E,A){return!A||!A.active?"":`${`${A.height}x${A.width}`}_${`${A.maxFramerate}fps`}_${A.maxBitrateBps/1e3+"kbps"}_${E}`}updateJitterBufferMinDelay(E){this.jitterBufferMinDelayInMs=E}setupIntervals(){this.action===Qt.PUBLISH&&this.simulcastEnabled&&!this.pollSimulcastLayerInterval&&(this.pollSimulcastLayers(),this.pollSimulcastLayerInterval=this.startInterval(this.pollSimulcastLayers,5e3)),this.uploadStatsInterval||(this.uploadStats(),this.uploadStatsInterval=this.startInterval(this.uploadStats,1e4))}startInterval(E,A){return setInterval(E.bind(this),A)}getConnectionState(){var E;if(!this.peerConnection)return hr.NONE;const A=(E=this.peerConnection.connectionState)!==null&&E!==void 0?E:this.peerConnection.iceConnectionState;try{return x_(A)}catch{return hr.IDLE}}pollSimulcastLayers(){var E;return Zu(this,void 0,void 0,(function*(){if(this.getConnectionState()===hr.CONNECTED){const A=yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats();if(!A)return;A.forEach((O=>{var F;if(O.type==="outbound-rtp"){const V=((F=O.framesPerSecond)!==null&&F!==void 0?F:0)!==0;switch(O.rid){case"low":V!==this.simulcastState.low&&(this.simulcastState.low=V,this.analyticsTracker.trackEventNoSharedProps(new Y_(this.token,this.traceId,O.rid,V)));break;case"mid":V!==this.simulcastState.mid&&(this.simulcastState.mid=V,this.analyticsTracker.trackEventNoSharedProps(new Y_(this.token,this.traceId,O.rid,V)));break;case"hi":V!==this.simulcastState.hi&&(this.simulcastState.hi=V,this.analyticsTracker.trackEventNoSharedProps(new Y_(this.token,this.traceId,O.rid,V)))}}}))}}))}flushStats(){var E;return Zu(this,void 0,void 0,(function*(){const A=yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats();A&&(this.action===Qt.PUBLISH?this.uploadPublisherStats(A):this.action===Qt.SUBSCRIBE&&this.uploadSubscriberStats(A))}))}uploadStats(){var E;return Zu(this,void 0,void 0,(function*(){if(this.getConnectionState()===hr.CONNECTED){const A=yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats();if(!A)return;this.action===Qt.PUBLISH?this.uploadPublisherStats(A):this.action===Qt.SUBSCRIBE&&this.uploadSubscriberStats(A)}}))}uploadPublisherStats(E){var A,O;const F={audio:{},video:[],candidateStats:{}},V=new Map,K=(Date.now()-this.connectionStartedTimestamp)/1e3,ue=Object.assign({},this.multihostConfiguration),{seiWriteCnt:me,seiBytesWritten:ce}=this.updateAndDiffSeiPublishStatsSinceLastUpdate((A=this.senderVideoTransformer)===null||A===void 0?void 0:A.getSenderStats());if(this.seiStats.seiWriteCnt+=me,this.seiStats.seiBytesWritten+=ce,E.forEach((de=>{if(de.type==="outbound-rtp"){const we=E.get(de.remoteId),Me=this.prevRemoteInboundStats.get(de.remoteId);switch(we&&this.prevRemoteInboundStats.set(we.id,we),de.kind){case"audio":F.audio=this.updateOutboundAudio(de),F.audio.remoteInbound=we,F.audio.prevRemoteInbound=Me,F.audio.codec=V.get(de.codecId);break;case"video":F.video.push(Object.assign({},this.updateOutboundVideo(de),{remoteInbound:we,prevRemoteInbound:Me,codec:V.get(de.codecId)}))}}de.type==="candidate-pair"&&de.nominated&&(F.candidateStats.candidatePair=de,F.candidateStats.localCandidate=E.get(de.localCandidateId),F.candidateStats.remoteCandidate=E.get(de.remoteCandidate)),de.type==="codec"&&V.set(de.id,de)})),F.video.forEach((de=>{var we,Me;const{outbound:nt,prevOutbound:bt}=de;if(!nt)return;const ut=(Me=(we=de.outbound)===null||we===void 0?void 0:we.rid)!==null&&Me!==void 0?Me:ye;this.updateNetworkQualityPublish(ut,this.vidNetworkQualityMap,nt,bt)})),F.audio.outbound){const de=(O=F.audio.outbound.rid)!==null&&O!==void 0?O:ye;this.updateNetworkQualityPublish(de,this.audioNetworkQualityMap,F.audio.outbound,F.audio.prevOutbound)}this.analyticsTracker.trackEventNoSharedProps(new lS(this.token,this.traceId,this.sfuResource,F.audio.outbound,F.audio.remoteInbound,F.candidateStats,F.audio.codec,ue,K,this.sdpFeatures)),F.audio.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new Iy(this.token,this.traceId,this.sfuResource,F.audio.outbound,F.audio.prevOutbound,F.audio.remoteInbound,F.audio.prevRemoteInbound,F.candidateStats,F.audio.codec,ue,this.sdpFeatures)),F.video.forEach((de=>{this.analyticsTracker.trackEventNoSharedProps(new q_(this.token,this.traceId,this.sfuResource,de.outbound,de.remoteInbound,F.candidateStats,de.codec,ue,K)),de.prevOutbound&&this.analyticsTracker.trackEventNoSharedProps(new cS(this.token,this.traceId,this.sfuResource,de.outbound,de.prevOutbound,de.remoteInbound,de.prevRemoteInbound,F.candidateStats,de.codec,ue,this.seiStats.seiWriteCnt,this.seiStats.seiBytesWritten))}))}updateNetworkQualityPublish(E,A,O,F){var V,K,ue,me;let ce=0;const de=Do.getNetworkQuality(),we=(V=O.packetsSent)!==null&&V!==void 0?V:0,Me=(K=O.nackCount)!==null&&K!==void 0?K:0;if(F)if(de===fo.DOWN)A.set(E,fo.DOWN);else{ce=(Me-((ue=F?.nackCount)!==null&&ue!==void 0?ue:0))/(we-((me=F?.packetsSent)!==null&&me!==void 0?me:0));const nt=this.convertLostRatioToQuality(ce);A.set(E,nt)}else A.set(E,de)}updateNetworkQualitySubscribe(E,A,O){var F,V,K,ue;let me=0;const ce=Do.getNetworkQuality(),de=(F=A?.packetsReceived)!==null&&F!==void 0?F:0,we=(V=A?.nackCount)!==null&&V!==void 0?V:0;if(!A)return;const Me=A.id;if(Me)if(O)if(ce===fo.DOWN)E.set(Me,fo.DOWN);else{me=(we-((K=O?.nackCount)!==null&&K!==void 0?K:0))/(de-((ue=O?.packetsReceived)!==null&&ue!==void 0?ue:0));const nt=this.convertLostRatioToQuality(me);E.set(Me,nt)}else E.set(Me,ce)}uploadSubscriberStats(E){var A,O;const F={audio:{},video:{},candidateStats:{}},V=new Map,K=(Date.now()-this.connectionStartedTimestamp)/1e3,ue=(A=this.jitterBufferMinDelayInMs)!==null&&A!==void 0?A:0,{seiReadCnt:me,seiBytesRead:ce}=this.updateAndDiffSeiSubscribeStatsSinceLastUpdate((O=this.receiveVideoTransformer)===null||O===void 0?void 0:O.getReceiverStats());this.seiStats.seiReadCnt+=me,this.seiStats.seiBytesRead+=ce,E.forEach((de=>{if(de.type==="inbound-rtp")switch(de.kind){case"audio":F.audio=this.updateInboundAudio(de),F.audio.codec=V.get(de.codecId),this.updateNetworkQualitySubscribe(this.audioNetworkQualityMap,F.audio.inbound,F.audio.prevInbound);break;case"video":F.video=this.updateInboundVideo(de),F.video.codec=V.get(de.codecId),this.updateNetworkQualitySubscribe(this.vidNetworkQualityMap,F.video.inbound,F.video.prevInbound)}de.type==="candidate-pair"&&de.nominated&&(F.candidateStats.candidatePair=de,F.candidateStats.localCandidate=E.get(de.localCandidateId),F.candidateStats.remoteCandidate=E.get(de.remoteCandidate)),de.type==="codec"&&V.set(de.id,de)})),this.analyticsTracker.trackEventNoSharedProps(new bT(this.token,this.traceId,this.identifier,this.sfuResource,F.audio.inbound,F.candidateStats,F.audio.codec,K,this.sdpFeatures)),F.audio.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new ST(this.token,this.traceId,this.identifier,this.sfuResource,F.audio.inbound,F.audio.prevInbound,F.candidateStats,F.audio.codec,this.sdpFeatures,ue)),this.analyticsTracker.trackEventNoSharedProps(new n0(this.token,this.traceId,this.identifier,this.sfuResource,F.video.inbound,F.candidateStats,F.video.codec,K)),F.video.prevInbound&&this.analyticsTracker.trackEventNoSharedProps(new uS(this.token,this.traceId,this.identifier,this.sfuResource,F.video.inbound,F.video.prevInbound,F.candidateStats,F.video.codec,ue,this.seiStats.seiReadCnt,this.seiStats.seiBytesRead))}updateAndDiffSeiSubscribeStatsSinceLastUpdate(E){const A=this.prevVideoReceiverTransformerStats;if(!E)return{seiReadCnt:A.seiReadCnt,seiBytesRead:A.seiBytesRead};const O=E.seiReadCnt-A.seiReadCnt,F=E.seiBytesRead-A.seiBytesRead;return this.prevVideoReceiverTransformerStats={seiReadCnt:E.seiReadCnt,seiBytesRead:E.seiBytesRead},{seiReadCnt:O,seiBytesRead:F}}updateAndDiffSeiPublishStatsSinceLastUpdate(E){const A=this.prevVideoSenderTransformerStats;if(!E)return{seiWriteCnt:A.seiWriteCnt,seiBytesWritten:A.seiBytesWritten};const O=E.seiWriteCnt-A.seiWriteCnt,F=E.seiBytesWritten-A.seiBytesWritten;return this.prevVideoSenderTransformerStats={seiWriteCnt:E.seiWriteCnt,seiBytesWritten:E.seiBytesWritten},{seiWriteCnt:O,seiBytesWritten:F}}updateOutboundAudio(E){const A=E,O=this.prevOutboundAudioStats,F=E.id===O?.id?O:void 0;return this.prevOutboundAudioStats=E,{outbound:A,prevOutbound:F}}updateInboundAudio(E){const A=E,O=this.prevInboundAudioStats,F=E.id===O?.id?O:void 0;return this.prevInboundAudioStats=E,{inbound:A,prevInbound:F}}updateInboundVideo(E){const A=E,O=this.prevInboundVideoStats.get(ye),F=E.id===O?.id?O:void 0;return this.prevInboundVideoStats.set(ye,E),{inbound:A,prevInbound:F}}updateOutboundVideo(E){const A=E,O=this.getPrevOutboundVideo(E),F=E.id===O?.id?O:void 0;return this.setPrevVideoStat(E),{outbound:A,prevOutbound:F}}getPrevOutboundVideo(E){return this.simulcastEnabled&&E.rid&&this.prevOutboundVideoStats.has(E.rid)?this.prevOutboundVideoStats.get(E.rid):!this.simulcastEnabled&&this.prevOutboundVideoStats.has(ye)?this.prevOutboundVideoStats.get(ye):void 0}setPrevVideoStat(E){this.simulcastEnabled&&E.rid?this.prevOutboundVideoStats.set(E.rid,E):this.simulcastEnabled||this.prevOutboundVideoStats.set(ye,E)}convertLostRatioToQuality(E){return E<=0?fo.EXCELLENT:E<=.01?fo.GOOD:E<=.03?fo.NORMAL:E<=.1?fo.POOR:fo.DOWN}}class h0 extends Kn{constructor(E,A,O,F,V){super(Mn.MINUTE,E,A,!1),Object.assign(this.properties,{action:F?Qt.PUBLISH:Qt.SUBSCRIBE,is_publishing:F,minutes_logged:O,subscribed_number:V})}}class f0 extends Kn{constructor(E){super(Mn.PUBLISH,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.PUBLISH,remote_participant_id:E.token.participantID})}}class Al extends Kn{constructor(E){super(Mn.UNPUBLISH,E.token,E.traceId,!0),Object.assign(this.properties,{action:Qt.PUBLISH,remote_participant_id:E.token.participantID})}}class Br extends Kn{constructor(E){var A,O,F,V;super(Mn.SUBSCRIBE,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:E.subscribedId,subscribed_id:E.subscribedId,is_edp_connected:E.isEdpConnected,is_reassignment:E.isReassignment,node:(O=(A=E.preAttemptSfuResource)===null||A===void 0?void 0:A.node)!==null&&O!==void 0?O:"",cluster:(V=(F=E.preAttemptSfuResource)===null||F===void 0?void 0:F.cluster)!==null&&V!==void 0?V:""})}}class ev extends Kn{constructor(E){super(Mn.UNSUBSCRIBE,E.token,E.traceId,!0),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:E.unsubscribedId,unsubscribed_id:E.unsubscribedId})}}class Cl extends Kn{constructor(E){var A,O,F,V;super(Mn.PUBLISH_STARTED,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.PUBLISH,options_duration:E.optionsDuration,post_duration:E.postDuration,remote_participant_id:E.token.participantID,time_to_candidate:E.timeToCandidate,total_duration:E.totalDuration,edp_initial_connect_duration:E.edpInitialConnectDuration,edp_initial_connect_retry_times:E.edpInitialConnectRetries,edp_initial_state_duration:E.edpInitialStateDuration,edp_state_update_count:E.edpStateUpdateCount,sdp_exchange_duration:E.sdpExchangeDuration,sdp_exchange_transport:E.sdpExchangeTransport,set_remote_desc_duration:E.setRemoteDescDuration,peer_connection_duration:E.peerConnectionDuration,node:(O=(A=E.sfuResource)===null||A===void 0?void 0:A.node)!==null&&O!==void 0?O:"",cluster:(V=(F=E.sfuResource)===null||F===void 0?void 0:F.cluster)!==null&&V!==void 0?V:"",publish_retry_times:E.publishRetries,total_duration_with_retries:E.totalDurationWithRetries,protocol:E.protocol})}}class _S extends Kn{constructor(E){super(Mn.PUBLISH_FAILED,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.PUBLISH,code:E.code,message:E.message,fatal:E.fatal,nominal:E.nominal,protocol:E.protocol})}}class Fr extends Kn{constructor(E){super(Mn.PUBLISH_ENDED,E.token,E.traceId,!0),Object.assign(this.properties,{action:Qt.PUBLISH,remote_participant_id:E.token.participantID,unpublish_successful:E.isUnpublishSuccessful,reason:E.reason,protocol:E.protocol})}}class vS extends Kn{constructor(E){var A,O,F,V;super(Mn.SUBSCRIBE_STARTED,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.SUBSCRIBE,options_duration:E.optionsDuration,post_duration:E.postDuration,remote_participant_id:E.remoteParticipantId,time_to_candidate:E.timeToCandidate,total_duration:E.totalDuration,edp_initial_connect_duration:E.edpInitialConnectDuration,edp_initial_connect_retry_times:E.edpInitialConnectRetries,edp_initial_state_duration:E.edpInitialStateDuration,edp_initial_state_publishing_count:E.edpInitialStatePublishingCount,edp_state_update_count:E.edpStateUpdateCount,sdp_exchange_duration:E.sdpExchangeDuration,sdp_exchange_transport:E.sdpExchangeTransport,set_remote_desc_duration:E.setRemoteDescDuration,peer_connection_duration:E.peerConnectionDuration,node:(O=(A=E.sfuResource)===null||A===void 0?void 0:A.node)!==null&&O!==void 0?O:"",cluster:(V=(F=E.sfuResource)===null||F===void 0?void 0:F.cluster)!==null&&V!==void 0?V:"",total_duration_with_retries:E.totalDurationWithRetries,subscribe_retry_times:E.subscribeRetryTimes,is_reassignment:E.isReassignment,protocol:E.protocol})}}class yS extends Kn{constructor(E){super(Mn.SUBSCRIBE_FAILED,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:E.remoteParticipantId,code:E.code,message:E.message,fatal:E.fatal,nominal:E.nominal,is_reassignment:E.isReassignment,protocol:E.protocol})}}class zd extends Kn{constructor(E){super(Mn.SUBSCRIBE_ENDED,E.token,E.traceId,!0),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:E.remoteParticipantId,unsubscribe_successful:E.isUnsubscribeSuccessful,reason:E.reason,protocol:E.protocol}),this.critical=!0}}class CT extends Kn{constructor(E){super(Mn.STATE_UPDATED,E.token,E.traceId,!1),Object.assign(this.properties,{audio_muted:E.isAudioMuted,is_disconnected:E.isDisconnected,is_publishing:E.isPublishing,other_participant_id:E.otherParticipantId,other_participant_user_id:E.otherParticipantUserId,video_stopped:E.isVideoStopped})}}class RT extends Kn{constructor(E){var A,O,F,V,K;super(Mn.FIRST_FRAME,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.SUBSCRIBE,remote_participant_id:E.remoteParticipantId,edp_initial_connect_duration:E.edpInitialConnectDuration,edp_initial_connect_retry_times:E.edpInitialConnectRetries,edp_initial_state_duration:E.edpInitialStateDuration,edp_initial_state_publishing_count:E.edpInitialStatePublishingCount,edp_state_update_count:E.edpStateUpdateCount,sdp_exchange_duration:E.sdpExchangeDuration,sdp_exchange_transport:E.sdpExchangeTransport,set_remote_desc_duration:E.setRemoteDescDuration,peer_connection_duration:E.peerConnectionDuration,node:(O=(A=E.sfuResource)===null||A===void 0?void 0:A.node)!==null&&O!==void 0?O:"",cluster:(V=(F=E.sfuResource)===null||F===void 0?void 0:F.cluster)!==null&&V!==void 0?V:"",video_was_paused:E.videoWasPaused,first_frame_duration:E.firstFrameDuration,total_duration_with_retries:E.totalDurationWithRetries,subscribe_retry_times:E.subscribeRetryTimes,media_type:E.mediaType,configured_jitter_buffer_min_delay_ms:(K=E.currentJitterBufferMinDelayInMs)!==null&&K!==void 0?K:0,protocol:E.protocol})}}class kT extends Kn{constructor(E){super(Mn.EDP_PONG,E.token,E.traceId,!1),Object.assign(this.properties,{event_endpoint:E.eventEndpoint,protocol:E.protocol,edp_rtt:E.edpRttMs})}}class d0 extends Kn{constructor(E){super(Mn.JOIN,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.JOIN,event_endpoint:E.eventEndpoint,whip_endpoint:E.whipEndpoint})}}class ec extends Kn{constructor(E){super(Mn.JOIN_ATTEMPT,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.JOIN,event_endpoint:E.eventEndpoint,whip_endpoint:E.whipEndpoint})}}class tc extends Kn{constructor(E){super(Mn.JOIN_ATTEMPT_FAILED,E.token,E.traceId,!1),Object.assign(this.properties,{action:Qt.JOIN,event_endpoint:E.eventEndpoint,whip_endpoint:E.whipEndpoint,code:E.code,message:E.message,fatal:E.fatal,nominal:E.nominal,connect_retry_times:E.retryCnt})}}class bS extends Kn{constructor(E){super(Mn.EDP_DISCONNECTED,E.token,E.traceId,!1),Object.assign(this.properties,{event_endpoint:E.eventEndpoint,protocol:E.protocol}),this.critical=!0}}class MT extends Kn{constructor(E){super(Mn.EDP_CONNECTED,E.token,E.traceId,!1),Object.assign(this.properties,{event_endpoint:E.eventEndpoint,protocol:E.protocol,connect_retry_times:E.numRetries}),this.critical=!0}}class jy{constructor(E,A,O){this.token=E,this.analyticsTracker=O,this.protocol="",this.connecting=!1,this.closing=!1,this.windowUnloading=!1,this.maxConnectRetries=6,this.connectionAttempts=0,this.latestSequenceNumber=0,this.nextConnectionAttemptId=0,this.connectTimeoutId=0,this.latestPingTimestamp=0,this.pingIntervalId=0,this.pongTimeoutId=0,this.pingIntervalMs=15e3,this.pongTimeoutMs=3e4,this.attemptConnect=ue=>{this.latestSequenceNumber=0,this.traceId=ue||Ns(),this.connectionAttempts++,this.trackJoinAttempt(this.connectionAttempts);const{topic:me,rawToken:ce}=this.token;this.connecting=!0,this.closing=!1;try{const de=encodeURIComponent(this.traceId.value),we=`topic=${me}/publishers`,Me=`traceid=${de}`,nt="error_over_ws=1",bt=`${this.addr}?${nt}&${we}&${Me}`;this.socket=this.createWebSocket(bt,ce),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onopen=this.onOpen.bind(this),this.protocol=this.socket.protocol}catch(de){const we=de instanceof Error?de.message:void 0,Me=this.createError(Jt.EVENT_PLANE_WS_CREATE_FAILED,we);this.trackJoinFailed(Me,this.getRetryCount()),this.emitter.emit(Sl,Me)}},this.triggerSocketOpen=ue=>{this.clearConnectionAttemptTimeouts();const me=this.getRetryCount();this.connectionAttempts=0,this.connecting=!1,this.trackJoinStarted(me),this.emitter.emit(Jp,{retryCnt:me,traceId:this.traceId,initialStageState:ue}),this.pingIntervalId=window.setInterval(this.ping,this.pingIntervalMs)},this.ping=()=>{var ue;if(this.logger.debug({msg:`${this.id}sending PING`}),!this.isSocketOpen()){const me=`${this.id} attempting to ping an unopened socket`;return this.logger.warn({msg:me}),void this.traceJoinOp(me)}this.latestPingTimestamp=performance.now(),this.pongTimeoutId===0&&(this.pongTimeoutId=window.setTimeout(this.pongTimedOut,this.pongTimeoutMs)),(ue=this.socket)===null||ue===void 0||ue.send(JSON.stringify({type:"PING"}))},this.pongTimedOut=()=>{if(!this.isSocketOpen()){const me=`${this.id} attempting pong timeout on an unopened socket`;return this.logger.warn({msg:me}),void this.traceJoinOp(me)}this.logger.debug({msg:`${this.id} Pong timed out!`}),this.clearPingPongTracking();const ue=this.createError(Jt.EVENT_PLANE_PONG_TIMEOUT);this.emitter.emit(Sl,ue)},this.beforeUnload=()=>{this.emitter.emit(dr,"beforeunload"),this.windowUnloading=!0},this.sendSdpOffer=(ue,me,ce,de,we,Me,nt,bt)=>{var ut;const dt={type:"aws:ivs:SDP_OFFER",payload:{whipUrl:me,requestId:de,traceId:ce,platform:"web",sdk:"1.31.1",whipVersion:ra,content:ue,contentType:"application/sdp"}};we&&(dt.payload.forceNode=we),Me&&(dt.payload.assignmentToken=Me),nt&&(dt.payload.multiCodec=nt);const Qe=ba()===void 0,st=ba()||Qe;bt&&st&&(dt.payload.initialLayerPref=Ry(bt)),(ut=this.socket)===null||ut===void 0||ut.send(JSON.stringify(dt))},this.checkNonFatalRetriesLimit=ue=>{if(ue.fatal||this.connectionAttempts<=this.maxConnectRetries)return xn.ok(!0);this.logger.debug({msg:`${this.id} maximum non-fatal retries of ${this.maxConnectRetries} exceeded`});const me=this.createError(Jt.JOIN_TIMED_OUT);return xn.err(me)},this.getRetryCount=()=>Math.max(this.connectionAttempts-1,0),this.trackSocketError=ue=>{this.connecting&&this.trackJoinFailed(ue,this.getRetryCount()),this.analyticsTracker.trackError(ue)},this.trackJoinEnded=()=>{this.analyticsTracker.trackEventNoSharedProps(new bS({token:this.token,eventEndpoint:this.token.eventsURL,traceId:this.traceId,protocol:this.protocol}))},this.traceJoinOp=ue=>{this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,this.traceId,ue,Qt.JOIN))},this.logger=new Ka(A,oe.SOCKET),this.emitter=new Li.EventEmitter,this.traceId=Ns(),this.id=`[${Nd().value}] `;const F=Sg("socketPingMs");F!==void 0&&(this.pingIntervalMs=F);const V=Sg("socketPongMs");V!==void 0&&(this.pongTimeoutMs=V);const K=Sg("socketConnectMaxRetries");K!==void 0&&(this.maxConnectRetries=K),window.addEventListener("beforeunload",this.beforeUnload)}connect(E,A,O=!1){this.close(),this.logger.debug({msg:`${this.id}connecting to ${this.addr}`}),this.addr=E,this.traceId=A,O&&!this.connecting&&(window.clearTimeout(this.connectTimeoutId),this.connectTimeoutId=window.setTimeout(this.connectTimedOut.bind(this),12e3)),this.attemptConnect(A)}send(E){var A;this.logger.debug({msg:`${this.id}sending ${JSON.stringify(E)}`}),this.logger.debug({msg:`${this.id}isReady called`}),this.isSocketOpen()?(A=this.socket)===null||A===void 0||A.send(JSON.stringify(E)):this.logger.warn({msg:"Trying to send data over stage socket that is not ready"})}close(){this.logger.debug({msg:`${this.id}closing`});const E=this.connecting,A=this.isSocketOpen(),O=this.socket&&this.socket.readyState===this.socket.CLOSING,F=this.getRetryCount();if(this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.connectionAttempts=0,this.socket){if(this.cleanupWebSocket(),A&&this.isStateMessageReceived())this.trackJoinEnded(),this.emitter.emit(dr,"intentional-close");else if(E&&!O){const V=this.createError(Jt.OPERATION_ABORTED);this.trackJoinFailed(V,F),this.analyticsTracker.trackError(V),this.emitter.emit(Sl,V)}}}markSocketAsClosed(){this.closing=!0,this.connecting=!1}removeAllListeners(){window.removeEventListener("beforeunload",this.beforeUnload),this.emitter.removeAllListeners()}createWebSocket(E,A){return new WebSocket(E,A)}cleanupWebSocket(){this.socket&&(this.socket.close(),this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.onopen=null,this.socket=void 0)}createError(E,A){return new Rr(Object.assign({action:Qt.JOIN,traceId:this.traceId,token:this.token,location:"StageSocket.connection",tag:na,details:A},E))}on(E,A){this.emitter.on(E,A)}off(E,A){this.emitter.off(E,A)}onMessage(E){this.logger.debug({msg:`${this.id}received message: ${E.data}`});try{const A=JSON.parse(E.data);switch(A.type){case"STAGE_STATE":case"aws:ivs:STAGE_STATE":{const O=A.payload.sequenceNumber;O>this.latestSequenceNumber&&(this.latestSequenceNumber===0&&this.connectTimeoutId>0?(this.triggerSocketOpen(A),window.setTimeout((()=>{this.emitter.emit(Hu,A)}))):this.emitter.emit(Hu,A),this.latestSequenceNumber=O);break}case"PONG":window.clearTimeout(this.pongTimeoutId),this.pongTimeoutId=0,this.analyticsTracker.trackEventNoSharedProps(new kT({token:this.token,eventEndpoint:this.token.eventsURL,protocol:this.protocol,traceId:this.traceId,edpRttMs:performance.now()-this.latestPingTimestamp}));break;case"REFRESH":this.emitter.emit(Yg);break;case"aws:ivs:SDP_ANSWER":this.emitter.emit(z_,A.payload);break;case"aws:ivs:DISCONNECT":this.emitter.emit(Kg,A.payload);break;case"aws:ivs:REASSIGN":this.emitter.emit(wy,A.payload);break;case"aws:ivs:INCOMPATIBLE_CODECS":this.emitter.emit($_,A.payload);break;case"aws:ivs:SSU":this.emitter.emit(J1,A.payload);break;case"aws:ivs:JOIN_ERROR":this.handleJoinError(A.payload);break;default:(0,zi.noop)()}}catch(A){this.logger.debug({msg:`onMessage JSON Parse error: ${A}`}),this.emitter.emit(Ty,A)}}onError(E){this.logger.debug({msg:`${this.id}error: ${JSON.stringify(E)}`})}onClose(E){if(this.logger.debug({msg:`${this.id} onClose triggered with code (closing = ${this.closing}, connecting = ${this.connecting})`}),this.clearPingPongTracking(),this.closing)return void(this.closing=!1);if(this.windowUnloading)return;const A=`code: ${E?.code}, reason: ${E?.reason}, wasClean: ${E?.wasClean}`;if(this.connecting){const F=this.createError(Jt.EVENT_PLANE_WS_CLOSE_BEFORE_OPEN,A);return void this.handleSocketError(F)}this.logger.debug({msg:`${this.id}unexpected close`}),this.emitter.emit(dr,"unknown");const O=this.createError(Jt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,A);this.trackJoinEnded(),this.emitter.emit(Sl,O)}onOpen(){this.logger.debug({msg:`${this.id} socket opened`}),this.clearConnectionAttemptTimeouts(),this.connectTimeoutId=window.setTimeout(this.triggerSocketOpen,12e3)}clearConnectionAttemptTimeouts(){window.clearTimeout(this.nextConnectionAttemptId),window.clearTimeout(this.connectTimeoutId),this.nextConnectionAttemptId=0,this.connectTimeoutId=0}clearConnectionAttempts(){this.connectionAttempts=0}connectTimedOut(){this.connecting=!1,this.logger.debug({msg:`${this.id} Connect timed out!`});const E=this.createError(Jt.JOIN_TIMED_OUT);this.isSocketConnecting()&&this.trackJoinFailed(E,this.getRetryCount()),this.emitter.emit(Sl,E),this.close()}clearPingPongTracking(){window.clearInterval(this.pingIntervalId),window.clearTimeout(this.pongTimeoutId),this.pingIntervalId=0,this.pongTimeoutId=0}handleJoinError(E){const A=(function(F){var V,K;let ue;switch(F.code){case Ja.TOKEN_EXPIRED:ue=Jt.EXPIRED_TOKEN;break;case Ja.TOKEN_INVALID:case Ja.TOKEN_INVALID_SIGNATURE:case Ja.TOKEN_MISSING:ue=Jt.MALFORMED_TOKEN;break;case Ja.STAGE_DELETED:ue=Jt.STAGE_DELETED;break;case Ja.PARTICIPANT_DISCONNECTED:ue=Jt.PARTICIPANT_DISCONNECTED;break;case Ja.INTERNAL:ue=Jt.JOIN_SERVER_INTERNAL_ERROR;break;case Ja.BAD_REQUEST:ue=Jt.JOIN_SERVER_BAD_REQUEST;break;default:ue=Object.assign(Object.assign({},Jt.JOIN_FAILURE),{message:F.message||Jt.JOIN_FAILURE.message})}return Object.assign(Object.assign({},ue),{fatal:(V=F.fatal)!==null&&V!==void 0?V:ue.fatal,nominal:(K=F.nominal)!==null&&K!==void 0?K:ue.nominal})})(E),O=this.createError(A,`JOIN_ERROR: ${E.code}`);this.logger.debug({msg:`${this.id} received JOIN_ERROR: ${JSON.stringify(E)}`}),this.handleSocketError(O)}handleSocketError(E){const A=this.checkNonFatalRetriesLimit(E);let O=E;A.ok||(O=A.error,O.details=`Timeout triggered by ${E.code}`),this.trackSocketError(O),this.markSocketAsClosed(),this.clearPingPongTracking(),this.clearConnectionAttemptTimeouts(),this.cleanupWebSocket(),O.fatal?(this.clearConnectionAttempts(),this.emitter.emit(Sl,O)):this.queueExponentialBackoffRetry()}queueExponentialBackoffRetry(){let E=Math.pow(2,this.connectionAttempts-1);E>32&&(E=32),this.logger.debug({msg:`${this.id} reconnecting in ${E} seconds`}),window.clearTimeout(this.nextConnectionAttemptId),this.nextConnectionAttemptId=window.setTimeout(this.attemptConnect,1e3*E)}isSocketConnecting(){return this.socket&&this.socket.readyState===this.socket.CONNECTING}isSocketOpen(){return this.socket&&this.socket.readyState===this.socket.OPEN}isStateMessageReceived(){return this.latestSequenceNumber!==0}trackJoinStarted(E){this.analyticsTracker.trackEventNoSharedProps(new MT({token:this.token,eventEndpoint:this.token.eventsURL,numRetries:E,protocol:this.protocol,traceId:this.traceId}))}trackJoinAttempt(E){const{token:A,traceId:O}=this;this.analyticsTracker.trackEvent(new ec({token:A,eventEndpoint:A?.eventsURL||"",whipEndpoint:A?.whipURL||"",traceId:O}))}trackJoinFailed(E,A){const{token:O,traceId:F,code:V,message:K,fatal:ue,nominal:me}=E;this.analyticsTracker.trackEvent(new tc({token:O,eventEndpoint:O.eventsURL,whipEndpoint:O.whipURL,traceId:F,code:V,message:K,fatal:ue,nominal:me,retryCnt:A}))}}var Ro=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))},Fo,nc,oa,Ni;(function(M){M.SDP_EXCHANGE="xdp",M.JITTER_BUFFER_MIN_DELAY_MS="jit_buf_min_delay_ms"})(Fo||(Fo={})),(function(M){M.USER_INITIATED="user-initiated",M.CLIENT_RECONNECT="reconnect",M.TOKEN_REUSED="token-reused",M.UNKNOWN="unknown",M.PARTICIPANT_DISCONNECTED="participant-disconnected",M.STAGE_DELETED="stage-deleted",M.TOKEN_EXPIRED="token-expired"})(nc||(nc={})),(function(M){M[M.NOT_CONNECTED=0]="NOT_CONNECTED",M[M.CONNECTION_LOST=1]="CONNECTION_LOST",M[M.TIMEDOUT=2]="TIMEDOUT",M[M.ABORTED=3]="ABORTED",M[M.INVALID_MESSAGE=4]="INVALID_MESSAGE",M[M.UNEXPECTED_ERROR=5]="UNEXPECTED_ERROR"})(oa||(oa={})),(function(M){M.DISCONNECTED="disconnected",M.CONNECTING="connecting",M.CONNECTED="connected",M.ERRORED="errored"})(Ni||(Ni={}));class tv extends Da{constructor(E,A,O){super(),this.token=E,this.nonScopedLogger=A,this.analyticsTracker=O,this.participants=new Map,this.disconnected=[],this.state={value:Ni.DISCONNECTED,context:{connectStartTime:0,hasConnected:!1}},this.features={sdpExchange:!1},this.stats=this.resetStats(),this.stageMinutesLogged=0,this.isStagePublishing=!1,this.onConnecting=(F,V)=>{this.logger.debug({msg:"onConnecting",context:F,event:V}),F.connectStartTime=performance.now();const K=V.type==="RECONNECT";K&&this.stageSocket.close();const{eventsURL:ue}=this.token;this.emit(Dd,Ni.CONNECTING),this.state.value=Ni.CONNECTING;const me=!K;this.stageSocket.connect(ue,this.traceId,me)},this.onConnected=(F,V)=>{this.logger.debug({msg:"onConnected",context:F,event:V}),F.hasConnected=!0,this.emit(Nf),this.emit(Dd,Ni.CONNECTED),this.state.value=Ni.CONNECTED},this.onDisconnected=(F,V)=>{this.logger.debug({msg:"onDisconnected",context:F}),this.state.value=Ni.DISCONNECTED,this.stopStageMinuteLoggedInterval(!0),this.stageSocket.close(),F.hasConnected=!1,this.participants=new Map,this.disconnected=[],this.stageSocket.removeAllListeners(),this.resetStats(),this.emit(Dd,Ni.DISCONNECTED,V)},this.onErrored=(F,V)=>{var K;this.logger.error({msg:"Connection failure occurred",err:V.payload.error}),this.emit(Dd,Ni.ERRORED),this.emit(qg,V.payload.error),this.state.value=Ni.ERRORED;const ue=V.payload.error;if(ue instanceof Rr&&ue.fatal&&(!((K=ue.details)===null||K===void 0)&&K.includes("JOIN_ERROR"))&&F.hasConnected){const me=this.mapJoinErrorCodeToDisconnectReason(ue);this.processStateUpdate({type:"DISCONNECT",reason:me})}else F.hasConnected?this.processStateUpdate({type:"RECONNECT"}):this.stageSocket.close()},this.processStateUpdate=F=>{const V=this.state.value,K=this.state.context;switch(V){case Ni.DISCONNECTED:F.type==="CONNECT"&&this.onConnecting(K,F);break;case Ni.CONNECTING:F.type==="RECONNECT"?this.onConnecting(K,F):F.type==="DISCONNECT"?this.onDisconnected(K,F.reason):F.type==="CONNECT_SUCCESS"?this.onConnected(K,F):F.type==="ERROR"&&this.onErrored(K,F);break;case Ni.CONNECTED:F.type==="RECONNECT"?this.onConnecting(K,F):F.type==="DISCONNECT"?this.onDisconnected(K,F.reason):F.type==="ERROR"&&this.onErrored(K,F);break;case Ni.ERRORED:F.type==="RECONNECT"?this.onConnecting(K,F):F.type==="DISCONNECT"&&this.onDisconnected(K,F.reason)}},this.measureConnect=(F,V)=>{const K=this.stats.edpConnectCount,ue=K+1,me=performance.now(),ce=me-V;return Object.assign(this.stats,{edpConnectCount:ue,edpConnectDuration:ce}),K===0&&Object.assign(this.stats,{edpInitialStartConnectTime:V,edpInitialFinishConnectTime:me,edpInitialConnectDuration:ce,edpInitialConnectRetries:F}),this.stats},this.measureStateUpdate=F=>{const{edpInitialFinishConnectTime:V}=this.stats,K=this.stats.edpStateUpdateCount,ue=K+1;return Object.assign(this.stats,{edpStateUpdateCount:ue}),K===0&&Object.assign(this.stats,{edpInitialStateDuration:performance.now()-V,edpInitialStatePublishingCount:F}),this.stats},this.trackMessageParseError=F=>{this.logger.error({msg:"Message Parse Error occurred",err:F.err});const V=new Rr({token:F.token,traceId:F.traceId,code:Jt.WEBSOCKET_MESSAGE_PARSE_FAILURE.code,tag:F.tag,location:F.location,message:F.message,details:F.err.message});this.analyticsTracker.trackEvent(new gs(V))},this.trackStageSocketMessageParseError=(F,V,K)=>{this.trackMessageParseError({token:F,traceId:V,tag:na,location:"StageConnection.onMessage",message:Jt.WEBSOCKET_MESSAGE_PARSE_FAILURE.message,err:K})},this.trackStageStateMessageParseError=(F,V,K,ue)=>{this.trackMessageParseError({token:F,traceId:V,tag:na,location:"StageConnection.onStageStateMessage",message:ue,err:K})},this.onDisconnectMessage=F=>{this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,this.traceId,`DISCONNECT message received: ${F.code}:${F.reason}`,Qt.JOIN));let V=nc.UNKNOWN;if(F.code==="PARTICIPANT_DISCONNECTED")V=nc.PARTICIPANT_DISCONNECTED;else if(F.code==="STAGE_DELETED")V=nc.STAGE_DELETED;else if(F.code==="TOKEN_REUSED"&&(V=nc.TOKEN_REUSED,Gc("disableTokenReuseMessage")))return void console.warn("Token reuse is detected, but skipping as feature is disabled");console.warn(`Disconnecting client due to: ${F.reason}`),this.processStateUpdate({type:"DISCONNECT",reason:V})},this.onReassignmentMessage=F=>{this.emit(j_,F)},this.onIncompatibleCodecsMessage=F=>{this.emit(Zs,F)},this.onSsuMessage=F=>{var V;const K=window.atob((V=F.A)!==null&&V!==void 0?V:"").trim();K&&K.startsWith("http")?Do.currentEndpoint=K:this.logger.warn({msg:"SSU Url invalid"})},this.onStageStateMessage=(F,V,K)=>{var ue,me;this.logger.debug({msg:"State Stage Message occurred",state:K});const ce=K.payload,de=(ue=ce.participants)!==null&&ue!==void 0?ue:[],we=(me=ce.disconnected)!==null&&me!==void 0?me:[],Me=[],nt=[];this.measureStateUpdate(de.length),this.enableFeaturesBasedOnServerFeatures(ce.serverFeatures||[]);const bt=(ut,dt)=>{this.analyticsTracker.trackEventNoSharedProps(new CT({token:F,otherParticipantId:ut.id,otherParticipantUserId:ut.userId,isAudioMuted:ut.audioMuted,isVideoStopped:ut.videoStopped,isPublishing:ut.isPublishing,isDisconnected:dt,traceId:V}))};this.participants.forEach((ut=>{const dt=de.find((Qe=>Qe.id===ut.id));if(dt){let Qe=!0,st=!1;["isPublishing","id","audioMuted","joinedAt","userId","videoStopped"].forEach((It=>{Qe=Qe&&dt[It.toString()]===ut[It.toString()],Qe||(ut[It.toString()]=dt[It.toString()],st=!0)})),Object.keys(ut.attributes).forEach((It=>{Qe=Qe&&dt.attributes[It]===ut.attributes[It],Qe||(ut.attributes=dt.attributes,st=!0)})),st&&(bt(ut,!1),this.emit(Pf,dt))}else nt.push(ut)})),de.forEach((ut=>{this.participants.get(ut.id)||Me.push(ut)})),nt.forEach((ut=>{this.participants.delete(ut.id),bt(ut,!0),this.emit(Zc,ut)})),Me.forEach((ut=>{this.participants.set(ut.id,ut),bt(ut,!1),this.emit(Ua,ut)})),we.forEach((ut=>{this.disconnected.find((dt=>dt.id===ut.id))||(this.disconnected.push(ut),ut.status==="KICKED"&&this.emit(F_,ut))})),this.disconnected=we},this.nonScopedLogger=A,this.logger=new Ka(A,oe.CONNECTION),this.stageSocket=new jy(E,this.nonScopedLogger,O),this.token=E,this.traceId=Ns()}resetStats(){return this.stats={isConnected:!1,edpInitialStartConnectTime:0,edpInitialFinishConnectTime:0,edpConnectCount:0,edpInitialConnectDuration:0,edpConnectDuration:0,edpInitialStateDuration:0,edpInitialStatePublishingCount:0,edpStateUpdateCount:0,edpInitialConnectRetries:0},this.stats}connect(E){return Ro(this,void 0,void 0,(function*(){return this.logger.debug({msg:"connect invoked",token:this.token,traceId:E}),this.traceId=E,this.state.value!==Ni.DISCONNECTED&&(this.logger.debug({msg:"Disconnecting previous connection"}),this.processStateUpdate({type:"DISCONNECT",reason:nc.CLIENT_RECONNECT})),new Promise(((A,O)=>{this.stageSocket.on(Jp,(F=>{var V,K;const{retryCnt:ue,initialStageState:me}=F;me&&this.enableFeaturesBasedOnServerFeatures((K=(V=me.payload)===null||V===void 0?void 0:V.serverFeatures)!==null&&K!==void 0?K:[]),this.traceId=F.traceId||Ns(),this.measureConnect(ue,this.state.context.connectStartTime),this.processStateUpdate({type:"CONNECT_SUCCESS"}),this.startStageMinuteLoggedInterval(this.token,this.traceId),A(this.traceId)})),this.stageSocket.on(Sl,(F=>{O(F),this.processStateUpdate({type:"ERROR",payload:{error:F}})})),this.stageSocket.on(Yg,(()=>{this.logger.debug({msg:"Refresh event occurred"}),this.emit(Pd),this.processStateUpdate({type:"RECONNECT"})})),this.stageSocket.on(Hu,(F=>this.onStageStateMessage(this.token,this.traceId,F))),this.stageSocket.on(Ty,(F=>this.trackStageSocketMessageParseError(this.token,this.traceId,F))),this.stageSocket.on(Kg,this.onDisconnectMessage),this.stageSocket.on(wy,this.onReassignmentMessage),this.stageSocket.on($_,this.onIncompatibleCodecsMessage),this.stageSocket.on(J1,this.onSsuMessage),this.stageSocket.on(dr,(F=>{this.stopStageMinuteLoggedInterval()})),this.processStateUpdate({type:"CONNECT",payload:{token:this.token,traceId:E}})}))}))}disconnect(){return this.logger.debug({msg:"disconnect invoked"}),this.processStateUpdate({type:"DISCONNECT",reason:nc.USER_INITIATED}),this.traceId}getParticipant(E){return this.participants.get(E)}listConnectedParticipants(){const E=[];return this.participants.forEach((A=>{A.subscribed&&E.push(A)})),E}listAvailableParticipants(){return Array.from(this.participants.values())}emitStageState(E,A){this.stageSocket.send({audioMuted:E,type:"SET_STATE",version:"0",videoStopped:A})}setStagePublishing(E){this.isStagePublishing=E,this.emit(zu,this.isStagePublishing)}getIsStagePublishing(){return this.isStagePublishing}startStageMinuteLoggedInterval(E,A){this.uploadStageMinutesBroadcastInterval||(this.analyticsTracker.trackEvent(new h0(E,A,this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++,this.uploadStageMinutesBroadcastInterval=setInterval((()=>{this.analyticsTracker.trackEvent(new h0(E,A??Ns(),this.stageMinutesLogged,this.isStagePublishing,0)),this.stageMinutesLogged++}),6e4))}stopStageMinuteLoggedInterval(E=!1){this.uploadStageMinutesBroadcastInterval&&(clearInterval(this.uploadStageMinutesBroadcastInterval),this.uploadStageMinutesBroadcastInterval=void 0),E&&(this.stageMinutesLogged=0)}enableFeaturesBasedOnServerFeatures(E){const A=(K,ue)=>{this.trackStageStateMessageParseError(this.token,this.traceId,ue,`Could not parse "${K}" from the Eevee server features list`)},O=E.includes(Fo.SDP_EXCHANGE);this.features.sdpExchange!==O&&(this.logger.debug({msg:`XDP SDP exchange feature toggled: ${O}`}),this.features.sdpExchange=O);const F=E.find((K=>K.indexOf(Fo.JITTER_BUFFER_MIN_DELAY_MS)!==-1)),V=K=>{this.logger.debug({msg:`jitterBufferMinDelay feature updated to: ${K}`}),this.features.jitterBufferMinDelayInMs=K};if(F!==void 0)try{const K=F.split("=")[1],ue=parseInt(K,10);if(isNaN(ue))throw new Error("Unable to parse - result is NaN");if(ue<0)throw new Error("Unable to apply - result is negative");this.features.jitterBufferMinDelayInMs!==void 0&&this.features.jitterBufferMinDelayInMs===ue||V(ue)}catch(K){A(F,K),V(void 0)}else V(void 0)}mapJoinErrorCodeToDisconnectReason(E){switch(E.code){case Jt.PARTICIPANT_DISCONNECTED.code:return nc.PARTICIPANT_DISCONNECTED;case Jt.STAGE_DELETED.code:return nc.STAGE_DELETED;case Jt.EXPIRED_TOKEN.code:return nc.TOKEN_EXPIRED;default:return nc.UNKNOWN}}isConnected(){return this.state.value===Ni.CONNECTED}supportsSdpExchange(){return this.features.sdpExchange}jitterBufferMinDelayInMs(){return this.features.jitterBufferMinDelayInMs}getConnectionStats(){return Object.assign({},this.stats,{isConnected:this.isConnected()})}exchangeSdp(E,A,O,F,V,K,ue,me,ce){return Ro(this,void 0,void 0,(function*(){return this.isConnected()?new Promise(((de,we)=>{const Me=window.setTimeout((()=>{nt(),we(oa.TIMEDOUT)}),12e3),nt=()=>{window.clearTimeout(Me),this.stageSocket.off(z_,bt),this.stageSocket.off(Sl,ut)},bt=dt=>{dt.requestId===F&&(nt(),de(dt))},ut=()=>{nt(),we(oa.CONNECTION_LOST)};V?.addEventListener("abort",(()=>{nt(),we(oa.ABORTED)})),this.stageSocket.on(z_,bt),this.stageSocket.on(Sl,ut),this.stageSocket.sendSdpOffer(E,A,O,F,K,ue,me,ce)})):Promise.reject(oa.NOT_CONNECTED)}))}}class $d{constructor(E){this.token=E}}const el=new RegExp("^(?:[a-z+]+:)?//","i");function Cc(M){return el.test(M)}function Rc({sdpExchangeTransport:M,serverHttpResponse:E,serverErrorCode:A}){return`sdpExchangeTransport: ${M}, serverHttpResponse: ${E}, serverErrorCode: ${A}`}var Ju=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};const nu={[oa.ABORTED]:Jt.OPERATION_ABORTED,[oa.NOT_CONNECTED]:Jt.EVENT_PLANE_WS_UNEXPECTED_CLOSE,[oa.CONNECTION_LOST]:Jt.XDP_CONNECTION_LOST,[oa.TIMEDOUT]:Jt.XDP_TIMEOUT,[oa.INVALID_MESSAGE]:Jt.XDP_INVALID_ANSWER_MSG,[oa.UNEXPECTED_ERROR]:Jt.XDP_UNEXPECTED_ERROR};class aa extends $d{constructor(E,A,O,F){super(E),this.token=E,this.stageConnection=A,this.contextData=O,this.analyticsTracker=F}exchange(E){return Ju(this,void 0,void 0,(function*(){const A=Nd(),{action:O}=this.contextData,{sdpOffer:F,url:V,traceId:K,forceNode:ue,assignmentToken:me,multiCodec:ce,abortController:de,initialLayerPreference:we}=E;let Me;this.trackAttempt(V,A,K);try{Me=yield this.stageConnection.exchangeSdp(F,V,K.value,A.value,de?.signal,ue,me,ce,we)}catch(En){if(typeof En=="number")throw this.createClientSideErrorFromReasonCode(En,K,A,O)}if(!Me)return;const{httpStatusCode:nt,errorCode:bt,location:ut,content:dt,sessionDeleteLink:Qe,subscriberControlLink:st,videoLayersLink:It}=Me;if(nt>=200&&nt<300)return{sdpAnswer:dt,url:V,location:ut,sessionDeleteLink:Qe,mediaControls:st,layerControls:It};throw this.createServerSideError(K,A,nt,bt,O)}))}trackAttempt(E,A,O){const{remoteParticipantId:F,action:V}=this.contextData;this.analyticsTracker.trackEventNoSharedProps(new Ay(V,this.token,E,"POST",A.value,F,O,"xdp"))}createServerSideError(E,A,O,F,V){const K=this.baseErrorProps(E,A);let ue=Wg(O,F);return ue||(ue=Jt.UNKNOWN_SERVER_ERROR),new Rr(Object.assign(Object.assign(Object.assign({action:V},K),ue),{details:Rc({sdpExchangeTransport:"xdp",serverHttpResponse:O,serverErrorCode:F})}))}baseErrorProps(E,A){const{remoteParticipantId:O,action:F}=this.contextData;return{token:this.token,traceId:E,tag:Lo(F,O),location:"EdpSdpExchanger.exchange",requestUUID:A,remoteParticipantId:O}}createClientSideErrorFromReasonCode(E,A,O,F){const V=this.baseErrorProps(A,O),K=nu[E];return new Rr(K?Object.assign(Object.assign({action:F},V),K):Object.assign(Object.assign({action:F},V),Jt.XDP_INVALID_ANSWER_MSG))}getTransport(){return"sdp"}}var p0=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class jf extends $d{constructor(E,A,O){super(E),this.contextData=A,this.analyticsTracker=O}exchange(E){var A,O,F;return p0(this,void 0,void 0,(function*(){const V=Nd(),{token:K}=this,{action:ue,remoteParticipantId:me}=this.contextData,{sdpOffer:ce,url:de,traceId:we,forceNode:Me,assignmentToken:nt,multiCodec:bt,abortController:ut,initialLayerPreference:dt}=E;try{const st="POST",It="http";this.analyticsTracker.trackEventNoSharedProps(new Ay(ue,K,de,st,V.value,me,we,It));const En={data:ce,headers:{Authorization:`Bearer ${K.rawToken}`,"Content-Type":"application/sdp","X-Stages-Platform":"web","X-Stages-Request-ID":V.value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":we.value,"X-Stages-WHIP-Version":ra,[mT]:(Qe=JSON.stringify({[Z1]:["sau"]}),btoa(Qe).replace(/[^A-Za-z0-9+/]/g,""))},method:st,responseType:"text",url:de,signal:ut?.signal,params:{}};Me&&(En.params.force_node=Me),nt&&(En.params.assignment_token=nt),bt&&(En.params.multi_codec=!0);const Dn=ba()===void 0,Xn=ba()||Dn;dt&&En.headers&&Xn&&(En.headers["X-Stages-Initial-Layer-Pref"]=Ry(dt));const{data:g,headers:y,request:k}=yield E_(En),j=this.parseWhipResource(de,y.location,y.link);return{url:k.responseURL,sdpAnswer:g,location:j?.location,sessionDeleteLink:j?.sessionDeleteLink,mediaControls:j?.mediaControls,layerControls:j?.layerControls}}catch(st){if(Tf().isCancel(st))throw new Rr(Object.assign(Object.assign({},Wh(Jt.OPERATION_ABORTED,st)),{action:ue,token:K,traceId:we,tag:Lo(ue,me),location:"StagePeerClient.start",requestUUID:V,remoteParticipantId:me}));const It=Number((A=st?.response)===null||A===void 0?void 0:A.status)||-1,En=((F=(O=st?.response)===null||O===void 0?void 0:O.data)===null||F===void 0?void 0:F.code)||-1,Dn=(function(Xn,g){var y;return Xn instanceof bc.AxiosError&&Xn.response&&typeof Xn.response.status=="number"?Xn instanceof bc.AxiosError&&Xn.code==="ERR_NETWORK"?Jt.NETWORK_FAILURE:Wg(Number(Xn.response.status),(y=Xn.response.data)===null||y===void 0?void 0:y.code)||g:g})(st,Jt.WHIP_POST_FAILURE);throw new Rr(Object.assign(Object.assign({},Wh(Dn,st)),{action:ue,token:K,traceId:we,tag:Lo(ue,me),details:Rc({sdpExchangeTransport:"http",serverHttpResponse:It,serverErrorCode:En}),location:"StagePeerClient.start",requestUUID:V,remoteParticipantId:me}))}var Qe}))}parseWhipResource(E,A,O){const F=new URL(E);let V;return V=(function(K,ue,me){if(!me)return K;if(K||(K={}),Cc(me))return K.location=me,K;const ce=ue.port?`:${ue.port}`:"";return K.location=`${ue.protocol}//${ue.hostname}${ce}${me}`,K})(V,F,A),V=(function(K,ue,me){if(!me)return K;K||(K={});const ce=K;return me.split(",").forEach((de=>{const we=/<(.+)>;\s?rel="([a-z:-]+)"/.exec(de);if(we?.length!==3)return;let Me;if(Cc(we[1]))Me=we[1];else{const nt=ue.port?`:${ue.port}`:"";Me=`${ue.protocol}//${ue.hostname}${nt}${we[1]}`}switch(we[2]){case"urn:ietf:params:whip:ivs-stages:session-delete":ce.sessionDeleteLink=Me;break;case"urn:ietf:params:whep:core:playback-controls":ce.mediaControls=Me;break;case"urn:ietf:params:whep:ext:core:layer":ce.layerControls=Me;break;default:return}})),ce})(V,F,O),V}getTransport(){return"http"}}function nv(M){const{connection:E,token:A,action:O,identifier:F,tracker:V}=M,K=E&&E.supportsSdpExchange()&&E.isConnected(),ue=O===Qt.SUBSCRIBE&&K&&!b_()&&!Gc("disableXdpSubscribe"),me=O===Qt.PUBLISH&&K&&!b_()&&!Gc("disableXdpPublish");return ue||me?new aa(A,E,{action:O,remoteParticipantId:F},V):new jf(A,{action:O,remoteParticipantId:F},V)}function jo({stageErrorValue:M,action:E,token:A,traceId:O,tag:F,identifier:V,details:K}){return new Rr(Object.assign(Object.assign({},M),{token:A,traceId:O,location:"peer-client",tag:F,action:E,remoteParticipantId:V,details:K}))}var li;function _i(M){var E;return!((E=M?.sender)===null||E===void 0)&&E.createEncodedStreams?li.INSERTABLE_STREAMS:window.RTCRtpSender&&"transform"in RTCRtpSender.prototype&&window.RTCRtpScriptTransform?li.ENCODED_TRANSFORMS:li.NONE}function ru(M){var E;return!((E=M?.receiver)===null||E===void 0)&&E.createEncodedStreams?li.INSERTABLE_STREAMS:window.RTCRtpReceiver&&"transform"in RTCRtpReceiver.prototype&&window.RTCRtpScriptTransform?li.ENCODED_TRANSFORMS:li.NONE}function tl(){return vy()(`/*! For license information please see transform.worker.worker.js.LICENSE.txt */
(()=>{"use strict";const e=new Uint8Array([158,80,78,165,238,90,79,2,148,159,176,51,163,118,141,162]);var t;!function(e){e.VIDEO_SEND="video/send",e.VIDEO_RECEIVE="video/receive",e.INSERT_SEI="insertSei"}(t||(t={}));function n(t,n){const{transformerId:s,type:r,payloads:a}=n;let o=[];if("sei"===n.type){const{value:n,messages:s}=function(t,n){function s(e,t,n){return n+t.length<=e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function r(e,t){const n=function(e,t){return new Uint8Array([0,0,1,6,5,...t,...e])}(e,function(e){const t=[];for(;e>=255;)t.push(255),e-=255;return t.push(e),new Uint8Array(t)}(t.length+e.length)),s=function(e){const t=[...e];let n=3;for(;n<t.length-2;)0!==t[n]||0!==t[n+1]||0!==t[n+2]&&1!==t[n+2]&&2!==t[n+2]&&3!==t[n+2]?n+=1:(t.splice(n+2,0,3),n+=3);return t}(new Uint8Array([...n,...t,128]));return new Uint8Array(s)}function a(e,n){const r=function(e){const t=new DataView(e);for(let e=0;e<t.byteLength-4;e++)if(s(t,[0,0,1],e)){const n=31&t.getUint8(e+3);if(n>=1&&n<=5)return e}return-1}(t.data);if(r>=0){const e=new ArrayBuffer(t.data.byteLength+n.byteLength),s=new Uint8Array(e);return s.set(new Uint8Array(t.data.slice(0,r)),0),s.set(n,r),s.set(new Uint8Array(t.data.slice(r)),r+n.byteLength),e}return e}return function(){const s=[];for(let o=0;o<n.length;o+=1){const i=r(e,new Uint8Array(n[o]));t.data=a(t.data,i),s.push({uuid:e,payload:n[o]})}return{value:t,messages:s}}()}(t,a||[]);t=n,o=s}return{success:!0,frame:t,transformerId:s,type:r,seiResult:o}}const s=function(){let e=[];const t=new Map;return{add:({payload:t,repeatCount:n})=>(e.push({payload:t,repeatCount:n}),!0),poll(n){t.has(n)||t.set(n,[]),t.size>0&&(t.forEach((t=>{t.push(...e)})),e=[]);const s=t.get(n)||[],r=s.filter((e=>e.repeatCount>0)).map((e=>Object.assign(Object.assign({},e),{repeatCount:e.repeatCount-1})));return t.set(n,r),s}}}(),r=e=>(t,r)=>{try{const a=t.getMetadata().synchronizationSource,o=(s?s.poll(a):[]).map((e=>e.payload)),i=n(t,Object.assign(Object.assign({},e),{payloads:o}));r.enqueue(i.frame),self.postMessage(Object.assign({success:i.success,seiResult:i.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}},a=e=>(t,n)=>{try{const s=function(e,t){const{type:n,transformerId:s}=t;if("sei"===n){const t=function(e){function t(e,t,n){return n+t.length<e.byteLength&&t.every(((t,s)=>e.getUint8(n+s)===t))}function n(e){const t=[];let n=0;for(;n<e.length;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(t.push(e[n]),t.push(e[n+1]),n+=3):(t.push(e[n]),n+=1);return new Uint8Array(t)}function s(e){let t=2;const n=e.byteLength;for(;t<n;){let s=0;for(;t<n&&255===e[t];)s+=255,t++;s+=e[t],t++;const r=Math.min(t+s,n),a=new Uint8Array(e.slice(t,r));return{uuid:a.slice(0,16),payload:a.slice(16)}}}return{messages:function(e){const r=new DataView(e.data),a=[];let o=0;if(!t(r,[0,0,1],0)&&!t(r,[0,0,0,1],0))return[];for(;o<r.byteLength-5;)if(t(r,[0,0,1],o)){const i=o+3;o=i;const c=31&r.getUint8(o),u=31&r.getUint8(o+1);if(6===c&&5===u){for(;o<r.byteLength&&!t(r,[0,0,1],o);)o++;const c=o,u=s(n(new Uint8Array(e.data.slice(i,c))));u&&a.push(Object.assign({},u))}else o++}else o++;return a}(e),frame:e}}(e),{frame:r,messages:a}=t;return{success:!0,frame:r,type:n,transformerId:s,seiResult:a}}return{success:!0,frame:e,transformerId:s,type:n}}(t,e);n.enqueue(s.frame),self.postMessage(Object.assign({success:s.success,seiResult:s.seiResult},e))}catch(t){self.postMessage(Object.assign({success:!1},e))}};function o(e,t,n,s){const o=new TransformStream({transform:"video/send"===e?r(t):a(t)});n.pipeThrough(o).pipeTo(s)}const i=self;i.addEventListener("message",(function(e){var n,r,a;if(!(null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.operation)||!(null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.transformerId))return;const{operation:i,transformerId:c}=e.data;switch(i){case t.VIDEO_SEND:case t.VIDEO_RECEIVE:o(i,{method:i,transformerId:c,type:"sei"},e.data.readable,e.data.writable);break;case t.INSERT_SEI:s.add({payload:e.data.payload,repeatCount:null!==(a=e.data.repeatCount)&&void 0!==a?a:0})}})),i.addEventListener("rtctransform",(function(e){const t=e.transformer;if(!t)return;o(t.options.method,t.options,t.readable,t.writable)}))})();`,"Worker",void 0,void 0)}(function(M){M.NONE="none",M.ENCODED_TRANSFORMS="encodedTransforms",M.INSERTABLE_STREAMS="insertableStreams"})(li||(li={}));const zf=(()=>{const M={};return{getWorker:E=>(M[E]||(M[E]=new tl),M[E]),destroy:E=>{var A;(A=M[E])===null||A===void 0||A.terminate(),M[E]=void 0}}})();var ca;(function(M){M.NOT_PUBLISHING_VIDEO="NOT_PUBLISHING_VIDEO",M.INBAND_MESSAGING_NOT_ENABLED="INBAND_MESSAGING_NOT_ENABLED",M.INVALID_REPEAT_COUNT="INVALID_REPEAT_COUNT",M.PAYLOAD_SIZE_INVALID="PAYLOAD_SIZE_INVALID",M.PAYLOAD_RATE_EXCEEDED="PAYLOAD_RATE_EXCEEDED",M.INVALID_TRACK_TYPE="INVALID_TRACK_TYPE"})(ca||(ca={}));class Jh{constructor(E){this.maxFramerate=E,this.queued=[]}validateMessagePayload(E,A){if(E.byteLength<=0)return xn.err(ca.PAYLOAD_SIZE_INVALID);if(A<0||A>30)return xn.err(ca.INVALID_REPEAT_COUNT);if(E.byteLength>1024)return xn.err(ca.PAYLOAD_SIZE_INVALID);this.queued=this.trimPastPayloads(this.queued,1e3);const{before:O,after:F}=this.getPayloadSums(this.queued);if(O+E.byteLength>10240||F+E.byteLength*Math.max(1,A)>10240)return xn.err(ca.PAYLOAD_RATE_EXCEEDED);if(this.queued.push({byteLength:E.byteLength,timestamp:Date.now()}),A>0){const V=1e3/this.maxFramerate;let K=Date.now()+V;for(let ue=0;ue<A;ue+=1)this.queued.push({byteLength:E.byteLength,timestamp:K}),K+=V}return xn.ok(!0)}trimPastPayloads(E,A){const O=Date.now()-A;return E.filter((F=>F.timestamp>O))}getPayloadSums(E){const A=Date.now();return E.reduce(((O,F)=>{const{before:V,after:K}=O;return F.timestamp<=A?{before:V+F.byteLength,after:K}:{before:V,after:K+F.byteLength}}),{before:0,after:0})}}const Qu="seiMessageReceived",SS="error";var ys;(function(M){M.CREATED="created",M.INITIALIZED="initialized",M.DESTROYED="destroyed"})(ys||(ys={}));class rv extends Da{constructor(E){super(),this.sessionId=E,this.state=ys.CREATED,this.transformerId=Nd().value,this.prevResultWasError=!1,this.consecutiveErrorResults=0,this.seiReadCnt=0,this.seiBytesRead=0,this.onMessage=A=>{this.onTransformResult(A.data)}}initializeInsertableStreams(E){var A,O;this.worker=zf.getWorker(this.sessionId);const F=E.receiver.createEncodedStreams(),{readable:V,writable:K}=F;(A=this.worker)===null||A===void 0||A.postMessage({operation:"video/receive",transformerId:this.transformerId,readable:V,writable:K},[V,K]),(O=this.worker)===null||O===void 0||O.addEventListener("message",this.onMessage)}initializeEncodedTransforms(E){var A;this.worker=zf.getWorker(this.sessionId);const O={method:"video/receive",type:"sei",transformerId:this.transformerId};E.receiver.transform=new RTCRtpScriptTransform(this.worker,O),(A=this.worker)===null||A===void 0||A.addEventListener("message",this.onMessage)}initialize(E,A){if(this.state!==ys.CREATED)return!1;const O=ru(E);if(O===li.NONE)return!1;if(A&&O===li.INSERTABLE_STREAMS)this.initializeInsertableStreams(E);else{if(A||O!==li.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(E)}return this.transceiver=E,this.state=ys.INITIALIZED,!0}onTransceiverAdd(E){return this.initialize(E,!0)}onTrackEvent(E){return E.track.kind==="video"&&this.initialize(E.transceiver,!1)}static isSupported(E){return ru(E)!==li.NONE}onTransformResult(E){return E.transformerId===this.transformerId&&(E.success?(this.prevResultWasError=!1,this.consecutiveErrorResults=0,!!E.seiResult&&(E.seiResult.forEach((A=>{const{payload:O,uuid:F}=A;this.updateReadStats(A),this.emit(Qu,{uuid:F,payload:O})})),E.seiResult.length>0)):(this.prevResultWasError&&this.consecutiveErrorResults++,this.consecutiveErrorResults>=300&&this.onError(E,Jt.TRANSFORM_TOO_MANY_ERRORS),this.prevResultWasError=!0,this.onError(E,Jt.TRANSFORM_UNEXPECTED_ERROR),!1))}updateReadStats(E){this.seiReadCnt++,this.seiBytesRead+=E.payload.byteLength}getReceiverStats(){const{seiBytesRead:E,seiReadCnt:A}=this;return{seiReadCnt:A,seiBytesRead:E}}onError(E,A){const{type:O}=E;this.emit(SS,{type:O,stageErrorValue:A})}destroy(){var E,A;this.state!==ys.DESTROYED&&(this.removeAllListeners(),(E=this.worker)===null||E===void 0||E.removeEventListener("message",this.onMessage),!((A=this.transceiver)===null||A===void 0)&&A.receiver&&(this.transceiver.receiver.transform=null),this.state=ys.DESTROYED)}getState(){return this.state}}class Ps{constructor(E){this.sessionId=E,this.state=ys.CREATED,this.transformerId=Nd().value,this.seiWriteCnt=0,this.seiBytesWritten=0,this.onMessage=A=>{this.onTransformResult(A.data)}}initializeInsertableStreams(E,A){var O,F;this.worker=zf.getWorker(this.sessionId);const V=E.sender.createEncodedStreams(),{readable:K,writable:ue}=V;(O=this.worker)===null||O===void 0||O.postMessage({operation:"video/send",transformerId:this.transformerId,readable:K,writable:ue},[K,ue]),(F=this.worker)===null||F===void 0||F.addEventListener("message",this.onMessage)}initializeEncodedTransforms(E,A){var O;this.worker=zf.getWorker(this.sessionId);const F={method:"video/send",type:"sei",transformerId:this.transformerId,encodingLayers:A};E.sender.transform=new RTCRtpScriptTransform(this.worker,F),(O=this.worker)===null||O===void 0||O.addEventListener("message",this.onMessage)}initialize(E){var A;if(this.state!==ys.CREATED)return!1;const O=_i(E);if(O===li.NONE)return!1;const F=E.sender.getParameters(),V=((A=F?.encodings)===null||A===void 0?void 0:A.length)||1;if(O===li.INSERTABLE_STREAMS)this.initializeInsertableStreams(E,V);else{if(O!==li.ENCODED_TRANSFORMS)return!1;this.initializeEncodedTransforms(E,V)}return this.transceiver=E,this.state=ys.INITIALIZED,!0}static isSupported(E){return _i(E)!==li.NONE}sendSeiMessage(E,A){var O;return this.state===ys.INITIALIZED&&this.transceiver?((O=this.worker)===null||O===void 0||O.postMessage({operation:"insertSei",transformerId:this.transformerId,payload:E,repeatCount:A}),xn.ok(!0)):xn.err(ca.NOT_PUBLISHING_VIDEO)}onTransceiverAdd(E){return this.initialize(E)}onTrackEvent(E){return!1}onTransformResult(E){return E.transformerId===this.transformerId&&(E.success&&this.updateSendStats(E),E.success)}updateSendStats(E){E.seiResult&&E.seiResult.forEach((A=>{this.seiWriteCnt++,this.seiBytesWritten+=A.payload.byteLength}))}getSenderStats(){const{seiBytesWritten:E,seiWriteCnt:A}=this;return{seiWriteCnt:A,seiBytesWritten:E}}destroy(){var E;this.state!==ys.DESTROYED&&(!((E=this.transceiver)===null||E===void 0)&&E.receiver&&(this.transceiver.receiver.transform=null),this.state=ys.DESTROYED)}getState(){return this.state}}class iv extends Kn{constructor(E,A,O,F,V,K,ue,me,ce){super(Mn.SELECTED_PAIR_CHANGE,A,O,!1),Object.assign(this.properties,{action:E,protocol:F,local_type:V,local_addr:K,remote_addr:ue,local_candidate_priority:me,remote_participant_id:ce})}}var xs=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};let Qh=null;class m0 extends Da{constructor(E,A,O,F,V,K,ue,me,ce){var de;if(super(),this.analyticsTracker=K,this.subscribeConfig=ce,this.sfuResource={node:"",cluster:""},this.protocol="",this.incompatibleCodecs=new Set,this.connect=({audioOnly:we=!1,traceId:Me,iceRestartOptions:nt})=>xs(this,void 0,void 0,(function*(){const{token:bt,tag:ut,identifier:dt,action:Qe}=this,st=!!nt,It=new AbortController;let En,Dn,Xn;this.abortController=It,this.traceId=Me,this.protocol="",this.perfTracker.resetMeasurements(Me);const g=()=>{En&&this.off(Ou,En),Dn&&this.off(qc,Dn)},y=new Promise(((k,j)=>{const ne=(function({action:Ze,token:St,traceId:Dt,tag:Kt,identifier:Xt}){const vn=Ze===Qt.SUBSCRIBE?Jt.SUBSCRIBE_TIMED_OUT:Jt.PUBLISH_TIMED_OUT;return new Rr(Object.assign(Object.assign({},vn),{action:Ze,token:St,traceId:Dt,tag:Kt,location:"connect",remoteParticipantId:Xt}))})({action:Qe,token:bt,traceId:Me,tag:ut,identifier:dt}),le=(function({action:Ze,token:St,traceId:Dt,tag:Kt}){const Xt=Jt.OPERATION_ABORTED;return new Rr(Object.assign(Object.assign({},Xt),{token:St,traceId:Dt,location:"peer-client.connect",tag:Kt,action:Ze}))})({action:Qe,token:bt,traceId:Me,tag:ut}),Ne=setTimeout((()=>{this.stop(),this.analyticsTracker.trackError(ne),j(ne)}),1e4);En=Ze=>{clearTimeout(Ne),st||this.stop(),j(Ze)},Dn=Ze=>{if(Ze===hr.CONNECTED)clearTimeout(Ne),k();else if(Ze===hr.FAILED){const St=(function({action:Dt,token:Kt,traceId:Xt,tag:vn}){return new Rr(Object.assign(Object.assign({},Jt.PEER_CONNECTION_NETWORK_FAILURE),{token:Kt,traceId:Xt,location:"peer-client.connect",tag:vn,action:Dt}))})({action:Qe,token:bt,traceId:Me,tag:ut});clearTimeout(Ne),j(St)}},this.on(Ou,En),this.on(qc,Dn),Xn=()=>{clearTimeout(Ne)},It.signal.aborted&&(clearTimeout(Ne),j(le)),It.signal.addEventListener("abort",(()=>{clearTimeout(Ne),j(le)}))}));try{const k=yield Promise.all([xs(this,void 0,void 0,(function*(){st||(yield this.start(),this.mediaStream=yield this.initializePeerConnection(we));const ne=nt?.assignmentToken,le=nt?.nodeOverride;return yield this.exchangeSdp({iceRestart:st,nodeOverride:le,assignmentToken:ne,abortController:It}),this.mediaStream})),y]);this.statsReporter.traceId=Me;const j=k[0];if(this.abortController=void 0,!st&&Qe===Qt.PUBLISH)try{yield this.verifyOrUpdateTransceiverSync()}catch(ne){this.logger.error({err:ne,msg:"error syncing transceivers"})}return{mediaStream:j}}catch(k){throw Xn&&Xn(),k}finally{g()}})),this.disconnect=(we=!1)=>xs(this,void 0,void 0,(function*(){var Me;const{token:nt,action:bt}=this;(Me=this.abortController)===null||Me===void 0||Me.abort(),this.stop(),this.protocol="",we?this.cleanup(bt,nt.participantID,nt,we):yield this.cleanup(bt,nt.participantID,nt,we)})),this.resetTransformers=()=>{var we,Me;(we=this.videoSenderTransformer)===null||we===void 0||we.destroy(),this.videoSenderTransformer=this.createVideoSenderTransformer(),(Me=this.videoReceiverTransformer)===null||Me===void 0||Me.destroy(),this.videoReceiverTransformer=this.createVideoReceiverTransformer(),this.statsReporter.resetTransformers(this.videoReceiverTransformer,this.videoSenderTransformer)},this.onTrack=we=>{var Me,nt;const{token:bt,action:ut,traceId:dt,identifier:Qe}=this;this.trace(bt,dt,`onTrack: ${we.track.kind}`,ut,Qe),this.sendInBandMessagingEnabled&&((Me=this.videoSenderTransformer)===null||Me===void 0||Me.onTrackEvent(we)),this.receiveInBandMessagingEnabled&&((nt=this.videoReceiverTransformer)===null||nt===void 0||nt.onTrackEvent(we))},this.onIceGatheringStateChange=()=>{var we,Me,nt;const{token:bt,action:ut,traceId:dt,identifier:Qe}=this;if(((we=this.peerConnection)===null||we===void 0?void 0:we.iceGatheringState)==="gathering"?this.perfTracker.markIceGatheringStart():((Me=this.peerConnection)===null||Me===void 0?void 0:Me.iceGatheringState)==="complete"&&this.perfTracker.markIceGatheringStop(),this.peerConnection){const st=this.peerConnection.iceGatheringState,It=new El(ut,bt,dt,st,Qe);this.analyticsTracker.trackEventNoSharedProps(It)}this.trace(bt,dt,`ICE gathering state change: ${(nt=this.peerConnection)===null||nt===void 0?void 0:nt.iceGatheringState}`,ut,Qe)},this.onSelectedCandidatePairChange=()=>{var we,Me,nt,bt,ut,dt,Qe,st,It,En,Dn,Xn,g,y;const{token:k,action:j,traceId:ne,identifier:le}=this,Ne=(Me=(we=this.peerConnection)===null||we===void 0?void 0:we.getReceivers()[0].transport)===null||Me===void 0?void 0:Me.iceTransport,Ze=Ne?.getSelectedCandidatePair();if(Ze){const{local:St,remote:Dt}=Ze,Kt=`Selected candidate pair change (local, remote): ${St?.candidate}, ${Dt?.candidate}`;this.logger.debug({msg:Kt});const Xt=new iv(j,k,ne,(bt=(nt=Ze.local)===null||nt===void 0?void 0:nt.protocol)!==null&&bt!==void 0?bt:"",(dt=(ut=Ze.local)===null||ut===void 0?void 0:ut.type)!==null&&dt!==void 0?dt:"",(st=(Qe=Ze.local)===null||Qe===void 0?void 0:Qe.address)!==null&&st!==void 0?st:"",(En=(It=Ze.remote)===null||It===void 0?void 0:It.address)!==null&&En!==void 0?En:"",(Xn=(Dn=Ze.local)===null||Dn===void 0?void 0:Dn.priority)!==null&&Xn!==void 0?Xn:0,le);this.analyticsTracker.trackEvent(Xt),this.protocol=(y=(g=Ze.local)===null||g===void 0?void 0:g.protocol)!==null&&y!==void 0?y:""}},this.onIceCandidate=we=>xs(this,void 0,void 0,(function*(){var Me,nt;const{identifier:bt,action:ut,traceId:dt}=this,Qe=(Me=we.target.localDescription)===null||Me===void 0?void 0:Me.sdp.includes("relay");this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,dt,`ice candidate: hasRelay = ${Qe}, candidate = ${(nt=we.candidate)===null||nt===void 0?void 0:nt.candidate}`,ut,bt))})),this.onMute=()=>xs(this,void 0,void 0,(function*(){const{token:we,action:Me,traceId:nt,identifier:bt}=this;this.trace(we,nt,"Track has muted",Me,bt)})),this.onUnMute=()=>xs(this,void 0,void 0,(function*(){const{token:we,action:Me,traceId:nt,identifier:bt}=this;this.trace(we,nt,"Track has unmuted",Me,bt)})),this.fetchAndSetRemoteDescription=we=>xs(this,void 0,void 0,(function*(){var Me,nt,bt,ut;const dt=(nt=(Me=this.peerConnection)===null||Me===void 0?void 0:Me.localDescription)===null||nt===void 0?void 0:nt.sdp;dt||this.logger.warn({msg:"Unexpected state: No SDP offer when attempting to fetch remote description"});const{token:Qe,traceId:st,action:It,identifier:En,tag:Dn}=this,{endpointURL:Xn,nodeOverride:g,assignmentToken:y,multiCodec:k,abortController:j}=we;let ne;this.perfTracker.markPostStart(),this.perfTracker.markSdpExchangeStart();try{const Dt=nv({connection:this.stageConnection,action:It,token:Qe,identifier:this.identifier,tracker:this.analyticsTracker});this.perfTracker.setTransport(Dt.getTransport());const Kt=g||_s("node")||_s("dataPlaneEndpoint");ne=yield Dt.exchange({sdpOffer:dt,url:Xn,traceId:st,forceNode:Kt,assignmentToken:y,multiCodec:k,abortController:j,initialLayerPreference:(bt=this.simulcastSubscribeConfig)===null||bt===void 0?void 0:bt.initialLayerPreference})}catch(Dt){let Kt=Dt;Kt instanceof Rr||(Kt=new Rr(Object.assign(Object.assign({},Jt.UNEXPECTED_ERROR),{action:It,token:Qe,traceId:st,tag:Dn,details:Dt instanceof Error?Dt.message:"",location:"sdp-exchange"}))),Kt instanceof Rr&&(this.analyticsTracker.trackError(Kt),this.emit(Ou,Kt))}if(this.perfTracker.markSdpExchangeStop(),!ne)return;const{location:le,sessionDeleteLink:Ne,mediaControls:Ze}=ne;let St=ne.sdpAnswer;try{St=this.mungeSdpAnswer(St),ne.sdpAnswer=St}catch(Dt){this.logger.error({err:Dt,msg:"Error while attempting to munge SDP, keeping original answer"})}this.statsReporter.sdpAnswer=St,this.emit(wf,ne),le&&(this.whipResource={location:le,sessionDeleteLink:Ne,mediaControls:Ze},this.sfuResource=(function(Dt){const Kt=Dt.match(/https:\/\/([^/]+)\//);if(Kt){const Xt=Kt[1].split(".");if(Xt[0].includes("video-rtx"))return{node:`${Xt[0]}.${Xt[1]}`,cluster:Xt[1]}}})(le)||{node:"",cluster:""},this.statsReporter.updateSfuResource(this.sfuResource));try{this.perfTracker.markSetRemoteDescStart(),yield(ut=this.peerConnection)===null||ut===void 0?void 0:ut.setRemoteDescription({sdp:St,type:"answer"}),this.perfTracker.markSetRemoteDescStop(),this.perfTracker.markPostStop()}catch(Dt){const Kt=new Rr(Object.assign(Object.assign({},Jt.SET_ANSWER_FAILURE),{action:It,token:Qe,traceId:st,tag:Lo(It,En),location:"setRemoteDescription",remoteParticipantId:En,details:Dt instanceof Error?Dt.message:""}));this.analyticsTracker.trackError(Kt),this.emit(Ou,Kt)}})),this.cleanup=(we,Me,nt,bt=!1)=>xs(this,void 0,void 0,(function*(){var ut,dt,Qe;const st=Nd();if(this.toggleStageConnectionListeners(!1),this.currentJitterBufferMinDelayInMs=void 0,this.stageConnection=void 0,this.closeFailedPeerConnections(),!(!((ut=this.whipResource)===null||ut===void 0)&&ut.location))return this.trace(nt,this.traceId,"whipResource location not known, exiting cleanup",we,Me),void this.analyticsTracker.trackError(new Rr(Object.assign(Object.assign({},Jt.WHIP_URL_MISSING),{action:we,token:nt,traceId:this.traceId,tag:Lo(we,Me),location:we===Qt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:st,remoteParticipantId:Me})));let It=this.whipResource.location;if(this.trace(nt,this.traceId,`use hostnamecachedurl: ${It}`,we,Me),bt){if(!((Qe=this.whipResource)===null||Qe===void 0)&&Qe.sessionDeleteLink){It=this.whipResource.sessionDeleteLink,this.trace(nt,this.traceId,`DELETE via session-delete beacon path: ${It}`,we,Me);try{navigator.sendBeacon(It,JSON.stringify({authorization:nt.rawToken}))}catch(En){this.analyticsTracker.trackErrorAndThrow(new Rr(Object.assign(Object.assign({},Wh(Jt.WHIP_DELETE_FAILURE,En)),{action:we,token:nt,traceId:this.traceId,tag:Lo(we,Me),location:Qt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:st,remoteParticipantId:Me})))}}}else try{yield Tf().delete(It,{headers:{Authorization:`Bearer ${nt.rawToken}`,"X-Stages-Platform":"web","X-Stages-Request-ID":st.value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":this.traceId.value,"X-Stages-WHIP-Version":ra}})}catch(En){((dt=En.response)===null||dt===void 0?void 0:dt.status)===404?this.trace(nt,this.traceId,`DELETE returned 404, ignoring, action = ${we}, uuid = ${st.value}`,we,Me):this.analyticsTracker.trackErrorAndThrow(new Rr(Object.assign(Object.assign({},Wh(Jt.WHIP_DELETE_FAILURE,En)),{action:we,token:nt,traceId:this.traceId,tag:Lo(we,Me),location:Qt.SUBSCRIBE?"unsubscribe":"unpublish",requestUUID:st,remoteParticipantId:Me})))}})),this.getConnectionState=()=>{if(!this.peerConnection)return hr.NONE;const we=this.peerConnection.connectionState||this.peerConnection.iceConnectionState;try{return x_(we)}catch{return this.logger.warn({msg:"Unhandled connection state:",rawState:we}),hr.IDLE}},this.onIceCandidateError=we=>{const{token:Me,traceId:nt,tag:bt}=this;if(we.errorCode!==701){const ut=new Rr(Object.assign(Object.assign({},Jt.ICE_CANDIDATE_ERROR),{action:this.action,token:Me,traceId:nt,tag:bt,location:"onIceCandidateError",remoteParticipantId:this.identifier}));this.analyticsTracker.trackError(ut),this.emit(Ou,ut)}},this.onIceConnectionStateChange=()=>{var we,Me;const{token:nt,traceId:bt,action:ut,identifier:dt}=this;this.trace(nt,bt,`ICE connection state change: ${(we=this.peerConnection)===null||we===void 0?void 0:we.iceConnectionState}`,ut,dt),((Me=this.peerConnection)===null||Me===void 0?void 0:Me.iceConnectionState)==="checking"&&this.peerConnection.getTransceivers().forEach((({receiver:Qe,sender:st})=>{[Qe,st].forEach((It=>{var En,Dn;(Dn=(En=It?.transport)===null||En===void 0?void 0:En.iceTransport)===null||Dn===void 0||Dn.addEventListener("selectedcandidatepairchange",this.onSelectedCandidatePairChange)}))})),this.onConnectionStateChange()},this.createVideoSenderTransformer=()=>new Ps(this.analyticsTracker.getSessionId()),this.createVideoReceiverTransformer=()=>{const we=new rv(this.analyticsTracker.getSessionId()),{token:Me,tag:nt,identifier:bt,action:ut,traceId:dt}=this;we.on(Qu,(It=>{this.emit(Lh,It)}));const Qe=(function(It,En){let Dn=0;return function(...Xn){const g=Date.now();g-Dn>=En&&(Dn=g,It(...Xn))}})((It=>{const En=`Transform error occurred: ${It.type}`,Dn=jo({traceId:dt,token:Me,tag:nt,identifier:bt,action:ut,details:En,stageErrorValue:Jt.TRANSFORM_UNEXPECTED_ERROR});this.logger.warn({err:Dn,msg:"Error encountered when transforming receiver",error:It})}),1e3),st=It=>{const En=`Too many errors occurred: ${It.type}`,Dn=jo({traceId:dt,token:Me,tag:nt,identifier:bt,action:ut,details:En,stageErrorValue:Jt.TRANSFORM_TOO_MANY_ERRORS});this.logger.error({err:Dn,msg:"Too many errors encountered when transforming receiver. Shutting down transformer.",error:It}),we.destroy(),this.analyticsTracker.trackError(Dn),this.emit(Ec,Dn)};return we.on(SS,(It=>{It.stageErrorValue.code!==Jt.TRANSFORM_TOO_MANY_ERRORS.code?Qe(It):st(It)})),we},this.onConnectionStateChange=()=>{if(this.peerConnection){const Me=this.peerConnection.connectionState||this.peerConnection.iceConnectionState,{token:nt,traceId:bt,identifier:ut,action:dt}=this,Qe=new ia(dt,nt,bt,Me,ut);this.analyticsTracker.trackEventNoSharedProps(Qe),this.trace(nt,bt,`connection state change: ${Me}`,dt,ut)}const we=this.getConnectionState();switch(we){case hr.CONNECTED:this.closeFailedPeerConnections(),this.perfTracker.markActionStop(),this.emit(qc,we),this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream);break;case hr.FAILED:this.storeFailedPeerConnection(this.peerConnection),this.destroyPeerConnection({closeConnection:!1}),this.emit(qc,we),this.handleConnectionFailure();break;default:this.emit(qc,we)}},this.onIncompatibleCodecs=we=>xs(this,void 0,void 0,(function*(){if(we.forEach((bt=>{let ut=!1;this.incompatibleCodecs.forEach((dt=>{dt.config===bt.config&&dt.mime===bt.mime&&(ut=!0)})),ut||this.incompatibleCodecs.add(bt)})),this.peerConnection)try{yield(Me=this.peerConnection,nt=[...this.incompatibleCodecs],vT(void 0,void 0,void 0,(function*(){var bt;for(const ut of Me.getSenders()){const dt=ut.getParameters();if(dt.codecs.length>1){const Qe=dt.codecs[0];let st=!1;for(const It of nt)W_(Qe,It)&&(st=!0);if(st){const It=yT(nt,dt.codecs);(bt=dt.encodings)===null||bt===void 0||bt.forEach((En=>{En.active&&(En.codec=It)})),yield ut.setParameters(dt)}}}})))}catch(bt){const{token:ut,action:dt,traceId:Qe,identifier:st}=this,It=new Rr(Object.assign(Object.assign({},Jt.CODEC_HANDLE_INCOMPATIBLE_UNEXPECTED_ERROR),{action:dt,token:ut,traceId:Qe,tag:Lo(dt,st),location:"onIncompatibleCodecs",remoteParticipantId:st,details:bt instanceof Error?bt.message:""}));this.analyticsTracker.trackError(It),this.emit(Ou,It)}var Me,nt})),this.token=E,this.logger=new Ka(A,oe.WEBRTC),this.action=O,this.tag=F,this.traceId=V,O===Qt.SUBSCRIBE&&!ue)throw new Error("Subscribe action provided without subscriber Id");this.jitterBufferConfig=ce?.jitterBuffer,this.simulcastSubscribeConfig=ce?.simulcast,this.subscriberId=ue,this.stageConnection=me,this.failedPeerConnections=[],this.receiveInBandMessagingEnabled=!!(!((de=this.subscribeConfig)===null||de===void 0)&&de.inBandMessaging.enabled),this.perfTracker=new go(this.action,this.traceId),this.statsReporter=new Q_(O,E,V,this.identifier,this.analyticsTracker),this.handlePublishingChangedBinding=this.handlePublishingChanged.bind(this),this.toggleStageConnectionListeners(!0)}get videoMediaId(){var E,A;return(A=(E=this.videoTransceiver)===null||E===void 0?void 0:E.mid)!==null&&A!==void 0?A:null}toggleStageConnectionListeners(E){var A,O;E?(A=this.stageConnection)===null||A===void 0||A.on(zu,this.handlePublishingChangedBinding):(O=this.stageConnection)===null||O===void 0||O.off(zu,this.handlePublishingChangedBinding)}updateSubscribeConfig(E){var A,O;if(this.jitterBufferConfig=E.jitterBuffer,this.simulcastSubscribeConfig=E.simulcast,this.action===Qt.SUBSCRIBE){const F=E.inBandMessaging.enabled;this.receiveInBandMessagingEnabled!==F&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for receiver"})}this.applyJitterBufferMinDelayConditionally((O=(A=this.stageConnection)===null||A===void 0?void 0:A.getIsStagePublishing())!==null&&O!==void 0&&O)}verifyOrUpdateTransceiverSync(){var E,A;return xs(this,void 0,void 0,(function*(){if(this.publishVideoStream){const O=this.getTransceiverForKind("video");O?this.publishVideoStream.track.id!==((E=O.sender.track)===null||E===void 0?void 0:E.id)&&(this.logger.debug({msg:"found out of sync video transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishVideoStream)):this.logger.warn({msg:"missing transceiver for video"})}if(this.publishAudioStream){const O=this.getTransceiverForKind("audio");O?this.publishAudioStream.track.id!==((A=O.sender.track)===null||A===void 0?void 0:A.id)&&(this.logger.debug({msg:"found out of sync audio transceiver... updating"}),yield this.replaceOrUpdateStream(this.publishAudioStream)):this.logger.warn({msg:"missing transceiver for audio"})}}))}start(){return xs(this,void 0,void 0,(function*(){const{token:E,action:A,traceId:O,identifier:F}=this;A!==Qt.PUBLISH||E.claims.capabilities.allow_publish||this.analyticsTracker.trackErrorAndThrow(new Rr(Object.assign(Object.assign({},Wh(Jt.TOKEN_PERMISSIONS_DENIED,new Error("Cannot publish with subscribe only token"))),{action:A,token:E,traceId:O,tag:Lo(A,F),location:"StagePeerClient.start",remoteParticipantId:F})));const V=(function({action:K,identifier:ue,token:me,analyticsTracker:ce}){let de="";const we=Qp(me,ce);switch(K){case Qt.PUBLISH:de=we.getPublishEndpoint();break;case Qt.SUBSCRIBE:ue&&(de=we.getSubscribeEndpoint(ue))}return de})({action:A,identifier:F,token:E.rawToken,analyticsTracker:this.analyticsTracker});try{this.perfTracker.markActionStart(),this.endpointURL=V,this.createPeerConnection(),this.trace(E,O,"peer connection created",A,F)}catch(K){const ue=new Rr(Object.assign(Object.assign({action:A},Wh(Jt.CREATE_PEER_CONNECTION_FAILURE,K)),{token:E,traceId:O,tag:Lo(A,F),location:"StagePeerClient.start",remoteParticipantId:F}));A===Qt.PUBLISH&&this.emit(qc,hr.FAILED),this.emit(Ou,ue),this.analyticsTracker.trackErrorAndThrow(ue)}}))}mungeSdpOffer(E,A,O){if(O.simulcastEnabled&&(E=new fi(E).withVideoLayersAllocationRtpHeaderExtension().sdp),A===Qt.SUBSCRIBE)E=new fi(E).withOpusAudioConfig(eu(nm),!0).sdp;else if(A===Qt.PUBLISH&&O.audioConfig){const{maxBitrateBps:F,stereo:V}=O.audioConfig;E=new fi(E).withOpusAudioConfig(F,V).sdp}return E}mungeSdpAnswer(E){Kh.browser.isFirefox()&&this.publishAudioStream&&this.action===Qt.PUBLISH&&(E=new fi(E).withOpusAudioConfig(this.publishAudioStream.config.maxBitrateBps,void 0).sdp);const A=Kh.browser.isChrome()||Kh.browser.isEdge();this.action===Qt.SUBSCRIBE&&A&&(E=new fi(E).withoutAudioRtcpRSize().sdp);const O=(function(){const F=_s("subscribeForceIceProtocol");if(F==="tcp"||F==="udp")return F})();return this.action===Qt.SUBSCRIBE&&O&&(E=new fi(E).withFilteredCandidates(O).sdp),E}createPeerConnection(){var E;this.logger.debug({msg:"setting up peer connection"}),this.peerConnection&&(this.logger.debug({msg:"peer connection is already established, cleaning up previous connection"}),this.destroyPeerConnection({closeConnection:!1})),this.peerConnection=new RTCPeerConnection({iceTransportPolicy:"all"}),this.statsReporter.start(this.peerConnection,(E=this.publishVideoStream)===null||E===void 0?void 0:E.config.simulcastEnabled),this.peerConnection.addEventListener("connectionstatechange",this.onConnectionStateChange),this.peerConnection.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.peerConnection.addEventListener("icecandidateerror",this.onIceCandidateError),this.peerConnection.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this.peerConnection.addEventListener("icecandidate",this.onIceCandidate),this.peerConnection.addEventListener("track",this.onTrack),this.peerConnection.addEventListener("mute",this.onMute),this.peerConnection.addEventListener("unmute",this.onUnMute)}destroyPeerConnection(E){var A,O,F,V,K,ue,me,ce,de;this.statsReporter.stop(),(A=this.peerConnection)===null||A===void 0||A.removeEventListener("connectionstatechange",this.onConnectionStateChange),(O=this.peerConnection)===null||O===void 0||O.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),(F=this.peerConnection)===null||F===void 0||F.removeEventListener("icecandidateerror",this.onIceCandidateError),(V=this.peerConnection)===null||V===void 0||V.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),(K=this.peerConnection)===null||K===void 0||K.removeEventListener("icecandidate",this.onIceCandidate),(ue=this.peerConnection)===null||ue===void 0||ue.removeEventListener("track",this.onTrack),(me=this.peerConnection)===null||me===void 0||me.removeEventListener("mute",this.onMute),(ce=this.peerConnection)===null||ce===void 0||ce.removeEventListener("unmute",this.onUnMute),(E.closeConnection||this.action===Qt.PUBLISH)&&((de=this.peerConnection)===null||de===void 0||de.close()),this.peerConnection=void 0}closeFailedPeerConnections(){for(const E of this.failedPeerConnections)E?.close();this.failedPeerConnections=[]}storeFailedPeerConnection(E){E&&this.action!==Qt.PUBLISH&&this.failedPeerConnections.push(E)}stop(){var E,A;(E=this.videoReceiverTransformer)===null||E===void 0||E.destroy(),(A=this.videoSenderTransformer)===null||A===void 0||A.destroy(),this.destroyPeerConnection({closeConnection:!0})}getTransceiverForKind(E){if(!this.peerConnection)return;const A=this.peerConnection.getTransceivers();return E==="audio"?A.find((O=>O.mid==="0")):E==="video"?A.find((O=>O.mid==="1")):void 0}removeTrack(E){return xs(this,void 0,void 0,(function*(){if(E==="audio"||E==="video")if(this.peerConnection)try{const A=this.getTransceiverForKind(E);if(!A)return void this.logger.warn({msg:`tried removing track type ${E} but couldn't find transceiver`});yield A.sender.replaceTrack(null),E===yl.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0,yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(A){this.logger.warn({msg:"error replacing track",err:A})}else E===yl.AUDIO?this.publishAudioStream=void 0:this.publishVideoStream=void 0;else this.logger.warn({msg:"RemoveTrack called with invalid track type",trackType:E})}))}replaceOrUpdateStream(E){return xs(this,void 0,void 0,(function*(){if(E.track){if(wl(E)?this.publishAudioStream=E:J_(E)&&(this.publishVideoStream=E),this.peerConnection)try{const A=this.getTransceiverForKind(E.track.kind);if(!A)return void this.logger.warn({msg:`tried replacing track type ${E.track.kind} but couldn't find transceiver`,track:E.track});if(J_(E)){const O=A.sender.getParameters(),F=E.config.encodingLayers;O.encodings=O.encodings.map((V=>{var K;const ue=(K=V.rid)!==null&&K!==void 0?K:"",me=F.find((ce=>{var de;return((de=ce.rid)!==null&&de!==void 0?de:"")===ue}));return me?Object.assign(Object.assign({},V),me):V})),yield A.sender.setParameters(O)}else if(wl(E)){const O=A.sender.getParameters(),F=H_(E)[0];O.encodings=O.encodings.map((V=>Object.assign(Object.assign({},V),F))),yield A.sender.setParameters(O)}yield A.sender.replaceTrack(E.track),yield this.statsReporter.updateMultihostConfiguration(this.publishAudioStream,this.publishVideoStream)}catch(A){this.logger.warn({msg:"error replacing track",err:A})}}else this.logger.warn({msg:"Unexpected call to replaceOrUpdateStream with no track"})}))}initializePeerConnection(E=!1){var A,O,F,V,K,ue,me,ce;return xs(this,void 0,void 0,(function*(){const{traceId:de,token:we,action:Me,identifier:nt}=this;$h(this.peerConnection),this.resetTransformers();let bt=new MediaStream;if(Me===Qt.PUBLISH){this.publishAudioStream||(this.publishAudioStream={track:this.getSilentAudio(),config:{maxBitrateBps:eu(e0),stereo:!1}});const ut=this.peerConnection.getTransceivers(),dt=[];ut.forEach((g=>{var y;dt.concat((y=g.sender.track)===null||y===void 0?void 0:y.id)})),bt=new MediaStream([this.publishAudioStream.track,(A=this.publishVideoStream)===null||A===void 0?void 0:A.track].filter((g=>!!g&&!dt.includes(g.id))));const Qe=bt.getAudioTracks()[0]||"audio",st=bt.getVideoTracks()[0]||"video",It={direction:"sendonly",streams:[bt],sendEncodings:H_(this.publishAudioStream)},En={direction:"sendrecv",streams:[bt],sendEncodings:(O=this.publishVideoStream)===null||O===void 0?void 0:O.config.encodingLayers};this.peerConnection.addTransceiver(Qe,It),this.trace(we,de,`track added, type: ${Qe.kind||Qe}`,Me,nt);const Dn=this.peerConnection.addTransceiver(st,En);this.trace(we,de,`track added, type: ${st.kind||st}`,Me,nt);const Xn=!!(!((V=(F=this.publishVideoStream)===null||F===void 0?void 0:F.config)===null||V===void 0)&&V.inBandMessagingEnabled);this.sendInBandMessagingEnabled===void 0?this.sendInBandMessagingEnabled=Xn:this.sendInBandMessagingEnabled!==Xn&&this.logger.warn({msg:"Cannot mutate in-band messaging config value for sender"}),this.sendInBandMessagingEnabled&&!Ps.isSupported(Dn)?this.handleTransformNotSupported():this.sendInBandMessagingEnabled&&((K=this.videoSenderTransformer)===null||K===void 0||K.onTransceiverAdd(Dn))}else Me===Qt.SUBSCRIBE&&(we.shouldSendSilentAudio()?this.peerConnection.addTransceiver(this.getSilentAudio(),{direction:"sendrecv"}):this.peerConnection.addTransceiver("audio",{direction:"recvonly"}),this.trace(we,de,"track added, type: audio",Me,nt),E||(this.videoTransceiver=this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.trace(we,de,"track added, type: video",Me,nt),this.receiveInBandMessagingEnabled&&!rv.isSupported(this.videoTransceiver)?this.handleTransformNotSupported():this.receiveInBandMessagingEnabled&&((ue=this.videoReceiverTransformer)===null||ue===void 0||ue.onTransceiverAdd(this.videoTransceiver))),this.peerConnection.getTransceivers().forEach((ut=>{ut.receiver?(this.logger.info({msg:"dbg: Subscribe succeeded, adding media track to participant mediaStream"}),bt?.addTrack(ut.receiver.track)):this.logger.info({msg:"dbg: Subscribe succeeded, but Transceiver were negotiated without Receiver"})})),this.applyJitterBufferMinDelayConditionally((ce=(me=this.stageConnection)===null||me===void 0?void 0:me.getIsStagePublishing())!==null&&ce!==void 0&&ce));return bt}))}handlePublishingChanged(E){this.logger.debug({msg:`[handlePublishingChanged (${this.subscriberId})] isStagePublishing: ${E}, currentMinDelay: ${this.currentJitterBufferMinDelayInMs}`}),this.action===Qt.SUBSCRIBE&&this.applyJitterBufferMinDelayConditionally(E)}applyJitterBufferMinDelayConditionally(E){const A=this.currentJitterBufferMinDelayInMs,O=this.calcJitterBufferMinDelay(E,this.jitterBufferConfig);if(E){if(A===void 0||A>O){const F=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is publishing and min delay is unset or > configured; attempting to update to ${O}`;this.logger.debug({msg:F}),this.trace(this.token,this.traceId,F,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(O)}}else if(A===void 0||O!==A){const F=`[applyJitterBufferMinDelayConditionally (${this.subscriberId})] participant is subscribe-only and min delay is unset or != configured; attempting to update to ${O}`;this.logger.debug({msg:F}),this.trace(this.token,this.traceId,F,this.action,this.identifier),this.applyAndTrackJitterBufferMinDelay(O)}}calcJitterBufferMinDelay(E,A){var O,F,V;let K=0;if(!(()=>{const ue=RTCRtpReceiver.prototype;return!(!ue||typeof ue!="object")&&("jitterBufferTarget"in ue||"playoutDelayHint"in ue)})())return 0;if(E)K=Xu((O=A?.minDelayWhenPublishing)!==null&&O!==void 0?O:Ms.DEFAULT,E);else{K=Xu((F=A?.minDelayWhenSubscribeOnly)!==null&&F!==void 0?F:Ms.DEFAULT,E);const ue=(V=this.stageConnection)===null||V===void 0?void 0:V.jitterBufferMinDelayInMs();A?.minDelayWhenSubscribeOnly===Ms.DEFAULT&&ue!==void 0&&(K=ue,this.logger.debug({msg:`[calcJitterBufferMinDelay] overriding min delay with remote value: ${K}`}))}return K}applyAndTrackJitterBufferMinDelay(E){var A,O;this.currentJitterBufferMinDelayInMs=E,this.statsReporter.updateJitterBufferMinDelay(E),E!==void 0&&((O=(A=this.peerConnection)===null||A===void 0?void 0:A.getTransceivers())===null||O===void 0||O.forEach((F=>{F.receiver&&this.applyJitterBufferMinDelay(F.receiver,E)})))}applyJitterBufferMinDelay(E,A){let O="Unable to set jitter buffer min delay";if("jitterBufferTarget"in E)O=`setting jitterBufferTarget to: ${A} for track: ${E.track.kind}`,this.logger.debug({msg:O}),E.jitterBufferTarget=A;else if("playoutDelayHint"in E){const F=A/1e3;O=`setting playoutDelayHint to: ${A} for track: ${E.track.kind}`,this.logger.debug({msg:O}),E.playoutDelayHint=F}else this.logger.warn({msg:O});this.trace(this.token,this.traceId,O,this.action,this.identifier)}exchangeSdp(E){var A,O,F;return xs(this,void 0,void 0,(function*(){const{traceId:V,token:K,action:ue,identifier:me,tag:ce,endpointURL:de}=this,{iceRestart:we=!1,nodeOverride:Me,assignmentToken:nt,abortController:bt}=E;let ut;this.logger.debug({msg:`Exchanging SDP: ${V.value}, iceRestart=${we}, nodeOverride=${Me}, assignmentToken=${nt}`}),$h(this.peerConnection),ue===Qt.PUBLISH&&Pp()&&(this.logger.debug({msg:"Applying publisher codec preference for main profile."}),((Qe,st)=>{var It,En;const Dn=(It=RTCRtpReceiver.getCapabilities("video"))===null||It===void 0?void 0:It.codecs;if(!Dn)return;let Xn=Dn;Xn=My(Dn,"42e0"),st.preferMainProfile&&(Xn=My(Dn,"4d00")),(En=Qe.getTransceivers().find((g=>g.receiver.track.kind==="video")))===null||En===void 0||En.setCodecPreferences(Xn)})(this.peerConnection,{preferMainProfile:Pp()}));try{this.trace(K,V,"Creating offer",ue,me),ut=yield this.peerConnection.createOffer({iceRestart:we})}catch(Qe){const st=new Rr(Object.assign(Object.assign({},Wh(Jt.CREATE_OFFER_FAILURE,Qe)),{action:ue,token:K,traceId:V,tag:ce,location:"exchangeSdp",remoteParticipantId:me}));this.emit(Ou,st),this.analyticsTracker.trackErrorAndThrow(st)}ut.sdp&&(ut.sdp=this.mungeSdpOffer(ut.sdp,ue,{simulcastEnabled:(O=(A=this.publishVideoStream)===null||A===void 0?void 0:A.config.simulcastEnabled)!==null&&O!==void 0&&O,audioConfig:(F=this.publishAudioStream)===null||F===void 0?void 0:F.config})),this.trace(K,V,"Setting local description",ue,me),yield this.peerConnection.setLocalDescription(ut),this.trace(K,V,"local description set",ue,me),de||this.logger.warn({msg:"Unexpected state: No endpointURL specified for fetching of remote description."});const dt=ue===Qt.PUBLISH&&Pp()||ue===Qt.SUBSCRIBE&&Gc("multiCodecAnswer");yield this.fetchAndSetRemoteDescription({endpointURL:de,nodeOverride:Me,assignmentToken:nt,multiCodec:dt,abortController:bt})}))}getReports(){var E;return xs(this,void 0,void 0,(function*(){try{const A=(yield(E=this.peerConnection)===null||E===void 0?void 0:E.getStats())||[],O=[];return A.forEach((F=>{O.push(F)})),O}catch{return[]}}))}requestRTCStats(E){return xs(this,void 0,void 0,(function*(){if(this.peerConnection)return this.statsReporter.getStats(E)}))}get identifier(){return this.subscriberId||this.token.participantID}handleTransformNotSupported(){const{token:E,tag:A,identifier:O,action:F,traceId:V}=this,K=jo({traceId:V,token:E,tag:A,identifier:O,action:F,stageErrorValue:Jt.TRANSFORM_NOT_SUPPORTED_BY_PLATFORM});this.logger.error({err:K,msg:"Transforms not supported by this platform"}),this.analyticsTracker.trackError(K),this.emit(Ec,K)}handleConnectionFailure(){return xs(this,void 0,void 0,(function*(){const{token:E,traceId:A,tag:O}=this;this.analyticsTracker.trackError(new Rr(Object.assign(Object.assign({},Jt.PEER_CONNECTION_NETWORK_FAILURE),{action:this.action,token:E,traceId:A,tag:O,location:"onIceCandidateError",remoteParticipantId:this.identifier})))}))}getSilentAudio(){Qh||(Qh=new AudioContext);const E=Qh.createOscillator(),A=Qh.createGain();E.connect(A);const O=Qh.createMediaStreamDestination();return A.connect(O),A.gain.value=0,E.start(),O.stream.getAudioTracks()[0]}getActionMeasurements(){return this.perfTracker.getMeasurements()}getProtocol(){return this.protocol}initStreamsToPublish(E){this.publishVideoStream=E.find(J_),this.publishAudioStream=E.find(wl)}getSfuResource(){return this.sfuResource}getExpectedJitterBufferMinDelayInMs(){var E,A;return this.calcJitterBufferMinDelay((A=(E=this.stageConnection)===null||E===void 0?void 0:E.getIsStagePublishing())!==null&&A!==void 0&&A,this.jitterBufferConfig)}trace(E,A,O,F,V){this.analyticsTracker.trackEventNoSharedProps(new Ba(E,A,O,F,V))}sendSeiMessage(E,A){const O=this.getTransceiverForKind("video");return this.videoSenderTransformer&&this.sendInBandMessagingEnabled?this.action===Qt.PUBLISH&&O?this.videoSenderTransformer.sendSeiMessage(E,A):xn.err(ca.NOT_PUBLISHING_VIDEO):xn.err(ca.INBAND_MESSAGING_NOT_ENABLED)}}const sv=Qt.SUBSCRIBE;class Vd{constructor(E,A,O){this.analyticsTracker=E,this.token=A,this.remoteId=O,this.action=sv}trackAttempt({stageConnectionStats:E,isReassignment:A=!1,traceIdOverride:O,preAttemptSfuResource:F}){const{action:V,analyticsTracker:K,token:ue,remoteId:me}=this,ce=O||Ns();return K.trackEvent(new Br({token:this.token,subscribedId:this.remoteId,traceId:ce,isEdpConnected:E.isConnected,isReassignment:A,preAttemptSfuResource:F})),{getTraceId:()=>ce,trackSubscribeStarted({totalDurationWithRetries:de,retryTimes:we,sfuResource:Me,peerClientPerfStats:nt,protocol:bt}){const{optionsDuration:ut,postDuration:dt,timeToCandidate:Qe,timeToConnected:st,sdpExchangeDuration:It,sdpExchangeTransport:En,setRemoteDescDuration:Dn,peerConnectionDuration:Xn}=nt,{edpInitialConnectDuration:g,edpInitialConnectRetries:y,edpInitialStateDuration:k,edpInitialStatePublishingCount:j,edpStateUpdateCount:ne}=E;K.trackEvent(new vS({token:ue,traceId:ce,remoteParticipantId:me,optionsDuration:ut,postDuration:dt,timeToCandidate:Qe,totalDuration:st,edpInitialConnectDuration:g,edpInitialConnectRetries:y,edpInitialStateDuration:k,edpInitialStatePublishingCount:j,edpStateUpdateCount:ne,sdpExchangeDuration:It,sdpExchangeTransport:En,setRemoteDescDuration:Dn,peerConnectionDuration:Xn,sfuResource:Me,totalDurationWithRetries:de,subscribeRetryTimes:we,isReassignment:A,protocol:bt}))},trackSubscribeFirstFrame:({peerClientPerfStats:de,totalDurationWithRetries:we,sfuResource:Me,retryTimes:nt,currentJitterBufferMinDelayInMs:bt,mediaType:ut,firstFrameDuration:dt,protocol:Qe})=>{const{sdpExchangeDuration:st,sdpExchangeTransport:It,setRemoteDescDuration:En,peerConnectionDuration:Dn}=de,{edpInitialConnectDuration:Xn,edpInitialConnectRetries:g,edpInitialStateDuration:y,edpInitialStatePublishingCount:k,edpStateUpdateCount:j}=E;this.analyticsTracker.trackEvent(new RT({token:this.token,traceId:ce,remoteParticipantId:me,edpInitialConnectDuration:Xn,edpInitialConnectRetries:g,edpInitialStateDuration:y,edpInitialStatePublishingCount:k,edpStateUpdateCount:j,sdpExchangeDuration:st,sdpExchangeTransport:It,setRemoteDescDuration:En,peerConnectionDuration:Dn,videoWasPaused:!1,firstFrameDuration:dt,mediaType:ut,sfuResource:Me,totalDurationWithRetries:we,subscribeRetryTimes:nt,currentJitterBufferMinDelayInMs:bt,protocol:Qe}))},trackSubscribeFailed(de,we,Me){const nt=((dt,Qe,st)=>{if(dt instanceof Rr)return dt;let It="";return dt instanceof bc.AxiosError&&(It+=`AxiosError - ${dt.code}`),new Rr(Object.assign(Object.assign(Object.assign({},Jt.SUBSCRIBE_FAILURE),{action:sv,token:Qe,traceId:st,tag:Gg,location:"subscribe",details:`${It} ${dt?.message}`}),{fatal:!0}))})(de,ue,ce);K.trackEvent(new yS({token:ue,traceId:ce,remoteParticipantId:me,code:nt.code,message:nt.message,fatal:nt.fatal,nominal:nt.nominal,isReassignment:A,protocol:we}));const{isConnected:bt}=E,ut=new Rr(Object.assign(Object.assign({},Jt.SUBSCRIBE_FAILURE),{action:V,token:ue,traceId:ce,tag:Lo(Qt.SUBSCRIBE,me),location:"subscribe",remoteParticipantId:me,isEdpConnected:bt,details:Me}));return de instanceof Rr&&(ut.fatal=de.fatal,ut.nominal=de.nominal,ut.location=`subscribe > ${de.location}`),K.trackError(ut),nt},trackUnsubscribe:()=>{K.trackEvent(new ev({token:ue,unsubscribedId:me,traceId:ce}))},trackEndSucceeded:(de,we)=>{K.trackEvent(new zd({token:ue,traceId:ce,remoteParticipantId:me,isUnsubscribeSuccessful:!0,reason:de,protocol:we}))},trackEndFailed:(de,we)=>{const Me=new Rr(Object.assign(Object.assign({},Jt.UNSUBSCRIBE_FAILURE),{token:ue,traceId:ce,tag:Lo(Qt.SUBSCRIBE,me),location:"unsubscribe",remoteParticipantId:me}));return de!==Sr.UNLOAD&&de!==Sr.UNSUBSCRIBE||K.trackError(Me),K.trackEvent(new zd({token:ue,traceId:ce,remoteParticipantId:me,isUnsubscribeSuccessful:!0,reason:de,protocol:we})),Me}}}}class om extends Kn{constructor(E,A,O,F,V,K){super(Mn.PLAYBACK_LAYER_REQUEST,E,A,!1),Object.assign(this.properties,{media_type:O,remote_participant_id:F,track_id:V,layer_id:K})}}class zy extends Kn{constructor(E,A,O,F,V,K=1){super(Mn.PLAYBACK_LAYER_STATE,E,A,!1),Object.assign(this.properties,{media_type:O,remote_participant_id:F,track_id:V,request_count:K})}}var eh,Ts,Hd,Ds;(function(M){M.PAUSE="pause",M.PLAY="play"})(eh||(eh={})),(function(M){M.IDLE="idle",M.ACTIVE="active",M.ERRORED="errored",M.DESTROYED="destroyed"})(Ts||(Ts={})),(function(M){M.SUCCESS="success"})(Hd||(Hd={})),(function(M){M.FAILED="failed",M.DESTROYED="destroyed",M.THROTTLED="throttled"})(Ds||(Ds={}));var kc=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class $y{constructor(E){this.state=Ts.IDLE,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null,this.stopVideo=()=>kc(this,void 0,void 0,(function*(){return this.state!==Ts.ACTIVE?(this.logCommandSkipped("stopVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(eh.PAUSE)})),this.startVideo=()=>kc(this,void 0,void 0,(function*(){return this.state!==Ts.ACTIVE?(this.logCommandSkipped("startVideo"),this.mapSkippedResultFromState(this.state)):this.sendPlaybackRequest(eh.PLAY)})),this.setLayer=A=>kc(this,void 0,void 0,(function*(){return this.state!==Ts.ACTIVE?(this.logCommandSkipped("setLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest(A)})),this.unsetLayer=()=>kc(this,void 0,void 0,(function*(){return this.state!==Ts.ACTIVE?(this.logCommandSkipped("unsetLayer"),this.mapSkippedResultFromState(this.state)):this.sendLayerRequest()})),this.getLayers=()=>kc(this,void 0,void 0,(function*(){return this.state!==Ts.ACTIVE?(this.logCommandSkipped("getLayers"),this.mapSkippedResultFromState(this.state)):this.sendLayerStateRequest()})),this.sendPlaybackRequest=A=>kc(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,xn.err)(Ds.FAILED);if(!this.playbackEndpoint)return this.logger.warn({msg:"Playback endpoint is unset and required for playback control requests"}),(0,xn.err)(Ds.FAILED);this.logger.info({msg:`Sending ${A} request to ${this.playbackEndpoint}`});const O=A===eh.PAUSE?{pause:[this.mid]}:{play:[this.mid]},F=this.createPostWhepRequest(O);return fetch(this.playbackEndpoint,F).then((V=>{if(V.status>=300){const K=new Error(`Error sending media controls request: ${V.status}:${V.statusText}`);return this.logger.error({err:K}),(0,xn.err)(Ds.FAILED)}return this.logger.debug({msg:`Request to ${A} was successful: ${V.status}`}),(0,xn.ok)(Hd.SUCCESS)})).catch((V=>(this.logger.error({err:V,msg:"Error sending media controls request"}),(0,xn.err)(Ds.FAILED))))})),this.sendLayerRequest=A=>kc(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,xn.err)(Ds.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,xn.err)(Ds.FAILED);const O=typeof A=="string",F=O?{mediaId:this.mid,encodingId:A}:{},V=O?`set : ${A}`:"unset layer";this.logger.info({msg:`sendLayerRequest for ${V} at ${this.layersEndpoint}`});const K=this.createPostWhepRequest(F);return this.trackLayerRequest(A??"auto"),fetch(this.layersEndpoint,K).then((ue=>this.state===Ts.DESTROYED?(0,xn.err)(Ds.DESTROYED):ue.status>=300?this.handleLayerRequestError(ue.status,ue.statusText):(this.logger.debug({msg:`Request to ${V} was successful: ${ue.status}`}),(0,xn.ok)(Hd.SUCCESS)))).catch((ue=>this.handleLayerRequestError(0,ue.message)))})),this.sendLayerStateRequest=()=>kc(this,void 0,void 0,(function*(){if(!this.mid)return this.logger.warn({msg:"mid is unexpectedly undefined"}),(0,xn.err)(Ds.FAILED);if(!this.layersEndpoint)return this.logger.warn({msg:"Layers endpoint is unset and required for layer requests"}),(0,xn.err)(Ds.FAILED);this.logger.info({msg:`sendLayerStateRequest for ${this.mid} at ${this.layersEndpoint}`});const A=this.createGetWhepRequest();return this.trackLayerStateRequest(),fetch(this.layersEndpoint,A).then((O=>kc(this,void 0,void 0,(function*(){var F;if(this.state===Ts.DESTROYED)return(0,xn.err)(Ds.DESTROYED);if(O.status>=300)return this.handleLayerStateRequestError(O.status,O.statusText);const V=yield O.json(),K=(F=V?.layers)!==null&&F!==void 0?F:[],ue=JSON.stringify(K,null,2);return this.logger.debug({msg:`sendLayerStateRequest was successful: ${ue}`}),(0,xn.ok)(K)})))).catch((O=>this.handleLayerStateRequestError(0,O.message)))})),this.logger=new Ka(E.logger,oe.REMOTE_PLAYBACK),this.token=E.token,this.traceId=E.traceId,this.analyticsTracker=E.analyticsTracker,this.remoteParticipantId=E.remoteParticipantId}set mediaId(E){if(this.state!==Ts.DESTROYED){if(this.mid=E,this.mid===null)return this.logger.info({msg:"media id is unset, controller is transitioning to idle state"}),void(this.state=Ts.IDLE);(this.playbackEndpoint||this.layersEndpoint)&&(this.state=Ts.ACTIVE)}else this.logCommandSkipped("set mediaId")}set endpoints(E){var A,O;if(this.state!==Ts.DESTROYED){if(this.playbackEndpoint=(A=E.playback)!==null&&A!==void 0?A:null,this.layersEndpoint=(O=E.layers)!==null&&O!==void 0?O:null,!this.playbackEndpoint||!this.layersEndpoint){const F={playbackEndpoint:this.playbackEndpoint,layersEndpoint:this.layersEndpoint};return this.logger.info({msg:`no endpoints are set, transitioning to idle state: ${JSON.stringify(F,null)}`}),void(this.state=Ts.IDLE)}this.mid&&(this.state=Ts.ACTIVE)}else this.logCommandSkipped("set endpoints")}destroy(){this.state=Ts.DESTROYED,this.mid=null,this.playbackEndpoint=null,this.layersEndpoint=null}logCommandSkipped(E="command"){this.logger.info({msg:`skipping ${E}, controller state invalid: ${this.state}`})}mapSkippedResultFromState(E){return E===Ts.DESTROYED?(0,xn.err)(Ds.DESTROYED):(0,xn.err)(Ds.FAILED)}createPostWhepRequest(E){return{method:"POST",headers:this.createRequestHeaders(),body:JSON.stringify(E)}}createGetWhepRequest(){return{method:"GET",headers:this.createRequestHeaders()}}createRequestHeaders(){var E,A;return{Authorization:`Bearer ${this.token.rawToken}`,"Content-Type":"application/json","X-Stages-Platform":"web","X-Stages-Request-ID":Nd().value,"X-Stages-SDK":"1.31.1","X-Stages-Session-ID":this.analyticsTracker.getSessionId(),"X-Stages-Trace-ID":(A=(E=this.traceId)===null||E===void 0?void 0:E.value)!==null&&A!==void 0?A:"","X-Stages-WHIP-Version":ra}}trackLayerRequest(E){var A;this.analyticsTracker.trackEventNoSharedProps(new om(this.token,this.traceId,Tr.VIDEO,this.remoteParticipantId,(A=this.mid)!==null&&A!==void 0?A:"unknown",E))}trackLayerStateRequest(E=1){var A;this.analyticsTracker.trackEventNoSharedProps(new zy(this.token,this.traceId,Tr.VIDEO,this.remoteParticipantId,(A=this.mid)!==null&&A!==void 0?A:"unknown",E))}handleLayerRequestError(E,A){const O=`sendLayerRequest failed for reason: ${E} ${A}`;let F,V;return E===429?(F=Ds.THROTTLED,V=Jt.WHEP_SET_LAYER_REQUEST_THROTTLED):(F=Ds.FAILED,V=Jt.WHEP_SET_LAYER_REQUEST_FAILED),this.trackRequestError(V,O),(0,xn.err)(F)}handleLayerStateRequestError(E,A){const O=`sendLayerStateRequest failed for reason: ${E} ${A}`;let F,V;return E===429?(F=Ds.THROTTLED,V=Jt.WHEP_GET_LAYER_STATE_THROTTLED):(F=Ds.FAILED,V=Jt.WHEP_GET_LAYER_STATE_FAILED),this.trackRequestError(V,O),(0,xn.err)(F)}trackRequestError(E,A){const O=new Error(A);this.logger.error({err:O}),E.message=A;const F=this.createError(E);this.analyticsTracker.trackError(F)}createError(E,A){return new Rr(Object.assign({action:Qt.SUBSCRIBE,traceId:this.traceId,token:this.token,location:"RemotePlaybackController",tag:Gg,details:A},E))}}var $f,ef,eo,Gs,th=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))},x=function(M,E,A,O){if(typeof E=="function"?M!==E||!O:!E.has(M))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?O:A==="a"?O.call(M):O?O.value:E.get(M)};(function(M){M.DISCONNECTED="disconnected",M.CONNECTING="connecting",M.CONNECTED="connected",M.ERRORED="errored"})(eo||(eo={})),(function(M){M.NONE="none",M.AUDIO_ONLY="audio_only",M.AUDIO_VIDEO="audio_video"})(Gs||(Gs={}));class D extends Da{constructor(E,A,O,F,V,K,ue){super(),this.id=E,this.token=A,this.stageConnection=O,this.nonScopedLogger=F,this.analyticsTracker=V,this.desiredSubscribeType=K,$f.add(this),this.isSubscriptionActive=!1,this.subscriptionState={connectionState:eo.DISCONNECTED,subscribeInProgress:!1},this.previousSignalState={isTargetPublishing:!1},this.failedRetries=0,this.startConnectingTimestamp=-1,this.throttler=new _T(1e3),this.cleanupFirstFrameTracking=Uh,this.actualSubscribeType=Gs.NONE,this.action=Qt.SUBSCRIBE,this.updateDesiredSubscribeType=ce=>{this.desiredSubscribeType=ce,this.attemptToActualizeSubscribeType()},this.updateSubscribeConfig=ce=>{this.peerClient.updateSubscribeConfig(ce)},this.getDesiredSubscribeType=()=>this.desiredSubscribeType,this.attemptToActualizeSubscribeType=()=>{const ce=this.actualSubscribeType,de=this.desiredSubscribeType;this.logger.debug({msg:`Attempt to actualize subscribe type to ${de}`}),this.subscriptionState.connectionState===eo.CONNECTED&&de!==Gs.NONE&&ce!==de&&this.applyVideoControlsBySubscribeType(de,ce)},this.onParticipantUpdated=ce=>{x(this,$f,"m",ef).call(this,ce)&&(this.logger.debug({msg:"onParticipantUpdated",participant:ce}),this.processStateUpdate({isTargetPublishing:ce.isPublishing}))},this.onParticipantJoined=ce=>{x(this,$f,"m",ef).call(this,ce)&&(this.logger.debug({msg:"onParticipantJoined",participant:ce}),this.processStateUpdate({isTargetPublishing:ce.isPublishing}))},this.onParticipantLeft=ce=>{x(this,$f,"m",ef).call(this,ce)&&(this.logger.debug({msg:"onParticipantLeft",participant:ce}),this.processStateUpdate({isTargetPublishing:!1}))},this.onPeerClientConnectionStateChange=ce=>{const de=this.stageConnection.getParticipant(this.id);this.logger.debug({msg:`onPeerClientConnectionStateChange: ${ce}`,state:ce,targetParticipant:de}),this.processStateUpdate({peerClientState:ce})},this.onPeerClientTransformError=ce=>{this.emit(Zp,ce)},this.onSdpNegotiated=ce=>{this.remotePlaybackController.endpoints={playback:ce.mediaControls,layers:ce.layerControls}},this.seiMessageHandler=ce=>{this.emit(Vu,ce)},this.requestRTCStats=ce=>th(this,void 0,void 0,(function*(){return this.peerClient.requestRTCStats(ce)})),this.trySubscribe=ce=>th(this,void 0,void 0,(function*(){var de,we;if(this.logger.debug({msg:`Subscribe attempt started: ${ce}`}),!this.isSubscriptionActive)return this.logger.warn({msg:"Subscribe attempt invalid: Subscription is inactive"}),!1;this.logger.debug({msg:"Subscribe attempt is valid."}),this.startConnectingTimestamp<0&&(this.startConnectingTimestamp=performance.now()),this.subscriptionState.connectionState!==eo.ERRORED&&(this.logger.debug({msg:"Updating state to CONNECTING"}),this.updateState({connectionState:eo.CONNECTING}));const Me=this.stageConnection.getConnectionStats(),nt=this.peerClient.getExpectedJitterBufferMinDelayInMs(),bt=this.peerClient.getSfuResource();this.attemptTracker=this.subscribeTracker.trackAttempt({stageConnectionStats:Me,preAttemptSfuResource:bt});try{this.remotePlaybackController.traceId=this.attemptTracker.getTraceId();const{mediaStream:ut}=yield this.subscribe(this.attemptTracker.getTraceId()),dt=performance.now()-this.startConnectingTimestamp,Qe=this.peerClient.getSfuResource();this.remotePlaybackController.mediaId=this.peerClient.videoMediaId;const st=this.failedRetries;this.attemptToActualizeSubscribeType();const It=this.peerClient.getActionMeasurements(),En=this.peerClient.getProtocol();if(this.attemptTracker.trackSubscribeStarted({sfuResource:Qe,totalDurationWithRetries:dt,retryTimes:st,peerClientPerfStats:It,protocol:En}),ut){this.cleanupFirstFrameTracking();const Dn=this.actualSubscribeType,Xn=this.attemptTracker,g=(y,k)=>{Xn.trackSubscribeFirstFrame({peerClientPerfStats:It,sfuResource:Qe,totalDurationWithRetries:dt,retryTimes:st,currentJitterBufferMinDelayInMs:nt,mediaType:k,firstFrameDuration:y,protocol:En})};this.cleanupFirstFrameTracking=this.measureFirstFrameDuration({mediaStream:ut,subscribeType:Dn,callback:g})}return this.throttler.clear(),this.failedRetries=0,this.startConnectingTimestamp=-1,ut&&this.emit(Df,ut,this.remotePlaybackController),this.logger.debug({msg:"Subscribe attempt succeeded"}),!0}catch(ut){const dt=(we=(de=this.peerClient)===null||de===void 0?void 0:de.getProtocol())!==null&&we!==void 0?we:"",Qe=this.attemptTracker.trackSubscribeFailed(ut,dt);this.logger.error({log:"Subscribe attempt failed",err:ut}),this.onTrySubscribeFailure(Qe,ce)}return!1}));const me=Ns();this.peerClient=new m0(A,this.nonScopedLogger,this.action,Lo(this.action,E),me,V,E,O,ue),this.logger=new Ka(F,oe.SUBSCRIPTION),this.subscribeTracker=new Vd(this.analyticsTracker,A,E),this.remotePlaybackController=new $y({token:A,analyticsTracker:V,traceId:me,logger:this.nonScopedLogger,remoteParticipantId:this.id})}applyVideoControlsBySubscribeType(E,A){try{E===Gs.AUDIO_ONLY?this.remotePlaybackController.stopVideo().catch((O=>{this.logger.error({err:O,msg:"Remote playback request to stop video failed"})})):E===Gs.AUDIO_VIDEO&&this.remotePlaybackController.startVideo().catch((O=>{this.logger.error({err:O,msg:"Remote playback request to start video failed"})})),this.actualSubscribeType=E,this.logger.debug({msg:`Desired subscribe type actualized from ${A} to ${E}.`})}catch(O){this.logger.error({err:O,msg:`Error updating subscribe type from ${A} to ${E}.`})}}processStateUpdate(E){const A=this.previousSignalState,O=Object.assign({},A,E);if(!this.isSubscriptionActive)return void this.logger.warn({msg:"Unexpected processStateUpdate when subscription is inactive"});O.isTargetPublishing?E.peerClientState===hr.CONNECTED?this.updateState({connectionState:eo.CONNECTED,subscribeInProgress:!0}):E.peerClientState===hr.FAILED&&this.subscriptionState.subscribeInProgress&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(Sr.CONNECTION_FAIL,this.peerClient.getProtocol()),this.updateState({subscribeInProgress:!1}),this.emit($u)):(A.isTargetPublishing&&this.subscriptionState.subscribeInProgress&&(this.logger.debug({msg:"Scheduling an unsubscribe on the event loop"}),this.unsubscribe()),this.throttler.clear(),this.updateState({connectionState:eo.DISCONNECTED}));const F=!A.isTargetPublishing&&E.isTargetPublishing,V=this.subscriptionState.connectionState===eo.CONNECTED&&E.peerClientState===hr.FAILED;(F||V)&&this.throttledTrySubscribe("onSignalState change: isTargetPublishing is now true"),Object.assign(this.previousSignalState,E)}onTrySubscribeFailure(E,A){this.logger.debug({msg:"Changing/keeping state FAILED"});const O=E.fatal,F=E.code===Jt.OPERATION_ABORTED.code,V=this.failedRetries<=4;if(!F&&!O&&V){const K=1e3*Math.pow(2,this.failedRetries);this.logger.debug({msg:`Retrying in ${K}ms`}),this.failedRetries++,this.nextAttemptTimerId=window.setTimeout((()=>th(this,void 0,void 0,(function*(){this.throttledTrySubscribe(A)}))),K)}else this.updateState({connectionState:eo.ERRORED}),this.emit(Xp,E),this.onTerminalFailure()}onTerminalFailure(){this.previousSignalState.isTargetPublishing=!1,this.startConnectingTimestamp=-1,this.failedRetries=0}start(){this.isSubscriptionActive=!0,this.peerClient.on(qc,this.onPeerClientConnectionStateChange),this.peerClient.on(wf,this.onSdpNegotiated),this.peerClient.on(Lh,this.seiMessageHandler),this.peerClient.on(Ec,this.onPeerClientTransformError),this.stageConnection.on(Pf,this.onParticipantUpdated),this.stageConnection.on(Ua,this.onParticipantJoined),this.stageConnection.on(Zc,this.onParticipantLeft),this.stageConnection.on(F_,this.onParticipantLeft);let E=!0;if(this.stageConnection.isConnected()){const A=this.stageConnection.getParticipant(this.id);E=!!A?.isPublishing}this.processStateUpdate({isTargetPublishing:E})}throttledTrySubscribe(E){return this.throttler.invoke(this.trySubscribe,E)}updateState(E){E.subscribeInProgress!==void 0&&(this.subscriptionState.subscribeInProgress=E.subscribeInProgress),E.connectionState&&this.subscriptionState.connectionState!==E.connectionState&&(this.subscriptionState.connectionState=E.connectionState,this.emit(Ac,this.subscriptionState.connectionState))}stop(E=!1){this.peerClient.off(qc,this.onPeerClientConnectionStateChange),this.peerClient.off(Ec,this.onPeerClientTransformError),this.peerClient.off(wf,this.onSdpNegotiated),this.peerClient.off(Lh,this.seiMessageHandler),this.unsubscribe(E),this.throttler.clear(),this.stageConnection.off(Pf,this.onParticipantUpdated),this.stageConnection.off(Ua,this.onParticipantJoined),this.stageConnection.off(Zc,this.onParticipantLeft),this.stageConnection.off(F_,this.onParticipantLeft),this.isSubscriptionActive=!1,this.updateState({connectionState:eo.DISCONNECTED})}isActive(){return this.isSubscriptionActive}subscribe(E,A){return th(this,void 0,void 0,(function*(){const{token:O,id:F}=this;O.assertTokenIsUnexpired(E,Lo(Qt.SUBSCRIBE,F),"subscribe",F);const{mediaStream:V}=yield this.peerClient.connect({audioOnly:A,traceId:E});return{peerClient:this.peerClient,mediaStream:V}}))}unsubscribe(E=!1){return th(this,void 0,void 0,(function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.remotePlaybackController.destroy(),!this.isSubscriptionActive||!this.attemptTracker||this.subscriptionState.connectionState===eo.DISCONNECTED)return;this.cleanupFirstFrameTracking(),this.attemptTracker.trackUnsubscribe();const A=E?Sr.UNLOAD:Sr.UNSUBSCRIBE,O=this.peerClient.getProtocol();try{E?this.peerClient.disconnect(E):yield this.peerClient.disconnect(E),this.updateState({subscribeInProgress:!1}),this.attemptTracker.trackEndSucceeded(A,O)}catch{this.attemptTracker.trackEndFailed(A,O)}}))}triggerIceRestart(E){var A;return th(this,void 0,void 0,(function*(){const O=this.stageConnection.getConnectionStats(),F=this.peerClient.getSfuResource(),V=this.subscribeTracker.trackAttempt({stageConnectionStats:O,isReassignment:!0,traceIdOverride:E.traceId,preAttemptSfuResource:F}),K=performance.now();try{this.emit(Ld),this.logger.debug({msg:`Triggering attempt. Current node: ${this.peerClient.getSfuResource().node}`}),yield this.peerClient.connect({iceRestartOptions:E,traceId:E.traceId}),this.logger.debug({msg:`Successful ICE restart attempt. Current node: ${this.peerClient.getSfuResource().node}`});const ue=performance.now()-K,me=this.peerClient.getSfuResource(),ce=this.peerClient.getActionMeasurements();(A=this.attemptTracker)===null||A===void 0||A.trackEndSucceeded(Sr.REASSIGNMENT,this.peerClient.getProtocol()),this.applyVideoControlsBySubscribeType(this.actualSubscribeType,this.actualSubscribeType),V.trackSubscribeStarted({totalDurationWithRetries:ue,sfuResource:me,retryTimes:0,peerClientPerfStats:ce,protocol:this.peerClient.getProtocol()}),this.emit(Ud)}catch(ue){this.emit(xy),this.logger.error({msg:"ICE restart attempt failed",err:ue});const me=this.peerClient.getSfuResource(),ce=V.trackSubscribeFailed(ue,this.peerClient.getProtocol(),`iceRestart=true, startNode=${F.node}, endNode=${me?.node}`);throw ce.code===Jt.SUBSCRIBE_TIMED_OUT.code&&this.onTrySubscribeFailure(ce,"ice restart timeout"),ue}}))}measureFirstFrameDuration({mediaStream:E,subscribeType:A,callback:O}){const F=performance.now(),V=me=>{const ce=performance.now()-F;O(ce,me),me==="audio"?ue():K()};let K=Uh,ue=Uh;return A!==Gs.AUDIO_ONLY&&(K=(function(me,ce){return Tg(me,"video",ce)})(E,V)),ue=(function(me,ce){return Tg(me,"audio",ce)})(E,V),()=>{K(),ue()}}}var Z,ge;$f=new WeakSet,ef=function(M){return M.id===this.id},(function(M){M.JOIN_ERROR="JOIN_ERROR",M.PUBLISH_ERROR="PUBLISH_ERROR",M.SUBSCRIBE_ERROR="SUBSCRIBE_ERROR"})(Z||(Z={})),(function(M){M[M.TOKEN_MALFORMED=1]="TOKEN_MALFORMED",M[M.TOKEN_EXPIRED=2]="TOKEN_EXPIRED",M[M.TIMEOUT=3]="TIMEOUT",M[M.FAILED=4]="FAILED",M[M.CANCELED=5]="CANCELED",M[M.STAGE_AT_CAPACITY=6]="STAGE_AT_CAPACITY",M[M.CODEC_MISMATCH=7]="CODEC_MISMATCH",M[M.TOKEN_NOT_ALLOWED=8]="TOKEN_NOT_ALLOWED",M[M.STAGE_DELETED=9]="STAGE_DELETED",M[M.PARTICIPANT_DISCONNECTED=10]="PARTICIPANT_DISCONNECTED"})(ge||(ge={}));const Ie={[ge.TOKEN_MALFORMED]:"Token is malformed",[ge.TOKEN_EXPIRED]:"Token expired and is no longer valid",[ge.TIMEOUT]:"Operation timed out",[ge.FAILED]:"Operation failed",[ge.CANCELED]:"Operation canceled",[ge.STAGE_AT_CAPACITY]:"Stage at capacity",[ge.CODEC_MISMATCH]:"Client codec is not supported",[ge.TOKEN_NOT_ALLOWED]:"Token not allowed to perform operation",[ge.STAGE_DELETED]:"Stage has been deleted, unable to join",[ge.PARTICIPANT_DISCONNECTED]:"Participant has been disconnected, unable to join"},He={[Jt.EXPIRED_TOKEN.code]:ge.TOKEN_EXPIRED,[Jt.MALFORMED_TOKEN.code]:ge.TOKEN_MALFORMED,[Jt.JOIN_SERVER_BAD_REQUEST.code]:ge.FAILED,[Jt.TOKEN_PERMISSIONS_DENIED.code]:ge.TOKEN_NOT_ALLOWED,[Jt.OPERATION_ABORTED.code]:ge.CANCELED,[Jt.JOIN_TIMED_OUT.code]:ge.TIMEOUT,[Jt.STAGE_DELETED.code]:ge.STAGE_DELETED,[Jt.PARTICIPANT_DISCONNECTED.code]:ge.PARTICIPANT_DISCONNECTED,[Jt.EVENT_PLANE_WS_CREATE_FAILED.code]:ge.FAILED,[Jt.PUBLISH_TIMED_OUT.code]:ge.TIMEOUT,[Jt.PUBLISH_FAILURE.code]:ge.FAILED,[Jt.SUBSCRIBE_TIMED_OUT.code]:ge.TIMEOUT,[Jt.SUBSCRIBE_FAILURE.code]:ge.FAILED,[Jt.STAGE_AT_CAPACITY.code]:ge.STAGE_AT_CAPACITY,[Jt.NO_MATCHING_CODEC.code]:ge.CODEC_MISMATCH,[Jt.NETWORK_FAILURE.code]:ge.FAILED,[Jt.INTERNAL_SERVER_ERROR.code]:ge.FAILED,[Jt.REMOTE_STREAM_NOT_FOUND.code]:ge.FAILED,[Jt.INTERNAL_MHCP_ERROR.code]:ge.FAILED,[Jt.UNREACHABLE_MHCP.code]:ge.FAILED,[Jt.INVALID_SESSION_STATUS.code]:ge.FAILED,[Jt.MHCP_ABORTED.code]:ge.FAILED,[Jt.EVENT_PLANE_PONG_TIMEOUT.code]:ge.FAILED,[Jt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code]:ge.FAILED},ct={[Jt.SEI_INSERT_NOT_PUBLISHING_VIDEO.code]:"SEI insert failed due to not publishing video",[Jt.SEI_INSERT_INBAND_NOT_ENABLED.code]:"SEI insert failed due to in-band messaging not being enabled for the stage stream"};class ft extends Error{constructor(E,A,O){super(),this.code=E,this.category=A,this.message=O,this.name="StageError",this.errorDetails=[],this.message=`[${A}] ${O}`}addDetails(E){this.errorDetails.push(E)}get details(){return this.errorDetails.length?JSON.stringify(this.errorDetails):""}toString(){return`
${this.message}
details - ${this.details}
        `.trim()}}var kt,Wt,Yt;function nn(M,E){let A;if(M instanceof Rr){if(E===Z.JOIN_ERROR&&(M.code===Jt.EVENT_PLANE_PONG_TIMEOUT.code||M.code===Jt.EVENT_PLANE_WS_UNEXPECTED_CLOSE.code))return;const O=He[M.code];O&&(A=(function(F,V,K){var ue,me,ce;const de=Ie[F],we=new ft(F,V,de);return we.addDetails({stageErrorMessage:de,stageErrorCode:F,stageErrorCategory:V,stageArn:(ue=K.token)===null||ue===void 0?void 0:ue.stageARN,traceId:(me=K.traceId)===null||me===void 0?void 0:me.value,causeCode:K.code,causeDetails:K.details,causeMessage:K.message,causeLocation:K.location,participantId:(ce=K.token)===null||ce===void 0?void 0:ce.participantID,timeUTC:new Date().toISOString()}),we})(O,E,M))}return A}(function(M){M.ERROR="error"})(kt||(kt={}));class Gn extends Da{constructor(E){super(),this.logger=E,this.handleError=(A,O,F=!0)=>{const V=(function(ue){let me;return ue instanceof Rr&&(me=ct[ue.code]),me})(A),K=nn(A,O);if(V&&this.logger.warn({msg:V}),K)return F&&this.emit(kt.ERROR,K),K}}}(function(M){M.INTERNAL="internal",M.REMOTE="remote",M.API="api"})(Wt||(Wt={})),(function(M){M.ADDITIVE="additive",M.REPLACE="replace"})(Yt||(Yt={}));class pn{constructor(E){this.logger=new Ka(E.logger,oe.CONNECTION),this.subscribeConfig={defaults:E.subscribeDefaults,participants:{}}}handleSubscribeConfigUpdate(E,A,O,F=Yt.REPLACE){A=(de=>{const we=Zg(de);if(we.jitterBuffer!==void 0){const Me=nt=>{if(typeof nt=="number"){if(nt<0)return 0;if(nt>4e3)return 4e3}return nt};we.jitterBuffer.minDelayWhenPublishing!==void 0&&(we.jitterBuffer.minDelayWhenPublishing=Me(we.jitterBuffer.minDelayWhenPublishing)),we.jitterBuffer.minDelayWhenSubscribeOnly!==void 0&&(we.jitterBuffer.minDelayWhenSubscribeOnly=Me(we.jitterBuffer.minDelayWhenSubscribeOnly))}return we})(A),this.subscribeConfig.participants[E]===void 0&&(this.subscribeConfig.participants[E]={internalOverrides:{},apiOverrides:{},remoteOverrides:{},lastMerged:this.subscribeConfig.defaults});const V=this.subscribeConfig.participants[E];switch(O){case Wt.INTERNAL:V.internalOverrides=this.handleSubscribeConfigLevelMerging(V.internalOverrides,A,F);break;case Wt.REMOTE:V.remoteOverrides=this.handleSubscribeConfigLevelMerging(V.remoteOverrides,A,F);break;case Wt.API:V.apiOverrides=this.handleSubscribeConfigLevelMerging(V.apiOverrides,A,F);break;default:(function(de){throw new Error(`Unknown case kind: ${de}`)})(O)}const K=Ta(this.subscribeConfig.defaults,V.internalOverrides,V.remoteOverrides,V.apiOverrides);if(K===void 0)return this.logger.warn({msg:`Unable to merge subscribe configs for participant: ${E} | ${V}, ${A}`}),!1;const ue=(me=V.lastMerged,ce=K,(typeof me=="object"&&typeof ce=="object"&&(0,zi.isEqual)(me,ce))===!1);var me,ce;return V.lastMerged=K,this.subscribeConfig.participants[E]=V,ue}handleExternalSubscribeConfigUpdate(E,A,O,F=Yt.REPLACE){const V=(K=>{const ue={};return typeof K!="object"?xn.err(new Error("Invalid input")):(K.jitterBuffer!==void 0&&(ue.jitterBuffer={},K.jitterBuffer.minDelay!==void 0&&(ue.jitterBuffer.minDelayWhenSubscribeOnly=K.jitterBuffer.minDelay)),K.inBandMessaging!==void 0&&(ue.inBandMessaging={enabled:K.inBandMessaging.enabled===!0}),K.simulcast!==void 0&&(ue.simulcast={},K.simulcast.initialLayerPreference!==void 0&&(ue.simulcast.initialLayerPreference=K.simulcast.initialLayerPreference)),xn.ok(ue))})(A);return V.ok===!0&&this.handleSubscribeConfigUpdate(E,V.value,O,F)}handleSubscribeConfigLevelMerging(E,A,O){if(O===Yt.REPLACE)return A;{const F=Ta(E,A);return F===void 0?(this.logger.warn({msg:`Unable to merge '${E}' and '${A}' with type ${O}`}),E):F}}getSubscribeConfigSnapshot(E){return this.subscribeConfig.participants[E]===void 0?Cy(this.subscribeConfig.defaults):Cy(this.subscribeConfig.participants[E].lastMerged)}}class Nn extends Kn{constructor(E){super(Mn.REASSIGNMENT_REQUEST,E.token,E.traceId,!1),Object.assign(this.properties,{target_local_participant_id:E.targetLocalParticipantId,target_remote_participant_id:E.targetRemoteParticipantId}),this.critical=!0}}var Vt,mn,nr,Rn,gr,Er=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class si extends Da{constructor(E,A){super(),this.setGetStats=O=>{this._getInternalStats=O},this.getStats=()=>Er(this,void 0,void 0,(function*(){return this.requestRTCStats()})),this.requestRTCStats=()=>Er(this,void 0,void 0,(function*(){if(!this._getInternalStats)return;const O=yield this._getInternalStats(this.mediaStreamTrack);return O?O.rawReport:void 0})),this._getInternalStats=A,this.id=E.id,this.isMuted=!E.enabled,this.mediaStreamTrack=E,this.streamType=this.mediaStreamTrack.kind==="audio"?Tr.AUDIO:Tr.VIDEO}cleanup(){this.removeAllListeners(),this._getInternalStats=void 0}}(function(M){M.IDLE="IDLE",M.INITIALIZING="INITIALIZING",M.ACTIVE="ACTIVE",M.CONTROLS_PAUSED="CONTROLS_PAUSED",M.DESTROYED="DESTROYED"})(Vt||(Vt={})),(function(M){M.LAYERS_CHANGED="LAYERS_CHANGED",M.LAYER_SELECTED="LAYER_SELECTED",M.ADAPTION_CHANGED="ADAPTION_CHANGED"})(mn||(mn={})),(function(M){M.LAYERS_CHANGED="LAYERS_CHANGED",M.LAYER_SELECTED="LAYER_SELECTED",M.ADAPTION_CHANGED="ADAPTION_CHANGED"})(nr||(nr={})),(function(M){M.UNAVAILABLE="unavailable",M.SELECTED="selected"})(Rn||(Rn={})),(function(M){M.LOCAL_STREAM_MUTE_CHANGED="localStreamMutedChanged",M.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST="localStreamInsertSeiMsgRequest"})(gr||(gr={}));var tr,jn,wi,Ls=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class wa extends si{constructor(E,A){super(E),this.setMuted=O=>{O!==this.isMuted&&(this.mediaStreamTrack.enabled=!O,this.isMuted=O,this.emit(gr.LOCAL_STREAM_MUTE_CHANGED,this))},this.insertSeiMessage=(O,F)=>Ls(this,void 0,void 0,(function*(){let V;if(this.streamType==="audio")V=ca.INVALID_TRACK_TYPE;else if(this.mediaConfig.inBandMessaging.enabled){const K=this.validator.validateMessagePayload(O,F?.repeatCount||0);V=xn.getErr(K)}else V=ca.INBAND_MESSAGING_NOT_ENABLED;V?console.warn(`Unable to insert SEI message due to ${V}`):this.emit(gr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this,O,F)})),this.requestQualityStats=()=>Ls(this,void 0,void 0,(function*(){if(!this._getInternalStats)return;const O=yield this._getInternalStats(this.mediaStreamTrack);return O?O.stats:void 0})),this.validatedExternalConfig=Qs(E,A),this.normalizedConfig=u0(0,this.validatedExternalConfig),this.mediaConfig=(0,zi.cloneDeep)(this.normalizedConfig),this.validator=new Jh(Yu)}}class cs{constructor(E,A){this.strategy=E,this.logger=A}setStrategy(E){this.strategy=E}hasStrategy(E){return this.strategy[E]!==void 0}stageStreamsToPublish(){let E=[];try{E=this.strategy.stageStreamsToPublish(),E=E.filter((F=>F instanceof wa))}catch(F){return this.logger.warn({msg:"error executing stageStreamsToPublish treating this as a no-op",err:F}),console.error("Error executing stageStreamsToPublish",F),xn.err(F)}let A=0,O=0;for(const F of E)F.mediaStreamTrack.kind==="audio"?A++:F.mediaStreamTrack.kind==="video"&&O++;if(A>1||O>1){const F=Error("stageStreamsToPublish strategy function returned more than 1 video or audio stream and as a result will not publish",{cause:"UserStrategy"});return xn.err(F)}return xn.ok(E)}shouldPublishParticipant(E){try{return xn.ok(this.strategy.shouldPublishParticipant(E))}catch(A){return this.logger.warn({msg:"error executing shouldPublishParticipant treating this as a no-op",err:A}),console.error("Error executing shouldPublishParticipant",A),xn.err(A)}}shouldSubscribeToParticipant(E){try{return xn.ok(this.strategy.shouldSubscribeToParticipant(E))}catch(A){return this.logger.warn({msg:"error executing shouldSubscribeToParticipant. Treating it as a no-op",err:A}),console.error("Error executing shouldSubscribeToParticipant",A),xn.err(A)}}subscribeConfiguration(E){var A,O;try{return xn.ok((O=(A=this.strategy).subscribeConfiguration)===null||O===void 0?void 0:O.call(A,E))}catch(F){return this.logger.warn({msg:"error executing subscribeConfiguration. Treating it as a no-op",err:F}),console.error("Error executing subscribeConfiguration",F),xn.err(F)}}preferredLayerForStream(E,A){var O,F;try{return xn.ok((F=(O=this.strategy).preferredLayerForStream)===null||F===void 0?void 0:F.call(O,E,A))}catch(V){return this.logger.warn({msg:"error executing preferredLayerForStream. Treating it as a no-op",err:V}),console.error("Error executing preferredLayerForStream",V),xn.err(V)}}}class zo extends Da{constructor(E,A){super(),this.audioMuted=!0,this.videoStopped=!0,this.publishState=jn.NOT_PUBLISHED,this.logger=A,this.info=E,this.audioMuted=E.audioMuted,this.videoStopped=E.videoStopped}}(function(M){M.PUBLISH="publish",M.SUBSCRIBE="subscribe"})(tr||(tr={})),(function(M){M.NOT_PUBLISHED="not_published",M.ATTEMPTING_PUBLISH="attempting_publish",M.PUBLISHED="published",M.ERRORED="errored"})(jn||(jn={})),(function(M){M.NOT_SUBSCRIBED="not_subscribed",M.ATTEMPTING_SUBSCRIBE="attempting_subscribe",M.SUBSCRIBED="subscribed",M.ERRORED="errored"})(wi||(wi={}));function $i(M){return M.map((E=>E.remote))}function nh(M){return{label:M.encodingId,bitrateBps:1e3*M.bitrate,width:M.width,height:M.height,framesPerSecond:M.framesPerSecond,selected:M.selected}}function nl(M,E){const A=M.width*M.height,O=E.width*E.height;return A>O||M.bitrateBps>E.bitrateBps||M.framesPerSecond>E.framesPerSecond?1:A===O&&M.bitrateBps===E.bitrateBps&&M.framesPerSecond===E.framesPerSecond?0:-1}var Us=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class Gd extends Da{constructor(E){var A,O,F;super(),this.onAdaptionChanged=V=>{this.emit(nr.ADAPTION_CHANGED,V)},this.onLayersChanged=V=>{this.emit(nr.LAYERS_CHANGED,V)},this.onLayerSelected=(V,K)=>{this.emit(nr.LAYER_SELECTED,V,K)},this.setGetStats=()=>{},this.requestRTCStats=()=>Us(this,void 0,void 0,(function*(){var V;return(V=this.internalStream)===null||V===void 0?void 0:V.requestRTCStats()})),this.requestQualityStats=()=>Us(this,void 0,void 0,(function*(){if(this.internalStream)try{const V=yield this.internalStream.getInternalStats();return V?V.stats:void 0}catch{return}})),this.getStats=()=>Us(this,void 0,void 0,(function*(){var V;return(V=this.internalStream)===null||V===void 0?void 0:V.requestRTCStats()})),this.setMuted=V=>{var K;(K=this.internalStream)===null||K===void 0||K.setMuted(V)},this.getLayers=()=>{var V,K;return(K=(V=this.internalStream)===null||V===void 0?void 0:V.layers)!==null&&K!==void 0?K:this.cachedLayers},this.getSelectedLayer=()=>{var V,K;return(K=(V=this.internalStream)===null||V===void 0?void 0:V.selectedLayer)!==null&&K!==void 0?K:this.cachedSelectedLayer},this.getLowestQualityLayer=()=>{var V,K;return(K=(V=this.internalStream)===null||V===void 0?void 0:V.lowestQualityLayer)!==null&&K!==void 0?K:this.cachedLowestLowestLayer},this.getHighestQualityLayer=()=>{var V,K;return(K=(V=this.internalStream)===null||V===void 0?void 0:V.highestQualityLayer)!==null&&K!==void 0?K:this.cachedHighestQualityLayer},this.internalStream=E,this.cachedId=this.internalStream.id,this.cachedParticipantInfo=(0,zi.cloneDeep)(this.internalStream.participantInfo),this.cachedStreamType=this.internalStream.streamType,this.cachedMediaStreamTrack=(F=(O=(A=this.internalStream.mediaStreamTrack).clone)===null||O===void 0?void 0:O.call(A))!==null&&F!==void 0?F:{},this.cachedIsMuted=this.internalStream.isMuted,this.cachedIsAdapting=this.internalStream.isAdapting,this.cachedLayers=this.internalStream.layers,this.updateCachedStreamData(),this.internalStream.on(mn.ADAPTION_CHANGED,this.onAdaptionChanged),this.internalStream.on(mn.LAYERS_CHANGED,this.onLayersChanged),this.internalStream.on(mn.LAYER_SELECTED,this.onLayerSelected)}updateCachedStreamData(){var E,A,O,F,V;this.cachedLayers=(A=(E=this.internalStream)===null||E===void 0?void 0:E.layers)!==null&&A!==void 0?A:[],this.cachedHighestQualityLayer=(O=this.internalStream)===null||O===void 0?void 0:O.highestQualityLayer,this.cachedLowestLowestLayer=(F=this.internalStream)===null||F===void 0?void 0:F.lowestQualityLayer,this.cachedSelectedLayer=(V=this.internalStream)===null||V===void 0?void 0:V.selectedLayer}get id(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.id)!==null&&A!==void 0?A:this.cachedId}get participantInfo(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.participantInfo)!==null&&A!==void 0?A:this.cachedParticipantInfo}get streamType(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.streamType)!==null&&A!==void 0?A:this.cachedStreamType}get mediaStreamTrack(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.mediaStreamTrack)!==null&&A!==void 0?A:this.cachedMediaStreamTrack}get isMuted(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.isMuted)!==null&&A!==void 0?A:this.cachedIsMuted}set isMuted(E){var A;(A=this.internalStream)===null||A===void 0||A.setMuted(E)}get isAdapting(){var E,A;return(A=(E=this.internalStream)===null||E===void 0?void 0:E.isAdapting)!==null&&A!==void 0?A:this.cachedIsAdapting}cleanup(){var E,A,O;this.updateCachedStreamData(),(E=this.internalStream)===null||E===void 0||E.off(mn.ADAPTION_CHANGED,this.onAdaptionChanged),(A=this.internalStream)===null||A===void 0||A.off(mn.LAYERS_CHANGED,this.onLayersChanged),(O=this.internalStream)===null||O===void 0||O.off(mn.LAYER_SELECTED,this.onLayerSelected),this.internalStream=void 0,this.removeAllListeners()}}var iu,vo,yo=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class Aa extends si{constructor({track:E,info:A,getStats:O,remotePlaybackController:F,analyticsTracker:V,token:K,subscribeConfig:ue}){super(E,O),this.hasRemoteListenersForLayerEvents=()=>{const ce=this.remote;return ce.hasListenersFor(nr.ADAPTION_CHANGED)||ce.hasListenersFor(nr.LAYERS_CHANGED)||ce.hasListenersFor(nr.LAYER_SELECTED)},this.setMuted=ce=>{this.isMuted=ce,this.mediaStreamTrack.enabled=!ce},this.setLayer=ce=>{const de=(0,zi.cloneDeep)(ce);if(this.queueLayerUpdateForValidState(de))return void this.logger.debug({msg:`setLayer:${de} queued, skipping for now`});const we=(function(nt,bt){if(!nt)return(0,xn.ok)(void 0);const ut=typeof nt=="string"?nt:nt.label,dt=bt.filter((Qe=>Qe.label===ut))[0];return dt?(0,xn.ok)(dt):(0,xn.err)(`Provided layer with id ${ut} does not exist`)})(de,this._layers);if(!we.ok){const nt=we.error;return void this.logger.error({err:nt,msg:"Unable to select layer, skipping selection"})}const Me=we.value;if(this.isNextUpdateAdaptionOnly(Me))return this.logger.warn({msg:"setLayer:dynamic"}),void this.handleDynamicUpdate();this.isFirstLayerUpdate()||!this.isRepeatLayerSelection(Me)||this.isAdapting?Me&&(this.logger.warn({msg:`setLayer:${JSON.stringify(Me)} `}),this.handleManualUpdate(Me)):this.logger.debug({msg:"Setting the same layer, same adaption state, skipping selection"})},this.state=Vt.INITIALIZING,this.prevState=Vt.IDLE,this.analyticsTracker=V,this.token=K,this.id=E.id,this.info=A,this.mediaStreamTrack=E,this.remotePlaybackController=F,this.layerPollingIntervalId=null,this.weakRemoteMap=new WeakMap,this.weakRemoteKey={id:"remote"},this.commandMap=new Map,this.subscribeConfig=ue,this._isAdapting=!0,this._layers=[],this._selectedLayer=null;const me=v_();this.logger=new Ka(new ta(me),oe.REMOTE_STAGE_STREAM),this.streamType===Tr.AUDIO?this.isMuted=A.audioMuted:this.isMuted=A.videoStopped,this.initializeLayerPolling(),this.pollInternalLayers(!0)}transitionStateTo(E){this.state!==E&&(this.prevState=this.state,this.state=E)}initializeLayerPolling(){Md(this.mediaStreamTrack)?this.streamType!==Tr.AUDIO?(this.logger.debug({msg:"Setting up RemoteStageStream, requesting initial layers"}),this.layerPollingIntervalId!==null&&clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=setInterval((()=>{this.pollInternalLayers()}),this.subscribeConfig.simulcast.layerPollingIntervalMs)):this.logger.debug({msg:"Skipping initializing polling for audio streams"}):this.logger.debug({msg:"Skipping initializing polling, media track is not active"})}startLayerPolling(){this.layerPollingIntervalId===null?this.initializeLayerPolling():this.logger.debug({msg:"Skipping start polling request, already started"})}stopLayerPolling(){this.layerPollingIntervalId!==null?(clearInterval(this.layerPollingIntervalId),this.layerPollingIntervalId=null):this.logger.debug({msg:"Skipping stop polling request, already stopped"})}pollInternalLayers(E=!1){if(!Md(this.mediaStreamTrack))return void this.pauseControls();if(this.streamType===Tr.AUDIO)return this.logger.debug({msg:"Skipping layer poll request for audio stream"}),void this.transitionStateTo(Vt.ACTIVE);const A=!this.hasRemoteListenersForLayerEvents(),O=!this.subscribeConfig.simulcast.layerPollingEnabled;!E&&A&&O?this.logger.debug({msg:"Skipping layer request due to no listeners"}):this.remotePlaybackController.getLayers().then((F=>{if(this.isStateValidForLayerUpdates()){if(!F.ok)throw Error(F.error);this.updateInternalLayersFromRemote(F.value),this.transitionStateTo(Vt.ACTIVE),this.flushCommandQueue()}else this.logger.warn({msg:"Stream controls have been paused, skipping getLayers"})})).catch((F=>{this.logger.error({err:F,msg:"Error calling getLayers, returning current layers"})}))}updateInternalLayersFromRemote(E){const A=this._layers,O=E.map(nh).sort(nl),F=!(0,zi.isEqual)(O,A);this._layers=O;const V=this._selectedLayer,K=this._layers.filter((me=>me.selected))[0],ue=!(0,zi.isEqual)(K,V);V&&(V.selected=!1),this._selectedLayer=K,ue&&(this.trackLayerUpdate(V),this.trackLayerUpdate(K)),this.isCommandQueueEmpty()&&(F&&this.emitLayersChanged(),ue&&this.emitLayerSelected(K))}flushCommandQueue(){if(this.isCommandQueueEmpty())return;const E=Array.from(this.commandMap.keys());this.logger.debug({msg:`Flushing active commands from map ${E}`});for(const A of this.commandMap.keys()){const O=this.commandMap.get(A);O?.()}this.commandMap.clear()}queueLayerUpdateForValidState(E){if(!E)return this.commandMap.delete("setLayer"),!1;if(this.state===Vt.INITIALIZING){const A=this.setLayer.bind(this,E);return this.commandMap.set("setLayer",A),!0}return!1}handleDynamicUpdate(){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const E=this._isAdapting;this._isAdapting=!0,this.emitAdaptionChanged(),this.remotePlaybackController.unsetLayer().then((A=>{if(!this.isStateValidForLayerUpdates())return this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"}),void this.resetAdaptionStateOnError(E,`Stream in invalid state: ${this.state}`);A.ok?this.logger.debug({msg:"Layer successfully unset, restarting dynamic adaption"}):this.resetAdaptionStateOnError(E,A.error)})).catch((()=>{}))}resetAdaptionStateOnError(E,A){this._isAdapting=E,this.emitAdaptionChanged(),this.logger.error({err:A,msg:"Error unsetting layer, reverting adaption state"})}handleManualUpdate(E){if(!this.isStateValidForLayerUpdates())return void this.logger.warn({msg:"Stream controls have been paused, skipping manual updates"});const A=this._isAdapting,O=this._selectedLayer;O&&(O.selected=!1),this._isAdapting=!1,this._selectedLayer=E,E.selected=!0,A!==this._isAdapting&&this.emitAdaptionChanged(),this.updateLocalLayerStateBeforeRemote(E,O),this.trackLayerUpdate(O),this.trackLayerUpdate(E),this.emitLayersChanged(),this.emitLayerSelected(E),this.remotePlaybackController.setLayer(E.label).then((F=>{if(!this.isStateValidForLayerUpdates()){this.logger.warn({msg:"Stream controls have been paused, skipping dynamic mode transition"});const V=`Stream in invalid state: ${this.state}`;return this.resetAdaptionStateOnError(A,V),void this.resetLayerOnError(O,E,V)}if(!F.ok){const V=F.error;return this.resetAdaptionStateOnError(A,V),void this.resetLayerOnError(O,E,V)}this.logger.debug({msg:`Layer successfully selected: ${E.label}`})})).catch((()=>{}))}applyExistingControlState(){var E;this._isAdapting?this.remotePlaybackController.unsetLayer().then((()=>{})).catch((()=>{})):!((E=this._selectedLayer)===null||E===void 0)&&E.label&&this.remotePlaybackController.setLayer(this._selectedLayer.label).then((()=>{})).catch((()=>{}))}resetLayerOnError(E,A,O){A&&(A.selected=!1),E&&(E.selected=!0),this._selectedLayer=E,this.logger.error({err:O,msg:"Error unsetting layer, leaving current selection in place"}),this.updateLocalLayerStateBeforeRemote(E,A),this.emitLayersChanged(),E!==null&&this.emitLayerSelected(E,Rn.UNAVAILABLE),this.trackLayerUpdate(A),this.trackLayerUpdate(E)}updateLocalLayerStateBeforeRemote(E,A){this._layers=this._layers.map((O=>O.label===E?.label?E:O.label===A?.label?A:O)).sort(nl)}trackLayerUpdate(E){var A,O;this.analyticsTracker.trackEventNoSharedProps(new Y_(this.token,Ns(),(A=E?.label)!==null&&A!==void 0?A:"auto",!0,Qt.SUBSCRIBE,(O=E?.selected)!==null&&O!==void 0&&O,this.info.id))}isNextUpdateAdaptionOnly(E){return E===void 0&&this.isFirstLayerUpdate()||E===void 0&&!this.isAdapting}isFirstLayerUpdate(){return this._selectedLayer===null}isRepeatLayerSelection(E){var A;return((A=this._selectedLayer)===null||A===void 0?void 0:A.label)===E?.label}isStateValidForLayerUpdates(){return this.state===Vt.ACTIVE||this.state===Vt.INITIALIZING}isCommandQueueEmpty(){return this.commandMap.size===0}emitLayerSelected(E,A=Rn.SELECTED){this.logger.debug({msg:`Emitting layers selected ${JSON.stringify(E,null,2)}`}),this.emit(mn.LAYER_SELECTED,(0,zi.cloneDeep)(E),A)}emitLayersChanged(){this.emit(mn.LAYERS_CHANGED,(0,zi.cloneDeep)(this._layers))}emitAdaptionChanged(){this.emit(mn.ADAPTION_CHANGED,this._isAdapting)}get remote(){const E=this.weakRemoteMap.get(this.weakRemoteKey);if(E)return E;const A=new Gd(this);return this.weakRemoteMap.set(this.weakRemoteKey,A),A}get participantInfo(){return(0,zi.cloneDeep)(this.info)}get isAdapting(){return this._isAdapting}get layers(){return(0,zi.cloneDeep)(this._layers)}get selectedLayer(){var E;return(0,zi.cloneDeep)((E=this._selectedLayer)!==null&&E!==void 0?E:void 0)}get highestQualityLayer(){return(0,zi.cloneDeep)(this.layers[this.layers.length-1])}get lowestQualityLayer(){return(0,zi.cloneDeep)(this.layers[0])}getInternalStats(){return yo(this,void 0,void 0,(function*(){if(this._getInternalStats)return this._getInternalStats(this.mediaStreamTrack)}))}pauseControls(){this.transitionStateTo(Vt.CONTROLS_PAUSED),this.stopLayerPolling()}resumeControls(){this.applyExistingControlState(),this.startLayerPolling(),this.transitionStateTo(Vt.ACTIVE)}updateSubscribeConfig(E){const A=this.subscribeConfig;this.subscribeConfig=E,A.simulcast.layerPollingIntervalMs!==E.simulcast.layerPollingIntervalMs&&this.isStateValidForLayerUpdates()&&this.initializeLayerPolling()}cleanup(){this.transitionStateTo(Vt.DESTROYED),super.cleanup(),this.weakRemoteMap.delete(this.weakRemoteKey),this.stopLayerPolling(),this._layers=[],this._selectedLayer=null,this._isAdapting=!0,this.commandMap.clear()}}(function(M){M.STATE_CHANGE="stateChange",M.MEDIA_STREAM_ADDED="mediaStreamAdded",M.MEDIA_STREAM_REMOVED="mediaStreamRemoved",M.MEDIA_STREAM_MUTE_CHANGED="mediaStreamMuteChanged",M.ERROR="error"})(iu||(iu={})),(function(M){M.SUBSCRIPTION_STATE_CHANGE="subscriptionStateChange",M.MEDIA_STREAM_SEI_MESSAGE_RECEIVED="mediaStreamSeiMessageReceived"})(vo||(vo={}));const ls=Object.assign(Object.assign({},iu),vo);var su;(function(M){M.PUBLICATION_STATE_CHANGE="publicationStateChange"})(su||(su={}));const ou=Object.assign(Object.assign({},iu),su);var g0=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class Wd extends zo{constructor(E,A,O,F,V,K,ue,me=!1){super(E,new Ka(F,oe.REMOTE_PARTICIPANT)),this.subscribeState=wi.NOT_SUBSCRIBED,this.reassigning=!1,this.streams=[],this.left=!1,this.onSubscriptionStateChange=ce=>{this.logger.debug({msg:"subscriptionStateChange",state:ce}),ce===eo.DISCONNECTED?this.updateSubscriptionState(wi.NOT_SUBSCRIBED):ce===eo.CONNECTED?this.updateSubscriptionState(wi.SUBSCRIBED):ce===eo.CONNECTING?this.updateSubscriptionState(wi.ATTEMPTING_SUBSCRIBE):ce===eo.ERRORED?(this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams(),this.updateSubscriptionState(wi.ERRORED)):this.logger.warn({msg:"FIXME onSubscriptionStateChange UNHANDLED STATE",state:ce})},this.onSubscriptionStreamRemoved=()=>{this.logger.debug({msg:"onSubscriptionStreamRemoved"}),this.emitStreamsRemovedByType(this.getDesiredSubscribeType()),this.cleanupStreams()},this.onSubscriptionStreamCreated=(ce,de)=>{this.logger.debug({msg:"onSubscriptionStreamCreated",stream:ce}),this.pruneInactiveStreams();let we=ce.getTracks().map((Me=>{const nt=new Aa({track:Me,info:this.info,getStats:this.subscription.requestRTCStats,remotePlaybackController:de,analyticsTracker:this.analyticsTracker,token:this.token,subscribeConfig:this.subscribeConfig});return this.streams.push(nt),nt}));this.subscription.getDesiredSubscribeType()===Gs.AUDIO_ONLY&&(we=we.filter((Me=>Me.streamType!==Tr.VIDEO))),this.emit(ls.MEDIA_STREAM_ADDED,we)},this.onSubscriptionError=ce=>{this.emit(ls.ERROR,ce)},this.onSubscriptionSeiMessageReceived=ce=>{this.emit(ls.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,ce)},this.onSubscriptionTransformError=ce=>{this.emit(ls.ERROR,ce)},this.onSubscriptionReassignmentStart=()=>{for(const ce of this.streams)ce.pauseControls()},this.onSubscriptionReassignmentDone=()=>{for(const ce of this.streams)ce.resumeControls()},this.updateSubscribeStateIfNecessary=(ce,de)=>{if(!this.info.capabilities.has(tr.SUBSCRIBE))return;de!==void 0&&(this.subscribeConfig=de,this.subscription.updateSubscribeConfig(de),this.streams.forEach((nt=>{nt.updateSubscribeConfig(de)})));const we=ce!==Gs.NONE&&this.publishState===jn.PUBLISHED,Me=this.subscribeState!==wi.NOT_SUBSCRIBED&&this.subscribeState!==wi.ERRORED;if(we&&!Me)this.subscription.updateDesiredSubscribeType(ce),this.subscribe();else if(!we&&Me)this.unsubscribe(),this.subscription.updateDesiredSubscribeType(ce);else if(this.subscribeState===wi.SUBSCRIBED&&this.subscription.getDesiredSubscribeType()!==ce)try{ce===Gs.AUDIO_ONLY?this.emit(ls.MEDIA_STREAM_REMOVED,this.filterStreamsByType(this.streams,Tr.VIDEO)):ce===Gs.AUDIO_VIDEO&&this.emit(ls.MEDIA_STREAM_ADDED,this.filterStreamsByType(this.streams,Tr.VIDEO)),this.subscription.updateDesiredSubscribeType(ce)}catch(nt){this.logger.error({err:nt,msg:"error updating subscribe type"})}},this.updatePublishState=ce=>{const de=ce&&this.publishState===jn.PUBLISHED,we=!ce&&this.publishState===jn.NOT_PUBLISHED;return!de&&!we&&(this.info.isPublishing=ce,this.publishState=ce?jn.PUBLISHED:jn.NOT_PUBLISHED,!0)},this.updateStreamState=(ce,de)=>{this.audioMuted!==ce&&(this.audioMuted=ce,this.info.audioMuted=ce,this.updateStreamMuteState(Tr.AUDIO,ce)),this.videoStopped!==de&&(this.videoStopped=de,this.info.videoStopped=de,this.updateStreamMuteState(Tr.VIDEO,de))},this.updateStreamMuteState=(ce,de)=>{const we=this.filterStreamsByType(this.streams,ce),Me=we[we.length-1];if(!Me){const nt=`state update received for ${this.info.id} for non-existent ${ce} stream`;return this.logger.warn({msg:nt}),void this.traceRemoteParticipantMsg(nt)}Me.setMuted(de),this.emit(ls.MEDIA_STREAM_MUTE_CHANGED,Me)},this.cleanup=()=>{this.removeAllListeners()},this.quickUnsubscribe=()=>this.subscribeState!==wi.NOT_SUBSCRIBED&&this.subscription.stop(!0),this.getDesiredSubscribeType=()=>this.subscription.getDesiredSubscribeType(),this.isReassigning=()=>this.reassigning,this.analyticsTracker=ue,this.token=A,this.subscribeConfig=K,this.createSubscription=()=>{const ce=new D(E.id,A,O,F,ue,V,K);return ce.on(Ac,this.onSubscriptionStateChange),ce.on(Df,this.onSubscriptionStreamCreated),ce.on($u,this.onSubscriptionStreamRemoved),ce.on(Xp,this.onSubscriptionError),ce.on(Vu,this.onSubscriptionSeiMessageReceived),ce.on(Zp,this.onSubscriptionTransformError),ce.on(Ld,this.onSubscriptionReassignmentStart),ce.on(Ud,this.onSubscriptionReassignmentDone),ce.on(xy,this.onSubscriptionReassignmentDone),ce},this.subscription=this.createSubscription(),me&&(this.publishState=jn.PUBLISHED)}updateSubscriptionState(E){E!==this.subscribeState&&(this.subscribeState=E,this.emit(ls.SUBSCRIPTION_STATE_CHANGE,this.subscribeState))}pruneInactiveStreams(){const E=[];this.streams=this.streams.filter((V=>!!Md(V.mediaStreamTrack)||(E.push(V),!1)));const A=E.length;if(A===0)return;const O=this.filterStreamsByType(E,Tr.AUDIO).length,F=A-O;this.traceRemoteParticipantMsg(`Pruning inactive streams (${O} audio, ${F} video)`),this.emitStreamsRemoved(E),E.forEach((V=>{V.remote.cleanup(),V.cleanup()}))}filterStreamsByType(E,A){return E.filter((O=>O.streamType===A))}participantLeave(){this.left=!0}subscribe(){this.left?this.logger.warn({msg:"tried to subscribe to a participant that left"}):(this.updateSubscriptionState(wi.ATTEMPTING_SUBSCRIBE),this.logger.debug({msg:"subscribe"}),this.subscription.start())}unsubscribe(){if(this.subscribeState===wi.NOT_SUBSCRIBED)return;this.logger.debug({msg:"unsubscribe"}),this.subscription.stop(),this.subscription.off(Ac,this.onSubscriptionStateChange),this.subscription.off(Df,this.onSubscriptionStreamCreated),this.subscription.off($u,this.onSubscriptionStreamRemoved),this.subscription.off(Xp,this.onSubscriptionError),this.subscription.off(Zp,this.onSubscriptionTransformError);const E=this.getDesiredSubscribeType();this.subscription=this.createSubscription(),this.emitStreamsRemovedByType(E),this.updateSubscriptionState(wi.NOT_SUBSCRIBED),this.cleanupStreams()}emitStreamsRemovedByType(E){switch(E){case Gs.AUDIO_VIDEO:this.emitStreamsRemoved(this.streams);break;case Gs.AUDIO_ONLY:this.emitStreamsRemoved(this.filterStreamsByType(this.streams,Tr.AUDIO));case Gs.NONE:}}emitStreamsRemoved(E){this.emit(ls.MEDIA_STREAM_REMOVED,E)}cleanupStreams(){this.streams.length!==0&&(this.logger.debug({msg:"Cleaning up streams due to internal removal"}),this.streams.forEach((E=>{E.remote.cleanup(),E.cleanup()})),this.streams=[])}traceRemoteParticipantMsg(E){this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,Ns(),E,Qt.SUBSCRIBE,this.info.id))}triggerIceRestart(E){return g0(this,void 0,void 0,(function*(){this.reassigning=!0;try{yield this.subscription.triggerIceRestart(E)}finally{this.reassigning=!1}}))}}const Vf=Qt.PUBLISH;function Vy(M,E,A){return new Rr(Object.assign(Object.assign({},M),{token:E,traceId:A,location:"stage-publication.sendSeiMessage",tag:Xc,action:Qt.PUBLISH}))}class ES{constructor(E,A){this.analyticsTracker=E,this.token=A,this.action=Vf,this.traceId=Ns()}trackPublish(E){const{action:A,traceId:O,analyticsTracker:F,token:V}=this;return F.trackEvent(new f0({token:V,traceId:O})),{getTraceId:()=>O,trackPublishStarted({totalDurationWithRetries:K,retryTimes:ue,sfuResource:me,peerClientPerfStats:ce,protocol:de}){const{optionsDuration:we,postDuration:Me,timeToCandidate:nt,timeToConnected:bt,sdpExchangeDuration:ut,sdpExchangeTransport:dt,setRemoteDescDuration:Qe,peerConnectionDuration:st}=ce,{edpInitialConnectDuration:It,edpInitialConnectRetries:En,edpInitialStateDuration:Dn,edpStateUpdateCount:Xn}=E;F.trackEvent(new Cl({token:V,traceId:O,optionsDuration:we,postDuration:Me,timeToCandidate:nt,totalDuration:bt,edpInitialConnectDuration:It,edpInitialConnectRetries:En,edpInitialStateDuration:Dn,edpStateUpdateCount:Xn,sdpExchangeDuration:ut,sdpExchangeTransport:dt,setRemoteDescDuration:Qe,peerConnectionDuration:st,publishRetries:ue,totalDurationWithRetries:K,sfuResource:me,protocol:de}))},trackPublishFailed(K,ue){const me=((de,we,Me)=>{if(de instanceof Rr)return de;let nt="";return de instanceof bc.AxiosError&&(nt+=`AxiosError - ${de.code}`),new Rr(Object.assign(Object.assign(Object.assign({},Jt.PUBLISH_FAILURE),{action:Vf,token:we,traceId:Me,tag:Xc,location:"publish",details:`${nt} ${de.message}`}),{fatal:!0}))})(K,V,O);F.trackEvent(new _S({token:V,traceId:O,code:me.code,message:me.message,fatal:me.fatal,nominal:me.nominal,protocol:ue}));const ce=new Rr(Object.assign(Object.assign({},Jt.PUBLISH_FAILURE),{action:A,token:V,traceId:O,tag:Xc,location:"publish"}));return K instanceof Rr&&(ce.fatal=K.fatal,ce.nominal=K.nominal,ce.location=`publish > ${K.location}`),F.trackError(ce),me},trackUnpublish:()=>{F.trackEvent(new Al({token:V,traceId:O}))},trackEndSucceeded:(K,ue)=>{F.trackEvent(new Fr({token:V,isUnpublishSuccessful:!0,traceId:O,reason:K,protocol:ue}))},trackEndFailed:(K,ue)=>{const me=new Rr(Object.assign(Object.assign({},Jt.UNPUBLISH_FAILURE),{token:V,traceId:O,tag:Ey,location:"unpublish"}));return K!==Sr.UNLOAD&&K!==Sr.UNPUBLISH||this.analyticsTracker.trackError(me),F.trackEvent(new Fr({token:V,isUnpublishSuccessful:!1,traceId:O,reason:K,protocol:ue})),me},createSeiNotPublishingVideoError:()=>Vy(Jt.SEI_INSERT_NOT_PUBLISHING_VIDEO,V,O),createSeiInBandMessagingNotEnabledError:()=>Vy(Jt.SEI_INSERT_INBAND_NOT_ENABLED,V,O)}}}var $o,Rl,Yr=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};(function(M){M.DISCONNECTED="disconnected",M.CONNECTING="connecting",M.CONNECTED="connected",M.ERRORED="errored"})($o||($o={})),(function(M){M.STATE_CHANGE="stateChange",M.ERROR="error",M.TRANSFORM_ERROR="transformError"})(Rl||(Rl={}));class ws extends Da{constructor(E,A,O,F){super(),this.token=E,this.stageConnection=A,this.nonScopedLogger=O,this.analyticsTracker=F,this.streamsToPublish=[],this.publicationState=$o.DISCONNECTED,this.latestPubAttemptNum=0,this.startConnectingTimestamp=-1,this.action=Qt.PUBLISH,this.start=V=>{this.publicationState===$o.DISCONNECTED||this.publicationState===$o.ERRORED?(this.streamsToPublish=V,this.latestPubAttemptNum=0,this.processStateUpdate()):this.logger.warn({msg:"publication cannot be started if not in disconnected or error state"})},this.requestRTCStats=V=>Yr(this,void 0,void 0,(function*(){return this.peerClient.requestRTCStats(V)})),this.stop=(V=!1)=>Yr(this,void 0,void 0,(function*(){this.peerClient.off(qc,this.onPeerClientConnectionStateChange),this.peerClient.off(Ec,this.onPeerClientTransformError),yield this.unpublish(V),this.updateState($o.DISCONNECTED)})),this.processStateUpdate=V=>{const{publicationState:K}=this;K===$o.DISCONNECTED||K===$o.ERRORED?this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState($o.CONNECTING),this.tryPublish()):K===$o.CONNECTING?V===hr.CONNECTED&&this.updateState($o.CONNECTED):K===$o.CONNECTED&&V===hr.FAILED&&(this.attemptTracker&&this.attemptTracker.trackEndFailed(Sr.CONNECTION_FAIL,this.peerClient.getProtocol()),this.latestPubAttemptNum===0&&(this.startConnectingTimestamp=performance.now(),this.updateState($o.CONNECTING),this.tryPublish()))},this.updateState=V=>{this.publicationState=V,this.emit(Rl.STATE_CHANGE,V)},this.tryPublish=()=>Yr(this,void 0,void 0,(function*(){if(this.latestPubAttemptNum++,this.latestPubAttemptNum<=4){const V=this.stageConnection.getConnectionStats();this.attemptTracker=this.publishTracker.trackPublish(V);try{this.logger.debug({msg:`attempting to publish, attemptNum: ${this.latestPubAttemptNum}`}),yield this.publish(this.streamsToPublish,this.attemptTracker.getTraceId()),this.logger.debug({msg:"publish succeeded!"});const K=this.peerClient.getSfuResource(),ue=this.latestPubAttemptNum-1,me=performance.now()-this.startConnectingTimestamp,ce=this.peerClient.getActionMeasurements();this.attemptTracker.trackPublishStarted({sfuResource:K,totalDurationWithRetries:me,retryTimes:ue,peerClientPerfStats:ce,protocol:this.peerClient.getProtocol()}),this.latestPubAttemptNum=0}catch(K){this.logger.error({msg:"publish failed!",err:K});const ue=this.attemptTracker.trackPublishFailed(K,this.peerClient.getProtocol()),me=ue.code===Jt.OPERATION_ABORTED.code,ce=ue.fatal,de=this.latestPubAttemptNum===4;if(me)return;if(ce||de)return this.logger.error({msg:`Stopping attempts: isFatal=${ce}, isLastAttempt=${de}`,err:K}),this.updateState($o.ERRORED),void this.emit(Rl.ERROR,ue);const we=1e3*Math.pow(2,this.latestPubAttemptNum);this.logger.debug({msg:`attempt failed, retrying in ${we}ms`}),this.nextAttemptTimerId=window.setTimeout((()=>{this.tryPublish()}),we)}}})),this.publish=(V,K)=>Yr(this,void 0,void 0,(function*(){this.peerClient.initStreamsToPublish(V),yield this.peerClient.connect({audioOnly:!1,traceId:K})})),this.unpublish=(V=!1)=>Yr(this,void 0,void 0,(function*(){if(window.clearTimeout(this.nextAttemptTimerId),this.publicationState===$o.DISCONNECTED||this.publicationState===$o.ERRORED||!this.attemptTracker)return;this.attemptTracker.trackUnpublish();const K=V?Sr.UNLOAD:Sr.UNPUBLISH,ue=this.peerClient.getProtocol();try{V?this.peerClient.disconnect(V):yield this.peerClient.disconnect(V),this.attemptTracker.trackEndSucceeded(K,ue)}catch{this.attemptTracker.trackEndFailed(K,ue)}})),this.replaceOrUpdateStream=V=>Yr(this,void 0,void 0,(function*(){this.streamsToPublish.find((K=>K.track.kind===V.track.kind))?this.streamsToPublish=this.streamsToPublish.map((K=>K.track.kind===V.track.kind?V:K)):this.streamsToPublish.push(V),yield this.peerClient.replaceOrUpdateStream(V)})),this.onPeerClientConnectionStateChange=V=>{this.logger.debug({msg:`onPeerClientConnectionStateChange: ${V}`,state:V}),this.processStateUpdate(V)},this.onPeerClientTransformError=V=>{this.emit(Rl.TRANSFORM_ERROR,V)},this.onIncompatibleCodecs=V=>Yr(this,void 0,void 0,(function*(){yield this.peerClient.onIncompatibleCodecs(V)})),this.sendSeiMessage=(V,K)=>{if(this.publicationState!==$o.CONNECTED)return this.attemptTracker&&this.emit(Rl.ERROR,this.attemptTracker.createSeiNotPublishingVideoError()),xn.err(ca.NOT_PUBLISHING_VIDEO);const ue=this.peerClient.sendSeiMessage(V,K),me=xn.getErr(ue);return me&&this.attemptTracker&&(me===ca.INBAND_MESSAGING_NOT_ENABLED?this.emit(Rl.ERROR,this.attemptTracker.createSeiInBandMessagingNotEnabledError()):me===ca.NOT_PUBLISHING_VIDEO&&this.emit(Rl.ERROR,this.attemptTracker.createSeiNotPublishingVideoError())),ue},this.peerClient=new m0(E,this.nonScopedLogger,this.action,Lo(this.action),Ns(),this.analyticsTracker,void 0,A,void 0),this.logger=new Ka(O,oe.PUBLICATION),this.peerClient.on(qc,this.onPeerClientConnectionStateChange),this.peerClient.on(Ec,this.onPeerClientTransformError),this.publishTracker=new ES(this.analyticsTracker,this.token)}removeTrack(E){return Yr(this,void 0,void 0,(function*(){this.streamsToPublish=this.streamsToPublish.filter((A=>A.track.kind!==E)),yield this.peerClient.removeTrack(E)}))}}var ar,Ei=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};class us extends zo{constructor(E,A,O,F,V){super(E,new Ka(O,oe.LOCAL_PARTICIPANT)),this.onPublicationStateChange=K=>{switch(this.logger.debug({msg:"publicationStateChange",state:K}),K){case"connected":this.connection.setStagePublishing(!0),this.updatePublishState(jn.PUBLISHED);break;case"connecting":this.updatePublishState(jn.ATTEMPTING_PUBLISH);break;case"errored":this.updatePublishState(jn.ERRORED),this.connection.setStagePublishing(!1);break;default:return void this.logger.warn({msg:"FIXME onPublicationStateChange UNHANDLED STATE",state:K})}},this.onPublicationError=K=>{this.emit(ou.ERROR,K)},this.updatePublishState=K=>{this.info.isPublishing=K===jn.PUBLISHED,this.publishState=K,this.emit(ou.PUBLICATION_STATE_CHANGE,this.publishState)},this.handleMute=K=>{K.streamType===Tr.AUDIO&&(this.audioMuted=K.isMuted,this.info.audioMuted=K.isMuted),K.streamType===Tr.VIDEO&&(this.videoStopped=K.isMuted,this.info.videoStopped=K.isMuted),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.emit(ou.MEDIA_STREAM_MUTE_CHANGED,K)},this.handleInsertSeiMsgRequest=(K,ue,me)=>{this.sendSeiMessage(ue,me?.repeatCount)},this.publish=K=>{this.logger.debug({msg:"publish"}),K.forEach((me=>{me&&(this.setupStreamListeners(me),me.streamType===Tr.AUDIO?(this.audioStream=me,this.audioMuted=!me.mediaStreamTrack.enabled,this.info.audioMuted=this.audioMuted):me.streamType===Tr.VIDEO&&(this.videoStream=me,this.videoStopped=!me.mediaStreamTrack.enabled,this.info.videoStopped=this.videoStopped),me.setGetStats(this.publication.requestRTCStats))})),this.connection.emitStageState(this.audioMuted,this.videoStopped);const ue=K.map((me=>tu(me)));this.publication.start(ue)},this.cleanup=()=>this.removeAllListeners(),this.quickUnpublish=()=>this.publishState!==jn.NOT_PUBLISHED&&this.publishState!==jn.ERRORED&&void this.publication.stop(!0),this.onIncompatibleCodecs=K=>Ei(this,void 0,void 0,(function*(){yield this.publication.onIncompatibleCodecs(K)})),this.sendSeiMessage=(K,ue=0)=>this.publication.sendSeiMessage(K,ue),this.sendSeiMessageString=(K,ue=0)=>{const me=new TextEncoder().encode(K);return this.publication.sendSeiMessage(me,ue)},this.connection=F,this.createPublication=()=>{const K=new ws(A,F,O,V);return K.on(Rl.STATE_CHANGE,this.onPublicationStateChange),K.on(Rl.ERROR,this.onPublicationError),K.on(Rl.TRANSFORM_ERROR,this.onPublicationError),K},this.publication=this.createPublication()}setupStreamListeners(E){E.on(gr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),E.streamType===Tr.VIDEO&&E.on(gr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleInsertSeiMsgRequest)}removeTrack(E){var A,O,F;E.streamType===Tr.AUDIO?((A=this.audioStream)===null||A===void 0||A.off(gr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),this.audioStream=void 0,this.audioMuted=!0,this.info.audioMuted=!0):E.streamType===Tr.VIDEO&&((O=this.videoStream)===null||O===void 0||O.off(gr.LOCAL_STREAM_MUTE_CHANGED,this.handleMute),(F=this.videoStream)===null||F===void 0||F.off(gr.LOCAL_STREAM_INSERT_SEI_MSG_REQUEST,this.handleMute),this.videoStream=void 0,this.videoStopped=!0,this.info.videoStopped=!0),this.connection.emitStageState(this.audioMuted,this.videoStopped),this.publication.removeTrack(E.streamType)}replaceOrAddTrack(E){return Ei(this,void 0,void 0,(function*(){this.setupStreamListeners(E),E.setGetStats(this.publication.requestRTCStats),E.streamType===Tr.AUDIO?(this.audioStream=E,this.audioMuted=!E.mediaStreamTrack.enabled):E.streamType===Tr.VIDEO&&(this.videoStream=E,this.videoStopped=!E.mediaStreamTrack.enabled),this.connection.emitStageState(this.audioMuted,this.videoStopped);const A=tu(E);yield this.publication.replaceOrUpdateStream(A)}))}unpublish(){if(this.publishState===jn.NOT_PUBLISHED||this.publishState===jn.ERRORED)return;this.logger.debug({msg:"unpublish"}),this.connection.setStagePublishing(!1),this.publication.stop(),this.publication.off(Rl.STATE_CHANGE,this.onPublicationStateChange),this.publication.off(Rl.ERROR,this.onPublicationError),this.publication.off(Rl.TRANSFORM_ERROR,this.onPublicationError);const E=[this.audioStream,this.videoStream].filter((A=>!!A));E.forEach((A=>{A.cleanup()})),this.audioStream=void 0,this.videoStream=void 0,this.emit(ou.MEDIA_STREAM_REMOVED,E),this.updatePublishState(jn.NOT_PUBLISHED),this.publication=this.createPublication()}}(function(M){M.STAGE_CONNECTION_STATE_CHANGED="stageConnectionStateChanged",M.STAGE_PARTICIPANT_JOINED="stageParticipantJoined",M.STAGE_PARTICIPANT_LEFT="stageParticipantLeft",M.STAGE_PARTICIPANT_STREAMS_ADDED="stageParticipantStreamsAdded",M.STAGE_PARTICIPANT_STREAMS_REMOVED="stageParticipantStreamsRemoved",M.STAGE_STREAM_MUTE_CHANGED="stageStreamMuteChanged",M.STAGE_STREAM_SEI_MESSAGE_RECEIVED="stageStreamSeiMessageReceived",M.STAGE_STREAM_LAYERS_CHANGED="stageStreamLayersChanged",M.STAGE_STREAM_LAYER_SELECTED="stageStreamLayerSelected",M.STAGE_STREAM_ADAPTION_CHANGED="stageStreamAdaptionChanged",M.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED="stageParticipantSubscribeStateChanged",M.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED="stageParticipantPublishStateChanged",M.ERROR="error",M.STAGE_LEFT="stageLeft"})(ar||(ar={}));var rc=function(M,E,A,O){return new(A||(A=Promise))((function(F,V){function K(ce){try{me(O.next(ce))}catch(de){V(de)}}function ue(ce){try{me(O.throw(ce))}catch(de){V(de)}}function me(ce){var de;ce.done?F(ce.value):(de=ce.value,de instanceof A?de:new A((function(we){we(de)}))).then(K,ue)}me((O=O.apply(M,[])).next())}))};const qd=M=>!!M;class ov extends Da{constructor(E,A){super(),this.connectionState=Ni.DISCONNECTED,this.participants=new Map,this.connectionStateErrored=!1,this.onConnectionStateChanged=(V,K)=>{var ue,me;if(this.connectionState=V,V===Ni.ERRORED&&(this.connectionStateErrored=!0),V===Ni.CONNECTED&&this.localParticipant&&this.localParticipant.publishState!==jn.NOT_PUBLISHED&&this.stageConnection.emitStageState((ue=this.localParticipant)===null||ue===void 0?void 0:ue.audioMuted,(me=this.localParticipant)===null||me===void 0?void 0:me.videoStopped),V===Ni.CONNECTED&&this.connectionStateErrored&&(this.connectionStateErrored=!1,this.refreshStrategy()),V===Ni.DISCONNECTED){if(K&&K!==nc.CLIENT_RECONNECT&&K!==nc.USER_INITIATED){let ce=am.UNKNOWN;(function(de){return Object.values(am).includes(de)})(K)?ce=K:this.logger.warn({msg:`DISCONNECTED reason is not a StageLeftReason: ${K}`}),this.cleanup(ce)}}else this.emit(ar.STAGE_CONNECTION_STATE_CHANGED,this.connectionState)},this.setupLocalParticipantOnce=()=>{var V;this.localParticipant?this.analyticsTracker.trackEventNoSharedProps(new Ba(this.token,(V=this.joinTraceId)!==null&&V!==void 0?V:new Za,"reusing local participant from repeat join",Qt.JOIN,"")):this.createLocalParticipant()},this.createLocalParticipant=()=>{const V=(function(K){var ue,me;const ce=new Set;return K.token.claims.capabilities.allow_publish&&ce.add(tr.PUBLISH),K.token.claims.capabilities.allow_subscribe&&ce.add(tr.SUBSCRIBE),{id:K.token.participantID,userId:(ue=K.token.userID)!==null&&ue!==void 0?ue:"",attributes:(me=K.token.claims.attributes)!==null&&me!==void 0?me:{},capabilities:ce,isLocal:!0,userInfo:{},videoStopped:K.videoStopped,audioMuted:K.audioMuted,isPublishing:K.isPublishing}})({token:this.token,videoStopped:!0,audioMuted:!0,isPublishing:!1});this.localParticipant=new us(V,this.token,this.logger.unwrap(),this.stageConnection,this.analyticsTracker),this.localParticipant.on(ou.PUBLICATION_STATE_CHANGE,(K=>{this.onPublishStateChanged(this.localParticipant.info,K)})),this.localParticipant.on(ou.MEDIA_STREAM_REMOVED,this.onLocalStreamsRemoved),this.localParticipant.on(ou.MEDIA_STREAM_MUTE_CHANGED,(K=>{this.localParticipant?this.onStreamMuteChange(this.localParticipant.info,K):this.logger.warn({msg:"tried to emit a stream mute change event for undefined local participant"})})),this.localParticipant.on(ou.ERROR,(K=>{this.errorManager.handleError(K,Z.PUBLISH_ERROR)})),this.emit(ar.STAGE_PARTICIPANT_JOINED,V)},this.onRemoteParticipantJoined=V=>{if(V.id===this.token.participantID)return;const K=(function(de){return{id:de.id,userId:de.userId,attributes:de.attributes,capabilities:new Set([tr.SUBSCRIBE]),isLocal:!1,userInfo:{},videoStopped:de.videoStopped,audioMuted:de.audioMuted,isPublishing:de.isPublishing}})(V);if(this.participants.has(K.id))return void this.logger.warn({msg:"Remote participant already tracked"});let ue=Gs.NONE;K.capabilities.has(tr.SUBSCRIBE)&&(ue=xn.getOk_or(this.strategyWrapper.shouldSubscribeToParticipant(K),ue),this.updateManagerWithExternalSubscribeConfig(K,"joined"));const me=this.configManager.getSubscribeConfigSnapshot(K.id),ce=new Wd(K,this.token,this.stageConnection,this.logger.unwrap(),ue,me,this.analyticsTracker,V.isPublishing);this.participants.set(K.id,ce),this.setupRemoteParticipantListeners(ce),this.emit(ar.STAGE_PARTICIPANT_JOINED,ce.info),ce.updateSubscribeStateIfNecessary(ue)},this.setupRemoteParticipantListeners=V=>{V.on(ls.SUBSCRIPTION_STATE_CHANGE,(K=>{this.onParticipantSubscribeStateChanged(V.info.id,K)})),V.on(ls.MEDIA_STREAM_ADDED,(K=>{const ue=this.participants.get(V.info.id);if(ue){for(const me of K)this.setupRemoteParticipantStreamEvents(ue.info,me);this.emit(ar.STAGE_PARTICIPANT_STREAMS_ADDED,ue.info,$i(K)),this.updateStreamLayerForParticipantInfo(V.info,V.streams)}else this.logger.warn({msg:"Got stream add for participant no longer being tracked"})})),V.on(ls.MEDIA_STREAM_REMOVED,(K=>{const ue=this.participants.get(V.info.id);ue?this.emit(ar.STAGE_PARTICIPANT_STREAMS_REMOVED,ue.info,$i(K)):this.logger.warn({msg:"Got stream remove for participant no longer being tracked"})})),V.on(ls.MEDIA_STREAM_MUTE_CHANGED,(K=>{this.onStreamMuteChange(V.info,K.remote)})),V.on(ls.ERROR,(K=>{this.errorManager.handleError(K,Z.SUBSCRIBE_ERROR)})),V.on(ls.MEDIA_STREAM_SEI_MESSAGE_RECEIVED,(K=>{this.onSeiMessageReceived(V.info,K)}))},this.onRemoteParticipantLeft=V=>{if(this.connectionState!==Ni.CONNECTED)return;const K=this.participants.get(V);K?(K.participantLeave(),K.unsubscribe(),K.cleanup(),this.participants.delete(V),this.emitParticipantLeave(K.info)):this.logger.warn({msg:"Remote participant no longer tracked"})},this.emitParticipantLeave=V=>{this.emit(ar.STAGE_PARTICIPANT_LEFT,V)},this.onRemoteParticipantStateChanged=V=>{const K=this.participants.get(V.id);if(!K)return void this.logger.warn({msg:"Remote participant updated but not tracked"});K.updatePublishState(V.isPublishing)&&this.onPublishStateChanged(K.info,K.publishState),K.updateStreamState(V.audioMuted,V.videoStopped);const ue=this.strategyWrapper.shouldSubscribeToParticipant(K.info);if(xn.isNotOk(ue))return;this.updateManagerWithExternalSubscribeConfig(K.info,"updated");const me=this.configManager.getSubscribeConfigSnapshot(K.info.id),ce=xn.getOk_or(ue,Gs.NONE);K.updateSubscribeStateIfNecessary(ce,me)},this.onPublishStateChanged=(V,K)=>{this.emit(ar.STAGE_PARTICIPANT_PUBLISH_STATE_CHANGED,V,K)},this.onParticipantSubscribeStateChanged=(V,K)=>{const ue=this.participants.get(V);ue?this.emit(ar.STAGE_PARTICIPANT_SUBSCRIBE_STATE_CHANGED,ue.info,K):this.logger.warn({msg:"Remote participant subscribe state changed but not tracked"})},this.onLocalStreamsAdded=V=>{this.localParticipant&&this.emit(ar.STAGE_PARTICIPANT_STREAMS_ADDED,this.localParticipant.info,V)},this.onLocalStreamsRemoved=V=>{this.localParticipant&&this.emit(ar.STAGE_PARTICIPANT_STREAMS_REMOVED,this.localParticipant.info,V)},this.onStreamMuteChange=(V,K)=>{this.emit(ar.STAGE_STREAM_MUTE_CHANGED,V,K)},this.onSeiMessageReceived=(V,K)=>{this.emit(ar.STAGE_STREAM_SEI_MESSAGE_RECEIVED,V,K)},this.leave=()=>{this.cleanup(am.USER_INITIATED)},this.onBeforeUnloadCleanup=()=>{var V;this.participants.forEach((K=>{K.quickUnsubscribe()})),(V=this.localParticipant)===null||V===void 0||V.quickUnpublish(),this.stageConnection.disconnect(),this.emit(ar.STAGE_CONNECTION_STATE_CHANGED,Ni.DISCONNECTED),this.analyticsTracker.stop(!0)},this.cleanup=V=>{if(!this.localParticipant)return;this.analyticsTracker.trackEventNoSharedProps(new Hg({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId,reason:V})),this.localParticipant.unpublish(),this.localParticipant.cleanup();const K=this.localParticipant.info;this.localParticipant=void 0,this.emitParticipantLeave(K);const ue=this.participants.entries();for(const[me,ce]of ue)ce.unsubscribe(),this.participants.delete(me),ce.cleanup(),this.emitParticipantLeave(ce.info);zf.destroy(this.analyticsTracker.getSessionId()),this.stageConnection.disconnect(),this.emit(ar.STAGE_CONNECTION_STATE_CHANGED,Ni.DISCONNECTED),this.emit(ar.STAGE_LEFT,V),this.analyticsTracker.stop(!1),window.removeEventListener("beforeunload",this.onBeforeUnloadCleanup)},this.refreshStrategy=()=>{this.participants.forEach((V=>{if(V.info.capabilities.has(tr.SUBSCRIBE)){const K=this.strategyWrapper.shouldSubscribeToParticipant(V.info);if(xn.isNotOk(K))return;const ue=xn.getOk_or(K,Gs.NONE);this.updateManagerWithExternalSubscribeConfig(V.info,"updated");const me=this.configManager.getSubscribeConfigSnapshot(V.info.id);V.updateSubscribeStateIfNecessary(ue,me),this.updateStreamLayerForParticipantInfo(V.info,V.streams)}})),this.updateStreamsToPublishIfNecessary()},this.updateManagerWithExternalSubscribeConfig=(V,K)=>{var ue;const me=xn.getOk(this.strategyWrapper.subscribeConfiguration(V)),ce=xn.getOk(this.getRemoteSubscribeConfiguration()),de=this.getInternalSubscribeOverrides(),we=V.id;let Me=!1;me&&(Me=this.configManager.handleExternalSubscribeConfigUpdate(we,me,Wt.API));let nt=!1;ce&&(nt=this.configManager.handleSubscribeConfigUpdate(we,ce,Wt.REMOTE));let bt=!1;if(de&&(bt=this.configManager.handleSubscribeConfigUpdate(we,de,Wt.INTERNAL)),Me||bt||nt){const ut=this.configManager.getSubscribeConfigSnapshot(we);this.analyticsTracker.trackEventNoSharedProps(new Es(this.token,(ue=this.joinTraceId)!==null&&ue!==void 0?ue:Ns(),K==="joined"?"initial":"ad-hoc",we,ut))}},this.getRemoteSubscribeConfiguration=()=>{const V=Do.getRemoteSubscribeConfig({customerId:this.token.customerId,sessionId:this.analyticsTracker.getSessionId()});return V?xn.ok(V):xn.err("No payload found")},this.updateStreamsToPublishIfNecessary=()=>{var V;if(!this.localParticipant||!(!((V=this.localParticipant)===null||V===void 0)&&V.info.capabilities.has(tr.PUBLISH)))return;const K=this.localParticipant.publishState!==jn.NOT_PUBLISHED&&this.localParticipant.publishState!==jn.ERRORED,ue=this.strategyWrapper.shouldPublishParticipant(this.localParticipant.info);if(xn.isNotOk(ue))return;let me=xn.getOk_or(ue,!1);if(!K&&!me)return;if(K&&!me)return void this.localParticipant.unpublish();const ce=this.strategyWrapper.stageStreamsToPublish();if(xn.isNotOk(ce)){const we=xn.getErr(ce);if(we instanceof Error&&we.cause==="UserStrategy")throw we;return}const de=xn.getOk_or(ce,[]);me=me&&de.length>0,!K&&me?(this.localParticipant.publish(de),this.onLocalStreamsAdded(de)):this.syncTracksToPublish(de)},this.syncTracksToPublish=V=>{var K;if(!this.localParticipant)return;const ue=this.localParticipant.audioStream,me=this.localParticipant.videoStream,{updates:ce,streamsToAdd:de,streamsToRemove:we}=this.determineStreamUpdates(ue,me,V);if(ce.length){for(const Me of ce)Me.newStream?(K=this.localParticipant)===null||K===void 0||K.replaceOrAddTrack(Me.newStream):Me.oldStream&&this.localParticipant.removeTrack(Me.oldStream);we.length!==0&&this.onLocalStreamsRemoved(we),de.length!==0&&this.onLocalStreamsAdded(de)}},this.determineStreamUpdates=(V,K,ue=[])=>{const me=[],ce=ue.slice(0,2);if(ce.sort(((Me,nt)=>Me.streamType===Tr.AUDIO?-1:1)),ce.length===0)V&&me.push({oldStream:V}),K&&me.push({oldStream:K});else if(ce.length===1){const Me=ce[0];Me.streamType===Tr.AUDIO?K&&me.push({oldStream:K}):Me.streamType===Tr.VIDEO&&V&&me.push({oldStream:V})}ce.forEach((Me=>{var nt,bt;Me.streamType===Tr.AUDIO?V?V.id===Me.id&&(0,zi.isEqual)(V.mediaConfig,Me.mediaConfig)||(!!(!((nt=V.mediaConfig)===null||nt===void 0)&&nt.stereo)!=!!(!((bt=Me.mediaConfig)===null||bt===void 0)&&bt.stereo)&&this.logger.warn({msg:"Ignoring change to audio stream's stereo configuration. Re-publish to change stereo configuraiton."}),me.push({oldStream:V,newStream:Me})):me.push({newStream:Me}):Me.streamType===Tr.VIDEO&&(K?K.id===Me.id&&(0,zi.isEqual)(K.mediaConfig,Me.mediaConfig)||me.push({oldStream:K,newStream:Me}):me.push({newStream:Me}))}));const de=me.map((Me=>Me.newStream)).filter(qd),we=me.map((Me=>Me.oldStream)).filter(qd);return{updates:me,streamsToAdd:de,streamsToRemove:we}},this.onReassignmentMessage=V=>rc(this,void 0,void 0,(function*(){if(Gc("disableReassignments"))return void this.logger.debug({msg:"REASSIGN message ignored: disableReassignments is configured"});if(!Kh.browser.isChrome())return void this.logger.debug({msg:"REASSIGN message ignored: browser is not chrome"});const K=Ns();this.trackReassignmentRequest(V,K);const ue=this.participants.get(V.remoteParticipantId),me=this.token.participantID,ce=(function(de,{localParticipantId:we,remoteParticipant:Me}){const{participantId:nt}=de;if(we!==nt)return xn.err(Object.assign(Object.assign({},Jt.REASSIGNMENT_REQUEST_INVALID_LOCAL_PARTICIPANT_ID),{details:`Invalid participantId received: ${nt}`}));if(!Me)return xn.err(Object.assign(Object.assign({},Jt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PARTICIPANT_ID),{details:`Invalid remoteParticipantId received: ${Me}`}));if(Me.isReassigning())return xn.err(Jt.REASSIGNMENT_REQUEST_ALREADY_IN_PROGRESS);const bt=Me.subscription.peerClient.getConnectionState();return[hr.CONNECTED,hr.DISCONNECTED].includes(bt)?xn.ok(Me):xn.err(Object.assign(Object.assign({},Jt.REASSIGNMENT_REQUEST_INVALID_REMOTE_PEER_CONNECTION_STATE),{details:`connectionState: ${bt}`}))})(V,{localParticipantId:me,remoteParticipant:ue});if(!ce.ok)this.trackReassignmentRequestRejected(ce.error,K);else try{const{token:de,nodeOverride:we}=V;yield ce.value.triggerIceRestart({assignmentToken:de,traceId:K,nodeOverride:we})}catch(de){this.logger.error({msg:"Reassignment failed.",err:de})}})),this.onIncompatibleCodecsMessage=V=>rc(this,void 0,void 0,(function*(){var K;yield(K=this.localParticipant)===null||K===void 0?void 0:K.onIncompatibleCodecs(V.codecs)})),this.analyticsTracker=new La;const O=v_();this.logger=new Ka(new ta(O),oe.STAGE),this.strategyWrapper=new cs(A,this.logger),this.configManager=new pn({logger:this.logger.unwrap(),subscribeDefaults:{jitterBuffer:{minDelayWhenPublishing:Ms.DEFAULT,minDelayWhenSubscribeOnly:Ms.DEFAULT},inBandMessaging:{enabled:!1},simulcast:{initialLayerPreference:Sa.LOWEST_QUALITY,layerPollingEnabled:!0,layerPollingIntervalMs:3e3}}}),this.errorManager=new Gn(this.logger.unwrap());try{this.token=Qp(E,this.analyticsTracker)}catch(V){const K=new Rr(Object.assign({action:Qt.JOIN,token:E,traceId:Ns(),tag:na,location:"Stage.constructor"},Jt.MALFORMED_TOKEN));throw V instanceof Error&&(K.details=V.message),this.errorManager.handleError(K,Z.JOIN_ERROR)||V}const F={customerId:this.token.customerId,sessionId:this.analyticsTracker.getSessionId()};Do.cacheRealTimeContext(F),Do.resolveExperimentsForRealTimeContext(F),this.stageConnection=new tv(this.token,this.logger.unwrap(),this.analyticsTracker),this.setupListeners()}setupListeners(){this.stageConnection.on(Dd,((E,A)=>{this.onConnectionStateChanged(E,A)})),this.stageConnection.on(Ua,(E=>{this.onRemoteParticipantJoined(E)})),this.stageConnection.on(Zc,(E=>{this.onRemoteParticipantLeft(E.id)})),this.stageConnection.on(Pf,(E=>{var A;E.id!==((A=this.localParticipant)===null||A===void 0?void 0:A.info.id)&&this.onRemoteParticipantStateChanged(E)})),this.stageConnection.on(j_,(E=>rc(this,void 0,void 0,(function*(){yield this.onReassignmentMessage(E)})))),this.stageConnection.on(Zs,(E=>rc(this,void 0,void 0,(function*(){yield this.onIncompatibleCodecsMessage(E)})))),this.stageConnection.on(qg,(E=>{E instanceof Rr&&this.analyticsTracker.trackError(E),this.errorManager.handleError(E,Z.JOIN_ERROR)})),this.errorManager.on(kt.ERROR,(E=>{this.emit(ar.ERROR,E)}))}setupRemoteParticipantStreamEvents(E,A){const O=A.remote;A.on(mn.ADAPTION_CHANGED,(F=>{this.emit(ar.STAGE_STREAM_ADAPTION_CHANGED,E,O,F)})),A.on(mn.LAYERS_CHANGED,(F=>{this.emit(ar.STAGE_STREAM_LAYERS_CHANGED,E,O,F),this.updateStreamLayerForParticipantInfo(E,[A])})),A.on(mn.LAYER_SELECTED,((F,V)=>{this.emit(ar.STAGE_STREAM_LAYER_SELECTED,E,O,F,V)})),A.layers.length>0&&(this.emit(ar.STAGE_STREAM_LAYERS_CHANGED,E,O,O.getLayers()),this.emit(ar.STAGE_STREAM_LAYER_SELECTED,E,O,O.getSelectedLayer(),Rn.SELECTED))}join(){return rc(this,void 0,void 0,(function*(){Do.markSdkUsage(),this.analyticsTracker.start(),this.joinTraceId=Ns(),this.analyticsTracker.trackEvent(new d0({token:this.token,eventEndpoint:this.token.eventsURL,whipEndpoint:this.token.whipURL,traceId:this.joinTraceId}));try{this.token.assertTokenIsUnexpired(Ns(),na,"join")}catch(E){throw this.errorManager.handleError(E,Z.JOIN_ERROR)||E}try{this.joinTraceId=yield this.stageConnection.connect(this.joinTraceId),this.connectionState===Ni.CONNECTED&&(this.setupLocalParticipantOnce(),this.updateStreamsToPublishIfNecessary()),window.addEventListener("beforeunload",this.onBeforeUnloadCleanup)}catch(E){throw this.logger.error({err:E,msg:"error joining stage"}),this.errorManager.handleError(E,Z.JOIN_ERROR,!1)||E}}))}replaceStrategy(E){this.strategyWrapper.setStrategy(E),this.refreshStrategy()}getInternalSubscribeOverrides(){const E=this.strategyWrapper.hasStrategy("preferredLayerForStream"),A=this.hasListenersFor(ar.STAGE_STREAM_LAYERS_CHANGED)||this.hasListenersFor(ar.STAGE_STREAM_ADAPTION_CHANGED)||this.hasListenersFor(ar.STAGE_STREAM_LAYER_SELECTED);return{simulcast:{layerPollingEnabled:E||A}}}updateStreamLayerForParticipantInfo(E,A){A.forEach((O=>{if(O.streamType==="audio")return;const F=this.strategyWrapper.preferredLayerForStream(E,O.remote),V=xn.getOk_or(F,void 0);O.setLayer(V)}))}trackReassignmentRequestRejected(E,A){const{token:O}=this,F=new Rr(Object.assign(Object.assign({},E),{token:O,action:Qt.JOIN,traceId:A,tag:Gg,location:"publish"}));this.logger.error({err:F,msg:"Reassignment request rejected."}),this.analyticsTracker.trackError(F)}trackReassignmentRequest(E,A){const{token:O}=this;this.analyticsTracker.trackEvent(new Nn({token:O,traceId:A,targetLocalParticipantId:E.participantId,targetRemoteParticipantId:E.remoteParticipantId}))}}var am;(function(M){M.UNKNOWN="unknown",M.USER_INITIATED="user-initiated",M.TOKEN_REUSED="token-reused",M.PARTICIPANT_DISCONNECTED="participant-disconnected",M.STAGE_DELETED="stage-deleted"})(am||(am={}));const Yd=h})(),s})()))})(ED)),ED.exports}var vKe=_Ke();const fE=wu(vKe);class yKe{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return bKe(e).buffer}}function bKe(n){let e=0;for(const i of n)e+=i.byteLength;const t=new Uint8Array(e);let r=0;for(const i of n){const s=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);t.set(s,r),r+=i.byteLength}return t}function eoe(n){return new SKe(n).unpack()}function toe(n){const e=new EKe,t=e.pack(n);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class SKe{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let r=0,i="",s,o;for(;r<e;)s=t[r],s<160?(o=s,r++):(s^192)<32?(o=(s&31)<<6|t[r+1]&63,r+=2):(s^224)<16?(o=(s&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,r+=3):(o=(s&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63,r+=4),i+=String.fromCodePoint(o);return this.index+=e,i}unpack_array(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){const t={};for(let r=0;r<e;r++){const i=this.unpack();t[i]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(t===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(i-20)+t*2**(i-52);return(r===0?1:-1)*o}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class EKe{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const r=i=>{if(i<t){const s=this.pack(e[i]);return s instanceof Promise?s.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,s=Math.floor(i*2**52),o=2**32,a=t<<31|r+1023<<20|s/o&1048575,c=s%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=s=>{if(s<t.length){const o=t[s];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>i(s+1))}return i(s+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new yKe,this._textEncoder=new TextEncoder}}let noe=!0,roe=!0;function Ow(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseFloat(r[t],10)}function j1(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const u=t(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function xKe(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(noe=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function TKe(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(roe=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function ioe(){if(typeof window=="object"){if(noe)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function $B(n,e){roe&&console.warn(n+" is deprecated, please use "+e+" instead.")}function wKe(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ow(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ow(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ow(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=Ow(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function VG(n){return Object.prototype.toString.call(n)==="[object Object]"}function soe(n){return VG(n)?Object.keys(n).reduce(function(e,t){const r=VG(n[t]),i=r?soe(n[t]):n[t],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[t]:i})},{}):n}function t5(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?t5(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(i=>{t5(n,n.get(i),t)})}))}function HG(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{n.forEach(a=>{a.type===r&&a.trackId===o.id&&t5(n,a,i)})}),i}const GG=ioe;function ooe(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const h=function(f,d){return f?f+d.charAt(0).toUpperCase()+d.slice(1):d==="deviceId"?"sourceId":d};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[h("min",l)]=u.ideal,c.optional.push(f),f={},f[h("max",l)]=u.ideal,c.optional.push(f)):(f[h("",l)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(f,l)]=u[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,h,f){h in u&&!(f in u)&&(u[f]=u[h],delete u[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return t.mediaDevices.enumerateDevices().then(f=>{f=f.filter(p=>p.kind==="videoinput");let d=f.find(p=>h.some(m=>p.label.toLowerCase().includes(m)));return!d&&f.length&&h.includes("back")&&(d=f[f.length-1]),d&&(a.video.deviceId=l.exact?{exact:d.deviceId}:{ideal:d.deviceId}),a.video=r(a.video),GG("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return GG("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,u=>{t.webkitGetUserMedia(u,c,h=>{l&&l(s(h))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function aoe(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function coe(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;n.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else j1(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function loe(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],t.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function uoe(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>HG(o,s.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i}),j1(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>HG(s,i.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function hoe(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function foe(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return hoe(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(h=>this._reverseStreams[h.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(h=>{if(this.getSenders().find(d=>d.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const h=new n.MediaStream(u.getTracks());this._streams[u.id]=h,this._reverseStreams[h.id]=u,u=h}r.apply(this,[u])};const i=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[h.id];if(p)p.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new n.MediaStream([u]);this._streams[h.id]=m,this._reverseStreams[m.id]=h,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function s(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const d=l._reverseStreams[f],p=l._streams[d.id];h=h.replace(new RegExp(p.id,"g"),d.id)}),new RTCSessionDescription({type:u.type,sdp:h})}function o(l,u){let h=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const d=l._reverseStreams[f],p=l._streams[d.id];h=h.replace(new RegExp(d.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const u=n.RTCPeerConnection.prototype[l],h={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[p=>{const m=s(this,p);f[0].apply(null,[m])},p=>{f[1]&&f[1].apply(null,p)},arguments[2]]):u.apply(this,arguments).then(p=>s(this,p))}};n.RTCPeerConnection.prototype[l]=h[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(m=>u.track===m)&&(f=this._streams[d])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function n5(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=i[t]})}function doe(n,e){j1(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}const WG=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:doe,shimAddTrackRemoveTrack:foe,shimAddTrackRemoveTrackWithNative:hoe,shimGetSendersWithDtmf:loe,shimGetUserMedia:ooe,shimMediaStream:aoe,shimOnTrack:coe,shimPeerConnection:n5,shimSenderReceiverGetStats:uoe},Symbol.toStringTag,{value:"Module"}));function poe(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(i,s,o){$B("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function AKe(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function moe(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function r5(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=n.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};n.RTCPeerConnection.prototype[i]=o[i]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,h)=>{c.set(h,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(o,a)}}function goe(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function _oe(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),j1(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function voe(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){$B("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function yoe(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function boe(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function Soe(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Eoe(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function xoe(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const qG=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:boe,shimCreateAnswer:xoe,shimCreateOffer:Eoe,shimGetDisplayMedia:AKe,shimGetParameters:Soe,shimGetUserMedia:poe,shimOnTrack:moe,shimPeerConnection:r5,shimRTCDataChannel:yoe,shimReceiverGetStats:_oe,shimRemoveStream:voe,shimSenderGetStats:goe},Symbol.toStringTag,{value:"Module"}));function Toe(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const i=t.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function woe(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function Aoe(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=t.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f},e.createAnswer=function(l,u){const h=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[h]);return u?(f.then(l,u),Promise.resolve()):f};let a=function(c,l,u){const h=i.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,u){const h=s.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,u){const h=o.apply(this,[c]);return u?(h.then(l,u),Promise.resolve()):h},e.addIceCandidate=a}function Coe(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=i=>r(Roe(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function Roe(n){return n&&n.video!==void 0?Object.assign({},n,{video:soe(n.video)}):n}function koe(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?($B("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Moe(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ioe(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Ooe(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const YG=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Ooe,shimCallbacksAPI:Aoe,shimConstraints:Roe,shimCreateOfferLegacy:Ioe,shimGetUserMedia:Coe,shimLocalStreamsAPI:Toe,shimRTCIceServerUrls:koe,shimRemoteStreamsAPI:woe,shimTrackEventTransceiver:Moe},Symbol.toStringTag,{value:"Module"}));var xD={exports:{}},KG;function CKe(){return KG||(KG=1,(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const i=t.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const s=t.type;return r.push("typ"),r.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const i=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let i;const s=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(t){let r="",i=t.payloadType;if(t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const s=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?s.push(o+"="+t.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",i=t.payloadType;return t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),i={ssrc:parseInt(t.substring(7,r),10)},s=t.indexOf(":",r);return s>-1?(i.attribute=t.substring(r+1,s),i.value=t.substring(s+1)):i.attribute=t.substring(r+1),i},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let i="a=setup:"+r+`\r
`;return t.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const i=e.matchPrefix(t+r,"a=ice-ufrag:")[0],s=e.matchPrefix(t+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),h=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=h.length?e.parseFmtp(h[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(t,r){let i="";i+="m="+t+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(t){const r=[],i=e.parseRtpParameters(t),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(p=>parseInt(p,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),i.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let d={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&l&&(d.rtx={ssrc:l}),r.push(d),s&&(d=JSON.parse(JSON.stringify(d)),d.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(d))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(t,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-2e3*8:h=void 0,r.forEach(f=>{f.maxBitrate=h})),r},e.parseRtcpParameters=function(t){const r={},i=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const i=e.matchPrefix(t,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,r){let i=[];return t.protocol!=="DTLS/SCTP"?i=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,i){let s;const o=r!==void 0?r:2;return t?s=t:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const i=e.splitLines(t);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const i=e.splitLines(t)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(t){const i=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},n.exports=e})(xD)),xD.exports}var Noe=CKe();const XE=wu(Noe),RKe=Xoe({__proto__:null,default:XE},[Noe]);function hM(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=XE.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,j1(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function i5(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||j1(n,"icecandidate",e=>{if(e.candidate){const t=XE.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function fM(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const c=XE.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=XE.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=XE.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=r(arguments[0]),l=i(c),u=s(arguments[0],c);let h;l===0&&u===0?h=Number.POSITIVE_INFINITY:l===0||u===0?h=Math.max(l,u):h=Math.min(l,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return h}}),this._sctp=f}return o.apply(this,arguments)}}function dM(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return e(i,this),i},j1(n,"datachannel",r=>(e(r.channel,r.target),r))}function s5(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function o5(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&i instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return t.apply(this,arguments)}}function pM(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function mM(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return t.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?t.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const kKe=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:o5,shimAddIceCandidateNullOrEmpty:pM,shimConnectionState:s5,shimMaxMessageSize:fM,shimParameterlessSetLocalDescription:mM,shimRTCIceCandidate:hM,shimRTCIceCandidateRelayProtocol:i5,shimSendThrowTypeError:dM},Symbol.toStringTag,{value:"Module"}));function MKe({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=ioe,r=wKe(n),i={browserDetails:r,commonShim:kKe,extractVersion:Ow,disableLog:xKe,disableWarnings:TKe,sdp:RKe};switch(r.browser){case"chrome":if(!WG||!n5||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),i;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),i;t("adapter.js shimming chrome."),i.browserShim=WG,pM(n,r),mM(n),ooe(n,r),aoe(n),n5(n,r),coe(n),foe(n,r),loe(n),uoe(n),doe(n,r),hM(n),i5(n),s5(n),fM(n,r),dM(n),o5(n,r);break;case"firefox":if(!qG||!r5||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox."),i.browserShim=qG,pM(n,r),mM(n),poe(n,r),r5(n,r),moe(n),voe(n),goe(n),_oe(n),yoe(n),boe(n),Soe(n),Eoe(n),xoe(n),hM(n),s5(n),fM(n,r),dM(n);break;case"safari":if(!YG||!e.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari."),i.browserShim=YG,pM(n,r),mM(n),koe(n),Ioe(n),Aoe(n),Toe(n),woe(n),Moe(n),Coe(n),Ooe(n),hM(n),i5(n),fM(n,r),dM(n),o5(n,r);break;default:t("Unsupported browser!");break}return i}const XG=MKe({window:typeof window>"u"?void 0:window});function z1(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}class Poe{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let s=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:s,data:c,total:i};t.push(l),o=a,s++}return this._dataCount++,t}}}function IKe(n){let e=0;for(const i of n)e+=i.byteLength;const t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.byteLength;return t}const TD=XG.default||XG,bw=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const n=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(n)?n==="chrome"?e>=this.minChromeVersion:n==="firefox"?e>=this.minFirefoxVersion:n==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return TD.browserDetails.browser}getVersion(){return TD.browserDetails.version||0}isUnifiedPlanSupported(){const n=this.getBrowser(),e=TD.browserDetails.version||0;if(n==="chrome"&&e<this.minChromeVersion)return!1;if(n==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,r=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),r=!0}catch{}finally{t&&t.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},OKe=n=>!n||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(n),Doe=()=>Math.random().toString(36).slice(2),ZG={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class NKe extends Poe{noop(){}blobToArrayBuffer(e,t){const r=new FileReader;return r.onload=function(i){i.target&&t(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=ZG,this.browser=bw.getBrowser(),this.browserVersion=bw.getVersion(),this.pack=toe,this.unpack=eoe,this.supports=(function(){const t={browser:bw.isBrowserSupported(),webRTC:bw.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let r;try{r=new RTCPeerConnection(ZG),t.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!i.ordered;try{i.binaryType="blob",t.binaryBlob=!bw.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return t})(),this.validateId=OKe,this.randomToken=Doe}}const lh=new NKe,PKe="PeerJS: ";class DKe{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const r=[PKe,...t];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var lr=new DKe,VB={},LKe=Object.prototype.hasOwnProperty,Tu="~";function qA(){}Object.create&&(qA.prototype=Object.create(null),new qA().__proto__||(Tu=!1));function UKe(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Loe(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new UKe(t,r||n,i),o=Tu?Tu+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],s]:n._events[o].push(s):(n._events[o]=s,n._eventsCount++),n}function gM(n,e){--n._eventsCount===0?n._events=new qA:delete n._events[e]}function Gl(){this._events=new qA,this._eventsCount=0}Gl.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)LKe.call(t,r)&&e.push(Tu?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Gl.prototype.listeners=function(e){var t=Tu?Tu+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o};Gl.prototype.listenerCount=function(e){var t=Tu?Tu+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Gl.prototype.emit=function(e,t,r,i,s,o){var a=Tu?Tu+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,h;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,s),!0;case 6:return c.fn.call(c.context,t,r,i,s,o),!0}for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];c.fn.apply(c.context,u)}else{var f=c.length,d;for(h=0;h<f;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),l){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,r);break;case 4:c[h].fn.call(c[h].context,t,r,i);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c[h].fn.apply(c[h].context,u)}}return!0};Gl.prototype.on=function(e,t,r){return Loe(this,e,t,r,!1)};Gl.prototype.once=function(e,t,r){return Loe(this,e,t,r,!0)};Gl.prototype.removeListener=function(e,t,r,i){var s=Tu?Tu+e:e;if(!this._events[s])return this;if(!t)return gM(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!r||o.context===r)&&gM(this,s);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||i&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[s]=c.length===1?c[0]:c:gM(this,s)}return this};Gl.prototype.removeAllListeners=function(e){var t;return e?(t=Tu?Tu+e:e,this._events[t]&&gM(this,t)):(this._events=new qA,this._eventsCount=0),this};Gl.prototype.off=Gl.prototype.removeListener;Gl.prototype.addListener=Gl.prototype.on;Gl.prefixed=Tu;Gl.EventEmitter=Gl;VB=Gl;var $1={};z1($1,"ConnectionType",()=>Fv);z1($1,"PeerErrorType",()=>Va);z1($1,"BaseConnectionErrorType",()=>a5);z1($1,"DataConnectionErrorType",()=>HB);z1($1,"SerializationType",()=>V3);z1($1,"SocketEventType",()=>Nv);z1($1,"ServerMessageType",()=>Ll);var Fv=(function(n){return n.Data="data",n.Media="media",n})({}),Va=(function(n){return n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc",n})({}),a5=(function(n){return n.NegotiationFailed="negotiation-failed",n.ConnectionClosed="connection-closed",n})({}),HB=(function(n){return n.NotOpenYet="not-open-yet",n.MessageToBig="message-too-big",n})({}),V3=(function(n){return n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json",n.None="raw",n})({}),Nv=(function(n){return n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close",n})({}),Ll=(function(n){return n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE",n})({});const Uoe="1.5.5";class BKe extends VB.EventEmitter{constructor(e,t,r,i,s,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+t+":"+r+i+"peerjs?key="+s}start(e,t){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+Uoe),this._disconnected=!1,this._socket.onmessage=i=>{let s;try{s=JSON.parse(i.data),lr.log("Server message received:",s)}catch{lr.log("Invalid server message",i.data);return}this.emit(Nv.Message,s)},this._socket.onclose=i=>{this._disconnected||(lr.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(Nv.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),lr.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){lr.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:Ll.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Nv.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class Boe{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Fv.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const r=this.connection,i={ordered:!!e.reliable},s=t.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){lr.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;lr.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(lr.log(`Received ICE candidates for ${t}:`,o.candidate),s.socket.send({type:Ll.Candidate,payload:{candidate:o.candidate,type:i,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":lr.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(a5.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":lr.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(a5.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":lr.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},lr.log("Listening for data channel"),e.ondatachannel=o=>{lr.log("Received data channel");const a=o.channel;s.getConnection(t,r)._initializeDataChannel(a)},lr.log("Listening for remote stream"),e.ontrack=o=>{lr.log("Received remote stream");const a=o.streams[0],c=s.getConnection(t,r);if(c.type===Fv.Media){const l=c;this._addStreamToMediaConnection(a,l)}}}cleanup(){lr.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(t||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);lr.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),lr.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Fv.Data){const s=this.connection;i={...i,label:s.label,reliable:s.reliable,serialization:s.serialization}}t.socket.send({type:Ll.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(Va.WebRTC,i),lr.log("Failed to setLocalDescription, ",i))}}catch(r){t.emitError(Va.WebRTC,r),lr.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createAnswer();lr.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),lr.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:Ll.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){t.emitError(Va.WebRTC,i),lr.log("Failed to setLocalDescription, ",i)}}catch(r){t.emitError(Va.WebRTC,r),lr.log("Failed to create answer, ",r)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const r=this.connection.peerConnection,i=this.connection.provider;lr.log("Setting remote description",t);const s=this;try{await r.setRemoteDescription(t),lr.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await s._makeAnswer()}catch(o){i.emitError(Va.WebRTC,o),lr.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){lr.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),lr.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(Va.WebRTC,t),lr.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(lr.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return lr.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){lr.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class Foe extends VB.EventEmitter{emitError(e,t){lr.error("Error:",t),this.emit("error",new FKe(`${e}`,t))}}class FKe extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class joe extends Foe{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}class JI extends joe{static#e=this.ID_PREFIX="mc_";get type(){return Fv.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||JI.ID_PREFIX+lh.randomToken(),this._negotiator=new Boe(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{lr.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{lr.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){lr.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,r=e.payload;switch(e.type){case Ll.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case Ll.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:lr.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){lr.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class jKe{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:r,port:i,path:s,key:o}=this._options,a=new URL(`${t}://${r}:${i}${s}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",Uoe),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){lr.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==lh.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===lh.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw lr.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}class QI extends joe{static#e=this.ID_PREFIX="dc_";static#t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return Fv.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||QI.ID_PREFIX+Doe(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new Boe(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{lr.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{lr.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{lr.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(HB.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case Ll.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case Ll.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:lr.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}}class GB extends QI{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>QI.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return lr.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class wD extends GB{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new Poe,this.serialization=V3.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=eoe(e),r=t.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];const i=IKe(r.data);this._handleDataMessage({data:i})}}_send(e,t){const r=toe(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);lr.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const r of t)this.send(r,!0)}}class zKe extends GB{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=V3.None}}class $Ke extends GB{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=lh.chunkedMTU){this.emitError(HB.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=V3.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class WB extends Foe{static#e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:zKe,json:$Ke,binary:wD,"binary-utf8":wD,default:wD},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:lh.CLOUD_HOST,port:lh.CLOUD_PORT,path:"/",key:WB.DEFAULT_KEY,token:lh.randomToken(),config:lh.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==lh.CLOUD_HOST?this._options.secure=lh.isSecure():this._options.host==lh.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&lr.setLogFunction(this._options.logFunction),lr.logLevel=this._options.debug||0,this._api=new jKe(t),this._socket=this._createServerConnection(),!lh.supports.audioVideo&&!lh.supports.data){this._delayedAbort(Va.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!lh.validateId(r)){this._delayedAbort(Va.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(Va.ServerError,i))}_createServerConnection(){const e=new BKe(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Nv.Message,t=>{this._handleMessage(t)}),e.on(Nv.Error,t=>{this._abort(Va.SocketError,t)}),e.on(Nv.Disconnected,()=>{this.disconnected||(this.emitError(Va.Network,"Lost connection to server."),this.disconnect())}),e.on(Nv.Close,()=>{this.disconnected||this._abort(Va.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,r=e.payload,i=e.src;switch(t){case Ll.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Ll.Error:this._abort(Va.ServerError,r.msg);break;case Ll.IdTaken:this._abort(Va.UnavailableID,`ID "${this.id}" is taken`);break;case Ll.InvalidKey:this._abort(Va.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Ll.Leave:lr.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case Ll.Expire:this.emitError(Va.PeerUnavailable,`Could not connect to peer ${i}`);break;case Ll.Offer:{const s=r.connectionId;let o=this.getConnection(i,s);if(o&&(o.close(),lr.warn(`Offer received for existing Connection ID:${s}`)),r.type===Fv.Media){const c=new JI(i,this,{connectionId:s,_payload:r,metadata:r.metadata});o=c,this._addConnection(i,o),this.emit("call",c)}else if(r.type===Fv.Data){const c=new this._serializers[r.serialization](i,this,{connectionId:s,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(i,o),this.emit("connection",c)}else{lr.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(s);for(const c of a)o.handleMessage(c);break}default:{if(!r){lr.warn(`You received a malformed message from ${i} of type ${t}`);return}const s=r.connectionId,o=this.getConnection(i,s);o&&o.peerConnection?o.handleMessage(e):s?this._storeMessage(s,e):lr.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){lr.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Va.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){lr.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Va.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){lr.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new JI(e,this,{...r,_stream:t});return this._addConnection(e,i),i}_addConnection(e,t){lr.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===t)return i;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){lr.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(lr.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const r of t)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;lr.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)lr.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)lr.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(Va.ServerError,t))}}var VKe=WB;async function HKe(){return Bee("netid")}async function zoe(n){return Fee("netid",n)}let LE="";function GKe(){return LE}let al;function WKe(){return al?.id===LE}function $oe(n){return zxe(n)}function JG(n){const e=ii();let t;function r(){t=z4(o=>{he(al)&&sHe(o)&&iHe(o)===!1&&n.send(o)})}function i(){t=z4(o=>{he(al)&&$4(o)&&oHe(o)===!1&&n.send(o)}),cxe(qe,e)}function s(){n.open&&(fs(qe,e,`connection ${n.peer} open`),WKe()?r():i())}n.on("open",s),n.on("close",()=>{t?.disconnect(),he(al)&&fs(qe,e,`disconnection from ${n.peer}`)}),n.on("data",o=>{const a=o;he(al)&&t?.forward({...a,session:qe.session()})}),n.on("error",o=>{_r(qe,e,"netterminal",`dataconnection ${n.peer} - ${JSON.stringify(o)}`)}),s()}function Voe(n,e){LE=n,axe(qe,ii(),LE);const t=ii(),r=e??n;al=new VKe(r,{debug:2,host:"terminal.zed.cafe"}),window.addEventListener("unload",()=>{al?.disconnect(),al=void 0}),fs(qe,t,`netterminal for ${r}`),al.on("open",()=>{if(fs(qe,t,"connected to netterminal"),n!==r){fs(qe,t,`joining topic ${LE}`);const i=al?.connect(n,{reliable:!0});he(i)&&JG(i)}else fs(qe,t,`hosting topic ${LE}`)}),al.on("connection",JG),al.on("disconnected",()=>{_r(qe,t,"netterminal","lost connection to netterminal"),setTimeout(()=>{_r(qe,t,"netterminal","retrying the connection to netterminal"),al?.reconnect()},5e3)}),al.on("error",i=>{switch(i.type){case"disconnected":case"peer-unavailable":return;case"invalid-id":case"unavailable-id":oo(qe,t,async()=>{await zoe(()=>"")});return}_r(qe,t,"netterminal",`${al?.id} - ${JSON.stringify(i)}`)})}async function QG(){const n=ii();if(he(al)){fs(qe,n,"netterminal already active");return}let e=await HKe();e=(e??"")||n,await zoe(()=>e??"");const t=$oe(e);Voe(t)}function qKe(n){const e=ii();if(he(al)){fs(qe,e,"netterminal already active");return}const t=$oe(e);Voe(n,t)}let bm,Pl;async function YKe(n,e,t,r,i,s){let o;switch(cr(i)){case"get":{o=await fetch(r);break}case"post:json":{const l=[];for(let u=0;u<s.length;u+=2)l.push([s[u],s[u+1]]);o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(nme(l))});break}}if(!o?.ok)return;const a=`fetch:${t}`,[c]=(o.headers.get("content-type")??"").split(";");switch(c){case"text/plain":{const l=await o.text();Th(qe,n,e,"text",a,l);break}case"application/json":{const l=await o.json();Th(qe,n,e,"json",a,l);break}case"application/octet-stream":{const l=await o.arrayBuffer();Th(qe,n,e,"binary",a,new Uint8Array(l));break}}}function eW(){const n=`${location.origin}/join/#${GKe()}`;return he(da())&&da().writeText(n).catch(e=>console.error(e)),n}function KKe(n){const e=/(?:https?|ftp):\/\/[\n\S]+/g;return n.replace(e,"")}function tW(n){let e=n.text;const t=[...n.emoteOffsets.values()];for(let r=0;r<t.length;++r){const i=t[r].reverse();for(let s=0;s<i.length;++s){const[o,a]=i[s].split("-").map(parseFloat);e=e.substring(0,o)+e.substring(a+1)}}return KKe(e)}const qs=mg("bridge",[],n=>{if(!qs.session(n))return;const e=ii();switch(n.target){default:if(n.player!==e)return;break}switch(n.target){case"fetch":if(sr(n.data)){const[t,r,i,s,o]=n.data;oo(qe,n.player,async()=>{await YKe(n.player,t,r,i,s,o)})}break;case"start":oo(qs,n.player,async()=>{await QG(),kEe(qe,n.player,!!n.data)});break;case"tab":oo(qs,n.player,async()=>{await QG(),REe(qe,n.player)});break;case"tabopen":{const t=eW();window.open(t,"_blank","noopener,noreferrer");break}case"join":un(n.data)&&qKe(n.data);break;case"showjoincode":{const t=eW();n.data?v4(qs,n.player,t,"secret join url",!1):v4(qs,n.player,t,t);break}case"chatstart":he(bm)?_r(qs,n.player,"bridge","chat is already started"):un(n.data)&&(fs(qs,n.player,`connecting to ${n.data}`),bm=new ZI({channels:[n.data]}),bm.connect(),bm.onConnect(()=>{fs(qs,n.player,"connected")}),bm.onDisconnect(()=>{fs(qs,n.player,"disconnected")}),bm.onMessage((t,r,i,s)=>{const o=tW(s);Th(qs,n.player,void 0,"text",`chat:message:${n.data}`,`${r}:${o}`)}),bm.onAction((t,r,i,s)=>{const o=tW(s);Th(qs,n.player,void 0,"text",`chat:action:${n.data}`,`${r}:${o}`)}));break;case"chatstop":he(bm)?(bm.quit(),bm=void 0,fs(qs,n.player,"chat stopped")):_r(qs,n.player,"bridge","chat is already stoped");break;case"streamstart":oo(qs,n.player,async()=>{if(he(Pl))_r(qs,n.player,"bridge","stream is already open");else{const r=window.innerHeight>window.innerWidth?fE.STANDARD_PORTRAIT:fE.STANDARD_LANDSCAPE;Pl=fE.create({streamConfig:{...r,maxFramerate:60}}),Pl.on(fE.BroadcastClientEvents.ACTIVE_STATE_CHANGE,function(o){console.info({activestate:o})}),Pl.on(fE.BroadcastClientEvents.CONNECTION_STATE_CHANGE,function(o){fs(qs,n.player,o)}),Pl.on(fE.BroadcastClientEvents.ERROR,function(o){_r(qs,n.player,"bridge",o),Pl=void 0});const i=document.querySelector("canvas");if(he(i))await Pl.addImageSource(i,"video",{index:1});else{_r(qs,n.player,"video","unabled to find canvas element"),Pl=void 0;return}const s=Kze();if(he(s))await Pl.addAudioInputDevice(s.stream,"audio");else{_r(qs,n.player,"video","unable create media audio node destination"),Pl=void 0;return}fs(qs,n.player,"created client")}un(n.data)&&he(Pl)&&(Hv(qs,n.player,"broadcasting in"),dh(qs,n.player,"3","..."),await mh(1e3),dh(qs,n.player,"2","..."),await mh(1e3),dh(qs,n.player,"1","..."),await mh(1e3),Hv(qs,n.player,"GOING LIVE"),await Pl.startBroadcast(n.data,"https://g.webrtc.live-video.net:4443"))});break;case"streamstop":he(Pl)?(Pl.stopBroadcast(),Pl.delete(),Pl=void 0,fs(qs,n.player,"stream stopped")):_r(qs,n.player,"bridge","stream already stopped");break}});function XKe(){const{viewport:n}=jc(),{width:e,height:t}=n.getCurrentViewport();Ke.useEffect(()=>(uHe(see()),()=>{hHe()}),[]);const[r]=Ke.useState(()=>new s$e);Ke.useEffect(()=>{if(!ame)return;document.body.appendChild(r.dom),r.showPanel(0),r.dom.style.cssText="position:fixed;bottom:0;left:0;z-index:2;";const T=Npe(()=>r.begin()),w=Ppe(()=>r.end());return()=>{document.body.removeChild(r.dom),T(),w()}},[r]);const i=h$e({benchmarksURL:"/benchmarks-min"}),[s,o]=Ke.useState(!1),[a,c]=Ke.useState(!1),[l,u]=Ke.useState(!1);Ke.useLayoutEffect(()=>{oo(qe,ii(),async()=>{await Jk("lowrez")==="on"&&o(!0),await Jk("crt")==="on"&&c(!0),await Jk("scanlines")==="on"&&u(!0)})},[]);const h=Math.min(e,t),f=s||h<600;kn.DRAW_CHAR_SCALE=f?1:2;const d=e>t,p=j4==="touchOnly"||XVe==="touch",m=!f&&!p&&a===!0&&i&&(i.tier>2||i.gpu?.includes("apple gpu"))&&!i.isMobile;Ke.useEffect(()=>{ad.setState(T=>({...T,islowrez:f,islandscape:d,showtouchcontrols:p}))},[f,d,p]);const{toast:_}=hs(),[v,S]=Ke.useState(_ee),b=Ke.useRef(null);return be.jsxs(be.Fragment,{children:[be.jsx(t$e,{ref:b,makeDefault:!0,near:1,far:2e3,position:[0,0,1e3]}),be.jsx(iy,{children:be.jsxs(HHe,{children:[be.jsx(tWe,{}),be.jsx(VWe,{}),be.jsx(rG,{toast:_}),be.jsx(XWe,{}),v&&be.jsxs(be.Fragment,{children:[be.jsx(Km,{blocking:!0,opacity:.5,color:"black",cursor:"pointer",width:Math.ceil(e/kn.DRAW_CHAR_WIDTH()),height:Math.ceil(t/kn.DRAW_CHAR_HEIGHT()),onClick:()=>S(!1)}),be.jsx(rG,{toast:"Click to un-mute"})]})]})}),be.jsx(qWe,{width:e,height:t,children:be.jsx(be.Fragment,{children:m&&be.jsxs(be.Fragment,{children:[l&&be.jsx(WWe,{}),be.jsx(HVe,{technique:SE.ESKIL,offset:.89,darkness:.911}),be.jsx(rHe,{viewheight:t})]})})})]})}_ee||window.addEventListener("keyup",()=>{GC()});window.addEventListener("click",()=>{GC()});window.addEventListener("dragover",n=>{n.preventDefault()});window.addEventListener("contextmenu",n=>{GC(),n.preventDefault()});window.addEventListener("paste",n=>{if(!n.clipboardData?.files.length)return;GC(),n.preventDefault(),[...n.clipboardData.files].forEach(t=>Th(qe,ii(),void 0,"file",`file:${t.name}`,t))});window.addEventListener("drop",n=>{GC(),n.preventDefault(),n.dataTransfer?.items?[...n.dataTransfer.items].forEach(t=>{if(t.kind==="file"){const r=t.getAsFile();he(r)&&Th(qe,ii(),void 0,"file",r.name,r)}}):[...n.dataTransfer?.files??[]].forEach(t=>Th(qe,ii(),void 0,"file",t.name,t))});document.addEventListener("DOMContentLoaded",()=>{let n,e=!1;document.body.style.cursor="none",document.body.addEventListener("mousemove",()=>{e||(document.body.style.cursor="",clearTimeout(n),n=setTimeout(()=>{document.body.style.cursor="none",e=!0,setTimeout(()=>{e=!1},200)},3e3))})});function ZKe(){return ad(e=>e.active)&&be.jsx(XKe,{})}WW({Mesh:df,OrthographicCamera:iO,Group:Ew,PlaneGeometry:ZA,MeshBasicMaterial:b5,BufferAttribute:Eh,BufferGeometry:ag,Points:Fce,BoxGeometry:jx,PerspectiveCamera:du,InstancedMesh:Dce,InstancedBufferAttribute:hL});const Hoe=n=>({...Dpe(n),filter:e=>{const t=e.filter(o=>!!o.object.visible),r=t.findIndex(o=>o.object.userData.blocking),i=r===-1?t:t.slice(0,r+1);let s="default";return i.some(o=>o.object.userData.cursor?(s=o.object.userData.cursor,!0):!1),document.querySelectorAll("html, body").forEach(o=>{o.style.cursor=s}),i}}),c5=Cpe(document.getElementById("frame"));function JKe(){const n=window.innerWidth,e=window.innerHeight,t=j9(n),r=j9(e),i=window.visualViewport?Math.min(e,window.visualViewport.height):e,s=Math.floor(i/kn.DRAW_CHAR_HEIGHT());ad.setState({saferows:s}),c5.configure({size:{left:0,top:0,width:t,height:r},events:Hoe,dpr:1,flat:!0,linear:!0,shadows:!1,gl:{alpha:!0,stencil:!1,antialias:!1,preserveDrawingBuffer:!0}}).catch(console.error)}const Sw=Bpe(JKe,256);async function QKe(){await c5.configure({events:Hoe,dpr:1,flat:!0,linear:!0,shadows:!1,gl:{alpha:!0,stencil:!1,antialias:!1,preserveDrawingBuffer:!0}}),window.addEventListener("resize",Sw),Sw(),window.visualViewport&&(window.visualViewport.addEventListener("resize",Sw),window.visualViewport.addEventListener("scroll",Sw)),Sw(),c5.render(be.jsx(ZKe,{}))}QKe().catch(console.error)});export default eXe();
